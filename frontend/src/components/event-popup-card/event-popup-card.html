<div class="card-container">
    <div class="card-content">
        <div class="header-row">
            <h1 class="title">{{ event.title }}</h1>
            @if (!event.isParticipating) {
            <mat-icon class="favorite-icon" [class.saved]="isSaved()"
                (click)="toggleFavorite.emit(); $event.stopPropagation()">
                {{ isSaved() ? 'favorite' : 'favorite_border' }}
            </mat-icon>
            }
        </div>
        <p class="day-time">{{ formatDateTime() }}</p>
        <p class="description">{{ event.description }}</p>

        <div class="info-section">
            <p class="info-item">ðŸ‘¥ {{ event.nPartecipants || 'Non specificato' }} partecipanti</p>
            <p class="info-item" *ngIf="event.occupiedSpots !== undefined">
                ðŸŽ« {{ event.nPartecipants - (event.occupiedSpots || 0) }} posti rimanenti
            </p>
            <p class="info-item">ðŸ’° {{ formatCost() }}</p>
        </div>

        <div class="eventer-section">
            <div class="eventer-info">
                @if (organizerImage) {
                <img [src]="organizerImage" alt="Organizer" class="organizer-avatar">
                } @else {
                <div class="organizer-avatar placeholder">{{ getInitials(organizerName) }}</div>
                }
                <div class="eventer-text">
                    <span class="eventer-label">Eventer</span>
                    <span class="eventer-name">{{ organizerName }}</span>
                </div>
            </div>

            @if (currentUserId && (creatorId || event.creatorId)) {
            @if (currentUserId.toString() === (creatorId || event.creatorId)?.toString()) {
            <span class="is-organizer-badge">Tu</span>
            } @else {
            @if (!isFollowing && !isLoadingFollowStatus) {
            <button class="icon-circle follow-btn-popup" (click)="followOrganizer(); $event.stopPropagation()">
                <mat-icon>person_add</mat-icon>
            </button>
            }
            }
            }
        </div>

        @if (event.participationStatus === 'ACCEPTED') {
        <button class="button partecipa-btn accepted" disabled>Sei dentro</button>
        } @else if (event.participationStatus === 'PENDING') {
        <button class="button partecipa-btn pending" disabled>In Attesa</button>
        } @else {
        <button class="button partecipa-btn" (click)="onParticipate()">Richiedi partecipazione</button>
        }
    </div>
</div>