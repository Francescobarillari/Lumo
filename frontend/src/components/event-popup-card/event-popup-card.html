<div class="card-container">
  <div class="card-content">
    <div class="header-row">
      <div class="title-block">
        <h1 class="title">{{ event.title }}</h1>
        @if (event.city) {
        <p class="subtitle">
          <mat-icon class="inline-icon">place</mat-icon>
          <span>{{ event.city }}</span>
        </p>
        } @else {
        <p class="subtitle">{{ getSubtitle() }}</p>
        }
        <p class="accent-date">
          <mat-icon class="inline-icon">event</mat-icon>
          <span>{{ formatHeroDate() }}</span>
        </p>
      </div>
      @if (!event.isParticipating) {
      <button class="favorite-icon" [class.saved]="isSaved()" (click)="toggleFavorite.emit(); $event.stopPropagation()"
        aria-label="Salva evento">
        <mat-icon>{{ isSaved() ? 'favorite' : 'favorite_border' }}</mat-icon>
      </button>
    }
    </div>

    <div class="chip-row">
      <span class="chip">
        <mat-icon>group</mat-icon>
        <span>{{ getActualParticipants() }} partecipanti</span>
      </span>
      <span class="chip" *ngIf="event.occupiedSpots !== undefined">
        <mat-icon>event_available</mat-icon>
        <span>{{ event.nPartecipants - (event.occupiedSpots || 0) }} posti liberi</span>
      </span>
      <span class="chip">
        <mat-icon>euro</mat-icon>
        <span>{{ formatCost() }}</span>
      </span>
    </div>

    <p class="description" *ngIf="showDescription()">{{ event.description }}</p>

    <div class="eventer-section">
      <div class="eventer-info">
        <button class="eventer-hit" type="button" (click)="onOrganizerClick(); $event.stopPropagation()">
          @if (organizerImage) {
          <img [src]="organizerImage" alt="Organizer" class="organizer-avatar">
          } @else {
          <div class="organizer-avatar placeholder">{{ getInitials(organizerName) }}</div>
          }
          <div class="eventer-text">
            <span class="eventer-label">Organizzatore</span>
            <span class="eventer-name">{{ organizerName }}</span>
          </div>
        </button>
      </div>

      @if (currentUserId && (creatorId || event.creatorId)) {
      @if (currentUserId.toString() === (creatorId || event.creatorId)?.toString()) {
      <span class="is-organizer-badge">Tu</span>
      } @else {
      @if (!isFollowing && !isLoadingFollowStatus) {
      <button class="icon-circle follow-btn-popup" (click)="followOrganizer(); $event.stopPropagation()">
        <mat-icon>person_add</mat-icon>
      </button>
      }
      }
      }
    </div>

    @if (isOrganizer()) {
    <div class="owner-note">Non puoi partecipare al tuo stesso evento</div>
    <button class="button cancel-btn" type="button" (click)="onDeleteEvent()">Cancella evento</button>
    } @else {
      @if (event.participationStatus === 'ACCEPTED') {
      <div class="participation-actions">
        <button class="button partecipa-btn accepted" disabled>Sei dentro</button>
        <button class="button leave-btn" type="button" (click)="onLeave()">Leave</button>
      </div>
      } @else if (event.participationStatus === 'PENDING') {
      <button class="button partecipa-btn pending" disabled>In Attesa</button>
      } @else {
      <button class="button partecipa-btn" (click)="onParticipate()">Richiedi partecipazione</button>
      }
    }
  </div>
</div>
