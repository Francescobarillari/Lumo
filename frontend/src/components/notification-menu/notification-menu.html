<div class="notif-container">
    <div class="notif-header">
        <mat-icon (click)="close.emit()" class="mobile-only back-arrow">arrow_back</mat-icon>
        <div class="title-wrap">
            <h1>Notifiche</h1>
        </div>
        <div class="header-actions">
            <button class="pill-btn" (click)="deleteRead()" title="Delete read notifications">
                <mat-icon>delete_sweep</mat-icon>
            </button>
            <!-- Close button only on mobile if it's meant to be an X, but user asked for back arrow.
                 Wrapping the old close button as per previous turn logic but keeping it hidden if back arrow is preferred. -->
        </div>
    </div>
    <div class="notif-list">
        @if (notifications.length === 0) {
        <div class="empty-state">No notifications</div>
        } @else {
        @for (n of notifications; track n.id) {
        <div class="notif-item" [class.unread]="!n.isRead" (click)="onNotificationClick(n)">
            <div class="icon-section">
                <mat-icon [style.color]="getIconColor(n.type)">{{ getIcon(n.type) }}</mat-icon>
            </div>

            <div class="content-section">
                <div class="notif-top">
                    <span class="notif-title">{{ n.title }}</span>
                    <span class="notif-time">{{ n.createdAt | date:'short' }}</span>
                </div>

                <div class="notif-msg" [class.expanded]="expandedId === n.id">
                    {{ n.message }}
                </div>

                @if (n.type === 'PARTICIPATION_REQUEST') {
                <div class="action-buttons">
                    <div class="btn-approve" (click)="acceptRequest(n, $event)" title="Accept">
                        <mat-icon>check</mat-icon>
                    </div>
                    <div class="btn-reject" (click)="rejectRequest(n, $event)" title="Reject">
                        <mat-icon>close</mat-icon>
                    </div>
                </div>
                }

                @if (n.type === 'REQUEST_ACCEPTED') {
                <div class="status-msg success">
                    <mat-icon>check_circle</mat-icon> Accepted
                </div>
                }

                @if (n.type === 'REQUEST_REJECTED') {
                <div class="status-msg error">
                    <mat-icon>cancel</mat-icon> Rejected
                </div>
                }

                @if (n.message.length > 100) {
                <div class="expand-btn" (click)="toggleExpand(n.id, $event)">
                    <mat-icon>{{ expandedId === n.id ? 'expand_less' : 'expand_more' }}</mat-icon>
                </div>
                }
            </div>
        </div>
        }
        }
    </div>
</div>
