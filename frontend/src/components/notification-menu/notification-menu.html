<div class="notif-container">
    <div class="notif-header">
        <div class="title-wrap">
            <h1>Notifiche</h1>
        </div>
        <div class="header-actions">
            <button class="pill-btn" (click)="deleteRead()" title="Cancella notifiche lette">
                <mat-icon>delete_sweep</mat-icon>
            </button>
        </div>
    </div>
    <div class="notif-list">
        @if (notifications.length === 0) {
        <div class="empty-state">Nessuna notifica</div>
        } @else {
        @for (n of notifications; track n.id) {
        <div class="notif-item" [class.unread]="!n.isRead">
            <div class="icon-section">
                <mat-icon [style.color]="getIconColor(n.type)">{{ getIcon(n.type) }}</mat-icon>
            </div>

            <div class="content-section">
                <div class="notif-top">
                    <span class="notif-title">{{ n.title }}</span>
                    <span class="notif-time">{{ n.createdAt | date:'short' }}</span>
                </div>

                <div class="notif-msg" [class.expanded]="expandedId === n.id">
                    {{ n.message }}
                </div>

                @if (n.type === 'PARTICIPATION_REQUEST') {
                <div class="action-buttons">
                    <div class="btn-approve" (click)="acceptRequest(n, $event)" title="Accetta">
                        <mat-icon>check</mat-icon>
                    </div>
                    <div class="btn-reject" (click)="rejectRequest(n, $event)" title="Rifiuta">
                        <mat-icon>close</mat-icon>
                    </div>
                </div>
                }

                @if (n.type === 'REQUEST_ACCEPTED') {
                <div class="status-msg success">
                    <mat-icon>check_circle</mat-icon> Accettata
                </div>
                }

                @if (n.type === 'REQUEST_REJECTED') {
                <div class="status-msg error">
                    <mat-icon>cancel</mat-icon> Rifiutata
                </div>
                }

                @if (n.message.length > 100) {
                <div class="expand-btn" (click)="toggleExpand(n.id, $event)">
                    <mat-icon>{{ expandedId === n.id ? 'expand_less' : 'expand_more' }}</mat-icon>
                </div>
                }
            </div>
        </div>
        }
        }
    </div>
</div>
