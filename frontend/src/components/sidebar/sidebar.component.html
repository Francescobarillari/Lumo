<div class="sidebar-container" [class.collapsed]="collapsed">
    <div class="header">
        <h1 class="logo">LUMO</h1>
        <button class="collapse-toggle" (click)="toggle()">
            <mat-icon>{{ collapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
        </button>
    </div>

    <div class="search-container" *ngIf="!collapsed">
        <input type="text" placeholder="Search city, events or user" class="search-input">
        <mat-icon class="search-icon">search</mat-icon>
    </div>
    <div class="sections-container" *ngIf="!collapsed">

        @if (!userId) {
        <!-- GUEST MODE: FOUND EVENTS -->
        <div class="events-section">
            <h2 class="section-title">FOUND EVENTS</h2>
            <div class="events-list">
                @for (event of foundEvents; track $index) {
                <app-event-card [title]="event.title" [location]="event.city" [dateTime]="formatDateTime(event)"
                    [distance]="formatDistance(event.distanceKm)" [id]="event.id!" [isSaved]="!!event.isSaved"
                    (focusLocation)="goToEvent(event)" (toggleFavorite)="toggleFavorite.emit(event)" />
                }
                @if (foundEvents.length === 0) {
                <div class="empty-state">Nessun evento trovato nella tua zona.</div>
                }
            </div>
        </div>
        } @else {
        <!-- LOGGED IN MODE -->

        <!-- FOLLOW UP EVENTS -->
        <div class="events-section">
            <h2 class="section-title">FOLLOW UP EVENTS</h2>
            <div class="events-list">
                @for (event of followUpEvents; track $index) {
                <app-event-card [title]="event.title" [location]="event.city" [dateTime]="formatDateTime(event)"
                    [distance]="formatDistance(event.distanceKm)" [id]="event.id!" [isSaved]="!!event.isSaved"
                    (focusLocation)="goToEvent(event)" (toggleFavorite)="toggleFavorite.emit(event)" />
                }
                @if (followUpEvents.length === 0) {
                <div class="empty-state">Nessun evento imminente a cui partecipi.</div>
                }
            </div>
        </div>

        <!-- SAVED EVENTS -->
        <div class="events-section">
            <h2 class="section-title">SAVED EVENTS</h2>
            <div class="events-list">
                @for (event of savedEvents; track $index) {
                <app-event-card [title]="event.title" [location]="event.city" [dateTime]="formatDateTime(event)"
                    [distance]="formatDistance(event.distanceKm)" [id]="event.id!" [isSaved]="!!event.isSaved"
                    (focusLocation)="goToEvent(event)" (toggleFavorite)="toggleFavorite.emit(event)" />
                }
                @if (savedEvents.length === 0) {
                <div class="empty-state">Non hai ancora salvato nessun evento.</div>
                }
            </div>
        </div>

        <!-- DISCOVER EVENTS -->
        <div class="events-section">
            <h2 class="section-title">DISCOVER EVENTS</h2>
            <div class="events-list">
                @for (event of discoverEvents; track $index) {
                <app-event-card [title]="event.title" [location]="event.city" [dateTime]="formatDateTime(event)"
                    [distance]="formatDistance(event.distanceKm)" [id]="event.id!" [isSaved]="!!event.isSaved"
                    (focusLocation)="goToEvent(event)" (toggleFavorite)="toggleFavorite.emit(event)" />
                }
                @if (discoverEvents.length === 0) {
                <div class="empty-state">Nessun nuovo evento da scoprire al momento.</div>
                }
            </div>
        </div>

        <!-- Fallback if specific sections empty -->
        <div *ngIf="discoverEvents.length === 0 && savedEvents.length === 0 && followUpEvents.length === 0"
            class="no-events">
            No events found.
        </div>
        }
    </div>
</div>