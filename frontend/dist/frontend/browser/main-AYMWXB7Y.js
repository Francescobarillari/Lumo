var iG=Object.create;var LM=Object.defineProperty,rG=Object.defineProperties,oG=Object.getOwnPropertyDescriptor,sG=Object.getOwnPropertyDescriptors,aG=Object.getOwnPropertyNames,xw=Object.getOwnPropertySymbols,lG=Object.getPrototypeOf,NM=Object.prototype.hasOwnProperty,xN=Object.prototype.propertyIsEnumerable;var yN=(i,n,e)=>n in i?LM(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e,Ht=(i,n)=>{for(var e in n||={})NM.call(n,e)&&yN(i,e,n[e]);if(xw)for(var e of xw(n))xN.call(n,e)&&yN(i,e,n[e]);return i},wi=(i,n)=>rG(i,sG(n));var bw=(i,n)=>{var e={};for(var a in i)NM.call(i,a)&&n.indexOf(a)<0&&(e[a]=i[a]);if(i!=null&&xw)for(var a of xw(i))n.indexOf(a)<0&&xN.call(i,a)&&(e[a]=i[a]);return e};var Nr=(i,n)=>()=>(n||i((n={exports:{}}).exports,n),n.exports);var cG=(i,n,e,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let d of aG(n))!NM.call(i,d)&&d!==e&&LM(i,d,{get:()=>n[d],enumerable:!(a=oG(n,d))||a.enumerable});return i};var ww=(i,n,e)=>(e=i!=null?iG(lG(i)):{},cG(n||!i||!i.__esModule?LM(e,"default",{value:i,enumerable:!0}):e,i));var Er=(i,n,e)=>new Promise((a,d)=>{var r=k=>{try{P(e.next(k))}catch(X){d(X)}},E=k=>{try{P(e.throw(k))}catch(X){d(X)}},P=k=>k.done?a(k.value):Promise.resolve(k.value).then(r,E);P((e=e.apply(i,n)).next())});var gO=Nr((fO,mO)=>{"use strict";(function(i,n){typeof fO=="object"&&typeof mO<"u"?mO.exports=n():typeof define=="function"&&define.amd?define(n):(i=typeof globalThis<"u"?globalThis:i||self,i.mapboxgl=n())})(fO,function(){"use strict";var i,n,e;function a(r,E){if(!i)i=E;else if(!n)n=E;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",k={};i(k),e=E(k),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(e.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}a(["exports"],function(r){var E=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function k(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s*m-h*u;return g?(l[0]=m*(g=1/g),l[1]=-u*g,l[2]=-h*g,l[3]=s*g,l):null}function X(){var l=new P(9);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function oe(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],C=t[7],T=t[8];return l[0]=g*T-v*C,l[1]=h*C-u*T,l[2]=u*v-h*g,l[3]=v*b-m*T,l[4]=s*T-h*b,l[5]=h*m-s*v,l[6]=m*C-g*b,l[7]=u*b-s*C,l[8]=s*g-u*m,l}function Se(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],C=t[6],T=t[7],I=t[8],D=s[0],O=s[1],R=s[2],B=s[3],H=s[4],$=s[5],Y=s[6],Q=s[7],ie=s[8];return l[0]=D*u+O*g+R*C,l[1]=D*h+O*v+R*T,l[2]=D*m+O*b+R*I,l[3]=B*u+H*g+$*C,l[4]=B*h+H*v+$*T,l[5]=B*m+H*b+$*I,l[6]=Y*u+Q*g+ie*C,l[7]=Y*h+Q*v+ie*T,l[8]=Y*m+Q*b+ie*I,l}function $e(){var l=new P(16);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function ke(l){var t=new P(16);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=l[3],t[4]=l[4],t[5]=l[5],t[6]=l[6],t[7]=l[7],t[8]=l[8],t[9]=l[9],t[10]=l[10],t[11]=l[11],t[12]=l[12],t[13]=l[13],t[14]=l[14],t[15]=l[15],t}function ht(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Nt(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],C=t[7],T=t[8],I=t[9],D=t[10],O=t[11],R=t[12],B=t[13],H=t[14],$=t[15],Y=s*v-u*g,Q=s*b-h*g,ie=s*C-m*g,he=u*b-h*v,le=u*C-m*v,me=h*C-m*b,ye=T*B-I*R,we=T*H-D*R,je=T*$-O*R,Ie=I*H-D*B,We=I*$-O*B,Ke=D*$-O*H,Qe=Y*Ke-Q*We+ie*Ie+he*je-le*we+me*ye;return Qe?(l[0]=(v*Ke-b*We+C*Ie)*(Qe=1/Qe),l[1]=(h*We-u*Ke-m*Ie)*Qe,l[2]=(B*me-H*le+$*he)*Qe,l[3]=(D*le-I*me-O*he)*Qe,l[4]=(b*je-g*Ke-C*we)*Qe,l[5]=(s*Ke-h*je+m*we)*Qe,l[6]=(H*ie-R*me-$*Q)*Qe,l[7]=(T*me-D*ie+O*Q)*Qe,l[8]=(g*We-v*je+C*ye)*Qe,l[9]=(u*je-s*We-m*ye)*Qe,l[10]=(R*le-B*ie+$*Y)*Qe,l[11]=(I*ie-T*le-O*Y)*Qe,l[12]=(v*we-g*Ie-b*ye)*Qe,l[13]=(s*Ie-u*we+h*ye)*Qe,l[14]=(B*Q-R*he-H*Y)*Qe,l[15]=(T*he-I*Q+D*Y)*Qe,l):null}function Mt(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],C=t[6],T=t[7],I=t[8],D=t[9],O=t[10],R=t[11],B=t[12],H=t[13],$=t[14],Y=t[15],Q=s[0],ie=s[1],he=s[2],le=s[3];return l[0]=Q*u+ie*v+he*I+le*B,l[1]=Q*h+ie*b+he*D+le*H,l[2]=Q*m+ie*C+he*O+le*$,l[3]=Q*g+ie*T+he*R+le*Y,l[4]=(Q=s[4])*u+(ie=s[5])*v+(he=s[6])*I+(le=s[7])*B,l[5]=Q*h+ie*b+he*D+le*H,l[6]=Q*m+ie*C+he*O+le*$,l[7]=Q*g+ie*T+he*R+le*Y,l[8]=(Q=s[8])*u+(ie=s[9])*v+(he=s[10])*I+(le=s[11])*B,l[9]=Q*h+ie*b+he*D+le*H,l[10]=Q*m+ie*C+he*O+le*$,l[11]=Q*g+ie*T+he*R+le*Y,l[12]=(Q=s[12])*u+(ie=s[13])*v+(he=s[14])*I+(le=s[15])*B,l[13]=Q*h+ie*b+he*D+le*H,l[14]=Q*m+ie*C+he*O+le*$,l[15]=Q*g+ie*T+he*R+le*Y,l}function Xt(l,t,s){var u,h,m,g,v,b,C,T,I,D,O,R,B=s[0],H=s[1],$=s[2];return t===l?(l[12]=t[0]*B+t[4]*H+t[8]*$+t[12],l[13]=t[1]*B+t[5]*H+t[9]*$+t[13],l[14]=t[2]*B+t[6]*H+t[10]*$+t[14],l[15]=t[3]*B+t[7]*H+t[11]*$+t[15]):(h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],C=t[6],T=t[7],I=t[8],D=t[9],O=t[10],R=t[11],l[0]=u=t[0],l[1]=h,l[2]=m,l[3]=g,l[4]=v,l[5]=b,l[6]=C,l[7]=T,l[8]=I,l[9]=D,l[10]=O,l[11]=R,l[12]=u*B+v*H+I*$+t[12],l[13]=h*B+b*H+D*$+t[13],l[14]=m*B+C*H+O*$+t[14],l[15]=g*B+T*H+R*$+t[15]),l}function Vn(l,t,s){var u=s[0],h=s[1],m=s[2];return l[0]=t[0]*u,l[1]=t[1]*u,l[2]=t[2]*u,l[3]=t[3]*u,l[4]=t[4]*h,l[5]=t[5]*h,l[6]=t[6]*h,l[7]=t[7]*h,l[8]=t[8]*m,l[9]=t[9]*m,l[10]=t[10]*m,l[11]=t[11]*m,l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15],l}function sr(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[4],g=t[5],v=t[6],b=t[7],C=t[8],T=t[9],I=t[10],D=t[11];return t!==l&&(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[4]=m*h+C*u,l[5]=g*h+T*u,l[6]=v*h+I*u,l[7]=b*h+D*u,l[8]=C*h-m*u,l[9]=T*h-g*u,l[10]=I*h-v*u,l[11]=D*h-b*u,l}function $i(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[0],g=t[1],v=t[2],b=t[3],C=t[8],T=t[9],I=t[10],D=t[11];return t!==l&&(l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=m*h-C*u,l[1]=g*h-T*u,l[2]=v*h-I*u,l[3]=b*h-D*u,l[8]=m*u+C*h,l[9]=g*u+T*h,l[10]=v*u+I*h,l[11]=b*u+D*h,l}function Li(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[0],g=t[1],v=t[2],b=t[3],C=t[4],T=t[5],I=t[6],D=t[7];return t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=m*h+C*u,l[1]=g*h+T*u,l[2]=v*h+I*u,l[3]=b*h+D*u,l[4]=C*h-m*u,l[5]=T*h-g*u,l[6]=I*h-v*u,l[7]=D*h-b*u,l}function Or(l,t){return l[0]=t[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=t[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=t[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Ho(l,t,s){var u,h,m,g=s[0],v=s[1],b=s[2],C=Math.sqrt(g*g+v*v+b*b);return C<E?null:(g*=C=1/C,v*=C,b*=C,u=Math.sin(t),h=Math.cos(t),l[0]=g*g*(m=1-h)+h,l[1]=v*g*m+b*u,l[2]=b*g*m-v*u,l[3]=0,l[4]=g*v*m-b*u,l[5]=v*v*m+h,l[6]=b*v*m+g*u,l[7]=0,l[8]=g*b*m+v*u,l[9]=v*b*m-g*u,l[10]=b*b*m+h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function Ys(l,t){var s=t[0],u=t[1],h=t[2],m=t[4],g=t[5],v=t[6],b=t[8],C=t[9],T=t[10];return l[0]=Math.sqrt(s*s+u*u+h*h),l[1]=Math.sqrt(m*m+g*g+v*v),l[2]=Math.sqrt(b*b+C*C+T*T),l}function Nu(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s+s,v=u+u,b=h+h,C=s*g,T=u*g,I=u*v,D=h*g,O=h*v,R=h*b,B=m*g,H=m*v,$=m*b;return l[0]=1-I-R,l[1]=T+$,l[2]=D-H,l[3]=0,l[4]=T-$,l[5]=1-C-R,l[6]=O+B,l[7]=0,l[8]=D+H,l[9]=O-B,l[10]=1-C-I,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var zu=Mt;function ci(){var l=new P(3);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Bu(l){var t=new P(3);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t}function xo(l){var t=l[0],s=l[1],u=l[2];return Math.sqrt(t*t+s*s+u*u)}function yr(l,t,s){var u=new P(3);return u[0]=l,u[1]=t,u[2]=s,u}function Ji(l,t,s,u){return l[0]=t,l[1]=s,l[2]=u,l}function Wr(l,t,s){return l[0]=t[0]+s[0],l[1]=t[1]+s[1],l[2]=t[2]+s[2],l}function dl(l,t,s){return l[0]=t[0]-s[0],l[1]=t[1]-s[1],l[2]=t[2]-s[2],l}function Va(l,t,s){return l[0]=t[0]*s[0],l[1]=t[1]*s[1],l[2]=t[2]*s[2],l}function hl(l,t,s){return l[0]=Math.min(t[0],s[0]),l[1]=Math.min(t[1],s[1]),l[2]=Math.min(t[2],s[2]),l}function Ua(l,t,s){return l[0]=Math.max(t[0],s[0]),l[1]=Math.max(t[1],s[1]),l[2]=Math.max(t[2],s[2]),l}function fr(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l[2]=t[2]*s,l}function Xs(l,t,s,u){return l[0]=t[0]+s[0]*u,l[1]=t[1]+s[1]*u,l[2]=t[2]+s[2]*u,l}function Jf(l,t){var s=t[0]-l[0],u=t[1]-l[1],h=t[2]-l[2];return Math.sqrt(s*s+u*u+h*h)}function ip(l,t){var s=t[0]-l[0],u=t[1]-l[1],h=t[2]-l[2];return s*s+u*u+h*h}function em(l){var t=l[0],s=l[1],u=l[2];return t*t+s*s+u*u}function zc(l,t){return l[0]=-t[0],l[1]=-t[1],l[2]=-t[2],l}function Yi(l,t){var s=t[0],u=t[1],h=t[2],m=s*s+u*u+h*h;return m>0&&(m=1/Math.sqrt(m)),l[0]=t[0]*m,l[1]=t[1]*m,l[2]=t[2]*m,l}function Ir(l,t){return l[0]*t[0]+l[1]*t[1]+l[2]*t[2]}function Go(l,t,s){var u=t[0],h=t[1],m=t[2],g=s[0],v=s[1],b=s[2];return l[0]=h*b-m*v,l[1]=m*g-u*b,l[2]=u*v-h*g,l}function Vu(l,t,s,u){var h=t[0],m=t[1],g=t[2];return l[0]=h+u*(s[0]-h),l[1]=m+u*(s[1]-m),l[2]=g+u*(s[2]-g),l}function Fr(l,t,s){var u=t[0],h=t[1],m=t[2],g=s[3]*u+s[7]*h+s[11]*m+s[15];return l[0]=(s[0]*u+s[4]*h+s[8]*m+s[12])/(g=g||1),l[1]=(s[1]*u+s[5]*h+s[9]*m+s[13])/g,l[2]=(s[2]*u+s[6]*h+s[10]*m+s[14])/g,l}function Bc(l,t,s){var u=t[0],h=t[1],m=t[2];return l[0]=u*s[0]+h*s[3]+m*s[6],l[1]=u*s[1]+h*s[4]+m*s[7],l[2]=u*s[2]+h*s[5]+m*s[8],l}function Vc(l,t,s){var u=s[0],h=s[1],m=s[2],g=s[3],v=t[0],b=t[1],C=t[2],T=h*C-m*b,I=m*v-u*C,D=u*b-h*v;return l[0]=v+g*(T+=T)+h*(D+=D)-m*(I+=I),l[1]=b+g*I+m*T-u*D,l[2]=C+g*D+u*I-h*T,l}function zs(l){return l[0]=0,l[1]=0,l[2]=0,l}function rs(l,t){return l[0]===t[0]&&l[1]===t[1]&&l[2]===t[2]}var Br=dl,bv=Va,Ud=xo;function Uu(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Uc(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l[2]=t[2]*s,l[3]=t[3]*s,l}function jc(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s*s+u*u+h*h+m*m;return g>0&&(g=1/Math.sqrt(g)),l[0]=s*g,l[1]=u*g,l[2]=h*g,l[3]=m*g,l}function qo(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3];return l[0]=s[0]*u+s[4]*h+s[8]*m+s[12]*g,l[1]=s[1]*u+s[5]*h+s[9]*m+s[13]*g,l[2]=s[2]*u+s[6]*h+s[10]*m+s[14]*g,l[3]=s[3]*u+s[7]*h+s[11]*m+s[15]*g,l}function ql(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function jd(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function ja(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+g*v,l[1]=h*b+m*v,l[2]=m*b-h*v,l[3]=g*b-u*v,l}function Wl(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b-m*v,l[1]=h*b+g*v,l[2]=m*b+u*v,l[3]=g*b-h*v,l}ci(),Uu();var ds,ju,$u,Hu=jc,$d=(ds=ci(),ju=yr(1,0,0),$u=yr(0,1,0),function(l,t,s){var u=Ir(t,s);return u<-.999999?(Go(ds,ju,t),Ud(ds)<1e-6&&Go(ds,$u,t),Yi(ds,ds),(function(h,m,g){g*=.5;var v=Math.sin(g);h[0]=v*m[0],h[1]=v*m[1],h[2]=v*m[2],h[3]=Math.cos(g)})(l,ds,Math.PI),l):u>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(Go(ds,t,s),l[0]=ds[0],l[1]=ds[1],l[2]=ds[2],l[3]=1+u,Hu(l,l))});function bo(){var l=new P(2);return P!=Float32Array&&(l[0]=0,l[1]=0),l}function Es(l,t){var s=new P(2);return s[0]=l,s[1]=t,s}function rp(l,t,s){return l[0]=t,l[1]=s,l}function $c(l,t,s){return l[0]=t[0]+s[0],l[1]=t[1]+s[1],l}function pl(l,t,s){return l[0]=t[0]-s[0],l[1]=t[1]-s[1],l}function Zl(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l}function $a(l){var t=l[0],s=l[1];return Math.sqrt(t*t+s*s)}function op(l,t){var s=t[0],u=t[1],h=s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),l[0]=t[0]*h,l[1]=t[1]*h,l}function Gu(l,t){return l[0]*t[0]+l[1]*t[1]}ql(),ql(),X();var ar,Mo,tm=pl;function qu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}bo();var Ha=(function(){if(Mo)return ar;function l(t,s,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=u,this.p2y=h}return Mo=1,ar=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,h=0;h<8;h++){var m=this.sampleCurveX(u)-t;if(Math.abs(m)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=m/g}var v=0,b=1;for(u=t,h=0;h<20&&(m=this.sampleCurveX(u),!(Math.abs(m-t)<s));h++)t>m?v=u:b=u,u=.5*(b-v)+v;return u},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},ar})(),nm=qu(Ha);function ot(l,t){this.x=l,this.y=t}function Yl(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!Yl(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(let s in l)if(!Yl(l[s],t[s]))return!1;return!0}return l===t}ot.prototype={clone(){return new ot(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,t){return this.clone()._rotateAround(l,t)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){let t=l.x-this.x,s=l.y-this.y;return t*t+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,t){return Math.atan2(this.x*t-this.y*l,this.x*l+this.y*t)},_matMult(l){let t=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=t,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){let l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){let t=Math.cos(l),s=Math.sin(l),u=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=u,this},_rotateAround(l,t){let s=Math.cos(l),u=Math.sin(l),h=t.y+u*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-u*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ot},ot.convert=function(l){if(l instanceof ot)return l;if(Array.isArray(l))return new ot(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new ot(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};let wv=Math.PI/180,Wu=180/Math.PI;function Zn(l){return l*wv}function os(l){return l*Wu}let Cv=[[0,0],[1,0],[1,1],[0,1]];function Zu(l){if(l<=0)return 0;if(l>=1)return 1;let t=l*l,s=t*l;return 4*(l<.5?s:3*(l-t)+s-.75)}function sp(l,t,s,u){let h=new nm(l,t,s,u);return function(m){return h.solve(m)}}let Re=sp(.25,.1,.25,1);function G(l,t,s){return Math.min(s,Math.max(t,l))}function K(l,t,s){return(s=G((s-l)/(t-l),0,1))*s*(3-2*s)}function se(l,t,s){let u=s-t,h=((l-t)%u+u)%u+t;return h===t?s:h}function xe(l,t,s){if(!l.length)return s(null,[]);let u=l.length,h=new Array(l.length),m=null;l.forEach((g,v)=>{t(g,(b,C)=>{b&&(m=b),h[v]=C,--u==0&&s(m,h)})})}let ve=1;function Ee(){return ve++}function ze(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function Pe(l,t){l.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function Ne(l,t,s){let u={};for(let h in l)u[h]=t.call(this,l[h],h,l);return u}function ut(l,t,s){let u={};for(let h in l)t.call(this,l[h],h,l)&&(u[h]=l[h]);return u}function Xe(l){return Array.isArray(l)?l.map(Xe):typeof l=="object"&&l?Ne(l,Xe):l}function kt(l,t){for(let s=0;s<l.length;s++)if(t.indexOf(l[s])>=0)return!0;return!1}let Qt={};function At(l){Qt[l]||(typeof console<"u"&&console.warn(l),Qt[l]=!0)}function xn(l,t,s){return(s.y-l.y)*(t.x-l.x)>(t.y-l.y)*(s.x-l.x)}function vn(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}function gn([l,t,s]){let u=Zn(t+90),h=Zn(s);return{x:l*Math.cos(u)*Math.sin(h),y:l*Math.sin(u)*Math.sin(h),z:l*Math.cos(h),azimuthal:t,polar:s}}function Un(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function mr(l){let t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,h,m)=>{let g=h||m;return t[u]=!g||g.toLowerCase(),""}),t["max-age"]){let s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Vr=null;function xr(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function Zr(l,t,s,u){for(;t<s;){let h=t+s>>1;l[h]<u?t=h+1:s=h}return t}function lr(l,t,s,u){for(;t<s;){let h=t+s>>1;l[h]<=u?t=h+1:s=h}return t}function Gn(l){return l>0?1/(1.001-l):1+l}function cr(l){return l>0?1-1/(1.001-l):-l}function Pi(l,t,s){return(l-t.min)*(s.max-s.min)/(t.max-t.min)+s.min}let kn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!kn.API_URL)return null;try{let l=new URL(kn.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function br(l){return kn.API_URL_REGEX.test(l)}function ko(l){return kn.API_SPRITE_REGEX.test(l)}let Wo,Ss,Yu,wo,Ks,ss;function fl(){return Wo==null&&(Wo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Wo}let ho={now:()=>wo!==void 0?wo:performance.now(),setNow(l){wo=l},restoreNow(){wo=void 0},frame(l){let t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){let{width:s,height:u}=l;Ks||(Ks=document.createElement("canvas"));let h=Ks.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Ks.width||u>Ks.height)&&(Ks.width=s,Ks.height=u),h.clearRect(-t,-t,s+2*t,u+2*t),h.drawImage(l,0,0,s,u),h.getImageData(-t,-t,s+2*t,u+2*t)},resolveURL:l=>(Ss||(Ss=document.createElement("a")),Ss.href=l,Ss.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Yu==null&&(Yu=window.matchMedia("(prefers-reduced-motion: reduce)")),Yu.matches)},hasCanvasFingerprintNoise(){if(ss!==void 0)return ss;if(!fl())return ss=!1,!1;let l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0}),s=0;for(let h=0;h<l.width;++h)t.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,t.fillRect(h,0,1,1);let u=t.getImageData(0,0,l.width,l.height);s=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&s++!==u.data[h])return ss=!0,!0;return ss=!1,!1}};function Xu(l,t){let s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(t).toString()}`;let u=new URLSearchParams(l.slice(s));for(let h in t)u.set(h,t[h]);return`${l.slice(0,s)}?${u.toString()}`}function Hd(l,t={persistentParams:[]}){let s=l.indexOf("?");if(s<0)return l;let u=new URLSearchParams,h=new URLSearchParams(l.slice(s));for(let g of t.persistentParams){let v=h.get(g);v&&u.set(g,v)}let m=u.toString();return`${l.slice(0,s)}${m.length>0?`?${m}`:""}`}let im="mapbox-tiles",rm=500,om=50,ap=["language","worldview","jobid"],ml,Ts;function Ga(){try{return caches}catch{}}function qa(){let l=Ga();l&&ml==null&&(ml=l.open(im))}let va=1/0,gl={supported:!1,testSupport:function(l){!sm&&Ku&&(Qu?wb(l):Hc=l)}},Hc,Ku,sm=!1,Qu=!1,am=typeof self<"u"?self:{};function wb(l){let t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Ku),l.isContextLost())return;gl.supported=!0}catch{}l.deleteTexture(t),sm=!0}am.document&&(Ku=am.document.createElement("img"),Ku.onload=function(){Hc&&wb(Hc),Hc=null,Qu=!0},Ku.onerror=function(){sm=!0,Hc=null},Ku.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let lp={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(lp);class Bs extends Error{constructor(t,s,u){s===401&&br(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let lm=Un()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ju=function(l,t){if(!(/^file:/.test(s=l.url)||/^file:/.test(lm())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,h){let m=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:lm(),referrerPolicy:u.referrerPolicy,signal:m.signal}),v=!1,b=!1,C=(T=g.url).indexOf("sku=")>0&&br(T);var T;u.type==="json"&&g.headers.set("Accept","application/json");let I=(O,R,B)=>{if(b)return;if(O&&O.message!=="SecurityError"&&At(O.toString()),R&&B)return D(R);let H=Date.now();fetch(g).then($=>{if($.ok){let Y=C?$.clone():null;return D($,Y,H)}return h(new Bs($.statusText,$.status,u.url))}).catch($=>{$.name!=="AbortError"&&h(new Error(`${$.message} ${u.url}`))})},D=(O,R,B)=>{(u.type==="arrayBuffer"?O.arrayBuffer():u.type==="json"?O.json():O.text()).then(H=>{b||(R&&B&&(function($,Y,Q){if(qa(),ml==null)return;let ie=mr(Y.headers.get("Cache-Control")||"");if(ie["no-store"])return;let he={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((ye,we)=>he.headers.set(we,ye)),ie["max-age"]&&he.headers.set("Expires",new Date(Q+1e3*ie["max-age"]).toUTCString());let le=he.headers.get("Expires");if(!le||new Date(le).getTime()-Q<42e4)return;let me=Hd($.url,{persistentParams:ap});if(Y.status===206){let ye=$.headers.get("Range");if(!ye)return;he.status=200,me=Xu(me,{range:ye})}(function(ye,we){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch{Ts=!1}Ts?we(ye.body):ye.blob().then(we).catch(je=>At(je.message))})(Y,ye=>{let we=new Response((je=Y.status)!==200&&je!==404&&[101,103,204,205,304].includes(je)?null:ye,he);var je;qa(),ml?.then(Ie=>Ie.put(me,we)).catch(Ie=>At(Ie.message))})})(g,R,B),v=!0,h(null,H,O.headers))}).catch(H=>{b||h(new Error(H.message))})};return C?(function(O,R){if(qa(),ml==null)return R(null);ml.then(B=>{let H=Hd(O.url,{persistentParams:ap}),$=O.headers.get("Range");$&&(H=Xu(H,{range:$})),B.match(H).then(Y=>{let Q=(function(ie){if(!ie)return!1;let he=new Date(ie.headers.get("Expires")||0),le=mr(ie.headers.get("Cache-Control")||"");return Number(he)>Date.now()&&!le["no-cache"]})(Y);B.delete(H).catch(R),Q&&B.put(H,Y.clone()).catch(R),R(null,Y,Q)}).catch(R)}).catch(R)})(g,I):I(null,null),{cancel:()=>{b=!0,v||m.abort()}}})(l,t);if(Un(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var s;return(function(u,h){let m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(b){return h(b)}let v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{let C=b.split(": "),T=C.shift(),I=C.join(": ");v.append(T,I)}),h(null,g,v)}else h(new Bs(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}})(l,t)},Xl=function(l,t){return Ju(Object.assign(l,{type:"arrayBuffer"}),t)};function NT(l){let t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}let Cb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",cp,qn;cp=[],qn=0;let cm=function(l,t){if(gl.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),qn>=kn.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return cp.push(m),m}qn++;let s=!1,u=()=>{if(!s)for(s=!0,qn--;cp.length&&qn<kn.MAX_PARALLEL_IMAGE_REQUESTS;){let m=cp.shift(),{requestParameters:g,callback:v,cancelled:b}=m;b||(m.cancel=cm(g,v).cancel)}},h=Xl(l,(m,g,v)=>{u(),m?t(m):g&&(self.createImageBitmap?(function(b,C){let T=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(T).then(I=>{C(null,I)}).catch(I=>{C(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(g,(b,C)=>t(b,C,v)):(function(b,C){let T=new Image;T.onload=()=>{C(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Cb})},T.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let I=new Blob([new Uint8Array(b)],{type:"image/png"});T.src=b.byteLength?URL.createObjectURL(I):Cb})(g,(b,C)=>t(b,C,v)))});return{cancel:()=>{h.cancel(),u()}}};var Ev,Eb,Sb,Gc={exports:{}},up={exports:{}},dp={exports:{}},Sv=(function(){if(Sb)return Gc.exports;Sb=1;var l=(Ev||(Ev=1,up.exports=function(s,u){var h,m,g,v,b,C,T,I;for(m=s.length-(h=3&s.length),g=u,b=3432918353,C=461845907,I=0;I<m;)T=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,h){case 3:T^=(255&s.charCodeAt(I+2))<<16;case 2:T^=(255&s.charCodeAt(I+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&s.charCodeAt(I)))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),up.exports),t=(Eb||(Eb=1,dp.exports=function(s,u){for(var h,m=s.length,g=u^m,v=0;m>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),dp.exports);return Gc.exports=l,Gc.exports.murmur3=l,Gc.exports.murmur2=t,Gc.exports})(),um=qu(Sv);class _l{constructor(t,...s){Object.assign(this,s[0]||{}),this.type=t}}class hp extends _l{constructor(t,s={}){super("error",Object.assign({error:t},s))}}function Tv(l,t,s){s[l]&&s[l].indexOf(t)!==-1||(s[l]=s[l]||[],s[l].push(t))}function qc(l,t,s){if(s&&s[l]){let u=s[l].indexOf(t);u!==-1&&s[l].splice(u,1)}}class ed{on(t,s){return this._listeners=this._listeners||{},Tv(t,s,this._listeners),this}off(t,s){return qc(t,s,this._listeners),qc(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Tv(t,s,this._oneTimeListeners),this):new Promise(u=>{this.once(t,u)})}fire(t,s){let u=typeof t=="string"?new _l(t,s):t,h=u.type;if(this.listens(h)){u.target=this;let m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(let b of m)b.call(this,u);let g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(let b of g)qc(h,b,this._oneTimeListeners),b.call(this,u);let v=this._eventedParent;if(v){let b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,b),v.fire(u)}}else u instanceof hp&&console.error(u.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}class as{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new as(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){let[s,u]=t.split("");return new as({name:s,iconsetId:u})}static isEqual(t,s){return t.name===s.name&&t.iconsetId===s.iconsetId}toString(){return as.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var dm,pp={},ya=(function(){if(dm)return pp;dm=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(m){return(m=Math.round(m))<0?0:m>255?255:m}function s(m){return t(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function h(m,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(g-m)*v*6:2*v<1?g:3*v<2?m+(g-m)*(2/3-v)*6:m}try{pp.parseCSSColor=function(m){var g,v=m.replace(/ /g,"").toLowerCase();if(v in l)return l[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var b=v.indexOf("("),C=v.indexOf(")");if(b!==-1&&C+1===v.length){var T=v.substr(0,b),I=v.substr(b+1,C-(b+1)).split(","),D=1;switch(T){case"rgba":if(I.length!==4)return null;D=u(I.pop());case"rgb":return I.length!==3?null:[s(I[0]),s(I[1]),s(I[2]),D];case"hsla":if(I.length!==4)return null;D=u(I.pop());case"hsl":if(I.length!==3)return null;var O=(parseFloat(I[0])%360+360)%360/360,R=u(I[1]),B=u(I[2]),H=B<=.5?B*(R+1):B+R-B*R,$=2*B-H;return[t(255*h($,H,O+1/3)),t(255*h($,H,O)),t(255*h($,H,O-1/3)),D];default:return null}}return null}}catch{}return pp})();class ui{constructor(t,s,u,h=1){this.r=t,this.g=s,this.b=u,this.a=h}static parse(t){if(!t)return;if(t instanceof ui)return t;if(typeof t!="string")return;let s=ya.parseCSSColor(t);return s?new ui(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){let[t,s,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*s)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(t){let{r:s,g:u,b:h,a:m}=this;return new Ib(t,s,u,h,m)}toPremultipliedRenderColor(t){let{r:s,g:u,b:h,a:m}=this;return new Mb(t,s*m,u*m,h*m,m)}clone(){return new ui(this.r,this.g,this.b,this.a)}}class Tb{constructor(t,s,u,h,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,t){let v=t.image.height,b=v*v;this.premultiplied?(s=m===0?0:s/m*(v-1),u=m===0?0:u/m*(v-1),h=m===0?0:h/m*(v-1)):(s*=v-1,u*=v-1,h*=v-1);let C=Math.floor(s),T=Math.floor(u),I=Math.floor(h),D=Math.ceil(s),O=Math.ceil(u),R=Math.ceil(h),B=s-C,H=u-T,$=h-I,Y=t.image.data,Q=4*(C+T*b+I*v),ie=4*(C+T*b+R*v),he=4*(C+O*b+I*v),le=4*(C+O*b+R*v),me=4*(D+T*b+I*v),ye=4*(D+T*b+R*v),we=4*(D+O*b+I*v),je=4*(D+O*b+R*v);if(Q<0||je>=Y.length)throw new Error("out of range");this.r=on(on(on(Y[Q],Y[ie],$),on(Y[he],Y[le],$),H),on(on(Y[me],Y[ye],$),on(Y[we],Y[je],$),H),B)/255*(this.premultiplied?m:1),this.g=on(on(on(Y[Q+1],Y[ie+1],$),on(Y[he+1],Y[le+1],$),H),on(on(Y[me+1],Y[ye+1],$),on(Y[we+1],Y[je+1],$),H),B)/255*(this.premultiplied?m:1),this.b=on(on(on(Y[Q+2],Y[ie+2],$),on(Y[he+2],Y[le+2],$),H),on(on(Y[me+2],Y[ye+2],$),on(Y[we+2],Y[je+2],$),H),B)/255*(this.premultiplied?m:1),this.a=m}else this.r=s,this.g=u,this.b=h,this.a=m}toArray(){let{r:t,g:s,b:u,a:h}=this;return[255*t,255*s,255*u,h]}toHslaArray(){let{r:t,g:s,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];let R=1/h;t*=R,s*=R,u*=R}let m=Math.min(Math.max(t,0),1),g=Math.min(Math.max(s,0),1),v=Math.min(Math.max(u,0),1),b=Math.min(m,g,v),C=Math.max(m,g,v),T=C-b,I=.5*(b+C);if(T===0)return[0,0,100*I,h];let D=I>.5?T/(2-C-b):T/(C+b),O;switch(C){case m:O=60*((g-v)/T+(g<v?6:0));break;case g:O=60*((v-m)/T+2);break;default:O=60*((m-g)/T+4)}return[O,100*D,100*I,h]}toArray01(){let{r:t,g:s,b:u,a:h}=this;return[t,s,u,h]}toArray01Scaled(t){let{r:s,g:u,b:h}=this;return[s*t,u*t,h*t]}toArray01Linear(){let{r:t,g:s,b:u,a:h}=this;return[Math.pow(t,2.2),Math.pow(s,2.2),Math.pow(u,2.2),h]}}class Ib extends Tb{constructor(t,s,u,h,m){super(t,s,u,h,m,!1)}}class Mb extends Tb{constructor(t,s,u,h,m){super(t,s,u,h,m,!0)}}function on(l,t,s){return l*(1-s)+t*s}function Iv(l,t,s){return l.map((u,h)=>on(u,t[h],s))}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1),ui.blue=new ui(0,0,1,1);var fp=Object.freeze({__proto__:null,array:Iv,color:function(l,t,s){return new ui(on(l.r,t.r,s),on(l.g,t.g,s),on(l.b,t.b,s),on(l.a,t.a,s))},number:on});class xa extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Gd{constructor(t,s=[]){this.parent=t,this.bindings={};for(let[u,h]of s)this.bindings[u]=h}concat(t){return new Gd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Wa={kind:"null"},Zt={kind:"number"},Bn={kind:"string"},fi={kind:"boolean"},Is={kind:"color"},vl={kind:"object"},ai={kind:"value"},hm={kind:"collator"},mp={kind:"formatted"},gp={kind:"resolvedImage"};function Zo(l,t){return{kind:"array",itemType:l,N:t}}function Ur(l){if(l.kind==="array"){let t=Ur(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}let zT=[Wa,Zt,Bn,fi,Is,mp,vl,Zo(ai),gp];function Wc(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Wc(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(let s of zT)if(!Wc(s,t))return null}}return`Expected ${Ur(l)} but found ${Ur(t)} instead.`}function Mv(l,t){return t.some(s=>s.kind===l.kind)}function _p(l,t){return t.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}function pm(l,t){return l.kind==="array"&&t.kind==="array"?l.N===t.N&&pm(l.itemType,t.itemType):l.kind===t.kind}class Dv{constructor(t,s,u){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fm{constructor(t,s,u,h,m){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=u,this.fontStack=h,this.textColor=m}}class hs{constructor(t){this.sections=t}static fromString(t){return new hs([new fm(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof hs?t:hs.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let s of this.sections){if(s.image){let h=s.image.getPrimary().id.toString();t.push(["image",h]);continue}t.push(s.text);let u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(u)}return t}}class Kl{constructor(t,s={}){this.id=as.from(t),this.params=s.params,this.sx=s.sx||1,this.sy=s.sy||1}toString(){return JSON.stringify(this)}static parse(t){let s,u,h,m;try{({id:s,params:u,sx:h,sy:m}=JSON.parse(t)||{})}catch{return null}return s?new Kl(s,{params:u,sx:h,sy:m}):null}scaleSelf(t,s=t){return this.sx*=t,this.sy*=s,this}}class ps{constructor(t,s,u,h,m=!1){this.primaryId=as.from(t),this.primaryOptions=s,u&&(this.secondaryId=as.from(u)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Kl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Kl(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?ps.build({name:t}):t}static build(t,s,u,h){return!t||typeof t=="object"&&!("name"in t)?null:new ps(t,u,s,h)}}function td(l,t,s,u){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,t,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,t,s,u]:[l,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qd(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof ui||l instanceof Dv||l instanceof hs||l instanceof ps)return!0;if(Array.isArray(l)){for(let t of l)if(!qd(t))return!1;return!0}if(typeof l=="object"){for(let t in l)if(!qd(l[t]))return!1;return!0}return!1}function po(l){if(l===null)return Wa;if(typeof l=="string")return Bn;if(typeof l=="boolean")return fi;if(typeof l=="number")return Zt;if(l instanceof ui)return Is;if(l instanceof Dv)return hm;if(l instanceof hs)return mp;if(l instanceof ps)return gp;if(Array.isArray(l)){let t=l.length,s;for(let u of l){let h=po(u);if(s){if(s===h)continue;s=ai;break}s=h}return Zo(s||ai,t)}return vl}function ba(l){let t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof hs||l instanceof ps||l instanceof ui?l.toString():JSON.stringify(l)}class Ql{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!qd(t[1]))return s.error("invalid value");let u=t[1],h=po(u),m=s.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new Ql(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ui?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof hs?this.value.serialize():this.value}}class oo{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let Av={string:Bn,number:Zt,boolean:fi,object:vl};class Za{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u,h=1,m=t[0];if(m==="array"){let v,b;if(t.length>2){let C=t[1];if(typeof C!="string"||!(C in Av)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Av[C],h++}else v=ai;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}u=Zo(v,b)}else u=Av[m];let g=[];for(;h<t.length;h++){let v=s.parse(t[h],h,ai);if(!v)return null;g.push(v)}return new Za(u,g)}evaluate(t){for(let s=0;s<this.args.length;s++){let u=this.args[s].evaluate(t);if(!Wc(this.type,po(u)))return u;if(s===this.args.length-1)throw new oo(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ur(po(u))} but was expected to be of type ${Ur(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,s=[t.kind];if(t.kind==="array"){let u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);let h=t.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(u=>u.serialize()))}}class yl{constructor(t){this.type=mp,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u=t[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");let h=[],m=!1;for(let g=1;g<=t.length-1;++g){let v=t[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let b=null;if(v["font-scale"]&&(b=s.parseObjectValue(v["font-scale"],g,"font-scale",Zt),!b))return null;let C=null;if(v["text-font"]&&(C=s.parseObjectValue(v["text-font"],g,"text-font",Zo(Bn)),!C))return null;let T=null;if(v["text-color"]&&(T=s.parseObjectValue(v["text-color"],g,"text-color",Is),!T))return null;let I=h[h.length-1];I.scale=b,I.font=C,I.textColor=T}else{let b=s.parse(t[g],g,ai);if(!b)return null;let C=b.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new yl(h)}evaluate(t){return new hs(this.sections.map(s=>{let u=s.content.evaluate(t);return pm(po(u),gp)?new fm("",u,null,null,null):new fm(ba(u),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(let s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let s of this.sections){t.push(s.content.serialize());let u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),t.push(u)}return t}}class yn{constructor(t,s,u,h){this._imageWarnHistory={},this.type=gp,this.namePrimary=t,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(t,s){if(t.length<2)return s.error("Expected two or more arguments.");let u=1,h=[];function m(){if(u<t.length){let v=s.parse(t[u],u++,Bn);return v?(h.push({image:v,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<t.length){let b=t[u];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;let C=b.params,T=b.iconset,I=s.concat(u);if(!C&&!T)return u++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return I.error('Image options "params" should be an object'),!1;let D={},O=I.concat(void 0,"params");for(let R in C){if(!R)return O.error("Image parameter name should be non-empty"),!1;let B=O.concat(void 0,R).parse(C[R],void 0,Is,void 0,{typeAnnotation:"coerce"});if(!B)return!1;D[R]=B}h[h.length-1].options.params=D}if(T){if(typeof T!="object"||T.constructor!==Object)return I.error('Image options "iconset" should be an object'),!1;if(!T.id)return I.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=T}return u++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!g())return;return new yn(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(t,s){let u={};if(s){for(let h in s)if(s[h])try{u[h]=s[h].evaluate(t)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(t){let s={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,h=ps.build(s,u,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(h&&t.availableImages){let m=h.getPrimary().id;if(h.available=t.availableImages.some(g=>as.isEqual(g,m)),h.available){let g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=t.availableImages.some(v=>as.isEqual(v,g)))}}return h}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(let s in this.paramsPrimary)this.paramsPrimary[s]&&t(this.paramsPrimary[s]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(let s in this.paramsSecondary)this.paramsSecondary[s]&&t(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(t,s){let u={};if(s&&(u.iconset={id:s}),t){u.params={};for(let h in t)t[h]&&(u.params[h]=t[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){let t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&t.push(s)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&t.push(s)}return t}}function Gt(l){return ln(l)?"string":Wd(l)?"number":gm(l)?"boolean":Array.isArray(l)?"array":l===null?"null":mm(l)?"object":typeof l}function mm(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function ln(l){return typeof l=="string"||l instanceof String}function Wd(l){return typeof l=="number"||l instanceof Number}function gm(l){return typeof l=="boolean"||l instanceof Boolean}let an={"to-boolean":fi,"to-color":Is,"to-number":Zt,"to-string":Bn};class xl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u=t[0],h=[],m=Wa;if(u==="to-array"){if(!Array.isArray(t[1]))return null;let g=t[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);m=Zo(s.expectedType.itemType,g)}else{if(!(g>0&&qd(t[1][0])))return null;m=Zo(po(t[1][0]),g)}for(let v=0;v<g;v++){let b=t[1][v],C;if(Array.isArray(b))C=s.parse(b,void 0,m.itemType);else{let T=Gt(b);if(T!==m.itemType.kind)return s.error(`Expected ${m.itemType.kind} but found ${T}.`);C=s.registry.literal.parse(["literal",b===void 0?null:b],s)}if(!C)return null;h.push(C)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return s.error("Expected one argument.");m=an[u];for(let g=1;g<t.length;g++){let v=s.parse(t[g],g,ai);if(!v)return null;h.push(v)}}return new xl(m,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,u;for(let h of this.args){if(s=h.evaluate(t),u=null,s instanceof ui)return s;if(typeof s=="string"){let m=t.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:td(s[0],s[1],s[2],s[3]),!u))return new ui(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new oo(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(let u of this.args){if(s=u.evaluate(t),s===null)return 0;let h=Number(s);if(!isNaN(h))return h}throw new oo(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?hs.fromString(ba(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ps.build(ba(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(s=>s.evaluate(t)):ba(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new yl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yn(this.args[0]).serialize();let t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}let Pv=["Unknown","Point","LineString","Polygon"];class _m{constructor(t,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-t[0])+this.featureDistanceData.bearing[1]*(h*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=ui.parse(t)),s}getConfig(t){return this.options?this.options.get(t):null}}class fs{constructor(t,s,u,h,m){this.name=t,this.type=s,this._evaluate=u,this.args=h,this._overloadIndex=m}evaluate(t){if(!this._evaluate){let s=fs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){let u=t[0],h=fs.definitions[u];if(!h)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[],b=null,C=-1;for(let[T,I]of g){if(Array.isArray(T)&&T.length!==t.length-1)continue;v.push(T),C++,b=new Dm(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);let D=[],O=!1;for(let R=1;R<t.length;R++){let B=t[R],H=Array.isArray(T)?T[R-1]:T.type,$=b.parse(B,1+D.length,H);if(!$){O=!0;break}D.push($)}if(!O)if(Array.isArray(T)&&T.length!==D.length)b.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){let B=Array.isArray(T)?T[R]:T.type,H=D[R];b.concat(R+1).checkSubtype(B,H.type)}if(b.errors.length===0)return new fs(u,m,I,D,C)}}if(v.length===1)s.errors.push(...b.errors);else{let T=(v.length?v:g.map(([D])=>D)).map(vm).join(" | "),I=[];for(let D=1;D<t.length;D++){let O=s.parse(t[D],1+I.length);if(!O)return null;I.push(Ur(O.type))}s.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){fs.definitions=s;for(let u in s)t[u]=fs}}function vm(l){return Array.isArray(l)?`(${l.map(Ur).join(", ")})`:`(${Ur(l.type)}...)`}class Co{constructor(t,s,u){this.type=hm,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");let u=t[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");let h=u["case-sensitive"]===void 0?s.parse(!1,1,fi):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",fi);if(!h)return null;let m=u["diacritic-sensitive"]===void 0?s.parse(!1,1,fi):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",fi);if(!m)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",Bn),!g)?null:new Co(h,m,g)}evaluate(t){return new Dv(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function ym(l,t,s=0,u=l.length-1,h=Ov){for(;u>s;){if(u-s>600){let b=u-s+1,C=t-s+1,T=Math.log(b),I=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*I*(b-I)/b)*(C-b/2<0?-1:1);ym(l,t,Math.max(s,Math.floor(t-C*I/b+D)),Math.min(u,Math.floor(t+(b-C)*I/b+D)),h)}let m=l[t],g=s,v=u;for(Ya(l,s,t),h(l[u],m)>0&&Ya(l,s,u);g<v;){for(Ya(l,g,v),g++,v--;h(l[g],m)<0;)g++;for(;h(l[v],m)>0;)v--}h(l[s],m)===0?Ya(l,s,v):(v++,Ya(l,v,u)),v<=t&&(s=v+1),t<=v&&(u=v-1)}}function Ya(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}function Ov(l,t){return l<t?-1:l>t?1:0}function Zc(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}function wa(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function vp(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function BT(l,t,s){let u=l[0]-t[0],h=l[1]-t[1],m=l[0]-s[0],g=l[1]-s[1];return u*g-m*h==0&&u*m<=0&&h*g<=0}function Zd(l,t,s=!1){let u=!1;for(let v=0,b=t.length;v<b;v++){let C=t[v];for(let T=0,I=C.length,D=I-1;T<I;D=T++){let O=C[D],R=C[T];if(BT(l,O,R))return s;(m=O)[1]>(h=l)[1]!=(g=R)[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(u=!u)}}var h,m,g;return u}function yp(l,t,s,u){let h=u[0]-s[0],m=u[1]-s[1],g=(l[0]-s[0])*m-h*(l[1]-s[1]),v=(t[0]-s[0])*m-h*(t[1]-s[1]);return g>0&&v<0||g<0&&v>0}function xp(l,t,s,u){return(h=[u[0]-s[0],u[1]-s[1]])[0]*(m=[t[0]-l[0],t[1]-l[1]])[1]-h[1]*m[0]!=0&&!(!yp(l,t,s,u)||!yp(s,u,l,t));var h,m}function Jl(l){let t=new ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u of l[0])t.x>u.x&&(t.x=u.x),t.y>u.y&&(t.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:t,max:s}}let Yc=8192;function VT(l,t){let s=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*Yc),Math.round(u*h*Yc)]}function Rv(l,t){for(let s=0;s<t.length;s++)if(Zd(l,t[s]))return!0;return!1}function UT(l,t,s){for(let u of s)for(let h=0,m=u.length,g=m-1;h<m;g=h++)if(xp(l,t,u[g],u[h]))return!0;return!1}function Db(l,t){for(let s=0;s<l.length;++s)if(!Zd(l[s],t))return!1;for(let s=0;s<l.length-1;++s)if(UT(l[s],l[s+1],t))return!1;return!0}function Ab(l,t){for(let s=0;s<t.length;s++)if(Db(l,t[s]))return!0;return!1}function kv(l,t,s){let u=[];for(let h=0;h<l.length;h++){let m=[];for(let g=0;g<l[h].length;g++){let v=VT(l[h][g],s);wa(t,v),m.push(v)}u.push(m)}return u}function Xc(l,t,s){let u=[];for(let h=0;h<l.length;h++){let m=kv(l[h],t,s);u.push(m)}return u}function Pb(l,t,s,u){if(l[0]<s[0]||l[0]>s[2]){let h=.5*u,m=l[0]-s[0]>h?-u:s[0]-l[0]>h?u:0;m===0&&(m=l[0]-s[2]>h?-u:s[2]-l[0]>h?u:0),l[0]+=m}wa(t,l)}function Ob(l,t,s,u){let h=Math.pow(2,u.z)*Yc,m=[u.x*Yc,u.y*Yc],g=[];if(!l)return g;for(let v of l)for(let b of v){let C=[b.x+m[0],b.y+m[1]];Pb(C,t,s,h),g.push(C)}return g}function xm(l,t,s,u){let h=Math.pow(2,u.z)*Yc,m=[u.x*Yc,u.y*Yc],g=[];if(!l)return g;for(let b of l){let C=[];for(let T of b){let I=[T.x+m[0],T.y+m[1]];wa(t,I),C.push(I)}g.push(C)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of g)for(let C of b)Pb(C,t,s,h)}var v;return g}class Kc{constructor(t,s){this.type=fi,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qd(t[1])){let u=t[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){let m=u.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Kc(u,u.features[h].geometry)}else if(u.type==="Feature"){let h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Kc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Kc(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(s,u){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=kv(u.coordinates,m,g),b=Ob(s.geometry(),h,m,g);if(!vp(h,m))return!1;for(let C of b)if(!Zd(C,v))return!1}if(u.type==="MultiPolygon"){let v=Xc(u.coordinates,m,g),b=Ob(s.geometry(),h,m,g);if(!vp(h,m))return!1;for(let C of b)if(!Rv(C,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(s,u){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=kv(u.coordinates,m,g),b=xm(s.geometry(),h,m,g);if(!vp(h,m))return!1;for(let C of b)if(!Db(C,v))return!1}if(u.type==="MultiPolygon"){let v=Xc(u.coordinates,m,g),b=xm(s.geometry(),h,m,g);if(!vp(h,m))return!1;for(let C of b)if(!Ab(C,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let bp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ca=1/298.257223563,Rb=Ca*(2-Ca),Yd=Math.PI/180;class Xd{static fromTile(t,s,u){let h=Math.PI*(1-2*(t+.5)/Math.pow(2,s)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Yd;return new Xd(m,u)}static get units(){return bp}constructor(t,s){if(t===void 0)throw new Error("No latitude given.");if(s&&!bp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(bp).join(", ")}`);let u=6378.137*Yd*(s?bp[s]:1),h=Math.cos(t*Yd),m=1/(1-Rb*(1-h*h)),g=Math.sqrt(m);this.kx=u*g*h,this.ky=u*g*m*(1-Rb)}distance(t,s){let u=Qs(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(t,s){let u=Qs(s[0]-t[0])*this.kx;return Math.atan2(u,(s[1]-t[1])*this.ky)/Yd}destination(t,s,u){let h=u*Yd;return this.offset(t,Math.sin(h)*s,Math.cos(h)*s)}offset(t,s,u){return[t[0]+s/this.kx,t[1]+u/this.ky]}lineDistance(t){let s=0;for(let u=0;u<t.length-1;u++)s+=this.distance(t[u],t[u+1]);return s}area(t){let s=0;for(let u=0;u<t.length;u++){let h=t[u];for(let m=0,g=h.length,v=g-1;m<g;v=m++)s+=Qs(h[m][0]-h[v][0])*(h[m][1]+h[v][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(t,s){let u=0;if(s<=0)return t[0];for(let h=0;h<t.length-1;h++){let m=t[h],g=t[h+1],v=this.distance(m,g);if(u+=v,u>s)return bm(m,g,(s-(u-v))/v)}return t[t.length-1]}pointToSegmentDistance(t,s,u){let[h,m]=s,g=Qs(u[0]-h)*this.kx,v=(u[1]-m)*this.ky;if(g!==0||v!==0){let b=(Qs(t[0]-h)*this.kx*g+(t[1]-m)*this.ky*v)/(g*g+v*v);b>1?(h=u[0],m=u[1]):b>0&&(h+=g/this.kx*b,m+=v/this.ky*b)}return g=Qs(t[0]-h)*this.kx,v=(t[1]-m)*this.ky,Math.sqrt(g*g+v*v)}pointOnLine(t,s){let u=1/0,h=t[0][0],m=t[0][1],g=0,v=0;for(let b=0;b<t.length-1;b++){let C=t[b][0],T=t[b][1],I=Qs(t[b+1][0]-C)*this.kx,D=(t[b+1][1]-T)*this.ky,O=0;I===0&&D===0||(O=(Qs(s[0]-C)*this.kx*I+(s[1]-T)*this.ky*D)/(I*I+D*D),O>1?(C=t[b+1][0],T=t[b+1][1]):O>0&&(C+=I/this.kx*O,T+=D/this.ky*O)),I=Qs(s[0]-C)*this.kx,D=(s[1]-T)*this.ky;let R=I*I+D*D;R<u&&(u=R,h=C,m=T,g=b,v=O)}return{point:[h,m],index:g,t:Math.max(0,Math.min(1,v))}}lineSlice(t,s,u){let h=this.pointOnLine(u,t),m=this.pointOnLine(u,s);if(h.index>m.index||h.index===m.index&&h.t>m.t){let C=h;h=m,m=C}let g=[h.point],v=h.index+1,b=m.index;!Fv(u[v],g[0])&&v<=b&&g.push(u[v]);for(let C=v+1;C<=b;C++)g.push(u[C]);return Fv(u[b],m.point)||g.push(m.point),g}lineSliceAlong(t,s,u){let h=0,m=[];for(let g=0;g<u.length-1;g++){let v=u[g],b=u[g+1],C=this.distance(v,b);if(h+=C,h>t&&m.length===0&&m.push(bm(v,b,(t-(h-C))/C)),h>=s)return m.push(bm(v,b,(s-(h-C))/C)),m;h>t&&m.push(b)}return m}bufferPoint(t,s){let u=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-u,t[0]+h,t[1]+u]}bufferBBox(t,s){let u=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-u,t[2]+h,t[3]+u]}insideBBox(t,s){return Qs(t[0]-s[0])>=0&&Qs(t[0]-s[2])<=0&&t[1]>=s[1]&&t[1]<=s[3]}}function Fv(l,t){return l[0]===t[0]&&l[1]===t[1]}function bm(l,t,s){let u=Qs(t[0]-l[0]);return[l[0]+u*s,l[1]+(t[1]-l[1])*s]}function Qs(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class wm{constructor(t=[],s=(u,h)=>u<h?-1:u>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:s,compare:u}=this,h=s[t];for(;t>0;){let m=t-1>>1,g=s[m];if(u(h,g)>=0)break;s[t]=g,t=m}s[t]=h}_down(t){let{data:s,compare:u}=this,h=this.length>>1,m=s[t];for(;t<h;){let g=1+(t<<1),v=g+1;if(v<this.length&&u(s[v],s[g])<0&&(g=v),u(s[g],m)>=0)break;s[t]=s[g],t=g}s[t]=m}}var vt=8192;function Lv(l,t){return t.dist-l.dist}let Cm=100,Em=50;function Nv(l){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==l[s])return!1;return!0}function wp(l){return l[1]-l[0]+1}function bl(l,t){let s=l[1]>=l[0]&&l[1]<t;return s||console.warn("Distance Expression: Index is out of range"),s}function zv(l,t){if(l[0]>l[1])return[null,null];let s=wp(l);if(t){if(s===2)return[l,null];let u=Math.floor(s/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(s===1)return[l,null];let u=Math.floor(s/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function nd(l,t){let s=[1/0,1/0,-1/0,-1/0];if(!bl(t,l.length))return s;for(let u=t[0];u<=t[1];++u)wa(s,l[u]);return s}function id(l){let t=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let u=0;u<l[s].length;++u)wa(t,l[s][u]);return t}function Qc(l,t,s){if(Nv(l)||Nv(t))return NaN;let u=0,h=0;return l[2]<t[0]&&(u=t[0]-l[2]),l[0]>t[2]&&(u=l[0]-t[2]),l[1]>t[3]&&(h=l[1]-t[3]),l[3]<t[1]&&(h=t[1]-l[3]),s.distance([0,0],[u,h])}function Sm(l){return 360*l-180}function kb(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Tm(l,t){let s=Math.pow(2,t.z),u=(l.y/vt+t.y)/s;return[Sm((l.x/vt+t.x)/s),kb(u)]}function jT(l,t){let s=[];for(let u=0;u<l.length;++u)s.push(Tm(l[u],t));return s}function Fb(l,t,s){let u=s.pointOnLine(t,l).point;return s.distance(l,u)}function Bv(l,t,s,u,h){let m=s.slice(u[0],u[1]+1),g=1/0;for(let v=t[0];v<=t[1];++v)if((g=Math.min(g,Fb(l[v],m,h)))===0)return 0;return g}function Jc(l,t,s,u,h){let m=Math.min(h.pointToSegmentDistance(l,s,u),h.pointToSegmentDistance(t,s,u)),g=Math.min(h.pointToSegmentDistance(s,l,t),h.pointToSegmentDistance(u,l,t));return Math.min(m,g)}function jn(l,t,s,u,h){if(!bl(t,l.length)||!bl(u,s.length))return NaN;let m=1/0;for(let g=t[0];g<t[1];++g)for(let v=u[0];v<u[1];++v){if(xp(l[g],l[g+1],s[v],s[v+1]))return 0;m=Math.min(m,Jc(l[g],l[g+1],s[v],s[v+1],h))}return m}function $T(l,t,s,u,h){if(!bl(t,l.length)||!bl(u,s.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let v=u[0];v<=u[1];++v)if((m=Math.min(m,h.distance(l[g],s[v])))===0)return m;return m}function HT(l,t,s){if(Zd(l,t,!0))return 0;let u=1/0;for(let h of t){let m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(u=Math.min(u,s.pointToSegmentDistance(l,h[m-1],h[0])))===0||(u=Math.min(u,Fb(l,h,s)))===0)return u}return u}function GT(l,t,s,u){if(!bl(t,l.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Zd(l[m],s,!0))return 0;let h=1/0;for(let m=t[0];m<t[1];++m)for(let g of s)for(let v=0,b=g.length,C=b-1;v<b;C=v++){if(xp(l[m],l[m+1],g[C],g[v]))return 0;h=Math.min(h,Jc(l[m],l[m+1],g[C],g[v],u))}return h}function Vv(l,t){for(let s of l)for(let u=0;u<=s.length-1;++u)if(Zd(s[u],t,!0))return!0;return!1}function qT(l,t,s,u=1/0){let h=id(l),m=id(t);if(u!==1/0&&Qc(h,m,s)>=u)return u;if(vp(h,m)){if(Vv(l,t))return 0}else if(Vv(t,l))return 0;let g=u;for(let v of l)for(let b=0,C=v.length,T=C-1;b<C;T=b++)for(let I of t)for(let D=0,O=I.length,R=O-1;D<O;R=D++){if(xp(v[T],v[b],I[R],I[D]))return 0;g=Math.min(g,Jc(v[T],v[b],I[R],I[D],s))}return g}function er(l,t,s,u,h,m,g){if(m===null||g===null)return;let v=Qc(nd(u,m),nd(h,g),s);v<t&&l.push({dist:v,range1:m,range2:g})}function WT(l,t,s,u,h=1/0){let m=Math.min(u.distance(l[0],s[0][0]),h);if(m===0)return m;let g=new wm([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Lv),v=t?Em:Cm,b=id(s);for(;g.length;){let C=g.pop();if(C.dist>=m)continue;let T=C.range1;if(wp(T)<=v){if(!bl(T,l.length))return NaN;if(t){let I=GT(l,T,s,u);if((m=Math.min(m,I))===0)return m}else for(let I=T[0];I<=T[1];++I){let D=HT(l[I],s,u);if((m=Math.min(m,D))===0)return m}}else{let I=zv(T,t);if(I[0]!==null){let D=Qc(nd(l,I[0]),b,u);D<m&&g.push({dist:D,range1:I[0],range2:[0,0]})}if(I[1]!==null){let D=Qc(nd(l,I[1]),b,u);D<m&&g.push({dist:D,range1:I[1],range2:[0,0]})}}}return m}function Lb(l,t,s,u,h,m=1/0){let g=Math.min(m,h.distance(l[0],s[0]));if(g===0)return g;let v=new wm([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],Lv),b=t?Em:Cm,C=u?Em:Cm;for(;v.length;){let T=v.pop();if(T.dist>=g)continue;let I=T.range1,D=T.range2;if(wp(I)<=b&&wp(D)<=C){if(!bl(I,l.length)||!bl(D,s.length))return NaN;if(t&&u?g=Math.min(g,jn(l,I,s,D,h)):t||u?t&&!u?g=Math.min(g,Bv(s,D,l,I,h)):!t&&u&&(g=Math.min(g,Bv(l,I,s,D,h))):g=Math.min(g,$T(l,I,s,D,h)),g===0)return g}else{let O=zv(I,t),R=zv(D,u);er(v,g,h,l,s,O[0],R[0]),er(v,g,h,l,s,O[0],R[1]),er(v,g,h,l,s,O[1],R[0]),er(v,g,h,l,s,O[1],R[1])}}return g}function Uv(l,t,s,u,h=1/0){let m=h,g=nd(l,[0,l.length-1]);for(let v of s)if(!(m!==1/0&&Qc(g,nd(v,[0,v.length-1]),u)>=m)&&(m=Math.min(m,Lb(l,t,v,!0,u,m)),m===0))return m;return m}function Im(l,t,s,u,h=1/0){let m=h,g=nd(l,[0,l.length-1]);for(let v of s){if(m!==1/0&&Qc(g,id(v),u)>=m)continue;let b=WT(l,t,v,u,m);if(isNaN(b))return b;if((m=Math.min(m,b))===0)return m}return m}function jv(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class rd{constructor(t,s){this.type=Zt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(qd(t[1])){let u=t[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(jv(u.features[h].geometry.type))return new rd(u,u.features[h].geometry)}else if(u.type==="Feature"){if(jv(u.geometry.type))return new rd(u,u.geometry)}else if(jv(u.type))return new rd(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let s=t.geometry(),u=t.canonicalID();if(s!=null&&u!=null){if(t.geometryType()==="Point")return(function(h,m,g){let v=[];for(let C of h)for(let T of C)v.push(Tm(T,m));let b=new Xd(v[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Lb(v,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?Uv(v,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?Im(v,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null})(s,u,this.geometries);if(t.geometryType()==="LineString")return(function(h,m,g){let v=[];for(let C of h){let T=[];for(let I of C)T.push(Tm(I,m));v.push(T)}let b=new Xd(v[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Uv(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let C=1/0;for(let T=0;T<g.coordinates.length;T++){let I=Uv(g.coordinates[T],!0,v,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}if(g.type==="Polygon"||g.type==="MultiPolygon"){let C=1/0;for(let T=0;T<v.length;T++){let I=Im(v[T],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}return null})(s,u,this.geometries);if(t.geometryType()==="Polygon")return(function(h,m,g){let v=[];for(let C of(function(T,I){let D=T.length;if(D<=1)return[T];let O=[],R,B;for(let H=0;H<D;H++){let $=Zc(T[H]);$!==0&&(T[H].area=Math.abs($),B===void 0&&(B=$<0),B===$<0?(R&&O.push(R),R=[T[H]]):R.push(T[H]))}return R&&O.push(R),O})(h)){let T=[];for(let I=0;I<C.length;++I)T.push(jT(C[I],m));v.push(T)}let b=new Xd(v[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Im(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let C=1/0;for(let T=0;T<g.coordinates.length;T++){let I=Im(g.coordinates[T],!0,v,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(C,T,I){let D=1/0;for(let O of C)for(let R of T){let B=qT(O,R,I,D);if(isNaN(B))return B;if((D=Math.min(D,B))===0)return D}return D})(g.type==="Polygon"?[g.coordinates]:g.coordinates,v,b):null})(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Kd(l){if(l instanceof fs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Kc||l instanceof rd)return!1;if(l instanceof Jd)return l.featureConstant;let t=!0;return l.eachChild(s=>{t&&!Kd(s)&&(t=!1)}),t}function Cp(l){if(l instanceof fs&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(s=>{t&&!Cp(s)&&(t=!1)}),t}function Qd(l,t){if(l instanceof fs&&t.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(u=>{s&&!Qd(u,t)&&(s=!1)}),s}function Nb(l,t,s){return[l,t,s].filter(Boolean).join("")}function $v(l,t){switch(l){case"string":return ba(t);case"number":return+t;case"boolean":return!!t;case"color":return ui.parse(t);case"formatted":return hs.fromString(ba(t));case"resolvedImage":return ps.build(ba(t))}return t}function zb(l,t,s,u){return u!==void 0&&(l=u*Math.round(l/u)),t!==void 0&&l<t&&(l=t),s!==void 0&&l>s&&(l=s),l}class Jd{constructor(t,s,u,h=!1){this.type=t,this.key=s,this.scope=u,this.featureConstant=h}static parse(t,s){let u=s.expectedType;if(u==null&&(u=ai),t.length<2||t.length>3)return s.error("Invalid number of arguments for 'config' expression.");let h=s.parse(t[1],1);if(!(h instanceof Ql))return s.error("Key name of 'config' expression must be a string literal.");let m,g=!0,v=ba(h.value);if(t.length>=3){let b=s.parse(t[2],2);if(!(b instanceof Ql))return s.error("Scope of 'config' expression must be a string literal.");m=ba(b.value)}if(s.options){let b=Nb(v,m,s._scope),C=s.options.get(b);C&&(g=Kd(C.value||C.default))}return new Jd(u,v,m,g)}evaluate(t){let s=Nb(this.key,this.scope,t.scope),u=t.getConfig(s);if(!u)return null;let{type:h,value:m,values:g,minValue:v,maxValue:b,stepValue:C}=u,T=u.default.evaluate(t),I=T;if(m){let D=t.scope;t.scope=(D||"").split("").slice(1).join(""),I=m.evaluate(t),t.scope=D}return h&&(I=$v(h,I)),I===void 0||v===void 0&&b===void 0&&C===void 0||(typeof I=="number"?I=zb(I,v,b,C):Array.isArray(I)&&(I=I.map(D=>typeof D=="number"?zb(D,v,b,C):D))),m!==void 0&&I!==void 0&&g&&!g.includes(I)&&(I=T,h&&(I=$v(h,I))),(h&&h!==this.type||I!==void 0&&!pm(po(I),this.type))&&(I=$v(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class Mm{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");let u=t[1];return s.scope.has(u)?new Mm(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Dm{constructor(t,s=[],u,h=new Gd,m=[],g,v,b){this.registry=t,this.path=s,this.key=s.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=h,this.errors=m,this.expectedType=u,this._scope=g,this.options=v,this.iconImageUseTheme=b}parse(t,s,u,h,m={}){return s||u?this.concat(s,null,u,h)._parse(t,m):this._parse(t,m)}parseObjectValue(t,s,u,h,m,g={}){return this.concat(s,u,h,m)._parse(t,g)}_parse(t,s){function u(h,m,g){return g==="assert"?new Za(m,[h]):g==="coerce"?new xl(m,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let m=h.parse(t,this);if(!m)return null;if(this.expectedType){let g=this.expectedType,v=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else m=u(m,g,s.typeAnnotation||"coerce");else m=u(m,g,s.typeAnnotation||"assert")}if(!(m instanceof Ql)&&m.type.kind!=="resolvedImage"&&Hv(m)){let g=new _m(this._scope,this.options,this.iconImageUseTheme);try{m=new Ql(m.type,m.evaluate(g))}catch(v){return this.error(v.message),null}}return m}return xl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,u,h){let m=typeof t=="number"?this.path.concat(t):this.path;m=typeof s=="string"?m.concat(s):m;let g=h?this.scope.concat(h):this.scope;return new Dm(this.registry,m,u||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...s){let u=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new xa(u,t))}checkSubtype(t,s){let u=Wc(t,s);return u&&this.error(u),u}}function Hv(l){if(l instanceof Mm)return Hv(l.boundExpression);if(l instanceof fs&&l.name==="error"||l instanceof Co||l instanceof Kc||l instanceof rd||l instanceof Jd)return!1;let t=l instanceof xl||l instanceof Za,s=!0;return l.eachChild(u=>{s=t?s&&Hv(u):s&&u instanceof Ql}),!!s&&Kd(l)&&Qd(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Am(l,t){let s=l.length-1,u,h,m=0,g=s,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),u=l[v],h=l[v+1],u<=t){if(v===s||t<h)return v;m=v+1}else{if(!(u>t))throw new oo("Input is not a number.");g=v-1}return 0}class Ep{constructor(t,s,u){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(let[h,m]of u)this.labels.push(h),this.outputs.push(m)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");let u=s.parse(t[1],1,Zt);if(!u)return null;let h=[],m=null;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(let g=1;g<t.length;g+=2){let v=g===1?-1/0:t[g],b=t[g+1],C=g,T=g+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);let I=s.parse(b,T,m);if(!I)return null;m=m||I.type,h.push([v,I])}return new Ep(m,u,h)}evaluate(t){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);let h=this.input.evaluate(t);if(h<=s[0])return u[0].evaluate(t);let m=s.length;return h>=s[m-1]?u[m-1].evaluate(t):u[Am(s,h)].evaluate(t)}eachChild(t){t(this.input);for(let s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}let Bb=.95047,Vb=1.08883,Ub=4/29,eh=6/29,jb=3*eh*eh,ZT=eh*eh*eh,YT=Math.PI/180,XT=180/Math.PI;function Gv(l){return l>ZT?Math.pow(l,1/3):l/jb+Ub}function qv(l){return l>eh?l*l*l:jb*(l-Ub)}function Wv(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Zv(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function $b(l){let t=Zv(l.r),s=Zv(l.g),u=Zv(l.b),h=Gv((.4124564*t+.3575761*s+.1804375*u)/Bb),m=Gv((.2126729*t+.7151522*s+.072175*u)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Gv((.0193339*t+.119192*s+.9503041*u)/Vb)),alpha:l.a}}function Pm(l){let t=(l.l+16)/116,s=isNaN(l.a)?t:t+l.a/500,u=isNaN(l.b)?t:t-l.b/200;return t=1*qv(t),s=Bb*qv(s),u=Vb*qv(u),new ui(Wv(3.2404542*s-1.5371385*t-.4985314*u),Wv(-.969266*s+1.8760108*t+.041556*u),Wv(.0556434*s-.2040259*t+1.0572252*u),l.alpha)}function Om(l,t,s){let u=t-l;return l+s*(u>180||u<-180?u-360*Math.round(u/360):u)}let th={forward:$b,reverse:Pm,interpolate:function(l,t,s){return{l:on(l.l,t.l,s),a:on(l.a,t.a,s),b:on(l.b,t.b,s),alpha:on(l.alpha,t.alpha,s)}}},Sp={forward:function(l){let{l:t,a:s,b:u}=$b(l),h=Math.atan2(u,s)*XT;return{h:h<0?h+360:h,c:Math.sqrt(s*s+u*u),l:t,alpha:l.a}},reverse:function(l){let t=l.h*YT,s=l.c;return Pm({l:l.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:l.alpha})},interpolate:function(l,t,s){return{h:Om(l.h,t.h,s),c:on(l.c,t.c,s),l:on(l.l,t.l,s),alpha:on(l.alpha,t.alpha,s)}}};var Hb=Object.freeze({__proto__:null,hcl:Sp,lab:th});class Js{constructor(t,s,u,h,m){this.type=t,this.operator=s,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(let[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,s,u,h){let m=0;if(t.name==="exponential")m=Rm(s,t.base,u,h);else if(t.name==="linear")m=Rm(s,1,u,h);else if(t.name==="cubic-bezier"){let g=t.controlPoints;m=new nm(g[0],g[1],g[2],g[3]).solve(Rm(s,1,u,h))}return m}static parse(t,s){let[u,h,m,...g]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let C=h[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let C=h.slice(1);if(C.length!==4||C.some(T=>typeof T!="number"||T<0||T>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,Zt),!m)return null;let v=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=Is:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let C=0;C<g.length;C+=2){let T=g[C],I=g[C+1],D=C+3,O=C+4;if(typeof T!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=T)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let R=s.parse(I,O,b);if(!R)return null;b=b||R.type,v.push([T,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Js(b,u,h,m,v):s.error(`Type ${Ur(b)} is not interpolatable.`)}evaluate(t){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);let h=this.input.evaluate(t);if(h<=s[0])return u[0].evaluate(t);let m=s.length;if(h>=s[m-1])return u[m-1].evaluate(t);let g=Am(s,h),v=Js.interpolationFactor(this.interpolation,h,s[g],s[g+1]),b=u[g].evaluate(t),C=u[g+1].evaluate(t);return this.operator==="interpolate"?fp[this.type.kind.toLowerCase()](b,C,v):this.operator==="interpolate-hcl"?Sp.reverse(Sp.interpolate(Sp.forward(b),Sp.forward(C),v)):th.reverse(th.interpolate(th.forward(b),th.forward(C),v))}eachChild(t){t(this.input);for(let s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let s=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Rm(l,t,s,u){let h=u-s,m=l-s;return h===0?0:t===1?m/h:(Math.pow(t,m)-1)/(Math.pow(t,h)-1)}class Tp{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let u=null,h=s.expectedType;h&&h.kind!=="value"&&(u=h);let m=[];for(let v of t.slice(1)){let b=s.parse(v,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,m.push(b)}let g=h&&m.some(v=>Wc(h,v.type));return new Tp(g?ai:u,m)}evaluate(t){let s,u=null,h=0;for(let m of this.args){if(h++,u=m.evaluate(t),u&&u instanceof ps&&!u.available&&(s||(s=u),u=null,h===this.args.length))return s;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class ec{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let u=[];for(let m=1;m<t.length-1;m+=2){let g=t[m];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);let v=s.parse(t[m+1],m+1);if(!v)return null;u.push([g,v])}let h=s.parse(t[t.length-1],t.length-1,s.expectedType,u);return h?new ec(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[s,u]of this.bindings)t.push(s,u.serialize());return t.push(this.result.serialize()),t}}class km{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Zt),h=s.parse(t[2],2,Zo(s.expectedType||ai));return u&&h?new km(h.type.itemType,u,h):null}evaluate(t){let s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new oo("Array index out of bounds: negative index");if(s>=u.length)throw new oo("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new oo("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fm{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Zt),h=s.parse(t[2],2,Zo(s.expectedType||ai));return u&&h?new Fm(h.type.itemType,u,h):null}evaluate(t){let s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new oo(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new oo(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];let h=Math.floor(s),m=Math.ceil(s),g=u[h],v=u[m];if(typeof g!="number"||typeof v!="number")throw new oo(`Cannot interpolate between non-number values at index ${s}.`);let b=s-h;return g*(1-b)+v*b}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Yv{constructor(t,s){this.type=fi,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,ai);return u&&h?Mv(u.type,[fi,Bn,Zt,Wa,ai])?new Yv(u,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(u.type)} instead`):null}evaluate(t){let s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!_p(s,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(po(s))} instead.`);if(!_p(u,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${Ur(po(u))} instead.`);return u.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class nh{constructor(t,s,u){this.type=Zt,this.needle=t,this.haystack=s,this.fromIndex=u}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,ai);if(!u||!h)return null;if(!Mv(u.type,[fi,Bn,Zt,Wa,ai]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(u.type)} instead`);if(t.length===4){let m=s.parse(t[3],3,Zt);return m?new nh(u,h,m):null}return new nh(u,h)}evaluate(t){let s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!_p(s,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(po(s))} instead.`);if(!_p(u,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${Ur(po(u))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(t);return u.indexOf(s,h)}return u.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ip{constructor(t,s,u,h,m,g){this.inputType=t,this.type=s,this.input=u,this.cases=h,this.outputs=m,this.otherwise=g}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let u,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);let m={},g=[];for(let C=2;C<t.length-1;C+=2){let T=t[C],I=t[C+1];Array.isArray(T)||(T=[T]);let D=s.concat(C);if(T.length===0)return D.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,po(R)))return null}else u=po(R);if(m[String(R)]!==void 0)return D.error("Branch labels must be unique.");m[String(R)]=g.length}let O=s.parse(I,C,h);if(!O)return null;h=h||O.type,g.push(O)}let v=s.parse(t[1],1,ai);if(!v)return null;let b=s.parse(t[t.length-1],t.length-1,h);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(u,v.type)?null:new Ip(u,h,v,m,g,b):null}evaluate(t){let s=this.input.evaluate(t);return(pm(po(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],h={};for(let g of s){let v=h[this.cases[g]];v===void 0?(h[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[v][1].push(g)}let m=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,v]of u)t.push(v.length===1?m(v[0]):v.map(m)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Mp{constructor(t,s,u){this.type=t,this.branches=s,this.otherwise=u}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);let h=[];for(let g=1;g<t.length-1;g+=2){let v=s.parse(t[g],g,fi);if(!v)return null;let b=s.parse(t[g+1],g+1,u);if(!b)return null;h.push([v,b]),u=u||b.type}let m=s.parse(t[t.length-1],t.length-1,u);return m?new Mp(u,h,m):null}evaluate(t){for(let[s,u]of this.branches)if(s.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[s,u]of this.branches)t(s),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class Lm{constructor(t,s,u,h){this.type=t,this.input=s,this.beginIndex=u,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,Zt);if(!u||!h)return null;if(!Mv(u.type,[Zo(ai),Bn,ai]))return s.error(`Expected first argument to be of type array or string, but found ${Ur(u.type)} instead`);if(t.length===4){let m=s.parse(t[3],3,Zt);return m?new Lm(u.type,u,h,m):null}return new Lm(u.type,u,h)}evaluate(t){let s=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!_p(s,["string","array"]))throw new oo(`Expected first argument to be of type array or string, but found ${Ur(po(s))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(t);return s.slice(u,h)}return s.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Xv{constructor(t,s){this.type=Zo(Bn),this.str=t,this.delimiter=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Bn),h=s.parse(t[2],2,Bn);return u&&h?new Xv(u,h):void 0}evaluate(t){let s=this.str.evaluate(t),u=this.delimiter.evaluate(t);return s.split(u)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Kv(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Qv(l,t,s,u){return u.compare(t,s)===0}function ih(l,t,s){let u=l!=="=="&&l!=="!=";return class M5{constructor(m,g,v){this.type=fi,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");let v=m[0],b=g.parse(m[1],1,ai);if(!b)return null;if(!Kv(v,b.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Ur(b.type)}'.`);let C=g.parse(m[2],2,ai);if(!C)return null;if(!Kv(v,C.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Ur(C.type)}'.`);if(b.type.kind!==C.type.kind&&b.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${Ur(b.type)}' and '${Ur(C.type)}'.`);u&&(b.type.kind==="value"&&C.type.kind!=="value"?b=new Za(C.type,[b]):b.type.kind!=="value"&&C.type.kind==="value"&&(C=new Za(b.type,[C])));let T=null;if(m.length===4){if(b.type.kind!=="string"&&C.type.kind!=="string"&&b.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(T=g.parse(m[3],3,hm),!T)return null}return new M5(b,C,T)}evaluate(m){let g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){let b=po(g),C=po(v);if(b.kind!==C.kind||b.kind!=="string"&&b.kind!=="number")throw new oo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${b.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=po(g),C=po(v);if(b.kind!=="string"||C.kind!=="string")return t(m,g,v)}return this.collator?s(m,g,v,this.collator.evaluate(m)):t(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[l];return this.eachChild(g=>{m.push(g.serialize())}),m}}}let KT=ih("==",function(l,t,s){return t===s},Qv),QT=ih("!=",function(l,t,s){return t!==s},function(l,t,s,u){return!Qv(0,t,s,u)}),Gb=ih("<",function(l,t,s){return t<s},function(l,t,s,u){return u.compare(t,s)<0}),qb=ih(">",function(l,t,s){return t>s},function(l,t,s,u){return u.compare(t,s)>0}),Nm=ih("<=",function(l,t,s){return t<=s},function(l,t,s,u){return u.compare(t,s)<=0}),JT=ih(">=",function(l,t,s){return t>=s},function(l,t,s,u){return u.compare(t,s)>=0});class zm{constructor(t,s,u,h,m,g){this.type=Bn,this.number=t,this.locale=s,this.currency=u,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");let u=s.parse(t[1],1,Zt);if(!u)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=s.parseObjectValue(h.locale,2,"locale",Bn),!m))return null;let g=null;if(h.currency&&(g=s.parseObjectValue(h.currency,2,"currency",Bn),!g))return null;let v=null;if(h.unit&&(v=s.parseObjectValue(h.unit,2,"unit",Bn),!v))return null;let b=null;if(h["min-fraction-digits"]&&(b=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Zt),!b))return null;let C=null;return h["max-fraction-digits"]&&(C=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Zt),!C)?null:new zm(u,m,g,v,b,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Jv{constructor(t){this.type=Zt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);let u=s.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ur(u.type)} instead.`):new Jv(u):null}evaluate(t){let s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new oo(`Expected value to be of type string or array, but found ${Ur(po(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}function Wb(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let rh={"==":KT,"!=":QT,">":qb,"<":Gb,">=":JT,"<=":Nm,array:Za,at:km,"at-interpolated":Fm,boolean:Za,case:Mp,coalesce:Tp,collator:Co,format:yl,image:yn,in:Yv,"index-of":nh,interpolate:Js,"interpolate-hcl":Js,"interpolate-lab":Js,length:Jv,let:ec,literal:Ql,match:Ip,number:Za,"number-format":zm,object:Za,slice:Lm,step:Ep,string:Za,"to-boolean":xl,"to-color":xl,"to-number":xl,"to-string":xl,var:Mm,within:Kc,distance:rd,config:Jd,split:Xv};function e0(l,[t,s,u,h]){t=t.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);let m=h?h.evaluate(l):1,g=td(t,s,u,m);if(g)throw new oo(g);return new ui(t/255,s/255,u/255,m)}function t0(l,[t,s,u,h]){t=t.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);let m=h?h.evaluate(l):1,g=(function(C,T,I,D){return typeof C=="number"&&C>=0&&C<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[C,T,I,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[C,T,I,D]:[C,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[C,T,I,D]:[C,T,I]).join(", ")}]: 'h' must be between 0 and 360.`})(t,s,u,m);if(g)throw new oo(g);let v=`hsla(${t}, ${s}%, ${u}%, ${m})`,b=ui.parse(v);if(!b)throw new oo(`Failed to parse HSLA color: ${v}`);return b}function Zb(l,t){return l in t}function n0(l,t){let s=t[l];return s===void 0?null:s}function eu(l){return{type:l}}function od(l){if(l instanceof Jd)return new Set([l.key]);let t=new Set;return l.eachChild(s=>{t=new Set([...t,...od(s)])}),t}function Bm(l){if(l instanceof fs&&l.name==="is-active-floor")return!0;let t=!1;return l.eachChild(s=>{!t&&Bm(s)&&(t=!0)}),t}function Yb(l){return{result:"success",value:l}}function tu(l){return{result:"error",value:l}}function i0(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function Dp(l){return l["property-type"]==="data-driven"}function Xb(l){return i0(l.expression,"measure-light")}function Kb(l){return i0(l.expression,"zoom")}function Vm(l){return!!l.expression&&l.expression.interpolated}function Um(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Qb(l){return l}function Jb(l,t){let s=t.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",h=u||!(u||l.property!==void 0),m=l.type||(Vm(t)?"exponential":"interval");if(s&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(C=>[C[0],ui.parse(C[1])])),l.default=ui.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Hb[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let g,v,b;if(m==="exponential")g=e1;else if(m==="interval")g=tI;else if(m==="categorical"){g=eI,v=Object.create(null);for(let C of l.stops)v[C[0]]=C[1];b=typeof l.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=t1}if(u){let C={},T=[];for(let O=0;O<l.stops.length;O++){let R=l.stops[O],B=R[0].zoom;C[B]===void 0&&(C[B]={zoom:B,type:l.type,property:l.property,default:l.default,stops:[]},T.push(B)),C[B].stops.push([R[0].value,R[1]])}let I=[];for(let O of T)I.push([C[O].zoom,Jb(C[O],t)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Js.interpolationFactor.bind(void 0,D),zoomStops:I.map(O=>O[0]),evaluate:({zoom:O},R)=>e1({stops:I,base:l.base},t,O).evaluate(O,R)}}if(h){let C=m==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Js.interpolationFactor.bind(void 0,C),zoomStops:l.stops.map(T=>T[0]),evaluate:({zoom:T})=>g(l,t,T,v,b)}}return{kind:"source",evaluate(C,T){let I=T&&T.properties?T.properties[l.property]:void 0;return I===void 0?wl(l.default,t.default):g(l,t,I,v,b)}}}function wl(l,t,s){return l!==void 0?l:t!==void 0?t:s!==void 0?s:void 0}function eI(l,t,s,u,h){return wl(typeof s===h?u[s]:void 0,l.default,t.default)}function tI(l,t,s){if(!Wd(s))return wl(l.default,t.default);let u=l.stops.length;if(u===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[u-1][0])return l.stops[u-1][1];let h=Am(l.stops.map(m=>m[0]),s);return l.stops[h][1]}function e1(l,t,s){let u=l.base!==void 0?l.base:1;if(!Wd(s))return wl(l.default,t.default);let h=l.stops.length;if(h===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[h-1][0])return l.stops[h-1][1];let m=Am(l.stops.map(T=>T[0]),s),g=(function(T,I,D,O){let R=O-D,B=T-D;return R===0?0:I===1?B/R:(Math.pow(I,B)-1)/(Math.pow(I,R)-1)})(s,u,l.stops[m][0],l.stops[m+1][0]),v=l.stops[m][1],b=l.stops[m+1][1],C=fp[t.type]||Qb;if(l.colorSpace&&l.colorSpace!=="rgb"){let T=Hb[l.colorSpace];C=(I,D)=>T.reverse(T.interpolate(T.forward(I),T.forward(D),g))}return typeof v.evaluate=="function"?{evaluate(...T){let I=v.evaluate.apply(void 0,T),D=b.evaluate.apply(void 0,T);if(I!==void 0&&D!==void 0)return C(I,D,g)}}:C(v,b,g)}function t1(l,t,s){return t.type==="color"?s=ui.parse(s):t.type==="formatted"?s=hs.fromString(s.toString()):t.type==="resolvedImage"?s=ps.build(s.toString()):Gt(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),wl(s,l.default,t.default)}fs.register(rh,{error:[{kind:"error"},[Bn],(l,[t])=>{throw new oo(t.evaluate(l))}],typeof:[Bn,[ai],(l,[t])=>Ur(po(t.evaluate(l)))],"to-rgba":[Zo(Zt,4),[Is],(l,[t])=>t.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Zo(Zt,4),[Is],(l,[t])=>t.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Is,[Zt,Zt,Zt],e0],rgba:[Is,[Zt,Zt,Zt,Zt],e0],hsl:[Is,[Zt,Zt,Zt],t0],hsla:[Is,[Zt,Zt,Zt,Zt],t0],has:{type:fi,overloads:[[[Bn],(l,[t])=>Zb(t.evaluate(l),l.properties())],[[Bn,vl],(l,[t,s])=>Zb(t.evaluate(l),s.evaluate(l))]]},get:{type:ai,overloads:[[[Bn],(l,[t])=>n0(t.evaluate(l),l.properties())],[[Bn,vl],(l,[t,s])=>n0(t.evaluate(l),s.evaluate(l))]]},"feature-state":[ai,[Bn],(l,[t])=>n0(t.evaluate(l),l.featureState||{})],properties:[vl,[],l=>l.properties()],"geometry-type":[Bn,[],l=>l.geometryType()],worldview:[Bn,[],l=>l.globals.worldview||""],"is-active-floor":[fi,eu(Bn),(l,t)=>{if(!(l.globals.activeFloors&&l.globals.activeFloors.size>0))return!1;let s=l.globals.activeFloors;return t.some(u=>{let h=u.evaluate(l);return s.has(h)})}],id:[ai,[],l=>l.id()],zoom:[Zt,[],l=>l.globals.zoom],pitch:[Zt,[],l=>l.globals.pitch||0],"distance-from-center":[Zt,[],l=>l.distanceFromCenter()],"measure-light":[Zt,[Bn],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[Zt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Zt,[],l=>l.globals.lineProgress||0],"raster-value":[Zt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Zt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Zt,[],l=>l.globals.skyRadialProgress||0],accumulated:[ai,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Zt,eu(Zt),(l,t)=>{let s=0;for(let u of t)s+=u.evaluate(l);return s}],"*":[Zt,eu(Zt),(l,t)=>{let s=1;for(let u of t)s*=u.evaluate(l);return s}],"-":{type:Zt,overloads:[[[Zt,Zt],(l,[t,s])=>t.evaluate(l)-s.evaluate(l)],[[Zt],(l,[t])=>-t.evaluate(l)]]},"/":[Zt,[Zt,Zt],(l,[t,s])=>t.evaluate(l)/s.evaluate(l)],"%":[Zt,[Zt,Zt],(l,[t,s])=>t.evaluate(l)%s.evaluate(l)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(l,[t,s])=>Math.pow(t.evaluate(l),s.evaluate(l))],sqrt:[Zt,[Zt],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[Zt,[Zt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[Zt,[Zt],(l,[t])=>Math.log(t.evaluate(l))],log2:[Zt,[Zt],(l,[t])=>Math.log2(t.evaluate(l))],sin:[Zt,[Zt],(l,[t])=>Math.sin(t.evaluate(l))],cos:[Zt,[Zt],(l,[t])=>Math.cos(t.evaluate(l))],tan:[Zt,[Zt],(l,[t])=>Math.tan(t.evaluate(l))],asin:[Zt,[Zt],(l,[t])=>Math.asin(t.evaluate(l))],acos:[Zt,[Zt],(l,[t])=>Math.acos(t.evaluate(l))],atan:[Zt,[Zt],(l,[t])=>Math.atan(t.evaluate(l))],min:[Zt,eu(Zt),(l,t)=>Math.min(...t.map(s=>s.evaluate(l)))],max:[Zt,eu(Zt),(l,t)=>Math.max(...t.map(s=>s.evaluate(l)))],abs:[Zt,[Zt],(l,[t])=>Math.abs(t.evaluate(l))],round:[Zt,[Zt],(l,[t])=>{let s=t.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[Zt,[Zt],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[Zt,[Zt],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[fi,[Bn,ai],(l,[t,s])=>l.properties()[t.value]===s.value],"filter-id-==":[fi,[ai],(l,[t])=>l.id()===t.value],"filter-type-==":[fi,[Bn],(l,[t])=>l.geometryType()===t.value],"filter-<":[fi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u<h}],"filter-id-<":[fi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s<u}],"filter->":[fi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u>h}],"filter-id->":[fi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s>u}],"filter-<=":[fi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[fi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s<=u}],"filter->=":[fi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[fi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s>=u}],"filter-has":[fi,[ai],(l,[t])=>t.value in l.properties()],"filter-has-id":[fi,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[fi,[Zo(Bn)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[fi,[Zo(ai)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[fi,[Bn,Zo(ai)],(l,[t,s])=>s.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[fi,[Bn,Zo(ai)],(l,[t,s])=>(function(u,h,m,g){for(;m<=g;){let v=m+g>>1;if(h[v]===u)return!0;h[v]>u?g=v-1:m=v+1}return!1})(l.properties()[t.value],s.value,0,s.value.length-1)],all:{type:fi,overloads:[[[fi,fi],(l,[t,s])=>t.evaluate(l)&&s.evaluate(l)],[eu(fi),(l,t)=>{for(let s of t)if(!s.evaluate(l))return!1;return!0}]]},any:{type:fi,overloads:[[[fi,fi],(l,[t,s])=>t.evaluate(l)||s.evaluate(l)],[eu(fi),(l,t)=>{for(let s of t)if(s.evaluate(l))return!0;return!1}]]},"!":[fi,[fi],(l,[t])=>!t.evaluate(l)],"is-supported-script":[fi,[Bn],(l,[t])=>{let s=l.globals&&l.globals.isSupportedScript;return!s||s(t.evaluate(l))}],upcase:[Bn,[Bn],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[Bn,[Bn],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[Bn,eu(ai),(l,t)=>t.map(s=>ba(s.evaluate(l))).join("")],"resolved-locale":[Bn,[hm],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[Zt,[Zt,Zt,ai],(l,t)=>{let[s,u,h]=t.map(g=>g.evaluate(l));if(s>u||s===u)return s;let m;if(typeof h=="string")m=(function(g){let v=0;if(g.length===0)return v;for(let b=0;b<g.length;b++)v=(v<<5)-v+g.charCodeAt(b),v|=0;return v})(h);else{if(typeof h!="number")throw new oo(`Invalid seed input: ${h}`);m=h}return s+Wb(m)()*(u-s)}]});class jm{constructor(t,s,u,h,m){this.expression=t,this._warningHistory={},this._scope=u,this._options=h,this._iconImageUseTheme=m,this._evaluator=new _m(u,h,m),this._defaultValue=s?(function(g){return g.type==="color"&&(Um(g.default)||Array.isArray(g.default))?new ui(0,0,0,0):g.type==="color"?ui.parse(g.default)||null:g.default===void 0?null:g.default})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=od(t),this.isIndoorDependent=Bm(t)}evaluateWithoutErrorHandling(t,s,u,h,m,g,v,b){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,u,h,m,g,v,b,C){this._evaluator||(this._evaluator=new _m(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=C||null;try{let T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new oo(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){let I=T;return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Ap(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in rh}function nu(l,t,s,u,h){let m=new Dm(rh,[],t?(function(v){let b={color:Is,string:Bn,number:Zt,enum:Bn,boolean:fi,formatted:mp,resolvedImage:gp};return v.type==="array"?Zo(b[v.value]||ai,v.length):b[v.type]})(t):void 0,void 0,void 0,s,u,h),g=m.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Yb(new jm(g,t,s,u,h)):tu(m.errors)}class oh{constructor(t,s,u,h){this.kind=t,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=t!=="constant"&&!Cp(s.expression),this.configDependencies=od(s.expression),this.isIndoorDependent=Bm(s.expression)}evaluateWithoutErrorHandling(t,s,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,h,m,g)}evaluate(t,s,u,h,m,g,v){return this._styleExpression.evaluate(t,s,u,h,m,g,void 0,void 0,v)}}class sd{constructor(t,s,u,h,m,g){this.kind=t,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Cp(s.expression),this.isIndoorDependent=Bm(s.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=od(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,h,m,g)}evaluate(t,s,u,h,m,g){return this._styleExpression.evaluate(t,s,u,h,m,g)}interpolationFactor(t,s,u){return this.interpolationType?Js.interpolationFactor(this.interpolationType,t,s,u):0}}function r0(l,t,s,u,h){if((l=nu(l,t,s,u,h)).result==="error")return l;let m=l.value.expression,g=Kd(m);if(!g&&!Dp(t))return tu([new xa("","data expressions not supported")]);let v=Qd(m,["zoom","pitch","distance-from-center"]);if(!v&&!Kb(t))return tu([new xa("","zoom expressions not supported")]);let b=Qd(m,["measure-light"]);if(!b&&!Xb(t))return tu([new xa("","measure-light expression not supported")]);let C=Qd(m,["line-progress"]);if(!C&&!(function(D){return i0(D.expression,"line-progress")})(t))return tu([new xa("","line-progress expression not supported")]);let T=t.expression&&t.expression.relaxZoomRestriction,I=Pp(m);return I||v||T?I instanceof xa?tu([I]):I instanceof Js&&!Vm(t)?tu([new xa("",'"interpolate" expressions cannot be used with this property')]):Yb(I?new sd(g&&C?"camera":"composite",l.value,I.labels,I instanceof Js?I.interpolation:void 0,b,C):new oh(g&&C?"constant":"source",l.value,b,C)):tu([new xa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class $m{constructor(t,s){this._parameters=t,this._specification=s,Object.assign(this,Jb(this._parameters,this._specification))}static deserialize(t){return new $m(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Pp(l){let t=null;if(l instanceof ec)t=Pp(l.result);else if(l instanceof Tp){for(let s of l.args)if(t=Pp(s),t)break}else(l instanceof Ep||l instanceof Js)&&l.input instanceof fs&&l.input.name==="zoom"&&(t=l);return t instanceof xa||l.eachChild(s=>{let u=Pp(s);u instanceof xa?t=u:t&&u&&t!==u&&(t=new xa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var o0,n1,i1=(function(){if(n1)return o0;n1=1,o0=t;var l=3;function t(s,u,h){var m=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(h=g[2]);for(var v=0;v<this.d*this.d;v++){var b=g[l+v],C=g[l+v+1];m.push(b===C?null:g.subarray(b,C))}var T=g[l+m.length+1];this.keys=g.subarray(g[l+m.length],T),this.bboxes=g.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var I=0;I<this.d*this.d;I++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=h,this.scale=u/s,this.uid=0;var D=h/u*s;this.min=-D,this.max=s+D}return t.prototype.insert=function(s,u,h,m,g){this._forEachCell(u,h,m,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(s,u,h,m,g,v){this.cells[g].push(v)},t.prototype.query=function(s,u,h,m,g){var v=this.min,b=this.max;if(s<=v&&u<=v&&b<=h&&b<=m&&!g)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(s,u,h,m,this._queryCell,C,{},g),C},t.prototype._queryCell=function(s,u,h,m,g,v,b,C){var T=this.cells[g];if(T!==null)for(var I=this.keys,D=this.bboxes,O=0;O<T.length;O++){var R=T[O];if(b[R]===void 0){var B=4*R;(C?C(D[B+0],D[B+1],D[B+2],D[B+3]):s<=D[B+2]&&u<=D[B+3]&&h>=D[B+0]&&m>=D[B+1])?(b[R]=!0,v.push(I[R])):b[R]=!1}}},t.prototype._forEachCell=function(s,u,h,m,g,v,b,C){for(var T=this._convertToCellCoord(s),I=this._convertToCellCoord(u),D=this._convertToCellCoord(h),O=this._convertToCellCoord(m),R=T;R<=D;R++)for(var B=I;B<=O;B++){var H=this.d*B+R;if((!C||C(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,s,u,h,m,H,v,b,C))return}},t.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},t.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=l+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var g=new Int32Array(u+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=u,b=0;b<s.length;b++){var C=s[b];g[l+b]=v,g.set(C,v),v+=C.length}return g[l+s.length]=v,g.set(this.keys,v),g[l+s.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer},o0})(),sh=qu(i1);let ad={};function Lt(l,t,s={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),ad[t]={klass:l,omit:s.omit||[]}}Lt(Object,"Object"),sh.serialize=function(l,t){let s=l.toArrayBuffer();return t&&t.add(s),{buffer:s}},sh.deserialize=function(l){return new sh(l.buffer)},Object.defineProperty(sh,"name",{value:"Grid"}),Lt(sh,"Grid"),delete ot.prototype.constructor,Lt(ui,"Color"),Lt(Error,"Error"),Lt(hs,"Formatted"),Lt(fm,"FormattedSection"),Lt(Bs,"AJAXError"),Lt(ps,"ResolvedImage"),Lt($m,"StylePropertyFunction"),Lt(jm,"StyleExpression",{omit:["_evaluator"]}),Lt(as,"ImageId"),Lt(Kl,"ImageVariant"),Lt(sd,"ZoomDependentExpression"),Lt(oh,"ZoomConstantExpression"),Lt(fs,"CompoundExpression",{omit:["_evaluate"]});for(let l in rh)ad[rh[l]._classRegistryKey]||Lt(rh[l],`Expression${l}`);function Op(l){return l&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function tc(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Op(l)||l instanceof ImageBitmap)return t&&t.add(l),l;if(ArrayBuffer.isView(l))return t&&t.add(l.buffer),l;if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){let s=[];for(let u of l)s.push(tc(u,t));return s}if(l instanceof Map){let s={$name:"Map",entries:[]};for(let[u,h]of l.entries())s.entries.push(tc(u),tc(h,t));return s}if(l instanceof Set){let s={$name:"Set"},u=0;for(let h of l.values())s[++u]=tc(h);return s}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){let s=l.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);let h=s.serialize?s.serialize(l,t):{};if(!s.serialize){for(let m in l)l.hasOwnProperty(m)&&(ad[u].omit.indexOf(m)>=0||(h[m]=tc(l[m],t)));l instanceof Error&&(h.message=l.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof l)}function iu(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Op(l)||l instanceof ImageBitmap||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(iu);if(typeof l=="object"){let t=l.$name||"Object";if(t==="Map"){let h=l.entries||[],m=new Map;for(let g=0;g<h.length;g+=2)m.set(iu(h[g]),iu(h[g+1]));return m}if(t==="Set"){let h=new Set;for(let m of Object.keys(l))m!=="$name"&&h.add(iu(l[m]));return h}if(t==="BigInt")return BigInt(l.value);let{klass:s}=ad[t];if(!s)throw new Error(`Can't deserialize unregistered class "${t}".`);if(s.deserialize)return s.deserialize(l);let u=Object.create(s.prototype);for(let h of Object.keys(l))h!=="$name"&&(u[h]=iu(l[h]));return u}throw new Error("can't deserialize object of type "+typeof l)}let en={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Rp(l){for(let t of l)if(Hm(t.charCodeAt(0)))return!0;return!1}function s0(l){for(let t of l)if(!r1(t.charCodeAt(0)))return!1;return!0}function r1(l){return!(en.Arabic(l)||en["Arabic Supplement"](l)||en["Arabic Extended-A"](l)||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l))}function Hm(l){return!(l!==746&&l!==747&&(l<4352||!(en["Bopomofo Extended"](l)||en.Bopomofo(l)||en["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||en["CJK Compatibility Ideographs"](l)||en["CJK Compatibility"](l)||en["CJK Radicals Supplement"](l)||en["CJK Strokes"](l)||!(!en["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||en["CJK Unified Ideographs Extension A"](l)||en["CJK Unified Ideographs"](l)||en["Enclosed CJK Letters and Months"](l)||en["Hangul Compatibility Jamo"](l)||en["Hangul Jamo Extended-A"](l)||en["Hangul Jamo Extended-B"](l)||en["Hangul Jamo"](l)||en["Hangul Syllables"](l)||en.Hiragana(l)||en["Ideographic Description Characters"](l)||en.Kanbun(l)||en["Kangxi Radicals"](l)||en["Katakana Phonetic Extensions"](l)||en.Katakana(l)&&l!==12540||!(!en["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!en["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||en["Unified Canadian Aboriginal Syllabics"](l)||en["Unified Canadian Aboriginal Syllabics Extended"](l)||en["Vertical Forms"](l)||en["Yijing Hexagram Symbols"](l)||en["Yi Syllables"](l)||en["Yi Radicals"](l))))}function Gm(l){return!(Hm(l)||(function(t){return!!(en["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||en["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||en["Letterlike Symbols"](t)||en["Number Forms"](t)||en["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||en["Control Pictures"](t)&&t!==9251||en["Optical Character Recognition"](t)||en["Enclosed Alphanumerics"](t)||en["Geometric Shapes"](t)||en["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||en["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||en["CJK Symbols and Punctuation"](t)||en.Katakana(t)||en["Private Use Area"](t)||en["CJK Compatibility Forms"](t)||en["Small Form Variants"](t)||en["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(l))}function qm(l){return en.Arabic(l)||en["Arabic Supplement"](l)||en["Arabic Extended-A"](l)||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l)}function a0(l){return l>=1424&&l<=2303||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l)}function nc(l,t){return!(!t&&a0(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||en.Khmer(l))}function nI(l){for(let t of l)if(a0(t.charCodeAt(0)))return!0;return!1}let Vs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"},l0=null,ms=Vs.unavailable,ic=null,kp=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(ms=Vs.error),l0&&l0(l)};function Wm(){Zm.fire(new _l("pluginStateChange",{pluginStatus:ms,pluginURL:ic}))}let Zm=new ed,Fp=function(){return ms},o1=function(){if(ms!==Vs.deferred||!ic)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ms=Vs.loading,Wm(),ic&&Xl({url:ic},l=>{l?kp(l):(ms=Vs.loaded,Wm())})},rc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ms===Vs.loaded||rc.applyArabicShaping!=null,isLoading:()=>ms===Vs.loading,setState(l){ms=l.pluginStatus,ic=l.pluginURL},isParsing:()=>ms===Vs.parsing,isParsed:()=>ms===Vs.parsed,getPluginURL:()=>ic};class Vi{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(s,u){for(let h of s)if(!nc(h.charCodeAt(0),u))return!1;return!0})(t,rc.isLoaded())}}class Ym{constructor(t,s,u,h,m){this.property=t,this.value=s,this.expression=(function(g,v,b,C,T){if(Um(g))return new $m(g,v);if(Ap(g)||Array.isArray(g)&&g.length>0){let I=r0(g,v,b,C,T);if(I.result==="error")throw new Error(I.value.map(D=>`${D.key}: ${D.message}`).join(", "));return I.value}{let I=g;return typeof g=="string"&&v.type==="color"&&(I=ui.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>I}}})(s===void 0?t.specification.default:s,t.specification,u,h,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,u,h){return this.property.possiblyEvaluate(this,t,s,u,h)}}class c0{constructor(t,s,u,h){this.property=t,this.value=new Ym(t,void 0,s,u,h)}transitioned(t,s){return new a1(this.property,this.value,s,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new a1(this.property,this.value,null,{},0)}}class s1{constructor(t,s,u,h){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Xe(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new c0(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new Ym(this._values[t].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].value.isIndoorDependent())}setTransitionOrValue(t,s){s&&(this._options=s);let u=this._properties.properties;if(t)for(let h in t){let m=t[h];if(h.endsWith("-transition")){let g=h.slice(0,-11);u[g]&&this.setTransition(g,m)}else u.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(t){return Xe(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new c0(this._values[t].property)),this._values[t].transition=Xe(s)||void 0}serialize(){let t={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(t[s]=u);let h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){let u=new l1(this._properties);for(let h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(t,s._values[h]);return u}untransitioned(){let t=new l1(this._properties);for(let s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}isIndoorDependent(){return this._isIndoorDependent}}class a1{constructor(t,s,u,h,m){let g=h.delay||0,v=h.duration||0;m=m||0,this.property=t,this.value=s,this.begin=m+g,this.end=this.begin+v,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(t,s,u){let h=t.now||0,m=this.value.possiblyEvaluate(t,s,u),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(t,s,u);{let v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,s,u),m,Zu(v))}}return m}}class l1{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,u){let h=new cd(this._properties);for(let m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,s,u);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class c1{constructor(t,s,u,h){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Xe(this._values[t].value)}setValue(t,s){this._values[t]=new Ym(this._values[t].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].isIndoorDependent())}serialize(){let t={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(t[s]=u)}return t}possiblyEvaluate(t,s,u,h){let m=new cd(this._properties);for(let g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(t,s,u,h);return m}isIndoorDependent(){return this._isIndoorDependent}}class ld{constructor(t,s,u,h){this.property=t,this.value=s,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,u,h){return this.property.evaluate(this.value,this.parameters,t,s,u,h,this.iconImageUseTheme)}}class cd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,u){let h=fp[this.specification.type];return h?h(t,s,u):t}}class Ct{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,u,h,m){return t.expression.kind==="constant"||t.expression.kind==="camera"?new ld(this,{kind:"constant",value:t.expression.evaluate(s,null,{},u,h,void 0,m)},s):new ld(this,t.expression,s,m)}interpolate(t,s,u){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new ld(this,{kind:"constant",value:void 0},t.parameters);let h=fp[this.specification.type];return h?new ld(this,{kind:"constant",value:h(t.value.value,s.value.value,u)},t.parameters):t}evaluate(t,s,u,h,m,g,v){return t.kind==="constant"?t.value:t.evaluate(s,u,h,m,g,void 0,v)}}class ud{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,h){return!!t.expression.evaluate(s,null,{},u,h)}interpolate(){return!1}}class gr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let s=new Vi(0,{});for(let u in t){let h=t[u];h.specification.overridable&&this.overridableProperties.push(u);let m=this.defaultPropertyValues[u]=new Ym(h,void 0),g=this.defaultTransitionablePropertyValues[u]=new c0(h);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(s)}}}Lt(Ct,"DataDrivenProperty"),Lt(gt,"DataConstantProperty"),Lt(ud,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function u1(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Xm(l){if(Array.isArray(l))return l.map(Xm);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let t={};for(let s in l)t[s]=Xm(l[s]);return t}return u1(l)}function Cl(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let t of l.slice(1))if(!Cl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Km(l,t="",s=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cl(l)||(l=Qm(l));let h=l,m=!0;try{m=(function(T){if(!ah(T))return T;let I=Xm(T);return d1(I),I=dd(I),I})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,v=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){v=Oe[`filter_${u}`];let T=nu(m,v,t,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));g=(I,D,O)=>T.value.evaluate(I,D,{},O)}let b=null,C=null;if(m!==h){let T=nu(h,v,t,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,D,O,R,B)=>T.value.evaluate(I,D,{},O,void 0,void 0,R,B),C=!Kd(T.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:h1(m),needFeature:!!C}}function dd(l){if(!Array.isArray(l))return l;let t=(function(s){if(iI.has(s[0])){for(let u=1;u<s.length;u++)if(ah(s[u]))return!0}return s})(l);return t===!0?t:t.map(s=>dd(s))}function d1(l){let t=!1,s=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)t=t||ah(l[u]),s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="match"){t=t||ah(l[1]);for(let u=2;u<l.length-1;u+=2)s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="step"){t=t||ah(l[1]);for(let u=1;u<l.length-1;u+=2)s.push(l[u+1])}t&&(l.length=0,l.push("any",...s));for(let u=1;u<l.length;u++)d1(l[u])}function ah(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<l.length;s++)if(ah(l[s]))return!0;return!1}let iI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rI(l,t){return l<t?-1:l>t?1:0}function h1(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(h1(l[t]))return!0;return!1}function Qm(l){if(!l)return!0;let t=l[0];return l.length<=1?t!=="any":t==="=="?Jm(l[1],l[2],"=="):t==="!="?Lp(Jm(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Jm(l[1],l[2],t):t==="any"?(s=l.slice(1),["any"].concat(s.map(Qm))):t==="all"?["all"].concat(l.slice(1).map(Qm)):t==="none"?["all"].concat(l.slice(1).map(Qm).map(Lp)):t==="in"?eg(l[1],l.slice(2)):t==="!in"?Lp(eg(l[1],l.slice(2))):t==="has"?tg(l[1]):t!=="!has"||Lp(tg(l[1]));var s}function Jm(l,t,s){switch(l){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,l,t]}}function eg(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",l,["literal",t.sort(rI)]]:["filter-in-small",l,["literal",t]]}}function tg(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Lp(l){return["!",l]}let hd="";function Xa(l,t){return t?`${l}${hd}${t}`:l}let p1,f1=()=>p1||(p1=new gr({"icon-size":new Ct(Oe.layout_symbol["icon-size"]),"icon-image":new Ct(Oe.layout_symbol["icon-image"]),"icon-rotate":new Ct(Oe.layout_symbol["icon-rotate"]),"icon-offset":new Ct(Oe.layout_symbol["icon-offset"]),"text-size":new Ct(Oe.layout_symbol["text-size"]),"text-rotate":new Ct(Oe.layout_symbol["text-rotate"]),"text-offset":new Ct(Oe.layout_symbol["text-offset"])}));class m1{constructor(t,s,u,h,m,g){let v=nu(t,Oe.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=s,u){this.properties=new cd(f1()),this.unevaluatedLayout=new c1(f1(),h,m,g);for(let b in u)this.unevaluatedLayout.setValue(b,u[b])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(t){return this.unevaluatedLayout._values[t]}recalculate(t,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(t,void 0,s,u))}serialize(){let t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.unevaluatedLayout&&(t.properties=this.unevaluatedLayout.serialize()),t}hasIconProperties(){let t=this.hasProperty("icon-image"),s=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),h=this.hasProperty("icon-rotate");return t||s||u||h}hasTextProperties(){let t=this.hasProperty("text-size"),s=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return t||s||u}hasProperty(t){return this.getUnevaluatedProperty(t).value!==void 0}}let g1="-transition",El=new Set(["fill","line","background","hillshade","raster"]);class gs extends ed{constructor(t,s,u,h,m,g){if(super(),this.id=t.id,this.fqid=Xa(this.id,u),this.type=t.type,this.scope=u,this.lut=h,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;let v=nu(this.filter,Oe[`filter_${t.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(t.slot&&(this.slot=t.slot),t.appearances&&this.setAppearances(t.appearances),s.layout&&(this._unevaluatedLayout=new c1(s.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new s1(s.paint,this.scope,m);for(let v in t.paint)this.setPaintProperty(v,t.paint[v]);for(let v in t.layout)this.setLayoutProperty(v,t.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cd(s.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&El.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s){if(this.type==="custom"&&t==="visibility")return void(this.visibility=s);let u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),t==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(t){this.appearances=[],t.forEach(s=>{this.appearances.push(new m1(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(g1)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}isPaintProperty(t){return!!this._transitionablePaint._properties.properties[t]}setPaintProperty(t,s){let u=this._transitionablePaint,h=u._properties.properties;if(t.endsWith(g1)){let I=t.slice(0,-11);return h[I]&&u.setTransition(I,s||void 0),!1}if(!h[t])return!1;let m=u._values[t],g=m.value.isDataDriven(),v=m.value;u.setValue(t,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(t);let b=u._values[t].value,C=b.isDataDriven(),T=t.endsWith("pattern")||t==="line-dasharray";return C||g||T||this._handleOverridablePaintPropertyUpdate(t,v,b)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,s,u){return null}_handleOverridablePaintPropertyUpdate(t,s,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){let t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map(s=>s.serialize())),ut(t,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(let t in this.paint._values){let s=this.paint.get(t);if(s instanceof ld&&Dp(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(let t of this.appearances)if(!Cp(t.condition.expression))return!0;return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Km(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(t,s,u){return{}}queryRadius(t){}queryIntersectsFeature(t,s,u,h,m,g,v,b,C){}}let _1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Np{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}let oI=new ArrayBuffer(0);class Xi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(t,s){return t._trim(),s&&t.arrayBuffer&&s.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,t.arrayBuffer?s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement:(s.capacity=0,s.arrayBuffer=oI),s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this._reallocCount++,this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}reserveForAdditional(t){this.reserve(this.length+t)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function An(l,t=1){let s=0,u=0;return{members:l.map(h=>{let m=_1[h.type].BYTES_PER_ELEMENT,g=s=v1(s,Math.max(t,m)),v=h.components||1;return u=Math.max(u,m),s+=m*v,{name:h.name,type:h.type,components:v,offset:g}}),size:v1(s,Math.max(u,t)),alignment:t}}function v1(l,t){return Math.ceil(l/t)*t}class ru extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.int16[h+0]=s,this.int16[h+1]=u,t}}ru.prototype.bytesPerElement=4,Lt(ru,"StructArrayLayout2i4");class lh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=h,t}}lh.prototype.bytesPerElement=6,Lt(lh,"StructArrayLayout3i6");class ch extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,this.int16[g+3]=m,t}}ch.prototype.bytesPerElement=8,Lt(ch,"StructArrayLayout4i8");class oc extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}oc.prototype.bytesPerElement=4,Lt(oc,"StructArrayLayout1f4");class u0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=4*t,g=2*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.float32[g+1]=h,t}}u0.prototype.bytesPerElement=8,Lt(u0,"StructArrayLayout2i1f8");class d0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=4*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=h,t}}d0.prototype.bytesPerElement=8,Lt(d0,"StructArrayLayout3i8");class h0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=5*t;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=g,t}}h0.prototype.bytesPerElement=10,Lt(h0,"StructArrayLayout5i10");class ng extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let C=6*t,T=12*t,I=3*t;return this.int16[C+0]=s,this.int16[C+1]=u,this.uint8[T+4]=h,this.uint8[T+5]=m,this.uint8[T+6]=g,this.uint8[T+7]=v,this.float32[I+2]=b,t}}ng.prototype.bytesPerElement=12,Lt(ng,"StructArrayLayout2i4ub1f12");class ea extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.float32[m+0]=s,this.float32[m+1]=u,this.float32[m+2]=h,t}}ea.prototype.bytesPerElement=12,Lt(ea,"StructArrayLayout3f12");class Ms extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=6*t,b=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=m,this.float32[b+2]=g,t}}Ms.prototype.bytesPerElement=12,Lt(Ms,"StructArrayLayout4ui1f12");class pd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=h,this.uint16[g+3]=m,t}}pd.prototype.bytesPerElement=8,Lt(pd,"StructArrayLayout4ui8");class ig extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=6*t;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=v,t}}ig.prototype.bytesPerElement=12,Lt(ig,"StructArrayLayout6i12");class p0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I,D){let O=this.length;return this.resize(O+1),this.emplace(O,t,s,u,h,m,g,v,b,C,T,I,D)}emplace(t,s,u,h,m,g,v,b,C,T,I,D,O){let R=12*t;return this.int16[R+0]=s,this.int16[R+1]=u,this.int16[R+2]=h,this.int16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=v,this.uint16[R+6]=b,this.uint16[R+7]=C,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=D,this.int16[R+11]=O,t}}p0.prototype.bytesPerElement=24,Lt(p0,"StructArrayLayout4i4ui4i24");class f0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=10*t,C=5*t;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=h,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=v,t}}f0.prototype.bytesPerElement=20,Lt(f0,"StructArrayLayout3i3f20");class ou extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=h,this.float32[g+3]=m,t}}ou.prototype.bytesPerElement=16,Lt(ou,"StructArrayLayout4f16");class rg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}rg.prototype.bytesPerElement=4,Lt(rg,"StructArrayLayout1ul4");class ta extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=u,t}}ta.prototype.bytesPerElement=4,Lt(ta,"StructArrayLayout2ui4");class og extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I,D,O){let R=this.length;return this.resize(R+1),this.emplace(R,t,s,u,h,m,g,v,b,C,T,I,D,O)}emplace(t,s,u,h,m,g,v,b,C,T,I,D,O,R){let B=20*t,H=10*t;return this.int16[B+0]=s,this.int16[B+1]=u,this.int16[B+2]=h,this.int16[B+3]=m,this.int16[B+4]=g,this.float32[H+3]=v,this.float32[H+4]=b,this.float32[H+5]=C,this.float32[H+6]=T,this.int16[B+14]=I,this.uint32[H+8]=D,this.uint16[B+18]=O,this.uint16[B+19]=R,t}}og.prototype.bytesPerElement=40,Lt(og,"StructArrayLayout5i4f1i1ul2ui40");class sg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let C=8*t;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=h,this.int16[C+4]=m,this.int16[C+5]=g,this.int16[C+6]=v,this.int16[C+7]=b,t}}sg.prototype.bytesPerElement=16,Lt(sg,"StructArrayLayout3i2i2i16");class ag extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=4*t,b=8*t;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[b+6]=m,this.int16[b+7]=g,t}}ag.prototype.bytesPerElement=16,Lt(ag,"StructArrayLayout2f1f2i16");class m0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=20*t,C=5*t;return this.uint8[b+0]=s,this.uint8[b+1]=u,this.float32[C+1]=h,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=v,t}}m0.prototype.bytesPerElement=20,Lt(m0,"StructArrayLayout2ub4f20");class Xr extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.uint16[m+0]=s,this.uint16[m+1]=u,this.uint16[m+2]=h,t}}Xr.prototype.bytesPerElement=6,Lt(Xr,"StructArrayLayout3ui6");class uh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he){let le=this.length;return this.resize(le+1),this.emplace(le,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he)}emplace(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he,le){let me=30*t,ye=15*t,we=60*t;return this.int16[me+0]=s,this.int16[me+1]=u,this.int16[me+2]=h,this.float32[ye+2]=m,this.float32[ye+3]=g,this.uint16[me+8]=v,this.uint16[me+9]=b,this.uint32[ye+5]=C,this.uint32[ye+6]=T,this.uint32[ye+7]=I,this.uint16[me+16]=D,this.uint16[me+17]=O,this.uint16[me+18]=R,this.float32[ye+10]=B,this.float32[ye+11]=H,this.uint8[we+48]=$,this.uint8[we+49]=Y,this.uint8[we+50]=Q,this.uint32[ye+13]=ie,this.int16[me+28]=he,this.uint8[we+58]=le,t}}uh.prototype.bytesPerElement=60,Lt(uh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class g0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he,le,me,ye,we,je,Ie,We,Ke,Qe,st,lt,nt){let it=this.length;return this.resize(it+1),this.emplace(it,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he,le,me,ye,we,je,Ie,We,Ke,Qe,st,lt,nt)}emplace(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he,le,me,ye,we,je,Ie,We,Ke,Qe,st,lt,nt,it){let qe=20*t,He=40*t,rt=80*t;return this.float32[qe+0]=s,this.float32[qe+1]=u,this.int16[He+4]=h,this.int16[He+5]=m,this.int16[He+6]=g,this.int16[He+7]=v,this.int16[He+8]=b,this.int16[He+9]=C,this.int16[He+10]=T,this.int16[He+11]=I,this.int16[He+12]=D,this.uint16[He+13]=O,this.uint16[He+14]=R,this.uint16[He+15]=B,this.uint16[He+16]=H,this.uint16[He+17]=$,this.uint16[He+18]=Y,this.uint16[He+19]=Q,this.uint16[He+20]=ie,this.uint16[He+21]=he,this.uint16[He+22]=le,this.uint16[He+23]=me,this.uint16[He+24]=ye,this.uint16[He+25]=we,this.uint16[He+26]=je,this.uint16[He+27]=Ie,this.uint32[qe+14]=We,this.float32[qe+15]=Ke,this.float32[qe+16]=Qe,this.float32[qe+17]=st,this.float32[qe+18]=lt,this.uint8[rt+76]=nt,this.uint16[He+39]=it,t}}g0.prototype.bytesPerElement=80,Lt(g0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class _0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=6*t;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=g,this.float32[b+5]=v,t}}_0.prototype.bytesPerElement=24,Lt(_0,"StructArrayLayout6f24");class fd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=5*t;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=m,this.float32[v+4]=g,t}}fd.prototype.bytesPerElement=20,Lt(fd,"StructArrayLayout5f20");class v0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let C=7*t;return this.float32[C+0]=s,this.float32[C+1]=u,this.float32[C+2]=h,this.float32[C+3]=m,this.float32[C+4]=g,this.float32[C+5]=v,this.float32[C+6]=b,t}}v0.prototype.bytesPerElement=28,Lt(v0,"StructArrayLayout7f28");class y0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I){let D=this.length;return this.resize(D+1),this.emplace(D,t,s,u,h,m,g,v,b,C,T,I)}emplace(t,s,u,h,m,g,v,b,C,T,I,D){let O=11*t;return this.float32[O+0]=s,this.float32[O+1]=u,this.float32[O+2]=h,this.float32[O+3]=m,this.float32[O+4]=g,this.float32[O+5]=v,this.float32[O+6]=b,this.float32[O+7]=C,this.float32[O+8]=T,this.float32[O+9]=I,this.float32[O+10]=D,t}}y0.prototype.bytesPerElement=44,Lt(y0,"StructArrayLayout11f44");class dh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C){let T=this.length;return this.resize(T+1),this.emplace(T,t,s,u,h,m,g,v,b,C)}emplace(t,s,u,h,m,g,v,b,C,T){let I=9*t;return this.float32[I+0]=s,this.float32[I+1]=u,this.float32[I+2]=h,this.float32[I+3]=m,this.float32[I+4]=g,this.float32[I+5]=v,this.float32[I+6]=b,this.float32[I+7]=C,this.float32[I+8]=T,t}}dh.prototype.bytesPerElement=36,Lt(dh,"StructArrayLayout9f36");class Sl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.float32[h+0]=s,this.float32[h+1]=u,t}}Sl.prototype.bytesPerElement=8,Lt(Sl,"StructArrayLayout2f8");class Ds extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=6*t;return this.uint32[3*t+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=h,this.uint16[g+4]=m,t}}Ds.prototype.bytesPerElement=12,Lt(Ds,"StructArrayLayout1ul3ui12");class su extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}su.prototype.bytesPerElement=2,Lt(su,"StructArrayLayout1ui2");class x0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H){let $=this.length;return this.resize($+1),this.emplace($,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H)}emplace(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$){let Y=16*t;return this.float32[Y+0]=s,this.float32[Y+1]=u,this.float32[Y+2]=h,this.float32[Y+3]=m,this.float32[Y+4]=g,this.float32[Y+5]=v,this.float32[Y+6]=b,this.float32[Y+7]=C,this.float32[Y+8]=T,this.float32[Y+9]=I,this.float32[Y+10]=D,this.float32[Y+11]=O,this.float32[Y+12]=R,this.float32[Y+13]=B,this.float32[Y+14]=H,this.float32[Y+15]=$,t}}x0.prototype.bytesPerElement=64,Lt(x0,"StructArrayLayout16f64");class lg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let C=10*t,T=5*t;return this.uint16[C+0]=s,this.uint16[C+1]=u,this.uint16[C+2]=h,this.uint16[C+3]=m,this.float32[T+2]=g,this.float32[T+3]=v,this.float32[T+4]=b,t}}lg.prototype.bytesPerElement=20,Lt(lg,"StructArrayLayout4ui3f20");class b0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.int16[1*t+0]=s,t}}b0.prototype.bytesPerElement=2,Lt(b0,"StructArrayLayout1i2");class cg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint8[1*t+0]=s,t}}cg.prototype.bytesPerElement=1,Lt(cg,"StructArrayLayout1ub1");class ug extends Np{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ug.prototype.size=40;class y1 extends og{get(t){return new ug(this,t)}}Lt(y1,"CollisionBoxArray");class dg extends Np{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}dg.prototype.size=60;class x1 extends uh{get(t){return new dg(this,t)}}Lt(x1,"PlacedSymbolArray");class b1 extends Np{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}b1.prototype.size=80;class w0 extends g0{get(t){return new b1(this,t)}}Lt(w0,"SymbolInstanceArray");class hg extends oc{getoffsetX(t){return this.float32[1*t+0]}}Lt(hg,"GlyphOffsetArray");class w1 extends ru{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Lt(w1,"SymbolLineVertexArray");class C0 extends Np{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}C0.prototype.size=12;class E0 extends Ds{get(t){return new C0(this,t)}}Lt(E0,"FeatureIndexArray");class C1 extends ta{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Lt(C1,"FillExtrusionCentroidArray");class pg extends Np{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}pg.prototype.size=6;class zp extends lh{get(t){return new pg(this,t)}}Lt(zp,"FillExtrusionWallArray");let E1=An([{name:"a_pos",components:2,type:"Int16"}],4),sI=An([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),S1=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class nr{constructor(t=[]){this.segments=t}_prepareSegment(t,s,u,h){let m=this.segments[this.segments.length-1];return t>nr.MAX_VERTEX_ARRAY_LENGTH&&At(`Max vertices per segment is ${nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>nr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(t,s,u,h){return this._prepareSegment(t,s.length,u.length,h)}get(){return this.segments}destroy(){for(let t of this.segments)for(let s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,u,h){return new nr([{vertexOffset:t,primitiveOffset:s,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function fg(l,t){return 256*(l=G(Math.floor(l),0,255))+G(Math.floor(t),0,255)}nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt(nr,"SegmentVector");let aI=An([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lI=An([{name:"a_pattern_b",components:4,type:"Uint16"}]),cI=An([{name:"a_dash",components:4,type:"Uint16"}]);class Bp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,s,u,h){this.ids.push(S0(t)),this.positions.push(s,u,h)}eachPosition(t,s){let u=S0(t),h=0,m=this.ids.length-1;for(;h<m;){let g=h+m>>1;this.ids[g]>=u?m=g:h=g+1}for(;this.ids[h]===u;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,s){let u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return T0(u,h,0,u.length-1),s&&(s.add(u.buffer),s.add(h.buffer)),{ids:u,positions:h}}static deserialize(t){let s=new Bp,u;s.ids=t.ids,s.positions=t.positions;for(let h of s.ids)h!==u&&s.uniqueIds.push(h),u=h;return s.indexed=!0,s}}function S0(l){let t=+l;return Number.isSafeInteger(t)?t:um(String(l))}function T0(l,t,s,u){for(;s<u;){let h=l[s+u>>1],m=s-1,g=u+1;for(;;){do m++;while(l[m]<h);do g--;while(l[g]>h);if(m>=g)break;mg(l,m,g),mg(t,3*m,3*g),mg(t,3*m+1,3*g+1),mg(t,3*m+2,3*g+2)}g-s<u-g?(T0(l,t,s,g),s=g+1):(T0(l,t,g+1,u),u=g)}}function mg(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}Lt(Bp,"FeaturePositionMap");class sc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}set(t,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class gg extends sc{constructor(t){super(t),this.current=0}set(t,s,u){this.fetchUniformLocation(t,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Kr extends sc{constructor(t){super(t),this.current=0}set(t,s,u){this.fetchUniformLocation(t,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Tl extends sc{constructor(t){super(t),this.current=[0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Vp extends sc{constructor(t){super(t),this.current=[0,0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class _g extends sc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Up extends sc{constructor(t){super(t),this.current=ui.transparent.toPremultipliedRenderColor(null)}set(t,s,u){this.fetchUniformLocation(t,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let uI=new Float32Array(16);class jp extends sc{constructor(t){super(t),this.current=uI}set(t,s,u){if(this.fetchUniformLocation(t,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}let vg=new Float32Array(9),dI=new Float32Array(4);class yg extends sc{constructor(t){super(t),this.current=dI}set(t,s,u){if(this.fetchUniformLocation(t,s)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function I0(l){return[fg(255*l.r,255*l.g),fg(255*l.b,255*l.a)]}function $p(l,t,s,u,h,m,g,v){return!!l&&(l.kind==="composite"||l.kind==="source"?l.evaluate(new Vi(0,{brightness:m,worldview:v}),t,s,h,u,g)==="none":l.value==="none")}class Hp{constructor(t,s,u,h){this.value=t,this.uniformNames=s.map(m=>`u_${m}`),this.type=u,this.context=h}setUniform(t,s,u,h,m){let g=h.constantOr(this.value);s.set(t,m,g instanceof ui?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(t,s){return this.type==="color"?new Up(t):new Kr(t)}}class hh{constructor(t,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,s){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(t,s,u,h,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&s.set(t,m,g)}getBinding(t,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new _g(t):new Kr(t)}}class ac{constructor(t,s,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,u,h,m,g,v,b){let C=this.paintVertexArray.length,T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Vi(0,{brightness:g,worldview:b}),s,{},m,h,v):this.expression.kind==="constant"&&this.expression.value,I=$p(this.lutExpression,s,{},h,m,g,v,b);this.paintVertexArray.resize(t),this._setPaintValue(C,t,T,I?null:this.context.lut)}updatePaintArray(t,s,u,h,m,g,v,b){let C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},u,h,void 0,m):this.expression.kind==="constant"&&this.expression.value,T=$p(this.lutExpression,u,h,m,void 0,v,void 0,b);this._setPaintValue(t,s,C,T?null:this.context.lut)}_setPaintValue(t,s,u,h){if(this.type==="color"){let m=I0(u.toPremultipliedRenderColor(h));for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lc{constructor(t,s,u,h,m,g){this.expression=t,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,s,u,h,m,g,v,b){let C=this.expression.evaluate(new Vi(this.context.zoom,{brightness:g,worldview:b}),s,{},m,h,v),T=this.expression.evaluate(new Vi(this.context.zoom+1,{brightness:g,worldview:b}),s,{},m,h,v),I=$p(this.lutExpression,s,{},h,m,g,v,b),D=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(D,t,C,T,I?null:this.context.lut)}updatePaintArray(t,s,u,h,m,g,v,b){let C=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},u,h,void 0,m),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},u,h,void 0,m),I=$p(this.lutExpression,u,h,m,void 0,v,void 0,b);this._setPaintValue(t,s,C,T,I?null:this.context.lut)}_setPaintValue(t,s,u,h,m){if(this.type==="color"){let g=I0(u.toPremultipliedRenderColor(m)),v=I0(u.toPremultipliedRenderColor(m));for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,g[0],g[1],v[0],v[1])}else{for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,u,h,m){let g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=G(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(t,m,v)}getBinding(t,s){return new Kr(t)}}class cc{constructor(t,s,u,h,m){this.expression=t,this.layerId=m,this.paintVertexAttributes=(u==="array"?cI:aI).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new pd}populatePaintArray(t,s,u,h){let m=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(m,t,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(t,s,u,h,m,g,v){this._setPaintValues(t,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(t,s,u,h){if(!h||!u)return;let m=h[u[0]],g=h[u[1]];if(m){if(m){let{tl:v,br:b,pixelRatio:C}=m;for(let T=t;T<s;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1],C)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:v,br:b}=g;for(let C=t;C<s;C++)this.paintTransitionVertexArray.emplace(C,v[0],v[1],b[0],b[1])}}}upload(t){let s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,lI.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class au{constructor(t,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;let h=[];for(let m in t.paint._values){let g=t.paint.get(m);if(m.endsWith("-use-theme")||!u(m)||!(g instanceof ld&&Dp(g.property.specification)))continue;let v=pI(m,t.type),b=g.value,C=g.property.specification.type,T=!!g.property.useIntegerZoom,I=m==="line-dasharray"||m.endsWith("pattern"),D=t.paint.get(`${m}-use-theme`),O=m==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(b.kind!=="constant"||O)if(b.kind==="source"||O||I){let R=M0(m,C,"source");this.binders[m]=I?new cc(b,v,C,R,t.id):new ac(b,v,C,R),h.push(`/a_${m}`)}else{let R=M0(m,C,"composite");this.binders[m]=new lc(b,v,C,T,s,R),h.push(`/z_${m}`)}else this.binders[m]=I?new hh(b.value,v):new Hp(b.value,v,C,s),h.push(`/u_${m}`);D&&(this.binders[m].lutExpression=D.value)}this.cacheKey=h.sort().join("")}getMaxValue(t){let s=this.binders[t];return s instanceof ac||s instanceof lc?s.maxValue:0}populatePaintArrays(t,s,u,h,m,g,v,b){for(let C in this.binders){let T=this.binders[C];T.context=this.context,(T instanceof ac||T instanceof lc||T instanceof cc)&&T.populatePaintArray(t,s,u,h,m,g,v,b)}}setConstantPatternPositions(t,s){for(let u in this.binders){let h=this.binders[u];h instanceof hh&&h.setConstantPatternPositions(t,s)}}getPatternTransitionVertexBuffer(t){let s=this.binders[t];return s instanceof cc?s.paintTransitionVertexBuffer:null}updatePaintArrays(t,s,u,h,m,g,v,b,C,T){let I=!1,D=Object.keys(t),O=D.length!==0&&!b,R=O?D:s.uniqueIds;this.context.lut=m.lut;for(let B in this.binders){let H=this.binders[B];if(H.context=this.context,(H instanceof ac||H instanceof lc||H instanceof cc)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){let $=m.paint.get(B);H.expression=$.value;for(let Y of R){let Q=t[Y.toString()];s.eachPosition(Y,(ie,he,le)=>{let me=h.feature(ie);H.updatePaintArray(he,le,me,Q,g,v,C,T)})}if(!O)for(let Y of u.uniqueIds){let Q=t[Y.toString()];u.eachPosition(Y,(ie,he,le)=>{let me=h.feature(ie);H.updatePaintArray(he,le,me,Q,g,v,C,T)})}I=!0}}return I}defines(){let t=[];for(let s in this.binders){let u=this.binders[s];(u instanceof Hp||u instanceof hh)&&t.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let s=[];for(let u in this.binders){let h=this.binders[u];if(h instanceof Hp||h instanceof hh||h instanceof lc)for(let m of h.uniformNames)s.push({name:m,property:u,binding:h.getBinding(t,m)})}return s}setUniforms(t,s,u,h,m){for(let{name:g,property:v,binding:b}of u)this.binders[v].setUniform(t,b,m,h.get(v),g)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let s=this.binders[t];(s instanceof ac||s instanceof lc||s instanceof cc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof cc&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(t){for(let s in this.binders){let u=this.binders[s];(u instanceof ac||u instanceof lc||u instanceof cc)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let s=this.binders[t];(s instanceof ac||s instanceof lc||s instanceof cc)&&s.destroy()}}}class Ka{constructor(t,s,u=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new au(h,s,u);this.needsUpload=!1,this._featureMap=new Bp,this._featureMapWithoutIds=new Bp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,s,u,h,m,g,v,b,C){for(let T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(t,s,h,m,g,v,b,C);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,u,h,m,g,v,b){for(let C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,s,C,h,m,g,v||0,b)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let hI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function pI(l,t){return hI[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}let fI={"line-pattern":{source:Ms,composite:Ms},"fill-pattern":{source:Ms,composite:Ms},"fill-extrusion-pattern":{source:Ms,composite:Ms},"line-dasharray":{source:pd,composite:pd}},mI={color:{source:Sl,composite:ou},number:{source:oc,composite:Sl}};function M0(l,t,s){let u=fI[l];return u&&u[s]||mI[t][s]}Lt(Hp,"ConstantBinder"),Lt(hh,"PatternConstantBinder"),Lt(ac,"SourceExpressionBinder"),Lt(cc,"PatternCompositeBinder"),Lt(lc,"CompositeExpressionBinder"),Lt(au,"ProgramConfiguration",{omit:["_buffers"]}),Lt(Ka,"ProgramConfigurationSet");let Yo=vt/Math.PI/2,Ea=5,xg=6,gI=16383,ph=64,D0=[ph,32,16],Sa=-Yo,Ta=Yo;function md(l,t,s,u=Yo){return s=Zn(s),[l*Math.sin(s)*u,-t*u,l*Math.cos(s)*u]}function fh(l,t,s){return md(Math.cos(Zn(l)),Math.sin(Zn(l)),t,s)}let p=63710088e-1,o=2*Math.PI*p;class c{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let s=Math.PI/180,u=this.lat*s,h=t.lat*s,m=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return p*Math.acos(Math.min(m,1))}toBounds(t=0){let s=360*t/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new f({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(t){return fh(this.lat,this.lng,Yo+t*Yo/p)}static convert(t){if(t instanceof c)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new c(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new c(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class f{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}setSouthWest(t){return this._sw=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}extend(t){let s=this._sw,u=this._ne,h,m;if(t instanceof c)h=t,m=t;else{if(!(t instanceof f))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(f.convert(t)):this.extend(c.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(c.convert(t)):this;if(h=t._sw,m=t._ne,!h||!m)return this}return s||u?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new c(h.lng,h.lat),this._ne=new c(m.lng,m.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:s,lat:u}=c.convert(t),h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(t){if(t)return t instanceof f?t:new f(t)}}let _=0,y=25.5;function x(l){return o*Math.cos(l*Math.PI/180)}function w(l){return(180+l)/360}function S(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function M(l,t){return l/x(t)}function A(l){return 360*l-180}function L(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function F(l,t){return l*x(L(t))}let N=85.051129;function j(l){return Math.cos(Zn(G(l,-N,N)))}function U(l,t){let s=G(t,_,y),u=Math.pow(2,s);return j(l)*o/(512*u)}function W(l){return 1/Math.cos(l*Math.PI/180)}function q(l,t=0){let s=Math.exp(Math.PI*(1-(l.y+t/vt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/vt/(1<<l.z)}class ee{constructor(t,s,u=0){this.x=+t,this.y=+s,this.z=+u}static fromLngLat(t,s=0){let u=c.convert(t);return new ee(w(u.lng),S(u.lat),M(s,u.lat))}toLngLat(){return new c(A(this.x),L(this.y))}toAltitude(){return F(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*W(L(this.y))}}function re(l,t,s,u,h,m,g,v,b){let C=(t+u)/2,T=(s+h)/2,I=new ot(C,T);v(I),(function(D,O,R,B,H,$){let Y=R-H,Q=B-$;return Math.abs((B-O)*Y-(R-D)*Q)/Math.hypot(Y,Q)})(I.x,I.y,m.x,m.y,g.x,g.y)>=b?(re(l,t,s,C,T,m,I,v,b),re(l,C,T,u,h,I,g,v,b)):l.push(g)}function te(l,t,s){let u=l[0],h=u.x,m=u.y;t(u);let g=[u];for(let v=1;v<l.length;v++){let b=l[v],{x:C,y:T}=b;t(b),re(g,h,m,C,T,u,b,t,s),h=C,m=T,u=b}return g}function ge(l,t,s,u){if(u(t,s)){let h=t.add(s)._mult(.5);ge(l,t,h,u),ge(l,h,s,u)}else l.push(s)}function de(l,t){let s=l[0],u=[s];for(let h=1;h<l.length;h++){let m=l[h];ge(u,s,m,t),s=m}return u}let fe=Math.pow(2,14)-1,ue=-fe-1;function ae(l,t){let s=Math.round(l.x*t),u=Math.round(l.y*t);return l.x=G(s,ue,fe),l.y=G(u,ue,fe),(s<l.x||s>l.x+1||u<l.y||u>l.y+1)&&At("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function _e(l,t,s){let u=l.loadGeometry(),h=l.extent,m=vt/h;if(t&&s&&s.projection.isReprojectedInTileSpace){let g=1<<t.z,{scale:v,x:b,y:C,projection:T}=s,I=D=>{let O=A((t.x+D.x/h)/g),R=L((t.y+D.y/h)/g),B=T.project(O,R);D.x=(B.x*v-b)*h,D.y=(B.y*v-C)*h};for(let D=0;D<u.length;D++)if(l.type!==1)u[D]=te(u[D],I,1);else{let O=[];for(let R of u[D])R.x<0||R.x>=h||R.y<0||R.y>=h||(I(R),O.push(R));u[D]=O}}for(let g of u)for(let v of g)ae(v,m);return u}function Te(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?_e(l):[]}}class Ce{constructor(t,s,u,h,m){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(Be,this,s)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let s=t.readVarint()+t.pos,u=[],h,m=1,g=0,v=0,b=0;for(;t.pos<s;){if(g<=0){let C=t.readVarint();m=7&C,g=C>>3}if(g--,m===1||m===2)v+=t.readSVarint(),b+=t.readSVarint(),m===1&&(h&&u.push(h),h=[]),h&&h.push(new ot(v,b));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){let t=this._pbf;t.pos=this._geometry;let s=t.readVarint()+t.pos,u=1,h=0,m=0,g=0,v=1/0,b=-1/0,C=1/0,T=-1/0;for(;t.pos<s;){if(h<=0){let I=t.readVarint();u=7&I,h=I>>3}if(h--,u===1||u===2)m+=t.readSVarint(),g+=t.readSVarint(),m<v&&(v=m),m>b&&(b=m),g<C&&(C=g),g>T&&(T=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[v,C,b,T]}toGeoJSON(t,s,u){let h=this.extent*Math.pow(2,u),m=this.extent*t,g=this.extent*s,v=this.loadGeometry();function b(D){return[360*(D.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+g)/h)*Math.PI))-90]}function C(D){return D.map(b)}let T;if(this.type===1){let D=[];for(let R of v)D.push(R[0]);let O=C(D);T=D.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){let D=v.map(C);T=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{let D=(function(R){let B=R.length;if(B<=1)return[R];let H=[],$,Y;for(let Q=0;Q<B;Q++){let ie=Ue(R[Q]);ie!==0&&(Y===void 0&&(Y=ie<0),Y===ie<0?($&&H.push($),$=[R[Q]]):$&&$.push(R[Q]))}return $&&H.push($),H})(v),O=[];for(let R of D)O.push(R.map(C));T=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}let I={type:"Feature",geometry:T,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Be(l,t,s){l===1?t.id=s.readVarint():l===2?(function(u,h){let m=u.readVarint()+u.pos;for(;u.pos<m;){let g=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[g]=v}})(s,t):l===3?t.type=s.readVarint():l===4&&(t._geometry=s.pos)}function Ue(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}Ce.types=["Unknown","Point","LineString","Polygon"];class Ye{constructor(t,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(dt,this,s),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let s=this._pbf.readVarint()+this._pbf.pos;return new Ce(this._pbf,s,this.extent,this._keys,this._values)}}function dt(l,t,s){l===15?t.version=s.readVarint():l===1?t.name=s.readString():l===5?t.extent=s.readVarint():l===2?t._features.push(s.pos):l===3?t._keys.push(s.readString()):l===4&&t._values.push((function(u){let h=null,m=u.readVarint()+u.pos;for(;u.pos<m;){let g=u.readVarint()>>3;h=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(s))}class Fe{constructor(t,s){this.layers=t.readFields(be,{},s)}}function be(l,t,s){if(l===3){let u=new Ye(s,s.readVarint()+s.pos);u.length&&(t[u.name]=u)}}let Ge="3d_elevation_id",Le="level";class tt{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,s){return this._valid&&t(s(this._geometry)),this}require(t,s,u){return this.get(t,!0,s,u)}optional(t,s,u){return this.get(t,!1,s,u)}success(){return this._valid}get(t,s,u,h){let m=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?u(h?h(m):m):s&&(this._valid=!1),this}}class xt{constructor(t,s){this.featureFunc=t,this.vertexFunc=s}parseFeature(t,s,u){return this.featureFunc(t,s,u)}parseVertex(t,s,u){return this.vertexFunc(t,s,u)}}let Dt=new xt((l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},pt.decodeRelativeHeight).geometry(u=>{s.bounds=u},Jl).success(),(l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},pt.decodeRelativeHeight).geometry(u=>{s.position=u},pt.getPoint).success()),_t=new xt((l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},pt.decodeMetricHeight).geometry(u=>{s.bounds=u},Jl).success(),(l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},pt.decodeMetricHeight).geometry(u=>{s.position=u},pt.getPoint).success());class pt{static getPoint(t){return Es(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?_t:void 0:Dt}static parse(t){let s=[],u=[],h=t.length,m=new tt;for(let g=0;g<h;g++){let v=t.feature(g),b=v.properties.version,C=pt.getVersionSchema(b);if(C===void 0){At(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}let T=v.properties.type;if(!T)continue;let I=Ce.types[v.type];if(I==="Point"&&T==="curve_point"){let D={};C.parseVertex(m,v,D)&&s.push(D)}else if(I==="Polygon"&&T==="curve_meta"){let D={};C.parseFeature(m,v,D)&&u.push(D)}}return{vertices:s,features:u}}}class Ut{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,u){let h=Gu(s,this.dir);if(Math.abs(h)<1e-6)return!1;let m=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,!0}}class zt{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,u){let h=Ir(s,this.dir);if(Math.abs(h)<1e-6)return!1;let m=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(t,s,u){if((function(O,R){var B=O[0],H=O[1],$=O[2],Y=R[0],Q=R[1],ie=R[2];return Math.abs(B-Y)<=E*Math.max(1,Math.abs(B),Math.abs(Y))&&Math.abs(H-Q)<=E*Math.max(1,Math.abs(H),Math.abs(Q))&&Math.abs($-ie)<=E*Math.max(1,Math.abs($),Math.abs(ie))})(this.pos,t)||s===0)return u[0]=u[1]=u[2]=0,!1;let[h,m,g]=this.dir,v=this.pos[0]-t[0],b=this.pos[1]-t[1],C=this.pos[2]-t[2],T=h*h+m*m+g*g,I=2*(v*h+b*m+C*g),D=I*I-4*T*(v*v+b*b+C*C-s*s);if(D<0){let O=Math.max(-I/2,0),R=v+h*O,B=b+m*O,H=C+g*O,$=Math.hypot(R,B,H);return u[0]=R*s/$,u[1]=B*s/$,u[2]=H*s/$,!1}{let O=(-I-Math.sqrt(D))/(2*T);if(O<0){let R=Math.hypot(v,b,C);return u[0]=v*s/R,u[1]=b*s/R,u[2]=C*s/R,!1}return u[0]=v+h*O,u[1]=b+m*O,u[2]=C+g*O,!0}}}class Tt{constructor(t,s,u,h,m){this.TL=t,this.TR=s,this.BR=u,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(t,s,u){let h=[-1,1,1],m=[1,1,1],g=[1,-1,1],v=[-1,-1,1],b=Fr(h,h,t),C=Fr(m,m,t),T=Fr(g,g,t),I=Fr(v,v,t);return new Tt(b,C,T,I,s/u)}}function Pt(l,t,s){let u=1/0,h=-1/0,m=[];for(let g of l){Br(m,g,t);let v=Ir(m,s);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function Jt(l,t){let s=!0;for(let u=0;u<l.planes.length;u++){let h=l.planes[u],m=0;for(let g=0;g<t.length;g++)m+=+(Ir(h,t[g])+h[3]>=0);if(m===0)return 0;m!==t.length&&(s=!1)}return s?2:1}function fn(l,t){for(let s of l.projections){let u=Pt(t,l.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Fn(l,t){let s=0,u=[0,0,0,0];for(let g=0;g<l.length;g++)u[0]=l[g][0],u[1]=l[g][1],u[2]=l[g][2],u[3]=1,(h=u)[0]*(m=t)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&s++;var h,m;return s}class Jn{constructor(t,s){this.points=t||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=jt.fromPoints(this.points),this.projections=[],this.frustumEdges=[Br([],this.points[2],this.points[3]),Br([],this.points[0],this.points[3]),Br([],this.points[4],this.points[0]),Br([],this.points[5],this.points[1]),Br([],this.points[6],this.points[2]),Br([],this.points[7],this.points[3])];for(let u of this.frustumEdges){let h=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Pt(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:Pt(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(t,s,u,h){let m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{let T=qo([],C,t),I=1/T[3]/s*m;return(D=T)[0]=(O=T)[0]*(R=[I,I,h?1/T[3]:I,I])[0],D[1]=O[1]*R[1],D[2]=O[2]*R[2],D[3]=O[3]*R[3],D;var D,O,R}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{let T=Yi([],Go([],Br([],g[C[0]],g[C[1]]),Br([],g[C[2]],g[C[1]]))),I=-Ir(T,g[C[1]]);return T.concat(I)}),b=[];for(let C=0;C<g.length;C++)b.push([g[C][0],g[C][1],g[C][2]]);return new Jn(b,v)}intersectsPrecise(t,s,u){for(let h=0;h<s.length;h++)if(!Fn(t,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Fn(t,this.planes[h]))return 0;for(let h of u)for(let m of this.frustumEdges){let g=Go([],h,m),v=xo(g);if(v===0)continue;fr(g,g,1/v);let b=Pt(this.points,this.points[0],g),C=Pt(t,this.points[0],g);if(b[0]>C[1]||C[0]>b[1])return 0}return 1}containsPoint(t){for(let s of this.planes){let u=s[3];if(Ir([s[0],s[1],s[2]],t)+u<0)return!1}return!0}}class jt{static fromPoints(t){let s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let h of t)hl(s,s,h),Ua(u,u,h);return new jt(s,u)}static fromTileIdAndHeight(t,s,u){let h=1<<t.canonical.z,m=t.canonical.x,g=t.canonical.y;return new jt([m/h,g/h,s],[(m+1)/h,(g+1)/h,u])}static applyTransform(t,s){let u=t.getCorners();for(let h=0;h<u.length;++h)Fr(u[h],u[h],s);return jt.fromPoints(u)}static applyTransformFast(t,s){let u=[s[12],s[13],s[14]],h=[...u];for(let m=0;m<3;m++)for(let g=0;g<3;g++){let v=s[4*g+m],b=v*t.min[g],C=v*t.max[g];u[m]+=Math.min(b,C),h[m]+=Math.max(b,C)}return new jt(u,h)}static projectAabbCorners(t,s){let u=t.getCorners();for(let h=0;h<u.length;++h)Fr(u[h],u[h],s);return u}constructor(t,s){this.min=t,this.max=s,this.center=fr([],Wr([],this.min,this.max),.5)}quadrant(t){let s=[t%2==0,t<2],u=Bu(this.min),h=Bu(this.max);for(let m=0;m<s.length;m++)u[m]=s[m]?this.min[m]:this.center[m],h[m]=s[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new jt(u,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Jt(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Jt(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,s){return s||this.intersects(t)?fn(t,this.getCorners()):0}intersectsPreciseFlat(t,s){return s||this.intersectsFlat(t)?fn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let s=0;s<3;++s)if(this.min[s]>t.max[s]||t.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t.min[s]),this.max[s]=Math.max(this.max[s],t.max[s])}encapsulatePoint(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t[s]),this.max[s]=Math.max(this.max[s],t[s])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Lt(jt,"Aabb");class Yn{constructor(t,s){this.feature=t,this.metersToTile=s,this.index=0}get(){let t=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],h=-s[0],m=(t.extent+1)*this.metersToTile;return[new ot(Math.trunc(t.position[0]+u*m),Math.trunc(t.position[1]+h*m)),new ot(Math.trunc(t.position[0]-u*m),Math.trunc(t.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class pn{constructor(t,s,u,h,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[bo(),bo(),bo(),bo(),bo(),bo(),bo()],this.id=t,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(C=this.vertices[v.b].position)[0]&&b[1]===C[1]);var b,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let v of this.vertices)this.vertexProps.push({dir:Es(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(let v of this.edges){let b=this.vertices[v.a].position,C=this.vertices[v.b].position,T=pl(bo(),C,b),I=$a(T),D=Zl(bo(),T,1/I);this.edgeProps.push({vec:T,dir:D,len:I});let O=this.vertexProps[v.a].dir,R=this.vertexProps[v.b].dir;$c(O,O,D),$c(R,R,D)}for(let v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||op(v.dir,v.dir);this.tessellate(g)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;let s=this.getClosestEdge(t);if(s==null)return 0;let[u,h]=s;return on(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(t,s){let u=this.getClosestEdge(t);if(!u)return yr(0,0,1);let h=u[0],m=this.edges[h],g=this.edgeProps[h].vec,v=yr(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*s),b=yr(v[1],-v[0],0);Go(b,b,v);let C=xo(b);return C>0?fr(b,b,1/C):Ji(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,h=0,[m,g,v,b,C,T,I]=this._tmpVec2;rp(I,t.x,t.y);let D=new Ut(I,null);for(let O=0;O<this.edges.length;O++){let R=this.edges[O],B=this.edgeProps[O].dir;D.dir=B;let H=this.vertices[R.a].position,$=this.vertices[R.b].position,Y=D.intersectsPlane(H,this.vertexProps[R.a].dir,m),Q=D.intersectsPlane($,this.vertexProps[R.b].dir,g);if(!Y||!Q)continue;pl(v,g,m),pl(b,I,m);let ie=Gu(v,v),he=ie>0?Gu(b,v)/ie:0,le=G(he,0,1),me=Math.abs((he-le)*this.edgeProps[O].len);pl(C,I,H),rp(T,B[1],-B[0]);let ye=me+Math.abs(Gu(C,T));ye<u&&(s=O,u=ye,h=le)}return[s,h]}tessellate(t){let s=ci(),u=ci(),h=ci(),m=ci();for(let g=this.edges.length-1;g>=0;--g){let v=this.edges[g].a,b=this.edges[g].b,{position:C,height:T,extent:I}=this.vertices[v],{position:D,height:O,extent:R}=this.vertices[b],B=this.vertexProps[v].dir,H=this.vertexProps[b].dir;if(Ji(s,C[0]/t,C[1]/t,T),Ji(u,D[0]/t,D[1]/t,O),Ji(h,B[1],-B[0],0),fr(h,h,I),Ji(m,H[1],-H[0],0),fr(m,m,R),this.distSqLines(yr(s[0]+.5*h[0],s[1]+.5*h[1],s[2]+.5*h[2]),yr(u[0]-.5*m[0],u[1]-.5*m[1],u[2]-.5*m[2]),yr(s[0]-.5*h[0],s[1]-.5*h[1],s[2]-.5*h[2]),yr(u[0]+.5*m[0],u[1]+.5*m[1],u[2]+.5*m[2]))<=.0025000000000000005)continue;let $=this.vertices.length,Y=$c(bo(),C,D);this.vertices.push({position:Zl(Y,Y,.5),height:.5*(T+O),extent:.5*(I+R)});let Q=$c(bo(),B,H);this.vertexProps.push({dir:op(Q,Q)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:v,b:$}),this.edges.push({a:$,b});let ie=pl(bo(),this.vertices[$].position,C),he=$a(ie),le={vec:ie,dir:Zl(bo(),ie,1/he),len:he};this.edgeProps.push(le),this.edgeProps.push(le)}}distSqLines(t,s,u,h){let m=dl(ci(),s,t),g=dl(ci(),h,u),v=dl(ci(),t,u),b=Ir(m,m),C=Ir(m,g),T=Ir(m,v),I=Ir(g,g),D=Ir(g,v),O=b*I-C*C;if(O===0)return ip(Vu(m,u,h,Ir(v,g)/Ir(g,g)),t);let R=(b*D-C*T)/O;return ip(Vu(m,t,s,(C*D-T*I)/O),Vu(g,u,h,R))}}class ii{static parseFrom(t,s){let u=pt.parse(t);if(!u)return[];let{vertices:h,features:m}=u,g=1/q(s);m.sort((T,I)=>T.id-I.id),h.sort((T,I)=>T.id-I.id||T.idx-I.idx),h=h.filter((T,I,D)=>I===D.findIndex(O=>O.id===T.id&&O.idx===T.idx));let v=new Array,b=0,C=h.length;for(let T of m){if(T.constantHeight){v.push(new pn(T.id,T.bounds,T.constantHeight));continue}for(;b!==C&&h[b].id<T.id;)b++;if(b===C||h[b].id!==T.id)continue;let I=new Array,D=new Array,O=b;for(;b!==C&&h[b].id===T.id;){let R=h[b];if(I.push({position:R.position,height:R.height,extent:R.extent}),b!==O&&h[b-1].idx===R.idx-1){let B=b-O;D.push({a:B-1,b:B})}b++}v.push(new pn(T.id,T.bounds,void 0,I,D,g))}return v}static getElevationFeature(t,s){if(!s)return;let u=+t.properties[Ge];return Number.isNaN(u)?void 0:s.find(h=>h.id===u)}}class mi{constructor(t,s){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(s)||(this.zScale=Math.pow(2,s.z-t.z),this.xOffset=(t.x*this.zScale-s.x)*vt,this.yOffset=(t.y*this.zScale-s.y)*vt)}constantElevation(t,s){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,s)}pointElevation(t,s,u){let h=this.constantElevation(s,u);return h??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(t),u))}computeBiasedHeight(t,s){return s<=0?t:t+s*K(0,s,t>=0?t:Math.abs(.5*t))}}Lt(pn,"ElevationFeature");class di{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ru,this.indexArray=new Xr,this.segments=new nr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new oc),this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){let m=this.layers[0],g=[],v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(let{feature:C,id:T,index:I,sourceLayerIndex:D}of t){let O=this.layers[0]._featureFilter.needGeometry,R=Te(C,O);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;let B=v?v.evaluate(R,{},u):void 0,H={id:T,properties:C.properties,type:C.type,sourceLayerIndex:D,index:I,geometry:O?R.geometry:_e(C,u,h),patterns:{},sortKey:B};g.push(H)}v&&g.sort((C,T)=>C.sortKey-T.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new ig,b=h.projection);for(let C of g){let{geometry:T,index:I,sourceLayerIndex:D}=C,O=t[I].feature;this.addFeature(C,T,I,s.availableImages,u,b,s.brightness,s.elevationFeatures),s.featureIndex.insert(O,T,I,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,E1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,S1.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,sI.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,s,u,h,m,g,v,b){let C;this.elevationMode!=="none"&&(C=ii.getElevationFeature(t,b));for(let T of s)for(let I of T){let D=I.x,O=I.y;if(D<0||D>=vt||O<0||O>=vt)continue;if(g){let H=g.projectTilePoint(D,O,m),$=g.upVector(m,D,O);this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$)}let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),B=R.vertexLength;if(this.addCircleVertex(D,O,-1,-1),this.addCircleVertex(D,O,1,-1),this.addCircleVertex(D,O,1,1),this.addCircleVertex(D,O,-1,1),this.elevationMode!=="none"){let H=C?C.pointElevation(new ot(D,O)):0;this.hasElevation=this.hasElevation||H!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h,m,v,void 0,this.worldview)}addCircleVertex(t,s,u,h){this.layoutVertexArray.emplaceBack(2*t+(u+1)/2,2*s+(h+1)/2)}addGlobeExtVertex(t,s){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Wn(l,t){for(let s=0;s<l.length;s++)if(Si(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Si(l,t[s]))return!0;return!!Ki(l,t)}function bn(l,t,s){return!!Si(l,t)||!!Hi(t,l,s)}function ti(l,t){if(l.length===1)return ir(t,l[0]);for(let s=0;s<t.length;s++){let u=t[s];for(let h=0;h<u.length;h++)if(Si(l,u[h]))return!0}for(let s=0;s<l.length;s++)if(ir(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Ki(l,t[s]))return!0;return!1}function ur(l,t,s){if(l.length>1){if(Ki(l,t))return!0;for(let u=0;u<t.length;u++)if(Hi(t[u],l,s))return!0}for(let u=0;u<l.length;u++)if(Hi(l[u],t,s))return!0;return!1}function Ki(l,t){if(l.length===0||t.length===0)return!1;for(let s=0;s<l.length-1;s++){let u=l[s],h=l[s+1];for(let m=0;m<t.length-1;m++)if(ri(u,h,t[m],t[m+1]))return!0}return!1}function ri(l,t,s,u){return xn(l,s,u)!==xn(t,s,u)&&xn(l,t,s)!==xn(l,t,u)}function $n(l,t,s){return(l.x-s.x)*(t.y-s.y)-(l.y-s.y)*(t.x-s.x)}function wn(l,t,s,u){let h=$n(l,t,u),m=$n(l,t,s);if(Math.sign(h)===Math.sign(m))return;let g=$n(s,u,l),v=g+m-h;return Math.sign(g)!==Math.sign(v)?[g/(g-v),m/(m-h)]:void 0}function Hi(l,t,s){let u=s*s;if(t.length===1)return l.distSqr(t[0])<u;for(let h=1;h<t.length;h++)if(wr(l,t[h-1],t[h])<u)return!0;return!1}function wr(l,t,s){let u=t.distSqr(s);if(u===0)return l.distSqr(t);let h=((l.x-t.x)*(s.x-t.x)+(l.y-t.y)*(s.y-t.y))/u;return l.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function ir(l,t){let s,u,h,m=!1;for(let g=0;g<l.length;g++){s=l[g];for(let v=0,b=s.length-1;v<s.length;b=v++)u=s[v],h=s[b],u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(m=!m)}return m}function Si(l,t){let s=!1;for(let u=0,h=l.length-1;u<l.length;h=u++){let m=l[u],g=l[h];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(s=!s)}return s}function _s(l,t,s,u,h){for(let g of l)if(t<=g.x&&s<=g.y&&u>=g.x&&h>=g.y)return!0;let m=[new ot(t,s),new ot(t,h),new ot(u,h),new ot(u,s)];if(l.length>2){for(let g of m)if(Si(l,g))return!0}for(let g=0;g<l.length-1;g++)if(Fo(l[g],l[g+1],m))return!0;return!1}function Fo(l,t,s){let u=s[0],h=s[2];if(l.x<u.x&&t.x<u.x||l.x>h.x&&t.x>h.x||l.y<u.y&&t.y<u.y||l.y>h.y&&t.y>h.y)return!1;let m=xn(l,t,s[0]);return m!==xn(l,t,s[1])||m!==xn(l,t,s[2])||m!==xn(l,t,s[3])}function Qr(l,t,s,u,h,m){let g=t.y-l.y,v=l.x-t.x;if(m=m||0){let b=g*g+v*v;if(b===0)return!0;let C=Math.sqrt(b);g/=C,v/=C}return!((s.x-l.x)*g+(s.y-l.y)*v-m<0||(u.x-l.x)*g+(u.y-l.y)*v-m<0||(h.x-l.x)*g+(h.y-l.y)*v-m<0)}function Xo(l,t,s,u,h,m,g){return!(Qr(l,t,u,h,m,g)||Qr(t,s,u,h,m,g)||Qr(s,l,u,h,m,g)||Qr(u,h,l,t,s,g)||Qr(h,m,l,t,s,g)||Qr(m,u,l,t,s,g))}function Ko(l,t,s){let u=t.paint.get(l).value;return u.kind==="constant"?u.value:s.programConfigurations.get(t.id).getMaxValue(l)}function Do(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function na(l,t,s,u,h){if(!t[0]&&!t[1])return l;let m=ot.convert(t)._mult(h);s==="viewport"&&m._rotate(-u);let g=[];for(let v=0;v<l.length;v++)g.push(l[v].sub(m));return g}function Ia(l,t,s,u){let h=ot.convert(l)._mult(u);return t==="viewport"&&h._rotate(-s),h}let As,_r;function Mr(l,t,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[l*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}Lt(di,"CircleBucket",{omit:["layers"]});class Ti{constructor(t,s,u){this.z=t,this.x=s,this.y=u,this.key=rr(0,t,t,s,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){let s=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>s&&t.y===this.y>>s}url(t,s){let u=(function(m,g,v){var b=Mr(256*m,256*(g=Math.pow(2,v)-g-1),v),C=Mr(256*(m+1),256*(g+1),v);return b[0]+","+b[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),h=(function(m,g,v){let b,C="";for(let T=m;T>0;T--)b=1<<T-1,C+=(g&b?1:0)+(v&b?2:0);return C})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lr{constructor(t,s){this.wrap=t,this.canonical=s,this.key=rr(t,s.z,s.z,s.x,s.y)}}class dr{constructor(t,s,u,h,m){this.overscaledZ=t,this.wrap=s,this.canonical=new Ti(u,+h,+m),this.key=s===0&&t===u?this.canonical.key:rr(s,t,u,h,m)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let s=this.canonical.z-t;return t>this.canonical.z?new dr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dr(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return rr(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-t;return rr(this.wrap*+s,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let s=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new dr(s,this.wrap,s,u,h),new dr(s,this.wrap,s,u+1,h),new dr(s,this.wrap,s,u,h+1),new dr(s,this.wrap,s,u+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new dr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rr(l,t,s,u,h){let m=1<<Math.min(s,22),g=m*(h%m)+u%m;return l&&s<22&&(g+=m*m*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*g+s)+(t-s)}let Ma=[l=>{let t=l.canonical.x-1,s=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,s--),new dr(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,s=l.wrap;return t===1<<l.canonical.z&&(t=0,s++),new dr(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>new dr(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new dr(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Lt(Ti,"CanonicalTileID"),Lt(dr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Gp=An([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Qa}=Gp,qp=An([{name:"a_pos_3",components:3,type:"Int16"}]);var mh=An([{name:"a_pos",type:"Int16",components:2}]);function Il(l){return l*Yo/p}let uc=[new jt([Sa,Sa,Sa],[Ta,Ta,Ta]),new jt([Sa,Sa,Sa],[0,0,Ta]),new jt([0,Sa,Sa],[Ta,0,Ta]),new jt([Sa,0,Sa],[0,Ta,Ta]),new jt([0,0,Sa],[Ta,Ta,Ta])];function gh(l,t,s,u=!0){let h=fr([],l._camera.position,l.worldSize),m=[t,s,1,1];qo(m,m,l.pixelMatrixInverse),Uc(m,m,1/m[3]);let g=Yi([],Br([],m,h)),v=l.globeMatrix,b=[v[12],v[13],v[14]],C=Br([],b,h),T=xo(C),I=Yi([],C),D=l.worldSize/(2*Math.PI),O=Ir(I,g),R=Math.asin(D/T);if(R<Math.acos(O)){if(!u)return null;let je=[],Ie=[];fr(je,g,T/O),Yi(Ie,Br(Ie,je,C)),Yi(g,Wr(g,C,fr(g,Ie,Math.tan(R)*T)))}let B=[];new zt(h,g).closestPointOnSphere(b,D,B);let H=Yi([],xr(v,0)),$=Yi([],xr(v,1)),Y=Yi([],xr(v,2)),Q=Ir(H,B),ie=Ir($,B),he=Ir(Y,B),le=os(Math.asin(-ie/D)),me=os(Math.atan2(Q,he));me=l.center.lng+(function(je,Ie){let We=(Ie-je+180)%360-180;return We<-180?We+360:We})(l.center.lng,me);let ye=w(me),we=G(S(le),0,1);return new ee(ye,we)}class lu{constructor(t,s,u){this.a=Br([],t,u),this.b=Br([],s,u),this.center=u;let h=Yi([],this.a),m=Yi([],this.b);this.angle=Math.acos(Ir(h,m))}}function dc(l,t){if(l.angle===0)return null;let s;return s=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:(function(u,h,m,g){let v=Math.sin(m);return u*(Math.sin((1-g)*m)/v)+h*(Math.sin(g*m)/v)})(l.a[t],l.b[t],l.angle,G(s,0,1))+l.center[t]}function Ja(l){if(l.z<=1)return uc[l.z+2*l.y+l.x];let t=_I(T1(l));return jt.fromPoints(t)}function hc(l,t,s){return fr(l,l,1-s),Xs(l,l,t,s)}function CR(l,t,s){for(let u of l)Fr(u,u,t),fr(u,u,s)}function ER(l,t,s,u){let h=t/l.worldSize,m=l.globeMatrix;if(s.z<=1){let we=Ja(s).getCorners();return CR(we,m,h),jt.fromPoints(we)}let g=T1(s,u),v=_I(g,Yo+Il(l._tileCoverLift));CR(v,m,h);let b=Number.MAX_VALUE,C=[-b,-b,-b],T=[b,b,b];if(g.contains(l.center)){for(let Ie of v)hl(T,T,Ie),Ua(C,C,Ie);C[2]=0;let we=l.point,je=[we.x*h,we.y*h,0];return hl(T,T,je),Ua(C,C,je),new jt(T,C)}if(l._tileCoverLift>0){for(let we of v)hl(T,T,we),Ua(C,C,we);return new jt(T,C)}let I=[m[12]*h,m[13]*h,m[14]*h],D=g.getCenter(),O=G(l.center.lat,-N,N),R=G(D.lat,-N,N),B=w(l.center.lng),H=S(O),$=B-w(D.lng),Y=H-S(R);$>.5?$-=1:$<-.5&&($+=1);let Q=0;Math.abs($)>Math.abs(Y)?Q=$>=0?1:3:(Q=Y>=0?0:2,Xs(I,I,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(Zn(Y>=0?g.getSouth():g.getNorth()))*Yo));let ie=v[Q],he=v[(Q+1)%4],le=new lu(ie,he,I),me=[dc(le,0)||ie[0],dc(le,1)||ie[1],dc(le,2)||ie[2]],ye=_h(l.zoom);if(ye>0){let we=(function({x:Ie,y:We,z:Ke},Qe,st,lt,nt){let it=1/(1<<Ke),qe=Ie*it,He=qe+it,rt=We*it,yt=rt+it,ft=0,qt=(qe+He)/2-lt;return qt>.5?ft=-1:qt<-.5&&(ft=1),qe=((qe+ft)*Qe-(lt*=Qe))*st+lt,He=((He+ft)*Qe-lt)*st+lt,rt=(rt*Qe-(nt*=Qe))*st+nt,yt=(yt*Qe-nt)*st+nt,[[qe,yt,0],[He,yt,0],[He,rt,0],[qe,rt,0]]})(s,t,l._pixelsPerMercatorPixel,B,H);for(let Ie=0;Ie<v.length;Ie++)hc(v[Ie],we[Ie],ye);let je=Wr([],we[Q],we[(Q+1)%4]);fr(je,je,.5),hc(me,je,ye)}for(let we of v)hl(T,T,we),Ua(C,C,we);return T[2]=Math.min(ie[2],he[2]),hl(T,T,me),Ua(C,C,me),new jt(T,C)}function T1({x:l,y:t,z:s},u=!1){let h=1/(1<<s),m=new c(A(l*h),t===(1<<s)-1&&u?-90:L((t+1)*h)),g=new c(A((l+1)*h),t===0&&u?90:L(t*h));return new f(m,g)}function _I(l,t=Yo){let s=Zn(l.getNorth()),u=Zn(l.getSouth()),h=Math.cos(s),m=Math.cos(u),g=Math.sin(s),v=Math.sin(u),b=l.getWest(),C=l.getEast();return[md(m,v,b,t),md(m,v,C,t),md(h,g,C,t),md(h,g,b,t)]}function A0(l,t,s,u){let h=1<<s.z,m=(l/vt+s.x)/h;return fh(L((t/vt+s.y)/h),A(m),u)}function I1({min:l,max:t}){return gI/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}let SR=new Float64Array(16);function M1(l){let t=I1(l),s=Or(SR,[t,t,t]);return Xt(s,s,zc([],l.min))}function vI(l){let t=(u=l.min,(s=SR)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;let h=1/I1(l);return Vn(t,t,[h,h,h])}function yI(l){let t=vt/(2*Math.PI);return l/(2*Math.PI)/t}function TR(l,t){return vt/(512*Math.pow(2,l))*I1(Ja(t))}function IR(l,t,s,u,h){let m=yI(s),g=[l,t,-s/(2*Math.PI)],v=ht(new Float64Array(16));return Xt(v,v,g),Vn(v,v,[m,m,m]),sr(v,v,Zn(-h)),$i(v,v,Zn(-u)),v}function _h(l){return K(Ea,xg,l)}function MR(l,t){let s=fh(t.lat,t.lng),u=(function(R){let B=fh(R._center.lat,R._center.lng),H=Go([],yr(0,1,0),B),$=Ho([],-R.angle,B);H=Fr(H,H,$),Ho($,-R._pitch,H);let Y=Yi([],B);return fr(Y,Y,Il(R.cameraToCenterDistance/R.pixelsPerMeter)),Fr(Y,Y,$),Wr([],B,Y)})(l);return g=(h=dl([],u,s))[0],v=h[1],b=h[2],C=(m=s)[0],T=m[1],I=m[2],O=(D=Math.sqrt((g*g+v*v+b*b)*(C*C+T*T+I*I)))&&Ir(h,m)/D,Math.acos(Math.min(Math.max(O,-1),1));var h,m,g,v,b,C,T,I,D,O}function xI(l,t){return MR(l,t)>Math.PI/2*1.01}let DR=Zn(85),y6=Math.cos(DR),x6=Math.sin(DR),b6=$e(),AR=l=>{let t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function PR(l,t,s,u,h,m,g,v,b){if(m&&l.queryGeometry.isAboveHorizon)return!1;m&&(b*=l.pixelToTileUnitsFactor);let C=l.tileID.canonical,T=s.projection.upVectorScale(C,s.center.lat,s.worldSize).metersToTile;for(let I of t)for(let D of I){let O=D.add(v),R=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,B=s.projection.projectTilePoint(O.x,O.y,C);if(R>0){let Q=s.projection.upVector(C,O.x,O.y);B.x+=Q[0]*T*R,B.y+=Q[1]*T*R,B.z+=Q[2]*T*R}let H=m?O:w6(B.x,B.y,B.z,u),$=m?l.tilespaceRays.map(Q=>E6(Q,R)):l.queryGeometry.screenGeometry,Y=qo([],[B.x,B.y,B.z,1],u);if(!g&&m?b*=Y[3]/s.cameraToCenterDistance:g&&!m&&(b*=s.cameraToCenterDistance/Y[3]),m){let Q=L((D.y/vt+C.y)/(1<<C.z));b/=s.projection.pixelsPerMeter(Q,1)/M(1,Q)}if(bn($,H,b))return!0}return!1}function w6(l,t,s,u){let h=qo([],[l,t,s,1],u);return new ot(h[0]/h[3],h[1]/h[3])}let OR=yr(0,0,0),C6=yr(0,0,1);function E6(l,t){let s=ci();return OR[2]=t,l.intersectsPlane(OR,C6,s),new ot(s[0],s[1])}class RR extends di{}let kR,FR,LR,NR;function zR(l,{width:t,height:s},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*s*u);return l.width=t,l.height=s,l.data=h,l}function BR(l,t,s){let{width:u,height:h}=t;u===l.width&&h===l.height||(bI(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,h)},s,null),l.width=u,l.height=h,l.data=t.data)}function bI(l,t,s,u,h,m,g,v){if(h.width===0||h.height===0)return t;if(h.width>l.width||h.height>l.height||s.x>l.width-h.width||s.y>l.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||u.x>t.width-h.width||u.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let b=l.data,C=t.data,T=m===4&&v;for(let I=0;I<h.height;I++){let D=((s.y+I)*l.width+s.x)*m,O=((u.y+I)*t.width+u.x)*m;if(T)for(let R=0;R<h.width;R++){let B=D+R*m+3,H=O+R*m;C[H+0]=255,C[H+1]=255,C[H+2]=255,C[H+3]=b[B]}else if(g)for(let R=0;R<h.width;R++){let B=D+R*m,H=O+R*m,$=new ui(b[B+0]/255,b[B+1]/255,b[B+2]/255,b[B+3]).toNonPremultipliedRenderColor(g).toArray();C[H+0]=$[0],C[H+1]=$[1],C[H+2]=$[2],C[H+3]=$[3]}else for(let R=0;R<h.width*m;R++)C[O+R]=b[D+R]}return t}Lt(RR,"HeatmapBucket",{omit:["layers"]});class vh{constructor(t,s){zR(this,t,1,s)}resize(t){BR(this,new vh(t),1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,h,m){bI(t,s,u,h,m,1,null)}}class Qo{constructor(t,s){zR(this,t,4,s)}resize(t){BR(this,new Qo(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,h,m,g,v){bI(t,s,u,h,m,4,g,v)}}class VR{constructor(t,s){this.width=t.width,this.height=t.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function P0(l){let t={},s=l.resolution||256,u=l.clips?l.clips.length:1,h=l.image||new Qo({width:s,height:u}),m=(g,v,b)=>{t[l.evaluationKey]=b;let C=l.expression.evaluate(t),T=C?C.toNonPremultipliedRenderColor(null):null;T&&(h.data[g+v+0]=Math.floor(255*T.r),h.data[g+v+1]=Math.floor(255*T.g),h.data[g+v+2]=Math.floor(255*T.b),h.data[g+v+3]=Math.floor(255*T.a))};if(l.clips)for(let g=0,v=0;g<u;++g,v+=4*s)for(let b=0,C=0;b<s;b++,C+=4){let T=b/(s-1),{start:I,end:D}=l.clips[g];m(v,C,I*(1-T)+D*T)}else for(let g=0,v=0;g<s;g++,v+=4)m(0,v,g/(s-1));return h}Lt(vh,"AlphaImage"),Lt(Qo,"RGBAImage");let S6=An([{name:"a_pos",components:2,type:"Int16"}],4),T6=An([{name:"a_road_z_offset",components:1,type:"Float32"}],4),I6=An([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),M6=An([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function bg(l,t,s=2){let u=t&&t.length,h=u?t[0]*s:l.length,m=UR(l,0,h,s,!0),g=[];if(!m||m.next===m.prev)return g;let v,b,C;if(u&&(m=(function(T,I,D,O){let R=[];for(let B=0,H=I.length;B<H;B++){let $=UR(T,I[B]*O,B<H-1?I[B+1]*O:T.length,O,!1);$===$.next&&($.steiner=!0),R.push(L6($))}R.sort(R6);for(let B=0;B<R.length;B++)D=k6(R[B],D);return D})(l,t,m,s)),l.length>80*s){v=l[0],b=l[1];let T=v,I=b;for(let D=s;D<h;D+=s){let O=l[D],R=l[D+1];O<v&&(v=O),R<b&&(b=R),O>T&&(T=O),R>I&&(I=R)}C=Math.max(T-v,I-b),C=C!==0?32767/C:0}return O0(m,g,s,v,b,C,0),g}function UR(l,t,s,u,h){let m;if(h===(function(g,v,b,C){let T=0;for(let I=v,D=b-C;I<b;I+=C)T+=(g[D]-g[I])*(g[I+1]+g[D+1]),D=I;return T})(l,t,s,u)>0)for(let g=t;g<s;g+=u)m=GR(g/u|0,l[g],l[g+1],m);else for(let g=s-u;g>=t;g-=u)m=GR(g/u|0,l[g],l[g+1],m);return m&&wg(m,m.next)&&(F0(m),m=m.next),m}function Wp(l,t){if(!l)return l;t||(t=l);let s,u=l;do if(s=!1,u.steiner||!wg(u,u.next)&&Eo(u.prev,u,u.next)!==0)u=u.next;else{if(F0(u),u=t=u.prev,u===u.next)break;s=!0}while(s||u!==t);return t}function O0(l,t,s,u,h,m,g){if(!l)return;!g&&m&&(function(b,C,T,I){let D=b;do D.z===0&&(D.z=wI(D.x,D.y,C,T,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==b);D.prevZ.nextZ=null,D.prevZ=null,(function(O){let R,B=1;do{let H,$=O;O=null;let Y=null;for(R=0;$;){R++;let Q=$,ie=0;for(let le=0;le<B&&(ie++,Q=Q.nextZ,Q);le++);let he=B;for(;ie>0||he>0&&Q;)ie!==0&&(he===0||!Q||$.z<=Q.z)?(H=$,$=$.nextZ,ie--):(H=Q,Q=Q.nextZ,he--),Y?Y.nextZ=H:O=H,H.prevZ=Y,Y=H;$=Q}Y.nextZ=null,B*=2}while(R>1)})(D)})(l,u,h,m);let v=l;for(;l.prev!==l.next;){let b=l.prev,C=l.next;if(m?A6(l,u,h,m):D6(l))t.push(b.i,l.i,C.i),F0(l),l=C.next,v=C.next;else if((l=C)===v){g?g===1?O0(l=P6(Wp(l),t),t,s,u,h,m,2):g===2&&O6(l,t,s,u,h,m):O0(Wp(l),t,s,u,h,m,1);break}}}function D6(l){let t=l.prev,s=l,u=l.next;if(Eo(t,s,u)>=0)return!1;let h=t.x,m=s.x,g=u.x,v=t.y,b=s.y,C=u.y,T=Math.min(h,m,g),I=Math.min(v,b,C),D=Math.max(h,m,g),O=Math.max(v,b,C),R=u.next;for(;R!==t;){if(R.x>=T&&R.x<=D&&R.y>=I&&R.y<=O&&R0(h,v,m,b,g,C,R.x,R.y)&&Eo(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function A6(l,t,s,u){let h=l.prev,m=l,g=l.next;if(Eo(h,m,g)>=0)return!1;let v=h.x,b=m.x,C=g.x,T=h.y,I=m.y,D=g.y,O=Math.min(v,b,C),R=Math.min(T,I,D),B=Math.max(v,b,C),H=Math.max(T,I,D),$=wI(O,R,t,s,u),Y=wI(B,H,t,s,u),Q=l.prevZ,ie=l.nextZ;for(;Q&&Q.z>=$&&ie&&ie.z<=Y;){if(Q.x>=O&&Q.x<=B&&Q.y>=R&&Q.y<=H&&Q!==h&&Q!==g&&R0(v,T,b,I,C,D,Q.x,Q.y)&&Eo(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ie.x>=O&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==h&&ie!==g&&R0(v,T,b,I,C,D,ie.x,ie.y)&&Eo(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;Q&&Q.z>=$;){if(Q.x>=O&&Q.x<=B&&Q.y>=R&&Q.y<=H&&Q!==h&&Q!==g&&R0(v,T,b,I,C,D,Q.x,Q.y)&&Eo(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ie&&ie.z<=Y;){if(ie.x>=O&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==h&&ie!==g&&R0(v,T,b,I,C,D,ie.x,ie.y)&&Eo(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function P6(l,t){let s=l;do{let u=s.prev,h=s.next.next;!wg(u,h)&&$R(u,s,s.next,h)&&k0(u,h)&&k0(h,u)&&(t.push(u.i,s.i,h.i),F0(s),F0(s.next),s=l=h),s=s.next}while(s!==l);return Wp(s)}function O6(l,t,s,u,h,m){let g=l;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&N6(g,v)){let b=HR(g,v);return g=Wp(g,g.next),b=Wp(b,b.next),O0(g,t,s,u,h,m,0),void O0(b,t,s,u,h,m,0)}v=v.next}g=g.next}while(g!==l)}function R6(l,t){let s=l.x-t.x;return s===0&&(s=l.y-t.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(t.next.y-t.y)/(t.next.x-t.x)),s}function k6(l,t){let s=(function(h,m){let g=m,v=h.x,b=h.y,C,T=-1/0;if(wg(h,g))return g;do{if(wg(h,g.next))return g.next;if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){let B=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(B<=v&&B>T&&(T=B,C=g.x<g.next.x?g:g.next,B===v))return C}g=g.next}while(g!==m);if(!C)return null;let I=C,D=C.x,O=C.y,R=1/0;g=C;do{if(v>=g.x&&g.x>=D&&v!==g.x&&jR(b<O?v:T,b,D,O,b<O?T:v,b,g.x,g.y)){let B=Math.abs(b-g.y)/(v-g.x);k0(g,h)&&(B<R||B===R&&(g.x>C.x||g.x===C.x&&F6(C,g)))&&(C=g,R=B)}g=g.next}while(g!==I);return C})(l,t);if(!s)return t;let u=HR(s,l);return Wp(u,u.next),Wp(s,s.next)}function F6(l,t){return Eo(l.prev,l,t.prev)<0&&Eo(t.next,l,l.next)<0}function wI(l,t,s,u,h){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*h|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function L6(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function jR(l,t,s,u,h,m,g,v){return(h-g)*(t-v)>=(l-g)*(m-v)&&(l-g)*(u-v)>=(s-g)*(t-v)&&(s-g)*(m-v)>=(h-g)*(u-v)}function R0(l,t,s,u,h,m,g,v){return!(l===g&&t===v)&&jR(l,t,s,u,h,m,g,v)}function N6(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!(function(s,u){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==u.i&&h.next.i!==u.i&&$R(h,h.next,s,u))return!0;h=h.next}while(h!==s);return!1})(l,t)&&(k0(l,t)&&k0(t,l)&&(function(s,u){let h=s,m=!1,g=(s.x+u.x)/2,v=(s.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==s);return m})(l,t)&&(Eo(l.prev,l,t.prev)||Eo(l,t.prev,t))||wg(l,t)&&Eo(l.prev,l,l.next)>0&&Eo(t.prev,t,t.next)>0)}function Eo(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function wg(l,t){return l.x===t.x&&l.y===t.y}function $R(l,t,s,u){let h=A1(Eo(l,t,s)),m=A1(Eo(l,t,u)),g=A1(Eo(s,u,l)),v=A1(Eo(s,u,t));return h!==m&&g!==v||!(h!==0||!D1(l,s,t))||!(m!==0||!D1(l,u,t))||!(g!==0||!D1(s,l,u))||!(v!==0||!D1(s,t,u))}function D1(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function A1(l){return l>0?1:l<0?-1:0}function k0(l,t){return Eo(l.prev,l,l.next)<0?Eo(l,t,l.next)>=0&&Eo(l,l.prev,t)>=0:Eo(l,t,l.prev)<0||Eo(l,l.next,t)<0}function HR(l,t){let s=CI(l.i,l.x,l.y),u=CI(t.i,t.x,t.y),h=l.next,m=t.prev;return l.next=t,t.prev=l,s.next=h,h.prev=s,u.next=s,s.prev=u,m.next=u,u.prev=m,u}function GR(l,t,s,u){let h=CI(l,t,s);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function F0(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function CI(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function L0(l,t){let s=l.length;if(s<=1)return[l];let u=[],h,m;for(let g=0;g<s;g++){let v=vn(l[g]);v!==0&&(l[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(h&&u.push(h),h=[l[g]]):h.push(l[g]))}if(h&&u.push(h),t>1)for(let g=0;g<u.length;g++)u[g].length<=t||(ym(u[g],t,1,u[g].length-1,z6),u[g]=u[g].slice(0,t));return u}function z6(l,t){return t.area-l.area}function qR(l,t,s=1){if(!l)return null;let u=typeof l=="string"?ps.from(l).getPrimary():l.getPrimary(),h=typeof l=="string"?null:l.getSecondary();for(let m of[u,h]){if(!m)continue;let g=m.id.toString();t.has(g)||t.set(g,[]),m.scaleSelf(s),t.get(g).push(m)}return{primary:u.toString(),secondary:h?h.toString():null}}function EI(l,t,s,u){let h=u.patternDependencies,m=!1;for(let g of t){let v=g.paint.get(`${l}-pattern`);v.isConstant()||(m=!0),qR(v.constantOr(null),h,s)&&(m=!0)}return m}function SI(l,t,s,u,h,m){let g=m.patternDependencies;for(let v of t){let b=v.paint.get(`${l}-pattern`).value;if(b.kind!=="constant"){let C=b.evaluate({zoom:u},s,{},m.availableImages);C=C&&C.name?C.name:C;let T=qR(C,g,h);if(!T)continue;let{primary:I,secondary:D}=T;I&&(s.patterns[v.id]=[I,D].filter(Boolean))}}return s}class WR{constructor(){this.polygons=new Map}add(t,...s){let u=this.polygons.get(t);u?u.push(...s):this.polygons.set(t,s)}merge(t){for(let[s,u]of t.polygons)this.add(s,...u)}}class gd{constructor(){this.portals=[]}static isOnBorder(t,s){return t<=0&&s<=0||t>=vt&&s>=vt}static evaluate(t){if(t.length===0)return new gd;let s=[];for(let b of t)s.push(...b.portals);if(s.length===0)return new gd;for(let b of s){let C=b.va,T=b.vb;(gd.isOnBorder(C.x,T.x)||gd.isOnBorder(C.y,T.y))&&(b.type="border")}let u=s.filter(b=>b.type!=="unevaluated"),h=s.filter(b=>b.type==="unevaluated");if(h.length===0)return new gd;h.sort((b,C)=>b.hash===C.hash?b.isTunnel===C.isTunnel?0:b.isTunnel?-1:1:b.hash<C.hash?1:-1),s=u.concat(h);let m=u.length,g=m,v=m;do if(g++,g===s.length||s[m].hash!==s[g].hash){if(g-m==2){v<m&&(s[v]=s[m],s[m]=null);let b=s[v],C=s[g-1];b.type=b.isTunnel!==C.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:C.connection.a},v++}m=g}while(m!==s.length);return s.splice(v),s.sort((b,C)=>b.hash<C.hash?1:-1),{portals:s}}}Lt(gd,"ElevationPortalGraph"),Lt(WR,"ElevationPolygons");class B6{constructor(t,s,u){this.outPositions=t,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(t,s,u){let h=t[2];u!=null&&(h*=u);let m=`${t[0]},${t[1]},${t[2]},${s[0]},${s[1]},${s[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;let v=this.outPositions.length;this.vertexLookup.set(m,v);let b=Math.trunc(16384*s[0]),C=Math.trunc(16384*s[1]),T=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(t[0],t[1],h),this.outNormals.emplaceBack(b,C,T),v}addTriangle(t,s,u){this.outIndices.emplaceBack(t,s,u)}addTriangles(t,s,u){if(t.length===0)return;let h=u.length===1,m=ci(),g=ci();for(let v=0;v<t.length;v+=3){let b=s[t[v+0]],C=s[t[v+1]],T=s[t[v+2]],I=h?u[0]:u[t[v+1]],D=h?u[0]:u[t[v+2]];Ji(m,b.x,b.y,h?u[0]:u[t[v+0]]);let O=this.addVertex(m,g);Ji(m,C.x,C.y,I);let R=this.addVertex(m,g);Ji(m,T.x,T.y,D);let B=this.addVertex(m,g);this.outIndices.emplaceBack(O,R,B)}}addQuad(t,s,u,h,m,g){let v=this.addVertex(t,m,g),b=this.addVertex(s,m,g),C=this.addVertex(u,m,g),T=this.addVertex(h,m,g);this.addTriangle(v,b,C),this.addTriangle(C,T,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ia{constructor(t,s,u,h){this.unevaluatedPortals=new gd,this.portalPolygons=new WR,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new u0,this.vertexNormals=new d0,this.indexArray=new Xr,this.tileToMeters=q(t),this.bridgeProgramConfigurations=new Ka(s,{zoom:u,lut:h},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ka(s,{zoom:u,lut:h},m=>m!=="fill-bridge-guard-rail-color")}addVertices(t,s){let u=this.unevalVertices.length;for(let h=0;h<t.length;h++)this.unevalVertices.push(t[h]),this.unevalHeights.push(s[h]);return u}addTriangles(t,s,u){let h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(let m of t)h.push(m+s)}addRenderableRing(t,s,u,h,m,g){let v=[new ot(m.min.x,m.min.y),new ot(m.max.x,m.min.y),new ot(m.max.x,m.max.y),new ot(m.min.x,m.max.y)];for(let b=0;b<u-1;b++){let C=s+b,T=C+1,I=this.unevalVertices[C],D=this.unevalVertices[T];if(!(I.x>=m.min.x&&I.x<=m.max.x&&I.y>=m.min.y&&I.y<=m.max.y||D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||Fo(I,D,v))||this.isOnBorder(I.x,D.x)||this.isOnBorder(I.y,D.y))continue;let O=ia.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[T]),R,B=this.vertexHashLookup.get(ia.computePosHash(I));B!=null?R=B.next:(B=this.vertexHashLookup.get(ia.computePosHash(D)),R=B!=null?B.prev:O),this.unevalEdges.push({polygonIdx:t,a:C,b:T,hash:O,portalHash:R,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(t,s,u,h,m){if(s.length===0)return;this.portalPolygons.add(t,{geometry:s,zLevel:m});let g=s[0];this.vertexHashLookup.clear();let v=ia.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let b=0;b<g.length-1;b++){let C=g[b+0],T=g[b+1],I=Es(T.x-C.x,T.y-C.y),D=$a(I);if(D===0)continue;let O="unevaluated",R=h.pointElevation(C),B=h.pointElevation(T);Math.abs(R)<.01&&Math.abs(B)<.01?O="entrance":(this.isOnBorder(C.x,T.x)||this.isOnBorder(C.y,T.y))&&(O="border");let H=ia.computeEdgeHash(C,T);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:C,vb:T,vab:I,length:D,hash:H,isTunnel:u,type:O});let $=ia.computePosHash(C);this.vertexHashLookup.set($,{prev:v,next:H}),v=H}}construct(t){if(this.unevalVertices.length===0)return;let s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},h=new B6(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);let m=s(),g=s(),v=s(),b=(D,O)=>{D.sort((B,H)=>B.type===O&&H.type!==O?-1:B.type!==O&&H.type===O?1:0);let R=D.findIndex(B=>B.type!==O);return R>=0?R:D.length},C=0;this.unevalEdges.length>0&&(C=b(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),u(v);let T=s(),I=s();if(this.unevalEdges.length>0){let D=this.unevalEdges.splice(C),O=b(D,"tunnel")+C;this.unevalEdges.push(...D),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:O})}u(T),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(I),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(m),this.maskSegments=nr.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.depthSegments=nr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=nr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=nr.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.shadowCasterSegments=nr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(t,s,u,h,m,g,v,b){this.bridgeProgramConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b),this.tunnelProgramConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,I6.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,M6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,s,u,h,m){let g=(v,b)=>{for(let C=0;C<b.length-1;C++){let T=b[C].featureIndex,I=b[C+1].vertexStart,D=t.feature(T);v.populatePaintArrays(I,D,T,{},u,s,h,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,s,u,h,m){let g=new Map;for(let v=h;v<m;v++){let b=u[v],C=b.a,T=b.b,I=ia.computePosHash(t[C]),D=ia.computePosHash(t[T]),O=g.get(I);O||(O={},g.set(I,O));let R=g.get(D);R||(R={},g.set(D,R)),s[C]<=0&&s[T]<=0||(O.to=T,R.from=C)}return g}isTerminalVertex(t,s){let u=ia.computePosHash(this.unevalVertices[t]),h=s.get(u);return!h||!h.from||!h.to}constructBridgeStructures(t,s,u,h,m,g){t.clearVertexLookup();let v=this.computeVertexConnections(s,u,h,m.min,m.max),b=1/g,C=.5*b,T=(st,lt)=>Ji(st,s[lt].x,s[lt].y,u[lt]*b),I=ci(),D=ci(),O=ci(),R=ci(),B=ci(),H=(st,lt)=>{let nt=v.get(ia.computePosHash(s[lt])),it=nt.from,qe=nt.to;if(!it||!qe)return;T(I,it),T(D,lt),T(O,qe),zs(R),rs(I,D)||(Br(B,D,I),Yi(R,B)),rs(O,D)||(Br(B,O,D),Wr(R,R,Yi(B,B)));let He=Ud(R);return He>0?fr(st,R,1/He):void 0},$=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,(st,lt)=>st.featureInfo.featureIndex-lt.featureInfo.featureIndex);let Y=ci(),Q=ci(),ie=ci(),he=ci(),le=ci(),me=ci(),ye=ci(),we=ci(),je=ci(),Ie=[ci(),ci(),ci(),ci()],We=[ci(),ci(),ci(),ci()],Ke=[{coord:new ot(0,0),height:0},{coord:new ot(0,0),height:0}],Qe=(st,lt)=>st>lt;for(let st=m.min;st<m.max;st++){let lt=h[st];if(!lt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ke,s,u,lt,Qe))continue;let[nt,it]=Ke;if(Ji(Y,nt.coord.x,nt.coord.y,b*nt.height),Ji(Q,it.coord.x,it.coord.y,b*it.height),rs(Y,Q))continue;Br(ie,Q,Y),Yi(ie,ie);let qe=H(we,lt.a)||ie,He=H(je,lt.b)||ie;Ji(he,qe[1],-qe[0],0),Yi(he,he),Ji(le,He[1],-He[0],0),Yi(le,le),Go(we,he,qe),Yi(me,we),Go(we,le,He),Yi(ye,we),Wr(Ie[0],Y,fr(we,Br(we,he,me),C)),Wr(Ie[1],Y,fr(we,Wr(we,he,me),C)),Wr(Ie[2],Y,fr(we,me,C)),Ie[3]=Y,Wr(We[0],Q,fr(we,Br(we,le,ye),C)),Wr(We[1],Q,fr(we,Wr(we,le,ye),C)),Wr(We[2],Q,fr(we,ye,C)),We[3]=Q,$=this.addFeatureSection(lt.featureInfo.featureIndex,$,this.bridgeFeatureSections,t);let rt=t.addVertex(Ie[0],he,g),yt=t.addVertex(Ie[1],he,g),ft=t.addVertex(We[0],le,g),qt=t.addVertex(We[1],le,g);t.addTriangle(rt,yt,ft),t.addTriangle(yt,qt,ft);let It=t.addVertex(Ie[1],me,g),Ot=t.addVertex(Ie[2],me,g),Bt=t.addVertex(We[1],ye,g),In=t.addVertex(We[2],ye,g);t.addTriangle(It,Ot,Bt),t.addTriangle(Ot,In,Bt),zc(he,he),zc(le,le);let mt=t.addVertex(Ie[2],he,g),Vt=t.addVertex(Ie[3],he,g),un=t.addVertex(We[2],le,g),Ln=t.addVertex(We[3],le,g);t.addTriangle(mt,Vt,un),t.addTriangle(Vt,Ln,un);let zn=this.isTerminalVertex(lt.a,v),_n=this.isTerminalVertex(lt.b,v);nt.height<.01&&zn&&t.addQuad(Ie[3],Ie[2],Ie[1],Ie[0],zc(qe,qe),g),it.height<.01&&_n&&t.addQuad(We[0],We[1],We[2],We[3],He,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,s,u,h,m,g){t.clearVertexLookup();let v=Number.POSITIVE_INFINITY,b=($,Y)=>$.featureInfo.featureIndex-Y.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,b),this.sortSubarray(h,g.min,g.max,b);let C=$=>Yi($,$),T=[{coord:new ot(0,0),height:0},{coord:new ot(0,0),height:0}],I=($,Y)=>$<Y,D=ci(),O=ci(),R=ci(),B=ci(),H=ci();for(let $=m.min;$<m.max;$++){if(!this.prepareEdgePoints(T,s,u,h[$],I))continue;let[Y,Q]=T,ie=C(Ji(H,-(Q.coord.y-Y.coord.y),Q.coord.x-Y.coord.x,0));v=this.addFeatureSection(h[$].featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Ji(D,Y.coord.x,Y.coord.y,Y.height),Ji(O,Q.coord.x,Q.coord.y,Q.height),Ji(R,Q.coord.x,Q.coord.y,h[$].isTunnel?-.1:0),Ji(B,Y.coord.x,Y.coord.y,h[$].isTunnel?-.1:0),ie)}for(let $=g.min;$<g.max;$++){let Y=h[$];Y.isTunnel&&([Y.a,Y.b]=[Y.b,Y.a]);let Q=s[Y.a],ie=s[Y.b],he=C(Ji(H,-(ie.y-Q.y),ie.x-Q.x,0));v=this.addFeatureSection(Y.featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Ji(D,ie.x,ie.y,0),Ji(O,Q.x,Q.y,0),Ji(R,Q.x,Q.y,u[Y.a]+4),Ji(B,ie.x,ie.y,u[Y.b]+4),he),t.addQuad(Ji(D,Q.x,Q.y,0),Ji(O,ie.x,ie.y,0),Ji(R,ie.x,ie.y,u[Y.b]+4),Ji(B,Q.x,Q.y,u[Y.a]+4),he)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,s,u,h){t.coord.x=s,t.coord.y=u,t.height=h}prepareEdgePoints(t,s,u,h,m){let g=s[h.a].x,v=s[h.a].y,b=s[h.b].x,C=s[h.b].y,T=u[h.a],I=u[h.b],D=m(T,0),O=m(I,0);if(D&&O)return this.setElevatedPoint(t[0],g,v,T),this.setElevatedPoint(t[1],b,C,I),!0;if(!D&&!O)return!1;if(D){if(!O){let R=I/(I-T);b=on(b,g,R),C=on(C,v,R),I=on(I,T,R)}}else{let R=T/(T-I);g=on(g,b,R),v=on(v,C,R),T=on(T,I,R)}return this.setElevatedPoint(t[0],g,v,T),this.setElevatedPoint(t[1],b,C,I),!0}prepareEdges(t,s){if(s.length===0)return;s.sort((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1);let u=0,h=0,m=0,g=s[u].polygonIdx;do h++,(h===s.length||s[u].hash!==s[h].hash)&&((h-u==1||s[h-1].polygonIdx!==g)&&(m<u&&(s[m]=s[u],s[u]=null),s[m].type="none",m++),u=h,u!==s.length&&(g=s[u].polygonIdx));while(u!==s.length);if(s.splice(m),s.length!==0&&t.length!==0){s.sort((C,T)=>C.portalHash<T.portalHash?1:-1);let v=0,b=0;for(;v!==s.length&&b!==t.length;){let C=s[v],T=t[b];C.portalHash>T.hash?v++:T.hash>C.portalHash?b++:(C.type=T.type,v++)}}}isOnBorder(t,s){return t<=0&&s<=0||t>=vt&&s>=vt}addFeatureSection(t,s,u,h){return t!==s&&(s=t,u.push({featureIndex:t,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),s}sortSubarray(t,s,u,h){let m=t.slice(s,u);m.sort(h),t.splice(s,m.length,...m)}static computeEdgeHash(t,s){return(t.y===s.y&&t.x>s.x||t.y>s.y)&&([t,s]=[s,t]),BigInt(ia.computePosHash(t))<<32n|BigInt(ia.computePosHash(s))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var ZR,YR={exports:{}},XR=(ZR||(ZR=1,(function(l){function t(ce,pe){return ce>pe?1:ce<pe?-1:0}var s=function(ce,pe){ce===void 0&&(ce=t),pe===void 0&&(pe=!1),this._compare=ce,this._root=null,this._size=0,this._noDuplicates=!!pe},u={size:{configurable:!0}};function h(ce,pe,Ze,at,Et){var St=Et-at;if(St>0){var Wt=at+Math.floor(St/2),Yt={key:pe[Wt],data:Ze[Wt],parent:ce};return Yt.left=h(Yt,pe,Ze,at,Wt),Yt.right=h(Yt,pe,Ze,Wt+1,Et),Yt}return null}function m(ce,pe,Ze,at,Et){if(!(Ze>=at)){for(var St=ce[Ze+at>>1],Wt=Ze-1,Yt=at+1;;){do Wt++;while(Et(ce[Wt],St)<0);do Yt--;while(Et(ce[Yt],St)>0);if(Wt>=Yt)break;var mn=ce[Wt];ce[Wt]=ce[Yt],ce[Yt]=mn,mn=pe[Wt],pe[Wt]=pe[Yt],pe[Yt]=mn}m(ce,pe,Ze,Yt,Et),m(ce,pe,Yt+1,at,Et)}}s.prototype.rotateLeft=function(ce){var pe=ce.right;pe&&(ce.right=pe.left,pe.left&&(pe.left.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.left=ce),ce.parent=pe},s.prototype.rotateRight=function(ce){var pe=ce.left;pe&&(ce.left=pe.right,pe.right&&(pe.right.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.right=ce),ce.parent=pe},s.prototype._splay=function(ce){for(;ce.parent;){var pe=ce.parent;pe.parent?pe.left===ce&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===ce&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===ce&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===ce?this.rotateRight(pe):this.rotateLeft(pe)}},s.prototype.splay=function(ce){for(var pe,Ze,at,Et,St;ce.parent;)(Ze=(pe=ce.parent).parent)&&Ze.parent?((at=Ze.parent).left===Ze?at.left=ce:at.right=ce,ce.parent=at):(ce.parent=null,this._root=ce),Et=ce.left,St=ce.right,ce===pe.left?(Ze&&(Ze.left===pe?(pe.right?(Ze.left=pe.right,Ze.left.parent=Ze):Ze.left=null,pe.right=Ze,Ze.parent=pe):(Et?(Ze.right=Et,Et.parent=Ze):Ze.right=null,ce.left=Ze,Ze.parent=ce)),St?(pe.left=St,St.parent=pe):pe.left=null,ce.right=pe,pe.parent=ce):(Ze&&(Ze.right===pe?(pe.left?(Ze.right=pe.left,Ze.right.parent=Ze):Ze.right=null,pe.left=Ze,Ze.parent=pe):(St?(Ze.left=St,St.parent=Ze):Ze.left=null,ce.right=Ze,Ze.parent=ce)),Et?(pe.right=Et,Et.parent=pe):pe.right=null,ce.left=pe,pe.parent=ce)},s.prototype.replace=function(ce,pe){ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.parent=ce.parent)},s.prototype.minNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.left;)ce=ce.left;return ce},s.prototype.maxNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.right;)ce=ce.right;return ce},s.prototype.insert=function(ce,pe){var Ze=this._root,at=null,Et=this._compare;if(this._noDuplicates)for(;Ze;){if(at=Ze,Et(Ze.key,ce)===0)return;Ze=Et(Ze.key,ce)<0?Ze.right:Ze.left}else for(;Ze;)at=Ze,Ze=Et(Ze.key,ce)<0?Ze.right:Ze.left;return Ze={key:ce,data:pe,left:null,right:null,parent:at},at?Et(at.key,Ze.key)<0?at.right=Ze:at.left=Ze:this._root=Ze,this.splay(Ze),this._size++,Ze},s.prototype.find=function(ce){for(var pe=this._root,Ze=this._compare;pe;){var at=Ze(pe.key,ce);if(at<0)pe=pe.right;else{if(!(at>0))return pe;pe=pe.left}}return null},s.prototype.contains=function(ce){for(var pe=this._root,Ze=this._compare;pe;){var at=Ze(ce,pe.key);if(at===0)return!0;pe=at<0?pe.left:pe.right}return!1},s.prototype.remove=function(ce){var pe=this.find(ce);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var Ze=this.minNode(pe.right);Ze.parent!==pe&&(this.replace(Ze,Ze.right),Ze.right=pe.right,Ze.right.parent=Ze),this.replace(pe,Ze),Ze.left=pe.left,Ze.left.parent=Ze}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},s.prototype.removeNode=function(ce){if(!ce)return!1;if(this.splay(ce),ce.left)if(ce.right){var pe=this.minNode(ce.right);pe.parent!==ce&&(this.replace(pe,pe.right),pe.right=ce.right,pe.right.parent=pe),this.replace(ce,pe),pe.left=ce.left,pe.left.parent=pe}else this.replace(ce,ce.left);else this.replace(ce,ce.right);return this._size--,!0},s.prototype.erase=function(ce){var pe=this.find(ce);if(pe){this.splay(pe);var Ze=pe.left,at=pe.right,Et=null;Ze&&(Ze.parent=null,Et=this.maxNode(Ze),this.splay(Et),this._root=Et),at&&(Ze?Et.right=at:this._root=at,at.parent=Et),this._size--}},s.prototype.pop=function(){var ce=this._root,pe=null;if(ce){for(;ce.left;)ce=ce.left;pe={key:ce.key,data:ce.data},this.remove(ce.key)}return pe},s.prototype.next=function(ce){var pe=ce;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=ce.parent;pe&&pe.right===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.prev=function(ce){var pe=ce;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=ce.parent;pe&&pe.left===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.forEach=function(ce){for(var pe=this._root,Ze=[],at=!1,Et=0;!at;)pe?(Ze.push(pe),pe=pe.left):Ze.length>0?(ce(pe=Ze.pop(),Et++),pe=pe.right):at=!0;return this},s.prototype.range=function(ce,pe,Ze,at){for(var Et=[],St=this._compare,Wt=this._root;Et.length!==0||Wt;)if(Wt)Et.push(Wt),Wt=Wt.left;else{if(St((Wt=Et.pop()).key,pe)>0)break;if(St(Wt.key,ce)>=0&&Ze.call(at,Wt))return this;Wt=Wt.right}return this},s.prototype.keys=function(){for(var ce=this._root,pe=[],Ze=[],at=!1;!at;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),Ze.push(ce.key),ce=ce.right):at=!0;return Ze},s.prototype.values=function(){for(var ce=this._root,pe=[],Ze=[],at=!1;!at;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),Ze.push(ce.data),ce=ce.right):at=!0;return Ze},s.prototype.at=function(ce){for(var pe=this._root,Ze=[],at=!1,Et=0;!at;)if(pe)Ze.push(pe),pe=pe.left;else if(Ze.length>0){if(pe=Ze.pop(),Et===ce)return pe;Et++,pe=pe.right}else at=!0;return null},s.prototype.load=function(ce,pe,Ze){if(ce===void 0&&(ce=[]),pe===void 0&&(pe=[]),Ze===void 0&&(Ze=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var at=ce.length;return Ze&&m(ce,pe,0,at-1,this._compare),this._root=h(null,ce,pe,0,at),this._size=at,this},s.prototype.min=function(){var ce=this.minNode(this._root);return ce?ce.key:null},s.prototype.max=function(){var ce=this.maxNode(this._root);return ce?ce.key:null},s.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},s.createTree=function(ce,pe,Ze,at,Et){return new s(Ze,Et).load(ce,pe,at)},Object.defineProperties(s.prototype,u);var g=0,v=1,b=2,C=3,T=0,I=1,D=2,O=3;function R(ce,pe,Ze){pe===null?(ce.inOut=!1,ce.otherInOut=!0):(ce.isSubject===pe.isSubject?(ce.inOut=!pe.inOut,ce.otherInOut=pe.otherInOut):(ce.inOut=!pe.otherInOut,ce.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(ce.prevInResult=!B(pe,Ze)||pe.isVertical()?pe.prevInResult:pe));var at=B(ce,Ze);ce.resultTransition=at?(function(Et,St){var Wt,Yt=!Et.inOut,mn=!Et.otherInOut;switch(St){case T:Wt=Yt&&mn;break;case I:Wt=Yt||mn;break;case O:Wt=Yt^mn;break;case D:Wt=Et.isSubject?Yt&&!mn:mn&&!Yt}return Wt?1:-1})(ce,Ze):0}function B(ce,pe){switch(ce.type){case g:switch(pe){case T:return!ce.otherInOut;case I:return ce.otherInOut;case D:return ce.isSubject&&ce.otherInOut||!ce.isSubject&&!ce.otherInOut;case O:return!0}break;case b:return pe===T||pe===I;case C:return pe===D;case v:return!1}return!1}var H=function(ce,pe,Ze,at,Et){this.left=pe,this.point=ce,this.otherEvent=Ze,this.isSubject=at,this.type=Et||g,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},$={inResult:{configurable:!0}};function Y(ce,pe){return ce[0]===pe[0]&&ce[1]===pe[1]}H.prototype.isBelow=function(ce){var pe=this.point,Ze=this.otherEvent.point;return this.left?(pe[0]-ce[0])*(Ze[1]-ce[1])-(Ze[0]-ce[0])*(pe[1]-ce[1])>0:(Ze[0]-ce[0])*(pe[1]-ce[1])-(pe[0]-ce[0])*(Ze[1]-ce[1])>0},H.prototype.isAbove=function(ce){return!this.isBelow(ce)},H.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},$.inResult.get=function(){return this.resultTransition!==0},H.prototype.clone=function(){var ce=new H(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ce.contourId=this.contourId,ce.resultTransition=this.resultTransition,ce.prevInResult=this.prevInResult,ce.isExteriorRing=this.isExteriorRing,ce.inOut=this.inOut,ce.otherInOut=this.otherInOut,ce},Object.defineProperties(H.prototype,$);var Q=11102230246251565e-32,ie=134217729,he=(3+8*Q)*Q;function le(ce,pe,Ze,at,Et){var St,Wt,Yt,mn,Cn=pe[0],Tn=at[0],Pn=0,rn=0;Tn>Cn==Tn>-Cn?(St=Cn,Cn=pe[++Pn]):(St=Tn,Tn=at[++rn]);var cn=0;if(Pn<ce&&rn<Ze)for(Tn>Cn==Tn>-Cn?(Yt=St-((Wt=Cn+St)-Cn),Cn=pe[++Pn]):(Yt=St-((Wt=Tn+St)-Tn),Tn=at[++rn]),St=Wt,Yt!==0&&(Et[cn++]=Yt);Pn<ce&&rn<Ze;)Tn>Cn==Tn>-Cn?(Yt=St-((Wt=St+Cn)-(mn=Wt-St))+(Cn-mn),Cn=pe[++Pn]):(Yt=St-((Wt=St+Tn)-(mn=Wt-St))+(Tn-mn),Tn=at[++rn]),St=Wt,Yt!==0&&(Et[cn++]=Yt);for(;Pn<ce;)Yt=St-((Wt=St+Cn)-(mn=Wt-St))+(Cn-mn),Cn=pe[++Pn],St=Wt,Yt!==0&&(Et[cn++]=Yt);for(;rn<Ze;)Yt=St-((Wt=St+Tn)-(mn=Wt-St))+(Tn-mn),Tn=at[++rn],St=Wt,Yt!==0&&(Et[cn++]=Yt);return St===0&&cn!==0||(Et[cn++]=St),cn}function me(ce){return new Float64Array(ce)}var ye=33306690738754716e-32,we=22204460492503146e-32,je=11093356479670487e-47,Ie=me(4),We=me(8),Ke=me(12),Qe=me(16),st=me(4);function lt(ce,pe,Ze){var at=(function(Et,St,Wt,Yt,mn,Cn){var Tn=(St-Cn)*(Wt-mn),Pn=(Et-mn)*(Yt-Cn),rn=Tn-Pn;if(Tn===0||Pn===0||Tn>0!=Pn>0)return rn;var cn=Math.abs(Tn+Pn);return Math.abs(rn)>=ye*cn?rn:-(function(Hn,Xn,Kn,hi,Ii,_i,ei){var oi,En,Nn,tr,tn,On,bi,Oi,Ui,Dr,Ni,nn,or,pi,Qi,Jr,mo,jr,$r=Hn-Ii,ao=Kn-Ii,Ps=Xn-_i,zi=hi-_i;Ie[0]=(Qi=(Oi=$r-(bi=(On=ie*$r)-(On-$r)))*(Dr=zi-(Ui=(On=ie*zi)-(On-zi)))-((pi=$r*zi)-bi*Ui-Oi*Ui-bi*Dr))-((Ni=Qi-(mo=(Oi=Ps-(bi=(On=ie*Ps)-(On-Ps)))*(Dr=ao-(Ui=(On=ie*ao)-(On-ao)))-((Jr=Ps*ao)-bi*Ui-Oi*Ui-bi*Dr)))+(tn=Qi-Ni))+(tn-mo),Ie[1]=(or=pi-((nn=pi+Ni)-(tn=nn-pi))+(Ni-tn))-((Ni=or-Jr)+(tn=or-Ni))+(tn-Jr),Ie[2]=nn-((jr=nn+Ni)-(tn=jr-nn))+(Ni-tn),Ie[3]=jr;var Cr=(function(du,Lo){for(var vs=Lo[0],oa=1;oa<4;oa++)vs+=Lo[oa];return vs})(0,Ie),Ar=we*ei;if(Cr>=Ar||-Cr>=Ar||(oi=Hn-($r+(tn=Hn-$r))+(tn-Ii),Nn=Kn-(ao+(tn=Kn-ao))+(tn-Ii),En=Xn-(Ps+(tn=Xn-Ps))+(tn-_i),tr=hi-(zi+(tn=hi-zi))+(tn-_i),oi===0&&En===0&&Nn===0&&tr===0)||(Ar=je*ei+he*Math.abs(Cr),(Cr+=$r*tr+zi*oi-(Ps*Nn+ao*En))>=Ar||-Cr>=Ar))return Cr;st[0]=(Qi=(Oi=oi-(bi=(On=ie*oi)-(On-oi)))*(Dr=zi-(Ui=(On=ie*zi)-(On-zi)))-((pi=oi*zi)-bi*Ui-Oi*Ui-bi*Dr))-((Ni=Qi-(mo=(Oi=En-(bi=(On=ie*En)-(On-En)))*(Dr=ao-(Ui=(On=ie*ao)-(On-ao)))-((Jr=En*ao)-bi*Ui-Oi*Ui-bi*Dr)))+(tn=Qi-Ni))+(tn-mo),st[1]=(or=pi-((nn=pi+Ni)-(tn=nn-pi))+(Ni-tn))-((Ni=or-Jr)+(tn=or-Ni))+(tn-Jr),st[2]=nn-((jr=nn+Ni)-(tn=jr-nn))+(Ni-tn),st[3]=jr;var Us=le(4,Ie,4,st,We);st[0]=(Qi=(Oi=$r-(bi=(On=ie*$r)-(On-$r)))*(Dr=tr-(Ui=(On=ie*tr)-(On-tr)))-((pi=$r*tr)-bi*Ui-Oi*Ui-bi*Dr))-((Ni=Qi-(mo=(Oi=Ps-(bi=(On=ie*Ps)-(On-Ps)))*(Dr=Nn-(Ui=(On=ie*Nn)-(On-Nn)))-((Jr=Ps*Nn)-bi*Ui-Oi*Ui-bi*Dr)))+(tn=Qi-Ni))+(tn-mo),st[1]=(or=pi-((nn=pi+Ni)-(tn=nn-pi))+(Ni-tn))-((Ni=or-Jr)+(tn=or-Ni))+(tn-Jr),st[2]=nn-((jr=nn+Ni)-(tn=jr-nn))+(Ni-tn),st[3]=jr;var eo=le(Us,We,4,st,Ke);st[0]=(Qi=(Oi=oi-(bi=(On=ie*oi)-(On-oi)))*(Dr=tr-(Ui=(On=ie*tr)-(On-tr)))-((pi=oi*tr)-bi*Ui-Oi*Ui-bi*Dr))-((Ni=Qi-(mo=(Oi=En-(bi=(On=ie*En)-(On-En)))*(Dr=Nn-(Ui=(On=ie*Nn)-(On-Nn)))-((Jr=En*Nn)-bi*Ui-Oi*Ui-bi*Dr)))+(tn=Qi-Ni))+(tn-mo),st[1]=(or=pi-((nn=pi+Ni)-(tn=nn-pi))+(Ni-tn))-((Ni=or-Jr)+(tn=or-Ni))+(tn-Jr),st[2]=nn-((jr=nn+Ni)-(tn=jr-nn))+(Ni-tn),st[3]=jr;var Dl=le(eo,Ke,4,st,Qe);return Qe[Dl-1]})(Et,St,Wt,Yt,mn,Cn,cn)})(ce[0],ce[1],pe[0],pe[1],Ze[0],Ze[1]);return at>0?-1:at<0?1:0}function nt(ce,pe){var Ze=ce.point,at=pe.point;return Ze[0]>at[0]?1:Ze[0]<at[0]?-1:Ze[1]!==at[1]?Ze[1]>at[1]?1:-1:(function(Et,St,Wt,Yt){return Et.left!==St.left?Et.left?1:-1:lt(Wt,Et.otherEvent.point,St.otherEvent.point)!==0?Et.isBelow(St.otherEvent.point)?-1:1:!Et.isSubject&&St.isSubject?1:-1})(ce,pe,Ze)}function it(ce,pe,Ze){var at=new H(pe,!1,ce,ce.isSubject),Et=new H(pe,!0,ce.otherEvent,ce.isSubject);return Y(ce.point,ce.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ce),at.contourId=Et.contourId=ce.contourId,nt(Et,ce.otherEvent)>0&&(ce.otherEvent.left=!0,Et.left=!1),ce.otherEvent.otherEvent=Et,ce.otherEvent=at,Ze.push(Et),Ze.push(at),Ze}function qe(ce,pe){return ce[0]*pe[1]-ce[1]*pe[0]}function He(ce,pe){return ce[0]*pe[0]+ce[1]*pe[1]}function rt(ce,pe,Ze){var at=(function(mn,Cn,Tn,Pn,rn){var cn=[Cn[0]-mn[0],Cn[1]-mn[1]],Hn=[Pn[0]-Tn[0],Pn[1]-Tn[1]];function Xn(On,bi,Oi){return[On[0]+bi*Oi[0],On[1]+bi*Oi[1]]}var Kn=[Tn[0]-mn[0],Tn[1]-mn[1]],hi=qe(cn,Hn),Ii=hi*hi,_i=He(cn,cn);if(Ii>0){var ei=qe(Kn,Hn)/hi;if(ei<0||ei>1)return null;var oi=qe(Kn,cn)/hi;return oi<0||oi>1?null:ei===0||ei===1?[Xn(mn,ei,cn)]:oi===0||oi===1?[Xn(Tn,oi,Hn)]:[Xn(mn,ei,cn)]}if((Ii=(hi=qe(Kn,cn))*hi)>0)return null;var En=He(cn,Kn)/_i,Nn=En+He(cn,Hn)/_i,tr=Math.min(En,Nn),tn=Math.max(En,Nn);return tr<=1&&tn>=0?tr===1?[Xn(mn,tr>0?tr:0,cn)]:tn===0?[Xn(mn,tn<1?tn:1,cn)]:[Xn(mn,tr>0?tr:0,cn),Xn(mn,tn<1?tn:1,cn)]:null})(ce.point,ce.otherEvent.point,pe.point,pe.otherEvent.point),Et=at?at.length:0;if(Et===0||Et===1&&(Y(ce.point,pe.point)||Y(ce.otherEvent.point,pe.otherEvent.point))||Et===2&&ce.isSubject===pe.isSubject)return 0;if(Et===1)return Y(ce.point,at[0])||Y(ce.otherEvent.point,at[0])||it(ce,at[0],Ze),Y(pe.point,at[0])||Y(pe.otherEvent.point,at[0])||it(pe,at[0],Ze),1;var St=[],Wt=!1,Yt=!1;return Y(ce.point,pe.point)?Wt=!0:nt(ce,pe)===1?St.push(pe,ce):St.push(ce,pe),Y(ce.otherEvent.point,pe.otherEvent.point)?Yt=!0:nt(ce.otherEvent,pe.otherEvent)===1?St.push(pe.otherEvent,ce.otherEvent):St.push(ce.otherEvent,pe.otherEvent),Wt&&Yt||Wt?(pe.type=v,ce.type=pe.inOut===ce.inOut?b:C,Wt&&!Yt&&it(St[1].otherEvent,St[0].point,Ze),2):Yt?(it(St[0],St[1].point,Ze),3):St[0]!==St[3].otherEvent?(it(St[0],St[1].point,Ze),it(St[1],St[2].point,Ze),3):(it(St[0],St[1].point,Ze),it(St[3].otherEvent,St[2].point,Ze),3)}function yt(ce,pe){if(ce===pe)return 0;if(lt(ce.point,ce.otherEvent.point,pe.point)!==0||lt(ce.point,ce.otherEvent.point,pe.otherEvent.point)!==0)return Y(ce.point,pe.point)?ce.isBelow(pe.otherEvent.point)?-1:1:ce.point[0]===pe.point[0]?ce.point[1]<pe.point[1]?-1:1:nt(ce,pe)===1?pe.isAbove(ce.point)?-1:1:ce.isBelow(pe.point)?-1:1;if(ce.isSubject!==pe.isSubject)return ce.isSubject?-1:1;var Ze=ce.point,at=pe.point;return Ze[0]===at[0]&&Ze[1]===at[1]?(Ze=ce.otherEvent.point)[0]===(at=pe.otherEvent.point)[0]&&Ze[1]===at[1]?0:ce.contourId>pe.contourId?1:-1:nt(ce,pe)===1?1:-1}var ft=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function qt(ce,pe,Ze,at){var Et,St=ce+1,Wt=pe[ce].point,Yt=pe.length;for(St<Yt&&(Et=pe[St].point);St<Yt&&Et[0]===Wt[0]&&Et[1]===Wt[1];){if(!Ze[St])return St;++St<Yt&&(Et=pe[St].point)}for(St=ce-1;Ze[St]&&St>at;)St--;return St}ft.prototype.isExterior=function(){return this.holeOf==null};var It=Bt,Ot=Bt;function Bt(ce,pe){if(!(this instanceof Bt))return new Bt(ce,pe);if(this.data=ce||[],this.length=this.data.length,this.compare=pe||In,this.length>0)for(var Ze=(this.length>>1)-1;Ze>=0;Ze--)this._down(Ze)}function In(ce,pe){return ce<pe?-1:ce>pe?1:0}Bt.prototype={push:function(ce){this.data.push(ce),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ce=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ce}},peek:function(){return this.data[0]},_up:function(ce){for(var pe=this.data,Ze=this.compare,at=pe[ce];ce>0;){var Et=ce-1>>1,St=pe[Et];if(Ze(at,St)>=0)break;pe[ce]=St,ce=Et}pe[ce]=at},_down:function(ce){for(var pe=this.data,Ze=this.compare,at=this.length>>1,Et=pe[ce];ce<at;){var St=1+(ce<<1),Wt=St+1,Yt=pe[St];if(Wt<this.length&&Ze(pe[Wt],Yt)<0&&(St=Wt,Yt=pe[Wt]),Ze(Yt,Et)>=0)break;pe[ce]=Yt,ce=St}pe[ce]=Et}},It.default=Ot;var mt=Math.max,Vt=Math.min,un=0;function Ln(ce,pe,Ze,at,Et,St){var Wt,Yt,mn,Cn,Tn,Pn;for(Wt=0,Yt=ce.length-1;Wt<Yt;Wt++)if(Cn=ce[Wt+1],Tn=new H(mn=ce[Wt],!1,void 0,pe),Pn=new H(Cn,!1,Tn,pe),Tn.otherEvent=Pn,mn[0]!==Cn[0]||mn[1]!==Cn[1]){Tn.contourId=Pn.contourId=Ze,St||(Tn.isExteriorRing=!1,Pn.isExteriorRing=!1),nt(Tn,Pn)>0?Pn.left=!0:Tn.left=!0;var rn=mn[0],cn=mn[1];Et[0]=Vt(Et[0],rn),Et[1]=Vt(Et[1],cn),Et[2]=mt(Et[2],rn),Et[3]=mt(Et[3],cn),at.push(Tn),at.push(Pn)}}var zn=[];function _n(ce,pe,Ze){typeof ce[0][0][0]=="number"&&(ce=[ce]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var at=(function(cn,Hn,Xn){var Kn=null;return cn.length*Hn.length==0&&(Xn===T?Kn=zn:Xn===D?Kn=cn:Xn!==I&&Xn!==O||(Kn=cn.length===0?Hn:cn)),Kn})(ce,pe,Ze);if(at)return at===zn?null:at;var Et=[1/0,1/0,-1/0,-1/0],St=[1/0,1/0,-1/0,-1/0],Wt=(function(cn,Hn,Xn,Kn,hi){var Ii,_i,ei,oi,En,Nn,tr=new It(null,nt);for(ei=0,oi=cn.length;ei<oi;ei++)for(En=0,Nn=(Ii=cn[ei]).length;En<Nn;En++)(_i=En===0)&&un++,Ln(Ii[En],!0,un,tr,Xn,_i);for(ei=0,oi=Hn.length;ei<oi;ei++)for(En=0,Nn=(Ii=Hn[ei]).length;En<Nn;En++)_i=En===0,hi===D&&(_i=!1),_i&&un++,Ln(Ii[En],!1,un,tr,Kn,_i);return tr})(ce,pe,Et,St,Ze);if(at=(function(cn,Hn,Xn,Kn,hi){var Ii=null;return(Xn[0]>Kn[2]||Kn[0]>Xn[2]||Xn[1]>Kn[3]||Kn[1]>Xn[3])&&(hi===T?Ii=zn:hi===D?Ii=cn:hi!==I&&hi!==O||(Ii=cn.concat(Hn))),Ii})(ce,pe,Et,St,Ze))return at===zn?null:at;for(var Yt=(function(cn){var Hn,Xn,Kn=(function(ei){var oi,En,Nn,tr,tn=[];for(En=0,Nn=ei.length;En<Nn;En++)((oi=ei[En]).left&&oi.inResult||!oi.left&&oi.otherEvent.inResult)&&tn.push(oi);for(var On=!1;!On;)for(On=!0,En=0,Nn=tn.length;En<Nn;En++)En+1<Nn&&nt(tn[En],tn[En+1])===1&&(tr=tn[En],tn[En]=tn[En+1],tn[En+1]=tr,On=!1);for(En=0,Nn=tn.length;En<Nn;En++)(oi=tn[En]).otherPos=En;for(En=0,Nn=tn.length;En<Nn;En++)(oi=tn[En]).left||(tr=oi.otherPos,oi.otherPos=oi.otherEvent.otherPos,oi.otherEvent.otherPos=tr);return tn})(cn),hi={},Ii=[],_i=function(){if(!hi[Hn]){var ei=Ii.length,oi=(function(tn,On,bi){var Oi=new ft;if(tn.prevInResult!=null){var Ui=tn.prevInResult,Dr=Ui.outputContourId;if(Ui.resultTransition>0){var Ni=On[Dr];if(Ni.holeOf!=null){var nn=Ni.holeOf;On[nn].holeIds.push(bi),Oi.holeOf=nn,Oi.depth=On[Dr].depth}else On[Dr].holeIds.push(bi),Oi.holeOf=Dr,Oi.depth=On[Dr].depth+1}else Oi.holeOf=null,Oi.depth=On[Dr].depth}else Oi.holeOf=null,Oi.depth=0;return Oi})(Kn[Hn],Ii,ei),En=function(tn){hi[tn]=!0,tn<Kn.length&&Kn[tn]&&(Kn[tn].outputContourId=ei)},Nn=Hn,tr=Hn;for(oi.points.push(Kn[Hn].point);En(Nn),En(Nn=Kn[Nn].otherPos),oi.points.push(Kn[Nn].point),!((Nn=qt(Nn,Kn,hi,tr))==tr||Nn>=Kn.length)&&Kn[Nn];);Ii.push(oi)}};for(Hn=0,Xn=Kn.length;Hn<Xn;Hn++)_i();return Ii})((function(cn,Hn,Xn,Kn,hi,Ii){for(var _i,ei,oi,En=new s(yt),Nn=[],tr=Math.min(Kn[2],hi[2]);cn.length!==0;){var tn=cn.pop();if(Nn.push(tn),Ii===T&&tn.point[0]>tr||Ii===D&&tn.point[0]>Kn[2])break;if(tn.left){ei=_i=En.insert(tn),_i=_i!==(oi=En.minNode())?En.prev(_i):null,ei=En.next(ei);var On=_i?_i.key:null;if(R(tn,On,Ii),ei&&rt(tn,ei.key,cn)===2&&(R(tn,On,Ii),R(ei.key,tn,Ii)),_i&&rt(_i.key,tn,cn)===2){var bi=_i;R(On,(bi=bi!==oi?En.prev(bi):null)?bi.key:null,Ii),R(tn,On,Ii)}}else ei=_i=En.find(tn=tn.otherEvent),_i&&ei&&(_i=_i!==oi?En.prev(_i):null,ei=En.next(ei),En.remove(tn),ei&&_i&&rt(_i.key,ei.key,cn))}return Nn})(Wt,0,0,Et,St,Ze)),mn=[],Cn=0;Cn<Yt.length;Cn++){var Tn=Yt[Cn];if(Tn.isExterior()){for(var Pn=[Tn.points],rn=0;rn<Tn.holeIds.length;rn++)Pn.push(Yt[Tn.holeIds[rn]].points);mn.push(Pn)}}return mn}var gi={UNION:I,DIFFERENCE:D,INTERSECTION:T,XOR:O};l.diff=function(ce,pe){return _n(ce,pe,D)},l.intersection=function(ce,pe){return _n(ce,pe,T)},l.operations=gi,l.union=function(ce,pe){return _n(ce,pe,I)},l.xor=function(ce,pe){return _n(ce,pe,O)},Object.defineProperty(l,"__esModule",{value:!0})})(YR.exports)),YR.exports);function P1(l,t,s,u){let h=[],m=u===0?(g,v,b,C,T,I)=>{g.push(new ot(I,b+(I-v)/(C-v)*(T-b)))}:(g,v,b,C,T,I)=>{g.push(new ot(v+(I-b)/(T-b)*(C-v),I))};for(let g of l){let v=[];for(let b of g){if(b.length<=2)continue;let C=[];for(let D=0;D<b.length-1;D++){let O=b[D].x,R=b[D].y,B=b[D+1].x,H=b[D+1].y,$=u===0?O:R,Y=u===0?B:H;$<t?Y>t&&m(C,O,R,B,H,t):$>s?Y<s&&m(C,O,R,B,H,s):C.push(b[D]),Y<t&&$>=t&&m(C,O,R,B,H,t),Y>s&&$<=s&&m(C,O,R,B,H,s)}let T=b[b.length-1],I=u===0?T.x:T.y;I>=t&&I<=s&&C.push(T),C.length&&(T=C[C.length-1],C[0].x===T.x&&C[0].y===T.y||C.push(C[0]),v.push(C))}v.length&&h.push(v)}return h}function V6(l,t){let s=TI(l),u=TI([t]),h=XR.intersection(s,u);return h==null?[]:KR(h)}function U6(l,t){let u=TI(l,65536),h=[];for(;t.valid();t.next()){let[m,g]=t.get(),v=m.x*65536,b=m.y*65536,C=g.x*65536,T=g.y*65536,I=C-v,D=T-b,O=Math.hypot(I,D);if(O===0)continue;let R=Math.trunc(D/O*3),B=-Math.trunc(I/O*3);h.push([[[v,b],[C,T],[C+R,T+B],[v+R,b+B],[v,b]]])}return h.length>0&&(u=XR.diff(u,h)),KR(u,1/65536)}function TI(l,t=1){return[l.map(s=>s.map(u=>[u.x*t,u.y*t]))]}function KR(l,t=1){return l.map(s=>s.map((u,h)=>{let m=u.map(g=>new ot(g[0]*t,g[1]*t).round());return h>0&&m.reverse(),m}))}class II{constructor(t,s){this.layoutVertexArray=new ru,this.indexArray=new Xr,this.lineIndexArray=new ta,this.triangleSegments=new nr,this.lineSegments=new nr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new oc)}update(t,s,u,h,m,g,v,b){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,S6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,T6.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,s,u,h,m,g,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,u,h,m,g,void 0,v)}}class MI{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new II(t,!1),this.elevationBufferData=new II(t,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.hasPattern=EI("fill",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:v,id:b,index:C,sourceLayerIndex:T}of t){let I=this.layers[0]._featureFilter.needGeometry,D=Te(v,I);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;let O=m?m.evaluate(D,{},u,s.availableImages):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:T,index:C,geometry:I?D.geometry:_e(v,u,h),patterns:{},sortKey:O};g.push(R)}m&&g.sort((v,b)=>v.sortKey-b.sortKey);for(let v of g){let{geometry:b,index:C,sourceLayerIndex:T}=v;if(this.hasPattern){let I=SI("fill",this.layers,v,this.zoom,this.pixelRatio,s);this.patternFeatures.push(I)}else this.addFeature(v,b,C,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(t[C].feature,b,C,T,this.index)}}update(t,s,u,h,m,g,v){this.bufferData.update(t,s,u,h,m,g,v,this.worldview),this.elevationBufferData.update(t,s,u,h,m,g,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,s,u,h,m,g,v,this.worldview)}addFeatures(t,s,u,h,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,g,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,s,u,h,m,g=[],v,b){let C=L0(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,C,h,u,b):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(t,u,m,g,h,v,this.worldview),this.elevationBufferData.populatePaintArrays(t,u,m,g,h,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,s,u,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(s,u,h,m,this.worldview))}addElevatedRoadFeature(t,s,u,h,m){let g=new Array,v=ii.getElevationFeature(t,m);if(!v)return void this.addGeometry(s,this.bufferData);{let C=this.clipPolygonsToTile(s,1);C.length>0&&g.push({polygons:C,elevationFeature:v,elevationTileID:u})}let b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},u),featureIndex:h};for(let C of g)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ia(C.elevationTileID,this.layers,this.zoom,this.lut));let I=C.elevationFeature.isTunnel(),D=0;t.properties.hasOwnProperty(Le)&&(D=+t.properties[Le]);for(let O of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,O,I,C.elevationFeature,D)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));let T=new mi(u,C.elevationTileID);this.addElevatedGeometry(C.polygons,T,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,b)}}addElevatedGeometry(t,s,u,h,m,g){let v={elevation:u,elevationSampler:s,bias:h,index:m,featureInfo:g},[b,C]=this.addGeometry(t,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(t,s,u){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(h=g,m=g));let v=(b,C,T)=>{if(u!=null)if(C.push(b),g!=null)s.elevatedLayoutVertexArray.emplaceBack(g),T.push(g);else{let I=u.elevationSampler.pointElevation(b,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(I),T.push(I),h=Math.min(h,I),m=Math.max(m,I)}};for(let b of t){let C=0;for(let Q of b)C+=Q.length;let T=s.triangleSegments.prepareSegment(C,s.layoutVertexArray,s.indexArray),I=T.vertexLength,D=[],O=[],R=[],B=[],H=[],$=s.layoutVertexArray.length;for(let Q of b){if(Q.length===0)continue;Q!==b[0]&&O.push(D.length/2);let ie=s.lineSegments.prepareSegment(Q.length,s.layoutVertexArray,s.lineIndexArray),he=ie.vertexLength;u&&H.push(s.layoutVertexArray.length-$),v(Q[0],R,B),s.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),s.lineIndexArray.emplaceBack(he+Q.length-1,he),D.push(Q[0].x),D.push(Q[0].y);for(let le=1;le<Q.length;le++)v(Q[le],R,B),s.layoutVertexArray.emplaceBack(Q[le].x,Q[le].y),s.lineIndexArray.emplaceBack(he+le-1,he+le),D.push(Q[le].x),D.push(Q[le].y);ie.vertexLength+=Q.length,ie.primitiveLength+=Q.length}let Y=bg(D,O);for(let Q=0;Q<Y.length;Q+=3)s.indexArray.emplaceBack(I+Y[Q],I+Y[Q+1],I+Y[Q+2]);if(Y.length>0&&u&&this.elevationMode==="hd-road-base"){let Q=u.elevation.isTunnel(),ie=u.elevation.safeArea,he=this.elevatedStructures.addVertices(R,B);this.elevatedStructures.addTriangles(Y,he,Q);let le=H.length;if(le>0){for(let me=0;me<le-1;me++)this.elevatedStructures.addRenderableRing(u.index,H[me]+he,H[me+1]-H[me],Q,ie,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,H[le-1]+he,R.length-H[le-1],Q,ie,u.featureInfo)}}T.vertexLength+=C,T.primitiveLength+=Y.length/3}return[h,m]}prepareElevatedPolygons(t,s,u){let h=1/q(u),m=[];for(let g of t){let v=U6(g,new Yn(s,h));m.push(...v)}return m}clipPolygonsToTile(t,s){let u=-s,h=-s,m=vt+s,g=vt+s,v=0,b=[],C=[];for(;v<t.length;v++){let D=t[v],O=Jl(D);(O.min.x>=u&&O.max.x<=m&&O.min.y>=h&&O.max.y<=g?b:C).push(D)}if(b.length===t.length)return t;let T=[new ot(u,h),new ot(m,h),new ot(m,g),new ot(u,g),new ot(u,h)],I=b;for(let D of C)I.push(...V6(D,T));return I}}let QR,JR,ek,tk;Lt(MI,"FillBucket",{omit:["layers","patternFeatures"]}),Lt(II,"FillBufferData"),Lt(ia,"ElevatedStructures");class O1{constructor(t,s,u,h){if(this.triangleCount=s.length/3,this.min=new ot(0,0),this.max=new ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;let[m,g]=[t[0].clone(),t[0].clone()];for(let I=1;I<t.length;++I){let D=t[I];m.x=Math.min(m.x,D.x),m.y=Math.min(m.y,D.y),g.x=Math.max(g.x,D.x),g.y=Math.max(g.y,D.y)}if(h){let I=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/h);u=Math.max(u,I)}if(u===0)return;this.min=m,this.max=g;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let b=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;let C=[];for(let I=0;I<this.triangleCount;I++){let D=t[s[3*I+0]].sub(this.min),O=t[s[3*I+1]].sub(this.min),R=t[s[3*I+2]].sub(this.min),B=cu(Math.floor(Math.min(D.x,O.x,R.x)),this.xScale,this.cellsX),H=cu(Math.floor(Math.max(D.x,O.x,R.x)),this.xScale,this.cellsX),$=cu(Math.floor(Math.min(D.y,O.y,R.y)),this.yScale,this.cellsY),Y=cu(Math.floor(Math.max(D.y,O.y,R.y)),this.yScale,this.cellsY),Q=new ot(0,0),ie=new ot(0,0),he=new ot(0,0),le=new ot(0,0);for(let me=$;me<=Y;++me){Q.y=ie.y=me*b,he.y=le.y=(me+1)*b;for(let ye=B;ye<=H;++ye)Q.x=he.x=ye*b,ie.x=le.x=(ye+1)*b,(Xo(D,O,R,Q,ie,le)||Xo(D,O,R,Q,le,he))&&C.push({cellIdx:me*this.cellsX+ye,triIdx:I})}}if(C.length===0)return;C.sort((I,D)=>I.cellIdx-D.cellIdx||I.triIdx-D.triIdx);let T=0;for(;T<C.length;){let I=C[T].cellIdx,D={start:this.payload.length,len:0};for(;T<C.length&&C[T].cellIdx===I;)++D.len,this.payload.push(C[T++].triIdx);this.cells[I]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,s){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;let u=cu(t.x-this.min.x,this.xScale,this.cellsX),h=cu(t.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+u];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){let v=this.payload[m.start+g],b=Math.floor(v/8),C=1<<v%8;if(!(this.lookup[b]&C)&&(this.lookup[b]|=C,s.push(v),s.length===this.triangleCount))return}}}query(t,s,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>s.x||t.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();let h=cu(t.x-this.min.x,this.xScale,this.cellsX),m=cu(s.x-this.min.x,this.xScale,this.cellsX),g=cu(t.y-this.min.y,this.yScale,this.cellsY),v=cu(s.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=v;b++)for(let C=h;C<=m;C++){let T=this.cells[b*this.cellsX+C];if(T)for(let I=0;I<T.len;I++){let D=this.payload[T.start+I],O=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[O]&R)&&(this.lookup[O]|=R,u.push(D),u.length===this.triangleCount))return}}}}function cu(l,t,s){return Math.max(0,Math.min(s-1,Math.floor(l*t)))}Lt(O1,"TriangleGridIndex");class nk{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){for(let u of this.footprints)s.push({footprint:u,id:t})}updateAppearances(t,s,u,h){}populate(t,s,u,h){let m=[];for(let{feature:g,id:v,index:b,sourceLayerIndex:C}of t){let T=this.layers[0]._featureFilter.needGeometry,I=Te(g,T);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:v,properties:g.properties,type:g.type,sourceLayerIndex:C,index:b,geometry:T?I.geometry:_e(g,u,h),patterns:{}};m.push(D)}for(let g of m){let{geometry:v,index:b,sourceLayerIndex:C}=g;this.addFeature(g,v,b,u,{},s.availableImages,s.brightness),s.featureIndex.insert(t[b].feature,v,b,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,s,u,h,m,g,v){}destroy(){}addFeature(t,s,u,h,m,g=[],v){for(let b of L0(s,2)){let C=[],T=[],I=[],D=new ot(1/0,1/0),O=new ot(-1/0,-1/0);for(let H of b)if(H.length!==0){H!==b[0]&&I.push(T.length/2);for(let $=0;$<H.length;$++)T.push(H[$].x),T.push(H[$].y),C.push(H[$]),D.x=Math.min(D.x,H[$].x),D.y=Math.min(D.y,H[$].y),O.x=Math.max(O.x,H[$].x),O.y=Math.max(O.y,H[$].y)}let R=bg(T,I),B=new O1(C,R,8,256);this.footprints.push({vertices:C,indices:R,grid:B,min:D,max:O})}}}Lt(nk,"ClipBucket",{omit:["layers"]});let j6=An([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$6=An([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),H6=An([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),G6=An([{name:"a_centroid_pos",components:2,type:"Uint16"}]),q6=An([{name:"a_join_normal_inside",components:3,type:"Int16"}]),W6=An([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Z6=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Y6}=j6,N0=Number.MAX_SAFE_INTEGER,ik=N0-1;function rk(l,t,s,u){return l.order<t||l.order===N0||!(l.clipMask&s)||(function(h,m){return m.length!==0&&m.find(g=>g===h)===void 0})(u,l.clipScope)}function R1(l,t){return l.x-t.x||l.y-t.y}function ok(l,t){return R1(l.min,t.min)===0&&R1(l.max,t.max)===0}function DI(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function k1(l,t){if(l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==t[s].sourceId||!ok(l[s],t[s])||l[s].order!==t[s].order||l[s].clipMask!==t[s].clipMask||!Yl(l[s].clipScope,t[s].clipScope))return!1;return!0}function sk(l,t,s){let u=1/vt,h=1/(1<<s.canonical.z),m=(t.x*u+s.canonical.x)*h+s.wrap,g=(t.y*u+s.canonical.y)*h;return{min:new ot((l.x*u+s.canonical.x)*h+s.wrap,(l.y*u+s.canonical.y)*h),max:new ot(m,g)}}function X6(l,t,s){let u=1<<s.canonical.z,h=((t.x-s.wrap)*u-s.canonical.x)*vt,m=(t.y*u-s.canonical.y)*vt;return{min:new ot(((l.x-s.wrap)*u-s.canonical.x)*vt,(l.y*u-s.canonical.y)*vt),max:new ot(h,m)}}function AI(l,t,s,u,h,m,g){let v=l.indices,b=l.vertices,C=[];for(let T=u;T<u+h;T+=3){let I=t[s[T+0]+m],D=t[s[T+1]+m],O=t[s[T+2]+m],R=Math.min(I.x,D.x,O.x),B=Math.max(I.x,D.x,O.x),H=Math.min(I.y,D.y,O.y),$=Math.max(I.y,D.y,O.y);C.length=0,l.grid.query(new ot(R,H),new ot(B,$),C);for(let Y=0;Y<C.length;Y++){let Q=C[Y];if(Xo(b[v[3*Q+0]],b[v[3*Q+1]],b[v[3*Q+2]],I,D,O,g))return!0}}return!1}function ak(l,t,s,u){if(!l||!s)return!1;let h=l.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(s.vertices.length<l.vertices.length)return ak(s,u,l,t);let m=t.canonical,g=u.canonical,v=Math.pow(2,g.z-m.z);h=l.vertices.map(b=>new ot((b.x+m.x*vt)*v-g.x*vt,(b.y+m.y*vt)*v-g.y*vt))}return AI(s,h,l.indices,0,l.indices.length,0,0)}function lk(l,t,s,u){let h=Math.pow(2,u.z-s.z);return new ot((l+s.x*vt)*h-u.x*vt,(t+s.y*vt)*h-u.y*vt)}function ck(l,t){let s=[];t.grid.queryPoint(l,s);let u=t.indices,h=t.vertices;for(let m=0;m<s.length;m++){let g=s[m];if(Si([h[u[3*g+0]],h[u[3*g+1]],h[u[3*g+2]]],l))return!0}return!1}let PI=[new ot(0,0),new ot(vt,0),new ot(vt,vt),new ot(0,vt)];function uk(l,t){let s=[],u=[];if(!t||l.length<2)return[l];if(l.length===2)return Fo(l[0],l[1],PI)?[l]:[];for(let h=0;h<l.length+2;h++){let m=l[h%l.length],g=l[(h+1)%l.length],v=Fo(h===0?l[l.length-1]:l[(h-1)%l.length],m,PI),b=Fo(m,g,PI),C=v||b;C&&u.push(m),C&&b||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}let OI=Ce.types,K6=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Q6=["fill-extrusion-flood-light-ground-radius"],J6=Math.pow(2,13),e8=Math.pow(2,15)-1,dk=new ot(0,1),_d=2147483648,hk=7,pk=450;function z0(l,t,s,u,h,m,g,v){l.emplaceBack((t<<1)+g,(s<<1)+m,(Math.floor(u*J6)<<1)+h,Math.round(v))}function B0(l,t,s){l.emplaceBack(t.x*vt,t.y*vt,s?1:0)}function F1(l,t,s,u,h,m){l.emplaceBack(t.x,t.y,(s.x<<1)+u,(s.y<<1)+h,m)}function V0(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class fk{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class mk{constructor(){this.centroidXY=new ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class gk{constructor(){this.acc=new ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,s){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=s.x,t.min.y=t.max.y=s.y)}appendEdge(t,s,u){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<t.min.x?(t.min.x=s.x,h=!0):s.x>t.max.x&&(t.max.x=s.x,h=!0),s.y<t.min.y?(t.min.y=s.y,h=!0):s.y>t.max.y&&(t.max.y=s.y,h=!0),((s.x===0||s.x===vt)&&s.x===u.x)!=((s.y===0||s.y===vt)&&s.y===u.y)&&this.processBorderOverlap(s,u),h&&this.checkBorderIntersection(s,u)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,on(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>vt!=t.x>vt&&this.addBorderIntersection(1,on(s.y,t.y,(vt-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,on(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>vt!=t.y>vt&&this.addBorderIntersection(3,on(s.x,t.x,(vt-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[t];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;let u=t.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,t.y)}else{let u=t.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new ot(0,0):new ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0):0}}function _k(l,t){let s=l.add(t)._unit(),u=G(l.x*s.x+l.y*s.y,-1,1);var h,m,g;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*e8*((m=l).x*(g=t).y-m.y*g.x<0?-1:1)}let t8=[l=>l.x<0,l=>l.x>vt,l=>l.y<0,l=>l.y>vt];function n8(l,t,s,u){let h=[4];if(u===0)return h;s._mult(u);let m=l.sub(s),g=t.sub(s),v=[l,t,m,g];for(let b=0;b<4;b++)for(let C of v)if(t8[b](C)){h.push(b);break}return h}class RI{constructor(t){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new h0,this.indexArray=new Xr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut},s=>Q6.includes(s)),this._segments=new nr,this.hiddenByLandmarkVertexArray=new cg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new nr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,s,u,h=!1){let m=t.length;if(m>2){let g=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let C=t[0],T=t[1];b=_k(C.sub(t[m-1])._perp()._unit(),T.sub(C)._perp()._unit())}for(let C=0;C<m;C++){let T=C===m-1?0:C+1,I=t[C],D=t[T],O=t[T===m-1?0:T+1],R=D.sub(I)._perp()._unit(),B=_k(R,O.sub(D)._perp()._unit()),H=b,$=B;if(kI(I,D,s)||h&&xk(I,s)&&xk(D,s)){b=B;continue}let Y=v.vertexLength;F1(this.vertexArray,I,D,1,1,H),F1(this.vertexArray,I,D,1,0,H),F1(this.vertexArray,I,D,0,1,$),F1(this.vertexArray,I,D,0,0,$),v.vertexLength+=4;let Q=n8(I,D,R,u);for(let ie of Q)this._segmentToGroundQuads[g].push({id:Y,region:ie}),this._segmentToRegionTriCounts[g][ie]+=2,v.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),s=t.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((h,m)=>h.region-m.region);for(let u=0;u<s;u++){let h=this._segmentToGroundQuads[u],m=t[u],g=this._segmentToRegionTriCounts[u];g.reduce((b,C)=>b+C,0);let v=0;for(let b=0;b<=4;b++){let C=g[b];if(C!==0){let T=this.regionSegments[b];T||(T=this.regionSegments[b]=new nr);let I={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:C};T.get().push(I)}v+=C}for(let b=0;b<h.length;b++){let C=h[b].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,s,u,h,m,g,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,s,u,h,m,g,void 0,v)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=t.createVertexBuffer(this.groundRadiusArray,H6.members)))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,s,u,h,m,g,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(t,s,u,h,m,g,v,b)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&_d))}updateHiddenByLandmarkRange(t,s,u){if(!this.hasData())return;let h=s+t;if(s!==0){for(let m=t;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,W6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let s=this.regionSegments[t];s&&s.destroy()}}}}class L1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Xr,this.footprintVertices=new ru,this.footprintSegments=[],this.layoutVertexArray=new ch,this.centroidVertexArray=new C1,this.wallVertexArray=new zp,this.indexArray=new Xr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut},s=>K6.includes(s)),this.segments=new nr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new RI(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.features=[],this.hasPattern=EI("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=q(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:m,id:g,index:v,sourceLayerIndex:b}of t){let C=this.layers[0]._featureFilter.needGeometry,T=Te(m,C);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),T,u))continue;let I={id:g,sourceLayerIndex:b,index:v,geometry:C?T.geometry:_e(m,u,h),properties:m.properties,type:m.type,patterns:{}},D=this.layoutVertexArray.length,O=OI[I.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:SI("fill-extrusion",this.layers,I,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(let R of I.geometry)for(let B of uk(R,O))this.addFeature(m.id,I,[B],v,u,{},s.availableImages,h,s.brightness);else this.addFeature(m.id,I,I.geometry,v,u,{},s.availableImages,h,s.brightness);s.featureIndex.insert(m,I.geometry,v,b,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,s,u,h,m,g){for(let{featureId:v,feature:b}of this.features){let C=OI[b.type]==="Polygon",{geometry:T}=b;if(this.wallMode)for(let I of T)for(let D of uk(I,C))this.addFeature(v,b,[D],b.index,s,u,h,m,g);else this.addFeature(v,b,T,b.index,s,u,h,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview),this.groundEffect.update(t,s,m,u,h,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Y6),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,q6.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Z6.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,G6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,u,h,m,g,v,b,C){let T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,I=[new ot(0,0),new ot(vt,vt)],D=b.projection,O=D.name==="globe",R=this.wallMode||OI[s.type]==="Polygon",B=new gk;B.centroidDataIndex=this.centroidData.length;let H=new mk;H.buildingId=t,s.properties&&s.properties.hasOwnProperty("building_id")&&(H.buildingId=s.properties.building_id);let $=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},m)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},m),Q;if(H.height=Y,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ig),this.wallMode){if(O)return void At("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;Q=(function(Ie){let We=Ie[0].x===Ie[Ie.length-1].x&&Ie[0].y===Ie[Ie.length-1].y;(function(Ot){let Bt=0,In=Ot.length;for(let mt=0;mt<In;mt++)Bt+=(Ot[(mt+1)%In].x-Ot[mt].x)*(Ot[(mt+1)%In].y+Ot[mt].y);return Bt>=0})(Ie)||(Ie=Ie.reverse());let Qe={geometry:[],joinNormals:[],indices:[]},st=[],lt=[],nt=[],it=Ie.length;for(;it>=2&&Ie[it-1].equals(Ie[it-2]);)it--;if(it<(We?3:2))return Qe;let qe,He,rt,yt,ft,qt=0;for(;qt<it-1&&Ie[qt].equals(Ie[qt+1]);)qt++;We&&(qe=Ie[it-2],ft=Ie[qt].sub(qe)._unit()._perp());for(let Ot=qt;Ot<it;Ot++){if(rt=Ot===it-1?We?Ie[qt+1]:void 0:Ie[Ot+1],rt&&Ie[Ot].equals(rt))continue;ft&&(yt=ft),qe&&(He=qe),qe=Ie[Ot],ft=rt?rt.sub(qe)._unit()._perp():yt,yt=yt||ft;let Bt=yt.add(ft);Bt.x===0&&Bt.y===0||Bt._unit();let In=Bt.x*ft.x+Bt.y*ft.y,mt=In!==0?1/In:1/0,Vt=yt.x*ft.y-yt.y*ft.x>0,un="miter",Ln=2;un==="miter"&&mt>Ln&&(un="bevel"),un==="bevel"&&(mt>100&&(un="flipbevel"),mt<Ln&&(un="miter"));let zn=(_n,gi,ce,pe)=>{let Ze=new ot(_n.x,_n.y),at=new ot(_n.x,_n.y);Ze.x+=gi.x*pe,Ze.y+=gi.y*pe,at.x-=gi.x*Math.max(ce,1),at.y-=gi.y*Math.max(ce,1),nt.push(gi),st.push(Ze),lt.push(at)};if(un==="miter")Bt._mult(mt),zn(qe,Bt,0,0);else if(un==="flipbevel")Bt=ft.mult(-1),zn(qe,Bt,0,0),zn(qe,Bt.mult(-1),0,0);else{let _n=-Math.sqrt(mt*mt-1),gi=Vt?_n:0,ce=Vt?0:_n;He&&zn(qe,yt,gi,ce),rt&&zn(qe,ft,gi,ce)}}Qe.geometry=[...st,...lt.reverse(),st[0]],Qe.joinNormals=[...nt,...nt.reverse(),nt[nt.length-1]];let It=Qe.geometry.length-1;for(let Ot=0;Ot<It/2;Ot++)if(Ot+1<It/2){let Bt=Ot,In=Ot+1,mt=It-1-Ot,Vt=It-2-Ot;Bt=Bt===0?It-1:Bt-1,In=In===0?It-1:In-1,mt=mt===0?It-1:mt-1,Vt=Vt===0?It-1:Vt-1,Qe.indices.push(mt),Qe.indices.push(In),Qe.indices.push(Bt),Qe.indices.push(mt),Qe.indices.push(Vt),Qe.indices.push(In)}return Qe})(u[0]),u=[Q.geometry]}let ie=(Ie,We)=>Ie<(We.length-1)/2||Ie===We.length-1,he=this.wallMode?[u]:L0(u,500);for(let Ie=he.length-1;Ie>=0;Ie--){let We=he[Ie];(We.length===0||(le=We[0]).every(Ke=>Ke.x<=0)||le.every(Ke=>Ke.x>=vt)||le.every(Ke=>Ke.y<=0)||le.every(Ke=>Ke.y>=vt))&&he.splice(Ie,1)}var le;let me;if(O)me=Ek(he,I,m);else{me=[];for(let Ie of he)me.push({polygon:Ie,bounds:I})}let ye=R?this.edgeRadius:0,we=ye>0&&this.zoom<17,je=(Ie,We)=>{if(Ie.length===0)return!1;let Ke=Ie[Ie.length-1];return We.x===Ke.x&&We.y===Ke.y};for(let{polygon:Ie,bounds:We}of me){let Ke=0,Qe=0;for(let it of Ie)R&&!it[0].equals(it[it.length-1])&&it.push(it[0]),Qe+=R?it.length-1:it.length;let st=this.segments.prepareSegment((R?5:4)*Qe,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);let lt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},nt=new fk;if(nt.vertexOffset=this.footprintVertices.length,nt.indexOffset=3*this.footprintIndices.length,nt.ringIndices=[],R){let it=[],qe=[];Ke=st.vertexLength;for(let rt=0;rt<Ie.length;rt++){let yt=Ie[rt];yt.length&&rt!==0&&qe.push(it.length/2);let ft=[],qt,It;qt=yt[1].sub(yt[0])._perp()._unit(),nt.ringIndices.push(yt.length-1);for(let Ot=1;Ot<yt.length;Ot++){let Bt=yt[Ot],In=yt[Ot===yt.length-1?1:Ot+1],mt=Bt.clone();if(ye){It=In.sub(Bt)._perp()._unit();let Vt=qt.add(It)._unit(),un=ye*Math.min(4,1/(qt.x*Vt.x+qt.y*Vt.y));mt.x+=un*Vt.x,mt.y+=un*Vt.y,mt.x=Math.round(mt.x),mt.y=Math.round(mt.y),qt=It}if(!$||ye!==0&&!we||je(ft,mt)||ft.push(mt),z0(this.layoutVertexArray,mt.x,mt.y,0,0,1,1,0),this.wallMode){let Vt=ie(Ot,yt);B0(this.wallVertexArray,Q.joinNormals[Ot],!Vt)}st.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),it.push(Bt.x,Bt.y),O&&V0(this.layoutVertexExtArray,D.projectTilePoint(mt.x,mt.y,m),D.upVector(m,mt.x,mt.y))}$&&(ye===0||we)&&(ft.length!==0&&je(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,We,T))}let He=this.wallMode?Q.indices:bg(it,qe);for(let rt=0;rt<He.length;rt+=3)this.footprintIndices.emplaceBack(nt.vertexOffset+He[rt+0],nt.vertexOffset+He[rt+1],nt.vertexOffset+He[rt+2]),this.indexArray.emplaceBack(Ke+He[rt],Ke+He[rt+2],Ke+He[rt+1]),st.primitiveLength++;nt.indexCount+=He.length,nt.vertexCount+=this.footprintVertices.length-nt.vertexOffset}for(let it=0;it<Ie.length;it++){let qe=Ie[it];B.startRing(H,qe[0]);let He=qe.length>4&&bk(qe[qe.length-2],qe[0],qe[1]),rt=ye?i8(qe[qe.length-2],qe[0],qe[1],ye):0,yt=[],ft,qt,It;qt=qe[1].sub(qe[0])._perp()._unit();let Ot=!0;for(let Bt=1,In=0;Bt<qe.length;Bt++){let mt=qe[Bt-1],Vt=qe[Bt],un=qe[Bt===qe.length-1?1:Bt+1];if(B.appendEdge(H,Vt,mt),kI(Vt,mt,We)){ye&&(qt=un.sub(Vt)._perp()._unit(),Ot=!Ot);continue}let Ln=Vt.sub(mt)._perp(),zn=Ln.x/(Math.abs(Ln.x)+Math.abs(Ln.y)),_n=Ln.y>0?1:0,gi=mt.dist(Vt);if(In+gi>32768&&(In=0),ye){It=un.sub(Vt)._perp()._unit();let at=yk(mt,Vt,un,vk(qt,It),ye);isNaN(at)&&(at=0);let Et=Vt.sub(mt)._unit();mt=mt.add(Et.mult(rt))._round(),Vt=Vt.add(Et.mult(-at))._round(),rt=at,qt=It,$&&this.zoom>=17&&(je(yt,mt)||yt.push(mt),je(yt,Vt)||yt.push(Vt))}let ce=st.vertexLength,pe=qe.length>4&&bk(mt,Vt,un),Ze=wk(In,He,Ot);if(z0(this.layoutVertexArray,mt.x,mt.y,zn,_n,0,0,Ze),z0(this.layoutVertexArray,mt.x,mt.y,zn,_n,0,1,Ze),this.wallMode){let at=ie(Bt-1,qe),Et=Q.joinNormals[Bt-1];B0(this.wallVertexArray,Et,at),B0(this.wallVertexArray,Et,at)}if(In+=gi,Ze=wk(In,pe,!Ot),He=pe,z0(this.layoutVertexArray,Vt.x,Vt.y,zn,_n,0,0,Ze),z0(this.layoutVertexArray,Vt.x,Vt.y,zn,_n,0,1,Ze),this.wallMode){let at=ie(Bt,qe),Et=Q.joinNormals[Bt];B0(this.wallVertexArray,Et,at),B0(this.wallVertexArray,Et,at)}if(st.vertexLength+=4,this.indexArray.emplaceBack(ce+0,ce+1,ce+2),this.indexArray.emplaceBack(ce+1,ce+3,ce+2),st.primitiveLength+=2,ye){let at=Ke+(Bt===1?qe.length-2:Bt-2),Et=Bt===1?Ke:at+1;if(this.indexArray.emplaceBack(ce+1,at,ce+3),this.indexArray.emplaceBack(at,Et,ce+3),st.primitiveLength+=2,ft===void 0&&(ft=ce),!kI(un,qe[Bt],We)){let St=Bt===qe.length-1?ft:st.vertexLength;this.indexArray.emplaceBack(ce+2,ce+3,St),this.indexArray.emplaceBack(ce+3,St+1,St),this.indexArray.emplaceBack(ce+3,Et,St+1),st.primitiveLength+=3}Ot=!Ot}if(O){let at=this.layoutVertexExtArray,Et=D.projectTilePoint(mt.x,mt.y,m),St=D.projectTilePoint(Vt.x,Vt.y,m),Wt=D.upVector(m,mt.x,mt.y),Yt=D.upVector(m,Vt.x,Vt.y);V0(at,Et,Wt),V0(at,Et,Wt),V0(at,St,Yt),V0(at,St,Yt)}}R&&(Ke+=qe.length-1),$&&ye&&this.zoom>=17&&(yt.length!==0&&je(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,We,T,ye>0))}this.footprintSegments.push(nt),lt.triangleCount=this.indexArray.length-lt.triangleArrayOffset,this.polygonSegments.push(lt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=B.borders?dk:this.encodeCentroid(B,H),this.centroidData.push(H),B.borders){this.featuresOnBorder.push(B);let Ie=this.featuresOnBorder.length-1;for(let We=0;We<B.borders.length;We++)B.borders[We][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[We].push(Ie)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,g,v,m,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,h,g,v,m,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((s,u)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}splitToSubtiles(){let t=[];for(let v=0;v<this.centroidData.length;v++){let b=this.centroidData[v],C=+(b.min.y+b.max.y>vt),T=2*C+(+(b.min.x+b.max.x>vt)^C);for(let I=0;I<b.polygonSegLen;I++){let D=b.polygonSegIdx+I;t.push({centroidIdx:v,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let s=new Xr;t.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let u=0,h=0,m=0;for(let v of t){if(v.triangleSegmentIdx!==u)break;m++}let g=t.length;for(;h!==t.length;){u=t[h].triangleSegmentIdx;let v=0,b=h,C=h;for(let T=b;T<m&&t[T].subtile===v;T++)C++;for(;b!==m;){let T=t[b];v=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=b;R<C;R++){let B=t[R],H=this.polygonSegments[B.polygonSegmentIdx],$=this.centroidData[B.centroidIdx].min,Y=this.centroidData[B.centroidIdx].max,Q=this.indexArray.uint16;for(let ie=H.triangleArrayOffset;ie<H.triangleArrayOffset+H.triangleCount;ie++)s.emplaceBack(Q[3*ie],Q[3*ie+1],Q[3*ie+2]);O.primitiveLength+=H.triangleCount,I.x=Math.min(I.x,$.x),I.y=Math.min(I.y,$.y),D.x=Math.max(D.x,Y.x),D.y=Math.max(D.y,Y.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:I,max:D}),b=C;for(let R=b;R<m&&t[R].subtile===t[b].subtile;R++)C++}h=m;for(let T=h;T<g&&t[T].triangleSegmentIdx===t[h].triangleSegmentIdx;T++)m++}s._trim(),this.indexArray=s}getVisibleSegments(t,s,u){let h=new nr;if(this.wallMode){for(let B of this.triangleSubSegments)h.segments.push(B.segment);return h}let m=0,g=0,v=1<<t.canonical.z;if(s){let B=s.getMinMaxForTile(t);B&&(m=B.min,g=B.max)}g+=this.maxHeight;let b=t.toUnwrapped(),C,T=[b.canonical.x/v+b.wrap,b.canonical.y/v],I=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],D=(B,H,$)=>[B[0]*(1-$[0])+H[0]*$[0],B[1]*(1-$[1])+H[1]*$[1]],O=[],R=[];for(let B of this.triangleSubSegments){O[0]=B.min.x/vt,O[1]=B.min.y/vt,R[0]=B.max.x/vt,R[1]=B.max.y/vt;let H=D(T,I,O),$=D(T,I,R);if(new jt([H[0],H[1],m],[$[0],$[1],g]).intersectsPrecise(u)===0){C&&(h.segments.push(C),C=void 0);continue}let Y=B.segment;C&&C.vertexOffset!==Y.vertexOffset&&(h.segments.push(C),C=void 0),C?(C.vertexLength+=Y.vertexLength,C.primitiveLength+=Y.primitiveLength):C={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&h.segments.push(C),h}encodeCentroid(t,s){let u=t.centroid(),h=s.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new ot(G(u.x,1,vt-1)<<3|m,G(u.y,1,vt-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new ot(0,0);let s=t.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){let h=s[0][0]!==u?0:1;return new ot(6|(s[0][0]!==u?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{let h=s[2][0]!==u?2:3;return new ot((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(t){let s=this.centroidData[t.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let s=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,h=t.flags&_d?dk:t.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||m!==h.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let h=s.getReplacementRegionsForTile(t.toUnwrapped());if(k1(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let g of this.centroidData)g.flags&=2147483647;let m=[];for(let g of this.activeReplacements){if(g.order<u)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));if(g.footprint.buildingIds)for(let b of this.centroidData)b.flags&_d||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y||g.footprint.buildingIds.has(b.buildingId)&&(b.flags|=_d);else for(let b of this.centroidData)if(!(b.flags&_d||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y))for(let C=0;C<b.footprintSegLen;C++){let T=this.footprintSegments[b.footprintSegIdx+C];if(m.length=0,r8(this.footprintVertices,T.vertexOffset,T.vertexCount,g.footprintTileId.canonical,t.canonical,m),AI(g.footprint,m,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-v)){b.flags|=_d;break}}}for(let g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,s,u){let h=!1;for(let m=0;m<u.footprintSegLen;m++){let g=this.footprintSegments[u.footprintSegIdx+m],v=0;for(let b of g.ringIndices){for(let C=v,T=b+v-1;C<b+v;T=C++){let I=this.footprintVertices.int16[2*(C+g.vertexOffset)+0],D=this.footprintVertices.int16[2*(C+g.vertexOffset)+1],O=this.footprintVertices.int16[2*(T+g.vertexOffset)+1];D>s!=O>s&&t<(this.footprintVertices.int16[2*(T+g.vertexOffset)+0]-I)*(s-D)/(O-D)+I&&(h=!h)}v=b}}return h}getHeightAtTileCoord(t,s){let u=Number.NEGATIVE_INFINITY,h=!0,m=4*(t+vt)*vt+(s+vt);if(this.partLookup.hasOwnProperty(m)){let g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&_d)}:void 0}for(let g of this.centroidData)t>g.max.x||g.min.x>t||s>g.max.y||g.min.y>s||g.height<=u||this.footprintContainsPoint(t,s,g)&&(u=g.height,this.partLookup[m]=g,h=!!(g.flags&_d));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[m]=void 0}}function vk(l,t){let s=l.add(t)._unit();return l.x*s.x+l.y*s.y}function i8(l,t,s,u){let h=t.sub(l)._perp()._unit(),m=s.sub(t)._perp()._unit();return yk(l,t,s,vk(h,m),u)}function yk(l,t,s,u,h){let m=Math.sqrt(1-u*u);return Math.min(l.dist(t)/3,t.dist(s)/3,h*m/u)}function kI(l,t,s){return l.x<s[0].x&&t.x<s[0].x||l.x>s[1].x&&t.x>s[1].x||l.y<s[0].y&&t.y<s[0].y||l.y>s[1].y&&t.y>s[1].y}function xk(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function bk(l,t,s){if(l.x<0||l.x>=vt||t.x<0||t.x>=vt||s.x<0||s.x>=vt)return!1;let u=s.sub(t),h=u.perp(),m=l.sub(t);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function wk(l,t,s){let u=t?2|l:-3&l;return s?1|u:-2&u}function Ck(){let l=Math.PI/32,t=Math.tan(l),s=p;return s*Math.sqrt(1+2*t*t)-s}function Ek(l,t,s){let u=1<<s.z,h=A(s.x/u),m=A((s.x+1)/u),g=L(s.y/u),v=L((s.y+1)/u);return(function(b,C,T,I,D=0,O){let R=[];if(!b.length||!T||!I)return R;let B=(le,me)=>{for(let ye of le)R.push({polygon:ye,bounds:me})},H=Math.ceil(Math.log2(T)),$=Math.ceil(Math.log2(I)),Y=H-$,Q=[];for(let le=0;le<Math.abs(Y);le++)Q.push(Y>0?0:1);for(let le=0;le<Math.min(H,$);le++)Q.push(0),Q.push(1);let ie=b;if(ie=P1(ie,C[0].y-D,C[1].y+D,1),ie=P1(ie,C[0].x-D,C[1].x+D,0),!ie.length)return R;let he=[];for(Q.length?he.push({polygons:ie,bounds:C,depth:0}):B(ie,C);he.length;){let le=he.pop(),me=le.depth,ye=Q[me],we=le.bounds[0],je=le.bounds[1],Ie=ye===0?we.x:we.y,We=ye===0?je.x:je.y,Ke=O?O(ye,Ie,We):.5*(Ie+We),Qe=P1(le.polygons,Ie-D,Ke+D,ye),st=P1(le.polygons,Ke-D,We+D,ye);if(Qe.length){let lt=[we,new ot(ye===0?Ke:je.x,ye===1?Ke:je.y)];Q.length>me+1?he.push({polygons:Qe,bounds:lt,depth:me+1}):B(Qe,lt)}if(st.length){let lt=[new ot(ye===0?Ke:we.x,ye===1?Ke:we.y),je];Q.length>me+1?he.push({polygons:st,bounds:lt,depth:me+1}):B(st,lt)}}return R})(l,t,Math.ceil((m-h)/11.25),Math.ceil((g-v)/11.25),1,(b,C,T)=>{if(b===0)return .5*(C+T);{let I=L((s.y+C/vt)/u);return(S(.5*(L((s.y+T/vt)/u)+I))*u-s.y)*vt}})}function r8(l,t,s,u,h,m){let g=Math.pow(2,u.z-h.z);for(let v=0;v<s;v++){let b=l.int16[2*(v+t)+0],C=l.int16[2*(v+t)+1];b=(b+h.x*vt)*g-u.x*vt,C=(C+h.y*vt)*g-u.y*vt,m.push(new ot(b,C))}}let Sk,Tk;Lt(L1,"FillExtrusionBucket",{omit:["layers","features"]}),Lt(mk,"PartData"),Lt(fk,"FootprintSegment"),Lt(gk,"BorderCentroidData"),Lt(RI,"GroundEffect");class Zp extends ot{constructor(t,s,u){super(t,s),this.z=u}}class Ik extends Zp{constructor(t,s,u,h){super(t,s,u),this.w=h}}function Mk(l,t,s,u){let h=s==="x"?"y":"x",m=(u-l[s])/(t[s]-l[s]);l[h]=Math.round(l[h]+(t[h]-l[h])*m),l[s]=u,l.hasOwnProperty("z")&&(l.z=on(l.z,t.z,m)),l.hasOwnProperty("w")&&(l.w=on(l.w,t.w,m))}function Dk(l,t,s,u){let h=s,m=u;for(let g of["x","y"]){let v=l,b=t;v[g]>=b[g]&&(v=t,b=l),v[g]<h&&b[g]>h&&Mk(v,b,g,h),v[g]<m&&b[g]>m&&Mk(b,v,g,m)}}function N1(l,t,s,u,h,m){let g=[];for(let v=0;v<l.length;v++){let b=l[v],C,T=g.length,I=0;for(let D=0;D<b.length-1;D++){let O=b[D],R=b[D+1],B=0,H=I,$,Y;m&&(B=Math.hypot(R.x-O.x,R.y-O.y),I+=B,$=O,Y=R),O.x<t&&R.x<t||(O.x<t?O=new ot(t,O.y+(t-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x<t&&(R=new ot(t,O.y+(t-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y<s&&R.y<s||(O.y<s?O=new ot(O.x+(s-O.y)/(R.y-O.y)*(R.x-O.x),s)._round():R.y<s&&(R=new ot(O.x+(s-O.y)/(R.y-O.y)*(R.x-O.x),s)._round()),O.x>=u&&R.x>=u||(O.x>=u?O=new ot(u,O.y+(u-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x>=u&&(R=new ot(u,O.y+(u-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y>=h&&R.y>=h||(O.y>=h?O=new ot(O.x+(h-O.y)/(R.y-O.y)*(R.x-O.x),h)._round():R.y>=h&&(R=new ot(O.x+(h-O.y)/(R.y-O.y)*(R.x-O.x),h)._round()),C&&O.equals(C[C.length-1])||(C=[O],g.push(C),m&&m.push({progress:{min:H+Ak($,Y,O)*B,max:1},parentIndex:v,prevPoint:$,nextPoint:Y})),C.push(R),m&&(m[m.length-1].progress.max=H+Ak($,Y,R)*B,m[m.length-1].nextPoint=Y)))))}if(m&&I>0)for(let D=T;D<g.length;D++)m[D].progress.min/=I,m[D].progress.max/=I}return g}function o8(l,t,s,u,h){if(l.length<2)return void u.push(l);let m=[];for(;t.valid();){let[C,T]=t.get();for(let I=0;I<l.length-1;I++){let D=l[I],O=l[I+1],R=wn(D,O,C,T);if(R){let[B]=R,H=new ot(on(D.x,O.x,B),on(D.y,O.y,B));m.push({t:I+B,distance:0,point:H})}}t.next()}if(m.length===0)return void u.push(l);m.sort((C,T)=>C.t-T.t);let g=0,v=0,b=[];for(u.push(b);g!==l.length;){if(v===m.length){for(;g!==l.length;)b.length!==0&&b[b.length-1].equals(l[g])||b.push(l[g]),g++;break}m[v].t<=g?(b.length!==0&&b[b.length-1].equals(m[v].point)||b.push(m[v].point),Math.trunc(m[v].t),v++):(b.length!==0&&b[b.length-1].equals(l[g])||b.push(l[g]),g++)}}function Ak(l,t,s){return l.x!==t.x?(s.x-l.x)/(t.x-l.x):l.y!==t.y?(s.y-l.y)/(t.y-l.y):0}function U0(l,t){return l.x*t.x+l.y*t.y}function Pk(l,t){if(l.length===1){let s=0,u=t[s++],h;for(;!h||u.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){let m=t[s],g=l[0],v=h.sub(u),b=m.sub(u),C=g.sub(u),T=U0(v,v),I=U0(v,b),D=U0(b,b),O=U0(C,v),R=U0(C,b),B=T*D-I*I,H=(D*O-I*R)/B,$=(T*R-I*O)/B,Y=u.z*(1-H-$)+h.z*H+m.z*$;if(isFinite(Y))return Y}return 1/0}{let s=1/0;for(let u of t)s=Math.min(s,u.z);return s}}function Ok(l,t,s){let u=1/0;ti(s,t)&&(u=Pk(s,t[0]));for(let h=0;h<t.length;h++){let m=t[h],g=l[h];for(let v=0;v<m.length-1;v++){let b=m[v],C=[b,m[v+1],g[v+1],g[v],b];Wn(s,C)&&(u=Math.min(u,Pk(s,C)))}}return u!==1/0&&u}function Rk(l,t,s,u,h,m,g,v,b,C,T){return l.projection.name==="globe"?(function(I,D,O,R,B,H,$,Y,Q,ie,he){let le=[],me=[],ye=I.projection.upVectorScale(he,I.center.lat,I.worldSize).metersToTile,we=[0,0,0,1],je=[0,0,0,1],Ie=(Ke,Qe,st,lt)=>{Ke[0]=Qe,Ke[1]=st,Ke[2]=lt,Ke[3]=1},We=Ck();O>0&&(O+=We),R+=We;for(let Ke of D){let Qe=[],st=[];for(let lt of Ke){let nt=lt.x+B.x,it=lt.y+B.y,qe=I.projection.projectTilePoint(nt,it,he),He=I.projection.upVector(he,lt.x,lt.y),rt=O,yt=R;if($){let ft=kk(nt,it,O,R,$,Y,Q,ie);rt+=ft.base,yt+=ft.top}O!==0?Ie(we,qe.x+He[0]*ye*rt,qe.y+He[1]*ye*rt,qe.z+He[2]*ye*rt):Ie(we,qe.x,qe.y,qe.z),Ie(je,qe.x+He[0]*ye*yt,qe.y+He[1]*ye*yt,qe.z+He[2]*ye*yt),Fr(we,we,H),Fr(je,je,H),Qe.push(new Zp(we[0],we[1],we[2])),st.push(new Zp(je[0],je[1],je[2]))}le.push(Qe),me.push(st)}return[le,me]})(l,t,s,u,h,m,g,v,b,C,T):g?(function(I,D,O,R,B,H,$,Y,Q){let ie=[],he=[],le=[0,0,0,1];for(let me of I){let ye=[],we=[];for(let je of me){let Ie=je.x+R.x,We=je.y+R.y,Ke=kk(Ie,We,D,O,H,$,Y,Q);le[0]=Ie,le[1]=We,le[2]=Ke.base,le[3]=1,qo(le,le,B),le[3]=Math.max(le[3],1e-5);let Qe=new Zp(le[0]/le[3],le[1]/le[3],le[2]/le[3]);le[0]=Ie,le[1]=We,le[2]=Ke.top,le[3]=1,qo(le,le,B),le[3]=Math.max(le[3],1e-5);let st=new Zp(le[0]/le[3],le[1]/le[3],le[2]/le[3]);ye.push(Qe),we.push(st)}ie.push(ye),he.push(we)}return[ie,he]})(t,s,u,h,m,g,v,b,C):(function(I,D,O,R,B){let H=[],$=[],Y=B[8]*D,Q=B[9]*D,ie=B[10]*D,he=B[11]*D,le=B[8]*O,me=B[9]*O,ye=B[10]*O,we=B[11]*O;for(let je of I){let Ie=[],We=[];for(let Ke of je){let Qe=Ke.x+R.x,st=Ke.y+R.y,lt=B[0]*Qe+B[4]*st+B[12],nt=B[1]*Qe+B[5]*st+B[13],it=B[2]*Qe+B[6]*st+B[14],qe=B[3]*Qe+B[7]*st+B[15],He=lt+Y,rt=nt+Q,yt=it+ie,ft=Math.max(qe+he,1e-5),qt=lt+le,It=nt+me,Ot=it+ye,Bt=Math.max(qe+we,1e-5);Ie.push(new Zp(He/ft,rt/ft,yt/ft)),We.push(new Zp(qt/Bt,It/Bt,Ot/Bt))}H.push(Ie),$.push(We)}return[H,$]})(t,s,u,h,m)}function kk(l,t,s,u,h,m,g,v){let b=g*h.getElevationAt(l,t,!0,!0),C=m[0]!==0,T=C?m[1]===0?g*(m[0]/hk-pk):g*(function(I,D,O){let R=Math.floor(D[0]/8),B=Math.floor(D[1]/8),H=10*(D[0]-8*R),$=10*(D[1]-8*B),Y=I.getElevationAt(R,B,!0,!0),Q=I.getMeterToDEM(O),ie=Math.floor(.5*(H*Q-1)),he=Math.floor(.5*($*Q-1)),le=I.tileCoordToPixel(R,B),me=2*ie+1,ye=2*he+1,we=(function(st,lt,nt,it,qe){return[st.getElevationAtPixel(lt,nt,!0),st.getElevationAtPixel(lt+qe,nt,!0),st.getElevationAtPixel(lt,nt+qe,!0),st.getElevationAtPixel(lt+it,nt+qe,!0)]})(I,le.x-ie,le.y-he,me,ye),je=Math.abs(we[0]-we[1]),Ie=Math.abs(we[2]-we[3]),We=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Ke=Math.min(.25,.5*Q*(je+Ie)/me),Qe=Math.min(.25,.5*Q*We/ye);return Y+Math.max(Ke*H,Qe*$)})(h,m,v):b;return{base:b+(s===0?-1:s),top:C?Math.max(T+u,b+s+2):b+u}}class s8{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class a8{constructor(){this.tasks={},this.taskQueue=[],Pe(["process"],this),this.invoker=new s8(this.process),this.nextId=0}add(t,s){let u=this.nextId++,h=(function({type:m,isSymbolTile:g,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-v:m==="maybePrepare"&&g?400-v:500:200-v:100-v})(s);if(h===0){try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:s,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){let m=this.tasks[this.taskQueue[h]];m.priority<s&&(s=m.priority,t=h)}if(t===null)return null;let u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class Fk{constructor(t,s,u){this.target=t,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Pe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new a8}send(t,s,u,h,m=!1,g){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[v]=u);let b=new Set;return this.target.postMessage({id:v,type:t,hasCallback:!!u,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:tc(s,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){let s=t.data;if(!s)return;let u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){let h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(s.mustQueue||Un(self)){let h=this.callbacks[u],m=this.scheduler.add(()=>this.processTask(u,s),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,s)}processTask(t,s){if(delete this.cancelCallbacks[t],s.type==="<response>"){let u=this.callbacks[t];delete this.callbacks[t],u&&(s.error?u(iu(s.error)):u(null,iu(s.data)))}else{let u=new Set,h=s.hasCallback?(g,v)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?tc(g):null,data:tc(v,u)},u)}:()=>{},m=iu(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,m,h);else if(this.parent.getWorkerSource){let g=s.type.split("."),{source:v,scope:b}=m;this.parent.getWorkerSource(s.sourceMapId,g[0],v,b)[g[1]](m,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var j0={workerUrl:"",workerClass:null,workerParams:void 0};let FI="mapboxgl_preloaded_worker_pool",z1=(()=>{class l{constructor(s){this.active={},this.name=s}acquire(s,u=l.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;){let m=(h=`${this.name||""}WorkerPool: ${s}-${this.workers.length}`,j0.workerClass!=null?new j0.workerClass:new self.Worker(j0.workerUrl,Object.assign({name:h},j0.workerParams)));this.workers.push(m)}var h;return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[FI]}numActive(){return Object.keys(this.active).length}}return l.workerCount=2,l})();class Cg{constructor(t,s,u="Worker",h=z1.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Ee();let m=this.workerPool.acquire(this.id,h);for(let g=0;g<m.length;g++){let v=new Cg.Actor(m[g],s,this.id);v.name=`${u} ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,u){xe(this.actors,(h,m)=>{h.send(t,s,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let $0,LI;function B1(){return $0||($0=new z1),$0}Cg.Actor=Fk;let NI=4096;class l8{constructor(t){this.module=t,this.memoryStack=this.module.malloc(NI),this.memoryStackNextFree=this.memoryStack}createIntArray(t){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>NI?-1:(new Int32Array(this.module.heap32.buffer,s,t.length).set(t),s)}createFloatArray(t){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>NI?-1:(new Float32Array(this.module.heapF32.buffer,s,t.length).set(t),s)}readStringBuffer(t){let s="";for(;this.module.heapU8[t]!==0;)s+=String.fromCharCode(this.module.heapU8[t]),++t;return s}setStyle(t){let s=t.normalScale;this.module.setStyle(s[0],s[1],s[2],t.tileToMeters)}setAOOptions(t,s){this.module.setAOOptions(t?1:0,s)}setMetricOptions(t,s){this.module.setMetricOptions(t?1:0,s)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,s){this.module.setFacadeOptions(t,s?1:0)}setFauxFacadeOptions(t,s,u){this.module.setFauxFacadeOptions(t?1:0,s?1:0,u)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,s){this.memoryStackNextFree=this.memoryStack;for(let v of t){let b=this.createIntArray(v.ringIndices),C=this.createFloatArray(v.coordinates);if(b===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,C,b,v.ringIndices.length-1)}for(let v of s){let b;b=v.entrances?JSON.parse(v.entrances):[];let C=this.createFloatArray(b),T=this.createFloatArray(v.coordinates);if(C===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,C,b.length,T,v.coordinates.length)}if(!this.module.generateMesh()){let v=this.module.getLastError();return this.readStringBuffer(v)}let u=this.module.getMeshCount(),h=new Array(u);for(let v=0;v<u;v++){let b=this.module.getPositionsPtr(v),C=this.module.getPositionsLength(v),T=new Float32Array(this.module.heapF32.buffer,b,C),I=this.module.getNormalsPtr(v),D=this.module.getNormalsLength(v),O=new Float32Array(this.module.heapF32.buffer,I,D),R=this.module.getAOPtr(v),B=this.module.getAOLength(v),H=new Float32Array(this.module.heapF32.buffer,R,B),$=this.module.getUVPtr(v),Y=this.module.getUVLength(v),Q=new Float32Array(this.module.heapF32.buffer,$,Y),ie=this.module.getFauxFacadePtr(v),he=this.module.getFauxFacadeLength(v),le=new Uint8Array(this.module.heapU8.buffer,ie,he),me=this.module.getIndicesPtr(v),ye=this.module.getIndicesLength(v),we=new Int16Array(this.module.heap16.buffer,me,ye),je=this.module.getBuildingPart(v);h[v]={positions:T,normals:O,ao:H,uv:Q,isFauxFacade:le,indices:we,buildingPart:je}}let m=this.module.getRingCount(),g=[];for(let v=0;v<m;v++){let b=this.module.getRingPtr(v),C=this.module.getRingLength(v),T=new Float32Array(this.module.heapF32.buffer,b,C);g.push(T)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let H0,zI,pc,Eg,BI,Sg=null,Tg=null,Lk=null,V1=null;function Nk(){return Un(self)&&self.worker.dracoUrl?self.worker.dracoUrl:zI||kn.DRACO_URL}function zk(){if(Un(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Eg)return Eg;let l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Eg=WebAssembly.validate(l)?kn.MESHOPT_SIMD_URL:kn.MESHOPT_URL,Eg}function c8(){return V1}let U1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},G0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Bk(l,t,s){let u=s.json.bufferViews.length,h=s.buffers.length;t.bufferView=u,s.json.bufferViews[u]={buffer:h,byteLength:l.byteLength},s.buffers[h]=l}let VI="KHR_draco_mesh_compression";function d8(l,t){let s=l.extensions&&l.extensions[VI];if(!s)return;let u=new pc.Decoder,h=$k(t,s.bufferView),m=new pc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");let g=t.json.accessors[l.indices],v=U1[g.componentType],b=g.count*v.BYTES_PER_ELEMENT,C=pc._malloc(b);v===Uint16Array?u.GetTrianglesUInt16Array(m,b,C):u.GetTrianglesUInt32Array(m,b,C),Bk(pc.memory.buffer.slice(C,C+b),g,t),pc._free(C);for(let T of Object.keys(s.attributes)){let I=u.GetAttributeByUniqueId(m,s.attributes[T]),D=t.json.accessors[l.attributes[T]],O=u8[D.componentType],R=D.count*G0[D.type]*U1[D.componentType].BYTES_PER_ELEMENT,B=pc._malloc(R);u.GetAttributeDataArrayForAllPoints(m,I,pc[O],R,B),Bk(pc.memory.buffer.slice(B,B+R),D,t),pc._free(B)}u.destroy(),m.destroy(),delete l.extensions[VI]}let j1="EXT_meshopt_compression";function h8(l,t){if(!l.extensions||!l.extensions[j1])return;let s=l.extensions[j1],u=new Uint8Array(t.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);BI.decodeGltfBuffer(h,s.count,s.byteStride,u,s.mode,s.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=h.buffer,delete l.extensions[j1]}let Vk=1179937895,Uk=new TextDecoder("utf8");function jk(l,t){return new URL(l,t).href}function p8(l,t,s,u){return fetch(jk(l.uri,u)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[s]=h})}function $k(l,t){let s=l.json.bufferViews[t];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function f8(l,t,s,u){if(l.uri){let h=jk(l.uri,u);return fetch(h).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{t.images[s]=m})}if(l.bufferView!==void 0){let h=$k(t,l.bufferView),m=new Blob([h],{type:l.mimeType});return createImageBitmap(m).then(g=>{t.images[s]=g})}}function Hk(l,t=0,s){let u={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===Vk){let T=new Uint32Array(l,t),I=2,D=(T[I++]>>2)-3,O=T[I++]>>2;if(I++,u.json=JSON.parse(Uk.decode(T.subarray(I,I+O))),I+=O,I<D){let R=T[I++];I++;let B=t+(I<<2);u.buffers[0]=l.slice(B,B+R)}}else u.json=JSON.parse(Uk.decode(new Uint8Array(l,t)));let{buffers:h,images:m,meshes:g,extensionsUsed:v,bufferViews:b}=u.json,C=Promise.resolve();if(h){let T=[];for(let I=0;I<h.length;I++){let D=h[I];D.uri?T.push(p8(D,u,I,s)):u.buffers[I]||(u.buffers[I]=null)}C=Promise.all(T)}return C.then(()=>{let T=[],I=v&&v.includes(VI),D=v&&v.includes(j1);if(I&&T.push((function(){if(!pc)return H0??(H0=(function(O){let R,B=null;function H(){R=new Uint8Array(B.buffer)}function $(){throw new Error("Unexpected Draco error.")}let Y={a:{a:$,d:function(Q,ie,he){return R.copyWithin(Q,ie,ie+he)},c:function(Q){let ie=R.length,he=Math.max(Q>>>0,Math.ceil(1.2*ie)),le=Math.ceil((he-ie)/65536);try{return B.grow(le),H(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,Y):O.then(Q=>Q.arrayBuffer()).then(Q=>WebAssembly.instantiate(Q,Y))).then(Q=>{let{Rb:ie,Qb:he,P:le,T:me,X:ye,Ja:we,La:je,Qa:Ie,Va:We,Wa:Ke,eb:Qe,jb:st,f:lt,e:nt,yb:it,zb:qe,Ab:He,Bb:rt,Db:yt,Gb:ft}=Q.instance.exports;B=nt;let qt=(()=>{let It=0,Ot=0,Bt=0,In=0;return mt=>{Bt&&(ie(In),ie(It),Ot+=Bt,Bt=It=0),It||(Ot+=128,It=he(Ot));let Vt=mt.length+7&-8,un=It;Vt>=Ot&&(Bt=Vt,un=In=he(Vt));for(let Ln=0;Ln<mt.length;Ln++)R[un+Ln]=mt[Ln];return un}})();return H(),lt(),{memory:nt,_free:ie,_malloc:he,Mesh:class{constructor(){this.ptr=le()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){st(this.ptr)}DecodeArrayToMesh(It,Ot,Bt){let In=qt(It),mt=je(this.ptr,In,Ot,Bt.ptr);return!!ye(mt)}GetAttributeByUniqueId(It,Ot){return{ptr:Ie(this.ptr,It.ptr,Ot)}}GetTrianglesUInt16Array(It,Ot,Bt){We(this.ptr,It.ptr,Ot,Bt)}GetTrianglesUInt32Array(It,Ot,Bt){Ke(this.ptr,It.ptr,Ot,Bt)}GetAttributeDataArrayForAllPoints(It,Ot,Bt,In,mt){Qe(this.ptr,It.ptr,Ot.ptr,Bt,In,mt)}},DT_INT8:it(),DT_UINT8:qe(),DT_INT16:He(),DT_UINT16:rt(),DT_UINT32:yt(),DT_FLOAT32:ft()}})})(fetch(Nk())),H0.then(O=>{pc=O,H0=void 0}))})()),D&&T.push((function(){if(BI)return;let O=(function(R){let B,H=WebAssembly.instantiateStreaming(R,{}).then(Q=>{B=Q.instance,B.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(Q,ie,he,le,me,ye){(function(we,je,Ie,We,Ke,Qe,st){let lt=we.exports.sbrk,nt=We+3&-4,it=lt(nt*Ke),qe=lt(Qe.length),He=new Uint8Array(we.exports.memory.buffer);He.set(Qe,qe);let rt=je(it,We,Ke,qe,Qe.length);if(rt===0&&st&&st(it,nt,Ke),Ie.set(He.subarray(it,it+We*Ke)),lt(it-lt(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(B,B.exports[Y[me]],Q,ie,he,le,B.exports[$[ye]])}}})(fetch(zk()));return O.ready.then(()=>{BI=O})})()),m)for(let O=0;O<m.length;O++)T.push(f8(m[O],u,O,s));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&g)for(let{primitives:O}of g)for(let R of O)d8(R,u);if(D&&g&&b)for(let O of b)h8(O,u);return u})})}function Gk(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>Hk(t,0,l))}function UI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function jI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class $I{constructor(t,s,u,h){this.context=t,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=t.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(t,s){let u=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,h=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:m}=this,{gl:g}=m,{x:v,y:b}=s&&s.position?s.position:{x:0,y:0},C=v+u,T=b+h;!this.size||this.size[0]===C&&this.size[1]===T||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));let I=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&C>0&&T>0){let D=this.useMipmap?Math.floor(Math.log2(Math.max(C,T)))+1:1;g.texStorage2D(g.TEXTURE_2D,D,this.format,C,T),this.size=[C,T]}this.size&&(I?g.texSubImage2D(g.TEXTURE_2D,0,v,b,UI(this.format),jI(this.format),t):"data"in t&&t.data&&g.texSubImage2D(g.TEXTURE_2D,0,v,b,u,h,UI(this.format),jI(this.format),t.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,s,u=!1){let{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(t,s,u,h,m){let{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),this.magFilter=s),t!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?t===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class q0{constructor(t,s){this.context=t,this.texture=s}bind(t,s){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}let m8=An([{name:"a_pos_3f",components:3,type:"Float32"}]),g8=An([{name:"a_color_3f",components:3,type:"Float32"}]),_8=An([{name:"a_color_4f",components:4,type:"Float32"}]),v8=An([{name:"a_uv_2f",components:2,type:"Float32"}]),y8=An([{name:"a_normal_3f",components:3,type:"Float32"}]),x8=An([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),b8=An([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function qk(l,t){let s=$1(l.projection,l.zoom,l.width,l.height),u=(function(m,g,v,b,C){let T=new c(v.lng-180*yh,v.lat),I=new c(v.lng+180*yh,v.lat),D=m.project(T.lng,T.lat),O=m.project(I.lng,I.lat),R=-Math.atan2(O.y-D.y,O.x-D.x),B=ee.fromLngLat(v);B.y=G(B.y,-1+yh,1-yh);let H=B.toLngLat(),$=m.project(H.lng,H.lat),Y=ee.fromLngLat(H);Y.x+=yh;let Q=Y.toLngLat(),ie=m.project(Q.lng,Q.lat),he=Zk(ie.x-$.x,ie.y-$.y,R),le=ee.fromLngLat(H);le.y+=yh;let me=le.toLngLat(),ye=m.project(me.lng,me.lat),we=Zk(ye.x-$.x,ye.y-$.y,R),je=Math.abs(he.x)/Math.abs(we.y),Ie=ht([]);Li(Ie,Ie,-R*(1-(C?0:b)));let We=ht([]);return Vn(We,We,[1,1-(1-je)*b,1]),We[4]=-we.x/we.y*b,Li(We,We,R),Mt(We,Ie,We),We})(l.projection,0,l.center,s,t),h=Wk(l);return Vn(u,u,[h,h,1]),u}function Wk(l){let t=l.projection,s=$1(l.projection,l.zoom,l.width,l.height),u=HI(t,l.center),h=HI(t,c.convert(t.center));return Math.pow(2,u*s+(1-s)*h)}function $1(l,t,s,u,h=1/0){let m=l.range;if(!m)return 0;let g=Math.min(h,Math.max(s,u)),v=Math.log2(g/1024);return K(m[0]+v,m[1]+v,t)}let yh=1/4e4;function HI(l,t){let s=G(t.lat,-N,N),u=new c(t.lng-180*yh,s),h=new c(t.lng+180*yh,s),m=l.project(u.lng,s),g=l.project(h.lng,s),v=ee.fromLngLat(u),b=ee.fromLngLat(h),C=g.x-m.x,T=g.y-m.y,I=b.x-v.x,D=b.y-v.y,O=Math.sqrt((I*I+D*D)/(C*C+T*T));return Math.log2(O)}function Zk(l,t,s){let u=Math.cos(s),h=Math.sin(s);return{x:l*u-t*h,y:l*h+t*u}}function Yk(l,t,s){ht(l),Li(l,l,Zn(t[2])),sr(l,l,Zn(t[0])),$i(l,l,Zn(t[1])),Vn(l,l,s),Mt(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function H1(l,t,s,u,h,m,g,v){let b=[s[0]-t[0],s[1]-t[1],0],C=[u[0]-t[0],u[1]-t[1],0];if(xo(b)<1e-12||xo(C)<1e-12)return jd(l);let T=Go([],b,C);Yi(T,T),dl(C,u,t),b[2]=(m-h)*v,C[2]=(g-h)*v;let I=b;return Go(I,b,C),Yi(I,I),$d(l,T,I)}function G1(l,t,s=!1){let u=_h(t.zoom),h=(function(m,g,v){let b=g.worldSize,C=[m[12],m[13],m[14]],T=L(C[1]/b),I=A(C[0]/b),D=ht([]),O=M(1,T)*b,R=M(1,0)*b*U(T,g.zoom),B=1/yI(b),H=R*B;if(v){let ie=$1(g.projection,g.zoom,g.width,g.height,1024);H=B*g.projection.pixelSpaceConversion(g.center.lat,b,ie)}let $=fh(T,I);Wr($,$,fr([],Yi([],$),O*H*C[2]));let Y=(function(ie){let he=[ie[0],ie[1],ie[2]],le=[0,1,0],me=Go([],le,he);return Go(le,he,me),em(le)===0&&(le=[0,1,0],Go(me,he,le)),Yi(me,me),Yi(le,le),Yi(he,he),[me[0],me[1],me[2],0,le[0],le[1],le[2],0,he[0],he[1],he[2],0,ie[0],ie[1],ie[2],1]})($);Vn(D,D,[H,H,H*O]),Xt(D,D,[-C[0],-C[1],-C[2]]);let Q=Mt([],g.globeMatrix,Y);return Mt(Q,Q,D),Mt(Q,Q,m),Q})(l,t,s);if(u>0){let m=(function(g,v){let b=v.worldSize,C=M(1,0)*b*U(v.center.lat,v.zoom)/yI(b),T=M(1,v.center.lat)*b,I=ht([]);$i(I,I,Zn(v.center.lng)),sr(I,I,Zn(v.center.lat)),Xt(I,I,[0,0,Yo]),Vn(I,I,[C,C,C*T]);let D=v.point;return Xt(I,I,[-D.x,-D.y,0]),Mt(I,I,g),Mt(I,v.globeMatrix,I)})(l,t);return(function(g,v,b){let C=(R,B,H)=>{let $=xo(R),Y=xo(B),Q=hc(R,B,H);return fr(Q,Q,1/xo(Q)*on($,Y,H))},T=C([g[0],g[1],g[2]],[v[0],v[1],v[2]],b),I=C([g[4],g[5],g[6]],[v[4],v[5],v[6]],b),D=C([g[8],g[9],g[10]],[v[8],v[9],v[10]],b),O=hc([g[12],g[13],g[14]],[v[12],v[13],v[14]],b);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],0,O[0],O[1],O[2],1]})(h,m,u)}return h}function GI(l,t,s,u){let h=jt.projectAabbCorners(u,s),m=Number.MAX_VALUE;for(let v=0;v<h.length;++v){let b=h[v];b[0]=(.5*b[0]+.5)*t.width,b[1]=(.5-.5*b[1])*t.height,b[2]<m&&(m=b[2])}let g=(function(v){let b=[],C=0;for(let O=1;O<v.length;O++)(v[O][0]<v[C][0]||v[O][0]===v[C][0]&&v[O][1]<v[C][1])&&(C=O);let T,I=C,D=new Uint8Array(v.length);do{if(D[I])break;b.push(new ot(v[I][0],v[I][1])),D[I]=1,T=(I+1)%v.length;for(let O=0;O<v.length;O++){if(v[O][0]===v[T][0]&&v[O][1]===v[T][1]||v[O][0]===v[I][0]&&v[O][1]===v[I][1])continue;let R=[v[O][0]-v[I][0],v[O][1]-v[I][1]],B=[v[T][0]-v[I][0],v[T][1]-v[I][1]],H=R[0]*B[1]-R[1]*B[0];(H>0||H===0&&R[0]*B[0]+R[1]*B[1]>=0&&R[0]*R[0]+R[1]*R[1]>B[0]*B[0]+B[1]*B[1])&&(T=O)}I=T}while(I!==C);return b.length>0&&b.push(b[0]),b})(h);if(Wn(l,g))return m}let Yp=64,Ig={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function q1(l,t,s,u,h,m,g,v,b,C=!1){let T=s.zoom,I=s.project(u),D=U(u.lat,T),O=1/D;ht(l),Xt(l,l,[I.x+g[0]*O,I.y+g[1]*O,g[2]]);let R=1,B=1,H=s.worldSize;if(C){if(s.projection.name==="mercator"){let ie=0;s.elevation&&(ie=s.elevation.getAtPointOrZero(new ee(I.x/H,I.y/H),0));let he=qo([],[I.x,I.y,ie,1],s.projMatrix)[3]/s.cameraToCenterDistance;R=he,B=he*U(s.center.lat,T)}else if(s.projection.name==="globe"){let ie=G1(l,s),he=[0,0,0,1];qo(he,he,Mt([],s.projMatrix,ie));let le=he[3]/s.cameraToCenterDistance,me=_h(T),ye=s.projection.pixelsPerMeter(u.lat,H)*U(u.lat,T),we=s.projection.pixelsPerMeter(s.center.lat,H)*U(s.center.lat,T);R=le/on(ye,j(s.center.lat),me),B=le*D/ye,R*=we,B*=we}}else R=O;Vn(l,l,[R,R,B]);let $=[...l],Y=t.orientation,Q=[];if(Yk(Q,[Y[0]+(h?h[0]:0),Y[1]+(h?h[1]:0),Y[2]+(h?h[2]:0)],m),Mt(l,$,Q),v&&s.elevation){let ie=0,he=[];if(b&&s.elevation){ie=(function(me,ye,we,je,Ie){let We=ye.elevation;if(!We)return 0;let Ke=jt.projectAabbCorners(we,je),Qe=M(1,Ie.lat)*ye.worldSize,st=(function(Ot,Bt){let In=[0,0,1],mt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Vt of mt){let un=Ot[Vt.corners[0]],Ln=Ot[Vt.corners[1]],zn=Ot[Vt.corners[2]],_n=[Ln[0]-un[0],Ln[1]-un[1],Bt*(Ln[2]-un[2])],gi=Go(_n,_n,[zn[0]-un[0],zn[1]-un[1],Bt*(zn[2]-un[2])]);Yi(gi,gi),Vt.dotProductWithUp=Ir(gi,In)}return mt.sort((Vt,un)=>Vt.dotProductWithUp-un.dotProductWithUp),mt[0].corners})(Ke,Qe),lt=Ke[st[0]],nt=Ke[st[1]],it=Ke[st[2]],qe=Ke[st[3]],He=We.getAtPointOrZero(new ee(lt[0]/ye.worldSize,lt[1]/ye.worldSize),0),rt=We.getAtPointOrZero(new ee(nt[0]/ye.worldSize,nt[1]/ye.worldSize),0),yt=We.getAtPointOrZero(new ee(it[0]/ye.worldSize,it[1]/ye.worldSize),0),ft=We.getAtPointOrZero(new ee(qe[0]/ye.worldSize,qe[1]/ye.worldSize),0),qt=(He+ft)/2,It=(rt+yt)/2;return qt>It?rt<yt?H1(me,nt,qe,lt,rt,ft,He,Qe):H1(me,it,lt,qe,yt,He,ft,Qe):He<ft?H1(me,lt,nt,it,He,rt,yt,Qe):H1(me,qe,it,nt,ft,yt,rt,Qe),Math.max(qt,It)})(he,s,t.aabb,l,u);let le=Mt([],Nu([],he),Q);Mt(l,$,le)}else ie=s.elevation.getAtPointOrZero(new ee(I.x/H,I.y/H),0);ie!==0&&(l[14]+=ie)}}class Xk{constructor(t,s,u,h,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=t,this.uri=s,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=h??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,s){Mt(t.globalMatrix,s,t.localMatrix);let u=this.nodeOverrides.get(t.name);if(u!==void 0){let g=[];m=u.orientation,ht(h=g),$i(h,h,Zn(m[1])),Li(h,h,Zn(m[2])),sr(h,h,Zn(m[0])),Mt(t.globalMatrix,t.globalMatrix,g)}var h,m;if(t.meshes)for(let g of t.meshes){let v=jt.applyTransformFast(g.aabb,t.globalMatrix);this.aabb.encapsulate(v)}if(t.children)for(let g of t.children)this._applyTransformations(g,t.globalMatrix)}computeBoundsAndApplyParent(){let t=ht([]);this.aabb=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.nodes)this._applyTransformations(s,t)}computeModelMatrix(t,s,u,h,m,g,v=!1){q1(this.matrix,this,t.transform,this.position,s,u,h,m,g,v)}upload(t){if(!this.uploaded){for(let s of this.nodes)qI(s,t);for(let s of this.nodes)W1(s);this.uploaded=!0}}destroy(){for(let t of this.nodes)WI(t)}}function W0(l,t,s=!1){l.uploaded||(l.gfxTexture=new $I(t,l.image,s?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function w8(l,t,s){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,m8.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,y8.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,v8.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?g8:_8).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,b8.members,!0)),l.segments=nr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);let u=l.material;u.pbrMetallicRoughness.baseColorTexture&&W0(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&W0(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&W0(u.normalTexture,t),u.occlusionTexture&&W0(u.occlusionTexture,t,s),u.emissionTexture&&W0(u.emissionTexture,t)}function qI(l,t,s){if(l.meshes)for(let u of l.meshes)w8(u,t,s);if(l.children)for(let u of l.children)qI(u,t,s)}function W1(l){if(l.meshes)for(let t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(let t of l.children)W1(t)}function WI(l){if(l.meshes)for(let s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((t=s.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(let s of l.children)WI(s)}function Xp(l,t){let s=l.json.bufferViews[t.bufferView],u=U1[t.componentType];return new u(l.buffers[s.buffer],(t.byteOffset||0)+(s.byteOffset||0),t.count*(s.byteStride&&s.byteStride!==G0[t.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:G0[t.type]))}function ZI(l,t,s,u){let h=U1[t.componentType],m=(function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),g=l.json.bufferViews[t.bufferView],v=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:G0[t.type],b=s.float32,C=b.length/s.capacity;for(let T=0,I=0;T<t.count*v;T+=v,I+=C)for(let D=0;D<C;D++)b[I+D]=u[T+D]*m;s._trim()}function C8(l,t,s){let u=l.indices,h=l.attributes,m={};m.indexArray=new Xr;let g=t.json.accessors[u],v=g.count/3;m.indexArray.reserve(v);let b=Xp(t,g);for(let D=0;D<v;D++)m.indexArray.emplaceBack(b[3*D],b[3*D+1],b[3*D+2]);m.indexArray._trim(),m.vertexArray=new ea;let C=t.json.accessors[h.POSITION];m.vertexArray.reserve(C.count);let T=Xp(t,C);for(let D=0;D<C.count;D++)m.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(m.vertexArray._trim(),m.aabb=new jt(C.min,C.max),m.centroid=(function(D,O){let R=[0,0,0],B=D.length;if(B>0){for(let H=0;H<B;H++){let $=3*D[H];R[0]+=O[$],R[1]+=O[$+1],R[2]+=O[$+2]}R[0]/=B,R[1]/=B,R[2]/=B}return R})(b,T),h.COLOR_0!==void 0){let D=t.json.accessors[h.COLOR_0],O=G0[D.type],R=Xp(t,D);m.colorArray=O===3?new ea:new ou,m.colorArray.resize(D.count),ZI(t,D,m.colorArray,R)}if(h.NORMAL!==void 0){m.normalArray=new ea;let D=t.json.accessors[h.NORMAL];m.normalArray.resize(D.count);let O=Xp(t,D);ZI(t,D,m.normalArray,O)}if(h.TEXCOORD_0!==void 0&&s.length>0){m.texcoordArray=new Sl;let D=t.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(D.count);let O=Xp(t,D);ZI(t,D,m.texcoordArray,O)}if(h._FEATURE_ID_RGBA4444!==void 0){let D=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Xp(t,D))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Xp(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));let I=l.material;return m.material=(function(D,O){let{emissiveFactor:R=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:H=.5,normalTexture:$,occlusionTexture:Y,emissiveTexture:Q,doubleSided:ie,name:he}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:me=1,roughnessFactor:ye=1,baseColorTexture:we,metallicRoughnessTexture:je}=D.pbrMetallicRoughness||{},Ie=Y?O[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&Ie){let We=Y.extensions.KHR_texture_transform;Ie.offsetScale=[We.offset[0],We.offset[1],We.scale[0],We.scale[1]]}return{name:he,pbrMetallicRoughness:{baseColorFactor:new ui(...le),metallicFactor:me,roughnessFactor:ye,baseColorTexture:we?O[we.index]:void 0,metallicRoughnessTexture:je?O[je.index]:void 0},doubleSided:ie,emissiveFactor:new ui(...R),alphaMode:B,alphaCutoff:H,normalTexture:$?O[$.index]:void 0,occlusionTexture:Ie,emissionTexture:Q?O[Q.index]:void 0,defined:D.defined===void 0}})(I!==void 0?t.json.materials[I]:{defined:!1},s),m}function Kk(l,t,s){let{matrix:u,rotation:h,translation:m,scale:g,mesh:v,extras:b,children:C,name:T}=l,I={};if(I.name=T,I.localMatrix=u||(function(D,O,R,B){var H=O[0],$=O[1],Y=O[2],Q=O[3],ie=H+H,he=$+$,le=Y+Y,me=H*ie,ye=H*he,we=H*le,je=$*he,Ie=$*le,We=Y*le,Ke=Q*ie,Qe=Q*he,st=Q*le,lt=B[0],nt=B[1],it=B[2];return D[0]=(1-(je+We))*lt,D[1]=(ye+st)*lt,D[2]=(we-Qe)*lt,D[3]=0,D[4]=(ye-st)*nt,D[5]=(1-(me+We))*nt,D[6]=(Ie+Ke)*nt,D[7]=0,D[8]=(we+Qe)*it,D[9]=(Ie-Ke)*it,D[10]=(1-(me+je))*it,D[11]=0,D[12]=R[0],D[13]=R[1],D[14]=R[2],D[15]=1,D})([],h||[0,0,0,1],m||[0,0,0],g||[1,1,1]),I.globalMatrix=ke(I.localMatrix),v!==void 0){I.meshes=s[v];let D=I.anchor=[0,0];for(let O of I.meshes){let{min:R,max:B}=O.aabb;D[0]+=R[0]+B[0],D[1]+=R[1]+B[1]}D[0]=Math.floor(D[0]/I.meshes.length/2),D[1]=Math.floor(D[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=(function(D){if(!D.length)return[];let O=(function(Y){let Q=atob(Y),ie=new Uint8Array(Q.length);for(let he=0;he<Q.length;he++)ie[he]=Q.codePointAt(he);return ie})(D),R=[],B=O.length/24,H=new Uint16Array(O.buffer),$=new Float32Array(O.buffer);for(let Y=0;Y<B;Y++){let Q=H[2*Y*6]/30,ie=H[2*Y*6+1]/30,he=H[2*Y*6+10]/100,le=$[6*Y+1],me=$[6*Y+2],ye=$[6*Y+3],we=$[6*Y+4],je=ye-le,Ie=we-me,We=Math.hypot(je,Ie);R.push({pos:[le+.5*je,me+.5*Ie,ie],normal:[Ie/We,-je/We,0],width:We,height:Q,depth:he,points:[le,me,ye,we]})}return R})(b.lights)),b.MAPBOX_geometry_bloom&&(I.isGeometryBloom=b.MAPBOX_geometry_bloom)),C){let D=[];for(let O of C)D.push(Kk(t.json.nodes[O],t,s));I.children=D}return I}function E8(l){if(l.vertices.length===0||l.indices.length===0)return null;let t=new O1(l.vertices,l.indices,8,256),[s,u]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:s,max:u}}function S8(l){if(!l.extras||!l.extras.ground)return null;let t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let s=t[0];if(!s||!Array.isArray(s)||s.length===0)return null;let u=[];for(let g of s){if(!Array.isArray(g)||g.length!==2)continue;let v=g[0],b=g[1];typeof v=="number"&&typeof b=="number"&&u.push(new ot(v,b))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let g=0;g<u.length;g++){let v=u[g],b=u[(g+1)%u.length],C=u[(g+2)%u.length];h+=(v.x-b.x)*(C.y-b.y)-(C.x-b.x)*(v.y-b.y)}h>0&&u.reverse();let m=bg(u.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:u,indices:m}}function T8(l,t){let s=[],u=[],h=0,m=[];for(let g of l){h=s.length;let v=g.vertexArray.float32,b=g.indexArray.uint16;for(let C=0;C<g.vertexArray.length;C++)m[0]=v[3*C+0],m[1]=v[3*C+1],m[2]=v[3*C+2],Fr(m,m,t),s.push(new ot(m[0],m[1]));for(let C=0;C<3*g.indexArray.length;C++)u.push(b[C]+h)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){let v=s[u[g+0]],b=s[u[g+1]],C=s[u[g+2]];(v.x-b.x)*(C.y-b.y)-(C.x-b.x)*(v.y-b.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function YI(l){let t=(function(b,C){let T=[],I=WebGL2RenderingContext;if(b.json.textures)for(let D of b.json.textures){let O={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};D.sampler!==void 0&&Object.assign(O,b.json.samplers[D.sampler]),T.push({image:C[D.source],sampler:O,uploaded:!1})}return T})(l,l.images),s=(function(b,C){let T=[];for(let I of b.json.meshes){let D=[];for(let O of I.primitives)D.push(C8(O,b,C));T.push(D)}return T})(l,t),{scenes:u,scene:h,nodes:m}=l.json,g=u?u[h||0].nodes:[...m.keys()],v=[];for(let b of g)v.push(Kk(m[b],l,s));return(function(b,C,T){let I={},D=new Set;for(let O=0;O<b.length;O++){let R=T[C[O]];if(!R.extras)continue;let B=R.extras["mapbox:footprint:version"],H=R.extras["mapbox:footprint:id"];(B||H)&&D.add(O),B==="1.0.0"&&H&&(I[H]=O)}for(let O=0;O<b.length;O++){if(D.has(O))continue;let R=b[O],B=T[C[O]];if(!B.extras)continue;let H=null;R.id in I&&(H=T8(b[I[R.id]].meshes,R.localMatrix)),H||(H=S8(B)),H&&(R.footprint=E8(H))}if(D.size>0){let O=Array.from(D.values()).sort((R,B)=>R-B);for(let R=O.length-1;R>=0;R--)b.splice(O[R],1)}})(v,g,l.json.nodes),v}function I8(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);let t=l.vertexArray.float32,s=l.aabb.min[0]-1,u=l.aabb.min[1]-1,h=Yp/(l.aabb.max[0]-s+2),m=Yp/(l.aabb.max[1]-u+2);for(let g=0;g<t.length;g+=3){let v=t[g+2],b=(t[g+0]-s)*h|0,C=(t[g+1]-u)*m|0;v>l.heightmap[C*Yp+b]&&(l.heightmap[C*Yp+b]=v)}}function Qk(l,t,s,u,h){s.reserve(s.length+4*l.length),u.reserve(u.length+10*l.length),h.reserve(h.length+10*l.length);let m=u.length;for(let g of l){let v=Math.min(10,Math.max(4,1.3*g.height))*t,b=[-g.normal[1],g.normal[0],0],C=Math.min(.29,.1*g.width/g.depth),T=g.width-2*g.depth*t*(C+.01),I=Xs([],g.pos,b,T/2),D=Xs([],g.pos,b,-T/2),O=[I[0],I[1],I[2]+g.height],R=[D[0],D[1],D[2]+g.height],B=Xs([],g.normal,b,C);fr(B,B,v);let H=Xs([],g.normal,b,-C);fr(H,H,v),Wr(B,I,B),Wr(H,D,H),I[2]+=.1,D[2]+=.1,u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(O[0],O[1],O[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(H[0],H[1],H[2]);let $=T/v/2;h.emplaceBack(-$-C,-1,$,.8),h.emplaceBack($+C,-1,$,.8),h.emplaceBack(-$,0,$,1.3),h.emplaceBack($,0,$,1.3),h.emplaceBack($+C,-.8,$,.7),h.emplaceBack($+C,-.8,$,.7),h.emplaceBack(0,0,$,1.3),h.emplaceBack(0,0,$,1.3),h.emplaceBack($+C,-1.2,$,.8),h.emplaceBack($+C,-1.2,$,.8),s.emplaceBack(6+m,4+m,8+m),s.emplaceBack(7+m,9+m,5+m),s.emplaceBack(0+m,1+m,2+m),s.emplaceBack(1+m,3+m,2+m),m+=10}}function M8(l,t){let s={};s.indexArray=new Xr,s.vertexArray=new ea,s.colorArray=new ou,Qk(l,t,s.indexArray,s.vertexArray,s.colorArray);let u={defined:!0};u.emissiveFactor=ui.black;let h={};return h.baseColorFactor=ui.white,u.pbrMetallicRoughness=h,s.material=u,s.aabb=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}let Jk=An([{name:"a_pos_3f",components:3,type:"Float32"}]),D8=An([{name:"a_normal_3",components:3,type:"Int16"}]),A8=An([{name:"a_centroid_3",components:3,type:"Int16"}]),eF=An([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),P8=An([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),O8=An([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),R8=An([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),k8=An([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),F8=An([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),tF=Ce.types,Z1=32767;function L8(l,t){let s=vt+t;for(let u of l)for(let h of u)if(h.x<-t||h.x>s||h.y<-t||h.y>s)return!1;return!0}function N8(l){switch(l){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${l}`)}}class XI{constructor(){this.layoutVertexArray=new ea,this.layoutAttenuationArray=new ou,this.layoutColorArray=new ta,this.indexArray=new Xr,this.indexArrayForConflation=new Xr,this.segmentsBucket=new nr}}class KI{constructor(t){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new nr,this.entranceBloom=new XI;let s=66560;this.layoutVertexArray=new ea,this.layoutVertexArray.reserve(s),this.layoutNormalArray=new lh,this.layoutNormalArray.reserve(s),this.layoutCentroidArray=new lh,this.layoutCentroidArray.reserve(s),this.layoutColorArray=new ta,this.layoutColorArray.reserve(s),this.layoutFloodLightDataArray=new su,this.layoutFloodLightDataArray.reserve(s),this.layoutAOArray=new cg,this.layoutAOArray.reserve(s),this.indexArray=new Xr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Xr,this.segmentsBucket=new nr,this.entranceBloom=new XI,t&&(this.layoutFacadePaintArray=new ta,this.layoutFacadeDataArray=new pd,this.layoutFacadeVerticalRangeArray=new ta)}reserve(t,s,u){this.layoutVertexArray.reserveForAdditional(t),this.layoutCentroidArray.reserveForAdditional(t),this.layoutFloodLightDataArray.reserveForAdditional(t),this.layoutNormalArray.reserveForAdditional(t),this.layoutAOArray.reserveForAdditional(t),this.layoutColorArray.reserveForAdditional(t),this.indexArray.reserveForAdditional(s),u&&(this.layoutFacadePaintArray.reserveForAdditional(t),this.layoutFacadeDataArray.reserveForAdditional(t),this.layoutFacadeVerticalRangeArray.reserveForAdditional(t))}}class nF{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Sl,this.footprintsIndices=new su,this.footprintsMin=new ot(1/0,1/0),this.footprintsMax=new ot(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new KI(!1),this.buildingWithFacade=new KI(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection,this.groundEffect=new RI(t),this.groundEffect.groundRadiusArray=new oc,this.hasAppearances=null}updateFootprints(t,s){let u=new O1([],[],1),h={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};s.push({footprint:h,id:t})}updateAppearances(t,s,u,h){}prepare(){return(function(){if(V1!=null||Lk!=null)return null;if(Tg!=null)return Tg;let t=fetch(kn.BUILDING_GEN_URL);return Tg=(function(s){let u,h,m,g,v;function b(){u=new Uint8Array(v.buffer),h=new Int16Array(v.buffer),m=new Int32Array(v.buffer),g=new Float32Array(v.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}let T=()=>{},I={a:{a:C,f:function(D){let O=u.length,R=Math.max(D>>>0,Math.ceil(1.2*O)),B=Math.ceil((R-O)/65536);try{return v.grow(B),b(),!0}catch{return!1}},g:C,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,I):s.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,I))).then(D=>{let O=D.instance.exports;return(0,O.g)(),v=O.f,b(),new l8({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getAOPtr:O.y,getAOLength:O.z,getUVPtr:O.A,getUVLength:O.B,getFauxFacadePtr:O.C,getFauxFacadeLength:O.D,getIndicesPtr:O.E,getIndicesLength:O.F,getBuildingPart:O.G,getRingCount:O.H,getRingPtr:O.I,getRingLength:O.J,malloc:O.K,free:O.L,heapU8:u,heap16:h,heap32:m,heapF32:g})})})(t).then(s=>(Tg=null,V1=s,V1)).catch(s=>{At("Could not load building-gen"),Tg=null,Lk=s}),Tg})()}populate(t,s,u,h){let m=c8();if(!m)return;let g=q(u);this.tileToMeter=g,this.brightness=s.brightness,m.setStyle({normalScale:[1,-1,g],tileToMeters:g}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);let v=new Map,b=new Map,C=0;for(let{feature:$}of t){if(tF[$.type]!=="LineString"){v.set($.id,$.properties.source_id);continue}let Y=this.layers[0]._featureFilter.needGeometry;if(Y&&!this.layers[0]._featureFilter.filter(new Vi(this.zoom),$,u))continue;let Q=Te($,Y);if(!Y&&!this.layers[0]._featureFilter.filter(new Vi(this.zoom),Q,u))continue;let ie=Y?Q.geometry:_e($,u,h),he=[];for(let we of ie)for(let je of we)he.push(je.x),he.push(je.y);let le={coordinates:he,crossPerc:$.properties.cross_perc,distanceToRoad:$.properties.distance_to_road,entrances:$.properties.entrances,sourceId:0},me=$.properties.source_id,ye=b.get(me);ye||(ye=[],b.set(me,ye)),ye.push(le),++C}this.maxHeight=0;let T=new Array,I=new Set,D=$=>{$!=null&&I.add($)},O=($,Y)=>{$!=null&&T.push({buildingId:$,footprintIndex:Y})},R=64*(t.length-C),B=R/2;this.buildingWithFacade.reserve(R,B,!0),this.buildingWithoutFacade.reserve(2*R,2*B,!1),this.footprintsIndices.reserve(16*(t.length-C)),this.footprintsVertices.reserve(8*(t.length-C));for(let{feature:$,id:Y,index:Q,sourceLayerIndex:ie}of t){if(tF[$.type]==="LineString")continue;let he=this.layers[0]._featureFilter.needGeometry;if(he&&!this.layers[0]._featureFilter.filter(new Vi(this.zoom),$,u))continue;let le=null;if($.properties&&$.properties.hasOwnProperty("building_id")&&(le=$.properties.building_id,I.has(le)))continue;let me=Te($,he);if(!he&&!this.layers[0]._featureFilter.filter(new Vi(this.zoom),me,u))continue;let ye=he?me.geometry:_e($,u,h),we=L0(ye,500),je=!1;for(let nn of we)if(nn.length!==1){je=!0;break}if(je){D(le);continue}if(!L8(ye,163)){D(le);continue}let Ie=this.layers[0],We=N8(Ie.layout.get("building-roof-shape").evaluate($,{},u)),Ke=Ie.layout.get("building-base").evaluate($,{},u),Qe=Ie.layout.get("building-height").evaluate($,{},u),st=Ie.layout.get("building-flood-light-ground-radius").evaluate($,{},u),lt=Ie.paint.get("building-ambient-occlusion-intensity"),nt=st/this.tileToMeter;$.properties["building-part"]="roof";let it=Ie.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),qe=Ie.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="wall";let He=Ie.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),rt=Ie.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="window";let yt=Ie.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),ft=Ie.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="door";let qt=Ie.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),It=Ie.paint.get("building-emissive-strength").evaluate($,{},this.canonical),Ot=Ie.layout.get("building-flood-light-wall-radius").evaluate($,{},u);Ot=G(Ot,0,2048);let Bt=Ot/2048*Z1,In=v.get(Y),mt=b.get(In)||[],Vt=mt.length!==0&&Ie.layout.get("building-facade").evaluate($,{},u);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(Vt,!1,1);let un=0,Ln=0,zn=0,_n=0,gi=0,ce=0,pe=0,Ze=0,at=0,Et=0,St=0;if(Vt){let nn=Math.round(Ie.layout.get("building-facade-floors").evaluate($,{},u));if(Ke===0){nn=Math.max(1,nn-(mt.length>0?1:0));let pi=4;if(Qe>100){let Qi=[10,13,15];pi=Qi[$.id?$.id%Qi.length:0]}else Qe<=10&&(pi=3);m.setFacadeOptions(pi,!0),gi=(Qe<15?1.3:1.61803)*pi/g}else gi=Ke/g;ce=Qe/g,gi=Math.min(gi,ce),zn=Ie.layout.get("building-facade-unit-width").evaluate($,{},u)/g,_n=(ce-gi)/nn,m.setFauxFacadeOptions(!0,!0,zn);let or=Ie.layout.get("building-facade-window").evaluate($,{},u);un=or[0],Ln=or[1],pe=Math.floor(65535*Math.min(1,gi/vt)),Ze=Math.floor(65535*Math.min(1,ce/vt)),at=Math.floor(255*un)<<8|Math.floor(255*Ln),Et=Math.floor(65535*Math.min(1,zn/vt)),St=Math.floor(65535*Math.min(1,_n/vt))}let Wt=Array(we.length),Yt={x:1/0,y:1/0},mn={x:-1/0,y:-1/0},Cn={x:0,y:0},Tn=0;for(let nn=0;nn<we.length;nn++){let or=we[nn];if(or.length>0){let pi=[],Qi=Array(or.length+1);Qi[0]=0;for(let Jr=0;Jr<or.length;Jr++){let mo=or[Jr];for(let jr=0;jr<mo.length;jr++){let $r=mo[mo.length-jr-1];Yt.x=Math.min(Yt.x,$r.x),Yt.y=Math.min(Yt.y,$r.y),mn.x=Math.max(mn.x,$r.x),mn.y=Math.max(mn.y,$r.y),Cn.x+=$r.x,Cn.y+=$r.y,Tn++,pi.push($r.x),pi.push($r.y)}Qi[Jr+1]=pi.length}Wt[nn]={id:$.id?$.id:0,height:Qe,minHeight:Ke,sourceId:0,roofType:We,coordinates:pi,ringIndices:Qi}}}Cn.x/=Tn||1,Cn.y/=Tn||1;let Pn=m.generateMesh(Wt,mt);if(typeof Pn=="string"){At(`Unable to generate building ${$.id}: ${Pn}`),D(le);continue}if(Pn.meshes.length===0||Pn.modifiedPolygonRings.length===0){D(le);continue}let rn=Vt?this.buildingWithFacade:this.buildingWithoutFacade,cn=0;for(let nn of Pn.meshes)cn+=nn.positions.length/3;let Hn=rn.segmentsBucket.prepareSegment(cn,rn.layoutVertexArray,rn.indexArray),Xn=[],Kn=null,hi=0,Ii=-1,_i=rn.layoutVertexArray.length,ei=_i+cn;rn.layoutVertexArray.resize(ei),rn.layoutCentroidArray.resize(ei),rn.layoutNormalArray.resize(ei),rn.layoutAOArray.resize(ei),rn.layoutColorArray.resize(ei),rn.layoutFloodLightDataArray.resize(ei),Vt&&(rn.layoutFacadePaintArray.resize(ei),rn.layoutFacadeDataArray.resize(ei),rn.layoutFacadeVerticalRangeArray.resize(ei));let oi=rn.indexArray.length,En=0,Nn=_i;for(let nn of Pn.meshes){let or,pi;if(nn.buildingPart===1)or=it,pi=qe;else if(nn.buildingPart===0)or=He,pi=rt;else if(nn.buildingPart===2)or=yt,pi=ft;else{if(nn.buildingPart!==3)continue;or=qt,pi=It}if(pi=G(pi,0,1),nn.buildingPart===3){let zi=new Array;for(let eo=0;eo<nn.positions.length;eo+=12){let Dl=nn.positions[eo+0],du=nn.positions[eo+1],Lo=nn.positions[eo+3],vs=nn.positions[eo+4],oa=nn.positions[eo+2],Ch=nn.positions[eo+8]-oa,Vg=1,vc=Lo-Dl,yc=vs-du,_y=Math.hypot(vc,yc);zi.push({pos:[Dl+.5*vc,du+.5*yc,oa],normal:[yc/_y,-vc/_y,0],width:_y,height:Ch,depth:Vg,points:[Dl,du,Lo,vs]})}let Cr=rn.entranceBloom.segmentsBucket.prepareSegment(10*zi.length,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.indexArray),Ar=rn.entranceBloom.layoutVertexArray.length;hi=rn.entranceBloom.indexArray.length,Qk(zi,.5/this.tileToMeter,rn.entranceBloom.indexArray,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.layoutAttenuationArray);let Us=rn.entranceBloom.layoutVertexArray.length-Ar;Ii=rn.entranceBloom.indexArray.length-hi;for(let eo=0;eo<Us;eo++)rn.entranceBloom.layoutColorArray.emplaceBack(255*qt.r<<8|255*qt.g,255*qt.b<<8|51*It);Cr.vertexLength+=Us,Cr.primitiveLength+=Ii,Kn={part:nn.buildingPart,vertexOffset:Ar,vertexLength:Us}}rn.layoutVertexArray.float32.set(nn.positions,3*Nn);let Qi=nn.positions.length/3;for(let zi=0;zi<Qi;++zi){let Cr=3*zi;En=Math.max(En,nn.positions[Cr+2]);let Ar=nn.normals[Cr+1]*Z1,Us=nn.normals[Cr+2]*Z1,eo=3*(Nn+zi);rn.layoutNormalArray.int16[eo]=nn.normals[Cr]*Z1,rn.layoutNormalArray.int16[eo+1]=Ar,rn.layoutNormalArray.int16[eo+2]=Us;let Dl=nn.ao[zi];rn.layoutAOArray.uint8[Nn+zi]=255*Dl;let du=1+(Dl-1)*lt,Lo=255*or.b*du<<8|255*pi;rn.layoutColorArray.uint16[2*(Nn+zi)]=255*or.r*du<<8|255*or.g*du,rn.layoutColorArray.uint16[2*(Nn+zi)+1]=Lo}let Jr=Math.floor(Cn.x),mo=Math.floor(Cn.y),jr=Math.floor(Qe);for(let zi=0;zi<Qi;++zi){let Cr=3*(Nn+zi);rn.layoutCentroidArray.int16[Cr]=Jr,rn.layoutCentroidArray.int16[Cr+1]=mo,rn.layoutCentroidArray.int16[Cr+2]=jr}if(rn.layoutFloodLightDataArray.uint16.fill(nn.buildingPart===0?Bt:0,Nn,Nn+Qi),Vt){let zi=255*yt.r<<8|255*yt.g,Cr=255*yt.b<<8|255*ft;for(let Ar=0;Ar<Qi;++Ar){let Us=2*(Nn+Ar);rn.layoutFacadePaintArray.uint16[Us]=zi,rn.layoutFacadePaintArray.uint16[Us+1]=Cr}for(let Ar=0;Ar<Qi;++Ar)if(nn.isFauxFacade[Ar]){let Us=Math.min(65535,Math.floor(nn.uv[2*Ar]*Pn.outerRingLength));rn.layoutFacadeDataArray.emplace(Nn+Ar,1|Us,at,Et,St),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Ar,pe,Ze)}else rn.layoutFacadeDataArray.emplace(Nn+Ar,0,0,0,0),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Ar,0,0)}let $r=Hn.vertexLength,ao=nn.indices.length/3,Ps=rn.indexArray.length;rn.indexArray.resize(Ps+ao);for(let zi=0;zi<ao;++zi){let Cr=3*zi,Ar=3*Ps+Cr;rn.indexArray.uint16[Ar]=$r+nn.indices[Cr],rn.indexArray.uint16[Ar+1]=$r+nn.indices[Cr+1],rn.indexArray.uint16[Ar+2]=$r+nn.indices[Cr+2]}nn.buildingPart!==1&&nn.buildingPart!==0&&nn.buildingPart!==2&&nn.buildingPart!==3||Xn.push({part:nn.buildingPart,vertexOffset:Nn,vertexLength:nn.positions.length/3}),Nn+=Qi,Hn.vertexLength+=Qi,Hn.primitiveLength+=nn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,En);let tr=rn.indexArray.length-oi,tn=this.footprintsIndices.length,On=this.footprintsVertices.length,bi=[],Oi=new ot(1/0,1/0),Ui=new ot(-1/0,-1/0),Dr=this.groundEffect.vertexArray.length;for(let nn of Pn.modifiedPolygonRings){let or=[],pi=new ot(1/0,1/0),Qi=new ot(-1/0,-1/0);for(let Jr=0;Jr<nn.length;Jr+=2){let mo=nn.length-Jr-2;pi.x=Math.min(pi.x,nn[mo]),pi.y=Math.min(pi.y,nn[mo+1]),Qi.x=Math.max(Qi.x,nn[mo]),Qi.y=Math.max(Qi.y,nn[mo+1]);let jr=new ot(nn[mo],nn[mo+1]);or.push(jr),bi.push(jr.x,jr.y),this.footprintsVertices.emplaceBack(jr.x,jr.y)}Oi.x=Math.min(Oi.x,pi.x),Oi.y=Math.min(Oi.y,pi.y),Ui.x=Math.max(Ui.x,Qi.x),Ui.y=Math.max(Ui.y,Qi.y),this.groundEffect.addData(or,[pi,Qi],nt)}let Ni=this.groundEffect.vertexArray.length-Dr;this.groundEffect.groundRadiusArray.reserveForAdditional(Ni);for(let nn=0;nn<Ni;nn++)this.groundEffect.groundRadiusArray.emplaceBack(st);(Yt.x<0||mn.x>vt||Yt.y<0||mn.y>vt)&&this.featuresOnBorder.push({featureId:$.id,footprintIndex:this.footprints.length});{let nn=bg(bi,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+nn.length),this.footprintsIndices.uint16.set(nn,tn),this.buildingIds.add(le??$.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Oi.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Oi.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Ui.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Ui.y);let or={footprintVertexOffset:On,footprintVertexLength:this.footprintsVertices.length-On,footprintIndexOffset:tn,footprintIndexLength:this.footprintsIndices.length-tn,min:Oi,max:Ui,hiddenFlags:0,indicesOffset:oi,indicesLength:tr,bloomIndicesOffset:hi,bloomIndicesLength:Ii,groundEffectVertexOffset:Dr,groundEffectVertexLength:Ni,hasFauxFacade:Vt,height:En,promoteId:Y,feature:me,parts:Xn,buildingBloom:Kn},pi=this.footprints.length;$.id!==void 0&&this.featureFootprintLookup.set($.id,pi),O(le,pi),this.footprints.push(or)}this.programConfigurations.populatePaintArrays(rn.layoutVertexArray.length,$,Q,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData($,Q,{},s.availableImages,u,s.brightness),s.featureIndex.insert($,ye,Q,ie,this.index,_i)}T.forEach(({buildingId:$,footprintIndex:Y})=>{I.has($)&&(this.footprints[Y].hiddenFlags|=4)});let H=new Set;this.buildingIds.forEach(($,Y,Q)=>{I.has($)||H.add($)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v),this.groundEffect.update(t,s,m,u,h,g,v),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){let s=u=>{u.layoutVertexBuffer=t.createVertexBuffer(u.layoutVertexArray,Jk.members),u.layoutNormalBuffer=t.createVertexBuffer(u.layoutNormalArray,D8.members),u.layoutCentroidBuffer=t.createVertexBuffer(u.layoutCentroidArray,A8.members),u.layoutFloodLightDataBuffer=t.createVertexBuffer(u.layoutFloodLightDataArray,F8.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=t.createVertexBuffer(u.layoutFacadeDataArray,O8.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(u.layoutFacadeVerticalRangeArray,R8.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(u.entranceBloom.layoutVertexArray,Jk.members),u.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,k8.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){let t=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,s,u=!0){let h=!1,m=u?s:0,g=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let v of t){let b=this.footprints[v],C=b.hiddenFlags&g|m;b.hiddenFlags!==C&&(b.hiddenFlags=C,h=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;let s=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(let h of this.footprints){let m=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let b=h.indicesOffset;b<g;b++)m.indexArrayForConflation.uint16[3*b+0]=0,m.indexArrayForConflation.uint16[3*b+1]=0,m.indexArrayForConflation.uint16[3*b+2]=0;let v=h.bloomIndicesOffset+h.bloomIndicesLength;for(let b=h.bloomIndicesOffset;b<v;b++)m.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}let u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=t.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=t.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){let s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=t.createVertexBuffer(u.layoutColorArray,eF.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=t.createVertexBuffer(u.layoutFacadePaintArray,P8.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=t.createVertexBuffer(u.entranceBloom.layoutColorArray,eF.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,s){let u=t.paint.get("building-ambient-occlusion-intensity");for(let h of this.footprints){if(4&h.hiddenFlags)continue;let m=s[h.promoteId],g=h.feature;g.properties["building-part"]="roof";let v=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),b=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";let C=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),T=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";let I=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),D=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";let O=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),R=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),B=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(let $ of h.parts){let Y,Q=v;$.part===1?(Q=v,Y=b):$.part===0?(Q=C,Y=T):$.part===2?(Q=I,Y=D):$.part===3&&(Q=O,Y=R),Y=G(Y,0,1);for(let ie=0;ie<$.vertexLength;ie++){let he=$.vertexOffset+ie,le=1+(B.layoutAOArray.uint8[he]/255-1)*u;B.layoutColorArray.emplace(he,Q.r*le*255<<8|Q.g*le*255,Q.b*le*255<<8|255*Y),h.hasFauxFacade&&B.layoutFacadePaintArray.emplace(he,255*I.r<<8|255*I.g,255*I.b<<8|255*D)}}let H=h.buildingBloom;if(H)for(let $=0;$<H.vertexLength;$++)B.entranceBloom.layoutColorArray.emplace(H.vertexOffset+$,255*O.r<<8|255*O.g,255*O.b<<8|51*R)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let h=s.getReplacementRegionsForTile(t.toUnwrapped());if(k1(this.activeReplacements,h))return;this.activeReplacements=h;for(let g of this.footprints)g.hiddenFlags&=-2;let m=[];for(let g of this.activeReplacements){if(g.order<=ik)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));for(let b of this.footprints)b.min.x>g.max.x||b.max.x<g.min.x||b.min.y>g.max.y||b.max.y<g.min.y||(m.length=0,B8(this.footprintsVertices,b.footprintVertexOffset,b.footprintVertexLength,g.footprintTileId.canonical,t.canonical,m),AI(g.footprint,m,this.footprintsIndices.uint16,b.footprintIndexOffset,b.footprintIndexLength,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(t){if(t.id!==void 0){let s=this.featureFootprintLookup.get(t.id);return this.footprints[s]}return null}getHeightAtTileCoord(t,s){let u=Number.NEGATIVE_INFINITY,h=!0,m=4*(t+vt)*vt+(s+vt);if(this.footprintLookup.hasOwnProperty(m)){let v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}let g=new ot(t,s);for(let v of this.footprints)t>v.max.x||v.min.x>t||s>v.max.y||v.min.y>s||v.height<=u||z8(g,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(u=v.height,this.footprintLookup[m]=v,h=v.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[m]=void 0}}function z8(l,t,s){for(let u=0;u<s.length;u+=3){let h=s[u],m=s[u+1],g=s[u+2],v=t[2*h+0],b=t[2*h+1],C=t[2*m+0],T=t[2*m+1],I=t[2*g+0],D=t[2*g+1],O=(v-I)*(l.y-D)-(b-D)*(l.x-I),R=(C-v)*(l.y-b)-(T-b)*(l.x-v);if(O<0!=R<0&&O!==0&&R!==0)continue;let B=(I-C)*(l.y-T)-(D-T)*(l.x-C);if(B===0||B<0==O+R<=0)return!0}return!1}function B8(l,t,s,u,h,m){let g=Math.pow(2,u.z-h.z);for(let v=0;v<s;v++){let b=l.float32[2*(v+t)+0],C=l.float32[2*(v+t)+1];b=(b+h.x*vt)*g-u.x*vt,C=(C+h.y*vt)*g-u.y*vt,m.push(new ot(b,C))}}let iF,rF;Lt(nF,"BuildingBucket",{omit:["layers"]}),Lt(KI,"BuildingGeometry"),Lt(XI,"BuildingBloomGeometry");let V8=An([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),U8=An([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:j8}=V8,$8=An([{name:"a_packed",components:3,type:"Float32"}]),{members:H8}=$8,G8=An([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:q8}=G8;class oF{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new vh({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){let u=this.getKey(t,s);return this.positions[u]}trim(){let t=this.width,s=this.height=ze(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,u){let h=[],m=t.length%2==1?-t[t.length-1]*u:0,g=t[0]*u,v=!0;h.push({left:m,right:g,isDash:v,zeroLength:t[0]===0});let b=t[0];for(let C=1;C<t.length;C++){v=!v;let T=t[C];m=b*u,b+=T,g=b*u,h.push({left:m,right:g,isDash:v,zeroLength:T===0})}return h}addRoundDash(t,s,u){let h=s/2;for(let m=-u;m<=u;m++){let g=this.width*(this.nextRow+u+m),v=0,b=t[v];for(let C=0;C<this.width;C++){C/b.right>1&&(b=t[++v]);let T=Math.abs(C-b.left),I=Math.abs(C-b.right),D=Math.min(T,I),O,R=m/u*(h+1);if(b.isDash){let B=h-Math.abs(R);O=Math.sqrt(D*D+B*B)}else O=h-Math.sqrt(D*D+R*R);this.image.data[g+C]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,s){for(let b=t.length-1;b>=0;--b){let C=t[b],T=t[b+1];C.zeroLength?t.splice(b,1):T&&T.isDash===C.isDash&&(T.left=C.left,t.splice(b,1))}let u=t[0],h=t[t.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);let m=this.width*this.nextRow,g=0,v=t[g];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++g]);let C=Math.abs(b-v.left),T=Math.abs(b-v.right),I=Math.min(C,T);this.image.data[m+b]=Math.max(0,Math.min(255,(v.isDash?I:-I)+s+128))}}addDash(t,s){let u=this.getKey(t,s);if(this.positions[u])return this.positions[u];let h=s==="round",m=h?7:0,g=2*m+1;if(this.nextRow+g>this.height)return At("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let T=0;T<t.length;T++)t[T]<0&&(At("Negative value is found in line dasharray, replacing values with 0"),t[T]=0),v+=t[T];if(v!==0){let T=this.width/v,I=this.getDashRanges(t,this.width,T);h?this.addRoundDash(I,T,m):this.addRegularDash(I,s==="square"?.5*T:0)}let b=this.nextRow+m;this.nextRow+=g;let C={tl:[b,m],br:[v,0]};return this.positions[u]=C,C}}Lt(oF,"LineAtlas");let W8=Ce.types,Z8=Math.cos(Math.PI/180*37.5),Y8=Math.cos(Math.PI/180*5);class QI{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ng,this.layoutVertexArray2=new ea,this.patternVertexArray=new ea,this.indexArray=new Xr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new nr,this.maxLineLength=0,this.zOffsetVertexArray=new ea,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:vt/64,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.hasPattern=EI("line",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=q(u);let g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{let D=this.layers[0].layout.get("line-z-offset"),O=D.isConstant()&&!D.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&O?"none":"offset",this.elevationType==="offset"&&g==="none"&&At(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;let b=[];for(let{feature:D,id:O,index:R,sourceLayerIndex:B}of t){let H=this.layers[0]._featureFilter.needGeometry,$=Te(D,H);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),$,u))continue;let Y=m?m.evaluate($,{},u):void 0,Q={id:O,properties:D.properties,type:D.type,sourceLayerIndex:B,index:R,geometry:H?$.geometry:_e(D,u,h),patterns:{},sortKey:Y};b.push(Q)}m&&b.sort((D,O)=>D.sortKey-O.sortKey);let{lineAtlas:C,featureIndex:T}=s,I=this.addConstantDashes(C);for(let D of b){let{geometry:O,index:R,sourceLayerIndex:B}=D;if(I&&this.addFeatureDashes(D,C),this.hasPattern){let H=SI("line",this.layers,D,this.zoom,this.pixelRatio,s);this.patternFeatures.push(H)}else this.addFeature(D,O,R,u,C.positions,s.availableImages,s.brightness,s.elevationFeatures);T.insert(t[R].feature,O,R,B,this.index)}}addConstantDashes(t){let s=!1;for(let u of this.layers){let h=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")s=!0;else{let g=m.value,v=h.value;if(!v)continue;t.addDash(v,g)}}return s}addFeatureDashes(t,s){let u=this.zoom;for(let h of this.layers){let m=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let v,b;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:u},t);b=g.kind==="constant"?g.value:g.evaluate({zoom:u},t),s.addDash(v,b),t.patterns[h.id]=[s.getKey(v,b)]}}update(t,s,u,h,m,g,v,b){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}addFeatures(t,s,u,h,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,g,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,H8)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,q8)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,U8.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j8),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,s){let u,h;if(s&&s>0?(u=`mapbox_clip_start_${s}`,h=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",h="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(u)&&t.properties.hasOwnProperty(h))return{start:+t.properties[u],end:+t.properties[h]}}addFeature(t,s,u,h,m,g,v,b){let C=this.layers[0].layout,T=C.get("line-join").evaluate(t,{}),I=C.get("line-cap").evaluate(t,{}),D=C.get("line-miter-limit"),O=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;let R=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;let B=this.layers[0].paint.get("line-width").value;if(B.kind!=="constant"&&B.isLineProgressConstant===!1&&(this.variableWidthValue=B),this.elevationType==="road"){let H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,s,h,b,T,I,D,O)){let[$,Y]=this.clipRuntimeLinesToTile(s,1);for(let Q=0;Q<$.length;Q++){let ie=$[Q],he=Y[Q],le={progress:{min:he.progress.min,max:he.progress.max},nextDir:this.computeSegNextDir(he,ie),prevDir:this.computeSegPrevDir(he,ie)};this.addLine(ie,t,h,T,I,D,O,le,R&&he.parentIndex>0?he.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<s.length;H++)this.addLine(s[H],t,h,T,I,D,O,void 0,R&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,m,g,h,v,void 0,this.worldview)}computeSegNextDir(t,s){return t.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(t,s){return s[1].sub(t.prevPoint).unit()}clipLinesToTile(t,s){return N1(t,-s,-s,vt+s,vt+s)}clipRuntimeLinesToTile(t,s){let u=[];return[N1(t,-s,-s,vt+s,vt+s,u),u]}addElevatedRoadFeature(t,s,u,h,m,g,v,b){let C=[],T=ii.getElevationFeature(t,h);if(T){let I=this.clipLinesToTile(s,1),D=this.prepareElevatedLines(I,T,u);for(let O of D)C.push({geometry:O,elevation:T,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(let I of C){let D=this.layoutVertexArray.length;this.addLine(I.geometry,t,u,m,g,v,b);let O=new mi(u,I.elevationTileID);if(I.elevation)for(let R=D;R<this.layoutVertexArray.length;R++){let B=new ot(this.layoutVertexArray.int16[6*R]>>1,this.layoutVertexArray.int16[6*R+1]>>1),H=O.pointElevation(B,I.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(t,s,u){if(s.constantHeight!=null)return t;let h=[],m=1/q(u);for(let g of t)o8(g,new Yn(s,m),0,h);return h}fillNonElevatedRoadSegment(t){for(let s=t;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,s,u,h,m,g,v,b,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(s,C):this.lineClips;let T=h==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let I=b&&b.progress.min>0,D=b&&b.progress.max<1;if(this.lineClips){let we={min:this.lineClips.start,max:this.lineClips.end},je=1;if(b){let Ke=this.lineClips.end-this.lineClips.start;we=(function(Qe,st,lt){return{min:Pi(Qe.min,st,lt),max:Pi(Qe.max,st,lt)}})(b.progress,{min:0,max:1},we),Ke>0&&(je=(we.max-we.min)/Ke)}let Ie=+s.properties.mapbox_clip_feature_len,We=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Ie)||Number.isNaN(We)){for(let Qe=0;Qe<t.length-1;Qe++)this.totalDistance+=t[Qe].dist(t[Qe+1]);let Ke=this.totalDistance/(we.max-we.min);this.totalFeatureLength=Number.isFinite(Ke)?Ke:0,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ie,this.distance=We*je,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let O=W8[s.type]==="Polygon",R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let B=0;for(;B<R-1&&t[B].equals(t[B+1]);)B++;if(R<(O?3:2))return;h==="bevel"&&(g=1.05);let H=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray),$,Y,Q,ie,he,le,me,ye;b&&b.prevDir&&(le=b.prevDir.perp()),b&&b.nextDir&&(me=b.nextDir.perp()),this.e1=this.e2=-1,O&&($=t[R-2],he=t[B].sub($)._unit()._perp());for(let we=B;we<R;we++){if(Q=we===R-1?O?t[B+1]:void 0:t[we+1],Q&&t[we].equals(Q))continue;he&&(ie=he),$&&(Y=$),$=t[we],ye=this.evaluateLineProgressFeatures(Y?Y.dist($):0),he=Q?Q.sub($)._unit()._perp():ie,ie=ie||he;let je=Y&&Q,Ie=je?h:O||T?"butt":m,We=ie.x*he.x+ie.y*he.y;if(T){let He=function(rt){if(rt.patternJoinNone){let yt=rt.segmentPoints.length/2,ft=rt.lineSoFar-rt.segmentStart;for(let qt=0;qt<yt;++qt){let It=rt.segmentPoints[2*qt+1],Ot=Math.round(rt.segmentPoints[2*qt])+.5+.25*It;rt.patternVertexArray.emplaceBack(Ot,ft,rt.segmentStart),rt.patternVertexArray.emplaceBack(Ot,ft,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(je&&We<Y8){this.updateDistance(Y,$),this.addCurrentVertex($,ie,1,1,H,ye),He(this),this.addCurrentVertex($,he,-1,-1,H,ye);continue}if(Y){if(!Q){this.updateDistance(Y,$),this.addCurrentVertex($,ie,1,1,H,ye),He(this);continue}Ie="miter"}}let Ke=ie.add(he);Ke.x===0&&Ke.y===0||Ke._unit();let Qe=Ke.x*he.x+Ke.y*he.y,st=Qe!==0?1/Qe:1/0,lt=2*Math.sqrt(2-2*Qe),nt=Qe<Z8&&Y&&Q,it=ie.x*he.y-ie.y*he.x>0,qe=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(je&&Ie==="round"){if(st<v)Ie="miter";else if(st<=2){let He=JI($,-10,vt+10);Ie=this.elevationType==="offset"&&(He||this.hasCrossSlope)?"miter":"fakeround"}}if(Ie==="miter"&&st>g&&(Ie="bevel"),Ie==="bevel"&&(st>2&&(Ie="flipbevel"),st<g&&(Ie="miter")),Y&&!(Ie==="miter"&&nt)&&this.updateDistance(Y,$),Ie==="miter")if(nt){let He=$.dist(Y);if(He>2*qe){let yt=$.sub($.sub(Y)._mult(qe/He)._round());this.updateDistance(Y,yt),this.addCurrentVertex(yt,ie,0,0,H,ye),Y=yt}this.updateDistance(Y,$),Ke._mult(st),this.addCurrentVertex($,Ke,0,0,H,ye);let rt=$.dist(Q);if(rt>2*qe){let yt=$.add(Q.sub($)._mult(qe/rt)._round());this.updateDistance($,yt),this.addCurrentVertex(yt,he,0,0,H,ye),$=yt}}else Ke._mult(st),this.addCurrentVertex($,Ke,0,0,H,ye);else if(Ie==="flipbevel"){if(st>100)Ke=he.mult(-1);else{let He=st*ie.add(he).mag()/ie.sub(he).mag();Ke._perp()._mult(He*(it?-1:1))}this.addCurrentVertex($,Ke,0,0,H,ye),this.addCurrentVertex($,Ke.mult(-1),0,0,H,ye)}else if(Ie==="bevel"||Ie==="fakeround"){ye!=null&&Y&&this.addCurrentVertex($,me||ie,-1,-1,H,ye);let He=$.dist(Y)<=2*qe&&Ie!=="bevel",rt=Ke.mult(it?1:-1);rt._mult(st);let yt=he.mult(it?-1:1),ft=ie.mult(it?-1:1),qt=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex($,rt.x,rt.y,!1,!it,0,H,qt),He||this.addHalfVertex($,rt.x+2*ft.x,rt.y+2*ft.y,!1,it,0,H,qt)),Ie==="fakeround"){let It=Math.round(180*lt/Math.PI/20);this.addHalfVertex($,ft.x,ft.y,!1,it,0,H,qt);for(let Ot=0;Ot<It;Ot++){let Bt=Ot/It;if(Bt!==.5){let mt=Bt-.5;Bt+=Bt*mt*(Bt-1)*((1.0904+We*(We*(3.55645-1.43519*We)-3.2452))*mt*mt+(.848013+We*(.215638*We-1.06021)))}let In=yt.sub(ft)._mult(Bt)._add(ft)._unit();this.addHalfVertex($,In.x,In.y,!1,it,0,H,qt)}this.addHalfVertex($,yt.x,yt.y,!1,it,0,H,qt)}He||ye!=null||this.addHalfVertex($,rt.x+2*yt.x,rt.y+2*yt.y,!1,it,0,H,qt),ye!=null&&Q&&this.addCurrentVertex($,le||he,1,1,H,ye)}else if(Ie==="butt")this.addCurrentVertex($,Ke,0,0,H,ye);else if(Ie==="square"){if(!Y){let He=I?0:-1;this.addCurrentVertex($,Ke,He,He,H,ye)}if(this.addCurrentVertex($,Ke,0,0,H,ye),Y){let He=D?0:1;this.addCurrentVertex($,Ke,He,He,H,ye)}}else if(Ie==="round"){if(Y){let He=!je&&me?me:ie;this.addCurrentVertex($,He,0,0,H,ye),!je&&D||this.addCurrentVertex($,He,1,1,H,ye,!0)}if(Q){let He=!je&&le?le:he;!je&&I||this.addCurrentVertex($,He,-1,-1,H,ye,!0),this.addCurrentVertex($,He,0,0,H,ye)}}}}addVerticesTo(t,s,u,h,m,g,v,b,C,T){let I=(s.w-t.w)/this.tessellationStep|0,D=0,O=this.scaledDistance;if(I>1){this.lineSoFar=t.w;let B=(s.x-t.x)/I,H=(s.y-t.y)/I,$=(s.z-t.z)/I,Y=(s.w-t.w)/I;for(let Q=1;Q<I;++Q){t.x+=B,t.y+=H,t.z+=$,this.lineSoFar+=Y,D+=Y;let ie=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(t,u,h,T,!1,v,C,ie),this.addHalfVertex(t,m,g,T,!0,-b,C,ie)}}this.lineSoFar=s.w,this.scaledDistance=O;let R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,h,T,!1,v,C,R),this.addHalfVertex(s,m,g,T,!0,-b,C,R)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):At(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(t,s,u,h,m,g,v=!1){let b=s.x+s.y*u,C=s.y-s.x*u,T=s.y*h-s.x,I=-s.y-s.x*h;if(g!=null){let D=this.elevationType==="offset",O=-10,R=vt+10,B=g.zOffset,H=new Ik(t.x,t.y,B,this.lineSoFar),$=!!D&&JI(t,O,R),Y=this.lineSoFar,Q=this.distance;if(this.currentVertex)if($){let ie=this.currentVertexIsOutside,he=this.currentVertex,le=new Ik(t.x,t.y,B,this.lineSoFar);if(Dk(he,le,O,R),!JI(le,O,R)){if(ie){this.e1=this.e2=-1,this.distance-=he.dist(H),this.lineSoFar=he.w;let me=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,b,C,v,!1,u,m,me),this.addHalfVertex(he,T,I,v,!0,-h,m,me),this.prevDistance=this.distance}this.distance=this.prevDistance+he.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(he,le,b,C,T,I,u,h,m,v),this.distance=Q,this.scaledDistance=this.distance/this.totalDistance}}else{let ie=this.currentVertex;if(this.currentVertexIsOutside){Dk(ie,H,O,R),this.e1=this.e2=-1,this.distance-=ie.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;let he=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,b,C,v,!1,u,m,he),this.addHalfVertex(ie,T,I,v,!0,-h,m,he),this.prevDistance=this.distance,this.distance=Q,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,H,b,C,T,I,u,h,m,v)}else $||(this.addHalfVertex(t,b,C,v,!1,u,m,g),this.addHalfVertex(t,T,I,v,!0,-h,m,g));this.currentVertex=H,this.currentVertexIsOutside=$,this.lineSoFar=Y}else this.addHalfVertex(t,b,C,v,!1,u,m,g),this.addHalfVertex(t,T,I,v,!0,-h,m,g)}addHalfVertex({x:t,y:s},u,h,m,g,v,b,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let I=on(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,I)}let T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),g?this.e2=T:this.e1=T,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,s){this.prevDistance=this.distance,this.distance+=t.dist(s),this.updateScaledDistance()}}function JI(l,t,s){return l.x<t||l.x>s||l.y<t||l.y>s}let sF,aF;function lF(l,t,s){return t*(vt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Lt(QI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let cF=(l,t,s)=>(1-s)*l+s*t;function uF(l,t){return 1/lF(l,1,t.tileZoom)}function dF(l,t,s,u){return l.translatePosMatrix(u||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}let hF=l=>{let t=[];pF(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");let u=l.layout.get("line-join").constantOr("miter")==="none",h=!!l.paint.get("line-pattern").constantOr(1);return u&&h&&t.push("LINE_JOIN_NONE"),t};function pF(l){let t=l.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let eM,fF=()=>eM||(eM={layout:sF||(sF=new gr({"line-cap":new Ct(Oe.layout_line["line-cap"]),"line-join":new Ct(Oe.layout_line["line-join"]),"line-miter-limit":new gt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new gt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Ct(Oe.layout_line["line-sort-key"]),"line-z-offset":new Ct(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new gt(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new gt(Oe.layout_line["line-cross-slope"]),visibility:new gt(Oe.layout_line.visibility),"line-width-unit":new gt(Oe.layout_line["line-width-unit"])})),paint:aF||(aF=new gr({"line-opacity":new Ct(Oe.paint_line["line-opacity"]),"line-color":new Ct(Oe.paint_line["line-color"]),"line-translate":new gt(Oe.paint_line["line-translate"]),"line-translate-anchor":new gt(Oe.paint_line["line-translate-anchor"]),"line-width":new Ct(Oe.paint_line["line-width"]),"line-gap-width":new Ct(Oe.paint_line["line-gap-width"]),"line-offset":new Ct(Oe.paint_line["line-offset"]),"line-blur":new Ct(Oe.paint_line["line-blur"]),"line-dasharray":new Ct(Oe.paint_line["line-dasharray"]),"line-pattern":new Ct(Oe.paint_line["line-pattern"]),"line-pattern-cross-fade":new gt(Oe.paint_line["line-pattern-cross-fade"]),"line-gradient":new ud(Oe.paint_line["line-gradient"]),"line-trim-offset":new gt(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new gt(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new gt(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new Ct(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Ct(Oe.paint_line["line-border-width"]),"line-border-color":new Ct(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new gt(Oe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},eM);class X8 extends Ct{possiblyEvaluate(t,s){return s=new Vi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(t,s)}evaluate(t,s,u,h){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,u,h)}}let Z0;function mF(l,t){return t>0?t+2*l:l}let K8=An([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q8=An([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),J8=An([{name:"a_projected_pos",components:4,type:"Float32"}],4);An([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let e$=An([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),t$=An([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),n$=An([{name:"a_texb",components:2,type:"Uint16"}]),i$=An([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),r$=An([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let gF=An([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),o$=An([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);An([{name:"triangle",components:3,type:"Uint16"}]),An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),An([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),An([{type:"Float32",name:"offsetX"}]),An([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;function s$(l,t,s){return l.sections.forEach(u=>{u.text=(function(h,m,g){let v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),rc.applyArabicShaping&&(h=rc.applyArabicShaping(h)),h})(u.text,t,s)}),l}let Y0={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function a$(l){return l==="\uFE36"||l==="\uFE48"||l==="\uFE38"||l==="\uFE44"||l==="\uFE42"||l==="\uFE3E"||l==="\uFE3C"||l==="\uFE3A"||l==="\uFE18"||l==="\uFE40"||l==="\uFE10"||l==="\uFE13"||l==="\uFE14"||l==="\uFF40"||l==="\uFFE3"||l==="\uFE11"||l==="\uFE12"}function l$(l){return l==="\uFE35"||l==="\uFE47"||l==="\uFE37"||l==="\uFE43"||l==="\uFE41"||l==="\uFE3D"||l==="\uFE3B"||l==="\uFE39"||l==="\uFE17"||l==="\uFE3F"}let tM=4294967296,_F=1/tM,vF=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),Y1=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,t,s=this.length){for(;this.pos<s;){let u=this.readVarint(),h=u>>3,m=this.pos;this.type=7&u,l(h,t,this),this.pos===m&&this.skip(u)}return t}readMessage(l,t){return this.readFields(l,t,this.readVarint()+this.pos)}readFixed32(){let l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){let l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){let l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*tM;return this.pos+=8,l}readSFixed64(){let l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*tM;return this.pos+=8,l}readFloat(){let l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){let l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){let t=this.buf,s,u;return u=t[this.pos++],s=127&u,u<128?s:(u=t[this.pos++],s|=(127&u)<<7,u<128?s:(u=t[this.pos++],s|=(127&u)<<14,u<128?s:(u=t[this.pos++],s|=(127&u)<<21,u<128?s:(u=t[this.pos],s|=(15&u)<<28,(function(h,m,g){let v=g.buf,b,C;if(C=v[g.pos++],b=(112&C)>>4,C<128||(C=v[g.pos++],b|=(127&C)<<3,C<128)||(C=v[g.pos++],b|=(127&C)<<10,C<128)||(C=v[g.pos++],b|=(127&C)<<17,C<128)||(C=v[g.pos++],b|=(127&C)<<24,C<128)||(C=v[g.pos++],b|=(1&C)<<31,C<128))return Mg(h,b,m);throw new Error("Expected varint not more than 10 bytes")})(s,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){let l=this.readVarint()+this.pos,t=this.pos;return this.pos=l,l-t>=12&&vF?vF.decode(this.buf.subarray(t,l)):(function(s,u,h){let m="",g=u;for(;g<h;){let v=s[g],b,C,T,I=null,D=v>239?4:v>223?3:v>191?2:1;if(g+D>h)break;D===1?v<128&&(I=v):D===2?(b=s[g+1],(192&b)==128&&(I=(31&v)<<6|63&b,I<=127&&(I=null))):D===3?(b=s[g+1],C=s[g+2],(192&b)==128&&(192&C)==128&&(I=(15&v)<<12|(63&b)<<6|63&C,(I<=2047||I>=55296&&I<=57343)&&(I=null))):D===4&&(b=s[g+1],C=s[g+2],T=s[g+3],(192&b)==128&&(192&C)==128&&(192&T)==128&&(I=(15&v)<<18|(63&b)<<12|(63&C)<<6|63&T,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,D=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),g+=D}return m})(this.buf,t,l)}readBytes(){let l=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,l);return this.pos=l,t}readPackedVarint(l=[],t){let s=this.readPackedEnd();for(;this.pos<s;)l.push(this.readVarint(t));return l}readPackedSVarint(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFloat());return l}readPackedDouble(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){let t=7&l;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(l,t){this.writeVarint(l<<3|t)}realloc(l){let t=this.length||16;for(;t<this.pos+l;)t*=2;if(t!==this.length){let s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*_F),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*_F),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?(function(t,s){let u,h;if(t>=0?(u=t%4294967296|0,h=t/4294967296|0):(u=~(-t%4294967296),h=~(-t/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(u,0,s),(function(m,g){let v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(h,s)})(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;let t=this.pos;this.pos=(function(u,h,m){for(let g,v,b=0;b<h.length;b++){if(g=h.charCodeAt(b),g>55295&&g<57344){if(!v){g>56319||b+1===h.length?(u[m++]=239,u[m++]=191,u[m++]=189):v=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(u[m++]=239,u[m++]=191,u[m++]=189,v=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m})(this.buf,l,this.pos);let s=this.pos-t;s>=128&&yF(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){let t=l.length;this.writeVarint(t),this.realloc(t);for(let s=0;s<t;s++)this.buf[this.pos++]=l[s]}writeRawMessage(l,t){this.pos++;let s=this.pos;l(t,this);let u=this.pos-s;u>=128&&yF(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(l,t,s){this.writeTag(l,2),this.writeRawMessage(t,s)}writePackedVarint(l,t){t.length&&this.writeMessage(l,c$,t)}writePackedSVarint(l,t){t.length&&this.writeMessage(l,u$,t)}writePackedBoolean(l,t){t.length&&this.writeMessage(l,p$,t)}writePackedFloat(l,t){t.length&&this.writeMessage(l,d$,t)}writePackedDouble(l,t){t.length&&this.writeMessage(l,h$,t)}writePackedFixed32(l,t){t.length&&this.writeMessage(l,f$,t)}writePackedSFixed32(l,t){t.length&&this.writeMessage(l,m$,t)}writePackedFixed64(l,t){t.length&&this.writeMessage(l,g$,t)}writePackedSFixed64(l,t){t.length&&this.writeMessage(l,_$,t)}writeBytesField(l,t){this.writeTag(l,2),this.writeBytes(t)}writeFixed32Field(l,t){this.writeTag(l,5),this.writeFixed32(t)}writeSFixed32Field(l,t){this.writeTag(l,5),this.writeSFixed32(t)}writeFixed64Field(l,t){this.writeTag(l,1),this.writeFixed64(t)}writeSFixed64Field(l,t){this.writeTag(l,1),this.writeSFixed64(t)}writeVarintField(l,t){this.writeTag(l,0),this.writeVarint(t)}writeSVarintField(l,t){this.writeTag(l,0),this.writeSVarint(t)}writeStringField(l,t){this.writeTag(l,2),this.writeString(t)}writeFloatField(l,t){this.writeTag(l,5),this.writeFloat(t)}writeDoubleField(l,t){this.writeTag(l,1),this.writeDouble(t)}writeBooleanField(l,t){this.writeVarintField(l,+t)}};function Mg(l,t,s){return s?4294967296*t+(l>>>0):4294967296*(t>>>0)+(l>>>0)}function yF(l,t,s){let u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(u);for(let h=s.pos-1;h>=l;h--)s.buf[h+u]=s.buf[h]}function c$(l,t){for(let s=0;s<l.length;s++)t.writeVarint(l[s])}function u$(l,t){for(let s=0;s<l.length;s++)t.writeSVarint(l[s])}function d$(l,t){for(let s=0;s<l.length;s++)t.writeFloat(l[s])}function h$(l,t){for(let s=0;s<l.length;s++)t.writeDouble(l[s])}function p$(l,t){for(let s=0;s<l.length;s++)t.writeBoolean(l[s])}function f$(l,t){for(let s=0;s<l.length;s++)t.writeFixed32(l[s])}function m$(l,t){for(let s=0;s<l.length;s++)t.writeSFixed32(l[s])}function g$(l,t){for(let s=0;s<l.length;s++)t.writeFixed64(l[s])}function _$(l,t){for(let s=0;s<l.length;s++)t.writeSFixed64(l[s])}let nM=3;function v$(l,t,s){t.glyphs=[],l===1&&s.readMessage(y$,t)}function y$(l,t,s){if(l===3){let{id:u,bitmap:h,width:m,height:g,left:v,top:b,advance:C}=s.readMessage(x$,{});t.glyphs.push({id:u,bitmap:new vh({width:m+2*nM,height:g+2*nM},h),metrics:{width:m,height:g,left:v,top:b,advance:C}})}else l===4?t.ascender=s.readSVarint():l===5&&(t.descender=s.readSVarint())}function x$(l,t,s){l===1?t.id=s.readVarint():l===2?t.bitmap=s.readBytes():l===3?t.width=s.readVarint():l===4?t.height=s.readVarint():l===5?t.left=s.readSVarint():l===6?t.top=s.readSVarint():l===7&&(t.advance=s.readVarint())}let xF=nM,ra={horizontal:1,vertical:2,horizontalOnly:3};class X0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,s){let u=new X0;return u.scale=t||1,u.fontStack=s,u}static forImage(t){let s=new X0;return s.image=t,s}}class Dg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s,u){let h=new Dg;for(let m=0;m<t.sections.length;m++){let g=t.sections[m];g.image?h.addImageSection(g,u):h.addTextSection(g,s)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(s,u){let h="";for(let m=0;m<s.length;m++){let g=s.charCodeAt(m+1)||null,v=s.charCodeAt(m-1)||null;h+=!u&&(g&&Gm(g)&&!Y0[s[m+1]]||v&&Gm(v)&&!Y0[s[m-1]])||!Y0[s[m]]?s[m]:Y0[s[m]]}return h})(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&X1[this.text.charCodeAt(u)];u++)t++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&X1[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){let u=new Dg;return u.text=this.text.substring(t,s),u.sectionIndex=this.sectionIndex.slice(t,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(X0.forText(t.scale,t.fontStack||s));let u=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(u)}addImageSection(t,s){let u=t.image?t.image.getPrimary():null;if(!u)return void At("Can't add FormattedSection with an empty image.");u.scaleSelf(s);let h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(X0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):At("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function iM(l,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B=1){let H=Dg.fromFeature(l,h,B);I===ra.vertical&&H.verticalizePunctuation(D);let $=[],Y=(function(me,ye,we,je,Ie,We){if(!me)return[];let Ke=[],Qe=(function(it,qe,He,rt,yt,ft){let qt=0;for(let It=0;It<it.length();It++){let Ot=it.getSection(It);qt+=bF(it.getCodePoint(It),Ot,rt,yt,qe,ft)}return qt/Math.max(1,Math.ceil(qt/He))})(me,ye,we,je,Ie,We),st=me.text.indexOf("\u200B")>=0,lt=0;for(let it=0;it<me.length();it++){let qe=me.getSection(it),He=me.getCodePoint(it);if(X1[He]||(lt+=bF(He,qe,je,Ie,ye,We)),it<me.length()-1){let rt=!((nt=He)<11904||!(en["Bopomofo Extended"](nt)||en.Bopomofo(nt)||en["CJK Compatibility Forms"](nt)||en["CJK Compatibility Ideographs"](nt)||en["CJK Compatibility"](nt)||en["CJK Radicals Supplement"](nt)||en["CJK Strokes"](nt)||en["CJK Symbols and Punctuation"](nt)||en["CJK Unified Ideographs Extension A"](nt)||en["CJK Unified Ideographs"](nt)||en["Enclosed CJK Letters and Months"](nt)||en["Halfwidth and Fullwidth Forms"](nt)||en.Hiragana(nt)||en["Ideographic Description Characters"](nt)||en["Kangxi Radicals"](nt)||en["Katakana Phonetic Extensions"](nt)||en.Katakana(nt)||en["Vertical Forms"](nt)||en["Yi Radicals"](nt)||en["Yi Syllables"](nt)));(b$[He]||rt||qe.image)&&Ke.push(CF(it+1,lt,Qe,Ke,w$(He,me.getCodePoint(it+1),rt&&st),!1))}}var nt;return EF(CF(me.length(),lt,Qe,Ke,0,!0))})(H,C,m,t,u,O),{processBidirectionalText:Q,processStyledBidirectionalText:ie}=rc;if(Q&&H.sections.length===1){let me=Q(H.toString(),Y);for(let ye of me){let we=new Dg;we.text=ye,we.sections=H.sections;for(let je=0;je<ye.length;je++)we.sectionIndex.push(0);$.push(we)}}else if(ie){let me=ie(H.text,H.sectionIndex,Y);for(let ye of me){let we=new Dg;we.text=ye[0],we.sectionIndex=ye[1],we.sections=H.sections,$.push(we)}}else $=(function(me,ye){let we=[],je=me.text,Ie=0;for(let We of ye)we.push(me.substring(Ie,We)),Ie=We;return Ie<je.length&&we.push(me.substring(Ie,je.length)),we})(H,Y);let he=[],le={positionedLines:he,text:H.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(me,ye,we,je,Ie,We,Ke,Qe,st,lt,nt,it){let qe=0,He=0,rt=0,yt=Qe==="right"?1:Qe==="left"?0:.5,ft=!1;for(let mt of Ie){let Vt=mt.getSections();for(let un of Vt){if(un.image)continue;let Ln=ye[un.fontStack];if(Ln&&(ft=Ln.ascender!==void 0&&Ln.descender!==void 0,!ft))break}if(!ft)break}let qt=0;for(let mt of Ie){mt.trim();let Vt=mt.getMaxScale(),un=(Vt-1)*fo,Ln={positionedGlyphs:[],lineOffset:0};me.positionedLines[qt]=Ln;let zn=Ln.positionedGlyphs,_n=0;if(!mt.length()){He+=We,++qt;continue}let gi=0,ce=0;for(let Ze=0;Ze<mt.length();Ze++){let at=mt.getSection(Ze),Et=mt.getSectionIndex(Ze),St=mt.getCodePoint(Ze),Wt=at.scale,Yt=null,mn=null,Cn=null,Tn=fo,Pn=0,rn=st;rn===ra.vertical&&((It=St)===12312||It===12313||It===12316||It===12540||It===12448)&&(rn=ra.horizontal);let cn=!(rn===ra.horizontal||!nt&&!Hm(St)||nt&&(X1[St]||qm(St)));if(at.image){let Hn=je.get(at.image.toString());if(!Hn)continue;Cn=at.image,me.iconsInText=me.iconsInText||!0,mn=Hn.paddedRect;let Xn=Hn.displaySize;Wt=Wt*fo/it,Yt={width:Xn[0],height:Xn[1],left:0,top:-xF,advance:cn?Xn[1]:Xn[0],localGlyph:!1},Pn=ft?-Yt.height*Wt:Vt*fo-17-Xn[1]*Wt,Tn=Yt.advance;let Kn=(cn?Xn[0]:Xn[1])*Wt-fo*Vt;Kn>0&&Kn>_n&&(_n=Kn)}else{let Hn=we[at.fontStack];if(!Hn)continue;Hn[St]&&(mn=Hn[St]);let Xn=ye[at.fontStack];if(!Xn)continue;let Kn=Xn.glyphs[St];if(!Kn)continue;if(Yt=Kn.metrics,Tn=St!==8203?fo:0,ft){let hi=Xn.ascender!==void 0?Math.abs(Xn.ascender):0,Ii=Xn.descender!==void 0?Math.abs(Xn.descender):0,_i=(hi+Ii)*Wt;gi<_i&&(gi=_i,ce=(hi-Ii)/2*Wt),Pn=-hi*Wt}else Pn=(Vt-Wt)*fo-17}cn?(me.verticalizable=!0,zn.push({glyph:St,image:Cn,x:qe,y:He+Pn,vertical:cn,scale:Wt,localGlyph:Yt.localGlyph,fontStack:at.fontStack,sectionIndex:Et,metrics:Yt,rect:mn}),qe+=Tn*Wt+lt):(zn.push({glyph:St,image:Cn,x:qe,y:He+Pn,vertical:cn,scale:Wt,localGlyph:Yt.localGlyph,fontStack:at.fontStack,sectionIndex:Et,metrics:Yt,rect:mn}),qe+=Yt.advance*Wt+lt)}zn.length!==0&&(rt=Math.max(qe-lt,rt),ft?SF(zn,yt,_n,ce,We*Vt/2):SF(zn,yt,_n,0,We/2)),qe=0;let pe=We*Vt+_n;Ln.lineOffset=Math.max(_n,un),He+=pe,++qt}var It;let Ot=He,{horizontalAlign:Bt,verticalAlign:In}=rM(Ke);(function(mt,Vt,un,Ln,zn,_n){let gi=(Vt-un)*zn,ce=-_n*Ln;for(let pe of mt)for(let Ze of pe.positionedGlyphs)Ze.x+=gi,Ze.y+=ce})(me.positionedLines,yt,Bt,In,rt,Ot),me.top+=-In*Ot,me.bottom=me.top+Ot,me.left+=-Bt*rt,me.right=me.left+rt,me.hasBaseline=ft})(le,t,s,u,$,g,v,b,I,C,D,R),!(function(me){for(let ye of me)if(ye.positionedGlyphs.length!==0)return!1;return!0})(he))return le}let X1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},b$={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bF(l,t,s,u,h,m){if(t.image){let g=u.get(t.image.toString());return g?g.displaySize[0]*t.scale*fo/m+h:0}{let g=s[t.fontStack],v=g&&g.glyphs[l];return v?v.metrics.advance*t.scale+h:0}}function wF(l,t,s,u){let h=Math.pow(l-t,2);return u?l<t?h/2:2*h:h+Math.abs(s)*s}function w$(l,t,s){let u=0;return l===10&&(u-=1e4),s&&(u+=150),l!==40&&l!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function CF(l,t,s,u,h,m){let g=null,v=wF(t,s,h,m);for(let b of u){let C=wF(t-b.x,s,h,m)+b.badness;C<=v&&(g=b,v=C)}return{index:l,x:t,priorBreak:g,badness:v}}function EF(l){return l?EF(l.priorBreak).concat(l.index):[]}function rM(l){let t=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function SF(l,t,s,u,h){if(!(t||s||u||h))return;let m=l.length-1,g=l[m],v=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=m;b++)l[b].x-=v,l[b].y+=s+u+h}function oM(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function K1(l,t,s,u){let{horizontalAlign:h,verticalAlign:m}=rM(u),g=s[0]-l.displaySize[0]*h,v=s[1]-l.displaySize[1]*m;return{imagePrimary:l,imageSecondary:t,top:v,bottom:v+l.displaySize[1],left:g,right:g+l.displaySize[0]}}function sM(l,t,s,u,h,m){let g=l.imagePrimary,v;if(g.content){let H=g.content,$=g.pixelRatio||1;v=[H[0]/$,H[1]/$,g.displaySize[0]-H[2]/$,g.displaySize[1]-H[3]/$]}let b=t.left*m,C=t.right*m,T,I,D,O;s==="width"||s==="both"?(O=h[0]+b-u[3],I=h[0]+C+u[1]):(O=h[0]+(b+C-g.displaySize[0])/2,I=O+g.displaySize[0]);let R=t.top*m,B=t.bottom*m;return s==="height"||s==="both"?(T=h[1]+R-u[0],D=h[1]+B+u[2]):(T=h[1]+(R+B-g.displaySize[1])/2,D=T+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:T,right:I,bottom:D,left:O,collisionPadding:v}}function TF(l){return!l.imagePrimary.stretchX}function IF(l){return!l.imagePrimary.stretchY}function MF(l){return{width:l.right-l.left,height:l.bottom-l.top}}let fc=128;function Ag(l,t,s){let{expression:u}=t;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Vi(l+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{let{zoomStops:h,interpolationType:m}=u,g=0;for(;g<h.length&&h[g]<=l;)g++;g=Math.max(0,g-1);let v=g;for(;v<h.length&&h[v]<l+1;)v++;v=Math.min(h.length-1,v);let b=h[g],C=h[v];return u.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:C,minSize:u.evaluate(new Vi(b,{worldview:s})),maxSize:u.evaluate(new Vi(C,{worldview:s})),interpolationType:m}}}function aM(l,{uSize:t,uSizeT:s},{lowerSize:u,upperSize:h}){return l.kind==="source"?u/fc:l.kind==="composite"?on(u/fc,h/fc,s):t}function Pg(l,t,s=1){let u=0,h=0;if(l.kind==="constant")h=l.layoutSize*s;else if(l.kind!=="source"){let{interpolationType:m,minZoom:g,maxZoom:v}=l,b=m?G(Js.interpolationFactor(m,t,g,v),0,1):0;l.kind==="camera"?h=on(l.minSize,l.maxSize,b)*s:u=b*s}return{uSizeT:u,uSize:h}}class vd extends ot{constructor(t,s,u,h,m){super(t,s),this.angle=h,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new vd(this.x,this.y,this.z,this.angle,this.segment)}}function DF(l,t,s,u,h){if(t.segment===void 0)return!0;let m=t,g=t.segment+1,v=0;for(;v>-s/2;){if(g--,g<0)return!1;v-=l[g].dist(m),m=l[g]}v+=l[g].dist(l[g+1]),g++;let b=[],C=0;for(;v<s/2;){let T=l[g],I=l[g+1];if(!I)return!1;let D=l[g-1].angleTo(T)-T.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:D}),C+=D;v-b[0].distance>u;)C-=b.shift().angleDelta;if(C>h)return!1;g++,v+=T.dist(I)}return!0}function AF(l){let t=0;for(let s=0;s<l.length-1;s++)t+=l[s].dist(l[s+1]);return t}function PF(l,t,s){return l?.6*t*s:0}function OF(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function C$(l,t,s,u,h,m){let g=PF(s,h,m),v=OF(s,u)*m,b=0,C=AF(l)/2;for(let T=0;T<l.length-1;T++){let I=l[T],D=l[T+1],O=I.dist(D);if(b+O>C){let R=(C-b)/O,B=on(I.x,D.x,R),H=on(I.y,D.y,R),$=new vd(B,H,0,D.angleTo(I),T);return!g||DF(l,$,v,g,t)?$:void 0}b+=O}}function E$(l,t,s,u,h,m,g,v,b){let C=PF(u,m,g),T=OF(u,h),I=T*g,D=l[0].x===0||l[0].x===b||l[0].y===0||l[0].y===b;return t-I<t/4&&(t=I+t/4),RF(l,D?t/2*v%t:(T/2+2*m)*g*v%t,t,C,s,I,D,!1,b)}function RF(l,t,s,u,h,m,g,v,b){let C=m/2,T=AF(l),I=0,D=t-s,O=[];for(let R=0;R<l.length-1;R++){let B=l[R],H=l[R+1],$=B.dist(H),Y=H.angleTo(B);for(;D+s<I+$;){D+=s;let Q=(D-I)/$,ie=on(B.x,H.x,Q),he=on(B.y,H.y,Q);if(ie>=0&&ie<b&&he>=0&&he<b&&D-C>=0&&D+C<=T){let le=new vd(ie,he,0,Y,R);u&&!DF(l,le,m,u,h)||O.push(le)}}I+=$}return v||O.length||g||(O=RF(l,I/2,s,u,h,m,g,!0,b)),O}function kF(l){let t=0,s=0;for(let g of l)t+=g.w*g.h,s=Math.max(s,g.w);l.sort((g,v)=>v.h-g.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}],h=0,m=0;for(let g of l)for(let v=u.length-1;v>=0;v--){let b=u[v];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){let C=u.pop();C&&v<u.length&&(u[v]=C)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(u.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:m,fill:t/(h*m)||0}}Lt(vd,"Anchor");let Kp=1;class K0{static getImagePositionScale(t,s,u){if(s&&t){let{sx:h,sy:m}=t;return{x:h,y:m}}return{x:u,y:u}}constructor(t,s,u,h){this.paddedRect=t;let{pixelRatio:m,version:g,stretchX:v,stretchY:b,content:C,sdf:T,usvg:I}=s;this.pixelRatio=m,this.stretchX=v,this.stretchY=b,this.content=C,this.version=g,this.padding=u,this.sdf=T,this.usvg=I,this.scale=K0.getImagePositionScale(h,I,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function lM(l,t,s){let u=Kl.parse(l),h=(function(m,g,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*g,h:(m.data?m.data.height:m.height*v[1])+2*g}})(t,s,[u.sx,u.sy]);return{bin:h,imagePosition:new K0(h,t,s,u),imageVariant:u}}class FF{constructor(t,s,u){let h=new Map,m=new Map;this.haveRenderCallbacks=[];let g=[];this.addImages(t,h,Kp,g),this.addImages(s,m,2,g);let{w:v,h:b}=kF(g),C=new Qo({width:v||1,height:b||1});for(let[T,I]of t.entries()){let D=h.get(T).paddedRect;Qo.copy(I.data,C,{x:0,y:0},{x:D.x+Kp,y:D.y+Kp},I.data,null,I.sdf)}for(let[T,I]of s.entries()){let D=m.get(T),O=D.paddedRect,R=D.padding,B=O.x+R,H=O.y+R,$=I.data.width,Y=I.data.height;R=R>1?R-1:R,Qo.copy(I.data,C,{x:0,y:0},{x:B,y:H},I.data,u),Qo.copy(I.data,C,{x:0,y:Y-R},{x:B,y:H-R},{width:$,height:R},u),Qo.copy(I.data,C,{x:0,y:0},{x:B,y:H+Y},{width:$,height:R},u),Qo.copy(I.data,C,{x:$-R,y:0},{x:B-R,y:H},{width:R,height:Y},u),Qo.copy(I.data,C,{x:0,y:0},{x:B+$,y:H},{width:R,height:Y},u),Qo.copy(I.data,C,{x:$-R,y:Y-R},{x:B-R,y:H-R},{width:R,height:R},u),Qo.copy(I.data,C,{x:0,y:Y-R},{x:B+$,y:H-R},{width:R,height:R},u),Qo.copy(I.data,C,{x:0,y:0},{x:B+$,y:H+Y},{width:R,height:R},u),Qo.copy(I.data,C,{x:$-R,y:0},{x:B-R,y:H+Y},{width:R,height:R},u)}this.lut=u,this.image=C,this.iconPositions=h,this.patternPositions=m}addImages(t,s,u,h){for(let[m,g]of t.entries()){let{bin:v,imagePosition:b,imageVariant:C}=lM(m,g,u);s.set(m,b),h.push(v),g.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(t,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(let h of t.getUpdatedImages(u)){for(let m of this.iconPositions.keys()){let g=Kl.parse(m);if(as.isEqual(g.id,h)){let v=t.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(m),v,s,null)}}for(let m of this.patternPositions.keys()){let g=Kl.parse(m);if(as.isEqual(g.id,h)){let v=t.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(m),v,s,this.lut)}}}}patchUpdatedImage(t,s,u,h=null){if(!t||!s||t.version===s.version)return;t.version=s.version;let[m,g]=t.tl,v=t.sdf;if(this.lut||v){let b={width:s.data.width,height:s.data.height},C=new Qo(b);Qo.copy(s.data,C,{x:0,y:0},{x:0,y:0},b,h,v),u.update(C,{position:{x:m,y:g}})}else u.update(s.data,{position:{x:m,y:g}})}}Lt(K0,"ImagePosition"),Lt(FF,"ImageAtlas");let Q0=1e20;function LF(l,t,s,u,h,m,g,v,b){for(let C=t;C<t+u;C++)NF(l,s*m+C,m,h,g,v,b);for(let C=s;C<s+h;C++)NF(l,C*m+t,1,u,g,v,b)}function NF(l,t,s,u,h,m,g){m[0]=0,g[0]=-Q0,g[1]=Q0,h[0]=l[t];for(let v=1,b=0,C=0;v<u;v++){h[v]=l[t+v*s];let T=v*v;do{let I=m[b];C=(h[v]-h[I]+T-I*I)/(v-I)/2}while(C<=g[b]&&--b>-1);b++,m[b]=v,g[b]=C,g[b+1]=Q0}for(let v=0,b=0;v<u;v++){for(;g[b+1]<v;)b++;let C=m[b],T=v-C;l[t+v*s]=h[C]+T*T}}let mc=2,cM={none:0,ideographs:1,all:2};class Og{constructor(t,s,u){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){let u=[],h=this.url||kn.GLYPHS_URL;for(let m in t)for(let g of t[m])u.push({stack:m,id:g});xe(u,({stack:m,id:g},v)=>{let b=this.entries[m];b||(b=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[g];if(C!==void 0)return void v(null,{stack:m,id:g,glyph:C});if(C=this._tinySDF(b,m,g),C)return b.glyphs[g]=C,void v(null,{stack:m,id:g,glyph:C});let T=Math.floor(g/256);if(256*T>65535)return At("glyphs > 65535 not supported"),void v(null,{stack:m,id:g,glyph:C});if(b.ranges[T])return void v(null,{stack:m,id:g,glyph:C});let I=b.requests[T];I||(I=b.requests[T]=[],Og.loadGlyphRange(m,T,h,this.requestManager,(D,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(let R in O.glyphs)this._doesCharSupportLocalGlyph(+R)||(b.glyphs[+R]=O.glyphs[+R]);b.ranges[T]=!0}for(let R of I)R(D,O);delete b.requests[T]})),I.push((D,O)=>{D?v(D):O&&v(null,{stack:m,id:g,glyph:O.glyphs[g]||null})})},(m,g)=>{if(m)s(m);else if(g){let v={};for(let{stack:b,id:C,glyph:T}of g)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[C]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;s(null,v)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==cM.none&&(this.localGlyphMode===cM.all?!!this.localFontFamily:!!this.localFontFamily&&(en["CJK Unified Ideographs"](t)||en["Hangul Syllables"](t)||en.Hiragana(t)||en.Katakana(t)||en["CJK Symbols and Punctuation"](t)||en["CJK Unified Ideographs Extension A"](t)||en["CJK Unified Ideographs Extension B"](t)||en.Osage(t)))}_tinySDF(t,s,u){let h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let m=t.tinySDF;if(!m){let B="400";/bold/i.test(s)?B="900":/medium/i.test(s)?B="500":/light/i.test(s)&&(B="200"),m=t.tinySDF=new Og.TinySDF({fontFamily:h,fontWeight:B,fontSize:24*mc,buffer:3*mc,radius:8*mc}),m.fontWeight=B}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];let g=String.fromCodePoint(u),{data:v,width:b,height:C,glyphWidth:T,glyphHeight:I,glyphLeft:D,glyphTop:O,glyphAdvance:R}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new vh({width:b,height:C},v),metrics:{width:T/mc,height:I/mc,left:D/mc,top:O/mc-27,advance:R/mc,localGlyph:!0}}}}Og.loadGlyphRange=function(l,t,s,u,h){let m=256*t,g=m+255,v=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${m}-${g}`),lp.Glyphs);Xl(v,(b,C)=>{if(b)h(b);else if(C){let T={},I=(function(D){return new Y1(D).readFields(v$,{})})(C);for(let D of I.glyphs)T[D.id]=D;h(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},Og.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:v=null}={}){this.buffer=t,this.cutoff=u,this.radius=s,this.lang=v;let b=this.size=l+4*t,C=this._createCanvas(b),T=this.ctx=C.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${m} ${l}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(l){let t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){let{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(l),g=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),b=Math.min(this.size-this.buffer,g+Math.ceil(u)),C=v+2*this.buffer,T=b+2*this.buffer,I=Math.max(C*T,0),D=new Uint8ClampedArray(I),O={data:D,width:C,height:T,glyphWidth:v,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(v===0||b===0)return O;let{ctx:R,buffer:B,gridInner:H,gridOuter:$}=this;this.lang&&(R.lang=this.lang),R.clearRect(B,B,v,b),R.fillText(l,B,B+g);let Y=R.getImageData(B,B,v,b);$.fill(Q0,0,I),H.fill(0,0,I);for(let Q=0;Q<b;Q++)for(let ie=0;ie<v;ie++){let he=Y.data[4*(Q*v+ie)+3]/255;if(he===0)continue;let le=(Q+B)*C+ie+B;if(he===1)$[le]=0,H[le]=Q0;else{let me=.5-he;$[le]=me>0?me*me:0,H[le]=me<0?me*me:0}}LF($,0,0,C,T,C,this.f,this.v,this.z),LF(H,B,B,v,b,C,this.f,this.v,this.z);for(let Q=0;Q<I;Q++){let ie=Math.sqrt($[Q])-Math.sqrt(H[Q]);D[Q]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};let uu=Kp;function zF(l,t){return l+t[1]-t[0]}function uM(l,t,s,u,h=1){let m=[],g=l.imagePrimary,v=g.pixelRatio,b=g.paddedRect.w-2*uu,C=g.paddedRect.h-2*uu,T=(l.right-l.left)*h,I=(l.bottom-l.top)*h,D=g.stretchX||[[0,b]],O=g.stretchY||[[0,C]],R=D.reduce(zF,0),B=O.reduce(zF,0),H=b-R,$=C-B,Y=0,Q=R,ie=0,he=B,le=0,me=H,ye=0,we=$;if(g.content&&u){let Ie=g.content;Y=Q1(D,0,Ie[0]),ie=Q1(O,0,Ie[1]),Q=Q1(D,Ie[0],Ie[2]),he=Q1(O,Ie[1],Ie[3]),le=Ie[0]-Y,ye=Ie[1]-ie,me=Ie[2]-Ie[0]-Q,we=Ie[3]-Ie[1]-he}let je=(Ie,We,Ke,Qe)=>{let st=J1(Ie.stretch-Y,Q,T,l.left*h),lt=ew(Ie.fixed-le,me,Ie.stretch,R),nt=J1(We.stretch-ie,he,I,l.top*h),it=ew(We.fixed-ye,we,We.stretch,B),qe=J1(Ke.stretch-Y,Q,T,l.left*h),He=ew(Ke.fixed-le,me,Ke.stretch,R),rt=J1(Qe.stretch-ie,he,I,l.top*h),yt=ew(Qe.fixed-ye,we,Qe.stretch,B),ft=new ot(st,nt),qt=new ot(qe,nt),It=new ot(qe,rt),Ot=new ot(st,rt),Bt=new ot(lt/v,it/v),In=new ot(He/v,yt/v),mt=t*Math.PI/180;if(mt){let gi=Math.sin(mt),ce=Math.cos(mt),pe=[ce,-gi,gi,ce];ft._matMult(pe),qt._matMult(pe),Ot._matMult(pe),It._matMult(pe)}let Vt=Ie.stretch+Ie.fixed,un=Ke.stretch+Ke.fixed,Ln=We.stretch+We.fixed,zn=Qe.stretch+Qe.fixed,_n=l.imageSecondary;return{tl:ft,tr:qt,bl:Ot,br:It,texPrimary:{x:g.paddedRect.x+uu+Vt,y:g.paddedRect.y+uu+Ln,w:un-Vt,h:zn-Ln},texSecondary:_n?{x:_n.paddedRect.x+uu+Vt,y:_n.paddedRect.y+uu+Ln,w:un-Vt,h:zn-Ln}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bt,pixelOffsetBR:In,minFontScaleX:me/v/T,minFontScaleY:we/v/I,isSDF:s}};if(u&&(g.stretchX||g.stretchY)){let Ie=BF(D,H,R),We=BF(O,$,B);for(let Ke=0;Ke<Ie.length-1;Ke++){let Qe=Ie[Ke],st=Ie[Ke+1];for(let lt=0;lt<We.length-1;lt++)m.push(je(Qe,We[lt],st,We[lt+1]))}}else m.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return m}function S$(l,t){let s=l.stretchY||[[0,l.paddedRect.h-2*uu]];return t&&(l.stretchX||l.stretchY)?VF(l.stretchX||[[0,l.paddedRect.w-2*uu]])*VF(s):1}function Q1(l,t,s){let u=0;for(let h of l)u+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return u}function BF(l,t,s){let u=[{fixed:-uu,stretch:0}];for(let[h,m]of l){let g=u[u.length-1];u.push({fixed:h-g.stretch,stretch:g.stretch}),u.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return u.push({fixed:t+uu,stretch:s}),u}function VF(l){return 2*l.length+1}function J1(l,t,s,u){return l/t*s+u}function ew(l,t,s,u){return l-t*s/u}function T$(l,t,s,u){let h=t+l.positionedLines[u].lineOffset;return u===0?s+h/2:s+(h+(t+l.positionedLines[u-1].lineOffset))/2}function I$(l,t=1,s=!1){let u=1/0,h=1/0,m=-1/0,g=-1/0,v=l[0];for(let O=0;O<v.length;O++){let R=v[O];(!O||R.x<u)&&(u=R.x),(!O||R.y<h)&&(h=R.y),(!O||R.x>m)&&(m=R.x),(!O||R.y>g)&&(g=R.y)}let b=Math.min(m-u,g-h),C=b/2,T=new wm([],M$);if(b===0)return new ot(u,h);for(let O=u;O<m;O+=b)for(let R=h;R<g;R+=b)T.push(new Rg(O+C,R+C,C,l));let I=(function(O){let R=0,B=0,H=0,$=O[0];for(let Y=0,Q=$.length,ie=Q-1;Y<Q;ie=Y++){let he=$[Y],le=$[ie],me=he.x*le.y-le.x*he.y;B+=(he.x+le.x)*me,H+=(he.y+le.y)*me,R+=3*me}return new Rg(B/R,H/R,0,O)})(l),D=T.length;for(;T.length;){let O=T.pop();(O.d>I.d||!I.d)&&(I=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-I.d<=t||(C=O.h/2,T.push(new Rg(O.p.x-C,O.p.y-C,C,l)),T.push(new Rg(O.p.x+C,O.p.y-C,C,l)),T.push(new Rg(O.p.x-C,O.p.y+C,C,l)),T.push(new Rg(O.p.x+C,O.p.y+C,C,l)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function M$(l,t){return t.max-l.max}class Rg{constructor(t,s,u,h){this.p=new ot(t,s),this.h=u,this.d=(function(m,g){let v=!1,b=1/0;for(let C=0;C<g.length;C++){let T=g[C];for(let I=0,D=T.length,O=D-1;I<D;O=I++){let R=T[I],B=T[O];R.y>m.y!=B.y>m.y&&m.x<(B.x-R.x)*(m.y-R.y)/(B.y-R.y)+R.x&&(v=!v),b=Math.min(b,wr(m,R,B))}}return(v?1:-1)*Math.sqrt(b)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}let D$=Object.keys,dM=Number.POSITIVE_INFINITY,A$=Math.sqrt(2);function xh(l,t,s,u,h){let m=oM(l)&&l.collisionPadding?l.collisionPadding:[0,0,0,0],g={top:l.top-m[1],bottom:l.bottom+m[3],left:l.left-m[0],right:l.right+m[2],scaled:!1};return u!==void 0&&(function(v,b){v.top*=b,v.bottom*=b,v.left*=b,v.right*=b,v.scaled=!0})(g,u),s&&(function(v,b){if(!b)return;let C=Zn(b),T=new ot(v.left,v.top),I=new ot(v.right,v.top),D=new ot(v.left,v.bottom),O=new ot(v.right,v.bottom),R=new ot(0,0);T._rotateAround(C,R),I._rotateAround(C,R),D._rotateAround(C,R),O._rotateAround(C,R),v.left=Math.min(T.x,I.x,D.x,O.x),v.right=Math.max(T.x,I.x,D.x,O.x),v.top=Math.min(T.y,I.y,D.y,O.y),v.bottom=Math.max(T.y,I.y,D.y,O.y)})(g,s),h&&(g.left+=h[0],g.right+=h[0],g.top+=h[1],g.bottom+=h[1]),t?{top:Math.min(t.top,g.top),bottom:Math.max(t.bottom,g.bottom),left:Math.min(t.left,g.left),right:Math.max(t.right,g.right),scaled:t.scaled||g.scaled}:g}function UF(l,[t,s]){let u=0,h=0;if(s===dM){t<0&&(t=0);let m=t/A$;switch(l){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(l){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),s=Math.abs(s),l){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(l){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,h]}function P$(l,t,s,u,h,m,g,v,b,C,T,I,D,O){let R=l.layers[0],B=R.appearances;if(B.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};let H={iconBBox:null,iconVerticalBBox:null},$={textBBox:null,textVerticalBBox:null},{baseIconRotate:Y,baseTextRotate:Q,iconScaleFactor:ie}=(function(le,me,ye){let we=le.get("icon-rotate").evaluate(me,{},ye),je=le.get("text-rotate").evaluate(me,{},ye),[Ie,We]=le.get("icon-size-scale-range");return{baseIconRotate:we,baseTextRotate:je,iconScaleFactor:G(1,Ie,We)}})(u,h,m);t&&(H.iconBBox=xh(t,H.iconBBox,Y,g),s)&&(H.iconVerticalBBox=xh(s,H.iconVerticalBBox,Y+90,g));let he=nw(I.horizontal);he&&($.textBBox=xh(he,$.textBBox,Q,1,O)),I.vertical&&($.textVerticalBBox=xh(I.vertical,$.textVerticalBBox,Q+90,1,O));for(let le of B)le.hasIconProperties()&&O$(H,l,R,le,h,m,v,Y,g,b,t,C,ie,T),le.hasTextProperties()&&R$($,R,le,h,m,O,Q,D,he,I.vertical);return{iconBBox:H.iconBBox,iconVerticalBBox:H.iconVerticalBBox,textBBox:$.textBBox,textVerticalBBox:$.textVerticalBBox}}function O$(l,t,s,u,h,m,g,v,b,C,T,I,D,O){let{appearanceIconOffset:R,appearanceIconRotate:B,appearanceIconSize:H}=(function(ie,he,le,me,ye,we,je,Ie){let We=ie.hasProperty("icon-offset")?he.getAppearanceValueAndResolveTokens(ie,"icon-offset",le,me,[]):null,Ke=We&&Array.isArray(We)?We:ye,Qe=ie.hasProperty("icon-rotate")?he.getAppearanceValueAndResolveTokens(ie,"icon-rotate",le,me,[]):null,st=typeof Qe=="number"?Qe:we,lt=ie.hasProperty("icon-size")?he.getAppearanceValueAndResolveTokens(ie,"icon-size",le,me,[]):null;return{appearanceIconOffset:Ke,appearanceIconRotate:st,appearanceIconSize:typeof lt=="number"?lt*Ie.iconScaleFactor:je}})(u,s,h,m,g,v,b,C),$=null,Y=null,Q=null;u.hasProperty("icon-image")?Q=(function(ie,he,le,me,ye,we,je){let Ie=null,We=he.getAppearanceValueAndResolveTokens(le,"icon-image",me,ye,[]);if(We){let Ke=ie.getResolvedImageFromTokens(We),Qe=le.getUnevaluatedProperty("icon-size"),st=J0(Ke,Ag(ie.zoom,Qe,ie.worldview),Qe,ye,ie.zoom,me,ie.pixelRatio,je,ie.worldview);Ie=we.get(st.iconPrimary.toString())}return Ie})(t,s,u,h,m,I,D):T&&(Q=T.imagePrimary),Q&&($=K1(Q,null,R,O),t.allowVerticalPlacement&&(Y=K1(Q,null,R,O))),$&&(l.iconBBox=xh($,l.iconBBox,B,H)),Y&&(l.iconVerticalBBox=xh(Y,l.iconVerticalBBox,B+90,H))}function R$(l,t,s,u,h,m,g,v,b,C){let{appearanceTextOffset:T,appearanceTextRotate:I,appearanceTextSize:D}=(function(R,B,H,$,Y,Q,ie){let he=R.hasProperty("text-offset")?B.getAppearanceValueAndResolveTokens(R,"text-offset",H,$,[]):null,le=he&&Array.isArray(he)?[he[0]*fo,he[1]*fo]:Y,me=R.hasProperty("text-rotate")?B.getAppearanceValueAndResolveTokens(R,"text-rotate",H,$,[]):null,ye=typeof me=="number"?me:Q,we=R.hasProperty("text-size")?B.getAppearanceValueAndResolveTokens(R,"text-size",H,$,[]):null;return{appearanceTextOffset:le,appearanceTextRotate:ye,appearanceTextSize:typeof we=="number"?we:ie}})(s,t,u,h,m,g,v),O=D/v;b&&(l.textBBox=xh(b,l.textBBox,I,O,T)),C&&(l.textVerticalBBox=xh(C,l.textVerticalBBox,I+90,O,T))}function tw(l,t,s,u,h,m,g,v,b){if(!t||!t.usvg)return;let C=MF(u),T=MF(h),I=m!=="both"&&m!=="width"||!TF(u)?1:T.width/C.width,D=m!=="both"&&m!=="height"||!IF(u)?1:T.height/C.height;s.scaleSelf(I,D);let O=s.toString();g.set(O,s),v.set(O,t);let{imagePosition:R}=lM(O,t,Kp);b.set(O,R)}function jF(l,t,s,u,h,m,g,v,b){if(!l)return;let C=(function(T,I,D,O,R,B){if(T.kind==="camera")return T.maxSize;if(T.kind==="composite"){let H=I.possiblyEvaluate(new Vi(T.maxZoom,{worldview:B}),D).evaluate(R,{},D),$=I.possiblyEvaluate(new Vi(T.minZoom,{worldview:B}),D).evaluate(R,{},D);return Math.max(H,$)}return I.possiblyEvaluate(new Vi(O,{worldview:B})).evaluate(R,{},D)})(t,s,u,h,m,b);return l.scaleSelf(C*v*g)}function J0(l,t,s,u,h,m,g,v,b){return{iconPrimary:jF(l.getPrimary(),t,s,u,h,m,g,v,b),iconSecondary:jF(l.getSecondary(),t,s,u,h,m,g,v,b)}}function k$(l,t,s){if(!t)return;let u=s.get(l.toString()),h=s.get(t.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||At(`Mismatch in icon variant sizes: ${l.toString()} and ${t.toString()}`),u.usvg!==h.usvg&&At(`Mismatch in icon variant image types: ${l.id} and ${t.id}`))}function $F(l,t,s,u){if(!l)return;let h=t.get(s.toString());if(l.imagePrimary=h,u){let m=t.get(u.toString());l.imageSecondary=m}}function F$(l,t){for(let s in l.horizontal)HF(l.horizontal[s],t);HF(l.vertical,t)}function HF(l,t){if(l){for(let s of l.positionedLines)for(let u of s.positionedGlyphs)if(u.image!==null){let h=u.image.toString();u.rect=t.get(h).paddedRect}}}function hM(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function L$(l,t,s,u,h,m,g,v,b){let C=nw(m.horizontal)||m.vertical,T=s.get("icon-text-fit-padding").evaluate(u,{},h),I,D=t;return t&&b!=="none"&&(l.allowVerticalPlacement&&m.vertical&&(I=sM(t,m.vertical,b,T,v,g)),C&&(D=sM(t,C,b,T,v,g))),{defaultShapedIcon:D,verticallyShapedIcon:I}}function N$(l,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y,Q,ie,he,le,me){let ye=g.textMaxSize.evaluate(t,{},D);ye===void 0?ye=v*g.textScaleFactor:ye*=g.textScaleFactor;let we=l.layers[0].layout,je=fo,Ie=v*g.textScaleFactor/je,We=nw(s.horizontal)||s.vertical;if(H!=="none"&&l.appearanceFeatureData&&t.index<l.appearanceFeatureData.length){let It=l.appearanceFeatureData[t.index];It&&(It.textShaping=We,It.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(t,{},D),It.fontScale=Ie)}let Ke=O.name==="globe",Qe=l.tilePixelRatio*ye/je,st=(rt=l.overscaling,l.zoom>18&&rt>2&&(rt>>=1),Math.max(vt/(512*rt),1)*we.get("symbol-spacing")),lt=we.get("text-padding")*l.tilePixelRatio,nt=we.get("icon-padding")*l.tilePixelRatio,it=Zn(we.get("text-max-angle")),qe=we.get("icon-rotation-alignment")==="map"&&Q!=="point",He=st/2;var rt;l.hasAnyIconTextFit===!1&&H!=="none"&&(l.hasAnyIconTextFit=!0);let yt=t.properties?+t.properties[Ge]:null,ft=yt&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(yt):65535,qt=(It,Ot,Bt)=>{if(Ot.x<0||Ot.x>=vt||Ot.y<0||Ot.y>=vt)return;let In=null;if(Ke){let{x:mt,y:Vt,z:un}=O.projectTilePoint(Ot.x,Ot.y,Bt);In={anchor:new vd(mt,Vt,un,0,void 0),up:O.upVector(Bt,Ot.x,Ot.y)}}(function(mt,Vt,un,Ln,zn,_n,gi,ce,pe,Ze,at,Et,St,Wt,Yt,mn,Cn,Tn,Pn,rn,cn,Hn,Xn,Kn,hi,Ii,_i,ei,oi,En,Nn,tr,tn){let On=mt.addToLineVertexArray(Vt,Ln),bi,Oi,Ui,Dr,Ni,nn,or,pi=0,Qi=0,Jr=0,mo=0,jr=-1,$r=-1,ao={},Ps=um(""),zi=un?un.anchor:Vt,Cr=ei!=="none",Ar=0,Us=0;if(pe._unevaluatedLayout.getValue("text-radial-offset")===void 0){let Lo=pe.layout.get("text-offset").evaluate(cn,{},hi);Ar=Lo[0]*fo,Us=Lo[1]*fo}else Ar=pe.layout.get("text-radial-offset").evaluate(cn,{},hi)*fo,Us=dM;if(mt.allowVerticalPlacement&&zn.vertical){let Lo=zn.vertical;if(Yt)nn=pM(Lo),ce&&(or=pM(ce));else{let vs=pe.layout.get("text-rotate").evaluate(cn,{},hi)+90;Ui=iw(Ze,zi,Vt,at,Et,St,Lo,Wt,vs,mn,tr),ce&&(Dr=iw(Ze,zi,Vt,at,Et,St,ce,Tn,vs,null,Nn))}}if(_n){let Lo=mt.iconSizeData,vs=pe.layout.get("icon-rotate").evaluate(cn,{},hi),oa=uM(_n,vs,Xn,Cr,Hn.iconScaleFactor),Ch=ce?uM(ce,vs,Xn,Cr,Hn.iconScaleFactor):void 0;Oi=iw(Ze,zi,Vt,at,Et,St,_n,Tn,vs,null,En);let Vg=(function(yc,_y,cN,YH,uN,dN,XH,KH){let hN=yc.layers[0],pN=hN.appearances,Ug=_y.length;if(cN&&(Ug=Math.max(Ug,cN.length)),pN.length===0)return Ug;let[QH,JH]=YH.get("icon-size-scale-range"),eG=G(1,QH,JH);for(let fN of pN){let mN=fN.getUnevaluatedProperties();if(mN._values["icon-image"].value!==void 0){let gN=hN.getAppearanceValueAndResolveTokens(fN,"icon-image",uN,dN,[]);if(gN){let _N=yc.getResolvedImageFromTokens(gN);if(_N){let vN=mN._values["icon-size"],tG=J0(_N,Ag(yc.zoom,vN,yc.worldview),vN,dN,yc.zoom,uN,yc.pixelRatio,eG,yc.worldview),nG=XH.get(tG.iconPrimary.toString());Ug=Math.max(Ug,S$(nG,KH))}}}}return Ug})(mt,oa,Ch,pe.layout,cn,hi,mt.iconAtlasPositions,Cr);pi=4*Vg;let vc=null;Lo.kind==="source"?(vc=[fc*pe.layout.get("icon-size").evaluate(cn,{},hi)*Hn.iconScaleFactor],vc[0]>yd&&At(`${mt.layerIds[0]}: Value for "icon-size" is >= ${ey}. Reduce your "icon-size".`)):Lo.kind==="composite"&&(vc=[fc*Hn.compositeIconSizes[0].evaluate(cn,{},hi)*Hn.iconScaleFactor,fc*Hn.compositeIconSizes[1].evaluate(cn,{},hi)*Hn.iconScaleFactor],(vc[0]>yd||vc[1]>yd)&&At(`${mt.layerIds[0]}: Value for "icon-size" is >= ${ey}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,oa,vc,rn,Pn,cn,void 0,un,Vt,On.lineStartIndex,On.lineLength,-1,Kn,hi,Ii,_i,mt.symbolInstances.length,Vg),jr=mt.icon.placedSymbolArray.length-1,Ch&&(Qi=4*Vg,mt.addSymbols(mt.icon,Ch,vc,rn,Pn,cn,ra.vertical,un,Vt,On.lineStartIndex,On.lineLength,-1,Kn,hi,Ii,_i,mt.symbolInstances.length,Vg),$r=mt.icon.placedSymbolArray.length-1)}for(let Lo in zn.horizontal){let vs=Lo,oa=zn.horizontal[vs];bi||(Ps=um(oa.text),Yt?Ni=pM(oa):bi=iw(Ze,zi,Vt,at,Et,St,oa,Wt,pe.layout.get("text-rotate").evaluate(cn,{},hi),mn,tr));let Ch=oa.positionedLines.length===1;if(Jr+=GF(mt,un,Vt,oa,gi,pe,Yt,cn,mn,On,zn.vertical?ra.horizontal:ra.horizontalOnly,Ch?D$(zn.horizontal):[vs],ao,jr,Hn,Kn,hi,mt.symbolInstances.length,Ii),Ch)break}zn.vertical&&(mo+=GF(mt,un,Vt,zn.vertical,gi,pe,Yt,cn,mn,On,ra.vertical,["vertical"],ao,$r,Hn,Kn,hi,mt.symbolInstances.length,Ii));let eo=-1,Dl=(Lo,vs)=>Lo?Math.max(Lo,vs):vs;eo=Dl(Ni,eo),eo=Dl(nn,eo),eo=Dl(or,eo);let du=eo>-1?1:0;mt.glyphOffsetArray.length>=65535&&At("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,cn.sortKey),mt.symbolInstances.emplaceBack(Vt.x,Vt.y,zi.x,zi.y,zi.z,ao.right>=0?ao.right:-1,ao.center>=0?ao.center:-1,ao.left>=0?ao.left:-1,ao.vertical>=0?ao.vertical:-1,jr,$r,Ps,bi!==void 0?bi:mt.collisionBoxArray.length,bi!==void 0?bi+1:mt.collisionBoxArray.length,Ui!==void 0?Ui:mt.collisionBoxArray.length,Ui!==void 0?Ui+1:mt.collisionBoxArray.length,Oi!==void 0?Oi:mt.collisionBoxArray.length,Oi!==void 0?Oi+1:mt.collisionBoxArray.length,Dr||mt.collisionBoxArray.length,Dr?Dr+1:mt.collisionBoxArray.length,at,Jr,mo,pi,Qi,du,0,Ar,Us,eo,0,Cr?1:0,oi)})(l,Ot,In,It,s,u,m,h,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,lt,Y,C,0,nt,qe,$,t,g,T,I,D,R,B,H,ft,ie,he,le)};if(Q==="line")for(let It of N1(t.geometry,0,0,vt,vt)){let Ot=E$(It,st,it,s.vertical||We,u,je,Qe,l.overscaling,vt);for(let Bt of Ot)We&&z$(l,We.text,He,Bt)||qt(It,Bt,D)}else if(Q==="line-center"){for(let It of t.geometry)if(It.length>1){let Ot=C$(It,it,s.vertical||We,u,je,Qe);Ot&&qt(It,Ot,D)}}else if(t.type==="Polygon")for(let It of L0(t.geometry,0)){let Ot=I$(It,16);qt(It[0],new vd(Ot.x,Ot.y,0,0,void 0),D)}else if(t.type==="LineString")for(let It of t.geometry)qt(It,new vd(It[0].x,It[0].y,0,0,void 0),D);else if(t.type==="Point")for(let It of t.geometry)for(let Ot of It)qt([Ot],new vd(Ot.x,Ot.y,0,0,void 0),D)}let ey=255,yd=ey*fc;function GF(l,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y){let Q=(function(le,me,ye,we,je,Ie,We,Ke){let Qe=[];if(me.positionedLines.length===0)return Qe;let st=we.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,lt=(function(rt){let yt=rt[0],ft=rt[1],qt=yt*ft;return qt>0?[yt,-ft]:qt<0?[-yt,ft]:yt===0?[ft,yt]:[ft,-yt]})(ye),nt=Math.abs(me.top-me.bottom);for(let rt of me.positionedLines)nt-=rt.lineOffset;let it=me.positionedLines.length,qe=nt/it,He=me.top-ye[1];for(let rt=0;rt<it;++rt){let yt=me.positionedLines[rt];He=T$(me,qe,He,rt);for(let ft of yt.positionedGlyphs){if(!ft.rect)continue;let qt=ft.rect||{},It=xF+1,Ot=!0,Bt=1,In=0;if(ft.image){let Cn=We.get(ft.image.toString());if(!Cn)continue;if(Cn.sdf){At("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,Bt=Cn.pixelRatio,It=Kp/Bt}let mt=(je||Ke)&&ft.vertical,Vt=ft.metrics.advance*ft.scale/2,un=ft.metrics,Ln=ft.rect;if(Ln===null)continue;Ke&&me.verticalizable&&(In=ft.image?Vt-ft.metrics.width*ft.scale/2:0);let zn=je?[ft.x+Vt,ft.y]:[0,0],_n=[0,0],gi=[0,0],ce=!1;je||(mt?(gi=[ft.x+Vt+lt[0],ft.y+lt[1]-In],ce=!0):_n=[ft.x+Vt+ye[0],ft.y+ye[1]-In]);let pe=Ln.w*ft.scale/(Bt*(ft.localGlyph?mc:1)),Ze=Ln.h*ft.scale/(Bt*(ft.localGlyph?mc:1)),at,Et,St,Wt;if(mt){let Cn=ft.y-He,Tn=new ot(-Vt,Vt-Cn),Pn=-Math.PI/2,rn=new ot(...gi);at=new ot(-Vt+_n[0],_n[1]),at._rotateAround(Pn,Tn)._add(rn),at.x+=-Cn+Vt,at.y-=(un.left-It)*ft.scale;let cn=ft.image?un.advance*ft.scale:fo*ft.scale,Hn=String.fromCodePoint(ft.glyph);a$(Hn)?at.x+=(1-It)*ft.scale:l$(Hn)?at.x+=cn-un.height*ft.scale+(-It-1)*ft.scale:at.x+=ft.image||un.width+2*It===Ln.w&&un.height+2*It===Ln.h?(cn-Ze)/2:(cn-(un.height+2*It)*ft.scale)/2,Et=new ot(at.x,at.y-pe),St=new ot(at.x+Ze,at.y),Wt=new ot(at.x+Ze,at.y-pe)}else{let Cn=(un.left-It)*ft.scale-Vt+_n[0],Tn=(-un.top-It)*ft.scale+_n[1],Pn=Cn+pe,rn=Tn+Ze;at=new ot(Cn,Tn),Et=new ot(Pn,Tn),St=new ot(Cn,rn),Wt=new ot(Pn,rn)}if(st){let Cn;Cn=je?new ot(0,0):ce?new ot(lt[0],lt[1]):new ot(ye[0],ye[1]),at._rotateAround(st,Cn),Et._rotateAround(st,Cn),St._rotateAround(st,Cn),Wt._rotateAround(st,Cn)}let Yt=new ot(0,0),mn=new ot(0,0);Qe.push({tl:at,tr:Et,bl:St,br:Wt,texPrimary:qt,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:zn,sectionIndex:ft.sectionIndex,isSDF:Ot,pixelOffsetTL:Yt,pixelOffsetBR:mn,minFontScaleX:0,minFontScaleY:0})}}return Qe})(0,u,b,m,g,v,h,l.allowVerticalPlacement),ie=l.textSizeData,he=null;ie.kind==="source"?(he=[fc*m.layout.get("text-size").evaluate(v,{},H)*R.textScaleFactor],he[0]>yd&&At(`${l.layerIds[0]}: Value for "text-size" is >= ${ey}. Reduce your "text-size".`)):ie.kind==="composite"&&(he=[fc*R.compositeTextSizes[0].evaluate(v,{},H)*R.textScaleFactor,fc*R.compositeTextSizes[1].evaluate(v,{},H)*R.textScaleFactor],(he[0]>yd||he[1]>yd)&&At(`${l.layerIds[0]}: Value for "text-size" is >= ${ey}. Reduce your "text-size".`)),l.addSymbols(l.text,Q,he,b,g,v,T,t,s,C.lineStartIndex,C.lineLength,O,B,H,Y,!1,$,Q.length);for(let le of I)D[le]=l.text.placedSymbolArray.length-1;return 4*Q.length}function nw(l){for(let t in l)return l[t];return null}function iw(l,t,s,u,h,m,g,v,b,C,T){let I,D,O,R;if(I=T?T.top:g.top,D=T?T.bottom:g.bottom,O=T?T.left:g.left,R=T?T.right:g.right,oM(g)&&g.collisionPadding){let B=g.collisionPadding;O-=B[0],I-=B[1],R+=B[2],D+=B[3]}if(b){let B=new ot(O,I),H=new ot(R,I),$=new ot(O,D),Y=new ot(R,D),Q=Zn(b),ie=new ot(0,0);C&&(ie=new ot(C[0],C[1])),B._rotateAround(Q,ie),H._rotateAround(Q,ie),$._rotateAround(Q,ie),Y._rotateAround(Q,ie),O=Math.min(B.x,H.x,$.x,Y.x),R=Math.max(B.x,H.x,$.x,Y.x),I=Math.min(B.y,H.y,$.y,Y.y),D=Math.max(B.y,H.y,$.y,Y.y)}return l.emplaceBack(t.x,t.y,t.z,s.x,s.y,O,I,R,D,v,u,h,m),l.length-1}function pM(l){oM(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);let t=l.bottom-l.top;return t>0?Math.max(10,t):null}function z$(l,t,s,u){let h=l.compareText;if(t in h){let m=h[t];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<s)return!0}else h[t]=[];return h[t].push(u),!1}function qF(l,t){let s=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,h=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),m=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01)),g=Math.sin(l._pitch)*m+h,v=h*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let b=Math.max(l.zoom-17,0);l.isOrthographic&&(b/=10),g*=1+b}return Math.min(1.01*g,v)}function ty(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};let s=Math.pow(2,-l.z),u=l.x*s,h=(l.x+1)*s,m=l.y*s,g=(l.y+1)*s,v=A(u),b=A(h),C=L(m),T=L(g),I=t.project(v,C),D=t.project(b,C),O=t.project(b,T),R=t.project(v,T),B=Math.min(I.x,D.x,O.x,R.x),H=Math.min(I.y,D.y,O.y,R.y),$=Math.max(I.x,D.x,O.x,R.x),Y=Math.max(I.y,D.y,O.y,R.y),Q=s/16;function ie(le,me,ye,we,je,Ie){let We=(ye+je)/2,Ke=(we+Ie)/2,Qe=t.project(A(We),L(Ke)),st=Math.max(0,B-Qe.x,H-Qe.y,Qe.x-$,Qe.y-Y);B=Math.min(B,Qe.x),$=Math.max($,Qe.x),H=Math.min(H,Qe.y),Y=Math.max(Y,Qe.y),st>Q&&(ie(le,Qe,ye,we,We,Ke),ie(Qe,me,We,Ke,je,Ie))}ie(I,D,u,m,h,m),ie(D,O,h,m,h,g),ie(O,R,h,g,u,g),ie(R,I,u,g,u,m),B-=Q,H-=Q,$+=Q,Y+=Q;let he=1/Math.max($-B,Y-H);return{scale:he,x:B*he,y:H*he,x2:$*he,y2:Y*he,projection:t}}function WF(l,{x:t,y:s},u=0){return new ot(((t-u)*l.scale-l.x)*vt,(s*l.scale-l.y)*vt)}let B$=ht(new Float32Array(16));class bh{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new c(0,0)}projectTilePoint(t,s,u){return{x:t,y:s,z:0}}locationPoint(t,s,u,h=!0){return t._coordinatePoint(t.locationCoordinate(s,u),h)}pixelsPerMeter(t,s){return M(1,t)*s}pixelSpaceConversion(t,s,u){return 1}farthestPixelDistance(t){return qF(t,t.pixelsPerMeter)}pointCoordinate(t,s,u,h){let m=t.horizonLineFromTop(!1),g=new ot(s,Math.max(m,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,s,u){let h=new ot(s,u);if(t.elevation)return t.elevation.pointCoordinate(h);{let m=this.pointCoordinate(t,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(t,s){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,s.x,s.y);let u=t.horizonLineFromTop();return s.y<u}createInversionMatrix(t,s){return B$}createTileMatrix(t,s,u){let h,m,g,v=u.canonical,b=ht(new Float64Array(16));if(this.isReprojectedInTileSpace){let C=ty(v,this);h=1,m=C.x+u.wrap*C.scale,g=C.y,Vn(b,b,[h/C.scale,h/C.scale,t.pixelsPerMeter/s])}else h=s/t.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*u.wrap)*h,g=v.y*h;return Xt(b,b,[m,g,0]),Vn(b,b,[h/vt,h/vt,1]),b}upVector(t,s,u){return[0,0,1]}upVectorScale(t,s,u){return{metersToTile:1}}}class V$ extends bh{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[s,u]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Zn(s));this.n=(h+Math.sin(Zn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,s){let{n:u,c:h,r0:m}=this,g=Zn(t-this.center[0]),v=Zn(s),b=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:b*Math.sin(g*u),y:b*Math.cos(g*u)-m,z:0}}unproject(t,s){let{n:u,c:h,r0:m}=this,g=m+s,v=Math.atan2(t,Math.abs(g))*Math.sign(g);g*u<0&&(v-=Math.PI*Math.sign(t)*Math.sign(g));let b=Zn(this.center[0])*u;v=se(v,-Math.PI-b,Math.PI-b);let C=G(os(v/u)+this.center[0],-180,180),T=Math.asin(G((h-(t*t+g*g)*u*u)/(2*u),-1,1)),I=G(os(T),-N,N);return new c(C,I)}}let ny=1.340264,iy=-.081106,ry=893e-6,oy=.003796,rw=Math.sqrt(3)/2;class U$ extends bh{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;let u=Math.asin(rw*Math.sin(s)),h=u*u,m=h*h*h;return{x:.5*(t*Math.cos(u)/(rw*(ny+3*iy*h+m*(7*ry+9*oy*h)))/Math.PI+.5),y:1-.5*(u*(ny+iy*h+m*(ry+oy*h))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=u*u,m=h*h*h;for(let T,I,D,O=0;O<12&&(I=u*(ny+iy*h+m*(ry+oy*h))-s,D=ny+3*iy*h+m*(7*ry+9*oy*h),T=I/D,u=G(u-T,-Math.PI/3,Math.PI/3),h=u*u,m=h*h*h,!(Math.abs(T)<1e-12));++O);let g=rw*t*(ny+3*iy*h+m*(7*ry+9*oy*h))/Math.cos(u),v=Math.asin(Math.sin(u)/rw),b=G(180*g/Math.PI,-180,180),C=G(180*v/Math.PI,-N,N);return new c(b,C)}}class j$ extends bh{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){let u=360*(t-.5),h=G(360*(.5-s),-N,N);return new c(u,h)}}let kg=Math.PI/2;function ow(l){return Math.tan((kg+l)/2)}class $$ extends bh{constructor(t){super(t),this.center=t.center||[0,30];let[s,u]=this.parallels=t.parallels||[30,30],h=Zn(s),m=Zn(u);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);let g=Math.cos(h),v=ow(h);this.n=h===m?Math.sin(h):Math.log(g/Math.cos(m))/Math.log(ow(m)/v),this.f=g*Math.pow(ow(h),this.n)/this.n}project(t,s){s=Zn(s),this.southernCenter&&(s=-s),t=Zn(t-this.center[0]);let u=1e-6,{n:h,f:m}=this;m>0?s<-kg+u&&(s=-kg+u):s>kg-u&&(s=kg-u);let g=m/Math.pow(ow(s),h),v=g*Math.sin(h*t),b=m-g*Math.cos(h*t);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;let{n:u,f:h}=this,m=h-s,g=Math.sign(m),v=Math.sign(u)*Math.sqrt(t*t+m*m),b=Math.atan2(t,Math.abs(m))*g;m*u<0&&(b-=Math.PI*Math.sign(t)*g);let C=G(os(b/u)+this.center[0],-180,180),T=G(os(2*Math.atan(Math.pow(h/v,1/u))-kg),-N,N);return new c(C,this.southernCenter?-T:T)}}class ZF extends bh{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:w(t),y:S(s),z:0}}unproject(t,s){let u=A(t),h=L(s);return new c(u,h)}}let YF=Zn(N);class H$ extends bh{project(t,s){let u=(s=Zn(s))*s,h=u*u;return{x:.5*((t=Zn(t))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=25,m=0,g=u*u;do{g=u*u;let C=g*g;m=(u*(1.007226+g*(.015085+C*(.028874*g-.044475-.005916*C)))-s)/(1.007226+g*(.045255+C*(.259866*g-.311325-.005916*11*C))),u=G(u-m,-YF,YF)}while(Math.abs(m)>1e-6&&--h>0);g=u*u;let v=G(os(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=os(u);return new c(v,b)}}let XF=Zn(N);class G$ extends bh{project(t,s){s=Zn(s),t=Zn(t);let u=Math.cos(s),h=2/Math.PI,m=Math.acos(u*Math.cos(t/2)),g=Math.sin(m)/m,v=.5*(t*h+2*u*Math.sin(t/2)/g)||0,b=.5*(s+Math.sin(s)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,s){let u=t=(2*t-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,m=25,g=1e-6,v=0,b=0;do{let C=Math.cos(h),T=Math.sin(h),I=2*T*C,D=T*T,O=C*C,R=Math.cos(u/2),B=Math.sin(u/2),H=2*R*B,$=B*B,Y=1-O*R*R,Q=Y?1/Y:0,ie=Y?Math.acos(C*R)*Math.sqrt(1/Y):0,he=.5*(2*ie*C*B+2*u/Math.PI)-t,le=.5*(ie*T+h)-s,me=.5*Q*(O*$+ie*C*R*D)+1/Math.PI,ye=Q*(H*I/4-ie*T*B),we=.125*Q*(I*B-ie*T*O*H),je=.5*Q*(D*R+ie*$*C)+.5,Ie=ye*we-je*me;v=(le*ye-he*je)/Ie,b=(he*we-le*me)/Ie,u=G(u-v,-Math.PI,Math.PI),h=G(h-b,-XF,XF)}while((Math.abs(v)>g||Math.abs(b)>g)&&--m>0);return new c(os(u),os(h))}}class KF extends bh{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){let{scale:u,cosPhi:h}=this;return{x:Zn(t)*h*u+.5,y:-Math.sin(Zn(s))/h*u+.5,z:0}}unproject(t,s){let{scale:u,cosPhi:h}=this,m=-(s-.5)/u,g=G(os((t-.5)/u)/h,-180,180),v=Math.asin(G(m*h,-1,1)),b=G(os(v),-N,N);return new c(g,b)}}class q$ extends ZF{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,s,u){let h=A0(t,s,u);return Fr(h,h,M1(Ja(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,s,u){let h=fh(s.lat,s.lng),m=Yi([],h),g=u?t._centerAltitude+u:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude;Xs(h,h,m,M(1,0)*vt*g);let v=ht(new Float64Array(16));return Mt(v,t.pixelMatrix,t.globeMatrix),Fr(h,h,v),new ot(h[0],h[1])}pixelsPerMeter(t,s){return M(1,0)*s}pixelSpaceConversion(t,s,u){let h=M(1,t)*s,m=on(M(1,45)*s,h,u);return this.pixelsPerMeter(t,s)/m}createTileMatrix(t,s,u){let h=vI(Ja(u.canonical));return Mt(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,s){let{center:u}=t,h=M1(Ja(s));return $i(h,h,Zn(u.lng)),sr(h,h,Zn(u.lat)),Vn(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,s,u,h){return gh(t,s,u,!0)||new ee(0,0)}pointCoordinate3D(t,s,u){let h=this.pointCoordinate(t,s,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,s){return!gh(t,s.x,s.y,!1)}farthestPixelDistance(t){let s=(function(h,m){let g=h.cameraToCenterDistance,v=h._centerAltitude*m,b=h._camera,C=h._camera.forward(),T=Wr([],fr([],C,-g),[0,0,v]),I=h.worldSize/(2*Math.PI),D=[0,0,-I],O=h.width/h.height,R=Math.tan(h.fovAboveCenter),B=fr([],b.up(),R),H=fr([],b.right(),R*O),$=Yi([],Wr([],Wr([],C,B),H)),Y=[],Q;if(new zt(T,$).closestPointOnSphere(D,I,Y)){let ie=Wr([],Y,D),he=Br([],ie,T);Q=Math.cos(h.fovAboveCenter)*xo(he)}else{let ie=Br([],T,D),he=Br([],D,T);Yi(he,he);let le=xo(ie)-I;Q=Math.sqrt(le*(le+2*I));let me=Math.acos(Q/(I+le))-Math.acos(Ir(C,he));Q*=Math.cos(me)}return 1.01*Q})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=_h(t.zoom);if(u>0){let h=qF(t,M(1,t.center.lat)*t.worldSize),m=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return on(s,h+m*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(t,s,u){return A0(s,u,t,1)}upVectorScale(t){return{metersToTile:Il(I1(Ja(t)))}}}function QF(l){let t=l.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new ZF(l);case"equirectangular":return new j$(l);case"naturalEarth":return new H$(l);case"equalEarth":return new U$(l);case"winkelTripel":return new G$(l);case"albers":return s?new KF(l):new V$(l);case"lambertConformalConic":return s?new KF(l):new $$(l);case"globe":return new q$(l)}throw new Error(`Invalid projection name: ${l.name}`)}let W$=Ce.types,Z$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sy(l,t,s,u,h,m,g,v,b,C,T,I,D){let O=v?Math.min(yd,Math.round(v[0])):0,R=v?Math.min(yd,Math.round(v[1])):0;l.emplaceBack(t,s,Math.round(32*u),Math.round(32*h),m,g,(O<<1)+(b?1:0),0+(R<<1),16*C,16*T,256*I,256*D)}function ay(l,t,s){l.emplaceBack(t,s)}function ly(l,t,s,u,h,m,g){l.emplaceBack(t,s,u,h,m,g)}let sw=(l,t,s,u)=>{for(let h=0;h<t;h++)l.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function Fg(l,t,s,u,h){l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h)}function Y$(l){for(let t of l.sections)if(nI(t.text))return!0;return!1}class fM{constructor(t){this.layoutVertexArray=new p0,this.indexArray=new Xr,this.programConfigurations=t,this.segments=new nr,this.dynamicLayoutVertexArray=new ou,this.opacityVertexArray=new rg,this.placedSymbolArray=new x1,this.iconTransitioningVertexArray=new ta,this.globeExtVertexArray=new f0,this.zOffsetVertexArray=new oc,this.orientationVertexArray=new _0,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(t,s){let u=[],h=this.layoutVertexArray.uint16;for(let m=0;m<s;++m){let g=12*(t+m);u.push(...h.slice(g,g+12))}return u}updateIconVertexData(t,s,u,h,m,g,v,b,C,T,I,D,O){let R=this.layoutVertexArray.uint16,B=12*t;R[B]=s,R[B+1]=u,R[B+2]=h,R[B+3]=m,R[B+4]=g,R[B+5]=v,R[B+6]=b,R[B+7]=C,R[B+8]=T,R[B+9]=I,R[B+10]=D,R[B+11]=O}upload(t,s,u,h,m,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,K8.members,!!g),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,J8.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Z$,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,n$.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Q8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,e$.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,t$.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Lt(fM,"SymbolBuffers");class mM{constructor(t,s,u){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new u,this.segments=new nr,this.collisionVertexArray=new m0,this.collisionVertexArrayExt=new ou}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,i$.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,r$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Lt(mM,"CollisionBuffers");class aw{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ht([]),this.placementViewportMatrix=ht([]);let s=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.localizable=t.localizable,this.textSizeData=Ag(this.zoom,s["text-size"],this.worldview),this.iconSizeData=Ag(this.zoom,s["icon-size"],this.worldview);let u=this.layers[0].layout,h=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.lut=t.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>ra[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(t){let s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(t)!=null)}createArrays(){this.text=new fM(new Ka(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new fM(new Ka(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new hg,this.lineVertexArray=new w1,this.symbolInstances=new w0}calculateGlyphDependencies(t,s,u,h,m){for(let g of t){let v=g.codePointAt(0);if(v===void 0)break;if(s[v]=!0,h&&m&&v<=65535){let b=Y0[g];b&&(s[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(t,s,u,h,m,g){let v=1,b=t.getUnevaluatedProperties()._values["icon-size"],C=Ag(this.zoom,b,this.worldview),T=Pg(C,s);if(C.kind!=="constant"&&C.kind!=="camera"||(v=T.uSize),C.kind==="composite"){let{minZoom:I,maxZoom:D}=C,O=b.possiblyEvaluate(new Vi(I,{worldview:this.worldview}),h),R=b.possiblyEvaluate(new Vi(D,{worldview:this.worldview}),h),B=O.evaluate(u,{},h,m);v=B+(R.evaluate(u,{},h,m)-B)*T.uSizeT}return C.kind==="source"&&(v=b.possiblyEvaluate(new Vi(this.zoom,{worldview:this.worldview}),h).evaluate(u,{},h,m)),v*g}updateFootprints(t,s){}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!k1(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(t){return typeof t=="string"?ps.build(t):t}populate(t,s,u,h){let m=this.layers[0],g=m.layout,v=this.projection.name==="globe",b=g.get("text-font"),C=g.get("text-field"),T=g.get("icon-image"),[I,D]=g.get("icon-size-scale-range"),O=G(s.scaleFactor||1,I,D),R=(C.value.kind!=="constant"||C.value.value instanceof hs&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),$=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!R&&!B&&!H)return;let Y=s.iconDependencies,Q=s.glyphDependencies,ie=s.availableImages,he=new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),le=me=>{let ye=me.id.toString();Y.has(ye)?Y.get(ye).push(me):Y.set(ye,[me])};for(let me of t){let{feature:ye,id:we,index:je,sourceLayerIndex:Ie}=me,We=m._featureFilter.needGeometry,Ke=Te(ye,We);if(!m._featureFilter.filter(he,Ke,u))continue;if(We||(Ke.geometry=_e(ye,u,h)),v&&ye.type!==1&&u.z<=5){let rt=Ke.geometry,yt=.98078528056,ft=(qt,It)=>Ir(A0(qt.x,qt.y,u,1),A0(It.x,It.y,u,1))<yt;for(let qt=0;qt<rt.length;qt++)rt[qt]=de(rt[qt],ft)}let Qe,st;if(R){let rt=m.getValueAndResolveTokens("text-field",Ke,u,ie),yt=hs.factory(rt);Y$(yt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fp()==="unavailable"||this.hasRTLText&&rc.isParsed())&&(Qe=s$(yt,m,Ke))}if(B){let rt=m.getValueAndResolveTokens("icon-image",Ke,u,ie);st=this.getResolvedImageFromTokens(rt)}let lt=this.layers[0],nt=!1;if(!st&&H){let rt=lt.getAppearances();for(let yt of rt)if(yt.getProperty("icon-image")){let ft=lt.getAppearanceValueAndResolveTokens(yt,"icon-image",Ke,u,ie);if(ft){st=this.getResolvedImageFromTokens(ft),nt=!0;break}}}if(!Qe&&!st)continue;let it=this.sortFeaturesByKey?$.evaluate(Ke,{},u):void 0,qe={id:we,text:Qe,icon:st,index:je,sourceLayerIndex:Ie,geometry:Ke.geometry,properties:ye.properties,type:W$[ye.type],sortKey:it};if(this.features.push(qe),this.featureToAppearanceIndex[je]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:we,properties:ye.properties,usesAppearanceIconAsPlaceholder:nt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),st){let rt=lt._unevaluatedLayout._values,{iconPrimary:yt,iconSecondary:ft}=J0(st,this.iconSizeData,rt["icon-size"],u,this.zoom,qe,this.pixelRatio,O,this.worldview);le(yt),ft&&(this.hasAnySecondaryIcon=!0,le(ft))}let He=lt.getAppearances();if(He.length!==0&&He.forEach(rt=>{if(!rt.getProperty("icon-image"))return;let yt=this.getCombinedIconPrimary(rt,lt,Ke,u,ie,qe,O);yt&&le(yt)}),Qe){let rt=b.evaluate(Ke,{},u).join(","),yt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ra.vertical)>=0;for(let ft of Qe.sections)if(ft.image){let qt=ft.image.getPrimary().scaleSelf(this.pixelRatio),It=qt.id.toString(),Ot=Y.get(It)||[];Ot.push(qt),Y.set(It,Ot)}else{let qt=Rp(Qe.toString()),It=ft.fontStack||rt,Ot=Q[It]=Q[It]||{};this.calculateGlyphDependencies(ft.text,Ot,yt,this.allowVerticalPlacement,qt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(me){let ye={},we={},je=[],Ie=0;function We(lt){je.push(me[lt]),Ie++}function Ke(lt,nt,it){let qe=we[lt];return delete we[lt],we[nt]=qe,je[qe].geometry[0].pop(),je[qe].geometry[0]=je[qe].geometry[0].concat(it[0]),qe}function Qe(lt,nt,it){let qe=ye[nt];return delete ye[nt],ye[lt]=qe,je[qe].geometry[0].shift(),je[qe].geometry[0]=it[0].concat(je[qe].geometry[0]),qe}function st(lt,nt,it){let qe=it?nt[0][nt[0].length-1]:nt[0][0];return`${lt}:${qe.x}:${qe.y}`}for(let lt=0;lt<me.length;lt++){let nt=me[lt],it=nt.geometry,qe=nt.text?nt.text.toString():null;if(!qe){We(lt);continue}let He=st(qe,it),rt=st(qe,it,!0);if(He in we&&rt in ye&&we[He]!==ye[rt]){let yt=Qe(He,rt,it),ft=Ke(He,rt,je[yt].geometry);delete ye[He],delete we[rt],we[st(qe,je[ft].geometry,!0)]=ft,je[yt].geometry=null}else He in we?Ke(He,rt,it):rt in ye?Qe(He,rt,it):(We(lt),ye[He]=Ie-1,we[rt]=Ie-1)}return je.filter(lt=>lt.geometry)})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(let me of s.elevationFeatures)this.elevationFeatureIdToIndex.set(me.id,this.elevationFeatures.length),this.elevationFeatures.push(me)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((me,ye)=>me.sortKey-ye.sortKey)}getCombinedIconPrimary(t,s,u,h,m,g,v){let b,C,T=t.getUnevaluatedProperties();if(T._values["icon-image"].value!==void 0){let I=s.getAppearanceValueAndResolveTokens(t,"icon-image",u,h,m);b=this.getResolvedImageFromTokens(I)}else{let I=s.getValueAndResolveTokens("icon-image",u,h,m);b=this.getResolvedImageFromTokens(I)}if(b){let I=T._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];C=J0(b,Ag(this.zoom,I,this.worldview),I,h,this.zoom,g,this.pixelRatio,v,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(t,s,u,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;let m=this.layers[0],g=!1,v=0,b=m.layout,[C,T]=b.get("icon-size-scale-range"),I=G(1,C,T);for(let D=0;D<this.symbolInstances.length;D++){let O=this.symbolInstances.get(D),R=this.featureToAppearanceIndex[O.featureIndex],B=R!==void 0?this.appearanceFeatureData[R]:void 0;if(B&&O.placedIconSymbolIndex>=0){let H=B.id,$=s&&H!==void 0?s[String(H)]:void 0,Y={type:"Point",id:B.id,properties:B.properties,geometry:[]},Q=this.layers[0].appearances&&this.layers[0].appearances.find(ie=>ie.isActive({globals:h,feature:Y,canonical:t,featureState:$}));if(B.activeAppearance===Q){v+=O.numIconVertices;continue}if(Q){B.activeAppearance=Q;let ie=this.getCombinedIconPrimary(Q,m,Y,t,u,{sortKey:void 0,text:void 0,icon:null,index:O.featureIndex,sourceLayerIndex:O.featureIndex,geometry:[],properties:B.properties,type:"Point",id:B.id},I);if(!ie)continue;let he=ie.toString(),le=this.iconAtlasPositions&&this.iconAtlasPositions.get(he);if(le){let me=m.getAppearanceValueAndResolveTokens(Q,"icon-offset",Y,t,u),ye=me&&Array.isArray(me)?me:[0,0],we=K1(le,void 0,ye,m.layout.get("icon-anchor").evaluate(Y,{},t)),je=m.getAppearanceValueAndResolveTokens(Q,"icon-rotate",Y,t,u),Ie=typeof je=="number"?je:0,We=le.sdf,Ke=m.layout.get("icon-text-fit").constantOr("none");Ke!=="none"&&B.textShaping&&B.iconTextFitPadding&&B.fontScale&&(we=sM(we,B.textShaping,Ke,B.iconTextFitPadding,ye,B.fontScale));let Qe=this.calculateEffectiveAppearanceIconSize(Q,h.zoom,Y,t,u,I),st=0,lt=1+(Math.min(yd,Math.round(Qe*fc))<<1),nt=uM(we,Ie,We,Ke!=="none",I);B.isUsingAppearanceVertexData||(B.isUsingAppearanceVertexData=!0,B.layoutBasedVertexData=this.icon.getIconVertexData(v,O.numIconVertices));for(let qe=0;qe<nt.length;++qe){let He=nt[qe],rt=B.layoutBasedVertexData[0]||O.tileAnchorX,yt=B.layoutBasedVertexData[1]||O.tileAnchorY,ft=16*He.pixelOffsetTL.x,qt=16*He.pixelOffsetTL.y,It=16*He.pixelOffsetBR.x,Ot=16*He.pixelOffsetBR.y,Bt=16*He.minFontScaleX,In=16*He.minFontScaleY;this.icon.updateIconVertexData(v,rt,yt,Math.round(32*He.tl.x),Math.round(32*He.tl.y),He.texPrimary.x,He.texPrimary.y,st,lt,ft,qt,Bt,In),this.icon.updateIconVertexData(v+1,rt,yt,Math.round(32*He.tr.x),Math.round(32*He.tr.y),He.texPrimary.x+He.texPrimary.w,He.texPrimary.y,st,lt,It,qt,Bt,In),this.icon.updateIconVertexData(v+2,rt,yt,Math.round(32*He.bl.x),Math.round(32*He.bl.y),He.texPrimary.x,He.texPrimary.y+He.texPrimary.h,st,lt,ft,Ot,Bt,In),this.icon.updateIconVertexData(v+3,rt,yt,Math.round(32*He.br.x),Math.round(32*He.br.y),He.texPrimary.x+He.texPrimary.w,He.texPrimary.y+He.texPrimary.h,st,lt,It,Ot,Bt,In),v+=4}let it=O.numIconVertices-4*nt.length;for(let qe=0;qe<it;++qe)this.icon.updateIconVertexData(v+qe,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else v+=O.numIconVertices}else if(B.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),v+=O.numIconVertices,B.activeAppearance=null;else if(B.isUsingAppearanceVertexData){let he=B.layoutBasedVertexData.length/12;for(let le=0;le<he;++le){let me=le*12;this.icon.updateIconVertexData(v+le,B.layoutBasedVertexData[me+0],B.layoutBasedVertexData[me+1],B.layoutBasedVertexData[me+2],B.layoutBasedVertexData[me+3],B.layoutBasedVertexData[me+4],B.layoutBasedVertexData[me+5],B.layoutBasedVertexData[me+6],B.layoutBasedVertexData[me+7],B.layoutBasedVertexData[me+8],B.layoutBasedVertexData[me+9],B.layoutBasedVertexData[me+10],B.layoutBasedVertexData[me+11])}v+=he,B.isUsingAppearanceVertexData=!1,B.activeAppearance=null,g=!0}else v+=O.numIconVertices,B.activeAppearance=null}}return g}update(t,s,u,h,m,g,v){this.text.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1,u=q(t),h=1/u,m=!1,g=!1;for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v),C=yr(1,0,0),T=yr(0,1,0),{numHorizontalGlyphVertices:I,numVerticalGlyphVertices:D,numIconVertices:O,numVerticalIconVertices:R}=b,B=I>0||D>0,H=O>0,$=this.elevationFeatures[b.elevationFeatureIndex];if($){let Y=new ot(b.tileAnchorX,b.tileAnchorY),Q=.075+$.pointElevation(Y);b.zOffset!==Q&&(s=!0,b.zOffset=Q),Q!==0&&(this.hasAnyZOffset=!0);let ie=$.computeSlopeNormal(Y,h),he=$d(ql(),yr(0,0,1),ie);Vc(C,C,he),Vc(T,T,he),C[2]*=u,T[2]*=u,C[0]===1&&C[1]===0&&C[2]===0&&T[0]===0&&T[1]===1&&T[2]===0||(m=m||B,g=g||H)}if(B&&(sw(this.text.orientationVertexArray,I,C,T),sw(this.text.orientationVertexArray,D,C,T)),H){let{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:Q}=b;Y>=0&&sw(this.icon.orientationVertexArray,O,C,T),Q>=0&&sw(this.icon.orientationVertexArray,R,C,T)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let t=(m,g,v)=>{u+=g,u>m.length&&m.resize(u);for(let b=-g;b<0;b++)m.emplace(b+u,v)},s=(m,g,v)=>{h+=g,h>m.length&&m.resize(h);for(let b=-g;b<0;b++)m.emplace(b+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){let g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:C}=g,T=g.zOffset,I=C>0;if((v>0||b>0)&&(t(this.text.zOffsetVertexArray,v,T),t(this.text.zOffsetVertexArray,b,T)),I){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:O}=g;D>=0&&s(this.icon.zOffsetVertexArray,C,T),O>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t,s,u,h,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(t,s,u,h){return!!(t&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(t,s,u,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=QF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){let u=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:h,y:m}of s)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,s,u,h,m,g,v,b,C,T,I,D,O,R,B,H,$,Y){let Q=t.indexArray,ie=t.layoutVertexArray,he=t.globeExtVertexArray,le=t.segments.prepareSegment(4*Y,ie,Q,this.canOverlap?g.sortKey:void 0),me=this.glyphOffsetArray.length,ye=le.vertexLength,we=this.allowVerticalPlacement&&v===ra.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let Ke=0;Ke<s.length;Ke++){let{tl:Qe,tr:st,bl:lt,br:nt,texPrimary:it,texSecondary:qe,pixelOffsetTL:He,pixelOffsetBR:rt,minFontScaleX:yt,minFontScaleY:ft,glyphOffset:qt,isSDF:It,sectionIndex:Ot}=s[Ke],Bt=le.vertexLength,In=qt[1];if(sy(ie,C.x,C.y,Qe.x,In+Qe.y,it.x,it.y,u,It,He.x,He.y,yt,ft),sy(ie,C.x,C.y,st.x,In+st.y,it.x+it.w,it.y,u,It,rt.x,He.y,yt,ft),sy(ie,C.x,C.y,lt.x,In+lt.y,it.x,it.y+it.h,u,It,He.x,rt.y,yt,ft),sy(ie,C.x,C.y,nt.x,In+nt.y,it.x+it.w,it.y+it.h,u,It,rt.x,rt.y,yt,ft),b){let{x:mt,y:Vt,z:un}=b.anchor,[Ln,zn,_n]=b.up;ly(he,mt,Vt,un,Ln,zn,_n),ly(he,mt,Vt,un,Ln,zn,_n),ly(he,mt,Vt,un,Ln,zn,_n),ly(he,mt,Vt,un,Ln,zn,_n),Fg(t.dynamicLayoutVertexArray,mt,Vt,un,we)}else Fg(t.dynamicLayoutVertexArray,C.x,C.y,C.z,we);if(H){let mt=qe||it;ay(t.iconTransitioningVertexArray,mt.x,mt.y),ay(t.iconTransitioningVertexArray,mt.x+mt.w,mt.y),ay(t.iconTransitioningVertexArray,mt.x,mt.y+mt.h),ay(t.iconTransitioningVertexArray,mt.x+mt.w,mt.y+mt.h)}Q.emplaceBack(Bt,Bt+1,Bt+2),Q.emplaceBack(Bt+1,Bt+2,Bt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qt[0]),Ke!==s.length-1&&Ot===s[Ke+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,g,g.index,{},O,R,B,je&&je[Ot],this.worldview)}let Ie=Y-s.length;Ie!==0&&this._addNullVertices(Ie,ie,u,b,he,t,H,le,Q);let We=b?b.anchor:C;t.placedSymbolArray.emplaceBack(We.x,We.y,We.z,C.x,C.y,me,this.glyphOffsetArray.length-me,ye,T,I,C.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,0,0,D,0),t.symbolInstanceIndices.push($)}_addNullVertices(t,s,u,h,m,g,v,b,C){for(let T=0;T<t;T++){for(let D=0;D<4;D++)sy(s,0,0,0,0,0,0,u,!1,0,0,0,0),h&&ly(m,0,0,0,0,0,0),Fg(g.dynamicLayoutVertexArray,0,0,0,0),v&&ay(g.iconTransitioningVertexArray,0,0);let I=b.vertexLength;C.emplaceBack(I,I+1,I+2),C.emplaceBack(I+1,I+2,I+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(t,s,u,h,m,g,v){t.emplaceBack(s,u,h,m,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,s,u,h,m,g,v){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=b.vertexLength,T=v.tileAnchorX,I=v.tileAnchorY;for(let O=0;O<4;O++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,t.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new ot(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new ot(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new ot(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new ot(t.x1,t.y2)),b.vertexLength+=4;let D=u.indexArray;D.emplaceBack(C,C+1),D.emplaceBack(C+1,C+2),D.emplaceBack(C+2,C+3),D.emplaceBack(C+3,C),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,u,h,m,g){for(let v=h;v<m;v++){let b=u.get(v),C=this.getSymbolInstanceTextSize(t,g,s,v);this._addCollisionDebugVertices(b,C,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,s,u,h,m,g){for(let v=h;v<m;v++){let b=u.get(v),C=this.getSymbolInstanceIconSize(t,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,C,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mM(sg,gF.members,ta),this.iconCollisionBox=new mM(sg,gF.members,ta);let h=Pg(this.iconSizeData,t),m=Pg(this.textSizeData,t,u);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,t,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,t,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,t,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,t,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(t,s,u,h){let m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),g=aM(this.textSizeData,t,m)/fo;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,s,u){let h=this.icon.placedSymbolArray.get(u),m=aM(this.iconSizeData,t,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(t,s,u,h){t.emplaceBack(s,-u,-u,h),t.emplaceBack(s,u,-u,h),t.emplaceBack(s,u,u,h),t.emplaceBack(s,-u,u,h)}_updateTextDebugCollisionBoxes(t,s,u,h,m,g,v){for(let b=h;b<m;b++){let C=u.get(b),T=this.getSymbolInstanceTextSize(t,g,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,C.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,s,u,h,m,g,v){for(let b=h;b<m;b++){let C=u.get(b),T=this.getSymbolInstanceIconSize(t,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,C.padding,g.zOffset)}}updateCollisionDebugBuffers(t,s,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let m=Pg(this.iconSizeData,t,h),g=Pg(this.textSizeData,t,u);for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(g,t,s,b.textBoxStartIndex,b.textBoxEndIndex,b,u),this._updateTextDebugCollisionBoxes(g,t,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(m,t,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b,h),this._updateIconDebugCollisionBoxes(m,t,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,u,h,m,g,v,b,C){let T={};if(s<u){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie,featureIndex:he}=t.get(s);T.textBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie},T.textFeatureIndex=he}if(h<m){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie,featureIndex:he}=t.get(h);T.verticalTextBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie},T.verticalTextFeatureIndex=he}if(g<v){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie,featureIndex:he}=t.get(g);T.iconBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie},T.iconFeatureIndex=he}if(b<C){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie,featureIndex:he}=t.get(b);T.verticalIconBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ie},T.verticalIconFeatureIndex=he}return T}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){let u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,s){let u=t.placedSymbolArray.get(s),h=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let s=Math.sin(t),u=Math.cos(t),h=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);let b=this.symbolInstances.get(v);h.push(0|Math.round(s*b.tileAnchorX+u*b.tileAnchorY)),m.push(b.featureIndex)}return g.sort((v,b)=>h[v]-h[b]||m[b]-m[v]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,s){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let s of this.symbolInstanceIndexes){let u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:C}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(t){let s=this.symbolInstances.get(this.text.symbolInstanceIndices[t]).elevationFeatureIndex,u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function JF(l,t){return t.replace(/{([^{}]+)}/g,(s,u)=>u in l?String(l[u]):"")}let eL,tL,gM;Lt(aw,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),aw.addDynamicAttributes=Fg;class nL{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wa,this.defaultValue=t}evaluate(t){if(t.formattedSection){let s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt(nL,"FormatSectionOverride",{omit:["defaultValue"]});let _M=()=>gM||(gM={layout:eL||(eL=new gr({"symbol-placement":new gt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ct(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new gt(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new gt(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new gt(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ct(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new gt(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ct(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ct(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ct(Oe.layout_symbol["icon-image"]),"icon-image-use-theme":new gt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Ct(Oe.layout_symbol["icon-rotate"]),"icon-padding":new gt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ct(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Ct(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ct(Oe.layout_symbol["text-field"]),"text-font":new Ct(Oe.layout_symbol["text-font"]),"text-size":new Ct(Oe.layout_symbol["text-size"]),"text-size-scale-range":new gt(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new Ct(Oe.layout_symbol["text-max-width"]),"text-line-height":new Ct(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ct(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ct(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Ct(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Ct(Oe.layout_symbol["text-anchor"]),"text-max-angle":new gt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ct(Oe.layout_symbol["text-rotate"]),"text-padding":new gt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new gt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Ct(Oe.layout_symbol["text-transform"]),"text-offset":new Ct(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Oe.layout_symbol["text-optional"]),visibility:new gt(Oe.layout_symbol.visibility)})),paint:tL||(tL=new gr({"icon-opacity":new Ct(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ct(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ct(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ct(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Ct(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Ct(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ct(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ct(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new gt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ct(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ct(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Ct(Oe.paint_symbol["text-color"],{runtimeType:Is,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ct(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ct(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ct(Oe.paint_symbol["text-halo-blur"]),"text-translate":new gt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new gt(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new gt(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new gt(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new gt(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ct(Oe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},gM);class lw extends gs{constructor(t,s,u,h){super(t,_M(),s,u,h,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ht([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,s){super.recalculate(t,s),this.appearances&&this.appearances.forEach(h=>{h.recalculate(t,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let h=[];for(let m of u)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,s,u,h){return this._saturation===t&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(m,g,v,b){m=cr(m),g=Gn(g);let C=$e(),T=m/3,I=1-2*T,D=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],O=.5-.5*g,R=b-v;return Mt(C,[R,0,0,0,0,R,0,0,0,0,R,0,v,v,v,1],[g,0,0,0,0,g,0,0,0,0,g,0,O,O,O,1]),Mt(C,C,D),C})(t,s,u,h),this._saturation=t,this._contrast=s,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,s,u,h){let m=this.layout.get(t).evaluate(s,{},u,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Ap(g.value)||!m?m:JF(s.properties,m)}getAppearanceValueAndResolveTokens(t,s,u,h,m){let g=t.getProperty(s);if(!g)return;let v=g.evaluate(u,{},h,m),b=t.getUnevaluatedProperties()._values[s];return b.isDataDriven()||Ap(b.value)||!v||typeof v!="string"?v:JF(u.properties,v)}createBucket(t){return new aw(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of _M().paint.overridableProperties){if(!lw.hasPaintOverride(this.layout,t))continue;let s=this.paint.get(t),u=new nL(s),h=new jm(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme")),m=null;m=s.value.kind==="constant"||s.value.kind==="source"?new oh("source",h):new sd("composite",h,s.value.zoomStops,s.value.interpolationType),this.paint._values[t]=new ld(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&lw.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){let u=t.get("text-field"),h=_M().paint.properties[s],m=!1,g=v=>{for(let b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof hs)g(u.value.value.sections);else if(u.value.kind==="source"){let v=C=>{m||(C instanceof Ql&&po(C.value)===mp?g(C.value.sections):C instanceof yl?g(C.sections):C.eachChild(v))},b=u.value;b._styleExpression&&v(b._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,s,u){return{config:new au(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let iL,rL,oL,sL;var vM=An([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function cw(l,t,s,u,h,m,g,v){let b=[l,t,1,s,u,1,h,m,1],C=[g,v,1],T=oe([],b),[I,D,O]=Bc(C,C,T);return Se(b,b,[I,0,0,0,D,0,0,0,O])}function aL(l,t,s,u,h,m,g,v){let b=(function(C,T,I,D,O,R,B,H){let $=cw(0,0,1,0,1,1,0,1),Y=cw(C,T,I,D,O,R,B,H);return Se(Y,Y,oe([],$))})(l,t,s,u,h,m,g,v);return[b[2]/b[8]/vt,b[5]/b[8]/vt]}function uw(l){return[l[0],Math.min(Math.max(l[1],-N),N)]}class lL extends ed{constructor(t,s,u,h){super(),this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(t,s){if(this._loaded=s||!1,this.fire(new _l("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=cm(this.map._requestManager.transformRequest(this.url,lp.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new hp(u)):h&&(this.image=h instanceof HTMLImageElement?ho.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new q0(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof q0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=t[0][1],u=t[0][1];for(let m of t)m[1]>u&&(u=m[1]),m[1]<s&&(s=m[1]);let h=(u+s)/2;if(h>N?this.onNorthPole=!0:h<-N&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=t.map(ee.fromLngLat);this.tileID=(function(g){let v=1/0,b=1/0,C=-1/0,T=-1/0;for(let B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),C=Math.max(C,B.x),T=Math.max(T,B.y);let I=Math.max(C-v,T-b),D=Math.max(0,Math.floor(-Math.log2(I))),O=Math.pow(2,D),R=Math.floor((v+C)/2*O);return R>1&&(R-=1),new Ti(D,R,Math.floor((b+T)/2*O))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _l("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof q0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(let $ in this.tiles){let Y=this.tiles[$];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let s=ty(new Ti(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function($){let Y=$[1].x-$[0].x,Q=$[1].y-$[0].y,ie=$[2].x-$[1].x,he=$[2].y-$[1].y,le=$[3].x-$[2].x,me=$[3].y-$[2].y,ye=$[0].x-$[3].x,we=$[0].y-$[3].y,je=Y*he-ie*Q,Ie=ie*me-le*he,We=le*we-ye*me,Ke=ye*Q-Y*we;return je>0&&Ie>0&&We>0&&Ke>0||je<0&&Ie<0&&We<0&&Ke<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let h=ty(this.tileID,this.map.transform.projection),[m,g,v,b]=this.coordinates.map($=>{let Y=h.projection.project($[0],$[1]);return WF(h,Y)._round()});this.perspectiveTransform=aL(m.x,m.y,g.x,g.y,v.x,v.y,b.x,b.y);let C=this._boundsArray=new ch;C.emplaceBack(m.x,m.y,0,0),C.emplaceBack(g.x,g.y,vt,0),C.emplaceBack(b.x,b.y,0,vt),C.emplaceBack(v.x,v.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(C,vM.members),this.boundsSegments=nr.simpleSegment(0,0,4,2);let T=[],I=[uw((D=this.coordinates)[0]),uw(D[1]),uw(D[2]),uw(D[3])];var D;let[O,R,B,H]=(function($){let Y=$[0][0],Q=Y,ie=$[0][1],he=ie;for(let le=1;le<$.length;le++)$[le][0]<Y?Y=$[le][0]:$[le][0]>Q&&(Q=$[le][0]),$[le][1]<ie?ie=$[le][1]:$[le][1]>he&&(he=$[le][1]);return[Y,ie,Q-Y,he-ie]})(I);{let $=new ch,[Y,Q,ie,he]=(function(nt){let it=nt[0].x,qe=it,He=nt[0].y,rt=He;for(let yt=1;yt<nt.length;yt++)nt[yt].x<it?it=nt[yt].x:nt[yt].x>qe&&(qe=nt[yt].x),nt[yt].y<He?He=nt[yt].y:nt[yt].y>rt&&(rt=nt[yt].y);return[it,He,qe-it,rt-He]})(u),le=nt=>[(nt.x-Y)/ie,(nt.y-Q)/he],[me,ye,we,je]=u.map(le),Ie=(function(nt,it,qe,He,rt,yt,ft,qt){let It=cw(0,0,1,0,1,1,0,1);return Se(It,It,oe([],cw(nt,it,qe,He,rt,yt,ft,qt)))})(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=aL(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);let We=(nt,it)=>{T.push(nt.lng);let qe=Math.round((nt.lng-O)/B*vt),He=Math.round((nt.lat-R)/H*vt),rt=le(it),yt=Bc([],[rt[0],rt[1],1],Ie),ft=Math.round(yt[0]/yt[2]*vt),qt=Math.round(yt[1]/yt[2]*vt);$.emplaceBack(qe,He,ft,qt)},Ke=u[3].x-u[0].x,Qe=u[3].y-u[0].y,st=u[2].x-u[1].x,lt=u[2].y-u[1].y;for(let nt=0;nt<65;nt++){let it=nt/64,qe=[u[0].x+it*Ke,u[0].y+it*Qe],He=[u[1].x+it*st,u[1].y+it*lt],rt=He[0]-qe[0],yt=He[1]-qe[1];for(let ft=0;ft<65;ft++){let qt=ft/64,It={x:qe[0]+rt*qt,y:qe[1]+yt*qt};We(s.projection.unproject(It.x,It.y),It)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer($,vM.members)}{this.maxLongitudeTriangleSize=0;let $=[],Y=new Xr,Q=(ie,he,le)=>{Y.emplaceBack(ie,he,le);let me=T[ie],ye=T[he],we=T[le],je=Math.min(Math.min(me,ye),we),Ie=Math.max(Math.max(me,ye),we)-je;Ie>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ie),$.push(je+Ie/2)};for(let ie=0;ie<64;ie++)for(let he=0;he<64;he++){let le=65*ie+he,me=le+1,ye=le+65,we=ye+1;Q(le,ye,me),Q(me,ye,we)}[$,Y]=(function(ie,he){let le=Array.from({length:ie.length},(we,je)=>je);le.sort((we,je)=>ie[we]-ie[je]);let me=[],ye=new Xr;for(let we=0;we<le.length;we++){let je=le[we];me.push(ie[je]);let Ie=3*je,We=Ie+1;ye.emplaceBack(he.uint16[Ie],he.uint16[We],he.uint16[We+1])}return[me,ye]})($,Y),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(Y)}this.elevatedGlobeSegments=nr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/vt,0,H/vt,0,0,R,O,0])}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof q0||(this.texture?this.texture.update(this.image):(this.texture=new $I(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(s)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){let s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;let u=this.elevatedGlobeTrianglesCenterLongitudes,h=(m=t+180)+360*Math.round((u[0]-m)/360);var m;let g=new nr,v=(I,D)=>{g.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=b){let I=lr(u,0,u.length,h+b);return I===u.length||v(I,Zr(u,I+1,u.length,h+360-b)-I),g}h<u[0]&&(h+=360);let C=Zr(u,0,u.length,h-b);if(C===u.length)return v(0,u.length),g;v(0,C-0);let T=lr(u,C+1,u.length,h+b);return T!==u.length&&v(T,u.length-T),g}}let X$=(Math.pow(256,2)-1)/16907520;class cL extends gs{constructor(t,s,u,h){super(t,{layout:oL||(oL=new gr({visibility:new gt(Oe.layout_raster.visibility)})),paint:sL||(sL=new gr({"raster-opacity":new gt(Oe.paint_raster["raster-opacity"]),"raster-color":new ud(Oe.paint_raster["raster-color"]),"raster-color-mix":new gt(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new gt(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new gt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new gt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new gt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new gt(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new gt(Oe.paint_raster["raster-array-band"]),"raster-elevation":new gt(Oe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof lL&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;let s=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=P0({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let uL,dL,hL,pL,fL;class mL extends gs{constructor(t,s,u,h){super(t,{layout:uL||(uL=new gr({visibility:new gt(Oe["layout_raster-particle"].visibility)})),paint:dL||(dL=new gr({"raster-particle-array-band":new gt(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new gt(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ud(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new gt(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new gt(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new gt(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new gt(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new gt(Oe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp(),this.lastInvalidatedAt=ho.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=P0({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ho.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class K$ extends gs{constructor(t,s){super(t,{},s,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function yM(l,t,s){let u=[0,0,1],h=jd([]);return Wl(h,h,s?-Zn(l)+Math.PI:Zn(l)),ja(h,h,-Zn(t)),Vc(u,u,h),Yi(u,u)}let gL={None:0,Model:1,Symbol:2,FillExtrusion:4};class dw{constructor(t,s,u,h){this.message=(t?`${t}: `:"")+u,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function xM(l,t){let s=l.indexOf("://")===-1;try{return new URL(l,s&&t?"http://example.com":void 0),!0}catch{return!1}}class _L{constructor(t,s){this.feature=t,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class vL{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new x0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(t){let s=16*t,u=this.instancedDataArray.float32,h=Math.floor(u[s+2]),m=1.05*(u[s+2]-h);return h/=100,[u[s]%1*1.05,u[s+1]%1*1.05,m,h]}tileCoordinatesForInstance(t){let s=16*t,u=this.instancedDataArray.float32,h=u[s+0];return h=h>vt?h-vt:h,new ot(Math.trunc(h),Math.trunc(u[s+1]))}translationForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class bM{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaledZ=this.canonical.z+Math.log2(t.overscaling),this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.tileToMeter=q(u);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:v,index:b,sourceLayerIndex:C}of t){let T=v??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),I=Te(g,m);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:T,sourceLayerIndex:C,index:b,geometry:m?I.geometry:_e(g,u,h),properties:g.properties,type:g.type,patterns:{}},O=this.addFeature(D,D.geometry,I);O&&s.featureIndex.insert(g,D.geometry,b,C,this.index,this.instancesPerModel[O].instancedDataArray.length,vt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){let t=this.layers[0].modelManager,s=this.layers[0].scope,u=0;for(let h of this.modelUris){let m=t.getModel(h,s);if(!m)continue;let g=this.instancesPerModel[h];if(g){let v=.5*Jf(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,b=Math.min(vt,Math.max(v/this.tileToMeter,vt/32));u=Math.max(b,u)}}return u}update(t,s,u,h){for(let m in this.instancesPerModel){let g=this.instancesPerModel[m];for(let v in t)g.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(g.features[g.idToFeaturesIndex[v]],t[v],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];for(let h of u.features){let m=this.layers[0],g=h.feature,v=this.canonical,b=m.paint.get("model-rotation").evaluate(g,{},v),C=m.paint.get("model-scale").evaluate(g,{},v),T=m.paint.get("model-translation").evaluate(g,{},v);rs(h.rotation,b)&&rs(h.scale,C)&&rs(h.translation,T)||(this.evaluate(h,h.featureStates,u,!0),t=!0)}}return t}updateReplacement(t,s,u,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let m=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(k1(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(let v in this.instancesPerModel){let b=this.instancesPerModel[v],C=b.instancedDataArray;for(let T of b.features){let I=T.instancedDataOffset,D=T.instancedDataCount;for(let O=0;O<D;O++){let R=16*(O+I),B=C.float32[R+0],H=B>vt;B=H?B-vt:B;let $=Math.floor(B),Y=Math.floor(C.float32[R+1]),Q=!1;for(let ie of this.activeReplacements)if(!rk(ie,u,gL.Model,h)&&!(ie.min.x>$||$>ie.max.x||ie.min.y>Y||Y>ie.max.y)&&(Q=ck(lk($,Y,t.canonical,ie.footprintTileId.canonical),ie.footprint),Q))break;C.float32[R]=Q?B+vt:B,g=g||Q!==H}}}return g}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,x8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(t){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}let s=this.layers[0].modelManager;if(t&&s&&this.modelUris&&this.modelsRequested)for(let u of this.modelUris)s.removeModel(u,"",!0)}addFeature(t,s,u){let h=this.layers[0],m=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return At(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(xM(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new vL);let g=this.instancesPerModel[m],v=g.instancedDataArray,b=new _L(u,v.length);for(let C of s)for(let T of C){if(T.x<0||T.x>=vt||T.y<0||T.y>=vt)continue;if(this.lookupDim!==0){let D=(this.lookupDim-1)/vt,O=this.lookupDim*(T.y*D|0)+T.x*D|0;if(this.lookup){if(this.lookup[O]!==0)continue;this.lookup[O]=1}}this.instanceCount++;let I=v.length;v.resize(I+1),g.instancesEvaluatedElevation.push(0),v.float32[16*I]=T.x,v.float32[16*I+1]=T.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(t,s,u,h){let m=this.layers[0],g=t.feature,v=this.canonical,b=t.rotation=m.paint.get("model-rotation").evaluate(g,s,v),C=t.scale=m.paint.get("model-scale").evaluate(g,s,v),T=t.translation=m.paint.get("model-translation").evaluate(g,s,v),I=Object.assign({},m.paint.get("model-color").evaluate(g,s,v));I.a=m.paint.get("model-color-mix-intensity").evaluate(g,s,v);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]);let O=T[0]*T[0]+T[1]*T[1],R=O>0?Math.sqrt(O):0;u.maxScale=Math.max(Math.max(u.maxScale,C[0]),Math.max(C[1],C[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,R),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),Yk(D,b,C);let B=Math.round(100*I.a)+I.b/1.05;for(let H=0;H<t.instancedDataCount;++H){let $=t.instancedDataOffset+H,Y=16*$,Q=u.instancedDataArray.float32,ie=0;h&&(ie=Q[Y+6]-u.instancesEvaluatedElevation[$]);let he=0|Q[Y+1];Q[Y]=(0|Q[Y])+I.r/1.05,Q[Y+1]=he+I.g/1.05,Q[Y+2]=B,Q[Y+3]=1/(v.z>10?this.tileToMeter:q(v,he)),Q[Y+4]=T[0],Q[Y+5]=T[1],Q[Y+6]=T[2]+ie,Q[Y+7]=D[0],Q[Y+8]=D[1],Q[Y+9]=D[2],Q[Y+10]=D[4],Q[Y+11]=D[5],Q[Y+12]=D[6],Q[Y+13]=D[8],Q[Y+14]=D[9],Q[Y+15]=D[10],u.instancesEvaluatedElevation[$]=T[2]}}}let yL,xL;Lt(bM,"ModelBucket",{omit:["layers"]}),Lt(vL,"PerModelAttributes"),Lt(_L,"ModelFeature");class Lg{constructor(t,s,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(t,s,u){let h=u||t.findDEMTileFor(s);if(!h||!h.dem)return;let m=h.dem,g=h.tileID,v=1<<s.canonical.z-g.canonical.z;return new Lg(h,m.dim/vt/v,[(s.canonical.x/v-g.canonical.x)*m.dim,(s.canonical.y/v-g.canonical.y)*m.dim])}tileCoordToPixel(t,s){let u=s*this._scale+this._offset[1];return new ot(Math.floor(t*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(t,s,u,h){let m=t*this._scale+this._offset[0],g=s*this._scale+this._offset[1],v=Math.floor(m),b=Math.floor(g),C=this._dem;return h=!!h,u?on(on(C.get(v,b,h),C.get(v,b+1,h),g-b),on(C.get(v+1,b,h),C.get(v+1,b+1,h),g-b),m-v):C.get(v,b,h)}getElevationAtPixel(t,s,u){return this._dem.get(t,s,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*M(1,t)*this._dem.stride}}let wM=new Float32Array(262144),Qp=new Uint8Array(262144);function bL(l){let t=0;if(l.meshes)for(let s of l.meshes)t=Math.max(t,s.aabb.max[2]);if(l.children)for(let s of l.children)t=Math.max(t,bL(s));return t}function wL(l,t,s){if(l.meshes)for(let u of l.meshes){if(u.aabb.min[0]===1/0)continue;let h=jt.applyTransform(u.aabb,l.globalMatrix);s.insert(t,h.min[0],h.min[1],h.max[0],h.max[1])}if(l.children)for(let u of l.children)wL(u,t,s)}let CL=["","wall","door","roof","window","lamp","logo"];class EL{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:bL(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0,s=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let u of this.node.meshes)this.node.lightMeshIndex!==t&&(u.transformedAabb=jt.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),t++;this.aabb=s}return this.aabb}}class hw{constructor(t,s,u,h,m,g,v,b){this.id=u,this.layers=t,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=Ig.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Ig.HasMapboxMeshFeatures),m&&(this.modelTraits|=Ig.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(let C of s)this.nodesInfo.push(new EL(C)),wL(C,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(t,s){for(let u of this.getNodesInfo()){let h=u.node;h.footprint&&s.push({footprint:h.footprint,id:t})}}updateAppearances(t,s,u,h){}update(t){let s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;let u=s?this.stateDependentLayers:this.layers;if(!Yl(t,this.states))for(let h of u)this.evaluate(h,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let s=this.getNodesInfo();for(let u of s){let h=u.node;this.uploaded?this.updatePbrBuffer(h):qI(h,t,!0)}for(let u of s)W1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let s=!1;if(!t.meshes)return s;for(let u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(t,s,u){let h=t.transform.projectionOptions,m=t.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||cy(u.paint.get("model-color").value,g)||cy(u.paint.get("model-color-mix-intensity").value,g)||cy(u.paint.get("model-roughness").value,g)||cy(u.paint.get("model-emissive-strength").value,g)||cy(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=m;let v=this.getNodesInfo();for(let b of v)b.state=null;return!0}return!1}evaluateTransform(t,s){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let u=this.getNodesInfo(),h=this.id.canonical;for(let m of u){let g=m.feature;m.evaluatedTranslation=s.paint.get("model-translation").evaluate(g,{},h),m.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},h)}}evaluate(t,s){let u=this.getNodesInfo();for(let h of u){if(!h.node.meshes)continue;let m=h.feature,g=s&&s[m.id];if(Yl(g,h.state))continue;h.state=structuredClone(g);let v=h.node.meshes&&h.node.meshes[0].featureData,b=h.evaluatedColor[2],C=h.evaluatedRMEA[2],T=this.id.canonical;if(h.hasTranslucentParts=!1,v){for(let I=0;I<CL.length;I++){let D=CL[I];D.length&&(m.properties.part=D);let O=t.paint.get("model-color").evaluate(m,g,T).toPremultipliedRenderColor(null),R=t.paint.get("model-color-mix-intensity").evaluate(m,g,T);h.evaluatedColor[I]=[O.r,O.g,O.b,R],h.evaluatedRMEA[I][0]=t.paint.get("model-roughness").evaluate(m,g,T),h.evaluatedRMEA[I][2]=t.paint.get("model-emissive-strength").evaluate(m,g,T),h.evaluatedRMEA[I][3]=O.a,h.emissionHeightBasedParams[I]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,T),!h.hasTranslucentParts&&O.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,J$(h,b!==h.evaluatedColor[2]||C!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(m,g,T);h.evaluatedTranslation=t.paint.get("model-translation").evaluate(m,g,T),h.evaluatedScale=t.paint.get("model-scale").evaluate(m,g,T),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,s,u,h){let m=t.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let g=Lg.create(t,u,m);if(!g)return;this.modelTraits&Ig.HasMapboxMeshFeatures&&this.updateDEM(t,g,u,h);for(let v of this.getNodesInfo()){let b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let C=b.footprint.vertices,T=g.getElevationAt(C[0].x,C[0].y,!0,!0);for(let I=1;I<C.length;I++)T=Math.min(T,g.getElevationAt(C[I].x,C[I].y,!0,!0));b.elevation=T}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=s}}updateDEM(t,s,u,h){let m=s._dem._modifiedForSources[h];if(m===void 0&&(s._dem._modifiedForSources[h]=[],m=s._dem._modifiedForSources[h]),m.includes(u.canonical))return;let g=s._dem.dim;m.push(u.canonical);let v=!1;for(let b of this.getNodesInfo()){let C=b.node;if(!C.footprint||!C.footprint.grid)continue;let T=C.footprint.grid,I=s.tileCoordToPixel(T.min.x,T.min.y),D=s.tileCoordToPixel(T.max.x,T.max.y),O=Math.min(Math.min(g-D.y,I.x),Math.min(I.y,g-D.x));if(O<0)continue;let R=G(O,2,5),B=Math.max(0,I.x-R),H=Math.max(0,I.y-R),$=Math.min(D.x+R,g-1),Y=Math.min(D.y+R,g-1);for(let le=H;le<=Y;++le)for(let me=B;me<=$;++me)Qp[le*g+me]=255;let Q=0,ie=0;for(let le=0;le<T.cellsY;++le)for(let me=0;me<T.cellsX;++me){if(!T.cells[le*T.cellsX+me])continue;let ye=s.tileCoordToPixel(T.min.x+me/T.xScale,T.min.y+le/T.yScale),we=s.tileCoordToPixel(T.min.x+(me+1)/T.xScale,T.min.y+(le+1)/T.yScale);for(let je=ye.y;je<=Math.min(we.y+1,g-1);++je)for(let Ie=ye.x;Ie<=Math.min(we.x+1,g-1);++Ie)Qp[je*g+Ie]===255&&(Qp[je*g+Ie]=0,Q+=s.getElevationAtPixel(Ie,je),ie++)}let he=Q/ie;B=Math.max(1,I.x-R),H=Math.max(1,I.y-R),$=Math.min(D.x+R,g-2),Y=Math.min(D.y+R,g-2),v=!0;for(let le=H;le<=Y;++le)for(let me=B;me<=$;++me)Qp[le*g+me]===0&&(wM[le*g+me]=s._dem.set(me,le,he));for(let le=1;le<R;++le){B=Math.max(1,I.x-le),H=Math.max(1,I.y-le),$=Math.min(D.x+le,g-2),Y=Math.min(D.y+le,g-2);for(let me=H;me<=Y;++me)for(let ye=B;ye<=$;++ye){let we=me*g+ye;if(Qp[we]===255){let je=0,Ie=0,We=-1,Ke=-1;for(let Qe=-1;Qe<=1;++Qe)for(let st=-1;st<=1;++st){let lt=(me+Qe)*g+ye+st;if(Qp[lt]>=le)continue;let nt=wM[lt],it=Math.abs(nt);it>Ie&&(je=nt,Ie=it,We=st,Ke=Qe)}if(Ie>.1){let Qe=1-(le+.5*Math.abs(We*Ke))/R,st=s._dem.get(ye,me)+je*Qe,lt=s._dem.get(ye+We,me+Ke),nt=s._dem.get(ye-We,me-Ke,!0);(st-lt)*(st-nt)>0&&(st=(lt+nt)/2),wM[we]=s._dem.set(ye,me,st),Qp[we]=le}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ho.now())}setFilter(t){this.filter=t?Km(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new Vi(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical)):this.nodesInfo}destroy(){let t=this.getNodesInfo();for(let s of t)W1(s.node),WI(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(t.toUnwrapped());for(let h of this.getNodesInfo()){let m=h.node.footprint;h.hiddenByReplacement=!!m&&!u.find(g=>g.footprint===m)}}getHeightAtTileCoord(t,s){let u=[],h=[0,0,0],m=ht([]);for(let g of this.getNodesInfo()){let v=g.node.meshes[0],b=v.transformedAabb;if(t<b.min[0]||s<b.min[1]||t>b.max[0]||s>b.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};Nt(m,g.node.globalMatrix),h[0]=t,h[1]=s,Fr(h,h,m);let C=(h[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Yp|0,T=Math.min(63,(h[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Yp|0)*Yp+Math.min(63,C),I=v.heightmap[T];if(!(I<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:I,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new ot(t,s),new ot(t,s),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function cy(l,t){return l instanceof oh&&!l.isLightConstant&&t}function Q$(l,t,s,u,h,m,g,v){let b=(61440&t|(61440&t)>>4)>>8,C=(3840&t|(3840&t)>>4)>>4,T=240&t|(240&t)>>4;s[3]>0&&(b=on(b,255*s[0],s[3]),C=on(C,255*s[1],s[3]),T=on(T,255*s[2],s[3]));let I=b<<8|C,D=T<<8|Math.floor(255*u[3]),O=(function(le){let me=G(le,0,2);return Math.min(Math.round(.5*me*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],R=G(h[0],0,1),B=G(h[1],0,1),H=G(h[2],0,1),$=G(h[3],0,1),Y,Q,ie,he;if(R!==B&&g!==m&&B!==R){let le=g-m;Q=1/(le*(B-R)),ie=-(m+le*R)/(le*(B-R));let me=G(h[4],-1,1);he=Math.pow(10,me),Y=255*H<<8|255*$}else Y=65535,Q=0,ie=1,he=1;if(l.emplaceBack(I,D,O,Y,Q,ie,he),v){let le=v.length;v.clear();for(let me=0;me<le;me++)v.emplaceBack(I,D,O,Y,Q,ie,he)}}function J$(l,t,s){let u=l.node,h=0,m=s&Ig.HasMeshoptCompression;for(let g of u.meshes){if(u.lights&&u.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new lg,g.featureArray.reserve(g.featureData.length);let v=t;for(let b of g.featureData){let C=m?65535&b:b>>16&65535,T=m?b>>16&65535:65535&b,I=(15&T)<8?15&T:0,D=l.evaluatedRMEA[I],O=l.evaluatedColor[I],R=l.emissionHeightBasedParams[I],B;if(v&&I===2&&u.lights&&(B=new lg,B.resize(10*u.lights.length)),Q$(g.featureArray,C,O,D,R,g.aabb.min[2],g.aabb.max[2],B),B&&v){v=!1;let H=u.meshes[u.lightMeshIndex];H.featureArray=B,H.featureArray._trim()}}g.featureArray._trim(),h++}}Lt(hw,"Tiled3dModelBucket",{omit:["layers"]}),Lt(EL,"Tiled3dModelFeature");let eH=["id","tile","layer","source","sourceLayer","state"];class Jp{constructor(t,s,u,h,m){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=u,this._y=h,this.properties=t?t.properties:{},this.id=m}clone(){let t=new Jp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let s of eH)this[s]!==void 0&&(t[s]=this[s]);return t}}class ef extends ed{constructor(t,s,u,h){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){let t=[];for(let s in this._options.models){let u=this._options.models[s],h=this._modelsInfo.get(s);if(h){let m=h.model;m.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),m.orientation=u.orientation!=null?u.orientation:[0,0,0],h.modelSpec=u,ef.applyModelSpecification(m,u),m.computeBoundsAndApplyParent(),this.models.push(m)}else{let m=Gk(this.map._requestManager.transformRequest(u.uri,lp.Model).url).then(g=>{if(!g)return;let v=YI(g),b=new Xk(s,u.uri,u.position,u.orientation,v);ef.applyModelSpecification(b,u),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(s,{modelSpec:u,model:b})}).catch(g=>{this.fire(new hp(new Error(`Could not load model ${s} from ${u.uri}: ${g.message}`)))});t.push(m)}}Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new hp(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(t,s){s.nodeOverrides&&ef.convertNodeOverrides(t,s.nodeOverrides),s.materialOverrides&&ef.convertMaterialOverrides(t,s.materialOverrides),s.nodeOverrideNames&&(t.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(t.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(t.featureProperties=s.featureProperties)}static convertNodeOverrides(t,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){t.nodeOverrideNames=[];for(let u of s)t.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{let m={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){let g=h.orientation;g&&(m.orientation=g)}t.nodeOverrides.set(u,m)})}static convertMaterialOverrides(t,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){t.materialOverrideNames=[];for(let u of s)t.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{let m={color:new ui(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=h["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);let v=h["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);let b=h["model-emissive-strength"];b!==void 0&&(m.emissionStrength=b);let C=h["model-opacity"];C!==void 0&&(m.opacity=C),t.materialOverrides.set(u,m)})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,s){}serialize(){return this._options}setProperty(t,s){return!1}reload(){let t=Xa(this.id,this.scope);this.map.style.clearSource(t),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(t){this.models=[];let s=new Map;for(let u in t){let h=t[u];if(this._modelsInfo.has(u)){let m=this._modelsInfo.get(u);m&&m.modelSpec.uri===h.uri&&s.set(u,m)}}this._modelsInfo=s,this._options.models=t,this._loaded=!1,this.load()}}function CM(l,t,s,u){let h=1<<l.z;t.lat=L((u/vt+l.y)/h),t.lng=A((s/vt+l.x)/h)}function tH(l,t,s,u){let h=l.getNodesInfo()[t];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE,g=h.node,v=s.tile,b=u.calculatePosMatrix(v.tileID.toUnwrapped(),u.worldSize),C=h.evaluatedScale,T=0;u.elevation&&g.elevation&&(T=g.elevation*u.elevation.exaggeration()),Xt(b,b,[(g.anchor?g.anchor[0]:0)*(C[0]-1),(g.anchor?g.anchor[1]:0)*(C[1]-1),T]),Vn(b,b,C);let I=s.queryGeometry,D=I.isPointQuery()?I.screenBounds:I.screenGeometry,O=function(B){let H=Mt([],b,B.globalMatrix);Mt(H,u.expandedFarZProjMatrix,H);for(let $=0;$<B.meshes.length;++$){let Y=B.meshes[$];if($===B.lightMeshIndex)continue;let Q=GI(D,u,H,Y.aabb);Q!=null&&(m=Math.min(Q,m))}if(B.children)for(let $ of B.children)O($)};if(O(g),m===Number.MAX_VALUE)return;let R=new c(0,0);return CM(v.tileID.canonical,R,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:R,feature:h.feature}}let nH={circle:class extends gs{constructor(l,t,s,u){super(l,{layout:As||(As=new gr({"circle-sort-key":new Ct(Oe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new gt(Oe.layout_circle["circle-elevation-reference"]),visibility:new gt(Oe.layout_circle.visibility)})),paint:_r||(_r=new gr({"circle-radius":new Ct(Oe.paint_circle["circle-radius"]),"circle-color":new Ct(Oe.paint_circle["circle-color"]),"circle-blur":new Ct(Oe.paint_circle["circle-blur"]),"circle-opacity":new Ct(Oe.paint_circle["circle-opacity"]),"circle-translate":new gt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ct(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ct(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ct(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new gt(Oe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}createBucket(l){return new di(l)}queryRadius(l){let t=l;return Ko("circle-radius",this,t)+Ko("circle-stroke-width",this,t)+Do(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,s,u,h,m,g,v){let b=Ia(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return PR(l,u,m,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,s){let u=AR(this);return{config:new au(this,{zoom:t,lut:s}),defines:u,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends gs{createBucket(l){return new RR(l)}constructor(l,t,s,u){super(l,{layout:kR||(kR=new gr({visibility:new gt(Oe.layout_heatmap.visibility)})),paint:FR||(FR=new gr({"heatmap-radius":new Ct(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ct(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ud(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Oe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=P0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Ko("heatmap-radius",this,l)}queryIntersectsFeature(l,t,s,u,h,m,g,v){let b=this.paint.get("heatmap-radius").evaluate(t,s);return PR(l,u,m,g,v,!0,!0,new ot(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,s){return l==="heatmap"?{config:new au(this,{zoom:t,lut:s}),overrideFog:!1}:{}}},hillshade:class extends gs{constructor(l,t,s,u){super(l,{layout:LR||(LR=new gr({visibility:new gt(Oe.layout_hillshade.visibility)})),paint:NR||(NR=new gr({"hillshade-illumination-direction":new gt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new gt(Oe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}},fill:class extends gs{constructor(l,t,s,u){super(l,{layout:QR||(QR=new gr({"fill-sort-key":new Ct(Oe.layout_fill["fill-sort-key"]),visibility:new gt(Oe.layout_fill.visibility),"fill-elevation-reference":new gt(Oe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ct(Oe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:JR||(JR=new gr({"fill-antialias":new gt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Ct(Oe.paint_fill["fill-opacity"]),"fill-color":new Ct(Oe.paint_fill["fill-color"]),"fill-outline-color":new Ct(Oe.paint_fill["fill-outline-color"]),"fill-translate":new gt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ct(Oe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new gt(Oe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new gt(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ct(Oe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ct(Oe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ct(Oe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}getProgramIds(){let l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,t,s){return{config:new au(this,{zoom:t,lut:s}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);let s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new MI(l)}queryRadius(){return Do(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,s,u,h,m){return!l.queryGeometry.isAboveHorizon&&ti(na(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;let t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?t&&!l:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends gs{constructor(l,t,s,u){super(l,{layout:Sk||(Sk=new gr({visibility:new gt(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new gt(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Tk||(Tk=new gr({"fill-extrusion-opacity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new L1(l)}queryRadius(){return Do(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,s,u,h,m,g,v,b){let C=Ia(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(t,s),I=this.paint.get("fill-extrusion-base").evaluate(t,s),D=[0,0],O=v&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,B=l.tile.getBucket(this);if(O&&B instanceof L1){let ie=B.centroidVertexArray,he=b+1;he<ie.length&&(D[0]=ie.geta_centroid_pos0(he),D[1]=ie.geta_centroid_pos1(he))}if(D[0]===0&&D[1]===1)return!1;m.projection.name==="globe"&&(u=Ek([u],[new ot(0,0),new ot(vt,vt)],l.tileID.canonical).map(ie=>ie.polygon).flat());let H=O?v:null,[$,Y]=Rk(m,u,I,T,C,g,H,D,R,m.center.lat,l.tileID.canonical),Q=l.queryGeometry;return Ok($,Y,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},building:class extends gs{constructor(l,t,s,u){super(l,{layout:iF||(iF=new gr({visibility:new gt(Oe.layout_building.visibility),"building-facade":new Ct(Oe.layout_building["building-facade"]),"building-facade-floors":new Ct(Oe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Ct(Oe.layout_building["building-facade-unit-width"]),"building-facade-window":new Ct(Oe.layout_building["building-facade-window"]),"building-roof-shape":new Ct(Oe.layout_building["building-roof-shape"]),"building-height":new Ct(Oe.layout_building["building-height"]),"building-base":new Ct(Oe.layout_building["building-base"]),"building-flood-light-wall-radius":new Ct(Oe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Ct(Oe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Ct(Oe.layout_building["building-flip-roof-orientation"])})),paint:rF||(rF=new gr({"building-opacity":new gt(Oe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new gt(Oe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new gt(Oe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new gt(Oe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new gt(Oe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new gt(Oe.paint_building["building-vertical-scale"]),"building-cast-shadows":new gt(Oe.paint_building["building-cast-shadows"]),"building-color":new Ct(Oe.paint_building["building-color"]),"building-emissive-strength":new Ct(Oe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new gt(Oe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new gt(Oe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new gt(Oe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new gt(Oe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new gt(Oe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new nF(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}queryRadius(l){return 0}queryIntersectsFeature(l,t,s,u,h,m,g,v,b){let C=this.layout.get("building-height").evaluate(t,s),T=this.layout.get("building-base").evaluate(t,s),I=l.tile.getBucket(this).getFootprint(t);if(I){if(I.hiddenFlags!==0)return!1;C=I.height}let[D,O]=Rk(m,u,T,C,new ot(0,0),g,null,[0,0],1,m.center.lat,l.tileID.canonical),R=l.queryGeometry;return Ok(D,O,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends gs{constructor(l,t,s,u){let h=fF();super(l,h,t,s,u),h.layout&&(this.layout=new cd(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Ep,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if(Z0)return Z0;let s=fF();return Z0=new X8(s.paint.properties["line-width"].specification),Z0.useIntegerZoom=!0,Z0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new QI(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,s){let u=hF(this);return{config:new au(this,{zoom:t,lut:s}),defines:u,overrideFog:!1}}queryRadius(l){let t=l,s=mF(Ko("line-width",this,t),Ko("line-gap-width",this,t)),u=Ko("line-offset",this,t);return s/2+Math.abs(u)+Do(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,s,u,h,m){if(l.queryGeometry.isAboveHorizon)return!1;let g=na(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),v=l.pixelToTileUnitsFactor/2*mF(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),b=this.paint.get("line-offset").evaluate(t,s);return b&&(u=(function(C,T){let I=[],D=new ot(0,0);for(let O=0;O<C.length;O++){let R=C[O],B=[];for(let H=0;H<R.length;H++){let $=R[H],Y=R[H+1],Q=H===0?D:$.sub(R[H-1])._unit()._perp(),ie=H===R.length-1?D:Y.sub($)._unit()._perp(),he=Q._add(ie)._unit();he._mult(1/(he.x*ie.x+he.y*ie.y)),B.push(he._mult(T)._add($))}I.push(B)}return I})(u,b*l.pixelToTileUnitsFactor)),(function(C,T,I){for(let D=0;D<T.length;D++){let O=T[D];if(C.length>=3){for(let R=0;R<O.length;R++)if(Si(C,O[R]))return!0}if(ur(C,O,I))return!0}return!1})(g,u,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:lw,background:class extends gs{constructor(l,t,s,u){super(l,{layout:iL||(iL=new gr({visibility:new gt(Oe.layout_background.visibility)})),paint:rL||(rL=new gr({"background-pitch-alignment":new gt(Oe.paint_background["background-pitch-alignment"]),"background-color":new gt(Oe.paint_background["background-color"]),"background-pattern":new gt(Oe.paint_background["background-pattern"]),"background-opacity":new gt(Oe.paint_background["background-opacity"]),"background-emissive-strength":new gt(Oe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:cL,"raster-particle":mL,sky:class extends gs{constructor(l,t,s,u){super(l,{layout:hL||(hL=new gr({visibility:new gt(Oe.layout_sky.visibility)})),paint:pL||(pL=new gr({"sky-type":new gt(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new gt(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new gt(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new gt(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new gt(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ud(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new gt(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new gt(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new gt(Oe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=P0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),h=!u,m=l.style.light,g=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&At("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?yM(g.azimuthal,90-g.polar,t):yM(u[0],90-u[1],t)}let s=this.paint.get("sky-gradient-center");return yM(s[0],90-s[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends gs{constructor(l,t,s,u){super(l,{paint:fL||(fL=new gr({}))},t,null)}},model:class extends gs{constructor(l,t,s,u){super(l,{layout:yL||(yL=new gr({visibility:new gt(Oe.layout_model.visibility),"model-id":new Ct(Oe.layout_model["model-id"])})),paint:xL||(xL=new gr({"model-opacity":new Ct(Oe.paint_model["model-opacity"]),"model-rotation":new Ct(Oe.paint_model["model-rotation"]),"model-scale":new Ct(Oe.paint_model["model-scale"]),"model-translation":new Ct(Oe.paint_model["model-translation"]),"model-color":new Ct(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Ct(Oe.paint_model["model-color-mix-intensity"]),"model-type":new gt(Oe.paint_model["model-type"]),"model-cast-shadows":new gt(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new gt(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new gt(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ct(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Ct(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ct(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new gt(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new gt(Oe.paint_model["model-front-cutoff"]),"model-elevation-reference":new gt(Oe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this.layer=l,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new bM(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof hw?vt-1:0}queryRenderedFeatures(l,t,s){let u=t.getSource();if(!(u&&u instanceof ef))return{};let h=u,m={};m[this.id]=[];let g=m[this.id],v=0;for(let b of h.models){let C=t.getFeatureState(this.sourceLayer,b.id),T={type:"Unknown",id:b.id,properties:b.featureProperties},I=this.paint.get("model-rotation").evaluate(T,C),D=this.paint.get("model-scale").evaluate(T,C),O=this.paint.get("model-translation").evaluate(T,C),R=this.paint.get("model-elevation-reference"),B=[];q1(B,b,s,b.position,I,D,O,R==="ground",R==="ground",!1),s.projection.name==="globe"&&(B=G1(B,s));let H=Mt([],s.projMatrix,B),$=GI(l.isPointQuery()?l.screenBounds:l.screenGeometry,s,H,b.aabb);if($!=null){let Y=new Jp(void 0,0,0,0,b.id);Y.layer=this.layer,Y.properties=structuredClone(b.featureProperties),Y.properties.layer=this.id,Y.properties.uri=b.uri,Y.properties.orientation=b.orientation,Y.sourceLayer=this.sourceLayer,Y.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},Y.state=C,Y.source=this.source,g.push({featureIndex:v,feature:Y,intersectionZ:$})}++v}return m}queryIntersectsFeature(l,t,s,u,h,m){if(!this.modelManager)return!1;let g=this.modelManager,v=l.tile.getBucket(this);if(!(v&&v instanceof bM))return!1;for(let b in v.instancesPerModel){let C=v.instancesPerModel[b],T=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(T)){let I=C.features[C.idToFeaturesIndex[T]],D=g.getModel(b,this.scope);if(!D)return!1;let O=[],R=new c(0,0),B=v.canonical,H=Number.MAX_VALUE;for(let $=0;$<I.instancedDataCount;++$){let Y=16*(I.instancedDataOffset+$),Q=C.instancedDataArray.float32,ie=[Q[Y+4],Q[Y+5],Q[Y+6]];CM(B,R,Math.floor(Q[Y]),Math.floor(Q[Y+1])),q1(O,D,m,R,I.rotation,I.scale,ie,!1,!1,!1),m.projection.name==="globe"&&(O=G1(O,m));let he=Mt([],m.projMatrix,O),le=l.queryGeometry,me=GI(le.isPointQuery()?le.screenBounds:le.screenGeometry,m,he,D.aabb);me!=null&&(H=Math.min(me,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(l,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){let t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof sd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends gs{constructor(l,t,s,u){super(l,{layout:ek||(ek=new gr({"clip-layer-types":new gt(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new gt(Oe.layout_clip["clip-layer-scope"])})),paint:tk||(tk=new gr({}))},t,s,u)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new nk(l)}is3D(l){return!0}}},EM=new ui(0,0,0),SM={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},TM={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},pw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},iH={PAINT_ORDER_FILL_AND_STROKE:1},uy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},SL={MASK_TYPE_LUMINANCE:1};function rH(l,t,s){l===1&&t.icons.push((function(u,h){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;let{metadata:g}=m;if(g.content_area){let{content_area:v}=g;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(g.text_placeholder){let{text_placeholder:v}=g;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return g.stretch_x&&g.stretch_x.length&&TL(g,"x"),g.stretch_y&&g.stretch_y.length&&TL(g,"y"),m})(u.readFields(oH,{name:void 0},h))})(s,s.readVarint()+s.pos))}function TL(l,t){let s=[],u=l[`stretch_${t}`],h=null;for(let m=0;m<u.length;m++)h===null?h=s.length===0?u[0]:s[s.length-1][1]+u[m]:(s.push([h,h+u[m]]),h=null);l[`stretch_${t}_areas`]=s}function oH(l,t,s){l===1?t.name=s.readString():l===2?t.metadata=(function(u,h){return u.readFields(sH,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(s,s.readVarint()+s.pos):l===3&&(t.usvg_tree=(function(u,h){return u.readFields(cH,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(s,s.readVarint()+s.pos),t.data="usvg_tree")}function sH(l,t,s){l===1?t.stretch_x=s.readPackedVarint():l===2?t.stretch_y=s.readPackedVarint():l===3?t.content_area=IL(s,s.readVarint()+s.pos):l===4?t.variables.push((function(u,h){return u.readFields(lH,{name:void 0},h)})(s,s.readVarint()+s.pos)):l===5&&(t.text_placeholder=IL(s,s.readVarint()+s.pos))}function IL(l,t){return l.readFields(aH,{},t)}function aH(l,t,s){l===1?t.left=s.readVarint():l===2?t.width=s.readVarint():l===3?t.top=s.readVarint():l===4&&(t.height=s.readVarint())}function lH(l,t,s){l===1?t.name=s.readString():l===2&&(t.rgb_color=gw(s.readVarint()),t.value="rgb_color")}function cH(l,t,s){l===1?t.width=t.height=s.readVarint():l===2?t.height=s.readVarint():l===3?t.children.push(fw(s,s.readVarint()+s.pos)):l===4?t.linear_gradients.push((function(u,h){return u.readFields(gH,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(s,s.readVarint()+s.pos)):l===5?t.radial_gradients.push((function(u,h){return u.readFields(vH,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(s,s.readVarint()+s.pos)):l===7?t.clip_paths.push((function(u,h){return u.readFields(yH,{children:[]},h)})(s,s.readVarint()+s.pos)):l===8&&t.masks.push((function(u,h){let m=u.readFields(xH,{left:0,width:20,mask_type:SL.MASK_TYPE_LUMINANCE,children:[]},h);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(s,s.readVarint()+s.pos))}function fw(l,t){return l.readFields(uH,{},t)}function uH(l,t,s){l===1?(t.group=(function(u,h){return u.readFields(dH,{opacity:255,children:[]},h)})(s,s.readVarint()+s.pos),t.node="group"):l===2&&(t.path=(function(u,h){return u.readFields(pH,{paint_order:1,commands:[],step:1,diffs:[],rule:SM.PATH_RULE_NON_ZERO},h)})(s,s.readVarint()+s.pos),t.node="path")}function dH(l,t,s){l===1?t.transform=mw(s,s.readVarint()+s.pos):l===2?t.opacity=s.readVarint():l===5?t.clip_path_idx=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(fw(s,s.readVarint()+s.pos))}function mw(l,t){return l.readFields(hH,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function hH(l,t,s){l===1?t.sx=s.readFloat():l===2?t.ky=s.readFloat():l===3?t.kx=s.readFloat():l===4?t.sy=s.readFloat():l===5?t.tx=s.readFloat():l===6&&(t.ty=s.readFloat())}function pH(l,t,s){l===1?t.fill=(function(u,h){return u.readFields(fH,{rgb_color:EM,paint:"rgb_color",opacity:255},h)})(s,s.readVarint()+s.pos):l===2?t.stroke=(function(u,h){return u.readFields(mH,{rgb_color:EM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(s,s.readVarint()+s.pos):l===3?t.paint_order=s.readVarint():l===5?s.readPackedVarint(t.commands):l===6?t.step=s.readFloat():l===7?s.readPackedSVarint(t.diffs):l===8&&(t.rule=s.readVarint())}function fH(l,t,s){l===1?(t.rgb_color=gw(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5&&(t.opacity=s.readVarint())}function gw(l){return new ui((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function mH(l,t,s){l===1?(t.rgb_color=gw(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5?s.readPackedFloat(t.dasharray):l===6?t.dashoffset=s.readFloat():l===7?t.miterlimit=s.readFloat():l===8?t.opacity=s.readVarint():l===9?t.width=s.readFloat():l===10?t.linecap=s.readVarint():l===11&&(t.linejoin=s.readVarint())}function gH(l,t,s){l===1?t.transform=mw(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(ML(s,s.readVarint()+s.pos)):l===4?t.x1=s.readFloat():l===5?t.y1=s.readFloat():l===6?t.x2=s.readFloat():l===7&&(t.y2=s.readFloat())}function ML(l,t){return l.readFields(_H,{offset:0,opacity:255,rgb_color:EM},t)}function _H(l,t,s){l===1?t.offset=s.readFloat():l===2?t.opacity=s.readVarint():l===3&&(t.rgb_color=gw(s.readVarint()))}function vH(l,t,s){l===1?t.transform=mw(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(ML(s,s.readVarint()+s.pos)):l===4?t.cx=s.readFloat():l===5?t.cy=s.readFloat():l===6?t.r=s.readFloat():l===7?t.fx=s.readFloat():l===8?t.fy=s.readFloat():l===9&&(t.fr=s.readFloat())}function yH(l,t,s){l===1?t.transform=mw(s,s.readVarint()+s.pos):l===2?t.clip_path_idx=s.readVarint():l===3&&t.children.push(fw(s,s.readVarint()+s.pos))}function xH(l,t,s){l===1?t.left=t.top=s.readFloat():l===2?t.width=t.height=s.readFloat():l===3?t.top=s.readFloat():l===4?t.height=s.readFloat():l===5?t.mask_type=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(fw(s,s.readVarint()+s.pos))}class bH{static calculate(t={},s=[]){let u=new Map,h=new Map;if(Object.keys(t).length===0)return u;s.forEach(m=>{h.set(m.name,m.rgb_color||new ui(0,0,0))});for(let[m,g]of Object.entries(t))h.has(m)?u.set(h.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return u}}function Ng(l,t=255,s){let u=t/255,h=l.toString(),m=s.has(h)?s.get(h).clone():l.clone();return m.a*=u,m.toString()}function dy(l,t){if(!fl()){let s=document.createElement("canvas");return s.width=l,s.height=t,s}return new OffscreenCanvas(l,t)}let IM,hy=null;function MM(l,t,s,u,h){for(let m of u.children)DL(l,t,s,m,h)}function DL(l,t,s,u,h){u.group?(l.save(),(function(m,g,v,b,C){let T=b.mask_idx!=null?v.masks[b.mask_idx]:null,I=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(g=zg(b.transform).preMultiplySelf(g)),!(function(R,B,H){return R.opacity!==255||B||H})(b,I!=null,T!=null))return void MM(m,g,v,b,C);let D=dy(m.canvas.width,m.canvas.height),O=D.getContext("2d");MM(O,g,v,b,C),I&&LL(O,g,v,I),T&&NL(O,g,v,T,C),m.globalAlpha=b.opacity/255,m.drawImage(D,0,0)})(l,t,s,u.group,h),l.restore()):u.path&&(l.save(),(function(m,g,v,b,C){m.setTransform(g),b.paint_order===iH.PAINT_ORDER_FILL_AND_STROKE?(AL(m,v,b,C),OL(m,v,b,C)):(OL(m,v,b,C),AL(m,v,b,C))})(l,t,s,u.path,h),l.restore())}function AL(l,t,s,u){let h=s.fill;if(!h)return;let m=h.opacity/255;switch(l.save(),l.beginPath(),zL(s,l),h.paint){case"rgb_color":l.fillStyle=Ng(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{let g=t.linear_gradients[h.linear_gradient_idx];g.transform&&l.setTransform(zg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=RL(l,g,m,u);break}case"radial_gradient_idx":{let g=t.radial_gradients[h.radial_gradient_idx];g.transform&&l.setTransform(zg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=kL(l,g,m,u)}}l.fill(PL(s)),l.restore()}function PL(l){return l.rule===SM.PATH_RULE_NON_ZERO?"nonzero":l.rule===SM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function OL(l,t,s,u){let h=s.stroke;if(!h)return;let m=BL(s);l.lineWidth=h.width,l.miterLimit=h.miterlimit,l.setLineDash(h.dasharray),l.lineDashOffset=h.dashoffset;let g=h.opacity/255;switch(h.paint){case"rgb_color":l.strokeStyle=Ng(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":l.strokeStyle=RL(l,t.linear_gradients[h.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":l.strokeStyle=kL(l,t.radial_gradients[h.radial_gradient_idx],g,u,!0)}switch(h.linejoin){case pw.LINE_JOIN_MITER_CLIP:case pw.LINE_JOIN_MITER:l.lineJoin="miter";break;case pw.LINE_JOIN_ROUND:l.lineJoin="round";break;case pw.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(h.linecap){case TM.LINE_CAP_BUTT:l.lineCap="butt";break;case TM.LINE_CAP_ROUND:l.lineCap="round";break;case TM.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(m)}function RL(l,t,s,u,h=!1){if(t.stops.length===1){let D=t.stops[0];return Ng(D.rgb_color,D.opacity*s,u)}let{x1:m,y1:g,x2:v,y2:b}=t,C=new DOMPoint(m,g),T=new DOMPoint(v,b);if(h){let D=zg(t.transform);C=D.transformPoint(C),T=D.transformPoint(T)}let I=l.createLinearGradient(C.x,C.y,T.x,T.y);for(let D of t.stops)I.addColorStop(D.offset,Ng(D.rgb_color,D.opacity*s,u));return I}function kL(l,t,s,u,h=!1){if(t.stops.length===1){let $=t.stops[0];return Ng($.rgb_color,$.opacity*s,u)}let m=zg(t.transform),{fx:g,fy:v,fr:b,cx:C,cy:T,r:I}=t,D=new DOMPoint(g,v),O=new DOMPoint(C,T),R=b,B=I;if(h){D=m.transformPoint(D),O=m.transformPoint(O);let $=(m.a+m.d)/2;R=b*$,B=t.r*$}let H=l.createRadialGradient(D.x,D.y,R,O.x,O.y,B);for(let $ of t.stops)H.addColorStop($.offset,Ng($.rgb_color,$.opacity*s,u));return H}function FL(l,t,s,u){let h=u.transform?zg(u.transform).preMultiplySelf(t):t,m=dy(l.canvas.width,l.canvas.height),g=m.getContext("2d");for(let b of u.children)if(b.group)FL(g,h,s,b.group);else if(b.path){let C=b.path,T=new Path2D;T.addPath(BL(C),h),g.fill(T,PL(C))}let v=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;v&&LL(g,h,s,v),l.globalCompositeOperation="source-over",l.drawImage(m,0,0)}function LL(l,t,s,u){let h=dy(l.canvas.width,l.canvas.height);FL(h.getContext("2d"),t,s,u),l.globalCompositeOperation="destination-in",l.drawImage(h,0,0)}function NL(l,t,s,u,h){if(u.children.length===0)return;let m=u.mask_idx!=null?s.masks[u.mask_idx]:null;m&&NL(l,t,s,m,h);let g=l.canvas.width,v=l.canvas.height,b=dy(g,v),C=b.getContext("2d"),T=u.width,I=u.height,D=u.left,O=u.top,R=new Path2D,B=new Path2D;B.rect(D,O,T,I),R.addPath(B,t),C.clip(R);for(let Y of u.children)DL(C,t,s,Y,h);let H=C.getImageData(0,0,g,v),$=H.data;if(u.mask_type===SL.MASK_TYPE_LUMINANCE)for(let Y=0;Y<$.length;Y+=4)$[Y+3]=$[Y+3]/255*(.2126*$[Y]+.7152*$[Y+1]+.0722*$[Y+2]);C.putImageData(H,0,0),l.globalCompositeOperation="destination-in",l.drawImage(b,0,0)}function zg(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function zL(l,t){let s=l.step,u=l.diffs[0]*s,h=l.diffs[1]*s;t.moveTo(u,h);for(let m=0,g=2;m<l.commands.length;m++)switch(l.commands[m]){case uy.PATH_COMMAND_MOVE:u+=l.diffs[g++]*s,h+=l.diffs[g++]*s,t.moveTo(u,h);break;case uy.PATH_COMMAND_LINE:u+=l.diffs[g++]*s,h+=l.diffs[g++]*s,t.lineTo(u,h);break;case uy.PATH_COMMAND_QUAD:{let v=u+l.diffs[g++]*s,b=h+l.diffs[g++]*s;u=v+l.diffs[g++]*s,h=b+l.diffs[g++]*s,t.quadraticCurveTo(v,b,u,h);break}case uy.PATH_COMMAND_CUBIC:{let v=u+l.diffs[g++]*s,b=h+l.diffs[g++]*s,C=v+l.diffs[g++]*s,T=b+l.diffs[g++]*s;u=C+l.diffs[g++]*s,h=T+l.diffs[g++]*s,t.bezierCurveTo(v,b,C,T,u,h);break}case uy.PATH_COMMAND_CLOSE:t.closePath()}return t}function BL(l){return zL(l,new Path2D)}class _w{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;let s=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,s),s}put(t,s){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,s)}delete(t){this.cache.delete(t)}}Lt(_w,"LRUCache");class DM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Qo(t,t.data)}getFromCache(t,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new _w(150)),this.cacheMap.get(u).get(Xa(t.toString(),s))}setInCache(t,s,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new _w(150));let m=this.cacheDependenciesMap.get(h),g=Xa(t.id.toString(),u);m.get(g)||m.set(g,new Set);let v=this.cacheMap.get(h),b=t.toString();m.get(g).add(b),v.put(Xa(t.toString(),u),s)}removeImagesFromCacheByIds(t,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;let h=this.cacheMap.get(u),m=this.cacheDependenciesMap.get(u);for(let g of t){let v=Xa(g.toString(),s);if(m.has(v)){for(let b of m.get(v))h.delete(b);m.delete(v)}}}rasterize(t,s,u,h){let m=this.getFromCache(t,u,h);if(m)return m.clone();let g=(function(b,C){let T=bH.calculate(C.params,b.metadata?b.metadata.variables:[]),I=b.usvg_tree,D=I.width,O=I.height,R=Math.max(1,Math.round(D*C.sx)),B=Math.max(1,Math.round(O*C.sy)),H=new DOMMatrix([R/D,0,0,B/O,0,0]);return hy===null&&(hy=dy(10,10),IM=hy.getContext("2d",{willReadFrequently:!0})),hy.width=R,hy.height=B,MM(IM,H,I,I,T),IM.getImageData(0,0,R,B)})(s.icon,t),v=DM._getImage(g);return this.setInCache(t,v,u,h),v.clone()}}class VL{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){let u=this.toIdx(t,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function UL(l,t,s,u){let h=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<l[g]||s[g]>t[g])return null}else{let v=1/u[g],b=(l[g]-s[g])*v,C=(t[g]-s[g])*v;if(b>C){let T=b;b=C,C=T}if(b>h&&(h=b),C<m&&(m=C),h>m)return null}return h}function jL(l,t,s,u,h,m,g,v,b,C,T){let I=u-l,D=h-t,O=m-s,R=g-l,B=v-t,H=b-s,$=T[1]*H-T[2]*B,Y=T[2]*R-T[0]*H,Q=T[0]*B-T[1]*R,ie=I*$+D*Y+O*Q;if(Math.abs(ie)<1e-15)return null;let he=1/ie,le=C[0]-l,me=C[1]-t,ye=C[2]-s,we=(le*$+me*Y+ye*Q)*he;if(we<0||we>1)return null;let je=me*O-ye*D,Ie=ye*I-le*O,We=le*D-me*I,Ke=(T[0]*je+T[1]*Ie+T[2]*We)*he;return Ke<0||we+Ke>1?null:(R*je+B*Ie+H*We)*he}function $L(l,t,s){return(l-t)/(s-t)}function HL(l,t,s,u,h,m,g,v,b){let C=1<<s,T=m-u,I=g-h,D=(l+1)/C*T+u,O=(t+0)/C*I+h,R=(t+1)/C*I+h;v[0]=(l+0)/C*T+u,v[1]=O,b[0]=D,b[1]=R}class GL{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let s=(function(m){let g=Math.ceil(Math.log2(m.dim/8)),v=[],b=Math.ceil(Math.pow(2,g)),C=1/b,T=(O,R,B,H,$)=>{let Y=H?1:0,Q=(O+1)*B-Y,ie=R*B,he=(R+1)*B-Y;$[0]=O*B,$[1]=ie,$[2]=Q,$[3]=he},I=new VL(b),D=[];for(let O=0;O<b*b;O++){T(O%b,Math.floor(O/b),C,!1,D);let R=wh(D[0],D[1],m),B=wh(D[2],D[1],m),H=wh(D[2],D[3],m),$=wh(D[0],D[3],m);I.minimums.push(Math.min(R,B,H,$)),I.maximums.push(Math.max(R,B,H,$)),I.leaves.push(1)}for(v.push(I),b/=2;b>=1;b/=2){let O=v[v.length-1];I=new VL(b);for(let R=0;R<b*b;R++){T(R%b,Math.floor(R/b),2,!0,D);let B=O.getElevation(D[0],D[1]),H=O.getElevation(D[2],D[1]),$=O.getElevation(D[2],D[3]),Y=O.getElevation(D[0],D[3]),Q=O.isLeaf(D[0],D[1]),ie=O.isLeaf(D[2],D[1]),he=O.isLeaf(D[2],D[3]),le=O.isLeaf(D[0],D[3]),me=Math.min(B.min,H.min,$.min,Y.min),ye=Math.max(B.max,H.max,$.max,Y.max),we=Q&&ie&&he&&le;I.maximums.push(ye),I.minimums.push(me),I.leaves.push(ye-me<=5&&we?1:0)}v.push(I)}return v})(this.dem),u=s.length-1,h=s[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(t,s,u,h,m,g,v=1){return UL([t,s,-100],[u,h,this.maximums[0]*v],m,g)}raycast(t,s,u,h,m,g,v=1){if(!this.nodeCount)return null;let b=this.raycastRoot(t,s,u,h,m,g,v);if(b==null)return null;let C=[],T=[],I=[],D=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){let{idx:R,t:B,nodex:H,nodey:$,depth:Y}=O.pop();if(this.leaves[R]){HL(H,$,Y,t,s,u,h,I,D);let ie=1<<Y,he=(H+0)/ie,le=(H+1)/ie,me=($+0)/ie,ye=($+1)/ie,we=wh(he,me,this.dem)*v,je=wh(le,me,this.dem)*v,Ie=wh(le,ye,this.dem)*v,We=wh(he,ye,this.dem)*v,Ke=jL(I[0],I[1],we,D[0],I[1],je,D[0],D[1],Ie,m,g),Qe=jL(D[0],D[1],Ie,I[0],D[1],We,I[0],I[1],we,m,g),st=Math.min(Ke!==null?Ke:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(st!==Number.MAX_VALUE)return st;{let lt=Xs([],m,g,B);if(qL(we,je,We,Ie,$L(lt[0],I[0],D[0]),$L(lt[1],I[1],D[1]))>=lt[2])return B}continue}let Q=0;for(let ie=0;ie<this._siblingOffset.length;ie++){HL((H<<1)+this._siblingOffset[ie][0],($<<1)+this._siblingOffset[ie][1],Y+1,t,s,u,h,I,D),I[2]=-100,D[2]=this.maximums[this.childOffsets[R]+ie]*v;let he=UL(I,D,m,g);if(he!=null){let le=he;C[ie]=le;let me=!1;for(let ye=0;ye<Q&&!me;ye++)le>=C[T[ye]]&&(T.splice(ye,0,ie),me=!0);me||(T[Q]=ie),Q++}}for(let ie=0;ie<Q;ie++){let he=T[ie];O.push({idx:this.childOffsets[R]+he,t:C[he],nodex:(H<<1)+this._siblingOffset[he][0],nodey:($<<1)+this._siblingOffset[he][1],depth:Y+1})}}return null}_addNode(t,s,u){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,u,h,m){if(t[h].isLeaf(s,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let g=h-1,v=t[g],b=0,C=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*s+this._siblingOffset[T][0],D=2*u+this._siblingOffset[T][1],O=v.getElevation(I,D),R=v.isLeaf(I,D),B=this._addNode(O.min,O.max,R);R&&(b|=1<<T),C||(C=B)}for(let T=0;T<this._siblingOffset.length;T++)b&1<<T||this._construct(t,2*s+this._siblingOffset[T][0],2*u+this._siblingOffset[T][1],g,C+T)}}function qL(l,t,s,u,h,m){return on(on(l,s,m),on(t,u,m),h)}function wh(l,t,s){let u=s.dim,h=G(l*u-.5,0,u-1),m=G(t*u-.5,0,u-1),g=Math.floor(h),v=Math.floor(m),b=Math.min(g+1,u-1),C=Math.min(v+1,u-1);return qL(s.get(g,v),s.get(b,v),s.get(g,C),s.get(b,C),h-g,m-v)}let wH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function CH(l,t,s){return(256*l*256+256*t+s)/10-1e4}function EH(l,t,s){return 256*l+t+s/256-32768}class vw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,u,h=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void At(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;let m=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<m;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(m,b)]=g[this._idx(m-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,m)]=g[this._idx(b,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}let v=u==="terrarium"?EH:CH;for(let b=0;b<g.length;++b){let C=4*b;this.floatView[b]=v(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=ho.now()}_buildQuadTree(){this._tree=new GL(this)}get(t,s,u=!1){u&&(t=G(t,-1,this.dim),s=G(s,-1,this.dim));let h=this._idx(t,s);return this.floatView[h]}set(t,s,u){let h=this._idx(t,s),m=this.floatView[h];return this.floatView[h]=u,u-m}static getUnpackVector(t){return wH[t]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}static pack(t,s){let u=[0,0,0,0],h=vw.getUnpackVector(s),m=Math.floor((t+h[3])/h[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new VR({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,m=s*this.dim+this.dim,g=u*this.dim,v=u*this.dim+this.dim;switch(s){case-1:h=m-1;break;case 1:m=h+1}switch(u){case-1:g=v-1;break;case 1:v=g+1}let b=-s*this.dim,C=-u*this.dim;for(let T=g;T<v;T++)for(let I=h;I<m;I++){let D=4*this._idx(I,T),O=4*this._idx(I+b,T+C);this.pixels[D+0]=t.pixels[O+0],this.pixels[D+1]=t.pixels[O+1],this.pixels[D+2]=t.pixels[O+2],this.pixels[D+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function SH(l,t,s){l===1?t.headerLength=s.readFixed32():l===2?t.x=s.readVarint():l===3?t.y=s.readVarint():l===4?t.z=s.readVarint():l===5&&t.layers.push((function(u,h){return u.readFields(AH,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(s,s.readVarint()+s.pos))}function TH(l,t,s){l===1?(t.delta_filter=(function(u,h){return u.readFields(IH,{blockSize:0},h)})(s,s.readVarint()+s.pos),t.filter="delta_filter"):l===2?(s.readVarint(),t.filter="zigzag_filter"):l===3?(s.readVarint(),t.filter="bitshuffle_filter"):l===4&&(s.readVarint(),t.filter="byteshuffle_filter")}function IH(l,t,s){l===1&&(t.blockSize=s.readVarint())}function MH(l,t,s){l===1?(s.readVarint(),t.codec="gzip_data"):l===2?(s.readVarint(),t.codec="jpeg_image"):l===3?(s.readVarint(),t.codec="webp_image"):l===4&&(s.readVarint(),t.codec="png_image")}function DH(l,t,s){let u=0,h=0;l===1?t.firstByte=s.readFixed64():l===2?t.lastByte=s.readFixed64():l===3?t.filters.push((function(m,g){return m.readFields(TH,{},g)})(s,s.readVarint()+s.pos)):l===4?t.codec=(function(m,g){return m.readFields(MH,{},g)})(s,s.readVarint()+s.pos):l===5?h=s.readFloat():l===6?u=s.readFloat():l===7?t.bands.push(s.readString()):l===8?t.offset=s.readDouble():l===9&&(t.scale=s.readDouble()),t.offset===0&&(t.offset=h),t.scale===0&&(t.scale=u)}function AH(l,t,s){l===1?t.version=s.readVarint():l===2?t.name=s.readString():l===3?t.units=s.readString():l===4?t.tileSize=s.readVarint():l===5?t.buffer=s.readVarint():l===6?t.pixelFormat=s.readVarint():l===7&&t.dataIndex.push((function(u,h){return u.readFields(DH,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(s,s.readVarint()+s.pos))}function PH(l,t,s){if(l===2)(function(u,h,m){u.readFields(OH,m,h)})(s,s.readVarint()+s.pos,t);else if(l===3)throw new Error("Not implemented")}function OH(l,t,s){if(l===1){let u=0,h=s.readVarint()+s.pos;for(;s.pos<h;)t[u++]=s.readVarint()}}function RH(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let s=t[3];for(let u=2;u>=1;u--){let h=u===1?1:0,m=u===2?1:0;for(let g=0;g<t[0];g++){let v=t[1]*g;for(let b=h;b<t[1];b++){let C=t[2]*(b+v);for(let T=m;T<t[2];T++){let I=t[3]*(T+C);for(let D=0;D<t[3];D++){let O=I+D;l[O]+=l[O-s]}}}}s*=t[u]}return l}function kH(l){for(let t=0,s=l.length;t<s;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function FH(l,t){switch(t){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){let u=l[s],h=l[s+1];l[s]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,l[s+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){let u=l[s],h=l[s+1],m=l[s+2],g=l[s+3];l[s+0]=(192&u)>>6|(192&h)>>4|(192&m)>>2|192&g,l[s+1]=(48&u)>>4|(48&h)>>2|48&m|(48&g)<<2,l[s+2]=(12&u)>>2|12&h|(12&m)<<2|(12&g)<<4,l[s+3]=3&u|(3&h)<<2|(3&m)<<4|(3&g)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}Lt(vw,"DEMData"),Lt(GL,"DemMinMaxQuadTree",{omit:["dem"]});var el=Uint8Array,py=Uint16Array,LH=Int32Array,WL=new el([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ZL=new el([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),NH=new el([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),YL=function(l,t){for(var s=new py(31),u=0;u<31;++u)s[u]=t+=1<<l[u-1];var h=new LH(s[30]);for(u=1;u<30;++u)for(var m=s[u];m<s[u+1];++m)h[m]=m-s[u]<<5|u;return{b:s,r:h}},XL=YL(WL,2),KL=XL.b,zH=XL.r;KL[28]=258,zH[258]=28;for(var BH=YL(ZL,0).b,QL=new py(32768),so=0;so<32768;++so){var Bg=(43690&so)>>1|(21845&so)<<1;QL[so]=((65280&(Bg=(61680&(Bg=(52428&Bg)>>2|(13107&Bg)<<2))>>4|(3855&Bg)<<4))>>8|(255&Bg)<<8)>>1}var fy=function(l,t,s){for(var u=l.length,h=0,m=new py(t);h<u;++h)l[h]&&++m[l[h]-1];var g,v=new py(t);for(h=1;h<t;++h)v[h]=v[h-1]+m[h-1]<<1;g=new py(1<<t);var b=15-t;for(h=0;h<u;++h)if(l[h])for(var C=h<<4|l[h],T=t-l[h],I=v[l[h]-1]++<<T,D=I|(1<<T)-1;I<=D;++I)g[QL[I]>>b]=C;return g},my=new el(288);for(so=0;so<144;++so)my[so]=8;for(so=144;so<256;++so)my[so]=9;for(so=256;so<280;++so)my[so]=7;for(so=280;so<288;++so)my[so]=8;var JL=new el(32);for(so=0;so<32;++so)JL[so]=5;var VH=fy(my,9),UH=fy(JL,5),AM=function(l){for(var t=l[0],s=1;s<l.length;++s)l[s]>t&&(t=l[s]);return t},gc=function(l,t,s){var u=t/8|0;return(l[u]|l[u+1]<<8)>>(7&t)&s},PM=function(l,t){var s=t/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&t)},jH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_c=function(l,t,s){var u=new Error(t||jH[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,_c),!s)throw u;return u},$H=new el(0),HH=typeof TextDecoder<"u"&&new TextDecoder;try{HH.decode($H,{stream:!0})}catch{}let GH={gzip_data:"gzip"};class Ml extends Error{constructor(t){super(t),this.name="MRTError"}}let qH={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},eN={uint32:1,uint16:2,uint8:4},WH={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},OM;class yw{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){let s=this.layers[t];if(!s)throw new Ml(`Layer '${t}' not found`);return s}getHeaderLength(t){let s=new Uint8Array(t),u=new DataView(t);if(s[0]!==13)throw new Ml("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){let s=new Uint8Array(t),u=this.getHeaderLength(t);if(s.length<u)throw new Ml(`Expected header with length >= ${u} but got buffer of length ${s.length}`);let h=new OM(s.subarray(0,u)).readFields(SH,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ml(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(let m of h.layers)this.layers[m.name]=new tN(m,{cacheSize:this._cacheSize});return this}createDecodingTask(t){let s=[],u=this.getLayer(t.layerName);for(let h of t.blockIndices){let m=u.dataIndex[h],g=m.firstByte-t.firstByte,v=m.lastByte-t.firstByte;if(u._blocksInProgress.has(h))continue;let b={layerName:u.name,firstByte:g,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map(C=>C.filter)};u._blocksInProgress.add(h),s.push(b)}return new nN(s,()=>{s.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,m)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),h)throw h;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class tN{constructor({version:t,name:s,units:u,tileSize:h,pixelFormat:m,buffer:g,dataIndex:v},b){if(this.version=t,this.version!==1)throw new Ml(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=s,this.units=u,this.tileSize=h,this.buffer=g,this.pixelFormat=qH[m],this.dataIndex=v,this.bandShape=[h+2*g,h+2*g,eN[this.pixelFormat]],this._decodedBlocks=new _w(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return eN[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){let s=t.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,t.data)}getBlockForBand(t){let s=0;switch(typeof t){case"string":for(let[u,h]of this.dataIndex.entries()){for(let[m,g]of h.bands.entries())if(g===t)return{bandIndex:s+m,blockIndex:u,blockBandIndex:m};s+=h.bands.length}break;case"number":for(let[u,h]of this.dataIndex.entries()){if(t>=s&&t<s+h.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-s};s+=h.bands.length}break;default:throw new Ml(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let s=1/0,u=-1/0,h=[],m=new Set;for(let g of t){let{blockIndex:v}=this.getBlockForBand(g);if(v<0)throw new Ml(`Invalid band: ${JSON.stringify(g)}`);let b=this.dataIndex[v];h.includes(v)||h.push(v),m.add(v),s=Math.min(s,b.firstByte),u=Math.max(u,b.lastByte)}if(m.size>this.cacheSize)throw new Ml(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:h}}hasBand(t){let{blockIndex:s}=this.getBlockForBand(t);return s>=0}hasDataForBand(t){let{blockIndex:s}=this.getBlockForBand(t);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(t){let{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(t);if(s<0)throw new Ml(`Band not found: ${JSON.stringify(t)}`);let h=this._decodedBlocks.get(s.toString());if(!h)throw new Ml(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[s],g=this.bandShape.reduce((C,T)=>C*T,1),v=u*g,b=h.subarray(v,v+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}yw.setPbf=function(l){OM=l};class nN{constructor(t,s,u){this.tasks=t,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,s){this._finalized||(this._onComplete(t,s),this._finalized=!0)}}yw.performDecoding=function(l,t){let s=new Uint8Array(l);return Promise.all(t.tasks.map(u=>{let{layerName:h,firstByte:m,lastByte:g,pixelFormat:v,blockShape:b,blockIndex:C,filters:T,codec:I}=u,D=s.subarray(m,g+1),O=new Uint32Array(b[0]*b[1]*b[2]),R;if(I!=="gzip_data")throw new Ml(`Unhandled codec: ${I}`);return R=(function(B,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((ie=(function(me){me[0]==31&&me[1]==139&&me[2]==8||_c(6,"invalid gzip data");var ye=me[3],we=10;4&ye&&(we+=2+(me[10]|me[11]<<8));for(var je=(ye>>3&1)+(ye>>4&1);je>0;je-=!me[we++]);return we+(2&ye)})(Q=B))+8>Q.length&&_c(6,"invalid gzip data"),(function(me,ye,we,je){var Ie=me.length;if(!Ie||ye.f&&!ye.l)return we||new el(0);var We=!we,Ke=We||ye.i!=2,Qe=ye.i;We&&(we=new el(3*Ie));var st,lt,nt=function(_i){var ei=we.length;if(_i>ei){var oi=new el(Math.max(2*ei,_i));oi.set(we),we=oi}},it=ye.f||0,qe=ye.p||0,He=ye.b||0,rt=ye.l,yt=ye.d,ft=ye.m,qt=ye.n,It=8*Ie;do{if(!rt){it=gc(me,qe,1);var Ot=gc(me,qe+1,3);if(qe+=3,!Ot){var Bt=me[(Ze=4+((qe+7)/8|0))-4]|me[Ze-3]<<8,In=Ze+Bt;if(In>Ie){Qe&&_c(0);break}Ke&&nt(He+Bt),we.set(me.subarray(Ze,In),He),ye.b=He+=Bt,ye.p=qe=8*In,ye.f=it;continue}if(Ot==1)rt=VH,yt=UH,ft=9,qt=5;else if(Ot==2){var mt=gc(me,qe,31)+257,Vt=gc(me,qe+10,15)+4,un=mt+gc(me,qe+5,31)+1;qe+=14;for(var Ln=new el(un),zn=new el(19),_n=0;_n<Vt;++_n)zn[NH[_n]]=gc(me,qe+3*_n,7);qe+=3*Vt;var gi=AM(zn),ce=(1<<gi)-1,pe=fy(zn,gi);for(_n=0;_n<un;){var Ze,at=pe[gc(me,qe,ce)];if(qe+=15&at,(Ze=at>>4)<16)Ln[_n++]=Ze;else{var Et=0,St=0;for(Ze==16?(St=3+gc(me,qe,3),qe+=2,Et=Ln[_n-1]):Ze==17?(St=3+gc(me,qe,7),qe+=3):Ze==18&&(St=11+gc(me,qe,127),qe+=7);St--;)Ln[_n++]=Et}}var Wt=Ln.subarray(0,mt),Yt=Ln.subarray(mt);ft=AM(Wt),qt=AM(Yt),rt=fy(Wt,ft),yt=fy(Yt,qt)}else _c(1);if(qe>It){Qe&&_c(0);break}}Ke&&nt(He+131072);for(var mn=(1<<ft)-1,Cn=(1<<qt)-1,Tn=qe;;Tn=qe){var Pn=(Et=rt[PM(me,qe)&mn])>>4;if((qe+=15&Et)>It){Qe&&_c(0);break}if(Et||_c(2),Pn<256)we[He++]=Pn;else{if(Pn==256){Tn=qe,rt=null;break}var rn=Pn-254;Pn>264&&(rn=gc(me,qe,(1<<(Xn=WL[_n=Pn-257]))-1)+KL[_n],qe+=Xn);var cn=yt[PM(me,qe)&Cn],Hn=cn>>4;if(cn||_c(3),qe+=15&cn,Yt=BH[Hn],Hn>3){var Xn=ZL[Hn];Yt+=PM(me,qe)&(1<<Xn)-1,qe+=Xn}if(qe>It){Qe&&_c(0);break}Ke&&nt(He+131072);var Kn=He+rn;if(He<Yt){var hi=0-Yt,Ii=Math.min(Yt,Kn);for(hi+He<0&&_c(3);He<Ii;++He)we[He]=(void 0)[hi+He]}for(;He<Kn;++He)we[He]=we[He-Yt]}}ye.l=rt,ye.p=Tn,ye.b=He,ye.f=it,rt&&(it=1,ye.m=ft,ye.d=yt,ye.n=qt)}while(!it);return He!=we.length&&We?(st=we,((lt=He)==null||lt>st.length)&&(lt=st.length),new el(st.subarray(0,lt))):we.subarray(0,He)})(Q.subarray(ie,-8),{i:2},new el((($=Q)[(Y=$.length)-4]|$[Y-3]<<8|$[Y-2]<<16|$[Y-1]<<24)>>>0))));var $,Y,Q,ie;let he=GH[H];if(!he)throw new Error(`Unhandled codec: ${H}`);let le=new globalThis.DecompressionStream(he);return new Response(new Blob([B]).stream().pipeThrough(le)).arrayBuffer().then(me=>new Uint8Array(me))})(D,I).then(B=>((function(H,$){H.readFields(PH,$)})(new OM(B),O),new WH[v](O.buffer))),R.then(B=>{for(let H=T.length-1;H>=0;H--)switch(T[H]){case"delta_filter":RH(B,b);break;case"zigzag_filter":kH(B);break;case"bitshuffle_filter":FH(B,v);break;default:throw new Ml(`Unhandled filter "${T[H]}"`)}return{layerName:h,blockIndex:C,data:B}}).catch(B=>{throw B})}))},Lt(nN,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Lt(yw,"MapboxRasterTile"),Lt(tN,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class iN{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){let u=t[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class rN{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new sh(vt,16,0),this.featureIndexArray=new E0,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,s,u,h,m,g=0,v=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,m,g);let C=this.grid;for(let T=0;T<s.length;T++){let I=s[T],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<I.length;O++){let R=I[O];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}v!==0&&(D[0]-=v,D[1]-=v,D[2]+=v,D[3]+=v),D[0]<vt&&D[1]<vt&&D[2]>=0&&D[3]>=0&&C.insert(b,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fe(new Y1(this.rawTileData)).layers,this.sourceLayerCoder=new iN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s){let{tilespaceGeometry:u,transform:h,tileTransform:m,pixelPosMatrix:g,availableImages:v,worldview:b}=s;this.loadVTLayers(),this.serializedLayersCache.clear();let C=s.queryRadius?s.queryRadius:0,T=u.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(B,H,$,Y)=>_s(u.bufferedTilespaceGeometry,B-C,H-C,$+C,Y+C));I.sort(ZH);let D=null;h.elevation&&I.length>0&&(D=Lg.create(h.elevation,this.tileID));let O={},R;for(let B=0;B<I.length;B++){let H=I[B];if(H===R)continue;R=H;let $=this.featureIndexArray.get(H),Y=null;this.is3DTile?this.loadMatchingModelFeature(O,$,t,u,h,b):this.loadMatchingFeature(O,$,t,v,b,(Q,ie,he,le=0)=>(Y||(Y=_e(Q,this.tileID.canonical,m)),ie.queryIntersectsFeature(u,Q,he,Y,this.z,h,g,D,le)))}return O}loadMatchingFeature(t,s,u,h,m,g){let{featureIndex:v,bucketIndex:b,sourceLayerIndex:C,layoutVertexArrayOffset:T}=s,I=this.bucketLayerIDs[b],D=u.layers,O=Object.keys(D);if(O.length&&!kt(O,I))return;let R=u.sourceCache,B=this.sourceLayerCoder.decode(C),H=this.vtLayers[B].feature(v),$=this.getId(H,B);for(let Y=0;Y<I.length;Y++){let Q=I[Y];if(!D[Q])continue;let{styleLayer:ie,targets:he}=D[Q],le={};$!==void 0&&(le=R.getFeatureState(ie.sourceLayer,$));let me=!g||g(H,ie,le,T);if(!me)continue;let ye=new Jp(H,this.z,this.x,this.y,$);ye.tile=this.tileID.canonical,ye.state=le;let we=this.serializedLayersCache.get(Q);we||(we=ie.serialize(),we.id=Q,this.serializedLayersCache.set(Q,we)),ye.source=we.source,ye.sourceLayer=we["source-layer"],ye.layer=Object.assign({},we),ye.layer.paint=oN(we.paint,ie.paint,H,le,h),ye.layer.layout=oN(we.layout,ie.layout,H,le,h);let je=!1;for(let Ie of he){this.updateFeatureProperties(ye,Ie);let{filter:We}=Ie;if(We){if(H.properties=ye.properties,We.needGeometry){let Ke=Te(H,!0);if(!We.filter(new Vi(this.tileID.overscaledZ,{worldview:m}),Ke,this.tileID.canonical))continue}else if(!We.filter(new Vi(this.tileID.overscaledZ,{worldview:m}),H))continue}je=!0,Ie.targetId&&this.addFeatureVariant(ye,Ie)}je&&this.appendToResult(t,Q,v,ye,me)}}loadMatchingModelFeature(t,s,u,h,m,g){let{featureIndex:v,bucketIndex:b}=s,C=this.bucketLayerIDs[b],T=u.layers,I=Object.keys(T);if(!I.length||kt(I,C))for(let D=0;D<C.length;D++){let O=C[D],{styleLayer:R,targets:B}=T[O];if(R.type!=="model")continue;let H=h.tile,$=H.getBucket(R);if(!($&&$ instanceof hw))continue;let Y=tH($,v,h,m);if(!Y)continue;let{z:Q,x:ie,y:he}=H.tileID.canonical,{feature:le,intersectionZ:me,position:ye}=Y,we={};le.id!==void 0&&(we=u.sourceCache.getFeatureState(R.sourceLayer,le.id));let je=new Jp({},Q,ie,he,le.id);je.tile=this.tileID.canonical,je.state=we,je.properties=le.properties,je.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Ie=this.serializedLayersCache.get(O);Ie||(Ie=R.serialize(),Ie.id=O,this.serializedLayersCache.set(O,Ie)),je.source=Ie.source,je.sourceLayer=Ie["source-layer"],je.layer=Object.assign({},Ie);let We=!1;for(let Ke of B){this.updateFeatureProperties(je,Ke);let{filter:Qe}=Ke;if(Qe){if(le.properties=je.properties,Qe.needGeometry){if(!Qe.filter(new Vi(this.tileID.overscaledZ,{worldview:g}),le,this.tileID.canonical))continue}else if(!Qe.filter(new Vi(this.tileID.overscaledZ,{worldview:g}),le))continue}We=!0,Ke.targetId&&this.addFeatureVariant(je,Ke)}We&&this.appendToResult(t,O,v,je,me)}}updateFeatureProperties(t,s,u){if(s.properties){let h={};for(let m in s.properties){let g=s.properties[m].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,u);g!=null&&(h[m]=g)}t.properties=h}}addFeatureVariant(t,s,u){let h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=t.properties),t.variants=t.variants||{},t.variants[s.targetId]=t.variants[s.targetId]||[],t.variants[s.targetId].push(h)}appendToResult(t,s,u,h,m){let g=t[s];g===void 0&&(g=t[s]=[]),g.push({featureIndex:u,feature:h,intersectionZ:m})}lookupSymbolFeatures(t,s,u,h,m,g){let v={};this.loadVTLayers();for(let b of t)this.loadMatchingFeature(v,{bucketIndex:s,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},h,m,g);return v}loadFeature(t){let{featureIndex:s,sourceLayerIndex:u}=t;this.loadVTLayers();let h=this.sourceLayerCoder.decode(u),m=this.vtFeatures[h];if(m[s])return m[s];let g=this.vtLayers[h].feature(s);return m[s]=g,g}hasLayer(t){for(let s of this.bucketLayerIDs)for(let u of s)if(t===u)return!0;return!1}getId(t,s){let u=t.id;if(this.promoteId){let h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){let m=nu(h);if(m.result!=="success"){let g=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void At(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}u=this.promoteIdExpression.evaluate({zoom:0},t)}else u=t.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function oN(l,t,s,u,h){return Ne(l,(m,g)=>{let v=t instanceof cd?t.get(g):null;return v&&v.evaluate?v.evaluate(s,u,void 0,h):v})}function ZH(l,t){return t-l}Lt(rN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let sN=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class RM{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,u]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let m=sN[15&u];if(!m)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new RM(v,g,m,t)}constructor(t,s=64,u=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let m=sN.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=s,u}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return kM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:g,nodeSize:v}=this,b=[0,m.length-1,0],C=[];for(;b.length;){let T=b.pop()||0,I=b.pop()||0,D=b.pop()||0;if(I-D<=v){for(let H=D;H<=I;H++){let $=g[2*H],Y=g[2*H+1];$>=t&&$<=u&&Y>=s&&Y<=h&&C.push(m[H])}continue}let O=D+I>>1,R=g[2*O],B=g[2*O+1];R>=t&&R<=u&&B>=s&&B<=h&&C.push(m[O]),(T===0?t<=R:s<=B)&&(b.push(D),b.push(O-1),b.push(1-T)),(T===0?u>=R:h>=B)&&(b.push(O+1),b.push(I),b.push(1-T))}return C}within(t,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:m,nodeSize:g}=this,v=[0,h.length-1,0],b=[],C=u*u;for(;v.length;){let T=v.pop()||0,I=v.pop()||0,D=v.pop()||0;if(I-D<=g){for(let H=D;H<=I;H++)lN(m[2*H],m[2*H+1],t,s)<=C&&b.push(h[H]);continue}let O=D+I>>1,R=m[2*O],B=m[2*O+1];lN(R,B,t,s)<=C&&b.push(h[O]),(T===0?t-u<=R:s-u<=B)&&(v.push(D),v.push(O-1),v.push(1-T)),(T===0?t+u>=R:s+u>=B)&&(v.push(O+1),v.push(I),v.push(1-T))}return b}}function kM(l,t,s,u,h,m){if(h-u<=s)return;let g=u+h>>1;aN(l,t,g,u,h,m),kM(l,t,s,u,g-1,1-m),kM(l,t,s,g+1,h,1-m)}function aN(l,t,s,u,h,m){for(;h>u;){if(h-u>600){let C=h-u+1,T=s-u+1,I=Math.log(C),D=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*D*(C-D)/C)*(T-C/2<0?-1:1);aN(l,t,s,Math.max(u,Math.floor(s-T*D/C+O)),Math.min(h,Math.floor(s+(C-T)*D/C+O)),m)}let g=t[2*s+m],v=u,b=h;for(gy(l,t,u,s),t[2*h+m]>g&&gy(l,t,u,h);v<b;){for(gy(l,t,v,b),v++,b--;t[2*v+m]<g;)v++;for(;t[2*b+m]>g;)b--}t[2*u+m]===g?gy(l,t,u,b):(b++,gy(l,t,b,h)),b<=s&&(u=b+1),s<=b&&(h=b-1)}}function gy(l,t,s,u){FM(l,s,u),FM(t,2*s,2*u),FM(t,2*s+1,2*u+1)}function FM(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}function lN(l,t,s,u){let h=l-s,m=t-u;return h*h+m*m}r.$=gm,r.A=Kl,r.B=Xa,r.C=2,r.D=Cg,r.E=ed,r.F=K0,r.G=kF,r.H=mm,r.I=as,r.J=u1,r.K=Gt,r.L=Wd,r.M=Vm,r.N=Dp,r.O=Kb,r.P=ot,r.Q=Ap,r.R=lp,r.S=Xm,r.T=$I,r.U=nu,r.V=dw,r.W=r0,r.X=Qd,r.Y=Kd,r.Z=Cp,r._=fs,r.a=function(l){return kn.API_CDN_URL_REGEX.test(l)},r.a$=L,r.a0=ln,r.a1=ya,r.a2=Cl,r.a3=class extends dw{},r.a4=Um,r.a5=Xb,r.a6=Oe,r.a7=function(l){let t=l.value;return t?ln(t)?xM(t,!0)?[]:[new dw(l.key,t,`invalid url "${t}"`)]:[new dw(l.key,t,`string expected, "${Gt(t)}" found`)]:[]},r.a8=s1,r.a9=gr,r.aA=G,r.aB=Mt,r.aC=qo,r.aD=Yo,r.aE=Si,r.aF=w,r.aG=te,r.aH=function(l,t){let s={};for(let u=0;u<t.length;u++){let h=t[u];h in l&&(s[h]=l[h])}return s},r.aI=f,r.aJ=S,r.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,s,u){let h=this.entries[l]=this.entries[l]||{callbacks:[]};if(h.result){let[m,g]=h.result;return this.scheduler?this.scheduler.add(()=>{u(m,g)},t):u(m,g),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=s((m,g)=>{h.result=[m,g];for(let v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,g)},t):v(m,g);setTimeout(()=>delete this.entries[l],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==u),h.callbacks.length||(h.cancel(),delete this.entries[l]))}}},r.aL=function(l,t,s){let u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},h=>{let m=Xl(l.request,(g,v,b)=>{g?h(g):v&&h(null,{rawData:v,vectorTile:s?void 0:new Fe(new Y1(v)),responseHeaders:new Map(b.entries())})});return()=>{m.cancel(),h()}},t)},r.aM=function(l){return l?{cacheControl:l.get("Cache-Control"),expires:l.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=Bs,r.aO=function(l){va++,va>om&&(l.getActor().send("enforceCacheSizeLimit",rm),va=0)},r.aP=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},r.aQ=dr,r.aR=cL,r.aS=mL,r.aT=c,r.aU=lL,r.aV=function(l,t){let s=document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let u=0;u<l.length;u++){let h=document.createElement("source");NT(l[u])||(s.crossOrigin="Anonymous"),h.src=l[u],s.appendChild(h)}return{cancel:()=>{}}},r.aW=q0,r.aX=ef,r.aY=Pe,r.aZ=ty,r.a_=A,r.aa=gt,r.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return gn(l.expression.evaluate(t))}interpolate(l,t,s){return{x:on(l.x,t.x,s),y:on(l.y,t.y,s),z:on(l.z,t.z,s),azimuthal:on(l.azimuthal,t.azimuthal,s),polar:on(l.polar,t.polar,s)}}},r.ac=Vi,r.ad=sd,r.ae=ee,r.af=Fr,r.ag=xo,r.ah=K,r.ai=cd,r.aj=_h,r.ak=on,r.al=vt,r.am=Iv,r.an=Zn,r.ao=ui,r.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return(function([s,u]){let h=gn([1,s,u]);return{x:h.x,y:h.y,z:h.z}})(l.expression.evaluate(t))}interpolate(l,t,s){return{x:on(l.x,t.x,s),y:on(l.y,t.y,s),z:on(l.z,t.z,s)}}},r.aq=function(l,t,s=0,u=!0){let h=new ot(s,s),m=l.sub(h),g=t.add(h),v=[m,new ot(g.x,m.y),g,new ot(m.x,g.y)];return u&&v.push(m.clone()),v},r.ar=function(l,t){let s=[];for(let u=0;u<l.length;u++){let h=se(u-1,-1,l.length-1),m=se(u+1,-1,l.length-1),g=l[u],v=l[m],b=l[h].sub(g).unit(),C=v.sub(g).unit(),T=C.angleWithSep(b.x,b.y),I=b.add(C).unit().mult(-1*t/Math.sin(T/2));s.push(g.add(I))}return s},r.as=WF,r.at=_s,r.au=function(l,t,s=0){return yr(((t.x-s)*l.scale-l.x)*vt,(t.y*l.scale-l.y)*vt,F(t.z,t.y))},r.av=Br,r.aw=Yi,r.ax=zt,r.ay=lF,r.az=function(l){let t=1/0,s=1/0,u=-1/0,h=-1/0;for(let m of l)t=Math.min(t,m.x),s=Math.min(s,m.y),u=Math.max(u,m.x),h=Math.max(h,m.y);return{min:new ot(t,s),max:new ot(u,h)}},r.b=function(l){return kn.API_FONTS_REGEX.test(l)},r.b$=lk,r.b0=Xr,r.b1=ch,r.b2=Ee,r.b3=y1,r.b4=aw,r.b5=function(){rc.isLoading()||rc.isLoaded()||Fp()!=="deferred"||o1()},r.b6=Km,r.b7=Te,r.b8=Jp,r.b9=mr,r.bA=ht,r.bB=Li,r.bC=$e,r.bD=function(l,t){let{x:s,y:u}=l.point,h=IR(s,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Mt(h,h,vI(Ja(t)))},r.bE=k,r.bF=zs,r.bG=Jf,r.bH=Xs,r.bI=Go,r.bJ=Ir,r.bK=Pg,r.bL=ra,r.bM=aM,r.bN=function(l,t,s,u,h){let m=5*t+2;l.float32[m+0]=s,l.float32[m+1]=u,l.float32[m+2]=h},r.bO=Fg,r.bP=Es,r.bQ=Zl,r.bR=$c,r.bS=tm,r.bT=se,r.bU=function(l,t,s,u){var h=new P(4);return h[0]=l,h[1]=t,h[2]=s,h[3]=u,h},r.bV=class{isDataAvailableAtPoint(l){let t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;let s=t.getSource().maxzoom,u=1<<s,h=Math.floor(l.x),m=Math.floor((l.x-h)*u),g=Math.floor(l.y*u),v=this.findDEMTileFor(new dr(s,h,s,m,g));return!(!v||!v.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,s=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);let u=this._source();if(!u||l.y<0||l.y>1)return t;let h=u.getSource().maxzoom,m=1<<h,g=Math.floor(l.x),v=l.x-g,b=new dr(h,g,h,Math.floor(v*m),Math.floor(l.y*m)),C=this.findDEMTileFor(b);if(!C||!C.dem)return t;let T=C.dem,I=1<<C.tileID.canonical.z,D=(v*I-C.tileID.canonical.x)*T.dim,O=(l.y*I-C.tileID.canonical.y)*T.dim,R=Math.floor(D),B=Math.floor(O);return(s?this.exaggeration():1)*on(on(T.get(R,B),T.get(R,B+1),O-B),on(T.get(R+1,B),T.get(R+1,B+1),O-B),D-R)}static getAtTileOffset(l,t,s,u){let h=1<<l.canonical.z;return u?u.pointElevation(t):s?s.getAtPointOrZero(new ee(l.wrap+(l.canonical.x+t.x/vt)/h,(l.canonical.y+t.y/vt)/h)):0}static getAtTileOffsetFunc(l,t,s,u){return(h,m,g)=>{let v=this.getAtTileOffset(l,h,m,g),b=u.upVector(l.canonical,h.x,h.y);return fr(b,b,v*u.upVectorScale(l.canonical,t,s).metersToTile),b}}getForTilePoints(l,t,s,u){if(this.isUsingMockSource())return!1;let h=Lg.create(this,l,u);return!!h&&(t.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;let t=this.findDEMTileFor(l);if(!t||!t.dem)return null;let s=t.dem.tree,u=t.tileID,h=1<<l.canonical.z-u.canonical.z,m=l.canonical.x/h-u.canonical.x,g=l.canonical.y/h-u.canonical.y,v=0;for(let b=0;b<l.canonical.z-u.canonical.z&&!s.leaves[v];b++){m*=2,g*=2;let C=2*Math.floor(g)+Math.floor(m);v=s.childOffsets[v]+C,m%=1,g%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(let h of l){let m=this.getMinMaxForTile(h.tileID);m&&(s=Math.min(s,m.min),u=Math.max(u,m.max),t=!0)}return t?{min:s,max:u}:null}},r.bW=N1,r.bX=Wn,r.bY=fo,r.bZ=rk,r.b_=gL,r.ba=QI,r.bb=MI,r.bc=_e,r.bd=ru,r.be=su,r.bf=mh,r.bg=nr,r.bh=bg,r.bi=vM,r.bj=function(l,t){let s=_h(t.zoom);if(s===0)return Ja(l);let u=T1(l),h=_I(u),m=w(u.getWest())*t.worldSize,g=w(u.getEast())*t.worldSize,v=S(u.getNorth())*t.worldSize,b=S(u.getSouth())*t.worldSize,C=[m,v,0],T=[g,v,0],I=[m,b,0],D=[g,b,0],O=Nt([],t.globeMatrix);return Fr(C,C,O),Fr(T,T,O),Fr(I,I,O),Fr(D,D,O),h[0]=hc(h[0],I,s),h[1]=hc(h[1],D,s),h[2]=hc(h[2],T,s),h[3]=hc(h[3],C,s),jt.fromPoints(h)},r.bk=M1,r.bl=Nt,r.bm=A0,r.bn=hc,r.bo=lh,r.bp=qp,r.bq=Or,r.br=Xt,r.bs=yw,r.bt=Y1,r.bu=Xl,r.bv=function(l,t){let s=[];for(let u in l)u in t||s.push(u);return s},r.bw=xe,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=Yl,r.bz=ke,r.c=ko,r.c$=function(l,t,s){let u=0;for(let h=0;h<2;++h)l[h]>0&&(u+=(l[h]-0)*(l[h]-0)),t[h]<0&&(u+=(0-t[h])*(0-t[h]));return u},r.c0=ck,r.c1=rM,r.c2=UF,r.c3=hM,r.c4=RM,r.c5=fr,r.c6=Ud,r.c7=jd,r.c8=function(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+h*v,l[1]=h*b-u*v,l[2]=m*b+g*v,l[3]=g*b-m*v,l},r.c9=ja,r.cA=ci,r.cB=Jn,r.cC=Wk,r.cD=Ti,r.cE=ER,r.cF=function(l,t,s,u,h,m,g,v,b){if(b.name==="globe")return ER(l,t,new Ti(s,u,h),!1);let C=ty({z:s,x:u,y:h},b);return new jt([(m+C.x/C.scale)*t,t*(C.y/C.scale),g],[(m+C.x2/C.scale)*t,t*(C.y2/C.scale),v])},r.cG=function(l,t,s){return l[0]=Math.min(t[0],s[0]),l[1]=Math.min(t[1],s[1]),l[2]=Math.min(t[2],s[2]),l[3]=Math.min(t[3],s[3]),l},r.cH=function(l,t,s){return l[0]=Math.max(t[0],s[0]),l[1]=Math.max(t[1],s[1]),l[2]=Math.max(t[2],s[2]),l[3]=Math.max(t[3],s[3]),l},r.cI=function(l){let t=Math.round((l+45+360)%360/90)%4;return Cv[t]},r.cJ=N,r.cK=Uc,r.cL=xg,r.cM=function(l){let t=ht(new Float64Array(16));Mt(t,l.pixelMatrix,l.globeMatrix);let s=[0,Sa,0],u=[0,Ta,0];return Fr(s,s,t),Fr(u,u,t),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!xI(l,new c(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!xI(l,new c(l.center.lat,-90))]},r.cN=function(l,t){let{scale:s}=l.tileTransform,u=s*vt/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return(function(h,m,g){var v=m[1],b=m[2],C=m[3],T=g[0],I=g[1];return h[0]=m[0]*T,h[1]=v*T,h[2]=b*I,h[3]=C*I,h})(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},r.cO=$1,r.cP=zu,r.cQ=qk,r.cR=function(l){let t=qk(l,!0);return k([],[t[0],t[1],t[4],t[5]])},r.cS=Vn,r.cT=Tt,r.cU=sr,r.cV=function(l){let{x:t,y:s}=l.point,{lng:u,lat:h}=l._center;return IR(t,s,l.worldSize,u,h)},r.cW=Va,r.cX=os,r.cY=rr,r.cZ=Fo,r.c_=Ea,r.ca=xr,r.cb=function(l,t){return l[0]=-t[0],l[1]=-t[1],l[2]=-t[2],l[3]=t[3],l},r.cc=Nu,r.cd=function(l,t,s,u,h){var m=1/Math.tan(t/2);if(l[0]=m/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=m,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,h!=null&&h!==1/0){var g=1/(u-h);l[10]=(h+u)*g,l[14]=2*h*u*g}else l[10]=-1,l[14]=-2*u;return l},r.ce=function(l,t,s,u,h,m,g){var v=1/(t-s),b=1/(u-h),C=1/(m-g);return l[0]=-2*v,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*b,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*C,l[11]=0,l[12]=(t+s)*v,l[13]=(h+u)*b,l[14]=(g+m)*C,l[15]=1,l},r.cf=M,r.cg=function(l,t,s){l[4*t+0]=s[0],l[4*t+1]=s[1],l[4*t+2]=s[2],l[4*t+3]=s[3]},r.ch=gg,r.ci=Vp,r.cj=Kr,r.ck=Tl,r.cl=jp,r.cm=QF,r.cn=function(){var l=new P(4);return P!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},r.co=function(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+m*v,l[1]=h*b+g*v,l[2]=u*-v+m*b,l[3]=h*-v+g*b,l},r.cp=function(l,t){return l[0]===t[0]&&l[1]===t[1]&&l[2]===t[2]&&l[3]===t[3]},r.cq=rs,r.cr=function(l){var t=l[0],s=l[1],u=l[2],h=l[3];return Math.sqrt(t*t+s*s+u*u+h*h)},r.cs=Hu,r.ct=Vc,r.cu=Lr,r.cv=3,r.cw=2,r.cx=7,r.cy=6,r.cz=Vu,r.d=function(l){return kn.API_TILEJSON_REGEX.test(l)},r.d$=class{constructor(l,t,s,u){this.context=l,this.format=u,this.size=s,this.texture=l.gl.createTexture();let[h,m,g]=this.size,{gl:v}=l;v.bindTexture(v.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,h,m,g,0,UI(this.format),jI(this.format),t.data)}bind(l,t){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){let{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},r.d0=function(l){return l*l*l*l*l},r.d1=x,r.d2=45,r.d3=_g,r.d4=function(l,t,s){let u=Math.sqrt(l*l+t*t+s*s),h=u>0?Math.acos(s/u)*Wu:0,m=l!==0||t!==0?Math.atan2(-t,-l)*Wu+90:0;return m<0&&(m+=360),[u,m,h]},r.d5=yr,r.d6=gn,r.d7=q,r.d8=Wr,r.d9=jt,r.dA=function(l){return l({pluginStatus:ms,pluginURL:ic}),Zm.on("pluginStateChange",l),l},r.dB=Up,r.dC=class extends sc{constructor(l){super(l),this.current=vg}set(l,t,s){if(this.fetchUniformLocation(l,t)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},r.dD=Zu,r.dE=function(l,t,s){let u=_h(s.zoom),h=l.style.map._antialias,m=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!h&&!m},r.dF=function(l){let t=l.pixelsPerMeter,s=t/M(1,l.center.lat),u=ht(new Float64Array(16));return Xt(u,u,[l.point.x,l.point.y,0]),Vn(u,u,[s,s,t]),Float32Array.from(u)},r.dG=T1,r.dH=function(l){let t=N-5;l=G(l,-t,t)/t*90;let s=Math.pow(Math.abs(Math.sin(Zn(l))),3);return Math.round(s*(D0.length-1))},r.dI=function(l,t,s,u){let h=t.getNorth(),m=t.getSouth(),g=t.getWest(),v=t.getEast(),b=1<<l.z,C=v-g,T=h-m,I=C/ph,D=-T/D0[s],O=[0,I,0,D,0,0,h,g,0];if(l.z>0){let R=180/u;Se(O,O,[R/C+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/D,1])}return O[2]=b,O[5]=l.x,O[8]=l.y,O},r.dJ=Ja,r.dK=function(l,t,s){let u=ht(new Float64Array(16)),h=(t/(1<<l)-.5)*Math.PI*2;return $i(u,s.globeMatrix,h),Float32Array.from(u)},r.dL=VR,r.dM=Il,r.dN=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},r.dO=X,r.dP=function(l,t){var s=Math.sin(t),u=Math.cos(t);return l[0]=u,l[1]=s,l[2]=0,l[3]=-s,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},r.dQ=Bc,r.dR=TR,r.dS=Gn,r.dT=cr,r.dU=256,r.dV=function(l,t){let s=[0,0,0];return Fr(s,s,M1(Ja(t.canonical))),Fr(s,s,l),s},r.dW=l=>({u_matrix:new jp(l),u_texsize:new Tl(l),u_pixels_to_tile_units:new yg(l),u_device_pixel_ratio:new Kr(l),u_width_scale:new Kr(l),u_floor_width_scale:new Kr(l),u_image:new gg(l),u_units_to_pixels:new Tl(l),u_tile_units_to_pixels:new Kr(l),u_alpha_discard_threshold:new Kr(l),u_trim_offset:new Tl(l),u_trim_fade_range:new Tl(l),u_trim_color:new _g(l),u_zbias_factor:new Kr(l),u_tile_to_meter:new Kr(l),u_ground_shadow_factor:new Vp(l),u_pattern_transition:new Kr(l)}),r.dX=l=>({u_matrix:new jp(l),u_pixels_to_tile_units:new yg(l),u_device_pixel_ratio:new Kr(l),u_width_scale:new Kr(l),u_floor_width_scale:new Kr(l),u_units_to_pixels:new Tl(l),u_dash_image:new gg(l),u_gradient_image:new gg(l),u_image_height:new Kr(l),u_texsize:new Tl(l),u_tile_units_to_pixels:new Kr(l),u_alpha_discard_threshold:new Kr(l),u_trim_offset:new Tl(l),u_trim_fade_range:new Tl(l),u_trim_color:new _g(l),u_zbias_factor:new Kr(l),u_tile_to_meter:new Kr(l),u_ground_shadow_factor:new Vp(l)}),r.dY=l=>({u_camera_to_center_distance:new Kr(l),u_extrude_scale:new yg(l),u_device_pixel_ratio:new Kr(l),u_matrix:new jp(l),u_inv_rot_matrix:new jp(l),u_merc_center:new Tl(l),u_tile_id:new Vp(l),u_zoom_transition:new Kr(l),u_up_dir:new Vp(l),u_emissive_strength:new Kr(l)}),r.dZ=ag,r.d_=o$,r.da=dl,r.db=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},r.dc=Gk,r.dd=YI,r.de=Xk,r.df=xM,r.dg=function(l,t){return l.readFields(rH,{icons:[]},t)},r.dh=B1,r.di=Og,r.dj=cM,r.dk=lm,r.dl=kp,r.dm=Hd,r.dn=um,r.dp=Xe,r.dq=function(l){let t=l.indexOf(hd);return t>=0?l.slice(0,t):l},r.dr=function(l){return l.indexOf(hd)>=0},r.ds=function(l){let t=l.lastIndexOf(hd);return t>=0?l.slice(t+1):""},r.dt=function(l){let t=[],s=l.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},r.du=function(l,t,s,u){return l.type==="custom"?new K$(l,t):new nH[l.type](l,t,s,u)},r.dv=ut,r.dw=function(l){let t=l.indexOf(hd);return t>=0?l.slice(t+1):""},r.dx=class extends Jp{constructor(l,t){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){let l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},r.dy=Zm,r.dz=Ju,r.e=kn,r.e$=Ji,r.e0=AR,r.e1=(l,t,s,u,h,m)=>{let g=l.transform,v=g.projection.name==="globe",b;if(m.paint.get("circle-pitch-alignment")==="map")if(v){let T=TR(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([T,0,0,T])}else b=g.calculatePixelsToTileUnitsMatrix(s);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let C={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(g.projection),u_matrix:l.translatePosMatrix(t.projMatrix,s,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ho.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:b6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){C.u_inv_rot_matrix=u,C.u_merc_center=h,C.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],C.u_zoom_transition=_h(g.zoom);let T=h[0]*vt,I=h[1]*vt;C.u_up_dir=g.projection.upVector(new Ti(0,0,0),T,I)}return C},r.e2=hF,r.e3=ps,r.e4=(l,t,s,u,h,m,g,v,b,C)=>{let T=l.transform,I=T.pitch<15?cF(.07,.7,G((14-T.zoom)/5,0,1)):.07,D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dF(l,t,s,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:uF(t,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:I,u_tile_to_meter:q(t.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:C}},r.e5=(l,t,s,u,h,m,g,v,b,C)=>{let T=l.transform,I=T.calculatePixelsToTileUnitsMatrix(t),D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",O=T.pitch<15?cF(.07,.7,G((14-T.zoom)/5,0,1)):.07;return{u_matrix:dF(l,t,s,u),u_pixels_to_tile_units:I,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:pF(s)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uF(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:O,u_tile_to_meter:q(t.tileID.canonical,0),u_ground_shadow_factor:C}},r.e6=ze,r.e7=P0,r.e8=F,r.e9=Ma,r.eA=function(l,t){var s=2*Math.acos(t[3]),u=Math.sin(s/2);return u>E?(l[0]=t[0]/u,l[1]=t[1]/u,l[2]=t[2]/u):(l[0]=1,l[1]=0,l[2]=0),s},r.eB=CM,r.eC=q1,r.eD=G1,r.eE=[1,1,1],r.eF=Lg,r.eG=Uu,r.eH=function(l,t,s,u){var h=t[0],m=t[1],g=t[2],v=t[3];return l[0]=h+u*(s[0]-h),l[1]=m+u*(s[1]-m),l[2]=g+u*(s[2]-g),l[3]=v+u*(s[3]-v),l},r.eI=Ig,r.eJ=ta,r.eK=Sl,r.eL=function(l,t,s,u,h,m,g,v,b,C,T,I,D,O,R,B){var H=new P(16);return H[0]=l,H[1]=t,H[2]=s,H[3]=u,H[4]=h,H[5]=m,H[6]=g,H[7]=v,H[8]=b,H[9]=C,H[10]=T,H[11]=I,H[12]=D,H[13]=O,H[14]=R,H[15]=B,H},r.eM=p,r.eN=dh,r.eO=y0,r.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ot(1/0,1/0),max:new ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){let s=sk(new ot(0,0),new ot(vt,vt),l),u=[];if(t&&!DI(s,this._globalClipBounds))return u;for(let h of this._activeRegions){if(h.hiddenByOverlap||!DI(s,h))continue;let m=X6(h.min,h.max,l);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{let s=[];for(let u of t.cache.getVisibleCoordinates()){let h=t.cache.getTile(u).buckets[t.layer];h&&h.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){let t=l.getFootprints();if(t.length===0)return;let s=l.getOrder(),u=l.getClipMask(),h=l.getClipScope();for(let m of t){if(!m.footprint)continue;let g=sk(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:s,clipMask:u,clipScope:h})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,s)=>t.priority-s.priority||R1(t.min,s.min)||R1(t.max,s.max)||t.order-s.order||t.clipMask-s.clipMask||(function(u,h){let m=(g,v)=>g+v;return u.length-h.length||u.reduce(m,"").localeCompare(h.reduce(m,""))})(t.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){let s=this._activeRegions[t],u=this._prevRegions[t];l=s.priority!==u.priority||!ok(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Yl(s.clipScope,u.clipScope),this._activeRegions[t].hiddenByOverlap=u.hiddenByOverlap,++t}}if(l){++this._updateTime;for(let s of this._activeRegions)s.order!==N0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));let t=s=>{let u=this._activeRegions;if(s>=u.length)return s;let h=u[s].priority;for(;s<u.length&&u[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,u=t(s);for(;s!==u;){let h=s,m=s;for(;h!==u;){let g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let v=0;v<m;v++){let b=this._activeRegions[v];if(!b.hiddenByOverlap&&g.order===N0&&DI(g,b)&&(g.hiddenByOverlap=ak(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++h}s=u,u=t(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},r.eQ=N0,r.eR=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let l of this._poleSegments)l.destroy();for(let l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){let s=new ru,u=new Xr,h=[],m=l+1+2,g=t[0]+1,v=t[0]+1+(1+t.length),b=(C,T,I)=>{let D=C===m-1?C-2:C===0?C:C-1;return D+=I?24575:0,[D,T]};for(let C=0;C<m;++C)s.emplaceBack(...b(C,0,!0));for(let C=0;C<g;++C)for(let T=0;T<m;++T)s.emplaceBack(...b(T,C,(T===0||T===m-1)&&!0));for(let C=0;C<t.length;++C){let T=t[C];for(let I=0;I<m;++I)s.emplaceBack(...b(I,T,!0))}for(let C=0;C<t.length;++C){let T=u.length,I=t[C]+1+2,D=new Xr;for(let B=0;B<I-1;B++){let H=B===I-2,$=H?m*(v-t.length+C-B):m;for(let Y=0;Y<m-1;Y++){let Q=B*m+Y;B===0||H||Y===0||Y===m-2?(D.emplaceBack(Q+1,Q,Q+$),D.emplaceBack(Q+$,Q+$+1,Q+1)):(u.emplaceBack(Q+1,Q,Q+$),u.emplaceBack(Q+$,Q+$+1,Q+1))}}let O=nr.simpleSegment(0,T,s.length,u.length-T);for(let B=0;B<D.uint16.length;B+=3)u.emplaceBack(D.uint16[B],D.uint16[B+1],D.uint16[B+2]);let R=nr.simpleSegment(0,T,s.length,u.length-T);h.push({withoutSkirts:O,withSkirts:R})}return{vertices:s,indices:u,segments:h}}_createGrid(l){let t=this._fillGridMeshWithLods(ph,D0);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,mh.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){let t=new Xr;for(let g=0;g<=ph;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);let s=new fd,u=new fd,h=new fd,m=new fd;this._poleSegments=[];for(let g=0,v=0;g<Ea;g++){let b=360/(1<<g);s.emplaceBack(0,-Yo,0,.5,0),u.emplaceBack(0,-Yo,0,.5,1),h.emplaceBack(0,-Yo,0,.5,.5),m.emplaceBack(0,-Yo,0,.5,.5);for(let C=0;C<=ph;C++){let T=C/ph,I=0,D=on(0,b,T),[O,R,B]=md(y6,x6,D,Yo);s.emplaceBack(O,R,B,T,I),u.emplaceBack(O,R,B,T,1-I);let H=Zn(D);T=.5+.5*Math.sin(H),I=.5+.5*Math.cos(H),h.emplaceBack(O,R,B,T,I),m.emplaceBack(O,R,B,T,1-I)}this._poleSegments.push(nr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,Qa,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,Qa,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(h,Qa,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(m,Qa,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},r.eS=ik,r.eT=sp,r.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eV=Re,r.eW=W,r.eX=function(l,t,s){return l[0]=t[0]/s[0],l[1]=t[1]/s[1],l[2]=t[2]/s[2],l},r.eY=bv,r.eZ=fh,r.e_=em,r.ea=L1,r.eb=Ck,r.ec=_d,r.ed=pk,r.ee=hk,r.ef=U,r.eg=function(l,t){if(l===t){var s=t[1],u=t[2],h=t[3],m=t[6],g=t[7],v=t[11];l[1]=t[4],l[2]=t[8],l[3]=t[12],l[4]=s,l[6]=t[9],l[7]=t[13],l[8]=u,l[9]=m,l[11]=t[14],l[12]=h,l[13]=g,l[14]=v}else l[0]=t[0],l[1]=t[4],l[2]=t[8],l[3]=t[12],l[4]=t[1],l[5]=t[5],l[6]=t[9],l[7]=t[13],l[8]=t[2],l[9]=t[6],l[10]=t[10],l[11]=t[14],l[12]=t[3],l[13]=t[7],l[14]=t[11],l[15]=t[15];return l},r.eh=X$,r.ei=An,r.ej=b0,r.ek=256,r.el=vI,r.em=ea,r.en=$i,r.eo=function(l,t){return l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[4],l[4]=t[5],l[5]=t[6],l[6]=t[8],l[7]=t[9],l[8]=t[10],l},r.ep=fd,r.eq=Wb,r.er=v0,r.es=function(l,t,s,u,h){return G((l-t)/(s-t)*(h-u)+u,u,h)},r.et=Wl,r.eu=function(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],C=t[7],T=t[8],I=T*g-v*C,D=-T*m+v*b,O=C*m-g*b,R=s*I+u*D+h*O;return R?(l[0]=I*(R=1/R),l[1]=(-T*u+h*C)*R,l[2]=(v*u-h*g)*R,l[3]=D*R,l[4]=(T*s-h*b)*R,l[5]=(-v*s+h*m)*R,l[6]=O*R,l[7]=(-C*s+u*b)*R,l[8]=(g*s-u*m)*R,l):null},r.ev=2,r.ew=zc,r.ex=ql,r.ey=Ys,r.ez=function(l,t){var s=new P(3);Ys(s,t);var u=1/s[0],h=1/s[1],m=1/s[2],g=t[0]*u,v=t[1]*h,b=t[2]*m,C=t[4]*u,T=t[5]*h,I=t[6]*m,D=t[8]*u,O=t[9]*h,R=t[10]*m,B=g+T+R,H=0;return B>0?(H=2*Math.sqrt(B+1),l[3]=.25*H,l[0]=(I-O)/H,l[1]=(D-b)/H,l[2]=(v-C)/H):g>T&&g>R?(H=2*Math.sqrt(1+g-T-R),l[3]=(I-O)/H,l[0]=.25*H,l[1]=(v+C)/H,l[2]=(D+b)/H):T>R?(H=2*Math.sqrt(1+T-g-R),l[3]=(D-b)/H,l[0]=(v+C)/H,l[1]=.25*H,l[2]=(I+O)/H):(H=2*Math.sqrt(1+R-g-T),l[3]=(v-C)/H,l[0]=(D+b)/H,l[1]=(I+O)/H,l[2]=.25*H),l},r.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(+("0x"+s))))},r.f0=function([l,t,s]){let u=Math.hypot(l,t,s),h=Math.atan2(l,s),m=.5*Math.PI-Math.acos(-t/u);return new c(os(h),os(m))},r.f1=jc,r.f2=HI,r.f3=function(l){let t=l.navigator?l.navigator.userAgent:null;return!!(function(s){if(Vr==null){let u=s.navigator?s.navigator.userAgent:null;Vr=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Vr})(l)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f4=function(l,t){rm=l,om=t},r.f5=xI,r.f6=MR,r.f7=function(l){let t=[0,0,0],s=ht(new Float64Array(16));return Mt(s,l.pixelMatrix,l.globeMatrix),Fr(t,t,s),new ot(t[0],t[1])},r.f8=function(){let l=$0;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(FI),$0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f9=function(){B1().acquire(FI)},r.fA=vw,r.fB=Ce,r.fC=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==Vk){let s=new Uint32Array(l,0,7),[,,u,h,m,g]=s;t=s.byteLength+h+m+g+m,(u!==l.byteLength||t>=l.byteLength)&&At("Invalid b3dm header information.")}return Hk(l,t)},r.fD=function(l,t){let s=YI(l);for(let u of s){for(let h of u.meshes)I8(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(M8(u.lights,t)))}return s},r.fE=hw,r.fF=Un,r.fG=Fk,r.fH=rc,r.fI=Vs,r.fJ=function(l){qa(),ml?.then(t=>{t.keys().then(s=>{for(let u=0;u<s.length-l;u++)t.delete(s[u]).catch(h=>At(h.message))}).catch(s=>At(s.message))}).catch(t=>At(t.message))},r.fa=Fp,r.fb=function(l,t,s=!1){if(ms===Vs.deferred||ms===Vs.loading||ms===Vs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ic=ho.resolveURL(l),ms=Vs.deferred,l0=t,Wm(),s||o1()},r.fc=function(l){Eg=ho.resolveURL(l),Sg||(Sg=new Cg(B1(),new ed)),Sg.broadcast("setMeshoptUrl",Eg)},r.fd=zk,r.fe=function(l){zI=ho.resolveURL(l),Sg||(Sg=new Cg(B1(),new ed)),Sg.broadcast("setDracoUrl",zI)},r.ff=Nk,r.fg=j0,r.fh=function(l){let t=Ga();if(!t)return;let s=t.delete(im);l&&s.then(()=>l()).catch(l)},r.fi=z1,r.fj=Lt,r.fk=vh,r.fl=mc,r.fm=iN,r.fn=rN,r.fo=oF,r.fp=Ge,r.fq="hd_road_elevation",r.fr=ii,r.fs=Ne,r.ft=gd,r.fu=lM,r.fv=Kp,r.fw=function(l,t,s,u,h,m,g,v=1,b,C,T){l.createArrays(),l.tilePixelRatio=vt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;let I=l.layers[0].layout,D=l.layers[0]._unevaluatedLayout._values,O={};O.scaleFactor=v,O.textSizeScaleRange=I.get("text-size-scale-range"),O.iconSizeScaleRange=I.get("icon-size-scale-range");let[R,B]=O.textSizeScaleRange,[H,$]=O.iconSizeScaleRange;O.textScaleFactor=G(O.scaleFactor,R,B),O.iconScaleFactor=G(O.scaleFactor,H,$);let Y=D["text-size"],Q=D["icon-size"];if(l.textSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=l.textSizeData;O.compositeTextSizes=[Y.possiblyEvaluate(new Vi(we,{worldview:T}),m),Y.possiblyEvaluate(new Vi(je,{worldview:T}),m)]}if(l.iconSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=l.iconSizeData;O.compositeIconSizes=[Q.possiblyEvaluate(new Vi(we,{worldview:T}),m),Q.possiblyEvaluate(new Vi(je,{worldview:T}),m)]}O.layoutTextSize=Y.possiblyEvaluate(new Vi(g+1,{worldview:T}),m),O.layoutIconSize=Q.possiblyEvaluate(new Vi(g+1,{worldview:T}),m),O.textMaxSize=Y.possiblyEvaluate(new Vi(18,{worldview:T}),m);let ie=I.get("symbol-placement"),he=I.get("text-rotation-alignment")==="map"&&ie!=="point",le=I.get("text-size"),me=!1,ye=[];for(let we of l.features){let je=I.get("text-font").evaluate(we,{},m).join(","),Ie=le.evaluate(we,{},m)*O.textScaleFactor,We=O.layoutTextSize.evaluate(we,{},m)*O.textScaleFactor,Ke=O.layoutIconSize.evaluate(we,{},m)*O.iconScaleFactor,Qe={horizontal:{},vertical:void 0},st=we.text,lt,nt=[0,0];if(st){let _n=st.toString(),gi=I.get("text-letter-spacing").evaluate(we,{},m)*fo,ce=I.get("text-line-height").evaluate(we,{},m)*fo,pe=s0(_n)?gi:0,Ze=I.get("text-anchor").evaluate(we,{},m),at=I.get("text-variable-anchor");if(!at){let mn=I.get("text-radial-offset").evaluate(we,{},m);if(mn)nt=UF(Ze,[mn*fo,dM]);else{let Cn=I.get("text-offset").evaluate(we,{},m);nt=[Cn[0]*fo,Cn[1]*fo]}}let Et=he?"center":I.get("text-justify").evaluate(we,{},m),St=ie==="point",Wt=St?I.get("text-max-width").evaluate(we,{},m)*fo:1/0,Yt=mn=>{l.allowVerticalPlacement&&Rp(_n)&&(Qe.vertical=iM(st,t,s,h,je,Wt,ce,Ze,mn,pe,nt,ra.vertical,!0,We,Ie,b))};if(!he&&at){let mn=Et==="auto"?at.map(Tn=>hM(Tn)):[Et],Cn=!1;for(let Tn=0;Tn<mn.length;Tn++){let Pn=mn[Tn];if(!Qe.horizontal[Pn])if(Cn)Qe.horizontal[Pn]=Qe.horizontal[0];else{let rn=iM(st,t,s,h,je,Wt,ce,"center",Pn,pe,nt,ra.horizontal,!1,We,Ie,b);rn&&(Qe.horizontal[Pn]=rn,Cn=rn.positionedLines.length===1)}}Yt("left")}else{if(Et==="auto"&&(Et=hM(Ze)),St||I.get("text-writing-mode").indexOf("horizontal")>=0||!Rp(_n)){let mn=iM(st,t,s,h,je,Wt,ce,Ze,Et,pe,nt,ra.horizontal,!1,We,Ie,b);mn&&(Qe.horizontal[Et]=mn)}Yt(St?"left":Et)}}let it,qe,He,rt,yt,ft,qt=!1,It=I.get("icon-text-fit").evaluate(we,{},m);if(we.icon&&we.icon.hasPrimary()){let _n=J0(we.icon,l.iconSizeData,D["icon-size"],m,l.zoom,we,b,O.iconScaleFactor,T);it=_n.iconPrimary,He=_n.iconSecondary;let gi=it.toString();if(qe=u.get(gi),qe&&(yt=I.get("icon-offset").evaluate(we,{},m),ft=I.get("icon-anchor").evaluate(we,{},m),lt=K1(h.get(gi),He?h.get(He.toString()):void 0,yt,ft),qt=qe.sdf,l.sdfIcons===void 0?l.sdfIcons=qe.sdf:l.sdfIcons!==qe.sdf&&At("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==l.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),He){let ce=He.toString();rt=u.get(ce)}}me=me||!(!we.icon||!we.icon.hasSecondary());let Ot=nw(Qe.horizontal)||Qe.vertical;l.iconsInText||(l.iconsInText=!!Ot&&Ot.iconsInText);let Bt=We*O.textScaleFactor/fo,{defaultShapedIcon:In,verticallyShapedIcon:mt}=L$(l,lt,I,we,m,Qe,Bt,yt,It);It!=="none"&&lt&&(TF(lt)||IF(lt))&&(tw(0,qe,it,lt,In,It,C,u,h),tw(0,rt,He,lt,In,It,C,u,h),mt&&(tw(0,qe,it,lt,mt,It,C,u,h),tw(0,rt,He,lt,mt,It,C,u,h))),lt=In;let{iconBBox:Vt,iconVerticalBBox:un,textBBox:Ln,textVerticalBBox:zn}=P$(l,lt,mt,I,we,m,Ke,yt,O,h,ft,Qe,We,nt);ye.push({feature:we,shapedTextOrientations:Qe,shapedText:Ot,shapedIcon:lt,iconPrimary:it,iconSecondary:He,iconOffset:yt,iconAnchor:ft,verticallyShapedIcon:mt,layoutTextSize:We,layoutIconSize:Ke,textOffset:nt,isSDFIcon:qt,iconTextFit:It,iconCollisionBounds:Vt,iconVerticalCollisionBounds:un,textCollisionBounds:Ln,textVerticalCollisionBounds:zn})}return{featureData:ye,sizes:O,hasAnySecondaryIcon:me,textAlongLine:he,symbolPlacement:ie}},r.fx=FF,r.fy=function(l,t,s,u,h,m,g,v,b,C){l.iconAtlasPositions=C.iconPositions;let{featureData:T,hasAnySecondaryIcon:I,sizes:D,textAlongLine:O,symbolPlacement:R}=t;for(let B of T){let{shapedIcon:H,verticallyShapedIcon:$,feature:Y,shapedTextOrientations:Q,shapedText:ie,layoutTextSize:he,textOffset:le,isSDFIcon:me,iconPrimary:ye,iconSecondary:we,iconTextFit:je,iconOffset:Ie,iconCollisionBounds:We,iconVerticalCollisionBounds:Ke,textCollisionBounds:Qe}=B;$F(H,C.iconPositions,ye,we),$F($,C.iconPositions,ye,we),F$(Q,C.iconPositions),k$(ye,we,C.iconPositions),(ie||H)&&N$(l,Y,Q,H,$,b,D,he,0,le,me,u,h,g,v,I,je,Ie,O,R,We,Ke,Qe)}s&&l.generateCollisionDebugBuffers(m,l.collisionBoxArray,D.textScaleFactor)},r.fz=Fe,r.g=function(l,t){return Ju(Object.assign(l,{method:"GET"}),t)},r.h=function(l){return l.indexOf("mapbox:")===0},r.i=function(l){return kn.API_STYLE_REGEX.test(l)&&!ko(l)},r.j=br,r.k=gl,r.l=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(l,t){return Ju(Object.assign(l,{type:"json"}),t)},r.n=cm,r.o=ho,r.p=function(l,t){return Ju(Object.assign(l,{method:"POST"}),t)},r.q=Qo,r.r=fl,r.s=function(l){try{let t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return LI||(LI=new z1("ImageRasterizer")),LI},r.u=function(){return(function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)})()},r.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},r.w=At,r.x=DM,r.y=hp,r.z=_l}),a(["./shared"],function(r){function E(Re){let G=Re?Re.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function P(Re){if(typeof Re=="number"||typeof Re=="boolean"||typeof Re=="string"||Re==null)return JSON.stringify(Re);if(Array.isArray(Re)){let K="[";for(let se of Re)K+=`${P(se)},`;return`${K}]`}let G="{";for(let K of Object.keys(Re).sort())G+=`${K}:${P(Re[K])},`;return`${G}}`}function k(Re){let G="";for(let K of r.bx)G+=`/${P(Re[K])}`;return G}class X{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,se){this._options=se;for(let ve of G)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=r.du(ve,this.scope,null,this._options)).compileFilter(se),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(let ve of K)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};let xe=(function(ve,Ee){let ze={};for(let Ne=0;Ne<ve.length;Ne++){let ut=ve[Ne],Xe=Ee&&Ee[ut.id];Xe||(ut.type==="symbol"?Xe=ut.id:(Xe=k(ut),ut.type==="line"&&ut.paint&&(function Qt(At){return typeof At=="string"&&At==="line-progress"||(Array.isArray(At)?At.some(Qt):!(!At||typeof At!="object")&&Object.values(At).some(Qt))})(ut.paint["line-width"])&&(Xe+=`/${P(ut.paint["line-width"])}`))),Ee&&(Ee[ut.id]=Xe);let kt=ze[Xe];kt||(kt=ze[Xe]=[]),kt.push(ut)}let Pe=[];for(let Ne in ze)Pe.push(ze[Ne]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(let ve of xe){let Ee=ve.map(kt=>this._layers[kt.id]),ze=Ee[0];if(ze.visibility==="none")continue;let Pe=ze.source||"",Ne=this.familiesBySource[Pe];Ne||(Ne=this.familiesBySource[Pe]={});let ut=ze.sourceLayer||"_geojsonTileLayer",Xe=Ne[ut];Xe||(Xe=Ne[ut]=[]),Xe.push(Ee)}}}let oe=1*r.fl;class Se{constructor(G){let K={},se=[];for(let ze in G){let Pe=G[ze],Ne=K[ze]={};for(let ut in Pe.glyphs){let Xe=Pe.glyphs[+ut];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let kt=Xe.metrics.localGlyph?oe:1,Qt={x:0,y:0,w:Xe.bitmap.width+2*kt,h:Xe.bitmap.height+2*kt};se.push(Qt),Ne[ut]=Qt}}let{w:xe,h:ve}=r.G(se),Ee=new r.fk({width:xe||1,height:ve||1});for(let ze in G){let Pe=G[ze];for(let Ne in Pe.glyphs){let ut=Pe.glyphs[+Ne];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let Xe=K[ze][Ne],kt=ut.metrics.localGlyph?oe:1;r.fk.copy(ut.bitmap,Ee,{x:0,y:0},{x:Xe.x+kt,y:Xe.y+kt},ut.bitmap)}}this.image=Ee,this.positions=K}}function $e(Re,G,K){Re[G]?K&&(Re[G].center=K):Re[G]={floorIds:new Set,center:K||[0,0],floors:{}}}function ke(Re,G,K,se){for(let xe of G)$e(Re,xe),Re[xe].floors[K]=se,Re[xe].floorIds.add(K)}function ht(Re){return{id:Re.properties.id.toString(),center:Re.properties.center.toString().split(";").map(Number)}}function Nt(Re){return{id:Re.properties.id.toString(),isDefault:!!Re.properties.is_default&&Re.properties.is_default,connections:Re.properties.connected_floor_ids?new Set(Re.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Re.properties.conflicted_floor_ids?new Set(Re.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Re.properties.building_ids?new Set(Re.properties.building_ids.toString().split(";")):new Set,name:Re.properties.name.toString(),zIndex:Re.properties.z_index}}function Mt(Re,G){return G.every(K=>Re.properties&&Re.properties[K]!=null)}function Xt(Re){return Mt(Re,["type","id","name"])&&Re.properties.type==="building"}function Vn(Re){return Mt(Re,["type","id","name","z_index"])&&Re.properties.type==="floor"}r.fj(Se,"GlyphAtlas");class sr{constructor(G){this.tileID=new r.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=r.aZ(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor,this.worldview=G.worldview,this.indoor=G.indoor}parse(G,K,se,xe,ve,Ee){this.status="parsing",this.data=G,this.collisionBoxArray=new r.b3;let ze=new r.fm(Object.keys(G.layers).sort()),Pe=new r.fn(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];let Ne={},ut=new r.fo(256,256),Xe={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ut,availableImages:se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){let xn=this.indoor.indoorState.activeFloorsVisible,vn=(function(gn,Un,mr){let Vr=(function(lr,Gn){if(!lr)return r.w("No source layers defined in indoor specification"),Gn;if(lr.size===0)return Gn;let cr=lr.difference(Gn);for(let Pi of cr)r.w(`Missing source layer required in indoor specification: ${Pi}`);return Gn.intersection(Gn)})(Un.sourceLayers,new Set(Object.keys(gn.layers))),xr=Un.indoorState,Zr=(function(lr,Gn,cr,Pi){let kn=new Set,br=new Set,ko=new Set,Wo=new Map,Ss={},Yu=wo=>{let Ks=Wo.get(wo)||new Set;for(let ss of kn)if((Wo.get(ss)||new Set).has(wo)||Ks.has(ss))return!0;return!1};for(let wo of Gn){let Ks=lr.layers[wo];if(Ks)for(let ss=0;ss<Ks.length;ss++){let fl=Ks.feature(ss);if(Xt(fl)){let{id:ho,center:Xu}=ht(fl);$e(Ss,ho,Xu),kn.add(ho)}else if(Vn(fl)){let{id:ho,isDefault:Xu,connections:Hd,conflicts:im,buildings:rm,name:om,zIndex:ap}=Nt(fl);ke(Ss,rm,ho,{name:om,zIndex:ap}),Wo.set(ho,im),(ho===Pi||Hd.has(Pi))&&kn.add(ho),br.add(ho),Xu&&ko.add(ho)}}else r.w(`indoor source layer not found: ${wo}`)}if(cr)for(let wo of cr)br.has(wo)&&(Yu(wo)||kn.add(wo));for(let wo of ko)kn.has(wo)||Yu(wo)||kn.add(wo);return{buildings:Ss,activeFloors:kn}})(gn,Vr,xr.lastActiveFloors,xr.selectedFloorId);return mr.send("setIndoorData",Zr),Zr})(G,this.indoor,ve);Xe.activeFloors=xn?vn.activeFloors:void 0}let kt=[],Qt=K.familiesBySource[this.source];for(let xn in Qt){let vn=G.layers[xn];if(!vn)continue;let gn=!1,Un=!1,mr=!1;for(let Gn of Qt[xn])Gn[0].type==="symbol"?gn=!0:Un=!0,Gn[0].is3D()&&Gn[0].type!=="model"&&(mr=!0);if(this.extraShadowCaster&&!mr||this.isSymbolTile===!0&&!gn||this.isSymbolTile===!1&&!Un)continue;vn.version===1&&r.w(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Vr=ze.encode(xn),xr=[],Zr=this.localizableLayerIds&&this.localizableLayerIds.has(xn),lr=!1;for(let Gn=0,cr=0;Gn<vn.length;Gn++){let Pi=vn.feature(Gn),kn=Pe.getId(Pi,xn),br=Pi.properties?Pi.properties.worldview:null;if(Zr&&this.worldview&&typeof br=="string")if(br==="all")Pi.properties.$localized=!0;else{if(!br.split(",").includes(this.worldview))continue;Pi.properties.$localized=!0,Pi.properties.worldview=this.worldview}!lr&&Pi.properties&&Pi.properties.hasOwnProperty(r.fp)&&(lr=!0),xr.push({feature:Pi,id:kn,index:cr,sourceLayerIndex:Vr}),cr++}lr&&!Xe.elevationFeatures&&G.layers.hasOwnProperty(r.fq)&&(Xe.elevationFeatures=r.fr.parseFrom(G.layers[r.fq],this.canonical));for(let Gn of Qt[xn]){let cr=Gn[0];if(this.extraShadowCaster&&(!cr.is3D()||cr.type==="model")||this.isSymbolTile!==void 0&&cr.type==="symbol"!==this.isSymbolTile||cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility==="none")continue;$i(Gn,this.zoom,Xe.brightness,se,this.worldview);let Pi=Ne[cr.id]=cr.createBucket({index:Pe.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview,localizable:Zr});Pe.bucketLayerIDs.push(Gn.map(br=>r.B(br.id,br.scope)));let kn=Pi.prepare?Pi.prepare():null;kn!=null?(kn=kn.then(()=>Pi.populate(xr,Xe,this.tileID.canonical,this.tileTransform)),kt.push(kn)):Pi.populate(xr,Xe,this.tileID.canonical,this.tileTransform)}}let At=()=>{let xn,vn,gn,Un,mr,Vr;ut.trim();let xr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Zr=()=>{if(xn)return this.status="done",Ee(xn);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:Object.values(Ne).filter(Gn=>!Gn.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(vn&&gn&&Un){let Gn=new Se(vn),cr=new Map;for(let[br,ko]of gn.entries()){let{imagePosition:Wo}=r.fu(br,ko,r.fv);cr.set(br,Wo)}let Pi={};for(let br in Ne){let ko=Ne[br];ko instanceof r.b4&&($i(ko.layers,this.zoom,Xe.brightness,se,this.worldview),Pi[br]=r.fw(ko,vn,Gn.positions,gn,cr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,mr,this.worldview))}let kn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,gn,mr,()=>{kn.iconsPending=!1,lr(Pi,Gn,kn)}),this.rasterizeIfNeeded(ve,Un,Vr,()=>{kn.patternsPending=!1,lr(Pi,Gn,kn)})}},lr=(Gn,cr,Pi,kn)=>{if(Pi.iconsPending||Pi.patternsPending)return;let br=new r.fx(gn,Un,this.lut);for(let ko in Ne){let Wo=Ne[ko];if(ko in Gn)r.fy(Wo,Gn[ko],this.showCollisionBoxes,se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gn,br);else if(Wo.hasPattern&&(Wo instanceof r.ba||Wo instanceof r.bb||Wo instanceof r.ea)){$i(Wo.layers,this.zoom,Xe.brightness,se,this.worldview);let Ss=Object.fromEntries(br.patternPositions);Wo.addFeatures(Xe,this.tileID.canonical,Ss,se,this.tileTransform,this.brightness)}}this.status="done",Ee(null,{buckets:Object.values(Ne).filter(ko=>!ko.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cr.image,lineAtlas:ut,imageAtlas:br,brightness:Xe.brightness})};if(!this.extraShadowCaster){let Gn=r.fs(Xe.glyphDependencies,kn=>Object.keys(kn).map(Number));Object.keys(Gn).length?ve.send("getGlyphs",{uid:this.uid,stacks:Gn},(kn,br)=>{xn||(xn=kn,vn=br,Zr())},void 0,!1,xr):vn={};let cr=Array.from(Xe.iconDependencies.keys()).map(kn=>r.I.parse(kn));cr.length?ve.send("getImages",{images:cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(kn,br)=>{xn||(xn=kn,gn=new Map,mr=this.updateImageMapAndGetImageTaskQueue(gn,br,Xe.iconDependencies),Zr())},void 0,!1,xr):(gn=new Map,mr=new Map);let Pi=Array.from(Xe.patternDependencies.keys()).map(kn=>r.I.parse(kn));Pi.length?ve.send("getImages",{images:Pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(kn,br)=>{xn||(xn=kn,Un=new Map,Vr=this.updateImageMapAndGetImageTaskQueue(Un,br,Xe.patternDependencies),Zr())},void 0,!1,xr):(Un=new Map,Vr=new Map)}if(Xe.elevationFeatures&&Xe.elevationFeatures.length>0){let Gn=[];for(let Pi of Object.values(Ne))if(Pi instanceof r.bb){let kn=Pi.getUnevaluatedPortalGraph();kn&&Gn.push(kn)}let cr=r.ft.evaluate(Gn);for(let Pi of Object.values(Ne))if(Pi instanceof r.bb){let kn=G.layers[ze.decode(Pi.sourceLayerIndex)];Pi.setEvaluatedPortalGraph(cr,kn,this.tileID.canonical,Xe.availableImages,Xe.brightness)}}Zr()};kt.length>0?Promise.allSettled(kt).then(At).catch(Ee):At()}updateParameters(G){this.scaleFactor=G.scaleFactor,this.showCollisionBoxes=G.showCollisionBoxes,this.projection=G.projection,this.brightness=G.brightness,this.tileTransform=r.aZ(G.tileID.canonical,G.projection),this.extraShadowCaster=G.extraShadowCaster,this.lut=G.lut,this.worldview=G.worldview,this.indoor=G.indoor}rasterizeIfNeeded(G,K,se,xe){Array.from(K.values()).some(ve=>ve.usvg)?this.rasterize(G,K,se,xe):xe()}updateImageMapAndGetImageTaskQueue(G,K,se){let xe=new Map;for(let ve of K.keys()){let Ee=se.get(ve)||[];for(let ze of Ee){let Pe=ze.toString(),Ne=K.get(ze.id.toString());Ne.usvg?xe.has(Pe)||(xe.set(Pe,ze),G.set(Pe,Object.assign({},Ne))):G.set(Pe,Ne)}}return xe}rasterize(G,K,se,xe){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:se},(ve,Ee)=>{if(!ve)for(let[ze,Pe]of Ee.entries()){let Ne=Object.assign(K.get(ze),{data:Pe});K.set(ze,Ne)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function $i(Re,G,K,se,xe){let ve=new r.ac(G,{brightness:K,worldview:xe});for(let Ee of Re)Ee.recalculate(ve,se)}class Li extends r.E{constructor(G,K,se,xe,ve,Ee,ze){super(),this.actor=G,this.layerIndex=K,this.availableImages=se,this.availableModels=xe,this.loadVectorData=Ee||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(G.scheduler),this.isSpriteLoaded=ve,this.scheduler=G.scheduler,this.brightness=ze}loadTile(G,K){let se=G.uid,xe=G&&G.request,ve=xe&&xe.collectResourceTiming,Ee=this.loading[se]=new sr(G);Ee.abort=this.loadVectorData(G,(ze,Pe)=>{let Ne=!this.loading[se];if(delete this.loading[se],Ee.cancelRasterize(),Ne||ze||!Pe)return Ee.status="done",Ne||(this.loaded[se]=Ee),K(ze);let ut=Pe.rawData,Xe={},kt=r.aM(Pe.responseHeaders);kt&&kt.expires&&(Xe.expires=kt.expires),kt&&kt.cacheControl&&(Xe.cacheControl=kt.cacheControl),Ee.vectorTile=Pe.vectorTile||new r.fz(new r.bt(ut));let Qt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(At,xn)=>{if(At||!xn)return K(At);let vn={};if(ve){let gn=E(xe);gn.length>0&&(vn.resourceTiming=JSON.parse(JSON.stringify(gn)))}K(null,Object.assign({rawTileData:ut.slice(0),responseHeaders:Pe.responseHeaders},xn,Xe,vn))})};this.isSpriteLoaded?Qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Qt()}),this.loaded=this.loaded||{},this.loaded[se]=Ee})}reloadTile(G,K){let se=this.loaded,xe=G.uid;if(se&&se[xe]){let ve=se[xe];ve.updateParameters(G);let Ee=(ze,Pe)=>{let Ne=ve.reloadCallback;Ne&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ne)),K(ze,Pe)};ve.status==="parsing"?ve.reloadCallback=Ee:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ee):Ee())}else K(null,void 0)}abortTile(G,K){let se=G.uid,xe=this.loading[se];xe&&(xe.abort&&xe.abort(),delete this.loading[se]),K()}removeTile(G,K){let se=this.loaded,xe=G.uid;se&&se[xe]&&delete se[xe],K()}}class Or{loadTile(G,K){let{uid:se,encoding:xe,rawImageData:ve,padding:Ee}=G,ze=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Ee):ve;K(null,new r.fA(se,ze,xe,Ee<1))}reloadTile(G,K){K(null,null)}abortTile(G,K){K()}removeTile(G,K){K()}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let se=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}r.bs.setPbf(r.bt);class Ho{constructor(G){this._mrt=new r.bs(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,K){let se=this._mrt;this.status="parsing",this._entireBuffer=G;try{se.parseHeader(G),this._isHeaderLoaded=!0;let xe=[];for(let ve in se.layers){let Ee=se.getLayer(ve),ze=Ee.getDataRange(Ee.getBandList()),Pe=se.createDecodingTask(ze),Ne=G.slice(ze.firstByte,ze.lastByte+1),ut=r.bs.performDecoding(Ne,Pe).then(Xe=>Pe.complete(null,Xe)).catch(Xe=>Pe.complete(Xe,null));xe.push(ut)}Promise.allSettled(xe).then(()=>K(null,se)).catch(ve=>K(ve))}catch(xe){K(xe)}}}class Ys{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,K){let se=G.uid,xe=G.request,ve=this.loading[se]=new Ho(G),{cancel:Ee}=r.bu(xe,(ze,Pe,Ne)=>{let ut=!this.loading[se];if(delete this.loading[se],ut||ze||!Pe)return ve.status="done",ut||(this.loaded[se]=ve),K(ze);ve.parse(Pe,(Xe,kt)=>{if(Xe||!kt)return K(Xe);K(null,kt,Ne)}),this.loaded[se]=ve});ve.abort=Ee}reloadTile(G,K){K(null,void 0)}abortTile(G,K){let se=G.uid,xe=this.loading[se];xe&&(xe.abort&&xe.abort(),delete this.loading[se]),K()}removeTile(G,K){let se=G.uid;this.loaded[se]&&delete this.loaded[se],K()}decodeRasterArray(G,K){r.bs.performDecoding(G.buffer,G.task).then(se=>K(null,se)).catch(se=>K(se))}}let Nu=r.fB.prototype.toGeoJSON;class zu{constructor(G){this._feature=G,this.extent=r.al,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){let G=[];for(let K of this._feature.geometry)G.push([new r.P(K[0],K[1])]);return G}{let G=[];for(let K of this._feature.geometry){let se=[];for(let xe of K)se.push(new r.P(xe[0],xe[1]));G.push(se)}return G}}toGeoJSON(G,K,se){return Nu.call(this,G,K,se)}}class ci{constructor(G,K){this.name=G,this.extent=r.al,this.length=K.length,this._jsonFeatures=K}feature(G){return new zu(this._jsonFeatures[G])}}class Bu{constructor(G){this.layers={},this.extent=r.al;for(let K of Object.keys(G))this.layers[K]=new ci(K,G[K])}}let xo=64/4096,yr=128;class Ji{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(let se of G){let xe=se.id;if(xe==null)continue;let ve=this.features.get(xe);ve&&this.updateCache(ve,K),se.geometry?(ve=dl(se),this.updateCache(ve,K),this.features.set(xe,ve)):this.features.delete(xe),this.updateCache(ve,K)}}updateCache(G,K){for(let{canonical:se,uid:xe}of Object.values(K)){let{z:ve,x:Ee,y:ze}=se;Wr(G,Math.pow(2,ve),Ee,ze)&&delete K[xe]}}getTile(G,K,se){let xe=Math.pow(2,G),ve=[];for(let Ee of this.features.values())Wr(Ee,xe,K,se)&&ve.push(fr(Ee,xe,K,se));return{features:ve}}getFeatures(){return[...this.features.values()]}}function Wr({minX:Re,minY:G,maxX:K,maxY:se},xe,ve,Ee){return Re<(ve+1+xo)/xe&&G<(Ee+1+xo)/xe&&K>(ve-xo)/xe&&se>(Ee-xo)/xe}function dl(Re){let{id:G,geometry:K,properties:se}=Re;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:xe,coordinates:ve}=K,Ee={id:G,type:1,geometry:[],tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ze=Ee.geometry;if(xe==="Point")Va(ve,ze,Ee);else if(xe==="MultiPoint")for(let Pe of ve)Va(Pe,ze,Ee);else if(xe==="LineString")Ee.type=2,hl(ve,ze,Ee);else if(xe==="MultiLineString")Ee.type=2,Ua(ve,ze,Ee);else if(xe==="Polygon")Ee.type=3,Ua(ve,ze,Ee,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(let Pe of ve)Ua(Pe,ze,Ee,!0)}return Ee}function Va([Re,G],K,se){let xe=r.aF(Re),ve=r.aJ(G);ve=ve<0?0:ve>1?1:ve,K.push(xe,ve),se.minX=Math.min(se.minX,xe),se.minY=Math.min(se.minY,ve),se.maxX=Math.max(se.maxX,xe),se.maxY=Math.max(se.maxY,ve)}function hl(Re,G,K,se=!1,xe=!1){let ve=[];for(let Ee of Re)Va(Ee,ve,K);G.push(ve),se&&(function(Ee,ze){let Pe=0;for(let Ne=0,ut=Ee.length,Xe=ut-2;Ne<ut;Xe=Ne,Ne+=2)Pe+=(Ee[Ne]-Ee[Xe])*(Ee[Ne+1]+Ee[Xe+1]);if(Pe>0===ze)for(let Ne=0,ut=Ee.length;Ne<ut/2;Ne+=2){let Xe=Ee[Ne],kt=Ee[Ne+1];Ee[Ne]=Ee[ut-2-Ne],Ee[Ne+1]=Ee[ut-1-Ne],Ee[ut-2-Ne]=Xe,Ee[ut-1-Ne]=kt}})(ve,xe)}function Ua(Re,G,K,se=!1){for(let xe=0;xe<Re.length;xe++)hl(Re[xe],G,K,se,xe===0)}function fr(Re,G,K,se){let{id:xe,type:ve,geometry:Ee,tags:ze}=Re,Pe=[];if(ve===1)(function(Ne,ut,Xe,kt,Qt){for(let At=0;At<Ne.length;At+=2){let xn=Math.round(r.al*(Ne[At+0]*ut-Xe)),vn=Math.round(r.al*(Ne[At+1]*ut-kt));Qt.push([xn,vn])}})(Ee,G,K,se,Pe);else if(ve===2)for(let Ne of Ee)Xs(Ne,G,K,se,Pe);else if(ve===3)for(let Ne of Ee)Jf(Ne,G,K,se,Pe);return{id:xe,type:ve,geometry:Pe,tags:ze}}function Xs(Re,G,K,se,xe){let ve=-yr,Ee=r.al+yr,ze;for(let Pe=0;Pe<Re.length-2;Pe+=2){let Ne=Math.round(r.al*(Re[Pe+0]*G-K)),ut=Math.round(r.al*(Re[Pe+1]*G-se)),Xe=Math.round(r.al*(Re[Pe+2]*G-K)),kt=Math.round(r.al*(Re[Pe+3]*G-se)),Qt=Xe-Ne,At=kt-ut;Ne<ve&&Xe<ve||(Ne<ve?(ut+=Math.round(At*((ve-Ne)/Qt)),Ne=ve):Xe<ve&&(kt=ut+Math.round(At*((ve-Ne)/Qt)),Xe=ve),ut<ve&&kt<ve||(ut<ve?(Ne+=Math.round(Qt*((ve-ut)/At)),ut=ve):kt<ve&&(Xe=Ne+Math.round(Qt*((ve-ut)/At)),kt=ve),Ne>=Ee&&Xe>=Ee||(Ne>=Ee?(ut+=Math.round(At*((Ee-Ne)/Qt)),Ne=Ee):Xe>=Ee&&(kt=ut+Math.round(At*((Ee-Ne)/Qt)),Xe=Ee),ut>=Ee&&kt>=Ee||(ut>=Ee?(Ne+=Math.round(Qt*((Ee-ut)/At)),ut=Ee):kt>=Ee&&(Xe=Ne+Math.round(Qt*((Ee-ut)/At)),kt=Ee),ze&&Ne===ze[ze.length-1][0]&&ut===ze[ze.length-1][1]||(ze=[[Ne,ut]],xe.push(ze)),ze.push([Xe,kt])))))}}function Jf(Re,G,K,se,xe){let ve=(K-xo)/G,Ee=(se-xo)/G,ze=(K+1+xo)/G,Pe=(se+1+xo)/G;function Ne(kt,Qt){let At=0;return kt<ve?At|=1:kt>ze&&(At|=2),Qt<Ee?At|=4:Qt>Pe&&(At|=8),At}let ut=[];for(let kt=1;kt<=8;kt*=2){let Qt=Re[Re.length-2],At=Re[Re.length-1],xn=!(Ne(Qt,At)&kt);for(let vn=0;vn<Re.length;vn+=2){let gn=Re[vn],Un=Re[vn+1],mr=!(Ne(gn,Un)&kt);mr!==xn&&(8&kt?ut.push(Qt+(gn-Qt)*(Pe-At)/(Un-At),Pe):4&kt?ut.push(Qt+(gn-Qt)*(Ee-At)/(Un-At),Ee):2&kt?ut.push(ze,At+(Un-At)*(ze-Qt)/(gn-Qt)):1&kt&&ut.push(ve,At+(Un-At)*(ve-Qt)/(gn-Qt))),mr&&ut.push(gn,Un),Qt=gn,At=Un,xn=mr}if(!(Re=ut).length||kt===8)break;ut=[]}let Xe=[];for(let kt=0;kt<ut.length;kt+=2)Xe.push([Math.round(r.al*(ut[kt]*G-K)),Math.round(r.al*(ut[kt+1]*G-se))]);xe.push(Xe)}function ip({name:Re,features:G},K){K.writeStringField(1,Re),K.writeVarintField(5,r.al);let se=new Map,xe=new Map,ve={keys:se,values:xe,feature:null};for(let Ee of G)ve.feature=Ee,K.writeMessage(2,em,ve);for(let Ee of se.keys())K.writeStringField(3,Ee);for(let Ee of xe.keys())K.writeMessage(4,Vu,Ee)}function em(Re,G){let K=Re.feature;K.id!==void 0&&Number.isSafeInteger(+K.id)&&G.writeVarintField(1,+K.id),K.tags&&G.writeMessage(2,zc,Re),G.writeVarintField(3,K.type),G.writeMessage(4,Go,K)}function zc({keys:Re,values:G,feature:K},se){for(let xe of Object.keys(K.tags)){let ve=K.tags[xe];if(ve===null)continue;let Ee=Re.get(xe);Ee===void 0&&(Ee=Re.size,Re.set(xe,Ee)),se.writeVarint(Ee);let ze=typeof ve;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(ve=JSON.stringify(ve));let Pe=G.get(ve);Pe===void 0&&(Pe=G.size,G.set(ve,Pe)),se.writeVarint(Pe)}}function Yi(Re,G){return(G<<3)+(7&Re)}function Ir(Re){return Re<<1^Re>>31}function Go(Re,G){let{geometry:K,type:se}=Re,xe=0,ve=0;if(se===1){G.writeVarint(Yi(1,K.length));for(let Ee of K){let ze=Ee[0]-xe,Pe=Ee[1]-ve;G.writeVarint(Ir(ze)),G.writeVarint(Ir(Pe)),xe+=ze,ve+=Pe}}else for(let Ee of K){G.writeVarint(Yi(1,1));let ze=Ee.length-(se===3?1:0);for(let Pe=0;Pe<ze;Pe++){Pe===1&&G.writeVarint(Yi(2,ze-1));let Ne=Ee[Pe][0]-xe,ut=Ee[Pe][1]-ve;G.writeVarint(Ir(Ne)),G.writeVarint(Ir(ut)),xe+=Ne,ve+=ut}se===3&&G.writeVarint(Yi(7,1))}}function Vu(Re,G){let K=typeof Re;K==="string"?G.writeStringField(1,Re):K==="boolean"?G.writeBooleanField(7,Re):K==="number"&&(Re%1!=0?G.writeDoubleField(3,Re):Re<0?G.writeSVarintField(6,Re):G.writeVarintField(5,Re))}let Fr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},Bc=Math.fround||(Vc=new Float32Array(1),Re=>(Vc[0]=+Re,Vc[0]));var Vc;let zs=3,rs=5,Br=6;class bv{constructor(G){this.options=Object.assign(Object.create(Fr),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:K,minZoom:se,maxZoom:xe}=this.options;K&&console.time("total time");let ve=`prepare ${G.length} points`;K&&console.time(ve),this.points=G;let Ee=[];for(let Pe=0;Pe<G.length;Pe++){let Ne=G[Pe];if(!Ne.geometry)continue;let[ut,Xe]=Ne.geometry.coordinates,kt=Bc(Uc(ut)),Qt=Bc(jc(Xe));Ee.push(kt,Qt,1/0,Pe,-1,1),this.options.reduce&&Ee.push(0)}let ze=this.trees[xe+1]=this._createTree(Ee);K&&console.timeEnd(ve);for(let Pe=xe;Pe>=se;Pe--){let Ne=+Date.now();ze=this.trees[Pe]=this._createTree(this._cluster(ze,Pe)),K&&console.log("z%d: %d clusters in %dms",Pe,ze.numItems,+Date.now()-Ne)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let se=((G[0]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,G[1])),ve=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)se=-180,ve=180;else if(se>ve){let Xe=this.getClusters([se,xe,180,Ee],K),kt=this.getClusters([-180,xe,ve,Ee],K);return Xe.concat(kt)}let ze=this.trees[this._limitZoom(K)],Pe=ze.range(Uc(se),jc(Ee),Uc(ve),jc(xe)),Ne=ze.data,ut=[];for(let Xe of Pe){let kt=this.stride*Xe;ut.push(Ne[kt+rs]>1?Ud(Ne,kt,this.clusterProps):this.points[Ne[kt+zs]])}return ut}getChildren(G){let K=this._getOriginId(G),se=this._getOriginZoom(G),xe="No cluster with the specified id.",ve=this.trees[se];if(!ve)throw new Error(xe);let Ee=ve.data;if(K*this.stride>=Ee.length)throw new Error(xe);let ze=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Pe=ve.within(Ee[K*this.stride],Ee[K*this.stride+1],ze),Ne=[];for(let ut of Pe){let Xe=ut*this.stride;Ee[Xe+4]===G&&Ne.push(Ee[Xe+rs]>1?Ud(Ee,Xe,this.clusterProps):this.points[Ee[Xe+zs]])}if(Ne.length===0)throw new Error(xe);return Ne}getLeaves(G,K,se){let xe=[];return this._appendLeaves(xe,G,K=K||10,se=se||0,0),xe}getTile(G,K,se){let xe=this.trees[this._limitZoom(G)],ve=Math.pow(2,G),{extent:Ee,radius:ze}=this.options,Pe=ze/Ee,Ne=(se-Pe)/ve,ut=(se+1+Pe)/ve,Xe={features:[]};return this._addTileFeatures(xe.range((K-Pe)/ve,Ne,(K+1+Pe)/ve,ut),xe.data,K,se,ve,Xe),K===0&&this._addTileFeatures(xe.range(1-Pe/ve,Ne,1,ut),xe.data,ve,se,ve,Xe),K===ve-1&&this._addTileFeatures(xe.range(0,Ne,Pe/ve,ut),xe.data,-1,se,ve,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){let se=this.getChildren(G);if(K++,se.length!==1)break;G=se[0].properties.cluster_id}return K}_appendLeaves(G,K,se,xe,ve){let Ee=this.getChildren(K);for(let ze of Ee){let Pe=ze.properties;if(Pe&&Pe.cluster?ve+Pe.point_count<=xe?ve+=Pe.point_count:ve=this._appendLeaves(G,Pe.cluster_id,se,xe,ve):ve<xe?ve++:G.push(ze),G.length===se)break}return ve}_createTree(G){let K=new r.c4(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<G.length;se+=this.stride)K.add(G[se],G[se+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,se,xe,ve,Ee){for(let ze of G){let Pe=ze*this.stride,Ne=K[Pe+rs]>1,ut,Xe,kt;if(Ne)ut=Uu(K,Pe,this.clusterProps),Xe=K[Pe],kt=K[Pe+1];else{let xn=this.points[K[Pe+zs]];ut=xn.properties;let[vn,gn]=xn.geometry.coordinates;Xe=Uc(vn),kt=jc(gn)}let Qt={type:1,geometry:[[Math.round(this.options.extent*(Xe*ve-se)),Math.round(this.options.extent*(kt*ve-xe))]],tags:ut},At;At=Ne||this.options.generateId?K[Pe+zs]:this.points[K[Pe+zs]].id,At!==void 0&&(Qt.id=At),Ee.features.push(Qt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){let{radius:se,extent:xe,reduce:ve,minPoints:Ee}=this.options,ze=se/(xe*Math.pow(2,K)),Pe=G.data,Ne=[],ut=this.stride;for(let Xe=0;Xe<Pe.length;Xe+=ut){if(Pe[Xe+2]<=K)continue;Pe[Xe+2]=K;let kt=Pe[Xe],Qt=Pe[Xe+1],At=G.within(Pe[Xe],Pe[Xe+1],ze),xn=Pe[Xe+rs],vn=xn;for(let gn of At){let Un=gn*ut;Pe[Un+2]>K&&(vn+=Pe[Un+rs])}if(vn>xn&&vn>=Ee){let gn,Un=kt*xn,mr=Qt*xn,Vr=-1,xr=(Xe/ut<<5)+(K+1)+this.points.length;for(let Zr of At){let lr=Zr*ut;if(Pe[lr+2]<=K)continue;Pe[lr+2]=K;let Gn=Pe[lr+rs];Un+=Pe[lr]*Gn,mr+=Pe[lr+1]*Gn,Pe[lr+4]=xr,ve&&(gn||(gn=this._map(Pe,Xe,!0),Vr=this.clusterProps.length,this.clusterProps.push(gn)),ve(gn,this._map(Pe,lr)))}Pe[Xe+4]=xr,Ne.push(Un/vn,mr/vn,1/0,xr,-1,vn),ve&&Ne.push(Vr)}else{for(let gn=0;gn<ut;gn++)Ne.push(Pe[Xe+gn]);if(vn>1)for(let gn of At){let Un=gn*ut;if(!(Pe[Un+2]<=K)){Pe[Un+2]=K;for(let mr=0;mr<ut;mr++)Ne.push(Pe[Un+mr])}}}}return Ne}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,se){if(G[K+rs]>1){let Ee=this.clusterProps[G[K+Br]];return se?Object.assign({},Ee):Ee}let xe=this.points[G[K+zs]].properties,ve=this.options.map(xe);return se&&ve===xe?Object.assign({},ve):ve}}function Ud(Re,G,K){return{type:"Feature",id:Re[G+zs],properties:Uu(Re,G,K),geometry:{type:"Point",coordinates:[(se=Re[G],360*(se-.5)),qo(Re[G+1])]}};var se}function Uu(Re,G,K){let se=Re[G+rs],xe=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,ve=Re[G+Br],Ee=ve===-1?{}:Object.assign({},K[ve]);return Object.assign(Ee,{cluster:!0,cluster_id:Re[G+zs],point_count:se,point_count_abbreviated:xe})}function Uc(Re){return Re/360+.5}function jc(Re){let G=Math.sin(Re*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function qo(Re){let G=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ql(Re,G,K,se){let xe=se,ve=G+(K-G>>1),Ee,ze=K-G,Pe=Re[G],Ne=Re[G+1],ut=Re[K],Xe=Re[K+1];for(let kt=G+3;kt<K;kt+=3){let Qt=jd(Re[kt],Re[kt+1],Pe,Ne,ut,Xe);if(Qt>xe)Ee=kt,xe=Qt;else if(Qt===xe){let At=Math.abs(kt-ve);At<ze&&(Ee=kt,ze=At)}}xe>se&&(Ee-G>3&&ql(Re,G,Ee,se),Re[Ee+2]=xe,K-Ee>3&&ql(Re,Ee,K,se))}function jd(Re,G,K,se,xe,ve){let Ee=xe-K,ze=ve-se;if(Ee!==0||ze!==0){let Pe=((Re-K)*Ee+(G-se)*ze)/(Ee*Ee+ze*ze);Pe>1?(K=xe,se=ve):Pe>0&&(K+=Ee*Pe,se+=ze*Pe)}return Ee=Re-K,ze=G-se,Ee*Ee+ze*ze}function ja(Re,G,K,se){let xe={id:Re??null,type:G,geometry:K,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")Wl(xe,K);else if(G==="Polygon")Wl(xe,K[0]);else if(G==="MultiLineString")for(let ve of K)Wl(xe,ve);else if(G==="MultiPolygon")for(let ve of K)Wl(xe,ve[0]);return xe}function Wl(Re,G){for(let K=0;K<G.length;K+=3)Re.minX=Math.min(Re.minX,G[K]),Re.minY=Math.min(Re.minY,G[K+1]),Re.maxX=Math.max(Re.maxX,G[K]),Re.maxY=Math.max(Re.maxY,G[K+1])}function ds(Re,G,K,se){if(!G.geometry)return;let xe=G.geometry.coordinates;if(xe&&xe.length===0)return;let ve=G.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),ze=[],Pe=G.id;if(K.promoteId?Pe=G.properties[K.promoteId]:K.generateId&&(Pe=se||0),ve==="Point")ju(xe,ze);else if(ve==="MultiPoint")for(let Ne of xe)ju(Ne,ze);else if(ve==="LineString")$u(xe,ze,Ee,!1);else if(ve==="MultiLineString"){if(K.lineMetrics){for(let Ne of xe)ze=[],$u(Ne,ze,Ee,!1),Re.push(ja(Pe,"LineString",ze,G.properties));return}Hu(xe,ze,Ee,!1)}else if(ve==="Polygon")Hu(xe,ze,Ee,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(let Ne of G.geometry.geometries)ds(Re,{id:Pe,geometry:Ne,properties:G.properties},K,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ne of xe){let ut=[];Hu(Ne,ut,Ee,!0),ze.push(ut)}}Re.push(ja(Pe,ve,ze,G.properties))}function ju(Re,G){G.push($d(Re[0]),bo(Re[1]),0)}function $u(Re,G,K,se){let xe,ve,Ee=0;for(let Pe=0;Pe<Re.length;Pe++){let Ne=$d(Re[Pe][0]),ut=bo(Re[Pe][1]);G.push(Ne,ut,0),Pe>0&&(Ee+=se?(xe*ut-Ne*ve)/2:Math.sqrt(Math.pow(Ne-xe,2)+Math.pow(ut-ve,2))),xe=Ne,ve=ut}let ze=G.length-3;G[2]=1,ql(G,0,ze,K),G[ze+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function Hu(Re,G,K,se){for(let xe=0;xe<Re.length;xe++){let ve=[];$u(Re[xe],ve,K,se),G.push(ve)}}function $d(Re){return Re/360+.5}function bo(Re){let G=Math.sin(Re*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Es(Re,G,K,se,xe,ve,Ee,ze){if(se/=G,ve>=(K/=G)&&Ee<se)return Re;if(Ee<K||ve>=se)return null;let Pe=[];for(let Ne of Re){let ut=Ne.geometry,Xe=Ne.type,kt=xe===0?Ne.minX:Ne.minY,Qt=xe===0?Ne.maxX:Ne.maxY;if(kt>=K&&Qt<se){Pe.push(Ne);continue}if(Qt<K||kt>=se)continue;let At=[];if(Xe==="Point"||Xe==="MultiPoint")rp(ut,At,K,se,xe);else if(Xe==="LineString")$c(ut,At,K,se,xe,!1,ze.lineMetrics);else if(Xe==="MultiLineString")Zl(ut,At,K,se,xe,!1);else if(Xe==="Polygon")Zl(ut,At,K,se,xe,!0);else if(Xe==="MultiPolygon")for(let xn of ut){let vn=[];Zl(xn,vn,K,se,xe,!0),vn.length&&At.push(vn)}if(At.length){if(ze.lineMetrics&&Xe==="LineString"){for(let xn of At)Pe.push(ja(Ne.id,Xe,xn,Ne.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(At.length===1?(Xe="LineString",At=At[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=At.length===3?"Point":"MultiPoint"),Pe.push(ja(Ne.id,Xe,At,Ne.tags))}}return Pe.length?Pe:null}function rp(Re,G,K,se,xe){for(let ve=0;ve<Re.length;ve+=3){let Ee=Re[ve+xe];Ee>=K&&Ee<=se&&$a(G,Re[ve],Re[ve+1],Re[ve+2])}}function $c(Re,G,K,se,xe,ve,Ee){let ze=pl(Re),Pe=xe===0?op:Gu,Ne,ut,Xe=Re.start;for(let vn=0;vn<Re.length-3;vn+=3){let gn=Re[vn],Un=Re[vn+1],mr=Re[vn+2],Vr=Re[vn+3],xr=Re[vn+4],Zr=xe===0?gn:Un,lr=xe===0?Vr:xr,Gn=!1;Ee&&(Ne=Math.sqrt(Math.pow(gn-Vr,2)+Math.pow(Un-xr,2))),Zr<K?lr>K&&(ut=Pe(ze,gn,Un,Vr,xr,K),Ee&&(ze.start=Xe+Ne*ut)):Zr>se?lr<se&&(ut=Pe(ze,gn,Un,Vr,xr,se),Ee&&(ze.start=Xe+Ne*ut)):$a(ze,gn,Un,mr),lr<K&&Zr>=K&&(ut=Pe(ze,gn,Un,Vr,xr,K),Gn=!0),lr>se&&Zr<=se&&(ut=Pe(ze,gn,Un,Vr,xr,se),Gn=!0),!ve&&Gn&&(Ee&&(ze.end=Xe+Ne*ut),G.push(ze),ze=pl(Re)),Ee&&(Xe+=Ne)}let kt=Re.length-3,Qt=Re[kt],At=Re[kt+1],xn=xe===0?Qt:At;xn>=K&&xn<=se&&$a(ze,Qt,At,Re[kt+2]),kt=ze.length-3,ve&&kt>=3&&(ze[kt]!==ze[0]||ze[kt+1]!==ze[1])&&$a(ze,ze[0],ze[1],ze[2]),ze.length&&G.push(ze)}function pl(Re){let G=[];return G.size=Re.size,G.start=Re.start,G.end=Re.end,G}function Zl(Re,G,K,se,xe,ve){for(let Ee of Re)$c(Ee,G,K,se,xe,ve,!1)}function $a(Re,G,K,se){Re.push(G,K,se)}function op(Re,G,K,se,xe,ve){let Ee=(ve-G)/(se-G);return $a(Re,ve,K+(xe-K)*Ee,1),Ee}function Gu(Re,G,K,se,xe,ve){let Ee=(ve-K)/(xe-K);return $a(Re,G+(se-G)*Ee,ve,1),Ee}function ar(Re,G){let K=[];for(let se=0;se<Re.length;se++){let xe=Re[se],ve=xe.type,Ee;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ee=Mo(xe.geometry,G);else if(ve==="MultiLineString"||ve==="Polygon"){Ee=[];for(let ze of xe.geometry)Ee.push(Mo(ze,G))}else if(ve==="MultiPolygon"){Ee=[];for(let ze of xe.geometry){let Pe=[];for(let Ne of ze)Pe.push(Mo(Ne,G));Ee.push(Pe)}}K.push(ja(xe.id,ve,Ee,xe.tags))}return K}function Mo(Re,G){let K=[];K.size=Re.size,Re.start!==void 0&&(K.start=Re.start,K.end=Re.end);for(let se=0;se<Re.length;se+=3)K.push(Re[se]+G,Re[se+1],Re[se+2]);return K}function tm(Re,G){if(Re.transformed)return Re;let K=1<<Re.z,se=Re.x,xe=Re.y;for(let ve of Re.features){let Ee=ve.geometry,ze=ve.type;if(ve.geometry=[],ze===1)for(let Pe=0;Pe<Ee.length;Pe+=2)ve.geometry.push(qu(Ee[Pe],Ee[Pe+1],G,K,se,xe));else for(let Pe=0;Pe<Ee.length;Pe++){let Ne=[];for(let ut=0;ut<Ee[Pe].length;ut+=2)Ne.push(qu(Ee[Pe][ut],Ee[Pe][ut+1],G,K,se,xe));ve.geometry.push(Ne)}}return Re.transformed=!0,Re}function qu(Re,G,K,se,xe,ve){return[Math.round(K*(Re*se-xe)),Math.round(K*(G*se-ve))]}function Ha(Re,G,K,se,xe){let ve=G===xe.maxZoom?0:xe.tolerance/((1<<G)*xe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:K,y:se,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ze of Re)nm(Ee,ze,ve,xe);return Ee}function nm(Re,G,K,se){let xe=G.geometry,ve=G.type,Ee=[];if(Re.minX=Math.min(Re.minX,G.minX),Re.minY=Math.min(Re.minY,G.minY),Re.maxX=Math.max(Re.maxX,G.maxX),Re.maxY=Math.max(Re.maxY,G.maxY),ve==="Point"||ve==="MultiPoint")for(let ze=0;ze<xe.length;ze+=3)Ee.push(xe[ze],xe[ze+1]),Re.numPoints++,Re.numSimplified++;else if(ve==="LineString")ot(Ee,xe,Re,K,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let ze=0;ze<xe.length;ze++)ot(Ee,xe[ze],Re,K,ve==="Polygon",ze===0);else if(ve==="MultiPolygon")for(let ze=0;ze<xe.length;ze++){let Pe=xe[ze];for(let Ne=0;Ne<Pe.length;Ne++)ot(Ee,Pe[Ne],Re,K,!0,Ne===0)}if(Ee.length){let ze=G.tags||null;if(ve==="LineString"&&se.lineMetrics){ze={};for(let Ne in G.tags)ze[Ne]=G.tags[Ne];ze.mapbox_clip_start=xe.start/xe.size,ze.mapbox_clip_end=xe.end/xe.size}let Pe={geometry:Ee,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:ze};G.id!==null&&(Pe.id=G.id),Re.features.push(Pe)}}function ot(Re,G,K,se,xe,ve){let Ee=se*se;if(se>0&&G.size<(xe?Ee:se))return void(K.numPoints+=G.length/3);let ze=[];for(let Pe=0;Pe<G.length;Pe+=3)(se===0||G[Pe+2]>Ee)&&(K.numSimplified++,ze.push(G[Pe],G[Pe+1])),K.numPoints++;xe&&(function(Pe,Ne){let ut=0;for(let Xe=0,kt=Pe.length,Qt=kt-2;Xe<kt;Qt=Xe,Xe+=2)ut+=(Pe[Xe]-Pe[Qt])*(Pe[Xe+1]+Pe[Qt+1]);if(ut>0===Ne)for(let Xe=0,kt=Pe.length;Xe<kt/2;Xe+=2){let Qt=Pe[Xe],At=Pe[Xe+1];Pe[Xe]=Pe[kt-2-Xe],Pe[Xe+1]=Pe[kt-1-Xe],Pe[kt-2-Xe]=Qt,Pe[kt-1-Xe]=At}})(ze,ve),Re.push(ze)}let Yl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class wv{constructor(G,K){let se=(K=this.options=(function(ve,Ee){for(let ze in Ee)ve[ze]=Ee[ze];return ve})(Object.create(Yl),K)).debug;if(se&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(ve,Ee){let ze=[];if(ve.type==="FeatureCollection")for(let Pe=0;Pe<ve.features.length;Pe++)ds(ze,ve.features[Pe],Ee,Pe);else ds(ze,ve.type==="Feature"?ve:{geometry:ve},Ee);return ze})(G,K);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(ve,Ee){let ze=Ee.buffer/Ee.extent,Pe=ve,Ne=Es(ve,1,-1-ze,ze,0,-1,2,Ee),ut=Es(ve,1,1-ze,2+ze,0,-1,2,Ee);return(Ne||ut)&&(Pe=Es(ve,1,-ze,1+ze,0,-1,2,Ee)||[],Ne&&(Pe=ar(Ne,1).concat(Pe)),ut&&(Pe=Pe.concat(ar(ut,-1)))),Pe})(xe,K),xe.length&&this.splitTile(xe,0,0,0),se&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,se,xe,ve,Ee,ze){let Pe=[G,K,se,xe],Ne=this.options,ut=Ne.debug;for(;Pe.length;){xe=Pe.pop(),se=Pe.pop(),K=Pe.pop(),G=Pe.pop();let Xe=1<<K,kt=Wu(K,se,xe),Qt=this.tiles[kt];if(!Qt&&(ut>1&&console.time("creation"),Qt=this.tiles[kt]=Ha(G,K,se,xe,Ne),this.tileCoords.push({z:K,x:se,y:xe}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,se,xe,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));let Gn=`z${K}`;this.stats[Gn]=(this.stats[Gn]||0)+1,this.total++}if(Qt.source=G,ve==null){if(K===Ne.indexMaxZoom||Qt.numPoints<=Ne.indexMaxPoints)continue}else{if(K===Ne.maxZoom||K===ve)continue;if(ve!=null){let Gn=ve-K;if(se!==Ee>>Gn||xe!==ze>>Gn)continue}}if(Qt.source=null,G.length===0)continue;ut>1&&console.time("clipping");let At=.5*Ne.buffer/Ne.extent,xn=.5-At,vn=.5+At,gn=1+At,Un=null,mr=null,Vr=null,xr=null,Zr=Es(G,Xe,se-At,se+vn,0,Qt.minX,Qt.maxX,Ne),lr=Es(G,Xe,se+xn,se+gn,0,Qt.minX,Qt.maxX,Ne);G=null,Zr&&(Un=Es(Zr,Xe,xe-At,xe+vn,1,Qt.minY,Qt.maxY,Ne),mr=Es(Zr,Xe,xe+xn,xe+gn,1,Qt.minY,Qt.maxY,Ne),Zr=null),lr&&(Vr=Es(lr,Xe,xe-At,xe+vn,1,Qt.minY,Qt.maxY,Ne),xr=Es(lr,Xe,xe+xn,xe+gn,1,Qt.minY,Qt.maxY,Ne),lr=null),ut>1&&console.timeEnd("clipping"),Pe.push(Un||[],K+1,2*se,2*xe),Pe.push(mr||[],K+1,2*se,2*xe+1),Pe.push(Vr||[],K+1,2*se+1,2*xe),Pe.push(xr||[],K+1,2*se+1,2*xe+1)}}getTile(G,K,se){G=+G,K=+K,se=+se;let xe=this.options,{extent:ve,debug:Ee}=xe;if(G<0||G>24)return null;let ze=1<<G,Pe=Wu(G,K=K+ze&ze-1,se);if(this.tiles[Pe])return tm(this.tiles[Pe],ve);Ee>1&&console.log("drilling down to z%d-%d-%d",G,K,se);let Ne,ut=G,Xe=K,kt=se;for(;!Ne&&ut>0;)ut--,Xe>>=1,kt>>=1,Ne=this.tiles[Wu(ut,Xe,kt)];return Ne&&Ne.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",ut,Xe,kt),console.time("drilling down")),this.splitTile(Ne.source,ut,Xe,kt,G,K,se),Ee>1&&console.timeEnd("drilling down"),this.tiles[Pe]?tm(this.tiles[Pe],ve):null):null}}function Wu(Re,G,K){return 32*((1<<Re)*K+G)+Re}function Zn(Re,G){let K=Re.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);let se=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!se)return void G(null,null);let xe=Ne=>Ne.tags&&"3d_elevation_id"in Ne.tags&&"source"in Ne.tags&&Ne.tags.source==="elevation",ve=se.features.filter(Ne=>xe(Ne)),Ee={_geojsonTileLayer:se.features};ve.length>0&&(Ee={_geojsonTileLayer:se.features.filter(Ne=>!xe(Ne)),hd_road_elevation:ve});let ze=new Bu(Ee),Pe=(function(Ne){let ut=new r.bt;for(let Xe of Object.keys(Ne))ut.writeMessage(3,ip,{name:Xe,features:Ne[Xe]});return ut.finish()})(Ee).buffer;G(null,{vectorTile:ze,rawData:Pe})}class os extends Li{constructor(G,K,se,xe,ve,Ee,ze){super(G,K,se,xe,ve,Zn,ze),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new Ji}loadData(G,K){let se=G&&G.request,xe=se&&se.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(G,(ve,Ee)=>{if(ve||!Ee)return K(ve);if(typeof Ee!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Pe=r.U(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Ne=>`${Ne.key}: ${Ne.message}`).join(", "));Ee.features=Ee.features.filter(Ne=>Pe.value.evaluate({zoom:0},Ne))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new bv((function({superclusterOptions:Pe,clusterProperties:Ne}){if(!Ne||!Pe)return Pe;let ut={},Xe={},kt={accumulated:null,zoom:0},Qt={properties:null},At=Object.keys(Ne);for(let xn of At){let[vn,gn]=Ne[xn],Un=r.U(gn),mr=r.U(typeof vn=="string"?[vn,["accumulated"],["get",xn]]:vn);ut[xn]=Un.value,Xe[xn]=mr.value}return Pe.map=xn=>{Qt.properties=xn;let vn={};for(let gn of At)vn[gn]=ut[gn].evaluate(kt,Qt);return vn},Pe.reduce=(xn,vn)=>{Qt.properties=vn;for(let gn of At)kt.accumulated=xn[gn],xn[gn]=Xe[gn].evaluate(kt,Qt)},Pe})(G)).load(Ee.features):G.dynamic?this._dynamicIndex:(function(Pe,Ne){return new wv(Pe,Ne)})(Ee,G.geojsonVtOptions)}catch(Pe){return K(Pe)}let ze={};if(xe){let Pe=E(se);Pe&&(ze.resourceTiming={},ze.resourceTiming[G.source]=JSON.parse(JSON.stringify(Pe)))}K(null,ze)}})}reloadTile(G,K){let se=this.loaded;return se&&se[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)r.m(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(se){K(se)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(se){K(se)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(se){K(se)}}}class Cv{constructor(G,K,se){this.tileID=new r.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K,this.worldview=se}parse(G,K,se,xe){this.status="parsing";let ve=new r.aQ(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),Ee=[],ze=K.familiesBySource[se.source],Pe=new r.fn(ve,se.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,r.fC(G).then(Ne=>{if(!Ne)return xe(new Error("Could not parse tile"));let ut=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ne.json.asset.extras&&Ne.json.asset.extras.MAPBOX_mesh_features,Xe=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("EXT_meshopt_compression"),kt=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(let Qt in ze)for(let At of ze[Qt]){let xn=At[0];Pe.bucketLayerIDs.push(At.map(Un=>r.B(Un.id,Un.scope))),xn.recalculate(kt,[]);let vn=r.fD(Ne,1/r.d7(se.tileID.canonical)),gn=new r.fE(At,vn,ve,ut,Xe,this.brightness,Pe,this.worldview);ut||(gn.needsUpload=!0),Ee.push(gn),gn.evaluate(xn)}this.status="done",xe(null,{buckets:Ee,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ne=>xe(new Error(Ne.message)))}}class Zu{constructor(G,K,se,xe,ve,Ee,ze,Pe){this.actor=G,this.layerIndex=K,this.availableImages=se,this.availableModels=xe,this.brightness=ze,this.loading={},this.loaded={},this.worldview=Pe}loadTile(G,K){let se=G.uid,xe=this.loading[se]=new Cv(G,this.brightness,this.worldview);r.bu(G.request,(ve,Ee)=>{let ze=!this.loading[se];return delete this.loading[se],ze||ve?(xe.status="done",ze||(this.loaded[se]=xe),K(ve)):Ee&&Ee.byteLength!==0?void xe.parse(Ee,this.layerIndex,G,(Pe,Ne)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[se]=xe,Pe||!Ne?K(Pe):K(null,Ne)}):(xe.status="done",this.loaded[se]=xe,K())})}reloadTile(G,K){let se=this.loaded,xe=G.uid;if(se&&se[xe]){let ve=se[xe];ve.projection=G.projection,ve.brightness=G.brightness;let Ee=(ze,Pe)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(G,K)),K(ze,Pe)};ve.status==="parsing"?ve.reloadCallback=Ee:ve.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){let se=G.uid;this.loading[se]&&delete this.loading[se],K()}removeTile(G,K){let se=this.loaded,xe=G.uid;se&&se[xe]&&delete se[xe],K()}}class sp{constructor(G){this.self=G,this.actor=new r.fG(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cm({name:"mercator"}),this.workerSourceTypes={vector:Li,geojson:os,"raster-dem":Or,"raster-array":Ys,"batched-model":Zu},this.workerSources={},this.self.registerWorkerSource=(K,se)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=se},this.self.registerRTLTextPlugin=K=>{if(r.fH.isParsed())throw new Error("RTL text plugin already registered.");r.fH.setState({pluginStatus:r.fI.parsed,pluginURL:r.fH.getPluginURL()}),r.fH.applyArabicShaping=K.applyArabicShaping,r.fH.processBidirectionalText=K.processBidirectionalText,r.fH.processStyledBidirectionalText=K.processStyledBidirectionalText;for(let se of this.rtlPluginParsingListeners)se(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(G,K,se){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],se()}checkIfReady(G,K,se){se()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,K){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});let{scope:se,isLoaded:xe}=K;if(this.isSpriteLoaded[G][se]=xe,this.workerSources[G]&&this.workerSources[G][se])for(let ve in this.workerSources[G][se]){let Ee=this.workerSources[G][se][ve];for(let ze in Ee){let Pe=Ee[ze];Pe instanceof Li&&(Pe.isSpriteLoaded=xe,Pe.fire(new r.z("isSpriteLoaded")))}}}setImages(G,K,se){this.availableImages[G]||(this.availableImages[G]={});let{scope:xe,images:ve}=K;if(this.availableImages[G][xe]=ve,this.workerSources[G]&&this.workerSources[G][xe]){for(let Ee in this.workerSources[G][xe]){let ze=this.workerSources[G][xe][Ee];for(let Pe in ze)ze[Pe].availableImages=ve}se()}else se()}setModels(G,{scope:K,models:se},xe){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][K]=se,this.workerSources[G]&&this.workerSources[G][K]){for(let ve in this.workerSources[G][K]){let Ee=this.workerSources[G][K][ve];for(let ze in Ee)Ee[ze].availableModels=se}xe()}else xe()}setProjection(G,K){this.projections[G]=r.cm(K)}setBrightness(G,K,se){this.brightness=K,se()}setWorldview(G,K,se){this.worldview=K,se()}setLayers(G,K,se){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),se()}updateLayers(G,K,se){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),se()}loadTile(G,K,se){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,se)}decodeRasterArray(G,K,se){this.getWorkerSource(G,K.type,K.source,K.scope).decodeRasterArray(K,se)}reloadTile(G,K,se){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,se)}abortTile(G,K,se){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,se)}removeTile(G,K,se){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,se)}removeSource(G,K,se){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;let xe=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],xe.removeSource!==void 0?xe.removeSource(K,se):se()}loadWorkerSource(G,K,se){try{this.self.importScripts(K.url),se()}catch(xe){se(xe)}}syncRTLPluginState(G,K,se){if(r.fH.isParsed())se(null,!0);else if(r.fH.isParsing())this.rtlPluginParsingListeners.push(se);else try{r.fH.setState(K);let xe=r.fH.getPluginURL();!r.fH.isLoaded()||r.fH.isParsed()||r.fH.isParsing()||xe==null||(r.fH.setState({pluginStatus:r.fI.parsing,pluginURL:r.fH.getPluginURL()}),this.self.importScripts(xe),r.fH.isParsed()?se(null,!0):this.rtlPluginParsingListeners.push(se))}catch(xe){se(xe)}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let se=this.availableImages[G][K];return se||(se=[]),se}getAvailableModels(G,K){this.availableModels[G]||(this.availableModels[G]={});let se=this.availableModels[G][K];return se||(se={}),se}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let se=this.layerIndexes[G][K];return se||(se=this.layerIndexes[G][K]=new X,se.scope=K),se}getWorkerSource(G,K,se,xe){let ve=this.workerSources;return ve[G]||(ve[G]={}),ve[G][xe]||(ve[G][xe]={}),ve[G][xe][K]||(ve[G][xe][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),ve[G][xe][K][se]||(ve[G][xe][K][se]=new this.workerSourceTypes[K]({send:(Ee,ze,Pe,Ne,ut,Xe)=>this.actor.send(Ee,ze,Pe,G,ut,Xe),scheduler:this.actor.scheduler},this.getLayerIndex(G,xe),this.getAvailableImages(G,xe),this.getAvailableModels(G,xe),this.isSpriteLoaded[G][xe],void 0,this.brightness,this.worldview)),ve[G][xe][K][se]}rasterizeImagesWorker(G,K,se){let xe=new Map;for(let[ve,{image:Ee,imageVariant:ze}]of K.tasks.entries()){let Pe=this.imageRasterizer.rasterize(ze,Ee,K.scope,G);xe.set(ve,Pe)}se(void 0,xe)}removeRasterizedImages(G,K,se){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,G),se()}enforceCacheSizeLimit(G,K){r.fJ(K)}getWorkerPerformanceMetrics(G,K,se){se(void 0,void 0)}}return r.fF(self)&&(self.worker=new sp(self)),sp}),a(["./shared"],function(r){var E="3.17.0";let P={create:"create",load:"load",fullLoad:"fullLoad"},k={mark(p){performance.mark(p)},measure(p,o,c){performance.measure(p,o,c)}};function X(p){let o=p.name.split("?")[0];return r.a(o)&&o.includes("mapbox-gl.js")?"javascript":r.a(o)&&o.includes("mapbox-gl.css")?"css":r.b(o)?"fontRange":r.c(o)?"sprite":r.i(o)?"style":r.d(o)?"tilejson":"other"}var oe,Se={},$e=(function(){if(oe)return Se;function p(f){return!o(f)}function o(f){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(S),y})()?(function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===y.width})()?(c[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(c[_]=(function(y){var x,w=(function(S){var M=document.createElement("canvas"),A=Object.create(p.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=S,M.getContext("webgl2",A)})(y);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)})(_)),c[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}oe=1,Se.supported=p,Se.notSupportedReason=o;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Se})();function ke(p,o,c){let f=document.createElement(p);return o!=null&&(f.className=o),c&&c.appendChild(f),f}function ht(p,o,c){let f=document.createElementNS("http://www.w3.org/2000/svg",p);for(let _ of Object.keys(o))f.setAttributeNS(null,_,String(o[_]));return c&&c.appendChild(f),f}let Nt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Mt=Nt&&Nt.userSelect!==void 0?"userSelect":"WebkitUserSelect",Xt;function Vn(){Nt&&Mt&&(Xt=Nt[Mt],Nt[Mt]="none")}function sr(){Nt&&Mt&&(Nt[Mt]=Xt)}function $i(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",$i,!0)}function Li(){window.addEventListener("click",$i,!0),window.setTimeout(()=>{window.removeEventListener("click",$i,!0)},0)}function Or(p,o){let c=p.getBoundingClientRect();return Nu(p,c,o)}function Ho(p,o){let c=p.getBoundingClientRect(),f=[];for(let _=0;_<o.length;_++)f.push(Nu(p,c,o[_]));return f}function Ys(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Nu(p,o,c){let f=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new r.P((c.clientX-o.left)*f,(c.clientY-o.top)*f)}let zu="01",ci="NO_ACCESS_TOKEN";class Bu{constructor(o,c,f){this._transformRequestFn=o,this._customAccessToken=c,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){let o=(function(){let c="";for(let f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zu,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeStyleURL(o,c){if(!r.h(o))return o;let f=yr(o);return f.params.push(`sdk=js-${E}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeGlyphsURL(o,c){if(!r.h(o))return o;let f=yr(o);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeModelURL(o,c){if(!r.h(o))return o;let f=yr(o);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeSourceURL(o,c,f,_){if(!r.h(o))return o;let y=yr(o);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),f&&y.params.push(`language=${f}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||c)}normalizeIconsetURL(o,c){let f=yr(o);return r.h(o)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||c)):Ji(f)}normalizeSpriteURL(o,c,f,_){let y=yr(o);return r.h(o)?(y.path=`/styles/v1${y.path}/sprite${c}${f}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${c}${f}`,Ji(y))}normalizeTileURL(o,c,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!r.h(o))return o;let _=yr(o);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||f&&_.authority!=="raster"&&f===512?"@2x":""}${r.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${r.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${r.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${r.e.TILE_URL_VERSION}${_.path}`);let y=this._customAccessToken||(function(x){for(let w of x){let S=w.match(/^access_token=(.*)$/);if(S)return S[1]}return null})(_.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(o,c){let f=yr(o);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return o;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let y=f.params;return c&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(o,c){let f=!!c&&r.h(c),_=[];for(let y of o.tiles||[])r.j(y)?_.push(this.canonicalizeTileURL(y,f)):_.push(y);return _}_makeAPIURL(o,c){let f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=yr(r.e.API_URL);if(o.protocol=_.protocol,o.authority=_.authority,o.protocol==="http"){let y=o.params.indexOf("secure");y>=0&&o.params.splice(y,1)}if(_.path!=="/"&&(o.path=`${_.path}${o.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Ji(o);if(c=c||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return o.params=o.params.filter(y=>y.indexOf("access_token")===-1),o.params.push(`access_token=${c||""}`),Ji(o)}}let xo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yr(p){let o=p.match(xo);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ji(p){let o=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${o}`}let Wr="mapbox.eventData";function dl(p){if(!p)return null;let o=p.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(r.l(o[1]))}catch{return null}}class Va{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){let c=dl(r.e.ACCESS_TOKEN),f="";return f=c&&c.u?r.f(c.u):r.e.ACCESS_TOKEN||"",o?`${Wr}.${o}:${f}`:`${Wr}:${f}`}fetchEventData(){let o=r.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(o)try{let y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));let x=localStorage.getItem(f);x&&(this.anonId=x);let w=localStorage.getItem(_);w&&(this.anonIdTimestamp=Number(w));let S=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<S)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){let o=r.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),y=this.anonId,x=this.anonIdTimestamp;if(o&&y)try{localStorage.setItem(f,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),x&&localStorage.setItem(_,x.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,f,_){if(!r.e.EVENTS_URL)return;let y=yr(r.e.EVENTS_URL);y.params.push(`access_token=${_||r.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(o).toISOString()},w=c?Object.assign(x,c):x,S={url:Ji(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=r.p(S,M=>{this.pendingRequest=null,f(M),this.saveEventData(),this.processRequests(_)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}class hl extends Va{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!r.e.EVENTS_URL||!o&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();let c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:c,payload:f}=this.queue.shift();this.postEvent(c,f,()=>{},o)}}let Ua=new class extends Va{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,o){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>r.h(c)||r.j(c))&&this.queueRequest(Date.now(),o)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let o=dl(r.e.ACCESS_TOKEN),c=o?o.u:r.e.ACCESS_TOKEN,f=c!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),f=!0);let _=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(_),w=(_-this.eventData.lastSuccess)/864e5;f=f||w>=1||w<-1||y.getDate()!==x.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:zu,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=c)},p):this.processRequests()}},fr=Ua.postTurnstileEvent.bind(Ua),Xs=new class extends Va{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,o,c,f){this.skuToken=o,this.errorCb=f,r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(ci)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:zu,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p))}remove(){this.errorCb=null}},Jf=Xs.postMapLoadEvent.bind(Xs),ip=new class extends Va{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let o=this.mapInstanceIdMap.get(p);return o||(o=r.u(),this.mapInstanceIdMap.set(p,o)),o}getEventId(p){let o=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,o+1),o}postStyleLoadEvent(p,o){let{map:c,style:f,importedStyles:_}=o;if(!r.e.EVENTS_URL||!p&&!r.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(c),x={mapInstanceId:y,eventId:this.getEventId(y),style:f};_.length&&(x.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:x},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,payload:c}=this.queue.shift();this.postEvent(o,c,()=>{},p)}},em=ip.postStyleLoadEvent.bind(ip),zc=new hl({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Yi=zc.postMetricsEvent.bind(zc),Ir=new hl({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Go=Ir.postMetricsEvent.bind(Ir),Vu=new class extends Va{constructor(){super("gljs.performance")}postPerformanceEvent(p,o){r.e.EVENTS_URL&&(p||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,performanceData:c}=this.queue.shift(),f=(function(_){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),w=(function(N){let j={};if(N){for(let U in N)if(U!=="other")for(let W of N[U]){let q=`${U}ResolveRangeMin`,ee=`${U}ResolveRangeMax`,re=`${U}RequestCount`,te=`${U}RequestCachedCount`;j[q]=Math.min(j[q]||1/0,W.startTime),j[ee]=Math.max(j[ee]||-1/0,W.responseEnd);let ge=de=>{j[de]===void 0&&(j[de]=0),++j[de]};W.transferSize!==void 0&&W.transferSize===0&&ge(te),ge(re)}}return j})((function(N,j){let U={};if(N)for(let W of N){let q=j(W);U[q]===void 0&&(U[q]=[]),U[q].push(W)}return U})(y,X)),S=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=M?M.effectiveType:void 0,L={counters:[],metadata:[],attributes:[]},F=(N,j,U)=>{U!=null&&N.push({name:j,value:U.toString()})};for(let N in w)F(L.counters,N,w[N]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(F(L.counters,"interactionRangeMin",_.interactionRange[0]),F(L.counters,"interactionRangeMax",_.interactionRange[1])),x)for(let N of Object.values(P)){let j=x.find(U=>U.name===N);j&&F(L.counters,N,j.startTime)}return F(L.counters,"visibilityHidden",_.visibilityHidden),F(L.attributes,"style",(function(N){if(N)for(let j of N){let U=j.name.split("?")[0];if(r.i(U)){let W=U.split("/").slice(-2);if(W.length===2)return`mapbox://styles/${W[0]}/${W[1]}`}}})(y)),F(L.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),F(L.attributes,"fogEnabled",_.fogEnabled?"true":"false"),F(L.attributes,"projection",_.projection),F(L.attributes,"zoom",_.zoom),F(L.metadata,"devicePixelRatio",S),F(L.metadata,"connectionEffectiveType",A),F(L.metadata,"navigatorUserAgent",navigator.userAgent),F(L.metadata,"screenWidth",window.screen.width),F(L.metadata,"screenHeight",window.screen.height),F(L.metadata,"windowWidth",window.innerWidth),F(L.metadata,"windowHeight",window.innerHeight),F(L.metadata,"mapWidth",_.width/S),F(L.metadata,"mapHeight",_.height/S),F(L.metadata,"webglRenderer",_.renderer),F(L.metadata,"webglVendor",_.vendor),F(L.metadata,"sdkVersion",E),F(L.metadata,"sdkIdentifier","mapbox-gl-js"),L})(c);for(let _ of f.metadata);for(let _ of f.counters);for(let _ of f.attributes);this.postEvent(o,f,()=>{},p)}},Fr=Vu.postPerformanceEvent.bind(Vu),Bc=new class extends Va{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,o,c,f){if(!r.e.API_URL||!r.e.SESSION_PATH)return;let _=yr(r.e.API_URL+r.e.SESSION_PATH);_.params.push(`sku=${o||""}`),_.params.push(`access_token=${f||r.e.ACCESS_TOKEN||""}`);let y={url:Ji(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(y,x=>{this.pendingRequest=null,c(x),this.saveEventData(),this.processRequests(f)})}getSessionAPI(p,o,c,f){this.skuToken=o,this.errorCb=f,r.e.SESSION_PATH&&r.e.API_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(ci)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p)}remove(){this.errorCb=null}},Vc=Bc.getSessionAPI.bind(Bc),zs=new Set;function rs(p,o){o?zs.add(p):zs.delete(p)}class Br{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,c){this._updatedSourceCaches[o]=c,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let c=o.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(o.id),this.setDirty()}removeLayer(o){let c=o.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][o.id]=o,this._updatedLayers[c].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let c in this._updatedLayers)o[c]=o[c]||{},o[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)o[c]=o[c]||{},o[c].removedIds=Object.keys(this._removedLayers[c]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(r.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function bv(p){let{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ud extends r.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new r.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);let c=this.atlasTexture.get(o);c&&(c.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(o.id,o)}removeImageProvider(o,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(o)}getPendingImageProviders(){let o=[];for(let c of this.imageProviders.values())for(let f of c.values())f.hasPendingRequests()&&o.push(f);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(let o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,c){if(this.loaded.get(c)!==o&&(this.loaded.set(c,o),o)){for(let{ids:f,callback:_}of this.requestors)this._notify(f,c,_);this.requestors=[]}}hasImage(o,c){return!!this.getImage(o,c)}getImage(o,c){return this.images.get(c).get(o.toString())}addImage(o,c,f){this._validate(o,f)&&this.images.get(c).set(o.toString(),f)}_validate(o,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "content" value`))),f=!1),f}_validateStretch(o,c){if(!o)return!0;let f=0;for(let _ of o){if(_[0]<f||_[1]<_[0]||c<_[1])return!1;f=_[1]}return!0}_validateContent(o,c){return o?o.length!==4||!c.usvg&&(o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,c,f){let _=this.images.get(c).get(o.toString());f.version=_.version+1,this.images.get(c).set(o.toString(),f),this.updatedImages.get(c).add(o),this.removeFromImageRasterizerCache(o,c)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,c){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([o],c))}removeImage(o,c){let f=this.images.get(c),_=f.get(o.toString());f.delete(o.toString()),this.patterns.get(c).delete(o.toString()),this.removeFromImageRasterizerCache(o,c),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(c=>r.I.from(c))}getImages(o,c,f){let _=[],y=[],x=this.imageProviders.get(c);for(let A of o){if(!A.iconsetId){_.push(A);continue}let L=x.get(A.iconsetId);L&&(this.getImage(A,c)?y.push(A):L.addPendingRequest(A))}if(_.length===0)return void this._notify(y,c,f);let w=!0,S=!!this.loaded.get(c),M=this.images.get(c);if(!S)for(let A of _)M.has(A.toString())||(w=!1);S||w?this._notify(_,c,f):this.requestors.push({ids:_,scope:c,callback:f})}rasterizeImages(o,c){let f=new Map,{tasks:_,scope:y}=o;for(let[x,w]of _.entries()){let S=this.getImage(w.id,y);S&&f.set(x,{image:S,imageVariant:w})}this._rasterizeImages(y,f,c)}_rasterizeImages(o,c,f){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:o},f);else{let _=new Map;for(let[y,{image:x,imageVariant:w}]of c.entries())_.set(y,this.imageRasterizer.rasterize(w,x,o,0));f(void 0,_)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,c,f){let _=this.images.get(c),y=new Map;for(let x of o){if(!_.get(x.toString())){if(x.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:x.name}))}let w=_.get(x.toString());if(!w){r.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let S={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(S,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),y.set(r.I.toString(x),S)}f(null,y)}getPixelSize(o){let{width:c,height:f}=this.atlasImage.get(o);return{width:c,height:f}}getPattern(o,c,f){let _=o.toString(),y=this.patterns.get(c),x=y.get(_),w=this.getImage(o,c);if(!w)return null;if(x){if(x.position.version===w.version)return x.position;x.position.version=w.version}else{if(w.usvg&&!w.data){let S=this.getPatternInFlightId(_,c);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);let M=new r.A(o).scaleSelf(r.o.devicePixelRatio),A=new Map([[M.toString(),{image:w,imageVariant:M}]]);return this._rasterizeImages(c,A,(L,F)=>this.storePatternImage(M,c,w,f,F)),null}this.storePattern(o,c,w)}return this._updatePatternAtlas(c,f),y.get(_).position}getPatternInFlightId(o,c){return r.B(o,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,c,f,_,y){let x=o.toString(),w=y?y.get(x):void 0;w&&(f.data=w,this.storePattern(o.id,c,f),this._updatePatternAtlas(c,_),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),c)))}storePattern(o,c,f){let _={w:f.data.width+2*r.C,h:f.data.height+2*r.C,x:0,y:0},y=new r.F(_,f,r.C);this.patterns.get(c).set(o.toString(),{bin:_,position:y})}destroyAtlasTextures(){for(let o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,c){let f=o.gl,_=this.atlasTexture.get(c);_?this.dirty&&(_.update(this.atlasImage.get(c)),this.dirty=!1):(_=new r.T(o,this.atlasImage.get(c),f.RGBA8),this.atlasTexture.set(c,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(o,c){let f=this.patterns.get(o),_=Array.from(f.values()).map(({bin:M})=>M),{w:y,h:x}=r.G(_),w=this.atlasImage.get(o);w.resize({width:y||1,height:x||1});let S=this.images.get(o);for(let[M,{bin:A,position:L}]of f.entries()){let F=L.padding,N=A.x+F,j=A.y+F,U=S.get(M).data,W=U.width,q=U.height;F=F>1?F-1:F,r.q.copy(U,w,{x:0,y:0},{x:N,y:j},{width:W,height:q},c),r.q.copy(U,w,{x:0,y:q-F},{x:N,y:j-F},{width:W,height:F},c),r.q.copy(U,w,{x:0,y:0},{x:N,y:j+q},{width:W,height:F},c),r.q.copy(U,w,{x:W-F,y:0},{x:N-F,y:j},{width:F,height:q},c),r.q.copy(U,w,{x:0,y:0},{x:N+W,y:j},{width:F,height:q},c),r.q.copy(U,w,{x:W-F,y:q-F},{x:N-F,y:j-F},{width:F,height:F},c),r.q.copy(U,w,{x:0,y:q-F},{x:N+W,y:j-F},{width:F,height:F},c),r.q.copy(U,w,{x:0,y:0},{x:N+W,y:j+q},{width:F,height:F},c),r.q.copy(U,w,{x:W-F,y:0},{x:N-F,y:j+q},{width:F,height:F},c)}this.dirty=!0}beginFrame(){for(let o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,c){let f=this.images.get(c);for(let _ of o){if(this.callbackDispatchedThisFrame.get(c).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(_.toString());let y=f.get(_.toString());bv(y)&&this.updateImage(_,c,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Uu(p){let o=p.value,c=p.valueSpec,f=p.style,_=p.styleSpec,y=p.key,x=p.arrayElementValidator||ar;if(!Array.isArray(o))return[new r.V(y,o,`array expected, ${r.K(o)} found`)];if(c.length&&o.length!==c.length)return[new r.V(y,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new r.V(y,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let w={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};_.$version<7&&(w.function=c.function),r.H(c.value)&&(w=c.value);let S=[];for(let M=0;M<o.length;M++)S=S.concat(x({array:o,arrayIndex:M,value:o[M],valueSpec:w,style:f,styleSpec:_,key:`${y}[${M}]`},!0));return S}function Uc(p){let o=p.key,c=p.value,f=p.valueSpec;if(!r.L(c))return[new r.V(o,c,`number expected, ${r.K(c)} found`)];if(c!=c)return[new r.V(o,c,"number expected, NaN found")];if("minimum"in f){let _=f.minimum;if(Array.isArray(f.minimum)&&(_=f.minimum[p.arrayIndex]),c<_)return[new r.V(o,c,`${c} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(Array.isArray(f.maximum)&&(_=f.maximum[p.arrayIndex]),c>_)return[new r.V(o,c,`${c} is greater than the maximum value ${_}`)]}return[]}function jc(p){let o=p.key,c=p.value;if(!r.H(c))return[new r.V(o,c,`object expected, ${r.K(c)} found`)];let f=p.valueSpec,_=r.J(c.type),y,x,w,S={},M=_!=="categorical"&&c.property===void 0,A=!M,L=(function(U){let W=U.stops;return Array.isArray(W)&&Array.isArray(W[0])&&r.H(W[0][0])})(c),F=Mo({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(U){if(_==="identity")return[new r.V(U.key,U.value,'identity function may not have a "stops" property')];let W=[],q=U.value;return W=W.concat(Uu({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:N})),Array.isArray(q)&&q.length===0&&W.push(new r.V(U.key,q,"array must have at least one stop")),W},default:function(U){return ar({key:U.key,value:U.value,valueSpec:f,style:U.style,styleSpec:U.styleSpec})}}});return _==="identity"&&M&&F.push(new r.V(p.key,p.value,'missing required property "property"')),_==="identity"||c.stops||F.push(new r.V(p.key,p.value,'missing required property "stops"')),_==="exponential"&&f.expression&&!r.M(f)&&F.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(A&&!r.N(f)?F.push(new r.V(p.key,p.value,"property functions not supported")):M&&!r.O(f)&&F.push(new r.V(p.key,p.value,"zoom functions not supported"))),_!=="categorical"&&!L||c.property!==void 0||F.push(new r.V(p.key,p.value,'"property" property is required')),F;function N(U){let W=[],q=U.value,ee=U.key;if(!Array.isArray(q))return[new r.V(ee,q,`array expected, ${r.K(q)} found`)];if(q.length!==2)return[new r.V(ee,q,`array length 2 expected, length ${q.length} found`)];if(L){if(!r.H(q[0]))return[new r.V(ee,q,`object expected, ${r.K(q[0])} found`)];let re=q[0];if(re.zoom===void 0)return[new r.V(ee,q,"object stop key must have zoom")];if(re.value===void 0)return[new r.V(ee,q,"object stop key must have value")];let te=r.J(re.zoom);if(typeof te!="number")return[new r.V(ee,re.zoom,"stop zoom values must be numbers")];if(w&&w>te)return[new r.V(ee,re.zoom,"stop zoom values must appear in ascending order")];te!==w&&(w=te,x=void 0,S={}),W=W.concat(Mo({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Uc,value:j}}))}else W=W.concat(j({key:`${ee}[0]`,value:q[0],style:U.style,styleSpec:U.styleSpec},q));return r.Q(r.S(q[1]))?W.concat([new r.V(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):W.concat(ar({key:`${ee}[1]`,value:q[1],valueSpec:f,style:U.style,styleSpec:U.styleSpec}))}function j(U,W){let q=r.K(U.value),ee=r.J(U.value),re=U.value!==null?U.value:W;if(y){if(q!==y)return[new r.V(U.key,re,`${q} stop domain type must match previous stop domain type ${y}`)]}else y=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new r.V(U.key,re,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&_!=="categorical"){let te=`number expected, ${q} found`;return r.N(f)&&_===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(U.key,re,te)]}return _!=="categorical"||q!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?_!=="categorical"&&q==="number"&&typeof ee=="number"&&typeof x=="number"&&x!==void 0&&ee<x?[new r.V(U.key,re,"stop domain values must appear in ascending order")]:(x=ee,_==="categorical"&&ee in S?[new r.V(U.key,re,"stop domain values must be unique")]:(S[ee]=!0,[])):[new r.V(U.key,re,`integer expected, found ${String(ee)}`)]}}function qo(p){let o=(p.expressionContext==="property"?r.W:r.U)(r.S(p.value),p.valueSpec);if(o.result==="error")return o.value.map(f=>new r.V(`${p.key}${f.key}`,p.value,f.message));let c=o.value.expression||o.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.Z(c))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return ql(c,p);if(p.expressionContext==="appearance")return jd(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.X(c,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.Y(c))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ql(p,o){let c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.delete(_);if(c.size===0)return[];let f=[];return p instanceof r._&&c.has(p.name)?[new r.V(o.key,o.value,`["${p.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(p.eachChild(_=>{f.push(...ql(_,o))}),f)}function jd(p,o){let c=new Set;if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.add(_);if(c.size===0)return[];let f=[];return p instanceof r._&&!c.has(p.name)?[new r.V(o.key,o.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(_=>{f.push(...jd(_,o))}),f)}function ja(p){let o=p.key,c=p.value,f=p.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(r.J(c))===-1&&_.push(new r.V(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(r.J(c))===-1&&_.push(new r.V(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Wl(p){return r.a2(r.S(p.value))?qo(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):ds(p)}function ds(p){let o=p.value,c=p.key;if(!Array.isArray(o))return[new r.V(c,o,`array expected, ${r.K(o)} found`)];if(o.length<1)return[new r.V(c,o,"filter array must have at least 1 element")];let f=p.styleSpec,_=ja({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator}),y=()=>{o.length>=2&&(r.a0(o[1])||_.push(new r.V(`${c}[1]`,o[1],`string expected, ${r.K(o[1])} found`)));for(let x=2;x<o.length;x++)r.J(o[1])==="$type"?_=_.concat(ja({key:`${c}[${x}]`,value:o[x],valueSpec:f.geometry_type})):r.a0(o[x])||r.L(o[x])||r.$(o[x])||_.push(new r.V(`${c}[${x}]`,o[x],`string, number, or boolean expected, ${r.K(o[x])} found.`))};switch(r.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&r.J(o[1])==="$type"&&_.push(new r.V(c,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&_.push(new r.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"==":case"!=":o.length!==3&&_.push(new r.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"in":case"!in":y();break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)_=_.concat(ds({key:`${c}[${x}]`,value:o[x],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":o.length!==2?_.push(new r.V(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):r.a0(o[1])||_.push(new r.V(`${c}[1]`,o[1],`string expected, ${r.K(o[1])} found`))}return _}function ju(p,o){let c=p.key,f=p.style,_=p.layer,y=p.styleSpec,x=p.value,w=p.objectKey,S=y[`${o}_${p.layerType}`];if(!S)return[];let M=w.match(/^(.*)-use-theme$/);if(M&&S[M[1]])return r.Q(r.S(x))?[].concat(ar({key:c,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w})):ar({key:c,value:x,valueSpec:{type:"string"},style:f,styleSpec:y});let A=w.match(/^(.*)-transition$/);if(o==="paint"&&A&&S[A[1]]&&S[A[1]].transition)return ar({key:c,value:x,valueSpec:y.transition,style:f,styleSpec:y});let L=p.valueSpec||S[w];if(!L)return[new r.a3(c,x,`unknown property "${w}"`)];let F;if(r.a0(x)&&r.N(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(x))){let j=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(c,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let N=[];if(p.layerType==="symbol")w!=="text-field"||!f||f.glyphs||f.imports||N.push(new r.V(c,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&r.a4(r.S(x))&&r.J(x.type)==="identity"&&N.push(new r.V(c,x,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&o==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.N(L)&&(r.a5(L)||r.O(L))){let j=r.W(r.S(x),L).value,U="expression"in j&&j.expression||"_styleExpression"in j&&j._styleExpression&&j._styleExpression.expression;U&&!r.X(U,["measure-light"])&&(w==="model-emissive-strength"&&r.Y(U)&&r.Z(U)||N.push(new r.V(c,x,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(ar({key:p.key,value:x,valueSpec:L,style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w}))}function $u(p){return ju(p,"paint")}function Hu(p){return ju(p,"layout")}function $d(p){let o=[],c=p.value,f=p.key,_=p.style,y=p.styleSpec;if(!r.H(c))return[new r.V(f,c,"object expected")];c.type||c.ref||o.push(new r.V(f,c,'either "type" or "ref" is required'));let x=r.J(c.type),w=r.J(c.ref);if(c.id){let S=r.J(c.id);for(let M=0;M<p.arrayIndex;M++){let A=_.layers[M];r.J(A.id)===S&&o.push(new r.V(f,c.id,`duplicate layer id "${S}", previously used at line ${A.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&o.push(new r.V(f,c[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{r.J(M.id)===w&&(S=M)}),S?S.ref?o.push(new r.V(f,c.ref,"ref cannot reference another ref layer")):x=r.J(S.type):typeof w=="string"&&o.push(new r.V(f,c.ref,`ref layer "${w}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(c.source)if(r.a0(c.source)){let S=_.sources&&_.sources[c.source],M=S&&r.J(S.type);S?M==="vector"&&x==="raster"?o.push(new r.V(f,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&x!=="raster"?o.push(new r.V(f,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&x!=="hillshade"?o.push(new r.V(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&M==="geojson"&&!S.lineMetrics?o.push(new r.V(f,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&M!=="raster-array"&&o.push(new r.V(f,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):o.push(new r.V(f,c.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new r.V(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new r.V(f,c.source,`source "${c.source}" not found`))}else o.push(new r.V(`${f}.source`,c.source,'"source" must be a string'));else o.push(new r.V(f,c,'missing required property "source"'));return o=o.concat(Mo({key:f,value:c,valueSpec:y.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${f}.type`,value:c.type,valueSpec:y.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:S=>Wl(Object.assign({layerType:x},S)),layout:S=>Mo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Hu(Object.assign({layerType:x},M))}}),paint:S=>Mo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>$u(Object.assign({layerType:x,layer:c},M))}}),appearances(S){let M=Uu({key:S.key,value:S.value,valueSpec:S.valueSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:F=>(function(N){let{key:j,layer:U,layerType:W}=N,q=r.J(N.value),ee=r.J(q.name),re=r.J(q.condition),te=Mo({key:j,value:q,valueSpec:N.styleSpec.appearance,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{condition:ge=>(function(de){let fe=[];return fe.push(...qo({key:de.key,value:de.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),fe})(Object.assign({layer:U,layerType:W},ge)),properties:ge=>(function(de){let fe=[],{styleSpec:ue,layer:ae,layerType:_e}=de,Te=ue[`paint_${_e}`],Ce=ue[`layout_${_e}`],Be=de.object[de.objectKey];for(let Ue in Be){let Ye=Ue in Te?"paint":Ue in Ce?"layout":void 0;if(!Ye){fe.push(new r.V(de.key,Ue,`unknown property "${Ue}" for layer type "${_e}"`));continue}let dt=Object.assign({},de,{key:`${de.key}.${Ue}`,object:Be,objectKey:Ue,layer:ae,layerType:_e,value:Be[Ue],valueSpec:Ye==="paint"?Te[Ue]:Ce[Ue]});fe.push(...ju(dt,Ye))}return fe})(Object.assign({layer:U,layerType:W},ge))}});return ee!=="hidden"&&re===void 0&&te.push(new r.V(N.key,"name",'Appearance with name different than "hidden" must have a condition')),te})(Object.assign({layerType:x,layer:c},F))}),A=Array.isArray(S.value)?S.value:[],L=new Set;return A.forEach((F,N)=>{let j=r.J(F.name);if(j)if(L.has(j)){let U=r.J(c.id);M.push(new r.V(S.key,j,`Duplicated appearance name "${j}" for layer "${U}"`))}else L.add(j)}),M}}})),o}function bo({key:p,value:o}){return r.a0(o)?[]:[new r.V(p,o,`string expected, ${r.K(o)} found`)]}let Es={promoteId:function p({key:o,value:c}){if(r.a0(c))return bo({key:o,value:c});if(Array.isArray(c)){let _=[],y=r.S(c),x=r.U(y);return x.result==="error"&&x.value.forEach(w=>{_.push(new r.V(`${o}${w.key}`,null,`${w.message}`))}),r.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new r.V(`${o}`,null,"promoteId expression should be only feature dependent")),_}if(!r.H(c))return[new r.V(o,c,`string, expression or object expected, "${r.K(c)}" found`)];let f=[];for(let _ in c)f.push(...p({key:`${o}.${_}`,value:c[_]}));return f}};function rp(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!r.H(o))return[new r.V(c,o,`object expected, ${r.K(o)} found`)];if(!("type"in o))return[new r.V(c,o,'"type" is required')];let y=r.J(o.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in o||"tiles"in o||x.push(new r.a3(c,o,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Mo({key:c,value:o,valueSpec:f[`source_${y.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:Es})),x;case"geojson":if(x=Mo({key:c,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Es}),"cluster"in o&&"clusterProperties"in o){if(!r.H(o.clusterProperties))return[new r.V(`${c}.clusterProperties`,o,`object expected, ${r.K(o)} found`)];for(let w in o.clusterProperties){let S=o.clusterProperties[w];if(!Array.isArray(S))return[new r.V(`${c}.clusterProperties.${w}`,S,"array expected")];let[M,A]=S,L=typeof M=="string"?[M,["accumulated"],["get",w]]:M;x.push(...qo({key:`${c}.${w}.map`,value:A,expressionContext:"cluster-map"})),x.push(...qo({key:`${c}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}}return x;case"video":return Mo({key:c,value:o,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Mo({key:c,value:o,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new r.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ja({key:`${c}.type`,value:o.type,valueSpec:{values:$c(f)}})}}function $c(p){return p.source.reduce((o,c)=>{let f=p[c];return f.type.type==="enum"&&(o=o.concat(Object.keys(f.type.values||{}))),o},[])}function pl(p){let o=p.value,c=p.styleSpec,f=c.light,_=p.style;if(o===void 0)return[];if(!r.H(o))return[new r.V("light",o,`object expected, ${r.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&f[S[1]]?ar({key:x,value:o[x],valueSpec:{type:"string"},style:_,styleSpec:c}):w&&f[w[1]]&&f[w[1]].transition?ar({key:x,value:o[x],valueSpec:c.transition,style:_,styleSpec:c}):f[x]?ar({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}):[new r.V(x,o[x],`unknown property "${x}"`)])}return y}function Zl(p){let o=p.value;if(!o)return[];let c=p.key;if(!r.H(o))return[new r.V(c,o,`object expected, ${r.K(o)} found`)];let f=[],_=p.styleSpec,y=_["light-3d"],x=p.style,w=p.style.lights;for(let A of["type","id"])if(!(A in o))return f=f.concat([new r.V(c,o,`missing property "${A}"`)]),f;if(!r.a0(o.type))return f=f.concat([new r.V(`${c}.type`,o.type,"string expected")]),f;if(w)for(let A=0;A<p.arrayIndex;A++){let L=r.J(o.type),F=w[A];r.J(F.type)===L&&f.push(new r.V(c,o.id,`duplicate light type "${o.type}", previously defined at line ${F.id.__line__}`))}let S=`properties_light_${o.type}`;if(!(S in _))return f=f.concat([new r.V(`${c}.type`,o,`Invalid light type ${o.type}`)]),f;let M=_[S];for(let A in o)if(A==="properties"){let L=o[A];if(!r.H(L))return f=f.concat([new r.V("properties",L,`object expected, ${r.K(L)} found`)]),f;for(let F in L){let N=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);f=f.concat(j&&M[j[1]]?ar({key:A,value:L[F],valueSpec:{type:"string"},style:x,styleSpec:_}):N&&M[N[1]]&&M[N[1]].transition?ar({key:A,value:o[A],valueSpec:_.transition,style:x,styleSpec:_}):M[F]?ar({key:F,value:L[F],valueSpec:M[F],style:x,styleSpec:_}):[new r.a3(p.key,L[F],`unknown property "${F}"`)])}}else f=f.concat(y[A]?ar({key:A,value:o[A],valueSpec:y[A],style:x,styleSpec:_}):[new r.a3(A,o[A],`unknown property "${A}"`)]);return f}function $a(p){let o=p.value,c=p.key,f=p.style,_=p.styleSpec,y=_.terrain;if(o==null)return[];if(!r.H(o))return[new r.V("terrain",o,`object expected, ${r.K(o)} found`)];let x=[];for(let w in o){let S=w.match(/^(.*)-transition$/),M=w.match(/^(.*)-use-theme$/);x=x.concat(M&&y[M[1]]?ar({key:w,value:o[w],valueSpec:{type:"string"},style:f,styleSpec:_}):S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:o[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:o[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,o[w],`unknown property "${w}"`)])}if(o.source)if(r.a0(o.source)){let w=f.sources&&f.sources[o.source],S=w&&r.J(w.type);w?S!=="raster-dem"&&x.push(new r.V(`${c}.source`,o.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):x.push(new r.V(`${c}.source`,o.source,`source "${o.source}" not found`))}else x.push(new r.V(`${c}.source`,o.source,"source must be a string"));else x.push(new r.V(c,o,'terrain is missing required property "source"'));return x}function op(p){let o=p.value,c=p.style,f=p.styleSpec,_=f.fog;if(o===void 0)return[];if(!r.H(o))return[new r.V("fog",o,`object expected, ${r.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&_[S[1]]?ar({key:x,value:o[x],valueSpec:{type:"string"},style:c,styleSpec:f}):w&&_[w[1]]&&_[w[1]].transition?ar({key:x,value:o[x],valueSpec:f.transition,style:c,styleSpec:f}):_[x]?ar({key:x,value:o[x],valueSpec:_[x],style:c,styleSpec:f}):[new r.a3(x,o[x],`unknown property "${x}"`)])}return y}let Gu={"*":()=>[],array:Uu,boolean:function(p){let o=p.value,c=p.key;return r.$(o)?[]:[new r.V(c,o,`boolean expected, ${r.K(o)} found`)]},number:Uc,color:function({key:p,value:o}){return r.a0(o)?r.a1.parseCSSColor(o)===null?[new r.V(p,o,`color expected, "${o}" found`)]:[]:[new r.V(p,o,`color expected, ${r.K(o)} found`)]},enum:ja,filter:Wl,function:jc,layer:$d,object:Mo,source:rp,model:r.a7,light:pl,"light-3d":Zl,terrain:$a,fog:op,string:bo,formatted:function(p){return bo(p).length===0?[]:qo(p)},resolvedImage:function(p){return bo(p).length===0?[]:qo(p)},projection:function(p){let o=p.value,c=p.styleSpec,f=c.projection,_=p.style;if(r.H(o)){let y=[];for(let x in o)y=y.concat(ar({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}));return y}return r.a0(o)?[]:[new r.V("projection",o,`object or string expected, ${r.K(o)} found`)]},import:function(p){let o=p.key,{value:c,styleSpec:f}=p;if(!r.H(c))return[new r.V(o,c,"import must be an object")];let w=c,{data:_}=w,y=bw(w,["data"]);Object.defineProperty(y,"__line__",{value:c.__line__,enumerable:!1});let x=Mo(Object.assign({},p,{value:y,valueSpec:f.import}));return r.J(y.id)===""&&x.push(new r.V(`${p.key}.id`,y,"import id can't be an empty string")),_&&(x=x.concat(qu(_,f,{key:`${p.key}.data`}))),x},iconset:function(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!r.H(o))return[new r.V(c,o,"object expected")];if(!o.type)return[new r.V(c,o,'"type" is required')];let y=r.J(o.type),x=[];if(x=x.concat(Mo({key:c,value:o,valueSpec:f[`iconset_${y}`],style:_,styleSpec:f})),(function(w,S){return!(w!=="source"||!S.source)})(y,o)){let w=_.sources&&_.sources[o.source],S=w&&r.J(w.type);w?S!=="raster-array"&&x.push(new r.V(c,o.source,`iconset cannot be used with a source of type ${String(S)}, it only be used with a "raster-array" source type`)):x.push(new r.V(c,o.source,`source "${o.source}" not found`))}return x}};function ar(p,o=!1){let c=p.value,f=p.valueSpec,_=p.styleSpec;if(f.expression){if(r.a4(r.J(c)))return jc(p);if(r.Q(r.S(c)))return qo(p)}if(f.type&&Gu[f.type]){let y=Gu[f.type](p);return o===!0&&y.length>0&&Array.isArray(p.value)?qo(p):y}return Mo(Object.assign({},p,{valueSpec:f.type?_[f.type]:f}))}function Mo(p){let o=p.key,c=p.value,f=p.valueSpec||{},_=p.objectElementValidators||{},y=p.style,x=p.styleSpec;if(!r.H(c))return[new r.V(o,c,`object expected, ${r.K(c)} found`)];let w=[];for(let S in c){let M=S.split(".")[0],A;_[M]?A=_[M]:f[M]?A=ar:_["*"]?A=_["*"]:f["*"]&&(A=ar),A?w=w.concat(A({key:(o&&`${o}.`)+S,value:c[S],valueSpec:f[M]||f["*"],style:y,styleSpec:x,object:c,objectKey:S},c)):w.push(new r.a3(o,c[S],`unknown property "${S}"`))}for(let S in f){if(_[S])continue;let M=f[S];M.required&&M.default===void 0&&c[S]===void 0&&w.push(new r.V(o,c,`missing required property "${S}"`))}return w}function tm({key:p,value:o}){let c=bo({key:p,value:o});if(c.length)return c;let f=o;return f.indexOf("{fontstack}")===-1&&c.push(new r.V(p,o,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&c.push(new r.V(p,o,'"glyphs" url must include a "{range}" token')),c}function qu(p,o=r.a6,c={}){return Mo({key:c.key||"",value:p,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:p,objectElementValidators:{glyphs:tm}})}function Ha(p,o=r.a6){return K(qu(p,o))}let nm=p=>K(rp(p)),ot=p=>K(pl(p)),Yl=p=>K(Zl(p)),wv=p=>K($a(p)),Wu=p=>K(op(p)),Zn=p=>K((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.snow;if(c===void 0)return[];if(!r.H(c))return[new r.V("snow",c,`object expected, ${r.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),os=p=>K((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.rain;if(c===void 0)return[];if(!r.H(c))return[new r.V("rain",c,`object expected, ${r.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),Cv=p=>K($d(p)),Zu=p=>K(Wl(p)),sp=p=>K($u(p)),Re=p=>K(Hu(p)),G=p=>K(r.a7(p));function K(p){return p.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function se(p,o){let c=!1;if(o&&o.length)for(let f of o)f instanceof r.a3?r.w(f.message):(p.fire(new r.y(new Error(f.message))),c=!0);return c}let xe=r.a6.light,ve;class Ee extends r.E{constructor(o,c="flat"){super(),this._transitionable=new r.a8(ve||(ve=new r.a9({anchor:new r.aa(xe.anchor),position:new r.ab(xe.position),color:new r.aa(xe.color),intensity:new r.aa(xe.intensity)}))),this.setLight(o,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c,f={}){this._validate(ot,o,f)||(this._transitionable.setTransitionOrValue(o),this.id=c)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&se(this,o.call(Ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let ze=r.a6.terrain,Pe=class extends r.E{constructor(p,o,c,f,_){super(),this.scope=c,this._transitionable=new r.a8(new r.a9({source:new r.aa(ze.source),exaggeration:new r.aa(ze.exaggeration)}),c,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=_}get(){return this._transitionable.serialize()}set(p,o){this._transitionable.setTransitionOrValue(p,o)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let p=this._transitionable._values.exaggeration;if(!p)return null;let o=p.value.expression;if(!o)return null;let c=-1,f=-1,_=1;for(let y of o.zoomStops)_=o.evaluate(new r.ac(y,{worldview:this.worldview})),_>.01?(c=y,f=-1):f=y;return _<.01&&c>0&&f>c?[c,f]:null}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.ad}},Ne=45,ut=65,Xe=.05;function kt(p,o,c,f){let _=r.ah(Ne,ut,c),[y,x]=Qt(p,f),w=1-Math.min(1,Math.exp((o-y)/(x-y)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*_*p.alpha}function Qt(p,o){let c=.5/Math.tan(.5*o);return[p.range[0]+c,p.range[1]+c]}function At(p,o,c,f,_){let y=r.af([],[o,c,f],_.mercatorFogMatrix);return kt(p,r.ag(y),_.pitch,_._fov)}function xn(p,o,c,f,_,y,x){let w=[[c,f,0],[_,f,0],[_,y,0],[c,y,0]],S=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let A of w){let L=r.af([],A,o),F=r.ag(L);S=Math.min(S,F),M=Math.max(M,F)}return[kt(p,S,x.pitch,x._fov),kt(p,M,x.pitch,x._fov)]}let vn=r.a6.fog;class gn extends r.E{constructor(o,c,f,_){super();let y=new r.a9({range:new r.aa(vn.range),color:new r.aa(vn.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(vn["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(vn["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(vn["horizon-blend"]),"star-intensity":new r.aa(vn["star-intensity"]),"vertical-range":new r.aa(vn["vertical-range"])});this._transitionable=new r.a8(y,f,new Map(_)),this.set(o,_),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new r.ai(y),this.scope=f}get state(){let o=this._transform,c=o.projection.name==="globe",f=r.aj(o.zoom),_=this.properties.get("range"),y=[.5,3];return{range:c?[r.ak(y[0],_[0],f),r.ak(y[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c,f={}){if(this._validate(Wu,o,f))return;let _=Object.assign({},o);for(let y of Object.keys(vn))_[y]===void 0&&(_[y]=vn[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Ne,ut,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?(function(f,_,y){let x=r.ae.fromLngLat(_),w=y.elevation?y.elevation.getAtPointOrZero(x):0;return At(f,x.x,x.y,w,y)})(this.state,o,c):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(o.toUnwrapped());return xn(this.state,c,0,0,r.al,r.al,this._transform)}getOpacityForBounds(o,c,f,_,y){return this._transform.projection.supportsFog?xn(this.state,o,c,f,_,y,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Qt(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let f of c){let _=o.points[f],y;if(_[2]>=0)y=_;else{let x=o.points[f-4];y=r.am(x,_,x[2]/(x[2]-_[2]))}if(At(this.state,y[0],y[1],0,this._transform)>=Xe)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&se(this,o.call(Ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Un,mr,Vr,xr,Zr=class extends r.E{constructor(p,o,c,f){super();let _=Un||(Un=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=r.an(c[0]),_=-Math.max(r.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(Zn,p,c))return;let f=Object.assign({},p),_=r.a6.snow;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&se(this,p.call(Ha,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},lr=class extends r.E{constructor(p,o,c,f){super();let _=mr||(mr=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=r.an(c[0]),_=-Math.max(r.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(os,p,c))return;let f=Object.assign({},p),_=r.a6.rain;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&se(this,p.call(Ha,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Gn extends r.E{constructor(o,c,f,_){super(),this.scope=f,this._options=o,this.properties=new r.ai(c),this._transitionable=new r.a8(c,f,new Map(_)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,c){this._options=o,this._transitionable.setTransitionOrValue(o.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class cr{constructor(o,c,f){this.screenBounds=o,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(o,c){let f,_;if(o instanceof r.P||typeof o[0]=="number"){let y=r.P.convert(o);f=[y],_=c.isPointAboveHorizon(y)}else{let y=r.P.convert(o[0]),x=r.P.convert(o[1]),w=y.add(x)._div(2);f=[y,x],_=r.aq(y,x).every(S=>c.isPointAboveHorizon(S))&&c.isPointAboveHorizon(w)}return new cr(f,_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),r.ar(_,o)}bufferedCameraGeometryGlobe(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(c,f,o),y=this.cameraPoint.clone();switch(3*((y.y>c.y)+(y.y>f.y))+((y.x>c.x)+(y.x>f.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(o,c,f,_=0){let y=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,x=f?this._bufferedCameraMercator(y,c):this._bufferedScreenMercator(y,c),w=o.tileID.wrap+(x.unwrapped?_:0),S=x.polygon.map(W=>r.as(o.tileTransform,W,w));if(!r.at(S,0,0,r.al,r.al))return;w=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let M=this.screenGeometryMercator.polygon.map(W=>r.au(o.tileTransform,W,w)),A=M.map(W=>new r.P(W[0],W[1])),L=c.getFreeCameraOptions().position||new r.ae(0,0,0),F=r.au(o.tileTransform,L,w),N=M.map(W=>{let q=r.av(W,W,F);return r.aw(q,q),new r.ax(F,q)}),j=r.ay(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:N,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(U=r.az(S),U.min.x=r.aA(U.min.x,0,r.al),U.min.y=r.aA(U.min.y,0,r.al),U.max.x=r.aA(U.max.x,0,r.al),U.max.y=r.aA(U.max.y,0,r.al),U),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(o,c){let f=br(o);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(o,c){let f=br(o);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(o,c){let f=(function(y,x){let w=r.aB([],x.pixelMatrix,x.globeMatrix),S=[0,-r.aD,0,1],M=[0,r.aD,0,1],A=[0,0,0,1];r.aC(S,S,w),r.aC(M,M,w),r.aC(A,A,w);let L=new r.P(S[0]/S[3],S[1]/S[3]),F=new r.P(M[0]/M[3],M[1]/M[3]),N=r.aE(y,L)&&S[3]<A[3],j=r.aE(y,F)&&M[3]<A[3];if(!N&&!j)return null;let U=(function(fe,ue,ae){for(let _e=1;_e<fe.length;_e++){let Te=kn(ue.pointCoordinate3D(fe[_e-1]).x),Ce=kn(ue.pointCoordinate3D(fe[_e]).x);if(ae<0){if(Te<Ce)return{idx:_e,t:-Te/(Ce-1-Te)}}else if(Ce<Te)return{idx:_e,t:(1-Te)/(Ce+1-Te)}}return null})(y,x,N?-1:1);if(!U)return null;let{idx:W,t:q}=U,ee=W>1?Pi(y.slice(0,W),x):[],re=W<y.length?Pi(y.slice(W),x):[];ee=ee.map(fe=>new r.P(kn(fe.x),fe.y)),re=re.map(fe=>new r.P(kn(fe.x),fe.y));let te=[...ee];te.length===0&&te.push(re[re.length-1]);let ge=r.ak(te[te.length-1].y,(re.length===0?ee[0]:re[0]).y,q),de;return de=N?[new r.P(0,ge),new r.P(0,0),new r.P(1,0),new r.P(1,ge)]:[new r.P(1,ge),new r.P(1,1),new r.P(0,1),new r.P(0,ge)],te.push(...de),re.length===0?te.push(ee[0]):te.push(...re),{polygon:te.map(fe=>new r.ae(fe.x,fe.y)),unwrapped:!1}})(o,c);if(f)return f;let _=(function(y,x){let w=!1,S=-1/0,M=0;for(let L=0;L<y.length-1;L++)y[L].x>S&&(S=y[L].x,M=L);for(let L=0;L<y.length-1;L++){let F=(M+L)%(y.length-1),N=y[F],j=y[F+1];Math.abs(N.x-j.x)>.5&&(N.x<j.x?(N.x+=1,F===0&&(y[y.length-1].x+=1)):(j.x+=1,F+1===y.length-1&&(y[0].x+=1)),w=!0)}let A=r.aF(x.center.lng);return w&&A<Math.abs(A-1)&&y.forEach(L=>{L.x-=1}),{polygon:y,unwrapped:w}})(Pi(o,c).map(y=>new r.P(kn(y.x),y.y)),c);return{polygon:_.polygon.map(y=>new r.ae(y.x,y.y)),unwrapped:_.unwrapped}}}function Pi(p,o){return r.aG(p,c=>{let f=o.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function kn(p){return p<0?1+p%1:p%1}function br(p){return 100*p|0}function ko(p,o,c,f,_){let y=function(w,S){if(w)return _(w);if(S){if(p.url&&S.tiles&&p.tiles&&delete p.tiles,S.variants){if(!Array.isArray(S.variants))return _(new Error("variants must be an array"));for(let A of S.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return _(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){S=Object.assign(S,A);break}}}let M=r.aH(Object.assign({},S,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=o.canonicalizeTileset(M,p.url),_(null,M)}},x=(function(w,S,M){if(!w)return null;if(!S&&!M)return w;M=M||w.worldview_default;let A=Object.values(w.language||{});if(A.length===0)return null;let L=Object.values(w.worldview||{});if(L.length===0)return null;let F=A.every(j=>j===S),N=L.every(j=>j===M);return F&&N?w:S in(w.language_options||{})||M in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null})(p.data,c,f);return x?r.o.frame(()=>y(null,x)):p.url?r.m(o.transformRequest(o.normalizeSourceURL(p.url,null,c,f),r.R.Source),y):r.o.frame(()=>{let M=p,{data:w}=M,S=bw(M,["data"]);y(null,S)})}function Wo(p,o){let c=Math.pow(2,o.z),f=Math.floor(r.aF(p.getWest())*c),_=Math.floor(r.aJ(p.getNorth())*c),y=Math.ceil(r.aF(p.getEast())*c),x=Math.ceil(r.aJ(p.getSouth())*c);return o.x>=f&&o.x<y&&o.y>=_&&o.y<x}class Ss{constructor(o,c,f){this.bounds=o?r.aI.convert(this.validateBounds(o)):null,this.minzoom=c||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(let c of o)this.extraBounds.push(r.aI.convert(this.validateBounds(c)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Wo(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(let c of this.extraBounds)if(Wo(c,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;let c=new Ss(o.bounds,o.minzoom,o.maxzoom);return c.addExtraBounds(o.extra_bounds),c}}class Yu extends r.E{constructor(o,c,f,_){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.aK}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=ko(this._options,this.map._requestManager,c,f,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.y(_));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Ss.fromTileJSON(y),fr(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,c){let f=o.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),y=this.map._requestManager.transformRequest(_,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w=x?{image:x.image.clone()}:null,S={request:y,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(f)&&(S.localizableLayerIds=this.localizableLayerIds),S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",S,M.bind(this));else if(o.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",S,M.bind(this),void 0,!0);else{let A=r.aL.call({deduped:this._deduped},S,(L,F)=>{if(L||!F)M.call(this,L);else{let N=r.aM(F.responseHeaders);S.data={rawData:F.rawData.slice(0),expires:N.expires,cacheControl:N.cacheControl},o.actor&&o.actor.send("loadTile",S,M.bind(this),void 0,!0)}},!0);o.request={cancel:A}}function M(A,L){return delete o.request,o.aborted?c(null):A&&A instanceof r.aN&&A.status!==404?c(A):(L&&L.resourceTiming&&(o.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&o.setExpiryData(L),o.loadVectorData(L,this.map.painter),r.aO(this.dispatcher),c(null,L),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wo extends r.E{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,r.aH(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let c=this.map.getWorldview();this._tileJSONRequest=ko(this._options,this.map._requestManager,null,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new r.y(f)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Ss.fromTileJSON(_),fr(_.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(f)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){let f=r.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);o.request=r.n(this.map._requestManager.transformRequest(_,r.R.Tile),(y,x,w)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(y)return o.state="errored",c(y);if(!x)return c(null);let S=r.aM(w);this.map._refreshExpiredTiles&&o.setExpiryData(S),o.setTexture(x,this.map.painter),o.state="loaded",r.aO(this.dispatcher),c(null)})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c&&c()}unloadTile(o,c){o.texture&&o.texture instanceof r.T?(o.destroy(!1),o.texture&&o.texture instanceof r.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ks([p,o],c,f,{scaled:_=!0}={}){let{tileSize:y,buffer:x}=f,{x:w,y:S,z:M}=c;if(!isFinite(w)||!isFinite(S)||!isFinite(M))throw new Error("Invalid MRT header");let A=2**M,L=A*r.aF(p),F=A*r.aJ(o);return(function([N,j],U,{scaled:W=!0}={}){if(!U)throw new Error("bandView is undefined");let{data:q,tileSize:ee,buffer:re,offset:te,scale:ge,dimension:de}=U;if(N<-re||N>ee+re||j<-re||j>ee+re)throw new Error(`Point (${N}, ${j}) out of bounds for tileSize=${ee}, buffer=${re}`);let fe=(j+re)*(ee+2*re)+(N+re);if(new Uint32Array(q.buffer)[fe]===4294967295)return null;let ue=[];ue=W?[]:new U.data.constructor(de);for(let ae=0;ae<de;ae++)ue[ae]=Math.round(1e12*(q[de*fe+ae]*ge+te))/1e12;return ue})([Math.min(Math.max(-x,Math.floor((L-w)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((F-S)*y)),y-1+x)],f,{scaled:_})}class ss extends wo{constructor(o,c,f,_){super(o,c,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(o){let c=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);c&&c.enabled&&f&&c._clearRenderCacheForTile(f.id,o.tileID),this.map.triggerRepaint()}loadTile(o,c){let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile),y={request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=_,o.actor||(o.actor=this.dispatcher.getActor());let x=(w,S,M)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(w)return w.name==="AbortError"?void 0:(o.state="errored",c(w));if(this.map._refreshExpiredTiles&&S){let A=r.aM(M);o.setExpiryData(A)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!S)return c(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=S}c(null)};o.request=this.partial?o.fetchHeader(void 0,x.bind(this)):o.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){let f=o.texturePerLayer;if(o.flushAllQueues(),f.size){o.destroy(!1);for(let _ of f.values())this.map.painter.saveTileTexture(_)}else o.destroy()}prepareTile(o,c,f,_){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(c,f,_,(y,x)=>{if(y)return o.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(o);x&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(f,x,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let c=this.rasterLayers.find(({id:y})=>y===o),f=c&&c.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(o,c,f){if(!o)return;let _=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;c instanceof r.aR?y=c.paint.get("raster-array-band"):c instanceof r.aS&&(y=c.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(_);if(x==null)return;if(!o.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(o,_,c.id,x);if(o.updateNeeded(c.id,x)&&!f)return;let w=o.textureDescriptorPerLayer.get(c.id);return Object.assign({},w,{texture:o.texturePerLayer.get(c.id)})}getImages(o,c){let f=new Map;for(let _ of o)for(let y of c){let[x,w]=y.split("/"),S=_.getLayer(x);if(!S||!S.hasBand(w)||!S.hasDataForBand(w))continue;let{bytes:M,tileSize:A,buffer:L}=S.getBandView(w),F=A+2*L,N={data:new r.q({width:F,height:F},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(y,N)}return f}queryRasterArrayValueByBandId(o,c,f){let _=c._mrt;return new Promise(y=>{let x={},w=new Set;for(let[S,M]of Object.entries(_.layers)){if(f.layerName&&S!==f.layerName)continue;let A={};x[S]=A;for(let{bands:L}of M.dataIndex)for(let F of L)f.bands&&!f.bands.includes(F)||(w.add(r.B(S,F)),c.fetchBand(S,null,F,N=>{r.o.frame(()=>{A[F]=N?null:Ks([o.lng,o.lat],_,M.getBandView(F)),w.delete(r.B(S,F)),w.size===0&&y(x)})},!1))}w.size===0&&y(x)})}_loadTileForQuery(o,c){if(this._loadTileLoaded[o.uid])return void c(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(c);this._loadTilePending[o.uid]=[c];let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile);o.actor.send("loadTile",{request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,w)=>{if(y)return this._loadTilePending[o.uid].forEach(S=>S(y,null)),void delete this._loadTilePending[o.uid];if(!x)return this._loadTilePending[o.uid].forEach(S=>S(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&x){let S=r.aM(w);o.setExpiryData(S)}o._mrt=x,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(S=>S(null,x)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,c,f){return new Promise((_,y)=>{this._loadTileForQuery(c,(x,w)=>{x?y(x):_(w?this.queryRasterArrayValueByBandId(o,c,f):null)})})}queryRasterArrayValue(o,c){let f=r.aT.convert(o),_=this.findLoadedParent(f);return _&&_._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(f,_,c):this.queryRasterArrayValueByAllBands(f,_,c):Promise.resolve(null)}findLoadedParent(o){let c=r.ae.fromLngLat(o,this.map.transform.tileSize),f=this.maxzoom+1,_=1<<f,y=Math.floor(c.x),x=Math.floor((c.x-y)*_),w=Math.floor(c.y*_),S=this.map.style.getSourceCache(this.id),M=new r.aQ(f,y,f,x,w);return S.findLoadedParent(M,this.minzoom)}}let fl={vector:Yu,raster:wo,"raster-dem":class extends wo{constructor(p,o,c,f){super(p,o,c,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(p.state="errored",o(_)),y&&(p.dem=y,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=r.n(this.map._requestManager.transformRequest(c,r.R.Tile),(function(_,y,x){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(_)p.state="errored",o(_);else if(y){let w=r.aM(x);this.map._refreshExpiredTiles&&p.setExpiryData(w);let S=ImageBitmap&&y instanceof ImageBitmap&&r.r(),M=1-(y.width-r.aP(y.width))/2;M<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let A=S?y:r.o.getImageData(y,M),L={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:M};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",L,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let o=p.canonical,c=Math.pow(2,o.z),f=(o.x-1+c)%c,_=o.x===0?p.wrap-1:p.wrap,y=(o.x+1+c)%c,x=o.x+1===c?p.wrap+1:p.wrap,w={};return w[new r.aQ(p.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y).key]={backfilled:!1},o.y>0&&(w[new r.aQ(p.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y-1).key]={backfilled:!1}),o.y+1<c&&(w[new r.aQ(p.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y+1).key]={backfilled:!1}),w}},"raster-array":ss,geojson:class extends r.E{constructor(p,o,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let _=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:r.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let o=new Map;for(let c of this._data.features)o.set(c.id,c);for(let c of p.features)o.set(c.id,c);this._data.features=[...o.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterLeaves(p,o,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:o,offset:c},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;let o=Object.assign({append:p},this.workerOptions);o.scope=this.scope;let c=this._data;typeof c=="string"?(o.request=this.map._requestManager.transformRequest(r.o.resolveURL(c),r.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new r.y(f));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let p=r.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,o){let c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,x,(w,S)=>y&&!S?(p.state="loaded",o(null)):(delete p.request,p.destroy(!1),p.aborted?o(null):w?o(w):(p.loadVectorData(S,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,o){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aU{constructor(p,o,c,f){super(p,o,c,f),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.R.Source).url);r.aV(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new r.y(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aU,model:r.aX,"batched-model":class extends r.E{constructor(p,o,c,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();let p=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=ko(this._options,this.map._requestManager,o,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.y(f))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new Ss(_.bounds,this.minzoom,this.maxzoom)),fr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=o;else{if(p.buckets){let y=Object.values(p.buckets);for(let x of y)x.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,_.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(y,x){return p.aborted?o(null):y&&y.status!==404?o(y):(this.map._refreshExpiredTiles&&x&&p.setExpiryData(x),p.loadModelData(x,this.map.painter),p.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aU{constructor(p,o,c,f){super(p,o,c,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new r.y(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,o,c,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ss(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:o,y:c,z:f}=p.canonical;return this._implementation.hasTile({x:o,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){let{x:c,y:f,z:_}=p.tileID.canonical,y=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:_},{signal:y.signal})).then((function(x){return delete p.request,p.aborted?(p.state="unloaded",o(null)):x===void 0?(p.state="errored",o(null)):x===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null)):(function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement})(x)?(this.loadTileData(p,x),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(p.state="errored",o(x))}),p.request.cancel=()=>y.abort()}loadTileData(p,o){p.setTexture(o,this.map.painter)}unloadTile(p,o){if(p.texture&&p.texture instanceof r.T?(p.destroy(!1),p.texture&&p.texture instanceof r.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:c,y:f,z:_}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:_})}o&&o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=r.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},ho=function(p,o,c,f){let _=new fl[o.type](p,o,c,f);if(_.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${_.id}`);return r.aY(["load","abort","unload","serialize","prepare"],_),_};function Xu(p,o,c=""){return`${c}:${o.id||""}:${o.layer.id}:${(function(f){if("layerId"in f)return`layer:${f.layerId}`;{let{featuresetId:_,importId:y}=f;return`featureset:${_}${y?`:import:${y}`:""}`}})(p.target)}`}function Hd(p,o,c,f=""){if(p.uniqueFeatureID){let _=Xu(p,o,f);if(c.has(_))return!0;c.add(_)}return!1}function im(p,o,c,f,_=!1){let y=o.sourceCache.transform,x=o.sourceCache.tilesIn(p,o.has3DLayers,_);x.sort(ap);let w=[];for(let S of x){let M=S.tile.queryRenderedFeatures(o,S,c,f,y,_);Object.keys(M).length&&w.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:M})}for(let S in o.layers){let M=o.layers[S];if(M.styleLayer){let A=M.styleLayer.queryRenderedFeatures(p,o.sourceCache,f);Object.keys(A).length&&w.push({wrappedTileID:0,queryResults:A})}}return w.length===0?{}:(function(S){let M={},A={};for(let L of S){let F=L.queryResults,N=L.wrappedTileID,j=A[N]=A[N]||{};for(let U in F){let W=F[U],q=j[U]=j[U]||{},ee=M[U]=M[U]||[];for(let re of W)q[re.featureIndex]||(q[re.featureIndex]=!0,ee.push(re))}}return M})(w)}function rm(p,o,c,f,_,y){let x={},w=f.queryRenderedSymbols(p),S=[];for(let M of Object.keys(w).map(Number))S.push(_[M]);S.sort(ap);for(let M of S){let A=M.featureIndex.lookupSymbolFeatures(w[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,o,c,y);for(let L in A){let F=x[L]=x[L]||[],N=A[L];N.sort((j,U)=>{let W=M.featureSortOrder;if(W){let q=W.indexOf(j.featureIndex);return W.indexOf(U.featureIndex)-q}return U.featureIndex-j.featureIndex});for(let j of N)F.push(j)}}return x}function om(p,o){let c=p.getRenderableIds().map(y=>p.getTileByID(y)),f=[],_={};for(let y=0;y<c.length;y++){let x=c[y],w=x.tileID.canonical.key;_[w]||(_[w]=!0,x.querySourceFeatures(f,o))}return f}function ap(p,o){let c=p.tileID,f=o.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function ml(p,o){let c={};if(!o)return c;for(let f of p){let _=f.layerIds.map(y=>o.getLayer(y)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(y=>_.filter(x=>x.id===y)[0]));for(let y of _)c[y.fqid]=f}}return c}let Ts=32,Ga=33,qa=new Uint16Array(8184);for(let p=0;p<2046;p++){let o=p+2,c=0,f=0,_=0,y=0,x=0,w=0;for(1&o?_=y=x=Ts:c=f=w=Ts;(o>>=1)>1;){let M=c+_>>1,A=f+y>>1;1&o?(_=c,y=f,c=x,f=w):(c=_,f=y,_=x,y=w),x=M,w=A}let S=4*p;qa[S+0]=c,qa[S+1]=f,qa[S+2]=_,qa[S+3]=y}let va=new Uint16Array(2178),gl=new Uint8Array(1089),Hc=new Uint16Array(1089);function Ku(p){return p===0?-.03125:p===32?.03125:0}let sm={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class Qu{constructor(o,c,f,_,y,x){this.tileID=o,this.uid=r.b2(),this.uses=0,this.tileSize=c,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(o){let c=o+this.timeAdded;c<r.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=ml(o.buckets,c.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof r.b4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof r.b4&&y.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(let _ in this.buckets){let y=this.buckets[_],x=c.style.getOwnLayer(_);if(!x)continue;let w=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,w)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,c,f){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,ml(o.buckets,c.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,c){for(let y in this.buckets){let x=this.buckets[y];if(x.uploadPending()){let w={},S=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){S=c.style.listImages();let A=x.layers[0],L=A.sourceLayer||"_geojsonTileLayer",F=c.style.getLayerSourceCache(A);F&&(w=F._state.getState(L,void 0))}M={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}x.upload(o,this.tileID.canonical,w,S,M)}}let f=o.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new r.T(o,_.image,f.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(o,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(o,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(o,c,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,f),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let o=0;for(let c in this.buckets){let f=this.buckets[c];f.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,f.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,c,f,_,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let w=this.evaluateQueryRenderedFeaturePadding(),S=(function(M,A){let L=r.bq([],[.5*M.width,.5*-M.height,1]);return r.br(L,L,[1,-1,0]),r.aB(L,L,M.calculateProjMatrix(A.toUnwrapped())),Float32Array.from(L)})(y,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:c,pixelPosMatrix:S,transform:_,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:w})}querySourceFeatures(o,c){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let _=f.loadVTLayers(),y=c?c.sourceLayer:"",x=_._geojsonTileLayer||_[y];if(!x)return;let w=r.b6(c&&c.filter),{z:S,x:M,y:A}=this.tileID.canonical,L={z:S,x:M,y:A};for(let F=0;F<x.length;F++){let N=x.feature(F);if(w.needGeometry){let W=r.b7(N,!0);if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W,this.tileID.canonical))continue}else if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),N))continue;let j=f.getId(N,y),U=new r.b8(N,S,M,A,j);U.tile=L,o.push(U)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){let c=this.expirationTime;if(o.cacheControl){let f=r.b9(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let f=Date.now(),_=!1;if(this.expirationTime>f)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{let y=this.expirationTime-c;y?this.expirationTime=f+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(let c in this.buckets)if(o.style.hasLayer(c)&&this.buckets[c].layers.some(f=>f.appearances&&f.appearances.length>0))return!0;return!1}updateBuckets(o,c){if(!this.latestFeatureIndex||!o.style)return;let f=o.style.listImages(),_=o.style.getBrightness();for(let y in this.buckets){if(!o.style.hasLayer(y))continue;let x=this.buckets[y],w=x.layers[0],S=w.sourceLayer||"_geojsonTileLayer",M=o.style.getLayerSourceCache(w),A={};M&&(A=M._state.getState(S,void 0));let L=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},F=Object.keys(A).length>0&&!c;x.hasAppearances=x.layers.some(U=>U.appearances&&U.appearances.length>0);let N=F?x.stateDependentLayers:x.layers;if(F&&x.stateDependentLayers.length!==0||c){let U=this.latestFeatureIndex.loadVTLayers();x.update(A,U[S],f,L,N,c,_)}if(F&&x.stateDependentLayers.length!==0||c||x.hasAppearances){let U={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};x.updateAppearances(this.tileID.canonical,A,f,U)}(x instanceof r.ba||x instanceof r.bb)&&o._terrain&&o._terrain.enabled&&M&&x.uploadPending()&&o._terrain._clearRenderCacheForTile(M.id,this.tileID);let j=o&&o.style&&o.style.getOwnLayer(y);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=r.o.now()+o}setTexture(o,c){let f=c.context,_=f.gl;this.texture=this.texture||c.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o):(this.texture=new r.T(f,o,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(o,c){let f={};for(let _ of c)f[_]=!0;this.dependencies[o]=f}hasDependency(o,c){for(let f of o){let _=this.dependencies[f];if(_){for(let y of c)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;let f=r.bc(sm,this.tileID.canonical,this.tileTransform)[0],_=new r.bd,y=new r.be;for(let x=0;x<f.length;x++){let{x:w,y:S}=f[x];_.emplaceBack(w,S),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(_,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;let f=r.bc(sm,this.tileID.canonical,this.tileTransform)[0],_,y;if(this.isRaster){let x=(function(w,S){let M=r.aZ(w,S),A=Math.pow(2,w.z);for(let W=0;W<Ga;W++)for(let q=0;q<Ga;q++){let ee=r.a_((w.x+(q+Ku(q))/Ts)/A),re=r.a$((w.y+(W+Ku(W))/Ts)/A),te=S.project(ee,re),ge=W*Ga+q;va[2*ge+0]=Math.round((te.x*M.scale-M.x)*r.al),va[2*ge+1]=Math.round((te.y*M.scale-M.y)*r.al)}gl.fill(0),Hc.fill(0);for(let W=2045;W>=0;W--){let q=4*W,ee=qa[q+0],re=qa[q+1],te=qa[q+2],ge=qa[q+3],de=ee+te>>1,fe=re+ge>>1,ue=de+fe-re,ae=fe+ee-de,_e=re*Ga+ee,Te=ge*Ga+te,Ce=fe*Ga+de,Be=Math.hypot((va[2*_e+0]+va[2*Te+0])/2-va[2*Ce+0],(va[2*_e+1]+va[2*Te+1])/2-va[2*Ce+1])>=16;gl[Ce]=gl[Ce]||(Be?1:0),W<1022&&(gl[Ce]=gl[Ce]||gl[(re+ae>>1)*Ga+(ee+ue>>1)]||gl[(ge+ae>>1)*Ga+(te+ue>>1)])}let L=new r.b1,F=new r.b0,N=0;function j(W,q){let ee=q*Ga+W;return Hc[ee]===0&&(L.emplaceBack(va[2*ee+0],va[2*ee+1],W*r.al/Ts,q*r.al/Ts),Hc[ee]=++N),Hc[ee]-1}function U(W,q,ee,re,te,ge){let de=W+ee>>1,fe=q+re>>1;if(Math.abs(W-te)+Math.abs(q-ge)>1&&gl[fe*Ga+de])U(te,ge,W,q,de,fe),U(ee,re,te,ge,de,fe);else{let ue=j(W,q),ae=j(ee,re),_e=j(te,ge);F.emplaceBack(ue,ae,_e)}}return U(0,0,Ts,Ts,Ts,0),U(Ts,Ts,0,0,0,Ts),{vertices:L,indices:F}})(this.tileID.canonical,c);_=x.vertices,y=x.indices}else{_=new r.b1,y=new r.b0;for(let{x:w,y:S}of f)_.emplaceBack(w,S,0,0);let x=r.bh(_.int16.subarray(0,4*_.length),void 0,4);for(let w=0;w<x.length;w+=3)y.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(_,r.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=r.bg.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(o,c){let f=c.projection;if(!f||f.name!=="globe"||c.freezeTileCoverage)return;let _=this.tileID.canonical,y=r.bj(_,c),x=r.bk(y),w=r.aj(c.zoom),S;w>0&&(S=r.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,_,c,x,S,w),this._makeGlobeTileDebugTextBuffer(o,_,c,x,S,w)}_globePoint(o,c,f,_,y,x,w){let S=r.bm(o,c,f);if(x){let M=1<<f.z,A=r.aF(_.center.lng),L=r.aJ(_.center.lat),F=(f.x+.5)/M-A,N=0;F>.5?N=-1:F<-.5&&(N=1);let j=(o/r.al+f.x)/M+N,U=(c/r.al+f.y)/M;j=(j-A)*_._pixelsPerMercatorPixel+A,U=(U-L)*_._pixelsPerMercatorPixel+L;let W=[j*_.worldSize,U*_.worldSize,0];r.af(W,W,x),S=r.bn(S,W,w)}return r.af(S,S,y)}_makeGlobeTileDebugBorderBuffer(o,c,f,_,y,x){let w=new r.bd,S=new r.be,M=new r.bo,A=(F,N,j,U,W)=>{let q=(j-F)/(W-1),ee=(U-N)/(W-1),re=w.length;for(let te=0;te<W;te++){let ge=F+te*q,de=N+te*ee;w.emplaceBack(ge,de);let fe=this._globePoint(ge,de,c,f,_,y,x);M.emplaceBack(fe[0],fe[1],fe[2]),S.emplaceBack(re+te)}},L=r.al;A(0,0,L,0,16),A(L,0,L,L,16),A(L,L,0,L,16),A(0,L,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(S),this._tileDebugBuffer=o.createVertexBuffer(w,r.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(M,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,w.length,S.length)}_makeGlobeTileDebugTextBuffer(o,c,f,_,y,x){let w=r.al/4,S=new r.bd,M=new r.b0,A=new r.bo,L=25;M.reserve(32),S.reserve(L),A.reserve(L);let F=(N,j)=>L*N+j;for(let N=0;N<L;N++){let j=N*w;for(let U=0;U<L;U++){let W=U*w;S.emplaceBack(W,j);let q=this._globePoint(W,j,c,f,_,y,x);A.emplaceBack(q[0],q[1],q[2])}}for(let N=0;N<4;N++)for(let j=0;j<4;j++){let U=F(N,j),W=F(N,j+1),q=F(N+1,j),ee=F(N+1,j+1);M.emplaceBack(U,W,q),M.emplaceBack(q,W,ee)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(M),this._tileDebugTextBuffer=o.createVertexBuffer(S,r.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(A,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,L,32)}destroy(o=!0){for(let c in this.buckets)this.buckets[c].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof r.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class am extends Qu{constructor(o,c,f,_,y){super(o,c,f,_,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,c,f){let _=f.context,y=_.gl,x=this.texturePerLayer.get(o)||f.getTileTexture(c.width);x&&x instanceof r.T?x.update(c,{premultiply:!1}):x=new r.T(_,c,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,x)}flushQueues(o){let c=this._workQueuePerLayer.get(o)||[],f=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(let o of this._workQueuePerLayer.keys()){let c=this._workQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}for(let o of this._fetchQueuePerLayer.keys()){let c=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}}fetchHeader(o=16384,c){let f=this._mrt=new r.bs(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=r.bu(_,(y,x,w)=>{if(y)c(y);else try{let S=f.getHeaderLength(x);if(S>o)return void(this.request=this.fetchHeader(S,c));f.parseHeader(x),this._isHeaderLoaded=!0;let M=0;for(let A of Object.values(f.layers))M=Math.max(M,A.dataIndex[A.dataIndex.length-1].lastByte);x.byteLength>=M&&(this.entireBuffer=x),c(null,this.entireBuffer||x,w)}catch(S){c(S)}}),this.request}fetchBandForRender(o,c,f,_){this.fetchBand(o,c,f,y=>{if(y)return void _(y);this.updateTextureDescriptor(o,c,f);let x=this.textureDescriptorPerLayer.get(c);_(null,x?x.img:null)})}fetchBand(o,c,f,_,y=!0){let x=this._mrt;if(!this._isHeaderLoaded||!x)return void _(new Error("Tile header is not ready"));let w=this.actor;if(!w)return void _(new Error("Can't fetch tile band without an actor"));let S,M=r.B(String(f),r.B(this.tileID.key,o)),A=this._taskQueue.get(M);A?A.add(_):(A=new Set,A.add(_),this._taskQueue.set(M,A));let L=(U,W)=>{S.complete(U,W),U?_(U):(A.forEach(q=>q(null,W)),this._taskQueue.delete(M))},F=(U,W)=>{if(U)return _(U);let q=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:W,task:S},L,void 0,!0);if(c!==null){let ee=this._workQueuePerLayer.get(c)||[];ee.push(()=>{q&&q.cancel(),S.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,ee)}},N;try{N=x.getLayer(o)}catch(U){if(this.state==="reloading")return;throw U}if(!N)return void _(new Error(`Unknown sourceLayer "${o}"`));if(N.hasDataForBand(f))return A.forEach(U=>U(null,null)),void this._taskQueue.delete(M);let j=N.getDataRange([f]);if(S=x.createDecodingTask(j),!S||S.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)F(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{let U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),W=r.bu(U,F);if(c!==null){let q=this._fetchQueuePerLayer.get(c)||[];q.push(()=>{W.cancel(),S.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,q)}}}updateNeeded(o,c){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,c,f){if(!this._mrt)return;let _=this._mrt.getLayer(o);if(!_||!_.hasBand(f)||!_.hasDataForBand(f))return;let{bytes:y,tileSize:x,buffer:w,offset:S,scale:M}=_.getBandView(f),A=x+2*w,L=new r.q({width:A,height:A},y),F=this.texturePerLayer.get(c);F&&F instanceof r.T&&F.update(L,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:o,band:f,img:L,buffer:w,offset:S,tileSize:x,format:_.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(let c of this.texturePerLayer.values())c&&c instanceof r.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class wb{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(let o in this.data)for(let c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,f){let _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let y={value:c,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(o,y)},f)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){let c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;let f=o.wrapped().key,_=c===void 0?0:this.data[f].indexOf(c),y=this.data[f][_];return this.data[f].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){let c=[];for(let f in this.data)for(let _ of this.data[f])o(_.value)||c.push(_);for(let f of c)this.remove(f.value.tileID,f)}}class lp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,f){let _=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},Object.assign(this.stateChanges[o][_],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(let y in this.state[o])y!==_&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(let y in this.state[o][_])f[y]||(this.deletedStates[o][_][y]=null)}else for(let y in f)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][y]===null&&delete this.deletedStates[o][_][y]}removeFeatureState(o,c,f){if(this.deletedStates[o]===null)return;let _=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&c!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][f]=null);else if(c!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(f in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][f]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,c){let f=this.state[o]||{},_=this.stateChanges[o]||{},y=this.deletedStates[o];if(y===null)return{};if(c!==void 0){let w=String(c),S=Object.assign({},f[w],_[w]);if(y){let M=y[c];if(M===null)return{};for(let A in M)delete S[A]}return S}let x=Object.assign({},f,_);if(y)for(let w in y)delete x[w];return x}initializeTileState(o,c){o.refreshFeatureState(c)}coalesceChanges(o,c){let f={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let y={};for(let x in this.stateChanges[_])this.state[_][x]||(this.state[_][x]={}),Object.assign(this.state[_][x],this.stateChanges[_][x]),y[x]=this.state[_][x];f[_]=y}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let y={};if(this.deletedStates[_]===null)for(let x in this.state[_])y[x]={},this.state[_][x]={};else for(let x in this.deletedStates[_]){if(this.deletedStates[_][x]===null)this.state[_][x]={};else if(this.state[_][x])for(let w of Object.keys(this.deletedStates[_][x]))delete this.state[_][x][w];y[x]=this.state[_][x]}f[_]=f[_]||{},Object.assign(f[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let _ in o)o[_].refreshFeatureState(c)}}class Bs extends r.E{constructor(o,c,f){super(),this.id=o,this._onlySymbols=f,c.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new wb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new lp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let c in this._tiles){let f=this._tiles[c];f.upload(o,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(lm).map(o=>o.key)}getRenderableIds(o,c){let f=[];for(let _ in this._tiles)this._isIdRenderable(+_,o,c)&&f.push(this._tiles[_]);return o?f.sort((_,y)=>{let x=_.tileID,w=y.tileID,S=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new r.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||M.y-S.y||M.x-S.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(lm).map(_=>_.key)}hasRenderableParent(o){let c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c,f){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())&&(f||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){let f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,o,c)))}_tileLoaded(o,c,f,_,y){if(_){if(o.state="errored",_.status!==404)this._source.fire(new r.y(_,{tile:o}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=r.o.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let x=new Map;y&&y.responseHeaders&&(x=y.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(o){let c=this.getRenderableIds();for(let _=0;_<c.length;_++){let y=c[_];if(o.neighboringTiles&&o.neighboringTiles[y]){let x=this.getTileByID(y);f(o,x),f(x,o)}}function f(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-_.tileID.canonical.x,w=y.tileID.canonical.y-_.tileID.canonical.y,S=Math.pow(2,_.tileID.canonical.z),M=y.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+S)===1?x+=S:Math.abs(x-S)===1&&(x-=S)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,x,w),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,f,_){for(let y in this._tiles){let x=this._tiles[y];if(_[y]||!x.hasData()||x.tileID.overscaledZ<=c||x.tileID.overscaledZ>f)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>c+1;){let M=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[M.key],x&&x.hasData()&&(w=M)}let S=w;for(;S.overscaledZ>c;)if(S=S.scaledTo(S.overscaledZ-1),o[S.key]){_[w.key]=w;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){let f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=o.overscaledZ-1;f>=c;f--){let _=o.scaledTo(f),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(o){let c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;let f=Math.ceil(o.width/c)+1,_=Math.ceil(o.height/c)+1,y=Math.floor(f*_*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(o){let c=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,c){let f={};for(let _ in this._tiles){let y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+c),f[y.tileID.key]=y}this._tiles=f;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(o,c,f,_,y){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(o,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let x=this._source.type==="batched-model",w,S=this._source.maxzoom,M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){let F=M.attenuationRange()[0],N=Math.floor(F)-Math.log2(M.getDemUpscale());S>N&&(S=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new r.aQ(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){let F=o.clone();F.tileCoverLift=this.tileCoverLift,w=F.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&o.projection.name==="globe"&&(w.push(new r.aQ(1,0,1,0,0)),w.push(new r.aQ(1,0,1,1,0)),w.push(new r.aQ(1,0,1,0,1)),w.push(new r.aQ(1,0,1,1,1)))}else if(w=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){let F=this._source.hasTile.bind(this._source);w=w.filter(N=>F(N))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ju(this._source.type)){let F=o.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),N=Math.min(F,this._source.maxzoom);if(x){let j=o.extendTileCover(w,N);for(let U of j)w.push(U)}else if(y){let j=o.extendTileCoverToNearPlane(w,this.transform.getFrustum(N),N);for(let U of j)w.push(U)}else if(this.castsShadows&&_){let j=o.extendTileCover(w,N,_,16);for(let U of j)this._shadowCasterTiles[U.key]=!0,w.push(U)}}let A=this._updateRetainedTiles(w);if(Ju(this._source.type)&&w.length!==0){let F={},N={},j=Object.keys(A);for(let W of j){let q=A[W],ee=this._tiles[W];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=r.o.now())continue;let re=this.findLoadedParent(q,Math.max(q.overscaledZ-Bs.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),F[re.tileID.key]=re.tileID),N[W]=q}let U=w[w.length-1].overscaledZ;for(let W in this._tiles){let q=this._tiles[W];if(A[W]||!q.hasData())continue;let ee=q.tileID;for(;ee.overscaledZ>U;){ee=ee.scaledTo(ee.overscaledZ-1);let re=this._tiles[ee.key];if(re&&re.hasData()&&N[ee.key]){A[W]=q.tileID;break}}}for(let W in F)A[W]||(this._coveredTiles[W]=!0,A[W]=F[W])}for(let F in A)this._tiles[F].clearFadeHold();let L=r.bv(this._tiles,A);for(let F of L){let N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let c={};if(o.length===0)return c;let f={},_=o.reduce((M,A)=>Math.min(M,A.overscaledZ),1/0),y=o[0].overscaledZ,x=Math.max(y-Bs.maxOverzooming,this._source.minzoom),w=Math.max(y+Bs.maxUnderzooming,this._source.minzoom),S={};for(let M of o){let A=this._addTile(M);c[M.key]=M,A.hasData()||_<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,_,w,c);for(let M of o){let A=this._tiles[M.key];if(A.hasData())continue;if(M.canonical.z>=this._source.maxzoom){let F=M.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){c[F.key]=F;continue}}else{let F=M.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let L=A.wasRequested();for(let F=M.overscaledZ-1;F>=x;--F){let N=M.scaledTo(F);if(f[N.key]||(f[N.key]=!0,A=this.getTile(N),!A&&L&&(A=this._addTile(N)),A&&(c[N.key]=N,L=A.wasRequested(),A.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let c=[],f,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}c.push(_.key);let y=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;_=y}for(let y of c)this._loadedParentTiles[y]=f}}_addTile(o){let c=this._tiles[o.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));let f=!!c;if(!f){let _=this.map?this.map.painter:null,y=this._source.tileSize*o.overscaleFactor();c=this._source.type==="raster-array"?new am(o,y,this.transform.tileZoom,_,this._isRaster):new Qu(o,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c.uses++,this._tiles[o.key]=c,f||this._source.fire(new r.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let f=c.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){let c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,f){let _=[],y=this.transform;if(!y)return _;let x=y.projection.name==="globe",w=r.aF(y.center.lng);for(let S in this._tiles){let M=this._tiles[S];if(f&&M.clearQueryDebugViz(),M.holdingForFade())continue;let A;if(x){let L=M.tileID.canonical;if(L.z===0){let F=[Math.abs(r.aA(w,...Xl(L,-1))-w),Math.abs(r.aA(w,...Xl(L,1))-w)];A=[0,2*F.indexOf(Math.min(...F))-1]}else{let F=[Math.abs(r.aA(w,...Xl(L,-1))-w),Math.abs(r.aA(w,...Xl(L,0))-w),Math.abs(r.aA(w,...Xl(L,1))-w)];A=[F.indexOf(Math.min(...F))-1]}}else A=[0];for(let L of A){let F=o.containsTile(M,y,c,L);F&&_.push(F)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,c){let f=this.getRenderableIds(o,c).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(let y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(o){let c=o.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(let x of c){let w=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*w+x.wrap-f[0])*_[0]+((x.canonical.y+.5)*w-f[1])*_[1]-f[2]*_[2]}return c.sort((x,w)=>y[x.key]-y[w.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Ju(this._source.type))for(let o in this._tiles){let c=this._tiles[o];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(o,c,f){this._state.updateState(o=o||"_geojsonTileLayer",c,f)}removeFeatureState(o,c,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,f)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,f){let _=this._tiles[o];_&&_.setDependencies(c,f)}reloadTilesForDependencies(o,c){for(let f in this._tiles)this._tiles[f].hasDependency(o,c)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,c))}_preloadTiles(o,c){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,c))};return void this._source.on("data",S)}let f=new Map,_=Array.isArray(o)?o:[o],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let S of _){let M=S.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of M)f.set(A.key,A);this.usedForTerrain&&S.updateElevation(!1)}let w=Array.from(f.values());r.bw(w,(S,M)=>{let A=new Qu(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(A,L=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),M(L,A)})},c)}}function lm(p,o){let c=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return p.overscaledZ-o.overscaledZ||f-c||o.canonical.y-p.canonical.y||o.canonical.x-p.canonical.x}function Ju(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function Xl(p,o){let c=1<<p.z;return[p.x/c+o,(p.x+1)/c+o]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class NT{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,c=!1;for(let f in this.style._mergedLayers){let _=this.style._mergedLayers[f];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:o,visibilityChanged:c});else if(_.type==="model"){let y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:o,visibilityChanged:c})}}}onNewFrame(o){this.layersGotHidden=!1;for(let c of this.layers){let f=c.layer,_=!1;f.type==="fill-extrusion"?_=!f.isHidden(o)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?_=!f.isHidden(o)&&f.paint.get("building-opacity")>0:f.type==="model"&&(_=!f.isHidden(o)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&c.visible,c.visible=_}}updateZOffset(o,c){this.currentBuildingBuckets=[];for(let _ of this.layers){let y=_.layer,x=this.style.getLayerSourceCache(y),w=1;y.type==="fill-extrusion"?w=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(w=_.visible?y.paint.get("building-vertical-scale"):0);let S=x?x.getTile(c):null;if(!S&&x)for(let M in x._tiles){let A=x._tiles[M];if(c.canonical.isChildOf(A.tileID.canonical)){S=A;break}}this.currentBuildingBuckets.push({bucket:S?S.getBucket(y):null,tileID:S?S.tileID:c,verticalScale:w})}o.hasAnyZOffset=!1;let f=!1;for(let _=0;_<o.symbolInstances.length;_++){let y=o.symbolInstances.get(_),x=y.zOffset,w=this._getHeightAtTileOffset(c,y.tileAnchorX,y.tileAnchorY);y.zOffset=w!==Number.NEGATIVE_INFINITY?w:x,f||x===y.zOffset||(f=!0),o.hasAnyZOffset||y.zOffset===0||(o.hasAnyZOffset=!0)}f&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,c,f,_){let y=c,x=f;if(o.canonical.z!==_.canonical.z){let w=_.canonical,S=1/(1<<o.canonical.z-w.z);y=(c+o.canonical.x*r.al)*S-w.x*r.al|0,x=(f+o.canonical.y*r.al)*S-w.y*r.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(o,c,f){let _,y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;let{bucket:S,tileID:M,verticalScale:A}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(o,c,f,M),N=S.getHeightAtTileCoord(L,F);N&&N.height!==void 0&&(N.hidden?_=N.height:y=Math.max(N.height*A,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x];if(w.layer.type!=="model"||!w.visible)continue;let{bucket:S,tileID:M}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:A,tileY:L}=this._mapCoordToOverlappingTile(o,c,f,M),F=S.getHeightAtTileCoord(A,L);if(F&&!F.hidden)return F.height===void 0&&_!==void 0?Math.min(F.maxHeight,_)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Cb(p,o){let c={};for(let f in p)f!=="ref"&&(c[f]=p[f]);return r.bx.forEach(f=>{f in o&&(c[f]=o[f])}),c}function cp(p){p=p.slice();let o=Object.create(null);for(let c=0;c<p.length;c++)o[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Cb(p[c],o[p[c].ref]));return p}let qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function cm(p,o,c){c.push({command:qn.addSource,args:[p,o[p]]})}function Ev(p,o,c){o.push({command:qn.removeSource,args:[p]}),c[p]=!0}function Eb(p,o,c,f){Ev(p,c,f),cm(p,o,c)}function Sb(p,o,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!r.by(p[c][f],o[c][f]))return!1;for(f in o[c])if(o[c].hasOwnProperty(f)&&f!=="data"&&!r.by(p[c][f],o[c][f]))return!1;return!0}function Gc(p,o,c,f,_,y){let x;for(x in o=o||{},p=p||{})p.hasOwnProperty(x)&&(r.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}));for(x in o)o.hasOwnProperty(x)&&!p.hasOwnProperty(x)&&(r.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}))}function up(p){return p.id}function dp(p,o){return p[o.id]=o,p}function Sv(p,o,c){let f=o.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.aB(new Float32Array(16),p.projMatrix,f)}function um(p,o,c){if(o.projection.name===c.projection.name)return p.projMatrix;let f=c.clone();return f.setProjection(o.projection),Sv(f,o.getProjection(),p)}function _l(p,o,c){return o.name===c.projection.name?p.projMatrix:Sv(c,o,p)}class hp{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.aA(o,0,1);let c=1,f=this._distances[c],_=o*this.paddedLength+this.padding;for(;f<_&&c<this._distances.length;)f=this._distances[++c];let y=c-1,x=this._distances[y],w=f-x,S=w>0?(_-x)/w:0;return this.points[y].mult(1-S).add(this.points[c].mult(S))}}class Tv{constructor(o,c,f){let _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(c/f);for(let x=0;x<this.xCellCount*this.yCellCount;x++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,f,_,y){this._forEachCell(c,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(o,c,f,_){this._forEachCell(c-_,f-_,c+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(f),this.circles.push(_)}_insertBoxCell(o,c,f,_,y,x){this.boxCells[y].push(x)}_insertCircleCell(o,c,f,_,y,x){this.circleCells[y].push(x)}_query(o,c,f,_,y,x){if(f<0||o>this.width||_<0||c>this.height)return!y&&[];let w=[];if(o<=0&&c<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let S=0;S<this.boxKeys.length;S++)w.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let M=this.circles[3*S],A=this.circles[3*S+1],L=this.circles[3*S+2];w.push({key:this.circleKeys[S],x1:M-L,y1:A-L,x2:M+L,y2:A+L})}return x?w.filter(x):w}return this._forEachCell(o,c,f,_,this._queryCell,w,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?w.length>0:w}_queryCircle(o,c,f,_,y){let x=o-f,w=o+f,S=c-f,M=c+f;if(w<0||x>this.width||M<0||S>this.height)return!_&&[];let A=[];return this._forEachCell(x,S,w,M,this._queryCellCircle,A,{hitTest:_,circle:{x:o,y:c,radius:f},seenUids:{box:{},circle:{}}},y),_?A.length>0:A}query(o,c,f,_,y){return this._query(o,c,f,_,!1,y)}hitTest(o,c,f,_,y){return this._query(o,c,f,_,!0,y)}hitTestCircle(o,c,f,_){return this._queryCircle(o,c,f,!0,_)}_queryCell(o,c,f,_,y,x,w,S){let M=w.seenUids,A=this.boxCells[y];if(A!==null){let F=this.bboxes;for(let N of A)if(!M.box[N]){M.box[N]=!0;let j=4*N;if(o<=F[j+2]&&c<=F[j+3]&&f>=F[j+0]&&_>=F[j+1]&&(!S||S(this.boxKeys[N]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[N],x1:F[j],y1:F[j+1],x2:F[j+2],y2:F[j+3]})}}}let L=this.circleCells[y];if(L!==null){let F=this.circles;for(let N of L)if(!M.circle[N]){M.circle[N]=!0;let j=3*N;if(this._circleAndRectCollide(F[j],F[j+1],F[j+2],o,c,f,_)&&(!S||S(this.circleKeys[N]))){if(w.hitTest)return x.push(!0),!0;{let U=F[j],W=F[j+1],q=F[j+2];x.push({key:this.circleKeys[N],x1:U-q,y1:W-q,x2:U+q,y2:W+q})}}}}}_queryCellCircle(o,c,f,_,y,x,w,S){let M=w.circle,A=w.seenUids,L=this.boxCells[y];if(L!==null){let N=this.bboxes;for(let j of L)if(!A.box[j]){A.box[j]=!0;let U=4*j;if(this._circleAndRectCollide(M.x,M.y,M.radius,N[U+0],N[U+1],N[U+2],N[U+3])&&(!S||S(this.boxKeys[j])))return x.push(!0),!0}}let F=this.circleCells[y];if(F!==null){let N=this.circles;for(let j of F)if(!A.circle[j]){A.circle[j]=!0;let U=3*j;if(this._circlesCollide(N[U],N[U+1],N[U+2],M.x,M.y,M.radius)&&(!S||S(this.circleKeys[j])))return x.push(!0),!0}}}_forEachCell(o,c,f,_,y,x,w,S){let M=this._convertToXCellCoord(o),A=this._convertToYCellCoord(c),L=this._convertToXCellCoord(f),F=this._convertToYCellCoord(_);for(let N=M;N<=L;N++)for(let j=A;j<=F;j++)if(y.call(this,o,c,f,_,this.xCellCount*j+N,x,w,S))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,f,_,y,x){let w=_-o,S=y-c,M=f+x;return M*M>w*w+S*S}_circleAndRectCollide(o,c,f,_,y,x,w){let S=(x-_)/2,M=Math.abs(o-(_+S));if(M>S+f)return!1;let A=(w-y)/2,L=Math.abs(c-(y+A));if(L>A+f)return!1;if(M<=S||L<=A)return!0;let F=M-S,N=L-A;return F*F+N*N<=f*f}}let qc={unknown:0,flipRequired:1,flipNotRequired:2},ed=Math.tan(85*Math.PI/180);function as(p,o,c,f,_,y,x){let w=r.bC();if(c)if(y.name==="globe"){let S=r.bD(_,o);r.aB(w,w,S)}else{let S=r.bE([],x);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3],f||r.bB(w,w,_.angle)}else r.aB(w,_.labelPlaneMatrix,p);return w}function dm(p,o,c,f,_,y,x){let w=as(p,o,c,f,_,y,x);return y.name==="globe"&&c||(w[2]=w[6]=w[10]=w[14]=0),w}function pp(p,o,c,f,_,y,x){if(c){if(y.name==="globe"){let w=as(p,o,c,f,_,y,x);return r.bl(w,w),r.aB(w,p,w),w}{let w=r.bz(p),S=r.bA([]);return S[0]=x[0],S[1]=x[1],S[4]=x[2],S[5]=x[3],r.aB(w,w,S),f||r.bB(w,w,-_.angle),w}}return _.glCoordMatrix}function ya(p,o,c,f){let _=[p,o,c,1];c?r.aC(_,_,f):Zt(_,_,f);let y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function ui(p,o){return Math.min(.5+p/o*.5,1.5)}function Tb(p,o){let c=p[0]/p[3],f=p[1]/p[3];return c>=-o[0]&&c<=o[0]&&f>=-o[1]&&f<=o[1]}function Ib(p,o,c,f,_,y,x,w,S,M,A=1){let L=c.transform,F=f?p.textSizeData:p.iconSizeData,N=r.bK(F,c.transform.zoom,A),j=L.projection.name==="globe",U=[256/c.width*2+1,256/c.height*2+1],W=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();let q=null;j&&(q=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let ee=p.lineVertexArray,re=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,te=c.transform.width/c.transform.height,ge,de=!1;for(let fe=0;fe<re.length;fe++){let ue=re.get(fe),{numGlyphs:ae,writingMode:_e}=ue;if(_e!==r.bL.vertical||de||ge===r.bL.horizontal||(de=!0),ge=_e,(ue.hidden||_e===r.bL.vertical)&&!de){Wa(ae,W);continue}de=!1;let Te=new r.P(ue.tileAnchorX,ue.tileAnchorY),Ce=p.elevationType==="road",Be=!!L.elevation||Ce,{x:Ue,y:Ye,z:dt}=L.projection.projectTilePoint(Te.x,Te.y,M.canonical),Fe=null;if(Be){let Pt=Ce?p.getElevationFeatureForText(fe):null;Fe={getElevation:S,elevation:L.elevation,elevationFeature:Pt};let[Jt,fn,Fn]=S(Te,L.elevation,Pt);Ue+=Jt,Ye+=fn,dt+=Fn}let be=[Ue,Ye,dt,1];if(r.aC(be,be,o),!Tb(be,U)){Wa(ae,W);continue}let Ge=be[3],Le=ui(c.transform.getCameraToCenterDistance(L.projection),Ge),tt=r.bM(F,N,ue),xt=x?tt/Le:tt*Le,Dt=ya(Ue,Ye,dt,_);if(Dt[3]<=0){Wa(ae,W);continue}let _t={},pt=r.an(p.layers[0].layout.get("text-max-angle")),Ut=Math.cos(pt),zt=x?null:Fe,Tt=Iv(ue,xt,!1,w,o,_,y,p.glyphOffsetArray,ee,W,q,Dt,Te,_t,te,zt,L.projection,M,x,Ut);de=Tt.useVertical,zt&&Tt.needsFlipping&&(_t={}),(Tt.notEnoughRoom||de||Tt.needsFlipping&&Iv(ue,xt,!0,w,o,_,y,p.glyphOffsetArray,ee,W,q,Dt,Te,_t,te,zt,L.projection,M,x,Ut).notEnoughRoom)&&Wa(ae,W)}f?(p.text.dynamicLayoutVertexBuffer.updateData(W),q&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(W),q&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(q))}function Mb(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W){let{lineStartIndex:q,glyphStartIndex:ee,segment:re}=w,te=ee+w.numGlyphs,ge=q+w.lineLength,de=o.getoffsetX(ee),fe=o.getoffsetX(te-1),ue=Gd(p*de,c,f,_,y,x,re,q,ge,S,M,A,L,F,!0,N,j,U,W);if(!ue)return null;let ae=Gd(p*fe,c,f,_,y,x,re,q,ge,S,M,A,L,F,!0,N,j,U,W);return ae?{first:ue,last:ae}:null}function on(p,o,c,f){return p===r.bL.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:p===r.bL.vertical?f>0?{needsFlipping:!0}:null:o!==qc.unknown&&(function(_,y){return _===0||Math.abs(y/_)>ed})(c,f)?o===qc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Iv(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee,re){let te=o/24,ge=p.lineOffsetX*te,de=p.lineOffsetY*te,{lineStartIndex:fe,glyphStartIndex:ue,numGlyphs:ae,segment:_e,writingMode:Te,flipState:Ce}=p,Be=fe+p.lineLength,Ue=Ye=>{if(A){let[Ge,Le,tt]=Ye.up,xt=M.length;r.bN(A,xt+0,Ge,Le,tt),r.bN(A,xt+1,Ge,Le,tt),r.bN(A,xt+2,Ge,Le,tt),r.bN(A,xt+3,Ge,Le,tt)}let[dt,Fe,be]=Ye.point;r.bO(M,dt,Fe,be,Ye.angle)};if(ae>1){let Ye=Mb(te,w,ge,de,c,L,F,p,S,y,N,U,!1,W,q,ee,re);if(!Ye)return{notEnoughRoom:!0};if(f&&!c){let[dt,Fe,be]=Ye.first.point,[Ge,Le,tt]=Ye.last.point;[dt,Fe]=ya(dt,Fe,be,x),[Ge,Le]=ya(Ge,Le,tt,x);let xt=on(Te,Ce,(Ge-dt)*j,Le-Fe);if(p.flipState=xt&&xt.needsFlipping?qc.flipRequired:qc.flipNotRequired,xt)return xt}Ue(Ye.first);for(let dt=ue+1;dt<ue+ae-1;dt++){let Fe=Gd(te*w.getoffsetX(dt),ge,de,c,L,F,_e,fe,Be,S,y,N,U,!1,!1,W,q,ee,re);if(!Fe)return M.length-=4*(dt-ue),{notEnoughRoom:!0};Ue(Fe)}Ue(Ye.last)}else{if(f&&!c){let dt=ya(F.x,F.y,0,_),Fe=fe+_e+1,be=new r.P(S.getx(Fe),S.gety(Fe)),Ge=ya(be.x,be.y,0,_),Le=Ge[3]>0?Ge:xa(F,be,dt,1,_,void 0,W,q.canonical),tt=on(Te,Ce,(Le[0]-dt[0])*j,Le[1]-dt[1]);if(p.flipState=tt&&tt.needsFlipping?qc.flipRequired:qc.flipNotRequired,tt)return tt}let Ye=Gd(te*w.getoffsetX(ue),ge,de,c,L,F,_e,fe,Be,S,y,N,U,!1,!1,W,q,ee,re);if(!Ye)return{notEnoughRoom:!0};Ue(Ye)}return{}}function fp(p,o,c,f,_){let{x:y,y:x,z:w}=f.projectTilePoint(p.x,p.y,o);if(!_)return ya(y,x,w,c);let[S,M,A]=_.getElevation(p,_.elevation,_.elevationFeature);return ya(y+S,x+M,w+A,c)}function xa(p,o,c,f,_,y,x,w){let S=fp(p.sub(o)._unit()._add(p),w,_,x,y);return r.av(S,c,S),r.aw(S,S),r.bH(S,c,S,f)}function Gd(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee){let re=f?p-o:p+o,te=re>0?1:-1,ge=0;f&&(te*=-1,ge=Math.PI),te<0&&(ge+=Math.PI);let de=w+x+(te>0?0:1)|0,fe=_,ue=_,ae=0,_e=0,Te=Math.abs(re),Ce=[],Be=[],Ue=y,Ye=Ue,dt=r.bF([]),Fe=()=>xa(Ye,Ue,ue,Te-ae+1,A,F,U,W.canonical);for(;ae+_e<=Te;){if(de+=te,de<w||de>=S)return null;if(ue=fe,Ye=Ue,Ce.push(ue),N&&Be.push(Ye),Ue=new r.P(M.getx(de),M.gety(de)),fe=L[de],!fe){let zt=fp(Ue,W.canonical,A,U,F);fe=zt[3]>0?L[de]=zt:Fe()}ae+=_e;let pt=r.av([],fe,ue),Ut=r.bG(ue,fe);if(c&&Ut>0&&_e>0&&r.bJ(dt,pt)/(_e*Ut)<ee)return null;_e=Ut,dt=pt}j&&F&&(L[de]&&(fe=Fe(),_e=r.bG(ue,fe),dt=r.av([],fe,ue)),L[de]=fe);let be=(Te-ae)/_e,Ge=Ue.sub(Ye)._mult(be)._add(Ye),Le=r.bH([],ue,dt,be),tt=[0,0,1],xt=dt[0],Dt=dt[1];if(q&&(tt=U.upVector(W.canonical,Ge.x,Ge.y),tt[0]!==0||tt[1]!==0||tt[2]!==1)){let pt=[tt[2],0,-tt[0]],Ut=r.bI([],tt,pt);r.aw(pt,pt),r.aw(Ut,Ut),xt=r.bJ(dt,pt),Dt=r.bJ(dt,Ut)}if(c){let pt=r.bI([],tt,dt);r.aw(pt,pt),r.bH(Le,Le,pt,c*te)}let _t=ge+Math.atan2(Dt,xt);return Ce.push(Le),N&&Be.push(Ge),{point:Le,angle:_t,path:Ce,tilePath:Be,up:tt}}function Wa(p,o){let c=o.length,f=c+4*p;o.resize(f),o.float32.fill(-1/0,4*c,4*f)}function Zt(p,o,c){let f=o[0],_=o[1];return p[0]=c[0]*f+c[4]*_+c[12],p[1]=c[1]*f+c[5]*_+c[13],p[3]=c[3]*f+c[7]*_+c[15],p}let Bn=100;class fi{constructor(o,c,f=new Tv(o.width+200,o.height+200,25),_=new Tv(o.width+200,o.height+200,25)){this.transform=o,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Bn,this.screenBottomBoundary=o.height+Bn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,f,_,y,x,w,S,M,A,L){let F=f.projectedAnchorX,N=f.projectedAnchorY,j=f.projectedAnchorZ,U=f.tileAnchorX,W=f.tileAnchorY,q=f.elevation,ee=f.tileID,re=o.getProjection();if(q&&ee){let[Be,Ue,Ye]=re.upVector(ee.canonical,f.tileAnchorX,f.tileAnchorY),dt=re.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Be*q*dt,N+=Ue*q*dt,j+=Ye*q*dt}let te=o.projection.name==="globe",ge=o.projection.name==="globe"?r.aj(this.transform.zoom):0;if(ee&&te&&ge<1&&!x){let Be=1<<ee.canonical.z,Ue=r.bP(U,W);r.bQ(Ue,Ue,1/r.al),r.bR(Ue,Ue,r.bP(ee.canonical.x,ee.canonical.y)),r.bQ(Ue,Ue,1/Be),r.bS(Ue,Ue,r.bP(_[0],_[1])),Ue[0]=r.bT(Ue[0],-.5,.5),r.bQ(Ue,Ue,r.al);let Ye=r.bU(Ue[0],Ue[1],r.al/(2*Math.PI),1);r.aC(Ye,Ye,y),F=r.ak(F,Ye[0],ge),N=r.ak(N,Ye[1],ge),j=r.ak(j,Ye[2],ge)}let de=this.projectAndGetPerspectiveRatio(A,F,N,j,f.tileID,re.name==="globe"||!!q||this.transform.pitch>0,re),fe=M*de.perspectiveRatio,ue=(f.x1*c+w.x-f.padding)*fe+de.point.x,ae=(f.y1*c+w.y-f.padding)*fe+de.point.y,_e=(f.x2*c+w.x+f.padding)*fe+de.point.x,Te=(f.y2*c+w.y+f.padding)*fe+de.point.y,Ce=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(ue,ae,_e,Te)||!S&&this.grid.hitTest(ue,ae,_e,Te,L)||Ce?{box:[],offscreen:!1,occluded:de.occluded}:{box:[ue,ae,_e,Te],offscreen:this.isOffscreen(ue,ae,_e,Te),occluded:!1}}placeCollisionCircles(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W){let q=[],ee=this.transform.elevation,re=o.getProjection(),te=o.elevationType==="road",ge=!!ee||te,de=r.bV.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,re),fe=new r.P(f.tileAnchorX,f.tileAnchorY),ue=new r.P(f.tileAnchorX,f.tileAnchorY),{x:ae,y:_e,z:Te}=re.projectTilePoint(ue.x,ue.y,W.canonical),Ce=null;if(ge){let Ut=te?o.getElevationFeatureForText(_):null;Ce={getElevation:de,elevation:ee,elevationFeature:Ut};let[zt,Tt,Pt]=de(fe,ee,Ut);ae+=zt,_e+=Tt,Te+=Pt}let Be=re.name==="globe",Ue=this.projectAndGetPerspectiveRatio(S,ae,_e,Te,W,Be||!!ee||this.transform.pitch>0,re),{perspectiveRatio:Ye}=Ue,dt=(F?w/Ye:w*Ye)/r.bY,Fe=ya(ae,_e,Te,M),be=f.lineOffsetX*dt,Ge=f.lineOffsetY*dt,Le=r.an(o.layers[0].layout.get("text-max-angle")),tt=Math.cos(Le),xt=Ue.signedDistanceFromCamera>0?Mb(dt,x,be,Ge,te&&f.flipState===1,Fe,ue,f,y,M,{},ge&&!F?Ce:null,F&&ge,re,W,F,tt):null,Dt=!1,_t=!1,pt=!0;if(xt&&!Ue.occluded){let Ut=.5*j*Ye+U,zt=new r.P(-100,-100),Tt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new hp,{first:Jt,last:fn}=xt,Fn=Jt.path.length,Jn=[];for(let pn=Fn-1;pn>=1;pn--)Jn.push(Jt.path[pn]);for(let pn=1;pn<fn.path.length;pn++)Jn.push(fn.path[pn]);let jt=2.5*Ut;A&&(Jn=Jn.map(([pn,ii,mi],di)=>(ge&&!Be&&(mi=de(di<Fn-1?Jt.tilePath[Fn-1-di]:fn.tilePath[di-Fn+2],ee,Ce.elevationFeature)[2]),ya(pn,ii,mi,A))),Jn.some(pn=>pn[3]<=0)&&(Jn=[]));let Yn=[];if(Jn.length>0){let pn=1/0,ii=-1/0,mi=1/0,di=-1/0;for(let Wn of Jn)pn=Math.min(pn,Wn[0]),mi=Math.min(mi,Wn[1]),ii=Math.max(ii,Wn[0]),di=Math.max(di,Wn[1]);ii>=zt.x&&pn<=Tt.x&&di>=zt.y&&mi<=Tt.y&&(Yn=[Jn.map(Wn=>new r.P(Wn[0],Wn[1]))],(pn<zt.x||ii>Tt.x||mi<zt.y||di>Tt.y)&&(Yn=r.bW(Yn,zt.x,zt.y,Tt.x,Tt.y)))}for(let pn of Yn){Pt.reset(pn,.25*Ut);let ii=0;ii=Pt.length<=.5*Ut?1:Math.ceil(Pt.paddedLength/jt)+1;for(let mi=0;mi<ii;mi++){let di=mi/Math.max(ii-1,1),Wn=Pt.lerp(di),bn=Wn.x+Bn,ti=Wn.y+Bn;q.push(bn,ti,Ut,0);let ur=bn-Ut,Ki=ti-Ut,ri=bn+Ut,$n=ti+Ut;if(pt=pt&&this.isOffscreen(ur,Ki,ri,$n),_t=_t||this.isInsideGrid(ur,Ki,ri,$n),!c&&this.grid.hitTestCircle(bn,ti,Ut,N)&&(Dt=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!L&&Dt||!_t?[]:q,offscreen:pt,collisionDetected:Dt,occluded:Ue.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],f=1/0,_=1/0,y=-1/0,x=-1/0;for(let A of o){let L=new r.P(A.x+Bn,A.y+Bn);f=Math.min(f,L.x),_=Math.min(_,L.y),y=Math.max(y,L.x),x=Math.max(x,L.y),c.push(L)}let w=this.grid.query(f,_,y,x).concat(this.ignoredGrid.query(f,_,y,x)),S={},M={};for(let A of w){let L=A.key;if(S[L.bucketInstanceId]===void 0&&(S[L.bucketInstanceId]={}),S[L.bucketInstanceId][L.featureIndex])continue;let F=[new r.P(A.x1,A.y1),new r.P(A.x2,A.y1),new r.P(A.x2,A.y2),new r.P(A.x1,A.y2)];r.bX(c,F)&&(S[L.bucketInstanceId][L.featureIndex]=!0,M[L.bucketInstanceId]===void 0&&(M[L.bucketInstanceId]=[]),M[L.bucketInstanceId].push(L.featureIndex))}return M}insertCollisionBox(o,c,f,_,y){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,f,_,y){let x=c?this.ignoredGrid:this.grid,w={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let S=0;S<o.length;S+=4)x.insertCircle(w,o[S],o[S+1],o[S+2])}projectAndGetPerspectiveRatio(o,c,f,_,y,x,w){let S=[c,f,_,1],M=!1;_||this.transform.pitch>0?(r.aC(S,S,o),this.fogState&&y&&w.name!=="globe"&&(M=(function(F,N,j,U,W,q){let ee=q.calculateFogTileMatrix(W),re=[N,j,U];return r.af(re,re,ee),kt(F,r.ag(re),q.pitch,q._fov)})(this.fogState,c,f,_,y.toUnwrapped(),this.transform)>.9)):Zt(S,S,o);let A=S[3];return{point:new r.P((S[0]/A+1)/2*this.transform.width+Bn,(-S[1]/A+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/A*.5,1.5),signedDistanceFromCamera:A,occluded:x&&S[2]>A||M}}isOffscreen(o,c,f,_){return f<Bn||o>=this.screenRightBoundary||_<Bn||c>this.screenBottomBoundary}isInsideGrid(o,c,f,_){return f>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let o=r.bA([]);return r.br(o,o,[-100,-100,0]),o}}class Is{constructor(o,c,f,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class vl{constructor(o,c,f,_,y,x=!1){this.text=new Is(o?o.text:null,c,f,y),this.icon=new Is(o?o.icon:null,c,_,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ai{constructor(o,c,f,_=!1){this.text=o,this.icon=c,this.skipFade=f,this.clipped=_}}class hm{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class mp{constructor(o,c,f,_,y){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class gp{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[o]}}function Zo(p,o,c,f,_){let{horizontalAlign:y,verticalAlign:x}=r.c1(p),w=-(y-.5)*o,S=-(x-.5)*c,M=r.c2(p,f);return new r.P(w+M[0]*_,S+M[1]*_)}function Ur(p,o,c,f,_){let y=new r.P(p,o);return c&&y._rotate(f?_:-_),y}class zT{constructor(o,c,f,_,y,x){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new fi(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new gp(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,c,f,_,y=1){let x=f.getBucket(c),w=f.latestFeatureIndex;if(!x||!w||c.fqid!==x.layerIds[0])return;let S=x.layers[0].layout,M=x.layers[0].paint,A=f.collisionBoxArray,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),F=f.tileSize/r.al,N=f.tileID.toUnwrapped();this.transform.setProjection(x.projection);let j=(U=f.tileID,W=x.getProjection(),q=this.transform,W.name===this.projection?q.calculateProjMatrix(U.toUnwrapped()):Sv(q,W,U));var U,W,q;let ee=S.get("text-pitch-alignment")==="map",re=S.get("text-rotation-alignment")==="map";c.compileFilter(c.options);let te=c.dynamicFilter(),ge=c.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(f),fe=dm(j,f.tileID.canonical,ee,re,this.transform,x.getProjection(),de),ue=null,ae=x.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(ee){let be=pp(j,f.tileID.canonical,ee,re,this.transform,x.getProjection(),de);ue=r.aB([],this.transform.labelPlaneMatrix,be)}let _e=null;te&&f.latestFeatureIndex&&(_e={unwrappedTileID:N,dynamicFilter:te,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new mp(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,f.tileID);let[Te,Ce]=x.layers[0].layout.get("text-size-scale-range"),Be=r.aA(y,Te,Ce),[Ue,Ye]=S.get("icon-size-scale-range"),dt=r.aA(y,Ue,Ye),Fe={bucket:x,layout:S,paint:M,posMatrix:j,invMatrix:ae,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:fe,labelToScreenMatrix:ue,clippingData:_e,scale:L,textPixelRatio:F,holdingForFade:f.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:r.bK(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:r.bK(x.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(let be of x.sortKeyRanges){let{sortKey:Ge,symbolInstanceStart:Le,symbolInstanceEnd:tt}=be;o.push({sortKey:Ge,symbolInstanceStart:Le,symbolInstanceEnd:tt,parameters:Fe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee,re,te,ge){let{textOffset0:de,textOffset1:fe,crossTileID:ue}=U,ae=[de,fe],_e=Zo(o,x,w,ae,S),Te=this.collisionIndex.placeCollisionBox(q,S,c,f,_,y,Ur(_e.x,_e.y,M,A,this.transform.angle),j,L,F,N.predicate);if(re){let Ce=q.getSymbolInstanceIconSize(ge,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ce,re,f,_,y,Ur(_e.x,_e.y,M,A,this.transform.angle),j,L,F,N.predicate).box.length===0)return}if(Te.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Ce=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ae,width:x,height:w,anchor:o,textScale:S,prevAnchor:Ce},this.markUsedJustification(q,o,U,ee),q.allowVerticalPlacement&&(this.markUsedOrientation(q,ee,U),this.placedOrientations[ue]=ee),{shift:_e,placedGlyphBoxes:Te}}}placeLayerBucketPart(o,c,f,_,y=1){let{bucket:x,layout:w,paint:S,posMatrix:M,textLabelPlaneMatrix:A,labelToScreenMatrix:L,clippingData:F,textPixelRatio:N,mercatorCenter:j,invMatrix:U,holdingForFade:W,collisionBoxArray:q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:re,collisionGroup:te,latestFeatureIndex:ge}=o.parameters,de=w.get("text-optional"),fe=w.get("icon-optional"),ue=w.get("text-allow-overlap"),ae=w.get("icon-allow-overlap"),_e=w.get("text-rotation-alignment")==="map",Te=w.get("icon-rotation-alignment")==="map",Ce=w.get("text-pitch-alignment")==="map",Be=S.get("symbol-z-offset"),Ue=w.get("symbol-elevation-reference")==="sea",Ye=w.get("symbol-placement"),[dt,Fe]=w.get("text-size-scale-range"),[be,Ge]=w.get("icon-size-scale-range"),Le=r.aA(y,dt,Fe),tt=r.aA(y,be,Ge),xt=w.get("text-variable-anchor"),Dt=_e&&Ye!=="point",_t=Te&&Ye!=="point",pt=xt&&x.hasTextData(),Ut=x.hasIconTextFit()&&pt&&x.hasIconData();this.transform.setProjection(x.projection);let zt=pt||Dt,Tt=_t||Ut,Pt=ue&&(ae||!x.hasIconData()||fe),Jt=ae&&(ue||!x.hasTextData()||de),fn=!Be.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),f&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,q,Le,tt);let Fn=(jt,Yn,pn)=>{let{crossTileID:ii,numVerticalGlyphVertices:mi}=jt,di=null;if(F&&F.dynamicFilterNeedsFeature||fn){let _r=this.retainedQueryData[x.bucketInstanceId];di=ge.loadFeature({featureIndex:jt.featureIndex,bucketIndex:_r.bucketIndex,sourceLayerIndex:_r.sourceLayerIndex,layoutVertexArrayOffset:0});let Mr=di.properties?di.properties.worldview:null;if(x.localizable&&x.worldview&&typeof Mr=="string")if(Mr==="all")di.properties.$localized=!0;else{if(!Mr.split(",").includes(x.worldview))return;di.properties.$localized=!0,di.properties.worldview=x.worldview}}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},di,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(jt.tileAnchorX,jt.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[ii]=new ai(!1,!1,!1,!0),void c.add(ii);let Wn=Be.evaluate(di,{});if(c.has(ii))return;if(W)return void(this.placements[ii]=new ai(!1,!1,!1));let bn=!1,ti=!1,ur=!0,Ki=!1,ri=!1,$n=null,wn={box:null,offscreen:null,occluded:null},Hi={box:null},wr=null,ir=null,Si=null,_s=0,Fo=0,Qr=0;pn.textFeatureIndex?_s=pn.textFeatureIndex:jt.useRuntimeCollisionCircles&&(_s=jt.featureIndex),pn.verticalTextFeatureIndex&&(Fo=pn.verticalTextFeatureIndex);let Xo=x.elevationFeatures?x.elevationFeatures[jt.elevationFeatureIndex]:void 0,Ko=_r=>{_r.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Mr=this.transform.elevation;_r.elevation=Ue?Wn:Wn+r.bV.getAtTileOffset(_r.tileID,new r.P(_r.tileAnchorX,_r.tileAnchorY),Mr,Xo),_r.elevation+=jt.zOffset},Do=pn.textBox;if(Do){Ko(Do);let _r=Ti=>{let Lr=r.bL.horizontal;if(x.allowVerticalPlacement&&!Ti&&this.prevPlacement){let dr=this.prevPlacement.placedOrientations[ii];dr&&(this.placedOrientations[ii]=dr,Lr=dr,this.markUsedOrientation(x,Lr,jt))}return Lr},Mr=(Ti,Lr)=>{if(x.allowVerticalPlacement&&mi>0&&pn.verticalTextBox){for(let dr of x.writingModes)if(dr===r.bL.vertical?(wn=Lr(),Hi=wn):wn=Ti(),wn&&wn.box&&wn.box.length)break}else wn=Ti()};if(xt){let Ti=xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ii]){let rr=this.prevPlacement.variableOffsets[ii];Ti.indexOf(rr.anchor)>0&&(Ti=Ti.filter(Ma=>Ma!==rr.anchor),Ti.unshift(rr.anchor))}let Lr=(rr,Ma,Gp)=>{let Qa=x.getSymbolInstanceTextSize(ee,jt,this.transform.zoom,Yn),qp=(rr.x2-rr.x1)*Qa+2*rr.padding,mh=(rr.y2-rr.y1)*Qa+2*rr.padding,Il=jt.hasIconTextFit&&!ae?Ma:null;Il&&Ko(Il);let uc={box:[],offscreen:!1,occluded:!1},gh=ue?2*Ti.length:Ti.length;for(let lu=0;lu<gh;++lu){let dc=this.attemptAnchorPlacement(Ti[lu%Ti.length],rr,j,U,zt,qp,mh,Qa,_e,Ce,N,M,te,lu>=Ti.length,jt,Yn,x,Gp,Il,ee,re);if(dc&&(uc=dc.placedGlyphBoxes,uc&&uc.box&&uc.box.length)){bn=!0,$n=dc.shift;break}}return uc};Mr(()=>Lr(Do,pn.iconBox,r.bL.horizontal),()=>{let rr=pn.verticalTextBox;return rr&&Ko(rr),x.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&mi>0&&rr?Lr(rr,pn.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(bn=wn.box,ur=wn.offscreen,Ki=wn.occluded);let dr=_r(!(!wn||!wn.box));if(!bn&&this.prevPlacement){let rr=this.prevPlacement.variableOffsets[ii];rr&&(this.variableOffsets[ii]=rr,this.markUsedJustification(x,rr.anchor,jt,dr))}}else{let Ti=(Lr,dr)=>{let rr=x.getSymbolInstanceTextSize(ee,jt,this.transform.zoom,Yn),Ma=this.collisionIndex.placeCollisionBox(x,rr,Lr,j,U,zt,new r.P(0,0),ue,N,M,te.predicate);return Ma&&Ma.box&&Ma.box.length&&(this.markUsedOrientation(x,dr,jt),this.placedOrientations[ii]=dr),Ma};Mr(()=>Ti(Do,r.bL.horizontal),()=>{let Lr=pn.verticalTextBox;return x.allowVerticalPlacement&&mi>0&&Lr?(Ko(Lr),Ti(Lr,r.bL.vertical)):{box:null,offscreen:null,occluded:null}}),_r(!!(wn&&wn.box&&wn.box.length))}}if(wr=wn,bn=wr&&wr.box&&wr.box.length>0,ur=wr&&wr.offscreen,Ki=wr&&wr.occluded,jt.useRuntimeCollisionCircles){let _r=jt.centerJustifiedTextSymbolIndex>=0?jt.centerJustifiedTextSymbolIndex:jt.verticalPlacedTextSymbolIndex,Mr=x.text.placedSymbolArray.get(_r),Ti=r.bM(x.textSizeData,ee,Mr),Lr=w.get("text-padding");ir=this.collisionIndex.placeCollisionCircles(x,ue,Mr,_r,x.lineVertexArray,x.glyphOffsetArray,Ti,M,A,L,f,Ce,te.predicate,jt.collisionCircleDiameter*Ti/r.bY,Lr,this.retainedQueryData[x.bucketInstanceId].tileID),bn=ue||ir.circles.length>0&&!ir.collisionDetected,ur=ur&&ir.offscreen,Ki=ir.occluded}if(pn.iconFeatureIndex&&(Qr=pn.iconFeatureIndex),pn.iconBox){let _r=Mr=>{Ko(Mr);let Ti=jt.hasIconTextFit&&$n?Ur($n.x,$n.y,_e,Ce,this.transform.angle):new r.P(0,0),Lr=x.getSymbolInstanceIconSize(re,this.transform.zoom,jt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Lr,Mr,j,U,Tt,Ti,ae,N,M,te.predicate)};Hi&&Hi.box&&Hi.box.length&&pn.verticalIconBox?(Si=_r(pn.verticalIconBox),ti=Si.box.length>0):(Si=_r(pn.iconBox),ti=Si.box.length>0),ur=ur&&Si.offscreen,ri=Si.occluded}let na=de||jt.numHorizontalGlyphVertices===0&&mi===0,Ia=fe||jt.numIconVertices===0;if(na||Ia?Ia?na||(ti=ti&&bn):bn=ti&&bn:ti=bn=ti&&bn,bn&&wr&&wr.box&&this.collisionIndex.insertCollisionBox(wr.box,w.get("text-ignore-placement"),x.bucketInstanceId,Hi&&Hi.box&&Fo?Fo:_s,te.ID),ti&&Si&&this.collisionIndex.insertCollisionBox(Si.box,w.get("icon-ignore-placement"),x.bucketInstanceId,Qr,te.ID),ir&&(bn&&this.collisionIndex.insertCollisionCircles(ir.circles,w.get("text-ignore-placement"),x.bucketInstanceId,_s,te.ID),f)){let _r=x.bucketInstanceId,Mr=this.collisionCircleArrays[_r];Mr===void 0&&(Mr=this.collisionCircleArrays[_r]=new hm);for(let Ti=0;Ti<ir.circles.length;Ti+=4)Mr.circles.push(ir.circles[Ti+0]),Mr.circles.push(ir.circles[Ti+1]),Mr.circles.push(ir.circles[Ti+2]),Mr.circles.push(ir.collisionDetected?1:0)}let As=x.projection.name!=="globe";Pt=Pt&&(As||!Ki),Jt=Jt&&(As||!ri),this.placements[ii]=new ai(bn||Pt,ti||Jt,ur||x.justReloaded),c.add(ii)},Jn=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,Jn),x.elevationType==="road"&&x.updateRoadElevation(Jn.canonical),x.updateZOffset(),x.sortFeaturesByY){let jt=x.getSortedSymbolIndexes(this.transform.angle);for(let Yn=jt.length-1;Yn>=0;--Yn){let pn=jt[Yn];Fn(x.symbolInstances.get(pn),pn,x.collisionArrays[pn])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let jt=x.getSortedIndexesByZOffset();for(let Yn=0;Yn<jt.length;++Yn){let pn=jt[Yn];Fn(x.symbolInstances.get(pn),pn,x.collisionArrays[pn])}}else for(let jt=o.symbolInstanceStart;jt<o.symbolInstanceEnd;jt++)Fn(x.symbolInstances.get(jt),jt,x.collisionArrays[jt]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){let jt=this.collisionCircleArrays[x.bucketInstanceId];r.bl(jt.invProjMatrix,M),jt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,f,_){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:S,crossTileID:M}=f,A=r.c3(c),L=_===r.bL.vertical?S:A==="left"?y:A==="center"?x:A==="right"?w:-1;y>=0&&(o.text.placedSymbolArray.get(y).crossTileID=L>=0&&y!==L?0:M),x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=L>=0&&x!==L?0:M),w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=L>=0&&w!==L?0:M),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=L>=0&&S!==L?0:M)}markUsedOrientation(o,c,f){let _=c===r.bL.horizontal||c===r.bL.horizontalOnly?c:0,y=c===r.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M}=f,A=o.text.placedSymbolArray;x>=0&&(A.get(x).placedOrientation=_),w>=0&&(A.get(w).placedOrientation=_),S>=0&&(A.get(S).placedOrientation=_),M>=0&&(A.get(M).placedOrientation=y)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let _=c?c.symbolFadeChange(o):1,y=c?c.opacities:{},x=c?c.variableOffsets:{},w=c?c.placedOrientations:{};for(let S in this.placements){let M=this.placements[S],A=y[S];A?(this.opacities[S]=new vl(A,_,M.text,M.icon,null,M.clipped),f=f||M.text!==A.text.placed||M.icon!==A.icon.placed):(this.opacities[S]=new vl(null,_,M.text,M.icon,M.skipFade,M.clipped),f=f||M.text||M.icon)}for(let S in y){let M=y[S];if(!this.opacities[S]){let A=new vl(M,_,!1,!1);A.isHidden()||(this.opacities[S]=A,f=f||M.text.placed||M.icon.placed)}}for(let S in x)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=x[S]);for(let S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c,f,_){_&&(this.lastReplacementSourceUpdateTime=_.updateTime);let y=new Set;for(let x of c){let w=x.getBucket(o);w&&x.latestFeatureIndex&&o.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,y,x,x.collisionBoxArray,f,_,x.tileID,o.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,x.tileID),w.elevationType==="road"&&w.updateRoadElevation(x.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(o,c,f,_,y,x,w,S){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let M=o.layers[0].layout,A=o.layers[0].paint,L=!!o.layers[0].dynamicFilter(),F=new vl(null,0,!1,!1,!0),N=M.get("text-allow-overlap"),j=M.get("icon-allow-overlap"),U=M.get("text-variable-anchor"),W=M.get("text-rotation-alignment")==="map",q=M.get("text-pitch-alignment")==="map",ee=A.get("symbol-z-offset"),re=M.get("symbol-elevation-reference")==="sea",te=!ee.isConstant(),ge=new vl(null,0,N&&(j||!o.hasIconData()||M.get("icon-optional")),j&&(N||!o.hasTextData()||M.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);let de=(ue,ae,_e)=>{for(let Te=0;Te<ae/4;Te++)ue.opacityVertexArray.emplaceBack(_e)},fe=0;x&&o.updateReplacement(w,x);for(let ue=0;ue<o.symbolInstances.length;ue++){let ae=o.symbolInstances.get(ue),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:Te,crossTileID:Ce,numIconVertices:Be,tileAnchorX:Ue,tileAnchorY:Ye}=ae,dt=null,Fe=this.retainedQueryData[o.bucketInstanceId];te&&ae&&Fe&&(dt=f.latestFeatureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));let be=ee.evaluate(dt,{}),Ge=c.has(Ce),Le=this.opacities[Ce];Ge?Le=F:Le||(Le=ge,this.opacities[Ce]=Le),c.add(Ce);let tt=_e>0||Te>0,xt=Be>0,Dt=this.placedOrientations[Ce],_t=Dt===r.bL.vertical,pt=Dt===r.bL.horizontal||Dt===r.bL.horizontalOnly;!tt&&!xt||Le.isHidden()||fe++;let Ut=!1;if((tt||xt)&&x)for(let zt of o.activeReplacements){if(r.bZ(zt,y,r.b_.Symbol,S)||zt.min.x>Ue||Ue>zt.max.x||zt.min.y>Ye||Ye>zt.max.y)continue;let Tt=r.b$(Ue,Ye,w.canonical,zt.footprintTileId.canonical);if(Ut=r.c0(Tt,zt.footprint),Ut)break}if(tt){let zt=Ut?td:ps(Le.text);de(o.text,_e,_t?td:zt),de(o.text,Te,pt?td:zt);let Tt=Le.text.isHidden(),{leftJustifiedTextSymbolIndex:Pt,centerJustifiedTextSymbolIndex:Jt,rightJustifiedTextSymbolIndex:fn,verticalPlacedTextSymbolIndex:Fn}=ae,Jn=o.text.placedSymbolArray,jt=Tt||_t?1:0;Pt>=0&&(Jn.get(Pt).hidden=jt),Jt>=0&&(Jn.get(Jt).hidden=jt),fn>=0&&(Jn.get(fn).hidden=jt),Fn>=0&&(Jn.get(Fn).hidden=Tt||pt?1:0);let Yn=this.variableOffsets[Ce];Yn&&this.markUsedJustification(o,Yn.anchor,ae,Dt);let pn=this.placedOrientations[Ce];pn&&(this.markUsedJustification(o,"left",ae,pn),this.markUsedOrientation(o,pn,ae))}if(xt){let zt=Ut?td:ps(Le.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:Pt}=ae,Jt=o.icon.placedSymbolArray,fn=Le.icon.isHidden()?1:0;Tt>=0&&(de(o.icon,Be,_t?td:zt),Jt.get(Tt).hidden=fn),Pt>=0&&(de(o.icon,ae.numVerticalIconVertices,pt?td:zt),Jt.get(Pt).hidden=fn)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let zt=o.collisionArrays[ue];if(zt){let Tt=new r.P(0,0),Pt=!0;if(zt.textBox||zt.verticalTextBox){if(U){let fn=this.variableOffsets[Ce];fn?(Tt=Zo(fn.anchor,fn.width,fn.height,fn.textOffset,fn.textScale),W&&Tt._rotate(q?this.transform.angle:-this.transform.angle)):Pt=!1}L&&(Pt=!Le.clipped),zt.textBox&&Wc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!Pt||_t,be,re,Tt.x,Tt.y),zt.verticalTextBox&&Wc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!Pt||pt,be,re,Tt.x,Tt.y)}let Jt=Pt&&!!(!pt&&zt.verticalIconBox);zt.iconBox&&Wc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,Jt,be,re,ae.hasIconTextFit?Tt.x:0,ae.hasIconTextFit?Tt.y:0),zt.verticalIconBox&&Wc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,!Jt,be,re,ae.hasIconTextFit?Tt.x:0,ae.hasIconTextFit?Tt.y:0)}}}if(o.fullyClipped=fe===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ue.invProjMatrix,o.placementViewportMatrix=ue.viewportMatrix,o.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){let f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>o}isStale(){return this.stale}setStale(){this.stale=!0}}function Wc(p,o,c,f,_,y,x){p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0)}let Mv=Math.pow(2,25),_p=Math.pow(2,24),pm=Math.pow(2,17),Dv=Math.pow(2,16),fm=Math.pow(2,9),hs=Math.pow(2,8),Kl=Math.pow(2,1);function ps(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let o=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Mv+o*_p+c*pm+o*Dv+c*fm+o*hs+c*Kl+o}let td=0;class qd{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,f,_,y,x){let w=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(w,_,o[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<w.length;){let S=w[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class po{constructor(o,c,f,_,y,x,w,S,M){this.placement=new zT(o,y,x,w,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,f,_,y){let x=r.o.now(),w=()=>{let S=r.o.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){let S=c[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&S.visibility!=="none"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){let A=S,L=A.layout.get("symbol-z-elevate"),F=A.layout.get("symbol-sort-key").constantOr(1)!==void 0,N=A.layout.get("symbol-z-order"),j=N==="viewport-y"||N==="auto"&&!(N!=="viewport-y"&&F),U=A.layout.get("text-allow-overlap")||A.layout.get("icon-allow-overlap")||A.layout.get("text-ignore-placement")||A.layout.get("icon-ignore-placement"),W=j&&U,q=this._inProgressLayer=this._inProgressLayer||new qd(A),ee=r.B(S.source,S.scope);if(q.continuePlacement(L||W?_[ee]:f[ee],this.placement,this._showCollisionBoxes,S,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let ba=512/r.al/2;class Ql{constructor(o,c,f){this.tileID=o,this.bucketInstanceId=f,this.index=new r.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=o.canonical.x*r.al,y=o.canonical.y*r.al;for(let x=0;x<c.length;x++){let{key:w,crossTileID:S,tileAnchorX:M,tileAnchorY:A}=c.get(x),L=Math.floor((_+M)*ba),F=Math.floor((y+A)*ba);this.index.add(L,F),this.keys.push(w),this.crossTileIDs.push(S)}this.index.finish()}findMatches(o,c,f){let _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),y=ba/Math.pow(2,c.canonical.z-this.tileID.canonical.z),x=c.canonical.x*r.al,w=c.canonical.y*r.al;for(let S=0;S<o.length;S++){let M=o.get(S);if(M.crossTileID)continue;let{key:A,tileAnchorX:L,tileAnchorY:F}=M,N=Math.floor((x+L)*y),j=Math.floor((w+F)*y),U=this.index.range(N-_,j-_,N+_,j+_).sort((W,q)=>W-q);for(let W of U){let q=this.crossTileIDs[W];if(this.keys[W]===A&&!f.has(q)){f.add(q),M.crossTileID=q;break}}}}}class oo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Av{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let c=Math.round((o-this.lng)/360);if(c!==0)for(let f in this.indexes){let _=this.indexes[f],y={};for(let x in _){let w=_[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),y[w.tileID.key]=w}this.indexes[f]=y}this.lng=o}addBucket(o,c,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let y=0;y<c.symbolInstances.length;y++)c.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let _=this.usedCrossTileIDs[o.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>o.overscaledZ)for(let w in x){let S=x[w];S.tileID.isChildOf(o)&&S.findMatches(c.symbolInstances,o,_)}else{let w=x[o.scaledTo(Number(y)).key];w&&w.findMatches(c.symbolInstances,o,_)}}for(let y=0;y<c.symbolInstances.length;y++){let x=c.symbolInstances.get(y);x.crossTileID||(x.crossTileID=f.generate(),_.add(x.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ql(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(let f of c.crossTileIDs)this.usedCrossTileIDs[o].delete(f)}removeStaleBuckets(o){let c=!1;for(let f in this.indexes){let _=this.indexes[f];for(let y in _)o[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],c=!0)}return c}}class Za{constructor(){this.layerIndexes={},this.crossTileIDs=new oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,f,_){let y=this.layerIndexes[o.fqid];y===void 0&&(y=this.layerIndexes[o.fqid]=new Av);let x=!1,w={};_.name!=="globe"&&y.handleWrapJump(f);for(let S of c){let M=S.getBucket(o);M&&o.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,M,this.crossTileIDs)&&(x=!0),w[M.bucketInstanceId]=!0)}return y.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(o){let c={};o.forEach(f=>{c[f]=!0});for(let f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}let yl=771;class yn{constructor(o,c,f,_){this.blendFunction=o,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=_}}yn.Replace=[1,0,1,0],yn.disabled=new yn(yn.Replace,r.ao.transparent,[!1,!1,!1,!1]),yn.unblended=new yn(yn.Replace,r.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlended=new yn([1,yl,1,yl],r.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlendedNonPremultiplied=new yn([770,yl,770,yl],r.ao.transparent,[!0,!0,!0,!0]),yn.multiply=new yn([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),yn.additive=new yn([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class Gt{constructor(o,c,f){this.func=o,this.mask=c,this.range=f}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);let mm=7680;class ln{constructor(o,c,f,_,y,x){this.test=o,this.ref=c,this.mask=f,this.fail=_,this.depthFail=y,this.pass=x}}ln.disabled=new ln({func:519,mask:0},0,0,mm,mm,mm);let Wd=1029,gm=2305;class an{constructor(o,c,f){this.enable=o,this.mode=c,this.frontFace=f}}function xl(p,o){let c=r.ca(p,3);r.cc(p,o),r.cg(p,3,c)}function Pv(p,o){let c=r.c7([]);return r.c8(c,c,-o),r.c9(c,c,-p),c}function _m(p,o){let c=[p[0],p[1],0],f=[o[0],o[1],0];if(r.ag(c)>=1e-15){let x=r.aw([],c);r.c5(f,x,r.bJ(f,x)),o[0]=f[0],o[1]=f[1]}let _=r.bI([],o,p);if(r.c6(_)<1e-15)return null;let y=Math.atan2(-_[1],_[0]);return Pv(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),y)}an.disabled=new an(!1,Wd,gm),an.backCCW=new an(!0,Wd,gm),an.backCW=new an(!0,Wd,2304),an.frontCW=new an(!0,1028,2304),an.frontCCW=new an(!0,1028,gm);class fs{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){let c=o instanceof r.ae?o:new r.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=r.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c,f){if(this.orientation=null,!this.position)return;let _=this.position,y=f||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(o)):0),x=r.ae.fromLngLat(o,y),w=[x.x-_.x,x.y-_.y,x.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=_m(w,c)}setPitchBearing(o,c){this.orientation=Pv(r.an(o),r.an(-c))}}class vm{constructor(o,c){this._transform=r.bA([]),this.orientation=c,this.position=o}get mercatorPosition(){let o=this.position;return new r.ae(o[0],o[1],o[2])}get position(){let o=r.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&r.cg(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.c7([]),o&&xl(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Pv(o,c),xl(this._transform,this._orientation)}forward(){let o=r.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=r.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=r.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){let f=new Float64Array(16);return r.bl(f,this.getWorldToCamera(o,c)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,c,f){let _=this.position;r.c5(_,_,-o);let y=new Float64Array(16);return r.bq(y,[f,f,f]),r.br(y,y,_),y[10]*=c,y}getWorldToCamera(o,c){let f=new Float64Array(16),_=new Float64Array(4),y=this.position;return r.cb(_,this._orientation),r.c5(y,y,-o),r.cc(f,_),r.br(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(o,c,f,_){let y=new Float64Array(16);return r.cd(y,o,c,f,_),y}getCameraToClipOrthographic(o,c,f,_,y,x){let w=new Float64Array(16);return r.ce(w,o,c,f,_,y,x),w}getDistanceToElevation(o,c=!1){let f=o===0?0:r.cf(o,c?r.a$(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new vm([...this.position],[...this.orientation])}}let Co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ym{constructor(o=0,c=0,f=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=f,this.right=_}interpolate(o,c,f){return c.top!=null&&o.top!=null&&(this.top=r.ak(o.top,c.top,f)),c.bottom!=null&&o.bottom!=null&&(this.bottom=r.ak(o.bottom,c.bottom,f)),c.left!=null&&o.left!=null&&(this.left=r.ak(o.left,c.left,f)),c.right!=null&&o.right!=null&&(this.right=r.ak(o.right,c.right,f)),this}getCenter(o,c){let f=r.aA((this.left+o-this.right)/2,0,o),_=r.aA((this.top+c-this.bottom)/2,0,c);return new r.P(f,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ym(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Ya=15;class Ov{constructor(o,c,f,_,y,x,w){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new r.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ym,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new vm,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let o=new Ov(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ya}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,c=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(o||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=r.cm(this.projectionOptions);let f=this.getProjection(),_=!r.by(c,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cm({name:"mercator"});let c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let c=-o*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=r.cn(),r.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let c=r.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;let o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),_=0,y=0;for(let x=0;x<c.length;x++){let w=new r.P(c[x][0]*this.width,f+c[x][1]*(this.height-f)),S=o.pointCoordinate(w);if(!S)continue;let M=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);_+=S[3]*M,y+=M}return y===0?NaN:_/y}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){let c=this.elevation,f=o.elevation,_=c!=null!=(f!=null)||c&&f&&c.exaggeration()!==f.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!_}computeZoomRelativeTo(o){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),f;f=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];let _=r.ag(r.av([],this._camera.position,f));return r.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!r.cp(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){let f=[o.position.x,o.position.y,o.position.z];r.cq(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,c=new fs;return c.position=new r.ae(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!r.cr(o))return!1;r.cs(o,o);let c=r.ct([],[0,0,-1],o),f=r.ct([],[0,-1,0],o);if(f[2]<0)return!1;let _=_m(c,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){let c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=r.aA(o[2],_/f,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,f){this._unmodified=!1,this._edgeInsets.interpolate(o,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){let c=[new r.cu(0,o)];if(this.renderWorldCopies){let f=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),w=Math.floor(Math.min(f.x,_.x,y.x,x.x)),S=Math.floor(Math.max(f.x,_.x,y.x,x.x)),M=1;for(let A=w-M;A<=S+M;A++)A!==0&&c.push(new r.cu(A,o))}return c}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,c,f,_){let y=[],x=f!=null,w=!x;if(w&&this.zoom<c||x&&f[0]===0&&f[1]===0)return y;let S=new Set,M=(L,F,N,j,U)=>{let W=r.cY(F,L,N,j,U);S.has(W)||(y.push(new r.aQ(L,F,N,j,U)),S.add(W))};for(let L=0;L<o.length;L++){let F=o[L];if(w&&F.canonical.z!==c||x&&_!==void 0&&_>F.canonical.z)continue;let N=F.canonical,j=F.overscaledZ,U=F.wrap,W=1<<N.z,q=N.x+1<W,ee=N.x>0,re=N.y+1<W,te=N.y>0,ge=F.wrap-(ee?0:1),de=F.wrap+(q?0:1),fe=ee?N.x-1:W-1,ue=q?N.x+1:0;if(x)f[0]<0?(M(j,de,N.z,ue,N.y),f[1]<0&&re&&(M(j,U,N.z,N.x,N.y+1),M(j,de,N.z,ue,N.y+1)),f[1]>0&&te&&(M(j,U,N.z,N.x,N.y-1),M(j,de,N.z,ue,N.y-1))):f[0]>0?(M(j,ge,N.z,fe,N.y),f[1]<0&&re&&(M(j,U,N.z,N.x,N.y+1),M(j,ge,N.z,fe,N.y+1)),f[1]>0&&te&&(M(j,U,N.z,N.x,N.y-1),M(j,ge,N.z,fe,N.y-1))):f[1]<0&&re?M(j,U,N.z,N.x,N.y+1):te&&M(j,U,N.z,N.x,N.y-1);else{let ae=F.visibleQuadrants;1&ae&&(M(j,ge,N.z,fe,N.y),te&&(M(j,U,N.z,N.x,N.y-1),M(j,ge,N.z,fe,N.y-1))),2&ae&&(M(j,de,N.z,ue,N.y),te&&(M(j,U,N.z,N.x,N.y-1),M(j,de,N.z,ue,N.y-1))),4&ae&&(M(j,ge,N.z,fe,N.y),re&&(M(j,U,N.z,N.x,N.y+1),M(j,ge,N.z,fe,N.y+1))),8&ae&&(M(j,de,N.z,ue,N.y),re&&(M(j,U,N.z,N.x,N.y+1),M(j,de,N.z,ue,N.y+1)))}}let A=[];for(let L of y)y.some(F=>L.isChildOf(F))||A.push(L);if(y=A.filter(L=>!o.some(F=>!!(L.overscaledZ<c&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),w){let L=1<<c,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[L*F.x,L*F.y],j=4,U=j*j;y=y.filter(W=>{let q=W.canonical.x+.5-N[0],ee=W.canonical.y+.5-N[1];return q*q+ee*ee<U})}return y}extendTileCoverToNearPlane(o,c,f){let _=[],y=new Set;for(let ee of o)y.add(ee.key);let x=(ee,re,te,ge,de)=>{let fe=r.cY(re,ee,te,ge,de);y.has(fe)||(_.push(new r.aQ(ee,re,te,ge,de)),y.add(fe))},w=o.reduce((ee,re)=>Math.max(ee,re.overscaledZ),f),S=1<<f,M=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],A=new r.P(0,0),L=new r.P(0,0),F=(ee,re)=>{let te=Math.floor(ee[0]),ge=Math.floor(ee[1]),de=(ee[0]-te)*r.al,fe=(ee[1]-ge)*r.al,ue=Math.floor(re[0]),ae=Math.floor(re[1]),_e=(re[0]-ue)*r.al,Te=(re[1]-ae)*r.al;for(let Ce=-1;Ce<=1;Ce++){let Be=te+Ce;if(!(Be<0||Be>=S)){A.x=de-Ce*r.al,L.x=_e-(Be-ue)*r.al;for(let Ue=-1;Ue<=1;Ue++){let Ye=ge+Ue;A.y=fe-Ue*r.al,L.y=Te-(Ye-ae)*r.al,r.cZ(A,L,M)&&x(w,0,f,Be,Ye)}}}},N=c.points,j=N[r.cv],U=N[r.cw],W=this._projectToGround(j,N[r.cx]),q=this._projectToGround(U,N[r.cy]);return F(j,W),F(U,q),_}_projectToGround(o,c){return r.cz(r.cA(),o,c,o[2]/(o[2]-c[2]))}coveringTiles(o){let c=this.coveringZoomLevel(o),f=c,_=this.elevation&&this.elevation.exaggeration(),y=_&&!o.isTerrainDEM,x=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);let w=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,A=[M*w.x,M*w.y,0],L=this.projection.name==="globe",F=!L,N=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,F),j=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=M*r.cf(1,this.center.lat),W=this._camera.position[2]/r.cf(1,this.center.lat),q=[M*j.x,M*j.y,W*(F?1:U)],ee=L||_,re=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),te=this.isLODDisabled(!0)?c:0,ge;if(this._elevation&&o.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let be=this._elevation.getMinMaxForVisibleTiles();ge=be?be.max:this._centerAltitude}else ge=this._centerAltitude;let de=o.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?r.cC(this):1,ue=be=>{let Le=new r.ae(be.x+25e-6,be.y,be.z),tt=new r.ae(be.x,be.y+25e-6,be.z),xt=be.toLngLat(),Dt=Le.toLngLat(),_t=tt.toLngLat(),pt=this.locationCoordinate(xt),Ut=this.locationCoordinate(Dt),zt=this.locationCoordinate(_t),Tt=Math.hypot(Ut.x-pt.x,Ut.y-pt.y),Pt=Math.hypot(zt.x-pt.x,zt.y-pt.y);return Math.sqrt(Tt*Pt)*fe/25e-6},ae=be=>{let Ge=ge,Le=de;return{aabb:r.cF(this,M,0,0,0,be,Le,Ge,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:Ge,wrap:be,fullyVisible:!1}},_e=[],Te=[],Ce=c,Be=o.reparseOverscaled?f:c,Ue=(W-this._centerAltitude)*U,Ye=be=>{if(!this._elevation||!be.tileID||!x)return;let Ge=this._elevation.getMinMaxForTile(be.tileID),Le=be.aabb;Ge?(Le.min[2]=Ge.min,Le.max[2]=Ge.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(be.shouldSplit=Fe(be),be.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},dt=(be,Ge)=>{if(.707*Ge<be)return 1;let Le=Ge/be;return Le/(1.4144271570014144+(Math.pow(1.1,Le-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=be=>{if(be.zoom<te)return!0;if(be.zoom===Ce)return!1;if(be.shouldSplit!=null)return be.shouldSplit;let Ge=be.aabb.distanceX(q),Le=be.aabb.distanceY(q),tt=Ue,xt=1;if(L){tt=be.aabb.distanceZ(q);let Pt=Math.pow(2,be.zoom),Jt=r.a$((be.y+1)/Pt),fn=r.a$(be.y/Pt),Fn=Math.min(Math.max(S,Jt),fn),Jn=r.d1(Fn)/r.d1(S);if(xt=Fn===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jn/this._mercatorScaleRatio),this.zoom<=r.c_&&be.zoom===Ce-1&&Jn>=.9)return!0}else if(y&&(tt=be.aabb.distanceZ(q)*U),this.projection.isReprojectedInTileSpace&&f<=5){let Pt=Math.pow(2,be.zoom),Jt=ue(new r.ae((be.x+.5)/Pt,(be.y+.5)/Pt));xt=Jt>.85?1:Jt}if(!x&&!L){let Pt=Math.sqrt(Ge*Ge+Le*Le+tt*tt),Jt=(1<<Ce-be.zoom)*re*xt;return Jt*=dt(Math.max(tt,Ue),Pt),Pt<Jt}let Dt=Number.MAX_VALUE,_t=0,pt=be.aabb.getCorners(),Ut=[];for(let Pt of pt){r.av(Ut,Pt,q),L||(y?Ut[2]*=U:Ut[2]=Ue);let Jt=r.bJ(Ut,this._camera.forward());Jt<Dt&&(Dt=Jt,_t=Math.abs(Ut[2]))}let zt=(1<<Ce-be.zoom)*re*xt;if(zt*=dt(Math.max(_t,Ue),Dt),Dt<zt)return!0;let Tt=be.aabb.closestPoint(A);return Tt[0]===A[0]&&Tt[1]===A[1]};if(this.renderWorldCopies)for(let be=1;be<=3;be++)_e.push(ae(-be)),_e.push(ae(be));for(_e.push(ae(0));_e.length>0;){let be=_e.pop(),Ge=be.x,Le=be.y,tt=be.fullyVisible,xt=()=>this.projection.name==="globe"&&(be.y===0||be.y===(1<<be.zoom)-1);if(!tt){let Dt=ee?be.aabb.intersects(N):be.aabb.intersectsFlat(N);if(Dt===0&&xt()){let _t=new r.cD(be.zoom,Ge,Le);Dt=r.cE(this,M,_t,!0).intersects(N)}if(Dt===0)continue;tt=Dt===2}if(be.zoom!==Ce&&Fe(be))for(let Dt=0;Dt<4;Dt++){let _t=(Ge<<1)+Dt%2,pt=(Le<<1)+(Dt>>1),Ut={aabb:x?be.aabb.quadrant(Dt):r.cF(this,M,be.zoom+1,_t,pt,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:_t,y:pt,wrap:be.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};y&&!L&&(Ut.tileID=new r.aQ(be.zoom+1===Ce?Be:be.zoom+1,be.wrap,be.zoom+1,_t,pt),Ye(Ut)),_e.push(Ut)}else{let Dt=be.zoom===Ce?Be:be.zoom;if(o.minzoom&&o.minzoom>Dt)continue;let _t=0;if(!tt){let Tt=ee?be.aabb.intersectsPrecise(N):be.aabb.intersectsPreciseFlat(N);if(Tt===0&&xt()){let Pt=new r.cD(be.zoom,Ge,Le);Tt=r.cE(this,M,Pt,!0).intersectsPrecise(N)}if(Tt===0)continue;if(o.calculateQuadrantVisibility)if(N.containsPoint(be.aabb.center))_t=15;else for(let Pt=0;Pt<4;Pt++)be.aabb.quadrant(Pt).intersects(N)!==0&&(_t|=1<<Pt)}let pt=A[0]-(.5+Ge+(be.wrap<<be.zoom))*(1<<c-be.zoom),Ut=A[1]-.5-Le,zt=be.tileID?be.tileID:new r.aQ(Dt,be.wrap,be.zoom,Ge,Le);o.calculateQuadrantVisibility&&(zt.visibleQuadrants=_t),Te.push({tileID:zt,distanceSq:pt*pt+Ut*Ut})}}if(this.fogCullDistSq){let be=this.fogCullDistSq,Ge=this.horizonLineFromTop();Te=Te.filter(Le=>{let tt=[0,0,0,1],xt=[r.al,r.al,0,1],Dt=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());r.aC(tt,tt,Dt),r.aC(xt,xt,Dt);let _t=r.cG([],tt,xt),pt=r.cH([],tt,xt),Ut=r.c$(_t,pt);if(Ut===0)return!0;let zt=!1,Tt=this._elevation;if(Tt&&Ut>be&&Ge!==0){let Pt=this.calculateProjMatrix(Le.tileID.toUnwrapped()),Jt;o.isTerrainDEM||(Jt=Tt.getMinMaxForTile(Le.tileID)),Jt||(Jt={min:de,max:ge});let fn=r.cI(this.rotation),Fn=[fn[0]*r.al,fn[1]*r.al,Jt.max];r.af(Fn,Fn,Pt),zt=(1-Fn[1])*this.height*.5<Ge}return Ut<be||zt})}return Te.sort((be,Ge)=>be.distanceSq-Ge.distanceSq).map(be=>be.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){let c=r.aA(o.lat,-r.cJ,r.cJ),f=this.projection.project(o.lng,c);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let f,_,y=this.centerPoint;if(this.projection.name==="globe"){let w=this.worldSize;f=(c.x-y.x)/w,_=(c.y-y.y)/w}else{let w=this.pointCoordinate(c),S=this.pointCoordinate(y);f=w.x-S.x,_=w.y-S.y}let x=this.locationCoordinate(o);this.setLocation(new r.ae(x.x-f,x.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,c){return this.projection.locationPoint(this,o,c)}locationPoint3D(o,c){return this.projection.locationPoint(this,o,c,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,c){return this.coordinateLocation(this.pointCoordinate3D(o,c))}locationCoordinate(o,c){let f=c?r.cf(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new r.ae(_.x,_.y,f)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){let f=c??this._centerAltitude,_=[o.x,o.y,0,1],y=[o.x,o.y,1,1];r.aC(_,_,this.pixelMatrixInverse),r.aC(y,y,this.pixelMatrixInverse);let x=y[3];r.cK(_,_,1/_[3]),r.cK(y,y,1/x);let w=_[2],S=y[2];return{p0:_,p1:y,t:w===S?0:(f-w)/(S-w)}}screenPointToMercatorRay(o){let c=[o.x,o.y,0,1],f=[o.x,o.y,1,1];return r.aC(c,c,this.pixelMatrixInverse),r.aC(f,f,this.pixelMatrixInverse),r.cK(c,c,1/c[3]),r.cK(f,f,1/f[3]),c[2]=r.cf(c[2],this._center.lat)*this.worldSize,f[2]=r.cf(f[2],this._center.lat)*this.worldSize,r.cK(c,c,1/this.worldSize),r.cK(f,f,1/this.worldSize),new r.ax([c[0],c[1],c[2]],r.aw([],r.av([],f,c)))}rayIntersectionCoordinate(o){let{p0:c,p1:f,t:_}=o,y=r.cf(c[2],this._center.lat),x=r.cf(f[2],this._center.lat);return new r.ae(r.ak(c[0],f[0],_)/this.worldSize,r.ak(c[1],f[1],_)/this.worldSize,r.ak(y,x,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o,c){if(!this.elevation)return this.pointCoordinate(o,c);let f=this.projection.pointCoordinate3D(this,o.x,o.y);if(f)return new r.ae(f[0],f[1],f[2]);let _=0,y=this.horizonLineFromTop();if(o.y>y)return this.pointCoordinate(o,c);let x=.02*y,w=o.clone();for(let S=0;S<10&&y-_>x;S++){w.y=r.ak(_,y,.66);let M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(y=w.y,f=M):_=w.y}return f?new r.ae(f[0],f[1],f[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.cL)return!this.isPointAboveHorizon(o);let c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){let f=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,f+o.toAltitude(),1];return r.aC(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(c,o)),x=this.pointLocation3D(new r.P(_,o)),w=this.pointLocation3D(new r.P(_,f)),S=this.pointLocation3D(new r.P(c,f)),M=Math.min(y.lng,x.lng,w.lng,S.lng),A=Math.max(y.lng,x.lng,w.lng,S.lng),L=Math.min(y.lat,x.lat,w.lat,S.lat),F=Math.max(y.lat,x.lat,w.lat,S.lat),N=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=(W,q,ee,re,te)=>{let ge=(W+ee)/2,de=(q+re)/2,fe=new r.P(ge,de),{lng:ue,lat:ae}=this.pointLocation3D(fe),_e=Math.max(0,M-ue,L-ae,ue-A,ae-F);M=Math.min(M,ue),A=Math.max(A,ue),L=Math.min(L,ae),F=Math.max(F,ae),(te<j||_e>N)&&(U(W,q,ge,de,te+1),U(ge,de,ee,re,te+1))};if(U(c,o,_,o,1),U(_,o,_,f,1),U(_,f,c,f,1),U(c,f,c,o,1),this.projection.name==="globe"){let[W,q]=r.cM(this);W?(F=90,A=180,M=-180):q&&(L=-90,A=180,M=-180)}return new r.aI(new r.aT(M,L),new r.aT(A,F))}_getBoundsRectangular(o,c){let{top:f,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=new r.P(_,f),S=new r.P(x,f),M=new r.P(x,y),A=new r.P(_,y),L=this.pointCoordinate(w,o),F=this.pointCoordinate(S,o),N=this.pointCoordinate(M,c),j=this.pointCoordinate(A,c),U=(W,q)=>(q.y-W.y)/(q.x-W.x);return L.y>1&&F.y>=0?L=new r.ae((1-j.y)/U(j,L)+j.x,1):L.y<0&&F.y<=1&&(L=new r.ae(-j.y/U(j,L)+j.x,0)),F.y>1&&L.y>=0?F=new r.ae((1-N.y)/U(N,F)+N.x,1):F.y<0&&L.y<=1&&(F=new r.ae(-N.y/U(N,F)+N.x,0)),new r.aI().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=o.visibleDemTiles.reduce((f,_)=>{if(_.dem){let y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.cJ,this.maxLat=r.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){let c=o.key,f=this._distanceTileDataCache;if(f[c])return f[c];let _=o.canonical,y=1/this.height,x=this.cameraWorldSize,w=x/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*o.wrap)*w,M=_.y*w,A=this.point;A.x*=x/this.worldSize,A.y*=x/this.worldSize;let L=this.angle,F=Math.sin(-L),N=-Math.cos(-L);return f[c]={bearing:[F,N],center:[(A.x-S)*y,(A.y-M)*y],scale:w/r.al*y},f[c]}calculateFogTileMatrix(o){let c=o.key,f=this._fogTileMatrixCache;if(f[c])return f[c];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.aB(_,this.worldToFogMatrix,_),f[c]=new Float32Array(_),f[c]}calculateProjMatrix(o,c=!1,f=!1){let _=o.key,y;if(y=f?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];let x=this.calculatePosMatrix(o,this.worldSize),w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,r.aB(x,w,x),y[_]=new Float32Array(x),y[_]}calculatePixelsToTileUnitsMatrix(o){let c=o.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];let _=r.cN(o,this);return f[c]=_,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,c=r.bq([],[o,o,o]);return r.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let c=r.cf(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=this._camera.forward(),y=r.cf(1,this._center.lat);f[2]/=y,_[2]/=y,r.aw(_,_);let x=o.raycast(f,_,o.exaggeration());if(x){let w=r.bH([],f,_,x),S=new r.ae(w[0],w[1],r.cf(w[2],r.a$(w[1]))),M=(S.z+r.ag([S.x-f[0],S.y-f[1],S.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let c=this._elevation,f=r.cf(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),y=c.getAtPointOrZero(new r.ae(..._)),x=this.pixelsPerMeter/this.worldSize*y,w=this._minimumHeightOverTerrain(),S=_[2]-x;if(S<=w)if(S<0||o){let M=this.locationCoordinate(this._center,this._centerAltitude),A=[_[0],_[1],M.z-_[2]],L=r.ag(A);A[2]-=(w-S)/this._pixelsPerMercatorPixel;let F=r.ag(A);if(F===0)return;r.c5(A,A,L/F*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let F=this.center;return F.lat=r.aA(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(F.lng=r.aA(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let c=this._unmodified,{x:f,y:_}=this.point,y=0,x=f,w=_,S=this.width/2,M=this.height/2,A=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-M<A&&(w=A+M),_+M>L&&(w=L-M),L-A<this.height&&(y=Math.max(y,this.height/(L-A)),w=(L+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,j=this.worldSize/2-(F+N)/2;x=(f+j+this.worldSize)%this.worldSize-j,x-S<F&&(x=F+S),x+S>N&&(x=N-S),N-F<this.width&&(y=Math.max(y,this.width/(N-F)),x=(N+F)/2)}x===f&&w===_||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(x,w))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,c=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.cf(1,this.center.lat)/r.cf(1,r.d2));let _=r.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?f:1,x=this._camera.getWorldToCamera(this.worldSize,y),w,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-o.x/this.width,S[9]=2*o.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),_e=ae*this.aspect,Te=-_e,Ce=-ae;_e-=o.x,Te-=o.x,ae+=o.y,Ce+=o.y,w=this._camera.getCameraToClipOrthographic(Te,_e,Ce,ae,this._nearZ,this._farZ),((Be,Ue,Ye,dt)=>{for(let Fe=0;Fe<16;Fe++)Be[Fe]=r.ak(Ue[Fe],Ye[Fe],dt)})(w,w,S,r.d0(this.pitch>=Ya?1:this.pitch/Ya))}else w=S;let M=r.cP([],S,x),A=r.cP([],w,x);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),_e=r.bA([]);r.br(_e,_e,[ae.x*this.worldSize,ae.y*this.worldSize,0]),r.aB(_e,_e,r.cQ(this)),r.br(_e,_e,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),r.aB(A,A,_e),r.aB(M,M,_e),this.inverseAdjustmentMatrix=r.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cS([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),c){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-o.x/this.width,ae[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.cP([],ae,x)}else this.expandedFarZProjMatrix=this.projMatrix;let L=r.bl([],w);this.frustumCorners=r.cT.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let F=new Float32Array(16);r.bA(F),r.cS(F,F,[1,-1,1]),r.cU(F,F,this._pitch),r.bB(F,F,this.angle);let N=r.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(N);let j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-o.x/this.width,N[9]=2*(o.y+j)/this.height,this.skyboxMatrix=r.aB(F,N,F);let U=this.point,W=U.x,q=U.y,ee=this.width%2/2,re=this.height%2/2,te=Math.cos(this.angle),ge=Math.sin(this.angle),de=W-Math.round(W)+te*ee+ge*re,fe=q-Math.round(q)+te*re+ge*ee,ue=new Float64Array(A);if(r.br(ue,ue,[de>.5?de-1:de,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ue,A=r.bC(),r.cS(A,A,[this.width/2,-this.height/2,1]),r.br(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=r.bC(),r.cS(A,A,[1,-1,1]),r.br(A,A,[-1,-1,0]),r.cS(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},A=r.bl(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cV(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(ae,ae,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[o,o,c];r.c5(y,y,_),r.c5(f,f,-1),r.cW(f,f,y);let x=r.bC();r.br(x,x,f),r.cS(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){let c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,o/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=o[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((c-f)/_,1)),this._camera.position=r.bH([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=r.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),w=Math.max((o[2]-y)/Math.cos(f),x),S=this._zoomFromMercatorZ(w);r.bH(o,o,c,w),this._pitch=r.aA(f,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(_,-Math.PI,Math.PI),this._setZoom(r.aA(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,f=r.cL,_=0,y=1/0;for(;f-c>1e-6&&f>c;){let x=c+.5*(f-c),w=this.tileSize*Math.pow(2,x),S=this.getCameraToCenterDistance(this.projection,x,w),M=this.scaleZoom(S/(Math.max(0,o)*this.tileSize)),A=Math.abs(x-M);A<y&&(y=A,_=x),x<M?c=x:f=x}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){let f=Math.min(o.x,c.x),_=Math.max(o.x,c.x),y=Math.min(o.y,c.y),x=Math.max(o.y,c.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let w=[new r.P(f,y),new r.P(_,x),new r.P(f,x),new r.P(_,y)],S=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let A of w){let L=this.pointRayIntersection(A);if(L.t<0)return!0;let F=this.rayIntersectionCoordinate(L);if(F.x<S||F.y<0||F.x>M||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,c){let f=r.ag(r.av([],this._camera.position,o)),_=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let o=(function([c,f,_],y){let x=[c,f,_,1];r.aC(x,x,y);let w=x[3]=Math.max(x[3],1e-6);return x[0]/=w,x[1]/=w,x[2]/=w,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,c=this.zoom,f=this.worldSize){let _=r.cO(o,c,this.width,this.height,1024),y=o.pixelSpaceConversion(this.center.lat,f,_),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=r.ak(1,x,r.d0(this.pitch>=Ya?1:this.pitch/Ya))),x}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(o,o,this.globeMatrix),o}getFrustum(o){return r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Zc=(p,o)=>{if(o>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),o<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=p.transform,f=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),_=c.isLODDisabled(!1)?r.ah(60,45,c.pitch):r.ah(30,15,c.pitch),y=c._farZ-c._nearZ,x=o*c.height,w=((1-(S=_))*c.cameraToCenterDistance+S*(c._farZ+x))*f;var S;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(w-c._nearZ)/y,(w-x-c._nearZ)/y]}}},wa=2048;class vp{constructor(o,c){this.aabb=o,this.lastCascade=c}}class BT{add(o,c){let f=this.receivers[o.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],c.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],c.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],c.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],c.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],c.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],c.max[2])):this.receivers[o.key]=new vp(c,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,c,f){let _=r.d9.fromPoints(o.points),y=0;for(let x in this.receivers){let w=this.receivers[x];if(!w||!_.intersectsAabb(w.aabb))continue;w.aabb.min=_.closestPoint(w.aabb.min),w.aabb.max=_.closestPoint(w.aabb.max);let S=w.aabb.getCorners();for(let M=0;M<f.length;M++){let A=!0;for(let L of S){let F=[L[0]*c,L[1]*c,L[2]];if(r.af(F,F,f[M].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){A=!1;break}}if(w.lastCascade=M,y=Math.max(y,M),A)break}}return y+1}}class Zd{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new BT,this._depthMode=new Gt(o.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,c){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let _=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((j,U)=>{let W=f.style._mergedLayers[U];return j+(W.hasShadowPass()&&!W.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=f.context,x=wa,w=wa;if(this._cascades.length===0||wa!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<2;++j){let U=f._shadowMapDebug,W=y.gl,q=y.createFramebuffer(x,w,U?1:0,"texture"),ee=new r.T(y,{width:x,height:w,data:null},W.DEPTH_COMPONENT16);if(q.depthAttachment.set(ee.texture),U){let re=new r.T(y,{width:x,height:w,data:null},W.RGBA8);q.colorAttachment0.set(re.texture)}this._cascades.push({framebuffer:q,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cB,scale:0})}}this.shadowDirection=xp(c);let S=0;if(o.elevation){let j=o.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter(W=>W.dem).forEach(W=>{let q=W.dem.tree;U[0]=Math.min(U[0],q.minimums[0]),U[1]=Math.max(U[1],q.maximums[0])}),U[0]!==1e4&&(S=(U[1]-U[0])*j.exaggeration())}let M=1.5*o.cameraToCenterDistance,A=3*M,L=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){let U=this._cascades[j],W=o.height/50,q=1;j===0?q=M:(W=M,q=A);let[ee,re]=Yc(o,this.shadowDirection,W,q,wa,S);U.scale=o.scale,U.matrix=ee,U.boundingSphereRadius=re,r.bl(L,U.matrix),U.frustum=r.cB.fromInvProjectionMatrix(L,1,0,!0),U.far=q}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=wa,this._uniformValues.u_shadowmap_0=Co.ShadowMap0,this._uniformValues.u_shadowmap_1=Co.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let N=f.transform.elevation;for(let j of this._groundShadowTiles){let U={min:0,max:0};if(N){let W=N.getMinMaxForTile(j);W&&(U=W)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,c){if(!this.enabled)return;let f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,wa,wa]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:r.ao.white,depth:1});for(let x of o.order){let w=o._mergedLayers[x];if(!w.hasShadowPass()||w.isHidden(f.transform.zoom))continue;let S=o.getLayerSourceCache(w),M=S?c[S.id]:void 0;(w.type==="model"||M&&M.length)&&f.renderLayer(f,S,w,M)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,c=o.style,f=o.context,_=f.gl,y=c.directionalLight,x=c.ambientLight;if(!y||!x)return;let w=[],S=Zc(o,o.longestCutoffRange);S.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");let M=Jl(c,y,x),A=new Gt(_.LEQUAL,Gt.ReadOnly,o.depthRangeFor3D),L=new ln({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(let F of this._groundShadowTiles){let N=F.toUnwrapped(),j=o.isTileAffectedByFog(F),U=o.getOrCreateProgram("groundShadow",{defines:w,overrideFog:j});this.setupShadows(N,U),o.uploadCommonUniforms(f,U,N,null,S);let W={u_matrix:o.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};U.draw(o,_.TRIANGLES,A,L,yn.multiply,an.disabled,W,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yn.unblended:yn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let c=this.painter.transform,f=c.calculatePosMatrix(o,c.worldSize);return r.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(o){let c=r.bz(o);return r.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,o),c}setupShadows(o,c,f){if(!this.enabled)return;let _=this.painter.transform,y=this.painter.context,x=y.gl,w=this._uniformValues,S=new Float64Array(16),M=_.calculatePosMatrix(o,_.worldSize);for(let A=0;A<this._cascades.length;A++)r.aB(S,this._cascades[A].matrix,M),w[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),y.activeTexture.set(x.TEXTURE0+Co.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){let A=r.d7(o.canonical),L=2/_.tileSize*r.al/wa,F=L*this._cascades[0].boundingSphereRadius,N=L*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(f==="vector-tile"?1:3)*(function(U,W,q,ee,re){let te=r.aA((U-22)/-22,0,1);return .125*(1-te)+4*te})(_.zoom);w.u_shadow_normal_offset=[A,F*j,N*j],w.u_shadow_bias=[1e-4,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,w)}setupShadowsFromMatrix(o,c,f=!1){if(!this.enabled)return;let _=this.painter.context,y=_.gl,x=this._uniformValues,w=new Float64Array(16);for(let S=0;S<2;S++)r.aB(w,this._cascades[S].matrix,o),x[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),_.activeTexture.set(y.TEXTURE0+Co.ShadowMap0+S),this._cascades[S].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);this.useNormalOffset=f,f?(x.u_shadow_normal_offset=[1,3,3],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(_,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,c,f,_){if(_[2]>=0)return{};let y=(function(S,M,A){let L=A/(1<<S.canonical.z);return new r.d9([S.canonical.x*L+S.wrap*A,S.canonical.y*L+S.wrap*A,0],[(S.canonical.x+1)*L+S.wrap*A,(S.canonical.y+1)*L+S.wrap*A,M])})(o,c,f).getCorners(),x=c/-_[2];_[0]<0?(r.d8(y[0],y[0],[_[0]*x,0,0]),r.d8(y[3],y[3],[_[0]*x,0,0])):_[0]>0&&(r.d8(y[1],y[1],[_[0]*x,0,0]),r.d8(y[2],y[2],[_[0]*x,0,0])),_[1]<0?(r.d8(y[0],y[0],[0,_[1]*x,0]),r.d8(y[1],y[1],[0,_[1]*x,0])):_[1]>0&&(r.d8(y[2],y[2],[0,_[1]*x,0]),r.d8(y[3],y[3],[0,_[1]*x,0]));let w={};return w.vertices=y,w.planes=[yp(y[1],y[0],y[4]),yp(y[2],y[1],y[5]),yp(y[3],y[2],y[6]),yp(y[0],y[3],y[7])],w}addShadowReceiver(o,c,f){this._receivers.add(o,r.d9.fromTileIdAndHeight(o,c,f))}getMaxCascadeForTile(o){let c=this._receivers.get(o);return c&&c.lastCascade?c.lastCascade:0}}function yp(p,o,c){let f=r.av([],c,o),_=r.av([],p,o),y=r.bI([],f,_),x=r.ag(y);return x===0?[0,0,1,0]:(r.c5(y,y,1/x),[y[0],y[1],y[2],-r.bJ(y,o)])}function xp(p){let o=p.properties.get("direction"),c=r.d4(o.x,o.y,o.z);c[2]=r.aA(c[2],0,75);let f=r.d6([c[0],c[1],c[2]]);return r.d5(f.x,f.y,f.z)}function Jl(p,o,c){let f=o.properties.get("color-use-theme")==="none",_=o.properties.get("color"),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=[x.x,x.y,x.z],S=c.properties.get("color-use-theme")==="none",M=c.properties.get("color"),A=c.properties.get("intensity"),L=Math.max(r.bJ([0,0,1],w),0),F=[0,0,0];r.c5(F,M.toPremultipliedRenderColor(S?null:p.getLut(o.scope)).toArray01Linear().slice(0,3),A);let N=[0,0,0];return r.c5(N,_.toPremultipliedRenderColor(f?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),L*y),r.db([F[0]>0?F[0]/(F[0]+N[0]):0,F[1]>0?F[1]/(F[1]+N[1]):0,F[2]>0?F[2]/(F[2]+N[2]):0])}function Yc(p,o,c,f,_,y){let x=p.zoom,w=p.scale,S=p.worldSize,M=1/S,A=p.aspect,L=Math.sqrt(1+A*A)*Math.tan(.5*p.fovX),F=L*L,N=f-c,j=f+c,U,W;F>N/j?(U=f,W=f*L):(U=.5*j*(1+F),W=.5*Math.sqrt(N*N+2*(f*f+c*c)*F+j*j*F*F));let q=p.projection.pixelsPerMeter(p.center.lat,S),ee=p._camera.getCameraToWorldMercator(),re=[0,0,-U*M];r.af(re,re,ee);let te=W*M,ge=p._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let tt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?q:1),xt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,f);xt[8]=2*-p.centerOffset.x/p.width,xt[9]=2*p.centerOffset.y/p.height;let Dt=new Float64Array(16);r.cP(Dt,xt,tt);let _t=new Float64Array(16);r.bl(_t,Dt);let pt=r.cB.fromInvProjectionMatrix(_t,S,x,!0);for(let Ut of pt.points){let zt=((de=Ut)[0]/=w,de[1]/=w,de[2]=r.cf(de[2],p._center.lat),de);te=Math.max(te,r.c6(r.da([],re,zt)))}}var de;te*=_/(_-1);let fe=Math.acos(o[2]),ue=Math.atan2(-o[0],-o[1]),ae=new vm;ae.position=re,ae.setPitchBearing(fe,ue);let _e=ae.getWorldToCamera(S,q),Te=te*S,Ce=Math.min(p._mercatorZfromZoom(17)*S*-2,-2*Te),Be=ae.getCameraToClipOrthographic(-Te,Te,-Te,Te,Ce,(Te+y*q)/o[2]),Ue=new Float64Array(16);r.aB(Ue,Be,_e);let Ye=r.d5(Math.floor(1e6*re[0])/1e6*S,Math.floor(1e6*re[1])/1e6*S,0),dt=.5*_,Fe=[0,0,0];r.af(Fe,Ye,Ue),r.c5(Fe,Fe,dt);let be=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ge=[0,0,0];r.av(Ge,Fe,be),r.c5(Ge,Ge,-1/dt);let Le=new Float64Array(16);return r.bA(Le),r.br(Le,Le,Ge),r.aB(Ue,Le,Ue),[Ue,Te]}class VT extends r.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,c){return r.dc(this.requestManager.transformRequest(c,r.R.Model).url).then(f=>{if(!f)return;let _=r.dd(f),y=new r.de(o,c,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${o} from ${c}: ${f.message}`)))})}load(o,c,f={forceReload:!1}){this.models[c]||(this.models[c]={});let _=Object.keys(o),y=[],x=[];for(let w of _){let S=o[w];this.hasURLBeenRequested(S)&&!f.forceReload||(this.modelByURL[S]={modelId:w,scope:c},y.push(this.loadModel(w,S)),x.push(w)),this.models[c][w]||(this.models[c][w]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+x.length,Promise.allSettled(y).then(w=>{for(let S=0;S<w.length;S++){let{status:M}=w[S];if(M==="rejected")continue;let{value:A}=w[S];this.models[c][x[S]]||(this.models[c][x[S]]={model:null,numReferences:1}),this.models[c][x[S]].model=A}this.numModelsLoading[c]-=x.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(w=>{this.fire(new r.y(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,c,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(o,c):this.getModelByURL(this.modelUris[c][o]))}getModel(o,c){return this.models[c]||(this.models[c]={}),this.models[c][o]?this.models[c][o].model:void 0}getModelByURL(o){if(!o)return null;let c=this.modelByURL[o];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(o,c){return this.models[c]&&this.models[c][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,c,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});let _=this.requestManager.normalizeModelURL(c);if((this.hasModel(o,f,{exactIdMatch:!0})||this.hasModelBeenAdded(o,f))&&this.modelUris[f][o]===_)this.models[f][o].numReferences++;else if(this.hasURLBeenRequested(_)){let{scope:y,modelId:x}=this.modelByURL[_];this.models[y][x].numReferences++}else this.modelUris[f][o]=_,this.load({[o]:this.modelUris[f][o]},f)}addModelURLs(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f=this.modelUris[c];for(let _ in o)f[_]=this.requestManager.normalizeModelURL(o[_])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f={};for(let _ of o)this.hasModel(_,c,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[c][_].numReferences++:this.modelUris[c][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[c][_]:!this.hasURLBeenRequested(_)&&r.df(_,!1)&&(this.modelUris[c][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[c][_]);this.load(f,c)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,c,f=!1,_=!1){if(this.models[c]&&this.models[c][o]&&(this.models[c][o].numReferences--,this.models[c][o].numReferences===0||_)){let y=this.modelUris[c][o];f||delete this.modelUris[c][o],delete this.modelByURL[y];let x=this.models[c][o].model;if(!x)return;delete this.models[c][o],x.destroy()}}destroy(){for(let o of Object.keys(this.models))for(let c of Object.keys(this.models[o])){let f=this.models[o][c].model;delete this.models[o][c],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,c){this.models[c]||(this.models[c]={});for(let f in this.models[c])this.models[c][f].model&&this.models[c][f].model.upload(o.context)}}let Rv=r.a6.colorTheme,UT=new r.a9({data:new r.aa(Rv.data)});function Db(p){if(!p.metadata||!p.metadata.content_area)return;let o=r.o.devicePixelRatio,{left:c,top:f,width:_,height:y}=p.metadata.content_area,x=c*o,w=f*o;return[x,w,x+_*o,w+y*o]}function Ab(p){if(p)return p.map(([o,c])=>[o*r.o.devicePixelRatio,c*r.o.devicePixelRatio])}class kv{constructor(o,c,f){this.id=o,this.scope=c,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let o=new Map;if(!this.sourceCache.loaded())return o;let c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return o;let f=this.sourceCache.getSource();if(!(f instanceof ss))return o;let _=c.map(x=>this.sourceCache.getTile(x)),y=f.getImages(_,Array.from(this.pendingRequests));for(let[x,w]of y)o.set(r.I.from({name:x,iconsetId:this.id}),w),this.pendingRequests.delete(x);for(let x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),o}}let Xc=(p,o)=>se(p,o&&o.filter(c=>c.identifier!=="source.canvas")),Pb=r.aH(qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ob=r.aH(qn,["setCenter","setZoom","setBearing","setPitch"]),xm=new Set(["background","sky","slot","custom"]),Kc={version:8,layers:[],sources:{}},bp={duration:300,delay:0};class Ca extends r.E{constructor(o,c={}){super(),this.map=o,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},bp),this._buildingIndex=new NT(this),this.crossTileSymbolIndex=new Za,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Br,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new r.D(r.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Ud(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new r.di(o._requestManager,c.localFontFamily?r.dj.all:c.localIdeographFontFamily?r.dj.ideographs:r.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new VT(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",r.dk());let f=this;this._rtlTextPluginCallback=Ca.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,x)=>{if(r.dl(y),x&&x.every(w=>w))for(let w in f._sourceCaches){let S=f._sourceCaches[w],M=S.getSource().type;M!=="vector"&&M!=="geojson"||S.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let w=this._layers[x];w.source===y.id&&this._validateLayer(w)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(r.h(o))return o;let c=r.dm(o);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${r.dn(JSON.stringify(o))}`}_diffStyle(o,c,f){this.globalId=this._getGlobalId(o);let _=(y,x)=>{try{x(null,this.setState(y,f))}catch(w){x(w,!1)}};if(typeof o=="string"){let y=this.map._requestManager.normalizeStyleURL(o),x=this.map._requestManager.transformRequest(y,r.R.Style);r.m(x,(w,S)=>{w?this.fire(new r.y(w)):S&&_(S,c)})}else typeof o=="object"&&_(o,c)}loadURL(o,c={}){this.fire(new r.z("dataloading",{dataType:"style"}));let f=typeof c.validate=="boolean"?c.validate:!r.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,c.accessToken),this.resolvedImports.add(o);let _=this.importsCache.get(o);if(_)return this._load(_,f);let y=this.map._requestManager.transformRequest(o,r.R.Style);this._request=r.m(y,(x,w)=>{if(this._request=null,x)this.fire(new r.y(x));else if(w)return this.importsCache.set(o,w),this._load(w,f)})}loadJSON(o,c={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=r.o.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Kc,!1)}_loadImports(o,c,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let y of o){let x=this._createFragmentStyle(y),w=new Promise(A=>{x.once("style.import.load",A),x.once("error",A)}).then(()=>this.mergeAll());if(_.push(w),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let S=y.data||this.importsCache.get(y.url);S?(x.loadJSON(S,{validate:c}),this._isInternalStyle(S)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:c}):x.loadEmpty();let M={style:x,id:y.id,config:y.config};if(f){let A=this.fragments.findIndex(({id:L})=>L===f);this.fragments=this.fragments.slice(0,A).concat(M).concat(this.fragments.slice(A))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(o=this,c=new Set){for(let f of o.fragments)f.style.globalId&&c.add(f.style.globalId),this.getImportGlobalIds(f.style,c);return[...c.values()]}_createFragmentStyle(o){let c=this.scope?r.B(o.id,this.scope):o.id,f,_=this._initialConfig&&this._initialConfig[c];(o.config||_)&&(f=Object.assign({},o.config,_));let y=new Ca(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,c){if(this._isInternalStyle(o)){let y=Object.assign({},Kc,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(y,c)}if(this.updateConfig(this._config,o.schema),c&&Xc(this,Ha(o)))return;this._loaded=!0,this.stylesheet=r.dp(o);let f=()=>{for(let S in o.sources)this.addSource(S,o.sources[S],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(let S in o.iconsets)this.addIconset(S,o.iconsets[S]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);let y=cp(this.stylesheet.layers);if(this._order=y.map(S=>S.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let S=this.stylesheet.lights[0];this.light=new Ee(S.properties,S.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ee(this.stylesheet.light)),this._layers={};for(let S of y){let M=r.du(S,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;let A=this.getOwnLayerSourceCache(M),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&M.canCastShadows()&&L&&(A.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));let w=this.isRootStyle();o.imports?this._loadImports(o.imports,c).then(()=>{this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load"))}).catch(S=>{this.fire(new r.y(new Error("Failed to load imports",S))),this.fire(new r.z(w?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){let y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{f()}).catch(x=>{r.w(`Couldn't load color theme from the stylesheet: ${x}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,c,f,_,y,x,w,S,M,A,L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(o=F.light),F.stylesheet.lights)for(let N of F.stylesheet.lights)N.type==="ambient"&&F.ambientLight!=null&&(c=F.ambientLight),N.type==="directional"&&F.directionalLight!=null&&(f=F.directionalLight);_=this._prioritizeTerrain(_,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(y=F.fog),F.stylesheet.snow&&F.snow!=null&&(x=F.snow),F.stylesheet.rain&&F.rain!=null&&(w=F.rain),F.stylesheet.camera!=null&&(A=F.stylesheet.camera),F.stylesheet.projection!=null&&(S=F.stylesheet.projection),F.stylesheet.transition!=null&&(M=F.stylesheet.transition),L[F.scope]=F._styleColorTheme}}),this.light=o,this.ambientLight=c,this.directionalLight=f,this.fog=y,this.snow=x,this.rain=w,this._styleColorThemeForScope=L,_===null?delete this.terrain:this.terrain=_,this.camera=A||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=Object.assign({},bp,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){let c=f=>{for(let _ of f.fragments)c(_.style);o(f)};c(this)}_prioritizeTerrain(o,c,f){let _=o&&o.drapeRenderMode===0;return f===null?c&&c.drapeRenderMode===0?c:_?o:null:c!=null&&(!o||_||c&&c.drapeRenderMode===1)?c:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(o=c.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},c={},f={};this.forEachFragmentStyle(_=>{for(let y in _._sourceCaches){let x=r.B(y,_.scope);o[x]=_._sourceCaches[y]}for(let y in _._otherSourceCaches){let x=r.B(y,_.scope);c[x]=_._otherSourceCaches[y]}for(let y in _._symbolSourceCaches){let x=r.B(y,_.scope);f[x]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(let c of Object.values(o.stylesheet.indoor)){let f=c,_=r.B(f.sourceId,o.scope);this._mergedIndoor[_]=new Set(f.sourceLayers||[])}})}mergeLayers(){let o={},c=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(let w of x._order){let S=x._layers[w];if(S.type==="slot"){let M=r.dq(w);if(o[M])continue;o[M]=[]}S.slot&&o[S.slot]?o[S.slot].push(S):c.push(S)}}),this._mergedOrder=[];let _=-1,y=(x=[])=>{for(let w of x)if(w.type==="slot"){let S=r.dq(w.id);o[S]&&y(o[S]),this._mergedSlots.push(S)}else{let S=r.B(w.id,w.scope);this._mergedOrder.push(S),f[S]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(c),this._has3DLayers){let x={};for(let w=0;w<this._mergedOrder.length;++w){let S=this._mergedOrder[w];x[S]=w===_?1:w<_?f[S].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((w,S)=>x[w]-x[S])}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?(function(c,f,_,y){let x=Object.assign({},f);for(let S of Object.keys(Rv))x[S]===void 0&&(x[S]=Rv[S].default);let w=new r.a8(UT,c,new Map(_));return w.setTransitionOrValue(x,_),w.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{let y="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let x=o;x.startsWith(y)||(x=y+x);let w=r.I.from("mapbox-reserved-lut"),S=new Image;S.src=x,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},S.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void f();this._styleColorTheme.lutLoading=!1;let{width:M,height:A,data:L}=r.o.getImageData(S);if(A>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==A*A)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new r.q({width:M,height:A},L),pixelRatio:1,sdf:!1,usvg:!1,version:0});let F=this.imageManager.getImage(w,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:o},f()):_(new Error("Missing LUT image."))}})}getLut(o){let c=this._styleColorThemeForScope[o];return c?c.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=(function(c,f,_){let y,x,w,S=r.o.devicePixelRatio>1?"@2x":"",M=r.m(f.transformRequest(f.normalizeSpriteURL(c,S,".json"),r.R.SpriteJSON),(F,N)=>{M=null,w||(w=F,y=N,L())}),A=r.n(f.transformRequest(f.normalizeSpriteURL(c,S,".png"),r.R.SpriteImage),(F,N)=>{A=null,w||(w=F,x=N,L())});function L(){if(w)_(w);else if(y&&x){let F=r.o.getImageData(x),N={};for(let j in y){let{width:U,height:W,x:q,y:ee,sdf:re,pixelRatio:te,stretchX:ge,stretchY:de,content:fe}=y[j],ue=new r.q({width:U,height:W});r.q.copy(F,ue,{x:q,y:ee},{x:0,y:0},{width:U,height:W},null),N[j]={data:ue,pixelRatio:te!==void 0?te:1,sdf:re!==void 0&&re,stretchX:ge,stretchY:de,content:fe,usvg:!1,version:0}}_(null,N)}}return{cancel(){M&&(M.cancel(),M=null),A&&(A.cancel(),A=null)}}})(o,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new r.y(c));else if(f){let _=new Map;for(let y in f)_.set(r.I.from(y),f[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(o,c){if(c.type==="sprite")return void this._loadSprite(c.url);let f=this.getOwnSourceCache(c.source);if(!f)return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));let _=f.getSource();if(_.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;let y=new kv(o,this.scope,f);this.imageManager.addImageProvider(y,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!r.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);let c=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(y,x)=>{if(this._spriteRequest=null,y)c?this._loadSprite(o):this.fire(new r.y(y));else if(x){let w=new Map;for(let S in x)w.set(r.I.from(S),x[S]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(o),r.R.Iconset),(y,x)=>{if(y)return void _(y);let w={},S=r.dg(new r.bt(x));for(let M of S.icons){let A={version:1,pixelRatio:r.o.devicePixelRatio,content:Db(M),stretchX:M.metadata?Ab(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?Ab(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};w[M.name]=A}_(null,w)}))}_validateLayer(o){let c=this.getOwnSource(o.source);if(!c)return;let f=o.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.y(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,c)=>{let f=this.fragments[c];return f&&f.style&&(o.data=f.style.serialize()),o})}_serializeSources(){let o={};for(let c in this._sourceCaches){let f=this._sourceCaches[c].getSource();o[f.id]||(o[f.id]=f.serialize())}return o}_serializeLayers(o){let c=[];for(let f of o){let _=this._layers[f];_&&_.type!=="custom"&&c.push(_.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];if(c._transitionablePaint&&c._transitionablePaint._values){let f=c._transitionablePaint._values["line-emissive-strength"];if(f&&f.value&&f.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let c=this.getOwnLayer(o);if(c)return c;this.fire(new r.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let c=this.getOwnSource(o);if(c)return c;this.fire(new r.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,c){let f=this.map.painter;if(f)for(let _=o.minzoom||0;_<(o.maxzoom||25.5);_++){let y=o.getProgramIds();if(y)for(let x of y){let w=o.getDefaultProgramParams(x,c.zoom,this._styleColorTheme.lut);w&&(f.style=this,this.fog&&(f._fogVisible=!0,w.overrideFog=!0,f.getOrCreateProgram(x,w)),f._fogVisible=!1,w.overrideFog=!1,f.getOrCreateProgram(x,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,f.getOrCreateProgram(x,w)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let c=this.calculateLightsBrightness();o.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));let f=this._changes.isDirty(),_=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let S in w){let{updatedIds:M,removedIds:A}=w[S];(M||A)&&(this._updateWorkerLayers(S,M,A),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}let y={};for(let w in this._mergedSourceCaches){let S=this._mergedSourceCaches[w];y[w]=S.used,S.used=!1,S.tileCoverLift=0}for(let w of this._mergedOrder){let S=this._mergedLayers[w];if(S.visibility!=="none"&&S.recalculate(o,this._availableImages),!S.isHidden(o.zoom)){let M=this.getLayerSourceCache(S);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,o)}):this.precompilePrograms(S,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();let x=this.imageManager.getPendingImageProviders();for(let w of x)w.sourceCache.used=!0;for(let w in y){let S=this._mergedSourceCaches[w];y[w]!==S.used&&S.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){let o=this.imageManager.getPendingImageProviders();for(let c of o){let f=c.resolvePendingRequests(),_=this.getFragmentStyle(c.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){let o={};for(let c in this._mergedSourceCaches){let f=this._mergedSourceCaches[c].getSource().scope;o[f]=o[f]||this._changes.getUpdatedImages(f),o[f].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o[f])}for(let c in o)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(o,c,f){let _=this.getFragmentStyle(o);_&&this.dispatcher.broadcast("updateLayers",{layers:c?_._serializeLayers(c):[],scope:o,removedIds:f||[],options:_.options})}setState(o,c){if(this._checkLoaded(),Xc(this,Ha(o)))return!1;(o=r.dp(o)).layers=cp(o.layers);let f=(function(x,w){if(!x)return[{command:qn.setStyle,args:[w]}];let S=[];try{if(!r.by(x.version,w.version))return[{command:qn.setStyle,args:[w]}];if(r.by(x.center,w.center)||S.push({command:qn.setCenter,args:[w.center]}),r.by(x.zoom,w.zoom)||S.push({command:qn.setZoom,args:[w.zoom]}),r.by(x.bearing,w.bearing)||S.push({command:qn.setBearing,args:[w.bearing]}),r.by(x.pitch,w.pitch)||S.push({command:qn.setPitch,args:[w.pitch]}),r.by(x.sprite,w.sprite)||S.push({command:qn.setSprite,args:[w.sprite]}),r.by(x.glyphs,w.glyphs)||S.push({command:qn.setGlyphs,args:[w.glyphs]}),r.by(x.imports,w.imports)||(function(N=[],j=[],U){j=j||[];let W=(N=N||[]).map(up),q=j.map(up),ee=N.reduce(dp,{}),re=j.reduce(dp,{}),te=W.slice(),ge,de,fe,ue;for(ge=0,de=0;ge<W.length;ge++)fe=W[ge],re.hasOwnProperty(fe)?de++:(U.push({command:qn.removeImport,args:[fe]}),te.splice(te.indexOf(fe,de),1));for(ge=0,de=0;ge<q.length;ge++)fe=q[q.length-1-ge],te[te.length-1-ge]!==fe&&(ee.hasOwnProperty(fe)?(U.push({command:qn.removeImport,args:[fe]}),te.splice(te.lastIndexOf(fe,te.length-de),1)):de++,ue=te[te.length-ge],U.push({command:qn.addImport,args:[re[fe],ue]}),te.splice(te.length-ge,0,fe));for(let ae of j){let _e=ee[ae.id];_e&&(delete _e.data,r.by(_e,ae)||U.push({command:qn.updateImport,args:[ae.id,ae]}))}})(x.imports,w.imports,S),r.by(x.transition,w.transition)||S.push({command:qn.setTransition,args:[w.transition]}),r.by(x.light,w.light)||S.push({command:qn.setLight,args:[w.light]}),r.by(x.fog,w.fog)||S.push({command:qn.setFog,args:[w.fog]}),r.by(x.snow,w.snow)||S.push({command:qn.setSnow,args:[w.snow]}),r.by(x.rain,w.rain)||S.push({command:qn.setRain,args:[w.rain]}),r.by(x.projection,w.projection)||S.push({command:qn.setProjection,args:[w.projection]}),r.by(x.lights,w.lights)||S.push({command:qn.setLights,args:[w.lights]}),r.by(x.camera,w.camera)||S.push({command:qn.setCamera,args:[w.camera]}),r.by(x.iconsets,w.iconsets)||(function(N,j,U){let W;for(W in j=j||{},N=N||{})N.hasOwnProperty(W)&&(j.hasOwnProperty(W)||U.push({command:qn.removeIconset,args:[W]}));for(W in j){if(!j.hasOwnProperty(W))continue;let q=j[W];N.hasOwnProperty(W)?r.by(N[W],q)||(U.push({command:qn.removeIconset,args:[W]}),U.push({command:qn.addIconset,args:[W,q]})):U.push({command:qn.addIconset,args:[W,q]})}})(x.iconsets,w.iconsets,S),!r.by(x["color-theme"],w["color-theme"]))return[{command:qn.setStyle,args:[w]}];let M={},A=[];(function(N,j,U,W){let q;for(q in j=j||{},N=N||{})N.hasOwnProperty(q)&&(j.hasOwnProperty(q)||Ev(q,U,W));for(q in j){if(!j.hasOwnProperty(q))continue;let ee=j[q];N.hasOwnProperty(q)?r.by(N[q],ee)||(N[q].type==="geojson"&&ee.type==="geojson"&&Sb(N,j,q)?U.push({command:qn.setGeoJSONSourceData,args:[q,ee.data]}):Eb(q,j,U,W)):cm(q,j,U)}})(x.sources,w.sources,A,M);let L=[];x.layers&&x.layers.forEach(N=>{N.source&&M[N.source]?S.push({command:qn.removeLayer,args:[N.id]}):L.push(N)});let F=x.terrain;F&&M[F.source]&&(S.push({command:qn.setTerrain,args:[void 0]}),F=void 0),S=S.concat(A),r.by(F,w.terrain)||S.push({command:qn.setTerrain,args:[w.terrain]}),(function(N,j,U){j=j||[];let W=(N=N||[]).map(up),q=j.map(up),ee=N.reduce(dp,{}),re=j.reduce(dp,{}),te=W.slice(),ge=Object.create(null),de,fe,ue,ae,_e,Te,Ce;for(de=0,fe=0;de<W.length;de++)ue=W[de],re.hasOwnProperty(ue)?fe++:(U.push({command:qn.removeLayer,args:[ue]}),te.splice(te.indexOf(ue,fe),1));for(de=0,fe=0;de<q.length;de++)ue=q[q.length-1-de],te[te.length-1-de]!==ue&&(ee.hasOwnProperty(ue)?(U.push({command:qn.removeLayer,args:[ue]}),te.splice(te.lastIndexOf(ue,te.length-fe),1)):fe++,Te=te[te.length-de],U.push({command:qn.addLayer,args:[re[ue],Te]}),te.splice(te.length-de,0,ue),ge[ue]=!0);for(de=0;de<q.length;de++)if(ue=q[de],ae=ee[ue],_e=re[ue],!ge[ue]&&!r.by(ae,_e))if(r.by(ae.source,_e.source)&&r.by(ae["source-layer"],_e["source-layer"])&&r.by(ae.type,_e.type)){for(Ce in Gc(ae.layout,_e.layout,U,ue,null,qn.setLayoutProperty),Gc(ae.paint,_e.paint,U,ue,null,qn.setPaintProperty),r.by(ae.slot,_e.slot)||U.push({command:qn.setSlot,args:[ue,_e.slot]}),r.by(ae.filter,_e.filter)||U.push({command:qn.setFilter,args:[ue,_e.filter]}),r.by(ae.minzoom,_e.minzoom)&&r.by(ae.maxzoom,_e.maxzoom)||U.push({command:qn.setLayerZoomRange,args:[ue,_e.minzoom,_e.maxzoom]}),ae)ae.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Gc(ae[Ce],_e[Ce],U,ue,Ce.slice(6),qn.setPaintProperty):r.by(ae[Ce],_e[Ce])||U.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}));for(Ce in _e)_e.hasOwnProperty(Ce)&&!ae.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Gc(ae[Ce],_e[Ce],U,ue,Ce.slice(6),qn.setPaintProperty):r.by(ae[Ce],_e[Ce])||U.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}))}else U.push({command:qn.removeLayer,args:[ue]}),Te=te[te.lastIndexOf(ue)+1],U.push({command:qn.addLayer,args:[_e,Te]})})(L,w.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:qn.setStyle,args:[w]}]}return S})(this.serialize(),o).filter(x=>!(x.command in Ob));if(f.length===0)return!1;let _=f.filter(x=>!(x.command in Pb));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);let y=[];return f.forEach(x=>{y.push(this[x.command](...x.args))}),c&&Promise.all(y).then(c).catch(c),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(let[c,f]of o.entries()){if(this.getImage(c))return this.fire(new r.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,f),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(o,c){return this.getImage(o)?this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,c),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(o,c,f=!1){this.imageManager.updateImage(o,this.scope,c),f&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(o,c,f={}){return this._checkLoaded(),this._validate(G,`models.${o}`,c,null,f)||(this.modelManager.addModel(o,c,this.getActualScope()),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,c,f={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(nm,`sources.${o}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let _=ho(o,c,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let y=x=>{let w=(x?"symbol:":"other:")+_.id,S=r.B(w,this.scope),M=this._sourceCaches[w]=new Bs(S,_,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};y(!1),c.type!=="vector"&&c.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let c=this.getOwnSource(o);if(!c)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let _=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===o);if(_)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while iconset "${_[0]}" is using it.`)))}let f=this.getOwnSourceCaches(o);for(let _ of f){let y=r.dq(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getOwnSource(o).setData(c),this._changes.setDirty()}getOwnSource(o){let c=this.getOwnSourceCache(o);return c&&c.getSource()}getOwnSources(){let o=[];for(let c in this._otherSourceCaches){let f=this.getOwnSourceCache(c);f&&o.push(f.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let c in o){let f=o[c]._tiles;for(let _ in f){let y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let y of o){if(this._validate(Yl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(y),x.updateTransitions(c)}else this.ambientLight=new Gn(y,Vr||(Vr=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(y),x.updateTransitions(c)}else this.directionalLight=new Gn(y,xr||(xr=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=Object.assign(c,{worldview:this.map.getWorldview()}),_=new r.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,c=this.ambientLight;if(!o||!c)return;let f=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),_=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=1-r.d4(x.x,x.y,x.z)[2]/90,S=f(_)*y*w,M=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),A=c.properties.get("intensity"),L=f(M)*A;return Number(((S+L)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(r.dr(o)){let c=r.ds(o),f=this.fragments.find(({id:y})=>y===c);if(!f)return;let _=r.dq(o);return f.style.getFragmentStyle(_)}{let c=this.fragments.find(({id:f})=>f===o);return c?c.style:void 0}}setFeaturesetSelectors(o){if(!o)return;let c={},f=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(let _ in o){let y=this._featuresetSelectors[_]=[];for(let x of o[_].selectors){if(x.featureNamespace){let S=this.getOwnLayer(x.layer);if(!S){r.w(`Layer is undefined for selector: ${x.layer}`);continue}let M=f(S.source,S.sourceLayer);if(M in c&&c[M]!==x.featureNamespace){r.w(`"featureNamespace ${x.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}c[M]=x.featureNamespace}let w;if(x.properties)for(let S in x.properties){let M=r.U(x.properties[S]);M.result==="success"&&(w=w||{},w[S]=M.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:w,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(o){let c=this.getFragmentStyle(o);if(!c||!c.stylesheet.featuresets)return[];let f=[];for(let _ in c.stylesheet.featuresets)f.push({featuresetId:_,importId:c.scope?c.scope:void 0});return f}getFeaturesetLayers(o,c){let f=this.getFragmentStyle(c),_=f.stylesheet.featuresets;if(!_||!_[o])return this.fire(new r.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of _[o].selectors){let w=f.getOwnLayer(x.layer);w&&y.push(w)}return y}getConfigProperty(o,c){let f=this.getFragmentStyle(o);if(!f)return null;let _=r.B(c,f.scope),y=f.options.get(_),x=y?y.value||y.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,c){let f=r.B(o,c);return this._mergedIndoor[f]}setIndoorData(o,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,c,f){let _=this.getFragmentStyle(o);if(!_)return;let y=_.stylesheet.schema;if(!y||!y[c])return;let x=r.U(f);if(x.result!=="success")return void Xc(this,x.value);let w=x.value.expression,S=r.B(c,_.scope),M=_.options.get(S);if(!M)return;let A,{minValue:L,maxValue:F,stepValue:N,type:j,values:U}=y[c],W=r.U(y[c].default);W.result==="success"&&(A=W.value.expression),A?(this.options.set(S,Object.assign({},M,{value:w,default:A,minValue:L,maxValue:F,stepValue:N,type:j,values:U})),this.updateConfigDependencies(c)):this.fire(new r.y(new Error(`No schema defined for the config option "${c}" in the "${o}" fragment.`)))}getConfig(o){let c=this.getFragmentStyle(o);if(!c)return null;let f=c.stylesheet.schema;if(!f)return null;let _={};for(let y in f){let x=r.B(y,c.scope),w=c.options.get(x),S=w?w.value||w.default:null;_[y]=S?S.serialize():null}return _}setConfig(o,c){let f=this.getFragmentStyle(o);f&&(f.updateConfig(c,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let c=this.getFragmentStyle(o);return c?c.stylesheet.schema:null}setSchema(o,c){let f=this.getFragmentStyle(o);f&&(f.stylesheet.schema=c,f.updateConfig(f._config,c),this.updateConfigDependencies())}updateConfig(o,c){if(this._config=o,o||c)if(c)for(let f in c){let _,y,x=r.U(c[f].default);if(x.result==="success"&&(_=x.value.expression),o&&o[f]!==void 0){let F=r.U(o[f]);F.result==="success"&&(y=F.value.expression)}let{minValue:w,maxValue:S,stepValue:M,type:A,values:L}=c[f];if(_){let F=r.B(f,this.scope);this.options.set(F,{default:_,value:y,minValue:w,maxValue:S,stepValue:M,type:A,values:L})}else this.fire(new r.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,c=()=>!0){for(let f of o){let _=this.getLayer(f);_&&c(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,c=>!o||c.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{let f=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(f){let _=c._evaluateColorThemeData(f);(!c._styleColorTheme.lut&&_!==""||c._styleColorTheme.lut&&_!==c._styleColorTheme.lut.data)&&c.setColorTheme(f)}}),this._changes.setDirty()}addLayer(o,c,f={}){this._checkLoaded();let _=o.id;if(this._layers[_])return void this.fire(new r.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(o.type==="custom"){if(Xc(this,r.dt(o)))return;y=r.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=r.dp(o),o=Object.assign(o,{source:_})),this._validate(Cv,`layers.${_}`,o,{arrayIndex:-1},f))return;y=r.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}let x=r.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let w=this._order.length;if(c){let L=this._order.indexOf(c);if(L===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));y.slot===this._layers[c].slot?w=L:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;let S=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&M&&(S.castsShadows=!0);let A=this._changes.getRemovedLayer(y);if(A&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let L=r.B(y.source,y.scope);A.type!==y.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(o,c){this._checkLoaded();let f=this._checkLayer(o);if(!f||o===c)return;let _=this._order.indexOf(o);this._order.splice(_,1);let y=this._order.length;if(c){let x=this._order.indexOf(c);if(x===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));f.slot===this._layers[c].slot?y=x:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let c=this._checkLayer(o);if(!c)return;c.setEventedParent(null);let f=this._order.indexOf(o);this._order.splice(f,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let _=this.getOwnLayerSourceCache(c);if(_&&_.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===c.source&&this._layers[x].canCastShadows()){y=!0;break}_.castsShadows=y}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,f){this._checkLoaded();let _=this._checkLayer(o);_&&(_.minzoom===c&&_.maxzoom===f||(c!=null&&(_.minzoom=c),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,c){this._checkLoaded();let f=this._checkLayer(o);f&&f.slot!==c&&(f.slot=c,this._updateLayer(f))}setFilter(o,c,f={}){this._checkLoaded();let _=this._checkLayer(o);if(_&&!r.by(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Zu,`layers.${_.id}.filter`,c,{layerType:_.type},f)||(_.filter=r.dp(c),this._updateLayer(_)))}getFilter(o){let c=this._checkLayer(o);if(c)return r.dp(c.filter)}setLayoutProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(y&&!r.by(y.getLayoutProperty(c),f)){if(f!=null&&(!_||_.validate!==!1)&&Xc(y,Re.call(Ha,{key:`layers.${o}.layout.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(c,f),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);y&&(c==="appearances"?(y.setAppearances(f),this._changes.setDirty()):y.isPaintProperty(c)?this.setPaintProperty(o,c,f,_):this.setLayoutProperty(o,c,f,_))}getLayoutProperty(o,c){let f=this._checkLayer(o);if(f)return f.getLayoutProperty(c)}setPaintProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(!y||r.by(y.getPaintProperty(c),f)||f!=null&&(!_||_.validate!==!1)&&Xc(y,sp.call(Ha,{key:`layers.${o}.paint.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:r.a6})))return;let x=y.setPaintProperty(c,f);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(o,c){let f=this._checkLayer(o);if(f)return f.getPaintProperty(c)}setFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),L=A.getFeaturesetLayers(S);for(let{source:F,sourceLayer:N}of L)A.setFeatureState({id:o.id,source:F,sourceLayer:N},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.setFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=o.sourceLayer,y=this._checkSource(f);if(!y)return;let x=y.type;if(x==="geojson"&&_)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!_)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.setFeatureState(_,o.id,c)}removeFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),L=A.getFeaturesetLayers(S);for(let{source:F,sourceLayer:N}of L)A.removeFeatureState({id:o.id,source:F,sourceLayer:N},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.removeFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=this._checkSource(f);if(!_)return;let y=_.type,x=y==="vector"?o.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.removeFeatureState(x,o.id,c)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let y;if("featuresetId"in o.target){let{featuresetId:x,importId:w}=o.target,S=this.getFragmentStyle(w),M=S.getFeaturesetLayers(x);for(let{source:A,sourceLayer:L}of M){let F=S.getFeatureState({id:o.id,source:A,sourceLayer:L});if(F&&!y)y=F;else if(!r.by(y,F))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){let{layerId:x}=o.target,w=this.getLayer(x);y=this.getFeatureState({id:o.id,source:w.source,sourceLayer:w.sourceLayer})}return y}let c=o.source,f=o.sourceLayer,_=this._checkSource(c);if(_){if(_.type!=="vector"||f)return o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,o.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),c=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(o){for(let c of Object.values(this._mergedLayers))o(c)&&this._updateLayer(c)}_updateLayer(o){this._changes.updateLayer(o);let c=this.getLayerSourceCache(o),f=r.B(o.source,o.scope),_=this._changes.getUpdatedSourceCaches();o.source&&!_[f]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),c.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let c=w=>this._mergedLayers[w].is3D(!!this.terrain),f=this.order,_={},y=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S)){_[S]=w;for(let M of o){let A=M[S];if(A)for(let L of A)y.push(L)}}}y.sort((w,S)=>S.intersectionZ-w.intersectionZ);let x=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S))for(let M=y.length-1;M>=0;M--){let A=y[M].feature;if(A.layer&&_[A.layer.id]<w)break;x.push(A),y.pop()}else for(let M of o){let A=M[S];if(A)for(let L of A)x.push(L.feature)}}return x}queryRasterValue(o,c,f){let _=this.getOwnSource(o);return _?_.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(c,f):(this.fire(new r.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Zu,"queryRenderedFeatures.filter",c.filter,null,c),_=r.b6(c.filter));let y={},x=A=>{if(xm.has(A.type))return;let L=this.getOwnLayerSourceCache(A),F=y[L.id]=y[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};A.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[A.fqid]=F.layers[A.fqid]||{styleLayer:A,targets:[]},F.layers[A.fqid].targets.push({filter:_})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(let A of c.layers){let L=this._layers[A];if(!L)return this.fire(new r.y(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];x(L)}}else for(let A in this._layers)x(this._layers[A]);let w=this._queryRenderedFeatures(o,y,f),S=this._flattenAndSortRenderedFeatures(w),M=[];for(let A of S)r.dw(A.layer.id)===this.scope&&M.push(A);return M}queryRenderedFeatureset(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Zu,"queryRenderedFeatures.filter",c.filter,null,c),_=r.b6(c.filter));let y="mock",x=[];if(c&&c.target)x.push(Object.assign({},c,{targetId:y,filter:_}));else{let A=this.getFeaturesetDescriptors();for(let L of A)x.push({targetId:y,filter:_,target:L});for(let{style:L}of this.fragments){let F=L.getFeaturesetDescriptors();for(let N of F)x.push({targetId:y,filter:_,target:N})}}let w=this.queryRenderedTargets(o,x,f),S=[],M=new Set;for(let A of w)for(let L of A.variants[y])Hd(L,A,M)||S.push(new r.dx(A,L));return S}queryRenderedTargets(o,c,f){let _={},y=(w,S,M,A)=>{let L=_[S.id]=_[S.id]||{sourceCache:S,layers:{},has3DLayers:!1};if(L.layers[w.fqid]=L.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(L.has3DLayers=!0),!A)return M.uniqueFeatureID=!1,void L.layers[w.fqid].targets.push(M);L.layers[w.fqid].targets.push(Object.assign({},M,{namespace:A.namespace,properties:A.properties,uniqueFeatureID:A.uniqueFeatureID}))};for(let w of c)if("featuresetId"in w.target){let{featuresetId:S,importId:M}=w.target,A=this.getFragmentStyle(M);if(!A||!A._featuresetSelectors)continue;let L=A._featuresetSelectors[S];if(!L){this.fire(new r.y(new Error(`The featureset '${S}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let F of L){let N=A.getOwnLayer(F.layerId);N&&!xm.has(N.type)&&y(N,A.getOwnLayerSourceCache(N),w,F)}}else if("layerId"in w.target){let{layerId:S}=w.target,M=this.getLayer(S);if(!M||xm.has(M.type))continue;y(M,this.getLayerSourceCache(M),w)}let x=this._queryRenderedFeatures(o,_,f);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(o,c,f){let _=[],y=!!this.map._showQueryGeometry,x=cr.createFromScreenPoints(o,f);for(let w in c){let S=im(x,c[w],this._availableImages,f,y);Object.keys(S).length&&_.push(S)}if(this.placement)for(let w in c){if(!c[w].sourceCache._onlySymbols)continue;let S=rm(x.screenGeometry,c[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(S).length&&_.push(S)}return _}querySourceFeatures(o,c){let f=c&&c.filter;f&&this._validate(Zu,"querySourceFeatures.filter",f,null,c);let _=[],y=this.getOwnSourceCaches(o);for(let x of y)_=_.concat(om(x,c));return _}addSourceType(o,c,f){return Ca.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(Ca.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,c,f={}){this._checkLoaded();let _=this.light.getLight(),y=!1;for(let w in o)if(!r.by(o[w],_[w])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(o,c,f),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,c=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=o,_=!("source"in o)||o.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in f&&typeof f.source=="object"){let w="terrain-dem-src";this.addSource(w,f.source),f=r.dp(f),f=Object.assign(f,{source:w})}let y=Object.assign({},f),x={};if(this.terrain&&_){y.source=this.terrain.get().source;let w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(x.style=w.serialize())}if(this._validate(wv,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c),this.fire(new r.z("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let w of Object.keys(r.a6.terrain))!f.hasOwnProperty(w)&&r.a6.terrain[w].default&&(f[w]=r.a6.terrain[w].default);for(let w in o)if(!r.by(o[w],x[w])){y.set(o,this.options),this.stylesheet.terrain=o;let S=this._getTransitionParameters({duration:0});y.updateTransitions(S),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let c=this.fog=new gn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createSnow(o){let c=this.snow=new Zr(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createRain(o){let c=this.rain=new lr(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let c=this.snow;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let c=this.rain;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){let o=()=>{for(let _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(let _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void o();let f=this._evaluateColorThemeData(c);this._loadColorTheme(f).then(()=>{this.fire(new r.z("colorthemeset")),o()}).catch(_=>{r.w(`Couldn't set color theme: ${_}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,c){let f=this.getFragmentStyle(o);f&&(f._styleColorTheme.colorThemeOverride=c,f._reloadColorTheme())}_getTransitionParameters(o){return{now:r.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],c=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?o.push(f):c.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){let f=this.terrain=new Pe(o,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,f,_,y={}){if(y&&y.validate===!1)return!1;let x=Object.assign({},this.serialize());return Xc(this,o.call(Ha,Object.assign({key:c,style:x,value:f,styleSpec:r.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){let c=this.getSourceCaches(o);for(let f of c)f.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];c._clear&&c._clear()}}reloadSource(o){let c=this.getSourceCaches(o);for(let f of c)f.resume(),f.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let c;this.directionalLight&&(c=xp(this.directionalLight));let f=new Set,_=new Set;for(let y in this._mergedLayers){let x=this._mergedLayers[y];x.type==="building"&&f.add(x.source),x.hasElevation()&&!_.has(x.source)&&_.add(x.source)}for(let y in this._mergedSourceCaches){let x=this._mergedSourceCaches[y],w=_.has(x._source.id);f.has(x._source.id)&&(x._source.reparseOverscaled=!1),x.update(o,void 0,void 0,c,w)}}_generateCollisionBoxes(){for(let o in this._sourceCaches){let c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,f,_,y,x,w=!1){let S=!1,M=!1,A={},L={};for(let U of this._mergedOrder){let W=this._mergedLayers[U];if(W.type!=="symbol")continue;let q=r.B(W.source,W.scope),ee=A[q];if(!ee){let te=this.getLayerSourceCache(W);if(!te)continue;let ge=te.getRenderableIds(!0).map(de=>te.getTileByID(de));L[q]=ge.slice(),ee=A[q]=ge.sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}let re=this.crossTileSymbolIndex.addLayer(W,ee,c.center.lng,c.projection);S=S||re}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new r.z("neworder"));let F=!!(this.placement&&!c.equals(this.placement.transform)),N=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!x||this.placement.lastReplacementSourceUpdateTime!==x.updateTime)),j=(F||N||S||this.placement&&this.placement.isStale())&&_===0;if((w||!this.pauseablePlacement||j||_!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),c.zoom))&&(this.pauseablePlacement=new po(c,this._mergedOrder,w||_===0,f,_,y,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,A,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S){this._buildingIndex.onNewFrame(c.zoom);for(let U=0;U<this._mergedOrder.length;U++){let W=this._mergedLayers[this._mergedOrder[U]];if(W.type!=="symbol"||W.visibility==="none")continue;let q=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,A[r.B(W.source,W.scope)],U,q?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,c){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===o.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!c)return f.push(o),this._loadImports([o],!0);let _=f.findIndex(({id:y})=>y===c);return _===-1&&this.fire(new r.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(o).concat(f.slice(_)),this._loadImports([o],!0,c)}updateImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);return _===-1?this:typeof c=="string"?(this.setImportUrl(o,c),this):(c.url&&c.url!==f[_].url&&this.setImportUrl(o,c.url),r.by(c.config,f[_].config)||this.setImportConfig(o,c.config,c.data.schema),r.by(c.data,f[_].data)||this.setImportData(o,c.data),this)}moveImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;let y=this.getImportIndex(c);if(y===-1)return this;let x=f[_],w=this.fragments[_];return f=f.filter(({id:S})=>S!==o),this.fragments=this.fragments.filter(({id:S})=>S!==o),this.stylesheet.imports=f.slice(0,y).concat(x).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(w).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;f[_].url=c;let y=this.fragments[_];return y.style=this._createFragmentStyle(f[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(c),this}setImportData(o,c){this._checkLoaded();let f=this.getImportIndex(o),_=this.stylesheet.imports||[];return f===-1?this:c?(this.fragments[f].style.setState(c),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(o,_[f].url))}setImportConfig(o,c,f){this._checkLoaded();let _=this.getImportIndex(o),y=this.stylesheet.imports||[];if(_===-1)return this;c?y[_].config=c:delete y[_].config;let x=this.fragments[_];f&&x.style.stylesheet&&(x.style.stylesheet.schema=f);let w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.updateConfig(c,w),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(o);f!==-1&&(c.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(o){let c=(this.stylesheet.imports||[]).findIndex(f=>f.id===o);return c===-1&&this.fire(new r.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),c}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let c in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[c];f&&o.push(f.getSource())}return o}getSource(o,c){let f=this.getSourceCache(o,c);return f&&f.getSource()}getLayerSource(o){let c=this.getLayerSourceCache(o);return c&&c.getSource()}getSourceCache(o,c){let f=r.B(o,c);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(o){let c=r.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let c=[];return this._mergedOtherSourceCaches[o]&&c.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&c.push(this._mergedSymbolSourceCaches[o]),c}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let c in o){let f=o[c];f==="reload"?this.reloadSource(c):f==="clear"&&this.clearSource(c)}}updateLayers(o){let c=this._changes.getUpdatedPaintProperties();for(let f of c){let _=this.getLayer(f);_&&_.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,c,f){this.imageManager.getImages(c.images,c.scope,f),this._updateTilesForChangedImages();let _=x=>{if(x){let w=c.images.map(S=>r.I.toString(S));x.setDependencies(c.tileID.key,c.type,w)}},y=r.B(c.source,c.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y]),c.images.some(x=>x.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(o,c,f){this.imageManager.rasterizeImages(c,f)}getGlyphs(o,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(o,c,f){return r.dz(c,f)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){let c=this.getOwnSourceCaches(o);return c.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${o}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,c){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;let f=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),_=o.type==="building";if(o.is3D(!!this.terrain)){if(f||_||c&&c.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ca.getSourceType=function(p){return fl[p]},Ca.setSourceType=function(p,o){fl[p]=o},Ca.registerForPluginStateChange=r.dA;class Rb extends r.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(let[c,f]of Object.entries(o.buildings))if(this._buildings[c])for(let _ of f.floorIds)this._buildings[c].floors[_]||(this._buildings[c].floors[_]=f.floors[_]);else this._buildings[c]=f;for(let c of o.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(o,c){let f=this._style.getIndoorSourceLayers(o,c);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(o,c,f){let _=(function(y,x,w,S){let M=null,A=Number.MAX_SAFE_INTEGER;if(S<16)return null;for(let[L,F]of Object.entries(y)){let N=F.center;if(N){let j=x.distanceTo(r.aT.convert(N));j<A&&w.contains(N)&&(A=j,M=L)}}return M})(this._buildings,c,f,o);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){let o=this._buildings,c=this._closestBuildingId,f=c&&o?o[c]:void 0;if(!f)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(let x of f.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){_=x;break}let y=Array.from(f.floorIds).map(x=>({id:x,name:f.floors[x].name,zIndex:f.floors[x].zIndex})).sort((x,w)=>w.zIndex-x.zIndex);this.fire(new r.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){let o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Yd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Xd=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Fv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,bm="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,wm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Lv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Cm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Em=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Nv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let wp=/#include\s+"([^"]+)"/g,bl=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,zv=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,nd=new Set(["ifdef","ifndef","elif","if","defined"]),id=new Set;Jc(Yd,id),Jc(Fv,id),Jc(Xd,id);let Qc={"_prelude_fog.vertex.glsl":wm,"_prelude_terrain.vertex.glsl":Qs,"_prelude_shadow.vertex.glsl":Em,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":vt,"_prelude_shadow.fragment.glsl":Nv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Lv,"_prelude_raster_particle.glsl":Cm},Sm={};jn("",Qs),jn(vt,wm),jn(Nv,Em),jn(Lv,""),jn(Cm,"");let kb=jn(Xd,Fv),Tm=Yd,jT=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Tm,kb.fragmentSource].join(`
`),Fb=["precision highp float;",Tm,kb.vertexSource].join(`
`);var Bv={background:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:jn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:jn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:jn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:jn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:jn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:jn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:jn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:jn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:jn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:jn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bm),skyboxGradient:jn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bm),skyboxCapture:jn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:jn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:jn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:jn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:jn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:jn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:jn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Jc(p,o){let c=p.split(`
`);for(let f of c){if(f=f.trimStart(),f[0]!=="#"||!f.includes("if")||f.startsWith("#endif"))continue;let _=f.match(zv);if(_)for(let y of _)nd.has(y)||o.add(y)}}function jn(p,o){let c=new Set,f=[],_=[];p=p.replace(wp,(x,w)=>(_.push(w),"")),o=o.replace(wp,(x,w)=>(f.push(w),""));let y=new Set(id);Jc(p,y),Jc(o,y);for(let x of[...f,..._])Sm[x]||(Sm[x]=new Set,Jc(Qc[x],Sm[x])),y=new Set([...y,...Sm[x]]);return{fragmentSource:p=p.replace(bl,(x,w,S,M,A)=>(c.add(A),w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?`
#ifdef HAS_UNIFORM_u_${A}
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(bl,(x,w,S,M,A)=>{let L=`MATERIAL_ATTRIBUTE_OFFSET_${A}`,F=M==="float"?"vec2":M,N=`GET_ATTRIBUTE_${F}(a_${A}, materialInfo, ${L})`,j=A.match(/color/)?"color":F;return w==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${A}
in ${S} ${M} a_${A};
#endif
`:c.has(A)?w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${L})
        in ${S} ${F} a_${A};
    #endif
out ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${A})
    #ifdef ${L}
        ${A} = unpack_mix_${j}(${N}, u_${A}_t);
    #else
        ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} a_${A};
    out ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${A} = a_${A};
#endif
`:void 0:w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${L})
        in ${S} ${F} a_${A};
    #endif
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${A}0;
in vec4 a_${A}1;
in vec4 a_${A}2;
in vec4 a_${A}3;
#else
uniform ${S} ${M} u_${A};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${S} ${F} a_${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${S} ${M} ${A} = a_${A};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${L}
        ${S} ${M} ${A} = ${N};
    #else
        ${S} ${M} ${A} = a_${A};
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${L}
        ${S} ${M} ${A} = unpack_mix_${j}(${N}, u_${A}_t);
    #else
        ${S} ${M} ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`}),usedDefines:y,vertexIncludes:f,fragmentIncludes:_}}class $T{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,f,_,y,x,w,S){this.context=o;let M=this.boundPaintVertexBuffers.length!==_.length;for(let L=0;!M&&L<_.length;L++)this.boundPaintVertexBuffers[L]!==_[L]&&(M=!0);let A=this.boundDynamicVertexBuffers.length!==w.length;for(let L=0;!A&&L<w.length;L++)this.boundDynamicVertexBuffers[L]!==w[L]&&(A=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||M||A||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(c,f,_,y,x,w,S);else{o.bindVertexArrayOES.set(this.vao);for(let L of w)L&&(L.bind(),S&&L.instanceCount&&L.setVertexAttribDivisor(o.gl,c,S));y&&y.dynamicDraw&&y.bind()}}freshBind(o,c,f,_,y,x,w){let S=this.context,M=S.gl;this.vao&&this.destroy(),this.vao=S.gl.createVertexArray(),S.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,c.enableAttributes(M,o),c.bind(),c.setVertexAttribPointers(M,o,y);for(let A of f)A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y);for(let A of x)A&&(A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y),w&&A.instanceCount&&A.setVertexAttribDivisor(M,o,w));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function HT(p,o){let c=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new r.ae(0,f/c).toLngLat().lat,new r.ae(0,(f+1)/c).toLngLat().lat]}function GT(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=c.hillshadeFBO;if(!M)return;p.prepareDrawTile();let A=p.isTileAffectedByFog(o),L=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1");let F=p.getOrCreateProgram("hillshade",{overrideFog:A,defines:L});w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment0.get());let N=((q,ee,re,te)=>{let ge=re.paint.get("hillshade-shadow-color"),de=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=re.paint.get("hillshade-highlight-color"),ue=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ae=re.paint.get("hillshade-accent-color"),_e=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Te=re.paint.get("hillshade-emissive-strength"),Ce=r.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Ce-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let Ue=q.style.directionalLight.properties.get("direction"),Ye=r.d4(Ue.x,Ue.y,Ue.z);Ce=r.an(Ye[1])}let Be=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),Be),u_image:0,u_latrange:HT(0,ee.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Ce],u_shadow:ge.toPremultipliedRenderColor(de?null:re.lut),u_highlight:fe.toPremultipliedRenderColor(ue?null:re.lut),u_emissive_strength:Te,u_accent:ae.toPremultipliedRenderColor(_e?null:re.lut)}})(p,c,f,p.terrain?o.projMatrix:null);p.uploadCommonUniforms(w,F,o.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:U,tileBoundsSegments:W}=p.getTileBoundsBuffers(c);F.draw(p,S.TRIANGLES,_,y,x,an.disabled,N,f.id,j,U,W)}function Vv(p,o,c){if(!o.needsDEMTextureUpload)return;let f=p.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(c.stride);let y=c.getPixels();o.demTexture?o.demTexture.update(y,{premultiply:!1}):o.demTexture=new r.T(f,y,_.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function qT(p,o,c){let f=p.context,_=f.gl;if(!o.dem)return;let y=o.dem;if(f.activeTexture.set(_.TEXTURE1),Vv(p,o,y),!o.demTexture)return;o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let x=y.dim;f.activeTexture.set(_.TEXTURE0);let w=o.hillshadeFBO;if(!w){let F=new r.T(f,{width:x,height:x,data:null},_.RGBA8);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),w=o.hillshadeFBO=f.createFramebuffer(x,x,1,"renderbuffer"),w.colorAttachment0.set(F.texture)}f.bindFramebuffer.set(w.framebuffer),f.viewport.set([0,0,x,x]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:M,tileBoundsSegments:A}=p.getMercatorTileBoundsBuffers(),L=[];p.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(p,_.TRIANGLES,Gt.disabled,ln.disabled,yn.unblended,an.disabled,((F,N)=>{let j=N.stride,U=r.bC();return r.ce(U,0,r.al,-r.al,0,0,1),r.br(U,U,[0,-r.al,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:F.overscaledZ}})(o.tileID,y),c.id,S,M,A),o.needsHillshadePrepare=!1}class er{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class WT extends er{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Lb extends er{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Uv extends er{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Im extends er{getDefault(){return[!0,!0,!0,!0]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class jv extends er{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class rd extends er{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Kd extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Cp extends er{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Qd extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class Nb extends er{getDefault(){return[0,1]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class $v extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class zb extends er{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Jd extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class Mm extends er{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Dm extends er{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Hv extends er{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Am extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Ep extends er{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Bb extends er{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Vb=class extends er{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Ub extends er{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class eh extends er{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class jb extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ZT extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class YT extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class XT extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Gv extends er{getDefault(){return null}set(o){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class qv extends er{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Wv extends er{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Zv extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class $b extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Pm extends er{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Om extends Pm{constructor(o,c,f=0){super(o,c),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+f}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class th extends Pm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Sp extends Pm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Hb extends th{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let Js=(p,o,c,f)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:c,u_emissive_texture_available:f}),Rm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_image1:1,u_frustum_tl:x,u_frustum_tr:w,u_frustum_br:S,u_frustum_bl:M,u_globe_pos:A,u_globe_radius:L,u_viewport:F,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:j,u_emissive_texture_available:U});function Tp(p,o){return p!=null&&o!=null&&!(!p.hasData()||!o.hasData())&&p.demTexture!=null&&o.demTexture!=null&&p.tileID.key!==o.tileID.key}let ec=new class{constructor(){this.operations={}}newMorphing(p,o,c,f,_){if(p in this.operations){let y=this.operations[p];y.to.tileID.key!==c.tileID.key&&(y.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(let o in this.operations){let c=this.operations[o];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},km={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Fm(p,o,c){if(o===0)return 0;let f=o<1&&c===514?.25/o:1;return 6*Math.pow(1.5,22-p)*Math.max(o,1)*f}function Yv(p,o){let c=1<<p.z;return!o&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}function nh(p,o){if(!p.style||!p.style.enable3dLights())return;let c=p.context,f=c.gl;c.activeTexture.set(f.TEXTURE1),o?o.bind(f.LINEAR,f.CLAMP_TO_EDGE):p.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}let Ip=p=>({u_matrix:p});function Mp(p,o,c,f,_){if(_>0){let y=r.o.now(),x=(y-p.timeAdded)/_,w=o?(y-o.timeAdded)/_:-1,S=c.getSource(),M=f.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),A=!o||Math.abs(o.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),L=A&&p.refreshedUponExpiration?1:r.aA(A?x:1-w,0,1);return o?{opacity:1,mix:1-L,isFading:x<1}:{opacity:L,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class Lm extends Bs{constructor(o){let c=ho("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class Xv extends Bs{constructor(o){let c=ho("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,f){if(o.freezeTileCoverage)return;this.transform=o;let _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let w=new Qu(x,this._source.tileSize*x.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[x.key]=w}return y},{});for(let y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(o){let c=this.proxyCachedFBO[o];if(c!==void 0){let f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kv extends r.aQ{constructor(o,c,f){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class Qv extends r.bV{constructor(o,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,_,y]=(function(S){let M=new r.bd,A=new r.b0,L=131;M.reserve(17161),A.reserve(33800);let F=r.al/128,N=r.al+F/2,j=N+F;for(let W=-F;W<j;W+=F)for(let q=-F;q<j;q+=F){let ee=q<0||q>N||W<0||W>N?24575:0,re=r.aA(Math.round(q),0,r.al),te=r.aA(Math.round(W),0,r.al);M.emplaceBack(re+ee,te)}let U=(W,q)=>{let ee=q*L+W;A.emplaceBack(ee+1,ee,ee+L),A.emplaceBack(ee+L,ee+L+1,ee+1)};for(let W=1;W<129;W++)for(let q=1;q<129;q++)U(q,W);return[0,129].forEach(W=>{for(let q=0;q<130;q++)U(q,W),U(W,q)}),[M,A,32768]})(),x=o.context;this.gridBuffer=x.createVertexBuffer(f,r.bf.members),this.gridIndexBuffer=x.createIndexBuffer(_),this.gridSegments=r.bg.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xv(c.map),this.orthoMatrix=r.bC(),r.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);let w=x.gl;this._overlapStencilMode=new ln({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lm(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,f){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let _=o.terrain.properties,y=o.terrain.drapeRenderMode===0,x=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();let w=o.terrain&&o.terrain.scope,S=_.get("source"),M=y?this._mockSourceCache:o.getSourceCache(S,w);if(!M)return void r.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=M,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(c):_.get("exaggeration"),!c.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let A=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let L=this.getScaledDemTileSize();this.sourceCache.update(c,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);let c=this._previousCameraAltitude,f=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=f;let _=c!=null?f-c:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let y=o.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let w=y-this._previousZoom,S=this._previousUpdateTimestamp,M=y;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(y-M)>.5&&(w=.5*(y-M+w)),w*_<0&&(M+=w)),this._evaluationZoom=M;let A=x.getExaggeration(M),L=A===x.getExaggeration(Math.max(0,M-.1));if(L&&Math.abs(A-this._exaggeration)<.01)return A;let F=Math.min(.1,.00375*(this._updateTimestamp-S));return(L||A<.1||Math.abs(w)<1e-4)&&(F=Math.min(.2,4*F)),r.ak(this._exaggeration,A,F)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=c.getIds().map(S=>{let M=c.getTileByID(S).tileID;return M.projMatrix=f.calculateProjMatrix(M.toUnwrapped()),M});(function(S,M){let A=M.transform.pointCoordinate(M.transform.getCameraPoint()),L=new r.P(A.x,A.y);S.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;let j=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),W=L.mult(1<<F.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr(j)-W.distSqr(U)})})(_,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},_.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let S in x){let M=x[S];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,o[S],y),M.usedForTerrain))continue;let A=o[S];M.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[c.id]=_.map(S=>new Kv(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let w={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let M=this.terrainTileForTile[S.key];if(!M)continue;let A=M.tileID.key;A in w||(this._visibleDemTiles.push(M),w[A]=A)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;let f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){let o=this.painter.context,c=o.gl;for(let f in this.terrainTileForTile){let _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),Vv(this.painter,_,y))}}_prepareDemTileUniforms(o,c,f,_){if(!c||c.demTexture==null)return!1;let y=o.tileID.canonical,x=Math.pow(2,c.tileID.canonical.z-y.z),w=_||"";return f[`u_dem_tl${w}`]=[y.x*x%1,y.y*x%1],f[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,c=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;let y=_.dem.tree.minimums[0];return y>0&&o++,f+y},0);return o?c/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);let f=this._getLoadedAreaMinimum(),_=new r.dL({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new r.T(o,_,c.R32F,{premultiply:!1}),y}setupElevationDraw(o,c,f){let _=this.painter.context,y=_.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let w=null,S=null,M=1;if(f&&f.morphing&&this._useVertexMorphing){let N=f.morphing.srcDemTile,j=f.morphing.dstDemTile;M=f.morphing.phase,N&&j&&(this._prepareDemTileUniforms(o,N,x,"_prev")&&(S=N),this._prepareDemTileUniforms(o,j,x)&&(w=j))}let A=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,L=null;var F;if(this.enabled?S&&w?(L=w.demTexture,_.activeTexture.set(y.TEXTURE4),S.demTexture.bind(A(S),y.CLAMP_TO_EDGE),x.u_dem_lerp=M):(w=this.terrainTileForTile[o.tileID.key],L=this._prepareDemTileUniforms(o,w,x)?w.demTexture:this.emptyDEMTexture):L=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),L&&(x.u_dem_size=(F=L).size[0]===1?1:F.size[0]-2,L.bind(A(w),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,c,x),f&&f.useMeterToDem&&w){let N=(1<<w.tileID.canonical.z)*r.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=N}if(f&&f.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(_,x),this.painter.transform.projection.name==="globe"){let N=this.globeUniformValues(this.painter.transform,o.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,N)}}globeUniformValues(o,c,f){let _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,r.al,0),u_tile_br_up:_.upVector(c,r.al,r.al),u_tile_bl_up:_.upVector(c,0,r.al),u_tile_up_scale:f?r.dM(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let c=this.painter,f=this.painter.context;o.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,y,x,w,S){if(_.transform.projection.name==="globe")(function(M,A,L,F,N){let j=M.context,U=j.gl,W,q,ee=M.transform,re=r.dE(M,j,ee),te=(Be,Ue)=>{if(q===Ue)return;let Ye=[km[Ue],"PROJECTION_GLOBE_VIEW"];re&&Ye.push("CUSTOM_ANTIALIASING");let dt=M.isTileAffectedByFog(Be);W=M.getOrCreateProgram("globeRaster",{defines:Ye,overrideFog:dt}),q=Ue},ge=M.colorModeForRenderPass(),de=new Gt(U.LEQUAL,Gt.ReadWrite,M.depthRangeFor3D);ec.update(N);let fe=r.dF(ee),ue=[r.aF(ee.center.lng),r.aJ(ee.center.lat)],ae=M.globeSharedBuffers,_e=[ee.width*r.o.devicePixelRatio,ee.height*r.o.devicePixelRatio],Te=Float32Array.from(ee.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};{let Be=M.transform,Ue=Fm(Be.zoom,A.exaggeration(),A.sourceCache._source.tileSize);q=-1;let Ye=U.TRIANGLES;for(let dt of F){let Fe=L.getTile(dt),be=ln.disabled,Ge=A.prevTerrainTileForTile[dt.key],Le=A.terrainTileForTile[dt.key];Tp(Ge,Le)&&ec.newMorphing(dt.key,Ge,Le,N,250),nh(M,Fe.emissiveTexture),j.activeTexture.set(U.TEXTURE0),Fe.texture&&Fe.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let tt=ec.getMorphValuesForProxy(dt.key),xt=tt?1:0;tt&&Object.assign(Ce,{morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:r.dD(tt.phase)}});let Dt=r.dG(dt.canonical),_t=r.dH(Dt.getCenter().lat),pt=r.dI(dt.canonical,Dt,_t,Be.worldSize/Be._pixelsPerMercatorPixel),Ut=r.bk(r.dJ(dt.canonical)),zt=M.emissiveMode==="mrt-fallback"?1:0,Tt=Rm(Be.expandedFarZProjMatrix,Te,fe,Ut,r.aj(Be.zoom),ue,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,_e,Ue,Be._farZ,zt,pt);if(te(dt,xt),W&&(A.setupElevationDraw(Fe,W,Ce),M.uploadCommonUniforms(j,W,dt.toUnwrapped()),ae)){let[Pt,Jt,fn]=ae.getGridBuffers(_t,Ue!==0);W.draw(M,Ye,de,be,ge,an.backCCW,Tt,"globe_raster",Pt,Jt,fn)}}}if(ae&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let Be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Be.push("CUSTOM_ANTIALIASING"),W=M.getOrCreateProgram("globeRaster",{defines:Be});for(let Ue of F){let{x:Ye,y:dt,z:Fe}=Ue.canonical,be=dt===0,Ge=dt===(1<<Fe)-1,[Le,tt,xt,Dt]=ae.getPoleBuffers(Fe,!1);if(Dt&&(be||Ge)){let _t=L.getTile(Ue);nh(M,_t.emissiveTexture),j.activeTexture.set(U.TEXTURE0),_t.texture&&_t.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let pt=r.dK(Fe,Ye,ee),Ut=r.bk(r.dJ(Ue.canonical)),zt=M.emissiveMode==="mrt-fallback"?1:0,Tt=(Pt,Jt)=>Pt.draw(M,U.TRIANGLES,de,ln.disabled,ge,an.disabled,Rm(ee.expandedFarZProjMatrix,pt,pt,Ut,0,ue,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,_e,0,ee._farZ,zt),"globe_pole_raster",Jt,xt,Dt);A.setupElevationDraw(_t,W,Ce),M.uploadCommonUniforms(j,W,Ue.toUnwrapped()),be&&M.renderDefaultNorthPole&&Tt(W,Le),Ge&&M.renderDefaultSouthPole&&(pt=r.cS(r.bC(),pt,[1,-1,1]),Tt(W,tt))}}}})(_,y,x,w,S);else{let M=_.context,A=M.gl,L,F,N=_.shadowRenderer,j=Zc(_,_.longestCutoffRange),U=ge=>{if(F===ge)return;let de=[];de.push(km[ge]),j.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),N&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&de.push("NORMAL_OFFSET")),L=_.getOrCreateProgram("terrainRaster",{defines:de}),F=ge},W=_.colorModeForRenderPass(),q=new Gt(A.LEQUAL,Gt.ReadWrite,_.depthRangeFor3D);ec.update(S);let ee=_.transform,re=Fm(ee.zoom,y.exaggeration(),y.sourceCache._source.tileSize),te=[0,0,0];if(N){let ge=_.style.directionalLight,de=_.style.ambientLight;ge&&de&&(te=Jl(_.style,ge,de))}{F=-1;let ge=A.TRIANGLES,[de,fe]=[y.gridIndexBuffer,y.gridSegments];for(let ue of w){let ae=x.getTile(ue),_e=ln.disabled,Te=y.prevTerrainTileForTile[ue.key],Ce=y.terrainTileForTile[ue.key];Tp(Te,Ce)&&ec.newMorphing(ue.key,Te,Ce,S,250),nh(_,ae.emissiveTexture),M.activeTexture.set(A.TEXTURE0),ae.texture&&ae.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let Be=ec.getMorphValuesForProxy(ue.key),Ue=Be?1:0,Ye;Be&&(Ye={morphing:{srcDemTile:Be.from,dstDemTile:Be.to,phase:r.dD(Be.phase)}});let dt=_.emissiveMode==="mrt-fallback"?1:0,Fe=Js(ue.projMatrix,Yv(ue.canonical,ee.renderWorldCopies)?re/10:re,te,dt);if(U(Ue),!L)continue;y.setupElevationDraw(ae,L,Ye);let be=ue.toUnwrapped();N&&N.setupShadows(be,L),_.uploadCommonUniforms(M,L,be,null,j),L.draw(_,ge,q,_e,W,an.backCCW,Fe,"terrain_raster",y.gridBuffer,de,fe)}}}})(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let c=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],x=this._drapedRenderBatches.shift(),w=c.style.order,S=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let M=0;for(let A of y){let L=_.getTileByID(A.proxyTileKey),F=_.proxyCachedFBO[A.key]?_.proxyCachedFBO[A.key][o]:void 0,N=F!==void 0?_.renderCache[F]:this.pool[M++],j=F!==void 0;if(L.texture=N.tex,L.emissiveTexture=N.emissiveTex,j&&!N.dirty){S.push(L.tileID);continue}f.bindFramebuffer.set(N.fb.framebuffer);let U=f.gl,W;U.drawBuffers(c.emissiveMode==="mrt-fallback"?[U.COLOR_ATTACHMENT0,U.COLOR_ATTACHMENT1]:[U.COLOR_ATTACHMENT0]),this.renderedToTile=!1,N.dirty&&(f.clear({color:r.ao.transparent,stencil:0}),N.dirty=!1);for(let q=x.start;q<=x.end;++q){let ee=c.style._mergedLayers[w[q]];if(ee.isHidden(c.transform.zoom))continue;let re=c.style.getLayerSourceCache(ee),te=re?this.proxyToSource[A.key][re.id]:[A];if(!te)continue;let ge=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),W!==(re?re.id:null)&&(this._setupStencil(N,te,ee,re),W=re?re.id:null),c.renderLayer(c,re,ee,ge)}if(U.drawBuffers([U.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let ee=c.style._mergedLayers[w[q]];if(ee.isHidden(c.transform.zoom))continue;let re=c.style.getLayerSourceCache(ee),te=re?this.proxyToSource[A.key][re.id]:[A];if(!te)continue;let ge=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),W!==(re?re.id:null)&&(this._setupStencil(N,te,ee,re),W=re?re.id:null),c.renderLayer(c,re,ee,ge)}this.renderedToTile?(N.dirty=!0,S.push(L.tileID)):j||--M,M===5&&(M=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),x.end+1}postRender(){}isLayerOrderingCorrect(o){let c=o.order.length,f=-1,_=c;for(let y=0;y<c;++y)this._style.isLayerDraped(o._mergedLayers[o.order[y]])?f=Math.max(f,y):_=Math.min(_,y);return _>f}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,f){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,w=1<<x.overscaledZ,{x:S,y:M}=x.canonical,A=S/w,L=(S+1)/w,F=M/w,N=(M+1)/w;return{minx:A,miny:F,maxx:L,maxy:N,t:y.dem.tree.raycastRoot(A,F,L,N,o,c,f),tile:y}});_.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of _){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,o,c,f);if(x!=null)return x}return null}_createFBO(){let o=this.painter.context,c=o.gl,f=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);let _=new r.T(o,{width:f[0],height:f[1],data:null},c.RGBA8);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);let y=o.createFramebuffer(f[0],f[1],1,null),x;return y.colorAttachment0.set(_.texture),this._emissiveTexture&&(x=new r.T(o,{width:f[0],height:f[1],data:null},c.R8),x.bind(c.LINEAR,c.CLAMP_TO_EDGE),y.createColorAttachment(o,1),y.colorAttachment1.set(x.texture)),y.depthAttachment=new Hb(o,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:y,tex:_,emissiveTex:x,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(let c of this.pool)this._updateFBO(c,o);for(let c of this.proxySourceCache.renderCache)this._updateFBO(c,o);this._emissiveTexture=o}}_updateFBO(o,c){let f=o.fb,_=this.painter.context,y=_.gl,x=this.drapeBufferSize;if(c){let w=new r.T(_,{width:x[0],height:x[1],data:null},y.R8);w.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.emissiveTex=w,f.createColorAttachment(_,1),f.colorAttachment1.set(w.texture)}else o.emissiveTex=void 0,f.removeColorAttachment(_,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let c=this._style._mergedLayers[o],f=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let f of this._style.getSources())if(f instanceof Yu){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="line")continue;let x=_.widthExpression(),w=_.emissiveStrengthExpression();if(x instanceof r.ad||w instanceof r.ad){c[y.id]=!0;for(let S of this.proxyCoords){let M=this.proxyToSource[S.key][y.id];if(M)for(let A of M)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof wo){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let x=_.paint.get("raster-fade-duration");for(let w of this.proxyCoords){let S=this.proxyToSource[w.key][y.id];if(S)for(let M of S){let A=Mp(y.getTile(M),y.findLoadedParent(M,0),y,this.painter.transform,x);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(y.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let o=this._style.order,c=o.length;if(c===0)return;let f=[];this._pendingGroundEffectLayers=[];let _,y=0,x=this._style._mergedLayers[o[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<c;)x=this._style._mergedLayers[o[y]];for(;y<c;++y){let w=this._style._mergedLayers[o[y]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?_===void 0&&(_=y):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(f.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:y-1}),f.length!==0){let w=f[f.length-1];this._pendingGroundEffectLayers.every(S=>S>w.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(o){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let x=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let w=0;w<x.length;++w){let S=Object.values(x[w]);c.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,_=this._tilesDirty;for(let x=f.length-1;x>=0;x--){let w=f[x];if(c.getTileByID(w.key),c.proxyCachedFBO[w.key]!==void 0){let S=o[w.key],M=this.proxyToSource[w.key],A=0;for(let L in M){let F=M[L],N=S[L];if(!N||N.length!==F.length||F.some((j,U)=>j!==N[U]||_[L]&&_[L].hasOwnProperty(j.key))){A=-1;break}++A}for(let L in c.proxyCachedFBO[w.key])c.renderCache[c.proxyCachedFBO[w.key][L]].dirty=A<0||A!==Object.values(S).length}}let y=[...this._drapedRenderBatches];y.sort((x,w)=>w.end-w.start-(x.end-x.start));for(let x of y)for(let w of f){if(c.proxyCachedFBO[w.key])continue;let S=c.renderCachePool.pop();S===void 0&&c.renderCache.length<50&&(S=c.renderCache.length,c.renderCache.push(this._createFBO())),S!==void 0&&(c.proxyCachedFBO[w.key]={},c.proxyCachedFBO[w.key][x.start]=S,c.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let w;if(f.isTileClipped())w=c.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):ln.disabled}_renderTileClippingMasks(o,c){let f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(yn.disabled),_.setDepthMode(Gt.disabled);let x=f.getOrCreateProgram("clippingMask");for(let w of o){let S=f._tileClippingMaskIDs[w.key]=--c;x.draw(f,y.TRIANGLES,Gt.disabled,new ln({func:y.ALWAYS,mask:0},S,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,an.disabled,Ip(w.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(o){let c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;let f=[o.x,o.y,1,1];r.aC(f,f,c.pixelMatrixInverse),r.cK(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;let _=c._camera.position,y=r.cf(1,c.center.lat),x=[_[0],_[1],_[2]/y,0],w=r.da([],f.slice(0,3),x);r.aw(w,w);let S=this.raycast(x,w,this._exaggeration);return S!==null&&S?(r.bH(x,x,w,S),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(o,c,f){if(o.getSource()instanceof r.aU)return this._setupProxiedCoordsForImageSource(o,c,f);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords;for(let S=0;S<y.length;S++){let M=y[S],A=this._findTileCoveringTileID(M,o);if(A){let L=this._createProxiedId(M,A,f[M.key]&&f[M.key][o.id]);_.push(L),this.proxyToSource[M.key][o.id]=[L]}}let x=!1,w=new Set;for(let S=0;S<c.length;S++){let M=o.getTile(c[S]);if(!M||!M.hasData())continue;let A=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==M.tileID.canonical.z){let L=this.proxyToSource[A.tileID.key][o.id],F=this._createProxiedId(A.tileID,M,f[A.tileID.key]&&f[A.tileID.key][o.id]);L?L.splice(L.length-1,0,F):this.proxyToSource[A.tileID.key][o.id]=[F];let N=this.proxyToSource[A.tileID.key][o.id];w.has(N)||w.add(N),_.push(F),x=!0}}if(this._sourceTilesOverlap[o.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let S of w)S.sort((M,A)=>A.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(o,c,f){if(!o.getSource().loaded())return;let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords,x=o.getSource(),w=x.tileID;if(!w)return;let S=new r.P(w.x,w.y)._div(1<<w.z),M=x.coordinates.map(r.ae.fromLngLat).reduce((L,F)=>(L.min.x=Math.min(L.min.x,F.x-S.x),L.min.y=Math.min(L.min.y,F.y-S.y),L.max.x=Math.max(L.max.x,F.x-S.x),L.max.y=Math.max(L.max.y,F.y-S.y),L),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(L,F)=>{let N=L.wrap+L.canonical.x/(1<<L.canonical.z),j=L.canonical.y/(1<<L.canonical.z),U=r.al/(1<<L.canonical.z),W=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z);return N+U<W+M.min.x||N>W+M.max.x||j+U<q+M.min.y||j>q+M.max.y};for(let L=0;L<y.length;L++){let F=y[L];for(let N=0;N<c.length;N++){let j=o.getTile(c[N]);if(!j||!j.hasData()||A(F,j.tileID))continue;let U=this._createProxiedId(F,j,f[F.key]&&f[F.key][o.id]),W=this.proxyToSource[F.key][o.id];W?W.push(U):this.proxyToSource[F.key][o.id]=[U],_.push(U)}}}_createProxiedId(o,c,f){let _=this.orthoMatrix;if(f){let y=f.find(x=>x.key===c.tileID.key);if(y)return y}if(c.tileID.key!==o.key){let y=o.canonical.z-c.tileID.canonical.z,x,w,S;_=r.bC();let M=c.tileID.wrap-o.wrap<<o.overscaledZ;y>0?(x=r.al>>y,w=x*((c.tileID.canonical.x<<y)-o.canonical.x+M),S=x*((c.tileID.canonical.y<<y)-o.canonical.y)):(x=r.al<<-y,w=r.al*(c.tileID.canonical.x-(o.canonical.x+M<<-y)),S=r.al*(c.tileID.canonical.y-(o.canonical.y<<-y))),r.ce(_,0,x,0,x,0,1),r.br(_,_,[w,S,0])}return new Kv(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let f=c.getTile(o);if(f&&f.hasData())return f;let _=this._findCoveringTileCache[c.id],y=_[o.key];if(f=y?c.getTileByID(y):null,f&&f.hasData()||y===null)return f;let x=f?f.tileID:o,w=x.overscaledZ,S=c.getSource().minzoom,M=[];if(!y){let L=c.getSource().maxzoom;if(o.canonical.z>=L){let F=o.canonical.z-L;c.getSource().reparseOverscaled?(w=Math.max(o.canonical.z+2,c.transform.tileZoom),x=new r.aQ(w,o.wrap,L,o.canonical.x>>F,o.canonical.y>>F)):F!==0&&(w=L,x=new r.aQ(w,o.wrap,L,o.canonical.x>>F,o.canonical.y>>F))}x.key!==o.key&&(M.push(x.key),f=c.getTile(x))}let A=L=>{M.forEach(F=>{_[F]=L}),M.length=0};for(w-=1;w>=S&&(!f||!f.hasData());w--){f&&A(f.tileID.key);let L=x.calculateScaledKey(w);if(f=c.getTileByID(L),f&&f.hasData())break;let F=_[L];if(F===null)break;F===void 0?M.push(L):f=c.getTileByID(F)}return A(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let f=this._tilesDirty[o];f||(f=this._tilesDirty[o]={}),f[c.key]=!0}}function ih(p,o,c){let f=(function(w,S,M){let A=r.bJ(S,w),L=r.bJ(M,[.2126,.7152,.0722]),F=(j,U,W)=>(1-W)*j+W*U,N=F(1-.3*Math.min(L,1),1,Math.min(A+1,1));return F(.92,1,Math.asin(r.aA(S[2],-1,1))/Math.PI+.5)*N})(p,[0,0,1],o),_=[0,0,0];r.c5(_,c.slice(0,3),f);let y=[0,0,0];r.c5(y,o.slice(0,3),p[2]);let x=[0,0,0];return r.d8(x,_,y),r.db(x)}let KT=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],QT=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Gb{static cacheKey(o,c,f,_){let y=[c];_&&y.push(_.cacheKey);for(let x of f)o.usedDefines.has(x)&&y.push(x);return y.join("/")}constructor(o,c,f,_,y,x){let w=o.gl;this.program=w.createProgram(),this.configuration=_,this.name=c,this.fixedDefines=[...x];let S=`#version 300 es
${(_?_.defines():[]).concat(x.map(U=>`#define ${U}`)).join(`
`)}`,M=[S,jT];for(let U of f.fragmentIncludes)M.push(Qc[U]);M.push(f.fragmentSource);let A=M.join(`
`),L=[S,Fb];for(let U of f.vertexIncludes)L.push(Qc[U]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&f.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&L.push("uniform int u_instanceID;"),L.push(f.vertexSource);let F=L.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));let N=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(N,A),w.compileShader(N),w.attachShader(this.program,N);let j=w.createShader(w.VERTEX_SHADER);w.isContextLost()?this.failedToCreate=!0:(w.shaderSource(j,F),w.compileShader(j),w.attachShader(this.program,j),this.attributes={},w.linkProgram(this.program),w.deleteShader(j),w.deleteShader(N),this.fixedUniforms=y(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=_?_.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(U=>({u_instanceID:new r.ch(U)}))(o)),(x.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(U=>({u_dem:new r.ch(U),u_dem_prev:new r.ch(U),u_dem_tl:new r.ck(U),u_dem_scale:new r.cj(U),u_dem_tl_prev:new r.ck(U),u_dem_scale_prev:new r.cj(U),u_dem_size:new r.cj(U),u_dem_lerp:new r.cj(U),u_exaggeration:new r.cj(U),u_depth:new r.ch(U),u_depth_size_inv:new r.ck(U),u_depth_range_unpack:new r.ck(U),u_occluder_half_size:new r.cj(U),u_occlusion_depth_offset:new r.cj(U),u_meter_to_dem:new r.cj(U),u_label_plane_matrix_inv:new r.cl(U)}))(o)),x.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new r.ci(U),u_tile_tr_up:new r.ci(U),u_tile_br_up:new r.ci(U),u_tile_bl_up:new r.ci(U),u_tile_up_scale:new r.cj(U)}))(o)),x.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new r.cl(U),u_fog_range:new r.ck(U),u_fog_color:new r.d3(U),u_fog_horizon_blend:new r.cj(U),u_fog_vertical_limit:new r.ck(U),u_fog_temporal_offset:new r.cj(U),u_frustum_tl:new r.ci(U),u_frustum_tr:new r.ci(U),u_frustum_br:new r.ci(U),u_frustum_bl:new r.ci(U),u_globe_pos:new r.ci(U),u_globe_radius:new r.cj(U),u_globe_transition:new r.cj(U),u_is_globe:new r.ch(U),u_viewport:new r.ck(U)}))(o)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new r.d3(U)}))(o)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new r.ci(U),u_lighting_directional_dir:new r.ci(U),u_lighting_directional_color:new r.ci(U),u_ground_radiance:new r.ci(U)}))(o)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new r.cl(U),u_light_matrix_1:new r.cl(U),u_fade_range:new r.ck(U),u_shadow_normal_offset:new r.ci(U),u_shadow_intensity:new r.cj(U),u_shadow_texel_size:new r.cj(U),u_shadow_map_resolution:new r.cj(U),u_shadow_direction:new r.ci(U),u_shadow_bias:new r.ci(U),u_shadowmap_0:new r.ch(U),u_shadowmap_1:new r.ch(U)}))(o)))}getAttributeLocation(o,c){let f=this.attributes[c];return f===void 0&&(f=this.attributes[c]=o.getAttribLocation(this.program,c)),f}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setCutoffUniformValues(o,c){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setLightsUniformValues(o,c){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setShadowUniformValues(o,c){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}_drawDebugWireframe(o,c,f,_,y,x,w,S,M,A){let L=o.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;let F=o.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||o._terrain&&o._terrain.renderingToTexture||!KT.includes(this.name))||!(!L.layers3D||!QT.includes(this.name))))return;let N=F.gl,j=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,y,F);if(!j)return;let U=[...this.fixedDefines,"DEBUG_WIREFRAME"],W=o.getOrCreateProgram(this.name,{config:this.configuration,defines:U});F.program.set(W.program);let q=(te,ge,de)=>{if(ge[te]&&de[te])for(let fe in ge[te])de[te][fe]&&de[te][fe].set(de.program,fe,ge[te][fe].current)};M&&M.setUniforms(W.program,F,W.binderUniforms,w,{zoom:S}),q("fixedUniforms",this,W),q("terrainUniforms",this,W),q("globeUniforms",this,W),q("fogUniforms",this,W),q("lightsUniforms",this,W),q("shadowUniforms",this,W),j.bind(),F.setColorMode(new yn([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],r.ao.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Gt(c.func===N.LESS?N.LEQUAL:c.func,Gt.ReadOnly,c.range)),F.setStencilMode(ln.disabled);let ee=3*x.primitiveLength*2,re=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let te=A||1;for(let ge=0;ge<te;++ge)W.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,re)}else A&&A>1?N.drawElementsInstanced(N.LINES,ee,N.UNSIGNED_SHORT,re,A):N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,re);y.bind(),F.program.set(this.program),F.setDepthMode(c),F.setStencilMode(f),F.setColorMode(_)}checkUniforms(o,c,f){if(this.fixedDefines.includes(c)){for(let _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${_} not set but required by ${c} being defined`)}}draw(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W){let q=o.context,ee=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(f),q.setStencilMode(_),q.setColorMode(y),q.setCullFace(x);for(let[ue,ae]of this.fixedUniformsEntries)ae.set(this.program,ue,w[ue]);j&&j.setUniforms(this.program,q,this.binderUniforms,F,{zoom:N});let re={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[c];this.checkUniforms(S,"RENDER_SHADOWS",this.shadowUniforms);let te=U||[],ge=j?j.getPaintVertexBuffers():[],de=c===ee.TRIANGLES&&A,fe=W&&W>0?1:void 0;for(let ue of L.get()){let ae=ue.vaos||(ue.vaos={});if((ae[S]||(ae[S]=new $T)).bind(q,this,M,ge,A,ue.vertexOffset,te,fe),this.forceManualRenderingForInstanceIDShaders){let _e=W||1;for(let Te=0;Te<_e;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),A?ee.drawElements(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2):ee.drawArrays(c,ue.vertexOffset,ue.vertexLength)}else W&&W>1?ee.drawElementsInstanced(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2,W):A?ee.drawElements(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2):ee.drawArrays(c,ue.vertexOffset,ue.vertexLength);de&&this._drawDebugWireframe(o,f,_,y,A,ue,F,N,j,W)}}}function qb(p,o,c=0){let f=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,p.transform.tileZoom)/f,y=_*(o.tileID.canonical.x+o.tileID.wrap*f),x=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(o,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:c}}let Nm={terrain:0,flat:1},JT=r.bC(),zm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q)=>{let ee=o.style.light,re=ee.properties.get("position"),te=[re.x,re.y,re.z],ge=r.dO();ee.properties.get("anchor")==="viewport"&&(r.dP(ge,-o.transform.angle),r.dQ(te,te,ge));let de=ee.properties.get("color").toPremultipliedRenderColor(null),fe=o.transform,ue={u_matrix:p,u_lightpos:te,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:JT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Nm[M],u_base_type:Nm[A],u_ao:_,u_edge_radius:y,u_width_scale:x,u_flood_light_color:j,u_vertical_scale:U,u_flood_light_intensity:W,u_ground_shadow_factor:q};return fe.projection.name==="globe"&&(ue.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],ue.u_zoom_transition=L,ue.u_inv_rot_matrix=N,ue.u_merc_center=F,ue.u_up_dir=fe.projection.upVector(new r.cD(0,0,0),F[0]*r.al,F[1]*r.al),ue.u_height_lift=S),ue},Jv=(p,o,c,f,_,y)=>({u_matrix:p,u_edge_radius:o,u_width_scale:c,u_vertical_scale:f,u_height_type:Nm[_],u_base_type:Nm[y]}),Wb=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q)=>{let ee=zm(p,o,c,f,_,y,x,w,M,A,L,F,N,j,U,W,1,[0,0,0]),re={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return Object.assign(ee,qb(o,S,q),re)},rh=(p,o,c,f,_,y,x,w,S,M,A)=>({u_matrix:o,u_opacity:c,u_ao_pass:f?1:0,u_meter_to_tile:_,u_ao:y,u_flood_light_intensity:x,u_flood_light_color:w,u_attenuation:S,u_edge_radius:M,u_fb:0,u_fb_size:A,u_dynamic_offset:1}),e0=(p,o,c)=>({u_matrix:p,u_emissive_strength:o,u_ground_shadow_factor:c}),t0=(p,o,c,f,_,y=0)=>Object.assign(e0(p,o,_),qb(c,f,y)),Zb=(p,o,c,f)=>({u_matrix:p,u_world:c,u_emissive_strength:o,u_ground_shadow_factor:f}),n0=(p,o,c,f,_,y,x=0)=>Object.assign(t0(p,o,c,f,y,x),{u_world:_}),eu=(p,o)=>({u_matrix:p,u_ground_shadow_factor:o}),od=(p,o,c,f,_)=>({u_matrix:p,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:c,u_height_scale:f,u_reset_depth:_}),Bm=(p,o,c,f,_,y,x,w,S)=>({u_matrix:p,u_normal_matrix:o,u_opacity:c,u_faux_facade_ao_intensity:f,u_camera_pos:_,u_tile_to_meter:y,u_facade_emissive_chance:x,u_flood_light_color:w,u_flood_light_intensity:S}),Yb=p=>({u_matrix:p}),tu=p=>({u_matrix:p}),i0=(p,o,c,f,_,y,x,w)=>{let S=r.al/y.tileSize;return{u_matrix:p,u_inv_rot_matrix:o,u_camera_to_center_distance:c.getCameraToCenterDistance(w),u_extrude_scale:[c.pixelsToGLUnits[0]/S,c.pixelsToGLUnits[1]/S],u_zoom_transition:f,u_tile_id:x,u_merc_center:_}},Dp=(p,o,c=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:c}),Xb=r.bC(),Kb=(p,o,c,f,_,y,x)=>{let w=p.transform,S=w.projection.name==="globe",M=S?r.dR(w.zoom,o.canonical)*w._pixelsPerMercatorPixel:r.ay(c,1,y),A={u_matrix:o.projMatrix,u_extrude_scale:M,u_intensity:x,u_inv_rot_matrix:Xb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){A.u_inv_rot_matrix=f,A.u_merc_center=_,A.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],A.u_zoom_transition=r.aj(w.zoom);let L=_[0]*r.al,F=_[1]*r.al;A.u_up_dir=w.projection.upVector(new r.cD(0,0,0),L,F)}return A};function Vm(p,[o,c,f,_],[y,x]){if(y===x)return[0,0,0,0];let w=255*(p-1)/(p*(x-y));return[o*w,c*w,f*w,_*w]}function Um(p,o,[c,f]){return c===f?0:.5/p+(o-c)*(p-1)/(p*(f-c))}let Qb=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee,re,te)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:r.dT(L.paint.get("raster-saturation")),u_contrast_factor:r.dS(L.paint.get("raster-contrast")),u_spin_weights:Jb(L.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S,u_colorization_mix:Vm(r.dU,U,q),u_colorization_offset:Um(r.dU,W,q),u_color_ramp:j,u_texture_offset:[re/(ee+2*re),ee/(ee+2*re)],u_texture_res:[ee+2*re,ee+2*re],u_emissive_strength:te});function Jb(p){p*=Math.PI/180;let o=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}let wl=.05,eI=(p,o,c,f,_,y,x,w,S,M,A,L)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S}),tI=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_tile_offset:c,u_velocity:f,u_color_ramp:y,u_velocity_res:_,u_max_speed:x,u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[wl,wl]}),e1=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_velocity:c,u_velocity_res:f,u_max_speed:_,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[wl,wl]}),t1=r.bC(),jm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee,re,te,ge,de,fe)=>{let ue=_.transform,ae={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(ee),u_rotate_symbol:+c,u_aspect_ratio:ue.width/ue.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+M,u_elevation_from_sea:S?1:0,u_pitch_with_map:+f,u_texsize:A,u_texsize_icon:L,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:t1,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:t1,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:de||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(ee)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:fe||1,u_ground_shadow_factor:re,u_inv_matrix:r.bl(r.bC(),x),u_normal_scale:te,u_lutTexture:Co.LUT};return ee.name==="globe"&&(ae.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],ae.u_zoom_transition=j,ae.u_inv_rot_matrix=W,ae.u_merc_center=U,ae.u_camera_forward=ue._camera.forward(),ae.u_ecef_origin=r.dV(ue.globeMatrix,N.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(ue.globeMatrix),ae.u_up_vector=q),ae},Ap=(p,o,c,f)=>({u_matrix:p,u_emissive_strength:o,u_opacity:c,u_color:f}),nu=(p,o,c,f,_,y,x,w,S)=>Object.assign((function(M,A,L,F,N,j){let{width:U,height:W}=F.imageManager.getPixelSize(A),q=Math.pow(2,j.tileID.overscaledZ),ee=j.tileSize*Math.pow(2,F.transform.tileZoom)/q,re=ee*(j.tileID.canonical.x+j.tileID.wrap*q),te=ee*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[U,W],u_pattern_size:L.displaySize,u_pattern_units_to_pixels:N?[F.transform.width,-1*F.transform.height]:[1/r.ay(j,1,F.transform.tileZoom),1/r.ay(j,1,F.transform.tileZoom)],u_pixel_coord_upper:[re>>16,te>>16],u_pixel_coord_lower:[65535&re,65535&te]}})(0,y,x,f,w,S),{u_matrix:p,u_emissive_strength:o,u_opacity:c}),oh=new Float32Array(r.bA([])),sd=(p,o,c,f,_,y,x,w,S,M,A,L,F,N=[0,0,0],j,U,W)=>{let q=_.style.light,ee=q.properties.get("position"),re=[-ee.x,-ee.y,ee.z],te=r.dO();q.properties.get("anchor")==="viewport"&&(r.dP(te,-_.transform.angle),r.dQ(re,re,te));let ge=A.alphaMode==="MASK",de=q.properties.get("color").toNonPremultipliedRenderColor(null),fe=F.paint.get("model-ambient-occlusion-intensity"),ue=F.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return ue.a=F.paint.get("model-color-mix-intensity").constantOr(0),W&&(ue.r=W[0],ue.g=W[1],ue.b=W[2],ue.a=W[3]),U&&(ue.r=U.color.r,ue.g=U.color.g,ue.b=U.color.b,ue.a=U.colorMix,L=U.emissionStrength,y*=U.opacity),{u_matrix:p,u_lighting_matrix:o,u_normal_matrix:c,u_node_matrix:f||oh,u_lightpos:re,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:N,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:A.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:S,u_roughnessFactor:M,u_baseColorTexture:Co.BaseColor,u_metallicRoughnessTexture:Co.MetallicRoughness,u_normalTexture:Co.Normal,u_occlusionTexture:Co.Occlusion,u_emissionTexture:Co.Emission,u_lutTexture:Co.LUT,u_color_mix:ue.toArray01(),u_aoIntensity:fe,u_emissive_strength:L,u_occlusionTextureTransform:j||[0,0,0,0]}},r0=(p,o=oh,c=oh)=>({u_matrix:p,u_instance:o,u_node_matrix:c}),$m={fillExtrusion:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_opacity:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_flood_light_color:new r.ci(p),u_vertical_scale:new r.cj(p),u_flood_light_intensity:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new r.cl(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_vertical_scale:new r.cj(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_height_factor:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_opacity:new r.cj(p),u_pattern_transition:new r.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.cl(p),u_opacity:new r.cj(p),u_ao_pass:new r.cj(p),u_meter_to_tile:new r.cj(p),u_ao:new r.ck(p),u_flood_light_intensity:new r.cj(p),u_flood_light_color:new r.ci(p),u_attenuation:new r.cj(p),u_edge_radius:new r.cj(p),u_fb:new r.ch(p),u_fb_size:new r.cj(p),u_dynamic_offset:new r.cj(p)}),fill:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),fillOutline:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_ground_shadow_factor:new r.ci(p)}),fillOutlinePattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),building:p=>({u_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_opacity:new r.cj(p),u_faux_facade_ao_intensity:new r.cj(p),u_camera_pos:new r.ci(p),u_tile_to_meter:new r.cj(p),u_facade_emissive_chance:new r.cj(p),u_flood_light_color:new r.ci(p),u_flood_light_intensity:new r.cj(p)}),buildingBloom:p=>({u_matrix:new r.cl(p)}),buildingDepth:p=>({u_matrix:new r.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new r.cl(p),u_depth_bias:new r.cj(p)}),elevatedStructures:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new r.cl(p),u_camera_pos:new r.ci(p),u_depth_bias:new r.cj(p),u_height_scale:new r.cj(p),u_reset_depth:new r.cj(p)}),circle:r.dY,collisionBox:p=>({u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_extrude_scale:new r.ck(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p)}),collisionCircle:p=>({u_matrix:new r.cl(p),u_inv_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_viewport_size:new r.ck(p)}),debug:p=>({u_color:new r.dB(p),u_matrix:new r.cl(p),u_overlay:new r.ch(p),u_overlay_scale:new r.cj(p)}),clippingMask:p=>({u_matrix:new r.cl(p)}),heatmap:p=>({u_extrude_scale:new r.cj(p),u_intensity:new r.cj(p),u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_up_dir:new r.ci(p)}),heatmapTexture:p=>({u_image:new r.ch(p),u_color_ramp:new r.ch(p),u_opacity:new r.cj(p)}),hillshade:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_latrange:new r.ck(p),u_light:new r.ck(p),u_shadow:new r.dB(p),u_highlight:new r.dB(p),u_emissive_strength:new r.cj(p),u_accent:new r.dB(p)}),hillshadePrepare:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_dimension:new r.ck(p),u_zoom:new r.cj(p)}),line:r.dX,linePattern:r.dW,raster:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_brightness_low:new r.cj(p),u_brightness_high:new r.cj(p),u_saturation_factor:new r.cj(p),u_contrast_factor:new r.cj(p),u_spin_weights:new r.ci(p),u_perspective_transform:new r.ck(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p),u_colorization_mix:new r.d3(p),u_colorization_offset:new r.cj(p),u_color_ramp:new r.ch(p),u_texture_offset:new r.ck(p),u_texture_res:new r.ck(p),u_emissive_strength:new r.cj(p)}),rasterParticle:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p)}),rasterParticleTexture:p=>({u_texture:new r.ch(p),u_opacity:new r.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_tile_offset:new r.ck(p),u_velocity:new r.ch(p),u_color_ramp:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_velocity:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_speed_factor:new r.cj(p),u_reset_rate:new r.cj(p),u_rand_seed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new r.ch(p),u_is_size_feature_constant:new r.ch(p),u_size_t:new r.cj(p),u_size:new r.cj(p),u_camera_to_center_distance:new r.cj(p),u_rotate_symbol:new r.ch(p),u_aspect_ratio:new r.cj(p),u_fade_change:new r.cj(p),u_matrix:new r.cl(p),u_label_plane_matrix:new r.cl(p),u_coord_matrix:new r.cl(p),u_is_text:new r.ch(p),u_elevation_from_sea:new r.ch(p),u_pitch_with_map:new r.ch(p),u_texsize:new r.ck(p),u_texsize_icon:new r.ck(p),u_texture:new r.ch(p),u_texture_icon:new r.ch(p),u_gamma_scale:new r.cj(p),u_device_pixel_ratio:new r.cj(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_camera_forward:new r.ci(p),u_tile_matrix:new r.cl(p),u_up_vector:new r.ci(p),u_ecef_origin:new r.ci(p),u_is_halo:new r.ch(p),u_icon_transition:new r.cj(p),u_color_adj_mat:new r.cl(p),u_scale_factor:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_inv_matrix:new r.cl(p),u_normal_scale:new r.cj(p),u_lutTexture:new r.ch(p)}),background:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_color:new r.dB(p)}),backgroundPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_image:new r.ch(p),u_pattern_tl:new r.ck(p),u_pattern_br:new r.ck(p),u_texsize:new r.ck(p),u_pattern_size:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_pattern_units_to_pixels:new r.ck(p)}),terrainRaster:p=>({u_matrix:new r.cl(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_skirt_height:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_emissive_texture_available:new r.cj(p)}),skybox:p=>({u_matrix:new r.cl(p),u_sun_direction:new r.ci(p),u_cubemap:new r.ch(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxGradient:p=>({u_matrix:new r.cl(p),u_color_ramp:new r.ch(p),u_center_direction:new r.ci(p),u_radius:new r.cj(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new r.dC(p),u_sun_direction:new r.ci(p),u_sun_intensity:new r.cj(p),u_color_tint_r:new r.d3(p),u_color_tint_m:new r.d3(p),u_luminance:new r.cj(p)}),globeRaster:p=>({u_proj_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_grid_matrix:new r.dC(p),u_skirt_height:new r.cj(p),u_far_z_cutoff:new r.cj(p),u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_globe_pos:new r.ci(p),u_globe_radius:new r.cj(p),u_viewport:new r.ck(p),u_emissive_texture_available:new r.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_horizon:new r.cj(p),u_transition:new r.cj(p),u_fadeout_range:new r.cj(p),u_atmosphere_fog_color:new r.d3(p),u_high_color:new r.d3(p),u_space_color:new r.d3(p),u_temporal_offset:new r.cj(p),u_horizon_angle:new r.cj(p)}),model:p=>({u_matrix:new r.cl(p),u_lighting_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_node_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_camera_pos:new r.ci(p),u_opacity:new r.cj(p),u_baseColorFactor:new r.d3(p),u_emissiveFactor:new r.d3(p),u_metallicFactor:new r.cj(p),u_roughnessFactor:new r.cj(p),u_baseTextureIsAlpha:new r.ch(p),u_alphaMask:new r.ch(p),u_alphaCutoff:new r.cj(p),u_baseColorTexture:new r.ch(p),u_metallicRoughnessTexture:new r.ch(p),u_normalTexture:new r.ch(p),u_occlusionTexture:new r.ch(p),u_emissionTexture:new r.ch(p),u_lutTexture:new r.ch(p),u_color_mix:new r.d3(p),u_aoIntensity:new r.cj(p),u_emissive_strength:new r.cj(p),u_occlusionTextureTransform:new r.d3(p)}),modelDepth:p=>({u_matrix:new r.cl(p),u_instance:new r.cl(p),u_node_matrix:new r.cl(p)}),groundShadow:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),stars:p=>({u_matrix:new r.cl(p),u_up:new r.ci(p),u_right:new r.ci(p),u_intensity_multiplier:new r.cj(p)}),snowParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_horizontalOscillationRadius:new r.cj(p),u_horizontalOscillationRate:new r.cj(p),u_boxSize:new r.cj(p),u_billboardSize:new r.cj(p),u_simpleShapeParameters:new r.ck(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_particleColor:new r.d3(p),u_direction:new r.ci(p)}),rainParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_texScreen:new r.ch(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_boxSize:new r.cj(p),u_rainDropletSize:new r.ck(p),u_distortionStrength:new r.cj(p),u_rainDirection:new r.ci(p),u_color:new r.d3(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_shapeDirectionalPower:new r.cj(p),u_shapeNormalPower:new r.cj(p),u_mode:new r.cj(p)}),vignette:p=>({u_vignetteShape:new r.ci(p),u_vignetteColor:new r.d3(p)}),occlusion:p=>({u_matrix:new r.cl(p),u_anchorPos:new r.ci(p),u_screenSizePx:new r.ck(p),u_occluderSizePx:new r.ck(p),u_color:new r.d3(p)})},Pp=(()=>{class p{constructor(c,f,_,y){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++,this.context=c;let x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return p.uniqueIdxCounter=0,p})(),o0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class n1{constructor(o,c,f,_,y,x){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.instanceCount=x,this.context=o;let w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let f=0;f<this.attributes.length;f++){let _=c.getAttributeLocation(o,this.attributes[f].name);_!==-1&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=this.attributes[_],x=c.getAttributeLocation(o,y.name);x!==-1&&o.vertexAttribPointer(x,y.components,o[o0[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=c.getAttributeLocation(o,this.attributes[_].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class i1{constructor(o,c,f,_,y){this.context=o,this.width=c,this.height=f;let x=this.framebuffer=o.gl.createFramebuffer();_>0&&(this.colorAttachment0=new Om(o,x,0)),_>1&&(this.colorAttachment1=new Om(o,x,1)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new th(o,x):new Sp(o,x))}createColorAttachment(o,c){c===0?this.colorAttachment0=new Om(o,this.framebuffer,0):c===1&&(this.colorAttachment1=new Om(o,this.framebuffer,1))}removeColorAttachment(o,c){let f=this.context.gl,_;c===0?(_=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(_=this.colorAttachment1.get(),this.colorAttachment1=void 0),_&&f.deleteTexture(_)}destroy(){let o=this.context.gl;if(this.colorAttachment0){let c=this.colorAttachment0.get();c&&o.deleteTexture(c)}if(this.colorAttachment1){let c=this.colorAttachment1.get();c&&o.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&o.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&o.deleteTexture(c)}o.deleteFramebuffer(this.framebuffer)}}class sh{constructor(o,c){this.gl=o,this.clearColor=new WT(this),this.clearDepth=new Lb(this),this.clearStencil=new Uv(this),this.colorMask=new Im(this),this.depthMask=new jv(this),this.stencilMask=new rd(this),this.stencilFunc=new Kd(this),this.stencilOp=new Cp(this),this.stencilTest=new Qd(this),this.depthRange=new Nb(this),this.depthTest=new $v(this),this.depthFunc=new zb(this),this.blend=new Jd(this),this.blendFunc=new Mm(this),this.blendColor=new Dm(this),this.blendEquation=new Hv(this),this.cullFace=new Am(this),this.cullFaceSide=new Ep(this),this.frontFace=new Bb(this),this.program=new Vb(this),this.activeTexture=new Ub(this),this.viewport=new eh(this),this.bindFramebuffer=new jb(this),this.bindRenderbuffer=new ZT(this),this.bindTexture=new YT(this),this.bindVertexBuffer=new XT(this),this.bindElementBuffer=new Gv(this),this.bindVertexArrayOES=new qv(this),this.pixelStoreUnpack=new Wv(this),this.pixelStoreUnpackPremultiplyAlpha=new Zv(this),this.pixelStoreUnpackFlipY=new $b(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c,f){return new Pp(this,o,c,f)}createVertexBuffer(o,c,f,_,y){return new n1(this,o,c,f,_,y)}createRenderbuffer(o,c,f){let _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,o,c,f),this.bindRenderbuffer.set(null),y}createFramebuffer(o,c,f,_){return new i1(this,o,c,f,_)}clear({color:o,depth:c,stencil:f,colorMask:_}){let y=this.gl,x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){r.by(o.blendFunction,yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ad;function Lt(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=p.transform,A=[r.aF(M.center.lng),r.aJ(M.center.lat)],L=c.layout.get("symbol-placement"),F=c.layout.get("text-variable-anchor"),N=c.layout.get("icon-rotation-alignment")==="map",j=c.layout.get("text-rotation-alignment")==="map",U=L!=="point",W=[],q=0,ee=0;for(let ae=0;ae<f.length;ae++){let _e=f[ae],Te=o.getTile(_e),Ce=Te.getBucket(c);if(!Ce)continue;let Be=Ce.getProjection().createInversionMatrix(M,_e.canonical),Ue=[],Ye=um(_e,Ce,M),dt=!x&&N&&U,Fe=x&&j&&U,be=F&&Ce.hasTextData(),Ge=Ce.hasIconTextFit()&&be&&Ce.hasIconData(),Le=dt||Fe||x&&be||Ge,tt=Ce.projection.name==="globe",xt=tt?r.aj(M.zoom):0;tt&&(Ue.push("PROJECTION_GLOBE_VIEW"),Le&&Ue.push("PROJECTED_POS_ON_VIEWPORT"));let Dt=p.getOrCreateProgram("collisionBox",{defines:Ue}),_t=Ye;_[0]===0&&_[1]===0||(_t=p.translatePosMatrix(Ye,Te,_,y));let pt=x?Ce.textCollisionBox:Ce.iconCollisionBox,Ut=Ce.collisionCircleArray;if(Ut.length>0){let Tt=r.bC(),Pt=_t;r.cP(Tt,Ce.placementInvProjMatrix,M.glCoordMatrix),r.cP(Tt,Tt,Ce.placementViewportMatrix),W.push({circleArray:Ut,circleOffset:ee,transform:Pt,invTransform:Tt,projection:Ce.getProjection()}),q+=Ut.length/4,ee=q}if(!pt)continue;p.terrain&&p.terrain.setupElevationDraw(Te,Dt);let zt=tt?[_e.canonical.x,_e.canonical.y,1<<_e.canonical.z]:[0,0,0];Dt.draw(p,S.LINES,Gt.disabled,ln.disabled,p.colorModeForRenderPass(),an.disabled,i0(_t,Be,M,xt,A,Te,zt,Ce.getProjection()),c.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,M.zoom,null,[pt.collisionVertexBuffer,pt.collisionVertexBufferExt])}if(!x||!W.length)return;let re=p.getOrCreateProgram("collisionCircle"),te=new r.dZ;te.resize(4*q),te._trim();let ge=0;for(let ae of W)for(let _e=0;_e<ae.circleArray.length/4;_e++){let Te=4*_e,Ce=ae.circleArray[Te+0],Be=ae.circleArray[Te+1],Ue=ae.circleArray[Te+2],Ye=ae.circleArray[Te+3];te.emplace(ge++,Ce,Be,Ue,Ye,0),te.emplace(ge++,Ce,Be,Ue,Ye,1),te.emplace(ge++,Ce,Be,Ue,Ye,2),te.emplace(ge++,Ce,Be,Ue,Ye,3)}(!ad||ad.length<2*q)&&(ad=(function(ae){let _e=2*ae,Te=new r.b0;Te.resize(_e),Te._trim();for(let Ce=0;Ce<_e;Ce++){let Be=6*Ce;Te.uint16[Be+0]=4*Ce+0,Te.uint16[Be+1]=4*Ce+1,Te.uint16[Be+2]=4*Ce+2,Te.uint16[Be+3]=4*Ce+2,Te.uint16[Be+4]=4*Ce+3,Te.uint16[Be+5]=4*Ce+0}return Te})(q));let de=w.createIndexBuffer(ad,!0),fe=w.createVertexBuffer(te,r.d_.members,!0);for(let ae of W){let _e={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(ue=M).getCameraToCenterDistance(ae.projection),u_viewport_size:[ue.width,ue.height]};re.draw(p,S.TRIANGLES,Gt.disabled,ln.disabled,p.colorModeForRenderPass(),an.disabled,_e,c.id,fe,de,r.bg.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,M.zoom)}var ue;fe.destroy(),de.destroy()}let Op=r.bC();function tc(p){let o=p._camera.getWorldToCamera(p.worldSize,1),c=r.aB([],o,p.globeMatrix);r.bl(c,c);let f=[0,0,0],_=[0,1,0,0];return r.aC(_,_,c),f[0]=_[0],f[1]=_[1],f[2]=_[2],r.aw(f,f),f}function iu({width:p,height:o,anchor:c,textOffset:f,textScale:_},y){let{horizontalAlign:x,verticalAlign:w}=r.c1(c),S=-(x-.5)*p,M=-(w-.5)*o,A=r.c2(c,f);return new r.P((S/_+A[0])*y,(M/_+A[1])*y)}function en(p,o,c,f,_,y,x,w,S,M){let A=p.text.placedSymbolArray,L=p.text.dynamicLayoutVertexArray,F=p.icon.dynamicLayoutVertexArray,N={},j=p.getProjection(),U=_l(x,j,_),W=_.elevation,q=j.upVectorScale(x.canonical,_.center.lat,_.worldSize).metersToTile;L.clear();for(let ee=0;ee<A.length;ee++){let re=A.get(ee),{tileAnchorX:te,tileAnchorY:ge,numGlyphs:de}=re,fe=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:f[re.crossTileID];if(fe){let ue=0,ae=0,_e=0,Te=p.elevationType==="road";if(W||Te){let Le=Te?p.getElevationFeatureForText(ee):null,tt=r.bV.getAtTileOffset(x,new r.P(te,ge),W,Le),[xt,Dt,_t]=j.upVector(x.canonical,te,ge);ue=tt*xt*q,ae=tt*Dt*q,_e=tt*_t*q}let[Ce,Be,Ue,Ye]=ya(re.projectedAnchorX+ue,re.projectedAnchorY+ae,re.projectedAnchorZ+_e,c?U:y),dt=ui(_.getCameraToCenterDistance(j),Ye),Fe=r.bM(p.textSizeData,S,re)*dt/r.bY;c&&(Fe*=p.tilePixelRatio/w);let be=iu(fe,Fe);c?({x:Ce,y:Be,z:Ue}=j.projectTilePoint(te+be.x,ge+be.y,x.canonical),[Ce,Be,Ue]=ya(Ce+ue,Be+ae,Ue+_e,y)):(o&&be._rotate(-_.angle),Ce+=be.x,Be+=be.y,Ue=0);let Ge=p.allowVerticalPlacement&&re.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let Le=0;Le<de;Le++)r.bO(L,Ce,Be,Ue,Ge);M&&re.associatedIconIndex>=0&&(N[re.associatedIconIndex]={x:Ce,y:Be,z:Ue,angle:Ge})}else Wa(de,L)}if(M){F.clear();let ee=p.icon.placedSymbolArray;for(let re=0;re<ee.length;re++){let te=ee.get(re),{numGlyphs:ge}=te,de=N[re];if(te.hidden||!de)Wa(ge,F);else{let{x:fe,y:ue,z:ae,angle:_e}=de;for(let Te=0;Te<ge;Te++)r.bO(F,fe,ue,ae,_e)}}p.icon.dynamicLayoutVertexBuffer.updateData(F)}p.text.dynamicLayoutVertexBuffer.updateData(L)}function Rp(p,o,c,f,_,y,x={}){let w=c.paint.get("icon-translate"),S=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),A=c.paint.get("text-translate-anchor"),L=c.layout.get("icon-rotation-alignment"),F=c.layout.get("text-rotation-alignment"),N=c.layout.get("icon-pitch-alignment"),j=c.layout.get("text-pitch-alignment"),U=c.layout.get("icon-keep-upright"),W=c.layout.get("text-keep-upright"),q=c.paint.get("icon-color-saturation"),ee=c.paint.get("icon-color-contrast"),re=c.paint.get("icon-color-brightness-min"),te=c.paint.get("icon-color-brightness-max"),ge=c.layout.get("symbol-elevation-reference")==="sea",de=c.layout.get("icon-image-use-theme")==="none",fe=p.context,ue=fe.gl,ae=p.transform,_e=L==="map",Te=F==="map",Ce=N==="map",Be=j==="map",Ue=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ye=!1,dt=p.depthModeForSublayer(0,Gt.ReadOnly),Fe=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),be=[r.aF(ae.center.lng),r.aJ(ae.center.lat)],Ge=c.layout.get("text-variable-anchor"),Le=ae.projection.name==="globe",tt=[],xt=[0,-1,0];for(let Dt of f){let _t=o.getTile(Dt),pt=_t.getBucket(c);if(!pt||pt.projection.name==="mercator"&&Le||pt.fullyClipped)continue;let Ut=pt.projection.name==="globe",zt=Ut?r.aj(ae.zoom):0,Tt=_l(Dt,pt.getProjection(),ae),Pt=ae.calculatePixelsToTileUnitsMatrix(_t),Jt=Ge&&pt.hasTextData(),fn=pt.hasIconTextFit()&&Jt&&pt.hasIconData(),Fn=pt.getProjection().createInversionMatrix(ae,Dt.canonical),Jn=(1<<_t.tileID.canonical.z)*r.al/p.transform.worldSize,jt=ri=>{let $n=[0,0,0];if(ri){let wn=p.style.directionalLight,Hi=p.style.ambientLight;wn&&Hi&&($n=Jl(p.style,wn,Hi))}return $n},Yn=ri=>{ae.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},pn=ri=>{c.lut&&!de&&(c.lut.texture||(c.lut.texture=new r.d$(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],fe.gl.RGBA8)),fe.activeTexture.set(fe.gl.TEXTURE0+Co.LUT),c.lut.texture&&c.lut.texture.bind(fe.gl.LINEAR,fe.gl.CLAMP_TO_EDGE),ri.push("APPLY_LUT_ON_GPU"))},ii=()=>{let ri=_e&&c.layout.get("symbol-placement")!=="point",$n=[];Yn($n),pn($n);let wn=ri||fn,Hi=pt.elevationType==="road",wr=p.shadowRenderer,ir=Hi&&Ce&&!!wr&&wr.enabled,Si=jt(ir),_s=Hi&&Ce&&!p.terrain?Fe:dt,Fo=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ce&&$n.push("PITCH_WITH_MAP_TERRAIN"),Ut&&($n.push("PROJECTION_GLOBE_VIEW"),wn&&$n.push("PROJECTED_POS_ON_VIEWPORT")),Fo>0&&pt.hasAnySecondaryIcon&&$n.push("ICON_TRANSITION"),!pt.icon.zOffsetVertexBuffer||Hi&&p.terrain||$n.push("Z_OFFSET"),q===0&&ee===0&&re===0&&te===1||$n.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&$n.push("RENDER_SDF"),ir&&$n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Hi&&Ce&&!p.terrain&&pt.icon.orientationVertexBuffer&&$n.push("ELEVATED_ROADS");let Qr=pt.icon.programConfigurations.get(c.id),Xo=p.getOrCreateProgram("symbol",{config:Qr,defines:$n}),Ko=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],Do=pt.iconSizeData,na=r.bK(Do,ae.zoom),Ia=Ce||!ae.isOrthographic,As=as(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Pt),_r=pp(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Pt),Mr=p.translatePosMatrix(_r,_t,w,M,!0),Ti=p.translatePosMatrix(Tt,_t,w,M),Lr=wn?Op:As,dr=_e&&!Ce&&!ri,rr=xt;!Le&&!ae.mercatorFromTransition||_e||(rr=tc(ae));let Ma=Ut?rr:xt,Gp=c.getColorAdjustmentMatrix(q,ee,re,te),Qa=jm(Do.kind,na,dr,Ce,p,Ti,Lr,Mr,ge,!1,Ko,[0,0],0,Dt,zt,be,Fn,Ma,pt.getProjection(),Si,Jn,Gp,Fo,null),qp=_t.imageAtlasTexture?_t.imageAtlasTexture:null,mh=c.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,Il=pt.sdfIcons||p.options.rotating||p.options.zooming||mh||Ia?ue.LINEAR:ue.NEAREST,uc=pt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,gh=p.terrain&&Ce&&ri?r.bl(r.bC(),As):Op;if(ri&&pt.icon){let lu=r.bV.getAtTileOffsetFunc(Dt,ae.center.lat,ae.worldSize,pt.getProjection()),dc=dm(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Pt),Ja=c.layout.get("icon-size-scale-range"),hc=r.aA(p.scaleFactor,Ja[0],Ja[1]);Ib(pt,Tt,p,!1,dc,_r,Ce,U,lu,Dt,hc)}return{program:Xo,buffers:pt.icon,uniformValues:Qa,atlasTexture:qp,atlasTextureIcon:null,atlasInterpolation:Il,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:uc,depthMode:_s,tile:_t,renderWithShadows:ir,labelPlaneMatrixInv:gh}},mi=()=>{let ri=Te&&c.layout.get("symbol-placement")!=="point",$n=[],wn=ri||Ge||fn,Hi=pt.elevationType==="road",wr=p.shadowRenderer,ir=Hi&&Be&&!!wr&&wr.enabled,Si=jt(ir),_s=Hi&&Be&&!p.terrain?Fe:dt;p.terrainRenderModeElevated()&&Be&&$n.push("PITCH_WITH_MAP_TERRAIN"),Ut&&($n.push("PROJECTION_GLOBE_VIEW"),wn&&$n.push("PROJECTED_POS_ON_VIEWPORT")),!pt.text.zOffsetVertexBuffer||Hi&&p.terrain||$n.push("Z_OFFSET"),pt.iconsInText&&$n.push("RENDER_TEXT_AND_SYMBOL"),$n.push("RENDER_SDF"),ir&&$n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Hi&&Be&&!p.terrain&&pt.text.orientationVertexBuffer&&$n.push("ELEVATED_ROADS"),Yn($n);let Fo=pt.text.programConfigurations.get(c.id),Qr=p.getOrCreateProgram("symbol",{config:Fo,defines:$n}),Xo,Ko=[0,0],Do=null,na=pt.textSizeData;pt.iconsInText&&(Ko=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],Do=_t.imageAtlasTexture?_t.imageAtlasTexture:null,Xo=Be||!ae.isOrthographic||p.options.rotating||p.options.zooming||na.kind==="composite"||na.kind==="camera"?ue.LINEAR:ue.NEAREST);let Ia=_t.glyphAtlasTexture?_t.glyphAtlasTexture.size:[0,0],As=c.layout.get("text-size-scale-range"),_r=r.aA(p.scaleFactor,As[0],As[1]),Mr=r.bK(na,ae.zoom,_r),Ti=as(Tt,_t.tileID.canonical,Be,Te,ae,pt.getProjection(),Pt),Lr=pp(Tt,_t.tileID.canonical,Be,Te,ae,pt.getProjection(),Pt),dr=p.translatePosMatrix(Lr,_t,S,A,!0),rr=p.translatePosMatrix(Tt,_t,S,A),Ma=wn?Op:Ti,Gp=Te&&!Be&&!ri,Qa=xt;!Le&&!ae.mercatorFromTransition||Te||(Qa=tc(ae));let qp=jm(na.kind,Mr,Gp,Be,p,rr,Ma,dr,ge,!0,Ia,Ko,0,Dt,zt,be,Fn,Ut?Qa:xt,pt.getProjection(),Si,Jn,null,null,_r),mh=_t.glyphAtlasTexture?_t.glyphAtlasTexture:null,Il=ue.LINEAR,uc=c.paint.get("text-halo-width").constantOr(1)!==0,gh=p.terrain&&Be&&ri?r.bl(r.bC(),Ti):Op;if(ri&&pt.text){let lu=r.bV.getAtTileOffsetFunc(Dt,ae.center.lat,ae.worldSize,pt.getProjection()),dc=dm(Tt,_t.tileID.canonical,Be,Te,ae,pt.getProjection(),Pt);Ib(pt,Tt,p,!0,dc,Lr,Be,W,lu,Dt,_r)}return{program:Qr,buffers:pt.text,uniformValues:qp,atlasTexture:mh,atlasTextureIcon:Do,atlasInterpolation:Il,atlasInterpolationIcon:Xo,isSDF:!0,hasHalo:uc,depthMode:_s,tile:_t,renderWithShadows:ir,labelPlaneMatrixInv:gh}},di=pt.icon.segments.get().length,Wn=pt.text.segments.get().length,bn=di&&!x.onlyText?ii():null,ti=Wn&&!x.onlyIcons?mi():null,ur=c.paint.get("icon-opacity").constantOr(1),Ki=c.paint.get("text-opacity").constantOr(1);if(Ue&&pt.canOverlap){Ye=!0;let ri=ur&&!x.onlyText?pt.icon.segments.get():[],$n=Ki&&!x.onlyIcons?pt.text.segments.get():[];for(let wn of ri)tt.push({segments:new r.bg([wn]),sortKey:wn.sortKey,state:bn});for(let wn of $n)tt.push({segments:new r.bg([wn]),sortKey:wn.sortKey,state:ti})}else x.onlyText||tt.push({segments:ur?pt.icon.segments:new r.bg([]),sortKey:0,state:bn}),x.onlyIcons||tt.push({segments:Ki?pt.text.segments:new r.bg([]),sortKey:0,state:ti})}Ye&&tt.sort((Dt,_t)=>Dt.sortKey-_t.sortKey);for(let Dt of tt){let _t=Dt.state;if(_t)if(p.terrain?p.terrain.setupElevationDraw(_t.tile,_t.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:_t.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,_t.program),fe.activeTexture.set(ue.TEXTURE0),_t.atlasTexture&&_t.atlasTexture.bind(_t.atlasInterpolation,ue.CLAMP_TO_EDGE,!0),_t.atlasTextureIcon&&(fe.activeTexture.set(ue.TEXTURE1),_t.atlasTextureIcon&&_t.atlasTextureIcon.bind(_t.atlasInterpolationIcon,ue.CLAMP_TO_EDGE,!0)),_t.renderWithShadows&&p.shadowRenderer.setupShadows(_t.tile.tileID.toUnwrapped(),_t.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,_t.program),_t.hasHalo){let pt=_t.uniformValues;pt.u_is_halo=1,s0(_t.buffers,Dt.segments,c,p,_t.program,_t.depthMode,_,y,pt,2),pt.u_is_halo=0}else{if(_t.isSDF){let pt=_t.uniformValues;_t.hasHalo&&(pt.u_is_halo=1,s0(_t.buffers,Dt.segments,c,p,_t.program,_t.depthMode,_,y,pt,1)),pt.u_is_halo=0}s0(_t.buffers,Dt.segments,c,p,_t.program,_t.depthMode,_,y,_t.uniformValues,1)}}}function s0(p,o,c,f,_,y,x,w,S,M){let A=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,y,x,w,an.disabled,S,c.id,p.layoutVertexBuffer,p.indexBuffer,o,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),A,M)}function r1(p,o){let c=1<<p.canonical.z,f=(o.x*c-p.canonical.x-p.wrap*c)*r.al,_=(o.y*c-p.canonical.y)*r.al,y=r.e8(o.z,o.y);return r.d5(f,_,y)}function Hm(p,o,c,f,_){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let y=p.context.gl,x=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),w=new Gt(p.context.gl.GREATER,Gt.ReadWrite,p.depthRangeFor3D),S=(function(N){let j=.01;return N.isOrthographic&&(j=r.ak(1e-4,j,r.d0(N.pitch>=Ya?1:N.pitch/Ya))),2*j})(p.transform),M=p.transform.getFreeCameraOptions().position,A="elevatedStructuresDepthReconstruct",L=p.getOrCreateProgram(A,{defines:["DEPTH_RECONSTRUCTION"]}),F=p.getOrCreateProgram(A);for(let N of f){let j=o.getTile(N),U=j.getBucket(c);if(!U)continue;let W=U.elevatedStructures;if(!W)continue;let q=U.elevationBufferData.heightRange,ee=r1(N.toUnwrapped(),M),re=p.translatePosMatrix(N.projMatrix,j,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),te,ge,de,fe;if(_==="initialize"){if(!q||q.min>=1||W.depthSegments.segments[0].primitiveLength===0)continue;te=od(re,ee,S,1,0),ge=x,de=W.depthSegments,fe=L}else if(_==="reset"){if(!q||q.min>=0||W.maskSegments.segments[0].primitiveLength===0)continue;te=od(re,ee,0,0,1),ge=w,de=W.maskSegments,fe=L}else if(_==="geometry"){if(W.depthSegments.segments[0].primitiveLength===0)continue;te=od(re,ee,S,1,0),ge=x,de=W.depthSegments,fe=F}fe.draw(p,y.TRIANGLES,ge,ln.disabled,yn.disabled,an.disabled,te,c.id,W.vertexBuffer,W.indexBuffer,de,c.paint,p.transform.zoom)}}function Gm(p,o,c,f){let{painter:_,sourceCache:y,layer:x,coords:w,colorMode:S,elevationType:M,terrainEnabled:A,pass:L}=p,F=_.context.gl,N=x.paint.get("fill-pattern"),j=x.paint.get("fill-pattern-cross-fade"),U=N.constantOr(null),W=M;M!=="road"||o&&!A||(W="none");let q=W==="road",ee=p.painter.shadowRenderer,re=q&&!!ee&&ee.enabled,te=new Gt(_.context.gl.LEQUAL,Gt.ReadOnly,_.depthRangeFor3D),ge=[0,0,0];if(re){let ae=_.style.directionalLight,_e=_.style.ambientLight;ae&&_e&&(ge=Jl(_.style,ae,_e))}let de=N&&N.constantOr(1),fe=_.terrain&&_.terrain.renderingToTexture,ue=(ae,_e)=>{let Te,Ce,Be,Ue,Ye;_e?(Te=de&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=F.LINES):(Te=de?"fillPattern":"fill",Be=F.TRIANGLES);for(let dt of w){let Fe=y.getTile(dt);if(de&&!Fe.patternsLoaded())continue;let be=Fe.getBucket(x);if(!be)continue;let Ge=o?be.elevationBufferData:be.bufferData;if(Ge.isEmpty())continue;_.prepareDrawTile();let Le=Ge.programConfigurations.get(x.id),tt=_.isTileAffectedByFog(dt),xt=[],Dt=[];q&&(xt.push("ELEVATED_ROADS"),Dt.push(Ge.elevatedLayoutVertexBuffer)),re&&xt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fe&&c&&xt.push("USE_MRT1"),de&&(_.context.activeTexture.set(F.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Le.updatePaintBuffers());let _t=!1;if(U&&Fe.imageAtlas){let Pt=Fe.imageAtlas,Jt=r.e3.from(U),fn=Jt.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Fn=Jt.getSecondary(),Jn=Pt.patternPositions.get(fn),jt=Fn?Pt.patternPositions.get(Fn.scaleSelf(r.o.devicePixelRatio).toString()):null;_t=!!Jn&&!!jt,Jn&&Le.setConstantPatternPositions(Jn,jt)}j>0&&(_t||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&xt.push("FILL_PATTERN_TRANSITION");let pt=_.getOrCreateProgram(Te,{config:Le,overrideFog:tt,defines:xt}),Ut=_.translatePosMatrix(dt.projMatrix,Fe,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));re&&ee.setupShadows(Fe.tileID.toUnwrapped(),pt,"vector-tile");let zt=x.paint.get("fill-emissive-strength");if(_e){Ue=Ge.lineIndexBuffer,Ye=Ge.lineSegments;let Pt=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ce=Te==="fillOutlinePattern"&&de?n0(Ut,zt,_,Fe,Pt,ge,j):Zb(Ut,zt,Pt,ge)}else Ue=Ge.indexBuffer,Ye=Ge.triangleSegments,Ce=de?t0(Ut,zt,_,Fe,ge,j):e0(Ut,zt,ge);_.uploadCommonUniforms(_.context,pt,dt.toUnwrapped());let Tt=ae;(M==="road"&&!A||M==="offset")&&(Tt=te),pt.draw(_,Be,Tt,f||_.stencilModeForClipping(dt),S,an.disabled,Ce,x.id,Ge.layoutVertexBuffer,Ue,Ye,x.paint,_.transform.zoom,Le,Dt)}};_.renderPass===L&&ue(_.depthModeForSublayer(1,_.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),W==="none"&&_.renderPass==="translucent"&&x.paint.get("fill-antialias")&&ue(_.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function qm(p,o,c,f,_,y,x,w){c.resetLayerRenderingStats(p);let S=p.context,M=S.gl,A=p.transform,L=c.paint.get("fill-extrusion-pattern"),F=c.paint.get("fill-extrusion-pattern-cross-fade"),N=L.constantOr(null),j=L.constantOr(1),U=c.paint.get("fill-extrusion-opacity"),W=p.style.enable3dLights(),q=c.paint.get(W&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],re=c.layout.get("fill-extrusion-edge-radius"),te=re>0&&!c.paint.get("fill-extrusion-rounded-roof"),ge=te?0:re,de=A.projection.name==="globe"?r.eb():0,fe=A.projection.name==="globe",ue=fe?r.aj(A.zoom):0,ae=[r.aF(A.center.lng),r.aJ(A.center.lat)],_e=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Te=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(_e?null:c.lut).toArray01().slice(0,3),Ce=c.paint.get("fill-extrusion-flood-light-intensity"),Be=c.paint.get("fill-extrusion-vertical-scale"),Ue=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=c.paint.get("fill-extrusion-height-alignment"),dt=c.paint.get("fill-extrusion-base-alignment"),Fe=Zc(p,c.paint.get("fill-extrusion-cutoff-fade-range")),be=[],Ge;fe&&be.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&be.push("FAUX_AO"),te&&be.push("ZERO_ROOF_RADIUS"),w&&be.push("HAS_CENTROID"),Ce>0&&be.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),Ue&&be.push("RENDER_WALL_MODE");let Le=p.renderPass==="shadow",tt=p.shadowRenderer,xt=Le&&!!tt,Dt=Le?an.disabled:an.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let _t=[0,0,0];if(tt){let zt=p.style.directionalLight,Tt=p.style.ambientLight;zt&&Tt&&(_t=Jl(p.style,zt,Tt)),Le||(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),tt.useNormalOffset&&be.push("NORMAL_OFFSET")),Ge=be.concat(["SHADOWS_SINGLE_CASCADE"])}let pt=xt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",Ut=c.getLayerRenderingStats();for(let zt of f){let Tt=o.getTile(zt),Pt=Tt.getBucket(c);if(!Pt||Pt.projection.name!==A.projection.name)continue;let Jt=!1;tt&&(Jt=tt.getMaxCascadeForTile(zt.toUnwrapped())===0);let fn=p.isTileAffectedByFog(zt),Fn=Pt.programConfigurations.get(c.id),Jn=!1;if(N&&Tt.imageAtlas){let Wn=Tt.imageAtlas,bn=r.e3.from(N),ti=bn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),ur=bn.getSecondary(),Ki=Wn.patternPositions.get(ti),ri=ur?Wn.patternPositions.get(ur.scaleSelf(r.o.devicePixelRatio).toString()):null;Jn=!!Ki&&!!ri,Ki&&Fn.setConstantPatternPositions(Ki,ri)}F>0&&(Jn||Fn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&be.push("FILL_EXTRUSION_PATTERN_TRANSITION");let jt=p.getOrCreateProgram(pt,{config:Fn,defines:Jt?Ge:be,overrideFog:fn});if(p.terrain&&p.terrain.setupElevationDraw(Tt,jt,{useMeterToDem:!0}),!Pt.centroidVertexBuffer){let Wn=jt.getAttributeLocation(M,"a_centroid_pos");Wn!==-1&&M.vertexAttrib2f(Wn,0,0)}!Le&&tt&&tt.setupShadows(Tt.tileID.toUnwrapped(),jt,"vector-tile"),j&&(p.context.activeTexture.set(M.TEXTURE0),Tt.imageAtlasTexture&&Tt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Fn.updatePaintBuffers());let Yn=c.paint.get("fill-extrusion-vertical-gradient"),pn=1/Pt.tileToMeter,ii;if(Le&&tt){if(ic(Tt.tileID,Pt.maxHeight,p))continue;let Wn=tt.calculateShadowPassMatrixFromTile(Tt.tileID.toUnwrapped());ii=Jv(Wn,ge,pn,Be,Ye,dt)}else{let Wn=p.translatePosMatrix(zt.expandedProjMatrix,Tt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),bn=A.projection.createInversionMatrix(A,zt.canonical);ii=j?Wb(Wn,p,Yn,U,ee,ge,pn,zt,Tt,de,Ye,dt,ue,ae,bn,Te,Be,F):zm(Wn,p,Yn,U,ee,ge,pn,zt,de,Ye,dt,ue,ae,bn,Te,Be,Ce,_t)}p.uploadCommonUniforms(S,jt,zt.toUnwrapped(),null,Fe);let mi=Pt.segments;if(A.projection.name==="mercator"&&!Le&&(mi=Pt.getVisibleSegments(Tt.tileID,p.terrain,p.transform.getFrustum(0)),!mi.get().length))continue;if(Ut)if(Le)for(let Wn of mi.get())Ut.numRenderedVerticesInShadowPass+=Wn.primitiveLength;else for(let Wn of mi.get())Ut.numRenderedVerticesInTransparentPass+=Wn.primitiveLength;let di=[];(p.terrain||w)&&di.push(Pt.centroidVertexBuffer),fe&&di.push(Pt.layoutVertexExtBuffer),Ue&&di.push(Pt.wallVertexBuffer),jt.draw(p,S.gl.TRIANGLES,_,y,x,Dt,ii,c.id,Pt.layoutVertexBuffer,Pt.indexBuffer,mi,c.paint,p.transform.zoom,Fn,di)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class a0{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function nc(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,W,q,ee,re){let te=o.context,ge=te.gl,de=o.transform,fe=o.transform.zoom,ue=[],ae=p.translate,_e=p.translateAnchor,Te=p.edgeRadius,Ce=Zc(o,p.cutoffFadeRange);A==="clear"?(ue.push("CLEAR_SUBPASS"),re&&(ue.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ge.TEXTURE0),re.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):A==="sdf"?ue.push("SDF_SUBPASS"):A==="emissive"&&(ue.push("USE_MRT1"),te.activeTexture.set(ge.TEXTURE0),re.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)),q&&ue.push("HAS_CENTROID"),Ce.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");let Be=(Ue,Ye,dt,Fe,be)=>{let Ge=ue;Ye.groundRadiusBuffer!=null&&(Ge=ue.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));let Le=Ye.programConfigurations.get(f.id),tt=o.isTileAffectedByFog(Ue),xt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Le,defines:Ge,overrideFog:tt}),Dt=rh(o,Fe,L,M,be,[F,N*be],j,U,W,fe>=17?0:Te*be,re?re.size[0]:0),_t=[];q&&_t.push(Ye.hiddenByLandmarkVertexBuffer),Ye.groundRadiusBuffer!=null&&_t.push(Ye.groundRadiusBuffer),o.uploadCommonUniforms(te,xt,Ue.toUnwrapped(),null,Ce),xt.draw(o,te.gl.TRIANGLES,y,x,w,S,Dt,f.id,Ye.vertexBuffer,Ye.indexBuffer,dt,f.paint,fe,Le,_t)};for(let Ue of _){let Ye=c.getTile(Ue),dt=Ye.getBucket(f);if(!dt||dt.projection.name!==de.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;let Fe=dt.groundEffect,be=1/dt.tileToMeter;{let Ge=o.translatePosMatrix(Ue.projMatrix,Ye,ae,_e),Le=Fe.getDefaultSegment();Be(Ue,Fe,Le,Ge,be)}if(ee)for(let Ge=0;Ge<4;Ge++){let Le=r.e9[Ge](Ue),tt=c.getTile(Le);if(!tt)continue;let xt=tt.getBucket(f);if(!xt||xt.projection.name!==de.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;let Dt=xt.groundEffect,_t,pt;Ge===0?(_t=[-r.al,0,0],pt=1):Ge===1?(_t=[r.al,0,0],pt=0):Ge===2?(_t=[0,-r.al,0],pt=3):(_t=[0,r.al,0],pt=2);let Ut=Dt.regionSegments[pt];if(!Ut)continue;let zt=new Float32Array(16);r.br(zt,Ue.projMatrix,_t),Be(Ue,Dt,Ut,o.translatePosMatrix(zt,Ye,ae,_e),be)}}}function nI(p,o,c,f,_,y,x){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let w=y?y.findDEMTileFor(c):null;if(!(w&&w.dem||x))return;y&&w&&w.dem&&f.selfDEMTileTimestamp!==w.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=w.dem._timestamp);let S=q=>new r.P(Math.ceil((q+r.ed)*r.ee),0),M=q=>{let ee=o.getSource().minzoom,re=ge=>{let de=o.getTileByID(ge);if(de&&de.hasData())return de.getBucket(_)},te=[0,-1,1];for(let ge of te){if(q.overscaledZ+ge<ee)continue;let de=re(q.calculateScaledKey(q.overscaledZ+ge));if(de)return de}},A=[0,0,0],L=(q,ee)=>(A[0]=Math.min(q.min.y,ee.min.y),A[1]=Math.max(q.max.y,ee.max.y),A[2]=r.al-ee.min.x>q.max.x?ee.min.x-r.al:q.max.x,A),F=(q,ee)=>(A[0]=Math.min(q.min.x,ee.min.x),A[1]=Math.max(q.max.x,ee.max.x),A[2]=r.al-ee.min.y>q.max.y?ee.min.y-r.al:q.max.y,A),N=[(q,ee)=>L(q,ee),(q,ee)=>L(ee,q),(q,ee)=>F(q,ee),(q,ee)=>F(ee,q)],j=(q,ee,re,te,ge,de,fe)=>{if(!y)return 0;let ue=[[de?re:q,de?q:re,0],[de?re:ee,de?ee:re,0]],ae=fe<0?r.al+fe:fe,_e=[de?ae:(q+ee)/2,de?(q+ee)/2:ae,0];return re===0&&fe<0||re!==0&&fe>0?y.getForTilePoints(ge,[_e],!0,te):ue.push(_e),y.getForTilePoints(c,ue,!0,w),Math.max(ue[0][2],ue[1][2],_e[2])/y.exaggeration()};for(let q=0;q<4;q++){let ee=f.borderFeatureIndices[q];if(ee.length===0)continue;let re=r.e9[q](c),te=M(re);if(!(te&&te instanceof r.ea))continue;let ge=y?y.findDEMTileFor(re):null;if(!(ge&&ge.dem||x)||(y&&ge&&ge.dem&&f.borderDEMTileTimestamp[q]!==ge.dem._timestamp&&(f.borderDoneWithNeighborZ[q]=-1,f.borderDEMTileTimestamp[q]=ge.dem._timestamp),f.borderDoneWithNeighborZ[q]===te.canonical.z))continue;te.centroidVertexArray.length===0&&te.createCentroidsBuffer();let de=(q<2?1:5)-q,fe=te.borderDoneWithNeighborZ[de]!==f.canonical.z,ue=te.borderFeatureIndices[de],ae=0;if(f.canonical.z!==te.canonical.z){for(let _e of ee)f.showCentroid(f.featuresOnBorder[_e]);if(fe)for(let _e of ue)te.showCentroid(te.featuresOnBorder[_e]);f.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[de]=f.canonical.z}for(let _e of ee){let Te=f.featuresOnBorder[_e],Ce=f.centroidData[Te.centroidDataIndex],Be=Te.borders[q],Ue;for(;ae<ue.length;){Ue=te.featuresOnBorder[ue[ae]];let Ye=Ue.borders[de];if(Ye[1]>Be[0]+3||Ye[0]>Be[0]-3)break;te.showCentroid(Ue),ae++}if(Ue&&ae<ue.length){let Ye=ae,dt=0;for(;!(Ue.borders[de][0]>Be[1]-3)&&(dt++,++ae!==ue.length);)Ue=te.featuresOnBorder[ue[ae]];Ue=te.featuresOnBorder[ue[Ye]];let Fe=!1;if(dt>=1){let Le=Ue.borders[de];Math.abs(Be[0]-Le[0])<3&&Math.abs(Be[1]-Le[1])<3&&(dt=1,Fe=!0,ae=Ye+1)}else if(dt===0){f.showCentroid(Te);continue}let be=te.centroidData[Ue.centroidDataIndex];x&&Fe&&(((U=Ce).flags|(W=be).flags)&r.ec?(U.flags|=r.ec,W.flags|=r.ec):(U.flags&=~r.ec,W.flags&=~r.ec));let Ge=Te.intersectsCount()>1||Ue.intersectsCount()>1;if(dt>1)ae=Ye,Ce.centroidXY=be.centroidXY=new r.P(0,0);else if(ge&&ge.dem&&!Ge){let Le=N[q](Ce,be),tt=q%2?r.al-1:0,xt=j(Le[0],Math.min(r.al-1,Le[1]),tt,ge,re,q<2,Le[2]);Ce.centroidXY=be.centroidXY=S(xt)}else Ge?Ce.centroidXY=be.centroidXY=new r.P(0,0):(Ce.centroidXY=f.encodeBorderCentroid(Te),be.centroidXY=te.encodeBorderCentroid(Ue));f.writeCentroidToBuffer(Ce),te.writeCentroidToBuffer(be)}else f.showCentroid(Te)}f.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[de]=f.canonical.z}var U,W;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}let Vs=[1,0,0],l0=[0,1,0],ms=[0,0,1];function ic(p,o,c){let f=c.transform,_=c.shadowRenderer;if(!_)return!0;let y=p.toUnwrapped(),x=f.tileSize*_._cascades[c.currentShadowCascade].scale,w=o;if(f.elevation){let U=f.elevation.getMinMaxForTile(p);U&&(w+=U.max)}let S=[..._.shadowDirection];S[2]=-S[2];let M=_.computeSimplifiedTileShadowVolume(y,w,x,S);if(!M)return!1;let A=[Vs,l0,ms,S,[S[0],0,S[2]],[0,S[1],S[2]]],L=f.projection.name==="globe",F=f.scaleZoom(x),N=r.cB.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!L),j=_.getCurrentCascadeFrustum();return N.intersectsPrecise(M.vertices,M.planes,A)===0||j.intersectsPrecise(M.vertices,M.planes,A)===0}function kp(p){let{painter:o,source:c,layer:f,coords:_}=p,y=p.defines,x=o.context,w=o.renderPass==="shadow",S=o.renderPass==="light-beam",M=o.shadowRenderer,A=r.ef(o.transform.center.lat,o.transform.zoom),L=Zc(o,f.paint.get("building-cutoff-fade-range"));L.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(let F of _){let N=c.getTile(F),j=N.getBucket(f);if(!j)continue;M&&M.getMaxCascadeForTile(F.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));let U=j.programConfigurations.get(f.id),W,q,ee,re=o.translatePosMatrix(F.expandedProjMatrix,N,[0,0],"map");if(re=r.cS(r.bC(),re,[1,1,p.verticalScale]),w&&M){if(ic(N.tileID,j.maxHeight*A,o))continue;let ge=M.calculateShadowPassMatrixFromTile(N.tileID.toUnwrapped());ge=r.cS(r.bC(),ge,[1,1,p.verticalScale]),ee=tu(ge),W=q=o.getOrCreateProgram("buildingDepth",{config:U,defines:y,overrideFog:!1})}else if(S)W=q=o.getOrCreateProgram("buildingBloom",{config:U,defines:y,overrideFog:!1}),ee=Yb(re);else{let ge=o.transform.calculatePosMatrix(F.toUnwrapped(),o.transform.worldSize);r.cS(ge,ge,[1,1,p.verticalScale]);let de=r.bC();r.cS(de,ge,[1,-1,1/A]),r.bl(de,de),r.eg(de,de);let fe=o.transform.getFreeCameraOptions().position,ue=1<<F.canonical.z;if(ee=Bm(re,de,p.opacity,p.facadeAOIntensity,[((fe.x-F.wrap)*ue-F.canonical.x)*r.al,(fe.y*ue-F.canonical.y)*r.al,fe.z*ue*r.al],j.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),q=o.getOrCreateProgram("building",{config:U,defines:y,overrideFog:!1}),p.depthOnly===!0)W=q;else{let ae=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);W=o.getOrCreateProgram("building",{config:U,defines:ae,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(ge,q,!0),W!==q&&M.setupShadowsFromMatrix(ge,W,!0))}let te=(ge,de)=>{if(S){let fe=ge.entranceBloom;de.draw(o,x.gl.TRIANGLES,p.depthMode,ln.disabled,p.blendMode,an.disabled,ee,f.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segmentsBucket,f.paint,o.transform.zoom,U,[fe.layoutAttenuationBuffer,fe.layoutColorBuffer])}else{let fe=ge.segmentsBucket,ue=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(ue=ue.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),de.draw(o,x.gl.TRIANGLES,p.depthMode,ln.disabled,p.blendMode,w?an.disabled:an.backCW,ee,f.id,ge.layoutVertexBuffer,ge.indexBuffer,fe,f.paint,o.transform.zoom,U,ue)}};o.uploadCommonUniforms(x,q,F.toUnwrapped(),null,L),j.buildingWithoutFacade&&te(j.buildingWithoutFacade,q),j.buildingWithFacade&&(W!==q&&o.uploadCommonUniforms(x,W,F.toUnwrapped(),null,L),te(j.buildingWithFacade,W))}}function Wm(p,o,c,f,_,y,x,w,S,M,A,L,F){let N=p.context.gl,j=p.depthModeForSublayer(1,Gt.ReadOnly,N.LEQUAL,!0),U=.1*(1-(W=A))+3*W;var W;let q=p._showOverdrawInspector,ee=L,re=new a0;q||nc(re,p,o,c,f,j,new ln({func:N.ALWAYS,mask:255},255,255,N.KEEP,N.KEEP,N.REPLACE),new yn([N.ONE,N.ONE,N.ONE,N.ONE],r.ao.transparent,[!1,!1,!1,!0],N.MIN),an.disabled,_,"sdf",y,x,w,S,M,U,ee,!1);{let te=q?ln.disabled:new ln({func:N.EQUAL,mask:255},255,255,N.KEEP,N.DECR,N.DECR),ge=q?p.colorModeForRenderPass():new yn([N.ONE_MINUS_DST_ALPHA,N.DST_ALPHA,N.ONE,N.ONE],r.ao.transparent,[!0,!0,!0,!0]);nc(re,p,o,c,f,j,te,ge,an.disabled,_,"color",y,x,w,S,M,U,ee,!1)}}function Zm(p){return[p[0]*r.eh,p[1]*r.eh,p[2]*r.eh,0]}function Fp(p,o,c,f,_,y,x,w,S){let M=f.getSource(),A=c.globeSharedBuffers;if(!A)return;let L,F,N;if(o&&(L=f.getTile(o)),M instanceof r.aU?(F=M.texture,N=r.dK(0,0,c.transform)):L&&o&&(F=L.texture,N=r.dK(o.canonical.z,o.canonical.x,c.transform)),!F||!N)return;p||(N=r.cS(r.bC(),N,[1,-1,1]));let j=c.context,U=j.gl,W=_.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,q=c.colorModeForDrapableLayerRenderPass(y),ee=x.defines;ee.push("GLOBE_POLES");let re=new Gt(U.LEQUAL,Gt.ReadWrite,c.depthRangeFor3D),te=Float32Array.from(c.transform.expandedFarZProjMatrix),ge=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),F.bind(W,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),F.bind(W,U.CLAMP_TO_EDGE),"useMipmap"in F&&j.extTextureFilterAnisotropic&&c.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);let[de,fe,ue,ae]=o?A.getPoleBuffers(o.canonical.z,!1):A.getPoleBuffers(0,!0),_e=_.paint.get("raster-elevation"),Te;p?(Te=de,c.renderDefaultNorthPole=_e!==0):(Te=fe,c.renderDefaultSouthPole=_e!==0);let Ce=Zm(x.mix),Be=((Ye,dt,Fe,be,Ge,Le,tt,xt,Dt,_t,pt,Ut,zt)=>Qb(Ye,dt,Fe,new Float32Array(16),new Float32Array(9),[0,0],be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Le,[0,0],xt,2,_t,pt,Ut,1,0,zt))(te,ge,N,r.aj(c.transform.zoom),0,_,0,_e,0,Ce,x.offset,x.range,y),Ue=c.getOrCreateProgram("raster",{defines:ee});c.uploadCommonUniforms(j,Ue,null),Ue.draw(c,U.TRIANGLES,re,S,q,w,Be,_.id,Te,ue,ae)}function o1(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}function rc(p,o,c,f){if(p)return o instanceof ss&&p instanceof am?o.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Zm(f.mix),offset:f.offset,buffer:0,tileSize:1}}var Vi=r.ei([{name:"a_index",type:"Int16",components:1}]);class Ym{constructor(o,c,f,_){let y={width:f[0],height:f[1],data:null},x=o.gl;this.targetColorTexture=new r.T(o,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(o,y,x.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(c,_),this.lastInvalidatedAt=0}updateParticleTexture(o,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,_=c.width*c.height;this.particleTexture0=new r.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1});let y=new r.ej;y.reserve(_);for(let x=0;x<_;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Vi.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function c0(p,o,c){if(!p)return null;let f=o.getTextureDescriptor(p,c,!0);if(!f)return null;let{texture:_,mix:y,offset:x,tileSize:w,buffer:S,format:M}=f;if(!_||!M)return null;let A=!1;return M==="uint32"&&(A=!0,y[3]=0,y=Vm(r.ek,y,[0,c.paint.get("raster-particle-max-speed")]),x=Um(r.ek,x,[0,c.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[S/(w+2*S),w/(w+2*S)],tileSize:w,scalarData:A,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function s1(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}let a1=new r.ao(1,0,0,1),l1=new r.ao(0,1,0,1),c1=new r.ao(0,0,1,1),ld=new r.ao(1,0,1,1),cd=new r.ao(0,1,1,1);function gt(p,o,c,f,_,y){for(let x=0;x<c.length;x++)if(_){let M=new r.ao(f.r*.8,f.g*.8,f.b*.8,1);Ct(p,o,c[x],f,-1,-1,y),Ct(p,o,c[x],f,-1,1,y),Ct(p,o,c[x],f,1,1,y),Ct(p,o,c[x],f,1,-1,y),Ct(p,o,c[x],M,0,0,y)}else Ct(p,o,c[x],f,0,0,y)}function Ct(p,o,c,f,_,y,x){let w=p.context,S=p.transform,M=w.gl,A=S.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],F=r.bz(c.projMatrix);if(A&&r.aj(S.zoom)>0){let Ce=r.bj(c.canonical,S),Be=r.el(Ce);F=r.aB(new Float32Array(16),S.globeMatrix,Be),r.aB(F,S.projMatrix,F)}let N=r.bC();N[12]+=2*_/(r.o.devicePixelRatio*S.width),N[13]+=2*y/(r.o.devicePixelRatio*S.height),r.aB(F,N,F);let j=p.getOrCreateProgram("debug",{defines:L}),U=o.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(U,j);let W=Gt.disabled,q=ln.disabled,ee=p.colorModeForRenderPass(),re="$debug";w.activeTexture.set(M.TEXTURE0),p.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),A?U._makeGlobeTileDebugBuffers(p.context,S):U._makeDebugTileBoundsBuffers(p.context,S.projection);let te=U._tileDebugBuffer||p.debugBuffer,ge=U._tileDebugIndexBuffer||p.debugIndexBuffer,de=U._tileDebugSegments||p.debugSegments;if(j.draw(p,M.LINE_STRIP,W,q,ee,an.disabled,Dp(F,f.toPremultipliedRenderColor(null)),re,te,ge,de,null,null,null,[U._globeTileDebugBorderBuffer]),x){let Ce=U.latestRawTileData,Be=Math.floor((Ce&&Ce.byteLength||0)/1024),Ue=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ue+=` => ${c.overscaledZ}`),Ue+=` ${U.state}`,Ue+=` ${Be}kb`,(function(Ye,dt){Ye.initDebugOverlayCanvas();let Fe=Ye.debugOverlayCanvas,be=Ye.context.gl,Ge=Ye.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Fe.width,Fe.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(dt,5,5),Ge.strokeText(dt,5,5),Ye.debugOverlayTexture.update(Fe),Ye.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)})(p,Ue)}let fe=o.getTile(c).tileSize,ue=512/Math.min(fe,512)*(c.overscaledZ/S.zoom)*.5,ae=U._tileDebugTextBuffer||p.debugBuffer,_e=U._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Te=U._tileDebugTextSegments||p.debugSegments;j.draw(p,M.TRIANGLES,W,q,yn.alphaBlended,an.disabled,Dp(F,r.ao.transparent.toPremultipliedRenderColor(null),ue),re,ae,_e,Te,null,null,null,[U._globeTileDebugTextBuffer])}function ud(p,o,c,f){Oe(p,0,o+c/2,p.transform.width,c,f)}function gr(p,o,c,f){Oe(p,o-c/2,0,c,p.transform.height,f)}function Oe(p,o,c,f,_,y){let x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(o*r.o.devicePixelRatio,c*r.o.devicePixelRatio,f*r.o.devicePixelRatio,_*r.o.devicePixelRatio),x.clear({color:y}),w.disable(w.SCISSOR_TEST)}let u1=r.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Xm}=u1;function Cl(p,o,c,f){p.emplaceBack(o,c,f)}class Km{constructor(o){this.vertexArray=new r.em,this.indices=new r.b0,Cl(this.vertexArray,-1,-1,1),Cl(this.vertexArray,1,-1,1),Cl(this.vertexArray,-1,1,1),Cl(this.vertexArray,1,1,1),Cl(this.vertexArray,-1,-1,-1),Cl(this.vertexArray,1,-1,-1),Cl(this.vertexArray,-1,1,-1),Cl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Xm),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function dd(p,o,c,f,_,y){let x=p.context.gl,w=o.paint.get("sky-atmosphere-color"),S=o.paint.get("sky-atmosphere-halo-color"),M=o.paint.get("sky-atmosphere-sun-intensity"),A=((L,F,N,j,U)=>({u_matrix_3f:L,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(r.eo(r.dO(),f),_,M,w.toPremultipliedRenderColor(null),S.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,o.skyboxTexture,0),c.draw(p,x.TRIANGLES,Gt.disabled,ln.disabled,yn.unblended,an.frontCW,A,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let d1=r.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ah{constructor(o){let c=new r.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let f=new r.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,d1.members),this.indexBuffer=o.createIndexBuffer(f),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let iI=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class rI{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class h1{constructor(o){this.colorModeAlphaBlendedWriteRGB=new yn([1,yl,1,yl],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yn([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new rI,this.updateNeeded=!0}update(o){let c=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ah(c);let f=this.params.sizeRange,_=this.params.intensityRange,y=(function(A){let L=r.eq(30),F=[];for(let N=0;N<A;++N){let j=2*Math.PI*L(),U=Math.acos(1-2*L())-.5*Math.PI;F.push(r.d5(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return F})(this.params.starsCount),x=r.eq(300),w=new r.er,S=new r.b0,M=0;for(let A=0;A<y.length;++A){let L=r.c5([],y[A],200),F=Math.max(0,1+.01*f*(1*x()-.5)),N=Math.max(0,1+.01*_*(1*x()-.5));w.emplaceBack(L[0],L[1],L[2],-1,-1,F,N),w.emplaceBack(L[0],L[1],L[2],1,-1,F,N),w.emplaceBack(L[0],L[1],L[2],1,1,F,N),w.emplaceBack(L[0],L[1],L[2],-1,1,F,N),S.emplaceBack(M+0,M+1,M+2),S.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(w,iI.members),this.starsIdx=c.createIndexBuffer(S),this.starsSegments=r.bg.simpleSegment(0,0,w.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,c){let f=o.context,_=f.gl,y=o.transform,x=new Gt(_.LEQUAL,Gt.ReadOnly,[0,1]),w=r.aj(y.zoom),S=o.style.getLut(c.scope),M=c.properties.get("color-use-theme")==="none",A=c.properties.get("color").toNonPremultipliedRenderColor(M?null:S),L=c.properties.get("high-color-use-theme")==="none",F=c.properties.get("high-color").toNonPremultipliedRenderColor(L?null:S),N=c.properties.get("space-color-use-theme")==="none",j=c.properties.get("space-color").toNonPremultipliedRenderColor(N?null:S),U=5e-4,W=r.es(c.properties.get("horizon-blend"),0,1,U,.25),q=r.dE(o,f,y)&&W===U?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ee=o.frameCounter/1e3%1,re=r.ag(y.globeCenterInViewSpace),te=Math.sqrt(Math.pow(re,2)-Math.pow(q,2)),ge=Math.acos(te/re),de=fe=>{let ue=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&ue.push("ALPHA_PASS");let ae=o.getOrCreateProgram("globeAtmosphere",{defines:ue}),_e=((Ce,Be,Ue,Ye,dt,Fe,be,Ge,Le,tt,xt,Dt)=>({u_frustum_tl:Ce,u_frustum_tr:Be,u_frustum_br:Ue,u_frustum_bl:Ye,u_horizon:dt,u_transition:Fe,u_fadeout_range:be,u_atmosphere_fog_color:Ge.toArray01(),u_high_color:Le.toArray01(),u_space_color:tt.toArray01(),u_temporal_offset:xt,u_horizon_angle:Dt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,w,W,A,F,j,ee,ge);o.uploadCommonUniforms(f,ae);let Te=this.atmosphereBuffer;Te&&ae.draw(o,_.TRIANGLES,x,ln.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,an.backCW,_e,fe?"atmosphere_glow_alpha":"atmosphere_glow",Te.vertexBuffer,Te.indexBuffer,Te.segments)};de(!1),de(!0)}drawStars(o,c){let f=r.aA(c.properties.get("star-intensity"),0,1);if(f===0)return;let _=o.context,y=_.gl,x=o.transform,w=o.getOrCreateProgram("stars"),S=r.c7([]);r.c9(S,S,-x._pitch),r.c8(S,S,-x.angle),r.c9(S,S,r.an(x._center.lat)),r.et(S,S,-r.an(x._center.lng));let M=r.cc(new Float32Array(16),S),A=r.aB([],x.starsProjMatrix,M),L=r.eo([],M),F=r.eu([],L),N=[0,1,0];r.dQ(N,N,F),r.c5(N,N,this.params.sizeMultiplier);let j=[1,0,0];r.dQ(j,j,F),r.c5(j,j,this.params.sizeMultiplier);let U=(W=N,q=j,ee=f,{u_matrix:Float32Array.from(A),u_up:W,u_right:q,u_intensity_multiplier:ee});var W,q,ee;o.uploadCommonUniforms(_,w),this.starsVx&&this.starsIdx&&w.draw(o,y.TRIANGLES,Gt.disabled,ln.disabled,this.colorModeAlphaBlendedWriteRGB,an.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Qm{constructor(){this.visibleTiles=[]}updateBorders(o,c){let f=[],_=[],y=o._getRenderableCoordinates(!1,!0);for(let S of y){let M=o.getTile(S);if(!M.hasData())continue;let A=M.getBucket(c);A&&(A.isEmpty()||(f.push(S.key),_.push({bucket:A,tileID:S.canonical})))}let x=f.length!==this.visibleTiles.length;if(!x){f.sort();for(let S=0;S<f.length;S++)if(f[S]!==this.visibleTiles[S]){x=!0;break}}if(!x)return;let w=new Set;this.visibleTiles=f,_.sort((S,M)=>S.tileID.z-M.tileID.z||S.tileID.x-M.tileID.x||S.tileID.y-M.tileID.y);for(let S of _){let M=new Array,A=new Array,L=S.bucket;for(let F of L.featuresOnBorder)w.has(F.featureId)?A.push(F.footprintIndex):(w.add(F.featureId),M.push(F.footprintIndex));L.updateFootprintHiddenFlags(M,r.ev,!1),L.updateFootprintHiddenFlags(A,r.ev,!0)}}}function Jm(p,o){let c=[...p],f=o.cameraWorldSizeForFog/o.worldSize,_=r.bA([]);return r.cS(_,_,[f,f,1]),r.aB(c,_,c),r.aB(c,o.worldToFogMatrix,c),c}function eg(p,o,c,f,_){let y=c.material,x=f.context,{baseColorTexture:w,metallicRoughnessTexture:S}=y.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:A,emissionTexture:L}=y;function F(j,U,W){if(j&&(p.push(U),x.activeTexture.set(x.gl.TEXTURE0+W),j.gfxTexture)){let{minFilter:q,magFilter:ee,wrapS:re,wrapT:te}=j.sampler;j.gfxTexture.bindExtraParam(q,ee,re,te)}}F(w,"HAS_TEXTURE_u_baseColorTexture",Co.BaseColor),F(S,"HAS_TEXTURE_u_metallicRoughnessTexture",Co.MetallicRoughness),F(M,"HAS_TEXTURE_u_normalTexture",Co.Normal),F(A,"HAS_TEXTURE_u_occlusionTexture",Co.Occlusion),F(L,"HAS_TEXTURE_u_emissionTexture",Co.Emission),_&&(_.texture||(_.texture=new r.d$(f.context,_.image,[_.image.height,_.image.height,_.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Co.LUT),_.texture&&_.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(c.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||p.push("DIFFUSE_SHADED");let N=f.shadowRenderer;N&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&p.push("NORMAL_OFFSET"))}function tg(p,o,c,f,_,y){let x=p.modelOpacity,w=o.context,S=new Gt(o.context.gl.LEQUAL,p.isLightMesh?Gt.ReadOnly:Gt.ReadWrite,o.depthRangeFor3D),M=o.transform,A=p.mesh,L=A.material,F=L.pbrMetallicRoughness,N=o.style.fog,j;j=o.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.aB([],f.zScaleMatrix,p.nodeModelMatrix),r.aB(j,f.negCameraPosMatrix,j);let U=r.bl([],j);r.eg(U,U);let W=c.paint.get("model-color-use-theme").constantOr("default")==="none",q=c.paint.get("model-emissive-strength").constantOr(0),ee=sd(new Float32Array(p.worldViewProjection),new Float32Array(j),new Float32Array(U),null,o,x,F.baseColorFactor,L.emissiveFactor,F.metallicFactor,F.roughnessFactor,L,q,c,void 0,void 0,p.materialOverride,p.modelColor),re={defines:[]},te=[],ge=o.shadowRenderer;ge&&(ge.useNormalOffset=!1),eg(re.defines,te,A,o,W?null:c.lut);let de=null;if(N){let ae=Jm(p.nodeModelMatrix,o.transform);if(de=new Float32Array(ae),M.projection.name!=="globe"){let _e=A.aabb.min,Te=A.aabb.max,[Ce,Be]=N.getOpacityForBounds(ae,_e[0],_e[1],Te[0],Te[1]);re.overrideFog=Ce>=Xe||Be>=Xe}}let fe=Zc(o,c.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ue=o.getOrCreateProgram("model",re);o.uploadCommonUniforms(w,ue,null,de,fe),o.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(p.nodeModelMatrix,ue),ue.draw(o,w.gl.TRIANGLES,S,_,y,A.material.doubleSided?an.disabled:an.backCCW,ee,c.id,A.vertexBuffer,A.indexBuffer,A.segments,c.paint,o.transform.zoom,void 0,te)}function Lp(p,o){return p.style._importedAsBasemap?"basemap":o.scope}function hd(p,o,c,f,_,y,x,w,S,M){let A=p.transform,L=!!o.isGeometryBloom&&o.isGeometryBloom;if(L&&p.renderPass==="shadow")return;let F=A.projection.name==="globe"?r.eD(c,A):[...c];r.aB(F,F,o.globalMatrix);let N=r.aB([],f,F);if(o.meshes)for(let j of o.meshes){let U=w.get(j.material.name);if(U&&U.opacity<=0)continue;if(j.material.alphaMode!=="BLEND"){x.push({mesh:j,depth:0,modelIndex:_,worldViewProjection:N,nodeModelMatrix:F,isLightMesh:L,materialOverride:U,modelOpacity:S,modelColor:M});continue}let W=r.af([],j.centroid,N);!A.isOrthographic&&W[2]<=0||y.push({mesh:j,depth:W[2],modelIndex:_,worldViewProjection:N,nodeModelMatrix:F,isLightMesh:L,materialOverride:U,modelOpacity:S,modelColor:M})}if(o.children)for(let j of o.children)hd(p,j,c,f,_,y,x,w,S,M)}function Xa(p,o,c,f){let _=c.shadowRenderer;if(!_)return;let y=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode(),w=_.calculateShadowPassMatrixFromMatrix(o),S=r0(w);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,y,ln.disabled,x,an.disabled,S,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,c.transform.zoom,void 0,void 0)}function p1(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={orientation:p.paint.get("model-rotation").evaluate(S,c)};y.set(x,M)}}function f1(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={color:p.paint.get("model-color").evaluate(S,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(S,c),opacity:p.paint.get("model-opacity").evaluate(S,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(S,c)};y.set(x,M)}}function m1(p,o,c,f,_){let y=!1;for(let w of f)w.modelOpacity!==1&&(tg(w,p,o,_[w.modelIndex],ln.disabled,yn.disabled),y=!0);for(let w of f)tg(w,p,o,_[w.modelIndex],w.modelOpacity!==1?p.stencilModeFor3D():ln.disabled,p.colorModeForRenderPass());y&&p.resetStencilClippingMasks();let x=yn.additive;for(let w of c)tg(w,p,o,_[w.modelIndex],ln.disabled,w.isLightMesh?x:p.colorModeForRenderPass())}function g1(p,o,c){let f=o.updateZoomBasedPaintProperties(),_=(function(y,x,w){let S,M,A,L=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&L>0){let F=y.terrain,N=F.findDEMTileFor(w);N&&N.dem?S=r.eF.create(F,w,N):L=0}if(L===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),L===x.validForExaggeration&&(L===0||S&&S._demTile&&S._demTile.tileID===x.validForDEMTile.id&&S._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let F in x.instancesPerModel){let N=x.instancesPerModel[F];for(let j=0;j<N.instancedDataArray.length;++j){let U=(S?L*S.getElevationAt(0|N.instancedDataArray.float32[16*j],0|N.instancedDataArray.float32[16*j+1],!0,!0):0)+N.instancesEvaluatedElevation[j];N.instancedDataArray.float32[16*j+6]=U,M=M?Math.min(x.terrainElevationMin,U):U,A=A?Math.max(x.terrainElevationMax,U):U}}return x.terrainElevationMin=M||0,x.terrainElevationMax=A||0,x.validForExaggeration=L,x.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,o,c);(f||_)&&(o.uploaded=!1,o.upload(p.context))}let El={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d9([0,0,0],[r.al,r.al,0])};function gs(p,o){let c=1<<p.canonical.z,f=o.getFreeCameraOptions().position,_=o.elevation,y=p.canonical.x/c,x=(p.canonical.x+1)/c,w=p.canonical.y/c,S=(p.canonical.y+1)/c,M=o._centerAltitude;if(_){let N=_.getMinMaxForTile(p);N&&N.max>M&&(M=N.max)}let A=r.aA(f.x,y,x)-f.x,L=r.aA(f.y,w,S)-f.y,F=r.cf(M,o.center.lat)-f.z;return o._zoomFromMercatorZ(Math.sqrt(A*A+L*L+F*F))}function _1(p,o,c,f,_,y,x){let w=p.context,S=p.renderPass==="shadow",M=p.shadowRenderer,A=S&&M?M.getShadowPassDepthMode():new Gt(w.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),L=p.isTileAffectedByFog(y),F=p.transform.projection.name==="globe";if(c.meshes)for(let N of c.meshes){let j=F?[]:["MODEL_POSITION_ON_GPU"],U=[],W,q,ee,re=!F&&f.instancedDataArray.length>20;re&&j.push("INSTANCED_ARRAYS");let te=Zc(p,o.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),S&&M)W=p.getOrCreateProgram("modelDepth",{defines:j}),q=r0(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(c.globalMatrix)),ee=M.getShadowPassColorMode();else{eg(j,U,N,p,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),W=p.getOrCreateProgram("model",{defines:j,overrideFog:L});let de=N.material,fe=de.pbrMetallicRoughness,ue=o.paint.get("model-opacity").constantOr(1),ae=o.paint.get("model-emissive-strength").constantOr(0);q=sd(y.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,ue,fe.baseColorFactor,de.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,de,ae,o,_),M&&(x.shadowUniformsInitialized?W.setShadowUniformValues(w,M.getShadowUniformValues()):(M.setupShadows(y.toUnwrapped(),W,"model-tile"),x.shadowUniformsInitialized=!0)),ee=te.shouldRenderCutoff||ue<1||de.alphaMode!=="OPAQUE"?yn.alphaBlended:yn.unblended}p.uploadCommonUniforms(w,W,y.toUnwrapped(),null,te);let ge=N.material.doubleSided?an.disabled:an.backCCW;if(re)U.push(f.instancedDataBuffer),W.draw(p,w.gl.TRIANGLES,A,ln.disabled,ee,ge,q,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,p.transform.zoom,void 0,U,f.instancedDataArray.length);else{let de=S?"u_instance":"u_normal_matrix";for(let fe=0;fe<f.instancedDataArray.length;++fe)q[de]=new Float32Array(f.instancedDataArray.arrayBuffer,64*fe,16),W.draw(p,w.gl.TRIANGLES,A,ln.disabled,ee,ge,q,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,p.transform.zoom,void 0,U)}}if(c.children)for(let N of c.children)_1(p,o,N,f,_,y,x)}let Np=[1,-1,1];function oI(p,o,c,f){if(!c.modelManager)return!0;let _=c.modelManager;if(!c.shadowRenderer)return!0;let y=c.shadowRenderer,x=o.aabb,w=!0,S=p.maxHeight;if(S===0){let A=0;for(let L in p.instancesPerModel){let F=_.getModel(L,f);F?A=Math.max(A,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):w=!1}S=p.maxScale*A*1.41+p.maxVerticalOffset,w&&(p.maxHeight=S)}x.max[2]=S,x.min[2]+=p.terrainElevationMin,x.max[2]+=p.terrainElevationMax,r.af(x.min,x.min,o.tileMatrix),r.af(x.max,x.max,o.tileMatrix);let M=x.intersects(y.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=M===2),M===0}function Xi(p,o){let c=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],_=p.uniformValues.u_cutoff_params[2],y=p.uniformValues.u_cutoff_params[3];return f===c||y===_?1:r.aA(((o-c)/(f-c)-_)/(y-_),0,1)}function An(p,o,c,f){if(o.pitch<20)return 1;let _=o.getWorldToCameraMatrix();r.aB(_,_,p);let y=r.bU(c.min[0],c.min[1],c.min[2],1),x=r.aC(r.eG(),y,_),w=x,S=x;y[1]=c.max[1],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[0]=c.max[0],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[1]=c.min[1],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S;let M=r.aA(f[0],0,1),A=100*o.pixelsPerMeter*r.aA(f[1],0,1),L=r.aA(f[2],0,1),F=r.eH(r.eG(),w,S,M),N=Math.tan(.5*o.fovX),j=-F[2]*N;if(A===0)return F[1]<-Math.abs(j)?L:1;let U=(-Math.abs(j)-F[1])/A,W=(ee,re,te)=>(1-te)*ee+te*re,q=r.aA(W(1,L,U),L,1);return W(1,q,r.aA((o.pitch-20)/20,0,1))}class v1{}class ru{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,c,f){{let L=this._storage.get(c.id);if(L)return L.lastUsedFrameIdx=o,L.buf}let _=f.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),x=new ArrayBuffer(y),w=new Int16Array(x);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let S=new r.eJ;for(let L=0;L<y/2;L+=3){let F=w[L],N=w[L+1],j=w[L+2];S.emplaceBack(F,N),S.emplaceBack(N,j),S.emplaceBack(j,F)}let M=f.bindVertexArrayOES.current,A=new v1;return A.buf=new Pp(f,S),A.lastUsedFrameIdx=o,this._storage.set(c.id,A),f.bindVertexArrayOES.set(M),A.buf}update(o){for(let[c,f]of this._storage)o-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(c))}destroy(){for(let[o,c]of this._storage)c.buf.destroy(),this._storage.delete(o)}}class lh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}let ch=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class oc{constructor(o){this.revealStart=11,this.revealRange=2}}let u0=r.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class d0{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,c){let f=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new r.eK,w=new r.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(x,u0.members),this.vignetteIdx=o.context.createIndexBuffer(w)}let _=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,f);let x={u_vignetteShape:(y={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};f.draw(o,o.context.gl.TRIANGLES,Gt.disabled,ln.disabled,yn.alphaBlended,an.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class h0{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,c){let f=o.getFreeCameraOptions().position,_=f.toAltitude(),y=f.toLngLat(),x=r.an(y.lng),w=r.an(y.lat),S=o.pixelsPerMeter/c,M=x*r.eM,A=r.eM*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let L=-this._offsetYPrev+A,F=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*S,this._accumulatedOffsetY+=L*S,this._accumulatedElevation+=F*S,this._offsetXPrev=M,this._offsetYPrev=A,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ng(p,o){return[-(p[0]-Math.floor(p[0]/o)*o),-(p[1]-Math.floor(p[1]/o)*o),-(p[2]-Math.floor(p[2]/o)*o)]}function ea(p){let o=r.eq(1323123451230),c=[];for(let f=0;f<p;++f){let _=2*o()-1,y=2*o()-1,x=2*o()-1;c.push(r.d5(_,y,x))}return c}function Ms(p,o,c,f,_){let y=r.aA((_-c)/(f-c),0,1);return(1-y)*p+y*o}class pd{constructor(o){this._movement=new h0,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new d0,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,c){let f=o.transform;this._movement.update(f,this._ppmScaleFactor);let _=f.starsProjMatrix,y=r.c7([]);r.c9(y,y,r.an(90)-f._pitch),r.c8(y,y,-f.angle);let x=r.cc(new Float32Array(16),y),w=r.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),S=r.eg([],w),M=r.aB([],S,x),A=Date.now()/1e3;return this._accumulatedTimeFromStart+=(A-this._prevTime)*c,this._prevTime=A,{projectionMatrix:_,modelviewMatrix:M}}}class ig extends pd{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new oc("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=ea(this.particlesCount),_=new r.eN,y=new r.b0,x=0,w=r.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=[2*w()-1,w(),w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,1,...A),_.emplaceBack(M[0],M[1],M[2],-1,1,...A),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,ch.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;let c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=o.transform.zoom;if(c.revealStart>f)return;let _=Ms(0,1,c.revealStart,c.revealStart+c.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;let y=structuredClone(this._params),x=[-y.direction.x,y.direction.y,-100];r.aw(x,x);let w=structuredClone(this._vignetteParams);w.strength*=_,y.overrideStyleParameters||(y.intensity=o.style.rain.state.density,y.timeFactor=o.style.rain.state.intensity,y.color=structuredClone(o.style.rain.state.color),x=structuredClone(o.style.rain.state.direction),y.screenThinning.intensity=o.style.rain.state.centerThinning,y.dropletSizeX=o.style.rain.state.dropletSize[0],y.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],y.distortionStrength=100*o.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(o.style.rain.state.vignetteColor));let S=this.updateOnRender(o,y.timeFactor),M=o.context,A=M.gl,L=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new r.T(M,{width:o.width,height:o.height,data:null},A.RGBA8)),y.distortionStrength>0&&(M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,o.width,o.height));let F=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(M,F),M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let N=[y.color.r,y.color.g,y.color.b,y.color.a],j=(U,W)=>{let q=ng(this._movement.getPosition(),U),ee=y.dropletSizeX,re=y.dropletSizeX*y.dropletSizeYScale,te=o.width/2,ge=o.height/2,de=Ms(0,y.screenThinning.start,0,1,y.screenThinning.intensity),fe=Ms(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),ue=Ms(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),ae=(_e={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:U,rainDropletSize:[ee,re],distortionStrength:y.distortionStrength,rainDirection:x,color:N,screenSize:[L.width,L.height],thinningCenterPos:[te,ge],thinningShape:[de,fe,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:W?0:1},{u_modelview:Float32Array.from(_e.modelview),u_projection:Float32Array.from(_e.projection),u_time:_e.time,u_cam_pos:_e.camPos,u_texScreen:0,u_velocityConeAperture:_e.velocityConeAperture,u_velocity:_e.velocity,u_boxSize:_e.boxSize,u_rainDropletSize:_e.rainDropletSize,u_distortionStrength:_e.distortionStrength,u_rainDirection:_e.rainDirection,u_color:_e.color,u_screenSize:_e.screenSize,u_thinningCenterPos:_e.thinningCenterPos,u_thinningShape:_e.thinningShape,u_thinningAffectedRatio:_e.thinningAffectedRatio,u_thinningParticleOffset:_e.thinningParticleOffset,u_shapeDirectionalPower:_e.shapeDirectionalPower,u_shapeNormalPower:_e.shapeNormalPower,u_mode:_e.mode});var _e;let Te=Math.round(y.intensity*this.particlesCount),Ce=r.bg.simpleSegment(0,0,4*Te,2*Te);F.draw(o,A.TRIANGLES,Gt.disabled,ln.disabled,yn.alphaBlended,an.disabled,ae,"rain_particles",this.particlesVx,this.particlesIdx,Ce)};y.distortionStrength>0&&j(y.boxSize,!0),j(y.boxSize,!1),this._vignette.draw(o,w)}}let p0=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class f0 extends pd{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new oc("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=ea(this.particlesCount),_=new r.eO,y=new r.b0,x=0,w=r.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=w(),L=w(),F=w(),N=[S/f.length,A,L,F],j=[w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...N,...j),_.emplaceBack(M[0],M[1],M[2],1,-1,...N,...j),_.emplaceBack(M[0],M[1],M[2],1,1,...N,...j),_.emplaceBack(M[0],M[1],M[2],-1,1,...N,...j),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,p0.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;let c=structuredClone(this._params),f=[-c.direction.x,c.direction.y,-100];r.aw(f,f);let _=structuredClone(this._vignetteParams),y=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=o.transform.zoom;if(y.revealStart>x)return;let w=Ms(0,1,y.revealStart,y.revealStart+y.revealRange,x);_.strength*=w,c.overrideStyleParameters||(c.intensity=o.style.snow.state.density,c.timeFactor=o.style.snow.state.intensity,c.color=structuredClone(o.style.snow.state.color),f=structuredClone(o.style.snow.state.direction),c.screenThinning.intensity=o.style.snow.state.centerThinning,c.billboardSize=2.79*o.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(o.style.snow.state.vignetteColor));let S=this.updateOnRender(o,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let M=o.context,A=M.gl,L=o.transform,F=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(M,F),((N,j,U)=>{let W=ng(this._movement.getPosition(),N),q=L.width/2,ee=L.height/2,re=Ms(0,U.screenThinning.start,0,1,U.screenThinning.intensity),te=Ms(.001,U.screenThinning.range,0,1,U.screenThinning.intensity),ge=Ms(0,U.screenThinning.particleOffset,0,1,U.screenThinning.intensity),de=(fe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:W,velocityConeAperture:U.velocityConeAperture,velocity:U.velocity,horizontalOscillationRadius:U.horizontalOscillationRadius,horizontalOscillationRate:U.horizontalOscillationRate,boxSize:N,billboardSize:1*U.billboardSize,simpleShapeParameters:[U.shapeFadeStart,U.shapeFadePower],screenSize:[L.width,L.height],thinningCenterPos:[q,ee],thinningShape:[re,te,Math.pow(10,U.screenThinning.fadePower)],thinningAffectedRatio:U.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[U.color.r,U.color.g,U.color.b,U.color.a],direction:f},{u_modelview:Float32Array.from(fe.modelview),u_projection:Float32Array.from(fe.projection),u_time:fe.time,u_cam_pos:fe.camPos,u_velocityConeAperture:fe.velocityConeAperture,u_velocity:fe.velocity,u_horizontalOscillationRadius:fe.horizontalOscillationRadius,u_horizontalOscillationRate:fe.horizontalOscillationRate,u_boxSize:fe.boxSize,u_billboardSize:fe.billboardSize,u_simpleShapeParameters:fe.simpleShapeParameters,u_screenSize:fe.screenSize,u_thinningCenterPos:fe.thinningCenterPos,u_thinningShape:fe.thinningShape,u_thinningAffectedRatio:fe.thinningAffectedRatio,u_thinningParticleOffset:fe.thinningParticleOffset,u_particleColor:fe.color,u_direction:fe.direction});var fe;let ue=Math.round(U.intensity*this.particlesCount),ae=r.bg.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&F.draw(o,A.TRIANGLES,Gt.disabled,ln.disabled,yn.alphaBlended,an.disabled,de,"snow_particles",this.particlesVx,this.particlesIdx,ae)})(c.boxSize,0,c),this._vignette.draw(o,_)}}let ou={symbol:function(p,o,c,f,_){if(p.renderPass!=="translucent")return;let y=ln.disabled,x=p.colorModeForRenderPass(),w=c.layout.get("text-variable-anchor"),S=c.layout.get("text-size-scale-range"),M=r.aA(p.scaleFactor,S[0],S[1]);w&&(function(F,N,j,U,W,q,ee,re){let te=N.transform,ge=W==="map",de=q==="map";for(let fe of F){let ue=U.getTile(fe),ae=ue.getBucket(j);if(!ae||!ae.text||!ae.text.segments.get().length)continue;let _e=r.bK(ae.textSizeData,te.zoom,re),Te=_l(fe,ae.getProjection(),te),Ce=te.calculatePixelsToTileUnitsMatrix(ue),Be=as(Te,ue.tileID.canonical,de,ge,te,ae.getProjection(),Ce),Ue=ae.hasIconTextFit()&&ae.hasIconData();_e&&en(ae,ge,de,ee,te,Be,fe,Math.pow(2,te.zoom-ue.tileID.overscaledZ),_e,Ue)}})(f,p,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_,M);let A=c.paint.get("icon-opacity").constantOr(1)!==0,L=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||L)?Rp(p,o,c,f,y,x):(A&&Rp(p,o,c,f,y,x,{onlyIcons:!0}),L&&Rp(p,o,c,f,y,x,{onlyText:!0})),o.map.showCollisionBoxes&&(Lt(p,o,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Lt(p,o,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("circle-opacity"),y=c.paint.get("circle-stroke-width"),x=c.paint.get("circle-stroke-opacity"),w=c.layout.get("circle-sort-key").constantOr(1)!==void 0,S=c.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let M=p.context,A=M.gl,L=p.transform,F=!(!p.terrain||!p.terrain.enabled),N=c.layout.get("circle-elevation-reference"),j=p.depthModeForSublayer(0,Gt.ReadOnly),U=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),W=N==="none"||F?j:U,q=ln.disabled,ee=p.colorModeForDrapableLayerRenderPass(S),re=L.projection.name==="globe",te=[r.aF(L.center.lng),r.aJ(L.center.lat)],ge=[];for(let fe=0;fe<f.length;fe++){let ue=f[fe],ae=o.getTile(ue),_e=ae.getBucket(c);if(!_e||_e.projection.name!==L.projection.name)continue;let Te=_e.programConfigurations.get(c.id),Ce=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,Ue=_e.indexBuffer,Ye=r.e0(c),dt=[Be],Fe=p.isTileAffectedByFog(ue);re&&Ye.push("PROJECTION_GLOBE_VIEW"),Ye.push("DEPTH_D24"),p.terrain&&L.depthOcclusionForSymbolsAndCircles&&Ye.push("DEPTH_OCCLUSION"),_e.hasElevation&&!p.terrain&&(Ye.push("ELEVATED_ROADS"),dt.push(_e.elevatedLayoutVertexBuffer));let be=p.getOrCreateProgram("circle",{config:Te,defines:Ye,overrideFog:Fe}),Ge=L.projection.createInversionMatrix(L,ue.canonical),Le={programConfiguration:Te,program:be,layoutVertexBuffer:Ce,dynamicBuffers:dt,indexBuffer:Ue,uniformValues:r.e1(p,ue,ae,Ge,te,c),tile:ae};if(w){let tt=_e.segments.get();for(let xt of tt)ge.push({segments:new r.bg([xt]),sortKey:xt.sortKey,state:Le})}else ge.push({segments:_e.segments,sortKey:0,state:Le})}w&&ge.sort((fe,ue)=>fe.sortKey-ue.sortKey);let de={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(let fe of ge){let{programConfiguration:ue,program:ae,layoutVertexBuffer:_e,dynamicBuffers:Te,indexBuffer:Ce,uniformValues:Be,tile:Ue}=fe.state,Ye=fe.segments;p.terrain&&p.terrain.setupElevationDraw(Ue,ae,de),p.uploadCommonUniforms(M,ae,Ue.tileID.toUnwrapped()),ae.draw(p,A.TRIANGLES,W,q,ee,an.disabled,Be,c.id,_e,Ce,Ye,c.paint,L.zoom,ue,Te)}},heatmap:function(p,o,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let _=p.context,y=_.gl,x=ln.disabled,w=new yn([y.ONE,y.ONE,y.ONE,y.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(N,j,U,W){let q=N.gl,ee=j.width*W,re=j.height*W;N.activeTexture.set(q.TEXTURE1),N.viewport.set([0,0,ee,re]);let te=U.heatmapFbo;if(!te||te&&(te.width!==ee||te.height!==re)){te&&te.destroy();let ge=q.createTexture();q.bindTexture(q.TEXTURE_2D,ge),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),te=U.heatmapFbo=N.createFramebuffer(ee,re,1,null),(function(de,fe,ue,ae,_e,Te){let Ce=de.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,_e,Te,0,Ce.RGBA,de.extRenderToTextureHalfFloat?Ce.HALF_FLOAT:Ce.UNSIGNED_BYTE,null),ae.colorAttachment0.set(ue)})(N,0,ge,te,ee,re)}else q.bindTexture(q.TEXTURE_2D,te.colorAttachment0.get()),N.bindFramebuffer.set(te.framebuffer)})(_,p,c,p.transform.projection.name==="globe"?.5:.25),_.clear({color:r.ao.transparent});let S=p.transform,M=S.projection.name==="globe",A=M?["PROJECTION_GLOBE_VIEW"]:[],L=M?an.frontCCW:an.disabled,F=[r.aF(S.center.lng),r.aJ(S.center.lat)];for(let N=0;N<f.length;N++){let j=f[N];if(o.hasRenderableParent(j))continue;let U=o.getTile(j),W=U.getBucket(c);if(!W||W.projection.name!==S.projection.name)continue;let q=p.isTileAffectedByFog(j),ee=W.programConfigurations.get(c.id),re=p.getOrCreateProgram("heatmap",{config:ee,defines:A,overrideFog:q}),{zoom:te}=p.transform;p.terrain&&p.terrain.setupElevationDraw(U,re),p.uploadCommonUniforms(_,re,j.toUnwrapped());let ge=S.projection.createInversionMatrix(S,j.canonical);re.draw(p,y.TRIANGLES,Gt.disabled,x,w,L,Kb(p,j,U,ge,F,te,c.paint.get("heatmap-intensity")),c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,p.transform.zoom,ee,M?[W.globeExtVertexBuffer]:null)}_.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(_,y){let x=_.context,w=x.gl,S=y.heatmapFbo;if(!S)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,S.colorAttachment0.get()),x.activeTexture.set(w.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new r.T(x,y.colorRamp,w.RGBA8)),M.bind(w.LINEAR,w.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,w.TRIANGLES,Gt.disabled,ln.disabled,_.colorModeForRenderPass(),an.disabled,((A,L,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)})(p,c))},line:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("line-opacity"),y=c.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;let x=c.paint.get("line-emissive-strength").isConstant(),w=c.paint.get("line-emissive-strength").constantOr(0),S=c.paint.get("line-occlusion-opacity"),M=c.layout.get("line-elevation-reference"),A=c.layout.get("line-width-unit")==="meters",L=M==="sea",F=!(!p.terrain||!p.terrain.enabled),N=p.context,j=N.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;let U=c.layout.get("line-cross-slope"),W=U!==void 0,q=U<1,ee=p.colorModeForDrapableLayerRenderPass(x?w:null),re=p.terrain&&p.terrain.renderingToTexture,te=re?1:r.o.devicePixelRatio,ge=c.paint.get("line-dasharray"),de=ge.constantOr(1),fe=c.layout.get("line-cap"),ue=ge.constantOr(null),ae=fe.constantOr(null),_e=c.paint.get("line-pattern"),Te=_e.constantOr(1),Ce=c.paint.get("line-pattern-cross-fade"),Be=_e.constantOr(null),Ue=c.paint.get("line-opacity").constantOr(1),Ye=!Te&&Ue!==1||p.depthOcclusion&&S>0&&S<1,dt=c.paint.get("line-gradient"),Fe=Te?"linePattern":"line",be=r.e2(c),Ge;if(re&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Ye=!1),S!==0&&p.depthOcclusion){let Dt=c.paint._values["line-opacity"];Dt&&Dt.value&&Dt.value.kind==="constant"?Ge=Dt.value:r.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&be.push("VARIABLE_LINE_WIDTH"),re&&(p.emissiveMode!=="dual-source-blending"||x?p.emissiveMode==="mrt-fallback"&&be.push("USE_MRT1"):be.push("DUAL_SOURCE_BLENDING"));let Le=(Dt,_t,pt,Ut,zt,Tt)=>{for(let Pt of Dt){let Jt=o.getTile(Pt);if(Te&&!Jt.patternsLoaded())continue;let fn=Jt.getBucket(c);if(!fn||fn.elevationType!=="none"&&!zt||fn.elevationType==="none"&&zt)continue;p.prepareDrawTile();let Fn=[..._t],Jn=p.shadowRenderer,jt=fn.elevationType==="road"&&!!Jn&&Jn.enabled,Yn=[0,0,0];if(jt){let wn=p.style.directionalLight,Hi=p.style.ambientLight;wn&&Hi&&(Yn=Jl(p.style,wn,Hi)),Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let pn=fn.programConfigurations.get(c.id),ii=!1;if(Be&&Jt.imageAtlas){let wn=r.e3.from(Be),Hi=wn.getPrimary().scaleSelf(te).toString(),wr=Jt.imageAtlas.patternPositions.get(Hi),ir=wn.getSecondary(),Si=ir?Jt.imageAtlas.patternPositions.get(ir.scaleSelf(te).toString()):null;ii=!!wr&&!!Si,wr&&pn.setConstantPatternPositions(wr,Si)}Ce>0&&(ii||pn.getPatternTransitionVertexBuffer("line-pattern"))&&Fn.push("LINE_PATTERN_TRANSITION");let mi=p.isTileAffectedByFog(Pt),di=p.getOrCreateProgram(Fe,{config:pn,defines:Fn,overrideFog:mi});if(!Te&&ue&&ae&&Jt.lineAtlas){let wn=Jt.lineAtlas.getDash(ue,ae);wn&&pn.setConstantPatternPositions(wn)}jt&&Jn.setupShadows(Jt.tileID.toUnwrapped(),di,"vector-tile");let[Wn,bn]=c.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&Wn!==bn&&(Wn===0&&(Wn-=1),bn===1&&(bn+=1));let ti=re?Pt.projMatrix:null,ur=A?1/fn.tileToMeter/r.ay(Jt,1,p.transform.zoom):1,Ki=A?1/fn.tileToMeter/r.ay(Jt,1,Math.floor(p.transform.zoom)):1,ri=Te?r.e4(p,Jt,c,ti,te,ur,Ki,[Wn,bn],Yn,Ce):r.e5(p,Jt,c,ti,fn.lineClipsArray.length,te,ur,Ki,[Wn,bn],Yn);if(dt){let wn=fn.gradients[c.id],Hi=wn.texture;if(c.gradientVersion!==wn.version){let wr=256;if(c.stepInterpolant){let ir=o.getSource().maxzoom,Si=Pt.canonical.z===ir?Math.ceil(1<<p.transform.maxZoom-Pt.canonical.z):1;wr=r.aA(r.e6(fn.maxLineLength/r.al*1024*Si),256,N.maxTextureSize)}wn.gradient=r.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:wr,image:wn.gradient||void 0,clips:fn.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new r.T(N,wn.gradient,j.RGBA8),wn.version=c.gradientVersion,Hi=wn.texture}N.activeTexture.set(j.TEXTURE1),Hi.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}de&&(N.activeTexture.set(j.TEXTURE0),Jt.lineAtlasTexture&&Jt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),pn.updatePaintBuffers()),Te&&(N.activeTexture.set(j.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),pn.updatePaintBuffers()),zt&&!L&&p.terrain.setupElevationDraw(Jt,di),p.uploadCommonUniforms(N,di,Pt.toUnwrapped());let $n=wn=>{Ge!=null&&(Ge.value=Ue*S),di.draw(p,j.TRIANGLES,pt,wn,ee,an.disabled,ri,c.id,fn.layoutVertexBuffer,fn.indexBuffer,fn.segments,c.paint,p.transform.zoom,pn,[fn.layoutVertexBuffer2,fn.patternVertexBuffer,fn.zOffsetVertexBuffer]),Ge!=null&&(Ge.value=Ue)};if(Ye&&!zt){let wn=p.stencilModeForClipping(Pt).ref;wn===0&&re&&N.clear({stencil:0});let Hi={func:j.EQUAL,mask:255};ri.u_alpha_discard_threshold=.8,$n(new ln(Hi,wn,255,j.KEEP,j.KEEP,j.INVERT)),ri.u_alpha_discard_threshold=0,$n(new ln(Hi,wn,255,j.KEEP,j.KEEP,j.KEEP))}else ri.u_alpha_discard_threshold=Ye&&zt&&Tt?.8:0,$n(zt?Ut:p.stencilModeForClipping(Pt))}},tt=p.depthModeForSublayer(0,Gt.ReadOnly),xt=new Gt(p.depthOcclusion?j.GREATER:j.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){let Dt=!re&&p.terrain;S!==0&&Dt?r.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Dt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Le(f,be,tt,ln.disabled,!1,!0)}if(c.hasElevatedBuckets){M==="hd-road-markup"?F||(tt=xt,be.push("ELEVATED_ROADS")):(be.push("ELEVATED"),tt=xt,W&&be.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&be.push("ELEVATION_REFERENCE_SEA"));let Dt=Ye?p.stencilModeFor3D():ln.disabled;p.forceTerrainMode=!0,Le(f,be,tt,Dt,!0,!0),Ye&&Le(f,be,tt,Dt,!0,!1),p.forceTerrainMode=!1}Ye&&(p.resetStencilClippingMasks(),re&&N.clear({stencil:0})),S===0||p.depthOcclusion||re||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,o,c,f){let _=c.paint.get("fill-color"),y=c.paint.get("fill-opacity");if(y.constantOr(1)===0)return;let x=c.paint.get("fill-emissive-strength"),w=p.colorModeForDrapableLayerRenderPass(x),S=c.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(r.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent",A="none";c.layout.get("fill-elevation-reference")!=="none"?A="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(A="offset");let L=!(!p.terrain||!p.terrain.enabled),F={painter:p,sourceCache:o,layer:c,coords:f,colorMode:w,elevationType:A,terrainEnabled:L,pass:M};if(p.renderPass==="shadow")return void(p.shadowRenderer&&A==="road"&&!L&&(function(j){let{painter:U,sourceCache:W,layer:q,coords:ee}=j,re=U.context.gl,te=j.painter.shadowRenderer;for(let ge of ee){let de=W.getTile(ge),fe=de.getBucket(q);if(!fe)continue;let ue=fe.elevatedStructures;if(!ue||!ue.shadowCasterSegments||ue.shadowCasterSegments.segments[0].primitiveLength===0)continue;U.prepareDrawTile();let ae=fe.bufferData.programConfigurations.get(q.id),_e=U.isTileAffectedByFog(ge),Te=U.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:_e}),Ce=te.calculateShadowPassMatrixFromTile(de.tileID.toUnwrapped());U.uploadCommonUniforms(U.context,Te,ge.toUnwrapped());let Be={u_matrix:Ce,u_depth_bias:0};Te.draw(U,re.TRIANGLES,te.getShadowPassDepthMode(),ln.disabled,te.getShadowPassColorMode(),an.disabled,Be,q.id,ue.vertexBuffer,ue.indexBuffer,ue.shadowCasterSegments,q.paint,U.transform.zoom,ae)}})(F));let N=p.emissiveMode==="mrt-fallback";if(A!=="offset"){if(Gm(F,!1,N),A==="road"){let j=!L&&p.renderPass==="translucent";j&&Hm(p,o,c,f,"geometry"),Gm(F,!0,N,ln.disabled),j&&(function(U){let{painter:W,sourceCache:q,layer:ee,coords:re,colorMode:te}=U,ge=W.context.gl,de=U.painter.shadowRenderer,fe=!!de&&de.enabled,ue=new Gt(W.context.gl.LEQUAL,Gt.ReadOnly,W.depthRangeFor3D),ae=[0,0,0];if(fe){let Te=W.style.directionalLight,Ce=W.style.ambientLight;Te&&Ce&&(ae=Jl(W.style,Te,Ce))}let _e=Te=>{for(let Ce of re){let Be=q.getTile(Ce),Ue=Be.getBucket(ee);if(!Ue)continue;let Ye=Ue.elevatedStructures;if(!Ye)continue;let dt,Fe;if(Te?(dt=Ye.renderableBridgeSegments,Fe=Ye.bridgeProgramConfigurations.get(ee.id)):(dt=Ye.renderableTunnelSegments,Fe=Ye.tunnelProgramConfigurations.get(ee.id)),!dt||dt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),W.prepareDrawTile();let be=W.isTileAffectedByFog(Ce),Ge=[];fe&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let Le=W.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:be,defines:Ge}),tt=W.translatePosMatrix(Ce.projMatrix,Be,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"));fe&&de.setupShadows(Be.tileID.toUnwrapped(),Le,"vector-tile");let xt=eu(tt,ae);W.uploadCommonUniforms(W.context,Le,Ce.toUnwrapped()),Le.draw(W,ge.TRIANGLES,ue,ln.disabled,te,an.backCCW,xt,ee.id,Ye.vertexBuffer,Ye.indexBuffer,dt,ee.paint,W.transform.zoom,Fe,[Ye.vertexBufferNormal])}};_e(!0),_e(!1)})(F)}}else Gm(F,!1,N,p.stencilModeFor3D())},"fill-extrusion":function(p,o,c,f){let _=c.paint.get("fill-extrusion-opacity"),y=p.context,x=y.gl,w=p.terrain,S=w&&w.renderingToTexture;if(_===0)return;let M=p.emissiveMode==="mrt-fallback",A=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),L=p.style.order.indexOf(c.fqid);if(A&&(function(F,N,j,U,W){for(let q of U){let ee=N.getTile(q).getBucket(j);ee&&(ee.updateReplacement(q,F.replacementSource,W),ee.uploadCentroid(F.context))}})(p,o,c,f,L),w||A)for(let F of f){let N=o.getTile(F).getBucket(c);N&&nI(p.context,o,F,N,c,w,A)}if(p.renderPass==="shadow"&&p.shadowRenderer){let F=p.shadowRenderer;if(w&&_<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;let N=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();qm(p,o,c,f,N,ln.disabled,j,A)}else if(p.renderPass==="translucent"){let F=!c.paint.get("fill-extrusion-pattern").constantOr(1),N=c.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!S&&N.a!==0){let j=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D);_===1&&F?qm(p,o,c,f,j,ln.disabled,yn.unblended,A):(qm(p,o,c,f,j,ln.disabled,yn.disabled,A),qm(p,o,c,f,j,p.stencilModeFor3D(),p.colorModeForRenderPass(),A),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&F&&(!w&&p.transform.projection.name!=="globe"||S)){let j=c.paint.get("fill-extrusion-opacity"),U=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=c.paint.get("fill-extrusion-flood-light-intensity"),ee=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ee?null:c.lut).toArray01().slice(0,3),te=U>0&&W>0,ge=q>0,de=(ae,_e,Te)=>(1-Te)*ae+Te*_e,fe=new a0;fe.translate=c.paint.get("fill-extrusion-translate"),fe.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),fe.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),fe.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");let ue=ae=>{let _e=p.depthModeForSublayer(1,Gt.ReadOnly,x.LEQUAL,!0),Te=c.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=de(.1,3,Te),Be=p._showOverdrawInspector;if(!Be){let Ue=new ln({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ye=new yn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);nc(fe,p,o,c,f,_e,Ue,Ye,an.disabled,ae,"sdf",j,U,W,q,re,Ce,A,!1)}{let Ue=Be?ln.disabled:new ln({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ye=Be?p.colorModeForRenderPass():new yn([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.ao.transparent,[!0,!0,!0,!0]);nc(fe,p,o,c,f,_e,Ue,Ye,an.disabled,ae,"color",j,U,W,q,re,Ce,A,!1)}};if(S){let ae=()=>{let Te=w.drapeBufferSize[0],Ce=w.drapeBufferSize[1],Be=w.framebufferCopyTexture;return Be&&(!Be||Be.size[0]===Te&&Be.size[1]===Ce)||(Be&&Be.destroy(),Be=w.framebufferCopyTexture=new r.T(y,new r.q({width:Te,height:Ce}),x.RGBA8)),Be.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,Te,Ce),Be},_e=(Te,Ce,Be)=>{let Ue=p.depthModeForSublayer(1,Gt.ReadOnly,x.LEQUAL,!1),Ye=c.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=de(.1,3,Ye);{let Fe=new yn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0]);nc(fe,p,o,c,f,Ue,ln.disabled,Fe,an.disabled,Te,"clear",j,U,W,q,re,dt,A,Ce)}{let Fe=new ln({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),be=new yn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);nc(fe,p,o,c,f,Ue,Fe,be,an.disabled,Te,"sdf",j,U,W,q,re,dt,A,Ce)}M&&!Te&&(Be=ae());{let Fe=Te?x.ZERO:x.ONE_MINUS_DST_ALPHA,be=new ln({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ge=new yn([Fe,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.ao.transparent,[!0,!0,!0,!0]);nc(fe,p,o,c,f,Ue,be,Ge,an.disabled,Te,"color",j,U,W,q,re,dt,A,Ce)}if(!M||Te){let Fe=new yn([x.ONE,x.ONE,x.ONE,Te?x.ZERO:x.ONE],r.ao.transparent,[!1,!1,!1,!0],Te?x.FUNC_ADD:x.MAX);nc(fe,p,o,c,f,Ue,ln.disabled,Fe,an.disabled,Te,"clear",j,U,W,q,re,dt,A,Ce,Be)}else{x.drawBuffers([x.NONE,x.COLOR_ATTACHMENT1]);let Fe=new ln({func:x.EQUAL,mask:255},254,255,x.KEEP,x.DECR,x.DECR),be=new yn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!0,!1,!1,!1],x.MAX);nc(fe,p,o,c,f,Ue,Fe,be,an.disabled,Te,"emissive",j,U,W,q,re,dt,A,Ce,Be),x.drawBuffers([x.COLOR_ATTACHMENT0])}};if(te||ge){let Te;p.prepareDrawTile(),M&&!te||(Te=ae()),te&&_e(!0,!1,Te),ge&&_e(!1,!0,Te)}}else te&&ue(!0),ge&&ue(!1),(te||ge)&&p.resetStencilClippingMasks()}}},building:function(p,o,c,f){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);let _=c.paint.get("building-ambient-occlusion-ground-intensity"),y=c.paint.get("building-ambient-occlusion-ground-radius"),x=c.paint.get("building-ambient-occlusion-ground-attenuation"),w=c.paint.get("building-opacity");if(w<=0)return;let S=_>0&&y>0,M=!0,A=c.paint.get("building-vertical-scale");if(A<=0)return;p.shadowRenderer||(M=!1);let L=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),F=p.style.order.indexOf(c.fqid);if((function(N,j,U,W,q,ee){for(let re of ee){let te=j.getTile(re).getBucket(U);te&&(q&&te.updateReplacement(re,N.replacementSource,W),te.uploadUpdatedIndexBuffer(N.context))}})(p,o,c,F,L,f),(function(N,j,U,W){for(let q of W){let ee=j.getTile(q).getBucket(U);ee&&ee.needsEvaluation()&&ee.uploadUpdatedColorBuffer(N.context)}})(p,o,c,f),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){let N=p.shadowRenderer,j=[],U=N.getShadowPassDepthMode();kp({painter:p,source:o,layer:c,coords:f,defines:j,blendMode:N.getShadowPassColorMode(),depthMode:U,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(N=N.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(N=N.concat("NORMAL_OFFSET"));let j=c.paint.get("building-facade-emissive-chance"),U=c.paint.get("building-ambient-occlusion-intensity"),W=c.paint.get("building-flood-light-intensity"),q=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ee=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(q?null:c.lut).toArray01().slice(0,3),re=c.paint.get("building-flood-light-ground-attenuation"),te=W>0,ge=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D);w<1&&kp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:yn.disabled,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:W,floodLightColor:ee,depthOnly:!0});let de=p.colorModeForRenderPass();kp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:de,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:W,floodLightColor:ee}),S&&Wm(p,o,c,f,!0,w,_,y,W,ee,x,L),te&&Wm(p,o,c,f,!1,w,_,y,W,ee,re,L)}else if(p.renderPass==="light-beam"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],j=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);kp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:yn.alphaBlended,depthMode:j,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,o,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let _=p.context,y=p.terrain&&p.terrain.renderingToTexture,[x,w]=p.renderPass!=="translucent"||y?[{},f]:p.stencilConfigForOverlap(f);for(let S of w){let M=o.getTile(S);if(M.needsHillshadePrepare&&p.renderPass==="offscreen")qT(p,M,c);else if(p.renderPass==="translucent"){let A=p.depthModeForSublayer(0,Gt.ReadOnly),L=c.paint.get("hillshade-emissive-strength"),F=p.colorModeForDrapableLayerRenderPass(L),N=y&&p.terrain?p.terrain.stencilModeForRTTOverlap(S):x[S.overscaledZ];GT(p,S,M,c,A,N,F)}}_.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,c,f,_,y){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let x=p.transform.projection.name==="globe",w=c.paint.get("raster-elevation")!==0,S=w&&x;if(p.renderElevatedRasterBackface&&!S)return;let M=p.context,A=M.gl,L=o.getSource(),F=(function(de,fe,ue,ae,_e){let Te=fe.paint.get("raster-color"),Ce=de.type==="raster-array",Be=[],Ue=fe.paint.get("raster-resampling"),Ye=fe.paint.get("raster-color-mix"),dt=fe.paint.get("raster-color-range"),Fe=[Ye[0],Ye[1],Ye[2],0],be=Ye[3],Ge=Ue==="nearest"?ae.NEAREST:ae.LINEAR;if(Ce&&(Be.push("RASTER_ARRAY"),Te||Be.push("RASTER_COLOR"),Ue==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),Ge=ae.NEAREST,!dt&&de.rasterLayers)){let Le=de.rasterLayers.find(({id:tt})=>tt===fe.sourceLayer);Le&&Le.fields&&Le.fields.range&&(dt=Le.fields.range)}if(dt=dt||[0,1],Te){Be.push("RASTER_COLOR"),ue.activeTexture.set(ae.TEXTURE2),fe.updateColorRamp(dt);let Le=fe.colorRampTexture;Le||(Le=fe.colorRampTexture=new r.T(ue,fe.colorRamp,ae.RGBA8)),Le.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return _e&&Be.push("USE_MRT1"),{mix:Fe,range:dt,offset:be,defines:Be,resampling:Ge}})(L,c,M,A,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(L instanceof r.aU&&!f.length&&!x)return;let N=c.paint.get("raster-emissive-strength"),j=p.colorModeForDrapableLayerRenderPass(N),U=p.terrain&&p.terrain.renderingToTexture,W=!p.options.moving,q=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(L instanceof r.aU&&!f.length&&(L.onNorthPole||L.onSouthPole)){let de=w?p.stencilModeFor3D():ln.disabled;return void Fp(!!L.onNorthPole,null,p,o,c,N,F,an.disabled,de)}if(!f.length)return;let[ee,re]=L instanceof r.aU||U?[{},f]:p.stencilConfigForOverlap(f),te=re[re.length-1].overscaledZ;S&&F.defines.push("PROJECTION_GLOBE_VIEW"),w&&F.defines.push("RENDER_CUTOFF");let ge=(de,fe,ue)=>{for(let ae of de){let _e=ae.toUnwrapped(),Te=o.getTile(ae);if(U&&(!Te||!Te.hasData()))continue;M.activeTexture.set(A.TEXTURE0);let Ce=rc(Te,L,c,F);if(!Ce||!Ce.texture)continue;let{texture:Be,mix:Ue,offset:Ye,tileSize:dt,buffer:Fe}=Ce,be,Ge;U?(be=Gt.disabled,Ge=ae.projMatrix):w?(be=new Gt(A.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),Ge=x?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(_e,W)):(be=p.depthModeForSublayer(ae.overscaledZ-te,c.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,A.LESS),Ge=p.transform.calculateProjMatrix(_e,W));let Le=p.terrain&&U?p.terrain.stencilModeForRTTOverlap(ae):ee[ae.overscaledZ],tt=y?0:c.paint.get("raster-fade-duration");Te.registerFadeDuration(tt);let xt=o.findLoadedParent(ae,0),Dt=Mp(Te,xt,o,p.transform,tt),_t,pt;!Dt.isFading&&Te.refreshedUponExpiration&&(Te.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),M.activeTexture.set(A.TEXTURE0),Be.bind(q,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),xt?(xt.texture&&xt.texture.bind(q,A.CLAMP_TO_EDGE),_t=Math.pow(2,xt.tileID.overscaledZ-Te.tileID.overscaledZ),pt=[Te.tileID.canonical.x*_t%1,Te.tileID.canonical.y*_t%1]):Be.bind(q,A.CLAMP_TO_EDGE),"useMipmap"in Be&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let Ut=p.transform,zt,Tt=w?o1(Ut):[0,0,0,0],Pt,Jt,fn,Fn,Jn,jt=0;if(S&&L instanceof r.aU&&L.coordinates.length>3)Pt=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0)))),Jt=Float32Array.from(Ut.globeMatrix),fn=Float32Array.from(r.dF(Ut)),Fn=[r.aF(Ut.center.lng),r.aJ(Ut.center.lat)],zt=L.elevatedGlobePerspectiveTransform,Jn=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let mi=r.dG(ae.canonical);jt=r.dH(mi.getCenter().lat),Pt=Float32Array.from(r.bk(r.dJ(ae.canonical))),Jt=Float32Array.from(Ut.globeMatrix),fn=Float32Array.from(r.dF(Ut)),Fn=[r.aF(Ut.center.lng),r.aJ(Ut.center.lat)],zt=[0,0],Jn=Float32Array.from(r.dI(ae.canonical,mi,jt,Ut.worldSize/Ut._pixelsPerMercatorPixel))}else zt=L instanceof r.aU?L.perspectiveTransform:[0,0],Pt=new Float32Array(16),Jt=new Float32Array(9),fn=new Float32Array(16),Fn=[0,0],Jn=new Float32Array(9);let Yn=Qb(Ge,Pt,Jt,fn,Jn,pt||[0,0],r.aj(p.transform.zoom),Fn,Tt,_t||1,Dt,c,zt,w?c.paint.get("raster-elevation"):0,2,Ue,Ye,F.range,dt,Fe,N),pn=p.isTileAffectedByFog(ae),ii=p.getOrCreateProgram("raster",{defines:F.defines,overrideFog:pn});if(p.uploadCommonUniforms(M,ii,_e),L instanceof r.aU){let mi=L.elevatedGlobeVertexBuffer,di=L.elevatedGlobeIndexBuffer;if(U||!x)L.boundsBuffer&&L.boundsSegments&&ii.draw(p,A.TRIANGLES,be,ln.disabled,j,an.disabled,Yn,c.id,L.boundsBuffer,p.quadTriangleIndexBuffer,L.boundsSegments);else if(mi&&di){let Wn=Ut.zoom<=r.c_?L.elevatedGlobeSegments:L.getSegmentsForLongitude(Ut.center.lng);Wn&&ii.draw(p,A.TRIANGLES,be,ln.disabled,j,fe,Yn,c.id,mi,di,Wn)}}else if(S){be=new Gt(A.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);let mi=p.globeSharedBuffers;if(mi){let[di,Wn,bn]=mi.getGridBuffers(jt,!1);ii.draw(p,A.TRIANGLES,be,ue||Le,p.colorModeForRenderPass(),fe,Yn,c.id,di,Wn,bn)}}else{let{tileBoundsBuffer:mi,tileBoundsIndexBuffer:di,tileBoundsSegments:Wn}=p.getTileBoundsBuffers(Te);ii.draw(p,A.TRIANGLES,be,Le,j,an.disabled,Yn,c.id,mi,di,Wn)}}if(!(L instanceof r.aU)&&S)for(let ae of de){let _e=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&Fp(!0,ae,p,o,c,N,F,fe,ue||ln.disabled),_e&&Fp(!1,ae,p,o,c,N,F,fe===an.frontCW?an.backCW:an.frontCW,ue||ln.disabled)}};S?ge(re,p.renderElevatedRasterBackface?an.backCW:an.frontCW,p.stencilModeFor3D()):ge(re,an.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,o,c,f,_,y){p.renderPass==="offscreen"&&(function(x,w,S,M){if(!M.length)return;let A=x.context,L=A.gl,F=w.getSource();if(!(F instanceof ss))return;let N=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count"))),j=S.particlePositionRGBAImage;if(!j||j.width!==N){let re=(function(te){let ge=te*te,de=new Uint8Array(4*ge),fe=function(ae){return ae|=0,ae=Math.imul(2747636419^ae,2654435769),ae=Math.imul(ae^ae>>>16,2654435769),((ae=Math.imul(ae^ae>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let ae=0;ae<ge;ae++){let _e=ue*(fe(2*ae+0)+wl),Te=ue*(fe(2*ae+1)+wl),Ce=255*_e%1,Be=255*Te%1,Ue=Ce,Ye=Te-Be/255,dt=Be;de[4*ae+0]=255*(_e-Ce/255),de[4*ae+1]=255*Ue,de[4*ae+2]=255*Ye,de[4*ae+3]=255*dt}return de})(N);j=S.particlePositionRGBAImage=new r.q({width:N,height:N},re)}let U=S.particleFramebuffer;U?U.width!==N&&(U.destroy(),U=S.particleFramebuffer=A.createFramebuffer(N,N,1,null)):U=S.particleFramebuffer=A.createFramebuffer(N,N,1,null);let W=[];for(let re of M){let te=w.getTile(re);if(!(te instanceof am))continue;let ge=c0(te,F,S);if(!ge)continue;let de=[te.tileSize,te.tileSize],fe=S.tileFramebuffer;fe||(fe=S.tileFramebuffer=A.createFramebuffer(de[0],de[1],1,null));let ue=te.rasterParticleState;ue||(ue=te.rasterParticleState=new Ym(A,re,de,j));let ae=ue.update(S.lastInvalidatedAt);ue.particleTextureDimension!==N&&ue.updateParticleTexture(re,j);let _e=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=_e;let Te=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=Te,W.push([re,ge,ue,ae])}if(W.length===0)return;let q=r.o.now(),ee=S.previousDrawTimestamp?.001*(q-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=q,S.hasColorMap()){A.activeTexture.set(L.TEXTURE0+2);let re=S.colorRampTexture;re||(re=S.colorRampTexture=new r.T(A,S.colorRamp,L.RGBA8)),re.bind(L.LINEAR,L.CLAMP_TO_EDGE)}A.bindFramebuffer.set(S.tileFramebuffer.framebuffer),(function(re,te,ge){let de=re.context,fe=de.gl,ue=te.tileFramebuffer;de.activeTexture.set(fe.TEXTURE0);let ae={u_texture:0,u_opacity:1.05*(Te=te.paint.get("raster-particle-fade-opacity-factor"))/(Te+.05)},_e=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Te;for(let Ce of ge){let[,,Be,Ue]=Ce;ue.colorAttachment0.set(Be.targetColorTexture.texture),de.viewport.set([0,0,ue.width,ue.height]),de.clear({color:r.ao.transparent}),Ue&&(Be.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),_e.draw(re,fe.TRIANGLES,Gt.disabled,ln.disabled,yn.alphaBlended,an.disabled,ae,te.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}})(x,S,W),(function(re,te,ge,de){let fe=re.context,ue=fe.gl,ae=ge.tileFramebuffer,_e=re.transform.projection.name==="globe",Te=ge.paint.get("raster-particle-max-speed");for(let Ce of de){let[Be,Ue,Ye]=Ce;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ae.colorAttachment0.set(Ye.targetColorTexture.texture);let dt=re.getOrCreateProgram("rasterParticleDraw",{defines:Ue.defines,overrideFog:!1});fe.activeTexture.set(ue.TEXTURE0+1);let Fe=Ue.scalarData?[]:[0,1,2,3].map(Le=>r.e9[Le](Be));Fe.push(Be);let be=Be.canonical.x,Ge=Be.canonical.y;for(let Le of Fe){let tt=te.getTile(_e?Le.wrapped():Le);if(!tt)continue;let xt=tt.rasterParticleState;if(!xt)continue;let Dt=Le.canonical.x+(1<<Le.canonical.z)*(Le.wrap-Be.wrap),_t=Le.canonical.y;xt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let pt=tI(1,xt.particleTexture0.size[0],[Dt-be,_t-Ge],0,Ue.texture.size,2,Te,Ue.textureOffset,Ue.scale,Ue.offset);dt.draw(re,ue.POINTS,Gt.disabled,ln.disabled,yn.alphaBlended,an.disabled,pt,ge.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}})(x,w,S,W),A.bindFramebuffer.set(S.particleFramebuffer.framebuffer),(function(re,te,ge,de){let fe=re.context,ue=fe.gl,ae=te.paint.get("raster-particle-max-speed"),_e=de*te.paint.get("raster-particle-speed-factor")*.15,Te=(function(Be){return Math.pow(Be,6)})(.01+1*te.paint.get("raster-particle-reset-rate-factor")),Ce=te.particleFramebuffer;fe.viewport.set([0,0,Ce.width,Ce.height]);for(let Be of ge){let[,Ue,Ye]=Be;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),fe.activeTexture.set(ue.TEXTURE0+1);let dt=Ye.particleTexture0;dt.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let Fe=e1(1,dt.size[0],0,Ue.texture.size,ae,_e,Te,Ue.textureOffset,Ue.scale,Ue.offset);Ce.colorAttachment0.set(Ye.particleTexture1.texture),fe.clear({color:r.ao.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Ue.defines}).draw(re,ue.TRIANGLES,Gt.disabled,ln.disabled,yn.unblended,an.disabled,Fe,te.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}})(x,S,W,ee)})(p,o,c,f),p.renderPass==="translucent"&&((function(x,w,S,M,A){let L=x.context,F=L.gl,N=w.getSource().tileSize,j=5*(1-r.ah(r.cL,r.cL+1,x.transform.zoom))*N+S.paint.get("raster-particle-elevation"),U=!x.options.moving,W=x.transform.projection.name==="globe";if(!M.length)return;let[q,ee]=x.stencilConfigForOverlap(M),re=[];W&&re.push("PROJECTION_GLOBE_VIEW");let te=x.stencilModeFor3D();for(let ge of ee){let de=ge.toUnwrapped(),fe=w.getTile(ge);if(!fe.rasterParticleState)continue;let ue=fe.rasterParticleState,ae=100;fe.registerFadeDuration(ae);let _e=w.findLoadedParent(ge,0),Te=Mp(fe,_e,w,x.transform,ae),Ce,Be;x.terrain&&x.terrain.prepareDrawTile(),L.activeTexture.set(F.TEXTURE0),ue.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),_e&&_e.rasterParticleState?(_e.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ce=Math.pow(2,_e.tileID.overscaledZ-fe.tileID.overscaledZ),Be=[fe.tileID.canonical.x*Ce%1,fe.tileID.canonical.y*Ce%1]):ue.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let Ue=W?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(de,U),Ye=x.transform,dt=s1(Ye),Fe=r.dG(ge.canonical),be=r.dH(Fe.getCenter().lat),Ge,Le,tt,xt,Dt;W?(Ge=Float32Array.from(r.bk(r.dJ(ge.canonical))),Le=Float32Array.from(Ye.globeMatrix),tt=Float32Array.from(r.dF(Ye)),xt=[r.aF(Ye.center.lng),r.aJ(Ye.center.lat)],Dt=Float32Array.from(r.dI(ge.canonical,Fe,be,Ye.worldSize/Ye._pixelsPerMercatorPixel))):(Ge=new Float32Array(16),Le=new Float32Array(9),tt=new Float32Array(16),xt=[0,0],Dt=new Float32Array(9));let _t=eI(Ue,Ge,Le,tt,Dt,Be||[0,0],r.aj(x.transform.zoom),xt,dt,Ce||1,Te,j),pt=x.isTileAffectedByFog(ge),Ut=x.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:pt});if(x.uploadCommonUniforms(L,Ut,de),W){let zt=new Gt(F.LEQUAL,Gt.ReadOnly,x.depthRangeFor3D),Tt=0,Pt=x.globeSharedBuffers;if(Pt){let[Jt,fn,Fn]=Pt.getGridBuffers(be,Tt!==0);Ut.draw(x,F.TRIANGLES,zt,te,yn.alphaBlended,x.renderElevatedRasterBackface?an.frontCCW:an.backCCW,_t,S.id,Jt,fn,Fn)}}else{let zt=x.depthModeForSublayer(0,Gt.ReadOnly),Tt=q[ge.overscaledZ],{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:Jt,tileBoundsSegments:fn}=x.getTileBoundsBuffers(fe);Ut.draw(x,F.TRIANGLES,zt,Tt,yn.alphaBlended,an.disabled,_t,S.id,Pt,Jt,fn)}}x.resetStencilClippingMasks()})(p,o,c,f),p.style.map.triggerRepaint())},background:function(p,o,c,f){let _=c.paint.get("background-color"),y=c.paint.get("background-color-use-theme").constantOr("default")==="none",x=c.paint.get("background-opacity"),w=c.paint.get("background-emissive-strength"),S=c.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let M=p.context,A=M.gl,L=p.transform,F=L.tileSize,N=c.paint.get("background-pattern"),j;if(N!==void 0&&(N===null||(j=p.imageManager.getPattern(r.I.from(N.toString()),c.scope,p.style.getLut(c.scope)),!j)))return;let U=!N&&_.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;let W=ln.disabled,q=p.depthModeForSublayer(0,U==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ee=p.colorModeForDrapableLayerRenderPass(w),re=N?"backgroundPattern":"background",te,ge=f;ge||(te=p.getBackgroundTiles(),ge=Object.values(te).map(fe=>fe.tileID)),N&&(M.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context,c.scope));let de=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&de.push("USE_MRT1"),S){let fe=p.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0,defines:de}),ue=new Float32Array(r.bA([])),ae=new r.aQ(0,0,0,0,0),_e=N?nu(ue,w,x,p,0,c.scope,j,S,{tileID:ae,tileSize:F}):Ap(ue,w,x,_.toPremultipliedRenderColor(y?null:c.lut));fe.draw(p,A.TRIANGLES,q,W,ee,an.disabled,_e,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(let fe of ge){let ue=p.isTileAffectedByFog(fe),ae=p.getOrCreateProgram(re,{overrideFog:ue,defines:de}),_e=fe.toUnwrapped(),Te=f?fe.projMatrix:p.transform.calculateProjMatrix(_e);p.prepareDrawTile();let Ce=o?o.getTile(fe):te?te[fe.key]:new Qu(fe,F,L.zoom,p),Be=N?nu(Te,w,x,p,0,c.scope,j,S,{tileID:fe,tileSize:F}):Ap(Te,w,x,_.toPremultipliedRenderColor(y?null:c.lut));p.uploadCommonUniforms(M,ae,_e);let{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Ye,tileBoundsSegments:dt}=p.getTileBoundsBuffers(Ce);ae.draw(p,A.TRIANGLES,q,W,ee,an.disabled,Be,c.id,Ue,Ye,dt)}},sky:function(p,o,c){let f=p._atmosphere?r.aj(p.transform.zoom):1,_=c.paint.get("sky-opacity")*f;if(_===0)return;let y=p.context,x=c.paint.get("sky-type"),w=new Gt(y.gl.LEQUAL,Gt.ReadOnly,[0,1]),S=p.frameCounter/1e3%1;x==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&((function(M,A,L,F){let N=M.context,j=N.gl,U=A.skyboxFbo;if(!U){U=A.skyboxFbo=N.createFramebuffer(32,32,1,null),A.skyboxGeometry=new Km(N),A.skyboxTexture=N.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,A.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let re=0;re<6;++re)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);let W=A.getCenter(M,!0),q=M.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);r.bA(ee),r.en(ee,ee,.5*-Math.PI),dd(M,A,q,ee,W,0),r.bA(ee),r.en(ee,ee,.5*Math.PI),dd(M,A,q,ee,W,1),r.bA(ee),r.cU(ee,ee,.5*-Math.PI),dd(M,A,q,ee,W,2),r.bA(ee),r.cU(ee,ee,.5*Math.PI),dd(M,A,q,ee,W,3),r.bA(ee),dd(M,A,q,ee,W,4),r.bA(ee),r.en(ee,ee,Math.PI),dd(M,A,q,ee,W,5),N.viewport.set([0,0,M.width,M.height])})(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&(function(M,A,L,F,N){let j=M.context,U=j.gl,W=M.transform,q=M.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,A.skyboxTexture);let ee=((re,te,ge,de,fe)=>({u_matrix:re,u_sun_direction:te,u_cubemap:0,u_opacity:de,u_temporal_offset:fe}))(W.skyboxMatrix,A.getCenter(M,!1),0,F,N);M.uploadCommonUniforms(j,q),q.draw(M,U.TRIANGLES,L,ln.disabled,M.colorModeForRenderPass(),an.backCW,ee,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S):x==="gradient"&&p.renderPass==="sky"&&(function(M,A,L,F,N){let j=M.context,U=j.gl,W=M.transform,q=M.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new Km(j)),j.activeTexture.set(U.TEXTURE0);let ee=A.colorRampTexture;ee||(ee=A.colorRampTexture=new r.T(j,A.colorRamp,U.RGBA8)),ee.bind(U.LINEAR,U.CLAMP_TO_EDGE);let re=((te,ge,de,fe,ue)=>({u_matrix:te,u_color_ramp:0,u_center_direction:ge,u_radius:r.an(de),u_opacity:fe,u_temporal_offset:ue}))(W.skyboxMatrix,A.getCenter(M,!1),A.paint.get("sky-gradient-radius"),F,N);M.uploadCommonUniforms(j,q),q.draw(M,U.TRIANGLES,L,ln.disabled,M.colorModeForRenderPass(),an.backCW,re,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S)},custom:function(p,o,c,f){let _=p.context,y=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(o)){if(p.renderPass==="offscreen"){let x=y.prerender;if(x){if(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;x.call(y,_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else x.call(y,_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let w=y.renderToTile;if(w){let S=f[0].canonical,M={x:S.x+f[0].wrap*(y.wrapTileId?0:1<<S.z),y:S.y,z:S.z};_.setDepthMode(Gt.disabled),_.setStencilMode(ln.disabled),_.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),w.call(y,_.gl,M),_.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(ln.disabled);let x=y.renderingMode==="3d"?new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Gt.ReadOnly);if(_.setDepthMode(x),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;y.render(_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else y.render(_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,o,c,f){if(p.renderPass==="opaque")return;let _=c.paint.get("model-opacity").constantOr(1),y=c.paint.get("model-elevation-reference"),x=y==="ground",w=y==="ground";if(_===0)return;let S=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!S||p.terrain&&_<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;let M=p.shadowRenderer,A=c.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,A||(M.enabled=!1));let L=()=>{M&&(M.useNormalOffset=!0,A||(M.enabled=!0))},F=o.getSource();if(p.renderPass==="light-beam"&&F.type!=="batched-model")return;if(F.type==="vector"||F.type==="geojson")return(function(te,ge,de,fe,ue){let ae=te.transform,_e=ae.projection.name==="globe",Te=ae.getFreeCameraOptions().position;if(!te.modelManager)return;let Ce=te.modelManager;de.modelManager=Ce;let Be=te.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Ue=de._unevaluatedLayout._values["model-id"],Ye=Object.assign({},de.layout.get("model-id").parameters),dt=te.style.order.indexOf(de.fqid),Fe=de.paint.get("model-opacity").constantOr(1);for(let be of fe){let Ge=ge.getTile(be).getBucket(de);if(!Ge||Ge.projection.name!==ae.projection.name)continue;let Le=Ge.getModelUris();if(Le&&!Ge.modelsRequested&&(Ce.addModelsFromBucket(Le,ue),Ge.modelsRequested=!0),_e)Ye.zoom=be.overscaledZ;else{let Tt=gs(be,ae);Ye.zoom=Tt}let tt=Ue.possiblyEvaluate(Ye);if(g1(te,Ge,be),El.shadowUniformsInitialized=!1,El.useSingleShadowCascade=!!Be&&Be.getMaxCascadeForTile(be.toUnwrapped())===0,te.renderPass==="shadow"&&Be){if(te.currentShadowCascade===1&&Ge.isInsideFirstShadowMapFrustum)continue;let Tt=ae.calculatePosMatrix(be.toUnwrapped(),ae.worldSize);if(El.tileMatrix.set(Tt),El.shadowTileMatrix=Float32Array.from(Be.calculateShadowPassMatrixFromMatrix(Tt)),El.aabb.min=[0,0,0],El.aabb.max[0]=El.aabb.max[1]=r.al,El.aabb.max[2]=0,oI(Ge,El,te,de.scope))continue}let xt=1<<be.canonical.z,Dt=[((Te.x-be.wrap)*xt-be.canonical.x)*r.al,(Te.y*xt-be.canonical.y)*r.al,Te.z*xt*r.al];te.conflationActive&&Object.keys(Ge.instancesPerModel).length>0&&te.style.isLayerClipped(de,ge.getSource())&&Ge.updateReplacement(be,te.replacementSource,dt,de.scope)&&(Ge.uploaded=!1,Ge.upload(te.context));let _t=0,pt=new Array,Ut=new Array,zt=new Array;for(let Tt in Ge.instancesPerModel){let Pt=Ge.instancesPerModel[Tt];Pt.features.length>0&&!_e&&(Tt=tt.evaluate(Pt.features[0].feature,{}));let Jt=Ce.getModel(Tt,ue);if(Jt||Ce.hasURLBeenRequested(Tt)||Ge.modelUris.includes(Tt)||(Ge.modelUris.push(Tt),Ge.modelsRequested=!1),Jt&&Jt.uploaded)if(_e){let fn=r.c5([],[Te.x,Te.y,Te.z],te.transform.worldSize);r.ew(fn,fn);for(let Fn=0;Fn<Pt.instancedDataArray.length;++Fn){let Jn=[0,0,0],jt=[1,1,1],Yn=r.ex(),pn=Pt.tileCoordinatesForInstance(Fn),ii=Pt.transformForInstance(Fn);r.ey(jt,ii),r.ez(Yn,ii),r.eA(Jn,Yn);let mi=Pt.translationForInstance(Fn),di=new r.aT(0,0);r.eB(Ge.canonical,di,pn.x,pn.y);let Wn=r.bC();r.eC(Wn,Jt,te.transform,di,Jn,jt,mi,!0,!1,!1);let bn=Pt.colorForInstance(Fn),ti=r.bA([]),ur=r.ef(di.lat,te.transform.zoom),Ki=r.bq([],[1,1,1/ur]);r.br(ti,ti,fn),zt.push({zScaleMatrix:Ki,negCameraPosMatrix:ti});for(let ri of Jt.nodes)hd(te,ri,Wn,te.transform.expandedFarZProjMatrix,_t,pt,Ut,Jt.materialOverrides,Fe,bn);++_t}}else for(let fn of Jt.nodes)_1(te,de,fn,Pt,Dt,be,El)}if(_e)if(te.renderPass==="shadow"){for(let Tt of Ut)Xa(Tt.mesh,Tt.nodeModelMatrix,te,de);for(let Tt of pt)Xa(Tt.mesh,Tt.nodeModelMatrix,te,de)}else m1(te,de,pt,Ut,zt)}})(p,o,c,f,Lp(p,c)),void L();if(!F.loaded())return;if(F.type==="batched-model")return(function(te,ge,de,fe){de.resetLayerRenderingStats(te);let ue=te.context,ae=te.transform,_e=te.style.fog,Te=te.shadowRenderer;if(ae.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ae.projection.name} projection is not yet implemented`);let Ce=te.transform.getFreeCameraOptions().position,Be=r.c5([],[Ce.x,Ce.y,Ce.z],te.transform.worldSize),Ue=r.ew([],Be),Ye=r.bA([]),dt=r.ef(ae.center.lat,ae.zoom),Fe=r.bq([],[1,1,1/dt]);r.br(Ye,Ye,Ue);let be=de.paint.get("model-opacity").constantOr(1),Ge=new Gt(ue.gl.LEQUAL,Gt.ReadWrite,te.depthRangeFor3D),Le=new Gt(ue.gl.LEQUAL,Gt.ReadOnly,te.depthRangeFor3D),tt=new r.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xt=te.renderPass==="shadow",Dt=xt&&Te?Te.getCurrentCascadeFrustum():ae.getFrustum(ae.scaleZoom(ae.worldSize)),_t=de.paint.get("model-front-cutoff"),pt=_t[2]<1,Ut=Zc(te,de.paint.get("model-cutoff-fade-range")),zt=de.getLayerRenderingStats();(function(Tt,Pt,Jt,fn){let Fn=Tt.terrain?Tt.terrain.exaggeration():0,Jn=Tt.transform.zoom;for(let jt of fn){let Yn=Pt.getTile(jt).getBucket(Jt);Yn&&(Yn.setFilter(Jt.filter),Tt.conflationActive&&Yn.updateReplacement(jt,Tt.replacementSource),Yn.evaluateTransform(Tt,Jt),Tt.terrain&&Fn>0&&Yn.elevationUpdate(Tt.terrain,Fn,jt,Jt.source),Yn.needsReEvaluation(Tt,Jn,Jt)&&Yn.evaluate(Jt))}})(te,ge,de,fe),(function(){let Tt,Pt,Jt;pt?(Tt=fe.length-1,Pt=-1,Jt=-1):(Tt=0,Pt=fe.length,Jt=1);let fn=new Float64Array(16),Fn=r.cA(),Jn=new r.P(0,0);for(let jt=Tt;jt!==Pt;jt+=Jt){let Yn=fe[jt],pn=ge.getTile(Yn).getBucket(de);if(!pn||!pn.uploaded)continue;let ii=!1;Te&&(ii=Te.getMaxCascadeForTile(Yn.toUnwrapped())===0);let mi=ae.calculatePosMatrix(Yn.toUnwrapped(),ae.worldSize),di=pn.modelTraits;!xt&&pt&&(r.bl(fn,mi),r.af(Fn,Be,fn),Jn.x=Fn[0],Jn.y=Fn[1]);let Wn=[];pn.setFilter(de.filter);for(let bn of pn.getNodesInfo()){if(bn.hiddenByReplacement||!bn.node.meshes)continue;let ti=bn.node,ur=0;te.terrain&&ti.elevation&&(ur=ti.elevation*te.terrain.exaggeration());let Ki=(()=>{let Xo=bn.aabb;return tt.min=[...Xo.min],tt.max=[...Xo.max],tt.min[2]+=ur,tt.max[2]+=ur,r.af(tt.min,tt.min,mi),r.af(tt.max,tt.max,mi),tt})(),ri=bn.evaluatedScale;if(ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&Ki.intersects(Dt)===0)continue;if(!xt&&pt){let Xo=.16666666666666666;bn.cameraCollisionOpacity=Be[0]>Ki.min[0]&&Be[0]<Ki.max[0]&&Be[1]>Ki.min[1]&&Be[1]<Ki.max[1]&&Be[2]*dt<Ki.max[2]&&ti.footprint&&r.c0(Jn,ti.footprint)?Math.max(bn.cameraCollisionOpacity-Xo,0):Math.min(1,bn.cameraCollisionOpacity+Xo)}let $n=[...mi],wn=1/r.d7(Yn.canonical),Hi=ti.anchor?ti.anchor[0]:0,wr=ti.anchor?ti.anchor[1]:0;r.br($n,$n,[Hi*(ri[0]-1)+bn.evaluatedTranslation[0]*wn,wr*(ri[1]-1)+bn.evaluatedTranslation[1]*wn,ur+bn.evaluatedTranslation[2]]),r.cq(ri,r.eE)||r.cS($n,$n,ri);let ir=r.aB([],$n,ti.globalMatrix),Si=r.aB([],ae.expandedFarZProjMatrix,ir),_s=r.aB([],ae.expandedFarZProjMatrix,$n),Fo=r.aC([],[Hi,wr,ur,1],Si)[2];ti.hidden=!1;let Qr=be;xt||(pt&&(Qr*=bn.cameraCollisionOpacity,Qr*=An($n,ae,bn.aabb,_t)),Qr*=Xi(Ut,Fo)),Qr!==0?Wn.push({nodeInfo:bn,depth:Fo,opacity:Qr,wvpForNode:Si,wvpForTile:_s,nodeModelMatrix:ir,tileModelMatrix:$n}):ti.hidden=!0}xt||Wn.sort((bn,ti)=>!pt||bn.opacity===1&&ti.opacity===1?bn.depth<ti.depth?-1:1:bn.opacity===1?-1:ti.opacity===1?1:bn.depth>ti.depth?-1:1);for(let bn of Wn){let ti=bn.nodeInfo,ur=ti.node,Ki=r.aB([],Fe,bn.tileModelMatrix);r.aB(Ki,Ye,Ki);let ri=r.bl([],Ki);r.eg(ri,ri),r.cS(ri,ri,Np),Ki=r.aB(Ki,Ki,ur.globalMatrix);let $n=te.renderPass==="light-beam",wn=de.paint.get("model-color-use-theme").constantOr("default")==="none",Hi=di&r.eI.HasMapboxMeshFeatures,wr=Hi?0:ti.evaluatedRMEA[0][2];for(let ir=0;ir<ur.meshes.length;++ir){let Si=ur.meshes[ir],_s=ir===ur.lightMeshIndex,Fo=bn.wvpForNode;if(_s){if(!$n&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}Fo=bn.wvpForTile}else if($n)continue;let Qr={defines:[]},Xo=[];if(!xt&&Te&&(Te.useNormalOffset=!!Si.normalBuffer),eg(Qr.defines,Xo,Si,te,wn?null:de.lut),Hi||Qr.defines.push("DIFFUSE_SHADED"),ii&&Qr.defines.push("SHADOWS_SINGLE_CASCADE"),zt&&(xt?zt.numRenderedVerticesInShadowPass+=Si.vertexArray.length:zt.numRenderedVerticesInTransparentPass+=Si.vertexArray.length),xt){Xa(Si,bn.nodeModelMatrix,te,de);continue}let Ko=null;if(_e){let Mr=Jm(bn.nodeModelMatrix,te.transform);if(Ko=new Float32Array(Mr),ae.projection.name!=="globe"){let Ti=Si.aabb.min,Lr=Si.aabb.max,[dr,rr]=_e.getOpacityForBounds(Mr,Ti[0],Ti[1],Lr[0],Lr[1]);Qr.overrideFog=dr>=Xe||rr>=Xe}}let Do=Si.material,na;Do.occlusionTexture&&Do.occlusionTexture.offsetScale&&(na=Do.occlusionTexture.offsetScale,Qr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Ia=te.getOrCreateProgram("model",Qr);!xt&&Te&&Te.setupShadowsFromMatrix(bn.tileModelMatrix,Ia,Te.useNormalOffset),te.uploadCommonUniforms(ue,Ia,null,Ko);let As=Do.pbrMetallicRoughness;As.metallicFactor=.9,As.roughnessFactor=.5;let _r=sd(new Float32Array(Fo),new Float32Array(Ki),new Float32Array(ri),new Float32Array(ur.globalMatrix),te,bn.opacity,As.baseColorFactor,Do.emissiveFactor,As.metallicFactor,As.roughnessFactor,Do,wr,de,[0,0,0],na);!_s&&(ti.hasTranslucentParts||bn.opacity<1)&&Ia.draw(te,ue.gl.TRIANGLES,Ge,ln.disabled,yn.disabled,an.backCCW,_r,de.id,Si.vertexBuffer,Si.indexBuffer,Si.segments,de.paint,te.transform.zoom,void 0,Xo),Ia.draw(te,ue.gl.TRIANGLES,_s?Le:Ge,ln.disabled,_s||bn.opacity<1||ti.hasTranslucentParts?yn.alphaBlended:yn.unblended,an.backCCW,_r,de.id,Si.vertexBuffer,Si.indexBuffer,Si.segments,de.paint,te.transform.zoom,void 0,Xo)}}}})()})(p,o,c,f),void L();if(F.type!=="model")return;let N=F.getModels(),j=[],U=p.transform.getFreeCameraOptions().position,W=r.c5([],[U.x,U.y,U.z],p.transform.worldSize);r.ew(W,W);let q=[],ee=[],re=0;for(let te of N){let ge=o.getFeatureState("",te.id),de={type:"Unknown",id:te.id,properties:te.featureProperties},fe=c.paint.get("model-rotation").evaluate(de,ge),ue=c.paint.get("model-scale").evaluate(de,ge),ae=c.paint.get("model-translation").evaluate(de,ge),_e=c.paint.get("model-opacity").evaluate(de,ge);p1(c,te.id,ge,te.featureProperties,te.nodeOverrideNames,te.nodeOverrides),f1(c,te.id,ge,te.featureProperties,te.materialOverrideNames,te.materialOverrides),te.nodeOverrides.size>0&&te.computeBoundsAndApplyParent(),te.computeModelMatrix(p,fe,ue,ae,w,x,!1);let Te=r.bA([]),Ce=r.ef(te.position.lat,p.transform.zoom),Be=r.bq([],[1,1,1/Ce]);r.br(Te,Te,W),j.push({zScaleMatrix:Be,negCameraPosMatrix:Te});for(let Ue of te.nodes)hd(p,Ue,te.matrix,p.transform.expandedFarZProjMatrix,re,q,ee,te.materialOverrides,_e);re++}if(q.sort((te,ge)=>ge.depth-te.depth),p.renderPass!=="shadow")m1(p,c,q,ee,j),L();else{for(let te of ee)Xa(te.mesh,te.nodeModelMatrix,p,c);for(let te of q)Xa(te.mesh,te.nodeModelMatrix,p,c);L()}}},rg={line:function(p,o,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){let f=o.getVisibleCoordinates();for(let _ of f){let y=o.getTile(_).getBucket(p);if(y&&(y.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,o,c){let f=o.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Lp(c,p)));if(f.type==="batched-model"||f.type!=="model")return;let _=f.getModels();for(let y of _)y.upload(c.context)},raster:function(p,o,c){let f=o.getSource();if(!(f instanceof ss&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)},"raster-particle":function(p,o,c){let f=o.getSource();if(!(f instanceof ss&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)}},ta={fill:Hm},og={fill:function(p,o,c,f){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let _=p.context.gl,y=new Gt(_.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),x=new ln({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),w=p.transform.getFreeCameraOptions().position,S=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(let M of f){let A=o.getTile(M),L=A.getBucket(c);if(!L)continue;let F=L.elevatedStructures;if(!F||F.depthSegments.segments[0].primitiveLength===0)continue;let N=r1(M.toUnwrapped(),w),j=p.translatePosMatrix(M.projMatrix,A,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),U=od(j,N,0,1,0);S.draw(p,_.TRIANGLES,y,x,yn.disabled,an.disabled,U,c.id,F.vertexBuffer,F.indexBuffer,F.depthSegments,c.paint,p.transform.zoom)}}};class sg{constructor(o,c,f,_,y){this.context=new sh(o,c),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;for(let S of x);this.occlusionParams=new lh,this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Zd(this),this._wireframeDebugCache=new ru,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let w=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,w,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=y,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,c){let f=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qv(this,o));let _=this._terrain;this.transform.elevation=f?_:null,_.update(o,this.transform,c),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(o){let c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,_]=c.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);let y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Qv(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,c){if(this.width=o*r.o.devicePixelRatio,this.height=c*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let o=this.context,c=new r.bd;c.emplaceBack(0,0),c.emplaceBack(r.al,0),c.emplaceBack(0,r.al),c.emplaceBack(r.al,r.al),this.tileExtentBuffer=o.createVertexBuffer(c,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);let f=new r.bd;f.emplaceBack(0,0),f.emplaceBack(r.al,0),f.emplaceBack(0,r.al),f.emplaceBack(r.al,r.al),this.debugBuffer=o.createVertexBuffer(f,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);let _=new r.bd;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);let y=new r.b1;y.emplaceBack(0,0,0,0),y.emplaceBack(r.al,0,r.al,0),y.emplaceBack(0,r.al,0,r.al),y.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=o.createVertexBuffer(y,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);let x=new r.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(x);let w=new r.be;for(let M of[0,1,3,2,0])w.emplaceBack(M);this.debugIndexBuffer=o.createIndexBuffer(w),this.emptyTexture=new r.T(o,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=r.bC();let S=this.context.gl;this.stencilClearMode=new ln({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Gt.disabled,this.stencilClearMode,yn.disabled,an.disabled,Ip(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,f){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(let S of f)if(this._tileClippingMaskIDs[S.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=c.id;let _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(yn.disabled),_.setDepthMode(Gt.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let w of f){let S=c.getTile(w),M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:L,tileBoundsSegments:F}=this.getTileBoundsBuffers(S);x.draw(this,y.TRIANGLES,Gt.disabled,new ln({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,an.disabled,Ip(w.projMatrix),"$clipping",A,L,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,c=this.context.gl;return new ln({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let c=this.context.gl;return new ln({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){let c=this.context.gl,f=o.sort((x,w)=>w.overscaledZ-x.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let w=0;w<y;w++)x[w+_]=new ln({func:c.GEQUAL,mask:255},w+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=y,[x,f]}return[{[_]:ln.disabled},f]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new yn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yn.unblended:yn.alphaBlended}colorModeForDrapableLayerRenderPass(o){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new yn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new yn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],r.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,c,f,_=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Gt.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Gt(f||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let o=this.context.gl,c=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&f!==0&&(this.depthFBO=new i1(this.context,c,f,0,"texture"),this.depthTexture=new r.T(this.context,{width:c,height:f,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),o.bindTexture(o.TEXTURE_2D,y),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,c,f,0,0,c,f,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,c)=>o+c/this._fpsHistory.length,0))}render(o,c){let f=r.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=c;let _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Fe=>{let be=_[Fe];return!(be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[be.type]}),w=x(),S=!1,M=!1,A=null,L=0,F=!1;for(let Fe of w){let be=_[Fe];be.visibility!=="none"&&(be.type==="circle"?S=!0:be.type==="building"?(A=be,++L):be.type==="symbol"&&(be.hasOcclusionOpacityProperties?M=!0:S=!0))}this.updateEmissiveMode();let N=w.map(Fe=>_[Fe]),j=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();for(let Fe in j){let be=j[Fe];be.used&&(be.prepare(this.context),be.getSource().usedInConflation&&++L)}let U=!1;for(let Fe of N)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(U=!0),this.prepareLayer(Fe));let W={},q={},ee={},re={},te={};for(let Fe in j){let be=j[Fe];W[Fe]=be.getVisibleCoordinates(),q[Fe]=W[Fe].slice().reverse(),ee[Fe]=be.getVisibleCoordinates(!0).reverse(),re[Fe]=be.getShadowCasterCoordinates(),te[Fe]=be.sortCoordinatesByDistance(W[Fe])}let ge=Fe=>{let be=this.style.getLayerSourceCache(Fe);return be&&be.used?be.getSource():null};if(L||U||this._clippingActiveLastFrame){let Fe=[],be=[],Ge=0;for(let Le of N)this.isSourceForClippingOrConflation(Le,ge(Le))&&(Fe.push(Le),be.push(Ge)),Ge++;if(Fe&&(U||Fe.length>1)||this._clippingActiveLastFrame){U=!1;let Le=[];for(let tt=0;tt<Fe.length;tt++){let xt=Fe[tt],Dt=be[tt],_t=this.style.getLayerSourceCache(xt);if(!_t||!_t.used||!_t.getSource().usedInConflation&&xt.type!=="clip"&&xt.type!=="building")continue;let pt=r.eQ,Ut=r.b_.None,zt=[],Tt=!0;if(xt.type==="building")pt=r.eS;else if(xt.type==="clip"){pt=Dt;for(let Pt of xt.layout.get("clip-layer-types"))Ut|=Pt==="model"?r.b_.Model:Pt==="symbol"?r.b_.Symbol:r.b_.FillExtrusion;for(let Pt of xt.layout.get("clip-layer-scope"))zt.push(Pt);xt.isHidden(this.transform.zoom)?Tt=!1:U=!0}Tt&&Le.push({layer:xt.fqid,cache:_t,order:pt,clipMask:Ut,clipScope:zt})}this.replacementSource.setSources(Le),F=!0}}this._clippingActiveLastFrame=U,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<N.length;Fe++){let be=N[Fe];if(be.visibility==="none")continue;let Ge=be.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){let Le=ge(be);Le&&(this.minCutoffZoom=Math.max(Le.minzoom,this.minCutoffZoom)),be.minzoom&&(this.minCutoffZoom=Math.max(be.minzoom,this.minCutoffZoom))}be.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}let de=this.style&&this.style.fog;de?(this._fogVisible=de.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=de.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,w=x(),N=w.map(Fe=>_[Fe]));let fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(let Fe in j)for(let be of W[Fe]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(be)||Ge),fe.addShadowReceiver(be.toUnwrapped(),Ge.min,Ge.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new h1(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ue&&!this._snow&&(this._snow=new f0(this)),!ue&&this._snow&&(this._snow.destroy(),delete this._snow),ae&&!this._rain&&(this._rain=new ig(this)),!ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),A){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Qm);let Fe=this.style.getLayerSourceCache(A);this.buildingTileBorderManager.updateBorders(Fe,A)}if(!zs.has(this.context.gl))return;this.renderPass="offscreen";for(let Fe of N){let be=o.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;let Ge=be?q[be.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Ge&&Ge.length)&&this.renderLayer(this,be,Fe,Ge)}this.depthRangeFor3D=[0,1-(N.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Te=(()=>{if(c.showOverdrawInspector)return r.ao.black;let Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){let be=this.style.getLut(Fe.scope);if(!_e){let Ge=Fe.properties.get("color-use-theme")==="none",Le=Fe.properties.get("color").toNonPremultipliedRenderColor(Ge?null:be).toArray01();return new r.ao(...Le)}if(_e){let Ge=Fe.properties.get("space-color-use-theme")==="none",Le=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Ge?null:be).toArray01();return new r.ao(...Le)}}return r.ao.transparent})();if(this.context.clear({color:Te,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);if(Fe.isSky())continue;let Ge=be?(Fe.is3D(y)?te:q)[be.id]:void 0;this._renderTileClippingMasks(Fe,be,Ge),this.renderLayer(this,be,Fe,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,be,Fe,be?q[be.id]:void 0)}function Ce(Fe,be){let Ge;return be&&(Ge=(Fe.type==="symbol"?ee:Fe.is3D(y)?te:q)[be.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){let Fe=N[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){let be=o.getLayerSourceCache(Fe);this.renderLayer(this,be,Fe,Ce(Fe,be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;fe&&(Be=fe.getShadowCastingLayerCount());let Ue=!1,Ye=-1;for(let Fe=0;Fe<w.length;++Fe){let be=N[Fe];be.isHidden(this.transform.zoom)||be.is3D(y)&&(Ye=Fe)}M&&Ye===-1&&(S=!0);let dt=!1;for(;this.currentLayer<w.length;){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&Fe.is3D(y)&&!y){let Ge=this.currentLayer,Le=tt=>{for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){let xt=N[this.currentLayer];if(ta[xt.type]){let Dt=this.style.getLayerSourceCache(xt);ta[xt.type](this,Dt,xt,Ce(xt,Dt),tt)}}};Le("initialize"),Le("reset"),this.currentLayer=Ge,dt=!0}if(S&&!Ue&&this.terrain&&!this.transform.isOrthographic&&(Ue=!0,this.blitDepth()),M&&Ye!==-1&&this.currentLayer===Ye+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,be,be?W[be.id]:void 0),this.renderLayer(this,be,Fe,Ce(Fe,be)),!this.terrain&&fe&&Be>0&&Fe.hasShadowPass()&&--Be==0){{this.clearStencil(),this.resetStencilClippingMasks();let Ge=this.currentLayer;for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){let Le=N[this.currentLayer];if(og[Le.type]){let tt=this.style.getLayerSourceCache(Le);og[Le.type](this,tt,Le,Ce(Le,tt))}}this.currentLayer=Ge}if(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){let Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){let Le=N[this.currentLayer];if(!Le.hasLightBeamPass())continue;let tt=o.getLayerSourceCache(Le);this.renderLayer(this,tt,Le,tt?q[tt.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Ge=this.currentLayer;this.depthOcclusion=!0;for(let Le of this.layersWithOcclusionOpacity){this.currentLayer=Le;let tt=N[this.currentLayer],xt=o.getLayerSourceCache(tt),Dt=xt?q[xt.id]:void 0;this.terrain||this._renderTileClippingMasks(tt,xt,xt?W[xt.id]:void 0),this.renderLayer(this,xt,tt,Dt)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;N.forEach(be=>{let Ge=o.getLayerSourceCache(be);Ge&&!be.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Ge.getSource().maxzoom)&&(Fe=Ge)}),Fe&&this.options.showTileBoundaries&&gt(this,Fe,Fe.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Fe){let be=Fe.transform.padding;ud(Fe,Fe.transform.height-(be.top||0),3,a1),ud(Fe,be.bottom||0,3,l1),gr(Fe,be.left||0,3,c1),gr(Fe,Fe.transform.width-(be.right||0),3,ld);let Ge=Fe.transform.centerPoint;(function(Le,tt,xt,Dt){Oe(Le,tt-1,xt-10,2,20,Dt),Oe(Le,tt-10,xt-1,20,2,Dt)})(Fe,Ge.x,Fe.transform.height-Ge.y,cd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:c}=this.transform.projection,f=!c||!c.includes(o.type);if(rg[o.type]&&(f||this.terrain&&o.type==="custom")){let _=this.style.getLayerSourceCache(o);rg[o.type](o,_,this)}this.gpuTimingEnd()}renderLayer(o,c,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(f.type)&&(!o.terrain||f.type!=="custom")||f.type==="clip"||ou[f.type](o,c,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,f=this.context.gl,_=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,c=this.context.gl,f=c.createQuery();this.deferredRenderGpuTimeQueries.push(f),c.beginQuery(o.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let c={};for(let f in o){let _=o[f],y=this.context.extTimerQuery,x=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),c[f]=x}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.gl,f=0;for(let _ of o)f+=c.getQueryParameter(_,c.QUERY_RESULT)/1e6,c.deleteQuery(_);return f}translatePosMatrix(o,c,f,_,y){if(!f[0]&&!f[1])return o;let x=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(x){let M=Math.sin(x),A=Math.cos(x);f=[f[0]*A-f[1]*M,f[0]*M+f[1]*A]}let w=[y?f[0]:r.ay(c,f[0],this.transform.zoom),y?f[1]:r.ay(c,f[1],this.transform.zoom),0],S=new Float32Array(16);return r.br(S,o,w),S}saveTileTexture(o){if(o.context!==this.context)return;let c=o.size[0],f=this._tileTextures[c];f?f.push(o):this._tileTextures[c]=[o]}getTileTexture(o){let c=this._tileTextures[o];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,c,f){let _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||c!==void 0&&!c||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(o,c){this.cache=this.cache||{};let f=c&&c.defines||[],_=c&&c.config,y=this.currentGlobalDefines(o,c&&c.overrideFog,c&&c.overrideRtt).concat(f),x=Gb.cacheKey(Bv[o],o,y,_);return this.cache[x]||(this.cache[x]=new Gb(this.context,o,Bv[o],_,$m[o],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,c){if(this.style.enable3dLights()){let f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){let y=((x,w,S)=>{let M=x.properties.get("direction"),A=x.properties.get("color-use-theme")==="none",L=x.properties.get("color").toNonPremultipliedRenderColor(A?null:S.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),N=w.properties.get("color-use-theme")==="none",j=w.properties.get("color").toNonPremultipliedRenderColor(N?null:S.getLut(w.scope)).toArray01(),U=w.properties.get("intensity"),W=[M.x,M.y,M.z],q=r.dN(j,U),ee=r.dN(L,F);return{u_lighting_ambient_color:q,u_lighting_directional_dir:W,u_lighting_directional_color:ee,u_ground_radiance:ih(W,ee,q)}})(f,_,this.style);c.setLightsUniformValues(o,y)}}}uploadCommonUniforms(o,c,f,_,y){if(this.uploadCommonLightUniforms(o,c),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let w=x.getOpacity(this.transform.pitch),S=((M,A,L,F,N,j,U,W,q,ee,re,te)=>{let ge=M.transform,de=A.properties.get("color-use-theme")==="none",fe=A.properties.get("color").toNonPremultipliedRenderColor(de?null:M.style.getLut(A.scope)).toArray01();fe[3]=F;let ue=M.frameCounter/1e3%1,[ae,_e]=A.properties.get("vertical-range");return{u_fog_matrix:L?ge.calculateFogTileMatrix(L):te||M.identityMat,u_fog_range:A.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ae,_e),_e],u_fog_temporal_offset:ue,u_frustum_tl:N,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:W,u_globe_pos:q,u_globe_radius:ee,u_viewport:re,u_globe_transition:r.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,f,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],_);c.setFogUniformValues(o,S)}y&&c.setCutoffUniformValues(o,y.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let _ of f)c[_.key]=o[_.key]||new Qu(_,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,c){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[o.key];return c||(this._cachedTileFogOpacities[o.key]=c=this.style.fog.getOpacityForTile(o)),c[0]>=Xe||c[1]>=Xe}setupDepthForOcclusion(o,c,f){let _=this.context,y=_.gl,x=!!f;var w;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),x||c.setTerrainUniformValues(_,f)}updateEmissiveMode(){if(this._forceEmissiveMode)return;let o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function ag(p,o){let c=!1,f=null,_=()=>{f=null,c&&(p(),f=setTimeout(_,o),c=!1)};return()=>(c=!0,f||_(),f)}class m0{constructor(o){this._hashName=o&&encodeURIComponent(o),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ag(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let c=Xr(o);if(this._hashName){let f=this._hashName,_=!1,y=location.hash.slice(1).split("&").map(x=>{let w=x.split("=")[0];return w===f?(_=!0,`${w}=${c}`):x}).filter(x=>x);return _||y.push(`${f}=${c}`),`#${y.join("&")}`}return`#${c}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(Number(f)))){let f=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Xr(p,o){let c=p.getCenter(),f=Math.round(100*p.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),x=Math.round(c.lng*y)/y,w=Math.round(c.lat*y)/y,S=p.getBearing(),M=p.getPitch(),A=o?`/${x}/${w}/${f}`:`${f}/${w}/${x}`;return(S||M)&&(A+="/"+Math.round(10*S)/10),M&&(A+=`/${Math.round(M)}`),A}let uh={linearity:.3,easing:r.eT(0,0,.3,1)},g0=Object.assign({deceleration:2500,maxSpeed:1400},uh),_0=Object.assign({deceleration:20,maxSpeed:1400},uh),fd=Object.assign({deceleration:1e3,maxSpeed:360},uh),v0=Object.assign({deceleration:1e3,maxSpeed:90},uh);class y0{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,c=r.o.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)c.zoom+=y.zoomDelta||0,c.bearing+=y.bearingDelta||0,c.pitch+=y.pitchDelta||0,y.panDelta&&c.pan._add(y.panDelta),y.around&&(c.around=y.around),y.pinchAround&&(c.pinchAround=y.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){let y=Sl(c.pan.mag(),f,Object.assign({},g0,o||{}));_.offset=c.pan.mult(y.amount/c.pan.mag()),_.center=this._map.transform.center,dh(_,y)}if(c.zoom){let y=Sl(c.zoom,f,_0);_.zoom=this._map.transform.zoom+y.amount,dh(_,y)}if(c.bearing){let y=Sl(c.bearing,f,fd);_.bearing=this._map.transform.bearing+r.aA(y.amount,-179,179),dh(_,y)}if(c.pitch){let y=Sl(c.pitch,f,v0);_.pitch=this._map.transform.pitch+y.amount,dh(_,y)}if(_.zoom||_.bearing){let y=c.pinchAround===void 0?c.around:c.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function dh(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function Sl(p,o,c){let{maxSpeed:f,linearity:_,deceleration:y}=c,x=r.aA(p*_/(o/1e3),-f,f),w=Math.abs(x)/(y*_);return{easing:c.easing,duration:1e3*w,amount:x*(w/2)}}class Ds extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f,_={}){let y=Or(c.getCanvasContainer(),f),x=c.unproject(y);super(o,Object.assign({point:y,lngLat:x,originalEvent:f},_)),this._defaultPrevented=!1,this.target=c}}class su extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){let _=o==="touchend"?f.changedTouches:f.touches,y=Ho(c.getCanvasContainer(),_),x=y.map(S=>c.unproject(S)),w=y.reduce((S,M,A,L)=>S.add(M.div(L.length)),new r.P(0,0));super(o,{points:y,point:w,lngLats:x,lngLat:c.unproject(w),originalEvent:f}),this._defaultPrevented=!1}}class x0 extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class lg{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new x0(this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Ds(o.type,this._map,o))}mouseup(o){this._map.fire(new Ds(o.type,this._map,o))}preclick(o){let c=new MouseEvent("preclick",o);this._map.fire(new Ds(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Ds(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Ds(o.type,this._map,o))}mouseover(o){this._map.fire(new Ds(o.type,this._map,o))}mouseout(o){this._map.fire(new Ds(o.type,this._map,o))}touchstart(o){return this._firePreventable(new su(o.type,this._map,o))}touchmove(o){this._map.fire(new su(o.type,this._map,o))}touchend(o){this._map.fire(new su(o.type,this._map,o))}touchcancel(o){this._map.fire(new su(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class b0{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Ds(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Ds(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cg{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(Vn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;let f=c,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ke("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let x=Math.min(_.x,f.x),w=Math.max(_.x,f.x),S=Math.min(_.y,f.y),M=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${S}px)`,this._box.style.width=w-x+"px",this._box.style.height=M-S+"px")})}mouseupWindow(o,c){if(!this._active)return;let f=this._startPos,_=c;if(f&&o.button===0){if(this.reset(),Li(),f.x!==_.x||f.y!==_.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:o})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),sr(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new r.z(o,{originalEvent:c}))}}function ug(p,o){let c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=o[f];return c}class y1{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=(function(_){let y=new r.P(0,0);for(let x of _)y._add(x);return y.div(_.length)})(c),this.touches=ug(f,c)))}touchmove(o,c,f){if(this.aborted||!this.centroid)return;let _=ug(f,c);for(let y in this.touches){let x=_[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(o,c,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class dg{constructor(o){this.singleTap=new y1(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,f){this.singleTap.touchstart(o,c,f)}touchmove(o,c,f){this.singleTap.touchmove(o,c,f)}touchend(o,c,f){let _=this.singleTap.touchend(o,c,f);if(_){let y=o.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(_)<30;if(y&&x||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class x1{constructor(){this._zoomIn=new dg({numTouches:1,numTaps:2}),this._zoomOut=new dg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,f){this._zoomIn.touchstart(o,c,f),this._zoomOut.touchstart(o,c,f)}touchmove(o,c,f){this._zoomIn.touchmove(o,c,f),this._zoomOut.touchmove(o,c,f)}touchend(o,c,f){let _=this._zoomIn.touchend(o,c,f),y=this._zoomOut.touchend(o,c,f);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(_)},{originalEvent:o})}):y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let b1={0:1,2:2},w0={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class hg{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;let f=Ys(o);this._correctButton(o,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(o,c){let f=this._lastPoint;if(f){if(o.preventDefault(),this._eventButton!=null&&(function(_,y){let x=b1[y];return _.buttons===void 0||(_.buttons&x)!==x})(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(o){this._lastPoint&&Ys(o)===this._eventButton&&(this._moved&&Li(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class w1 extends hg{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class C0 extends hg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?w0[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=.8*(c.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class E0 extends hg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?w0[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=-.5*(c.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class C1{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,c,f){return this._calculateTransform(o,c,f)}touchmove(o,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,f)}}touchend(o,c,f){this._calculateTransform(o,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,f){f.length>0&&(this._active=!0);let _=ug(f,c),y=new r.P(0,0),x=new r.P(0,0),w=0;for(let M in _){let A=_[M],L=this._touches[M];L&&(y._add(A),x._add(A.sub(L)),w++,_[M]=A)}if(this._touches=_,w<this._minTouches||!x.mag())return;let S=x.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(w),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ke("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class pg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,f){return{}}touchstart(o,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,f){let _=this._firstTwoTouches;if(!_)return;o.preventDefault();let[y,x]=_,w=zp(f,c,y),S=zp(f,c,x);if(!w||!S)return;let M=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],M,o)}touchend(o,c,f){if(!this._firstTwoTouches)return;let[_,y]=this._firstTwoTouches,x=zp(f,c,_),w=zp(f,c,y);x&&w||(this._active&&Li(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zp(p,o,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return o[f]}function E1(p,o){return Math.log2(p/o)}class sI extends pg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){let f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(E1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:E1(this._distance,f),pinchAround:c}}}function S1(p,o){return 180*p.angleWith(o)/Math.PI}class nr extends pg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){let f=this._vector;if(this._vector=o[0].sub(o[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:S1(this._vector,f),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let _=S1(o,f);return Math.abs(_)<c}}function fg(p){return Math.abs(p.y)>Math.abs(p.x)}class aI extends pg{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,fg(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,f){let _=this._lastPoints;if(!_)return;let y=o[0].sub(_[0]),x=o[1].sub(_[1]);return this._map._cooperativeGestures&&!r.eU()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,f.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(o,c,f){if(this._valid!==void 0)return this._valid;let _=o.mag()>=2,y=c.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let x=o.y>0==c.y>0;return fg(o)&&fg(c)&&x}}let lI={panStep:100,bearingStep:15,pitchStep:10};class cI{constructor(){let o=lI;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,f=0,_=0,y=0,x=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),y=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),y=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),x=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:w=>{let S=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Bp,zoom:c?Math.round(S)+c*(o.shiftKey?2:1):S,bearing:w.getBearing()+f*this._bearingStep,pitch:w.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bp(p){return p*(2-p)}let S0=4.000244140625,T0=1/450;class mg{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=T0,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,f=r.o.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%S0==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=Or(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>S0?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);let L=c(),F=Math.pow(2,L),N=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(N*A))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,y=this._easing,x,w=!1;if(this._type==="wheel"&&_&&y){let M=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),A=y(M);x=r.ak(_,f,A),M<1?this._frameId||(this._frameId=!0):w=!0}else x=f,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=x-c();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=r.eV;if(this._prevEase){let f=this._prevEase,_=(r.o.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),x=.27/Math.sqrt(y*y+1e-4)*.01,w=Math.sqrt(.0729-x*x);c=r.eT(x,w,.25,1)}return this._prevEase={start:r.o.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ke("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class sc{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kr{constructor(){this._tap=new dg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,c,f))}touchmove(o,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let _=c[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(o,c,f)}touchend(o,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(o,c,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl{constructor(o,c,f){this._el=o,this._mousePan=c,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vp{constructor(o,c,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _g{constructor(o,c,f,_){this._el=o,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Up=p=>p.zoom||p.drag||p.pitch||p.rotate;class uI extends r.z{}class jp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){let f=r.av([],c,o);this.radius=r.ag(f[2]<0?r.eX([],f,this.constants):[f[0],f[1],0])}projectRay(o){r.eX(o,o,this.constants),r.aw(o,o),r.eY(o,o,this.constants);let c=r.c5([],o,this.radius);if(c[2]>0){let f=r.c5([],[0,0,1],r.bJ(c,[0,0,1])),_=r.c5([],r.aw([],[c[0],c[1],0]),this.radius),y=r.d8([],c,r.c5([],r.av([],r.d8([],_,f),c),2));c[0]=y[0],c[1]=y[1]}return c}}function vg(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class dI{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new y0(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.aY(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,y,x]of this._listeners){let w=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,w,x)}}destroy(){for(let[o,c,f]of this._listeners){let _=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(c,_,f)}}_addDefaultHandlers(o){let c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new lg(c,o));let _=c.boxZoom=new cg(c,o);this._add("boxZoom",_);let y=new x1,x=new gg;c.doubleClickZoom=new sc(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let w=new Kr;this._add("tapDragZoom",w);let S=c.touchPitch=new aI(c);this._add("touchPitch",S);let M=new C0(o),A=new E0(o);c.dragRotate=new Vp(o,M,A),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);let L=new w1(o),F=new C1(c,o);c.dragPan=new Tl(f,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]);let N=new nr,j=new sI;c.touchZoomRotate=new _g(f,j,N,w),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new b0(c));let U=c.scrollZoom=new mg(c,this);this._add("scrollZoom",U,["mousePan"]);let W=c.keyboard=new cI;this._add("keyboard",W);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[q]&&c[q].enable(o[q])}_add(o,c,f){this._handlers.push({handlerName:o,handler:c,allowed:f}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Up(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,f){for(let _ in o)if(_!==f&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let c=[];for(let f of o)this._el.contains(f.target)&&c.push(f);return c}handleEvent(o,c){this._updatingCamera=!0;let f=o.type==="renderFrame",_=f?void 0:o,y={needsRenderFrame:!1},x={},w={},S=o.touches?this._getMapTouches(o.touches):void 0,M=S?Ho(this._el,S):f?void 0:Or(this._el,o);for(let{handlerName:F,handler:N,allowed:j}of this._handlers){if(!N.isEnabled())continue;let U;this._blockedByActive(w,j,F)?N.reset():N[c||o.type]&&(U=N[c||o.type](o,M,S),this.mergeHandlerResult(y,x,U,F,_),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||N.isActive())&&(w[F]=N)}let A={};for(let F in this._previousActiveHandlers)w[F]||(A[F]=_);this._previousActiveHandlers=w,(Object.keys(A).length||vg(y))&&(this._changes.push([y,x,A]),this._triggerRenderFrame()),(Object.keys(w).length||vg(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:L}=y;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(o,c,f,_,y){if(!f)return;Object.assign(o,f);let x={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(c.zoom=x),f.panDelta!==void 0&&(c.drag=x),f.pitchDelta!==void 0&&(c.pitch=x),f.bearingDelta!==void 0&&(c.rotate=x)}_applyChanges(){let o={},c={},f={};for(let[_,y,x]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),Object.assign(c,y),Object.assign(f,x);this._updateMapTransform(o,c,f),this._changes=[]}_updateMapTransform(o,c,f){let _=this._map,y=_.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{let re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!vg(o)){let ee=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ee!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!vg(o))return void this._fireEvents(c,f,!0);let{panDelta:w,zoomDelta:S,bearingDelta:M,pitchDelta:A,around:L,aroundCoord:F,pinchAround:N}=o;y._isCameraConstrained&&(S>0&&(S=0),y._isCameraConstrained=!1),N!==void 0&&(L=N),(S||(ee=>c[ee]&&!this._eventsInProgress[ee])("drag"))&&L&&(this._dragOrigin=x(y.pointCoordinate3D(L)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),L=L||_.transform.centerPoint,M&&(y.bearing+=M),A&&(y.pitch+=A),y._updateCameraState();let j=[0,0,0];if(w)if(y.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L).dir),re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L.sub(w)).dir);j[0]=re[0]-ee[0],j[1]=re[1]-ee[1]}else{let ee=y.pointCoordinate(L);if(y.projection.name==="globe"){w=w.rotate(-y.angle);let re=y._pixelsPerMercatorPixel/y.worldSize;j[0]=-w.x*r.eW(r.a$(ee.y))*re,j[1]=-w.y*r.eW(y.center.lat)*re}else{let re=y.pointCoordinate(L.sub(w));ee&&re&&(j[0]=re.x-ee.x,j[1]=re.y-ee.y)}}let U=y.zoom,W=[0,0,0];if(S){let ee=x(F||y.pointCoordinate3D(L)),re={dir:r.aw([],r.av([],ee,y._camera.position))};if(re.dir[2]<0){let te=y.zoomDeltaToMovement(ee,S);r.c5(W,re.dir,te)}}let q=r.d8(j,j,W);y._translateCameraConstrained(q),S&&Math.abs(y.zoom-U)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,f,!0)}_fireEvents(o,c,f){let _=Up(this._eventsInProgress),y=Up(o),x={};for(let A in o){let{originalEvent:L}=o[A];this._eventsInProgress[A]||(x[`${A}start`]=L),this._eventsInProgress[A]=o[A]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(let A in x)this._fireEvent(A,x[A]);y&&this._fireEvent("move",y.originalEvent);for(let A in o){let{originalEvent:L}=o[A];this._fireEvent(A,L)}let w={},S;for(let A in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[A];this._handlersById[L].isActive()||(delete this._eventsInProgress[A],S=c[L]||F,w[`${A}end`]=S)}for(let A in w)this._fireEvent(A,w[A]);let M=Up(this._eventsInProgress);if(f&&(_||y)&&!M){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;A?(L(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:S})):(this._map.fire(new r.z("moveend",{originalEvent:S})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new r.z(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new uI("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let yg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class I0 extends r.E{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,f){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},c),f)}panTo(o,c,f){return this.easeTo(Object.assign({center:o},c),f)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,f){return this.easeTo(Object.assign({zoom:o},c),f)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,f){return this.easeTo(Object.assign({bearing:o},c),f)}resetNorth(o,c){return this.rotateTo(0,Object.assign({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=r.aI.convert(o);let f=c&&c.bearing||0,_=c&&c.pitch||0,y=o.getNorthWest(),x=o.getSouthEast();return this._cameraForBounds(this.transform,y,x,f,_,c)}_extendPadding(o){let c={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},c,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},c,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,c){let f=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return f/_>o.aspect?f/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,f,_,y,x){let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=r.aT.convert(c),A=r.aT.convert(f),L=.5*(M.lat+A.lat),F=.5*(M.lng+A.lng),N=r.eZ(L,F),j=r.aw([],N),U=r.aw([],r.bI([],j,[0,1,0])),W=r.bI([],U,j),q=[U[0],U[1],U[2],0,W[0],W[1],W[2],0,j[0],j[1],j[2],0,0,0,0,1],ee=[N,r.eZ(M.lat,M.lng),r.eZ(A.lat,M.lng),r.eZ(A.lat,A.lng),r.eZ(M.lat,A.lng),r.eZ(L,M.lng),r.eZ(L,A.lng),r.eZ(M.lat,F),r.eZ(A.lat,F)],re=r.d9.fromPoints(ee.map(Le=>[r.bJ(U,Le),r.bJ(W,Le),r.bJ(j,Le)])),te=r.af([],re.center,q);r.e_(te)===0&&r.e$(te,0,0,1),r.aw(te,te),r.c5(te,te,r.aD),w.center=r.f0(te);let ge=w.getWorldToCameraMatrix(),de=r.bl(new Float64Array(16),ge);re=r.d9.applyTransform(re,r.aB([],ge,q));let fe=this._extendAABB(re,w,S,_);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=fe,r.af(te,te,ge);let ue=.5*(re.max[2]-re.min[2]),ae=this._minimumAABBFrustumDistance(w,re),_e=r.c5([],[0,0,1],ue),Te=r.d8(_e,te,_e),Ce=ae+(w.pitch===0?0:r.bG(te,Te)),Be=w.globeCenterInViewSpace,Ue=r.av([],te,[Be[0],Be[1],Be[2]]);r.aw(Ue,Ue),r.c5(Ue,Ue,Ce);let Ye=r.d8([],te,Ue);r.af(Ye,Ye,de);let dt=r.eM/r.aD,Fe=r.ag(Ye),be=r.cf(Math.max(Fe*dt-r.eM,Number.EPSILON),0),Ge=Math.min(w.zoomFromMercatorZAdjusted(be),S.maxZoom);return Ge>.5*(r.c_+r.cL)?(w.setProjection({name:"mercator"}),w.zoom=Ge,this._cameraForBounds(w,c,f,_,y,x)):{center:w.center,zoom:Ge,bearing:_,pitch:y}}_extendAABB(o,c,f,_){let y=.5*((f.padding.left||0)+(f.padding.right||0)),x=.5*((f.padding.top||0)+(f.padding.bottom||0)),w=x,S=y,M=y,A=x,L=c.width-(S+M),F=c.height-(w+A),N=r.av([],o.max,o.min),j=Math.min(L/N[0],F/N[1]),U=Math.min(c.scaleZoom(c.scale*j),f.maxZoom);if(isNaN(U))return null;let W=c.scale/c.zoomScale(U),q=new r.d9([o.min[0]-S*W,o.min[1]-A*W,o.min[2]],[o.max[0]+M*W,o.max[1]+w*W,o.max[2]]),ee=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new r.P(f.offset.x,f.offset.y):r.P.convert(f.offset)).rotate(-r.an(_));return q.center[0]-=ee.x*W,q.center[1]+=ee.y*W,q}queryTerrainElevation(o,c){let f=this.transform.elevation;return f?(c=Object.assign({},{exaggerated:!0},c),f.getAtPoint(r.ae.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,f,_,y,x){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,f,_,y,x);let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=r.aT.convert(c),A=r.aT.convert(f),L=new r.aT(M.lng,A.lat),F=new r.aT(A.lng,M.lat),N=w.project(M),j=w.project(A),U=this.queryTerrainElevation(M),W=this.queryTerrainElevation(A),q=this.queryTerrainElevation(L),ee=this.queryTerrainElevation(F),re=[[N.x,N.y,Math.min(U||0,W||0,q||0,ee||0)],[j.x,j.y,Math.max(U||0,W||0,q||0,ee||0)]],te=r.d9.fromPoints(re),ge=w.getWorldToCameraMatrix(),de=r.bl(new Float64Array(16),ge);te=r.d9.applyTransform(te,ge);let fe=this._extendAABB(te,w,S,_);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=fe;let ue=.5*r.av([],te.max,te.min)[2],ae=this._minimumAABBFrustumDistance(w,te),_e=[0,0,1,0];r.aC(_e,_e,ge),r.f1(_e,_e);let Te=r.c5([],_e,ae+ue),Ce=r.d8([],te.center,Te);r.af(te.center,te.center,de),r.af(Ce,Ce,de);let Be=w.unproject(new r.P(te.center[0],te.center[1])),Ue=r.f2(w.projection,Be),Ye=Math.pow(2,Ue),dt=Math.min(w._zoomFromMercatorZ(Ce[2]*w.pixelsPerMeter*Ye/w.worldSize),S.maxZoom);return w.mercatorFromTransition&&dt<.5*(r.c_+r.cL)?(w.setProjection({name:"globe"}),w.zoom=dt,this._cameraForBounds(w,c,f,_,y,x)):{center:Be,zoom:dt,bearing:_,pitch:y}}fitBounds(o,c,f){let _=this.cameraForBounds(o,c);return this._fitInternal(_,c,f)}fitScreenCoordinates(o,c,f,_,y){let x=r.P.convert(o),w=r.P.convert(c),S=new r.P(Math.min(x.x,w.x),Math.min(x.y,w.y)),M=new r.P(Math.max(x.x,w.x),Math.max(x.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,w))return this;let A=this.transform.pointLocation3D(S),L=this.transform.pointLocation3D(M),F=this.transform.pointLocation3D(new r.P(S.x,M.y)),N=this.transform.pointLocation3D(new r.P(M.x,S.y)),j=[Math.min(A.lng,L.lng,F.lng,N.lng),Math.min(A.lat,L.lat,F.lat,N.lat)],U=[Math.max(A.lng,L.lng,F.lng,N.lng),Math.max(A.lat,L.lat,F.lat,N.lat)],W=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,j,U,f,W,_);return this._fitInternal(q,_,y)}_fitInternal(o,c,f){return o?(c=Object.assign(o,c)).linear?this.easeTo(c,f):this.flyTo(c,f):this}jumpTo(o,c){this.stop();let f=o.preloadOnly?this.transform.clone():this.transform,_=!1,y=!1,x=!1;"zoom"in o&&f.zoom!==+o.zoom&&(_=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=r.aT.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(y=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(x=!0,f.pitch=+o.pitch);let w=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!f.isPaddingEqual(w))if(o.retainPadding===!1){let S=f.clone();S.padding=w,f.setLocationAtPoint(f.center,S.centerPoint)}else f.padding=w;return o.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),_&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),y&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),x&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(yg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){let f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(yg),this;this.stop();let _=f.zoom,y=f.pitch,x=f.bearing;f.setFreeCameraOptions(o);let w=_!==f.zoom,S=y!==f.pitch,M=x!==f.bearing;return this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),w&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),M&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),S&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:r.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?+o.zoom:_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,L=this._extendPadding(o.padding),F=r.P.convert(o.offset),N,j,U;if(f.projection.name==="globe"){let _e=r.ae.fromLngLat(f.center),Te=F.rotate(-f.angle);_e.x+=Te.x/f.worldSize,_e.y+=Te.y/f.worldSize;let Ce=_e.toLngLat(),Be=r.aT.convert(o.center||Ce);this._normalizeCenter(Be),N=f.centerPoint.add(Te),j=new r.P(_e.x,_e.y).mult(f.worldSize),U=new r.P(r.aF(Be.lng),r.aJ(Be.lat)).mult(f.worldSize).sub(j)}else{N=f.centerPoint.add(F);let _e=f.pointLocation(N),Te=r.aT.convert(o.center||_e);this._normalizeCenter(Te),j=f.project(_e),U=f.project(Te).sub(j)}let W=f.zoomScale(S-_),q,ee;o.around&&(q=r.aT.convert(o.around),ee=f.locationPoint(q));let re=this._zooming||S!==_,te=this._rotating||y!==M,ge=this._pitching||A!==x,de=!f.isPaddingEqual(L),fe=o.retainPadding===!1?f.clone():f,ue=_e=>Te=>{if(re&&(_e.zoom=r.ak(_,S,Te)),te&&(_e.bearing=r.ak(y,M,Te)),ge&&(_e.pitch=r.ak(x,A,Te)),de&&(fe.interpolatePadding(w,L,Te),N=fe.centerPoint.add(F)),q)_e.setLocationAtPoint(q,ee);else{let Ce=_e.zoomScale(_e.zoom-_),Be=S>_?Math.min(2,W):Math.max(.5,W),Ue=Math.pow(Be,1-Te),Ye=_e.unproject(j.add(U.mult(Te*Ue)).mult(Ce));_e.setLocationAtPoint(_e.renderWorldCopies?Ye.wrap():Ye,N)}return o.preloadOnly||this._fireMoveEvents(c),_e};if(o.preloadOnly){let _e=this._emulate(ue,o.duration,f);return this._preloadTiles(_e),this}let ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=te,this._pitching=ge,this._padding=de,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,ae),this._ease(ue(f),_e=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(c,_e)},o),this}_prepareEase(o,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||f.moving||this.fire(new r.z("movestart",o)),this._zooming&&!f.zooming&&this.fire(new r.z("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new r.z("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new r.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.z("move",o)),this._zooming&&this.fire(new r.z("zoom",o)),this._rotating&&this.fire(new r.z("rotate",o)),this._pitching&&this.fire(new r.z("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new r.z("zoomend",o)),_&&this.fire(new r.z("rotateend",o)),y&&this.fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){let Le=r.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Le,c)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eV},o);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?r.aA(+o.zoom,f.minZoom,f.maxZoom):_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,L=this._extendPadding(o.padding),F=f.zoomScale(S-_),N=r.P.convert(o.offset),j=f.centerPoint.add(N),U=f.pointLocation(j),W=r.aT.convert(o.center||U);this._normalizeCenter(W);let q=f.project(U),ee=f.project(W).sub(q),re=o.curve,te=Math.max(f.width,f.height),ge=te/F,de=ee.mag();if("minZoom"in o){let Le=r.aA(Math.min(o.minZoom,_,S),f.minZoom,f.maxZoom),tt=te/f.zoomScale(Le-_);re=Math.sqrt(tt/de*2)}let fe=re*re;function ue(Le){let tt=(ge*ge-te*te+(Le?-1:1)*fe*fe*de*de)/(2*(Le?ge:te)*fe*de);return Math.log(Math.sqrt(tt*tt+1)-tt)}function ae(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function _e(Le){return(Math.exp(Le)+Math.exp(-Le))/2}let Te=ue(0),Ce=function(Le){return _e(Te)/_e(Te+re*Le)},Be=function(Le){return te*((_e(Te)*(ae(tt=Te+re*Le)/_e(tt))-ae(Te))/fe)/de;var tt},Ue=(ue(1)-Te)/re;if(Math.abs(de)<1e-6||!isFinite(Ue)){if(Math.abs(te-ge)<1e-6)return this.easeTo(o,c);let Le=ge<te?-1:1;Ue=Math.abs(Math.log(ge/te))/re,Be=function(){return 0},Ce=function(tt){return Math.exp(Le*re*tt)}}o.duration="duration"in o?+o.duration:1e3*Ue/("screenSpeed"in o?+o.screenSpeed/re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let Ye=y!==M,dt=A!==x,Fe=!f.isPaddingEqual(L),be=o.retainPadding===!1?f.clone():f,Ge=Le=>tt=>{let xt=tt*Ue,Dt=1/Ce(xt);Le.zoom=tt===1?S:_+Le.scaleZoom(Dt),Ye&&(Le.bearing=r.ak(y,M,tt)),dt&&(Le.pitch=r.ak(x,A,tt)),Fe&&(be.interpolatePadding(w,L,tt),j=be.centerPoint.add(N));let _t=tt===1?W:Le.unproject(q.add(ee.mult(Be(xt))).mult(Dt));return Le.setLocationAtPoint(Le.renderWorldCopies?_t.wrap():_t,j),Le._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Le};if(o.preloadOnly){let Le=this._emulate(Ge,o.duration,f);return this._preloadTiles(Le),this}return this._zooming=!0,this._rotating=Ye,this._pitching=dt,this._padding=Fe,this._prepareEase(c,!1),this._ease(Ge(f),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!o){let f=this.handlers;f&&f.stop(!1)}return this}_ease(o,c,f){f.animate===!1||f.duration===0?(o(1),c()):(this._easeStart=r.o.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=r.bT(o,-180,180);let f=Math.abs(o-c);return Math.abs(o-360-c)<f&&(o-=360),Math.abs(o+360-c)<f&&(o+=360),o}_normalizeCenter(o){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let f=o.lng-c.center.lng;o.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,f){let _=Math.ceil(15*c/1e3),y=[],x=o(f.clone());for(let w=0;w<=_;w++){let S=x(w/_);y.push(S.clone())}return y}_preloadTiles(o,c){}}class $p{constructor(o={}){this.options=o,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let c=this.options&&this.options.compact,f=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ke("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let _=ke("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=ke("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(o){let f=c.reduce((_,y,x)=>(y.value&&(_+=`${y.key}=${y.value}${x<c.length-1?"&":""}`),_),"?");o.href=`${r.e.FEEDBACK_URL}/${f}#${Xr(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let c=this._map.style._mergedSourceCaches;for(let _ in c){let y=c[_];if(y.used){let x=y.getSource();x.attribution&&o.indexOf(x.attribution)<0&&o.push(x.attribution)}}o.sort((_,y)=>_.length-y.length),o=o.filter((_,y)=>{for(let x=y+1;x<o.length;x++)if(o[x].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let f=o.map(_=>(function(y){let x=new DOMParser().parseFromString(y,"text/html");return Array.from(x.body.querySelectorAll("*")).forEach(w=>{let S=w.textContent||"";if(w.tagName!=="A")return void w.replaceWith(x.createTextNode(S));let M=w.getAttribute("href");if(!M||!/^(https?:|mailto:)/i.test(M))return void w.replaceWith(x.createTextNode(S));let A=x.createElement("a");A.href=M,A.textContent=S,A.rel="noopener nofollow";let L=w.getAttribute("class");L&&(A.className=L),w.replaceWith(A)}),x.body.innerHTML})(_)).join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hp{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=ke("div","mapboxgl-ctrl");let c=ke("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let c in o){let f=o[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class hh{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(o,c){let f=ke("button",o,this._container);return f.type="button",f.addEventListener("click",c),f}_createSeparator(){return ke("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,c){this._map&&(o.setAttribute("aria-label",c),o.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");let c=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(f=>f.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){let o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{let c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});ke("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){let o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,c){for(let f=0;f<o.length;f++){let _=o[f],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(y,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&c&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),f<o.length-1&&this._createSeparator()}}}class ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){let c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(let _ of f)if(_.id===o)return void(_.cancelled=!0)}run(o=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let f of c)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class lc{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let c=r.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,f){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+f}}let cc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class au extends r.z{constructor(o,c,f,_){let{point:y,lngLat:x,originalEvent:w,target:S}=o;super(o.type,{point:y,lngLat:x,originalEvent:w,target:S}),this.preventDefault=()=>{o.preventDefault()},this.id=c,this.interaction=f,this.feature=_}}class Ka{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,c){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);let f=c.filter,_=c.type;f&&this.filters.set(o,r.b6(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");let y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,c)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(o,c),this.typeById.set(o,_)}get(o){let c=this.typeById.get(o);if(!c)return;let f=this.interactionsByType.get(c);return f?f.get(o):void 0}remove(o){let c=this.typeById.get(o);if(!c)return;this.typeById.delete(o),this.filters.delete(o);let f=this.interactionsByType.get(c);f&&(f.delete(o),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(c,this.handleType))}queryTargets(o,c){let f=[];for(let[_,y]of c)y.target&&f.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(o,f,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let c=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());c.length&&(o.type="mouseenter",this.handleType(o,c));let f=new Map;for(let[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(y.id,y);f.size&&(o.type="mouseleave",this.handleType(o,Array.from(f.values())))}handleOut(o){let c=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);c.length&&(o.type="mouseleave",this.handleType(o,c)),this.hoveredFeatures.clear()}handleType(o,c){let f=o.type==="mouseenter";if(f&&!this.interactionsByType.has(o.type))return void r.w("mouseenter interaction required for mouseleave to work.");let _=Array.from(this.interactionsByType.get(o.type)).reverse(),y=!!c;c=c||this.queryTargets(o.point,_);let x=!1,w=new Set;for(let S of c){for(let[M,A]of _){if(!A.target)continue;let L=S.variants?S.variants[M]:null;if(L){for(let F of L){if(Hd(F,S,w,M))continue;let N=new r.dx(S,F),j=Xu(F,S,M);y&&N.id!==void 0&&(N.state=this.map.getFeatureState(N));let U=f?this.prevHoveredFeatures.get(j):null,W=new au(o,M,A,N),q=U?U.stop:A.handler(W);if(f&&this.hoveredFeatures.set(j,{feature:S,stop:q}),q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[S,M]of _){let{handler:A,target:L}=M;if(!L&&A(new au(o,S,M,null))!==!1)break}}}function hI(p,o){if(Array.isArray(p)&&Array.isArray(o)){let c=new Set(p),f=new Set(o);return c.size===f.size&&p.every(_=>f.has(_))}return r.by(p,o)}let pI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},fI={showCompass:!0,showZoom:!0,visualizePitch:!1};class mI{constructor(o,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new C0({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new E0({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Vn()}move(o,c){let f=this.map,_=this.mouseRotate.mousemoveWindow(o,c),y=_&&_.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(o,c),w=x&&x.pitchDelta;w&&f.setPitch(f.getPitch()+w)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){sr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Or(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Or(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ho(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Ho(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function M0(p,o,c){if(p=new r.aT(p.lng,p.lat),o){let f=new r.aT(p.lng-360,p.lat),_=new r.aT(p.lng+360,p.lat),y=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),x=c.locationPoint3D(p).distSqr(o),w=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint3D(f).distSqr(o)<x&&(w||Math.abs(f.lng-c.center.lng)<y)?p=f:c.locationPoint3D(_).distSqr(o)<x&&(w||Math.abs(_.lng-c.center.lng)<y)&&(p=_)}for(;Math.abs(p.lng-c.center.lng)>180;){let f=c.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}let Yo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ea={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class xg extends r.E{constructor(o,c){super(),(o instanceof HTMLElement||c)&&(o=Object.assign({element:o},c)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:f="center",color:_="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:w=0,rotation:S=Ea.rotation,rotationAlignment:M=Ea.rotationAlignment,pitchAlignment:A=Ea.pitchAlignment,occludedOpacity:L=Ea.occludedOpacity,altitude:F=Ea.altitude}=o||{};this._anchor=f,this._color=_,this._scale=y,this._draggable=x,this._clickTolerance=w,this._rotation=S,this._rotationAlignment=M,this._pitchAlignment=A,this._occludedOpacity=L,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",U=>{U.preventDefault()}),this._element.addEventListener("mousedown",U=>{U.preventDefault()});let N=this._element.classList;for(let U in Yo)N.remove(`mapboxgl-marker-anchor-${U}`);N.add(`mapboxgl-marker-anchor-${this._anchor}`);let j=o&&o.className?o.className.trim().split(/\s+/):[];N.add(...j),this._popup=null}_createDefaultMarker(){let o=ke("div"),c=ht("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){let f=ht("radialGradient",{id:"shadowGradient"},ht("defs",{},c));ht("stop",{offset:"10%","stop-opacity":.4},f),ht("stop",{offset:"100%","stop-opacity":.05},f),ht("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return ht("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),ht("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),ht("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Ea.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let c=o.code,f=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(o){let c=o.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,c=this._pos;if(!o||!c)return!1;let f=o.unproject(c,this._altitude),_=o.getFreeCameraOptions();if(!_.position)return!1;let y=_.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();let f=o.unproject(c,this._altitude),_;o._showingGlobe()&&r.f5(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(f),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Yo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let o=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!o||f!=="map")return"";if(!c._showingGlobe()){let S=c.getPitch();return S?`rotateX(${S}deg)`:""}let _=r.cX(r.f6(c.transform,this._lngLat)),y=o.sub(r.f7(c.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let w=_/x;return`rotateX(${-y.y*w}deg) rotateY(${y.x*w}deg)`}_calculateZTransform(){let o=this._pos,c=this._map;if(!c||!o)return"";let f=0,_=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){let y=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);f=r.cX(Math.atan2(x.y,x.x))-90}else f=-c.getBearing();else if(_==="horizon"){let y=r.ah(4,6,c.getZoom()),x=r.f7(c.transform);x.y+=y*c.transform.height;let w=o.sub(x),S=r.cX(Math.atan2(w.y,w.x));f=(S>90?S-270:S+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=M0(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let c=this._map;if(!c)return;let f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){let y=this._clickTolerance||c._clickTolerance;if(o.point.dist(f)<y)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(o){let c=this._map,f=this._pos;c&&f&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(f),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Ea.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Ea.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Ea.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Ea.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let gI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ph={maxWidth:100,unit:"metric"},D0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Sa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ta=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function md(p=new r.P(0,0),o="bottom"){if(typeof p=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new r.P(0,p);case"top-left":return new r.P(c,c);case"top-right":return new r.P(-c,c);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(c,-c);case"bottom-right":return new r.P(-c,-c);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[o]||[0,0])}return{version:E,supported:$e.supported,setRTLTextPlugin:r.fb,getRTLTextPluginStatus:r.fa,Map:class extends I0{constructor(p){k.mark(P.create);let o=p;if((p=Object.assign({},pI,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.f3(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ov(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new ac,this._domRenderTaskQueue=new ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},cc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new lc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new Bu(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){let c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new dI(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new m0(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new $p({customAttribution:p.customAttribution})),this._logoControl=new Hp,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new r.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new r.z(`${c.dataType}dataloading`,c))}),this._interactions=new Ka(this)}_getMapId(){return this._mapId}addControl(p,o){if(o===void 0&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=p.onAdd(this);this._controls.push(p);let f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new r.z("movestart",p)).fire(new r.z("move",p)),this.fire(new r.z("resize",p)),o&&this.fire(new r.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(o=>o==="auto"?navigator.language:o):p}setLanguage(p){let o=this._parseLanguage(p);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,o=p.projection.name,c;o==="globe"&&p.zoom>=r.cL?(p.setMercatorFromTransition(),c=!0):o==="mercator"&&p.zoom<r.cL&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,o){return this._updateProjection(p||o||{name:"mercator"})}_updateProjection(p){let o,c=this.transform.mercatorFromTransition;o=p.name==="globe"&&this.transform.zoom>=r.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();let f=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(o||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,o){return this.transform.locationPoint3D(r.aT.convert(p),o)}unproject(p,o){return this.transform.pointLocation3D(r.P.convert(p),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,o,c){let f=_=>{let y=[];if(Array.isArray(o)){let x=o.filter(w=>this.getLayer(w));y=x.length?this.queryRenderedFeatures(_,{layers:x}):[]}else y=this.queryRenderedFeatures(_,{target:o});return y};if(p==="mouseenter"||p==="mouseover"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:x=>{let w=f(x.point);w.length?_||(_=!0,c.call(this,new Ds(p,this,x.originalEvent,{features:w}))):_=!1},mouseout:()=>{_=!1}}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:w=>{f(w.point).length?_=!0:_&&(_=!1,c.call(this,new Ds(p,this,w.originalEvent)))},mouseout:w=>{_&&(_=!1,c.call(this,new Ds(p,this,w.originalEvent)))}}}}{let _=y=>{let x=f(y.point);x.length&&(y.features=x,c.call(this,y),delete y.features)};return{listener:c,targets:o,delegates:{[p]:_}}}}on(p,o,c){if(typeof o=="function"||c===void 0)return super.on(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(let _ in f.delegates)this.on(_,f.delegates[_]);return this}once(p,o,c){if(typeof o=="function"||c===void 0)return super.once(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);for(let _ in f.delegates)this.once(_,f.delegates[_]);return this}off(p,o,c){if(typeof o=="function"||c===void 0)return super.off(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(_=>{for(let y=0;y<_.length;y++){let x=_[y];if(x.listener===c&&hI(x.targets,o)){for(let w in x.delegates)this.off(w,x.delegates[w]);return _.splice(y,1),this}}})(f),this}queryRenderedFeatures(p,o){if(!this.style)return[];if(p===void 0||p instanceof r.P||Array.isArray(p)||o!==void 0||(o=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!o){let y=this.style.queryRenderedFeatures(p,void 0,this.transform),x=this.style.queryRenderedFeatureset(p,void 0,this.transform);return y.concat(x)}let c=!0;if(o.target&&(c=this._isTargetValid(o.target),c&&!o.layers))return this.style.queryRenderedFeatureset(p,o,this.transform);let f=!0;if(o.layers&&Array.isArray(o.layers)){for(let y of o.layers)if(!this._isValidId(y)){f=!1;break}if(f&&!o.target)return this.style.queryRenderedFeatures(p,o,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(p,o,this.transform))),c&&(_=_.concat(this.style.queryRenderedFeatureset(p,o,this.transform))),_}querySourceFeatures(p,o){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,o)}queryRasterValue(p,o,c){return this._isValidId(p)?this.style.queryRasterValue(p,o,c):Promise.resolve(null)}isPointOnSurface(p){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}addInteraction(p,o){return this._interactions.add(p,o),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&p&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(p,(c,f)=>{if(c){let _=typeof c=="string"?c:c instanceof Error?c.message:c.error;r.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(p,o)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){let o=this._locale[p];if(o==null)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){let c=Object.assign({},o);o&&o.config&&(c.initialConfig=o.config,delete c.config),this.style=new Ca(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dr(p)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(let o of p)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(p)}addSource(p,o){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,o,{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();let w=r.I.from(p);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:S,height:M,data:A}=r.o.getImageData(o);this.style.addImage(w,{data:new r.q({width:S,height:M},A),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:S,height:M}=o,A=o;this.style.addImage(w,{data:new r.q({width:S,height:M},new Uint8Array(A.data)),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,usvg:!1,version:0,userImage:A}),A.onAdd&&A.onAdd(this,p)}}updateImage(p,o){this._lazyInitEmptyStyle();let c=r.I.from(p),f=this.style.getImage(c);if(!f)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.o.getImageData(o):o,{width:y,height:x,data:w}=_;if(y===void 0||x===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||x!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));let S=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap),M=!1;f.usvg?(f.data=new r.q({width:y,height:x},new Uint8Array(w)),f.usvg=!1,f.icon=void 0,M=!0):f.data.replace(w,S),this.style.updateImage(c,f,M)}hasImage(p){return p?!!this.style&&!!this.style.getImage(r.I.from(p)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(r.I.from(p))}loadImage(p,o){r.n(this._requestManager.transformRequest(p,r.R.Image),(c,f)=>{o(c,f instanceof HTMLImageElement?r.o.getImageData(f):f)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,o){this._lazyInitEmptyStyle(),this.style.addModel(p,o)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,o){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)):this}getSlot(p){let o=this.getLayer(p);return o&&o.slot||null}setSlot(p,o){return this.style.setSlot(p,o),this.style.mergeLayers(),this._update(!0)}addImport(p,o){return this.style.addImport(p,o).catch(c=>this.fire(new r.y(new Error("Failed to add import",c)))),this}updateImport(p,o){return typeof o!="string"&&o.id!==p?(this.removeImport(p),this.addImport(o)):(this.style.updateImport(p,o),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,o){return this.style.moveImport(p,o),this._update(!0)}moveLayer(p,o){return this._isValidId(p)?(this.style.moveLayer(p,o),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;let o=this.style.getOwnLayer(p);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,o,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,o,c),this._update(!0)):this}setFilter(p,o,c={}){return this._isValidId(p)?(this.style.setFilter(p,o,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,o,c,f),this._update(!0)):this}getPaintProperty(p,o){return this._isValidId(p)?this.style.getPaintProperty(p,o):null}setLayoutProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,o,c,f),this._update(!0)):this}getLayoutProperty(p,o){return this._isValidId(p)?this.style.getLayoutProperty(p,o):null}setLayerProperty(p,o,c,f={}){return this._isValidId(p)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,o,c,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,o){return this.style.setSchema(p,o),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,o){return this.style.setConfig(p,o),this._update(!0)}getConfigProperty(p,o){return this.style.getConfigProperty(p,o)}setConfigProperty(p,o,c){return this.style.setConfigProperty(p,o,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let o=p[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,o),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aT.convert(p),this.transform):0}setFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,o),this._update())}removeFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,o),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new hh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,c,f,_,y=this._container;for(;y&&(!f||!_);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(c=x.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),y=y.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Rb(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=ke("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=ke("div","mapboxgl-canvas-container",p);this._canvas=ke("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=ke("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=ke("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){let c=r.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let o=this._markers.indexOf(p);o!==-1&&this._markers.splice(o,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let o=this._popups.indexOf(p);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let p=Object.assign({},$e.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",p);o?(rs(o,!0),this.painter=new sg(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.k.testSupport(o)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;this.fire(new r.z("renderstart")),++this._frameId;let c=this.painter.context.extTimerQuery,f=r.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=_.createQuery(),_.beginQuery(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let M=this.transform.zoom,A=this.transform.pitch,L=r.o.now(),F=new r.ac(M,{now:L,fadeDuration:y,pitch:A,transition:this.style.transition,worldview:this._worldview});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(f);let w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,k.mark(P.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let M=r.o.now()-f;_.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let A=_.getQueryParameter(o,_.QUERY_RESULT)/1e6;_.deleteQuery(o),this.fire(new r.z("gpu-timing-frame",{cpuTime:M,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){let M=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(M);this.fire(new r.z("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(M);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:A}))},50)}let S=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(S||this._repaint)this.triggerRepaint();else{let M=this.idle();if(M&&(x=this._updateAverageElevation(f,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,k.mark(P.fullLoad),this._performanceMetricsCollection&&Fr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let o of this._markers)p&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!p||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(p,o=!1){let c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let _=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=p;let x=Math.abs(_-y);if(x>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){Vc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===ci||p.status===401)){let o=this.painter.context.gl;rs(o,!1),this._logoControl instanceof Hp&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Jf(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&em(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Yi(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Go(this._requestManager._customAccessToken)}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let c=this.painter.context.gl,f=c.createFramebuffer();function _(y){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0);let x=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,x),x}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(_(p),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(p,o,c){let f=c[1]-c[0],_=p.length/4;for(let y=0;y<o.length;y++){let x=o[y],w=0;for(let S=0;S<x.length;S+=4)x[S]===p[S]&&x[S+1]===p[S+1]&&x[S+2]===p[S+2]&&x[S+3]===p[S+3]&&(w+=1);f+=(c[y+2]-c[y+1])*(1-w/_)}return f}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zs.delete(this.painter.context.gl),Bc.remove(),Xs.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.o.frame(o=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(p){let o=this.style?this.style.getSourceCaches():[];return r.bw(o,(c,f)=>c._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,o){r.f4(p,o)}get version(){return E}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},fI,p),this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),ke("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),ke("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=ke("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let o=p.getZoom(),c=o===p.getMaxZoom(),f=o===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mI(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){let c=ke("button",p,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(p,o){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.E{constructor(p={}){super();let o=navigator.geolocation;this.options=Object.assign({geolocation:o},gI,p),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ag(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(p){let o=this._map.getMaxBounds(),c=p.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){let o=new r.aT(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),_=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(p){if(p){let o=new r.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,o=r.cf(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ke("button","mapboxgl-ctrl-geolocate",this._container),ke("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ke("div","mapboxgl-user-location"),this._dotElement.appendChild(ke("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ke("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ke("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$p,ScaleControl:class{constructor(p={}){this.options=Object.assign({},ph,p),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,f=o._containerWidth/2-p/2,_=o.unproject([f,c]),y=o.unproject([f+p,c]),x=_.distanceTo(y);if(this.options.unit==="imperial"){let w=3.2808*x;w>5280?this._setScale(p,w/5280,"mile"):this._setScale(p,w,"foot")}else this.options.unit==="nautical"?this._setScale(p,x/1852,"nautical-mile"):x>=1e3?this._setScale(p,x/1e3,"kilometer"):this._setScale(p,x,"meter")}_setScale(p,o,c){this._map._requestDomTask(()=>{let f=(function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),w=y/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){let M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M})(w),x*w})(o),_=f/o;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${D0[c]}`,this._container.style.width=p*_+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=ke("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ke("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:hh,Popup:class extends r.E{constructor(p){super(),this.options=Object.assign(Object.create(Sa),p),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let o=document.createDocumentFragment(),c=document.createElement("body"),f;for(c.innerHTML=p;f=c.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=ke("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){let c=this._closeButton=ke("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let o=this._map,c=this._container,f=this._pos;if(!o||!c||!f)return"bottom";let _=c.offsetWidth,y=c.offsetHeight,x=f.x<_/2,w=f.x>o.transform.width-_/2;if(f.y+p<y)return x?"top-left":w?"top-right":"top";if(f.y>o.transform.height-y){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){let o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=ke("div","mapboxgl-popup",o.getContainer()),this._tip=ke("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=M0(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){let _=this._pos=this._trackPointer&&p instanceof r.P?p:o.project(this._lngLat,this._altitude),y=md(this.options.offset),x=this._anchor=this._getAnchor(y.y),w=md(this.options.offset,x),S=_.add(w).round();o._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Yo[x]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&o._showingGlobe()){let _=r.f5(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(Ta);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:xg,Style:Ca,LngLat:r.aT,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:fs,Evented:r.E,config:r.e,prewarm:r.f9,clearPrewarmedResources:r.f8,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(p){r.e.ACCESS_TOKEN=p},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(p){r.e.API_URL=p},get workerCount(){return r.fi.workerCount},set workerCount(p){r.fi.workerCount=p},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.fh(p)},get workerUrl(){return r.fg.workerUrl},set workerUrl(p){r.fg.workerUrl=p},get workerClass(){return r.fg.workerClass},set workerClass(p){r.fg.workerClass=p},get workerParams(){return r.fg.workerParams},set workerParams(p){r.fg.workerParams=p},get dracoUrl(){return r.ff()},set dracoUrl(p){r.fe(p)},get meshoptUrl(){return r.fd()},set meshoptUrl(p){r.fc(p)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var d=e;return d})});var pj=Nr((hIe,hj)=>{"use strict";hj.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var Xh=Nr(Yf=>{"use strict";var YO,$ee=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Yf.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17};Yf.getSymbolTotalCodewords=function(n){return $ee[n]};Yf.getBCHDigit=function(i){let n=0;for(;i!==0;)n++,i>>>=1;return n};Yf.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');YO=n};Yf.isKanjiModeEnabled=function(){return typeof YO<"u"};Yf.toSJIS=function(n){return YO(n)}});var rT=Nr(Gl=>{"use strict";Gl.L={bit:1};Gl.M={bit:0};Gl.Q={bit:3};Gl.H={bit:2};function Hee(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return Gl.L;case"m":case"medium":return Gl.M;case"q":case"quartile":return Gl.Q;case"h":case"high":return Gl.H;default:throw new Error("Unknown EC Level: "+i)}}Gl.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4};Gl.from=function(n,e){if(Gl.isValid(n))return n;try{return Hee(n)}catch{return e}}});var gj=Nr((mIe,mj)=>{"use strict";function fj(){this.buffer=[],this.length=0}fj.prototype={get:function(i){let n=Math.floor(i/8);return(this.buffer[n]>>>7-i%8&1)===1},put:function(i,n){for(let e=0;e<n;e++)this.putBit((i>>>n-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(i){let n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),i&&(this.buffer[n]|=128>>>this.length%8),this.length++}};mj.exports=fj});var vj=Nr((gIe,_j)=>{"use strict";function hb(i){if(!i||i<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=i,this.data=new Uint8Array(i*i),this.reservedBit=new Uint8Array(i*i)}hb.prototype.set=function(i,n,e,a){let d=i*this.size+n;this.data[d]=e,a&&(this.reservedBit[d]=!0)};hb.prototype.get=function(i,n){return this.data[i*this.size+n]};hb.prototype.xor=function(i,n,e){this.data[i*this.size+n]^=e};hb.prototype.isReserved=function(i,n){return this.reservedBit[i*this.size+n]};_j.exports=hb});var yj=Nr(oT=>{"use strict";var Gee=Xh().getSymbolSize;oT.getRowColCoords=function(n){if(n===1)return[];let e=Math.floor(n/7)+2,a=Gee(n),d=a===145?26:Math.ceil((a-13)/(2*e-2))*2,r=[a-7];for(let E=1;E<e-1;E++)r[E]=r[E-1]-d;return r.push(6),r.reverse()};oT.getPositions=function(n){let e=[],a=oT.getRowColCoords(n),d=a.length;for(let r=0;r<d;r++)for(let E=0;E<d;E++)r===0&&E===0||r===0&&E===d-1||r===d-1&&E===0||e.push([a[r],a[E]]);return e}});var wj=Nr(bj=>{"use strict";var qee=Xh().getSymbolSize,xj=7;bj.getPositions=function(n){let e=qee(n);return[[0,0],[e-xj,0],[0,e-xj]]}});var Cj=Nr(ro=>{"use strict";ro.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var Xf={N1:3,N2:3,N3:40,N4:10};ro.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7};ro.from=function(n){return ro.isValid(n)?parseInt(n,10):void 0};ro.getPenaltyN1=function(n){let e=n.size,a=0,d=0,r=0,E=null,P=null;for(let k=0;k<e;k++){d=r=0,E=P=null;for(let X=0;X<e;X++){let oe=n.get(k,X);oe===E?d++:(d>=5&&(a+=Xf.N1+(d-5)),E=oe,d=1),oe=n.get(X,k),oe===P?r++:(r>=5&&(a+=Xf.N1+(r-5)),P=oe,r=1)}d>=5&&(a+=Xf.N1+(d-5)),r>=5&&(a+=Xf.N1+(r-5))}return a};ro.getPenaltyN2=function(n){let e=n.size,a=0;for(let d=0;d<e-1;d++)for(let r=0;r<e-1;r++){let E=n.get(d,r)+n.get(d,r+1)+n.get(d+1,r)+n.get(d+1,r+1);(E===4||E===0)&&a++}return a*Xf.N2};ro.getPenaltyN3=function(n){let e=n.size,a=0,d=0,r=0;for(let E=0;E<e;E++){d=r=0;for(let P=0;P<e;P++)d=d<<1&2047|n.get(E,P),P>=10&&(d===1488||d===93)&&a++,r=r<<1&2047|n.get(P,E),P>=10&&(r===1488||r===93)&&a++}return a*Xf.N3};ro.getPenaltyN4=function(n){let e=0,a=n.data.length;for(let r=0;r<a;r++)e+=n.data[r];return Math.abs(Math.ceil(e*100/a/5)-10)*Xf.N4};function Wee(i,n,e){switch(i){case ro.Patterns.PATTERN000:return(n+e)%2===0;case ro.Patterns.PATTERN001:return n%2===0;case ro.Patterns.PATTERN010:return e%3===0;case ro.Patterns.PATTERN011:return(n+e)%3===0;case ro.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(e/3))%2===0;case ro.Patterns.PATTERN101:return n*e%2+n*e%3===0;case ro.Patterns.PATTERN110:return(n*e%2+n*e%3)%2===0;case ro.Patterns.PATTERN111:return(n*e%3+(n+e)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}ro.applyMask=function(n,e){let a=e.size;for(let d=0;d<a;d++)for(let r=0;r<a;r++)e.isReserved(r,d)||e.xor(r,d,Wee(n,r,d))};ro.getBestMask=function(n,e){let a=Object.keys(ro.Patterns).length,d=0,r=1/0;for(let E=0;E<a;E++){e(E),ro.applyMask(E,n);let P=ro.getPenaltyN1(n)+ro.getPenaltyN2(n)+ro.getPenaltyN3(n)+ro.getPenaltyN4(n);ro.applyMask(E,n),P<r&&(r=P,d=E)}return d}});var KO=Nr(XO=>{"use strict";var Kh=rT(),sT=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],aT=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];XO.getBlocksCount=function(n,e){switch(e){case Kh.L:return sT[(n-1)*4+0];case Kh.M:return sT[(n-1)*4+1];case Kh.Q:return sT[(n-1)*4+2];case Kh.H:return sT[(n-1)*4+3];default:return}};XO.getTotalCodewordsCount=function(n,e){switch(e){case Kh.L:return aT[(n-1)*4+0];case Kh.M:return aT[(n-1)*4+1];case Kh.Q:return aT[(n-1)*4+2];case Kh.H:return aT[(n-1)*4+3];default:return}}});var Ej=Nr(cT=>{"use strict";var pb=new Uint8Array(512),lT=new Uint8Array(256);(function(){let n=1;for(let e=0;e<255;e++)pb[e]=n,lT[n]=e,n<<=1,n&256&&(n^=285);for(let e=255;e<512;e++)pb[e]=pb[e-255]})();cT.log=function(n){if(n<1)throw new Error("log("+n+")");return lT[n]};cT.exp=function(n){return pb[n]};cT.mul=function(n,e){return n===0||e===0?0:pb[lT[n]+lT[e]]}});var Sj=Nr(fb=>{"use strict";var QO=Ej();fb.mul=function(n,e){let a=new Uint8Array(n.length+e.length-1);for(let d=0;d<n.length;d++)for(let r=0;r<e.length;r++)a[d+r]^=QO.mul(n[d],e[r]);return a};fb.mod=function(n,e){let a=new Uint8Array(n);for(;a.length-e.length>=0;){let d=a[0];for(let E=0;E<e.length;E++)a[E]^=QO.mul(e[E],d);let r=0;for(;r<a.length&&a[r]===0;)r++;a=a.slice(r)}return a};fb.generateECPolynomial=function(n){let e=new Uint8Array([1]);for(let a=0;a<n;a++)e=fb.mul(e,new Uint8Array([1,QO.exp(a)]));return e}});var Mj=Nr((CIe,Ij)=>{"use strict";var Tj=Sj();function JO(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}JO.prototype.initialize=function(n){this.degree=n,this.genPoly=Tj.generateECPolynomial(this.degree)};JO.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");let e=new Uint8Array(n.length+this.degree);e.set(n);let a=Tj.mod(e,this.genPoly),d=this.degree-a.length;if(d>0){let r=new Uint8Array(this.degree);return r.set(a,d),r}return a};Ij.exports=JO});var eR=Nr(Dj=>{"use strict";Dj.isValid=function(n){return!isNaN(n)&&n>=1&&n<=40}});var tR=Nr(Vd=>{"use strict";var Aj="[0-9]+",Zee="[A-Z $%*+\\-./:]+",mb="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";mb=mb.replace(/u/g,"\\u");var Yee="(?:(?![A-Z0-9 $%*+\\-./:]|"+mb+`)(?:.|[\r
]))+`;Vd.KANJI=new RegExp(mb,"g");Vd.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Vd.BYTE=new RegExp(Yee,"g");Vd.NUMERIC=new RegExp(Aj,"g");Vd.ALPHANUMERIC=new RegExp(Zee,"g");var Xee=new RegExp("^"+mb+"$"),Kee=new RegExp("^"+Aj+"$"),Qee=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Vd.testKanji=function(n){return Xee.test(n)};Vd.testNumeric=function(n){return Kee.test(n)};Vd.testAlphanumeric=function(n){return Qee.test(n)}});var Qh=Nr(is=>{"use strict";var Jee=eR(),nR=tR();is.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};is.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};is.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};is.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};is.MIXED={bit:-1};is.getCharCountIndicator=function(n,e){if(!n.ccBits)throw new Error("Invalid mode: "+n);if(!Jee.isValid(e))throw new Error("Invalid version: "+e);return e>=1&&e<10?n.ccBits[0]:e<27?n.ccBits[1]:n.ccBits[2]};is.getBestModeForData=function(n){return nR.testNumeric(n)?is.NUMERIC:nR.testAlphanumeric(n)?is.ALPHANUMERIC:nR.testKanji(n)?is.KANJI:is.BYTE};is.toString=function(n){if(n&&n.id)return n.id;throw new Error("Invalid mode")};is.isValid=function(n){return n&&n.bit&&n.ccBits};function ete(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return is.NUMERIC;case"alphanumeric":return is.ALPHANUMERIC;case"kanji":return is.KANJI;case"byte":return is.BYTE;default:throw new Error("Unknown mode: "+i)}}is.from=function(n,e){if(is.isValid(n))return n;try{return ete(n)}catch{return e}}});var Fj=Nr(Kf=>{"use strict";var uT=Xh(),tte=KO(),Pj=rT(),Jh=Qh(),iR=eR(),Rj=7973,Oj=uT.getBCHDigit(Rj);function nte(i,n,e){for(let a=1;a<=40;a++)if(n<=Kf.getCapacity(a,e,i))return a}function kj(i,n){return Jh.getCharCountIndicator(i,n)+4}function ite(i,n){let e=0;return i.forEach(function(a){let d=kj(a.mode,n);e+=d+a.getBitsLength()}),e}function rte(i,n){for(let e=1;e<=40;e++)if(ite(i,e)<=Kf.getCapacity(e,n,Jh.MIXED))return e}Kf.from=function(n,e){return iR.isValid(n)?parseInt(n,10):e};Kf.getCapacity=function(n,e,a){if(!iR.isValid(n))throw new Error("Invalid QR Code version");typeof a>"u"&&(a=Jh.BYTE);let d=uT.getSymbolTotalCodewords(n),r=tte.getTotalCodewordsCount(n,e),E=(d-r)*8;if(a===Jh.MIXED)return E;let P=E-kj(a,n);switch(a){case Jh.NUMERIC:return Math.floor(P/10*3);case Jh.ALPHANUMERIC:return Math.floor(P/11*2);case Jh.KANJI:return Math.floor(P/13);case Jh.BYTE:default:return Math.floor(P/8)}};Kf.getBestVersionForData=function(n,e){let a,d=Pj.from(e,Pj.M);if(Array.isArray(n)){if(n.length>1)return rte(n,d);if(n.length===0)return 1;a=n[0]}else a=n;return nte(a.mode,a.getLength(),d)};Kf.getEncodedBits=function(n){if(!iR.isValid(n)||n<7)throw new Error("Invalid QR Code version");let e=n<<12;for(;uT.getBCHDigit(e)-Oj>=0;)e^=Rj<<uT.getBCHDigit(e)-Oj;return n<<12|e}});var Bj=Nr(zj=>{"use strict";var rR=Xh(),Nj=1335,ote=21522,Lj=rR.getBCHDigit(Nj);zj.getEncodedBits=function(n,e){let a=n.bit<<3|e,d=a<<10;for(;rR.getBCHDigit(d)-Lj>=0;)d^=Nj<<rR.getBCHDigit(d)-Lj;return(a<<10|d)^ote}});var Uj=Nr((DIe,Vj)=>{"use strict";var ste=Qh();function lv(i){this.mode=ste.NUMERIC,this.data=i.toString()}lv.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)};lv.prototype.getLength=function(){return this.data.length};lv.prototype.getBitsLength=function(){return lv.getBitsLength(this.data.length)};lv.prototype.write=function(n){let e,a,d;for(e=0;e+3<=this.data.length;e+=3)a=this.data.substr(e,3),d=parseInt(a,10),n.put(d,10);let r=this.data.length-e;r>0&&(a=this.data.substr(e),d=parseInt(a,10),n.put(d,r*3+1))};Vj.exports=lv});var $j=Nr((AIe,jj)=>{"use strict";var ate=Qh(),oR=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function cv(i){this.mode=ate.ALPHANUMERIC,this.data=i}cv.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)};cv.prototype.getLength=function(){return this.data.length};cv.prototype.getBitsLength=function(){return cv.getBitsLength(this.data.length)};cv.prototype.write=function(n){let e;for(e=0;e+2<=this.data.length;e+=2){let a=oR.indexOf(this.data[e])*45;a+=oR.indexOf(this.data[e+1]),n.put(a,11)}this.data.length%2&&n.put(oR.indexOf(this.data[e]),6)};jj.exports=cv});var Gj=Nr((PIe,Hj)=>{"use strict";var lte=Qh();function uv(i){this.mode=lte.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}uv.getBitsLength=function(n){return n*8};uv.prototype.getLength=function(){return this.data.length};uv.prototype.getBitsLength=function(){return uv.getBitsLength(this.data.length)};uv.prototype.write=function(i){for(let n=0,e=this.data.length;n<e;n++)i.put(this.data[n],8)};Hj.exports=uv});var Wj=Nr((OIe,qj)=>{"use strict";var cte=Qh(),ute=Xh();function dv(i){this.mode=cte.KANJI,this.data=i}dv.getBitsLength=function(n){return n*13};dv.prototype.getLength=function(){return this.data.length};dv.prototype.getBitsLength=function(){return dv.getBitsLength(this.data.length)};dv.prototype.write=function(i){let n;for(n=0;n<this.data.length;n++){let e=ute.toSJIS(this.data[n]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),i.put(e,13)}};qj.exports=dv});var Zj=Nr((RIe,sR)=>{"use strict";var gb={single_source_shortest_paths:function(i,n,e){var a={},d={};d[n]=0;var r=gb.PriorityQueue.make();r.push(n,0);for(var E,P,k,X,oe,Se,$e,ke,ht;!r.empty();){E=r.pop(),P=E.value,X=E.cost,oe=i[P]||{};for(k in oe)oe.hasOwnProperty(k)&&(Se=oe[k],$e=X+Se,ke=d[k],ht=typeof d[k]>"u",(ht||ke>$e)&&(d[k]=$e,r.push(k,$e),a[k]=P))}if(typeof e<"u"&&typeof d[e]>"u"){var Nt=["Could not find a path from ",n," to ",e,"."].join("");throw new Error(Nt)}return a},extract_shortest_path_from_predecessor_list:function(i,n){for(var e=[],a=n,d;a;)e.push(a),d=i[a],a=i[a];return e.reverse(),e},find_path:function(i,n,e){var a=gb.single_source_shortest_paths(i,n,e);return gb.extract_shortest_path_from_predecessor_list(a,e)},PriorityQueue:{make:function(i){var n=gb.PriorityQueue,e={},a;i=i||{};for(a in n)n.hasOwnProperty(a)&&(e[a]=n[a]);return e.queue=[],e.sorter=i.sorter||n.default_sorter,e},default_sorter:function(i,n){return i.cost-n.cost},push:function(i,n){var e={value:i,cost:n};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof sR<"u"&&(sR.exports=gb)});var n6=Nr(hv=>{"use strict";var kr=Qh(),Kj=Uj(),Qj=$j(),Jj=Gj(),e6=Wj(),_b=tR(),dT=Xh(),dte=Zj();function Yj(i){return unescape(encodeURIComponent(i)).length}function vb(i,n,e){let a=[],d;for(;(d=i.exec(e))!==null;)a.push({data:d[0],index:d.index,mode:n,length:d[0].length});return a}function t6(i){let n=vb(_b.NUMERIC,kr.NUMERIC,i),e=vb(_b.ALPHANUMERIC,kr.ALPHANUMERIC,i),a,d;return dT.isKanjiModeEnabled()?(a=vb(_b.BYTE,kr.BYTE,i),d=vb(_b.KANJI,kr.KANJI,i)):(a=vb(_b.BYTE_KANJI,kr.BYTE,i),d=[]),n.concat(e,a,d).sort(function(E,P){return E.index-P.index}).map(function(E){return{data:E.data,mode:E.mode,length:E.length}})}function aR(i,n){switch(n){case kr.NUMERIC:return Kj.getBitsLength(i);case kr.ALPHANUMERIC:return Qj.getBitsLength(i);case kr.KANJI:return e6.getBitsLength(i);case kr.BYTE:return Jj.getBitsLength(i)}}function hte(i){return i.reduce(function(n,e){let a=n.length-1>=0?n[n.length-1]:null;return a&&a.mode===e.mode?(n[n.length-1].data+=e.data,n):(n.push(e),n)},[])}function pte(i){let n=[];for(let e=0;e<i.length;e++){let a=i[e];switch(a.mode){case kr.NUMERIC:n.push([a,{data:a.data,mode:kr.ALPHANUMERIC,length:a.length},{data:a.data,mode:kr.BYTE,length:a.length}]);break;case kr.ALPHANUMERIC:n.push([a,{data:a.data,mode:kr.BYTE,length:a.length}]);break;case kr.KANJI:n.push([a,{data:a.data,mode:kr.BYTE,length:Yj(a.data)}]);break;case kr.BYTE:n.push([{data:a.data,mode:kr.BYTE,length:Yj(a.data)}])}}return n}function fte(i,n){let e={},a={start:{}},d=["start"];for(let r=0;r<i.length;r++){let E=i[r],P=[];for(let k=0;k<E.length;k++){let X=E[k],oe=""+r+k;P.push(oe),e[oe]={node:X,lastCount:0},a[oe]={};for(let Se=0;Se<d.length;Se++){let $e=d[Se];e[$e]&&e[$e].node.mode===X.mode?(a[$e][oe]=aR(e[$e].lastCount+X.length,X.mode)-aR(e[$e].lastCount,X.mode),e[$e].lastCount+=X.length):(e[$e]&&(e[$e].lastCount=X.length),a[$e][oe]=aR(X.length,X.mode)+4+kr.getCharCountIndicator(X.mode,n))}}d=P}for(let r=0;r<d.length;r++)a[d[r]].end=0;return{map:a,table:e}}function Xj(i,n){let e,a=kr.getBestModeForData(i);if(e=kr.from(n,a),e!==kr.BYTE&&e.bit<a.bit)throw new Error('"'+i+'" cannot be encoded with mode '+kr.toString(e)+`.
 Suggested mode is: `+kr.toString(a));switch(e===kr.KANJI&&!dT.isKanjiModeEnabled()&&(e=kr.BYTE),e){case kr.NUMERIC:return new Kj(i);case kr.ALPHANUMERIC:return new Qj(i);case kr.KANJI:return new e6(i);case kr.BYTE:return new Jj(i)}}hv.fromArray=function(n){return n.reduce(function(e,a){return typeof a=="string"?e.push(Xj(a,null)):a.data&&e.push(Xj(a.data,a.mode)),e},[])};hv.fromString=function(n,e){let a=t6(n,dT.isKanjiModeEnabled()),d=pte(a),r=fte(d,e),E=dte.find_path(r.map,"start","end"),P=[];for(let k=1;k<E.length-1;k++)P.push(r.table[E[k]].node);return hv.fromArray(hte(P))};hv.rawSplit=function(n){return hv.fromArray(t6(n,dT.isKanjiModeEnabled()))}});var r6=Nr(i6=>{"use strict";var pT=Xh(),lR=rT(),mte=gj(),gte=vj(),_te=yj(),vte=wj(),dR=Cj(),hR=KO(),yte=Mj(),hT=Fj(),xte=Bj(),bte=Qh(),cR=n6();function wte(i,n){let e=i.size,a=vte.getPositions(n);for(let d=0;d<a.length;d++){let r=a[d][0],E=a[d][1];for(let P=-1;P<=7;P++)if(!(r+P<=-1||e<=r+P))for(let k=-1;k<=7;k++)E+k<=-1||e<=E+k||(P>=0&&P<=6&&(k===0||k===6)||k>=0&&k<=6&&(P===0||P===6)||P>=2&&P<=4&&k>=2&&k<=4?i.set(r+P,E+k,!0,!0):i.set(r+P,E+k,!1,!0))}}function Cte(i){let n=i.size;for(let e=8;e<n-8;e++){let a=e%2===0;i.set(e,6,a,!0),i.set(6,e,a,!0)}}function Ete(i,n){let e=_te.getPositions(n);for(let a=0;a<e.length;a++){let d=e[a][0],r=e[a][1];for(let E=-2;E<=2;E++)for(let P=-2;P<=2;P++)E===-2||E===2||P===-2||P===2||E===0&&P===0?i.set(d+E,r+P,!0,!0):i.set(d+E,r+P,!1,!0)}}function Ste(i,n){let e=i.size,a=hT.getEncodedBits(n),d,r,E;for(let P=0;P<18;P++)d=Math.floor(P/3),r=P%3+e-8-3,E=(a>>P&1)===1,i.set(d,r,E,!0),i.set(r,d,E,!0)}function uR(i,n,e){let a=i.size,d=xte.getEncodedBits(n,e),r,E;for(r=0;r<15;r++)E=(d>>r&1)===1,r<6?i.set(r,8,E,!0):r<8?i.set(r+1,8,E,!0):i.set(a-15+r,8,E,!0),r<8?i.set(8,a-r-1,E,!0):r<9?i.set(8,15-r-1+1,E,!0):i.set(8,15-r-1,E,!0);i.set(a-8,8,1,!0)}function Tte(i,n){let e=i.size,a=-1,d=e-1,r=7,E=0;for(let P=e-1;P>0;P-=2)for(P===6&&P--;;){for(let k=0;k<2;k++)if(!i.isReserved(d,P-k)){let X=!1;E<n.length&&(X=(n[E]>>>r&1)===1),i.set(d,P-k,X),r--,r===-1&&(E++,r=7)}if(d+=a,d<0||e<=d){d-=a,a=-a;break}}}function Ite(i,n,e){let a=new mte;e.forEach(function(k){a.put(k.mode.bit,4),a.put(k.getLength(),bte.getCharCountIndicator(k.mode,i)),k.write(a)});let d=pT.getSymbolTotalCodewords(i),r=hR.getTotalCodewordsCount(i,n),E=(d-r)*8;for(a.getLengthInBits()+4<=E&&a.put(0,4);a.getLengthInBits()%8!==0;)a.putBit(0);let P=(E-a.getLengthInBits())/8;for(let k=0;k<P;k++)a.put(k%2?17:236,8);return Mte(a,i,n)}function Mte(i,n,e){let a=pT.getSymbolTotalCodewords(n),d=hR.getTotalCodewordsCount(n,e),r=a-d,E=hR.getBlocksCount(n,e),P=a%E,k=E-P,X=Math.floor(a/E),oe=Math.floor(r/E),Se=oe+1,$e=X-oe,ke=new yte($e),ht=0,Nt=new Array(E),Mt=new Array(E),Xt=0,Vn=new Uint8Array(i.buffer);for(let Ho=0;Ho<E;Ho++){let Ys=Ho<k?oe:Se;Nt[Ho]=Vn.slice(ht,ht+Ys),Mt[Ho]=ke.encode(Nt[Ho]),ht+=Ys,Xt=Math.max(Xt,Ys)}let sr=new Uint8Array(a),$i=0,Li,Or;for(Li=0;Li<Xt;Li++)for(Or=0;Or<E;Or++)Li<Nt[Or].length&&(sr[$i++]=Nt[Or][Li]);for(Li=0;Li<$e;Li++)for(Or=0;Or<E;Or++)sr[$i++]=Mt[Or][Li];return sr}function Dte(i,n,e,a){let d;if(Array.isArray(i))d=cR.fromArray(i);else if(typeof i=="string"){let X=n;if(!X){let oe=cR.rawSplit(i);X=hT.getBestVersionForData(oe,e)}d=cR.fromString(i,X||40)}else throw new Error("Invalid data");let r=hT.getBestVersionForData(d,e);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(!n)n=r;else if(n<r)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+r+`.
`);let E=Ite(n,e,d),P=pT.getSymbolSize(n),k=new gte(P);return wte(k,n),Cte(k),Ete(k,n),uR(k,e,0),n>=7&&Ste(k,n),Tte(k,E),isNaN(a)&&(a=dR.getBestMask(k,uR.bind(null,k,e))),dR.applyMask(a,k),uR(k,e,a),{modules:k,version:n,errorCorrectionLevel:e,maskPattern:a,segments:d}}i6.create=function(n,e){if(typeof n>"u"||n==="")throw new Error("No input text");let a=lR.M,d,r;return typeof e<"u"&&(a=lR.from(e.errorCorrectionLevel,lR.M),d=hT.from(e.version),r=dR.from(e.maskPattern),e.toSJISFunc&&pT.setToSJISFunction(e.toSJISFunc)),Dte(n,d,a,r)}});var pR=Nr(Qf=>{"use strict";function o6(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let n=i.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+i);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(a){return[a,a]}))),n.length===6&&n.push("F","F");let e=parseInt(n.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:e&255,hex:"#"+n.slice(0,6).join("")}}Qf.getOptions=function(n){n||(n={}),n.color||(n.color={});let e=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,a=n.width&&n.width>=21?n.width:void 0,d=n.scale||4;return{width:a,scale:a?4:d,margin:e,color:{dark:o6(n.color.dark||"#000000ff"),light:o6(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}};Qf.getScale=function(n,e){return e.width&&e.width>=n+e.margin*2?e.width/(n+e.margin*2):e.scale};Qf.getImageWidth=function(n,e){let a=Qf.getScale(n,e);return Math.floor((n+e.margin*2)*a)};Qf.qrToImageData=function(n,e,a){let d=e.modules.size,r=e.modules.data,E=Qf.getScale(d,a),P=Math.floor((d+a.margin*2)*E),k=a.margin*E,X=[a.color.light,a.color.dark];for(let oe=0;oe<P;oe++)for(let Se=0;Se<P;Se++){let $e=(oe*P+Se)*4,ke=a.color.light;if(oe>=k&&Se>=k&&oe<P-k&&Se<P-k){let ht=Math.floor((oe-k)/E),Nt=Math.floor((Se-k)/E);ke=X[r[ht*d+Nt]?1:0]}n[$e++]=ke.r,n[$e++]=ke.g,n[$e++]=ke.b,n[$e]=ke.a}}});var s6=Nr(fT=>{"use strict";var fR=pR();function Ate(i,n,e){i.clearRect(0,0,n.width,n.height),n.style||(n.style={}),n.height=e,n.width=e,n.style.height=e+"px",n.style.width=e+"px"}function Pte(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}fT.render=function(n,e,a){let d=a,r=e;typeof d>"u"&&(!e||!e.getContext)&&(d=e,e=void 0),e||(r=Pte()),d=fR.getOptions(d);let E=fR.getImageWidth(n.modules.size,d),P=r.getContext("2d"),k=P.createImageData(E,E);return fR.qrToImageData(k.data,n,d),Ate(P,r,E),P.putImageData(k,0,0),r};fT.renderToDataURL=function(n,e,a){let d=a;typeof d>"u"&&(!e||!e.getContext)&&(d=e,e=void 0),d||(d={});let r=fT.render(n,e,d),E=d.type||"image/png",P=d.rendererOpts||{};return r.toDataURL(E,P.quality)}});var c6=Nr(l6=>{"use strict";var Ote=pR();function a6(i,n){let e=i.a/255,a=n+'="'+i.hex+'"';return e<1?a+" "+n+'-opacity="'+e.toFixed(2).slice(1)+'"':a}function mR(i,n,e){let a=i+n;return typeof e<"u"&&(a+=" "+e),a}function Rte(i,n,e){let a="",d=0,r=!1,E=0;for(let P=0;P<i.length;P++){let k=Math.floor(P%n),X=Math.floor(P/n);!k&&!r&&(r=!0),i[P]?(E++,P>0&&k>0&&i[P-1]||(a+=r?mR("M",k+e,.5+X+e):mR("m",d,0),d=0,r=!1),k+1<n&&i[P+1]||(a+=mR("h",E),E=0)):d++}return a}l6.render=function(n,e,a){let d=Ote.getOptions(e),r=n.modules.size,E=n.modules.data,P=r+d.margin*2,k=d.color.light.a?"<path "+a6(d.color.light,"fill")+' d="M0 0h'+P+"v"+P+'H0z"/>':"",X="<path "+a6(d.color.dark,"stroke")+' d="'+Rte(E,r,d.margin)+'"/>',oe='viewBox="0 0 '+P+" "+P+'"',$e='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+oe+' shape-rendering="crispEdges">'+k+X+`</svg>
`;return typeof a=="function"&&a(null,$e),$e}});var vR=Nr(yb=>{"use strict";var kte=pj(),gR=r6(),u6=s6(),Fte=c6();function _R(i,n,e,a,d){let r=[].slice.call(arguments,1),E=r.length,P=typeof r[E-1]=="function";if(!P&&!kte())throw new Error("Callback required as last argument");if(P){if(E<2)throw new Error("Too few arguments provided");E===2?(d=e,e=n,n=a=void 0):E===3&&(n.getContext&&typeof d>"u"?(d=a,a=void 0):(d=a,a=e,e=n,n=void 0))}else{if(E<1)throw new Error("Too few arguments provided");return E===1?(e=n,n=a=void 0):E===2&&!n.getContext&&(a=e,e=n,n=void 0),new Promise(function(k,X){try{let oe=gR.create(e,a);k(i(oe,n,a))}catch(oe){X(oe)}})}try{let k=gR.create(e,a);d(null,i(k,n,a))}catch(k){d(k)}}yb.create=gR.create;yb.toCanvas=_R.bind(null,u6.render);yb.toDataURL=_R.bind(null,u6.renderToDataURL);yb.toString=_R.bind(null,function(i,n,e){return Fte.render(i,e)})});var zM;function Cw(){return zM}function hu(i){let n=zM;return zM=i,n}var bN=Symbol("NotFound");function jg(i){return i===bN||i?.name==="\u0275NotFound"}var js=null,Ew=!1,BM=1,uG=null,$s=Symbol("SIGNAL");function Ci(i){let n=js;return js=i,n}function Mw(){return js}var $g={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Hg(i){if(Ew)throw new Error("");if(js===null)return;js.consumerOnSignalRead(i);let n=js.producersTail;if(n!==void 0&&n.producer===i)return;let e,a=js.recomputing;if(a&&(e=n!==void 0?n.nextProducer:js.producers,e!==void 0&&e.producer===i)){js.producersTail=e,e.lastReadVersion=i.version;return}let d=i.consumersTail;if(d!==void 0&&d.consumer===js&&(!a||hG(d,js)))return;let r=qg(js),E={producer:i,consumer:js,nextProducer:e,prevConsumer:d,lastReadVersion:i.version,nextConsumer:void 0};js.producersTail=E,n!==void 0?n.nextProducer=E:js.producers=E,r&&SN(i,E)}function wN(){BM++}function Dw(i){if(!(qg(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===BM)){if(!i.producerMustRecompute(i)&&!xy(i)){Iw(i);return}i.producerRecomputeValue(i),Iw(i)}}function VM(i){if(i.consumers===void 0)return;let n=Ew;Ew=!0;try{for(let e=i.consumers;e!==void 0;e=e.nextConsumer){let a=e.consumer;a.dirty||dG(a)}}finally{Ew=n}}function UM(){return js?.consumerAllowSignalWrites!==!1}function dG(i){i.dirty=!0,VM(i),i.consumerMarkedDirty?.(i)}function Iw(i){i.dirty=!1,i.lastCleanEpoch=BM}function Gg(i){return i&&CN(i),Ci(i)}function CN(i){i.producersTail=void 0,i.recomputing=!0}function yy(i,n){Ci(n),i&&EN(i)}function EN(i){i.recomputing=!1;let n=i.producersTail,e=n!==void 0?n.nextProducer:i.producers;if(e!==void 0){if(qg(i))do e=jM(e);while(e!==void 0);n!==void 0?n.nextProducer=void 0:i.producers=void 0}}function xy(i){for(let n=i.producers;n!==void 0;n=n.nextProducer){let e=n.producer,a=n.lastReadVersion;if(a!==e.version||(Dw(e),a!==e.version))return!0}return!1}function by(i){if(qg(i)){let n=i.producers;for(;n!==void 0;)n=jM(n)}i.producers=void 0,i.producersTail=void 0,i.consumers=void 0,i.consumersTail=void 0}function SN(i,n){let e=i.consumersTail,a=qg(i);if(e!==void 0?(n.nextConsumer=e.nextConsumer,e.nextConsumer=n):(n.nextConsumer=void 0,i.consumers=n),n.prevConsumer=e,i.consumersTail=n,!a)for(let d=i.producers;d!==void 0;d=d.nextProducer)SN(d.producer,d)}function jM(i){let n=i.producer,e=i.nextProducer,a=i.nextConsumer,d=i.prevConsumer;if(i.nextConsumer=void 0,i.prevConsumer=void 0,a!==void 0?a.prevConsumer=d:n.consumersTail=d,d!==void 0)d.nextConsumer=a;else if(n.consumers=a,!qg(n)){let r=n.producers;for(;r!==void 0;)r=jM(r)}return e}function qg(i){return i.consumerIsAlwaysLive||i.consumers!==void 0}function Aw(i){uG?.(i)}function hG(i,n){let e=n.producersTail;if(e!==void 0){let a=n.producers;do{if(a===i)return!0;if(a===e)break;a=a.nextProducer}while(a!==void 0)}return!1}function Pw(i,n){return Object.is(i,n)}function Ow(i,n){let e=Object.create(pG);e.computation=i,n!==void 0&&(e.equal=n);let a=()=>{if(Dw(e),Hg(e),e.value===vy)throw e.error;return e.value};return a[$s]=e,Aw(e),a}var Sw=Symbol("UNSET"),Tw=Symbol("COMPUTING"),vy=Symbol("ERRORED"),pG=wi(Ht({},$g),{value:Sw,dirty:!0,error:null,equal:Pw,kind:"computed",producerMustRecompute(i){return i.value===Sw||i.value===Tw},producerRecomputeValue(i){if(i.value===Tw)throw new Error("");let n=i.value;i.value=Tw;let e=Gg(i),a,d=!1;try{a=i.computation(),Ci(null),d=n!==Sw&&n!==vy&&a!==vy&&i.equal(n,a)}catch(r){a=vy,i.error=r}finally{yy(i,e)}if(d){i.value=n;return}i.value=a,i.version++}});function fG(){throw new Error}var TN=fG;function IN(i){TN(i)}function $M(i){TN=i}var mG=null;function HM(i,n){let e=Object.create(Rw);e.value=i,n!==void 0&&(e.equal=n);let a=()=>MN(e);return a[$s]=e,Aw(e),[a,E=>Wg(e,E),E=>GM(e,E)]}function MN(i){return Hg(i),i.value}function Wg(i,n){UM()||IN(i),i.equal(i.value,n)||(i.value=n,gG(i))}function GM(i,n){UM()||IN(i),Wg(i,n(i.value))}var Rw=wi(Ht({},$g),{equal:Pw,value:void 0,kind:"signal"});function gG(i){i.version++,wN(),VM(i),mG?.(i)}function Ri(i){return typeof i=="function"}function Zg(i){let e=i(a=>{Error.call(a),a.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var kw=Zg(i=>function(e){i(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((a,d)=>`${d+1}) ${a.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function tf(i,n){if(i){let e=i.indexOf(n);0<=e&&i.splice(e,1)}}var Hr=class i{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let r of e)r.remove(this);else e.remove(this);let{initialTeardown:a}=this;if(Ri(a))try{a()}catch(r){n=r instanceof kw?r.errors:[r]}let{_finalizers:d}=this;if(d){this._finalizers=null;for(let r of d)try{DN(r)}catch(E){n=n??[],E instanceof kw?n=[...n,...E.errors]:n.push(E)}}if(n)throw new kw(n)}}add(n){var e;if(n&&n!==this)if(this.closed)DN(n);else{if(n instanceof i){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&tf(e,n)}remove(n){let{_finalizers:e}=this;e&&tf(e,n),n instanceof i&&n._removeParent(this)}};Hr.EMPTY=(()=>{let i=new Hr;return i.closed=!0,i})();var qM=Hr.EMPTY;function Fw(i){return i instanceof Hr||i&&"closed"in i&&Ri(i.remove)&&Ri(i.add)&&Ri(i.unsubscribe)}function DN(i){Ri(i)?i():i.unsubscribe()}var xc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Yg={setTimeout(i,n,...e){let{delegate:a}=Yg;return a?.setTimeout?a.setTimeout(i,n,...e):setTimeout(i,n,...e)},clearTimeout(i){let{delegate:n}=Yg;return(n?.clearTimeout||clearTimeout)(i)},delegate:void 0};function Lw(i){Yg.setTimeout(()=>{let{onUnhandledError:n}=xc;if(n)n(i);else throw i})}function wy(){}var AN=WM("C",void 0,void 0);function PN(i){return WM("E",void 0,i)}function ON(i){return WM("N",i,void 0)}function WM(i,n,e){return{kind:i,value:n,error:e}}var nf=null;function Xg(i){if(xc.useDeprecatedSynchronousErrorHandling){let n=!nf;if(n&&(nf={errorThrown:!1,error:null}),i(),n){let{errorThrown:e,error:a}=nf;if(nf=null,e)throw a}}else i()}function RN(i){xc.useDeprecatedSynchronousErrorHandling&&nf&&(nf.errorThrown=!0,nf.error=i)}var rf=class extends Hr{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Fw(n)&&n.add(this)):this.destination=yG}static create(n,e,a){return new xd(n,e,a)}next(n){this.isStopped?YM(ON(n),this):this._next(n)}error(n){this.isStopped?YM(PN(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?YM(AN,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},_G=Function.prototype.bind;function ZM(i,n){return _G.call(i,n)}var XM=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(a){Nw(a)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(a){Nw(a)}else Nw(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Nw(e)}}},xd=class extends rf{constructor(n,e,a){super();let d;if(Ri(n)||!n)d={next:n??void 0,error:e??void 0,complete:a??void 0};else{let r;this&&xc.useDeprecatedNextContext?(r=Object.create(n),r.unsubscribe=()=>this.unsubscribe(),d={next:n.next&&ZM(n.next,r),error:n.error&&ZM(n.error,r),complete:n.complete&&ZM(n.complete,r)}):d=n}this.destination=new XM(d)}};function Nw(i){xc.useDeprecatedSynchronousErrorHandling?RN(i):Lw(i)}function vG(i){throw i}function YM(i,n){let{onStoppedNotification:e}=xc;e&&Yg.setTimeout(()=>e(i,n))}var yG={closed:!0,next:wy,error:vG,complete:wy};var Kg=typeof Symbol=="function"&&Symbol.observable||"@@observable";function sa(i){return i}function KM(...i){return QM(i)}function QM(i){return i.length===0?sa:i.length===1?i[0]:function(e){return i.reduce((a,d)=>d(a),e)}}var ki=(()=>{class i{constructor(e){e&&(this._subscribe=e)}lift(e){let a=new i;return a.source=this,a.operator=e,a}subscribe(e,a,d){let r=bG(e)?e:new xd(e,a,d);return Xg(()=>{let{operator:E,source:P}=this;r.add(E?E.call(r,P):P?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(e){try{return this._subscribe(e)}catch(a){e.error(a)}}forEach(e,a){return a=kN(a),new a((d,r)=>{let E=new xd({next:P=>{try{e(P)}catch(k){r(k),E.unsubscribe()}},error:r,complete:d});this.subscribe(E)})}_subscribe(e){var a;return(a=this.source)===null||a===void 0?void 0:a.subscribe(e)}[Kg](){return this}pipe(...e){return QM(e)(this)}toPromise(e){return e=kN(e),new e((a,d)=>{let r;this.subscribe(E=>r=E,E=>d(E),()=>a(r))})}}return i.create=n=>new i(n),i})();function kN(i){var n;return(n=i??xc.Promise)!==null&&n!==void 0?n:Promise}function xG(i){return i&&Ri(i.next)&&Ri(i.error)&&Ri(i.complete)}function bG(i){return i&&i instanceof rf||xG(i)&&Fw(i)}function JM(i){return Ri(i?.lift)}function Bi(i){return n=>{if(JM(n))return n.lift(function(e){try{return i(e,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fi(i,n,e,a,d){return new eD(i,n,e,a,d)}var eD=class extends rf{constructor(n,e,a,d,r,E){super(n),this.onFinalize=r,this.shouldUnsubscribe=E,this._next=e?function(P){try{e(P)}catch(k){n.error(k)}}:super._next,this._error=d?function(P){try{d(P)}catch(k){n.error(k)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(P){n.error(P)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Qg(){return Bi((i,n)=>{let e=null;i._refCount++;let a=Fi(n,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){e=null;return}let d=i._connection,r=e;e=null,d&&(!r||d===r)&&d.unsubscribe(),n.unsubscribe()});i.subscribe(a),a.closed||(e=i.connect())})}var Jg=class extends ki{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,JM(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Hr;let e=this.getSubject();n.add(this.source.subscribe(Fi(e,void 0,()=>{this._teardown(),e.complete()},a=>{this._teardown(),e.error(a)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Hr.EMPTY)}return n}refCount(){return Qg()(this)}};var FN=Zg(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var li=(()=>{class i extends ki{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let a=new zw(this,this);return a.operator=e,a}_throwIfClosed(){if(this.closed)throw new FN}next(e){Xg(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let a of this.currentObservers)a.next(e)}})}error(e){Xg(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:a}=this;for(;a.length;)a.shift().error(e)}})}complete(){Xg(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:a,isStopped:d,observers:r}=this;return a||d?qM:(this.currentObservers=null,r.push(e),new Hr(()=>{this.currentObservers=null,tf(r,e)}))}_checkFinalizedStatuses(e){let{hasError:a,thrownError:d,isStopped:r}=this;a?e.error(d):r&&e.complete()}asObservable(){let e=new ki;return e.source=this,e}}return i.create=(n,e)=>new zw(n,e),i})(),zw=class extends li{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,a;(a=(e=this.destination)===null||e===void 0?void 0:e.next)===null||a===void 0||a.call(e,n)}error(n){var e,a;(a=(e=this.destination)===null||e===void 0?void 0:e.error)===null||a===void 0||a.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,a;return(a=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&a!==void 0?a:qM}};var No=class extends li{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:a}=this;if(n)throw e;return this._throwIfClosed(),a}next(n){super.next(this._value=n)}};var tD={now(){return(tD.delegate||Date).now()},delegate:void 0};var Bw=class extends Hr{constructor(n,e){super()}schedule(n,e=0){return this}};var Cy={setInterval(i,n,...e){let{delegate:a}=Cy;return a?.setInterval?a.setInterval(i,n,...e):setInterval(i,n,...e)},clearInterval(i){let{delegate:n}=Cy;return(n?.clearInterval||clearInterval)(i)},delegate:void 0};var Vw=class extends Bw{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var a;if(this.closed)return this;this.state=n;let d=this.id,r=this.scheduler;return d!=null&&(this.id=this.recycleAsyncId(r,d,e)),this.pending=!0,this.delay=e,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(r,this.id,e),this}requestAsyncId(n,e,a=0){return Cy.setInterval(n.flush.bind(n,this),a)}recycleAsyncId(n,e,a=0){if(a!=null&&this.delay===a&&this.pending===!1)return e;e!=null&&Cy.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let a=this._execute(n,e);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let a=!1,d;try{this.work(n)}catch(r){a=!0,d=r||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),d}unsubscribe(){if(!this.closed){let{id:n,scheduler:e}=this,{actions:a}=e;this.work=this.state=this.scheduler=null,this.pending=!1,tf(a,this),n!=null&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}};var e_=class i{constructor(n,e=i.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,a){return new this.schedulerActionCtor(this,n).schedule(a,e)}};e_.now=tD.now;var Uw=class extends e_{constructor(n,e=e_.now){super(n,e),this.actions=[],this._active=!1}flush(n){let{actions:e}=this;if(this._active){e.push(n);return}let a;this._active=!0;do if(a=n.execute(n.state,n.delay))break;while(n=e.shift());if(this._active=!1,a){for(;n=e.shift();)n.unsubscribe();throw a}}};var of=new Uw(Vw),LN=of;var Da=new ki(i=>i.complete());function jw(i){return i&&Ri(i.schedule)}function NN(i){return i[i.length-1]}function $w(i){return Ri(NN(i))?i.pop():void 0}function Eh(i){return jw(NN(i))?i.pop():void 0}function BN(i,n,e,a){function d(r){return r instanceof e?r:new e(function(E){E(r)})}return new(e||(e=Promise))(function(r,E){function P(oe){try{X(a.next(oe))}catch(Se){E(Se)}}function k(oe){try{X(a.throw(oe))}catch(Se){E(Se)}}function X(oe){oe.done?r(oe.value):d(oe.value).then(P,k)}X((a=a.apply(i,n||[])).next())})}function zN(i){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&i[n],a=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&a>=i.length&&(i=void 0),{value:i&&i[a++],done:!i}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function sf(i){return this instanceof sf?(this.v=i,this):new sf(i)}function VN(i,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e.apply(i,n||[]),d,r=[];return d=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),P("next"),P("throw"),P("return",E),d[Symbol.asyncIterator]=function(){return this},d;function E(ke){return function(ht){return Promise.resolve(ht).then(ke,Se)}}function P(ke,ht){a[ke]&&(d[ke]=function(Nt){return new Promise(function(Mt,Xt){r.push([ke,Nt,Mt,Xt])>1||k(ke,Nt)})},ht&&(d[ke]=ht(d[ke])))}function k(ke,ht){try{X(a[ke](ht))}catch(Nt){$e(r[0][3],Nt)}}function X(ke){ke.value instanceof sf?Promise.resolve(ke.value.v).then(oe,Se):$e(r[0][2],ke)}function oe(ke){k("next",ke)}function Se(ke){k("throw",ke)}function $e(ke,ht){ke(ht),r.shift(),r.length&&k(r[0][0],r[0][1])}}function UN(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i[Symbol.asyncIterator],e;return n?n.call(i):(i=typeof zN=="function"?zN(i):i[Symbol.iterator](),e={},a("next"),a("throw"),a("return"),e[Symbol.asyncIterator]=function(){return this},e);function a(r){e[r]=i[r]&&function(E){return new Promise(function(P,k){E=i[r](E),d(P,k,E.done,E.value)})}}function d(r,E,P,k){Promise.resolve(k).then(function(X){r({value:X,done:P})},E)}}var Hw=i=>i&&typeof i.length=="number"&&typeof i!="function";function Gw(i){return Ri(i?.then)}function qw(i){return Ri(i[Kg])}function Ww(i){return Symbol.asyncIterator&&Ri(i?.[Symbol.asyncIterator])}function Zw(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function wG(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Yw=wG();function Xw(i){return Ri(i?.[Yw])}function Kw(i){return VN(this,arguments,function*(){let e=i.getReader();try{for(;;){let{value:a,done:d}=yield sf(e.read());if(d)return yield sf(void 0);yield yield sf(a)}}finally{e.releaseLock()}})}function Qw(i){return Ri(i?.getReader)}function lo(i){if(i instanceof ki)return i;if(i!=null){if(qw(i))return CG(i);if(Hw(i))return EG(i);if(Gw(i))return SG(i);if(Ww(i))return jN(i);if(Xw(i))return TG(i);if(Qw(i))return IG(i)}throw Zw(i)}function CG(i){return new ki(n=>{let e=i[Kg]();if(Ri(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function EG(i){return new ki(n=>{for(let e=0;e<i.length&&!n.closed;e++)n.next(i[e]);n.complete()})}function SG(i){return new ki(n=>{i.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Lw)})}function TG(i){return new ki(n=>{for(let e of i)if(n.next(e),n.closed)return;n.complete()})}function jN(i){return new ki(n=>{MG(i,n).catch(e=>n.error(e))})}function IG(i){return jN(Kw(i))}function MG(i,n){var e,a,d,r;return BN(this,void 0,void 0,function*(){try{for(e=UN(i);a=yield e.next(),!a.done;){let E=a.value;if(n.next(E),n.closed)return}}catch(E){d={error:E}}finally{try{a&&!a.done&&(r=e.return)&&(yield r.call(e))}finally{if(d)throw d.error}}n.complete()})}function Aa(i,n,e,a=0,d=!1){let r=n.schedule(function(){e(),d?i.add(this.schedule(null,a)):this.unsubscribe()},a);if(i.add(r),!d)return r}function Jw(i,n=0){return Bi((e,a)=>{e.subscribe(Fi(a,d=>Aa(a,i,()=>a.next(d),n),()=>Aa(a,i,()=>a.complete(),n),d=>Aa(a,i,()=>a.error(d),n)))})}function eC(i,n=0){return Bi((e,a)=>{a.add(i.schedule(()=>e.subscribe(a),n))})}function $N(i,n){return lo(i).pipe(eC(n),Jw(n))}function HN(i,n){return lo(i).pipe(eC(n),Jw(n))}function GN(i,n){return new ki(e=>{let a=0;return n.schedule(function(){a===i.length?e.complete():(e.next(i[a++]),e.closed||this.schedule())})})}function qN(i,n){return new ki(e=>{let a;return Aa(e,n,()=>{a=i[Yw](),Aa(e,n,()=>{let d,r;try{({value:d,done:r}=a.next())}catch(E){e.error(E);return}r?e.complete():e.next(d)},0,!0)}),()=>Ri(a?.return)&&a.return()})}function tC(i,n){if(!i)throw new Error("Iterable cannot be null");return new ki(e=>{Aa(e,n,()=>{let a=i[Symbol.asyncIterator]();Aa(e,n,()=>{a.next().then(d=>{d.done?e.complete():e.next(d.value)})},0,!0)})})}function WN(i,n){return tC(Kw(i),n)}function ZN(i,n){if(i!=null){if(qw(i))return $N(i,n);if(Hw(i))return GN(i,n);if(Gw(i))return HN(i,n);if(Ww(i))return tC(i,n);if(Xw(i))return qN(i,n);if(Qw(i))return WN(i,n)}throw Zw(i)}function go(i,n){return n?ZN(i,n):lo(i)}function Dn(...i){let n=Eh(i);return go(i,n)}function bc(i,n){let e=Ri(i)?i:()=>i,a=d=>d.error(e());return new ki(n?d=>n.schedule(a,0,d):a)}function nC(i){return!!i&&(i instanceof ki||Ri(i.lift)&&Ri(i.subscribe))}var bd=Zg(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function YN(i){return i instanceof Date&&!isNaN(i)}function Qn(i,n){return Bi((e,a)=>{let d=0;e.subscribe(Fi(a,r=>{a.next(i.call(n,r,d++))}))})}var{isArray:DG}=Array;function AG(i,n){return DG(n)?i(...n):i(n)}function iC(i){return Qn(n=>AG(i,n))}var{isArray:PG}=Array,{getPrototypeOf:OG,prototype:RG,keys:kG}=Object;function rC(i){if(i.length===1){let n=i[0];if(PG(n))return{args:n,keys:null};if(FG(n)){let e=kG(n);return{args:e.map(a=>n[a]),keys:e}}}return{args:i,keys:null}}function FG(i){return i&&typeof i=="object"&&OG(i)===RG}function oC(i,n){return i.reduce((e,a,d)=>(e[a]=n[d],e),{})}function af(...i){let n=Eh(i),e=$w(i),{args:a,keys:d}=rC(i);if(a.length===0)return go([],n);let r=new ki(LG(a,n,d?E=>oC(d,E):sa));return e?r.pipe(iC(e)):r}function LG(i,n,e=sa){return a=>{XN(n,()=>{let{length:d}=i,r=new Array(d),E=d,P=d;for(let k=0;k<d;k++)XN(n,()=>{let X=go(i[k],n),oe=!1;X.subscribe(Fi(a,Se=>{r[k]=Se,oe||(oe=!0,P--),P||a.next(e(r.slice()))},()=>{--E||a.complete()}))},a)},a)}}function XN(i,n,e){i?Aa(e,i,n):n()}function KN(i,n,e,a,d,r,E,P){let k=[],X=0,oe=0,Se=!1,$e=()=>{Se&&!k.length&&!X&&n.complete()},ke=Nt=>X<a?ht(Nt):k.push(Nt),ht=Nt=>{r&&n.next(Nt),X++;let Mt=!1;lo(e(Nt,oe++)).subscribe(Fi(n,Xt=>{d?.(Xt),r?ke(Xt):n.next(Xt)},()=>{Mt=!0},void 0,()=>{if(Mt)try{for(X--;k.length&&X<a;){let Xt=k.shift();E?Aa(n,E,()=>ht(Xt)):ht(Xt)}$e()}catch(Xt){n.error(Xt)}}))};return i.subscribe(Fi(n,ke,()=>{Se=!0,$e()})),()=>{P?.()}}function zo(i,n,e=1/0){return Ri(n)?zo((a,d)=>Qn((r,E)=>n(a,r,d,E))(lo(i(a,d))),e):(typeof n=="number"&&(e=n),Bi((a,d)=>KN(a,d,i,e)))}function t_(i=1/0){return zo(sa,i)}function QN(){return t_(1)}function Sh(...i){return QN()(go(i,Eh(i)))}function Ey(i){return new ki(n=>{lo(i()).subscribe(n)})}function Sy(...i){let n=$w(i),{args:e,keys:a}=rC(i),d=new ki(r=>{let{length:E}=e;if(!E){r.complete();return}let P=new Array(E),k=E,X=E;for(let oe=0;oe<E;oe++){let Se=!1;lo(e[oe]).subscribe(Fi(r,$e=>{Se||(Se=!0,X--),P[oe]=$e},()=>k--,void 0,()=>{(!k||!Se)&&(X||r.next(a?oC(a,P):P),r.complete())}))}});return n?d.pipe(iC(n)):d}function sC(i=0,n,e=LN){let a=-1;return n!=null&&(jw(n)?e=n:a=n),new ki(d=>{let r=YN(i)?+i-e.now():i;r<0&&(r=0);let E=0;return e.schedule(function(){d.closed||(d.next(E++),0<=a?this.schedule(void 0,a):d.complete())},r)})}function lf(i=0,n=of){return i<0&&(i=0),sC(i,i,n)}function Ao(i,n){return Bi((e,a)=>{let d=0;e.subscribe(Fi(a,r=>i.call(n,r,d++)&&a.next(r)))})}function JN(i){return Bi((n,e)=>{let a=!1,d=null,r=null,E=!1,P=()=>{if(r?.unsubscribe(),r=null,a){a=!1;let X=d;d=null,e.next(X)}E&&e.complete()},k=()=>{r=null,E&&e.complete()};n.subscribe(Fi(e,X=>{a=!0,d=X,r||lo(i(X)).subscribe(r=Fi(e,P,k))},()=>{E=!0,(!a||!r||r.closed)&&e.complete()}))})}function aC(i,n=of){return JN(()=>sC(i,n))}function tl(i){return Bi((n,e)=>{let a=null,d=!1,r;a=n.subscribe(Fi(e,void 0,void 0,E=>{r=lo(i(E,tl(i)(n))),a?(a.unsubscribe(),a=null,r.subscribe(e)):d=!0})),d&&(a.unsubscribe(),a=null,r.subscribe(e))})}function e3(i,n,e,a,d){return(r,E)=>{let P=e,k=n,X=0;r.subscribe(Fi(E,oe=>{let Se=X++;k=P?i(k,oe,Se):(P=!0,oe),a&&E.next(k)},d&&(()=>{P&&E.next(k),E.complete()})))}}function pu(i,n){return Ri(n)?zo(i,n,1):zo(i,1)}function n_(i,n=of){return Bi((e,a)=>{let d=null,r=null,E=null,P=()=>{if(d){d.unsubscribe(),d=null;let X=r;r=null,a.next(X)}};function k(){let X=E+i,oe=n.now();if(oe<X){d=this.schedule(void 0,X-oe),a.add(d);return}P()}e.subscribe(Fi(a,X=>{r=X,E=n.now(),d||(d=n.schedule(k,i),a.add(d))},()=>{P(),a.complete()},void 0,()=>{r=d=null}))})}function Th(i){return Bi((n,e)=>{let a=!1;n.subscribe(Fi(e,d=>{a=!0,e.next(d)},()=>{a||e.next(i),e.complete()}))})}function nl(i){return i<=0?()=>Da:Bi((n,e)=>{let a=0;n.subscribe(Fi(e,d=>{++a<=i&&(e.next(d),i<=a&&e.complete())}))})}function cf(i,n=sa){return i=i??NG,Bi((e,a)=>{let d,r=!0;e.subscribe(Fi(a,E=>{let P=n(E);(r||!i(d,P))&&(r=!1,d=P,a.next(E))}))})}function NG(i,n){return i===n}function lC(i=zG){return Bi((n,e)=>{let a=!1;n.subscribe(Fi(e,d=>{a=!0,e.next(d)},()=>a?e.complete():e.error(i())))})}function zG(){return new bd}function wd(i){return Bi((n,e)=>{try{n.subscribe(e)}finally{e.add(i)}})}function Cd(i,n){let e=arguments.length>=2;return a=>a.pipe(i?Ao((d,r)=>i(d,r,a)):sa,nl(1),e?Th(n):lC(()=>new bd))}function i_(i){return i<=0?()=>Da:Bi((n,e)=>{let a=[];n.subscribe(Fi(e,d=>{a.push(d),i<a.length&&a.shift()},()=>{for(let d of a)e.next(d);e.complete()},void 0,()=>{a=null}))})}function nD(i,n){let e=arguments.length>=2;return a=>a.pipe(i?Ao((d,r)=>i(d,r,a)):sa,i_(1),e?Th(n):lC(()=>new bd))}function iD(i,n){return Bi(e3(i,n,arguments.length>=2,!0))}function oD(i={}){let{connector:n=()=>new li,resetOnError:e=!0,resetOnComplete:a=!0,resetOnRefCountZero:d=!0}=i;return r=>{let E,P,k,X=0,oe=!1,Se=!1,$e=()=>{P?.unsubscribe(),P=void 0},ke=()=>{$e(),E=k=void 0,oe=Se=!1},ht=()=>{let Nt=E;ke(),Nt?.unsubscribe()};return Bi((Nt,Mt)=>{X++,!Se&&!oe&&$e();let Xt=k=k??n();Mt.add(()=>{X--,X===0&&!Se&&!oe&&(P=rD(ht,d))}),Xt.subscribe(Mt),!E&&X>0&&(E=new xd({next:Vn=>Xt.next(Vn),error:Vn=>{Se=!0,$e(),P=rD(ke,e,Vn),Xt.error(Vn)},complete:()=>{oe=!0,$e(),P=rD(ke,a),Xt.complete()}}),lo(Nt).subscribe(E))})(r)}}function rD(i,n,...e){if(n===!0){i();return}if(n===!1)return;let a=new xd({next:()=>{a.unsubscribe(),i()}});return lo(n(...e)).subscribe(a)}function Ty(i){return Ao((n,e)=>i<=e)}function r_(...i){let n=Eh(i);return Bi((e,a)=>{(n?Sh(i,e,n):Sh(i,e)).subscribe(a)})}function So(i,n){return Bi((e,a)=>{let d=null,r=0,E=!1,P=()=>E&&!d&&a.complete();e.subscribe(Fi(a,k=>{d?.unsubscribe();let X=0,oe=r++;lo(i(k,oe)).subscribe(d=Fi(a,Se=>a.next(n?n(k,Se,oe,X++):Se),()=>{d=null,P()}))},()=>{E=!0,P()}))})}function wc(i){return Bi((n,e)=>{lo(i).subscribe(Fi(e,()=>e.complete(),wy)),!e.closed&&n.subscribe(e)})}function Po(i,n,e){let a=Ri(i)||n||e?{next:i,error:n,complete:e}:i;return a?Bi((d,r)=>{var E;(E=a.subscribe)===null||E===void 0||E.call(a);let P=!0;d.subscribe(Fi(r,k=>{var X;(X=a.next)===null||X===void 0||X.call(a,k),r.next(k)},()=>{var k;P=!1,(k=a.complete)===null||k===void 0||k.call(a),r.complete()},k=>{var X;P=!1,(X=a.error)===null||X===void 0||X.call(a,k),r.error(k)},()=>{var k,X;P&&((k=a.unsubscribe)===null||k===void 0||k.call(a)),(X=a.finalize)===null||X===void 0||X.call(a)}))}):sa}function t3(i){let n=Ci(null);try{return i()}finally{Ci(n)}}var hC="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",sn=class extends Error{code;constructor(n,e){super(fu(n,e)),this.code=n}};function BG(i){return`NG0${Math.abs(i)}`}function fu(i,n){return`${BG(i)}${n?": "+n:""}`}var Al=globalThis;function Rr(i){for(let n in i)if(i[n]===Rr)return n;throw Error("")}function r3(i,n){for(let e in n)n.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(i[e]=n[e])}function Sd(i){if(typeof i=="string")return i;if(Array.isArray(i))return`[${i.map(Sd).join(", ")}]`;if(i==null)return""+i;let n=i.overriddenName||i.name;if(n)return`${n}`;let e=i.toString();if(e==null)return""+e;let a=e.indexOf(`
`);return a>=0?e.slice(0,a):e}function pC(i,n){return i?n?`${i} ${n}`:i:n||""}var VG=Rr({__forward_ref__:Rr});function Id(i){return i.__forward_ref__=Id,i.toString=function(){return Sd(this())},i}function Os(i){return _D(i)?i():i}function _D(i){return typeof i=="function"&&i.hasOwnProperty(VG)&&i.__forward_ref__===Id}function Rt(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function vr(i){return{providers:i.providers||[],imports:i.imports||[]}}function Ay(i){return UG(i,fC)}function vD(i){return Ay(i)!==null}function UG(i,n){return i.hasOwnProperty(n)&&i[n]||null}function jG(i){let n=i?.[fC]??null;return n||null}function aD(i){return i&&i.hasOwnProperty(uC)?i[uC]:null}var fC=Rr({\u0275prov:Rr}),uC=Rr({\u0275inj:Rr}),Kt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=Rt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function yD(i){return i&&!!i.\u0275providers}var xD=Rr({\u0275cmp:Rr}),bD=Rr({\u0275dir:Rr}),wD=Rr({\u0275pipe:Rr}),CD=Rr({\u0275mod:Rr}),My=Rr({\u0275fac:Rr}),ff=Rr({__NG_ELEMENT_ID__:Rr}),n3=Rr({__NG_ENV_ID__:Rr});function mf(i){return typeof i=="string"?i:i==null?"":String(i)}function o3(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():mf(i)}var s3=Rr({ngErrorCode:Rr}),$G=Rr({ngErrorMessage:Rr}),HG=Rr({ngTokenPath:Rr});function ED(i,n){return a3("",-200,n)}function mC(i,n){throw new sn(-201,!1)}function a3(i,n,e){let a=new sn(n,i);return a[s3]=n,a[$G]=i,e&&(a[HG]=e),a}function GG(i){return i[s3]}var lD;function l3(){return lD}function aa(i){let n=lD;return lD=i,n}function SD(i,n,e){let a=Ay(i);if(a&&a.providedIn=="root")return a.value===void 0?a.value=a.factory():a.value;if(e&8)return null;if(n!==void 0)return n;mC(i,"Injector")}var qG={},uf=qG,WG="__NG_DI_FLAG__",cD=class{injector;constructor(n){this.injector=n}retrieve(n,e){let a=df(e)||0;try{return this.injector.get(n,a&8?null:uf,a)}catch(d){if(jg(d))return d;throw d}}};function ZG(i,n=0){let e=Cw();if(e===void 0)throw new sn(-203,!1);if(e===null)return SD(i,void 0,n);{let a=YG(n),d=e.retrieve(i,a);if(jg(d)){if(a.optional)return null;throw d}return d}}function dn(i,n=0){return(l3()||ZG)(Os(i),n)}function Ve(i,n){return dn(i,df(n))}function df(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function YG(i){return{optional:!!(i&8),host:!!(i&1),self:!!(i&2),skipSelf:!!(i&4)}}function uD(i){let n=[];for(let e=0;e<i.length;e++){let a=Os(i[e]);if(Array.isArray(a)){if(a.length===0)throw new sn(900,!1);let d,r=0;for(let E=0;E<a.length;E++){let P=a[E],k=XG(P);typeof k=="number"?k===-1?d=P.token:r|=k:d=P}n.push(dn(d,r))}else n.push(dn(a))}return n}function XG(i){return i[WG]}function Ih(i,n){let e=i.hasOwnProperty(My);return e?i[My]:null}function c3(i,n,e){if(i.length!==n.length)return!1;for(let a=0;a<i.length;a++){let d=i[a],r=n[a];if(e&&(d=e(d),r=e(r)),r!==d)return!1}return!0}function u3(i){return i.flat(Number.POSITIVE_INFINITY)}function gC(i,n){i.forEach(e=>Array.isArray(e)?gC(e,n):n(e))}function TD(i,n,e){n>=i.length?i.push(e):i.splice(n,0,e)}function Py(i,n){return n>=i.length-1?i.pop():i.splice(n,1)[0]}function d3(i,n){let e=[];for(let a=0;a<i;a++)e.push(n);return e}function h3(i,n,e,a){let d=i.length;if(d==n)i.push(e,a);else if(d===1)i.push(a,i[0]),i[0]=e;else{for(d--,i.push(i[d-1],i[d]);d>n;){let r=d-2;i[d]=i[r],d--}i[n]=e,i[n+1]=a}}function _C(i,n,e){let a=s_(i,n);return a>=0?i[a|1]=e:(a=~a,h3(i,a,n,e)),a}function vC(i,n){let e=s_(i,n);if(e>=0)return i[e|1]}function s_(i,n){return KG(i,n,1)}function KG(i,n,e){let a=0,d=i.length>>e;for(;d!==a;){let r=a+(d-a>>1),E=i[r<<e];if(n===E)return r<<e;E>n?d=r:a=r+1}return~(d<<e)}var Dh={},la=[],mu=new Kt(""),ID=new Kt("",-1),MD=new Kt(""),Dy=class{get(n,e=uf){if(e===uf){let d=a3("",-201);throw d.name="\u0275NotFound",d}return e}};function DD(i){return i[CD]||null}function gu(i){return i[xD]||null}function AD(i){return i[bD]||null}function p3(i){return i[wD]||null}function Cc(i){return{\u0275providers:i}}function f3(i){return Cc([{provide:mu,multi:!0,useValue:i}])}function m3(...i){return{\u0275providers:PD(!0,i),\u0275fromNgModule:!0}}function PD(i,...n){let e=[],a=new Set,d,r=E=>{e.push(E)};return gC(n,E=>{let P=E;dC(P,r,[],a)&&(d||=[],d.push(P))}),d!==void 0&&g3(d,r),e}function g3(i,n){for(let e=0;e<i.length;e++){let{ngModule:a,providers:d}=i[e];OD(d,r=>{n(r,a)})}}function dC(i,n,e,a){if(i=Os(i),!i)return!1;let d=null,r=aD(i),E=!r&&gu(i);if(!r&&!E){let k=i.ngModule;if(r=aD(k),r)d=k;else return!1}else{if(E&&!E.standalone)return!1;d=i}let P=a.has(d);if(E){if(P)return!1;if(a.add(d),E.dependencies){let k=typeof E.dependencies=="function"?E.dependencies():E.dependencies;for(let X of k)dC(X,n,e,a)}}else if(r){if(r.imports!=null&&!P){a.add(d);let X;try{gC(r.imports,oe=>{dC(oe,n,e,a)&&(X||=[],X.push(oe))})}finally{}X!==void 0&&g3(X,n)}if(!P){let X=Ih(d)||(()=>new d);n({provide:d,useFactory:X,deps:la},d),n({provide:MD,useValue:d,multi:!0},d),n({provide:mu,useValue:()=>dn(d),multi:!0},d)}let k=r.providers;if(k!=null&&!P){let X=i;OD(k,oe=>{n(oe,X)})}}else return!1;return d!==i&&i.providers!==void 0}function OD(i,n){for(let e of i)yD(e)&&(e=e.\u0275providers),Array.isArray(e)?OD(e,n):n(e)}var QG=Rr({provide:String,useValue:Rr});function _3(i){return i!==null&&typeof i=="object"&&QG in i}function JG(i){return!!(i&&i.useExisting)}function eq(i){return!!(i&&i.useFactory)}function hf(i){return typeof i=="function"}function v3(i){return!!i.useClass}var Oy=new Kt(""),cC={},i3={},sD;function a_(){return sD===void 0&&(sD=new Dy),sD}var Yr=class{},pf=class extends Yr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,a,d){super(),this.parent=e,this.source=a,this.scopes=d,hD(n,E=>this.processProvider(E)),this.records.set(ID,o_(void 0,this)),d.has("environment")&&this.records.set(Yr,o_(void 0,this));let r=this.records.get(Oy);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(MD,la,{self:!0}))}retrieve(n,e){let a=df(e)||0;try{return this.get(n,uf,a)}catch(d){if(jg(d))return d;throw d}}destroy(){Iy(this),this._destroyed=!0;let n=Ci(null);try{for(let a of this._ngOnDestroyHooks)a.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let a of e)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ci(n)}}onDestroy(n){return Iy(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){Iy(this);let e=hu(this),a=aa(void 0),d;try{return n()}finally{hu(e),aa(a)}}get(n,e=uf,a){if(Iy(this),n.hasOwnProperty(n3))return n[n3](this);let d=df(a),r,E=hu(this),P=aa(void 0);try{if(!(d&4)){let X=this.records.get(n);if(X===void 0){let oe=oq(n)&&Ay(n);oe&&this.injectableDefInScope(oe)?X=o_(dD(n),cC):X=null,this.records.set(n,X)}if(X!=null)return this.hydrate(n,X,d)}let k=d&2?a_():this.parent;return e=d&8&&e===uf?null:e,k.get(n,e)}catch(k){let X=GG(k);throw X===-200||X===-201?new sn(X,null):k}finally{aa(P),hu(E)}}resolveInjectorInitializers(){let n=Ci(null),e=hu(this),a=aa(void 0),d;try{let r=this.get(mu,la,{self:!0});for(let E of r)E()}finally{hu(e),aa(a),Ci(n)}}toString(){let n=[],e=this.records;for(let a of e.keys())n.push(Sd(a));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Os(n);let e=hf(n)?n:Os(n&&n.provide),a=nq(n);if(!hf(n)&&n.multi===!0){let d=this.records.get(e);d||(d=o_(void 0,cC,!0),d.factory=()=>uD(d.multi),this.records.set(e,d)),e=n,d.multi.push(n)}this.records.set(e,a)}hydrate(n,e,a){let d=Ci(null);try{if(e.value===i3)throw ED(Sd(n));return e.value===cC&&(e.value=i3,e.value=e.factory(void 0,a)),typeof e.value=="object"&&e.value&&rq(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Ci(d)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Os(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function dD(i){let n=Ay(i),e=n!==null?n.factory:Ih(i);if(e!==null)return e;if(i instanceof Kt)throw new sn(204,!1);if(i instanceof Function)return tq(i);throw new sn(204,!1)}function tq(i){if(i.length>0)throw new sn(204,!1);let e=jG(i);return e!==null?()=>e.factory(i):()=>new i}function nq(i){if(_3(i))return o_(void 0,i.useValue);{let n=RD(i);return o_(n,cC)}}function RD(i,n,e){let a;if(hf(i)){let d=Os(i);return Ih(d)||dD(d)}else if(_3(i))a=()=>Os(i.useValue);else if(eq(i))a=()=>i.useFactory(...uD(i.deps||[]));else if(JG(i))a=(d,r)=>dn(Os(i.useExisting),r!==void 0&&r&8?8:void 0);else{let d=Os(i&&(i.useClass||i.provide));if(iq(i))a=()=>new d(...uD(i.deps));else return Ih(d)||dD(d)}return a}function Iy(i){if(i.destroyed)throw new sn(205,!1)}function o_(i,n,e=!1){return{factory:i,value:n,multi:e?[]:void 0}}function iq(i){return!!i.deps}function rq(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function oq(i){return typeof i=="function"||typeof i=="object"&&i.ngMetadataName==="InjectionToken"}function hD(i,n){for(let e of i)Array.isArray(e)?hD(e,n):e&&yD(e)?hD(e.\u0275providers,n):n(e)}function ys(i,n){let e;i instanceof pf?(Iy(i),e=i):e=new cD(i);let a,d=hu(e),r=aa(void 0);try{return n()}finally{hu(d),aa(r)}}function y3(){return l3()!==void 0||Cw()!=null}var Ec=0,ni=1,Ei=2,ls=3,Pl=4,ca=5,gf=6,l_=7,Bo=8,Md=9,_u=10,co=11,c_=12,kD=13,_f=14,ua=15,Ah=16,vf=17,vu=18,Ry=19,FD=20,Ed=21,yC=22,ky=23,il=24,yf=25,xf=26,uo=27,x3=1,LD=6,Ph=7,Fy=8,bf=9,Oo=10;function yu(i){return Array.isArray(i)&&typeof i[x3]=="object"}function Sc(i){return Array.isArray(i)&&i[x3]===!0}function ND(i){return(i.flags&4)!==0}function Oh(i){return i.componentOffset>-1}function Ly(i){return(i.flags&1)===1}function xu(i){return!!i.template}function u_(i){return(i[Ei]&512)!==0}function wf(i){return(i[Ei]&256)===256}var b3="svg",w3="math";function Ol(i){for(;Array.isArray(i);)i=i[Ec];return i}function zD(i,n){return Ol(n[i])}function Tc(i,n){return Ol(n[i.index])}function Ny(i,n){return i.data[n]}function zy(i,n){return i[n]}function BD(i,n,e,a){e>=i.data.length&&(i.data[e]=null,i.blueprint[e]=null),n[e]=a}function Rl(i,n){let e=n[i];return yu(e)?e:e[Ec]}function C3(i){return(i[Ei]&4)===4}function xC(i){return(i[Ei]&128)===128}function E3(i){return Sc(i[ls])}function kl(i,n){return n==null?null:i[n]}function VD(i){i[vf]=0}function UD(i){i[Ei]&1024||(i[Ei]|=1024,xC(i)&&d_(i))}function S3(i,n){for(;i>0;)n=n[_f],i--;return n}function By(i){return!!(i[Ei]&9216||i[il]?.dirty)}function bC(i){i[_u].changeDetectionScheduler?.notify(8),i[Ei]&64&&(i[Ei]|=1024),By(i)&&d_(i)}function d_(i){i[_u].changeDetectionScheduler?.notify(0);let n=Mh(i);for(;n!==null&&!(n[Ei]&8192||(n[Ei]|=8192,!xC(n)));)n=Mh(n)}function jD(i,n){if(wf(i))throw new sn(911,!1);i[Ed]===null&&(i[Ed]=[]),i[Ed].push(n)}function T3(i,n){if(i[Ed]===null)return;let e=i[Ed].indexOf(n);e!==-1&&i[Ed].splice(e,1)}function Mh(i){let n=i[ls];return Sc(n)?n[ls]:n}function $D(i){return i[l_]??=[]}function HD(i){return i.cleanup??=[]}function I3(i,n,e,a){let d=$D(n);d.push(e),i.firstCreatePass&&HD(i).push(a,d.length-1)}var Gi={lFrame:B3(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var pD=!1;function M3(){return Gi.lFrame.elementDepthCount}function D3(){Gi.lFrame.elementDepthCount++}function GD(){Gi.lFrame.elementDepthCount--}function qD(){return Gi.bindingsEnabled}function WD(){return Gi.skipHydrationRootTNode!==null}function ZD(i){return Gi.skipHydrationRootTNode===i}function YD(){Gi.skipHydrationRootTNode=null}function vi(){return Gi.lFrame.lView}function Vo(){return Gi.lFrame.tView}function Me(i){return Gi.lFrame.contextLView=i,i[Bo]}function De(i){return Gi.lFrame.contextLView=null,i}function Rs(){let i=XD();for(;i!==null&&i.type===64;)i=i.parent;return i}function XD(){return Gi.lFrame.currentTNode}function A3(){let i=Gi.lFrame,n=i.currentTNode;return i.isParent?n:n.parent}function h_(i,n){let e=Gi.lFrame;e.currentTNode=i,e.isParent=n}function KD(){return Gi.lFrame.isParent}function QD(){Gi.lFrame.isParent=!1}function P3(){return Gi.lFrame.contextLView}function JD(){return pD}function eA(i){let n=pD;return pD=i,n}function Vy(){let i=Gi.lFrame,n=i.bindingRootIndex;return n===-1&&(n=i.bindingRootIndex=i.tView.bindingStartIndex),n}function O3(){return Gi.lFrame.bindingIndex}function R3(i){return Gi.lFrame.bindingIndex=i}function Cf(){return Gi.lFrame.bindingIndex++}function wC(i){let n=Gi.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+i,e}function k3(){return Gi.lFrame.inI18n}function F3(i,n){let e=Gi.lFrame;e.bindingIndex=e.bindingRootIndex=i,CC(n)}function L3(){return Gi.lFrame.currentDirectiveIndex}function CC(i){Gi.lFrame.currentDirectiveIndex=i}function N3(i){let n=Gi.lFrame.currentDirectiveIndex;return n===-1?null:i[n]}function tA(){return Gi.lFrame.currentQueryIndex}function EC(i){Gi.lFrame.currentQueryIndex=i}function sq(i){let n=i[ni];return n.type===2?n.declTNode:n.type===1?i[ca]:null}function nA(i,n,e){if(e&4){let d=n,r=i;for(;d=d.parent,d===null&&!(e&1);)if(d=sq(r),d===null||(r=r[_f],d.type&10))break;if(d===null)return!1;n=d,i=r}let a=Gi.lFrame=z3();return a.currentTNode=n,a.lView=i,!0}function SC(i){let n=z3(),e=i[ni];Gi.lFrame=n,n.currentTNode=e.firstChild,n.lView=i,n.tView=e,n.contextLView=i,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function z3(){let i=Gi.lFrame,n=i===null?null:i.child;return n===null?B3(i):n}function B3(i){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=n),n}function V3(){let i=Gi.lFrame;return Gi.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var iA=V3;function TC(){let i=V3();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function U3(i){return(Gi.lFrame.contextLView=S3(i,Gi.lFrame.contextLView))[Bo]}function bu(){return Gi.lFrame.selectedIndex}function Rh(i){Gi.lFrame.selectedIndex=i}function IC(){let i=Gi.lFrame;return Ny(i.tView,i.selectedIndex)}function j3(){return Gi.lFrame.currentNamespace}var $3=!0;function MC(){return $3}function DC(i){$3=i}function fD(i,n=null,e=null,a){let d=rA(i,n,e,a);return d.resolveInjectorInitializers(),d}function rA(i,n=null,e=null,a,d=new Set){let r=[e||la,m3(i)];return a=a||(typeof i=="object"?void 0:Sd(i)),new pf(r,n||a_(),a||null,d)}var hr=class i{static THROW_IF_NOT_FOUND=uf;static NULL=new Dy;static create(n,e){if(Array.isArray(n))return fD({name:""},e,n,"");{let a=n.name??"";return fD({name:a},n.parent,n.providers,a)}}static \u0275prov=Rt({token:i,providedIn:"any",factory:()=>dn(ID)});static __NG_ELEMENT_ID__=-1},si=new Kt(""),Fl=(()=>{class i{static __NG_ELEMENT_ID__=aq;static __NG_ENV_ID__=e=>e}return i})(),mD=class extends Fl{_lView;constructor(n){super(),this._lView=n}get destroyed(){return wf(this._lView)}onDestroy(n){let e=this._lView;return jD(e,n),()=>T3(e,n)}};function aq(){return new mD(vi())}var Hs=class{_console=console;handleError(n){this._console.error("ERROR",n)}},Gs=new Kt("",{providedIn:"root",factory:()=>{let i=Ve(Yr),n;return e=>{i.destroyed&&!n?setTimeout(()=>{throw e}):(n??=i.get(Hs),n.handleError(e))}}}),H3={provide:mu,useValue:()=>void Ve(Hs),multi:!0},lq=new Kt("",{providedIn:"root",factory:()=>{let i=Ve(si).defaultView;if(!i)return;let n=Ve(Gs),e=r=>{n(r.reason),r.preventDefault()},a=r=>{r.error?n(r.error):n(new Error(r.message,{cause:r})),r.preventDefault()},d=()=>{i.addEventListener("unhandledrejection",e),i.addEventListener("error",a)};typeof Zone<"u"?Zone.root.run(d):d(),Ve(Fl).onDestroy(()=>{i.removeEventListener("error",a),i.removeEventListener("unhandledrejection",e)})}});function oA(){return Cc([f3(()=>void Ve(lq))])}function sA(i){return typeof i=="function"&&i[$s]!==void 0}function da(i,n){let[e,a,d]=HM(i,n?.equal),r=e,E=r[$s];return r.set=a,r.update=d,r.asReadonly=G3.bind(r),r}function G3(){let i=this[$s];if(i.readonlyFn===void 0){let n=()=>this();n[$s]=i,i.readonlyFn=n}return i.readonlyFn}function aA(i){return sA(i)&&typeof i.set=="function"}var AC=(()=>{class i{view;node;constructor(e,a){this.view=e,this.node=a}static __NG_ELEMENT_ID__=cq}return i})();function cq(){return new AC(vi(),Rs())}var Td=class{},p_=new Kt("",{providedIn:"root",factory:()=>!1});var lA=new Kt(""),cA=new Kt(""),wu=(()=>{class i{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new No(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new ki(e=>{e.next(!1),e.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new i})}return i})(),PC=(()=>{class i{internalPendingTasks=Ve(wu);scheduler=Ve(Td);errorHandler=Ve(Gs);add(){let e=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(e)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(e))}}run(e){let a=this.add();e().catch(this.errorHandler).finally(a)}static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new i})}return i})();function Uy(...i){}var uA=(()=>{class i{static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new gD})}return i})(),gD=class{dirtyEffectCount=0;queues=new Map;add(n){this.enqueue(n),this.schedule(n)}schedule(n){n.dirty&&this.dirtyEffectCount++}remove(n){let e=n.zone,a=this.queues.get(e);a.has(n)&&(a.delete(n),n.dirty&&this.dirtyEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let a=this.queues.get(e);a.has(n)||a.add(n)}flush(){for(;this.dirtyEffectCount>0;){let n=!1;for(let[e,a]of this.queues)e===null?n||=this.flushQueue(a):n||=e.run(()=>this.flushQueue(a));n||(this.dirtyEffectCount=0)}}flushQueue(n){let e=!1;for(let a of n)a.dirty&&(this.dirtyEffectCount--,e=!0,a.run());return e}};function Xy(i){return{toString:i}.toString()}function _q(i){return typeof i=="function"}var UC=class{previousValue;currentValue;firstChange;constructor(n,e,a){this.previousValue=n,this.currentValue=e,this.firstChange=a}isFirstChange(){return this.firstChange}};function Tz(i,n,e,a){n!==null?n.applyValueToInputSignal(n,a):i[e]=a}var Gr=(()=>{let i=()=>Iz;return i.ngInherit=!0,i})();function Iz(i){return i.type.prototype.ngOnChanges&&(i.setInput=yq),vq}function vq(){let i=Dz(this),n=i?.current;if(n){let e=i.previous;if(e===Dh)i.previous=n;else for(let a in n)e[a]=n[a];i.current=null,this.ngOnChanges(n)}}function yq(i,n,e,a,d){let r=this.declaredInputs[a],E=Dz(i)||xq(i,{previous:Dh,current:null}),P=E.current||(E.current={}),k=E.previous,X=k[r];P[r]=new UC(X&&X.currentValue,e,k===Dh),Tz(i,n,d,e)}var Mz="__ngSimpleChanges__";function Dz(i){return i[Mz]||null}function xq(i,n){return i[Mz]=n}var q3=[];var zr=function(i,n=null,e){for(let a=0;a<q3.length;a++){let d=q3[a];d(i,n,e)}};function bq(i,n,e){let{ngOnChanges:a,ngOnInit:d,ngDoCheck:r}=n.type.prototype;if(a){let E=Iz(n);(e.preOrderHooks??=[]).push(i,E),(e.preOrderCheckHooks??=[]).push(i,E)}d&&(e.preOrderHooks??=[]).push(0-i,d),r&&((e.preOrderHooks??=[]).push(i,r),(e.preOrderCheckHooks??=[]).push(i,r))}function Az(i,n){for(let e=n.directiveStart,a=n.directiveEnd;e<a;e++){let r=i.data[e].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:P,ngAfterViewInit:k,ngAfterViewChecked:X,ngOnDestroy:oe}=r;E&&(i.contentHooks??=[]).push(-e,E),P&&((i.contentHooks??=[]).push(e,P),(i.contentCheckHooks??=[]).push(e,P)),k&&(i.viewHooks??=[]).push(-e,k),X&&((i.viewHooks??=[]).push(e,X),(i.viewCheckHooks??=[]).push(e,X)),oe!=null&&(i.destroyHooks??=[]).push(e,oe)}}function NC(i,n,e){Pz(i,n,3,e)}function zC(i,n,e,a){(i[Ei]&3)===e&&Pz(i,n,e,a)}function dA(i,n){let e=i[Ei];(e&3)===n&&(e&=16383,e+=1,i[Ei]=e)}function Pz(i,n,e,a){let d=a!==void 0?i[vf]&65535:0,r=a??-1,E=n.length-1,P=0;for(let k=d;k<E;k++)if(typeof n[k+1]=="number"){if(P=n[k],a!=null&&P>=a)break}else n[k]<0&&(i[vf]+=65536),(P<r||r==-1)&&(wq(i,e,n,k),i[vf]=(i[vf]&4294901760)+k+2),k++}function W3(i,n){zr(4,i,n);let e=Ci(null);try{n.call(i)}finally{Ci(e),zr(5,i,n)}}function wq(i,n,e,a){let d=e[a]<0,r=e[a+1],E=d?-e[a]:e[a],P=i[E];d?i[Ei]>>14<i[vf]>>16&&(i[Ei]&3)===n&&(i[Ei]+=16384,W3(P,r)):W3(P,r)}var m_=-1,Sf=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,a,d){this.factory=n,this.name=d,this.canSeeViewProviders=e,this.injectImpl=a}};function Cq(i){return(i.flags&8)!==0}function Eq(i){return(i.flags&16)!==0}function Sq(i,n,e){let a=0;for(;a<e.length;){let d=e[a];if(typeof d=="number"){if(d!==0)break;a++;let r=e[a++],E=e[a++],P=e[a++];i.setAttribute(n,E,P,r)}else{let r=d,E=e[++a];Tq(r)?i.setProperty(n,r,E):i.setAttribute(n,r,E),a++}}return a}function Oz(i){return i===3||i===4||i===6}function Tq(i){return i.charCodeAt(0)===64}function g_(i,n){if(!(n===null||n.length===0))if(i===null||i.length===0)i=n.slice();else{let e=-1;for(let a=0;a<n.length;a++){let d=n[a];typeof d=="number"?e=d:e===0||(e===-1||e===2?Z3(i,e,d,null,n[++a]):Z3(i,e,d,null,null))}}return i}function Z3(i,n,e,a,d){let r=0,E=i.length;if(n===-1)E=-1;else for(;r<i.length;){let P=i[r++];if(typeof P=="number"){if(P===n){E=-1;break}else if(P>n){E=r-1;break}}}for(;r<i.length;){let P=i[r];if(typeof P=="number")break;if(P===e){d!==null&&(i[r+1]=d);return}r++,d!==null&&r++}E!==-1&&(i.splice(E,0,n),r=E+1),i.splice(r++,0,e),d!==null&&i.splice(r++,0,d)}function Rz(i){return i!==m_}function jC(i){return i&32767}function Iq(i){return i>>16}function $C(i,n){let e=Iq(i),a=n;for(;e>0;)a=a[_f],e--;return a}var CA=!0;function HC(i){let n=CA;return CA=i,n}var Mq=256,kz=Mq-1,Fz=5,Dq=0,Cu={};function Aq(i,n,e){let a;typeof e=="string"?a=e.charCodeAt(0)||0:e.hasOwnProperty(ff)&&(a=e[ff]),a==null&&(a=e[ff]=Dq++);let d=a&kz,r=1<<d;n.data[i+(d>>Fz)]|=r}function GC(i,n){let e=Lz(i,n);if(e!==-1)return e;let a=n[ni];a.firstCreatePass&&(i.injectorIndex=n.length,hA(a.data,i),hA(n,null),hA(a.blueprint,null));let d=l2(i,n),r=i.injectorIndex;if(Rz(d)){let E=jC(d),P=$C(d,n),k=P[ni].data;for(let X=0;X<8;X++)n[r+X]=P[E+X]|k[E+X]}return n[r+8]=d,r}function hA(i,n){i.push(0,0,0,0,0,0,0,0,n)}function Lz(i,n){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||n[i.injectorIndex+8]===null?-1:i.injectorIndex}function l2(i,n){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let e=0,a=null,d=n;for(;d!==null;){if(a=Uz(d),a===null)return m_;if(e++,d=d[_f],a.injectorIndex!==-1)return a.injectorIndex|e<<16}return m_}function EA(i,n,e){Aq(i,n,e)}function Pq(i,n){if(n==="class")return i.classes;if(n==="style")return i.styles;let e=i.attrs;if(e){let a=e.length,d=0;for(;d<a;){let r=e[d];if(Oz(r))break;if(r===0)d=d+2;else if(typeof r=="number")for(d++;d<a&&typeof e[d]=="string";)d++;else{if(r===n)return e[d+1];d=d+2}}}return null}function Nz(i,n,e){if(e&8||i!==void 0)return i;mC(n,"NodeInjector")}function zz(i,n,e,a){if(e&8&&a===void 0&&(a=null),(e&3)===0){let d=i[Md],r=aa(void 0);try{return d?d.get(n,a,e&8):SD(n,a,e&8)}finally{aa(r)}}return Nz(a,n,e)}function Bz(i,n,e,a=0,d){if(i!==null){if(n[Ei]&2048&&!(a&2)){let E=Fq(i,n,e,a,Cu);if(E!==Cu)return E}let r=Vz(i,n,e,a,Cu);if(r!==Cu)return r}return zz(n,e,a,d)}function Vz(i,n,e,a,d){let r=Rq(e);if(typeof r=="function"){if(!nA(n,i,a))return a&1?Nz(d,e,a):zz(n,e,a,d);try{let E;if(E=r(a),E==null&&!(a&8))mC(e);else return E}finally{iA()}}else if(typeof r=="number"){let E=null,P=Lz(i,n),k=m_,X=a&1?n[ua][ca]:null;for((P===-1||a&4)&&(k=P===-1?l2(i,n):n[P+8],k===m_||!X3(a,!1)?P=-1:(E=n[ni],P=jC(k),n=$C(k,n)));P!==-1;){let oe=n[ni];if(Y3(r,P,oe.data)){let Se=Oq(P,n,e,E,a,X);if(Se!==Cu)return Se}k=n[P+8],k!==m_&&X3(a,n[ni].data[P+8]===X)&&Y3(r,P,n)?(E=oe,P=jC(k),n=$C(k,n)):P=-1}}return d}function Oq(i,n,e,a,d,r){let E=n[ni],P=E.data[i+8],k=a==null?Oh(P)&&CA:a!=E&&(P.type&3)!==0,X=d&1&&r===P,oe=BC(P,E,e,k,X);return oe!==null?Hy(n,E,oe,P,d):Cu}function BC(i,n,e,a,d){let r=i.providerIndexes,E=n.data,P=r&1048575,k=i.directiveStart,X=i.directiveEnd,oe=r>>20,Se=a?P:P+oe,$e=d?P+oe:X;for(let ke=Se;ke<$e;ke++){let ht=E[ke];if(ke<k&&e===ht||ke>=k&&ht.type===e)return ke}if(d){let ke=E[k];if(ke&&xu(ke)&&ke.type===e)return k}return null}function Hy(i,n,e,a,d){let r=i[e],E=n.data;if(r instanceof Sf){let P=r;if(P.resolving){let ke=o3(E[e]);throw ED(ke)}let k=HC(P.canSeeViewProviders);P.resolving=!0;let X=E[e].type||E[e],oe,Se=P.injectImpl?aa(P.injectImpl):null,$e=nA(i,a,0);try{r=i[e]=P.factory(void 0,d,E,i,a),n.firstCreatePass&&e>=a.directiveStart&&bq(e,E[e],n)}finally{Se!==null&&aa(Se),HC(k),P.resolving=!1,iA()}}return r}function Rq(i){if(typeof i=="string")return i.charCodeAt(0)||0;let n=i.hasOwnProperty(ff)?i[ff]:void 0;return typeof n=="number"?n>=0?n&kz:kq:n}function Y3(i,n,e){let a=1<<i;return!!(e[n+(i>>Fz)]&a)}function X3(i,n){return!(i&2)&&!(i&1&&n)}var Ef=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,a){return Bz(this._tNode,this._lView,n,df(a),e)}};function kq(){return new Ef(Rs(),vi())}function Tu(i){return Xy(()=>{let n=i.prototype.constructor,e=n[My]||SA(n),a=Object.prototype,d=Object.getPrototypeOf(i.prototype).constructor;for(;d&&d!==a;){let r=d[My]||SA(d);if(r&&r!==e)return r;d=Object.getPrototypeOf(d)}return r=>new r})}function SA(i){return _D(i)?()=>{let n=SA(Os(i));return n&&n()}:Ih(i)}function Fq(i,n,e,a,d){let r=i,E=n;for(;r!==null&&E!==null&&E[Ei]&2048&&!u_(E);){let P=Vz(r,E,e,a|2,Cu);if(P!==Cu)return P;let k=r.parent;if(!k){let X=E[FD];if(X){let oe=X.get(e,Cu,a);if(oe!==Cu)return oe}k=Uz(E),E=E[_f]}r=k}return d}function Uz(i){let n=i[ni],e=n.type;return e===2?n.declTNode:e===1?i[ca]:null}function Ky(i){return Pq(Rs(),i)}function Lq(){return x_(Rs(),vi())}function x_(i,n){return new pr(Tc(i,n))}var pr=(()=>{class i{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=Lq}return i})();function Nq(i){return i instanceof pr?i.nativeElement:i}function zq(){return this._results[Symbol.iterator]()}var qC=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new li}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;let a=u3(n);(this._changesDetected=!c3(this._results,a,e))&&(this._results=a,this.length=a.length,this.last=a[this.length-1],this.first=a[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=zq};function jz(i){return(i.flags&128)===128}var c2=(function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i})(c2||{}),$z=new Map,Bq=0;function Vq(){return Bq++}function Uq(i){$z.set(i[Ry],i)}function TA(i){$z.delete(i[Ry])}var K3="__ngContext__";function __(i,n){yu(n)?(i[K3]=n[Ry],Uq(n)):i[K3]=n}function Hz(i){return qz(i[c_])}function Gz(i){return qz(i[Pl])}function qz(i){for(;i!==null&&!Sc(i);)i=i[Pl];return i}var IA;function u2(i){IA=i}function Wz(){if(IA!==void 0)return IA;if(typeof document<"u")return document;throw new sn(210,!1)}var b_=new Kt("",{providedIn:"root",factory:()=>jq}),jq="ng",aE=new Kt(""),Mf=new Kt("",{providedIn:"platform",factory:()=>"unknown"});var Qy=new Kt(""),w_=new Kt("",{providedIn:"root",factory:()=>Wz().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var $q="h",Hq="b";var Zz="r";var Yz="di";var Xz=!1,Kz=new Kt("",{providedIn:"root",factory:()=>Xz});var lE=new Kt("");var Gq=(i,n,e,a)=>{};function qq(i,n,e,a){Gq(i,n,e,a)}function cE(i){return(i.flags&32)===32}var Wq=()=>null;function Qz(i,n,e=!1){return Wq(i,n,e)}function Jz(i,n){let e=i.contentQueries;if(e!==null){let a=Ci(null);try{for(let d=0;d<e.length;d+=2){let r=e[d],E=e[d+1];if(E!==-1){let P=i.data[E];EC(r),P.contentQueries(2,n[E],E)}}}finally{Ci(a)}}}function MA(i,n,e){EC(0);let a=Ci(null);try{n(i,e)}finally{Ci(a)}}function eB(i,n,e){if(ND(n)){let a=Ci(null);try{let d=n.directiveStart,r=n.directiveEnd;for(let E=d;E<r;E++){let P=i.data[E];if(P.contentQueries){let k=e[E];P.contentQueries(1,k,E)}}}finally{Ci(a)}}}var Dd=(function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i})(Dd||{});var OC;function Zq(){if(OC===void 0&&(OC=null,Al.trustedTypes))try{OC=Al.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return OC}function uE(i){return Zq()?.createHTML(i)||i}var RC;function Yq(){if(RC===void 0&&(RC=null,Al.trustedTypes))try{RC=Al.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return RC}function Q3(i){return Yq()?.createScriptURL(i)||i}var Ad=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${hC})`}},DA=class extends Ad{getTypeName(){return"HTML"}},AA=class extends Ad{getTypeName(){return"Style"}},PA=class extends Ad{getTypeName(){return"Script"}},OA=class extends Ad{getTypeName(){return"URL"}},RA=class extends Ad{getTypeName(){return"ResourceURL"}};function Nl(i){return i instanceof Ad?i.changingThisBreaksApplicationSecurity:i}function Pd(i,n){let e=tB(i);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${hC})`)}return e===n}function tB(i){return i instanceof Ad&&i.getTypeName()||null}function d2(i){return new DA(i)}function h2(i){return new AA(i)}function p2(i){return new PA(i)}function f2(i){return new OA(i)}function m2(i){return new RA(i)}function Xq(i){let n=new FA(i);return Kq()?new kA(n):n}var kA=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let e=new window.DOMParser().parseFromString(uE(n),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(n):(e.firstChild?.remove(),e)}catch{return null}}},FA=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let e=this.inertDocument.createElement("template");return e.innerHTML=uE(n),e}};function Kq(){try{return!!new window.DOMParser().parseFromString(uE(""),"text/html")}catch{return!1}}var Qq=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Jy(i){return i=String(i),i.match(Qq)?i:"unsafe:"+i}function Od(i){let n={};for(let e of i.split(","))n[e]=!0;return n}function ex(...i){let n={};for(let e of i)for(let a in e)e.hasOwnProperty(a)&&(n[a]=!0);return n}var nB=Od("area,br,col,hr,img,wbr"),iB=Od("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),rB=Od("rp,rt"),Jq=ex(rB,iB),e9=ex(iB,Od("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),t9=ex(rB,Od("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),J3=ex(nB,e9,t9,Jq),oB=Od("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),n9=Od("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),i9=Od("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),r9=ex(oB,n9,i9),o9=Od("script,style,template"),LA=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let e=n.firstChild,a=!0,d=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?a=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,a&&e.firstChild){d.push(e),e=l9(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=a9(e);if(r){e=r;break}e=d.pop()}}return this.buf.join("")}startElement(n){let e=ez(n).toLowerCase();if(!J3.hasOwnProperty(e))return this.sanitizedSomething=!0,!o9.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let a=n.attributes;for(let d=0;d<a.length;d++){let r=a.item(d),E=r.name,P=E.toLowerCase();if(!r9.hasOwnProperty(P)){this.sanitizedSomething=!0;continue}let k=r.value;oB[P]&&(k=Jy(k)),this.buf.push(" ",E,'="',tz(k),'"')}return this.buf.push(">"),!0}endElement(n){let e=ez(n).toLowerCase();J3.hasOwnProperty(e)&&!nB.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(tz(n))}};function s9(i,n){return(i.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function a9(i){let n=i.nextSibling;if(n&&i!==n.previousSibling)throw sB(n);return n}function l9(i){let n=i.firstChild;if(n&&s9(i,n))throw sB(n);return n}function ez(i){let n=i.nodeName;return typeof n=="string"?n:"FORM"}function sB(i){return new Error(`Failed to sanitize html because the element is clobbered: ${i.outerHTML}`)}var c9=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,u9=/([^\#-~ |!])/g;function tz(i){return i.replace(/&/g,"&amp;").replace(c9,function(n){let e=n.charCodeAt(0),a=n.charCodeAt(1);return"&#"+((e-55296)*1024+(a-56320)+65536)+";"}).replace(u9,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var kC;function g2(i,n){let e=null;try{kC=kC||Xq(i);let a=n?String(n):"";e=kC.getInertBodyElement(a);let d=5,r=a;do{if(d===0)throw new Error("Failed to sanitize html because the input is unstable");d--,a=r,r=e.innerHTML,e=kC.getInertBodyElement(a)}while(a!==r);let P=new LA().sanitizeChildren(nz(e)||e);return uE(P)}finally{if(e){let a=nz(e)||e;for(;a.firstChild;)a.firstChild.remove()}}}function nz(i){return"content"in i&&d9(i)?i.content:null}function d9(i){return i.nodeType===Node.ELEMENT_NODE&&i.nodeName==="TEMPLATE"}function h9(i,n){return i.createText(n)}function p9(i,n,e){i.setValue(n,e)}function aB(i,n,e){return i.createElement(n,e)}function WC(i,n,e,a,d){i.insertBefore(n,e,a,d)}function lB(i,n,e){i.appendChild(n,e)}function iz(i,n,e,a,d){a!==null?WC(i,n,e,a,d):lB(i,n,e)}function cB(i,n,e,a){i.removeChild(null,n,e,a)}function f9(i,n,e){i.setAttribute(n,"style",e)}function m9(i,n,e){e===""?i.removeAttribute(n,"class"):i.setAttribute(n,"class",e)}function uB(i,n,e){let{mergedAttrs:a,classes:d,styles:r}=e;a!==null&&Sq(i,n,a),d!==null&&m9(i,n,d),r!==null&&f9(i,n,r)}var ks=(function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i})(ks||{});function to(i){let n=hB();return n?n.sanitize(ks.URL,i)||"":Pd(i,"URL")?Nl(i):Jy(mf(i))}function dB(i){let n=hB();if(n)return Q3(n.sanitize(ks.RESOURCE_URL,i)||"");if(Pd(i,"ResourceURL"))return Q3(Nl(i));throw new sn(904,!1)}function g9(i,n){return n==="src"&&(i==="embed"||i==="frame"||i==="iframe"||i==="media"||i==="script")||n==="href"&&(i==="base"||i==="link")?dB:to}function _2(i,n,e){return g9(n,e)(i)}function hB(){let i=vi();return i&&i[_u].sanitizer}function v2(i){return i.ownerDocument.defaultView}function tx(i){return i.ownerDocument}function pB(i){return i instanceof Function?i():i}function _9(i,n,e){let a=i.length;for(;;){let d=i.indexOf(n,e);if(d===-1)return d;if(d===0||i.charCodeAt(d-1)<=32){let r=n.length;if(d+r===a||i.charCodeAt(d+r)<=32)return d}e=d+1}}var fB="ng-template";function v9(i,n,e,a){let d=0;if(a){for(;d<n.length&&typeof n[d]=="string";d+=2)if(n[d]==="class"&&_9(n[d+1].toLowerCase(),e,0)!==-1)return!0}else if(y2(i))return!1;if(d=n.indexOf(1,d),d>-1){let r;for(;++d<n.length&&typeof(r=n[d])=="string";)if(r.toLowerCase()===e)return!0}return!1}function y2(i){return i.type===4&&i.value!==fB}function y9(i,n,e){let a=i.type===4&&!e?fB:i.value;return n===a}function x9(i,n,e){let a=4,d=i.attrs,r=d!==null?C9(d):0,E=!1;for(let P=0;P<n.length;P++){let k=n[P];if(typeof k=="number"){if(!E&&!Ic(a)&&!Ic(k))return!1;if(E&&Ic(k))continue;E=!1,a=k|a&1;continue}if(!E)if(a&4){if(a=2|a&1,k!==""&&!y9(i,k,e)||k===""&&n.length===1){if(Ic(a))return!1;E=!0}}else if(a&8){if(d===null||!v9(i,d,k,e)){if(Ic(a))return!1;E=!0}}else{let X=n[++P],oe=b9(k,d,y2(i),e);if(oe===-1){if(Ic(a))return!1;E=!0;continue}if(X!==""){let Se;if(oe>r?Se="":Se=d[oe+1].toLowerCase(),a&2&&X!==Se){if(Ic(a))return!1;E=!0}}}}return Ic(a)||E}function Ic(i){return(i&1)===0}function b9(i,n,e,a){if(n===null)return-1;let d=0;if(a||!e){let r=!1;for(;d<n.length;){let E=n[d];if(E===i)return d;if(E===3||E===6)r=!0;else if(E===1||E===2){let P=n[++d];for(;typeof P=="string";)P=n[++d];continue}else{if(E===4)break;if(E===0){d+=4;continue}}d+=r?1:2}return-1}else return E9(n,i)}function mB(i,n,e=!1){for(let a=0;a<n.length;a++)if(x9(i,n[a],e))return!0;return!1}function w9(i){let n=i.attrs;if(n!=null){let e=n.indexOf(5);if((e&1)===0)return n[e+1]}return null}function C9(i){for(let n=0;n<i.length;n++){let e=i[n];if(Oz(e))return n}return i.length}function E9(i,n){let e=i.indexOf(4);if(e>-1)for(e++;e<i.length;){let a=i[e];if(typeof a=="number")return-1;if(a===n)return e;e++}return-1}function S9(i,n){e:for(let e=0;e<n.length;e++){let a=n[e];if(i.length===a.length){for(let d=0;d<i.length;d++)if(i[d]!==a[d])continue e;return!0}}return!1}function rz(i,n){return i?":not("+n.trim()+")":n}function T9(i){let n=i[0],e=1,a=2,d="",r=!1;for(;e<i.length;){let E=i[e];if(typeof E=="string")if(a&2){let P=i[++e];d+="["+E+(P.length>0?'="'+P+'"':"")+"]"}else a&8?d+="."+E:a&4&&(d+=" "+E);else d!==""&&!Ic(E)&&(n+=rz(r,d),d=""),a=E,r=r||!Ic(a);e++}return d!==""&&(n+=rz(r,d)),n}function I9(i){return i.map(T9).join(",")}function M9(i){let n=[],e=[],a=1,d=2;for(;a<i.length;){let r=i[a];if(typeof r=="string")d===2?r!==""&&n.push(r,i[++a]):d===8&&e.push(r);else{if(!Ic(d))break;d=r}a++}return e.length&&n.push(1,...e),n}var ha={};function x2(i,n,e,a,d,r,E,P,k,X,oe){let Se=uo+a,$e=Se+d,ke=D9(Se,$e),ht=typeof X=="function"?X():X;return ke[ni]={type:i,blueprint:ke,template:e,queries:null,viewQuery:P,declTNode:n,data:ke.slice().fill(null,Se),bindingStartIndex:Se,expandoStartIndex:$e,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof E=="function"?E():E,firstChild:null,schemas:k,consts:ht,incompleteFirstPass:!1,ssrId:oe}}function D9(i,n){let e=[];for(let a=0;a<n;a++)e.push(a<i?null:ha);return e}function A9(i){let n=i.tView;return n===null||n.incompleteFirstPass?i.tView=x2(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):n}function b2(i,n,e,a,d,r,E,P,k,X,oe){let Se=n.blueprint.slice();return Se[Ec]=d,Se[Ei]=a|4|128|8|64|1024,(X!==null||i&&i[Ei]&2048)&&(Se[Ei]|=2048),VD(Se),Se[ls]=Se[_f]=i,Se[Bo]=e,Se[_u]=E||i&&i[_u],Se[co]=P||i&&i[co],Se[Md]=k||i&&i[Md]||null,Se[ca]=r,Se[Ry]=Vq(),Se[gf]=oe,Se[FD]=X,Se[ua]=n.type==2?i[ua]:Se,Se}function P9(i,n,e){let a=Tc(n,i),d=A9(e),r=i[_u].rendererFactory,E=w2(i,b2(i,d,null,gB(e),a,n,null,r.createRenderer(a,e),null,null,null));return i[n.index]=E}function gB(i){let n=16;return i.signals?n=4096:i.onPush&&(n=64),n}function _B(i,n,e,a){if(e===0)return-1;let d=n.length;for(let r=0;r<e;r++)n.push(a),i.blueprint.push(a),i.data.push(null);return d}function w2(i,n){return i[c_]?i[kD][Pl]=n:i[c_]=n,i[kD]=n,n}function J(i=1){vB(Vo(),vi(),bu()+i,!1)}function vB(i,n,e,a){if(!a)if((n[Ei]&3)===3){let r=i.preOrderCheckHooks;r!==null&&NC(n,r,e)}else{let r=i.preOrderHooks;r!==null&&zC(n,r,0,e)}Rh(e)}var dE=(function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i})(dE||{});function NA(i,n,e,a){let d=Ci(null);try{let[r,E,P]=i.inputs[e],k=null;(E&dE.SignalBased)!==0&&(k=n[r][$s]),k!==null&&k.transformFn!==void 0?a=k.transformFn(a):P!==null&&(a=P.call(n,a)),i.setInput!==null?i.setInput(n,k,a,e,r):Tz(n,k,r,a)}finally{Ci(d)}}var Eu=(function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i})(Eu||{}),O9;function C2(i,n){return O9(i,n)}var Tf=new Set,hE=(function(i){return i[i.CHANGE_DETECTION=0]="CHANGE_DETECTION",i[i.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",i})(hE||{}),Df=new Kt(""),oz=new Set;function Dc(i){oz.has(i)||(oz.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var yB=!1,zA=class extends li{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,y3()&&(this.destroyRef=Ve(Fl,{optional:!0})??void 0,this.pendingTasks=Ve(wu,{optional:!0})??void 0)}emit(n){let e=Ci(null);try{super.next(n)}finally{Ci(e)}}subscribe(n,e,a){let d=n,r=e||(()=>null),E=a;if(n&&typeof n=="object"){let k=n;d=k.next?.bind(k),r=k.error?.bind(k),E=k.complete?.bind(k)}this.__isAsync&&(r=this.wrapInTimeout(r),d&&(d=this.wrapInTimeout(d)),E&&(E=this.wrapInTimeout(E)));let P=super.subscribe({next:d,error:r,complete:E});return n instanceof Hr&&n.add(P),P}wrapInTimeout(n){return e=>{let a=this.pendingTasks?.add();setTimeout(()=>{try{n(e)}finally{a!==void 0&&this.pendingTasks?.remove(a)}})}}},$t=zA;function xB(i){let n,e;function a(){i=Uy;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{i(),a()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{i(),a()})),()=>a()}function sz(i){return queueMicrotask(()=>i()),()=>{i=Uy}}var E2="isAngularZone",ZC=E2+"_ID",R9=0,yi=class i{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new $t(!1);onMicrotaskEmpty=new $t(!1);onStable=new $t(!1);onError=new $t(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1,scheduleInRootZone:r=yB}=n;if(typeof Zone>"u")throw new sn(908,!1);Zone.assertZonePatched();let E=this;E._nesting=0,E._outer=E._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(E._inner=E._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(E._inner=E._inner.fork(Zone.longStackTraceZoneSpec)),E.shouldCoalesceEventChangeDetection=!d&&a,E.shouldCoalesceRunChangeDetection=d,E.callbackScheduled=!1,E.scheduleInRootZone=r,L9(E)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(E2)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new sn(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new sn(909,!1)}run(n,e,a){return this._inner.run(n,e,a)}runTask(n,e,a,d){let r=this._inner,E=r.scheduleEventTask("NgZoneEvent: "+d,n,k9,Uy,Uy);try{return r.runTask(E,e,a)}finally{r.cancelTask(E)}}runGuarded(n,e,a){return this._inner.runGuarded(n,e,a)}runOutsideAngular(n){return this._outer.run(n)}},k9={};function S2(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function F9(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function n(){xB(()=>{i.callbackScheduled=!1,BA(i),i.isCheckStableRunning=!0,S2(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{n()}):i._outer.run(()=>{n()}),BA(i)}function L9(i){let n=()=>{F9(i)},e=R9++;i._inner=i._inner.fork({name:"angular",properties:{[E2]:!0,[ZC]:e,[ZC+e]:!0},onInvokeTask:(a,d,r,E,P,k)=>{if(N9(k))return a.invokeTask(r,E,P,k);try{return az(i),a.invokeTask(r,E,P,k)}finally{(i.shouldCoalesceEventChangeDetection&&E.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&n(),lz(i)}},onInvoke:(a,d,r,E,P,k,X)=>{try{return az(i),a.invoke(r,E,P,k,X)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!z9(k)&&n(),lz(i)}},onHasTask:(a,d,r,E)=>{a.hasTask(r,E),d===r&&(E.change=="microTask"?(i._hasPendingMicrotasks=E.microTask,BA(i),S2(i)):E.change=="macroTask"&&(i.hasPendingMacrotasks=E.macroTask))},onHandleError:(a,d,r,E)=>(a.handleError(r,E),i.runOutsideAngular(()=>i.onError.emit(E)),!1)})}function BA(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function az(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function lz(i){i._nesting--,S2(i)}var YC=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new $t;onMicrotaskEmpty=new $t;onStable=new $t;onError=new $t;run(n,e,a){return n.apply(e,a)}runGuarded(n,e,a){return n.apply(e,a)}runOutsideAngular(n){return n()}runTask(n,e,a,d){return n.apply(e,a)}};function N9(i){return bB(i,"__ignore_ng_zone__")}function z9(i){return bB(i,"__scheduler_tick__")}function bB(i,n){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[n]===!0}var T2=(()=>{class i{impl=null;execute(){this.impl?.execute()}static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new i})}return i})(),wB=[0,1,2,3],CB=(()=>{class i{ngZone=Ve(yi);scheduler=Ve(Td);errorHandler=Ve(Hs,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Ve(Df,{optional:!0})}execute(){let e=this.sequences.size>0;e&&zr(16),this.executing=!0;for(let a of wB)for(let d of this.sequences)if(!(d.erroredOrDestroyed||!d.hooks[a]))try{d.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let r=d.hooks[a];return r(d.pipelinedValue)},d.snapshot))}catch(r){d.erroredOrDestroyed=!0,this.errorHandler?.handleError(r)}this.executing=!1;for(let a of this.sequences)a.afterRun(),a.once&&(this.sequences.delete(a),a.destroy());for(let a of this.deferredRegistrations)this.sequences.add(a);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&zr(17)}register(e){let{view:a}=e;a!==void 0?((a[yf]??=[]).push(e),d_(a),a[Ei]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,a){return a?a.run(hE.AFTER_NEXT_RENDER,e):e()}static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new i})}return i})(),XC=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(n,e,a,d,r,E=null){this.impl=n,this.hooks=e,this.view=a,this.once=d,this.snapshot=E,this.unregisterOnDestroy=r?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let n=this.view?.[yf];n&&(this.view[yf]=n.filter(e=>e!==this))}};function zl(i,n){let e=n?.injector??Ve(hr);return Dc("NgAfterNextRender"),V9(i,e,n,!0)}function B9(i){return i instanceof Function?[void 0,void 0,i,void 0]:[i.earlyRead,i.write,i.mixedReadWrite,i.read]}function V9(i,n,e,a){let d=n.get(T2);d.impl??=n.get(CB);let r=n.get(Df,null,{optional:!0}),E=e?.manualCleanup!==!0?n.get(Fl):null,P=n.get(AC,null,{optional:!0}),k=new XC(d.impl,B9(i),P?.view,a,E,r?.snapshot(null));return d.impl.register(k),k}var EB=new Kt("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function SB(i,n,e){let a=i.get(EB);if(Array.isArray(n))for(let d of n)a.queue.add(d),e?.detachedLeaveAnimationFns?.push(d);else a.queue.add(n),e?.detachedLeaveAnimationFns?.push(n);a.scheduler&&a.scheduler(i)}function U9(i,n){let e=i.get(EB);if(n.detachedLeaveAnimationFns){for(let a of n.detachedLeaveAnimationFns)e.queue.delete(a);n.detachedLeaveAnimationFns=void 0}}function j9(i,n){for(let[e,a]of n)SB(i,a.animateFns)}function cz(i,n,e,a){let d=i?.[xf]?.enter;n!==null&&d&&d.has(e.index)&&j9(a,d)}function f_(i,n,e,a,d,r,E,P){if(d!=null){let k,X=!1;Sc(d)?k=d:yu(d)&&(X=!0,d=d[Ec]);let oe=Ol(d);i===0&&a!==null?(cz(P,a,r,e),E==null?lB(n,a,oe):WC(n,a,oe,E||null,!0)):i===1&&a!==null?(cz(P,a,r,e),WC(n,a,oe,E||null,!0)):i===2?uz(P,r,e,Se=>{cB(n,oe,X,Se)}):i===3&&uz(P,r,e,()=>{n.destroyNode(oe)}),k!=null&&J9(n,i,e,k,r,a,E)}}function $9(i,n){TB(i,n),n[Ec]=null,n[ca]=null}function H9(i,n,e,a,d,r){a[Ec]=d,a[ca]=n,fE(i,a,e,1,d,r)}function TB(i,n){n[_u].changeDetectionScheduler?.notify(9),fE(i,n,n[co],2,null,null)}function G9(i){let n=i[c_];if(!n)return pA(i[ni],i);for(;n;){let e=null;if(yu(n))e=n[c_];else{let a=n[Oo];a&&(e=a)}if(!e){for(;n&&!n[Pl]&&n!==i;)yu(n)&&pA(n[ni],n),n=n[ls];n===null&&(n=i),yu(n)&&pA(n[ni],n),e=n&&n[Pl]}n=e}}function I2(i,n){let e=i[bf],a=e.indexOf(n);e.splice(a,1)}function pE(i,n){if(wf(n))return;let e=n[co];e.destroyNode&&fE(i,n,e,3,null,null),G9(n)}function pA(i,n){if(wf(n))return;let e=Ci(null);try{n[Ei]&=-129,n[Ei]|=256,n[il]&&by(n[il]),Z9(i,n),W9(i,n),n[ni].type===1&&n[co].destroy();let a=n[Ah];if(a!==null&&Sc(n[ls])){a!==n[ls]&&I2(a,n);let d=n[vu];d!==null&&d.detachView(i)}TA(n)}finally{Ci(e)}}function uz(i,n,e,a){let d=i?.[xf];if(d==null||d.leave==null||!d.leave.has(n.index))return a(!1);i&&Tf.add(i),SB(e,()=>{if(d.leave&&d.leave.has(n.index)){let E=d.leave.get(n.index),P=[];if(E){for(let k=0;k<E.animateFns.length;k++){let X=E.animateFns[k],{promise:oe}=X();P.push(oe)}d.detachedLeaveAnimationFns=void 0}d.running=Promise.allSettled(P),q9(i,a)}else i&&Tf.delete(i),a(!1)},d)}function q9(i,n){let e=i[xf]?.running;if(e){e.then(()=>{i[xf].running=void 0,Tf.delete(i),n(!0)});return}n(!1)}function W9(i,n){let e=i.cleanup,a=n[l_];if(e!==null)for(let E=0;E<e.length-1;E+=2)if(typeof e[E]=="string"){let P=e[E+3];P>=0?a[P]():a[-P].unsubscribe(),E+=2}else{let P=a[e[E+1]];e[E].call(P)}a!==null&&(n[l_]=null);let d=n[Ed];if(d!==null){n[Ed]=null;for(let E=0;E<d.length;E++){let P=d[E];P()}}let r=n[ky];if(r!==null){n[ky]=null;for(let E of r)E.destroy()}}function Z9(i,n){let e;if(i!=null&&(e=i.destroyHooks)!=null)for(let a=0;a<e.length;a+=2){let d=n[e[a]];if(!(d instanceof Sf)){let r=e[a+1];if(Array.isArray(r))for(let E=0;E<r.length;E+=2){let P=d[r[E]],k=r[E+1];zr(4,P,k);try{k.call(P)}finally{zr(5,P,k)}}else{zr(4,d,r);try{r.call(d)}finally{zr(5,d,r)}}}}}function IB(i,n,e){return Y9(i,n.parent,e)}function Y9(i,n,e){let a=n;for(;a!==null&&a.type&168;)n=a,a=n.parent;if(a===null)return e[Ec];if(Oh(a)){let{encapsulation:d}=i.data[a.directiveStart+a.componentOffset];if(d===Dd.None||d===Dd.Emulated)return null}return Tc(a,e)}function MB(i,n,e){return K9(i,n,e)}function X9(i,n,e){return i.type&40?Tc(i,e):null}var K9=X9,dz;function M2(i,n,e,a){let d=IB(i,a,n),r=n[co],E=a.parent||n[ca],P=MB(E,a,n);if(d!=null)if(Array.isArray(e))for(let k=0;k<e.length;k++)iz(r,d,e[k],P,!1);else iz(r,d,e,P,!1);dz!==void 0&&dz(r,a,n,e,d)}function jy(i,n){if(n!==null){let e=n.type;if(e&3)return Tc(n,i);if(e&4)return VA(-1,i[n.index]);if(e&8){let a=n.child;if(a!==null)return jy(i,a);{let d=i[n.index];return Sc(d)?VA(-1,d):Ol(d)}}else{if(e&128)return jy(i,n.next);if(e&32)return C2(n,i)()||Ol(i[n.index]);{let a=DB(i,n);if(a!==null){if(Array.isArray(a))return a[0];let d=Mh(i[ua]);return jy(d,a)}else return jy(i,n.next)}}}return null}function DB(i,n){if(n!==null){let a=i[ua][ca],d=n.projection;return a.projection[d]}return null}function VA(i,n){let e=Oo+i+1;if(e<n.length){let a=n[e],d=a[ni].firstChild;if(d!==null)return jy(a,d)}return n[Ph]}function D2(i,n,e,a,d,r,E){for(;e!=null;){let P=a[Md];if(e.type===128){e=e.next;continue}let k=a[e.index],X=e.type;if(E&&n===0&&(k&&__(Ol(k),a),e.flags|=2),!cE(e))if(X&8)D2(i,n,e.child,a,d,r,!1),f_(n,i,P,d,k,e,r,a);else if(X&32){let oe=C2(e,a),Se;for(;Se=oe();)f_(n,i,P,d,Se,e,r,a);f_(n,i,P,d,k,e,r,a)}else X&16?AB(i,n,a,e,d,r):f_(n,i,P,d,k,e,r,a);e=E?e.projectionNext:e.next}}function fE(i,n,e,a,d,r){D2(e,a,i.firstChild,n,d,r,!1)}function Q9(i,n,e){let a=n[co],d=IB(i,e,n),r=e.parent||n[ca],E=MB(r,e,n);AB(a,0,n,e,d,E)}function AB(i,n,e,a,d,r){let E=e[ua],k=E[ca].projection[a.projection];if(Array.isArray(k))for(let X=0;X<k.length;X++){let oe=k[X];f_(n,i,e[Md],d,oe,a,r,e)}else{let X=k,oe=E[ls];jz(a)&&(X.flags|=128),D2(i,n,X,oe,d,r,!0)}}function J9(i,n,e,a,d,r,E){let P=a[Ph],k=Ol(a);P!==k&&f_(n,i,e,r,P,d,E);for(let X=Oo;X<a.length;X++){let oe=a[X];fE(oe[ni],oe,i,n,r,P)}}function e7(i,n,e,a,d){if(n)d?i.addClass(e,a):i.removeClass(e,a);else{let r=a.indexOf("-")===-1?void 0:Eu.DashCase;d==null?i.removeStyle(e,a,r):(typeof d=="string"&&d.endsWith("!important")&&(d=d.slice(0,-10),r|=Eu.Important),i.setStyle(e,a,d,r))}}function PB(i,n,e,a,d){let r=bu(),E=a&2;try{Rh(-1),E&&n.length>uo&&vB(i,n,uo,!1),zr(E?2:0,d,e),e(a,d)}finally{Rh(r),zr(E?3:1,d,e)}}function A2(i,n,e){a7(i,n,e),(e.flags&64)===64&&l7(i,n,e)}function mE(i,n,e=Tc){let a=n.localNames;if(a!==null){let d=n.index+1;for(let r=0;r<a.length;r+=2){let E=a[r+1],P=E===-1?e(n,i):i[E];i[d++]=P}}}function t7(i,n,e,a){let r=a.get(Kz,Xz)||e===Dd.ShadowDom,E=i.selectRootElement(n,r);return n7(E),E}function n7(i){i7(i)}var i7=()=>null;function r7(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function OB(i,n,e,a,d,r){let E=n[ni];if(P2(i,E,n,e,a)){Oh(i)&&s7(n,i.index);return}i.type&3&&(e=r7(e)),o7(i,n,e,a,d,r)}function o7(i,n,e,a,d,r){if(i.type&3){let E=Tc(i,n);a=r!=null?r(a,i.value||"",e):a,d.setProperty(E,e,a)}else i.type&12}function s7(i,n){let e=Rl(n,i);e[Ei]&16||(e[Ei]|=64)}function a7(i,n,e){let a=e.directiveStart,d=e.directiveEnd;Oh(e)&&P9(n,e,i.data[a+e.componentOffset]),i.firstCreatePass||GC(e,n);let r=e.initialInputs;for(let E=a;E<d;E++){let P=i.data[E],k=Hy(n,i,E,e);if(__(k,n),r!==null&&h7(n,E-a,k,P,e,r),xu(P)){let X=Rl(e.index,n);X[Bo]=Hy(n,i,E,e)}}}function l7(i,n,e){let a=e.directiveStart,d=e.directiveEnd,r=e.index,E=L3();try{Rh(r);for(let P=a;P<d;P++){let k=i.data[P],X=n[P];CC(P),(k.hostBindings!==null||k.hostVars!==0||k.hostAttrs!==null)&&c7(k,X)}}finally{Rh(-1),CC(E)}}function c7(i,n){i.hostBindings!==null&&i.hostBindings(1,n)}function RB(i,n){let e=i.directiveRegistry,a=null;if(e)for(let d=0;d<e.length;d++){let r=e[d];mB(n,r.selectors,!1)&&(a??=[],xu(r)?a.unshift(r):a.push(r))}return a}function u7(i,n,e,a,d,r){let E=Tc(i,n);d7(n[co],E,r,i.value,e,a,d)}function d7(i,n,e,a,d,r,E){if(r==null)i.removeAttribute(n,d,e);else{let P=E==null?mf(r):E(r,a||"",d);i.setAttribute(n,d,P,e)}}function h7(i,n,e,a,d,r){let E=r[n];if(E!==null)for(let P=0;P<E.length;P+=2){let k=E[P],X=E[P+1];NA(a,e,k,X)}}function kB(i,n,e,a,d){let r=uo+e,E=n[ni],P=d(E,n,i,a,e);n[r]=P,h_(i,!0);let k=i.type===2;return k?(uB(n[co],P,i),(M3()===0||Ly(i))&&__(P,n),D3()):__(P,n),MC()&&(!k||!cE(i))&&M2(E,n,P,i),i}function FB(i){let n=i;return KD()?QD():(n=n.parent,h_(n,!1)),n}function p7(i,n){let e=i[Md];if(!e)return;let a;try{a=e.get(Gs,null)}catch{a=null}a?.(n)}function P2(i,n,e,a,d){let r=i.inputs?.[a],E=i.hostDirectiveInputs?.[a],P=!1;if(E)for(let k=0;k<E.length;k+=2){let X=E[k],oe=E[k+1],Se=n.data[X];NA(Se,e[X],oe,d),P=!0}if(r)for(let k of r){let X=e[k],oe=n.data[k];NA(oe,X,a,d),P=!0}return P}function f7(i,n){let e=Rl(n,i),a=e[ni];m7(a,e);let d=e[Ec];d!==null&&e[gf]===null&&(e[gf]=Qz(d,e[Md])),zr(18),O2(a,e,e[Bo]),zr(19,e[Bo])}function m7(i,n){for(let e=n.length;e<i.blueprint.length;e++)n.push(i.blueprint[e])}function O2(i,n,e){SC(n);try{let a=i.viewQuery;a!==null&&MA(1,a,e);let d=i.template;d!==null&&PB(i,n,d,1,e),i.firstCreatePass&&(i.firstCreatePass=!1),n[vu]?.finishViewCreation(i),i.staticContentQueries&&Jz(i,n),i.staticViewQueries&&MA(2,i.viewQuery,e);let r=i.components;r!==null&&g7(n,r)}catch(a){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),a}finally{n[Ei]&=-5,TC()}}function g7(i,n){for(let e=0;e<n.length;e++)f7(i,n[e])}function nx(i,n,e,a){let d=Ci(null);try{let r=n.tView,P=i[Ei]&4096?4096:16,k=b2(i,r,e,P,null,n,null,null,a?.injector??null,a?.embeddedViewInjector??null,a?.dehydratedView??null),X=i[n.index];k[Ah]=X;let oe=i[vu];return oe!==null&&(k[vu]=oe.createEmbeddedView(r)),O2(r,k,e),k}finally{Ci(d)}}function v_(i,n){return!n||n.firstChild===null||jz(i)}function Gy(i,n,e,a,d=!1){for(;e!==null;){if(e.type===128){e=d?e.projectionNext:e.next;continue}let r=n[e.index];r!==null&&a.push(Ol(r)),Sc(r)&&LB(r,a);let E=e.type;if(E&8)Gy(i,n,e.child,a);else if(E&32){let P=C2(e,n),k;for(;k=P();)a.push(k)}else if(E&16){let P=DB(n,e);if(Array.isArray(P))a.push(...P);else{let k=Mh(n[ua]);Gy(k[ni],k,P,a,!0)}}e=d?e.projectionNext:e.next}return a}function LB(i,n){for(let e=Oo;e<i.length;e++){let a=i[e],d=a[ni].firstChild;d!==null&&Gy(a[ni],a,d,n)}i[Ph]!==i[Ec]&&n.push(i[Ph])}function NB(i){if(i[yf]!==null){for(let n of i[yf])n.impl.addSequence(n);i[yf].length=0}}var zB=[];function _7(i){return i[il]??v7(i)}function v7(i){let n=zB.pop()??Object.create(x7);return n.lView=i,n}function y7(i){i.lView[il]!==i&&(i.lView=null,zB.push(i))}var x7=wi(Ht({},$g),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{d_(i.lView)},consumerOnSignalRead(){this.lView[il]=this}});function b7(i){let n=i[il]??Object.create(w7);return n.lView=i,n}var w7=wi(Ht({},$g),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{let n=Mh(i.lView);for(;n&&!BB(n[ni]);)n=Mh(n);n&&UD(n)},consumerOnSignalRead(){this.lView[il]=this}});function BB(i){return i.type!==2}function VB(i){if(i[ky]===null)return;let n=!0;for(;n;){let e=!1;for(let a of i[ky])a.dirty&&(e=!0,a.zone===null||Zone.current===a.zone?a.run():a.zone.run(()=>a.run()));n=e&&!!(i[Ei]&8192)}}var C7=100;function UB(i,n=0){let a=i[_u].rendererFactory,d=!1;d||a.begin?.();try{E7(i,n)}finally{d||a.end?.()}}function E7(i,n){let e=JD();try{eA(!0),UA(i,n);let a=0;for(;By(i);){if(a===C7)throw new sn(103,!1);a++,UA(i,1)}}finally{eA(e)}}function S7(i,n,e,a){if(wf(n))return;let d=n[Ei],r=!1,E=!1;SC(n);let P=!0,k=null,X=null;r||(BB(i)?(X=_7(n),k=Gg(X)):Mw()===null?(P=!1,X=b7(n),k=Gg(X)):n[il]&&(by(n[il]),n[il]=null));try{VD(n),R3(i.bindingStartIndex),e!==null&&PB(i,n,e,2,a);let oe=(d&3)===3;if(!r)if(oe){let ke=i.preOrderCheckHooks;ke!==null&&NC(n,ke,null)}else{let ke=i.preOrderHooks;ke!==null&&zC(n,ke,0,null),dA(n,0)}if(E||T7(n),VB(n),jB(n,0),i.contentQueries!==null&&Jz(i,n),!r)if(oe){let ke=i.contentCheckHooks;ke!==null&&NC(n,ke)}else{let ke=i.contentHooks;ke!==null&&zC(n,ke,1),dA(n,1)}M7(i,n);let Se=i.components;Se!==null&&HB(n,Se,0);let $e=i.viewQuery;if($e!==null&&MA(2,$e,a),!r)if(oe){let ke=i.viewCheckHooks;ke!==null&&NC(n,ke)}else{let ke=i.viewHooks;ke!==null&&zC(n,ke,2),dA(n,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),n[yC]){for(let ke of n[yC])ke();n[yC]=null}r||(NB(n),n[Ei]&=-73)}catch(oe){throw r||d_(n),oe}finally{X!==null&&(yy(X,k),P&&y7(X)),TC()}}function jB(i,n){for(let e=Hz(i);e!==null;e=Gz(e))for(let a=Oo;a<e.length;a++){let d=e[a];$B(d,n)}}function T7(i){for(let n=Hz(i);n!==null;n=Gz(n)){if(!(n[Ei]&2))continue;let e=n[bf];for(let a=0;a<e.length;a++){let d=e[a];UD(d)}}}function I7(i,n,e){zr(18);let a=Rl(n,i);$B(a,e),zr(19,a[Bo])}function $B(i,n){xC(i)&&UA(i,n)}function UA(i,n){let a=i[ni],d=i[Ei],r=i[il],E=!!(n===0&&d&16);if(E||=!!(d&64&&n===0),E||=!!(d&1024),E||=!!(r?.dirty&&xy(r)),E||=!1,r&&(r.dirty=!1),i[Ei]&=-9217,E)S7(a,i,a.template,i[Bo]);else if(d&8192){let P=Ci(null);try{VB(i),jB(i,1);let k=a.components;k!==null&&HB(i,k,1),NB(i)}finally{Ci(P)}}}function HB(i,n,e){for(let a=0;a<n.length;a++)I7(i,n[a],e)}function M7(i,n){let e=i.hostBindingOpCodes;if(e!==null)try{for(let a=0;a<e.length;a++){let d=e[a];if(d<0)Rh(~d);else{let r=d,E=e[++a],P=e[++a];F3(E,r);let k=n[r];zr(24,k),P(2,k),zr(25,k)}}}finally{Rh(-1)}}function R2(i,n){let e=JD()?64:1088;for(i[_u].changeDetectionScheduler?.notify(n);i;){i[Ei]|=e;let a=Mh(i);if(u_(i)&&!a)return i;i=a}return null}function GB(i,n,e,a){return[i,!0,0,n,null,a,null,e,null,null]}function qB(i,n){let e=Oo+n;if(e<i.length)return i[e]}function ix(i,n,e,a=!0){let d=n[ni];if(D7(d,n,i,e),a){let E=VA(e,i),P=n[co],k=P.parentNode(i[Ph]);k!==null&&H9(d,i[ca],P,n,k,E)}let r=n[gf];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function WB(i,n){let e=qy(i,n);return e!==void 0&&pE(e[ni],e),e}function qy(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e];if(a){let d=a[Ah];d!==null&&d!==i&&I2(d,a),n>0&&(i[e-1][Pl]=a[Pl]);let r=Py(i,Oo+n);$9(a[ni],a);let E=r[vu];E!==null&&E.detachView(r[ni]),a[ls]=null,a[Pl]=null,a[Ei]&=-129}return a}function D7(i,n,e,a){let d=Oo+a,r=e.length;a>0&&(e[d-1][Pl]=n),a<r-Oo?(n[Pl]=e[d],TD(e,Oo+a,n)):(e.push(n),n[Pl]=null),n[ls]=e;let E=n[Ah];E!==null&&e!==E&&ZB(E,n);let P=n[vu];P!==null&&P.insertView(i),bC(n),n[Ei]|=128}function ZB(i,n){let e=i[bf],a=n[ls];if(yu(a))i[Ei]|=2;else{let d=a[ls][ua];n[ua]!==d&&(i[Ei]|=2)}e===null?i[bf]=[n]:e.push(n)}var kh=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let n=this._lView,e=n[ni];return Gy(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e}get context(){return this._lView[Bo]}set context(n){this._lView[Bo]=n}get destroyed(){return wf(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[ls];if(Sc(n)){let e=n[Fy],a=e?e.indexOf(this):-1;a>-1&&(qy(n,a),Py(e,a))}this._attachedToViewContainer=!1}pE(this._lView[ni],this._lView)}onDestroy(n){jD(this._lView,n)}markForCheck(){R2(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ei]&=-129}reattach(){bC(this._lView),this._lView[Ei]|=128}detectChanges(){this._lView[Ei]|=1024,UB(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new sn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=u_(this._lView),e=this._lView[Ah];e!==null&&!n&&I2(e,this._lView),TB(this._lView[ni],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new sn(902,!1);this._appRef=n;let e=u_(this._lView),a=this._lView[Ah];a!==null&&!e&&ZB(a,this._lView),bC(this._lView)}};var rl=(()=>{class i{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=A7;constructor(e,a,d){this._declarationLView=e,this._declarationTContainer=a,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,a){return this.createEmbeddedViewImpl(e,a)}createEmbeddedViewImpl(e,a,d){let r=nx(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:a,dehydratedView:d});return new kh(r)}}return i})();function A7(){return gE(Rs(),vi())}function gE(i,n){return i.type&4?new rl(n,i,x_(i,n)):null}function C_(i,n,e,a,d){let r=i.data[n];if(r===null)r=P7(i,n,e,a,d),k3()&&(r.flags|=32);else if(r.type&64){r.type=e,r.value=a,r.attrs=d;let E=A3();r.injectorIndex=E===null?-1:E.injectorIndex}return h_(r,!0),r}function P7(i,n,e,a,d){let r=XD(),E=KD(),P=E?r:r&&r.parent,k=i.data[n]=R7(i,P,e,n,a,d);return O7(i,k,r,E),k}function O7(i,n,e,a){i.firstChild===null&&(i.firstChild=n),e!==null&&(a?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function R7(i,n,e,a,d,r){let E=n?n.injectorIndex:-1,P=0;return WD()&&(P|=128),{type:e,index:a,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:P,providerIndexes:0,value:d,attrs:r,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var Upe=new RegExp(`^(\\d+)*(${Hq}|${$q})*(.*)`);function k7(i){let n=i[LD]??[],a=i[ls][co],d=[];for(let r of n)r.data[Yz]!==void 0?d.push(r):F7(r,a);i[LD]=d}function F7(i,n){let e=0,a=i.firstChild;if(a){let d=i.data[Zz];for(;e<d;){let r=a.nextSibling;cB(n,a,!1),a=r,e++}}}var L7=()=>null,N7=()=>null;function KC(i,n){return L7(i,n)}function YB(i,n,e){return N7(i,n,e)}var XB=class{},_E=class{},jA=class{resolveComponentFactory(n){throw new sn(917,!1)}},rx=class{static NULL=new jA},xs=class{},Pa=(()=>{class i{destroyNode=null;static __NG_ELEMENT_ID__=()=>z7()}return i})();function z7(){let i=vi(),n=Rs(),e=Rl(n.index,i);return(yu(e)?e:i)[co]}var KB=(()=>{class i{static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>null})}return i})();var VC={},$A=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,a){let d=this.injector.get(n,VC,a);return d!==VC||e===VC?d:this.parentInjector.get(n,e,a)}};function QC(i,n,e){let a=e?i.styles:null,d=e?i.classes:null,r=0;if(n!==null)for(let E=0;E<n.length;E++){let P=n[E];if(typeof P=="number")r=P;else if(r==1)d=pC(d,P);else if(r==2){let k=P,X=n[++E];a=pC(a,k+": "+X+";")}}e?i.styles=a:i.stylesWithoutHost=a,e?i.classes=d:i.classesWithoutHost=d}function Ft(i,n=0){let e=vi();if(e===null)return dn(i,n);let a=Rs();return Bz(a,e,Os(i),n)}function k2(){let i="invalid";throw new Error(i)}function QB(i,n,e,a,d){let r=a===null?null:{"":-1},E=d(i,e);if(E!==null){let P=E,k=null,X=null;for(let oe of E)if(oe.resolveHostDirectives!==null){[P,k,X]=oe.resolveHostDirectives(E);break}U7(i,n,e,P,r,k,X)}r!==null&&a!==null&&B7(e,a,r)}function B7(i,n,e){let a=i.localNames=[];for(let d=0;d<n.length;d+=2){let r=e[n[d+1]];if(r==null)throw new sn(-301,!1);a.push(n[d],r)}}function V7(i,n,e){n.componentOffset=e,(i.components??=[]).push(n.index)}function U7(i,n,e,a,d,r,E){let P=a.length,k=!1;for(let $e=0;$e<P;$e++){let ke=a[$e];!k&&xu(ke)&&(k=!0,V7(i,e,$e)),EA(GC(e,n),i,ke.type)}W7(e,i.data.length,P);for(let $e=0;$e<P;$e++){let ke=a[$e];ke.providersResolver&&ke.providersResolver(ke)}let X=!1,oe=!1,Se=_B(i,n,P,null);P>0&&(e.directiveToIndex=new Map);for(let $e=0;$e<P;$e++){let ke=a[$e];if(e.mergedAttrs=g_(e.mergedAttrs,ke.hostAttrs),$7(i,e,n,Se,ke),q7(Se,ke,d),E!==null&&E.has(ke)){let[Nt,Mt]=E.get(ke);e.directiveToIndex.set(ke.type,[Se,Nt+e.directiveStart,Mt+e.directiveStart])}else(r===null||!r.has(ke))&&e.directiveToIndex.set(ke.type,Se);ke.contentQueries!==null&&(e.flags|=4),(ke.hostBindings!==null||ke.hostAttrs!==null||ke.hostVars!==0)&&(e.flags|=64);let ht=ke.type.prototype;!X&&(ht.ngOnChanges||ht.ngOnInit||ht.ngDoCheck)&&((i.preOrderHooks??=[]).push(e.index),X=!0),!oe&&(ht.ngOnChanges||ht.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(e.index),oe=!0),Se++}j7(i,e,r)}function j7(i,n,e){for(let a=n.directiveStart;a<n.directiveEnd;a++){let d=i.data[a];if(e===null||!e.has(d))hz(0,n,d,a),hz(1,n,d,a),fz(n,a,!1);else{let r=e.get(d);pz(0,n,r,a),pz(1,n,r,a),fz(n,a,!0)}}}function hz(i,n,e,a){let d=i===0?e.inputs:e.outputs;for(let r in d)if(d.hasOwnProperty(r)){let E;i===0?E=n.inputs??={}:E=n.outputs??={},E[r]??=[],E[r].push(a),JB(n,r)}}function pz(i,n,e,a){let d=i===0?e.inputs:e.outputs;for(let r in d)if(d.hasOwnProperty(r)){let E=d[r],P;i===0?P=n.hostDirectiveInputs??={}:P=n.hostDirectiveOutputs??={},P[E]??=[],P[E].push(a,r),JB(n,E)}}function JB(i,n){n==="class"?i.flags|=8:n==="style"&&(i.flags|=16)}function fz(i,n,e){let{attrs:a,inputs:d,hostDirectiveInputs:r}=i;if(a===null||!e&&d===null||e&&r===null||y2(i)){i.initialInputs??=[],i.initialInputs.push(null);return}let E=null,P=0;for(;P<a.length;){let k=a[P];if(k===0){P+=4;continue}else if(k===5){P+=2;continue}else if(typeof k=="number")break;if(!e&&d.hasOwnProperty(k)){let X=d[k];for(let oe of X)if(oe===n){E??=[],E.push(k,a[P+1]);break}}else if(e&&r.hasOwnProperty(k)){let X=r[k];for(let oe=0;oe<X.length;oe+=2)if(X[oe]===n){E??=[],E.push(X[oe+1],a[P+1]);break}}P+=2}i.initialInputs??=[],i.initialInputs.push(E)}function $7(i,n,e,a,d){i.data[a]=d;let r=d.factory||(d.factory=Ih(d.type,!0)),E=new Sf(r,xu(d),Ft,null);i.blueprint[a]=E,e[a]=E,H7(i,n,a,_B(i,e,d.hostVars,ha),d)}function H7(i,n,e,a,d){let r=d.hostBindings;if(r){let E=i.hostBindingOpCodes;E===null&&(E=i.hostBindingOpCodes=[]);let P=~n.index;G7(E)!=P&&E.push(P),E.push(e,a,r)}}function G7(i){let n=i.length;for(;n>0;){let e=i[--n];if(typeof e=="number"&&e<0)return e}return 0}function q7(i,n,e){if(e){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)e[n.exportAs[a]]=i;xu(n)&&(e[""]=i)}}function W7(i,n,e){i.flags|=1,i.directiveStart=n,i.directiveEnd=n+e,i.providerIndexes=n}function eV(i,n,e,a,d,r,E,P){let k=n[ni],X=k.consts,oe=kl(X,E),Se=C_(k,i,e,a,oe);return r&&QB(k,n,Se,kl(X,P),d),Se.mergedAttrs=g_(Se.mergedAttrs,Se.attrs),Se.attrs!==null&&QC(Se,Se.attrs,!1),Se.mergedAttrs!==null&&QC(Se,Se.mergedAttrs,!0),k.queries!==null&&k.queries.elementStart(k,Se),Se}function tV(i,n){Az(i,n),ND(n)&&i.queries.elementEnd(n)}function Z7(i,n,e,a,d,r){let E=n.consts,P=kl(E,d),k=C_(n,i,e,a,P);if(k.mergedAttrs=g_(k.mergedAttrs,k.attrs),r!=null){let X=kl(E,r);k.localNames=[];for(let oe=0;oe<X.length;oe+=2)k.localNames.push(X[oe],-1)}return k.attrs!==null&&QC(k,k.attrs,!1),k.mergedAttrs!==null&&QC(k,k.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,k),k}function F2(i){return vE(i)?Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i:!1}function nV(i,n){if(Array.isArray(i))for(let e=0;e<i.length;e++)n(i[e]);else{let e=i[Symbol.iterator](),a;for(;!(a=e.next()).done;)n(a.value)}}function vE(i){return i!==null&&(typeof i=="function"||typeof i=="object")}function yE(i,n,e){return i[n]=e}function Y7(i,n){return i[n]}function Ll(i,n,e){if(e===ha)return!1;let a=i[n];return Object.is(a,e)?!1:(i[n]=e,!0)}function L2(i,n,e,a){let d=Ll(i,n,e);return Ll(i,n+1,a)||d}function X7(i,n,e,a,d){let r=L2(i,n,e,a);return Ll(i,n+2,d)||r}function fA(i,n,e){return function a(d){let r=Oh(i)?Rl(i.index,n):n;R2(r,5);let E=n[Bo],P=mz(n,E,e,d),k=a.__ngNextListenerFn__;for(;k;)P=mz(n,E,k,d)&&P,k=k.__ngNextListenerFn__;return P}}function mz(i,n,e,a){let d=Ci(null);try{return zr(6,n,e),e(a)!==!1}catch(r){return p7(i,r),!1}finally{zr(7,n,e),Ci(d)}}function K7(i,n,e,a,d,r,E,P){let k=Ly(i),X=!1,oe=null;if(!a&&k&&(oe=J7(n,e,r,i.index)),oe!==null){let Se=oe.__ngLastListenerFn__||oe;Se.__ngNextListenerFn__=E,oe.__ngLastListenerFn__=E,X=!0}else{let Se=Tc(i,e),$e=a?a(Se):Se;qq(e,$e,r,P);let ke=d.listen($e,r,P);if(!Q7(r)){let ht=a?Nt=>a(Ol(Nt[i.index])):i.index;iV(ht,n,e,r,P,ke,!1)}}return X}function Q7(i){return i.startsWith("animation")||i.startsWith("transition")}function J7(i,n,e,a){let d=i.cleanup;if(d!=null)for(let r=0;r<d.length-1;r+=2){let E=d[r];if(E===e&&d[r+1]===a){let P=n[l_],k=d[r+2];return P&&P.length>k?P[k]:null}typeof E=="string"&&(r+=2)}return null}function iV(i,n,e,a,d,r,E){let P=n.firstCreatePass?HD(n):null,k=$D(e),X=k.length;k.push(d,r),P&&P.push(a,i,X,(X+1)*(E?-1:1))}function gz(i,n,e,a,d,r){let E=n[e],P=n[ni],X=P.data[e].outputs[a],Se=E[X].subscribe(r);iV(i.index,P,n,d,r,Se,!0)}var HA=Symbol("BINDING");var JC=class extends rx{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=gu(n);return new Fh(e,this.ngModule)}};function eW(i){return Object.keys(i).map(n=>{let[e,a,d]=i[n],r={propName:e,templateName:n,isSignal:(a&dE.SignalBased)!==0};return d&&(r.transform=d),r})}function tW(i){return Object.keys(i).map(n=>({propName:i[n],templateName:n}))}function nW(i,n,e){let a=n instanceof Yr?n:n?.injector;return a&&i.getStandaloneInjector!==null&&(a=i.getStandaloneInjector(a)||a),a?new $A(e,a):e}function iW(i){let n=i.get(xs,null);if(n===null)throw new sn(407,!1);let e=i.get(KB,null),a=i.get(Td,null);return{rendererFactory:n,sanitizer:e,changeDetectionScheduler:a,ngReflect:!1}}function rW(i,n){let e=rV(i);return aB(n,e,e==="svg"?b3:e==="math"?w3:null)}function rV(i){return(i.selectors[0][0]||"div").toLowerCase()}var Fh=class extends _E{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=eW(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=tW(this.componentDef.outputs),this.cachedOutputs}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=I9(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,a,d,r,E){zr(22);let P=Ci(null);try{let k=this.componentDef,X=oW(a,k,E,r),oe=nW(k,d||this.ngModule,n),Se=iW(oe),$e=Se.rendererFactory.createRenderer(null,k),ke=a?t7($e,a,k.encapsulation,oe):rW(k,$e),ht=E?.some(_z)||r?.some(Xt=>typeof Xt!="function"&&Xt.bindings.some(_z)),Nt=b2(null,X,null,512|gB(k),null,null,Se,$e,oe,null,Qz(ke,oe,!0));Nt[uo]=ke,SC(Nt);let Mt=null;try{let Xt=eV(uo,Nt,2,"#host",()=>X.directiveRegistry,!0,0);uB($e,ke,Xt),__(ke,Nt),A2(X,Nt,Xt),eB(X,Xt,Nt),tV(X,Xt),e!==void 0&&aW(Xt,this.ngContentSelectors,e),Mt=Rl(Xt.index,Nt),Nt[Bo]=Mt[Bo],O2(X,Nt,null)}catch(Xt){throw Mt!==null&&TA(Mt),TA(Nt),Xt}finally{zr(23),TC()}return new eE(this.componentType,Nt,!!ht)}finally{Ci(P)}}};function oW(i,n,e,a){let d=i?["ng-version","20.3.15"]:M9(n.selectors[0]),r=null,E=null,P=0;if(e)for(let oe of e)P+=oe[HA].requiredVars,oe.create&&(oe.targetIdx=0,(r??=[]).push(oe)),oe.update&&(oe.targetIdx=0,(E??=[]).push(oe));if(a)for(let oe=0;oe<a.length;oe++){let Se=a[oe];if(typeof Se!="function")for(let $e of Se.bindings){P+=$e[HA].requiredVars;let ke=oe+1;$e.create&&($e.targetIdx=ke,(r??=[]).push($e)),$e.update&&($e.targetIdx=ke,(E??=[]).push($e))}}let k=[n];if(a)for(let oe of a){let Se=typeof oe=="function"?oe:oe.type,$e=AD(Se);k.push($e)}return x2(0,null,sW(r,E),1,P,k,null,null,null,[d],null)}function sW(i,n){return!i&&!n?null:e=>{if(e&1&&i)for(let a of i)a.create();if(e&2&&n)for(let a of n)a.update()}}function _z(i){let n=i[HA].kind;return n==="input"||n==="twoWay"}var eE=class extends XB{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e,a){super(),this._rootLView=e,this._hasInputBindings=a,this._tNode=Ny(e[ni],uo),this.location=x_(this._tNode,e),this.instance=Rl(this._tNode.index,e)[Bo],this.hostView=this.changeDetectorRef=new kh(e,void 0),this.componentType=n}setInput(n,e){this._hasInputBindings;let a=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let d=this._rootLView,r=P2(a,d[ni],d,n,e);this.previousInputValues.set(n,e);let E=Rl(a.index,d);R2(E,1)}get injector(){return new Ef(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function aW(i,n,e){let a=i.projection=[];for(let d=0;d<n.length;d++){let r=e[d];a.push(r!=null&&r.length?Array.from(r):null)}}var ol=(()=>{class i{static __NG_ELEMENT_ID__=lW}return i})();function lW(){let i=Rs();return sV(i,vi())}var cW=ol,oV=class extends cW{_lContainer;_hostTNode;_hostLView;constructor(n,e,a){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=a}get element(){return x_(this._hostTNode,this._hostLView)}get injector(){return new Ef(this._hostTNode,this._hostLView)}get parentInjector(){let n=l2(this._hostTNode,this._hostLView);if(Rz(n)){let e=$C(n,this._hostLView),a=jC(n),d=e[ni].data[a+8];return new Ef(d,e)}else return new Ef(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=vz(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-Oo}createEmbeddedView(n,e,a){let d,r;typeof a=="number"?d=a:a!=null&&(d=a.index,r=a.injector);let E=KC(this._lContainer,n.ssrId),P=n.createEmbeddedViewImpl(e||{},r,E);return this.insertImpl(P,d,v_(this._hostTNode,E)),P}createComponent(n,e,a,d,r,E,P){let k=n&&!_q(n),X;if(k)X=e;else{let Mt=e||{};X=Mt.index,a=Mt.injector,d=Mt.projectableNodes,r=Mt.environmentInjector||Mt.ngModuleRef,E=Mt.directives,P=Mt.bindings}let oe=k?n:new Fh(gu(n)),Se=a||this.parentInjector;if(!r&&oe.ngModule==null){let Xt=(k?Se:this.parentInjector).get(Yr,null);Xt&&(r=Xt)}let $e=gu(oe.componentType??{}),ke=KC(this._lContainer,$e?.id??null),ht=ke?.firstChild??null,Nt=oe.create(Se,d,ht,r,E,P);return this.insertImpl(Nt.hostView,X,v_(this._hostTNode,ke)),Nt}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,a){let d=n._lView;if(E3(d)){let P=this.indexOf(n);if(P!==-1)this.detach(P);else{let k=d[ls],X=new oV(k,k[ca],k[ls]);X.detach(X.indexOf(n))}}let r=this._adjustIndex(e),E=this._lContainer;return ix(E,d,r,a),n.attachToViewContainerRef(),TD(mA(E),r,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=vz(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),a=qy(this._lContainer,e);a&&(Py(mA(this._lContainer),e),pE(a[ni],a))}detach(n){let e=this._adjustIndex(n,-1),a=qy(this._lContainer,e);return a&&Py(mA(this._lContainer),e)!=null?new kh(a):null}_adjustIndex(n,e=0){return n??this.length+e}};function vz(i){return i[Fy]}function mA(i){return i[Fy]||(i[Fy]=[])}function sV(i,n){let e,a=n[i.index];return Sc(a)?e=a:(e=GB(a,n,null,i),n[i.index]=e,w2(n,e)),dW(e,n,i,a),new oV(e,i,n)}function uW(i,n){let e=i[co],a=e.createComment(""),d=Tc(n,i),r=e.parentNode(d);return WC(e,r,a,e.nextSibling(d),!1),a}var dW=fW,hW=()=>!1;function pW(i,n,e){return hW(i,n,e)}function fW(i,n,e,a){if(i[Ph])return;let d;e.type&8?d=Ol(a):d=uW(n,e),i[Ph]=d}var GA=class i{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new i(this.queryList)}setDirty(){this.queryList.setDirty()}},qA=class i{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let e=n.queries;if(e!==null){let a=n.contentQueries!==null?n.contentQueries[0]:e.length,d=[];for(let r=0;r<a;r++){let E=e.getByIndex(r),P=this.queries[E.indexInDeclarationView];d.push(P.clone())}return new i(d)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)N2(n,e).matches!==null&&this.queries[e].setDirty()}},WA=class{flags;read;predicate;constructor(n,e,a=null){this.flags=e,this.read=a,typeof n=="string"?this.predicate=wW(n):this.predicate=n}},ZA=class i{queries;constructor(n=[]){this.queries=n}elementStart(n,e){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let a=0;a<this.length;a++){let d=e!==null?e.length:0,r=this.getByIndex(a).embeddedTView(n,d);r&&(r.indexInDeclarationView=a,e!==null?e.push(r):e=[r])}return e!==null?new i(e):null}template(n,e){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},YA=class i{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,e=-1){this.metadata=n,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new i(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,a=n.parent;for(;a!==null&&a.type&8&&a.index!==e;)a=a.parent;return e===(a!==null?a.index:-1)}return this._appliesToNextNode}matchTNode(n,e){let a=this.metadata.predicate;if(Array.isArray(a))for(let d=0;d<a.length;d++){let r=a[d];this.matchTNodeWithReadOption(n,e,mW(e,r)),this.matchTNodeWithReadOption(n,e,BC(e,n,r,!1,!1))}else a===rl?e.type&4&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,BC(e,n,a,!1,!1))}matchTNodeWithReadOption(n,e,a){if(a!==null){let d=this.metadata.read;if(d!==null)if(d===pr||d===ol||d===rl&&e.type&4)this.addMatch(e.index,-2);else{let r=BC(e,n,d,!1,!1);r!==null&&this.addMatch(e.index,r)}else this.addMatch(e.index,a)}}addMatch(n,e){this.matches===null?this.matches=[n,e]:this.matches.push(n,e)}};function mW(i,n){let e=i.localNames;if(e!==null){for(let a=0;a<e.length;a+=2)if(e[a]===n)return e[a+1]}return null}function gW(i,n){return i.type&11?x_(i,n):i.type&4?gE(i,n):null}function _W(i,n,e,a){return e===-1?gW(n,i):e===-2?vW(i,n,a):Hy(i,i[ni],e,n)}function vW(i,n,e){if(e===pr)return x_(n,i);if(e===rl)return gE(n,i);if(e===ol)return sV(n,i)}function aV(i,n,e,a){let d=n[vu].queries[a];if(d.matches===null){let r=i.data,E=e.matches,P=[];for(let k=0;E!==null&&k<E.length;k+=2){let X=E[k];if(X<0)P.push(null);else{let oe=r[X];P.push(_W(n,oe,E[k+1],e.metadata.read))}}d.matches=P}return d.matches}function XA(i,n,e,a){let d=i.queries.getByIndex(e),r=d.matches;if(r!==null){let E=aV(i,n,d,e);for(let P=0;P<r.length;P+=2){let k=r[P];if(k>0)a.push(E[P/2]);else{let X=r[P+1],oe=n[-k];for(let Se=Oo;Se<oe.length;Se++){let $e=oe[Se];$e[Ah]===$e[ls]&&XA($e[ni],$e,X,a)}if(oe[bf]!==null){let Se=oe[bf];for(let $e=0;$e<Se.length;$e++){let ke=Se[$e];XA(ke[ni],ke,X,a)}}}}}return a}function yW(i,n){return i[vu].queries[n].queryList}function xW(i,n,e){let a=new qC((e&4)===4);return I3(i,n,a,a.destroy),(n[vu]??=new qA).queries.push(new GA(a))-1}function bW(i,n,e){let a=Vo();return a.firstCreatePass&&(CW(a,new WA(i,n,e),-1),(n&2)===2&&(a.staticViewQueries=!0)),xW(a,vi(),n)}function wW(i){return i.split(",").map(n=>n.trim())}function CW(i,n,e){i.queries===null&&(i.queries=new ZA),i.queries.track(new YA(n,e))}function N2(i,n){return i.queries.getByIndex(n)}function EW(i,n){let e=i[ni],a=N2(e,n);return a.crossesNgTemplate?XA(e,i,n,[]):aV(e,i,a,n)}var Su=class{},xE=class{};var tE=class extends Su{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new JC(this);constructor(n,e,a,d=!0){super(),this.ngModuleType=n,this._parent=e;let r=DD(n);this._bootstrapComponents=pB(r.bootstrap),this._r3Injector=rA(n,e,[{provide:Su,useValue:this},{provide:rx,useValue:this.componentFactoryResolver},...a],Sd(n),new Set(["environment"])),d&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},nE=class extends xE{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new tE(this.moduleType,n,[])}};var Wy=class extends Su{injector;componentFactoryResolver=new JC(this);instance=null;constructor(n){super();let e=new pf([...n.providers,{provide:Su,useValue:this},{provide:rx,useValue:this.componentFactoryResolver}],n.parent||a_(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function E_(i,n,e=null){return new Wy({providers:i,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var SW=(()=>{class i{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let a=PD(!1,e.type),d=a.length>0?E_([a],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,d)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Rt({token:i,providedIn:"environment",factory:()=>new i(dn(Yr))})}return i})();function Sn(i){return Xy(()=>{let n=lV(i),e=wi(Ht({},n),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===c2.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&i.dependencies||null,getStandaloneInjector:n.standalone?d=>d.get(SW).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||Dd.Emulated,styles:i.styles||la,_:null,schemas:i.schemas||null,tView:null,id:""});n.standalone&&Dc("NgStandalone"),cV(e);let a=i.dependencies;return e.directiveDefs=yz(a,TW),e.pipeDefs=yz(a,p3),e.id=DW(e),e})}function TW(i){return gu(i)||AD(i)}function Sr(i){return Xy(()=>({type:i.type,bootstrap:i.bootstrap||la,declarations:i.declarations||la,imports:i.imports||la,exports:i.exports||la,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function IW(i,n){if(i==null)return Dh;let e={};for(let a in i)if(i.hasOwnProperty(a)){let d=i[a],r,E,P,k;Array.isArray(d)?(P=d[0],r=d[1],E=d[2]??r,k=d[3]||null):(r=d,E=d,P=dE.None,k=null),e[r]=[a,P,k],n[r]=E}return e}function MW(i){if(i==null)return Dh;let n={};for(let e in i)i.hasOwnProperty(e)&&(n[i[e]]=e);return n}function Tr(i){return Xy(()=>{let n=lV(i);return cV(n),n})}function S_(i){return{type:i.type,name:i.name,factory:null,pure:i.pure!==!1,standalone:i.standalone??!0,onDestroy:i.type.prototype.ngOnDestroy||null}}function lV(i){let n={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:n,inputConfig:i.inputs||Dh,exportAs:i.exportAs||null,standalone:i.standalone??!0,signals:i.signals===!0,selectors:i.selectors||la,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:IW(i.inputs,n),outputs:MW(i.outputs),debugInfo:null}}function cV(i){i.features?.forEach(n=>n(i))}function yz(i,n){return i?()=>{let e=typeof i=="function"?i():i,a=[];for(let d of e){let r=n(d);r!==null&&a.push(r)}return a}:null}function DW(i){let n=0,e=typeof i.consts=="function"?"":i.consts,a=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,e,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery];for(let r of a.join("|"))n=Math.imul(31,n)+r.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function AW(i){return Object.getPrototypeOf(i.prototype).constructor}function Fs(i){let n=AW(i.type),e=!0,a=[i];for(;n;){let d;if(xu(i))d=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new sn(903,!1);d=n.\u0275dir}if(d){if(e){a.push(d);let E=i;E.inputs=gA(i.inputs),E.declaredInputs=gA(i.declaredInputs),E.outputs=gA(i.outputs);let P=d.hostBindings;P&&FW(i,P);let k=d.viewQuery,X=d.contentQueries;if(k&&RW(i,k),X&&kW(i,X),PW(i,d),r3(i.outputs,d.outputs),xu(d)&&d.data.animation){let oe=i.data;oe.animation=(oe.animation||[]).concat(d.data.animation)}}let r=d.features;if(r)for(let E=0;E<r.length;E++){let P=r[E];P&&P.ngInherit&&P(i),P===Fs&&(e=!1)}}n=Object.getPrototypeOf(n)}OW(a)}function PW(i,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||i.inputs.hasOwnProperty(e))continue;let a=n.inputs[e];a!==void 0&&(i.inputs[e]=a,i.declaredInputs[e]=n.declaredInputs[e])}}function OW(i){let n=0,e=null;for(let a=i.length-1;a>=0;a--){let d=i[a];d.hostVars=n+=d.hostVars,d.hostAttrs=g_(d.hostAttrs,e=g_(e,d.hostAttrs))}}function gA(i){return i===Dh?{}:i===la?[]:i}function RW(i,n){let e=i.viewQuery;e?i.viewQuery=(a,d)=>{n(a,d),e(a,d)}:i.viewQuery=n}function kW(i,n){let e=i.contentQueries;e?i.contentQueries=(a,d,r)=>{n(a,d,r),e(a,d,r)}:i.contentQueries=n}function FW(i,n){let e=i.hostBindings;e?i.hostBindings=(a,d)=>{n(a,d),e(a,d)}:i.hostBindings=n}function uV(i,n,e,a,d,r,E,P){if(e.firstCreatePass){i.mergedAttrs=g_(i.mergedAttrs,i.attrs);let oe=i.tView=x2(2,i,d,r,E,e.directiveRegistry,e.pipeRegistry,null,e.schemas,e.consts,null);e.queries!==null&&(e.queries.template(e,i),oe.queries=e.queries.embeddedTView(i))}P&&(i.flags|=P),h_(i,!1);let k=NW(e,n,i,a);MC()&&M2(e,n,k,i),__(k,n);let X=GB(k,n,k,i);n[a+uo]=X,w2(n,X),pW(X,i,n)}function LW(i,n,e,a,d,r,E,P,k,X,oe){let Se=e+uo,$e;return n.firstCreatePass?($e=C_(n,Se,4,E||null,P||null),qD()&&QB(n,i,$e,kl(n.consts,X),RB),Az(n,$e)):$e=n.data[Se],uV($e,i,n,e,a,d,r,k),Ly($e)&&A2(n,i,$e),X!=null&&mE(i,$e,oe),$e}function Zy(i,n,e,a,d,r,E,P,k,X,oe){let Se=e+uo,$e;if(n.firstCreatePass){if($e=C_(n,Se,4,E||null,P||null),X!=null){let ke=kl(n.consts,X);$e.localNames=[];for(let ht=0;ht<ke.length;ht+=2)$e.localNames.push(ke[ht],-1)}}else $e=n.data[Se];return uV($e,i,n,e,a,d,r,k),X!=null&&mE(i,$e,oe),$e}function ji(i,n,e,a,d,r,E,P){let k=vi(),X=Vo(),oe=kl(X.consts,r);return LW(k,X,i,n,e,a,d,oe,void 0,E,P),ji}var NW=zW;function zW(i,n,e,a){return DC(!0),n[co].createComment("")}var bE=(()=>{class i{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();var z2=new Kt("");function Rd(i){return!!i&&typeof i.then=="function"}function wE(i){return!!i&&typeof i.subscribe=="function"}var B2=new Kt("");function CE(i){return Cc([{provide:B2,multi:!0,useValue:i}])}var V2=(()=>{class i{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,a)=>{this.resolve=e,this.reject=a});appInits=Ve(B2,{optional:!0})??[];injector=Ve(hr);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let d of this.appInits){let r=ys(this.injector,d);if(Rd(r))e.push(r);else if(wE(r)){let E=new Promise((P,k)=>{r.subscribe({complete:P,error:k})});e.push(E)}}let a=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{a()}).catch(d=>{this.reject(d)}),e.length===0&&a(),this.initialized=!0}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ox=new Kt("");function dV(){$M(()=>{let i="";throw new sn(600,i)})}function hV(i){return i.isBoundToModule}var BW=10;var Oa=(()=>{class i{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Ve(Gs);afterRenderManager=Ve(T2);zonelessEnabled=Ve(p_);rootEffectScheduler=Ve(uA);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new li;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=Ve(wu);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Qn(e=>!e))}constructor(){Ve(Df,{optional:!0})}whenStable(){let e;return new Promise(a=>{e=this.isStable.subscribe({next:d=>{d&&a()}})}).finally(()=>{e.unsubscribe()})}_injector=Ve(Yr);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,a){return this.bootstrapImpl(e,a)}bootstrapImpl(e,a,d=hr.NULL){return this._injector.get(yi).run(()=>{zr(10);let E=e instanceof _E;if(!this._injector.get(V2).done){let ht="";throw new sn(405,ht)}let k;E?k=e:k=this._injector.get(rx).resolveComponentFactory(e),this.componentTypes.push(k.componentType);let X=hV(k)?void 0:this._injector.get(Su),oe=a||k.selector,Se=k.create(d,[],oe,X),$e=Se.location.nativeElement,ke=Se.injector.get(z2,null);return ke?.registerApplication($e),Se.onDestroy(()=>{this.detachView(Se.hostView),$y(this.components,Se),ke?.unregisterApplication($e)}),this._loadComponent(Se),zr(11,Se),Se})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){zr(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(hE.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new sn(101,!1);let e=Ci(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Ci(e),this.afterTick.next(),zr(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(xs,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<BW;)zr(14),this.synchronizeOnce(),zr(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let e=!1;if(this.dirtyFlags&7){let a=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:d}of this.allViews){if(!a&&!By(d))continue;let r=a&&!this.zonelessEnabled?0:1;UB(d,r),e=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}e||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>By(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let a=e;this._views.push(a),a.attachToAppRef(this)}detachView(e){let a=e;$y(this._views,a),a.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView);try{this.tick()}catch(d){this.internalErrorHandler(d)}this.components.push(e),this._injector.get(ox,[]).forEach(d=>d(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>$y(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new sn(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function $y(i,n){let e=i.indexOf(n);e>-1&&i.splice(e,1)}function Jo(i,n,e,a){let d=vi(),r=Cf();if(Ll(d,r,n)){let E=Vo(),P=IC();u7(P,d,i,n,e,a)}return Jo}var Zpe=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var KA=class{destroy(n){}updateValue(n,e){}swap(n,e){let a=Math.min(n,e),d=Math.max(n,e),r=this.detach(d);if(d-a>1){let E=this.detach(a);this.attach(a,r),this.attach(d,E)}else this.attach(a,r)}move(n,e){this.attach(e,this.detach(n))}};function _A(i,n,e,a,d){return i===e&&Object.is(n,a)?1:Object.is(d(i,n),d(e,a))?-1:0}function VW(i,n,e){let a,d,r=0,E=i.length-1,P=void 0;if(Array.isArray(n)){let k=n.length-1;for(;r<=E&&r<=k;){let X=i.at(r),oe=n[r],Se=_A(r,X,r,oe,e);if(Se!==0){Se<0&&i.updateValue(r,oe),r++;continue}let $e=i.at(E),ke=n[k],ht=_A(E,$e,k,ke,e);if(ht!==0){ht<0&&i.updateValue(E,ke),E--,k--;continue}let Nt=e(r,X),Mt=e(E,$e),Xt=e(r,oe);if(Object.is(Xt,Mt)){let Vn=e(k,ke);Object.is(Vn,Nt)?(i.swap(r,E),i.updateValue(E,ke),k--,E--):i.move(E,r),i.updateValue(r,oe),r++;continue}if(a??=new iE,d??=bz(i,r,E,e),QA(i,a,r,Xt))i.updateValue(r,oe),r++,E++;else if(d.has(Xt))a.set(Nt,i.detach(r)),E--;else{let Vn=i.create(r,n[r]);i.attach(r,Vn),r++,E++}}for(;r<=k;)xz(i,a,e,r,n[r]),r++}else if(n!=null){let k=n[Symbol.iterator](),X=k.next();for(;!X.done&&r<=E;){let oe=i.at(r),Se=X.value,$e=_A(r,oe,r,Se,e);if($e!==0)$e<0&&i.updateValue(r,Se),r++,X=k.next();else{a??=new iE,d??=bz(i,r,E,e);let ke=e(r,Se);if(QA(i,a,r,ke))i.updateValue(r,Se),r++,E++,X=k.next();else if(!d.has(ke))i.attach(r,i.create(r,Se)),r++,E++,X=k.next();else{let ht=e(r,oe);a.set(ht,i.detach(r)),E--}}}for(;!X.done;)xz(i,a,e,i.length,X.value),X=k.next()}for(;r<=E;)i.destroy(i.detach(E--));a?.forEach(k=>{i.destroy(k)})}function QA(i,n,e,a){return n!==void 0&&n.has(a)?(i.attach(e,n.get(a)),n.delete(a),!0):!1}function xz(i,n,e,a,d){if(QA(i,n,a,e(a,d)))i.updateValue(a,d);else{let r=i.create(a,d);i.attach(a,r)}}function bz(i,n,e,a){let d=new Set;for(let r=n;r<=e;r++)d.add(a(r,i.at(r)));return d}var iE=class{kvMap=new Map;_vMap=void 0;has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;let e=this.kvMap.get(n);return this._vMap!==void 0&&this._vMap.has(e)?(this.kvMap.set(n,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,e){if(this.kvMap.has(n)){let a=this.kvMap.get(n);this._vMap===void 0&&(this._vMap=new Map);let d=this._vMap;for(;d.has(a);)a=d.get(a);d.set(a,e)}else this.kvMap.set(n,e)}forEach(n){for(let[e,a]of this.kvMap)if(n(a,e),this._vMap!==void 0){let d=this._vMap;for(;d.has(a);)a=d.get(a),n(a,e)}}};function Je(i,n,e,a,d,r,E,P){Dc("NgControlFlow");let k=vi(),X=Vo(),oe=kl(X.consts,r);return Zy(k,X,i,n,e,a,d,oe,256,E,P),sx}function sx(i,n,e,a,d,r,E,P){Dc("NgControlFlow");let k=vi(),X=Vo(),oe=kl(X.consts,r);return Zy(k,X,i,n,e,a,d,oe,512,E,P),sx}function et(i,n){Dc("NgControlFlow");let e=vi(),a=Cf(),d=e[a]!==ha?e[a]:-1,r=d!==-1?rE(e,uo+d):void 0,E=0;if(Ll(e,a,i)){let P=Ci(null);try{if(r!==void 0&&WB(r,E),i!==-1){let k=uo+i,X=rE(e,k),oe=n2(e[ni],k),Se=YB(X,oe,e),$e=nx(e,oe,n,{dehydratedView:Se});ix(X,$e,E,v_(oe,Se))}}finally{Ci(P)}}else if(r!==void 0){let P=qB(r,E);P!==void 0&&(P[Bo]=n)}}var JA=class{lContainer;$implicit;$index;constructor(n,e,a){this.lContainer=n,this.$implicit=e,this.$index=a}get $count(){return this.lContainer.length-Oo}};function Ra(i){return i}var e2=class{hasEmptyBlock;trackByFn;liveCollection;constructor(n,e,a){this.hasEmptyBlock=n,this.trackByFn=e,this.liveCollection=a}};function qi(i,n,e,a,d,r,E,P,k,X,oe,Se,$e){Dc("NgControlFlow");let ke=vi(),ht=Vo(),Nt=k!==void 0,Mt=vi(),Xt=P?E.bind(Mt[ua][Bo]):E,Vn=new e2(Nt,Xt);Mt[uo+i]=Vn,Zy(ke,ht,i+1,n,e,a,d,kl(ht.consts,r),256),Nt&&Zy(ke,ht,i+2,k,X,oe,Se,kl(ht.consts,$e),512)}var t2=class extends KA{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(n,e,a){super(),this.lContainer=n,this.hostLView=e,this.templateTNode=a}get length(){return this.lContainer.length-Oo}at(n){return this.getLView(n)[Bo].$implicit}attach(n,e){let a=e[gf];this.needsIndexUpdate||=n!==this.length,ix(this.lContainer,e,n,v_(this.templateTNode,a)),UW(this.lContainer,n)}detach(n){return this.needsIndexUpdate||=n!==this.length-1,jW(this.lContainer,n),$W(this.lContainer,n)}create(n,e){let a=KC(this.lContainer,this.templateTNode.tView.ssrId),d=nx(this.hostLView,this.templateTNode,new JA(this.lContainer,e,n),{dehydratedView:a});return this.operationsCounter?.recordCreate(),d}destroy(n){pE(n[ni],n),this.operationsCounter?.recordDestroy()}updateValue(n,e){this.getLView(n)[Bo].$implicit=e}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[Bo].$index=n}getLView(n){return HW(this.lContainer,n)}};function Wi(i){let n=Ci(null),e=bu();try{let a=vi(),d=a[ni],r=a[e],E=e+1,P=rE(a,E);if(r.liveCollection===void 0){let X=n2(d,E);r.liveCollection=new t2(P,a,X)}else r.liveCollection.reset();let k=r.liveCollection;if(VW(k,i,r.trackByFn),k.updateIndexes(),r.hasEmptyBlock){let X=Cf(),oe=k.length===0;if(Ll(a,X,oe)){let Se=e+2,$e=rE(a,Se);if(oe){let ke=n2(d,Se),ht=YB($e,ke,a),Nt=nx(a,ke,void 0,{dehydratedView:ht});ix($e,Nt,0,v_(ke,ht))}else d.firstUpdatePass&&k7($e),WB($e,0)}}}finally{Ci(n)}}function rE(i,n){return i[n]}function UW(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e],d=a?a[xf]:void 0;if(a&&d&&d.detachedLeaveAnimationFns&&d.detachedLeaveAnimationFns.length>0){let r=a[Md];U9(r,d),Tf.delete(a),d.detachedLeaveAnimationFns=void 0}}function jW(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e],d=a?a[xf]:void 0;d&&d.leave&&d.leave.size>0&&(d.detachedLeaveAnimationFns=[])}function $W(i,n){return qy(i,n)}function HW(i,n){return qB(i,n)}function n2(i,n){return Ny(i,n)}function bt(i,n,e){let a=vi(),d=Cf();if(Ll(a,d,n)){let r=Vo(),E=IC();OB(E,a,i,n,a[co],e)}return bt}function i2(i,n,e,a,d){P2(n,i,e,d?"class":"style",a)}function z(i,n,e,a){let d=vi(),r=d[ni],E=i+uo,P=r.firstCreatePass?eV(E,d,2,n,RB,qD(),e,a):r.data[E];if(kB(P,d,i,n,pV),Ly(P)){let k=d[ni];A2(k,d,P),eB(k,P,d)}return a!=null&&mE(d,P),z}function V(){let i=Vo(),n=Rs(),e=FB(n);return i.firstCreatePass&&tV(i,e),ZD(e)&&YD(),GD(),e.classesWithoutHost!=null&&Cq(e)&&i2(i,e,vi(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&Eq(e)&&i2(i,e,vi(),e.stylesWithoutHost,!1),V}function Rn(i,n,e,a){return z(i,n,e,a),V(),Rn}function T_(i,n,e,a){let d=vi(),r=d[ni],E=i+uo,P=r.firstCreatePass?Z7(E,r,2,n,e,a):r.data[E];return kB(P,d,i,n,pV),a!=null&&mE(d,P),T_}function I_(){let i=Rs(),n=FB(i);return ZD(n)&&YD(),GD(),I_}function Af(i,n,e,a){return T_(i,n,e,a),I_(),Af}var pV=(i,n,e,a,d)=>(DC(!0),aB(n[co],a,j3()));function wt(){return vi()}var FC=void 0;function GW(i){let n=Math.floor(Math.abs(i)),e=i.toString().replace(/^[^.]*\.?/,"").length;return n===1&&e===0?1:5}var qW=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],FC,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],FC,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",FC,"{1} 'at' {0}",FC],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",GW],vA={};function sl(i){let n=WW(i),e=wz(n);if(e)return e;let a=n.split("-")[0];if(e=wz(a),e)return e;if(a==="en")return qW;throw new sn(701,!1)}function wz(i){return i in vA||(vA[i]=Al.ng&&Al.ng.common&&Al.ng.common.locales&&Al.ng.common.locales[i]),vA[i]}var Uo=(function(i){return i[i.LocaleId=0]="LocaleId",i[i.DayPeriodsFormat=1]="DayPeriodsFormat",i[i.DayPeriodsStandalone=2]="DayPeriodsStandalone",i[i.DaysFormat=3]="DaysFormat",i[i.DaysStandalone=4]="DaysStandalone",i[i.MonthsFormat=5]="MonthsFormat",i[i.MonthsStandalone=6]="MonthsStandalone",i[i.Eras=7]="Eras",i[i.FirstDayOfWeek=8]="FirstDayOfWeek",i[i.WeekendRange=9]="WeekendRange",i[i.DateFormat=10]="DateFormat",i[i.TimeFormat=11]="TimeFormat",i[i.DateTimeFormat=12]="DateTimeFormat",i[i.NumberSymbols=13]="NumberSymbols",i[i.NumberFormats=14]="NumberFormats",i[i.CurrencyCode=15]="CurrencyCode",i[i.CurrencySymbol=16]="CurrencySymbol",i[i.CurrencyName=17]="CurrencyName",i[i.Currencies=18]="Currencies",i[i.Directionality=19]="Directionality",i[i.PluralCase=20]="PluralCase",i[i.ExtraData=21]="ExtraData",i})(Uo||{});function WW(i){return i.toLowerCase().replace(/_/g,"-")}var ax="en-US";var ZW=ax;function fV(i){typeof i=="string"&&(ZW=i.toLowerCase().replace(/_/g,"-"))}function Ae(i,n,e){let a=vi(),d=Vo(),r=Rs();return mV(d,a,a[co],r,i,n,e),Ae}function mV(i,n,e,a,d,r,E){let P=!0,k=null;if((a.type&3||E)&&(k??=fA(a,n,r),K7(a,i,n,E,e,d,r,k)&&(P=!1)),P){let X=a.outputs?.[d],oe=a.hostDirectiveOutputs?.[d];if(oe&&oe.length)for(let Se=0;Se<oe.length;Se+=2){let $e=oe[Se],ke=oe[Se+1];k??=fA(a,n,r),gz(a,n,$e,ke,d,k)}if(X&&X.length)for(let Se of X)k??=fA(a,n,r),gz(a,n,Se,d,d,k)}}function ne(i=1){return U3(i)}function YW(i,n){let e=null,a=w9(i);for(let d=0;d<n.length;d++){let r=n[d];if(r==="*"){e=d;continue}if(a===null?mB(i,r,!0):S9(a,r))return d}return e}function Pf(i){let n=vi()[ua][ca];if(!n.projection){let e=i?i.length:1,a=n.projection=d3(e,null),d=a.slice(),r=n.child;for(;r!==null;){if(r.type!==128){let E=i?YW(r,i):0;E!==null&&(d[E]?d[E].projectionNext=r:a[E]=r,d[E]=r)}r=r.next}}}function kd(i,n=0,e,a,d,r){let E=vi(),P=Vo(),k=a?i+1:null;k!==null&&Zy(E,P,k,a,d,r,null,e);let X=C_(P,uo+i,16,null,e||null);X.projection===null&&(X.projection=n),QD();let Se=!E[gf]||WD();E[ua][ca].projection[X.projection]===null&&k!==null?XW(E,P,k):Se&&!cE(X)&&Q9(P,E,X)}function XW(i,n,e){let a=uo+e,d=n.data[a],r=i[a],E=KC(r,d.tView.ssrId),P=nx(i,d,void 0,{dehydratedView:E});ix(r,P,0,v_(d,E))}function ka(i,n,e){bW(i,n,e)}function pa(i){let n=vi(),e=Vo(),a=tA();EC(a+1);let d=N2(e,a);if(i.dirty&&C3(n)===((d.metadata.flags&2)===2)){if(d.matches===null)i.reset([]);else{let r=EW(n,a);i.reset(r,Nq),i.notifyOnChanges()}return!0}return!1}function fa(){return yW(vi(),tA())}function Bl(i){let n=P3();return zy(n,uo+i)}function LC(i,n){return i<<17|n<<2}function If(i){return i>>17&32767}function KW(i){return(i&2)==2}function QW(i,n){return i&131071|n<<17}function r2(i){return i|2}function y_(i){return(i&131068)>>2}function yA(i,n){return i&-131069|n<<2}function JW(i){return(i&1)===1}function o2(i){return i|1}function eZ(i,n,e,a,d,r){let E=r?n.classBindings:n.styleBindings,P=If(E),k=y_(E);i[a]=e;let X=!1,oe;if(Array.isArray(e)){let Se=e;oe=Se[1],(oe===null||s_(Se,oe)>0)&&(X=!0)}else oe=e;if(d)if(k!==0){let $e=If(i[P+1]);i[a+1]=LC($e,P),$e!==0&&(i[$e+1]=yA(i[$e+1],a)),i[P+1]=QW(i[P+1],a)}else i[a+1]=LC(P,0),P!==0&&(i[P+1]=yA(i[P+1],a)),P=a;else i[a+1]=LC(k,0),P===0?P=a:i[k+1]=yA(i[k+1],a),k=a;X&&(i[a+1]=r2(i[a+1])),Cz(i,oe,a,!0),Cz(i,oe,a,!1),tZ(n,oe,i,a,r),E=LC(P,k),r?n.classBindings=E:n.styleBindings=E}function tZ(i,n,e,a,d){let r=d?i.residualClasses:i.residualStyles;r!=null&&typeof n=="string"&&s_(r,n)>=0&&(e[a+1]=o2(e[a+1]))}function Cz(i,n,e,a){let d=i[e+1],r=n===null,E=a?If(d):y_(d),P=!1;for(;E!==0&&(P===!1||r);){let k=i[E],X=i[E+1];nZ(k,n)&&(P=!0,i[E+1]=a?o2(X):r2(X)),E=a?If(X):y_(X)}P&&(i[e+1]=a?r2(d):o2(d))}function nZ(i,n){return i===null||n==null||(Array.isArray(i)?i[1]:i)===n?!0:Array.isArray(i)&&typeof n=="string"?s_(i,n)>=0:!1}var Mc={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function iZ(i){return i.substring(Mc.key,Mc.keyEnd)}function rZ(i){return oZ(i),gV(i,_V(i,0,Mc.textEnd))}function gV(i,n){let e=Mc.textEnd;return e===n?-1:(n=Mc.keyEnd=sZ(i,Mc.key=n,e),_V(i,n,e))}function oZ(i){Mc.key=0,Mc.keyEnd=0,Mc.value=0,Mc.valueEnd=0,Mc.textEnd=i.length}function _V(i,n,e){for(;n<e&&i.charCodeAt(n)<=32;)n++;return n}function sZ(i,n,e){for(;n<e&&i.charCodeAt(n)>32;)n++;return n}function jo(i,n,e){return vV(i,n,e,!1),jo}function hn(i,n){return vV(i,n,null,!0),hn}function lx(i){lZ(fZ,aZ,i,!0)}function aZ(i,n){for(let e=rZ(n);e>=0;e=gV(n,e))_C(i,iZ(n),!0)}function vV(i,n,e,a){let d=vi(),r=Vo(),E=wC(2);if(r.firstUpdatePass&&xV(r,i,E,a),n!==ha&&Ll(d,E,n)){let P=r.data[bu()];bV(r,P,d,d[co],i,d[E+1]=gZ(n,e),a,E)}}function lZ(i,n,e,a){let d=Vo(),r=wC(2);d.firstUpdatePass&&xV(d,null,r,a);let E=vi();if(e!==ha&&Ll(E,r,e)){let P=d.data[bu()];if(wV(P,a)&&!yV(d,r)){let k=a?P.classesWithoutHost:P.stylesWithoutHost;k!==null&&(e=pC(k,e||"")),i2(d,P,E,e,a)}else mZ(d,P,E,E[co],E[r+1],E[r+1]=pZ(i,n,e),a,r)}}function yV(i,n){return n>=i.expandoStartIndex}function xV(i,n,e,a){let d=i.data;if(d[e+1]===null){let r=d[bu()],E=yV(i,e);wV(r,a)&&n===null&&!E&&(n=!1),n=cZ(d,r,n,a),eZ(d,r,n,e,E,a)}}function cZ(i,n,e,a){let d=N3(i),r=a?n.residualClasses:n.residualStyles;if(d===null)(a?n.classBindings:n.styleBindings)===0&&(e=xA(null,i,n,e,a),e=Yy(e,n.attrs,a),r=null);else{let E=n.directiveStylingLast;if(E===-1||i[E]!==d)if(e=xA(d,i,n,e,a),r===null){let k=uZ(i,n,a);k!==void 0&&Array.isArray(k)&&(k=xA(null,i,n,k[1],a),k=Yy(k,n.attrs,a),dZ(i,n,a,k))}else r=hZ(i,n,a)}return r!==void 0&&(a?n.residualClasses=r:n.residualStyles=r),e}function uZ(i,n,e){let a=e?n.classBindings:n.styleBindings;if(y_(a)!==0)return i[If(a)]}function dZ(i,n,e,a){let d=e?n.classBindings:n.styleBindings;i[If(d)]=a}function hZ(i,n,e){let a,d=n.directiveEnd;for(let r=1+n.directiveStylingLast;r<d;r++){let E=i[r].hostAttrs;a=Yy(a,E,e)}return Yy(a,n.attrs,e)}function xA(i,n,e,a,d){let r=null,E=e.directiveEnd,P=e.directiveStylingLast;for(P===-1?P=e.directiveStart:P++;P<E&&(r=n[P],a=Yy(a,r.hostAttrs,d),r!==i);)P++;return i!==null&&(e.directiveStylingLast=P),a}function Yy(i,n,e){let a=e?1:2,d=-1;if(n!==null)for(let r=0;r<n.length;r++){let E=n[r];typeof E=="number"?d=E:d===a&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),_C(i,E,e?!0:n[++r]))}return i===void 0?null:i}function pZ(i,n,e){if(e==null||e==="")return la;let a=[],d=Nl(e);if(Array.isArray(d))for(let r=0;r<d.length;r++)i(a,d[r],!0);else if(typeof d=="object")for(let r in d)d.hasOwnProperty(r)&&i(a,r,d[r]);else typeof d=="string"&&n(a,d);return a}function fZ(i,n,e){let a=String(n);a!==""&&!a.includes(" ")&&_C(i,a,e)}function mZ(i,n,e,a,d,r,E,P){d===ha&&(d=la);let k=0,X=0,oe=0<d.length?d[0]:null,Se=0<r.length?r[0]:null;for(;oe!==null||Se!==null;){let $e=k<d.length?d[k+1]:void 0,ke=X<r.length?r[X+1]:void 0,ht=null,Nt;oe===Se?(k+=2,X+=2,$e!==ke&&(ht=Se,Nt=ke)):Se===null||oe!==null&&oe<Se?(k+=2,ht=oe):(X+=2,ht=Se,Nt=ke),ht!==null&&bV(i,n,e,a,ht,Nt,E,P),oe=k<d.length?d[k]:null,Se=X<r.length?r[X]:null}}function bV(i,n,e,a,d,r,E,P){if(!(n.type&3))return;let k=i.data,X=k[P+1],oe=JW(X)?Ez(k,n,e,d,y_(X),E):void 0;if(!oE(oe)){oE(r)||KW(X)&&(r=Ez(k,null,e,d,P,E));let Se=zD(bu(),e);e7(a,E,Se,d,r)}}function Ez(i,n,e,a,d,r){let E=n===null,P;for(;d>0;){let k=i[d],X=Array.isArray(k),oe=X?k[1]:k,Se=oe===null,$e=e[d+1];$e===ha&&($e=Se?la:void 0);let ke=Se?vC($e,a):oe===a?$e:void 0;if(X&&!oE(ke)&&(ke=vC(k,a)),oE(ke)&&(P=ke,E))return P;let ht=i[d+1];d=E?If(ht):y_(ht)}if(n!==null){let k=r?n.residualClasses:n.residualStyles;k!=null&&(P=vC(k,a))}return P}function oE(i){return i!==void 0}function gZ(i,n){return i==null||i===""||(typeof n=="string"?i=i+n:typeof i=="object"&&(i=Sd(Nl(i)))),i}function wV(i,n){return(i.flags&(n?8:16))!==0}function Z(i,n=""){let e=vi(),a=Vo(),d=i+uo,r=a.firstCreatePass?C_(a,d,1,n,null):a.data[d],E=_Z(a,e,r,n,i);e[d]=E,MC()&&M2(a,e,E,r),h_(r,!1)}var _Z=(i,n,e,a,d)=>(DC(!0),h9(n[co],a));function vZ(i,n,e,a=""){return Ll(i,Cf(),e)?n+mf(e)+a:ha}function yZ(i,n,e,a,d,r=""){let E=O3(),P=L2(i,E,e,d);return wC(2),P?n+mf(e)+a+mf(d)+r:ha}function ct(i){return Zi("",i),ct}function Zi(i,n,e){let a=vi(),d=vZ(a,i,n,e);return d!==ha&&CV(a,bu(),d),Zi}function ma(i,n,e,a,d){let r=vi(),E=yZ(r,i,n,e,a,d);return E!==ha&&CV(r,bu(),E),ma}function CV(i,n,e){let a=zD(n,i);p9(i[co],a,e)}function _o(i,n,e){aA(n)&&(n=n());let a=vi(),d=Cf();if(Ll(a,d,n)){let r=Vo(),E=IC();OB(E,a,i,n,a[co],e)}return _o}function To(i,n){let e=aA(i);return e&&i.set(n),e}function vo(i,n){let e=vi(),a=Vo(),d=Rs();return mV(a,e,e[co],d,i,n),vo}function xZ(i,n,e){let a=Vo();if(a.firstCreatePass){let d=xu(i);s2(e,a.data,a.blueprint,d,!0),s2(n,a.data,a.blueprint,d,!1)}}function s2(i,n,e,a,d){if(i=Os(i),Array.isArray(i))for(let r=0;r<i.length;r++)s2(i[r],n,e,a,d);else{let r=Vo(),E=vi(),P=Rs(),k=hf(i)?i:Os(i.provide),X=RD(i),oe=P.providerIndexes&1048575,Se=P.directiveStart,$e=P.providerIndexes>>20;if(hf(i)||!i.multi){let ke=new Sf(X,d,Ft,null),ht=wA(k,n,d?oe:oe+$e,Se);ht===-1?(EA(GC(P,E),r,k),bA(r,i,n.length),n.push(k),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),e.push(ke),E.push(ke)):(e[ht]=ke,E[ht]=ke)}else{let ke=wA(k,n,oe+$e,Se),ht=wA(k,n,oe,oe+$e),Nt=ke>=0&&e[ke],Mt=ht>=0&&e[ht];if(d&&!Mt||!d&&!Nt){EA(GC(P,E),r,k);let Xt=CZ(d?wZ:bZ,e.length,d,a,X,i);!d&&Mt&&(e[ht].providerFactory=Xt),bA(r,i,n.length,0),n.push(k),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),e.push(Xt),E.push(Xt)}else{let Xt=EV(e[d?ht:ke],X,!d&&a);bA(r,i,ke>-1?ke:ht,Xt)}!d&&a&&Mt&&e[ht].componentProviders++}}}function bA(i,n,e,a){let d=hf(n),r=v3(n);if(d||r){let k=(r?Os(n.useClass):n).prototype.ngOnDestroy;if(k){let X=i.destroyHooks||(i.destroyHooks=[]);if(!d&&n.multi){let oe=X.indexOf(e);oe===-1?X.push(e,[a,k]):X[oe+1].push(a,k)}else X.push(e,k)}}}function EV(i,n,e){return e&&i.componentProviders++,i.multi.push(n)-1}function wA(i,n,e,a){for(let d=e;d<a;d++)if(n[d]===i)return d;return-1}function bZ(i,n,e,a,d){return a2(this.multi,[])}function wZ(i,n,e,a,d){let r=this.multi,E;if(this.providerFactory){let P=this.providerFactory.componentProviders,k=Hy(a,a[ni],this.providerFactory.index,d);E=k.slice(0,P),a2(r,E);for(let X=P;X<k.length;X++)E.push(k[X])}else E=[],a2(r,E);return E}function a2(i,n){for(let e=0;e<i.length;e++){let a=i[e];n.push(a())}return n}function CZ(i,n,e,a,d,r){let E=new Sf(i,e,Ft,null);return E.multi=[],E.index=n,E.componentProviders=0,EV(E,d,a&&!e),E}function Lh(i,n=[]){return e=>{e.providersResolver=(a,d)=>xZ(a,d?d(i):i,n)}}function U2(i,n,e){let a=Vy()+i,d=vi();return d[a]===ha?yE(d,a,e?n.call(e):n()):Y7(d,a)}function j2(i,n){let e=i[n];return e===ha?void 0:e}function EZ(i,n,e,a,d,r){let E=n+e;return Ll(i,E,d)?yE(i,E+1,r?a.call(r,d):a(d)):j2(i,E+1)}function SZ(i,n,e,a,d,r,E){let P=n+e;return L2(i,P,d,r)?yE(i,P+2,E?a.call(E,d,r):a(d,r)):j2(i,P+2)}function TZ(i,n,e,a,d,r,E,P){let k=n+e;return X7(i,k,d,r,E)?yE(i,k+3,P?a.call(P,d,r,E):a(d,r,E)):j2(i,k+3)}function Ls(i,n){let e=Vo(),a,d=i+uo;e.firstCreatePass?(a=IZ(n,e.pipeRegistry),e.data[d]=a,a.onDestroy&&(e.destroyHooks??=[]).push(d,a.onDestroy)):a=e.data[d];let r=a.factory||(a.factory=Ih(a.type,!0)),E,P=aa(Ft);try{let k=HC(!1),X=r();return HC(k),BD(e,vi(),d,X),X}finally{aa(P)}}function IZ(i,n){if(n)for(let e=n.length-1;e>=0;e--){let a=n[e];if(i===a.name)return a}}function M_(i,n,e){let a=i+uo,d=vi(),r=zy(d,a);return $2(d,a)?EZ(d,Vy(),n,r.transform,e,r):r.transform(e)}function D_(i,n,e,a){let d=i+uo,r=vi(),E=zy(r,d);return $2(r,d)?SZ(r,Vy(),n,E.transform,e,a,E):E.transform(e,a)}function Of(i,n,e,a,d){let r=i+uo,E=vi(),P=zy(E,r);return $2(E,r)?TZ(E,Vy(),n,P.transform,e,a,d,P):P.transform(e,a,d)}function $2(i,n){return i[ni].data[n].pure}function cx(i,n){return gE(i,n)}var sE=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},H2=(()=>{class i{compileModuleSync(e){return new nE(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let a=this.compileModuleSync(e),d=DD(e),r=pB(d.declarations).reduce((E,P)=>{let k=gu(P);return k&&E.push(new Fh(k)),E},[]);return new sE(a,r)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var MZ=(()=>{class i{zone=Ve(yi);changeDetectionScheduler=Ve(Td);applicationRef=Ve(Oa);applicationErrorHandler=Ve(Gs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(e){this.applicationErrorHandler(e)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),SV=new Kt("",{factory:()=>!1});function G2({ngZoneFactory:i,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return i??=()=>new yi(wi(Ht({},W2()),{scheduleInRootZone:e})),[{provide:yi,useFactory:i},{provide:mu,multi:!0,useFactory:()=>{let a=Ve(MZ,{optional:!0});return()=>a.initialize()}},{provide:mu,multi:!0,useFactory:()=>{let a=Ve(DZ);return()=>{a.initialize()}}},n===!0?{provide:lA,useValue:!0}:[],{provide:cA,useValue:e??yB},{provide:Gs,useFactory:()=>{let a=Ve(yi),d=Ve(Yr),r;return E=>{a.runOutsideAngular(()=>{d.destroyed&&!r?setTimeout(()=>{throw E}):(r??=d.get(Hs),r.handleError(E))})}}}]}function q2(i){let n=i?.ignoreChangesOutsideZone,e=i?.scheduleInRootZone,a=G2({ngZoneFactory:()=>{let d=W2(i);return d.scheduleInRootZone=e,d.shouldCoalesceEventChangeDetection&&Dc("NgZone_CoalesceEvent"),new yi(d)},ignoreChangesOutsideZone:n,scheduleInRootZone:e});return Cc([{provide:SV,useValue:!0},{provide:p_,useValue:!1},a])}function W2(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var DZ=(()=>{class i{subscription=new Hr;initialized=!1;zone=Ve(yi);pendingTasks=Ve(wu);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{yi.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{yi.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var TV=(()=>{class i{applicationErrorHandler=Ve(Gs);appRef=Ve(Oa);taskService=Ve(wu);ngZone=Ve(yi);zonelessEnabled=Ve(p_);tracing=Ve(Df,{optional:!0});disableScheduling=Ve(lA,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Hr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(ZC):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ve(cA,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof YC||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let a=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,a=!0;break}case 12:{this.appRef.dirtyFlags|=16,a=!0;break}case 13:{this.appRef.dirtyFlags|=2,a=!0;break}case 11:{a=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(a))return;let d=this.useMicrotaskScheduler?sz:xB;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>d(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>d(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(ZC+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(a){this.taskService.remove(e),this.applicationErrorHandler(a)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,sz(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function AZ(){return typeof $localize<"u"&&$localize.locale||ax}var ux=new Kt("",{providedIn:"root",factory:()=>Ve(ux,{optional:!0,skipSelf:!0})||AZ()});function es(i){return t3(i)}function dx(i,n){return Ow(i,n?.equal)}var IV=class{[$s];constructor(n){this[$s]=n}destroy(){this[$s].destroy()}};var RV=Symbol("InputSignalNode#UNSET"),qZ=wi(Ht({},Rw),{transformFn:void 0,applyValueToInputSignal(i,n){Wg(i,n)}});function kV(i,n){let e=Object.create(qZ);e.value=i,e.transformFn=n?.transform;function a(){if(Hg(e),e.value===RV){let d=null;throw new sn(-950,d)}return e.value}return a[$s]=e,a}var A_=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>Ky(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},WZ=new Kt("");WZ.__NG_ELEMENT_ID__=i=>{let n=Rs();if(n===null)throw new sn(204,!1);if(n.type&2)return n.value;if(i&8)return null;throw new sn(204,!1)};function MV(i,n){return kV(i,n)}function ZZ(i){return kV(RV,i)}var Io=(MV.required=ZZ,MV);var Z2=new Kt(""),YZ=new Kt("");function hx(i){return!i.moduleRef}function XZ(i){let n=hx(i)?i.r3Injector:i.moduleRef.injector,e=n.get(yi);return e.run(()=>{hx(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let a=n.get(Gs),d;if(e.runOutsideAngular(()=>{d=e.onError.subscribe({next:a})}),hx(i)){let r=()=>n.destroy(),E=i.platformInjector.get(Z2);E.add(r),n.onDestroy(()=>{d.unsubscribe(),E.delete(r)})}else{let r=()=>i.moduleRef.destroy(),E=i.platformInjector.get(Z2);E.add(r),i.moduleRef.onDestroy(()=>{$y(i.allPlatformModules,i.moduleRef),d.unsubscribe(),E.delete(r)})}return QZ(a,e,()=>{let r=n.get(wu),E=r.add(),P=n.get(V2);return P.runInitializers(),P.donePromise.then(()=>{let k=n.get(ux,ax);if(fV(k||ax),!n.get(YZ,!0))return hx(i)?n.get(Oa):(i.allPlatformModules.push(i.moduleRef),i.moduleRef);if(hx(i)){let oe=n.get(Oa);return i.rootComponent!==void 0&&oe.bootstrap(i.rootComponent),oe}else return KZ?.(i.moduleRef,i.allPlatformModules),i.moduleRef}).finally(()=>void r.remove(E))})})}var KZ;function QZ(i,n,e){try{let a=e();return Rd(a)?a.catch(d=>{throw n.runOutsideAngular(()=>i(d)),d}):a}catch(a){throw n.runOutsideAngular(()=>i(a)),a}}var EE=null;function JZ(i=[],n){return hr.create({name:n,providers:[{provide:Oy,useValue:"platform"},{provide:Z2,useValue:new Set([()=>EE=null])},...i]})}function eY(i=[]){if(EE)return EE;let n=JZ(i);return EE=n,dV(),tY(n),n}function tY(i){let n=i.get(aE,null);ys(i,()=>{n?.forEach(e=>e())})}var Ac=(()=>{class i{static __NG_ELEMENT_ID__=nY}return i})();function nY(i){return iY(Rs(),vi(),(i&16)===16)}function iY(i,n,e){if(Oh(i)&&!e){let a=Rl(i.index,n);return new kh(a,a)}else if(i.type&175){let a=n[ua];return new kh(a,n)}return null}var Y2=class{constructor(){}supports(n){return F2(n)}create(n){return new X2(n)}},rY=(i,n)=>n,X2=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||rY}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,a=this._removalsHead,d=0,r=null;for(;e||a;){let E=!a||e&&e.currentIndex<DV(a,d,r)?e:a,P=DV(E,d,r),k=E.currentIndex;if(E===a)d--,a=a._nextRemoved;else if(e=e._next,E.previousIndex==null)d++;else{r||(r=[]);let X=P-d,oe=k-d;if(X!=oe){for(let $e=0;$e<X;$e++){let ke=$e<r.length?r[$e]:r[$e]=0,ht=ke+$e;oe<=ht&&ht<X&&(r[$e]=ke+1)}let Se=E.previousIndex;r[Se]=oe-X}}P!==k&&n(E,P,k)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!F2(n))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,a=!1,d,r,E;if(Array.isArray(n)){this.length=n.length;for(let P=0;P<this.length;P++)r=n[P],E=this._trackByFn(P,r),e===null||!Object.is(e.trackById,E)?(e=this._mismatch(e,r,E,P),a=!0):(a&&(e=this._verifyReinsertion(e,r,E,P)),Object.is(e.item,r)||this._addIdentityChange(e,r)),e=e._next}else d=0,nV(n,P=>{E=this._trackByFn(d,P),e===null||!Object.is(e.trackById,E)?(e=this._mismatch(e,P,E,d),a=!0):(a&&(e=this._verifyReinsertion(e,P,E,d)),Object.is(e.item,P)||this._addIdentityChange(e,P)),e=e._next,d++}),this.length=d;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,a,d){let r;return n===null?r=this._itTail:(r=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(a,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,r,d)):(n=this._linkedRecords===null?null:this._linkedRecords.get(a,d),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,r,d)):n=this._addAfter(new K2(e,a),r,d)),n}_verifyReinsertion(n,e,a,d){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(a,null);return r!==null?n=this._reinsertAfter(r,n._prev,d):n.currentIndex!=d&&(n.currentIndex=d,this._addToMoves(n,d)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,a){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let d=n._prevRemoved,r=n._nextRemoved;return d===null?this._removalsHead=r:d._nextRemoved=r,r===null?this._removalsTail=d:r._prevRemoved=d,this._insertAfter(n,e,a),this._addToMoves(n,a),n}_moveAfter(n,e,a){return this._unlink(n),this._insertAfter(n,e,a),this._addToMoves(n,a),n}_addAfter(n,e,a){return this._insertAfter(n,e,a),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,a){let d=e===null?this._itHead:e._next;return n._next=d,n._prev=e,d===null?this._itTail=n:d._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new SE),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,a=n._next;return e===null?this._itHead=a:e._next=a,a===null?this._itTail=e:a._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new SE),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},K2=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},Q2=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let a;for(a=this._head;a!==null;a=a._nextDup)if((e===null||e<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){let e=n._prevDup,a=n._nextDup;return e===null?this._head=a:e._nextDup=a,a===null?this._tail=e:a._prevDup=e,this._head===null}},SE=class{map=new Map;put(n){let e=n.trackById,a=this.map.get(e);a||(a=new Q2,this.map.set(e,a)),a.add(n)}get(n,e){let a=n,d=this.map.get(a);return d?d.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function DV(i,n,e){let a=i.previousIndex;if(a===null)return a;let d=0;return e&&a<e.length&&(d=e[a]),a+n+d}var J2=class{constructor(){}supports(n){return n instanceof Map||vE(n)}create(){return new eP}},eP=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let e;for(e=this._mapHead;e!==null;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;e!==null;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;e!==null;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||vE(n)))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,d)=>{if(e&&e.key===d)this._maybeAddToChanges(e,a),this._appendAfter=e,e=e._next;else{let r=this._getOrCreateRecordForKey(d,a);e=this._insertBeforeOrAppend(e,r)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let a=e;a!==null;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){let a=n._prev;return e._next=n,e._prev=a,n._prev=e,a&&(a._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){let d=this._records.get(n);this._maybeAddToChanges(d,e);let r=d._prev,E=d._next;return r&&(r._next=E),E&&(E._prev=r),d._next=null,d._prev=null,d}let a=new tP(n);return this._records.set(n,a),a.currentValue=e,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(a=>e(n[a],a))}},tP=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(n){this.key=n}};function AV(){return new TE([new Y2])}var TE=(()=>{class i{factories;static \u0275prov=Rt({token:i,providedIn:"root",factory:AV});constructor(e){this.factories=e}static create(e,a){if(a!=null){let d=a.factories.slice();e=e.concat(d)}return new i(e)}static extend(e){return{provide:i,useFactory:()=>{let a=Ve(i,{optional:!0,skipSelf:!0});return i.create(e,a||AV())}}}find(e){let a=this.factories.find(d=>d.supports(e));if(a!=null)return a;throw new sn(901,!1)}}return i})();function PV(){return new rP([new J2])}var rP=(()=>{class i{static \u0275prov=Rt({token:i,providedIn:"root",factory:PV});factories;constructor(e){this.factories=e}static create(e,a){if(a){let d=a.factories.slice();e=e.concat(d)}return new i(e)}static extend(e){return{provide:i,useFactory:()=>{let a=Ve(i,{optional:!0,skipSelf:!0});return i.create(e,a||PV())}}}find(e){let a=this.factories.find(d=>d.supports(e));if(a)return a;throw new sn(901,!1)}}return i})();function FV(i){let{rootComponent:n,appProviders:e,platformProviders:a,platformRef:d}=i;zr(8);try{let r=d?.injector??eY(a),E=[G2({}),{provide:Td,useExisting:TV},H3,...e||[]],P=new Wy({providers:E,parent:r,debugName:"",runEnvironmentInitializers:!1});return XZ({r3Injector:P.injector,platformInjector:r,rootComponent:n})}catch(r){return Promise.reject(r)}finally{zr(9)}}function Ns(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}function oP(i,n=NaN){return!isNaN(parseFloat(i))&&!isNaN(Number(i))?Number(i):n}function IE(i,n){let e=gu(i),a=n.elementInjector||a_();return new Fh(e).create(a,n.projectableNodes,n.hostElement,n.environmentInjector,n.directives,n.bindings)}function LV(i){let n=gu(i);if(!n)return null;let e=new Fh(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var BV=null;function Vl(){return BV}function sP(i){BV??=i}var px=class{},fx=(()=>{class i{historyGo(e){throw new Error("")}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(VV),providedIn:"platform"})}return i})(),aP=new Kt(""),VV=(()=>{class i extends fx{_location;_history;_doc=Ve(si);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Vl().getBaseHref(this._doc)}onPopState(e){let a=Vl().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",e,!1),()=>a.removeEventListener("popstate",e)}onHashChange(e){let a=Vl().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",e,!1),()=>a.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,a,d){this._history.pushState(e,a,d)}replaceState(e,a,d){this._history.replaceState(e,a,d)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>new i,providedIn:"platform"})}return i})();function ME(i,n){return i?n?i.endsWith("/")?n.startsWith("/")?i+n.slice(1):i+n:n.startsWith("/")?i+n:`${i}/${n}`:i:n}function NV(i){let n=i.search(/#|\?|$/);return i[n-1]==="/"?i.slice(0,n-1)+i.slice(n):i}function Pc(i){return i&&i[0]!=="?"?`?${i}`:i}var Oc=(()=>{class i{historyGo(e){throw new Error("")}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(AE),providedIn:"root"})}return i})(),DE=new Kt(""),AE=(()=>{class i extends Oc{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,a){super(),this._platformLocation=e,this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??Ve(si).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return ME(this._baseHref,e)}path(e=!1){let a=this._platformLocation.pathname+Pc(this._platformLocation.search),d=this._platformLocation.hash;return d&&e?`${a}${d}`:a}pushState(e,a,d,r){let E=this.prepareExternalUrl(d+Pc(r));this._platformLocation.pushState(e,a,E)}replaceState(e,a,d,r){let E=this.prepareExternalUrl(d+Pc(r));this._platformLocation.replaceState(e,a,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(a){return new(a||i)(dn(fx),dn(DE,8))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Iu=(()=>{class i{_subject=new li;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let a=this._locationStrategy.getBaseHref();this._basePath=aY(NV(zV(a))),this._locationStrategy.onPopState(d=>{this._subject.next({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,a=""){return this.path()==this.normalize(e+Pc(a))}normalize(e){return i.stripTrailingSlash(sY(this._basePath,zV(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,a="",d=null){this._locationStrategy.pushState(d,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Pc(a)),d)}replaceState(e,a="",d=null){this._locationStrategy.replaceState(d,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Pc(a)),d)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}),()=>{let a=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(a,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",a){this._urlChangeListeners.forEach(d=>d(e,a))}subscribe(e,a,d){return this._subject.subscribe({next:e,error:a??void 0,complete:d??void 0})}static normalizeQueryParams=Pc;static joinWithSlash=ME;static stripTrailingSlash=NV;static \u0275fac=function(a){return new(a||i)(dn(Oc))};static \u0275prov=Rt({token:i,factory:()=>oY(),providedIn:"root"})}return i})();function oY(){return new Iu(dn(Oc))}function sY(i,n){if(!i||!n.startsWith(i))return n;let e=n.substring(i.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function zV(i){return i.replace(/\/index.html$/,"")}function aY(i){if(new RegExp("^(https?:)?//").test(i)){let[,e]=i.split(/\/\/[^\/]+/);return e}return i}var fP=(()=>{class i extends Oc{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,a){super(),this._platformLocation=e,a!=null&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let a=this._platformLocation.hash??"#";return a.length>0?a.substring(1):a}prepareExternalUrl(e){let a=ME(this._baseHref,e);return a.length>0?"#"+a:a}pushState(e,a,d,r){let E=this.prepareExternalUrl(d+Pc(r))||this._platformLocation.pathname;this._platformLocation.pushState(e,a,E)}replaceState(e,a,d,r){let E=this.prepareExternalUrl(d+Pc(r))||this._platformLocation.pathname;this._platformLocation.replaceState(e,a,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(a){return new(a||i)(dn(fx),dn(DE,8))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})();var qs=(function(i){return i[i.Format=0]="Format",i[i.Standalone=1]="Standalone",i})(qs||{}),qr=(function(i){return i[i.Narrow=0]="Narrow",i[i.Abbreviated=1]="Abbreviated",i[i.Wide=2]="Wide",i[i.Short=3]="Short",i})(qr||{}),Fa=(function(i){return i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long",i[i.Full=3]="Full",i})(Fa||{}),Ld={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function qV(i){return sl(i)[Uo.LocaleId]}function WV(i,n,e){let a=sl(i),d=[a[Uo.DayPeriodsFormat],a[Uo.DayPeriodsStandalone]],r=Ul(d,n);return Ul(r,e)}function ZV(i,n,e){let a=sl(i),d=[a[Uo.DaysFormat],a[Uo.DaysStandalone]],r=Ul(d,n);return Ul(r,e)}function YV(i,n,e){let a=sl(i),d=[a[Uo.MonthsFormat],a[Uo.MonthsStandalone]],r=Ul(d,n);return Ul(r,e)}function XV(i,n){let a=sl(i)[Uo.Eras];return Ul(a,n)}function mx(i,n){let e=sl(i);return Ul(e[Uo.DateFormat],n)}function gx(i,n){let e=sl(i);return Ul(e[Uo.TimeFormat],n)}function _x(i,n){let a=sl(i)[Uo.DateTimeFormat];return Ul(a,n)}function vx(i,n){let e=sl(i),a=e[Uo.NumberSymbols][n];if(typeof a>"u"){if(n===Ld.CurrencyDecimal)return e[Uo.NumberSymbols][Ld.Decimal];if(n===Ld.CurrencyGroup)return e[Uo.NumberSymbols][Ld.Group]}return a}function KV(i){if(!i[Uo.ExtraData])throw new sn(2303,!1)}function QV(i){let n=sl(i);return KV(n),(n[Uo.ExtraData][2]||[]).map(a=>typeof a=="string"?lP(a):[lP(a[0]),lP(a[1])])}function JV(i,n,e){let a=sl(i);KV(a);let d=[a[Uo.ExtraData][0],a[Uo.ExtraData][1]],r=Ul(d,n)||[];return Ul(r,e)||[]}function Ul(i,n){for(let e=n;e>-1;e--)if(typeof i[e]<"u")return i[e];throw new sn(2304,!1)}function lP(i){let[n,e]=i.split(":");return{hours:+n,minutes:+e}}var lY=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,PE={},cY=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function e4(i,n,e,a){let d=vY(i);n=Fd(e,n)||n;let E=[],P;for(;n;)if(P=cY.exec(n),P){E=E.concat(P.slice(1));let oe=E.pop();if(!oe)break;n=oe}else{E.push(n);break}let k=d.getTimezoneOffset();a&&(k=n4(a,k),d=_Y(d,a));let X="";return E.forEach(oe=>{let Se=mY(oe);X+=Se?Se(d,e,k):oe==="''"?"'":oe.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),X}function LE(i,n,e){let a=new Date(0);return a.setFullYear(i,n,e),a.setHours(0,0,0),a}function Fd(i,n){let e=qV(i);if(PE[e]??={},PE[e][n])return PE[e][n];let a="";switch(n){case"shortDate":a=mx(i,Fa.Short);break;case"mediumDate":a=mx(i,Fa.Medium);break;case"longDate":a=mx(i,Fa.Long);break;case"fullDate":a=mx(i,Fa.Full);break;case"shortTime":a=gx(i,Fa.Short);break;case"mediumTime":a=gx(i,Fa.Medium);break;case"longTime":a=gx(i,Fa.Long);break;case"fullTime":a=gx(i,Fa.Full);break;case"short":let d=Fd(i,"shortTime"),r=Fd(i,"shortDate");a=OE(_x(i,Fa.Short),[d,r]);break;case"medium":let E=Fd(i,"mediumTime"),P=Fd(i,"mediumDate");a=OE(_x(i,Fa.Medium),[E,P]);break;case"long":let k=Fd(i,"longTime"),X=Fd(i,"longDate");a=OE(_x(i,Fa.Long),[k,X]);break;case"full":let oe=Fd(i,"fullTime"),Se=Fd(i,"fullDate");a=OE(_x(i,Fa.Full),[oe,Se]);break}return a&&(PE[e][n]=a),a}function OE(i,n){return n&&(i=i.replace(/\{([^}]+)}/g,function(e,a){return n!=null&&a in n?n[a]:e})),i}function Rc(i,n,e="-",a,d){let r="";(i<0||d&&i<=0)&&(d?i=-i+1:(i=-i,r=e));let E=String(i);for(;E.length<n;)E="0"+E;return a&&(E=E.slice(E.length-n)),r+E}function uY(i,n){return Rc(i,3).substring(0,n)}function ts(i,n,e=0,a=!1,d=!1){return function(r,E){let P=dY(i,r);if((e>0||P>-e)&&(P+=e),i===3)P===0&&e===-12&&(P=12);else if(i===6)return uY(P,n);let k=vx(E,Ld.MinusSign);return Rc(P,n,k,a,d)}}function dY(i,n){switch(i){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new sn(2301,!1)}}function io(i,n,e=qs.Format,a=!1){return function(d,r){return hY(d,r,i,n,e,a)}}function hY(i,n,e,a,d,r){switch(e){case 2:return YV(n,d,a)[i.getMonth()];case 1:return ZV(n,d,a)[i.getDay()];case 0:let E=i.getHours(),P=i.getMinutes();if(r){let X=QV(n),oe=JV(n,d,a),Se=X.findIndex($e=>{if(Array.isArray($e)){let[ke,ht]=$e,Nt=E>=ke.hours&&P>=ke.minutes,Mt=E<ht.hours||E===ht.hours&&P<ht.minutes;if(ke.hours<ht.hours){if(Nt&&Mt)return!0}else if(Nt||Mt)return!0}else if($e.hours===E&&$e.minutes===P)return!0;return!1});if(Se!==-1)return oe[Se]}return WV(n,d,a)[E<12?0:1];case 3:return XV(n,a)[i.getFullYear()<=0?0:1];default:let k=e;throw new sn(2302,!1)}}function RE(i){return function(n,e,a){let d=-1*a,r=vx(e,Ld.MinusSign),E=d>0?Math.floor(d/60):Math.ceil(d/60);switch(i){case 0:return(d>=0?"+":"")+Rc(E,2,r)+Rc(Math.abs(d%60),2,r);case 1:return"GMT"+(d>=0?"+":"")+Rc(E,1,r);case 2:return"GMT"+(d>=0?"+":"")+Rc(E,2,r)+":"+Rc(Math.abs(d%60),2,r);case 3:return a===0?"Z":(d>=0?"+":"")+Rc(E,2,r)+":"+Rc(Math.abs(d%60),2,r);default:throw new sn(2310,!1)}}}var pY=0,FE=4;function fY(i){let n=LE(i,pY,1).getDay();return LE(i,0,1+(n<=FE?FE:FE+7)-n)}function t4(i){let n=i.getDay(),e=n===0?-3:FE-n;return LE(i.getFullYear(),i.getMonth(),i.getDate()+e)}function cP(i,n=!1){return function(e,a){let d;if(n){let r=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,E=e.getDate();d=1+Math.floor((E+r)/7)}else{let r=t4(e),E=fY(r.getFullYear()),P=r.getTime()-E.getTime();d=1+Math.round(P/6048e5)}return Rc(d,i,vx(a,Ld.MinusSign))}}function kE(i,n=!1){return function(e,a){let r=t4(e).getFullYear();return Rc(r,i,vx(a,Ld.MinusSign),n)}}var uP={};function mY(i){if(uP[i])return uP[i];let n;switch(i){case"G":case"GG":case"GGG":n=io(3,qr.Abbreviated);break;case"GGGG":n=io(3,qr.Wide);break;case"GGGGG":n=io(3,qr.Narrow);break;case"y":n=ts(0,1,0,!1,!0);break;case"yy":n=ts(0,2,0,!0,!0);break;case"yyy":n=ts(0,3,0,!1,!0);break;case"yyyy":n=ts(0,4,0,!1,!0);break;case"Y":n=kE(1);break;case"YY":n=kE(2,!0);break;case"YYY":n=kE(3);break;case"YYYY":n=kE(4);break;case"M":case"L":n=ts(1,1,1);break;case"MM":case"LL":n=ts(1,2,1);break;case"MMM":n=io(2,qr.Abbreviated);break;case"MMMM":n=io(2,qr.Wide);break;case"MMMMM":n=io(2,qr.Narrow);break;case"LLL":n=io(2,qr.Abbreviated,qs.Standalone);break;case"LLLL":n=io(2,qr.Wide,qs.Standalone);break;case"LLLLL":n=io(2,qr.Narrow,qs.Standalone);break;case"w":n=cP(1);break;case"ww":n=cP(2);break;case"W":n=cP(1,!0);break;case"d":n=ts(2,1);break;case"dd":n=ts(2,2);break;case"c":case"cc":n=ts(7,1);break;case"ccc":n=io(1,qr.Abbreviated,qs.Standalone);break;case"cccc":n=io(1,qr.Wide,qs.Standalone);break;case"ccccc":n=io(1,qr.Narrow,qs.Standalone);break;case"cccccc":n=io(1,qr.Short,qs.Standalone);break;case"E":case"EE":case"EEE":n=io(1,qr.Abbreviated);break;case"EEEE":n=io(1,qr.Wide);break;case"EEEEE":n=io(1,qr.Narrow);break;case"EEEEEE":n=io(1,qr.Short);break;case"a":case"aa":case"aaa":n=io(0,qr.Abbreviated);break;case"aaaa":n=io(0,qr.Wide);break;case"aaaaa":n=io(0,qr.Narrow);break;case"b":case"bb":case"bbb":n=io(0,qr.Abbreviated,qs.Standalone,!0);break;case"bbbb":n=io(0,qr.Wide,qs.Standalone,!0);break;case"bbbbb":n=io(0,qr.Narrow,qs.Standalone,!0);break;case"B":case"BB":case"BBB":n=io(0,qr.Abbreviated,qs.Format,!0);break;case"BBBB":n=io(0,qr.Wide,qs.Format,!0);break;case"BBBBB":n=io(0,qr.Narrow,qs.Format,!0);break;case"h":n=ts(3,1,-12);break;case"hh":n=ts(3,2,-12);break;case"H":n=ts(3,1);break;case"HH":n=ts(3,2);break;case"m":n=ts(4,1);break;case"mm":n=ts(4,2);break;case"s":n=ts(5,1);break;case"ss":n=ts(5,2);break;case"S":n=ts(6,1);break;case"SS":n=ts(6,2);break;case"SSS":n=ts(6,3);break;case"Z":case"ZZ":case"ZZZ":n=RE(0);break;case"ZZZZZ":n=RE(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=RE(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=RE(2);break;default:return null}return uP[i]=n,n}function n4(i,n){i=i.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+i)/6e4;return isNaN(e)?n:e}function gY(i,n){return i=new Date(i.getTime()),i.setMinutes(i.getMinutes()+n),i}function _Y(i,n,e){let d=i.getTimezoneOffset(),r=n4(n,d);return gY(i,-1*(r-d))}function vY(i){if(UV(i))return i;if(typeof i=="number"&&!isNaN(i))return new Date(i);if(typeof i=="string"){if(i=i.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(i)){let[d,r=1,E=1]=i.split("-").map(P=>+P);return LE(d,r-1,E)}let e=parseFloat(i);if(!isNaN(i-e))return new Date(e);let a;if(a=i.match(lY))return yY(a)}let n=new Date(i);if(!UV(n))throw new sn(2311,!1);return n}function yY(i){let n=new Date(0),e=0,a=0,d=i[8]?n.setUTCFullYear:n.setFullYear,r=i[8]?n.setUTCHours:n.setHours;i[9]&&(e=Number(i[9]+i[10]),a=Number(i[9]+i[11])),d.call(n,Number(i[1]),Number(i[2])-1,Number(i[3]));let E=Number(i[4]||0)-e,P=Number(i[5]||0)-a,k=Number(i[6]||0),X=Math.floor(parseFloat("0."+(i[7]||0))*1e3);return r.call(n,E,P,k,X),n}function UV(i){return i instanceof Date&&!isNaN(i.valueOf())}var dP=/\s+/,jV=[],mP=(()=>{class i{_ngEl;_renderer;initialClasses=jV;rawClass;stateMap=new Map;constructor(e,a){this._ngEl=e,this._renderer=a}set klass(e){this.initialClasses=e!=null?e.trim().split(dP):jV}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(dP):e}ngDoCheck(){for(let a of this.initialClasses)this._updateState(a,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let a of e)this._updateState(a,!0);else if(e!=null)for(let a of Object.keys(e))this._updateState(a,!!e[a]);this._applyStateDiff()}_updateState(e,a){let d=this.stateMap.get(e);d!==void 0?(d.enabled!==a&&(d.changed=!0,d.enabled=a),d.touched=!0):this.stateMap.set(e,{enabled:a,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let a=e[0],d=e[1];d.changed?(this._toggleClass(a,d.enabled),d.changed=!1):d.touched||(d.enabled&&this._toggleClass(a,!1),this.stateMap.delete(a)),d.touched=!1}}_toggleClass(e,a){e=e.trim(),e.length>0&&e.split(dP).forEach(d=>{a?this._renderer.addClass(this._ngEl.nativeElement,d):this._renderer.removeClass(this._ngEl.nativeElement,d)})}static \u0275fac=function(a){return new(a||i)(Ft(pr),Ft(Pa))};static \u0275dir=Tr({type:i,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return i})();var NE=class{$implicit;ngForOf;index;count;constructor(n,e,a,d){this.$implicit=n,this.ngForOf=e,this.index=a,this.count=d}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},P_=(()=>{class i{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,a,d){this._viewContainer=e,this._template=a,this._differs=d}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let a=this._viewContainer;e.forEachOperation((d,r,E)=>{if(d.previousIndex==null)a.createEmbeddedView(this._template,new NE(d.item,this._ngForOf,-1,-1),E===null?void 0:E);else if(E==null)a.remove(r===null?void 0:r);else if(r!==null){let P=a.get(r);a.move(P,E),$V(P,d)}});for(let d=0,r=a.length;d<r;d++){let P=a.get(d).context;P.index=d,P.count=r,P.ngForOf=this._ngForOf}e.forEachIdentityChange(d=>{let r=a.get(d.currentIndex);$V(r,d)})}static ngTemplateContextGuard(e,a){return!0}static \u0275fac=function(a){return new(a||i)(Ft(ol),Ft(rl),Ft(TE))};static \u0275dir=Tr({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return i})();function $V(i,n){i.context.$implicit=n.item}var cs=(()=>{class i{_viewContainer;_context=new zE;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,a){this._viewContainer=e,this._thenTemplateRef=a}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){HV(e,!1),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){HV(e,!1),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,a){return!0}static \u0275fac=function(a){return new(a||i)(Ft(ol),Ft(rl))};static \u0275dir=Tr({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return i})(),zE=class{$implicit=null;ngIf=null};function HV(i,n){if(i&&!i.createEmbeddedView)throw new sn(2020,!1)}function gP(i,n){return new sn(2100,!1)}var hP=class{createSubscription(n,e,a){return es(()=>n.subscribe({next:e,error:a}))}dispose(n){es(()=>n.unsubscribe())}},pP=class{createSubscription(n,e,a){return n.then(d=>e?.(d),d=>a?.(d)),{unsubscribe:()=>{e=null,a=null}}}dispose(n){n.unsubscribe()}},xY=new pP,bY=new hP,_P=(()=>{class i{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;applicationErrorHandler=Ve(Gs);constructor(e){this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){if(!this._obj){if(e)try{this.markForCheckOnValueUpdate=!1,this._subscribe(e)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,a=>this._updateLatestValue(e,a),a=>this.applicationErrorHandler(a))}_selectStrategy(e){if(Rd(e))return xY;if(wE(e))return bY;throw gP(i,e)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,a){e===this._obj&&(this._latestValue=a,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(a){return new(a||i)(Ft(Ac,16))};static \u0275pipe=S_({name:"async",type:i,pure:!1})}return i})();var wY="mediumDate",i4=new Kt(""),r4=new Kt(""),yx=(()=>{class i{locale;defaultTimezone;defaultOptions;constructor(e,a,d){this.locale=e,this.defaultTimezone=a,this.defaultOptions=d}transform(e,a,d,r){if(e==null||e===""||e!==e)return null;try{let E=a??this.defaultOptions?.dateFormat??wY,P=d??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return e4(e,E,r||this.locale,P)}catch(E){throw gP(i,E.message)}}static \u0275fac=function(a){return new(a||i)(Ft(ux,16),Ft(i4,24),Ft(r4,24))};static \u0275pipe=S_({name:"date",type:i,pure:!0})}return i})();function CY(i,n){return{key:i,value:n}}var vP=(()=>{class i{differs;constructor(e){this.differs=e}differ;keyValues=[];compareFn=GV;transform(e,a=GV){if(!e||!(e instanceof Map)&&typeof e!="object")return null;this.differ??=this.differs.find(e).create();let d=this.differ.diff(e),r=a!==this.compareFn;return d&&(this.keyValues=[],d.forEachItem(E=>{this.keyValues.push(CY(E.key,E.currentValue))})),(d||r)&&(a&&this.keyValues.sort(a),this.compareFn=a),this.keyValues}static \u0275fac=function(a){return new(a||i)(Ft(rP,16))};static \u0275pipe=S_({name:"keyvalue",type:i,pure:!1})}return i})();function GV(i,n){let e=i.key,a=n.key;if(e===a)return 0;if(e==null)return 1;if(a==null)return-1;if(typeof e=="string"&&typeof a=="string")return e<a?-1:1;if(typeof e=="number"&&typeof a=="number")return e-a;if(typeof e=="boolean"&&typeof a=="boolean")return e<a?-1:1;let d=String(e),r=String(a);return d==r?0:d<r?-1:1}var yP=(()=>{class i{transform(e,a,d){if(e==null)return null;if(!(typeof e=="string"||Array.isArray(e)))throw gP(i,e);return e.slice(a,d)}static \u0275fac=function(a){return new(a||i)};static \u0275pipe=S_({name:"slice",type:i,pure:!1})}return i})();var xi=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})();function xx(i,n){n=encodeURIComponent(n);for(let e of i.split(";")){let a=e.indexOf("="),[d,r]=a==-1?[e,""]:[e.slice(0,a),e.slice(a+1)];if(d.trim()===n)return decodeURIComponent(r)}return null}var Rf=class{};var bP="browser";function o4(i){return i===bP}var s4=(()=>{class i{static \u0275prov=Rt({token:i,providedIn:"root",factory:()=>new xP(Ve(si),window)})}return i})(),xP=class{document;window;offset=()=>[0,0];constructor(n,e){this.document=n,this.window=e}setOffset(n){Array.isArray(n)?this.offset=()=>n:this.offset=n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n,e){this.window.scrollTo(wi(Ht({},e),{left:n[0],top:n[1]}))}scrollToAnchor(n,e){let a=EY(this.document,n);a&&(this.scrollToElement(a,e),a.focus())}setHistoryScrollRestoration(n){try{this.window.history.scrollRestoration=n}catch{console.warn(fu(2400,!1))}}scrollToElement(n,e){let a=n.getBoundingClientRect(),d=a.left+this.window.pageXOffset,r=a.top+this.window.pageYOffset,E=this.offset();this.window.scrollTo(wi(Ht({},e),{left:d-E[0],top:r-E[1]}))}};function EY(i,n){let e=i.getElementById(n)||i.getElementsByName(n)[0];if(e)return e;if(typeof i.createTreeWalker=="function"&&i.body&&typeof i.body.attachShadow=="function"){let a=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT),d=a.currentNode;for(;d;){let r=d.shadowRoot;if(r){let E=r.getElementById(n)||r.querySelector(`[name="${n}"]`);if(E)return E}d=a.nextNode()}}return null}var bx=class{_doc;constructor(n){this._doc=n}manager},BE=(()=>{class i extends bx{constructor(e){super(e)}supports(e){return!0}addEventListener(e,a,d,r){return e.addEventListener(a,d,r),()=>this.removeEventListener(e,a,d,r)}removeEventListener(e,a,d,r){return e.removeEventListener(a,d,r)}static \u0275fac=function(a){return new(a||i)(dn(si))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),UE=new Kt(""),TP=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,a){this._zone=a,e.forEach(E=>{E.manager=this});let d=e.filter(E=>!(E instanceof BE));this._plugins=d.slice().reverse();let r=e.find(E=>E instanceof BE);r&&this._plugins.push(r)}addEventListener(e,a,d,r){return this._findPluginFor(a).addEventListener(e,a,d,r)}getZone(){return this._zone}_findPluginFor(e){let a=this._eventNameToPlugin.get(e);if(a)return a;if(a=this._plugins.find(r=>r.supports(e)),!a)throw new sn(5101,!1);return this._eventNameToPlugin.set(e,a),a}static \u0275fac=function(a){return new(a||i)(dn(UE),dn(yi))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),wP="ng-app-id";function a4(i){for(let n of i)n.remove()}function l4(i,n){let e=n.createElement("style");return e.textContent=i,e}function SY(i,n,e,a){let d=i.head?.querySelectorAll(`style[${wP}="${n}"],link[${wP}="${n}"]`);if(d)for(let r of d)r.removeAttribute(wP),r instanceof HTMLLinkElement?a.set(r.href.slice(r.href.lastIndexOf("/")+1),{usage:0,elements:[r]}):r.textContent&&e.set(r.textContent,{usage:0,elements:[r]})}function EP(i,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",i),e}var IP=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(e,a,d,r={}){this.doc=e,this.appId=a,this.nonce=d,SY(e,a,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,a){for(let d of e)this.addUsage(d,this.inline,l4);a?.forEach(d=>this.addUsage(d,this.external,EP))}removeStyles(e,a){for(let d of e)this.removeUsage(d,this.inline);a?.forEach(d=>this.removeUsage(d,this.external))}addUsage(e,a,d){let r=a.get(e);r?r.usage++:a.set(e,{usage:1,elements:[...this.hosts].map(E=>this.addElement(E,d(e,this.doc)))})}removeUsage(e,a){let d=a.get(e);d&&(d.usage--,d.usage<=0&&(a4(d.elements),a.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])a4(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[a,{elements:d}]of this.inline)d.push(this.addElement(e,l4(a,this.doc)));for(let[a,{elements:d}]of this.external)d.push(this.addElement(e,EP(a,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,a){return this.nonce&&a.setAttribute("nonce",this.nonce),e.appendChild(a)}static \u0275fac=function(a){return new(a||i)(dn(si),dn(b_),dn(w_,8),dn(Mf))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),CP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},MP=/%COMP%/g;var u4="%COMP%",TY=`_nghost-${u4}`,IY=`_ngcontent-${u4}`,MY=!0,DY=new Kt("",{providedIn:"root",factory:()=>MY});function AY(i){return IY.replace(MP,i)}function PY(i){return TY.replace(MP,i)}function d4(i,n){return n.map(e=>e.replace(MP,i))}var DP=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,a,d,r,E,P,k=null,X=null){this.eventManager=e,this.sharedStylesHost=a,this.appId=d,this.removeStylesOnCompDestroy=r,this.doc=E,this.ngZone=P,this.nonce=k,this.tracingService=X,this.platformIsServer=!1,this.defaultRenderer=new wx(e,E,P,this.platformIsServer,this.tracingService)}createRenderer(e,a){if(!e||!a)return this.defaultRenderer;let d=this.getOrCreateRenderer(e,a);return d instanceof VE?d.applyToHost(e):d instanceof Cx&&d.applyStyles(),d}getOrCreateRenderer(e,a){let d=this.rendererByCompId,r=d.get(a.id);if(!r){let E=this.doc,P=this.ngZone,k=this.eventManager,X=this.sharedStylesHost,oe=this.removeStylesOnCompDestroy,Se=this.platformIsServer,$e=this.tracingService;switch(a.encapsulation){case Dd.Emulated:r=new VE(k,X,a,this.appId,oe,E,P,Se,$e);break;case Dd.ShadowDom:return new SP(k,X,e,a,E,P,this.nonce,Se,$e);default:r=new Cx(k,X,a,oe,E,P,Se,$e);break}d.set(a.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(a){return new(a||i)(dn(TP),dn(IP),dn(b_),dn(DY),dn(si),dn(yi),dn(w_),dn(Df,8))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),wx=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,a,d,r){this.eventManager=n,this.doc=e,this.ngZone=a,this.platformIsServer=d,this.tracingService=r}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(CP[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(c4(n)?n.content:n).appendChild(e)}insertBefore(n,e,a){n&&(c4(n)?n.content:n).insertBefore(e,a)}removeChild(n,e){e.remove()}selectRootElement(n,e){let a=typeof n=="string"?this.doc.querySelector(n):n;if(!a)throw new sn(-5104,!1);return e||(a.textContent=""),a}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,a,d){if(d){e=d+":"+e;let r=CP[d];r?n.setAttributeNS(r,e,a):n.setAttribute(e,a)}else n.setAttribute(e,a)}removeAttribute(n,e,a){if(a){let d=CP[a];d?n.removeAttributeNS(d,e):n.removeAttribute(`${a}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,a,d){d&(Eu.DashCase|Eu.Important)?n.style.setProperty(e,a,d&Eu.Important?"important":""):n.style[e]=a}removeStyle(n,e,a){a&Eu.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,a){n!=null&&(n[e]=a)}setValue(n,e){n.nodeValue=e}listen(n,e,a,d){if(typeof n=="string"&&(n=Vl().getGlobalEventTarget(this.doc,n),!n))throw new sn(5102,!1);let r=this.decoratePreventDefault(a);return this.tracingService?.wrapEventListener&&(r=this.tracingService.wrapEventListener(n,e,r)),this.eventManager.addEventListener(n,e,r,d)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;n(e)===!1&&e.preventDefault()}}};function c4(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var SP=class extends wx{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,a,d,r,E,P,k,X){super(n,r,E,k,X),this.sharedStylesHost=e,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let oe=d.styles;oe=d4(d.id,oe);for(let $e of oe){let ke=document.createElement("style");P&&ke.setAttribute("nonce",P),ke.textContent=$e,this.shadowRoot.appendChild(ke)}let Se=d.getExternalStyles?.();if(Se)for(let $e of Se){let ke=EP($e,r);P&&ke.setAttribute("nonce",P),this.shadowRoot.appendChild(ke)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,a){return super.insertBefore(this.nodeOrShadowRoot(n),e,a)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Cx=class extends wx{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,a,d,r,E,P,k,X){super(n,r,E,P,k),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=d;let oe=a.styles;this.styles=X?d4(X,oe):oe,this.styleUrls=a.getExternalStyles?.(X)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Tf.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},VE=class extends Cx{contentAttr;hostAttr;constructor(n,e,a,d,r,E,P,k,X){let oe=d+"-"+a.id;super(n,e,a,r,E,P,k,X,oe),this.contentAttr=AY(oe),this.hostAttr=PY(oe)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let a=super.createElement(n,e);return super.setAttribute(a,this.contentAttr,""),a}};var jE=class i extends px{supportsDOMEvents=!0;static makeCurrent(){sP(new i)}onAndCancel(n,e,a,d){return n.addEventListener(e,a,d),()=>{n.removeEventListener(e,a,d)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=OY();return e==null?null:RY(e)}resetBaseElement(){Ex=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return xx(document.cookie,n)}},Ex=null;function OY(){return Ex=Ex||document.head.querySelector("base"),Ex?Ex.getAttribute("href"):null}function RY(i){return new URL(i,document.baseURI).pathname}var kY=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),h4=["alt","control","meta","shift"],FY={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},LY={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},p4=(()=>{class i extends bx{constructor(e){super(e)}supports(e){return i.parseEventName(e)!=null}addEventListener(e,a,d,r){let E=i.parseEventName(a),P=i.eventCallback(E.fullKey,d,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Vl().onAndCancel(e,E.domEventName,P,r))}static parseEventName(e){let a=e.toLowerCase().split("."),d=a.shift();if(a.length===0||!(d==="keydown"||d==="keyup"))return null;let r=i._normalizeKey(a.pop()),E="",P=a.indexOf("code");if(P>-1&&(a.splice(P,1),E="code."),h4.forEach(X=>{let oe=a.indexOf(X);oe>-1&&(a.splice(oe,1),E+=X+".")}),E+=r,a.length!=0||r.length===0)return null;let k={};return k.domEventName=d,k.fullKey=E,k}static matchEventFullKeyCode(e,a){let d=FY[e.key]||e.key,r="";return a.indexOf("code.")>-1&&(d=e.code,r="code."),d==null||!d?!1:(d=d.toLowerCase(),d===" "?d="space":d==="."&&(d="dot"),h4.forEach(E=>{if(E!==d){let P=LY[E];P(e)&&(r+=E+".")}}),r+=d,r===a)}static eventCallback(e,a,d){return r=>{i.matchEventFullKeyCode(r,e)&&d.runGuarded(()=>a(r))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(a){return new(a||i)(dn(si))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})();function AP(i,n,e){let a=Ht({rootComponent:i,platformRef:e?.platformRef},NY(n));return FV(a)}function NY(i){return{appProviders:[...jY,...i?.providers??[]],platformProviders:UY}}function zY(){jE.makeCurrent()}function BY(){return new Hs}function VY(){return u2(document),document}var UY=[{provide:Mf,useValue:bP},{provide:aE,useValue:zY,multi:!0},{provide:si,useFactory:VY}];var jY=[{provide:Oy,useValue:"root"},{provide:Hs,useFactory:BY},{provide:UE,useClass:BE,multi:!0,deps:[si]},{provide:UE,useClass:p4,multi:!0,deps:[si]},DP,IP,TP,{provide:xs,useExisting:DP},{provide:Rf,useClass:kY},[]];var R_=class{},Sx=class{},zh=class i{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let a=e.indexOf(":");if(a>0){let d=e.slice(0,a),r=e.slice(a+1).trim();this.addHeaderEntry(d,r)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,a)=>{this.addHeaderEntry(a,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,a])=>{this.setHeaderEntries(e,a)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new i;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let a=n.value;if(typeof a=="string"&&(a=[a]),a.length===0)return;this.maybeSetNormalizedName(n.name,e);let d=(n.op==="a"?this.headers.get(e):void 0)||[];d.push(...a),this.headers.set(e,d);break;case"d":let r=n.value;if(!r)this.headers.delete(e),this.normalizedNames.delete(e);else{let E=this.headers.get(e);if(!E)return;E=E.filter(P=>r.indexOf(P)===-1),E.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,E)}break}}addHeaderEntry(n,e){let a=n.toLowerCase();this.maybeSetNormalizedName(n,a),this.headers.has(a)?this.headers.get(a).push(e):this.headers.set(a,[e])}setHeaderEntries(n,e){let a=(Array.isArray(e)?e:[e]).map(r=>r.toString()),d=n.toLowerCase();this.headers.set(d,a),this.maybeSetNormalizedName(n,d)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var HE=class{encodeKey(n){return f4(n)}encodeValue(n){return f4(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function $Y(i,n){let e=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(d=>{let r=d.indexOf("="),[E,P]=r==-1?[n.decodeKey(d),""]:[n.decodeKey(d.slice(0,r)),n.decodeValue(d.slice(r+1))],k=e.get(E)||[];k.push(P),e.set(E,k)}),e}var HY=/%(\d[a-f0-9])/gi,GY={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function f4(i){return encodeURIComponent(i).replace(HY,(n,e)=>GY[e]??n)}function $E(i){return`${i}`}var Nd=class i{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new HE,n.fromString){if(n.fromObject)throw new sn(2805,!1);this.map=$Y(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let a=n.fromObject[e],d=Array.isArray(a)?a.map($E):[$E(a)];this.map.set(e,d)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(a=>{let d=n[a];Array.isArray(d)?d.forEach(r=>{e.push({param:a,value:r,op:"a"})}):e.push({param:a,value:d,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(a=>e+"="+this.encoder.encodeValue(a)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new i({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push($E(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let a=this.map.get(n.param)||[],d=a.indexOf($E(n.value));d!==-1&&a.splice(d,1),a.length>0?this.map.set(n.param,a):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var GE=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function qY(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function m4(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function g4(i){return typeof Blob<"u"&&i instanceof Blob}function _4(i){return typeof FormData<"u"&&i instanceof FormData}function WY(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var v4="Content-Type",y4="Accept",x4="X-Request-URL",b4="text/plain",w4="application/json",ZY=`${w4}, ${b4}, */*`,O_=class i{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(n,e,a,d){this.url=e,this.method=n.toUpperCase();let r;if(qY(this.method)||d?(this.body=a!==void 0?a:null,r=d):r=a,r){if(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,this.keepalive=!!r.keepalive,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),r.priority&&(this.priority=r.priority),r.cache&&(this.cache=r.cache),r.credentials&&(this.credentials=r.credentials),typeof r.timeout=="number"){if(r.timeout<1||!Number.isInteger(r.timeout))throw new sn(2822,"");this.timeout=r.timeout}r.mode&&(this.mode=r.mode),r.redirect&&(this.redirect=r.redirect),r.integrity&&(this.integrity=r.integrity),r.referrer&&(this.referrer=r.referrer),this.transferCache=r.transferCache}if(this.headers??=new zh,this.context??=new GE,!this.params)this.params=new Nd,this.urlWithParams=e;else{let E=this.params.toString();if(E.length===0)this.urlWithParams=e;else{let P=e.indexOf("?"),k=P===-1?"?":P<e.length-1?"&":"";this.urlWithParams=e+k+E}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||m4(this.body)||g4(this.body)||_4(this.body)||WY(this.body)?this.body:this.body instanceof Nd?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||_4(this.body)?null:g4(this.body)?this.body.type||null:m4(this.body)?null:typeof this.body=="string"?b4:this.body instanceof Nd?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?w4:null}clone(n={}){let e=n.method||this.method,a=n.url||this.url,d=n.responseType||this.responseType,r=n.keepalive??this.keepalive,E=n.priority||this.priority,P=n.cache||this.cache,k=n.mode||this.mode,X=n.redirect||this.redirect,oe=n.credentials||this.credentials,Se=n.referrer||this.referrer,$e=n.integrity||this.integrity,ke=n.transferCache??this.transferCache,ht=n.timeout??this.timeout,Nt=n.body!==void 0?n.body:this.body,Mt=n.withCredentials??this.withCredentials,Xt=n.reportProgress??this.reportProgress,Vn=n.headers||this.headers,sr=n.params||this.params,$i=n.context??this.context;return n.setHeaders!==void 0&&(Vn=Object.keys(n.setHeaders).reduce((Li,Or)=>Li.set(Or,n.setHeaders[Or]),Vn)),n.setParams&&(sr=Object.keys(n.setParams).reduce((Li,Or)=>Li.set(Or,n.setParams[Or]),sr)),new i(e,a,Nt,{params:sr,headers:Vn,context:$i,reportProgress:Xt,responseType:d,withCredentials:Mt,transferCache:ke,keepalive:r,cache:P,priority:E,timeout:ht,mode:k,redirect:X,credentials:oe,referrer:Se,integrity:$e})}},kf=(function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i})(kf||{}),k_=class{headers;status;statusText;url;ok;type;redirected;constructor(n,e=200,a="OK"){this.headers=n.headers||new zh,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||a,this.url=n.url||null,this.redirected=n.redirected,this.ok=this.status>=200&&this.status<300}},qE=class i extends k_{constructor(n={}){super(n)}type=kf.ResponseHeader;clone(n={}){return new i({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Tx=class i extends k_{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=kf.Response;clone(n={}){return new i({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0,redirected:n.redirected??this.redirected})}},Nh=class extends k_{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},YY=200,XY=204;function PP(i,n){return{body:n,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,credentials:i.credentials,transferCache:i.transferCache,timeout:i.timeout,keepalive:i.keepalive,priority:i.priority,cache:i.cache,mode:i.mode,redirect:i.redirect,integrity:i.integrity,referrer:i.referrer}}var yo=(()=>{class i{handler;constructor(e){this.handler=e}request(e,a,d={}){let r;if(e instanceof O_)r=e;else{let k;d.headers instanceof zh?k=d.headers:k=new zh(d.headers);let X;d.params&&(d.params instanceof Nd?X=d.params:X=new Nd({fromObject:d.params})),r=new O_(e,a,d.body!==void 0?d.body:null,{headers:k,context:d.context,params:X,reportProgress:d.reportProgress,responseType:d.responseType||"json",withCredentials:d.withCredentials,transferCache:d.transferCache,keepalive:d.keepalive,priority:d.priority,cache:d.cache,mode:d.mode,redirect:d.redirect,credentials:d.credentials,referrer:d.referrer,integrity:d.integrity,timeout:d.timeout})}let E=Dn(r).pipe(pu(k=>this.handler.handle(k)));if(e instanceof O_||d.observe==="events")return E;let P=E.pipe(Ao(k=>k instanceof Tx));switch(d.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return P.pipe(Qn(k=>{if(k.body!==null&&!(k.body instanceof ArrayBuffer))throw new sn(2806,!1);return k.body}));case"blob":return P.pipe(Qn(k=>{if(k.body!==null&&!(k.body instanceof Blob))throw new sn(2807,!1);return k.body}));case"text":return P.pipe(Qn(k=>{if(k.body!==null&&typeof k.body!="string")throw new sn(2808,!1);return k.body}));case"json":default:return P.pipe(Qn(k=>k.body))}case"response":return P;default:throw new sn(2809,!1)}}delete(e,a={}){return this.request("DELETE",e,a)}get(e,a={}){return this.request("GET",e,a)}head(e,a={}){return this.request("HEAD",e,a)}jsonp(e,a){return this.request("JSONP",e,{params:new Nd().append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,a={}){return this.request("OPTIONS",e,a)}patch(e,a,d={}){return this.request("PATCH",e,PP(d,a))}post(e,a,d={}){return this.request("POST",e,PP(d,a))}put(e,a,d={}){return this.request("PUT",e,PP(d,a))}static \u0275fac=function(a){return new(a||i)(dn(R_))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})();var KY=new Kt("");function QY(i,n){return n(i)}function JY(i,n,e){return(a,d)=>ys(e,()=>n(a,r=>i(r,d)))}var RP=new Kt(""),C4=new Kt(""),E4=new Kt("",{providedIn:"root",factory:()=>!0});var WE=(()=>{class i extends R_{backend;injector;chain=null;pendingTasks=Ve(PC);contributeToStability=Ve(E4);constructor(e,a){super(),this.backend=e,this.injector=a}handle(e){if(this.chain===null){let a=Array.from(new Set([...this.injector.get(RP),...this.injector.get(C4,[])]));this.chain=a.reduceRight((d,r)=>JY(d,r,this.injector),QY)}if(this.contributeToStability){let a=this.pendingTasks.add();return this.chain(e,d=>this.backend.handle(d)).pipe(wd(a))}else return this.chain(e,a=>this.backend.handle(a))}static \u0275fac=function(a){return new(a||i)(dn(Sx),dn(Yr))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})();var eX=/^\)\]\}',?\n/,tX=RegExp(`^${x4}:`,"m");function nX(i){return"responseURL"in i&&i.responseURL?i.responseURL:tX.test(i.getAllResponseHeaders())?i.getResponseHeader(x4):null}var OP=(()=>{class i{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new sn(-2800,!1);let a=this.xhrFactory;return Dn(null).pipe(So(()=>new ki(r=>{let E=a.build();if(E.open(e.method,e.urlWithParams),e.withCredentials&&(E.withCredentials=!0),e.headers.forEach((Mt,Xt)=>E.setRequestHeader(Mt,Xt.join(","))),e.headers.has(y4)||E.setRequestHeader(y4,ZY),!e.headers.has(v4)){let Mt=e.detectContentTypeHeader();Mt!==null&&E.setRequestHeader(v4,Mt)}if(e.timeout&&(E.timeout=e.timeout),e.responseType){let Mt=e.responseType.toLowerCase();E.responseType=Mt!=="json"?Mt:"text"}let P=e.serializeBody(),k=null,X=()=>{if(k!==null)return k;let Mt=E.statusText||"OK",Xt=new zh(E.getAllResponseHeaders()),Vn=nX(E)||e.url;return k=new qE({headers:Xt,status:E.status,statusText:Mt,url:Vn}),k},oe=()=>{let{headers:Mt,status:Xt,statusText:Vn,url:sr}=X(),$i=null;Xt!==XY&&($i=typeof E.response>"u"?E.responseText:E.response),Xt===0&&(Xt=$i?YY:0);let Li=Xt>=200&&Xt<300;if(e.responseType==="json"&&typeof $i=="string"){let Or=$i;$i=$i.replace(eX,"");try{$i=$i!==""?JSON.parse($i):null}catch(Ho){$i=Or,Li&&(Li=!1,$i={error:Ho,text:$i})}}Li?(r.next(new Tx({body:$i,headers:Mt,status:Xt,statusText:Vn,url:sr||void 0})),r.complete()):r.error(new Nh({error:$i,headers:Mt,status:Xt,statusText:Vn,url:sr||void 0}))},Se=Mt=>{let{url:Xt}=X(),Vn=new Nh({error:Mt,status:E.status||0,statusText:E.statusText||"Unknown Error",url:Xt||void 0});r.error(Vn)},$e=Se;e.timeout&&($e=Mt=>{let{url:Xt}=X(),Vn=new Nh({error:new DOMException("Request timed out","TimeoutError"),status:E.status||0,statusText:E.statusText||"Request timeout",url:Xt||void 0});r.error(Vn)});let ke=!1,ht=Mt=>{ke||(r.next(X()),ke=!0);let Xt={type:kf.DownloadProgress,loaded:Mt.loaded};Mt.lengthComputable&&(Xt.total=Mt.total),e.responseType==="text"&&E.responseText&&(Xt.partialText=E.responseText),r.next(Xt)},Nt=Mt=>{let Xt={type:kf.UploadProgress,loaded:Mt.loaded};Mt.lengthComputable&&(Xt.total=Mt.total),r.next(Xt)};return E.addEventListener("load",oe),E.addEventListener("error",Se),E.addEventListener("timeout",$e),E.addEventListener("abort",Se),e.reportProgress&&(E.addEventListener("progress",ht),P!==null&&E.upload&&E.upload.addEventListener("progress",Nt)),E.send(P),r.next({type:kf.Sent}),()=>{E.removeEventListener("error",Se),E.removeEventListener("abort",Se),E.removeEventListener("load",oe),E.removeEventListener("timeout",$e),e.reportProgress&&(E.removeEventListener("progress",ht),P!==null&&E.upload&&E.upload.removeEventListener("progress",Nt)),E.readyState!==E.DONE&&E.abort()}})))}static \u0275fac=function(a){return new(a||i)(dn(Rf))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),S4=new Kt(""),iX="XSRF-TOKEN",rX=new Kt("",{providedIn:"root",factory:()=>iX}),oX="X-XSRF-TOKEN",sX=new Kt("",{providedIn:"root",factory:()=>oX}),Ix=class{},aX=(()=>{class i{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,a){this.doc=e,this.cookieName=a}getToken(){let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=xx(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(a){return new(a||i)(dn(si),dn(rX))};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),lX=/^(?:https?:)?\/\//i;function cX(i,n){if(!Ve(S4)||i.method==="GET"||i.method==="HEAD"||lX.test(i.url))return n(i);let e=Ve(Ix).getToken(),a=Ve(sX);return e!=null&&!i.headers.has(a)&&(i=i.clone({headers:i.headers.set(a,e)})),n(i)}var kP=(function(i){return i[i.Interceptors=0]="Interceptors",i[i.LegacyInterceptors=1]="LegacyInterceptors",i[i.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",i[i.NoXsrfProtection=3]="NoXsrfProtection",i[i.JsonpSupport=4]="JsonpSupport",i[i.RequestsMadeViaParent=5]="RequestsMadeViaParent",i[i.Fetch=6]="Fetch",i})(kP||{});function uX(i,n){return{\u0275kind:i,\u0275providers:n}}function FP(...i){let n=[yo,OP,WE,{provide:R_,useExisting:WE},{provide:Sx,useFactory:()=>Ve(KY,{optional:!0})??Ve(OP)},{provide:RP,useValue:cX,multi:!0},{provide:S4,useValue:!0},{provide:Ix,useClass:aX}];for(let e of i)n.push(...e.\u0275providers);return Cc(n)}function LP(i){return uX(kP.Interceptors,i.map(n=>({provide:RP,useValue:n,multi:!0})))}var T4=(()=>{class i{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(a){return new(a||i)(dn(si))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var NP=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:function(a){let d=null;return a?d=new(a||i):d=dn(dX),d},providedIn:"root"})}return i})(),dX=(()=>{class i extends NP{_doc;constructor(e){super(),this._doc=e}sanitize(e,a){if(a==null)return null;switch(e){case ks.NONE:return a;case ks.HTML:return Pd(a,"HTML")?Nl(a):g2(this._doc,String(a)).toString();case ks.STYLE:return Pd(a,"Style")?Nl(a):a;case ks.SCRIPT:if(Pd(a,"Script"))return Nl(a);throw new sn(5200,!1);case ks.URL:return Pd(a,"URL")?Nl(a):Jy(String(a));case ks.RESOURCE_URL:if(Pd(a,"ResourceURL"))return Nl(a);throw new sn(5201,!1);default:throw new sn(5202,!1)}}bypassSecurityTrustHtml(e){return d2(e)}bypassSecurityTrustStyle(e){return h2(e)}bypassSecurityTrustScript(e){return p2(e)}bypassSecurityTrustUrl(e){return f2(e)}bypassSecurityTrustResourceUrl(e){return m2(e)}static \u0275fac=function(a){return new(a||i)(dn(si))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Mi="primary",Vx=Symbol("RouteTitle"),jP=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Nf(i){return new jP(i)}function F4(i,n,e){let a=e.path.split("/");if(a.length>i.length||e.pathMatch==="full"&&(n.hasChildren()||a.length<i.length))return null;let d={};for(let r=0;r<a.length;r++){let E=a[r],P=i[r];if(E[0]===":")d[E.substring(1)]=P;else if(E!==P.path)return null}return{consumed:i.slice(0,a.length),posParams:d}}function hX(i,n){if(i.length!==n.length)return!1;for(let e=0;e<i.length;++e)if(!Mu(i[e],n[e]))return!1;return!0}function Mu(i,n){let e=i?$P(i):void 0,a=n?$P(n):void 0;if(!e||!a||e.length!=a.length)return!1;let d;for(let r=0;r<e.length;r++)if(d=e[r],!L4(i[d],n[d]))return!1;return!0}function $P(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function L4(i,n){if(Array.isArray(i)&&Array.isArray(n)){if(i.length!==n.length)return!1;let e=[...i].sort(),a=[...n].sort();return e.every((d,r)=>a[r]===d)}else return i===n}function N4(i){return i.length>0?i[i.length-1]:null}function zd(i){return nC(i)?i:Rd(i)?go(Promise.resolve(i)):Dn(i)}var pX={exact:B4,subset:V4},z4={exact:fX,subset:mX,ignored:()=>!0};function M4(i,n,e){return pX[e.paths](i.root,n.root,e.matrixParams)&&z4[e.queryParams](i.queryParams,n.queryParams)&&!(e.fragment==="exact"&&i.fragment!==n.fragment)}function fX(i,n){return Mu(i,n)}function B4(i,n,e){if(!Ff(i.segments,n.segments)||!XE(i.segments,n.segments,e)||i.numberOfChildren!==n.numberOfChildren)return!1;for(let a in n.children)if(!i.children[a]||!B4(i.children[a],n.children[a],e))return!1;return!0}function mX(i,n){return Object.keys(n).length<=Object.keys(i).length&&Object.keys(n).every(e=>L4(i[e],n[e]))}function V4(i,n,e){return U4(i,n,n.segments,e)}function U4(i,n,e,a){if(i.segments.length>e.length){let d=i.segments.slice(0,e.length);return!(!Ff(d,e)||n.hasChildren()||!XE(d,e,a))}else if(i.segments.length===e.length){if(!Ff(i.segments,e)||!XE(i.segments,e,a))return!1;for(let d in n.children)if(!i.children[d]||!V4(i.children[d],n.children[d],a))return!1;return!0}else{let d=e.slice(0,i.segments.length),r=e.slice(i.segments.length);return!Ff(i.segments,d)||!XE(i.segments,d,a)||!i.children[Mi]?!1:U4(i.children[Mi],n,r,a)}}function XE(i,n,e){return n.every((a,d)=>z4[e](i[d].parameters,a.parameters))}var Au=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Pr([],{}),e={},a=null){this.root=n,this.queryParams=e,this.fragment=a}get queryParamMap(){return this._queryParamMap??=Nf(this.queryParams),this._queryParamMap}toString(){return vX.serialize(this)}},Pr=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return KE(this)}},Bh=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=Nf(this.parameters),this._parameterMap}toString(){return $4(this)}};function gX(i,n){return Ff(i,n)&&i.every((e,a)=>Mu(e.parameters,n[a].parameters))}function Ff(i,n){return i.length!==n.length?!1:i.every((e,a)=>e.path===n[a].path)}function _X(i,n){let e=[];return Object.entries(i.children).forEach(([a,d])=>{a===Mi&&(e=e.concat(n(d,a)))}),Object.entries(i.children).forEach(([a,d])=>{a!==Mi&&(e=e.concat(n(d,a)))}),e}var zf=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>new Vh,providedIn:"root"})}return i})(),Vh=class{parse(n){let e=new GP(n);return new Au(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${Mx(n.root,!0)}`,a=bX(n.queryParams),d=typeof n.fragment=="string"?`#${yX(n.fragment)}`:"";return`${e}${a}${d}`}},vX=new Vh;function KE(i){return i.segments.map(n=>$4(n)).join("/")}function Mx(i,n){if(!i.hasChildren())return KE(i);if(n){let e=i.children[Mi]?Mx(i.children[Mi],!1):"",a=[];return Object.entries(i.children).forEach(([d,r])=>{d!==Mi&&a.push(`${d}:${Mx(r,!1)}`)}),a.length>0?`${e}(${a.join("//")})`:e}else{let e=_X(i,(a,d)=>d===Mi?[Mx(i.children[Mi],!1)]:[`${d}:${Mx(a,!1)}`]);return Object.keys(i.children).length===1&&i.children[Mi]!=null?`${KE(i)}/${e[0]}`:`${KE(i)}/(${e.join("//")})`}}function j4(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ZE(i){return j4(i).replace(/%3B/gi,";")}function yX(i){return encodeURI(i)}function HP(i){return j4(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function QE(i){return decodeURIComponent(i)}function D4(i){return QE(i.replace(/\+/g,"%20"))}function $4(i){return`${HP(i.path)}${xX(i.parameters)}`}function xX(i){return Object.entries(i).map(([n,e])=>`;${HP(n)}=${HP(e)}`).join("")}function bX(i){let n=Object.entries(i).map(([e,a])=>Array.isArray(a)?a.map(d=>`${ZE(e)}=${ZE(d)}`).join("&"):`${ZE(e)}=${ZE(a)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var wX=/^[^\/()?;#]+/;function zP(i){let n=i.match(wX);return n?n[0]:""}var CX=/^[^\/()?;=#]+/;function EX(i){let n=i.match(CX);return n?n[0]:""}var SX=/^[^=?&#]+/;function TX(i){let n=i.match(SX);return n?n[0]:""}var IX=/^[^&#]+/;function MX(i){let n=i.match(IX);return n?n[0]:""}var GP=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Pr([],{}):new Pr([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(a[Mi]=new Pr(n,e)),a}parseSegment(){let n=zP(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new sn(4009,!1);return this.capture(n),new Bh(QE(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=EX(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){let d=zP(this.remaining);d&&(a=d,this.capture(a))}n[QE(e)]=QE(a)}parseQueryParam(n){let e=TX(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){let E=MX(this.remaining);E&&(a=E,this.capture(a))}let d=D4(e),r=D4(a);if(n.hasOwnProperty(d)){let E=n[d];Array.isArray(E)||(E=[E],n[d]=E),E.push(r)}else n[d]=r}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let a=zP(this.remaining),d=this.remaining[a.length];if(d!=="/"&&d!==")"&&d!==";")throw new sn(4010,!1);let r;a.indexOf(":")>-1?(r=a.slice(0,a.indexOf(":")),this.capture(r),this.capture(":")):n&&(r=Mi);let E=this.parseChildren();e[r??Mi]=Object.keys(E).length===1&&E[Mi]?E[Mi]:new Pr([],E),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new sn(4011,!1)}};function H4(i){return i.segments.length>0?new Pr([],{[Mi]:i}):i}function G4(i){let n={};for(let[a,d]of Object.entries(i.children)){let r=G4(d);if(a===Mi&&r.segments.length===0&&r.hasChildren())for(let[E,P]of Object.entries(r.children))n[E]=P;else(r.segments.length>0||r.hasChildren())&&(n[a]=r)}let e=new Pr(i.segments,n);return DX(e)}function DX(i){if(i.numberOfChildren===1&&i.children[Mi]){let n=i.children[Mi];return new Pr(i.segments.concat(n.segments),n.children)}return i}function Uh(i){return i instanceof Au}function q4(i,n,e=null,a=null){let d=W4(i);return Z4(d,n,e,a)}function W4(i){let n;function e(r){let E={};for(let k of r.children){let X=e(k);E[k.outlet]=X}let P=new Pr(r.url,E);return r===i&&(n=P),P}let a=e(i.root),d=H4(a);return n??d}function Z4(i,n,e,a){let d=i;for(;d.parent;)d=d.parent;if(n.length===0)return BP(d,d,d,e,a);let r=AX(n);if(r.toRoot())return BP(d,d,new Pr([],{}),e,a);let E=PX(r,d,i),P=E.processChildren?Ax(E.segmentGroup,E.index,r.commands):X4(E.segmentGroup,E.index,r.commands);return BP(d,E.segmentGroup,P,e,a)}function JE(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function Ox(i){return typeof i=="object"&&i!=null&&i.outlets}function BP(i,n,e,a,d){let r={};a&&Object.entries(a).forEach(([k,X])=>{r[k]=Array.isArray(X)?X.map(oe=>`${oe}`):`${X}`});let E;i===n?E=e:E=Y4(i,n,e);let P=H4(G4(E));return new Au(P,r,d)}function Y4(i,n,e){let a={};return Object.entries(i.children).forEach(([d,r])=>{r===n?a[d]=e:a[d]=Y4(r,n,e)}),new Pr(i.segments,a)}var eS=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,a){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=a,n&&a.length>0&&JE(a[0]))throw new sn(4003,!1);let d=a.find(Ox);if(d&&d!==N4(a))throw new sn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function AX(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new eS(!0,0,i);let n=0,e=!1,a=i.reduce((d,r,E)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let P={};return Object.entries(r.outlets).forEach(([k,X])=>{P[k]=typeof X=="string"?X.split("/"):X}),[...d,{outlets:P}]}if(r.segmentPath)return[...d,r.segmentPath]}return typeof r!="string"?[...d,r]:E===0?(r.split("/").forEach((P,k)=>{k==0&&P==="."||(k==0&&P===""?e=!0:P===".."?n++:P!=""&&d.push(P))}),d):[...d,r]},[]);return new eS(e,n,a)}var N_=class{segmentGroup;processChildren;index;constructor(n,e,a){this.segmentGroup=n,this.processChildren=e,this.index=a}};function PX(i,n,e){if(i.isAbsolute)return new N_(n,!0,0);if(!e)return new N_(n,!1,NaN);if(e.parent===null)return new N_(e,!0,0);let a=JE(i.commands[0])?0:1,d=e.segments.length-1+a;return OX(e,d,i.numberOfDoubleDots)}function OX(i,n,e){let a=i,d=n,r=e;for(;r>d;){if(r-=d,a=a.parent,!a)throw new sn(4005,!1);d=a.segments.length}return new N_(a,!1,d-r)}function RX(i){return Ox(i[0])?i[0].outlets:{[Mi]:i}}function X4(i,n,e){if(i??=new Pr([],{}),i.segments.length===0&&i.hasChildren())return Ax(i,n,e);let a=kX(i,n,e),d=e.slice(a.commandIndex);if(a.match&&a.pathIndex<i.segments.length){let r=new Pr(i.segments.slice(0,a.pathIndex),{});return r.children[Mi]=new Pr(i.segments.slice(a.pathIndex),i.children),Ax(r,0,d)}else return a.match&&d.length===0?new Pr(i.segments,{}):a.match&&!i.hasChildren()?qP(i,n,e):a.match?Ax(i,0,d):qP(i,n,e)}function Ax(i,n,e){if(e.length===0)return new Pr(i.segments,{});{let a=RX(e),d={};if(Object.keys(a).some(r=>r!==Mi)&&i.children[Mi]&&i.numberOfChildren===1&&i.children[Mi].segments.length===0){let r=Ax(i.children[Mi],n,e);return new Pr(i.segments,r.children)}return Object.entries(a).forEach(([r,E])=>{typeof E=="string"&&(E=[E]),E!==null&&(d[r]=X4(i.children[r],n,E))}),Object.entries(i.children).forEach(([r,E])=>{a[r]===void 0&&(d[r]=E)}),new Pr(i.segments,d)}}function kX(i,n,e){let a=0,d=n,r={match:!1,pathIndex:0,commandIndex:0};for(;d<i.segments.length;){if(a>=e.length)return r;let E=i.segments[d],P=e[a];if(Ox(P))break;let k=`${P}`,X=a<e.length-1?e[a+1]:null;if(d>0&&k===void 0)break;if(k&&X&&typeof X=="object"&&X.outlets===void 0){if(!P4(k,X,E))return r;a+=2}else{if(!P4(k,{},E))return r;a++}d++}return{match:!0,pathIndex:d,commandIndex:a}}function qP(i,n,e){let a=i.segments.slice(0,n),d=0;for(;d<e.length;){let r=e[d];if(Ox(r)){let k=FX(r.outlets);return new Pr(a,k)}if(d===0&&JE(e[0])){let k=i.segments[n];a.push(new Bh(k.path,A4(e[0]))),d++;continue}let E=Ox(r)?r.outlets[Mi]:`${r}`,P=d<e.length-1?e[d+1]:null;E&&P&&JE(P)?(a.push(new Bh(E,A4(P))),d+=2):(a.push(new Bh(E,{})),d++)}return new Pr(a,{})}function FX(i){let n={};return Object.entries(i).forEach(([e,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(n[e]=qP(new Pr([],{}),0,a))}),n}function A4(i){let n={};return Object.entries(i).forEach(([e,a])=>n[e]=`${a}`),n}function P4(i,n,e){return i==e.path&&Mu(n,e.parameters)}var z_="imperative",us=(function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i})(us||{}),cl=class{id;url;constructor(n,e){this.id=n,this.url=e}},jh=class extends cl{type=us.NavigationStart;navigationTrigger;restoredState;constructor(n,e,a="imperative",d=null){super(n,e),this.navigationTrigger=a,this.restoredState=d}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},jl=class extends cl{urlAfterRedirects;type=us.NavigationEnd;constructor(n,e,a){super(n,e),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ga=(function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i[i.Aborted=4]="Aborted",i})(ga||{}),V_=(function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i})(V_||{}),Du=class extends cl{reason;code;type=us.NavigationCancel;constructor(n,e,a,d){super(n,e),this.reason=a,this.code=d}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Pu=class extends cl{reason;code;type=us.NavigationSkipped;constructor(n,e,a,d){super(n,e),this.reason=a,this.code=d}},U_=class extends cl{error;target;type=us.NavigationError;constructor(n,e,a,d){super(n,e),this.error=a,this.target=d}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Rx=class extends cl{urlAfterRedirects;state;type=us.RoutesRecognized;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},tS=class extends cl{urlAfterRedirects;state;type=us.GuardsCheckStart;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nS=class extends cl{urlAfterRedirects;state;shouldActivate;type=us.GuardsCheckEnd;constructor(n,e,a,d,r){super(n,e),this.urlAfterRedirects=a,this.state=d,this.shouldActivate=r}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},iS=class extends cl{urlAfterRedirects;state;type=us.ResolveStart;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rS=class extends cl{urlAfterRedirects;state;type=us.ResolveEnd;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oS=class{route;type=us.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},sS=class{route;type=us.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},aS=class{snapshot;type=us.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lS=class{snapshot;type=us.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cS=class{snapshot;type=us.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uS=class{snapshot;type=us.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},j_=class{routerEvent;position;anchor;type=us.Scroll;constructor(n,e,a){this.routerEvent=n,this.position=e,this.anchor=a}toString(){let n=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${n}')`}},kx=class{},$_=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function LX(i){return!(i instanceof kx)&&!(i instanceof $_)}function NX(i,n){return i.providers&&!i._injector&&(i._injector=E_(i.providers,n,`Route: ${i.path}`)),i._injector??n}function Fc(i){return i.outlet||Mi}function zX(i,n){let e=i.filter(a=>Fc(a)===n);return e.push(...i.filter(a=>Fc(a)!==n)),e}function q_(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let n=i.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var dS=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return q_(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new Bf(this.rootInjector)}},Bf=(()=>{class i{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,a){let d=this.getOrCreateContext(e);d.outlet=a,this.contexts.set(e,d)}onChildOutletDestroyed(e){let a=this.getContext(e);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let a=this.getContext(e);return a||(a=new dS(this.rootInjector),this.contexts.set(e,a)),a}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(a){return new(a||i)(dn(Yr))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),hS=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=WP(n,this._root);return e?e.children.map(a=>a.value):[]}firstChild(n){let e=WP(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=ZP(n,this._root);return e.length<2?[]:e[e.length-2].children.map(d=>d.value).filter(d=>d!==n)}pathFromRoot(n){return ZP(n,this._root).map(e=>e.value)}};function WP(i,n){if(i===n.value)return n;for(let e of n.children){let a=WP(i,e);if(a)return a}return null}function ZP(i,n){if(i===n.value)return[n];for(let e of n.children){let a=ZP(i,e);if(a.length)return a.unshift(n),a}return[]}var ll=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function L_(i){let n={};return i&&i.children.forEach(e=>n[e.value.outlet]=e),n}var Fx=class extends hS{snapshot;constructor(n,e){super(n),this.snapshot=e,nO(this,n)}toString(){return this.snapshot.toString()}};function K4(i){let n=BX(i),e=new No([new Bh("",{})]),a=new No({}),d=new No({}),r=new No({}),E=new No(""),P=new La(e,a,r,E,d,Mi,i,n.root);return P.snapshot=n.root,new Fx(new ll(P,[]),n)}function BX(i){let n={},e={},a={},r=new Lf([],n,a,"",e,Mi,i,null,{});return new Lx("",new ll(r,[]))}var La=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,a,d,r,E,P,k){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=a,this.fragmentSubject=d,this.dataSubject=r,this.outlet=E,this.component=P,this._futureSnapshot=k,this.title=this.dataSubject?.pipe(Qn(X=>X[Vx]))??Dn(void 0),this.url=n,this.params=e,this.queryParams=a,this.fragment=d,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Qn(n=>Nf(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Qn(n=>Nf(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function pS(i,n,e="emptyOnly"){let a,{routeConfig:d}=i;return n!==null&&(e==="always"||d?.path===""||!n.component&&!n.routeConfig?.loadComponent)?a={params:Ht(Ht({},n.params),i.params),data:Ht(Ht({},n.data),i.data),resolve:Ht(Ht(Ht(Ht({},i.data),n.data),d?.data),i._resolvedData)}:a={params:Ht({},i.params),data:Ht({},i.data),resolve:Ht(Ht({},i.data),i._resolvedData??{})},d&&J4(d)&&(a.resolve[Vx]=d.title),a}var Lf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Vx]}constructor(n,e,a,d,r,E,P,k,X){this.url=n,this.params=e,this.queryParams=a,this.fragment=d,this.data=r,this.outlet=E,this.component=P,this.routeConfig=k,this._resolve=X}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Nf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Nf(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(a=>a.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},Lx=class extends hS{url;constructor(n,e){super(e),this.url=n,nO(this,e)}toString(){return Q4(this._root)}};function nO(i,n){n.value._routerState=i,n.children.forEach(e=>nO(i,e))}function Q4(i){let n=i.children.length>0?` { ${i.children.map(Q4).join(", ")} } `:"";return`${i.value}${n}`}function VP(i){if(i.snapshot){let n=i.snapshot,e=i._futureSnapshot;i.snapshot=e,Mu(n.queryParams,e.queryParams)||i.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&i.fragmentSubject.next(e.fragment),Mu(n.params,e.params)||i.paramsSubject.next(e.params),hX(n.url,e.url)||i.urlSubject.next(e.url),Mu(n.data,e.data)||i.dataSubject.next(e.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function YP(i,n){let e=Mu(i.params,n.params)&&gX(i.url,n.url),a=!i.parent!=!n.parent;return e&&!a&&(!i.parent||YP(i.parent,n.parent))}function J4(i){return typeof i.title=="string"||i.title===null}var e5=new Kt(""),Ux=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Mi;activateEvents=new $t;deactivateEvents=new $t;attachEvents=new $t;detachEvents=new $t;routerOutletData=Io();parentContexts=Ve(Bf);location=Ve(ol);changeDetector=Ve(Ac);inputBinder=Ve(jx,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:a,previousValue:d}=e.name;if(a)return;this.isTrackedInParentContexts(d)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(d)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new sn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new sn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new sn(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,a){this.activated=e,this._activatedRoute=a,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,a){if(this.isActivated)throw new sn(4013,!1);this._activatedRoute=e;let d=this.location,E=e.snapshot.component,P=this.parentContexts.getOrCreateContext(this.name).children,k=new XP(e,P,d.injector,this.routerOutletData);this.activated=d.createComponent(E,{index:d.length,injector:k,environmentInjector:a}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Gr]})}return i})(),XP=class{route;childContexts;parent;outletData;constructor(n,e,a,d){this.route=n,this.childContexts=e,this.parent=a,this.outletData=d}get(n,e){return n===La?this.route:n===Bf?this.childContexts:n===e5?this.outletData:this.parent.get(n,e)}},jx=new Kt(""),iO=(()=>{class i{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:a}=e,d=af([a.queryParams,a.params,a.data]).pipe(So(([r,E,P],k)=>(P=Ht(Ht(Ht({},r),E),P),k===0?Dn(P):Promise.resolve(P)))).subscribe(r=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==a||a.component===null){this.unsubscribeFromRouteData(e);return}let E=LV(a.component);if(!E){this.unsubscribeFromRouteData(e);return}for(let{templateName:P}of E.inputs)e.activatedComponentRef.setInput(P,r[P])});this.outletDataSubscriptions.set(e,d)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})(),rO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(a,d){a&1&&Rn(0,"router-outlet")},dependencies:[Ux],encapsulation:2})}return i})();function oO(i){let n=i.children&&i.children.map(oO),e=n?wi(Ht({},i),{children:n}):Ht({},i);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Mi&&(e.component=rO),e}function VX(i,n,e){let a=Nx(i,n._root,e?e._root:void 0);return new Fx(a,n)}function Nx(i,n,e){if(e&&i.shouldReuseRoute(n.value,e.value.snapshot)){let a=e.value;a._futureSnapshot=n.value;let d=UX(i,n,e);return new ll(a,d)}else{if(i.shouldAttach(n.value)){let r=i.retrieve(n.value);if(r!==null){let E=r.route;return E.value._futureSnapshot=n.value,E.children=n.children.map(P=>Nx(i,P)),E}}let a=jX(n.value),d=n.children.map(r=>Nx(i,r));return new ll(a,d)}}function UX(i,n,e){return n.children.map(a=>{for(let d of e.children)if(i.shouldReuseRoute(a.value,d.value.snapshot))return Nx(i,a,d);return Nx(i,a)})}function jX(i){return new La(new No(i.url),new No(i.params),new No(i.queryParams),new No(i.fragment),new No(i.data),i.outlet,i.component,i)}var H_=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},t5="ngNavigationCancelingError";function fS(i,n){let{redirectTo:e,navigationBehaviorOptions:a}=Uh(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,d=n5(!1,ga.Redirect);return d.url=e,d.navigationBehaviorOptions=a,d}function n5(i,n){let e=new Error(`NavigationCancelingError: ${i||""}`);return e[t5]=!0,e.cancellationCode=n,e}function $X(i){return i5(i)&&Uh(i.url)}function i5(i){return!!i&&i[t5]}var HX=(i,n,e,a)=>Qn(d=>(new KP(n,d.targetRouterState,d.currentRouterState,e,a).activate(i),d)),KP=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,a,d,r){this.routeReuseStrategy=n,this.futureState=e,this.currState=a,this.forwardEvent=d,this.inputBindingEnabled=r}activate(n){let e=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,a,n),VP(this.futureState.root),this.activateChildRoutes(e,a,n)}deactivateChildRoutes(n,e,a){let d=L_(e);n.children.forEach(r=>{let E=r.value.outlet;this.deactivateRoutes(r,d[E],a),delete d[E]}),Object.values(d).forEach(r=>{this.deactivateRouteAndItsChildren(r,a)})}deactivateRoutes(n,e,a){let d=n.value,r=e?e.value:null;if(d===r)if(d.component){let E=a.getContext(d.outlet);E&&this.deactivateChildRoutes(n,e,E.children)}else this.deactivateChildRoutes(n,e,a);else r&&this.deactivateRouteAndItsChildren(e,a)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let a=e.getContext(n.value.outlet),d=a&&n.value.component?a.children:e,r=L_(n);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,d);if(a&&a.outlet){let E=a.outlet.detach(),P=a.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:E,route:n,contexts:P})}}deactivateRouteAndOutlet(n,e){let a=e.getContext(n.value.outlet),d=a&&n.value.component?a.children:e,r=L_(n);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,d);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(n,e,a){let d=L_(e);n.children.forEach(r=>{this.activateRoutes(r,d[r.value.outlet],a),this.forwardEvent(new uS(r.value.snapshot))}),n.children.length&&this.forwardEvent(new lS(n.value.snapshot))}activateRoutes(n,e,a){let d=n.value,r=e?e.value:null;if(VP(d),d===r)if(d.component){let E=a.getOrCreateContext(d.outlet);this.activateChildRoutes(n,e,E.children)}else this.activateChildRoutes(n,e,a);else if(d.component){let E=a.getOrCreateContext(d.outlet);if(this.routeReuseStrategy.shouldAttach(d.snapshot)){let P=this.routeReuseStrategy.retrieve(d.snapshot);this.routeReuseStrategy.store(d.snapshot,null),E.children.onOutletReAttached(P.contexts),E.attachRef=P.componentRef,E.route=P.route.value,E.outlet&&E.outlet.attach(P.componentRef,P.route.value),VP(P.route.value),this.activateChildRoutes(n,null,E.children)}else E.attachRef=null,E.route=d,E.outlet&&E.outlet.activateWith(d,E.injector),this.activateChildRoutes(n,null,E.children)}else this.activateChildRoutes(n,null,a)}},mS=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},B_=class{component;route;constructor(n,e){this.component=n,this.route=e}};function GX(i,n,e){let a=i._root,d=n?n._root:null;return Dx(a,d,e,[a.value])}function qX(i){let n=i.routeConfig?i.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:i,guards:n}}function W_(i,n){let e=Symbol(),a=n.get(i,e);return a===e?typeof i=="function"&&!vD(i)?i:n.get(i):a}function Dx(i,n,e,a,d={canDeactivateChecks:[],canActivateChecks:[]}){let r=L_(n);return i.children.forEach(E=>{WX(E,r[E.value.outlet],e,a.concat([E.value]),d),delete r[E.value.outlet]}),Object.entries(r).forEach(([E,P])=>Px(P,e.getContext(E),d)),d}function WX(i,n,e,a,d={canDeactivateChecks:[],canActivateChecks:[]}){let r=i.value,E=n?n.value:null,P=e?e.getContext(i.value.outlet):null;if(E&&r.routeConfig===E.routeConfig){let k=ZX(E,r,r.routeConfig.runGuardsAndResolvers);k?d.canActivateChecks.push(new mS(a)):(r.data=E.data,r._resolvedData=E._resolvedData),r.component?Dx(i,n,P?P.children:null,a,d):Dx(i,n,e,a,d),k&&P&&P.outlet&&P.outlet.isActivated&&d.canDeactivateChecks.push(new B_(P.outlet.component,E))}else E&&Px(n,P,d),d.canActivateChecks.push(new mS(a)),r.component?Dx(i,null,P?P.children:null,a,d):Dx(i,null,e,a,d);return d}function ZX(i,n,e){if(typeof e=="function")return e(i,n);switch(e){case"pathParamsChange":return!Ff(i.url,n.url);case"pathParamsOrQueryParamsChange":return!Ff(i.url,n.url)||!Mu(i.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!YP(i,n)||!Mu(i.queryParams,n.queryParams);case"paramsChange":default:return!YP(i,n)}}function Px(i,n,e){let a=L_(i),d=i.value;Object.entries(a).forEach(([r,E])=>{d.component?n?Px(E,n.children.getContext(r),e):Px(E,null,e):Px(E,n,e)}),d.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new B_(n.outlet.component,d)):e.canDeactivateChecks.push(new B_(null,d)):e.canDeactivateChecks.push(new B_(null,d))}function $x(i){return typeof i=="function"}function YX(i){return typeof i=="boolean"}function XX(i){return i&&$x(i.canLoad)}function KX(i){return i&&$x(i.canActivate)}function QX(i){return i&&$x(i.canActivateChild)}function JX(i){return i&&$x(i.canDeactivate)}function eK(i){return i&&$x(i.canMatch)}function r5(i){return i instanceof bd||i?.name==="EmptyError"}var YE=Symbol("INITIAL_VALUE");function G_(){return So(i=>af(i.map(n=>n.pipe(nl(1),r_(YE)))).pipe(Qn(n=>{for(let e of n)if(e!==!0){if(e===YE)return YE;if(e===!1||tK(e))return e}return!0}),Ao(n=>n!==YE),nl(1)))}function tK(i){return Uh(i)||i instanceof H_}function nK(i,n){return zo(e=>{let{targetSnapshot:a,currentSnapshot:d,guards:{canActivateChecks:r,canDeactivateChecks:E}}=e;return E.length===0&&r.length===0?Dn(wi(Ht({},e),{guardsResult:!0})):iK(E,a,d,i).pipe(zo(P=>P&&YX(P)?rK(a,r,i,n):Dn(P)),Qn(P=>wi(Ht({},e),{guardsResult:P})))})}function iK(i,n,e,a){return go(i).pipe(zo(d=>cK(d.component,d.route,e,n,a)),Cd(d=>d!==!0,!0))}function rK(i,n,e,a){return go(n).pipe(pu(d=>Sh(sK(d.route.parent,a),oK(d.route,a),lK(i,d.path,e),aK(i,d.route,e))),Cd(d=>d!==!0,!0))}function oK(i,n){return i!==null&&n&&n(new cS(i)),Dn(!0)}function sK(i,n){return i!==null&&n&&n(new aS(i)),Dn(!0)}function aK(i,n,e){let a=n.routeConfig?n.routeConfig.canActivate:null;if(!a||a.length===0)return Dn(!0);let d=a.map(r=>Ey(()=>{let E=q_(n)??e,P=W_(r,E),k=KX(P)?P.canActivate(n,i):ys(E,()=>P(n,i));return zd(k).pipe(Cd())}));return Dn(d).pipe(G_())}function lK(i,n,e){let a=n[n.length-1],r=n.slice(0,n.length-1).reverse().map(E=>qX(E)).filter(E=>E!==null).map(E=>Ey(()=>{let P=E.guards.map(k=>{let X=q_(E.node)??e,oe=W_(k,X),Se=QX(oe)?oe.canActivateChild(a,i):ys(X,()=>oe(a,i));return zd(Se).pipe(Cd())});return Dn(P).pipe(G_())}));return Dn(r).pipe(G_())}function cK(i,n,e,a,d){let r=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!r||r.length===0)return Dn(!0);let E=r.map(P=>{let k=q_(n)??d,X=W_(P,k),oe=JX(X)?X.canDeactivate(i,n,e,a):ys(k,()=>X(i,n,e,a));return zd(oe).pipe(Cd())});return Dn(E).pipe(G_())}function uK(i,n,e,a){let d=n.canLoad;if(d===void 0||d.length===0)return Dn(!0);let r=d.map(E=>{let P=W_(E,i),k=XX(P)?P.canLoad(n,e):ys(i,()=>P(n,e));return zd(k)});return Dn(r).pipe(G_(),o5(a))}function o5(i){return KM(Po(n=>{if(typeof n!="boolean")throw fS(i,n)}),Qn(n=>n===!0))}function dK(i,n,e,a){let d=n.canMatch;if(!d||d.length===0)return Dn(!0);let r=d.map(E=>{let P=W_(E,i),k=eK(P)?P.canMatch(n,e):ys(i,()=>P(n,e));return zd(k)});return Dn(r).pipe(G_(),o5(a))}var zx=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},Bx=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function F_(i){return bc(new zx(i))}function hK(i){return bc(new sn(4e3,!1))}function pK(i){return bc(n5(!1,ga.GuardRejected))}var QP=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let a=[],d=e.root;for(;;){if(a=a.concat(d.segments),d.numberOfChildren===0)return Dn(a);if(d.numberOfChildren>1||!d.children[Mi])return hK(`${n.redirectTo}`);d=d.children[Mi]}}applyRedirectCommands(n,e,a,d,r){return fK(e,d,r).pipe(Qn(E=>{if(E instanceof Au)throw new Bx(E);let P=this.applyRedirectCreateUrlTree(E,this.urlSerializer.parse(E),n,a);if(E[0]==="/")throw new Bx(P);return P}))}applyRedirectCreateUrlTree(n,e,a,d){let r=this.createSegmentGroup(n,e.root,a,d);return new Au(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let a={};return Object.entries(n).forEach(([d,r])=>{if(typeof r=="string"&&r[0]===":"){let P=r.substring(1);a[d]=e[P]}else a[d]=r}),a}createSegmentGroup(n,e,a,d){let r=this.createSegments(n,e.segments,a,d),E={};return Object.entries(e.children).forEach(([P,k])=>{E[P]=this.createSegmentGroup(n,k,a,d)}),new Pr(r,E)}createSegments(n,e,a,d){return e.map(r=>r.path[0]===":"?this.findPosParam(n,r,d):this.findOrReturn(r,a))}findPosParam(n,e,a){let d=a[e.path.substring(1)];if(!d)throw new sn(4001,!1);return d}findOrReturn(n,e){let a=0;for(let d of e){if(d.path===n.path)return e.splice(a),d;a++}return n}};function fK(i,n,e){if(typeof i=="string")return Dn(i);let a=i,{queryParams:d,fragment:r,routeConfig:E,url:P,outlet:k,params:X,data:oe,title:Se}=n;return zd(ys(e,()=>a({params:X,data:oe,queryParams:d,fragment:r,routeConfig:E,url:P,outlet:k,title:Se})))}var JP={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function mK(i,n,e,a,d){let r=s5(i,n,e);return r.matched?(a=NX(n,a),dK(a,n,e,d).pipe(Qn(E=>E===!0?r:Ht({},JP)))):Dn(r)}function s5(i,n,e){if(n.path==="**")return gK(e);if(n.path==="")return n.pathMatch==="full"&&(i.hasChildren()||e.length>0)?Ht({},JP):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let d=(n.matcher||F4)(e,i,n);if(!d)return Ht({},JP);let r={};Object.entries(d.posParams??{}).forEach(([P,k])=>{r[P]=k.path});let E=d.consumed.length>0?Ht(Ht({},r),d.consumed[d.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:d.consumed,remainingSegments:e.slice(d.consumed.length),parameters:E,positionalParamSegments:d.posParams??{}}}function gK(i){return{matched:!0,parameters:i.length>0?N4(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function O4(i,n,e,a){return e.length>0&&yK(i,e,a)?{segmentGroup:new Pr(n,vK(a,new Pr(e,i.children))),slicedSegments:[]}:e.length===0&&xK(i,e,a)?{segmentGroup:new Pr(i.segments,_K(i,e,a,i.children)),slicedSegments:e}:{segmentGroup:new Pr(i.segments,i.children),slicedSegments:e}}function _K(i,n,e,a){let d={};for(let r of e)if(_S(i,n,r)&&!a[Fc(r)]){let E=new Pr([],{});d[Fc(r)]=E}return Ht(Ht({},a),d)}function vK(i,n){let e={};e[Mi]=n;for(let a of i)if(a.path===""&&Fc(a)!==Mi){let d=new Pr([],{});e[Fc(a)]=d}return e}function yK(i,n,e){return e.some(a=>_S(i,n,a)&&Fc(a)!==Mi)}function xK(i,n,e){return e.some(a=>_S(i,n,a))}function _S(i,n,e){return(i.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function bK(i,n,e){return n.length===0&&!i.children[e]}var eO=class{};function wK(i,n,e,a,d,r,E="emptyOnly"){return new tO(i,n,e,a,d,E,r).recognize()}var CK=31,tO=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,a,d,r,E,P){this.injector=n,this.configLoader=e,this.rootComponentType=a,this.config=d,this.urlTree=r,this.paramsInheritanceStrategy=E,this.urlSerializer=P,this.applyRedirects=new QP(this.urlSerializer,this.urlTree)}noMatchError(n){return new sn(4002,`'${n.segmentGroup}'`)}recognize(){let n=O4(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Qn(({children:e,rootSnapshot:a})=>{let d=new ll(a,e),r=new Lx("",d),E=q4(a,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(E),{state:r,tree:E}}))}match(n){let e=new Lf([],Object.freeze({}),Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Mi,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Mi,e).pipe(Qn(a=>({children:a,rootSnapshot:e})),tl(a=>{if(a instanceof Bx)return this.urlTree=a.urlTree,this.match(a.urlTree.root);throw a instanceof zx?this.noMatchError(a):a}))}processSegmentGroup(n,e,a,d,r){return a.segments.length===0&&a.hasChildren()?this.processChildren(n,e,a,r):this.processSegment(n,e,a,a.segments,d,!0,r).pipe(Qn(E=>E instanceof ll?[E]:[]))}processChildren(n,e,a,d){let r=[];for(let E of Object.keys(a.children))E==="primary"?r.unshift(E):r.push(E);return go(r).pipe(pu(E=>{let P=a.children[E],k=zX(e,E);return this.processSegmentGroup(n,k,P,E,d)}),iD((E,P)=>(E.push(...P),E)),Th(null),nD(),zo(E=>{if(E===null)return F_(a);let P=a5(E);return EK(P),Dn(P)}))}processSegment(n,e,a,d,r,E,P){return go(e).pipe(pu(k=>this.processSegmentAgainstRoute(k._injector??n,e,k,a,d,r,E,P).pipe(tl(X=>{if(X instanceof zx)return Dn(null);throw X}))),Cd(k=>!!k),tl(k=>{if(r5(k))return bK(a,d,r)?Dn(new eO):F_(a);throw k}))}processSegmentAgainstRoute(n,e,a,d,r,E,P,k){return Fc(a)!==E&&(E===Mi||!_S(d,r,a))?F_(d):a.redirectTo===void 0?this.matchSegmentAgainstRoute(n,d,a,r,E,k):this.allowRedirects&&P?this.expandSegmentAgainstRouteUsingRedirect(n,d,e,a,r,E,k):F_(d)}expandSegmentAgainstRouteUsingRedirect(n,e,a,d,r,E,P){let{matched:k,parameters:X,consumedSegments:oe,positionalParamSegments:Se,remainingSegments:$e}=s5(e,d,r);if(!k)return F_(e);typeof d.redirectTo=="string"&&d.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>CK&&(this.allowRedirects=!1));let ke=new Lf(r,X,Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,R4(d),Fc(d),d.component??d._loadedComponent??null,d,k4(d)),ht=pS(ke,P,this.paramsInheritanceStrategy);return ke.params=Object.freeze(ht.params),ke.data=Object.freeze(ht.data),this.applyRedirects.applyRedirectCommands(oe,d.redirectTo,Se,ke,n).pipe(So(Mt=>this.applyRedirects.lineralizeSegments(d,Mt)),zo(Mt=>this.processSegment(n,a,e,Mt.concat($e),E,!1,P)))}matchSegmentAgainstRoute(n,e,a,d,r,E){let P=mK(e,a,d,n,this.urlSerializer);return a.path==="**"&&(e.children={}),P.pipe(So(k=>k.matched?(n=a._injector??n,this.getChildConfig(n,a,d).pipe(So(({routes:X})=>{let oe=a._loadedInjector??n,{parameters:Se,consumedSegments:$e,remainingSegments:ke}=k,ht=new Lf($e,Se,Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,R4(a),Fc(a),a.component??a._loadedComponent??null,a,k4(a)),Nt=pS(ht,E,this.paramsInheritanceStrategy);ht.params=Object.freeze(Nt.params),ht.data=Object.freeze(Nt.data);let{segmentGroup:Mt,slicedSegments:Xt}=O4(e,$e,ke,X);if(Xt.length===0&&Mt.hasChildren())return this.processChildren(oe,X,Mt,ht).pipe(Qn(sr=>new ll(ht,sr)));if(X.length===0&&Xt.length===0)return Dn(new ll(ht,[]));let Vn=Fc(a)===r;return this.processSegment(oe,X,Mt,Xt,Vn?Mi:r,!0,ht).pipe(Qn(sr=>new ll(ht,sr instanceof ll?[sr]:[])))}))):F_(e)))}getChildConfig(n,e,a){return e.children?Dn({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?Dn({routes:e._loadedRoutes,injector:e._loadedInjector}):uK(n,e,a,this.urlSerializer).pipe(zo(d=>d?this.configLoader.loadChildren(n,e).pipe(Po(r=>{e._loadedRoutes=r.routes,e._loadedInjector=r.injector})):pK(e))):Dn({routes:[],injector:n})}};function EK(i){i.sort((n,e)=>n.value.outlet===Mi?-1:e.value.outlet===Mi?1:n.value.outlet.localeCompare(e.value.outlet))}function SK(i){let n=i.value.routeConfig;return n&&n.path===""}function a5(i){let n=[],e=new Set;for(let a of i){if(!SK(a)){n.push(a);continue}let d=n.find(r=>a.value.routeConfig===r.value.routeConfig);d!==void 0?(d.children.push(...a.children),e.add(d)):n.push(a)}for(let a of e){let d=a5(a.children);n.push(new ll(a.value,d))}return n.filter(a=>!e.has(a))}function R4(i){return i.data||{}}function k4(i){return i.resolve||{}}function TK(i,n,e,a,d,r){return zo(E=>wK(i,n,e,a,E.extractedUrl,d,r).pipe(Qn(({state:P,tree:k})=>wi(Ht({},E),{targetSnapshot:P,urlAfterRedirects:k}))))}function IK(i,n){return zo(e=>{let{targetSnapshot:a,guards:{canActivateChecks:d}}=e;if(!d.length)return Dn(e);let r=new Set(d.map(k=>k.route)),E=new Set;for(let k of r)if(!E.has(k))for(let X of l5(k))E.add(X);let P=0;return go(E).pipe(pu(k=>r.has(k)?MK(k,a,i,n):(k.data=pS(k,k.parent,i).resolve,Dn(void 0))),Po(()=>P++),i_(1),zo(k=>P===E.size?Dn(e):Da))})}function l5(i){let n=i.children.map(e=>l5(e)).flat();return[i,...n]}function MK(i,n,e,a){let d=i.routeConfig,r=i._resolve;return d?.title!==void 0&&!J4(d)&&(r[Vx]=d.title),Ey(()=>(i.data=pS(i,i.parent,e).resolve,DK(r,i,n,a).pipe(Qn(E=>(i._resolvedData=E,i.data=Ht(Ht({},i.data),E),null)))))}function DK(i,n,e,a){let d=$P(i);if(d.length===0)return Dn({});let r={};return go(d).pipe(zo(E=>AK(i[E],n,e,a).pipe(Cd(),Po(P=>{if(P instanceof H_)throw fS(new Vh,P);r[E]=P}))),i_(1),Qn(()=>r),tl(E=>r5(E)?Da:bc(E)))}function AK(i,n,e,a){let d=q_(n)??a,r=W_(i,d),E=r.resolve?r.resolve(n,e):ys(d,()=>r(n,e));return zd(E)}function UP(i){return So(n=>{let e=i(n);return e?go(e).pipe(Qn(()=>n)):Dn(n)})}var sO=(()=>{class i{buildTitle(e){let a,d=e.root;for(;d!==void 0;)a=this.getResolvedTitleForRoute(d)??a,d=d.children.find(r=>r.outlet===Mi);return a}getResolvedTitleForRoute(e){return e.data[Vx]}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(c5),providedIn:"root"})}return i})(),c5=(()=>{class i extends sO{title;constructor(e){super(),this.title=e}updateTitle(e){let a=this.buildTitle(e);a!==void 0&&this.title.setTitle(a)}static \u0275fac=function(a){return new(a||i)(dn(T4))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),$h=new Kt("",{providedIn:"root",factory:()=>({})}),Vf=new Kt(""),vS=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Ve(H2);loadComponent(e,a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return Dn(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);let d=zd(ys(e,()=>a.loadComponent())).pipe(Qn(d5),So(h5),Po(E=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=E}),wd(()=>{this.componentLoaders.delete(a)})),r=new Jg(d,()=>new li).pipe(Qg());return this.componentLoaders.set(a,r),r}loadChildren(e,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return Dn({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);let r=u5(a,this.compiler,e,this.onLoadEndListener).pipe(wd(()=>{this.childrenLoaders.delete(a)})),E=new Jg(r,()=>new li).pipe(Qg());return this.childrenLoaders.set(a,E),E}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function u5(i,n,e,a){return zd(ys(e,()=>i.loadChildren())).pipe(Qn(d5),So(h5),zo(d=>d instanceof xE||Array.isArray(d)?Dn(d):go(n.compileModuleAsync(d))),Qn(d=>{a&&a(i);let r,E,P=!1;return Array.isArray(d)?(E=d,P=!0):(r=d.create(e).injector,E=r.get(Vf,[],{optional:!0,self:!0}).flat()),{routes:E.map(oO),injector:r}}))}function PK(i){return i&&typeof i=="object"&&"default"in i}function d5(i){return PK(i)?i.default:i}function h5(i){return Dn(i)}var yS=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(OK),providedIn:"root"})}return i})(),OK=(()=>{class i{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,a){return e}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),aO=new Kt(""),lO=new Kt("");function p5(i,n,e){let a=i.get(lO),d=i.get(si);if(!d.startViewTransition||a.skipNextTransition)return a.skipNextTransition=!1,new Promise(X=>setTimeout(X));let r,E=new Promise(X=>{r=X}),P=d.startViewTransition(()=>(r(),RK(i)));P.ready.catch(X=>{});let{onViewTransitionCreated:k}=a;return k&&ys(i,()=>k({transition:P,from:n,to:e})),E}function RK(i){return new Promise(n=>{zl({read:()=>setTimeout(n)},{injector:i})})}var cO=new Kt(""),xS=(()=>{class i{currentNavigation=da(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new li;transitionAbortWithErrorSubject=new li;configLoader=Ve(vS);environmentInjector=Ve(Yr);destroyRef=Ve(Fl);urlSerializer=Ve(zf);rootContexts=Ve(Bf);location=Ve(Iu);inputBindingEnabled=Ve(jx,{optional:!0})!==null;titleStrategy=Ve(sO);options=Ve($h,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Ve(yS);createViewTransition=Ve(aO,{optional:!0});navigationErrorHandler=Ve(cO,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Dn(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=d=>this.events.next(new oS(d)),a=d=>this.events.next(new sS(d));this.configLoader.onLoadEndListener=a,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let a=++this.navigationId;es(()=>{this.transitions?.next(wi(Ht({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:a}))})}setupNavigations(e){return this.transitions=new No(null),this.transitions.pipe(Ao(a=>a!==null),So(a=>{let d=!1;return Dn(a).pipe(So(r=>{if(this.navigationId>a.id)return this.cancelNavigationTransition(a,"",ga.SupersededByNewNavigation),Da;this.currentTransition=a,this.currentNavigation.set({id:r.id,initialUrl:r.rawUrl,extractedUrl:r.extractedUrl,targetBrowserUrl:typeof r.extras.browserUrl=="string"?this.urlSerializer.parse(r.extras.browserUrl):r.extras.browserUrl,trigger:r.source,extras:r.extras,previousNavigation:this.lastSuccessfulNavigation?wi(Ht({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>r.abortController.abort()});let E=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),P=r.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!E&&P!=="reload")return this.events.next(new Pu(r.id,this.urlSerializer.serialize(r.rawUrl),"",V_.IgnoredSameUrlNavigation)),r.resolve(!1),Da;if(this.urlHandlingStrategy.shouldProcessUrl(r.rawUrl))return Dn(r).pipe(So(k=>(this.events.next(new jh(k.id,this.urlSerializer.serialize(k.extractedUrl),k.source,k.restoredState)),k.id!==this.navigationId?Da:Promise.resolve(k))),TK(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Po(k=>{a.targetSnapshot=k.targetSnapshot,a.urlAfterRedirects=k.urlAfterRedirects,this.currentNavigation.update(oe=>(oe.finalUrl=k.urlAfterRedirects,oe));let X=new Rx(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(X)}));if(E&&this.urlHandlingStrategy.shouldProcessUrl(r.currentRawUrl)){let{id:k,extractedUrl:X,source:oe,restoredState:Se,extras:$e}=r,ke=new jh(k,this.urlSerializer.serialize(X),oe,Se);this.events.next(ke);let ht=K4(this.rootComponentType).snapshot;return this.currentTransition=a=wi(Ht({},r),{targetSnapshot:ht,urlAfterRedirects:X,extras:wi(Ht({},$e),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(Nt=>(Nt.finalUrl=X,Nt)),Dn(a)}else return this.events.next(new Pu(r.id,this.urlSerializer.serialize(r.extractedUrl),"",V_.IgnoredByUrlHandlingStrategy)),r.resolve(!1),Da}),Po(r=>{let E=new tS(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot);this.events.next(E)}),Qn(r=>(this.currentTransition=a=wi(Ht({},r),{guards:GX(r.targetSnapshot,r.currentSnapshot,this.rootContexts)}),a)),nK(this.environmentInjector,r=>this.events.next(r)),Po(r=>{if(a.guardsResult=r.guardsResult,r.guardsResult&&typeof r.guardsResult!="boolean")throw fS(this.urlSerializer,r.guardsResult);let E=new nS(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot,!!r.guardsResult);this.events.next(E)}),Ao(r=>r.guardsResult?!0:(this.cancelNavigationTransition(r,"",ga.GuardRejected),!1)),UP(r=>{if(r.guards.canActivateChecks.length!==0)return Dn(r).pipe(Po(E=>{let P=new iS(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(P)}),So(E=>{let P=!1;return Dn(E).pipe(IK(this.paramsInheritanceStrategy,this.environmentInjector),Po({next:()=>P=!0,complete:()=>{P||this.cancelNavigationTransition(E,"",ga.NoDataFromResolver)}}))}),Po(E=>{let P=new rS(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(P)}))}),UP(r=>{let E=P=>{let k=[];if(P.routeConfig?.loadComponent){let X=q_(P)??this.environmentInjector;k.push(this.configLoader.loadComponent(X,P.routeConfig).pipe(Po(oe=>{P.component=oe}),Qn(()=>{})))}for(let X of P.children)k.push(...E(X));return k};return af(E(r.targetSnapshot.root)).pipe(Th(null),nl(1))}),UP(()=>this.afterPreactivation()),So(()=>{let{currentSnapshot:r,targetSnapshot:E}=a,P=this.createViewTransition?.(this.environmentInjector,r.root,E.root);return P?go(P).pipe(Qn(()=>a)):Dn(a)}),Qn(r=>{let E=VX(e.routeReuseStrategy,r.targetSnapshot,r.currentRouterState);return this.currentTransition=a=wi(Ht({},r),{targetRouterState:E}),this.currentNavigation.update(P=>(P.targetRouterState=E,P)),a}),Po(()=>{this.events.next(new kx)}),HX(this.rootContexts,e.routeReuseStrategy,r=>this.events.next(r),this.inputBindingEnabled),nl(1),wc(new ki(r=>{let E=a.abortController.signal,P=()=>r.next();return E.addEventListener("abort",P),()=>E.removeEventListener("abort",P)}).pipe(Ao(()=>!d&&!a.targetRouterState),Po(()=>{this.cancelNavigationTransition(a,a.abortController.signal.reason+"",ga.Aborted)}))),Po({next:r=>{d=!0,this.lastSuccessfulNavigation=es(this.currentNavigation),this.events.next(new jl(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects))),this.titleStrategy?.updateTitle(r.targetRouterState.snapshot),r.resolve(!0)},complete:()=>{d=!0}}),wc(this.transitionAbortWithErrorSubject.pipe(Po(r=>{throw r}))),wd(()=>{d||this.cancelNavigationTransition(a,"",ga.SupersededByNewNavigation),this.currentTransition?.id===a.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),tl(r=>{if(this.destroyed)return a.resolve(!1),Da;if(d=!0,i5(r))this.events.next(new Du(a.id,this.urlSerializer.serialize(a.extractedUrl),r.message,r.cancellationCode)),$X(r)?this.events.next(new $_(r.url,r.navigationBehaviorOptions)):a.resolve(!1);else{let E=new U_(a.id,this.urlSerializer.serialize(a.extractedUrl),r,a.targetSnapshot??void 0);try{let P=ys(this.environmentInjector,()=>this.navigationErrorHandler?.(E));if(P instanceof H_){let{message:k,cancellationCode:X}=fS(this.urlSerializer,P);this.events.next(new Du(a.id,this.urlSerializer.serialize(a.extractedUrl),k,X)),this.events.next(new $_(P.redirectTo,P.navigationBehaviorOptions))}else throw this.events.next(E),r}catch(P){this.options.resolveNavigationPromiseOnError?a.resolve(!1):a.reject(P)}}return Da}))}))}cancelNavigationTransition(e,a,d){let r=new Du(e.id,this.urlSerializer.serialize(e.extractedUrl),a,d);this.events.next(r),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),a=es(this.currentNavigation),d=a?.targetBrowserUrl??a?.extractedUrl;return e.toString()!==d?.toString()&&!a?.extras.skipLocationChange}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function kK(i){return i!==z_}var f5=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(FK),providedIn:"root"})}return i})(),gS=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},FK=(()=>{class i extends gS{static \u0275fac=(()=>{let e;return function(d){return(e||(e=Tu(i)))(d||i)}})();static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),m5=(()=>{class i{urlSerializer=Ve(zf);options=Ve($h,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=Ve(Iu);urlHandlingStrategy=Ve(yS);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Au;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:a,targetBrowserUrl:d}){let r=e!==void 0?this.urlHandlingStrategy.merge(e,a):a,E=d??r;return E instanceof Au?this.urlSerializer.serialize(E):E}commitTransition({targetRouterState:e,finalUrl:a,initialUrl:d}){a&&e?(this.currentUrlTree=a,this.rawUrlTree=this.urlHandlingStrategy.merge(a,d),this.routerState=e):this.rawUrlTree=d}routerState=K4(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:()=>Ve(LK),providedIn:"root"})}return i})(),LK=(()=>{class i extends m5{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(a=>{a.type==="popstate"&&setTimeout(()=>{e(a.url,a.state,"popstate")})})}handleRouterEvent(e,a){e instanceof jh?this.updateStateMemento():e instanceof Pu?this.commitTransition(a):e instanceof Rx?this.urlUpdateStrategy==="eager"&&(a.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(a),a)):e instanceof kx?(this.commitTransition(a),this.urlUpdateStrategy==="deferred"&&!a.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(a),a)):e instanceof Du&&e.code!==ga.SupersededByNewNavigation&&e.code!==ga.Redirect?this.restoreHistory(a):e instanceof U_?this.restoreHistory(a,!0):e instanceof jl&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:a,id:d}){let{replaceUrl:r,state:E}=a;if(this.location.isCurrentPathEqualTo(e)||r){let P=this.browserPageId,k=Ht(Ht({},E),this.generateNgRouterState(d,P));this.location.replaceState(e,"",k)}else{let P=Ht(Ht({},E),this.generateNgRouterState(d,this.browserPageId+1));this.location.go(e,"",P)}}restoreHistory(e,a=!1){if(this.canceledNavigationResolution==="computed"){let d=this.browserPageId,r=this.currentPageId-d;r!==0?this.location.historyGo(r):this.getCurrentUrlTree()===e.finalUrl&&r===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(a&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,a){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:a}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(d){return(e||(e=Tu(i)))(d||i)}})();static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function bS(i,n){i.events.pipe(Ao(e=>e instanceof jl||e instanceof Du||e instanceof U_||e instanceof Pu),Qn(e=>e instanceof jl||e instanceof Pu?0:(e instanceof Du?e.code===ga.Redirect||e.code===ga.SupersededByNewNavigation:!1)?2:1),Ao(e=>e!==2),nl(1)).subscribe(()=>{n()})}var NK={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zK={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},bs=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Ve(bE);stateManager=Ve(m5);options=Ve($h,{optional:!0})||{};pendingTasks=Ve(wu);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Ve(xS);urlSerializer=Ve(zf);location=Ve(Iu);urlHandlingStrategy=Ve(yS);injector=Ve(Yr);_events=new li;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Ve(f5);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Ve(Vf,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Ve(jx,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Hr;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(a=>{try{let d=this.navigationTransitions.currentTransition,r=es(this.navigationTransitions.currentNavigation);if(d!==null&&r!==null){if(this.stateManager.handleRouterEvent(a,r),a instanceof Du&&a.code!==ga.Redirect&&a.code!==ga.SupersededByNewNavigation)this.navigated=!0;else if(a instanceof jl)this.navigated=!0;else if(a instanceof $_){let E=a.navigationBehaviorOptions,P=this.urlHandlingStrategy.merge(a.url,d.currentRawUrl),k=Ht({browserUrl:d.extras.browserUrl,info:d.extras.info,skipLocationChange:d.extras.skipLocationChange,replaceUrl:d.extras.replaceUrl||this.urlUpdateStrategy==="eager"||kK(d.source)},E);this.scheduleNavigation(P,z_,null,k,{resolve:d.resolve,reject:d.reject,promise:d.promise})}}LX(a)&&this._events.next(a)}catch(d){this.navigationTransitions.transitionAbortWithErrorSubject.next(d)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),z_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,a,d)=>{this.navigateToSyncWithBrowser(e,d,a)})}navigateToSyncWithBrowser(e,a,d){let r={replaceUrl:!0},E=d?.navigationId?d:null;if(d){let k=Ht({},d);delete k.navigationId,delete k.\u0275routerPageId,Object.keys(k).length!==0&&(r.state=k)}let P=this.parseUrl(e);this.scheduleNavigation(P,a,E,r).catch(k=>{this.disposed||this.injector.get(Gs)(k)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return es(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(oO),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,a={}){let{relativeTo:d,queryParams:r,fragment:E,queryParamsHandling:P,preserveFragment:k}=a,X=k?this.currentUrlTree.fragment:E,oe=null;switch(P??this.options.defaultQueryParamsHandling){case"merge":oe=Ht(Ht({},this.currentUrlTree.queryParams),r);break;case"preserve":oe=this.currentUrlTree.queryParams;break;default:oe=r||null}oe!==null&&(oe=this.removeEmptyProps(oe));let Se;try{let $e=d?d.snapshot:this.routerState.snapshot.root;Se=W4($e)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),Se=this.currentUrlTree.root}return Z4(Se,e,oe,X??null)}navigateByUrl(e,a={skipLocationChange:!1}){let d=Uh(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(r,z_,null,a)}navigate(e,a={skipLocationChange:!1}){return BK(e),this.navigateByUrl(this.createUrlTree(e,a),a)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.console.warn(fu(4018,!1)),this.urlSerializer.parse("/")}}isActive(e,a){let d;if(a===!0?d=Ht({},NK):a===!1?d=Ht({},zK):d=a,Uh(e))return M4(this.currentUrlTree,e,d);let r=this.parseUrl(e);return M4(this.currentUrlTree,r,d)}removeEmptyProps(e){return Object.entries(e).reduce((a,[d,r])=>(r!=null&&(a[d]=r),a),{})}scheduleNavigation(e,a,d,r,E){if(this.disposed)return Promise.resolve(!1);let P,k,X;E?(P=E.resolve,k=E.reject,X=E.promise):X=new Promise((Se,$e)=>{P=Se,k=$e});let oe=this.pendingTasks.add();return bS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(oe))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:r,resolve:P,reject:k,promise:X,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),X.catch(Se=>Promise.reject(Se))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function BK(i){for(let n=0;n<i.length;n++)if(i[n]==null)throw new sn(4008,!1)}var wS=(()=>{class i{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=da(null);get href(){return es(this.reactiveHref)}set href(e){this.reactiveHref.set(e)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new li;applicationErrorHandler=Ve(Gs);options=Ve($h,{optional:!0});constructor(e,a,d,r,E,P){this.router=e,this.route=a,this.tabIndexAttribute=d,this.renderer=r,this.el=E,this.locationStrategy=P,this.reactiveHref.set(Ve(new A_("href"),{optional:!0}));let k=E.nativeElement.tagName?.toLowerCase();this.isAnchorElement=k==="a"||k==="area"||!!(typeof customElements=="object"&&customElements.get(k)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let e=this.preserveFragment,a=d=>d==="merge"||d==="preserve";e||=a(this.queryParamsHandling),e||=!this.queryParamsHandling&&!a(this.options?.defaultQueryParamsHandling),e&&(this.subscription=this.router.events.subscribe(d=>{d instanceof jl&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Uh(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,a,d,r,E){let P=this.urlTree;if(P===null||this.isAnchorElement&&(e!==0||a||d||r||E||typeof this.target=="string"&&this.target!="_self"))return!0;let k={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(P,k)?.catch(X=>{this.applicationErrorHandler(X)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.reactiveHref.set(e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e))??"":null)}applyAttributeValue(e,a){let d=this.renderer,r=this.el.nativeElement;a!==null?d.setAttribute(r,e,a):d.removeAttribute(r,e)}get urlTree(){return this.routerLinkInput===null?null:Uh(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(a){return new(a||i)(Ft(bs),Ft(La),Ky("tabindex"),Ft(Pa),Ft(pr),Ft(Oc))};static \u0275dir=Tr({type:i,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(a,d){a&1&&Ae("click",function(E){return d.onClick(E.button,E.ctrlKey,E.shiftKey,E.altKey,E.metaKey)}),a&2&&Jo("href",d.reactiveHref(),_2)("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Ns],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Ns],replaceUrl:[2,"replaceUrl","replaceUrl",Ns],routerLink:"routerLink"},features:[Gr]})}return i})();var Hx=class{};var g5=(()=>{class i{router;injector;preloadingStrategy;loader;subscription;constructor(e,a,d,r){this.router=e,this.injector=a,this.preloadingStrategy=d,this.loader=r}setUpPreloading(){this.subscription=this.router.events.pipe(Ao(e=>e instanceof jl),pu(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,a){let d=[];for(let r of a){r.providers&&!r._injector&&(r._injector=E_(r.providers,e,`Route: ${r.path}`));let E=r._injector??e,P=r._loadedInjector??E;(r.loadChildren&&!r._loadedRoutes&&r.canLoad===void 0||r.loadComponent&&!r._loadedComponent)&&d.push(this.preloadConfig(E,r)),(r.children||r._loadedRoutes)&&d.push(this.processRoutes(P,r.children??r._loadedRoutes))}return go(d).pipe(t_())}preloadConfig(e,a){return this.preloadingStrategy.preload(a,()=>{let d;a.loadChildren&&a.canLoad===void 0?d=this.loader.loadChildren(e,a):d=Dn(null);let r=d.pipe(zo(E=>E===null?Dn(void 0):(a._loadedRoutes=E.routes,a._loadedInjector=E.injector,this.processRoutes(E.injector??e,E.routes))));if(a.loadComponent&&!a._loadedComponent){let E=this.loader.loadComponent(e,a);return go([r,E]).pipe(t_())}else return r})}static \u0275fac=function(a){return new(a||i)(dn(bs),dn(Yr),dn(Hx),dn(vS))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),_5=new Kt(""),VK=(()=>{class i{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=z_;restoredId=0;store={};constructor(e,a,d,r,E={}){this.urlSerializer=e,this.transitions=a,this.viewportScroller=d,this.zone=r,this.options=E,E.scrollPositionRestoration||="disabled",E.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof jh?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof jl?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Pu&&e.code===V_.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{if(!(e instanceof j_))return;let a={behavior:"instant"};e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],a):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position,a):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(e,a){this.zone.runOutsideAngular(()=>Er(this,null,function*(){yield new Promise(d=>{setTimeout(d),typeof requestAnimationFrame<"u"&&requestAnimationFrame(d)}),this.zone.run(()=>{this.transitions.events.next(new j_(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,a))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(a){k2()};static \u0275prov=Rt({token:i,factory:i.\u0275fac})}return i})();function dO(i,...n){return Cc([{provide:Vf,multi:!0,useValue:i},[],{provide:La,useFactory:v5,deps:[bs]},{provide:ox,multi:!0,useFactory:y5},n.map(e=>e.\u0275providers)])}function v5(i){return i.routerState.root}function Gx(i,n){return{\u0275kind:i,\u0275providers:n}}function y5(){let i=Ve(hr);return n=>{let e=i.get(Oa);if(n!==e.components[0])return;let a=i.get(bs),d=i.get(x5);i.get(hO)===1&&a.initialNavigation(),i.get(C5,null,{optional:!0})?.setUpPreloading(),i.get(_5,null,{optional:!0})?.init(),a.resetRootComponentType(e.componentTypes[0]),d.closed||(d.next(),d.complete(),d.unsubscribe())}}var x5=new Kt("",{factory:()=>new li}),hO=new Kt("",{providedIn:"root",factory:()=>1});function b5(){let i=[{provide:lE,useValue:!0},{provide:hO,useValue:0},CE(()=>{let n=Ve(hr);return n.get(aP,Promise.resolve()).then(()=>new Promise(a=>{let d=n.get(bs),r=n.get(x5);bS(d,()=>{a(!0)}),n.get(xS).afterPreactivation=()=>(a(!0),r.closed?Dn(void 0):r),d.initialNavigation()}))})];return Gx(2,i)}function w5(){let i=[CE(()=>{Ve(bs).setUpLocationChangeListener()}),{provide:hO,useValue:2}];return Gx(3,i)}var C5=new Kt("");function E5(i){return Gx(0,[{provide:C5,useExisting:g5},{provide:Hx,useExisting:i}])}function S5(){return Gx(8,[iO,{provide:jx,useExisting:iO}])}function T5(i){Dc("NgRouterViewTransitions");let n=[{provide:aO,useValue:p5},{provide:lO,useValue:Ht({skipNextTransition:!!i?.skipInitialTransition},i)}];return Gx(9,n)}var I5=[Iu,{provide:zf,useClass:Vh},bs,Bf,{provide:La,useFactory:v5,deps:[bs]},vS,[]],pO=(()=>{class i{constructor(){}static forRoot(e,a){return{ngModule:i,providers:[I5,[],{provide:Vf,multi:!0,useValue:e},[],a?.errorHandler?{provide:cO,useValue:a.errorHandler}:[],{provide:$h,useValue:a||{}},a?.useHash?jK():$K(),UK(),a?.preloadingStrategy?E5(a.preloadingStrategy).\u0275providers:[],a?.initialNavigation?HK(a):[],a?.bindToComponentInputs?S5().\u0275providers:[],a?.enableViewTransitions?T5().\u0275providers:[],GK()]}}static forChild(e){return{ngModule:i,providers:[{provide:Vf,multi:!0,useValue:e}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})();function UK(){return{provide:_5,useFactory:()=>{let i=Ve(s4),n=Ve(yi),e=Ve($h),a=Ve(xS),d=Ve(zf);return e.scrollOffset&&i.setOffset(e.scrollOffset),new VK(d,a,i,n,e)}}}function jK(){return{provide:Oc,useClass:fP}}function $K(){return{provide:Oc,useClass:AE}}function HK(i){return[i.initialNavigation==="disabled"?w5().\u0275providers:[],i.initialNavigation==="enabledBlocking"?b5().\u0275providers:[]]}var uO=new Kt("");function GK(){return[{provide:uO,useFactory:y5},{provide:ox,multi:!0,useExisting:uO}]}var Na=class i{stateSubject=new No(null);state$=this.stateSubject.asObservable();pendingResolve=null;confirm(n){return n.message?(this.pendingResolve&&this.pendingResolve(!1),new Promise(e=>{this.pendingResolve=e,this.stateSubject.next({title:n.title??"Confirm action",message:n.message,confirmText:n.confirmText??"Confirm",cancelText:n.cancelText??"Cancel",tone:n.tone??"accent"})})):Promise.resolve(!1)}resolve(n){this.pendingResolve&&(this.pendingResolve(n),this.pendingResolve=null),this.stateSubject.next(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};function qK(i,n){if(i&1){let e=wt();z(0,"div",1),Ae("click",function(){Me(e);let d=ne();return De(d.onCancel())}),z(1,"div",2),Ae("click",function(d){return Me(e),De(d.stopPropagation())}),z(2,"div",3)(3,"h2"),Z(4),V()(),z(5,"p",4),Z(6),V(),z(7,"div",5)(8,"button",6),Ae("click",function(){Me(e);let d=ne();return De(d.onCancel())}),Z(9),V(),z(10,"button",7),Ae("click",function(){Me(e);let d=ne();return De(d.onConfirm())}),Z(11),V()()()()}if(i&2){let e=n.ngIf;J(4),ct(e.title),J(2),ct(e.message),J(3),Zi(" ",e.cancelText," "),J(),hn("danger",e.tone==="danger"),J(),Zi(" ",e.confirmText," ")}}var ES=class i{constructor(n){this.confirmation=n;this.state$=this.confirmation.state$,this.subscription=this.confirmation.state$.subscribe(e=>{this.isOpen=!!e})}state$;isOpen=!1;subscription;ngOnDestroy(){this.subscription.unsubscribe()}onConfirm(){this.confirmation.resolve(!0)}onCancel(){this.confirmation.resolve(!1)}onEscape(){this.isOpen&&this.onCancel()}static \u0275fac=function(e){return new(e||i)(Ft(Na))};static \u0275cmp=Sn({type:i,selectors:[["app-confirm-dialog"]],hostBindings:function(e,a){e&1&&Ae("keydown.escape",function(){return a.onEscape()},tx)},decls:2,vars:3,consts:[["class","confirm-backdrop",3,"click",4,"ngIf"],[1,"confirm-backdrop",3,"click"],["role","dialog","aria-modal","true",1,"confirm-modal",3,"click"],[1,"confirm-header"],[1,"confirm-message"],[1,"confirm-actions"],["type","button",1,"button","cancel-button",3,"click"],["type","button",1,"button","confirm-button",3,"click"]],template:function(e,a){e&1&&(ji(0,qK,12,6,"div",0),Ls(1,"async")),e&2&&bt("ngIf",M_(1,1,a.state$))},dependencies:[xi,cs,_P],styles:[".confirm-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:100000}.confirm-modal[_ngcontent-%COMP%]{width:min(480px,92vw);background:var(--modal-surface);border-radius:var(--modal-radius);padding:24px;border:var(--modal-border);box-shadow:var(--modal-shadow);animation:_ngcontent-%COMP%_confirmPop .18s ease-out}.confirm-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:22px;font-weight:700}.confirm-message[_ngcontent-%COMP%]{margin:12px 0 0;color:var(--color-white);font-size:15px;line-height:1.5}.confirm-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;flex-wrap:wrap}button.button.cancel-button[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white);box-shadow:none}button.button.cancel-button[_ngcontent-%COMP%]:hover{border-color:var(--color-light-gray);transform:translateY(-1px)}button.button.confirm-button[_ngcontent-%COMP%]{background:var(--color-accent);color:var(--color-black)}button.button.confirm-button.danger[_ngcontent-%COMP%]{background:var(--color-error);color:var(--color-white)}button.button.confirm-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}@keyframes _ngcontent-%COMP%_confirmPop{0%{transform:scale(.98);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width: 640px){.confirm-modal[_ngcontent-%COMP%]{width:calc(100% - 32px);padding:20px;border-radius:var(--modal-radius)}.confirm-actions[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:stretch}}"]})};var SS=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Sn({type:i,selectors:[["app-root"]],decls:2,vars:0,template:function(e,a){e&1&&Rn(0,"router-outlet")(1,"app-confirm-dialog")},dependencies:[Ux,ES],encapsulation:2})};var ul={mapboxToken:"pk.eyJ1IjoiZm5zYnJsIiwiYSI6ImNtaHhqbGUwbDAxeGcyanNjazVybGJtdHYifQ.YxqJwN9S4EposFmNb7igWA",googleClientId:"177987336410-qse83le4nl3i65oat3g2b32kk5sji7sq.apps.googleusercontent.com",googleRedirectUri:"postmessage"};var fv=ww(gO());var TS;function WK(){if(TS===void 0&&(TS=null,typeof window<"u")){let i=window;i.trustedTypes!==void 0&&(TS=i.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return TS}function qx(i){return WK()?.createHTML(i)||i}function D5(i){return Error(`Unable to find icon with the name "${i}"`)}function ZK(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function A5(i){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${i}".`)}function P5(i){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${i}".`)}var Bd=class{url;svgText;options;svgElement;constructor(n,e,a){this.url=n,this.svgText=e,this.options=a}},R5=(()=>{class i{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(e,a,d,r){this._httpClient=e,this._sanitizer=a,this._errorHandler=r,this._document=d}addSvgIcon(e,a,d){return this.addSvgIconInNamespace("",e,a,d)}addSvgIconLiteral(e,a,d){return this.addSvgIconLiteralInNamespace("",e,a,d)}addSvgIconInNamespace(e,a,d,r){return this._addSvgIconConfig(e,a,new Bd(d,null,r))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,a,d,r){let E=this._sanitizer.sanitize(ks.HTML,d);if(!E)throw P5(d);let P=qx(E);return this._addSvgIconConfig(e,a,new Bd("",P,r))}addSvgIconSet(e,a){return this.addSvgIconSetInNamespace("",e,a)}addSvgIconSetLiteral(e,a){return this.addSvgIconSetLiteralInNamespace("",e,a)}addSvgIconSetInNamespace(e,a,d){return this._addSvgIconSetConfig(e,new Bd(a,null,d))}addSvgIconSetLiteralInNamespace(e,a,d){let r=this._sanitizer.sanitize(ks.HTML,a);if(!r)throw P5(a);let E=qx(r);return this._addSvgIconSetConfig(e,new Bd("",E,d))}registerFontClassAlias(e,a=e){return this._fontCssClassesByAlias.set(e,a),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){let a=this._sanitizer.sanitize(ks.RESOURCE_URL,e);if(!a)throw A5(e);let d=this._cachedIconsByUrl.get(a);return d?Dn(IS(d)):this._loadSvgIconFromConfig(new Bd(e,null)).pipe(Po(r=>this._cachedIconsByUrl.set(a,r)),Qn(r=>IS(r)))}getNamedSvgIcon(e,a=""){let d=O5(a,e),r=this._svgIconConfigs.get(d);if(r)return this._getSvgFromConfig(r);if(r=this._getIconConfigFromResolvers(a,e),r)return this._svgIconConfigs.set(d,r),this._getSvgFromConfig(r);let E=this._iconSetConfigs.get(a);return E?this._getSvgFromIconSetConfigs(e,E):bc(D5(d))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Dn(IS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Qn(a=>IS(a)))}_getSvgFromIconSetConfigs(e,a){let d=this._extractIconWithNameFromAnySet(e,a);if(d)return Dn(d);let r=a.filter(E=>!E.svgText).map(E=>this._loadSvgIconSetFromConfig(E).pipe(tl(P=>{let X=`Loading icon set URL: ${this._sanitizer.sanitize(ks.RESOURCE_URL,E.url)} failed: ${P.message}`;return this._errorHandler.handleError(new Error(X)),Dn(null)})));return Sy(r).pipe(Qn(()=>{let E=this._extractIconWithNameFromAnySet(e,a);if(!E)throw D5(e);return E}))}_extractIconWithNameFromAnySet(e,a){for(let d=a.length-1;d>=0;d--){let r=a[d];if(r.svgText&&r.svgText.toString().indexOf(e)>-1){let E=this._svgElementFromConfig(r),P=this._extractSvgIconFromSet(E,e,r.options);if(P)return P}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Po(a=>e.svgText=a),Qn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Dn(null):this._fetchIcon(e).pipe(Po(a=>e.svgText=a))}_extractSvgIconFromSet(e,a,d){let r=e.querySelector(`[id="${a}"]`);if(!r)return null;let E=r.cloneNode(!0);if(E.removeAttribute("id"),E.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(E,d);if(E.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(E),d);let P=this._svgElementFromString(qx("<svg></svg>"));return P.appendChild(E),this._setSvgAttributes(P,d)}_svgElementFromString(e){let a=this._document.createElement("DIV");a.innerHTML=e;let d=a.querySelector("svg");if(!d)throw Error("<svg> tag not found");return d}_toSvgElement(e){let a=this._svgElementFromString(qx("<svg></svg>")),d=e.attributes;for(let r=0;r<d.length;r++){let{name:E,value:P}=d[r];E!=="id"&&a.setAttribute(E,P)}for(let r=0;r<e.childNodes.length;r++)e.childNodes[r].nodeType===this._document.ELEMENT_NODE&&a.appendChild(e.childNodes[r].cloneNode(!0));return a}_setSvgAttributes(e,a){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),a&&a.viewBox&&e.setAttribute("viewBox",a.viewBox),e}_fetchIcon(e){let{url:a,options:d}=e,r=d?.withCredentials??!1;if(!this._httpClient)throw ZK();if(a==null)throw Error(`Cannot fetch icon from URL "${a}".`);let E=this._sanitizer.sanitize(ks.RESOURCE_URL,a);if(!E)throw A5(a);let P=this._inProgressUrlFetches.get(E);if(P)return P;let k=this._httpClient.get(E,{responseType:"text",withCredentials:r}).pipe(Qn(X=>qx(X)),wd(()=>this._inProgressUrlFetches.delete(E)),oD());return this._inProgressUrlFetches.set(E,k),k}_addSvgIconConfig(e,a,d){return this._svgIconConfigs.set(O5(e,a),d),this}_addSvgIconSetConfig(e,a){let d=this._iconSetConfigs.get(e);return d?d.push(a):this._iconSetConfigs.set(e,[a]),this}_svgElementFromConfig(e){if(!e.svgElement){let a=this._svgElementFromString(e.svgText);this._setSvgAttributes(a,e.options),e.svgElement=a}return e.svgElement}_getIconConfigFromResolvers(e,a){for(let d=0;d<this._resolvers.length;d++){let r=this._resolvers[d](a,e);if(r)return YK(r)?new Bd(r.url,null,r.options):new Bd(r,null)}}static \u0275fac=function(a){return new(a||i)(dn(yo,8),dn(NP),dn(si,8),dn(Hs))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function IS(i){return i.cloneNode(!0)}function O5(i,n){return i+":"+n}function YK(i){return!!(i.url&&i.options)}function Wx(i){return i.buttons===0||i.detail===0}function Zx(i){let n=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var _O;function k5(){if(_O==null){let i=typeof document<"u"?document.head:null;_O=!!(i&&(i.createShadowRoot||i.attachShadow))}return _O}function vO(i){if(k5()){let n=i.getRootNode?i.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}function za(i){return i.composedPath?i.composedPath()[0]:i.target}var yO;try{yO=typeof Intl<"u"&&Intl.v8BreakIterator}catch{yO=!1}var ns=(()=>{class i{_platformId=Ve(Mf);isBrowser=this._platformId?o4(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||yO)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Yx;function F5(){if(Yx==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Yx=!0}))}finally{Yx=Yx||!1}return Yx}function Y_(i){return F5()?i:!!i.capture}function Ou(i){return i instanceof pr?i.nativeElement:i}var L5=new Kt("cdk-input-modality-detector-options"),N5={ignoreKeys:[18,17,224,91,16]},z5=650,xO={passive:!0,capture:!0},B5=(()=>{class i{_platform=Ve(ns);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new No(null);_options;_lastTouchMs=0;_onKeydown=e=>{this._options?.ignoreKeys?.some(a=>a===e.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=za(e))};_onMousedown=e=>{Date.now()-this._lastTouchMs<z5||(this._modality.next(Wx(e)?"keyboard":"mouse"),this._mostRecentTarget=za(e))};_onTouchstart=e=>{if(Zx(e)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=za(e)};constructor(){let e=Ve(yi),a=Ve(si),d=Ve(L5,{optional:!0});if(this._options=Ht(Ht({},N5),d),this.modalityDetected=this._modality.pipe(Ty(1)),this.modalityChanged=this.modalityDetected.pipe(cf()),this._platform.isBrowser){let r=Ve(xs).createRenderer(null,null);this._listenerCleanups=e.runOutsideAngular(()=>[r.listen(a,"keydown",this._onKeydown,xO),r.listen(a,"mousedown",this._onMousedown,xO),r.listen(a,"touchstart",this._onTouchstart,xO)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(e=>e())}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Xx=(function(i){return i[i.IMMEDIATE=0]="IMMEDIATE",i[i.EVENTUAL=1]="EVENTUAL",i})(Xx||{}),V5=new Kt("cdk-focus-monitor-default-options"),MS=Y_({passive:!0,capture:!0}),bO=(()=>{class i{_ngZone=Ve(yi);_platform=Ve(ns);_inputModalityDetector=Ve(B5);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=Ve(si);_stopInputModalityDetector=new li;constructor(){let e=Ve(V5,{optional:!0});this._detectionMode=e?.detectionMode||Xx.IMMEDIATE}_rootNodeFocusAndBlurListener=e=>{let a=za(e);for(let d=a;d;d=d.parentElement)e.type==="focus"?this._onFocus(e,d):this._onBlur(e,d)};monitor(e,a=!1){let d=Ou(e);if(!this._platform.isBrowser||d.nodeType!==1)return Dn();let r=vO(d)||this._document,E=this._elementInfo.get(d);if(E)return a&&(E.checkChildren=!0),E.subject;let P={checkChildren:a,subject:new li,rootNode:r};return this._elementInfo.set(d,P),this._registerGlobalListeners(P),P.subject}stopMonitoring(e){let a=Ou(e),d=this._elementInfo.get(a);d&&(d.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(d))}focusVia(e,a,d){let r=Ou(e),E=this._document.activeElement;r===E?this._getClosestElementsInfo(r).forEach(([P,k])=>this._originChanged(P,a,k)):(this._setOrigin(a),typeof r.focus=="function"&&r.focus(d))}ngOnDestroy(){this._elementInfo.forEach((e,a)=>this.stopMonitoring(a))}_getWindow(){return this._document.defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return this._detectionMode===Xx.EVENTUAL||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,a){e.classList.toggle("cdk-focused",!!a),e.classList.toggle("cdk-touch-focused",a==="touch"),e.classList.toggle("cdk-keyboard-focused",a==="keyboard"),e.classList.toggle("cdk-mouse-focused",a==="mouse"),e.classList.toggle("cdk-program-focused",a==="program")}_setOrigin(e,a=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=e,this._originFromTouchInteraction=e==="touch"&&a,this._detectionMode===Xx.IMMEDIATE){clearTimeout(this._originTimeoutId);let d=this._originFromTouchInteraction?z5:1;this._originTimeoutId=setTimeout(()=>this._origin=null,d)}})}_onFocus(e,a){let d=this._elementInfo.get(a),r=za(e);!d||!d.checkChildren&&a!==r||this._originChanged(a,this._getFocusOrigin(r),d)}_onBlur(e,a){let d=this._elementInfo.get(a);!d||d.checkChildren&&e.relatedTarget instanceof Node&&a.contains(e.relatedTarget)||(this._setClasses(a),this._emitOrigin(d,null))}_emitOrigin(e,a){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(a))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;let a=e.rootNode,d=this._rootNodeFocusListenerCount.get(a)||0;d||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,MS),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,MS)}),this._rootNodeFocusListenerCount.set(a,d+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(wc(this._stopInputModalityDetector)).subscribe(r=>{this._setOrigin(r,!0)}))}_removeGlobalListeners(e){let a=e.rootNode;if(this._rootNodeFocusListenerCount.has(a)){let d=this._rootNodeFocusListenerCount.get(a);d>1?this._rootNodeFocusListenerCount.set(a,d-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,MS),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,MS),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,a,d){this._setClasses(e,a),this._emitOrigin(d,a),this._lastFocusOrigin=a}_getClosestElementsInfo(e){let a=[];return this._elementInfo.forEach((d,r)=>{(r===e||d.checkChildren&&r.contains(e))&&a.push([r,d])}),a}_isLastInteractionFromInputLabel(e){let{_mostRecentTarget:a,mostRecentModality:d}=this._inputModalityDetector;if(d!=="mouse"||!a||a===e||e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"||e.disabled)return!1;let r=e.labels;if(r){for(let E=0;E<r.length;E++)if(r[E].contains(a))return!0}return!1}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var DS=new WeakMap,Hh=(()=>{class i{_appRef;_injector=Ve(hr);_environmentInjector=Ve(Yr);load(e){let a=this._appRef=this._appRef||this._injector.get(Oa),d=DS.get(a);d||(d={loaders:new Set,refs:[]},DS.set(a,d),a.onDestroy(()=>{DS.get(a)?.refs.forEach(r=>r.destroy()),DS.delete(a)})),d.loaders.has(e)||(d.loaders.add(e),d.refs.push(IE(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function X_(i){return Array.isArray(i)?i:[i]}var U5=new Set,Uf,AS=(()=>{class i{_platform=Ve(ns);_nonce=Ve(w_,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):KK}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&XK(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function XK(i,n){if(!U5.has(i))try{Uf||(Uf=document.createElement("style"),n&&Uf.setAttribute("nonce",n),Uf.setAttribute("type","text/css"),document.head.appendChild(Uf)),Uf.sheet&&(Uf.sheet.insertRule(`@media ${i} {body{ }}`,0),U5.add(i))}catch(e){console.error(e)}}function KK(i){return{matches:i==="all"||i==="",media:i,addListener:()=>{},removeListener:()=>{}}}var jf=(()=>{class i{_mediaMatcher=Ve(AS);_zone=Ve(yi);_queries=new Map;_destroySubject=new li;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return j5(X_(e)).some(d=>this._registerQuery(d).mql.matches)}observe(e){let d=j5(X_(e)).map(E=>this._registerQuery(E).observable),r=af(d);return r=Sh(r.pipe(nl(1)),r.pipe(Ty(1),n_(0))),r.pipe(Qn(E=>{let P={matches:!1,breakpoints:{}};return E.forEach(({matches:k,query:X})=>{P.matches=P.matches||k,P.breakpoints[X]=k}),P}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);let a=this._mediaMatcher.matchMedia(e),r={observable:new ki(E=>{let P=k=>this._zone.run(()=>E.next(k));return a.addListener(P),()=>{a.removeListener(P)}}).pipe(r_(a),Qn(({matches:E})=>({query:e,matches:E})),wc(this._destroySubject)),mql:a};return this._queries.set(e,r),r}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function j5(i){return i.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}var G5=new Kt("liveAnnouncerElement",{providedIn:"root",factory:q5});function q5(){return null}var W5=new Kt("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),QK=0,CO=(()=>{class i{_ngZone=Ve(yi);_defaultOptions=Ve(W5,{optional:!0});_liveElement;_document=Ve(si);_previousTimeout;_currentPromise;_currentResolve;constructor(){let e=Ve(G5,{optional:!0});this._liveElement=e||this._createLiveElement()}announce(e,...a){let d=this._defaultOptions,r,E;return a.length===1&&typeof a[0]=="number"?E=a[0]:[r,E]=a,this.clear(),clearTimeout(this._previousTimeout),r||(r=d&&d.politeness?d.politeness:"polite"),E==null&&d&&(E=d.duration),this._liveElement.setAttribute("aria-live",r),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(P=>this._currentResolve=P)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,typeof E=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),E)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let e="cdk-live-announcer-element",a=this._document.getElementsByClassName(e),d=this._document.createElement("div");for(let r=0;r<a.length;r++)a[r].remove();return d.classList.add(e),d.classList.add("cdk-visually-hidden"),d.setAttribute("aria-atomic","true"),d.setAttribute("aria-live","polite"),d.id=`cdk-live-announcer-${QK++}`,this._document.body.appendChild(d),d}_exposeAnnouncerToModals(e){let a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<a.length;d++){let r=a[d],E=r.getAttribute("aria-owns");E?E.indexOf(e)===-1&&r.setAttribute("aria-owns",E+" "+e):r.setAttribute("aria-owns",e)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Gh=(function(i){return i[i.NONE=0]="NONE",i[i.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",i[i.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",i})(Gh||{}),$5="cdk-high-contrast-black-on-white",H5="cdk-high-contrast-white-on-black",wO="cdk-high-contrast-active",EO=(()=>{class i{_platform=Ve(ns);_hasCheckedHighContrastMode;_document=Ve(si);_breakpointSubscription;constructor(){this._breakpointSubscription=Ve(jf).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Gh.NONE;let e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);let a=this._document.defaultView||window,d=a&&a.getComputedStyle?a.getComputedStyle(e):null,r=(d&&d.backgroundColor||"").replace(/ /g,"");switch(e.remove(),r){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Gh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Gh.BLACK_ON_WHITE}return Gh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let e=this._document.body.classList;e.remove(wO,$5,H5),this._hasCheckedHighContrastMode=!0;let a=this.getHighContrastMode();a===Gh.BLACK_ON_WHITE?e.add(wO,$5):a===Gh.WHITE_ON_BLACK&&e.add(wO,H5)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var SO={},Kx=(()=>{class i{_appId=Ve(b_);getId(e){return this._appId!=="ng"&&(e+=this._appId),SO.hasOwnProperty(e)||(SO[e]=0),`${e}${SO[e]++}`}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var JK=new Kt("cdk-dir-doc",{providedIn:"root",factory:eQ});function eQ(){return Ve(si)}var tQ=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function nQ(i){let n=i?.toLowerCase()||"";return n==="auto"&&typeof navigator<"u"&&navigator?.language?tQ.test(navigator.language)?"rtl":"ltr":n==="rtl"?"rtl":"ltr"}var Z5=(()=>{class i{get value(){return this.valueSignal()}valueSignal=da("ltr");change=new $t;constructor(){let e=Ve(JK,{optional:!0});if(e){let a=e.body?e.body.dir:null,d=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(nQ(a||d||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var qh=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})();var $l=(()=>{class i{constructor(){Ve(EO)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[qh,qh]})}return i})();var iQ=["*"],rQ=new Kt("MAT_ICON_DEFAULT_OPTIONS"),oQ=new Kt("mat-icon-location",{providedIn:"root",factory:sQ});function sQ(){let i=Ve(si),n=i?i.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}var Y5=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],aQ=Y5.map(i=>`[${i}]`).join(", "),lQ=/^url\(['"]?#(.*?)['"]?\)$/,Di=(()=>{class i{_elementRef=Ve(pr);_iconRegistry=Ve(R5);_location=Ve(oQ);_errorHandler=Ve(Hs);_defaultColor;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(e){let a=this._cleanupFontValue(e);a!==this._fontSet&&(this._fontSet=a,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(e){let a=this._cleanupFontValue(e);a!==this._fontIcon&&(this._fontIcon=a,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Hr.EMPTY;constructor(){let e=Ve(new A_("aria-hidden"),{optional:!0}),a=Ve(rQ,{optional:!0});a&&(a.color&&(this.color=this._defaultColor=a.color),a.fontSet&&(this.fontSet=a.fontSet)),e||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(e){if(!e)return["",""];let a=e.split(":");switch(a.length){case 1:return["",a[0]];case 2:return a;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let e=this._elementsWithExternalReferences;if(e&&e.size){let a=this._location.getPathname();a!==this._previousPath&&(this._previousPath=a,this._prependPathToReferences(a))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();let a=this._location.getPathname();this._previousPath=a,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(a),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){let e=this._elementRef.nativeElement,a=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();a--;){let d=e.childNodes[a];(d.nodeType!==1||d.nodeName.toLowerCase()==="svg")&&d.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let e=this._elementRef.nativeElement,a=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(d=>d.length>0);this._previousFontSetClass.forEach(d=>e.classList.remove(d)),a.forEach(d=>e.classList.add(d)),this._previousFontSetClass=a,this.fontIcon!==this._previousFontIconClass&&!a.includes("mat-ligature-font")&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return typeof e=="string"?e.trim().split(" ")[0]:e}_prependPathToReferences(e){let a=this._elementsWithExternalReferences;a&&a.forEach((d,r)=>{d.forEach(E=>{r.setAttribute(E.name,`url('${e}#${E.value}')`)})})}_cacheChildrenWithExternalReferences(e){let a=e.querySelectorAll(aQ),d=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let r=0;r<a.length;r++)Y5.forEach(E=>{let P=a[r],k=P.getAttribute(E),X=k?k.match(lQ):null;if(X){let oe=d.get(P);oe||(oe=[],d.set(P,oe)),oe.push({name:E,value:X[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){let[a,d]=this._splitIconName(e);a&&(this._svgNamespace=a),d&&(this._svgName=d),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(d,a).pipe(nl(1)).subscribe(r=>this._setSvgElement(r),r=>{let E=`Error retrieving icon ${a}:${d}! ${r.message}`;this._errorHandler.handleError(new Error(E))})}}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(a,d){a&2&&(Jo("data-mat-icon-type",d._usingFontIcon()?"font":"svg")("data-mat-icon-name",d._svgName||d.fontIcon)("data-mat-icon-namespace",d._svgNamespace||d.fontSet)("fontIcon",d._usingFontIcon()?d.fontIcon:null),lx(d.color?"mat-"+d.color:""),hn("mat-icon-inline",d.inline)("mat-icon-no-color",d.color!=="primary"&&d.color!=="accent"&&d.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Ns],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],ngContentSelectors:iQ,decls:1,vars:0,template:function(a,d){a&1&&(Pf(),kd(0))},styles:[`mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
`],encapsulation:2,changeDetection:0})}return i})(),Ai=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[$l,$l]})}return i})();var $f;function X5(){if($f==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return $f=!1,$f;if(document.documentElement?.style&&"scrollBehavior"in document.documentElement.style)$f=!0;else{let i=Element.prototype.scrollTo;i?$f=!/\{\s*\[native code\]\s*\}/.test(i.toString()):$f=!1}}return $f}function TO(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var K5={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var uQ=new Kt("MATERIAL_ANIMATIONS");var Q5=null;function dQ(){return Ve(uQ,{optional:!0})?.animationsDisabled||Ve(Qy,{optional:!0})==="NoopAnimations"?"di-disabled":(Q5??=Ve(AS).matchMedia("(prefers-reduced-motion)").matches,Q5?"reduced-motion":"enabled")}function Hf(){return dQ()!=="enabled"}function $o(i){return i==null?"":typeof i=="string"?i:`${i}px`}var Hl=(function(i){return i[i.FADING_IN=0]="FADING_IN",i[i.VISIBLE=1]="VISIBLE",i[i.FADING_OUT=2]="FADING_OUT",i[i.HIDDEN=3]="HIDDEN",i})(Hl||{}),IO=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Hl.HIDDEN;constructor(n,e,a,d=!1){this._renderer=n,this.element=e,this.config=a,this._animationForciblyDisabledThroughCss=d}fadeOut(){this._renderer.fadeOutRipple(this)}},J5=Y_({passive:!0,capture:!0}),MO=class{_events=new Map;addHandler(n,e,a,d){let r=this._events.get(e);if(r){let E=r.get(a);E?E.add(d):r.set(a,new Set([d]))}else this._events.set(e,new Map([[a,new Set([d])]])),n.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,J5)})}removeHandler(n,e,a){let d=this._events.get(n);if(!d)return;let r=d.get(e);r&&(r.delete(a),r.size===0&&d.delete(e),d.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,J5)))}_delegateEventHandler=n=>{let e=za(n);e&&this._events.get(n.type)?.forEach((a,d)=>{(d===e||d.contains(e))&&a.forEach(r=>r.handleEvent(n))})}},Qx={enterDuration:225,exitDuration:150},pQ=800,eU=Y_({passive:!0,capture:!0}),tU=["mousedown","touchstart"],nU=["mouseup","mouseleave","touchend","touchcancel"],fQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(a,d){},styles:[`.mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}
`],encapsulation:2,changeDetection:0})}return i})(),PS=class i{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new MO;constructor(n,e,a,d,r){this._target=n,this._ngZone=e,this._platform=d,d.isBrowser&&(this._containerElement=Ou(a)),r&&r.get(Hh).load(fQ)}fadeInRipple(n,e,a={}){let d=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=Ht(Ht({},Qx),a.animation);a.centered&&(n=d.left+d.width/2,e=d.top+d.height/2);let E=a.radius||mQ(n,e,d),P=n-d.left,k=e-d.top,X=r.enterDuration,oe=document.createElement("div");oe.classList.add("mat-ripple-element"),oe.style.left=`${P-E}px`,oe.style.top=`${k-E}px`,oe.style.height=`${E*2}px`,oe.style.width=`${E*2}px`,a.color!=null&&(oe.style.backgroundColor=a.color),oe.style.transitionDuration=`${X}ms`,this._containerElement.appendChild(oe);let Se=window.getComputedStyle(oe),$e=Se.transitionProperty,ke=Se.transitionDuration,ht=$e==="none"||ke==="0s"||ke==="0s, 0s"||d.width===0&&d.height===0,Nt=new IO(this,oe,a,ht);oe.style.transform="scale3d(1, 1, 1)",Nt.state=Hl.FADING_IN,a.persistent||(this._mostRecentTransientRipple=Nt);let Mt=null;return!ht&&(X||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xt=()=>{Mt&&(Mt.fallbackTimer=null),clearTimeout(sr),this._finishRippleTransition(Nt)},Vn=()=>this._destroyRipple(Nt),sr=setTimeout(Vn,X+100);oe.addEventListener("transitionend",Xt),oe.addEventListener("transitioncancel",Vn),Mt={onTransitionEnd:Xt,onTransitionCancel:Vn,fallbackTimer:sr}}),this._activeRipples.set(Nt,Mt),(ht||!X)&&this._finishRippleTransition(Nt),Nt}fadeOutRipple(n){if(n.state===Hl.FADING_OUT||n.state===Hl.HIDDEN)return;let e=n.element,a=Ht(Ht({},Qx),n.config.animation);e.style.transitionDuration=`${a.exitDuration}ms`,e.style.opacity="0",n.state=Hl.FADING_OUT,(n._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let e=Ou(n);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,tU.forEach(a=>{i._eventManager.addHandler(this._ngZone,a,e,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{nU.forEach(e=>{this._triggerElement.addEventListener(e,this,eU)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===Hl.FADING_IN?this._startFadeOutTransition(n):n.state===Hl.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let e=n===this._mostRecentTransientRipple,{persistent:a}=n.config;n.state=Hl.VISIBLE,!a&&(!e||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let e=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=Hl.HIDDEN,e!==null&&(n.element.removeEventListener("transitionend",e.onTransitionEnd),n.element.removeEventListener("transitioncancel",e.onTransitionCancel),e.fallbackTimer!==null&&clearTimeout(e.fallbackTimer)),n.element.remove()}_onMousedown(n){let e=Wx(n),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+pQ;!this._target.rippleDisabled&&!e&&!a&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!Zx(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let e=n.changedTouches;if(e)for(let a=0;a<e.length;a++)this.fadeInRipple(e[a].clientX,e[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let e=n.state===Hl.VISIBLE||n.config.terminateOnPointerUp&&n.state===Hl.FADING_IN;!n.config.persistent&&e&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(tU.forEach(e=>i._eventManager.removeHandler(e,n,this)),this._pointerUpEventsRegistered&&(nU.forEach(e=>n.removeEventListener(e,this,eU)),this._pointerUpEventsRegistered=!1))}};function mQ(i,n,e){let a=Math.max(Math.abs(i-e.left),Math.abs(i-e.right)),d=Math.max(Math.abs(n-e.top),Math.abs(n-e.bottom));return Math.sqrt(a*a+d*d)}var iU=new Kt("mat-ripple-global-options");var gQ={capture:!0},_Q=["focus","mousedown","mouseenter","touchstart"],DO="mat-ripple-loader-uninitialized",AO="mat-ripple-loader-class-name",rU="mat-ripple-loader-centered",OS="mat-ripple-loader-disabled",oU=(()=>{class i{_document=Ve(si);_animationsDisabled=Hf();_globalRippleOptions=Ve(iU,{optional:!0});_platform=Ve(ns);_ngZone=Ve(yi);_injector=Ve(hr);_eventCleanups;_hosts=new Map;constructor(){let e=Ve(xs).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>_Q.map(a=>e.listen(this._document,a,this._onInteraction,gQ)))}ngOnDestroy(){let e=this._hosts.keys();for(let a of e)this.destroyRipple(a);this._eventCleanups.forEach(a=>a())}configureRipple(e,a){e.setAttribute(DO,this._globalRippleOptions?.namespace??""),(a.className||!e.hasAttribute(AO))&&e.setAttribute(AO,a.className||""),a.centered&&e.setAttribute(rU,""),a.disabled&&e.setAttribute(OS,"")}setDisabled(e,a){let d=this._hosts.get(e);d?(d.target.rippleDisabled=a,!a&&!d.hasSetUpEvents&&(d.hasSetUpEvents=!0,d.renderer.setupTriggerEvents(e))):a?e.setAttribute(OS,""):e.removeAttribute(OS)}_onInteraction=e=>{let a=za(e);if(a instanceof HTMLElement){let d=a.closest(`[${DO}="${this._globalRippleOptions?.namespace??""}"]`);d&&this._createRipple(d)}};_createRipple(e){if(!this._document||this._hosts.has(e))return;e.querySelector(".mat-ripple")?.remove();let a=this._document.createElement("span");a.classList.add("mat-ripple",e.getAttribute(AO)),e.append(a);let d=this._globalRippleOptions,r=this._animationsDisabled?0:d?.animation?.enterDuration??Qx.enterDuration,E=this._animationsDisabled?0:d?.animation?.exitDuration??Qx.exitDuration,P={rippleDisabled:this._animationsDisabled||d?.disabled||e.hasAttribute(OS),rippleConfig:{centered:e.hasAttribute(rU),terminateOnPointerUp:d?.terminateOnPointerUp,animation:{enterDuration:r,exitDuration:E}}},k=new PS(P,this._ngZone,a,this._platform,this._injector),X=!P.rippleDisabled;X&&k.setupTriggerEvents(e),this._hosts.set(e,{target:P,renderer:k,hasSetUpEvents:X}),e.removeAttribute(DO)}destroyRipple(e){let a=this._hosts.get(e);a&&(a.renderer._removeTriggerEvents(),this._hosts.delete(e))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var sU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["structural-styles"]],decls:0,vars:0,template:function(a,d){},styles:[`.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}
`],encapsulation:2,changeDetection:0})}return i})();var vQ=new Kt("MAT_BUTTON_CONFIG");function aU(i){return i==null?void 0:oP(i)}var lU=(()=>{class i{_elementRef=Ve(pr);_ngZone=Ve(yi);_animationsDisabled=Hf();_config=Ve(vQ,{optional:!0});_focusMonitor=Ve(bO);_cleanupClick;_renderer=Ve(Pa);_rippleLoader=Ve(oU);_isAnchor;_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=e,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;tabIndex;set _tabindex(e){this.tabIndex=e}constructor(){Ve(Hh).load(sU);let e=this._elementRef.nativeElement;this._isAnchor=e.tagName==="A",this.disabledInteractive=this._config?.disabledInteractive??!1,this.color=this._config?.color??null,this._rippleLoader?.configureRipple(e,{className:"mat-mdc-button-ripple"})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0),this._isAnchor&&this._setupAsAnchor()}ngOnDestroy(){this._cleanupClick?.(),this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(e="program",a){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,a):this._elementRef.nativeElement.focus(a)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this._isAnchor?this.disabled||null:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}_getTabIndex(){return this._isAnchor?this.disabled&&!this.disabledInteractive?-1:this.tabIndex:this.tabIndex}_setupAsAnchor(){this._cleanupClick=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"click",e=>{this.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}))}static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,hostAttrs:[1,"mat-mdc-button-base"],hostVars:13,hostBindings:function(a,d){a&2&&(Jo("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled())("tabindex",d._getTabIndex()),lx(d.color?"mat-"+d.color:""),hn("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("mat-unthemed",!d.color)("_mat-animation-noopable",d._animationsDisabled))},inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",Ns],disabled:[2,"disabled","disabled",Ns],ariaDisabled:[2,"aria-disabled","ariaDisabled",Ns],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Ns],tabIndex:[2,"tabIndex","tabIndex",aU],_tabindex:[2,"tabindex","_tabindex",aU]}})}return i})();var cU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[$l,$l]})}return i})();var yQ=["matButton",""],xQ=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],bQ=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var uU=new Map([["text",["mat-mdc-button"]],["filled",["mdc-button--unelevated","mat-mdc-unelevated-button"]],["elevated",["mdc-button--raised","mat-mdc-raised-button"]],["outlined",["mdc-button--outlined","mat-mdc-outlined-button"]],["tonal",["mat-tonal-button"]]]),dU=(()=>{class i extends lU{get appearance(){return this._appearance}set appearance(e){this.setAppearance(e||this._config?.defaultAppearance||"text")}_appearance=null;constructor(){super();let e=wQ(this._elementRef.nativeElement);e&&this.setAppearance(e)}setAppearance(e){if(e===this._appearance)return;let a=this._elementRef.nativeElement.classList,d=this._appearance?uU.get(this._appearance):null,r=uU.get(e);d&&a.remove(...d),a.add(...r),this._appearance=e}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["button","matButton",""],["a","matButton",""],["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""],["a","mat-button",""],["a","mat-raised-button",""],["a","mat-flat-button",""],["a","mat-stroked-button",""]],hostAttrs:[1,"mdc-button"],inputs:{appearance:[0,"matButton","appearance"]},exportAs:["matButton","matAnchor"],features:[Fs],attrs:yQ,ngContentSelectors:bQ,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(a,d){a&1&&(Pf(xQ),Af(0,"span",0),kd(1),T_(2,"span",1),kd(3,1),I_(),kd(4,2),Af(5,"span",2)(6,"span",3)),a&2&&hn("mdc-button__ripple",!d._isFab)("mdc-fab__ripple",d._isFab)},styles:[`.mat-mdc-button-base{text-decoration:none}.mat-mdc-button-base .mat-icon{min-height:fit-content;flex-shrink:0}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-button-text-horizontal-padding, 12px);height:var(--mat-button-text-container-height, 40px);font-family:var(--mat-button-text-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-text-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-text-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-text-label-text-transform);font-weight:var(--mat-button-text-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mat-button-text-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mat-button-text-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-text-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-button-text-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-button-text-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-text-touch-target-size, 48px);display:var(--mat-button-text-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-filled-container-height, 40px);font-family:var(--mat-button-filled-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-filled-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-filled-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-filled-label-text-transform);font-weight:var(--mat-button-filled-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-filled-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-button-filled-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-filled-touch-target-size, 48px);display:var(--mat-button-filled-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mat-button-filled-label-text-color, var(--mat-sys-on-primary));background-color:var(--mat-button-filled-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mat-button-filled-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-filled-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-filled-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mat-button-protected-container-elevation-shadow, var(--mat-sys-level1));height:var(--mat-button-protected-container-height, 40px);font-family:var(--mat-button-protected-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-protected-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-protected-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-protected-label-text-transform);font-weight:var(--mat-button-protected-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-protected-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-button-protected-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-protected-touch-target-size, 48px);display:var(--mat-button-protected-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-raised-button:not(:disabled){color:var(--mat-button-protected-label-text-color, var(--mat-sys-primary));background-color:var(--mat-button-protected-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mat-button-protected-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mat-button-protected-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mat-button-protected-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mat-button-protected-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-protected-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-protected-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mat-button-protected-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-outlined-container-height, 40px);font-family:var(--mat-button-outlined-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-outlined-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-outlined-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-outlined-label-text-transform);font-weight:var(--mat-button-outlined-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mat-button-outlined-container-shape, var(--mat-sys-corner-full));border-width:var(--mat-button-outlined-outline-width, 1px);padding:0 var(--mat-button-outlined-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-button-outlined-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-outlined-touch-target-size, 48px);display:var(--mat-button-outlined-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-outlined-button:not(:disabled){color:var(--mat-button-outlined-label-text-color, var(--mat-sys-primary));border-color:var(--mat-button-outlined-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-outlined-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mat-button-outlined-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-tonal-container-height, 40px);font-family:var(--mat-button-tonal-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-tonal-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-tonal-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-tonal-label-text-transform);font-weight:var(--mat-button-tonal-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-tonal-horizontal-padding, 24px)}.mat-tonal-button:not(:disabled){color:var(--mat-button-tonal-label-text-color, var(--mat-sys-on-secondary-container));background-color:var(--mat-button-tonal-container-color, var(--mat-sys-secondary-container))}.mat-tonal-button,.mat-tonal-button .mdc-button__ripple{border-radius:var(--mat-button-tonal-container-shape, var(--mat-sys-corner-full))}.mat-tonal-button[disabled],.mat-tonal-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-tonal-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-tonal-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-tonal-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}[dir=rtl] .mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}.mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}[dir=rtl] .mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}.mat-tonal-button .mat-ripple-element{background-color:var(--mat-button-tonal-ripple-color, color-mix(in srgb, var(--mat-sys-on-secondary-container) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-tonal-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-tonal-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-tonal-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-tonal-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-tonal-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-tonal-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-tonal-touch-target-size, 48px);display:var(--mat-button-tonal-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button,.mat-tonal-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon,.mat-tonal-button .mdc-button__label,.mat-tonal-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator,.mat-tonal-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before,.mat-tonal-button:focus>.mat-focus-indicator::before{content:"";border-radius:inherit}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable,.mat-tonal-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon,.mat-tonal-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-tonal-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}
`,`@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-button-base.mat-tonal-button,.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}
`],encapsulation:2,changeDetection:0})}return i})();function wQ(i){return i.hasAttribute("mat-raised-button")?"elevated":i.hasAttribute("mat-stroked-button")?"outlined":i.hasAttribute("mat-flat-button")?"filled":i.hasAttribute("mat-button")?"text":null}var hU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[$l,cU,$l]})}return i})();var Jx=class{_attachedHost;attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;n!=null&&(this._attachedHost=null,n.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(n){this._attachedHost=n}},K_=class extends Jx{component;viewContainerRef;injector;projectableNodes;constructor(n,e,a,d){super(),this.component=n,this.viewContainerRef=e,this.injector=a,this.projectableNodes=d}},Q_=class extends Jx{templateRef;viewContainerRef;context;injector;constructor(n,e,a,d){super(),this.templateRef=n,this.viewContainerRef=e,this.context=a,this.injector=d}get origin(){return this.templateRef.elementRef}attach(n,e=this.context){return this.context=e,super.attach(n)}detach(){return this.context=void 0,super.detach()}},PO=class extends Jx{element;constructor(n){super(),this.element=n instanceof pr?n.nativeElement:n}},J_=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(n){if(n instanceof K_)return this._attachedPortal=n,this.attachComponentPortal(n);if(n instanceof Q_)return this._attachedPortal=n,this.attachTemplatePortal(n);if(this.attachDomPortal&&n instanceof PO)return this._attachedPortal=n,this.attachDomPortal(n)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},RS=class extends J_{outletElement;_appRef;_defaultInjector;constructor(n,e,a){super(),this.outletElement=n,this._appRef=e,this._defaultInjector=a}attachComponentPortal(n){let e;if(n.viewContainerRef){let a=n.injector||n.viewContainerRef.injector,d=a.get(Su,null,{optional:!0})||void 0;e=n.viewContainerRef.createComponent(n.component,{index:n.viewContainerRef.length,injector:a,ngModuleRef:d,projectableNodes:n.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else{let a=this._appRef,d=n.injector||this._defaultInjector||hr.NULL,r=d.get(Yr,a.injector);e=IE(n.component,{elementInjector:d,environmentInjector:r,projectableNodes:n.projectableNodes||void 0}),a.attachView(e.hostView),this.setDisposeFn(()=>{a.viewCount>0&&a.detachView(e.hostView),e.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=n,e}attachTemplatePortal(n){let e=n.viewContainerRef,a=e.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return a.rootNodes.forEach(d=>this.outletElement.appendChild(d)),a.detectChanges(),this.setDisposeFn(()=>{let d=e.indexOf(a);d!==-1&&e.remove(d)}),this._attachedPortal=n,a}attachDomPortal=n=>{let e=n.element;e.parentNode;let a=this.outletElement.ownerDocument.createComment("dom-portal");e.parentNode.insertBefore(a,e),this.outletElement.appendChild(e),this._attachedPortal=n,super.setDisposeFn(()=>{a.parentNode&&a.parentNode.replaceChild(e,a)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}};var OO=(()=>{class i extends J_{_moduleRef=Ve(Su,{optional:!0});_document=Ve(si);_viewContainerRef=Ve(ol);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new $t;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);let a=e.viewContainerRef!=null?e.viewContainerRef:this._viewContainerRef,d=a.createComponent(e.component,{index:a.length,injector:e.injector||a.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return a!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);let a=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=a,this.attached.emit(a),a}attachDomPortal=e=>{let a=e.element;a.parentNode;let d=this._document.createComment("dom-portal");e.setAttachedHost(this),a.parentNode.insertBefore(d,a),this._getRootNode().appendChild(a),this._attachedPortal=e,super.setDisposeFn(()=>{d.parentNode&&d.parentNode.replaceChild(a,d)})};_getRootNode(){let e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Fs]})}return i})();var kS=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})();var CQ=20,RO=(()=>{class i{_ngZone=Ve(yi);_platform=Ve(ns);_renderer=Ve(xs).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new li;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let a=this.scrollContainers.get(e);a&&(a.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=CQ){return this._platform.isBrowser?new ki(a=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let d=e>0?this._scrolled.pipe(aC(e)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{d.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Dn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(e,a){let d=this.getAncestorScrollContainers(e);return this.scrolled(a).pipe(Ao(r=>!r||d.indexOf(r)>-1))}getAncestorScrollContainers(e){let a=[];return this.scrollContainers.forEach((d,r)=>{this._scrollableContainsElement(r,e)&&a.push(r)}),a}_scrollableContainsElement(e,a){let d=Ou(a),r=e.getElementRef().nativeElement;do if(d==r)return!0;while(d=d.parentElement);return!1}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var EQ=20,eb=(()=>{class i{_platform=Ve(ns);_listeners;_viewportSize;_change=new li;_document=Ve(si);constructor(){let e=Ve(yi),a=Ve(xs).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let d=r=>this._change.next(r);this._listeners=[a.listen("window","resize",d),a.listen("window","orientationchange",d)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:a,height:d}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+d,right:e.left+a,height:d,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,a=this._getWindow(),d=e.documentElement,r=d.getBoundingClientRect(),E=-r.top||e.body.scrollTop||a.scrollY||d.scrollTop||0,P=-r.left||e.body.scrollLeft||a.scrollX||d.scrollLeft||0;return{top:E,left:P}}change(e=EQ){return e>0?this._change.pipe(aC(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var pU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})(),kO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[qh,pU,qh,pU]})}return i})();var fU=X5();function bU(i){return new FS(i.get(eb),i.get(si))}var FS=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(n,e){this._viewportRuler=n,this._document=e}attach(){}enable(){if(this._canBeEnabled()){let n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=$o(-this._previousScrollPosition.left),n.style.top=$o(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let n=this._document.documentElement,e=this._document.body,a=n.style,d=e.style,r=a.scrollBehavior||"",E=d.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),fU&&(a.scrollBehavior=d.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),fU&&(a.scrollBehavior=r,d.scrollBehavior=E)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let e=this._document.documentElement,a=this._viewportRuler.getViewportSize();return e.scrollHeight>a.height||e.scrollWidth>a.width}};function wU(i,n){return new LS(i.get(RO),i.get(yi),i.get(eb),n)}var LS=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(n,e,a,d){this._scrollDispatcher=n,this._ngZone=e,this._viewportRuler=a,this._config=d}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(this._scrollSubscription)return;let n=this._scrollDispatcher.scrolled(0).pipe(Ao(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{let e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}};var tb=class{enable(){}disable(){}attach(){}};function FO(i,n){return n.some(e=>{let a=i.bottom<e.top,d=i.top>e.bottom,r=i.right<e.left,E=i.left>e.right;return a||d||r||E})}function mU(i,n){return n.some(e=>{let a=i.top<e.top,d=i.bottom>e.bottom,r=i.left<e.left,E=i.right>e.right;return a||d||r||E})}function jS(i,n){return new NS(i.get(RO),i.get(eb),i.get(yi),n)}var NS=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(n,e,a,d){this._scrollDispatcher=n,this._viewportRuler=e,this._ngZone=a,this._config=d}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(!this._scrollSubscription){let n=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(n).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:d}=this._viewportRuler.getViewportSize();FO(e,[{width:a,height:d,bottom:d,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},CU=(()=>{class i{_injector=Ve(hr);constructor(){}noop=()=>new tb;close=e=>wU(this._injector,e);block=()=>bU(this._injector);reposition=e=>jS(this._injector,e);static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ev=class{positionStrategy;scrollStrategy=new tb;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(n){if(n){let e=Object.keys(n);for(let a of e)n[a]!==void 0&&(this[a]=n[a])}}};var zS=class{connectionPair;scrollableViewProperties;constructor(n,e){this.connectionPair=n,this.scrollableViewProperties=e}};var EU=(()=>{class i{_attachedOverlays=[];_document=Ve(si);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){let a=this._attachedOverlays.indexOf(e);a>-1&&this._attachedOverlays.splice(a,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),SU=(()=>{class i extends EU{_ngZone=Ve(yi);_renderer=Ve(xs).createRenderer(null,null);_cleanupKeydown;add(e){super.add(e),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=e=>{let a=this._attachedOverlays;for(let d=a.length-1;d>-1;d--)if(a[d]._keydownEvents.observers.length>0){this._ngZone.run(()=>a[d]._keydownEvents.next(e));break}};static \u0275fac=(()=>{let e;return function(d){return(e||(e=Tu(i)))(d||i)}})();static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),TU=(()=>{class i extends EU{_platform=Ve(ns);_ngZone=Ve(yi);_renderer=Ve(xs).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(e){if(super.add(e),!this._isAttached){let a=this._document.body,d={capture:!0},r=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[r.listen(a,"pointerdown",this._pointerDownListener,d),r.listen(a,"click",this._clickListener,d),r.listen(a,"auxclick",this._clickListener,d),r.listen(a,"contextmenu",this._clickListener,d)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(e=>e()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=e=>{this._pointerDownEventTarget=za(e)};_clickListener=e=>{let a=za(e),d=e.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;let r=this._attachedOverlays.slice();for(let E=r.length-1;E>-1;E--){let P=r[E];if(P._outsidePointerEvents.observers.length<1||!P.hasAttached())continue;if(gU(P.overlayElement,a)||gU(P.overlayElement,d))break;let k=P._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(e)):k.next(e)}};static \u0275fac=(()=>{let e;return function(d){return(e||(e=Tu(i)))(d||i)}})();static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function gU(i,n){let e=typeof ShadowRoot<"u"&&ShadowRoot,a=n;for(;a;){if(a===i)return!0;a=e&&a instanceof ShadowRoot?a.host:a.parentNode}return!1}var IU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(a,d){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}
`],encapsulation:2,changeDetection:0})}return i})(),MU=(()=>{class i{_platform=Ve(ns);_containerElement;_document=Ve(si);_styleLoader=Ve(Hh);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let e="cdk-overlay-container";if(this._platform.isBrowser||TO()){let d=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let r=0;r<d.length;r++)d[r].remove()}let a=this._document.createElement("div");a.classList.add(e),TO()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}_loadStyles(){this._styleLoader.load(IU)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),LO=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(n,e,a,d){this._renderer=e,this._ngZone=a,this.element=n.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=e.listen(this.element,"click",d)}detach(){this._ngZone.runOutsideAngular(()=>{let n=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(n,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),n.style.pointerEvents="none",n.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},BS=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new li;_attachments=new li;_detachments=new li;_positionStrategy;_scrollStrategy;_locationChanges=Hr.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_previousHostParent;_keydownEvents=new li;_outsidePointerEvents=new li;_afterNextRenderRef;constructor(n,e,a,d,r,E,P,k,X,oe=!1,Se,$e){this._portalOutlet=n,this._host=e,this._pane=a,this._config=d,this._ngZone=r,this._keyboardDispatcher=E,this._document=P,this._location=k,this._outsideClickDispatcher=X,this._animationsDisabled=oe,this._injector=Se,this._renderer=$e,d.scrollStrategy&&(this._scrollStrategy=d.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=d.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let e=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=zl(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof e?.onDestroy=="function"&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let n=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){let n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,n&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config=Ht(Ht({},this._config),n),this._updateElementSize()}setDirection(n){this._config=wi(Ht({},this._config),{direction:n}),this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){let n=this._config.direction;return n?typeof n=="string"?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let n=this._pane.style;n.width=$o(this._config.width),n.height=$o(this._config.height),n.minWidth=$o(this._config.minWidth),n.minHeight=$o(this._config.minHeight),n.maxWidth=$o(this._config.maxWidth),n.maxHeight=$o(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){let n="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new LO(this._document,this._renderer,this._ngZone,e=>{this._backdropClick.next(e)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(n))}):this._backdropRef.element.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(n,e,a){let d=X_(e||[]).filter(r=>!!r);d.length&&(a?n.classList.add(...d):n.classList.remove(...d))}_detachContentWhenEmpty(){let n=!1;try{this._detachContentAfterRenderRef=zl(()=>{n=!0,this._detachContent()},{injector:this._injector})}catch(e){if(n)throw e;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let n=this._scrollStrategy;n?.disable(),n?.detach?.()}},_U="cdk-overlay-connected-position-bounding-box",SQ=/([A-Za-z%]+)$/;function DU(i,n){return new VS(n,i.get(eb),i.get(si),i.get(ns),i.get(MU))}var VS=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new li;_resizeSubscription=Hr.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(n,e,a,d,r){this._viewportRuler=e,this._document=a,this._platform=d,this._overlayContainer=r,this.setOrigin(n)}attach(n){this._overlayRef&&this._overlayRef,this._validatePositions(),n.hostElement.classList.add(_U),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let n=this._originRect,e=this._overlayRect,a=this._viewportRect,d=this._containerRect,r=[],E;for(let P of this._preferredPositions){let k=this._getOriginPoint(n,d,P),X=this._getOverlayPoint(k,e,P),oe=this._getOverlayFit(X,e,a,P);if(oe.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(P,k);return}if(this._canFitWithFlexibleDimensions(oe,X,a)){r.push({position:P,origin:k,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(k,P)});continue}(!E||E.overlayFit.visibleArea<oe.visibleArea)&&(E={overlayFit:oe,overlayPoint:X,originPoint:k,position:P,overlayRect:e})}if(r.length){let P=null,k=-1;for(let X of r){let oe=X.boundingBoxRect.width*X.boundingBoxRect.height*(X.position.weight||1);oe>k&&(k=oe,P=X)}this._isPushed=!1,this._applyPosition(P.position,P.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(E.position,E.originPoint);return}this._applyPosition(E.position,E.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Gf(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(_U),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,e)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,n.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,e,a){let d;if(a.originX=="center")d=n.left+n.width/2;else{let E=this._isRtl()?n.right:n.left,P=this._isRtl()?n.left:n.right;d=a.originX=="start"?E:P}e.left<0&&(d-=e.left);let r;return a.originY=="center"?r=n.top+n.height/2:r=a.originY=="top"?n.top:n.bottom,e.top<0&&(r-=e.top),{x:d,y:r}}_getOverlayPoint(n,e,a){let d;a.overlayX=="center"?d=-e.width/2:a.overlayX==="start"?d=this._isRtl()?-e.width:0:d=this._isRtl()?0:-e.width;let r;return a.overlayY=="center"?r=-e.height/2:r=a.overlayY=="top"?0:-e.height,{x:n.x+d,y:n.y+r}}_getOverlayFit(n,e,a,d){let r=yU(e),{x:E,y:P}=n,k=this._getOffset(d,"x"),X=this._getOffset(d,"y");k&&(E+=k),X&&(P+=X);let oe=0-E,Se=E+r.width-a.width,$e=0-P,ke=P+r.height-a.height,ht=this._subtractOverflows(r.width,oe,Se),Nt=this._subtractOverflows(r.height,$e,ke),Mt=ht*Nt;return{visibleArea:Mt,isCompletelyWithinViewport:r.width*r.height===Mt,fitsInViewportVertically:Nt===r.height,fitsInViewportHorizontally:ht==r.width}}_canFitWithFlexibleDimensions(n,e,a){if(this._hasFlexibleDimensions){let d=a.bottom-e.y,r=a.right-e.x,E=vU(this._overlayRef.getConfig().minHeight),P=vU(this._overlayRef.getConfig().minWidth),k=n.fitsInViewportVertically||E!=null&&E<=d,X=n.fitsInViewportHorizontally||P!=null&&P<=r;return k&&X}return!1}_pushOverlayOnScreen(n,e,a){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};let d=yU(e),r=this._viewportRect,E=Math.max(n.x+d.width-r.width,0),P=Math.max(n.y+d.height-r.height,0),k=Math.max(r.top-a.top-n.y,0),X=Math.max(r.left-a.left-n.x,0),oe=0,Se=0;return d.width<=r.width?oe=X||-E:oe=n.x<this._viewportMargin?r.left-a.left-n.x:0,d.height<=r.height?Se=k||-P:Se=n.y<this._viewportMargin?r.top-a.top-n.y:0,this._previousPushAmount={x:oe,y:Se},{x:n.x+oe,y:n.y+Se}}_applyPosition(n,e){if(this._setTransformOrigin(n),this._setOverlayElementStyles(e,n),this._setBoundingBoxStyles(e,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){let a=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!TQ(this._lastScrollVisibility,a)){let d=new zS(n,a);this._positionChanges.next(d)}this._lastScrollVisibility=a}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;let e=this._boundingBox.querySelectorAll(this._transformOriginSelector),a,d=n.overlayY;n.overlayX==="center"?a="center":this._isRtl()?a=n.overlayX==="start"?"right":"left":a=n.overlayX==="start"?"left":"right";for(let r=0;r<e.length;r++)e[r].style.transformOrigin=`${a} ${d}`}_calculateBoundingBoxRect(n,e){let a=this._viewportRect,d=this._isRtl(),r,E,P;if(e.overlayY==="top")E=n.y,r=a.height-E+this._viewportMargin;else if(e.overlayY==="bottom")P=a.height-n.y+this._viewportMargin*2,r=a.height-P+this._viewportMargin;else{let ke=Math.min(a.bottom-n.y+a.top,n.y),ht=this._lastBoundingBoxSize.height;r=ke*2,E=n.y-ke,r>ht&&!this._isInitialRender&&!this._growAfterOpen&&(E=n.y-ht/2)}let k=e.overlayX==="start"&&!d||e.overlayX==="end"&&d,X=e.overlayX==="end"&&!d||e.overlayX==="start"&&d,oe,Se,$e;if(X)$e=a.width-n.x+this._viewportMargin*2,oe=n.x-this._viewportMargin;else if(k)Se=n.x,oe=a.right-n.x;else{let ke=Math.min(a.right-n.x+a.left,n.x),ht=this._lastBoundingBoxSize.width;oe=ke*2,Se=n.x-ke,oe>ht&&!this._isInitialRender&&!this._growAfterOpen&&(Se=n.x-ht/2)}return{top:E,left:Se,bottom:P,right:$e,width:oe,height:r}}_setBoundingBoxStyles(n,e){let a=this._calculateBoundingBoxRect(n,e);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));let d={};if(this._hasExactPosition())d.top=d.left="0",d.bottom=d.right=d.maxHeight=d.maxWidth="",d.width=d.height="100%";else{let r=this._overlayRef.getConfig().maxHeight,E=this._overlayRef.getConfig().maxWidth;d.height=$o(a.height),d.top=$o(a.top),d.bottom=$o(a.bottom),d.width=$o(a.width),d.left=$o(a.left),d.right=$o(a.right),e.overlayX==="center"?d.alignItems="center":d.alignItems=e.overlayX==="end"?"flex-end":"flex-start",e.overlayY==="center"?d.justifyContent="center":d.justifyContent=e.overlayY==="bottom"?"flex-end":"flex-start",r&&(d.maxHeight=$o(r)),E&&(d.maxWidth=$o(E))}this._lastBoundingBoxSize=a,Gf(this._boundingBox.style,d)}_resetBoundingBoxStyles(){Gf(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Gf(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,e){let a={},d=this._hasExactPosition(),r=this._hasFlexibleDimensions,E=this._overlayRef.getConfig();if(d){let oe=this._viewportRuler.getViewportScrollPosition();Gf(a,this._getExactOverlayY(e,n,oe)),Gf(a,this._getExactOverlayX(e,n,oe))}else a.position="static";let P="",k=this._getOffset(e,"x"),X=this._getOffset(e,"y");k&&(P+=`translateX(${k}px) `),X&&(P+=`translateY(${X}px)`),a.transform=P.trim(),E.maxHeight&&(d?a.maxHeight=$o(E.maxHeight):r&&(a.maxHeight="")),E.maxWidth&&(d?a.maxWidth=$o(E.maxWidth):r&&(a.maxWidth="")),Gf(this._pane.style,a)}_getExactOverlayY(n,e,a){let d={top:"",bottom:""},r=this._getOverlayPoint(e,this._overlayRect,n);if(this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,a)),n.overlayY==="bottom"){let E=this._document.documentElement.clientHeight;d.bottom=`${E-(r.y+this._overlayRect.height)}px`}else d.top=$o(r.y);return d}_getExactOverlayX(n,e,a){let d={left:"",right:""},r=this._getOverlayPoint(e,this._overlayRect,n);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,a));let E;if(this._isRtl()?E=n.overlayX==="end"?"left":"right":E=n.overlayX==="end"?"right":"left",E==="right"){let P=this._document.documentElement.clientWidth;d.right=`${P-(r.x+this._overlayRect.width)}px`}else d.left=$o(r.x);return d}_getScrollVisibility(){let n=this._getOriginRect(),e=this._pane.getBoundingClientRect(),a=this._scrollables.map(d=>d.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:mU(n,a),isOriginOutsideView:FO(n,a),isOverlayClipped:mU(e,a),isOverlayOutsideView:FO(e,a)}}_subtractOverflows(n,...e){return e.reduce((a,d)=>a-Math.max(d,0),n)}_getNarrowedViewportRect(){let n=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+n-this._viewportMargin,bottom:a.top+e-this._viewportMargin,width:n-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,e){return e==="x"?n.offsetX==null?this._offsetX:n.offsetX:n.offsetY==null?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&X_(n).forEach(e=>{e!==""&&this._appliedPanelClasses.indexOf(e)===-1&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){let n=this._origin;if(n instanceof pr)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();let e=n.width||0,a=n.height||0;return{top:n.y,bottom:n.y+a,left:n.x,right:n.x+e,height:a,width:e}}};function Gf(i,n){for(let e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i}function vU(i){if(typeof i!="number"&&i!=null){let[n,e]=i.split(SQ);return!e||e==="px"?parseFloat(n):null}return i||null}function yU(i){return{top:Math.floor(i.top),right:Math.floor(i.right),bottom:Math.floor(i.bottom),left:Math.floor(i.left),width:Math.floor(i.width),height:Math.floor(i.height)}}function TQ(i,n){return i===n?!0:i.isOriginClipped===n.isOriginClipped&&i.isOriginOutsideView===n.isOriginOutsideView&&i.isOverlayClipped===n.isOverlayClipped&&i.isOverlayOutsideView===n.isOverlayOutsideView}var xU="cdk-global-overlay-wrapper";function $S(i){return new US}var US=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(n){let e=n.getConfig();this._overlayRef=n,this._width&&!e.width&&n.updateSize({width:this._width}),this._height&&!e.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(xU),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:d,height:r,maxWidth:E,maxHeight:P}=a,k=(d==="100%"||d==="100vw")&&(!E||E==="100%"||E==="100vw"),X=(r==="100%"||r==="100vh")&&(!P||P==="100%"||P==="100vh"),oe=this._xPosition,Se=this._xOffset,$e=this._overlayRef.getConfig().direction==="rtl",ke="",ht="",Nt="";k?Nt="flex-start":oe==="center"?(Nt="center",$e?ht=Se:ke=Se):$e?oe==="left"||oe==="end"?(Nt="flex-end",ke=Se):(oe==="right"||oe==="start")&&(Nt="flex-start",ht=Se):oe==="left"||oe==="start"?(Nt="flex-start",ke=Se):(oe==="right"||oe==="end")&&(Nt="flex-end",ht=Se),n.position=this._cssPosition,n.marginLeft=k?"0":ke,n.marginTop=X?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=k?"0":ht,e.justifyContent=Nt,e.alignItems=X?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,a=e.style;e.classList.remove(xU),a.justifyContent=a.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}},AU=(()=>{class i{_injector=Ve(hr);constructor(){}global(){return $S()}flexibleConnectedTo(e){return DU(this._injector,e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function HS(i,n){i.get(Hh).load(IU);let e=i.get(MU),a=i.get(si),d=i.get(Kx),r=i.get(Oa),E=i.get(Z5),P=a.createElement("div"),k=a.createElement("div");k.id=d.getId("cdk-overlay-"),k.classList.add("cdk-overlay-pane"),P.appendChild(k),e.getContainerElement().appendChild(P);let X=new RS(k,r,i),oe=new ev(n),Se=i.get(Pa,null,{optional:!0})||i.get(xs).createRenderer(null,null);return oe.direction=oe.direction||E.value,new BS(X,P,k,oe,i.get(yi),i.get(SU),a,i.get(Iu),i.get(TU),n?.disableAnimations??i.get(Qy,null,{optional:!0})==="NoopAnimations",i.get(Yr),Se)}var PU=(()=>{class i{scrollStrategies=Ve(CU);_positionBuilder=Ve(AU);_injector=Ve(hr);constructor(){}create(e){return HS(this._injector,e)}position(){return this._positionBuilder}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var IQ=new Kt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let i=Ve(hr);return()=>jS(i)}});function MQ(i){let n=Ve(hr);return()=>jS(n)}var DQ={provide:IQ,useFactory:MQ},NO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({providers:[PU,DQ],imports:[qh,kS,kO,kO]})}return i})();function AQ(i,n){if(i&1){let e=wt();z(0,"div",1)(1,"button",2),Ae("click",function(){Me(e);let d=ne();return De(d.action())}),Z(2),V()()}if(i&2){let e=ne();J(2),Zi(" ",e.data.action," ")}}var PQ=["label"];function OQ(i,n){}var RQ=Math.pow(2,31)-1,nb=class{_overlayRef;instance;containerInstance;_afterDismissed=new li;_afterOpened=new li;_onAction=new li;_durationTimeoutId;_dismissedByAction=!1;constructor(n,e){this._overlayRef=e,this.containerInstance=n,n._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(n){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(n,RQ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},OU=new Kt("MatSnackBarData"),tv=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},kQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return i})(),FQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return i})(),LQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return i})(),RU=(()=>{class i{snackBarRef=Ve(nb);data=Ve(OU);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(a,d){a&1&&(z(0,"div",0),Z(1),V(),Je(2,AQ,3,1,"div",1)),a&2&&(J(),Zi(" ",d.data.message,`
`),J(),et(d.hasAction?2:-1))},dependencies:[dU,kQ,FQ,LQ],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return i})(),zO="_mat-snack-bar-enter",BO="_mat-snack-bar-exit",NQ=(()=>{class i extends J_{_ngZone=Ve(yi);_elementRef=Ve(pr);_changeDetectorRef=Ve(Ac);_platform=Ve(ns);_animationsDisabled=Hf();snackBarConfig=Ve(tv);_document=Ve(si);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=Ve(hr);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new li;_onExit=new li;_onEnter=new li;_animationState="void";_live;_label;_role;_liveElementId=Ve(Kx).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let a=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),a}attachTemplatePortal(e){this._assertNotAttached();let a=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),a}attachDomPortal=e=>{this._assertNotAttached();let a=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),a};onAnimationEnd(e){e===BO?this._completeExit():e===zO&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?zl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(zO)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(zO)},200)))}exit(){return this._destroyed?Dn(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?zl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(BO)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(BO),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,a=this.snackBarConfig.panelClass;a&&(Array.isArray(a)?a.forEach(E=>e.classList.add(E)):e.classList.add(a)),this._exposeToModals();let d=this._label.nativeElement,r="mdc-snackbar__label";d.classList.toggle(r,!d.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<a.length;d++){let r=a[d],E=r.getAttribute("aria-owns");this._trackedModals.add(r),E?E.indexOf(e)===-1&&r.setAttribute("aria-owns",E+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let a=e.getAttribute("aria-owns");if(a){let d=a.replace(this._liveElementId,"").trim();d.length>0?e.setAttribute("aria-owns",d):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,a=e.querySelector("[aria-hidden]"),d=e.querySelector("[aria-live]");if(a&&d){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&a.contains(document.activeElement)&&(r=document.activeElement),a.removeAttribute("aria-hidden"),d.appendChild(a),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Sn({type:i,selectors:[["mat-snack-bar-container"]],viewQuery:function(a,d){if(a&1&&(ka(OO,7),ka(PQ,7)),a&2){let r;pa(r=fa())&&(d._portalOutlet=r.first),pa(r=fa())&&(d._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(a,d){a&1&&Ae("animationend",function(E){return d.onAnimationEnd(E.animationName)})("animationcancel",function(E){return d.onAnimationEnd(E.animationName)}),a&2&&hn("mat-snack-bar-container-enter",d._animationState==="visible")("mat-snack-bar-container-exit",d._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!d._animationsDisabled)},features:[Fs],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(a,d){a&1&&(z(0,"div",1)(1,"div",2,0)(3,"div",3),ji(4,OQ,0,0,"ng-template",4),V(),Rn(5,"div"),V()()),a&2&&(J(5),Jo("aria-live",d._live)("role",d._role)("id",d._liveElementId))},dependencies:[OO],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return i})();function zQ(){return new tv}var BQ=new Kt("mat-snack-bar-default-options",{providedIn:"root",factory:zQ}),Lc=(()=>{class i{_live=Ve(CO);_injector=Ve(hr);_breakpointObserver=Ve(jf);_parentSnackBar=Ve(i,{optional:!0,skipSelf:!0});_defaultConfig=Ve(BQ);_animationsDisabled=Hf();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=RU;snackBarContainerComponent=NQ;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,a){return this._attach(e,a)}openFromTemplate(e,a){return this._attach(e,a)}open(e,a="",d){let r=Ht(Ht({},this._defaultConfig),d);return r.data={message:e,action:a},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,a){let d=a&&a.viewContainerRef&&a.viewContainerRef.injector,r=hr.create({parent:d||this._injector,providers:[{provide:tv,useValue:a}]}),E=new K_(this.snackBarContainerComponent,a.viewContainerRef,r),P=e.attach(E);return P.instance.snackBarConfig=a,P.instance}_attach(e,a){let d=Ht(Ht(Ht({},new tv),this._defaultConfig),a),r=this._createOverlay(d),E=this._attachSnackBarContainer(r,d),P=new nb(E,r);if(e instanceof rl){let k=new Q_(e,null,{$implicit:d.data,snackBarRef:P});P.instance=E.attachTemplatePortal(k)}else{let k=this._createInjector(d,P),X=new K_(e,void 0,k),oe=E.attachComponentPortal(X);P.instance=oe.instance}return this._breakpointObserver.observe(K5.HandsetPortrait).pipe(wc(r.detachments())).subscribe(k=>{r.overlayElement.classList.toggle(this.handsetCssClass,k.matches)}),d.announcementMessage&&E._onAnnounce.subscribe(()=>{this._live.announce(d.announcementMessage,d.politeness)}),this._animateSnackBar(P,d),this._openedSnackBarRef=P,this._openedSnackBarRef}_animateSnackBar(e,a){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),a.announcementMessage&&this._live.clear()}),a.duration&&a.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(a.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let a=new ev;a.direction=e.direction;let d=$S(this._injector),r=e.direction==="rtl",E=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,P=!E&&e.horizontalPosition!=="center";return E?d.left("0"):P?d.right("0"):d.centerHorizontally(),e.verticalPosition==="top"?d.top("0"):d.bottom("0"),a.positionStrategy=d,a.disableAnimations=this._animationsDisabled,HS(this._injector,a)}_createInjector(e,a){let d=e&&e.viewContainerRef&&e.viewContainerRef.injector;return hr.create({parent:d||this._injector,providers:[{provide:nb,useValue:a},{provide:OU,useValue:e.data}]})}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Ru=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({providers:[Lc],imports:[NO,kS,hU,$l,RU,$l]})}return i})();var jU=(()=>{class i{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,a){this._renderer=e,this._elementRef=a}setProperty(e,a){this._renderer.setProperty(this._elementRef.nativeElement,e,a)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(a){return new(a||i)(Ft(Pa),Ft(pr))};static \u0275dir=Tr({type:i})}return i})(),VQ=(()=>{class i extends jU{static \u0275fac=(()=>{let e;return function(d){return(e||(e=Tu(i)))(d||i)}})();static \u0275dir=Tr({type:i,features:[Fs]})}return i})(),$O=new Kt("");var UQ={provide:$O,useExisting:Id(()=>ws),multi:!0};function jQ(){let i=Vl()?Vl().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var $Q=new Kt(""),ws=(()=>{class i extends jU{_compositionMode;_composing=!1;constructor(e,a,d){super(e,a),this._compositionMode=d,this._compositionMode==null&&(this._compositionMode=!jQ())}writeValue(e){let a=e??"";this.setProperty("value",a)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(a){return new(a||i)(Ft(Pa),Ft(pr),Ft($Q,8))};static \u0275dir=Tr({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(a,d){a&1&&Ae("input",function(E){return d._handleInput(E.target.value)})("blur",function(){return d.onTouched()})("compositionstart",function(){return d._compositionStart()})("compositionend",function(E){return d._compositionEnd(E.target.value)})},standalone:!1,features:[Lh([UQ]),Fs]})}return i})();function HO(i){return i==null||GO(i)===0}function GO(i){return i==null?null:Array.isArray(i)||typeof i=="string"?i.length:i instanceof Set?i.size:null}var $U=new Kt(""),HU=new Kt(""),HQ=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ku=class{static min(n){return GQ(n)}static max(n){return qQ(n)}static required(n){return WQ(n)}static requiredTrue(n){return ZQ(n)}static email(n){return YQ(n)}static minLength(n){return XQ(n)}static maxLength(n){return KQ(n)}static pattern(n){return QQ(n)}static nullValidator(n){return GU()}static compose(n){return KU(n)}static composeAsync(n){return JU(n)}};function GQ(i){return n=>{if(n.value==null||i==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e<i?{min:{min:i,actual:n.value}}:null}}function qQ(i){return n=>{if(n.value==null||i==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e>i?{max:{max:i,actual:n.value}}:null}}function WQ(i){return HO(i.value)?{required:!0}:null}function ZQ(i){return i.value===!0?null:{required:!0}}function YQ(i){return HO(i.value)||HQ.test(i.value)?null:{email:!0}}function XQ(i){return n=>{let e=n.value?.length??GO(n.value);return e===null||e===0?null:e<i?{minlength:{requiredLength:i,actualLength:e}}:null}}function KQ(i){return n=>{let e=n.value?.length??GO(n.value);return e!==null&&e>i?{maxlength:{requiredLength:i,actualLength:e}}:null}}function QQ(i){if(!i)return GU;let n,e;return typeof i=="string"?(e="",i.charAt(0)!=="^"&&(e+="^"),e+=i,i.charAt(i.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=i.toString(),n=i),a=>{if(HO(a.value))return null;let d=a.value;return n.test(d)?null:{pattern:{requiredPattern:e,actualValue:d}}}}function GU(i){return null}function qU(i){return i!=null}function WU(i){return Rd(i)?go(i):i}function ZU(i){let n={};return i.forEach(e=>{n=e!=null?Ht(Ht({},n),e):n}),Object.keys(n).length===0?null:n}function YU(i,n){return n.map(e=>e(i))}function JQ(i){return!i.validate}function XU(i){return i.map(n=>JQ(n)?n:e=>n.validate(e))}function KU(i){if(!i)return null;let n=i.filter(qU);return n.length==0?null:function(e){return ZU(YU(e,n))}}function QU(i){return i!=null?KU(XU(i)):null}function JU(i){if(!i)return null;let n=i.filter(qU);return n.length==0?null:function(e){let a=YU(e,n).map(WU);return Sy(a).pipe(Qn(ZU))}}function ej(i){return i!=null?JU(XU(i)):null}function kU(i,n){return i===null?[n]:Array.isArray(i)?[...i,n]:[i,n]}function tj(i){return i._rawValidators}function nj(i){return i._rawAsyncValidators}function VO(i){return i?Array.isArray(i)?i:[i]:[]}function WS(i,n){return Array.isArray(i)?i.includes(n):i===n}function FU(i,n){let e=VO(n);return VO(i).forEach(d=>{WS(e,d)||e.push(d)}),e}function LU(i,n){return VO(n).filter(e=>!WS(i,e))}var ZS=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=QU(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=ej(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},YS=class extends ZS{name;get formDirective(){return null}get path(){return null}},qf=class extends ZS{_parent=null;name=null;valueAccessor=null},XS=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},eJ={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},ITe=wi(Ht({},eJ),{"[class.ng-submitted]":"isSubmitted"}),Ws=(()=>{class i extends XS{constructor(e){super(e)}static \u0275fac=function(a){return new(a||i)(Ft(qf,2))};static \u0275dir=Tr({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(a,d){a&2&&hn("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)},standalone:!1,features:[Fs]})}return i})(),ov=(()=>{class i extends XS{constructor(e){super(e)}static \u0275fac=function(a){return new(a||i)(Ft(YS,10))};static \u0275dir=Tr({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(a,d){a&2&&hn("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)("ng-submitted",d.isSubmitted)},standalone:!1,features:[Fs]})}return i})();var rb="VALID",GS="INVALID",nv="PENDING",ob="DISABLED",Wf=class{},KS=class extends Wf{value;source;constructor(n,e){super(),this.value=n,this.source=e}},sb=class extends Wf{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},ab=class extends Wf{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},iv=class extends Wf{status;source;constructor(n,e){super(),this.status=n,this.source=e}};var lb=class extends Wf{source;constructor(n){super(),this.source=n}};function qO(i){return(eT(i)?i.validators:i)||null}function tJ(i){return Array.isArray(i)?QU(i):i||null}function WO(i,n){return(eT(n)?n.asyncValidators:i)||null}function nJ(i){return Array.isArray(i)?ej(i):i||null}function eT(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function ij(i,n,e){let a=i.controls;if(!(n?Object.keys(a):a).length)throw new sn(1e3,"");if(!a[e])throw new sn(1001,"")}function rj(i,n,e){i._forEachChild((a,d)=>{if(e[d]===void 0)throw new sn(1002,"")})}var rv=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return es(this.statusReactive)}set status(n){es(()=>this.statusReactive.set(n))}_status=dx(()=>this.statusReactive());statusReactive=da(void 0);get valid(){return this.status===rb}get invalid(){return this.status===GS}get pending(){return this.status==nv}get disabled(){return this.status===ob}get enabled(){return this.status!==ob}errors;get pristine(){return es(this.pristineReactive)}set pristine(n){es(()=>this.pristineReactive.set(n))}_pristine=dx(()=>this.pristineReactive());pristineReactive=da(!0);get dirty(){return!this.pristine}get touched(){return es(this.touchedReactive)}set touched(n){es(()=>this.touchedReactive.set(n))}_touched=dx(()=>this.touchedReactive());touchedReactive=da(!1);get untouched(){return!this.touched}_events=new li;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(FU(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(FU(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(LU(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(LU(n,this._rawAsyncValidators))}hasValidator(n){return WS(this._rawValidators,n)}hasAsyncValidator(n){return WS(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let a=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(wi(Ht({},n),{sourceControl:a})),e&&n.emitEvent!==!1&&this._events.next(new ab(!0,a))}markAllAsDirty(n={}){this.markAsDirty({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(n))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let a=n.sourceControl??this;this._forEachChild(d=>{d.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:a})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,a),e&&n.emitEvent!==!1&&this._events.next(new ab(!1,a))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let a=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(wi(Ht({},n),{sourceControl:a})),e&&n.emitEvent!==!1&&this._events.next(new sb(!1,a))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let a=n.sourceControl??this;this._forEachChild(d=>{d.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,a),e&&n.emitEvent!==!1&&this._events.next(new sb(!0,a))}markAsPending(n={}){this.status=nv;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new iv(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(wi(Ht({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=ob,this.errors=null,this._forEachChild(d=>{d.disable(wi(Ht({},n),{onlySelf:!0}))}),this._updateValue();let a=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new KS(this.value,a)),this._events.next(new iv(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(wi(Ht({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(d=>d(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=rb,this._forEachChild(a=>{a.enable(wi(Ht({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(wi(Ht({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let a=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===rb||this.status===nv)&&this._runAsyncValidator(a,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new KS(this.value,e)),this._events.next(new iv(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(wi(Ht({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ob:rb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=nv,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:n!==!1};let a=WU(this.asyncValidator(this));this._asyncValidationSubscription=a.subscribe(d=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(d,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((a,d)=>a&&a._find(d),this)}getError(n,e){let a=e?this.get(e):this;return a&&a.errors?a.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,a){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||a)&&this._events.next(new iv(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,a)}_initObservables(){this.valueChanges=new $t,this.statusChanges=new $t}_calculateStatus(){return this._allControlsDisabled()?ob:this.errors?GS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(nv)?nv:this._anyControlsHaveStatus(GS)?GS:rb}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let a=!this._anyControlsDirty(),d=this.pristine!==a;this.pristine=a,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),d&&this._events.next(new sb(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new ab(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){eT(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=tJ(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=nJ(this._rawAsyncValidators)}},QS=class extends rv{constructor(n,e,a){super(qO(e),WO(a,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,a={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,a={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){rj(this,!0,n),Object.keys(n).forEach(a=>{ij(this,!0,a),this.controls[a].setValue(n[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(a=>{let d=this.controls[a];d&&d.patchValue(n[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((a,d)=>{a.reset(n?n[d]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new lb(this))}getRawValue(){return this._reduceChildren({},(n,e,a)=>(n[a]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,a)=>a._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let a=this.controls[e];a&&n(a,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,a]of Object.entries(this.controls))if(this.contains(e)&&n(a))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,a,d)=>((a.enabled||this.disabled)&&(e[d]=a.value),e))}_reduceChildren(n,e){let a=n;return this._forEachChild((d,r)=>{a=e(a,d,r)}),a}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var UO=class extends QS{};var tT=new Kt("",{providedIn:"root",factory:()=>nT}),nT="always";function iJ(i,n){return[...n.path,i]}function oj(i,n,e=nT){oJ(i,n),n.valueAccessor.writeValue(i.value),(i.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(i.disabled),aJ(i,n),cJ(i,n),lJ(i,n),rJ(i,n)}function NU(i,n,e=!0){let a=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(a),n.valueAccessor.registerOnTouched(a)),sJ(i,n),i&&(n._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function JS(i,n){i.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function rJ(i,n){if(n.valueAccessor.setDisabledState){let e=a=>{n.valueAccessor.setDisabledState(a)};i.registerOnDisabledChange(e),n._registerOnDestroy(()=>{i._unregisterOnDisabledChange(e)})}}function oJ(i,n){let e=tj(i);n.validator!==null?i.setValidators(kU(e,n.validator)):typeof e=="function"&&i.setValidators([e]);let a=nj(i);n.asyncValidator!==null?i.setAsyncValidators(kU(a,n.asyncValidator)):typeof a=="function"&&i.setAsyncValidators([a]);let d=()=>i.updateValueAndValidity();JS(n._rawValidators,d),JS(n._rawAsyncValidators,d)}function sJ(i,n){let e=!1;if(i!==null){if(n.validator!==null){let d=tj(i);if(Array.isArray(d)&&d.length>0){let r=d.filter(E=>E!==n.validator);r.length!==d.length&&(e=!0,i.setValidators(r))}}if(n.asyncValidator!==null){let d=nj(i);if(Array.isArray(d)&&d.length>0){let r=d.filter(E=>E!==n.asyncValidator);r.length!==d.length&&(e=!0,i.setAsyncValidators(r))}}}let a=()=>{};return JS(n._rawValidators,a),JS(n._rawAsyncValidators,a),e}function aJ(i,n){n.valueAccessor.registerOnChange(e=>{i._pendingValue=e,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&sj(i,n)})}function lJ(i,n){n.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&sj(i,n),i.updateOn!=="submit"&&i.markAsTouched()})}function sj(i,n){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function cJ(i,n){let e=(a,d)=>{n.valueAccessor.writeValue(a),d&&n.viewToModelUpdate(a)};i.registerOnChange(e),n._registerOnDestroy(()=>{i._unregisterOnChange(e)})}function aj(i,n){if(!i.hasOwnProperty("model"))return!1;let e=i.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function uJ(i){return Object.getPrototypeOf(i.constructor)===VQ}function lj(i,n){if(!n)return null;Array.isArray(n);let e,a,d;return n.forEach(r=>{r.constructor===ws?e=r:uJ(r)?a=r:d=r}),d||a||e||null}function zU(i,n){let e=i.indexOf(n);e>-1&&i.splice(e,1)}function BU(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var qS=class extends rv{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,a){super(qO(e),WO(a,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),eT(e)&&(e.nonNullable||e.initialValueIsDefault)&&(BU(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(a=>a(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new lb(this))}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){zU(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){zU(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){BU(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var dJ={provide:qf,useExisting:Id(()=>_a)},VU=Promise.resolve(),_a=(()=>{class i extends qf{_changeDetectorRef;callSetDisabledState;control=new qS;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new $t;constructor(e,a,d,r,E,P){super(),this._changeDetectorRef=E,this.callSetDisabledState=P,this._parent=e,this._setValidators(a),this._setAsyncValidators(d),this.valueAccessor=lj(this,r)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let a=e.name.previousValue;this.formDirective.removeControl({name:a,path:this._getPath(a)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),aj(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){oj(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){VU.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let a=e.isDisabled.currentValue,d=a!==0&&Ns(a);VU.then(()=>{d&&!this.control.disabled?this.control.disable():!d&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?iJ(e,this._parent):[e]}static \u0275fac=function(a){return new(a||i)(Ft(YS,9),Ft($U,10),Ft(HU,10),Ft($O,10),Ft(Ac,8),Ft(tT,8))};static \u0275dir=Tr({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Lh([dJ]),Fs,Gr]})}return i})();var sv=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=Tr({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return i})();var cj=new Kt(""),hJ={provide:qf,useExisting:Id(()=>ZO)},ZO=(()=>{class i extends qf{_ngModelWarningConfig;callSetDisabledState;viewModel;form;set isDisabled(e){}model;update=new $t;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,a,d,r,E){super(),this._ngModelWarningConfig=r,this.callSetDisabledState=E,this._setValidators(e),this._setAsyncValidators(a),this.valueAccessor=lj(this,d)}ngOnChanges(e){if(this._isControlChanged(e)){let a=e.form.previousValue;a&&NU(a,this,!1),oj(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}aj(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&NU(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}static \u0275fac=function(a){return new(a||i)(Ft($U,10),Ft(HU,10),Ft($O,10),Ft(cj,8),Ft(tT,8))};static \u0275dir=Tr({type:i,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],standalone:!1,features:[Lh([hJ]),Fs,Gr]})}return i})();var uj=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({})}return i})(),jO=class extends rv{constructor(n,e,a){super(qO(e),WO(a,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){Array.isArray(n)?n.forEach(a=>{this.controls.push(a),this._registerControl(a)}):(this.controls.push(n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,a={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(n,e={}){let a=this._adjustIndex(n);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,a={}){let d=this._adjustIndex(n);d<0&&(d=0),this.controls[d]&&this.controls[d]._registerOnCollectionChange(()=>{}),this.controls.splice(d,1),e&&(this.controls.splice(d,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){rj(this,!1,n),n.forEach((a,d)=>{ij(this,!1,d),this.at(d).setValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((a,d)=>{this.at(d)&&this.at(d).patchValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((a,d)=>{a.reset(n[d],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new lb(this))}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,a)=>a._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,a)=>{n(e,a)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function UU(i){return!!i&&(i.asyncValidators!==void 0||i.validators!==void 0||i.updateOn!==void 0)}var av=(()=>{class i{useNonNullable=!1;get nonNullable(){let e=new i;return e.useNonNullable=!0,e}group(e,a=null){let d=this._reduceControls(e),r={};return UU(a)?r=a:a!==null&&(r.validators=a.validator,r.asyncValidators=a.asyncValidator),new QS(d,r)}record(e,a=null){let d=this._reduceControls(e);return new UO(d,a)}control(e,a,d){let r={};return this.useNonNullable?(UU(a)?r=a:(r.validators=a,r.asyncValidators=d),new qS(e,wi(Ht({},r),{nonNullable:!0}))):new qS(e,a,d)}array(e,a,d){let r=e.map(E=>this._createControl(E));return new jO(r,a,d)}_reduceControls(e){let a={};return Object.keys(e).forEach(d=>{a[d]=this._createControl(e[d])}),a}_createControl(e){if(e instanceof qS)return e;if(e instanceof rv)return e;if(Array.isArray(e)){let a=e[0],d=e.length>1?e[1]:null,r=e.length>2?e[2]:null;return this.control(a,d,r)}else return this.control(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Ba=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:tT,useValue:e.callSetDisabledState??nT}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[uj]})}return i})(),Wh=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:cj,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:tT,useValue:e.callSetDisabledState??nT}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Sr({type:i});static \u0275inj=vr({imports:[uj]})}return i})();var Cs=class i{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/users";getUsers(){return this.http.get(this.apiUrl)}getUserById(n){return this.http.get(`${this.apiUrl}/${n}`)}searchUsers(n){return this.http.get(`${this.apiUrl}/search?q=${n}`)}toggleSavedEvent(n,e){return this.http.post(`${this.apiUrl}/${n}/saved-events/${e}`,{})}followUser(n,e){return this.http.post(`${this.apiUrl}/${n}/follow/${e}`,{})}unfollowUser(n,e){return this.http.delete(`${this.apiUrl}/${n}/follow/${e}`)}isFollowing(n,e){return this.http.get(`${this.apiUrl}/${n}/is-following/${e}?t=${new Date().getTime()}`)}getFollowNotifications(n,e){return this.http.get(`${this.apiUrl}/${n}/follow/${e}/notifications?t=${new Date().getTime()}`)}setFollowNotifications(n,e,a){return this.http.put(`${this.apiUrl}/${n}/follow/${e}/notifications?enabled=${a}`,{})}getFollowers(n){return this.http.get(`${this.apiUrl}/${n}/followers`)}getFollowing(n){return this.http.get(`${this.apiUrl}/${n}/following`)}updateUser(n,e){return this.http.put(`${this.apiUrl}/${n}`,e)}changePassword(n,e,a){return this.http.put(`${this.apiUrl}/${n}/password`,{oldPassword:e,newPassword:a})}userUpdated=new li;userUpdates$=this.userUpdated.asObservable();notifyUserUpdate(){this.userUpdated.next()}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};function pJ(i,n){if(i&1&&(z(0,"p",5),Z(1),V()),i&2){let e=ne();J(),ct(e.distance())}}function fJ(i,n){if(i&1&&(z(0,"p",6),Z(1),V()),i&2){let e=ne();J(),Zi("\u{1F3AB} ",e.maxParticipants()-e.occupiedSpots()," spots left")}}function mJ(i,n){if(i&1){let e=wt();z(0,"div",10),Ae("click",function(d){return Me(e),ne(2).focusLocation.emit(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2,"place"),V()()}}function gJ(i,n){if(i&1&&(z(0,"span",13),Z(1),V()),i&2){let e=ne(4);J(),ct(e.savedCount())}}function _J(i,n){if(i&1){let e=wt();z(0,"div",12),Ae("click",function(d){return Me(e),ne(3).toggleFavorite.emit(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2),V(),Je(3,gJ,2,1,"span",13),V()}if(i&2){let e=ne(3);J(),hn("saved",e.isSaved()),J(),ct(e.isSaved()?"favorite":"favorite_border"),J(),et(e.showSavedCount()&&e.savedCount()!==null&&e.savedCount()!==void 0?3:-1)}}function vJ(i,n){if(i&1&&Je(0,_J,4,4,"div",11),i&2){let e=ne(2);et(e.isParticipating()?-1:0)}}function yJ(i,n){if(i&1){let e=wt();z(0,"div",10),Ae("click",function(d){return Me(e),ne(2).shareEvent.emit(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2,"share"),V()()}}function xJ(i,n){if(i&1&&(z(0,"div",7),Je(1,mJ,3,0,"div",9),Je(2,vJ,1,1),Je(3,yJ,3,0,"div",9),V()),i&2){let e=ne();J(),et(e.showActions()||e.showLocationPin()?1:-1),J(),et(e.showActions()?2:-1),J(),et(e.showShare()?3:-1)}}function bJ(i,n){i&1&&(z(0,"mat-icon"),Z(1,"person"),V())}function wJ(i,n){i&1&&(z(0,"span",17),Z(1,"You are the eventer"),V())}function CJ(i,n){if(i&1){let e=wt();z(0,"button",19),Ae("click",function(d){Me(e);let r=ne(3);return De(r.isFollowing?r.unfollowOrganizer(d):r.followOrganizer(d))}),Z(1),V()}if(i&2){let e=ne(3);hn("following",e.isFollowing),J(),Zi(" ",e.isFollowing?"Following":"Follow"," ")}}function EJ(i,n){if(i&1&&Je(0,wJ,2,0,"span",17)(1,CJ,2,3,"button",18),i&2){let e,a=ne(2);et(((e=a.currentUserId())==null?null:e.toString())===((e=a.creatorId())==null?null:e.toString())?0:1)}}function SJ(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",14),Ae("click",function(d){return Me(e),ne().openOrganizerProfile.emit(),De(d.stopPropagation())}),z(2,"div",15),Je(3,bJ,2,0,"mat-icon"),V(),z(4,"span",16),Z(5),V()(),Je(6,EJ,2,1),V()}if(i&2){let e=ne();J(2),jo("background-image",e.organizerImage()?"url("+e.organizerImage()+")":""),J(),et(e.organizerImage()?-1:3),J(2),ct(e.organizerName()),J(),et(e.currentUserId()&&e.creatorId()?6:-1)}}var Yh=class i{constructor(n){this.userService=n}title=Io.required();location=Io.required();dateTime=Io.required();distance=Io();id=Io.required();isSaved=Io(!1);savedCount=Io(null);isParticipating=Io(!1);showDistance=Io(!0);showActions=Io(!0);showShare=Io(!1);showOrganizerInfo=Io(!0);showSavedCount=Io(!0);showLocationPin=Io(!1);organizerName=Io();organizerImage=Io();creatorId=Io();occupiedSpots=Io();maxParticipants=Io();currentUserId=Io(null);isFollowing=!1;focusLocation=new $t;toggleFavorite=new $t;openOrganizerProfile=new $t;shareEvent=new $t;ngOnInit(){this.checkIfFollowing()}checkIfFollowing(){}followOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.followUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!0},error:e=>console.error("Error following",e)})}unfollowOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.unfollowUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!1},error:e=>console.error("Error unfollowing",e)})}static \u0275fac=function(e){return new(e||i)(Ft(Cs))};static \u0275cmp=Sn({type:i,selectors:[["app-event-card"]],inputs:{title:[1,"title"],location:[1,"location"],dateTime:[1,"dateTime"],distance:[1,"distance"],id:[1,"id"],isSaved:[1,"isSaved"],savedCount:[1,"savedCount"],isParticipating:[1,"isParticipating"],showDistance:[1,"showDistance"],showActions:[1,"showActions"],showShare:[1,"showShare"],showOrganizerInfo:[1,"showOrganizerInfo"],showSavedCount:[1,"showSavedCount"],showLocationPin:[1,"showLocationPin"],organizerName:[1,"organizerName"],organizerImage:[1,"organizerImage"],creatorId:[1,"creatorId"],occupiedSpots:[1,"occupiedSpots"],maxParticipants:[1,"maxParticipants"],currentUserId:[1,"currentUserId"]},outputs:{focusLocation:"focusLocation",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",shareEvent:"shareEvent"},decls:12,vars:7,consts:[[1,"card-container"],[1,"info-section"],[1,"title"],[1,"location"],[1,"date-time"],[1,"distance"],[1,"spots-info"],[1,"actions-section"],[1,"organizer-info"],[1,"icon-circle"],[1,"icon-circle",3,"click"],[1,"icon-circle","favorite-icon"],[1,"icon-circle","favorite-icon",3,"click"],[1,"favorite-count"],[1,"organizer-details","clickable",3,"click"],[1,"organizer-img"],[1,"organizer-name"],[1,"is-organizer-badge"],[1,"follow-btn",3,"following"],[1,"follow-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"h3",2),Z(3),V(),z(4,"p",3),Z(5),V(),z(6,"p",4),Z(7),V(),Je(8,pJ,2,1,"p",5),Je(9,fJ,2,1,"p",6),V(),Je(10,xJ,4,3,"div",7),V(),Je(11,SJ,7,5,"div",8)),e&2&&(J(3),ct(a.title()),J(2),ct(a.location()),J(2),ct(a.dateTime()),J(),et(a.distance()?8:-1),J(),et(a.maxParticipants()&&a.occupiedSpots()!==void 0?9:-1),J(),et(a.showActions()||a.showShare()||a.showLocationPin()?10:-1),J(),et(a.organizerName()&&a.showOrganizerInfo()?11:-1))},dependencies:[xi,Ai,Di],styles:[".card-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);color:var(--color-white)}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.title[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.location[_ngcontent-%COMP%]{margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.date-time[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#888}.distance[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#aaa}.actions-section[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm)}.icon-circle[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:background-color .2s}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:1px;right:1px;min-width:14px;height:14px;padding:0 4px;border-radius:999px;background:#101010e6;border:1px solid rgba(255,255,255,.2);color:var(--color-accent);font-size:8px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#555}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.9)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-light-gray);transition:color .2s ease}.icon-circle[_ngcontent-%COMP%]   mat-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent)}.organizer-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-top:10px;margin-top:10px;border-top:1px solid rgba(255,255,255,.1)}.organizer-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.organizer-details.clickable[_ngcontent-%COMP%]{cursor:pointer}.organizer-details.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-img[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#333;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;overflow:hidden}.organizer-img[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:#ccc}.organizer-name[_ngcontent-%COMP%]{font-size:12px;color:#aaa;font-weight:500}.follow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #1a73e8;color:#1a73e8;border-radius:12px;padding:2px 10px;font-size:11px;cursor:pointer;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{background:#1a73e81a}.follow-btn.following[_ngcontent-%COMP%]{background:#1a73e8;color:#fff;border-color:#1a73e8}.is-organizer-badge[_ngcontent-%COMP%]{font-size:10px;color:#4caf50;background:#4caf501a;padding:2px 6px;border-radius:4px;border:1px solid rgba(76,175,80,.3)}"]})};var Zs=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";getEvents(n){let e=this.baseUrl;return n&&n!=="undefined"&&n!=="null"&&!isNaN(Number(n))&&(e+=`?userId=${n}`),this.http.get(e)}getOrganizedEvents(n){return this.http.get(`${this.baseUrl}/organized?userId=${n}`)}getJoinedEvents(n){return this.http.get(`${this.baseUrl}/joined?userId=${n}`)}toggleSavedEvent(n,e){return this.http.post(`http://localhost:8080/api/users/${n}/saved-events/${e}`,{})}getSavedEvents(n){return this.http.get(`http://localhost:8080/api/users/${n}/saved-events`)}getEventById(n,e){let a=`${this.baseUrl}/${n}`;return e&&(a+=`?userId=${e}`),this.http.get(a)}searchEvents(n){return this.http.get(`${this.baseUrl}/search?q=${n}`)}requestParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participation-request?userId=${e}`,{})}leaveEvent(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/leave`,{})}acceptParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/accept`,{})}rejectParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/reject`,{})}removeParticipant(n,e,a){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/remove?organizerId=${a}`,{})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/${n}`)}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var Fu=class i{constructor(n){this.http=n}apiUrl="https://api.mapbox.com/geocoding/v5/mapbox.places";searchCity(n){let e=`${this.apiUrl}/${encodeURIComponent(n)}.json`,a={access_token:ul.mapboxToken,types:"place,locality",limit:"5",language:"it"};return this.http.get(e,{params:a}).pipe(Qn(d=>d.features&&d.features.length>0?d.features:[]))}reverseGeocode(n,e){let a=`${this.apiUrl}/${e},${n}.json`,d={access_token:ul.mapboxToken,types:"place,locality",limit:"1",language:"it"};return this.http.get(a,{params:d}).pipe(Qn(r=>{let E=r?.features||[],P=E.find(k=>(k.place_type||[]).includes("place"))||E[0];return P?.text||P?.place_name||null}))}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var cb=(i,n)=>n.id;function TJ(i,n){if(i&1){let e=wt();z(0,"mat-icon",12),Ae("click",function(){Me(e);let d=ne(2);return De(d.clearSearch())}),Z(1,"close"),V()}}function IJ(i,n){if(i&1){let e=wt();z(0,"mat-icon",12),Ae("click",function(){Me(e);let d=ne(2);return De(d.onSearch())}),Z(1,"search"),V()}}function MJ(i,n){if(i&1){let e=wt();z(0,"div",7)(1,"input",8),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.searchQuery,d)||(r.searchQuery=d),De(d)}),Ae("keyup.enter",function(){Me(e);let d=ne();return De(d.onSearch())})("ngModelChange",function(d){Me(e);let r=ne();return De(r.onSearchChange(d))}),V(),z(2,"div",9),Je(3,TJ,2,0,"mat-icon",10)(4,IJ,2,0,"mat-icon",10),z(5,"mat-icon",11),Ae("click",function(){Me(e);let d=ne();return d.showFilterOptions=!d.showFilterOptions,d.filterMenuOpen=!1,De(d.sortMenuOpen=!1)}),Z(6,"tune"),V()()()}if(i&2){let e=ne();J(),_o("ngModel",e.searchQuery),J(2),et(e.isSearching?3:4)}}function DJ(i,n){i&1&&(z(0,"mat-icon"),Z(1,"check"),V())}function AJ(i,n){if(i&1){let e=wt();z(0,"button",26),Ae("click",function(d){let r=Me(e).$implicit;return ne(3).selectFilter(r),De(d.stopPropagation())}),z(1,"span"),Z(2),V(),Je(3,DJ,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=ne(3);J(2),ct(a.filterLabels[e]),J(),et(a.filterOption===e?3:-1)}}function PJ(i,n){if(i&1&&(z(0,"div",18),qi(1,AJ,4,2,"button",25,Ra),V()),i&2){let e=ne(2);J(),Wi(e.filterOrder)}}function OJ(i,n){i&1&&(z(0,"mat-icon"),Z(1,"check"),V())}function RJ(i,n){if(i&1){let e=wt();z(0,"button",26),Ae("click",function(d){let r=Me(e).$implicit;return ne(3).selectSort(r),De(d.stopPropagation())}),z(1,"span"),Z(2),V(),Je(3,OJ,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=ne(3);J(2),ct(a.sortLabels[e]),J(),et(a.sortOption===e?3:-1)}}function kJ(i,n){if(i&1&&(z(0,"div",18),qi(1,RJ,4,2,"button",25,Ra),V()),i&2){let e=ne(2);J(),Wi(e.sortOrder)}}function FJ(i,n){if(i&1){let e=wt();z(0,"div",13)(1,"div",14)(2,"div",15),Ae("click",function(){Me(e);let d=ne();return d.filterMenuOpen=!d.filterMenuOpen,De(d.sortMenuOpen=!1)}),z(3,"div",16)(4,"mat-icon"),Z(5,"filter_list"),V(),z(6,"span"),Z(7),V(),z(8,"mat-icon",17),Z(9),V()(),Je(10,PJ,3,0,"div",18),V(),z(11,"div",15),Ae("click",function(){Me(e);let d=ne();return d.sortMenuOpen=!d.sortMenuOpen,De(d.filterMenuOpen=!1)}),z(12,"div",16)(13,"mat-icon"),Z(14,"swap_vert"),V(),z(15,"span"),Z(16),V(),z(17,"mat-icon",17),Z(18),V()(),Je(19,kJ,3,0,"div",18),V()(),z(20,"div",19)(21,"div",20)(22,"span"),Z(23,"Price"),V(),z(24,"span",21),Z(25),V()(),z(26,"div",22)(27,"input",23),Ae("input",function(d){Me(e);let r=ne();return De(r.onPriceMinChange(d.target.value))}),V(),z(28,"input",24),Ae("input",function(d){Me(e);let r=ne();return De(r.onPriceMaxChange(d.target.value))}),V()()(),z(29,"div",19)(30,"div",20)(31,"span"),Z(32,"Distance"),V(),z(33,"span",21),Z(34),V()(),z(35,"div",22)(36,"input",23),Ae("input",function(d){Me(e);let r=ne();return De(r.onDistanceMinChange(d.target.value))}),V(),z(37,"input",24),Ae("input",function(d){Me(e);let r=ne();return De(r.onDistanceMaxChange(d.target.value))}),V()()()()}if(i&2){let e=ne();J(7),ct(e.filterLabels[e.filterOption]),J(2),ct(e.filterMenuOpen?"expand_less":"expand_more"),J(),et(e.filterMenuOpen?10:-1),J(6),ct(e.sortLabels[e.sortOption]),J(2),ct(e.sortMenuOpen?"expand_less":"expand_more"),J(),et(e.sortMenuOpen?19:-1),J(6),ma("\u20AC",e.priceMin.toFixed(0)," - \u20AC",e.priceMax.toFixed(0)),J(),jo("--min-percent",e.priceMinPercent)("--max-percent",e.priceMaxPercent),J(),bt("min",0)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMin),J(),bt("min",e.priceMin)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMax),J(6),ma("",e.distanceMin.toFixed(1)," - ",e.distanceMax.toFixed(1)," km"),J(),jo("--min-percent",e.distanceMinPercent)("--max-percent",e.distanceMaxPercent),J(),bt("min",0)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMin),J(),bt("min",e.distanceMin)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMax)}}function LJ(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Me(e).$implicit,r=ne(4);return De(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function NJ(i,n){if(i&1){let e=wt();z(0,"button",36),Ae("click",function(){Me(e);let d=ne(4);return De(d.showMoreSearch())}),Z(1,"Show more"),V()}}function zJ(i,n){i&1&&(z(0,"div",34),Z(1,"No events found."),V())}function BJ(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),qi(2,LJ,1,14,"app-event-card",32,cb),Ls(4,"slice"),Je(5,NJ,2,0,"button",33),Je(6,zJ,2,0,"div",34),V()()),i&2){let e=ne(3);J(2),Wi(Of(4,2,e.filteredSearchResults,0,e.shownSearch)),J(3),et(e.shownSearch<e.filteredSearchResults.length?5:-1),J(),et(e.filteredSearchResults.length===0?6:-1)}}function VJ(i,n){if(i&1){let e=wt();z(0,"div",38),Ae("click",function(){let d=Me(e).$implicit,r=ne(4);return De(r.selectCity(d))}),z(1,"div",39)(2,"mat-icon"),Z(3,"location_on"),V()(),z(4,"div",40)(5,"span",41),Z(6),V()()()}if(i&2){let e=n.$implicit;J(6),ct(e.name)}}function UJ(i,n){i&1&&(z(0,"div",34),Z(1,"No places found."),V())}function jJ(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),qi(2,VJ,7,1,"div",37,Ra),V(),Je(4,UJ,2,0,"div",34),V()),i&2){let e=ne(3);J(2),Wi(e.cityResults),J(2),et(e.cityResults.length===0?4:-1)}}function $J(i,n){i&1&&(z(0,"mat-icon"),Z(1,"person"),V())}function HJ(i,n){if(i&1){let e=wt();z(0,"div",43),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne(4);return E.followingMap[r.id]?E.unfollowUser(r,d):E.followUser(r,d),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2),V()()}if(i&2){let e=ne().$implicit,a=ne(4);hn("following",a.followingMap[e.id]),J(2),ct(a.followingMap[e.id]?"person":"person_add")}}function GJ(i,n){if(i&1){let e=wt();z(0,"div",38),Ae("click",function(){let d=Me(e).$implicit,r=ne(4);return De(r.openUserProfile.emit(d.id.toString()))}),z(1,"div",39),Je(2,$J,2,0,"mat-icon"),V(),z(3,"div",40)(4,"span",41),Z(5),V()(),Je(6,HJ,3,3,"div",42),V()}if(i&2){let e=n.$implicit,a=ne(4);J(),jo("background-image",e.profileImage?"url("+e.profileImage+")":"")("background-size","cover"),J(),et(e.profileImage?-1:2),J(3),ct(e.name),J(),et(a.userId&&a.userId.toString()!==e.id.toString()?6:-1)}}function qJ(i,n){i&1&&(z(0,"div",34),Z(1,"No creators found."),V())}function WJ(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),qi(2,GJ,7,7,"div",37,Ra),V(),Je(4,qJ,2,0,"div",34),V()),i&2){let e=ne(3);J(2),Wi(e.userResults),J(2),et(e.userResults.length===0?4:-1)}}function ZJ(i,n){if(i&1){let e=wt();z(0,"div",28)(1,"button",29),Ae("click",function(){Me(e);let d=ne(2);return De(d.setActiveTab("events"))}),Z(2," EVENTS "),V(),z(3,"button",29),Ae("click",function(){Me(e);let d=ne(2);return De(d.setActiveTab("places"))}),Z(4," PLACES "),V(),z(5,"button",29),Ae("click",function(){Me(e);let d=ne(2);return De(d.setActiveTab("creators"))}),Z(6," CREATORS "),V()(),Je(7,BJ,7,6,"div",30),Je(8,jJ,5,1,"div",30),Je(9,WJ,5,1,"div",30)}if(i&2){let e=ne(2);J(),hn("active",e.activeTab==="events"),J(2),hn("active",e.activeTab==="places"),J(2),hn("active",e.activeTab==="creators"),J(2),et(e.activeTab==="events"?7:-1),J(),et(e.activeTab==="places"?8:-1),J(),et(e.activeTab==="creators"?9:-1)}}function YJ(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Me(e).$implicit,r=ne(4);return De(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function XJ(i,n){if(i&1){let e=wt();z(0,"button",36),Ae("click",function(){Me(e);let d=ne(4);return De(d.showMoreFound())}),Z(1," Show more"),V()}}function KJ(i,n){i&1&&(z(0,"div",34),Z(1,"No events found in your area."),V())}function QJ(i,n){if(i&1&&(z(0,"div",30)(1,"h2",44),Z(2,"FOUND EVENTS"),V(),z(3,"div",31),qi(4,YJ,1,14,"app-event-card",32,cb),Ls(6,"slice"),Je(7,XJ,2,0,"button",33),Je(8,KJ,2,0,"div",34),V()()),i&2){let e=ne(3);J(4),Wi(Of(6,2,e.filteredFoundEvents,0,e.shownFound)),J(3),et(e.shownFound<e.filteredFoundEvents.length?7:-1),J(),et(e.filteredFoundEvents.length===0?8:-1)}}function JJ(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Me(e).$implicit,r=ne(4);return De(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!0)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function eee(i,n){if(i&1){let e=wt();z(0,"button",36),Ae("click",function(){Me(e);let d=ne(4);return De(d.showMoreFollowUp())}),Z(1,"Show more"),V()}}function tee(i,n){i&1&&(z(0,"div",34),Z(1,"No upcoming events you are participating in."),V())}function nee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Me(e).$implicit,r=ne(4);return De(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function iee(i,n){if(i&1){let e=wt();z(0,"button",36),Ae("click",function(){Me(e);let d=ne(4);return De(d.showMoreSaved())}),Z(1," Show more"),V()}}function ree(i,n){i&1&&(z(0,"div",34),Z(1,"You haven't saved any events yet."),V())}function oee(i,n){if(i&1){let e=wt();z(0,"app-event-card",46),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Me(e).$implicit,r=ne(4);return De(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function see(i,n){if(i&1){let e=wt();z(0,"button",36),Ae("click",function(){Me(e);let d=ne(4);return De(d.showMoreDiscover())}),Z(1,"Show more"),V()}}function aee(i,n){i&1&&(z(0,"div",34),Z(1,"No new events to discover at the moment."),V())}function lee(i,n){if(i&1&&(z(0,"div",30)(1,"h2",44),Z(2,"FOLLOW UP EVENTS"),V(),z(3,"div",31),qi(4,JJ,1,14,"app-event-card",32,cb),Ls(6,"slice"),Je(7,eee,2,0,"button",33),Je(8,tee,2,0,"div",34),V()(),z(9,"div",30)(10,"h2",44),Z(11,"SAVED EVENTS"),V(),z(12,"div",31),qi(13,nee,1,17,"app-event-card",32,cb),Ls(15,"slice"),Je(16,iee,2,0,"button",33),Je(17,ree,2,0,"div",34),V()(),z(18,"div",30)(19,"h2",44),Z(20,"DISCOVER EVENTS"),V(),z(21,"div",31),qi(22,oee,1,13,"app-event-card",45,cb),Ls(24,"slice"),Je(25,see,2,0,"button",33),Je(26,aee,2,0,"div",34),V()()),i&2){let e=ne(3);J(4),Wi(Of(6,6,e.filteredFollowUpEvents,0,e.shownFollowUp)),J(3),et(e.shownFollowUp<e.filteredFollowUpEvents.length?7:-1),J(),et(e.filteredFollowUpEvents.length===0?8:-1),J(5),Wi(Of(15,10,e.filteredSavedEvents,0,e.shownSaved)),J(3),et(e.shownSaved<e.filteredSavedEvents.length?16:-1),J(),et(e.filteredSavedEvents.length===0?17:-1),J(5),Wi(Of(24,14,e.filteredDiscoverEvents,0,e.shownDiscover)),J(3),et(e.shownDiscover<e.filteredDiscoverEvents.length?25:-1),J(),et(e.filteredDiscoverEvents.length===0?26:-1)}}function cee(i,n){if(i&1&&Je(0,QJ,9,6,"div",30)(1,lee,27,18),i&2){let e=ne(2);et(e.userId?1:0)}}function uee(i,n){if(i&1&&(z(0,"div",27),Je(1,ZJ,10,9)(2,cee,2,1),V()),i&2){let e=ne();hn("search-mode",e.isSearching),J(),et(e.isSearching?1:2)}}var ub=class i{constructor(n,e,a){this.eventService=n;this.mapboxService=e;this.userService=a}events=[];focusEvent=new $t;collapsed=!1;userId=null;toggleSidebar=new $t;toggleFavorite=new $t;foundLocation=new $t;openUserProfile=new $t;shareEvent=new $t;searchQuery="";searchResults=[];cityResults=[];userResults=[];activeTab="events";isSearching=!1;followingMap={};showFilterOptions=!1;followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filteredFollowUpEvents=[];filteredSavedEvents=[];filteredDiscoverEvents=[];filteredFoundEvents=[];filteredSearchResults=[];shownFollowUp=3;shownSaved=3;shownDiscover=3;shownFound=3;shownSearch=3;filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};searchInput$=new li;searchSub;ngOnInit(){this.searchSub=this.searchInput$.pipe(n_(300),cf()).subscribe(n=>{let e=n?.trim()||"";if(!e){this.clearSearch();return}this.onSearchInternal(e)})}ngOnDestroy(){this.searchSub?.unsubscribe()}get isFiltering(){return this.filterOption!=="all"}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};ngOnChanges(n){(n.events||n.userId)&&this.categorizeEvents()}showMoreFollowUp(){this.shownFollowUp+=3}showMoreSaved(){this.shownSaved+=3}showMoreDiscover(){this.shownDiscover+=3}showMoreFound(){this.shownFound+=3}showMoreSearch(){this.shownSearch+=3}categorizeEvents(){if(this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent),this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.applyFilters();return}this.eventService.getJoinedEvents(this.userId).subscribe({next:a=>{let d=a.filter(this.isFutureEvent);d.sort((r,E)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`),k=new Date(`${E.date}T${E.startTime||"00:00"}`);return P.getTime()-k.getTime()}),this.followUpEvents=d,this.applyFilters()},error:a=>console.error("Error fetching follow up events",a)});let n=[],e=[];this.events.filter(this.isFutureEvent).forEach(a=>{let d=!1,r=a.isParticipating||!1;a.isSaved&&!r&&(d=!0),d&&n.push(a),!r&&!d&&e.push(a)}),this.savedEvents=n,this.discoverEvents=e,this.foundEvents=[],this.applyFilters()}updateRangeLimits(){let n=this.events.map(X=>X.costPerPerson??0),e=n.length?Math.max(...n):0,a=Math.max(10,Math.ceil(e)),d=this.events.map(X=>X.distanceKm).filter(X=>typeof X=="number"&&!Number.isNaN(X)),r=d.length?Math.max(...d):0,E=Math.max(5,Math.ceil(r)),P=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=a,(P||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let k=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=E,(k||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(){this.filteredFoundEvents=this.filterAndSortList(this.foundEvents),this.filteredFollowUpEvents=this.filterAndSortList(this.followUpEvents),this.filteredSavedEvents=this.filterAndSortList(this.savedEvents),this.filteredDiscoverEvents=this.filterAndSortList(this.discoverEvents),this.filteredSearchResults=this.filterAndSortList(this.searchResults)}filterAndSortList(n){let e=[...n];switch(this.filterOption){case"participating":e=e.filter(r=>!!r.isParticipating);break;case"free":e=e.filter(r=>r.costPerPerson==null||r.costPerPerson===0);break;case"available":e=e.filter(r=>r.nPartecipants==null||r.occupiedSpots==null?!0:r.nPartecipants-r.occupiedSpots>0);break;default:break}switch((this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(e=e.filter(r=>{let E=r.costPerPerson??0;return E>=this.priceMin&&E<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(e=e.filter(r=>{let E=r.distanceKm;return E==null?!1:E>=this.distanceMin&&E<=this.distanceMax})),this.sortOption){case"distance":e.sort((r,E)=>{let P=r.distanceKm??Number.MAX_SAFE_INTEGER,k=E.distanceKm??Number.MAX_SAFE_INTEGER;return P-k});break;case"name":e.sort((r,E)=>(r.title||"").localeCompare(E.title||"","it"));break;case"date":default:e.sort((r,E)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`).getTime(),k=new Date(`${E.date}T${E.startTime||"00:00"}`).getTime();return P-k});break}return e}cycleFilter(){let n=this.filterOrder.indexOf(this.filterOption);this.filterOption=this.filterOrder[(n+1)%this.filterOrder.length],this.applyFilters()}cycleSort(){let n=this.sortOrder.indexOf(this.sortOption);this.sortOption=this.sortOrder[(n+1)%this.sortOrder.length],this.applyFilters()}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1,this.applyFilters()}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1,this.applyFilters()}get priceMinPercent(){return this.priceMaxLimit?`${this.priceMin/this.priceMaxLimit*100}%`:"0%"}get priceMaxPercent(){return this.priceMaxLimit?`${this.priceMax/this.priceMaxLimit*100}%`:"100%"}get distanceMinPercent(){return this.distanceMaxLimit?`${this.distanceMin/this.distanceMaxLimit*100}%`:"0%"}get distanceMaxPercent(){return this.distanceMaxLimit?`${this.distanceMax/this.distanceMaxLimit*100}%`:"100%"}onPriceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(e)?this.priceMin:e,this.applyFilters()}onPriceMaxChange(n){let e=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(e)?this.priceMax:e,this.applyFilters()}onDistanceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(e)?this.distanceMin:e,this.applyFilters()}onDistanceMaxChange(n){let e=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(e)?this.distanceMax:e,this.applyFilters()}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=a&&d?`${a} - ${d}`:a||d;return[r,E].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}goToEvent(n){this.focusEvent.emit(n)}toggle(){this.toggleSidebar.emit()}onSearchChange(n){this.searchQuery=n,this.searchInput$.next(n)}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.onSearchInternal(this.searchQuery.trim())}onSearchInternal(n){this.isSearching=!0,this.eventService.searchEvents(n).subscribe(e=>{this.searchResults=e.filter(this.isFutureEvent),this.applyFilters()}),this.mapboxService.searchCity(n).subscribe(e=>{this.cityResults=e.map(a=>({name:a.place_name,center:a.center}))}),this.userService.searchUsers(n).subscribe(e=>{this.userResults=e,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(e=>{this.followingMap[n.id]=e.isFollowing})})}followUser(n,e){e.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,e){e.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}setActiveTab(n){this.activeTab=n}selectCity(n){if(n){let[e,a]=n.center;this.foundLocation.emit({lat:a,lng:e})}}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[],this.activeTab="events",this.applyFilters()}isMobileOrTablet(){return window.innerWidth<=1024}static \u0275fac=function(e){return new(e||i)(Ft(Zs),Ft(Fu),Ft(Cs))};static \u0275cmp=Sn({type:i,selectors:[["app-sidebar"]],inputs:{events:"events",collapsed:"collapsed",userId:"userId"},outputs:{focusEvent:"focusEvent",toggleSidebar:"toggleSidebar",toggleFavorite:"toggleFavorite",foundLocation:"foundLocation",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Gr],decls:10,vars:6,consts:[[1,"sidebar-container"],[1,"header"],[1,"logo"],[1,"collapse-toggle",3,"click"],["class","search-container",4,"ngIf"],["class","filter-sort",4,"ngIf"],["class","sections-container",3,"search-mode",4,"ngIf"],[1,"search-container"],["type","text","placeholder","Search city, events or user",1,"search-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-actions"],[1,"search-icon","clickable"],[1,"options-icon","clickable",3,"click"],[1,"search-icon","clickable",3,"click"],[1,"filter-sort"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs","dual"],["type","range",1,"min-range",3,"input","min","max","step","value"],["type","range",1,"max-range",3,"input","min","max","step","value"],[1,"menu-item"],[1,"menu-item",3,"click"],[1,"sections-container"],[1,"tabs-header"],[1,"tab-btn",3,"click"],[1,"events-section"],[1,"events-list"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"show-more-btn"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"show-more-btn",3,"click"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle","small"],[1,"loc-info"],[1,"loc-name"],[1,"icon-circle","follow-icon",3,"following"],[1,"icon-circle","follow-icon",3,"click"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"h1",2),Z(3,"LUMO"),V(),z(4,"button",3),Ae("click",function(){return a.toggle()}),z(5,"mat-icon"),Z(6),V()()(),ji(7,MJ,7,2,"div",4)(8,FJ,38,34,"div",5)(9,uee,3,3,"div",6),V()),e&2&&(hn("collapsed",a.collapsed),J(6),ct(a.collapsed?"chevron_right":"chevron_left"),J(),bt("ngIf",!a.collapsed),J(),bt("ngIf",!a.collapsed&&a.showFilterOptions),J(),bt("ngIf",!a.collapsed))},dependencies:[xi,cs,Ba,ws,Ws,_a,Ai,Di,Yh,yP],styles:['.sidebar-container[_ngcontent-%COMP%]{width:360px;max-width:90vw;height:calc(100vh - 40px);background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);display:flex;flex-direction:column;gap:24px;padding:24px;border-radius:24px;box-shadow:4px 0 12px #0000004d;border:1px solid var(--color-light-gray);color:var(--color-white);position:absolute;top:20px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:auto;height:72px;overflow:hidden;padding:24px;justify-content:center;border-radius:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:14px;font-weight:700;margin:0 0 16px;text-transform:uppercase;letter-spacing:.5px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{gap:10px;justify-content:space-between;width:100%;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block;font-size:24px}.logo[_ngcontent-%COMP%]{color:var(--color-accent);font-size:24px;font-weight:900;margin:0;padding:0;letter-spacing:1px;text-shadow:none}.search-container[_ngcontent-%COMP%]{position:relative}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px 64px 12px 16px;background-color:var(--color-gray);border:1px solid rgba(255,255,255,.12);border-radius:12px;color:#aaa;font-size:14px;outline:none;box-sizing:border-box}.search-input[_ngcontent-%COMP%]::placeholder{color:#666}.search-actions[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);display:flex;align-items:center;gap:8px;color:#666}.search-icon[_ngcontent-%COMP%], .options-icon[_ngcontent-%COMP%]{font-size:20px;display:flex;align-items:center;justify-content:center}.options-icon[_ngcontent-%COMP%]{font-size:20px}.filter-sort[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin:6px 0 4px;position:relative;z-index:var(--z-dropdown);overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{display:grid;gap:6px}.range-inputs.dual[_ngcontent-%COMP%]{position:relative;height:24px;display:flex;align-items:center;gap:0}.range-inputs.dual[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;right:0;height:4px;border-radius:999px;background:#ffffff2e}.range-inputs.dual[_ngcontent-%COMP%]:after{content:"";position:absolute;left:var(--min-percent, 0%);right:calc(100% - var(--max-percent, 100%));height:4px;border-radius:999px;background:var(--color-accent)}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;left:0;right:0;width:100%;height:24px;margin:0;background:none;pointer-events:none;-webkit-appearance:none}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{pointer-events:auto;-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{pointer-events:auto;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   .min-range[_ngcontent-%COMP%]{z-index:2}.range-inputs.dual[_ngcontent-%COMP%]   .max-range[_ngcontent-%COMP%]{z-index:3}.range-inputs[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:100%;accent-color:var(--color-accent)}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;gap:5px;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:10px;transition:background-color .2s ease,border-color .2s ease,transform .1s ease;min-width:110px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:5px 8px;gap:4px}.pill[_ngcontent-%COMP%]:hover{background:var(--color-bit-gray);border-color:var(--color-light-gray)}.pill[_ngcontent-%COMP%]:active{transform:translateY(1px)}.dropdown[_ngcontent-%COMP%]{position:relative}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:180px;z-index:calc(var(--z-dropdown) + 1);padding:4px;pointer-events:auto}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:none;background:transparent;color:var(--color-white);cursor:pointer;border-radius:8px;transition:background-color .15s ease;text-align:left}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff14}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:8px;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-weight:500;font-size:13px;cursor:pointer;border-radius:20px;transition:all .2s;white-space:nowrap}.tab-btn[_ngcontent-%COMP%]:hover{background:#fff3}.tab-btn.active[_ngcontent-%COMP%]{background:#fbbc04;color:var(--color-white);font-weight:600}.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:color .2s}.clickable[_ngcontent-%COMP%]:hover{color:var(--color-white)}.sections-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow-y:auto;min-height:0;gap:24px}.sections-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.sections-container.search-mode[_ngcontent-%COMP%]{overflow:hidden}.sections-container.search-mode[_ngcontent-%COMP%]   .tabs-header[_ngcontent-%COMP%]{flex:0 0 auto}.sections-container.search-mode[_ngcontent-%COMP%]   .events-section[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;padding-right:4px}.events-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.collapse-toggle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;border:none;background:var(--color-gray);color:var(--color-white);display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,transform .1s ease;z-index:calc(var(--z-sidebar) + 10)}.collapse-toggle[_ngcontent-%COMP%]:hover{background:#3a3a3a}.collapse-toggle[_ngcontent-%COMP%]:active{transform:scale(.96)}@media (max-width: 767px){.sidebar-container[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px) and (max-width: 1024px){.sidebar-container[_ngcontent-%COMP%]{padding:24px;top:20px;left:20px;z-index:var(--z-sidebar)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:fit-content;height:72px;padding:24px;border-radius:24px;justify-content:center;align-items:center}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block}}.empty-state[_ngcontent-%COMP%]{font-size:13px;font-weight:300;color:var(--color-gray-light);font-style:italic;opacity:.7;margin-bottom:8px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px;transition:background-color .2s;border:1px solid transparent}.location-item[_ngcontent-%COMP%]:hover{background:#333;border-color:#555;cursor:pointer}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--color-white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.follow-icon[_ngcontent-%COMP%]{background:var(--color-bit-gray);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;margin-left:auto}.follow-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-white)}.follow-icon[_ngcontent-%COMP%]:hover{background:#555}.follow-icon.following[_ngcontent-%COMP%]{background:var(--color-accent)}.follow-icon.following[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-black)}.show-more-btn[_ngcontent-%COMP%]{width:100%;padding:10px;background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white);border-radius:12px;cursor:pointer;font-size:13px;font-weight:500;margin-top:8px;transition:all .2s}.show-more-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:var(--color-light-gray)}']})};var dj=(i,n)=>n.id;function dee(i,n){if(i&1){let e=wt();z(0,"mat-icon",7),Ae("click",function(d){Me(e);let r=ne();return r.showFilterOptions=!r.showFilterOptions,r.filterMenuOpen=!1,r.sortMenuOpen=!1,De(d.stopPropagation())}),Z(1,"tune"),V()}}function hee(i,n){if(i&1){let e=wt();z(0,"mat-icon",8),Ae("click",function(d){return Me(e),ne().toggleExpand(),De(d.stopPropagation())}),Z(1,"close"),V()}}function pee(i,n){i&1&&(z(0,"mat-icon"),Z(1,"check"),V())}function fee(i,n){if(i&1){let e=wt();z(0,"button",28),Ae("click",function(d){let r=Me(e).$implicit;return ne(4).selectFilter(r),De(d.stopPropagation())}),z(1,"span"),Z(2),V(),Je(3,pee,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=ne(4);J(2),ct(a.filterLabels[e]),J(),et(a.filterOption===e?3:-1)}}function mee(i,n){if(i&1&&(z(0,"div",20),qi(1,fee,4,2,"button",27,Ra),V()),i&2){let e=ne(3);J(),Wi(e.filterOrder)}}function gee(i,n){i&1&&(z(0,"mat-icon"),Z(1,"check"),V())}function _ee(i,n){if(i&1){let e=wt();z(0,"button",28),Ae("click",function(d){let r=Me(e).$implicit;return ne(4).selectSort(r),De(d.stopPropagation())}),z(1,"span"),Z(2),V(),Je(3,gee,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=ne(4);J(2),ct(a.sortLabels[e]),J(),et(a.sortOption===e?3:-1)}}function vee(i,n){if(i&1&&(z(0,"div",20),qi(1,_ee,4,2,"button",27,Ra),V()),i&2){let e=ne(3);J(),Wi(e.sortOrder)}}function yee(i,n){if(i&1){let e=wt();z(0,"div",13)(1,"div",16)(2,"div",17),Ae("click",function(){Me(e);let d=ne(2);return d.filterMenuOpen=!d.filterMenuOpen,De(d.sortMenuOpen=!1)}),z(3,"div",18)(4,"mat-icon"),Z(5,"filter_list"),V(),z(6,"span"),Z(7),V(),z(8,"mat-icon",19),Z(9),V()(),Je(10,mee,3,0,"div",20),V(),z(11,"div",17),Ae("click",function(){Me(e);let d=ne(2);return d.sortMenuOpen=!d.sortMenuOpen,De(d.filterMenuOpen=!1)}),z(12,"div",18)(13,"mat-icon"),Z(14,"swap_vert"),V(),z(15,"span"),Z(16),V(),z(17,"mat-icon",19),Z(18),V()(),Je(19,vee,3,0,"div",20),V()(),z(20,"div",21)(21,"div",22)(22,"span"),Z(23,"Price"),V(),z(24,"span",23),Z(25),V()(),z(26,"div",24)(27,"input",25),Ae("input",function(d){Me(e);let r=ne(2);return De(r.onPriceMinChange(d.target.value))}),V(),z(28,"input",26),Ae("input",function(d){Me(e);let r=ne(2);return De(r.onPriceMaxChange(d.target.value))}),V()()(),z(29,"div",21)(30,"div",22)(31,"span"),Z(32,"Distance"),V(),z(33,"span",23),Z(34),V()(),z(35,"div",24)(36,"input",25),Ae("input",function(d){Me(e);let r=ne(2);return De(r.onDistanceMinChange(d.target.value))}),V(),z(37,"input",26),Ae("input",function(d){Me(e);let r=ne(2);return De(r.onDistanceMaxChange(d.target.value))}),V()()()()}if(i&2){let e=ne(2);J(7),ct(e.filterLabels[e.filterOption]),J(2),ct(e.filterMenuOpen?"expand_less":"expand_more"),J(),et(e.filterMenuOpen?10:-1),J(6),ct(e.sortLabels[e.sortOption]),J(2),ct(e.sortMenuOpen?"expand_less":"expand_more"),J(),et(e.sortMenuOpen?19:-1),J(6),ma("\u20AC",e.priceMin.toFixed(0)," - \u20AC",e.priceMax.toFixed(0)),J(),jo("--min-percent",e.priceMinPercent)("--max-percent",e.priceMaxPercent),J(),bt("min",0)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMin),J(),bt("min",e.priceMin)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMax),J(6),ma("",e.distanceMin.toFixed(1)," - ",e.distanceMax.toFixed(1)," km"),J(),jo("--min-percent",e.distanceMinPercent)("--max-percent",e.distanceMaxPercent),J(),bt("min",0)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMin),J(),bt("min",e.distanceMin)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMax)}}function xee(i,n){if(i&1){let e=wt();z(0,"app-event-card",31),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(4);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(4);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(4);return De(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=ne(4);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)}}function bee(i,n){i&1&&(z(0,"div",30),Z(1,"No events found."),V())}function wee(i,n){if(i&1&&(z(0,"div",15),qi(1,xee,1,13,"app-event-card",29,dj),Je(3,bee,2,0,"div",30),V()),i&2){let e=ne(3);J(),Wi(e.getFiltered(e.searchResults)),J(2),et(e.searchResults.length===0?3:-1)}}function Cee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(5);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(5);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(5);return De(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=ne(5);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Eee(i,n){i&1&&(z(0,"div",30),Z(1,"No events found in your area."),V())}function See(i,n){if(i&1&&(z(0,"div",32)(1,"div",33),Z(2,"FOUND EVENTS"),V(),z(3,"div",15),qi(4,Cee,1,14,"app-event-card",34,Ra),Je(6,Eee,2,0,"div",30),V()()),i&2){let e=ne(4);J(4),Wi(e.getFiltered(e.foundEvents)),J(2),et(e.foundEvents.length===0?6:-1)}}function Tee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(5);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(5);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(5);return De(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=ne(5);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!0)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Iee(i,n){i&1&&(z(0,"div",30),Z(1,"No upcoming events you are participating in."),V())}function Mee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(5);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(5);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(5);return De(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=ne(5);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Dee(i,n){i&1&&(z(0,"div",30),Z(1,"You haven't saved any events yet."),V())}function Aee(i,n){if(i&1){let e=wt();z(0,"app-event-card",37),Ae("focusLocation",function(){let d=Me(e).$implicit,r=ne(5);return De(r.goToEvent(d))})("toggleFavorite",function(){let d=Me(e).$implicit,r=ne(5);return De(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Me(e).$implicit,r=ne(5);return De(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=ne(5);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Pee(i,n){i&1&&(z(0,"div",30),Z(1,"No new events to discover at the moment."),V())}function Oee(i,n){if(i&1&&(z(0,"div",32)(1,"div",33),Z(2,"FOLLOW UP EVENTS"),V(),z(3,"div",15),qi(4,Tee,1,14,"app-event-card",34,Ra),Je(6,Iee,2,0,"div",30),V()(),z(7,"div",32)(8,"div",33),Z(9,"SAVED EVENTS"),V(),z(10,"div",15),qi(11,Mee,1,14,"app-event-card",34,Ra),Je(13,Dee,2,0,"div",30),V()(),z(14,"div",32)(15,"div",33),Z(16,"DISCOVER EVENTS"),V(),z(17,"div",15),qi(18,Aee,1,13,"app-event-card",36,Ra),Je(20,Pee,2,0,"div",30),V()()),i&2){let e=ne(4);J(4),Wi(e.getFiltered(e.followUpEvents)),J(2),et(e.followUpEvents.length===0?6:-1),J(5),Wi(e.getFiltered(e.savedEvents)),J(2),et(e.savedEvents.length===0?13:-1),J(5),Wi(e.getFiltered(e.discoverEvents)),J(2),et(e.discoverEvents.length===0?20:-1)}}function Ree(i,n){if(i&1&&Je(0,See,7,1,"div",32)(1,Oee,21,3),i&2){let e=ne(3);et(e.userId?1:0)}}function kee(i,n){if(i&1&&Je(0,wee,4,1,"div",15)(1,Ree,2,1),i&2){let e=ne(2);et(e.isSearching&&e.hasSearchQuery?0:1)}}function Fee(i,n){if(i&1){let e=wt();z(0,"div",39),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.selectCity(d))}),z(1,"div",40)(2,"mat-icon"),Z(3,"location_on"),V()(),z(4,"div",41)(5,"span",42),Z(6),V()()()}if(i&2){let e=n.$implicit;J(6),ct(e.name)}}function Lee(i,n){i&1&&(z(0,"div",30),Z(1,"No places found."),V())}function Nee(i,n){if(i&1&&(z(0,"div",15),qi(1,Fee,7,1,"div",38,Ra),Je(3,Lee,2,0,"div",30),V()),i&2){let e=ne(2);J(),Wi(e.cityResults),J(2),et(e.isSearching&&e.cityResults.length===0?3:-1)}}function zee(i,n){i&1&&(z(0,"mat-icon"),Z(1,"person"),V())}function Bee(i,n){if(i&1){let e=wt();z(0,"div",39),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.openProfile(d))}),z(1,"div",40),ji(2,zee,2,0,"mat-icon",43),V(),z(3,"div",41)(4,"span",42),Z(5),V()()()}if(i&2){let e=n.$implicit;J(),jo("background-image",e.profileImage?"url("+e.profileImage+")":"")("background-size","cover"),J(),bt("ngIf",!e.profileImage),J(3),ct(e.name)}}function Vee(i,n){i&1&&(z(0,"div",30),Z(1,"No creators found."),V())}function Uee(i,n){if(i&1&&(z(0,"div",15),qi(1,Bee,6,6,"div",38,dj),Je(3,Vee,2,0,"div",30),V()),i&2){let e=ne(2);J(),Wi(e.userResults),J(2),et(e.isSearching&&e.userResults.length===0?3:-1)}}function jee(i,n){if(i&1){let e=wt();z(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),Ae("click",function(){Me(e);let d=ne();return De(d.setActiveTab("events"))}),Z(4,"EVENTS"),V(),z(5,"button",12),Ae("click",function(){Me(e);let d=ne();return De(d.setActiveTab("places"))}),Z(6,"PLACES"),V(),z(7,"button",12),Ae("click",function(){Me(e);let d=ne();return De(d.setActiveTab("creators"))}),Z(8,"CREATORS"),V()(),Je(9,yee,38,34,"div",13),z(10,"div",14),Je(11,kee,2,1),Je(12,Nee,4,1,"div",15),Je(13,Uee,4,1,"div",15),V()()()}if(i&2){let e=ne();J(3),hn("active",e.activeTab==="events"),J(2),hn("active",e.activeTab==="places"),J(2),hn("active",e.activeTab==="creators"),J(2),et(e.activeTab==="events"&&e.showFilterOptions?9:-1),J(2),et(e.activeTab==="events"?11:-1),J(),et(e.activeTab==="places"?12:-1),J(),et(e.activeTab==="creators"?13:-1)}}var db=class i{constructor(n,e,a){this.eventService=n;this.mapboxService=e;this.userService=a}focusEvent=new $t;foundLocation=new $t;toggleFavorite=new $t;openUserProfile=new $t;shareEvent=new $t;userId=null;events=[];searchQuery="";isExpanded=!1;isSearching=!1;activeTab="events";searchResults=[];cityResults=[];userResults=[];followingMap={};followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;showFilterOptions=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};ngOnChanges(){this.categorizeEvents()}toggleExpand(){this.isExpanded=!this.isExpanded,this.isExpanded||this.clearSearch()}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.isSearching=!0,this.eventService.searchEvents(this.searchQuery).subscribe(n=>{this.searchResults=n}),this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(e=>({name:e.place_name,center:e.center}))}),this.userService.searchUsers(this.searchQuery).subscribe(n=>{this.userResults=n,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(e=>{this.followingMap[n.id]=e.isFollowing})})}followUser(n,e){e.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,e){e.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}openProfile(n){this.openUserProfile.emit(n.id.toString()),this.closeSearch()}setActiveTab(n){this.activeTab=n,n!=="events"&&(this.filterMenuOpen=!1,this.sortMenuOpen=!1)}selectCity(n){let[e,a]=n.center;this.foundLocation.emit({lat:a,lng:e}),this.closeSearch()}goToEvent(n){this.focusEvent.emit(n),this.closeSearch()}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[]}closeSearch(){this.isExpanded=!1,this.clearSearch()}get hasSearchQuery(){return this.searchQuery.trim().length>0}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=a&&d?`${a} - ${d}`:a||d;return[r,E].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};categorizeEvents(){if(this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.foundEvents=[],this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent);return}this.eventService.getJoinedEvents(this.userId).subscribe(n=>{this.followUpEvents=n.filter(this.isFutureEvent)}),this.events.filter(this.isFutureEvent).forEach(n=>{let e=n.isSaved||!1,a=n.isParticipating||!1;e&&this.savedEvents.push(n),!a&&!e&&this.discoverEvents.push(n)})}updateRangeLimits(){let n=this.events.map(X=>X.costPerPerson??0),e=n.length?Math.max(...n):0,a=Math.max(10,Math.ceil(e)),d=this.events.map(X=>X.distanceKm).filter(X=>typeof X=="number"&&!Number.isNaN(X)),r=d.length?Math.max(...d):0,E=Math.max(5,Math.ceil(r)),P=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=a,(P||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let k=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=E,(k||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(n){let e=[...n];switch(this.filterOption){case"participating":e=e.filter(r=>!!r.isParticipating);break;case"free":e=e.filter(r=>r.costPerPerson==null||r.costPerPerson===0);break;case"available":e=e.filter(r=>r.nPartecipants==null||r.occupiedSpots==null?!0:r.nPartecipants-r.occupiedSpots>0);break}switch(this.sortOption){case"distance":e.sort((r,E)=>(r.distanceKm??999)-(E.distanceKm??999));break;case"name":e.sort((r,E)=>(r.title||"").localeCompare(E.title||""));break;case"date":default:e.sort((r,E)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`).getTime(),k=new Date(`${E.date}T${E.startTime||"00:00"}`).getTime();return P-k});break}return(this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(e=e.filter(r=>{let E=r.costPerPerson??0;return E>=this.priceMin&&E<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(e=e.filter(r=>{let E=r.distanceKm;return E==null?!1:E>=this.distanceMin&&E<=this.distanceMax})),e}getFiltered(n){return this.applyFilters(n)}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1}get priceMinPercent(){return this.priceMaxLimit?`${this.priceMin/this.priceMaxLimit*100}%`:"0%"}get priceMaxPercent(){return this.priceMaxLimit?`${this.priceMax/this.priceMaxLimit*100}%`:"100%"}get distanceMinPercent(){return this.distanceMaxLimit?`${this.distanceMin/this.distanceMaxLimit*100}%`:"0%"}get distanceMaxPercent(){return this.distanceMaxLimit?`${this.distanceMax/this.distanceMaxLimit*100}%`:"100%"}onPriceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(e)?this.priceMin:e}onPriceMaxChange(n){let e=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(e)?this.priceMax:e}onDistanceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(e)?this.distanceMin:e}onDistanceMaxChange(n){let e=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(e)?this.distanceMax:e}static \u0275fac=function(e){return new(e||i)(Ft(Zs),Ft(Fu),Ft(Cs))};static \u0275cmp=Sn({type:i,selectors:[["app-mobile-search"]],inputs:{userId:"userId",events:"events"},outputs:{focusEvent:"focusEvent",foundLocation:"foundLocation",toggleFavorite:"toggleFavorite",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Gr],decls:8,vars:7,consts:[[1,"mobile-search-wrapper"],[1,"floating-search-bar",3,"click"],[1,"search-icon"],["type","text","placeholder","Search events, cities or people",1,"pill-input",3,"ngModelChange","keyup.enter","focus","ngModel","readonly"],["class","options-icon",3,"click",4,"ngIf"],["class","close-icon",3,"click",4,"ngIf"],["class","search-overlay",4,"ngIf"],[1,"options-icon",3,"click"],[1,"close-icon",3,"click"],[1,"search-overlay"],[1,"search-results-container"],[1,"tabs-header"],[1,"tab-btn",3,"click"],[1,"filter-sort-container"],[1,"results-scroll-area"],[1,"list-view"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs","dual"],["type","range",1,"min-range",3,"input","min","max","step","value"],["type","range",1,"max-range",3,"input","min","max","step","value"],[1,"menu-item"],[1,"menu-item",3,"click"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"mobile-section"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle"],[1,"loc-info"],[1,"loc-name"],[4,"ngIf"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1),Ae("click",function(){return!a.isExpanded&&a.toggleExpand()}),z(2,"mat-icon",2),Z(3,"search"),V(),z(4,"input",3),vo("ngModelChange",function(r){return To(a.searchQuery,r)||(a.searchQuery=r),r}),Ae("keyup.enter",function(){return a.onSearch()})("focus",function(){return!a.isExpanded&&a.toggleExpand()}),V(),ji(5,dee,2,0,"mat-icon",4)(6,hee,2,0,"mat-icon",5),V(),ji(7,jee,14,10,"div",6),V()),e&2&&(hn("expanded",a.isExpanded),J(4),_o("ngModel",a.searchQuery),bt("readonly",!a.isExpanded),J(),bt("ngIf",a.isExpanded&&a.activeTab==="events"),J(),bt("ngIf",a.isExpanded),J(),bt("ngIf",a.isExpanded))},dependencies:[xi,cs,Ba,ws,Ws,_a,Ai,Di,Yh],styles:['.mobile-search-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:80px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}@media (max-width: 767px){.mobile-search-wrapper[_ngcontent-%COMP%]{bottom:40px}}.mobile-search-wrapper.expanded[_ngcontent-%COMP%]{inset:0;z-index:10000}.floating-search-bar[_ngcontent-%COMP%]{background:var(--color-dark-gray);height:50px;border-radius:25px;display:flex;align-items:center;padding:0 16px;box-shadow:0 4px 12px #0000004d;border:1px solid var(--color-light-gray);gap:12px;cursor:pointer;z-index:10001;position:absolute;bottom:0;width:100%}.expanded[_ngcontent-%COMP%]   .floating-search-bar[_ngcontent-%COMP%]{inset:20px 20px auto;width:calc(100% - 40px);border-radius:12px}.pill-input[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--color-white);font-size:14px;flex:1;outline:none}.search-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.search-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-dark-gray);z-index:9999;display:flex;flex-direction:column;padding-top:90px;animation:_ngcontent-%COMP%_searchSlideUp .3s cubic-bezier(.25,.8,.25,1)}@keyframes _ngcontent-%COMP%_searchSlideUp{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.search-results-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:0 20px 20px;gap:20px;overflow:hidden}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:8px;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-size:12px;font-weight:600;border-radius:20px;white-space:nowrap}.tab-btn.active[_ngcontent-%COMP%]{background:var(--color-accent);color:var(--color-black)}.results-scroll-area[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background:var(--color-bit-gray);display:flex;align-items:center;justify-content:center}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;opacity:.5;font-style:italic}.search-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.options-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.filter-sort-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:0 0 10px;overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{display:grid;gap:6px}.range-inputs.dual[_ngcontent-%COMP%]{position:relative;height:24px;display:flex;align-items:center;gap:0}.range-inputs.dual[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;right:0;height:4px;border-radius:999px;background:#ffffff2e}.range-inputs.dual[_ngcontent-%COMP%]:after{content:"";position:absolute;left:var(--min-percent, 0%);right:calc(100% - var(--max-percent, 100%));height:4px;border-radius:999px;background:var(--color-accent)}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;left:0;right:0;width:100%;height:24px;margin:0;background:none;pointer-events:none;-webkit-appearance:none}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{pointer-events:auto;-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{pointer-events:auto;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   .min-range[_ngcontent-%COMP%]{z-index:2}.range-inputs.dual[_ngcontent-%COMP%]   .max-range[_ngcontent-%COMP%]{z-index:3}.range-inputs[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:100%;accent-color:var(--color-accent)}.mobile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:11px;min-width:120px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;gap:6px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:160px;z-index:10002;padding:4px}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:none;background:transparent;color:var(--color-white);font-size:13px;border-radius:8px}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.clickable[_ngcontent-%COMP%]{cursor:pointer}']})};var d6=ww(vR());function Lte(i,n){if(i&1&&Rn(0,"img",8),i&2){let e=ne(2);bt("src",e.posterPreviewUrl,to)}}function Nte(i,n){i&1&&(z(0,"div",9),Z(1,"Anteprima in generazione..."),V())}function zte(i,n){if(i&1){let e=wt();z(0,"div",1),Ae("click",function(){Me(e);let d=ne();return De(d.close.emit())}),z(1,"div",2),Ae("click",function(d){return Me(e),De(d.stopPropagation())}),z(2,"div",3)(3,"div",4)(4,"span"),Z(5,"Share Event"),V()(),z(6,"button",5),Ae("click",function(){Me(e);let d=ne();return De(d.close.emit())}),z(7,"mat-icon"),Z(8,"close"),V()()(),z(9,"div",6)(10,"div",7),Je(11,Lte,1,1,"img",8)(12,Nte,2,0,"div",9),V(),z(13,"div",10)(14,"button",11),Ae("click",function(){Me(e);let d=ne();return De(d.downloadPoster())}),z(15,"mat-icon"),Z(16,"download"),V(),z(17,"span"),Z(18),V()(),z(19,"button",12),Ae("click",function(){Me(e);let d=ne();return De(d.shareLink())}),z(20,"mat-icon"),Z(21,"link"),V(),z(22,"span"),Z(23,"Share link"),V()()()()()()}if(i&2){let e=ne();J(10),jo("background-image","url("+e.templateUrl+")"),J(),et(e.posterPreviewUrl?11:12),J(3),bt("disabled",e.downloading),J(4),ct(e.downloading?"Generating...":"Download poster")}}var pv=class i{constructor(n){this.snackBar=n}event=null;close=new $t;templateUrl="assets/img/LocandinaTemplate.png";downloading=!1;posterPreviewUrl="";posterWidth=1080;posterHeight=1350;infoArea={x:50,y:190,width:590};qrSquare={x:325,y:831,size:430};previewToken=0;ngOnChanges(n){n.event&&this.buildPreview()}getShareLink(n=this.event){if(!n)return"";let e=window.location.protocol,a=window.location.host;return`${e}//${a}/?event=${n.id}`}getQrCodeUrl(n=220,e=this.event){let a=this.getShareLink(e);return a?`https://api.qrserver.com/v1/create-qr-code/?size=${n}x${n}&margin=0&data=${encodeURIComponent(a)}`:""}buildPreview(){return Er(this,null,function*(){let n=++this.previewToken;if(!this.event){this.posterPreviewUrl="";return}try{let e=yield this.renderPoster(this.event);if(n!==this.previewToken)return;this.posterPreviewUrl=e.toDataURL("image/png")}catch(e){console.error("Failed to generate poster preview",e),n===this.previewToken&&(this.posterPreviewUrl="")}})}downloadPoster(){return Er(this,null,function*(){let n=this.event;if(!(!n||this.downloading)){this.downloading=!0;try{let e=yield this.renderPoster(n),a=yield new Promise(E=>e.toBlob(E,"image/png"));if(!a)throw new Error("Unable to generate poster");let d=`lumo-event-${n.id}.png`,r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=d,r.click(),setTimeout(()=>URL.revokeObjectURL(r.href),1e3)}catch(e){console.error("Failed to download poster",e),this.showToast("Unable to generate the poster. You can share the link instead.","error")}finally{this.downloading=!1}}})}shareLink(){return Er(this,null,function*(){let n=this.getShareLink();if(!(!n||!this.event)){if(navigator.share)try{yield navigator.share({title:this.event.title,text:"Check out this event on Lumo",url:n});return}catch(e){console.warn("Share cancelled or failed",e)}this.copyShareLink()}})}copyShareLink(){let n=this.getShareLink();n&&navigator.clipboard.writeText(n).then(()=>{this.showToast("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy link: ",e),this.showToast("Unable to copy the link.","error")})}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1600:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=a&&d?`${a} - ${d}`:a||d;return[r,E].filter(Boolean).join(" | ")}formatCost(n){return n.costPerPerson==null||n.costPerPerson===0?"Free":`\u20AC${n.costPerPerson} per person`}formatLocation(n){return n.city||"Location TBD"}ensureFontsLoaded(){return Er(this,null,function*(){if("fonts"in document)try{yield document.fonts.ready}catch(n){console.warn("Fonts not ready",n)}})}loadImage(n){return new Promise((e,a)=>{let d=new Image;d.crossOrigin="anonymous",d.onload=()=>e(d),d.onerror=()=>a(new Error("Failed to load image")),d.src=n})}renderPoster(n){return Er(this,null,function*(){yield this.ensureFontsLoaded();let e=document.createElement("canvas");e.width=this.posterWidth,e.height=this.posterHeight;let a=e.getContext("2d");if(!a)throw new Error("Unable to render poster");let d=yield this.loadImage(this.templateUrl);a.drawImage(d,0,0,this.posterWidth,this.posterHeight),a.textAlign="left",a.textBaseline="top";let r=n.title||"Lumo Event",E=this.infoArea.x,P=this.infoArea.width,k=this.infoArea.y;a.fillStyle="#FCC324",a.font='700 56px "Stack Sans Headline", Arial, sans-serif',k=this.drawWrappedText(a,r,E,k,P,64,2),k+=12;let X=this.formatDateTime(n);X&&(a.fillStyle="#FCC324",a.font='600 32px "Stack Sans Headline", Arial, sans-serif',a.fillText(X,E,k),k+=40),a.fillStyle="#FFFFFF",a.font='500 30px "Stack Sans Headline", Arial, sans-serif',a.fillText(this.formatLocation(n),E,k),k+=38,a.fillText(this.formatCost(n),E,k),k+=38,n.organizerName&&(a.fillStyle="#B0B0B0",a.font='500 26px "Stack Sans Headline", Arial, sans-serif',a.fillText(`Eventer: ${n.organizerName}`,E,k),k+=32),n.description&&(a.fillStyle="#B0B0B0",a.font='400 24px "Stack Sans Headline", Arial, sans-serif',k=this.drawWrappedText(a,n.description,E,k+6,P,30,3));let oe=20,Se=12,$e=24,ke=this.qrSquare.size+oe*2,ht=this.qrSquare.x-oe,Nt=this.qrSquare.y-oe,Mt=ke-Se*2,Xt=ht+Se,Vn=Nt+Se,sr=this.getShareLink(n),$i="";try{$i=yield d6.toDataURL(sr,{width:Mt,margin:0,color:{dark:"#000000",light:"#ffffff"}})}catch(Li){console.error("Local QR generation failed",Li)}if($i){let Li=yield this.loadImage($i);a.save(),this.drawRoundedRect(a,ht,Nt,ke,ke,$e),a.clip(),a.fillStyle="#FFFFFF",a.fill(),a.drawImage(Li,Xt,Vn,Mt,Mt),a.restore()}return e})}drawRoundedRect(n,e,a,d,r,E){let P=Math.max(0,Math.min(E,d/2,r/2));n.beginPath(),n.moveTo(e+P,a),n.arcTo(e+d,a,e+d,a+r,P),n.arcTo(e+d,a+r,e,a+r,P),n.arcTo(e,a+r,e,a,P),n.arcTo(e,a,e+d,a,P),n.closePath()}drawWrappedText(n,e,a,d,r,E,P){let k=e.split(" "),X="",oe=0;for(let Se of k){let $e=X?`${X} ${Se}`:Se;if(n.measureText($e).width>r&&X){if(n.fillText(this.truncateToWidth(n,X,r,oe===P-1),a,d),X=Se,d+=E,oe+=1,oe>=P)return d}else X=$e}if(X&&oe<P){let Se=oe===P-1;n.fillText(this.truncateToWidth(n,X,r,Se),a,d),d+=E}return d}truncateToWidth(n,e,a,d){if(!d||n.measureText(e).width<=a)return e;let r=e;for(;r.length>0;){let E=`${r}...`;if(n.measureText(E).width<=a)return E;r=r.slice(0,-1)}return e}static \u0275fac=function(e){return new(e||i)(Ft(Lc))};static \u0275cmp=Sn({type:i,selectors:[["app-event-share-modal"]],inputs:{event:"event"},outputs:{close:"close"},features:[Gr],decls:1,vars:1,consts:[[1,"event-share-backdrop"],[1,"event-share-backdrop",3,"click"],[1,"event-share-modal",3,"click"],[1,"event-share-header"],[1,"header-title"],[1,"close-btn",3,"click"],[1,"event-share-content"],[1,"poster-preview"],["alt","Event poster",1,"poster-preview-image",3,"src"],[1,"poster-preview-loading"],[1,"share-actions"],[1,"button","action-btn",3,"click","disabled"],[1,"button","action-btn","secondary",3,"click"]],template:function(e,a){e&1&&Je(0,zte,24,5,"div",0),e&2&&et(a.event?0:-1)},dependencies:[xi,Ai,Di,Ru],styles:['.event-share-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-popup);display:flex;align-items:center;justify-content:center;padding:20px}.event-share-modal[_ngcontent-%COMP%]{width:min(560px,94vw);background:var(--modal-surface);border:var(--modal-border);border-radius:var(--modal-radius);box-shadow:var(--modal-shadow);padding:14px 14px 18px;display:flex;flex-direction:column;gap:16px}.event-share-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-white);font-weight:600;font-size:16px}.header-title[_ngcontent-%COMP%]:before{content:"";width:10px;height:10px;display:inline-block}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.event-share-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.poster-preview[_ngcontent-%COMP%]{position:relative;width:min(500px,100%);aspect-ratio:4 / 5;border-radius:18px;border:1px solid var(--color-bit-gray);overflow:hidden;background-position:center;background-size:cover;background-color:#0b0b0b}.poster-preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.poster-preview-loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:grid;place-items:center;color:#cfcfcf;font-size:13px;background:#00000059}.share-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;align-items:center;justify-content:center;width:100%}.action-btn[_ngcontent-%COMP%]{gap:8px;width:210px;justify-content:center;font-weight:var(--font-weight-semibold)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:inherit}.action-btn.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white)}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:default}@media (max-width: 767px){.event-share-modal[_ngcontent-%COMP%]{padding:16px}.event-share-content[_ngcontent-%COMP%]{width:100%}.share-actions[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;justify-content:center}.action-btn[_ngcontent-%COMP%]{flex:1 1 140px;justify-content:center;width:auto}}']})};function Bte(i,n){if(i&1){let e=wt();z(0,"app-event-share-modal",5),Ae("close",function(){Me(e);let d=ne();return De(d.sharingEvent=null)}),V()}if(i&2){let e=ne();bt("event",e.sharingEvent)}}var ep=document.createElement("div");ep.style.width="20px";ep.style.height="20px";ep.style.backgroundColor="#4285F4";ep.style.border="3px solid white";ep.style.borderRadius="50%";ep.style.boxShadow="0 0 3px rgba(0,0,0,0.3)";var xb=class i{constructor(n,e){this.eventService=n;this.snackBar=e}userId=null;eventSelected=new $t;mapInteract=new $t;eventsUpdated=new $t;openUserProfile=new $t;mapInstance;eventMarkers=new Map;events=[];sharingEvent=null;userCoords=null;sidebarCollapsed=!1;managedPopupType=null;sidebar;mobileSearch;pollSubscription=null;get map(){return this.mapInstance}getEventScreenPosition(n){if(!n.latitude||!n.longitude||!this.mapInstance)return null;let e=this.mapInstance.project([n.longitude,n.latitude]);return{x:e.x,y:e.y}}ngOnChanges(n){n.userId&&!n.userId.isFirstChange()&&(this.resetSearch(),this.loadEvents(),this.startPolling())}resetSearch(){this.sidebar&&this.sidebar.clearSearch(),this.mobileSearch&&this.mobileSearch.clearSearch()}ngAfterViewInit(){this.mapInstance=new fv.Map({accessToken:ul.mapboxToken,container:"map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:18,pitch:60,bearing:-20,antialias:!0}),this.mapInstance.dragPan.enable(),this.mapInstance.touchZoomRotate.enable({around:"center"}),this.mapInstance.touchZoomRotate.disableRotation(),this.mapInstance.touchZoomRotate.enable(),this.mapInstance.on("move",n=>{n.originalEvent&&this.mapInteract.emit()}),this.mapInstance.on("moveend",()=>this.updateVisibleMarkers()),this.mapInstance.on("zoomend",()=>this.updateVisibleMarkers()),this.mapInstance.on("click",n=>{n.originalEvent&&this.mapInteract.emit()}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.setCenter(this.userCoords),new fv.Marker({element:ep}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>{console.warn("Geolocation error:",n)},{enableHighAccuracy:!0}),this.loadEvents(),this.startPolling()}ngOnDestroy(){this.map&&this.mapInstance.remove(),this.eventMarkers.forEach(n=>n.remove()),this.stopPolling()}startPolling(){this.stopPolling(),this.pollSubscription=lf(1e4).pipe(So(()=>this.eventService.getEvents(this.userId||void 0))).subscribe({next:n=>{this.handleEventsUpdate(n)},error:n=>console.error("Error polling events",n)})}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}isFutureEvent(n){if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()}handleEventsUpdate(n){let e=n.filter(r=>this.isFutureEvent(r)),a=JSON.stringify(this.events.map(r=>({id:r.id,status:r.participationStatus,saved:r.isSaved,savedCount:r.savedCount}))),d=JSON.stringify(e.map(r=>({id:r.id,status:r.participationStatus,saved:r.isSaved,savedCount:r.savedCount})));(this.events.length!==e.length||a!==d)&&(this.events=e,this.updateDistancesAndSort(),this.placeEventMarkers(),this.eventsUpdated.emit(this.events))}loadEvents(){this.eventService.getEvents(this.userId||void 0).subscribe({next:n=>{this.events=n.filter(e=>this.isFutureEvent(e)),this.updateDistancesAndSort(),this.placeEventMarkers()},error:n=>{console.error("Error fetching events",n)}})}placeEventMarkers(){this.updateVisibleMarkers()}updateVisibleMarkers(){if(!this.mapInstance)return;let n=this.mapInstance.getBounds();if(!n)return;let e=this.events.filter(d=>d.latitude==null||d.longitude==null?!1:n.contains([d.longitude,d.latitude]));e.length>100&&(e=e.slice(0,100));let a=new Set(e.map(d=>d.id));this.eventMarkers.forEach((d,r)=>{a.has(r)||(d.remove(),this.eventMarkers.delete(r))}),e.forEach(d=>{if(typeof d.id=="number"&&!this.eventMarkers.has(d.id)){if(d.latitude==null||d.longitude==null)return;let r=document.createElement("div");r.className="golden-pulse-marker";let E=new fv.Marker({element:r}).setLngLat([d.longitude,d.latitude]).addTo(this.map);r.addEventListener("click",P=>{P.stopPropagation(),this.flyToEvent(d)}),this.eventMarkers.set(d.id,E)}})}flyToEvent(n){!this.map||n.longitude==null||n.latitude==null||(this.mapInstance.flyTo({center:[n.longitude,n.latitude],zoom:18,essential:!0,duration:1e3}),this.eventSelected.emit(n))}flyToLocation(n){this.map&&this.mapInstance.flyTo({center:[n.lng,n.lat],zoom:17,essential:!0,duration:1500})}flyToUser(){if(this.map){if(this.userCoords){this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),this.updateDistancesAndSort(),this.placeEventMarkers();return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),new fv.Marker({element:ep}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>console.warn("Geolocation error:",n),{enableHighAccuracy:!0})}}updateDistancesAndSort(){if(!this.userCoords||!this.events.length)return;let[n,e]=this.userCoords;this.events=this.events.map(a=>wi(Ht({},a),{distanceKm:this.computeDistanceKm(e,n,a.latitude,a.longitude)})).sort((a,d)=>(a.distanceKm??Number.POSITIVE_INFINITY)-(d.distanceKm??Number.POSITIVE_INFINITY))}computeDistanceKm(n,e,a,d){if(a==null||d==null)return;let r=6371,E=this.deg2rad(a-n),P=this.deg2rad(d-e),k=Math.sin(E/2)*Math.sin(E/2)+Math.cos(this.deg2rad(n))*Math.cos(this.deg2rad(a))*Math.sin(P/2)*Math.sin(P/2),X=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k));return r*X}deg2rad(n){return n*(Math.PI/180)}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}requestLogin=new $t;onToggleFavorite(n){if(!this.userId){this.snackBar.open("You must sign in to save events.","SIGN IN",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["login-snackbar"]}).onAction().subscribe(()=>{this.requestLogin.emit()});return}n.id&&this.eventService.toggleSavedEvent(this.userId,n.id).subscribe({next:e=>{let a=!!n.isSaved,d=typeof n.savedCount=="number"?n.savedCount:0;n.isSaved=e.isSaved,e.isSaved&&!a?n.savedCount=d+1:!e.isSaved&&a?n.savedCount=Math.max(0,d-1):(n.savedCount===void 0||n.savedCount===null)&&(n.savedCount=d);let r=this.events.find(E=>E.id===n.id);r&&r!==n&&(r.isSaved=n.isSaved,r.savedCount=n.savedCount),this.events=[...this.events]},error:e=>console.error("Error toggling favorite",e)})}openShare(n){this.sharingEvent=n}static \u0275fac=function(e){return new(e||i)(Ft(Zs),Ft(Lc))};static \u0275cmp=Sn({type:i,selectors:[["map-view"]],viewQuery:function(e,a){if(e&1&&(ka(ub,5),ka(db,5)),e&2){let d;pa(d=fa())&&(a.sidebar=d.first),pa(d=fa())&&(a.mobileSearch=d.first)}},inputs:{userId:"userId"},outputs:{eventSelected:"eventSelected",mapInteract:"mapInteract",eventsUpdated:"eventsUpdated",openUserProfile:"openUserProfile",requestLogin:"requestLogin"},features:[Gr],decls:7,vars:6,consts:[[3,"focusEvent","toggleSidebar","toggleFavorite","foundLocation","shareEvent","openUserProfile","events","collapsed","userId"],[3,"focusEvent","foundLocation","toggleFavorite","shareEvent","openUserProfile","events","userId"],[3,"event"],["id","map",1,"map-container"],[1,"locate-btn",3,"click"],[3,"close","event"]],template:function(e,a){e&1&&(z(0,"app-sidebar",0),Ae("focusEvent",function(r){return a.flyToEvent(r)})("toggleSidebar",function(){return a.toggleSidebar()})("toggleFavorite",function(r){return a.onToggleFavorite(r)})("foundLocation",function(r){return a.flyToLocation(r)})("shareEvent",function(r){return a.openShare(r)})("openUserProfile",function(r){return a.openUserProfile.emit(r)}),V(),z(1,"app-mobile-search",1),Ae("focusEvent",function(r){return a.flyToEvent(r)})("foundLocation",function(r){return a.flyToLocation(r)})("toggleFavorite",function(r){return a.onToggleFavorite(r)})("shareEvent",function(r){return a.openShare(r)})("openUserProfile",function(r){return a.openUserProfile.emit(r)}),V(),Je(2,Bte,1,1,"app-event-share-modal",2),Rn(3,"div",3),z(4,"button",4),Ae("click",function(){return a.flyToUser()}),z(5,"mat-icon"),Z(6,"my_location"),V()()),e&2&&(bt("events",a.events)("collapsed",a.sidebarCollapsed)("userId",a.userId),J(),bt("events",a.events)("userId",a.userId),J(),et(a.sharingEvent?2:-1))},dependencies:[ub,db,pv,Ai,Di,Ru,xi],styles:['.map-container[_ngcontent-%COMP%]{width:100%;height:100vh}.locate-btn[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px;width:48px;height:48px;border-radius:50%;border:none;background:var(--color-dark-gray);box-shadow:0 2px 8px #00000040;display:grid;place-items:center;cursor:pointer;transition:box-shadow .2s ease,transform .1s ease,background-color .2s}.locate-btn[_ngcontent-%COMP%]:hover{background:#333;box-shadow:0 4px 12px #0000004d}.locate-btn[_ngcontent-%COMP%]:active{transform:scale(.96)}.locate-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}app-mobile-search[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){app-mobile-search[_ngcontent-%COMP%]{display:block}.locate-btn[_ngcontent-%COMP%]{bottom:40px}}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content{background:var(--color-dark-gray);color:#f5f5f5;border:1px solid var(--color-gray);box-shadow:0 4px 12px #00000059;border-radius:10px}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content strong{color:#fbbc04}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-tip{border-top-color:var(--color-dark-gray)}[_nghost-%COMP%]     .golden-pulse-marker{width:40px;height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;background:transparent}[_nghost-%COMP%]     .golden-pulse-marker:after{content:"";position:absolute;width:14px;height:14px;background-color:#fcc324;border:2px solid white;border-radius:3px;transform:rotate(45deg);box-shadow:0 0 10px #fcc324cc;z-index:2;animation:_ngcontent-%COMP%_corePulse 3s infinite ease-in-out}[_nghost-%COMP%]     .golden-pulse-marker:before{content:"";position:absolute;width:100%;height:100%;background:radial-gradient(circle,#fcc32466,#fcc32400 70%);border-radius:50%;z-index:1;opacity:.6;animation:_ngcontent-%COMP%_glowPulse 2.5s infinite ease-in-out}@keyframes _ngcontent-%COMP%_corePulse{0%,to{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:.8;transform:rotate(45deg) scale(.9)}}@keyframes _ngcontent-%COMP%_glowPulse{0%,to{opacity:.2;transform:scale(.8)}50%{opacity:.7;transform:scale(1.2)}}']})};function Vte(i,n){if(i&1&&Rn(0,"textarea",1),i&2){let e=ne();bt("formControl",e.control)("placeholder",e.placeholder)}}function Ute(i,n){if(i&1&&(z(0,"span",5),Z(1),V()),i&2){let e=ne(2);J(),ct(e.placeholder)}}function jte(i,n){if(i&1){let e=wt();z(0,"button",7),Ae("click",function(d){Me(e);let r=ne(2);return De(r.togglePasswordVisibility(d))}),z(1,"mat-icon"),Z(2),V()()}if(i&2){let e=ne(2);J(2),ct(e.showPassword?"visibility_off":"visibility")}}function $te(i,n){if(i&1&&(z(0,"div",3),Rn(1,"input",4),Je(2,Ute,2,1,"span",5),Je(3,jte,3,1,"button",6),V()),i&2){let e=ne();hn("with-toggle",e.showToggle&&e.type==="password"),J(),hn("date-input",e.type==="date")("has-value",e.type==="date"&&!!(e.control!=null&&e.control.value)),bt("formControl",e.control)("type",e.inputType)("placeholder",e.placeholder),Jo("min",e.min),J(),et(e.type==="date"&&!(e.control!=null&&e.control.value)?2:-1),J(),et(e.showToggle&&e.type==="password"?3:-1)}}var tp=class i{control=null;type="text";placeholder="";error=!1;customClass="";showToggle=!1;min=null;showPassword=!1;get inputType(){return this.showToggle&&this.type==="password"?this.showPassword?"text":"password":this.type}togglePasswordVisibility(n){n.stopPropagation(),this.showToggle&&this.type==="password"&&(this.showPassword=!this.showPassword)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Sn({type:i,selectors:[["FormField"]],inputs:{control:"control",type:"type",placeholder:"placeholder",error:"error",customClass:"customClass",showToggle:"showToggle",min:"min"},decls:3,vars:4,consts:[[1,"input-wrapper",3,"ngClass"],[1,"input-field",3,"formControl","placeholder"],[1,"input-with-toggle",3,"with-toggle"],[1,"input-with-toggle"],[1,"input-field",3,"formControl","type","placeholder"],[1,"date-placeholder"],["type","button",1,"toggle-btn"],["type","button",1,"toggle-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Je(1,Vte,1,2,"textarea",1)(2,$te,4,12,"div",2),V()),e&2&&(hn("error",a.error),bt("ngClass",a.customClass),J(),et(a.type==="textarea"?1:2))},dependencies:[Wh,ws,Ws,ZO,xi,mP,Ai,Di],styles:[".form-field[_ngcontent-%COMP%]{font:var(--font-stack-headline);display:block;min-width:0;min-height:50px;max-width:500px;padding:0 var(--spacing-md);border-radius:var(--radius-lg);background-color:var(--color-gray);border:none;color:var(--color-white);font-size:16px}.form-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray);font-weight:var(--font-weight-light)}.form-field[_ngcontent-%COMP%]:focus{outline:none}input[type=date][_ngcontent-%COMP%]{color:var(--color-light-gray)}.input-wrapper[_ngcontent-%COMP%]{width:100%;position:relative}.input-wrapper.tall-field[_ngcontent-%COMP%]{height:80px}.input-wrapper.tall-field[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{height:100%;resize:none;padding-top:12px}.input-with-toggle[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.date-input[_ngcontent-%COMP%]{color:transparent}.date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-text, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-month-field, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-day-field, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-year-field{color:transparent}.date-input.has-value[_ngcontent-%COMP%]{color:var(--color-white)}.date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-text, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-month-field, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-day-field, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-year-field{color:var(--color-white)}.date-placeholder[_ngcontent-%COMP%]{position:absolute;left:var(--spacing-md);top:50%;transform:translateY(-50%);color:var(--color-light-gray);font-weight:var(--font-weight-light);pointer-events:none}.input-with-toggle.with-toggle[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{padding-right:42px}.toggle-btn[_ngcontent-%COMP%]{position:absolute;right:10px;background:transparent;border:none;color:#bbb;cursor:pointer;display:grid;place-items:center;padding:4px}.toggle-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.input-field[_ngcontent-%COMP%]{width:100%;height:50px;padding:0 var(--spacing-md);background-color:var(--color-gray);border:2px solid rgba(255,255,255,.12);border-radius:var(--radius-lg);color:var(--color-white);font-size:16px;font-family:inherit;font-weight:var(--font-weight-light);outline:none;transition:border-color .2s}.input-field[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.input-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.input-wrapper.error[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{border-color:var(--color-error)}input[_ngcontent-%COMP%]:-webkit-autofill, input[_ngcontent-%COMP%]:-webkit-autofill:hover, input[_ngcontent-%COMP%]:-webkit-autofill:focus, input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px var(--color-gray) inset!important;-webkit-text-fill-color:var(--color-white)!important;transition:background-color 5000s ease-in-out 0s;caret-color:var(--color-white)}"]})};function yR(i){let n=i.value?.trim();return/^[A-Za-z---\s]+$/.test(n)?null:{onlyLetters:!0}}function xR(i){let n=i.value;if(!n)return{adult:!0};let e=new Date(n);return new Date().getFullYear()-e.getFullYear()<18?{adult:!0}:null}function mv(i){let n=i.value?.trim();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?null:{emailInvalid:!0}}function gv(i){let n=i.value;return/^(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(n)?null:{weakPassword:!0}}var Lu=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/auth";signUp(n){return console.log("Payload inviato:",n),this.http.post(`${this.baseUrl}/signup`,n)}login(n){return this.http.post(`${this.baseUrl}/login`,n)}loginWithGoogle(n){return this.http.post(`${this.baseUrl}/login/google`,n)}loginWithGoogleCode(n){return this.http.post(`${this.baseUrl}/login/google/code`,n)}verifyEmail(n){return this.http.get(`${this.baseUrl}/verify?token=${n}`)}resendEmail(n){return this.http.post(`${this.baseUrl}/resend-token`,n)}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var _v=class i{scriptLoadingPromise=null;loadScript(){return this.scriptLoadingPromise?this.scriptLoadingPromise:(this.scriptLoadingPromise=new Promise((n,e)=>{if(document.getElementById("google-identity")){n();return}let a=document.createElement("script");a.id="google-identity",a.src="https://accounts.google.com/gsi/client",a.async=!0,a.defer=!0,a.onload=()=>n(),a.onerror=()=>e(new Error("Unable to load Google Identity Services")),document.head.appendChild(a)}),this.scriptLoadingPromise)}getAuthCode(){return Er(this,null,function*(){if(yield this.loadScript(),!ul.googleClientId)throw new Error("Configure the Google Client ID.");let n=ul.googleRedirectUri||window.location.origin;return new Promise((e,a)=>{google.accounts.oauth2.initCodeClient({client_id:ul.googleClientId,scope:"openid email profile",ux_mode:"popup",redirect_uri:n,state:"signin",callback:r=>{if(r&&r.code)e(r.code);else if(r&&r.error){let E=new Error(r.error_description||r.error||"Google sign-in cancelled.");E.code=r.error,a(E)}else a(new Error("Google sign-in cancelled."))}}).requestCode()})})}getIdToken(){return Er(this,null,function*(){if(yield this.loadScript(),!ul.googleClientId)throw new Error("Configure the Google Client ID.");return new Promise((n,e)=>{let a=!1,d=E=>{let P=(E||"").toLowerCase();return P.includes("invalid")?{message:"Configure the Google Client ID.",code:"google_config"}:P.includes("missing")?{message:"Configure the Google Client ID.",code:"google_config"}:P.includes("suppressed")?{message:"Google sign-in cancelled: Google suppressed the prompt (cookie).",code:"google_cancelled"}:P.includes("user_cancel")?{message:"Google sign-in cancelled by the user.",code:"google_cancelled"}:{message:"Google sign-in cancelled.",code:"google_cancelled"}},r=(E,P)=>{if(!a)if(a=!0,P)n(P);else{let k=typeof E=="string"?E:E?.message,X=typeof E=="string"?void 0:E?.code,oe=new Error(k||"Google sign-in cancelled.");X&&(oe.code=X),e(oe)}};google.accounts.id.initialize({client_id:ul.googleClientId,callback:E=>{E&&E.credential?r(void 0,E.credential):r({message:"Google sign-in cancelled.",code:"google_cancelled"})},ux_mode:"popup",use_fedcm_for_prompt:!0,itp_support:!0,cancel_on_tap_outside:!0,auto_select:!1}),google.accounts.id.prompt(E=>{let P=E?.isNotDisplayed?.(),k=E?.isSkippedMoment?.();if(P||k){let X=E?.getNotDisplayedReason?.()||E?.getSkippedReason?.()||"Google sign-in cancelled.";r(d(X))}})})})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var np=class i{constructor(n){this.bp=n;this.bp.observe(["(max-width: 979px)","(min-width: 980px) and (max-width: 1399px)","(min-width: 1400px)"]).subscribe(e=>{e.breakpoints["(max-width: 979px)"]?this.screen.set("mobile"):e.breakpoints["(min-width: 980px) and (max-width: 1399px)"]?this.screen.set("tablet"):this.screen.set("desktop")})}screen=da("desktop");static \u0275fac=function(e){return new(e||i)(dn(jf))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};function Hte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.generalError)}}function Gte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.name)}}function qte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.birthdate)}}function Wte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.email)}}function Zte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.password)}}function Yte(i,n){i&1&&(z(0,"p"),Z(1,"Start joining events"),V())}var gT=class i{constructor(n,e,a,d){this.fb=n;this.auth=e;this.googleIdentity=a;this.responsive=d;this.form=this.fb.group({name:["",[yR]],birthdate:["",[xR]],email:["",[mv]],password:["",[gv]]})}close=new $t;switchToSignIn=new $t;signUpSuccess=new $t;signInSuccess=new $t;form;errors={};generalError=null;onSubmit(){this.errors={},this.generalError=null;let n=this.form.controls;if(yR(n.name)&&(this.errors.name="Il nome deve contenere solo lettere."),xR(n.birthdate)&&(this.errors.birthdate="Devi essere maggiore di 18 anni."),mv(n.email)&&(this.errors.email="Email non valida."),gv(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let E={name:this.form.value.name,birthdate:this.form.value.birthdate,email:this.form.value.email,password:this.form.value.password};this.auth.signUp(E).subscribe({next:P=>{if(this.errors={},this.generalError=null,!P?.success){this.generalError=P?.error||"Registrazione non riuscita.";return}this.signUpSuccess.emit({email:this.form.value.email,token:P?.data?.token||""})},error:P=>{if(this.errors={},this.generalError=null,P&&typeof P=="object"&&"error"in P){let k=P.error;if(k&&typeof k=="object"){if(k.data&&typeof k.data=="object"){this.errors=k.data;return}if(k.error&&typeof k.error=="string"){this.generalError=k.error;return}}if(typeof P.error=="string"){this.generalError=P.error;return}}if(typeof P=="string"){this.generalError=P;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",P)}})}hasError(n){return!!this.errors[n]}closePopup(){this.close.emit()}goToSignIn(){this.switchToSignIn.emit()}signUpWithGoogle(){return Er(this,null,function*(){this.errors={},this.generalError=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:e=>{this.signInSuccess.emit({id:e?.data?.id||"",name:e?.data?.name||"",email:e?.data?.email||""}),this.closePopup()},error:e=>{let a=e?.error;if(a?.data&&typeof a.data=="object"){this.errors=a.data;return}if(typeof a?.error=="string"){this.generalError=a.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}static \u0275fac=function(e){return new(e||i)(Ft(av),Ft(Lu),Ft(_v),Ft(np))};static \u0275cmp=Sn({type:i,selectors:[["SignUpPopup"]],outputs:{close:"close",switchToSignIn:"switchToSignIn",signUpSuccess:"signUpSuccess",signInSuccess:"signInSuccess"},decls:38,vars:26,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header","desktop-header"],[1,"error"],[1,"form"],["placeholder","Full name",3,"error","control","type"],["placeholder","Birthday",3,"error","control","type"],["placeholder","Email",3,"error","control","type"],["placeholder","Password",3,"error","control","type","showToggle"],["type","button",1,"button",3,"click"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.closePopup()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Ae("click",function(){return a.closePopup()}),Z(5,"arrow_back"),V(),z(6,"h1"),Z(7,"Sign Up"),V()(),z(8,"div",5)(9,"div",6)(10,"button",7),Ae("click",function(){return a.closePopup()}),z(11,"mat-icon"),Z(12,"close"),V()(),z(13,"div",8)(14,"h1"),Z(15,"Join LUMO"),V(),Je(16,Hte,2,1,"p",9)(17,Gte,2,1,"p",9)(18,qte,2,1,"p",9)(19,Wte,2,1,"p",9)(20,Zte,2,1,"p",9)(21,Yte,2,0,"p"),V(),z(22,"form",10),Rn(23,"FormField",11)(24,"FormField",12)(25,"FormField",13)(26,"FormField",14),z(27,"button",15),Ae("click",function(){return a.onSubmit()}),Z(28,"Sign Up"),V()(),z(29,"div",16)(30,"p"),Z(31,"or sign up with"),V(),z(32,"a",17),Ae("click",function(){return a.signUpWithGoogle()}),Rn(33,"img",18),V()(),z(34,"p"),Z(35," Already have an account? "),z(36,"span",19),Ae("click",function(){return a.goToSignIn()}),Z(37,"Sign In"),V()()()()()()),e&2&&(hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(),hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(15),et(a.generalError?16:a.errors.name?17:a.errors.birthdate?18:a.errors.email?19:a.errors.password?20:21),J(7),bt("error",a.hasError("name"))("control",a.form.get("name"))("type","text"),J(),bt("error",a.hasError("birthdate"))("control",a.form.get("birthdate"))("type","date"),J(),bt("error",a.hasError("email"))("control",a.form.get("email"))("type","text"),J(),bt("error",a.hasError("password"))("control",a.form.get("password"))("type","password")("showToggle",!0))},dependencies:[tp,Ai,Di,xi,Wh,sv,ov],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:var(--spacing-2xl) 5%;border:var(--modal-border);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:var(--modal-surface);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function Xte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.generalError)}}function Kte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.email)}}function Qte(i,n){if(i&1&&(z(0,"p",9),Z(1),V()),i&2){let e=ne();J(),ct(e.errors.password)}}function Jte(i,n){i&1&&(z(0,"p"),Z(1,"Sign in to LUMO"),V())}var _T=class i{constructor(n,e,a,d,r){this.fb=n;this.auth=e;this.googleIdentity=a;this.router=d;this.responsive=r;this.form=this.fb.group({email:["",[mv]],password:["",[gv]]})}close=new $t;switchToSignUp=new $t;signInSuccess=new $t;form;errors={};generalError=null;closePopup(){this.close.emit()}goToSignUp(){this.switchToSignUp.emit()}onSubmit(){this.errors={},this.generalError=null;let n=this.form.controls;if(mv(n.email)&&(this.errors.email="Email non valida."),gv(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let d={email:this.form.value.email,password:this.form.value.password};this.auth.login(d).subscribe({next:r=>{this.errors={},this.generalError=null,this.signInSuccess.emit({id:r?.data?.id||"",name:r?.data?.name||"",email:r?.data?.email||d.email,profileImage:r?.data?.profileImage}),localStorage.setItem("user",JSON.stringify({id:r?.data?.id||"",name:r?.data?.name||"",email:r?.data?.email||d.email,profileImage:r?.data?.profileImage,isAdmin:r?.data?.isAdmin})),r?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:r=>{if(this.errors={},this.generalError=null,r&&typeof r=="object"&&"error"in r){let E=r.error;if(E&&typeof E=="object"){if(E.data&&typeof E.data=="object"){this.errors=E.data;return}if(E.error&&typeof E.error=="string"){this.generalError=E.error;return}}if(typeof r.error=="string"){this.generalError=r.error;return}}if(typeof r=="string"){this.generalError=r;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",r)}})}signInWithGoogle(){return Er(this,null,function*(){this.errors={},this.generalError=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:e=>{this.signInSuccess.emit({id:e?.data?.id||"",name:e?.data?.name||"",email:e?.data?.email||"",profileImage:e?.data?.profileImage}),localStorage.setItem("user",JSON.stringify(e.data)),e?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:e=>{let a=e?.error;if(a?.data&&typeof a.data=="object"){this.errors=a.data;return}if(typeof a?.error=="string"){this.generalError=a.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}hasError(n){return!!this.errors[n]}static \u0275fac=function(e){return new(e||i)(Ft(av),Ft(Lu),Ft(_v),Ft(bs),Ft(np))};static \u0275cmp=Sn({type:i,selectors:[["SignInPopup"]],outputs:{close:"close",switchToSignUp:"switchToSignUp",signInSuccess:"signInSuccess"},decls:37,vars:22,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header"],[1,"error"],[1,"form"],["placeholder","Email",3,"error","control","type","title"],["placeholder","Password",3,"error","control","type","title","showToggle"],[1,"click-text"],["type","button",1,"button",3,"click"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.closePopup()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Ae("click",function(){return a.closePopup()}),Z(5,"arrow_back"),V(),z(6,"h1"),Z(7,"Sign In"),V()(),z(8,"div",5)(9,"div",6)(10,"button",7),Ae("click",function(){return a.closePopup()}),z(11,"mat-icon"),Z(12,"close"),V()(),z(13,"div",8)(14,"h1"),Z(15,"Welcome back!"),V(),Je(16,Xte,2,1,"p",9)(17,Kte,2,1,"p",9)(18,Qte,2,1,"p",9)(19,Jte,2,0,"p"),V(),z(20,"form",10),Rn(21,"FormField",11)(22,"FormField",12),z(23,"p")(24,"span",13),Z(25,"Forgot password?"),V()(),z(26,"button",14),Ae("click",function(){return a.onSubmit()}),Z(27,"Sign In"),V()(),z(28,"div",15)(29,"p"),Z(30,"or sign in with"),V(),z(31,"a",16),Ae("click",function(){return a.signInWithGoogle()}),Rn(32,"img",17),V()(),z(33,"p"),Z(34," Don\u2019t have an account? "),z(35,"span",18),Ae("click",function(){return a.goToSignUp()}),Z(36,"Sign Up"),V()()()()()()),e&2&&(hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(),hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(15),et(a.generalError?16:a.errors.email?17:a.errors.password?18:19),J(5),bt("error",a.hasError("email"))("control",a.form.get("email"))("type","text")("title","Email"),J(),bt("error",a.hasError("password"))("control",a.form.get("password"))("type","password")("title","Password")("showToggle",!0))},dependencies:[tp,Ai,Di,xi,Wh,sv,ov],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:var(--spacing-2xl) 5%;border:var(--modal-border);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:var(--modal-surface);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{text-align:right;width:100%}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]{gap:var(--spacing-xl)}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function ene(i,n){i&1&&(z(0,"p",5),Z(1,"You have been successfully registered"),V())}function tne(i,n){i&1&&(z(0,"p"),Z(1,"Check your email and click the button"),V())}var vT=class i{constructor(n){this.responsive=n}email;token;verified=!1;close=new $t;resendVerification=new $t;onClose(){this.close.emit()}resend(){this.resendVerification.emit()}closePopup(){this.close.emit()}static \u0275fac=function(e){return new(e||i)(Ft(np))};static \u0275cmp=Sn({type:i,selectors:[["VerifyEmailPopup"]],inputs:{email:"email",token:"token",verified:"verified"},outputs:{close:"close",resendVerification:"resendVerification"},decls:13,vars:13,consts:[[1,"backdrop"],[1,"popup-container"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header"],[1,"success"],[1,"button",3,"click"]],template:function(e,a){e&1&&(Rn(0,"div",0),z(1,"div",1)(2,"div",2)(3,"button",3),Ae("click",function(){return a.closePopup()}),z(4,"mat-icon"),Z(5,"close"),V()(),z(6,"div",4)(7,"h1"),Z(8,"Verify your email"),V(),Je(9,ene,2,0,"p",5)(10,tne,2,0,"p"),V(),z(11,"a",6),Ae("click",function(){return a.resend()}),Z(12,"Resend verification email"),V()()()),e&2&&(hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(),hn("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),J(8),et(a.verified?9:10))},dependencies:[Ai,Di],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:900}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:40px;border:var(--modal-border);display:flex;flex-direction:column;gap:24px}.popup-container.tablet[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:40%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:40px;border:var(--modal-border);display:flex;flex-direction:column;gap:24px}.backdrop.mobile[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100vw;height:100vh}.popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;background:var(--modal-surface);display:flex;justify-content:center;align-items:center;flex-direction:column;padding:1.5rem;height:100%;width:100%;border-radius:0;overflow-y:auto;gap:24px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.error[_ngcontent-%COMP%]{color:var(--color-error)}.success[_ngcontent-%COMP%]{color:#14c972}"]})};var yT=class i{close=new $t;action=new $t;onAction(n){this.action.emit(n),this.close.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Sn({type:i,selectors:[["UserMenu"]],outputs:{close:"close",action:"action"},decls:20,vars:0,consts:[[1,"menu-backdrop",3,"click"],[1,"menu-container"],[1,"menu-header","mobile-header"],[3,"click"],[1,"menu-item-container"],[1,"menu-item",3,"click"],[1,"icon"],[1,"menu-item","logout",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.close.emit()}),V(),z(1,"div",1)(2,"div",2)(3,"mat-icon",3),Ae("click",function(){return a.close.emit()}),Z(4,"arrow_back"),V(),z(5,"h1"),Z(6,"Menu"),V()(),z(7,"div",4)(8,"div",5),Ae("click",function(){return a.onAction("account")}),z(9,"i",6),Z(10,"\u{1F464}"),V(),Z(11," Account "),V(),z(12,"div",5),Ae("click",function(){return a.onAction("my-events")}),z(13,"i",6),Z(14,"\u2795"),V(),Z(15," My events "),V(),z(16,"div",7),Ae("click",function(){return a.onAction("logout")}),z(17,"i",6),Z(18,"\u{1F6AA}"),V(),Z(19," Logout "),V()()())},dependencies:[xi,Ai,Di],styles:["[_nghost-%COMP%]{display:contents}.menu-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent}.menu-container[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 10px);right:0;width:100%;background:var(--color-dark-gray);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:var(--z-dropdown);animation:_ngcontent-%COMP%_menuFadeIn .2s ease-out;transform-origin:top right;overflow:hidden}@keyframes _ngcontent-%COMP%_menuFadeIn{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.menu-item-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-regular);cursor:pointer;width:100%;justify-content:center;transition:all .2s ease;border-bottom:1px solid var(--color-bit-gray)}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;color:var(--color-white)}.menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.menu-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-style:normal;font-size:16px;display:none}.menu-item.logout[_ngcontent-%COMP%]{color:var(--color-error)}.menu-item.logout[_ngcontent-%COMP%]:hover{background:#ff6b6b1a;color:var(--color-error)}.mobile-only[_ngcontent-%COMP%]{display:none!important}@media (max-width: 767px){.menu-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;border-radius:0;z-index:var(--z-popup);padding-top:0;transform-origin:center;background:var(--color-dark-gray);display:flex;flex-direction:column;justify-content:flex-start;align-items:center;background:linear-gradient(160deg,#141414,#0c0c0c);overflow-y:auto}.menu-item[_ngcontent-%COMP%]{width:100%;padding:24px 30px;font-size:28px;border-bottom:1px solid var(--color-bit-gray);justify-content:center}.mobile-only[_ngcontent-%COMP%]{display:flex!important}}"]})};var vv=class i{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/notifications";getNotifications(n){return this.http.get(`${this.apiUrl}?userId=${n}`)}markAsRead(n){return this.http.post(`${this.apiUrl}/${n}/read`,{})}markAllAsRead(n){return this.http.post(`${this.apiUrl}/read-all?userId=${n}`,{})}updateType(n,e){return this.http.post(`${this.apiUrl}/${n}/type?newType=${e}`,{})}deleteNotification(n){return this.http.delete(`${this.apiUrl}/${n}`)}deleteReadNotifications(n){return this.http.delete(`${this.apiUrl}/read?userId=${n}`)}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var nne=(i,n)=>n.id;function ine(i,n){i&1&&(z(0,"div",7),Z(1,"No notifications"),V())}function rne(i,n){if(i&1){let e=wt();z(0,"div",16)(1,"div",20),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne(2);return De(E.acceptRequest(r,d))}),z(2,"mat-icon"),Z(3,"check"),V()(),z(4,"div",21),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne(2);return De(E.rejectRequest(r,d))}),z(5,"mat-icon"),Z(6,"close"),V()()()}}function one(i,n){i&1&&(z(0,"div",17)(1,"mat-icon"),Z(2,"check_circle"),V(),Z(3," Accepted "),V())}function sne(i,n){i&1&&(z(0,"div",18)(1,"mat-icon"),Z(2,"cancel"),V(),Z(3," Rejected "),V())}function ane(i,n){if(i&1){let e=wt();z(0,"div",22),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne(2);return De(E.toggleExpand(r.id,d))}),z(1,"mat-icon"),Z(2),V()()}if(i&2){let e=ne().$implicit,a=ne(2);J(2),ct(a.expandedId===e.id?"expand_less":"expand_more")}}function lne(i,n){if(i&1){let e=wt();z(0,"div",9),Ae("click",function(){let d=Me(e).$implicit,r=ne(2);return De(r.onNotificationClick(d))}),z(1,"div",10)(2,"mat-icon"),Z(3),V()(),z(4,"div",11)(5,"div",12)(6,"span",13),Z(7),V(),z(8,"span",14),Z(9),Ls(10,"date"),V()(),z(11,"div",15),Z(12),V(),Je(13,rne,7,0,"div",16),Je(14,one,4,0,"div",17),Je(15,sne,4,0,"div",18),Je(16,ane,3,1,"div",19),V()()}if(i&2){let e=n.$implicit,a=ne(2);hn("unread",!e.isRead),J(2),jo("color",a.getIconColor(e.type)),J(),ct(a.getIcon(e.type)),J(4),ct(e.title),J(2),ct(D_(10,14,e.createdAt,"short")),J(2),hn("expanded",a.expandedId===e.id),J(),Zi(" ",e.message," "),J(),et(e.type==="PARTICIPATION_REQUEST"?13:-1),J(),et(e.type==="REQUEST_ACCEPTED"?14:-1),J(),et(e.type==="REQUEST_REJECTED"?15:-1),J(),et(e.message.length>100?16:-1)}}function cne(i,n){if(i&1&&qi(0,lne,17,17,"div",8,nne),i&2){let e=ne();Wi(e.notifications)}}var xT=class i{constructor(n,e,a){this.notifService=n;this.eventService=e;this.eRef=a}userId;close=new $t;openChat=new $t;notifications=[];expandedId=null;ngOnInit(){this.loadNotifications()}loadNotifications(){this.userId&&this.notifService.getNotifications(this.userId).subscribe(n=>{this.notifications=n.map(e=>this.translateNotification(e))})}translateNotification(n){let e=(n.message||"").match(/["']([^"']+)["']/g)?.map(r=>r.slice(1,-1))||[],a=e.length?e[e.length-1]:"",d=e[0]||"";switch(n.type){case"APPROVED":n.title="Event Approved",a?n.message=`Your event '${a}' has been approved and is now visible!`:n.message="Your event has been approved and is now visible!";break;case"REJECTED":n.title="Event Rejected",a?n.message=`Your event '${a}' has been rejected.`:n.message="Your event has been rejected.";break;case"PARTICIPATION_REQUEST":n.title="Participation Request",e.length>=2?n.message=`User '${d}' wants to join event '${a}'.`:a?n.message=`A user wants to join event '${a}'.`:n.message="A user requested to join your event.";break;case"PARTICIPATION_ACCEPTED":n.title="Request Accepted",n.message="Your request to join the event has been accepted!";break;case"PARTICIPATION_REJECTED":n.title="Request Rejected",n.message="Your request to join the event has been rejected.";break;case"PARTICIPATION_REMOVED":n.title="Removed from Event",a?n.message=`You have been removed from the event '${a}'.`:n.message="You have been removed from the event.";break;case"REQUEST_ACCEPTED":n.title="Request Accepted";break;case"REQUEST_REJECTED":n.title="Request Rejected";break;case"CHAT_MESSAGE":n.title="New chat message";break}return n}toggleExpand(n,e){e.stopPropagation(),this.expandedId=this.expandedId===n?null:n}deleteRead(){this.userId&&this.notifService.deleteReadNotifications(this.userId).subscribe({next:()=>{this.notifications=this.notifications.filter(n=>!n.isRead)},error:n=>console.error("Error deleting read notifications",n)})}acceptRequest(n,e){e.stopPropagation(),console.log("Attempting to accept request:",n),n.relatedEventId&&n.relatedUserId?(console.log("IDs found, calling service..."),this.eventService.acceptParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{console.log("Participation accepted successfully"),this.notifService.updateType(n.id,"REQUEST_ACCEPTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:a=>console.error("Error accepting participation",a)})):console.error("Missing relatedEventId or relatedUserId in notification:",n)}rejectRequest(n,e){e.stopPropagation(),n.relatedEventId&&n.relatedUserId&&this.eventService.rejectParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{this.notifService.updateType(n.id,"REQUEST_REJECTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:a=>console.error("Error rejecting participation",a)})}delete(n,e){n.stopPropagation(),this.notifService.deleteNotification(e.id).subscribe({next:()=>{this.notifications=this.notifications.filter(a=>a.id!==e.id)},error:a=>console.error("Error deleting notification",a)})}onNotificationClick(n){if(n.type==="CHAT_MESSAGE"){if(!n.relatedEventId){console.error("Missing relatedEventId in chat notification:",n);return}this.openChat.emit(n.relatedEventId),this.close.emit()}}getIcon(n){switch(n){case"APPROVED":return"check_circle";case"REJECTED":return"cancel";case"FOLLOWUP":return"event_available";case"PARTICIPATION_REQUEST":return"person_add";case"PARTICIPATION_ACCEPTED":return"how_to_reg";case"PARTICIPATION_REJECTED":return"person_remove";case"PARTICIPATION_REMOVED":return"person_remove";case"REQUEST_ACCEPTED":return"check_circle";case"REQUEST_REJECTED":return"cancel";case"CHAT_MESSAGE":return"chat";case"SUCCESS":return"check_circle";case"ERROR":return"error";case"WARNING":return"warning";default:return"notifications"}}getIconColor(n){switch(n){case"APPROVED":return"var(--color-accent)";case"REJECTED":return"#ff4444";case"FOLLOWUP":return"#4caf50";case"PARTICIPATION_REQUEST":return"#2196f3";case"PARTICIPATION_ACCEPTED":return"#4caf50";case"PARTICIPATION_REJECTED":return"#ff4444";case"PARTICIPATION_REMOVED":return"#ff4444";case"CHAT_MESSAGE":return"var(--color-accent)";default:return"white"}}static \u0275fac=function(e){return new(e||i)(Ft(vv),Ft(Zs),Ft(pr))};static \u0275cmp=Sn({type:i,selectors:[["notification-menu"]],inputs:{userId:"userId"},outputs:{close:"close",openChat:"openChat"},decls:14,vars:1,consts:[[1,"notif-container"],[1,"notif-header"],[1,"mobile-only","back-arrow",3,"click"],[1,"title-wrap"],[1,"header-actions"],["title","Delete read notifications",1,"pill-btn",3,"click"],[1,"notif-list"],[1,"empty-state"],[1,"notif-item",3,"unread"],[1,"notif-item",3,"click"],[1,"icon-section"],[1,"content-section"],[1,"notif-top"],[1,"notif-title"],[1,"notif-time"],[1,"notif-msg"],[1,"action-buttons"],[1,"status-msg","success"],[1,"status-msg","error"],[1,"expand-btn"],["title","Accept",1,"btn-approve",3,"click"],["title","Reject",1,"btn-reject",3,"click"],[1,"expand-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"mat-icon",2),Ae("click",function(){return a.close.emit()}),Z(3,"arrow_back"),V(),z(4,"div",3)(5,"h1"),Z(6,"Notifications"),V()(),z(7,"div",4)(8,"button",5),Ae("click",function(){return a.deleteRead()}),z(9,"mat-icon"),Z(10,"delete_sweep"),V()()()(),z(11,"div",6),Je(12,ine,2,0,"div",7)(13,cne,2,0),V()()),e&2&&(J(12),et(a.notifications.length===0?12:13))},dependencies:[xi,Ai,Di,yx],styles:[".notif-container[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);border:1px solid rgba(255,255,255,.08);width:340px;border-radius:18px;box-shadow:0 18px 48px #00000073;overflow:hidden;display:flex;flex-direction:column;max-height:460px;color:var(--color-white);font-family:var(--font-stack-headline)}.notif-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;column-gap:12px;height:64px;padding:0 20px;border-bottom:1px solid rgba(255,255,255,.08);background:radial-gradient(circle at 20% 20%,rgba(252,195,36,.1),transparent 38%)}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:var(--font-weight-bold);letter-spacing:.2px;display:flex;padding-bottom:0;align-items:center;height:40px;line-height:1}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex:1;height:40px;color:var(--color-white)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end}.pill-btn[_ngcontent-%COMP%]{width:40px;height:40px;display:grid;place-items:center;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#ffffff0d;color:var(--color-white);cursor:pointer;transition:background .2s,border-color .2s,transform .1s,color .2s}.pill-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fff3;transform:translateY(-1px)}.pill-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.pill-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.notif-list[_ngcontent-%COMP%]{overflow-y:auto;max-height:380px;padding:8px 4px 10px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-dark-gray)}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-bit-gray);border-radius:3px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-light-gray)}.notif-item[_ngcontent-%COMP%]{display:flex;padding:12px 14px;margin:6px 8px;border-radius:14px;border:1px solid rgba(255,255,255,.06);transition:background .2s,border-color .2s,transform .15s;align-items:flex-start;gap:var(--spacing-md);position:relative;background:#ffffff05}.notif-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#ffffff1f;transform:translateY(-1px)}.notif-item.unread[_ngcontent-%COMP%]{background:#fcc32414;border-color:#fcc3243d}.icon-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-top:2px}.content-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-width:0}.notif-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:var(--spacing-xs)}.notif-title[_ngcontent-%COMP%]{font-weight:var(--font-weight-semibold);font-size:14px;color:var(--color-white)}.notif-time[_ngcontent-%COMP%]{font-size:10px;opacity:.6;margin-left:var(--spacing-sm);white-space:nowrap}.notif-msg[_ngcontent-%COMP%]{font-size:13px;opacity:.82;line-height:1.45;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;transition:max-height .3s ease}.notif-msg.expanded[_ngcontent-%COMP%]{-webkit-line-clamp:unset;overflow:visible}.expand-btn[_ngcontent-%COMP%]{cursor:pointer;opacity:.6;transition:opacity .2s;display:flex;align-items:center;justify-content:center}.expand-btn[_ngcontent-%COMP%]:hover{opacity:1}.empty-state[_ngcontent-%COMP%]{padding:28px 18px 34px;text-align:center;opacity:.6;font-style:italic;font-size:13px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);margin-left:auto;align-items:center;padding-left:var(--spacing-sm);margin-top:8px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s,background-color .2s}.btn-approve[_ngcontent-%COMP%]{background-color:#4caf5033;color:#4caf50}.btn-approve[_ngcontent-%COMP%]:hover{background-color:#4caf5066;transform:scale(1.1)}.btn-reject[_ngcontent-%COMP%]{background-color:#f4433633;color:#f44336}.btn-reject[_ngcontent-%COMP%]:hover{background-color:#f4433666;transform:scale(1.1)}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.status-msg[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:12px;font-weight:var(--font-weight-medium);margin-left:auto;padding-left:var(--spacing-sm);white-space:nowrap;margin-top:5px}.status-msg[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.status-msg.success[_ngcontent-%COMP%]{color:#4caf50}.status-msg.error[_ngcontent-%COMP%]{color:#f44336}@media (max-width: 768px){.notif-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;max-height:none;border-radius:0;z-index:100001;background-color:var(--color-dark-gray)}.notif-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:1px solid rgba(255,255,255,.1)}.title-wrap[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.header-actions[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:flex;align-items:center;height:100%;top:0}.notif-list[_ngcontent-%COMP%]{max-height:none;flex:1;padding-bottom:20px}.notif-item[_ngcontent-%COMP%]{padding:var(--spacing-lg)}.notif-title[_ngcontent-%COMP%]{font-size:18px}.notif-msg[_ngcontent-%COMP%]{font-size:16px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:44px;height:44px}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}}"]})};var bT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";moderationUrl="http://localhost:8080/api/moderation";getMessages(n,e,a=100){let d=new URLSearchParams;return e!=null&&d.set("userId",String(e)),d.set("limit",String(a)),this.http.get(`${this.baseUrl}/${n}/chat/messages?${d.toString()}`)}sendMessage(n,e,a){return this.http.post(`${this.baseUrl}/${n}/chat/messages?userId=${e}`,{content:a})}connect(n,e,a){let d=new EventSource(`${this.baseUrl}/${n}/chat/stream?userId=${e}`),r=E=>P=>{a(E,JSON.parse(P.data))};return d.addEventListener("message",r("message")),d.addEventListener("poll",r("poll")),d.addEventListener("poll-vote",r("poll-vote")),d.addEventListener("poll-close",r("poll-close")),d.addEventListener("mute",r("mute")),d}getMuteStatus(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/mute-status?userId=${e}`)}getMutes(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/mutes?userId=${e}`)}muteUser(n,e,a,d){return this.http.post(`${this.baseUrl}/${n}/chat/mutes?userId=${e}`,{targetUserId:a,reason:d})}unmuteUser(n,e,a){return this.http.delete(`${this.baseUrl}/${n}/chat/mutes/${a}?userId=${e}`)}getPolls(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/polls?userId=${e}`)}createPoll(n,e,a,d,r){return this.http.post(`${this.baseUrl}/${n}/chat/polls/open?userId=${e}`,{question:a,options:d,endsAt:r})}votePoll(n,e,a,d){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${e}/votes?userId=${a}`,{optionIds:d})}closePoll(n,e,a){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${e}/close?userId=${a}`,{})}getBannedWords(){return this.http.get(`${this.moderationUrl}/banned-words`)}checkMessage(n){return this.http.post(`${this.moderationUrl}/check`,{content:n})}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var dne=["messagesContainer"];function hne(i,n){if(i&1){let e=wt();z(0,"button",30),Ae("click",function(d){Me(e);let r=ne(2);return r.togglePin(r.pinnedItem,r.pinnedType),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2,"close"),V()()}}function pne(i,n){if(i&1){let e=wt();z(0,"div",24),Ae("click",function(){Me(e);let d=ne();return De(d.scrollToItem(d.pinnedId,d.pinnedType))}),z(1,"mat-icon",25),Z(2,"push_pin"),V(),z(3,"div",26)(4,"span",27),Z(5),V(),z(6,"span",28),Z(7),V()(),ji(8,hne,3,0,"button",29),V()}if(i&2){let e=ne();J(5),ct(e.getPinnedSenderName()),J(2),ct(e.getPinnedDisplayText()),J(),bt("ngIf",e.isOrganizer)}}function fne(i,n){if(i&1&&(z(0,"a",35),Z(1,"Open link"),V()),i&2){let e=ne().$implicit;bt("href",e.link,to)}}function mne(i,n){if(i&1&&(z(0,"div",31)(1,"div",32),Z(2),V(),z(3,"div",33),Z(4),V(),ji(5,fne,2,1,"a",34),V()),i&2){let e=n.$implicit;Jo("id",e.anchorId),J(2),ct(e.label),J(2),ct(e.content),J(),bt("ngIf",e.link)}}function gne(i,n){if(i&1&&Rn(0,"img",49),i&2){let e=ne(2).$implicit;bt("src",e.message.senderImage,to)}}function _ne(i,n){if(i&1&&(z(0,"div",50),Z(1),V()),i&2){let e=ne(2).$implicit;J(),Zi(" ",e.message.senderName.slice(0,1)||"?"," ")}}function vne(i,n){if(i&1){let e=wt();z(0,"div",51),Ae("click",function(d){return Me(e),De(d.stopPropagation())}),z(1,"button",52),Ae("click",function(d){Me(e);let r=ne(2).$implicit,E=ne();return De(E.togglePinFromMenu(r.message,"message",d))}),z(2,"mat-icon"),Z(3,"push_pin"),V()()()}if(i&2){let e=ne(2).$implicit,a=ne();J(),hn("active",a.isPinned(e.message.id,"message"))("unpin",a.isPinned(e.message.id,"message")),Jo("aria-label",a.isPinned(e.message.id,"message")?"Unpin":"Pin message")}}function yne(i,n){if(i&1){let e=wt();z(0,"div",39),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne();return De(E.openPinMenu(r.message,"message",d))}),z(1,"div",40),ji(2,gne,1,1,"img",41)(3,_ne,2,1,"div",42),V(),z(4,"div",43)(5,"div",44)(6,"span",45),Z(7),V(),z(8,"span",46),Z(9),V(),Je(10,vne,4,5,"div",47),V(),z(11,"div",48),Z(12),V()()()}if(i&2){let e=ne().$implicit,a=ne();hn("mine",a.currentUserId&&e.message.senderId.toString()===a.currentUserId)("pin-enabled",a.isOrganizer),Jo("id",a.getItemAnchorId(e.message.id,"message")),J(2),bt("ngIf",e.message.senderImage),J(),bt("ngIf",!e.message.senderImage),J(4),ct(e.message.senderName),J(2),ct(a.formatTimestamp(e.message.createdAt)),J(),et(a.isOrganizer&&a.activePinId===e.message.id&&a.activePinType==="message"?10:-1),J(2),ct(e.message.content)}}function xne(i,n){if(i&1){let e=wt();z(0,"div",51),Ae("click",function(d){return Me(e),De(d.stopPropagation())}),z(1,"button",52),Ae("click",function(d){Me(e);let r=ne(2).$implicit,E=ne();return De(E.togglePinFromMenu(r.poll,"poll",d))}),z(2,"mat-icon"),Z(3,"push_pin"),V()()()}if(i&2){let e=ne(2).$implicit,a=ne();J(),hn("active",a.isPinned(e.poll.id,"poll"))("unpin",a.isPinned(e.poll.id,"poll")),Jo("aria-label",a.isPinned(e.poll.id,"poll")?"Unpin":"Pin poll")}}function bne(i,n){if(i&1){let e=wt();z(0,"div",63),Ae("click",function(){let d=Me(e).$implicit,r=ne(2).$implicit,E=ne();return De(E.toggleVote(r.poll,d.id))}),z(1,"div",64)(2,"span"),Z(3),V(),z(4,"span",65),Z(5),V()(),z(6,"div",66),Rn(7,"div",67),V()()}if(i&2){let e=n.$implicit,a=ne(2).$implicit,d=ne();hn("selected",d.pollSelections[a.poll.id]==null?null:d.pollSelections[a.poll.id].has(e.id))("closed",a.poll.closed),J(3),ct(e.text),J(2),ct(d.getPollOptionCount(e)),J(2),jo("width",d.getPollBarWidth(a.poll,e))}}function wne(i,n){if(i&1){let e=wt();z(0,"button",68),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne();return De(r.closePoll(d.poll))}),Z(1," Chiudi sondaggio "),V()}if(i&2){let e=ne(2).$implicit;bt("disabled",e.poll.closed)}}function Cne(i,n){if(i&1){let e=wt();z(0,"div",53),Ae("click",function(d){Me(e);let r=ne().$implicit,E=ne();return De(E.openPinMenu(r.poll,"poll",d))}),z(1,"div",54)(2,"div",55)(3,"span",56),Z(4,"Sondaggio"),V(),z(5,"span",46),Z(6),V()(),Je(7,xne,4,5,"div",47),V(),z(8,"div",57),Z(9),V(),z(10,"div",58),ji(11,bne,8,8,"div",59),V(),z(12,"div",60),ji(13,wne,2,1,"button",61),V(),z(14,"div",62),Z(15),V()()}if(i&2){let e=ne().$implicit,a=ne();hn("pin-enabled",a.isOrganizer),Jo("id",a.getItemAnchorId(e.poll.id,"poll")),J(6),ct(a.formatTimestamp(e.poll.createdAt)),J(),et(a.isOrganizer&&a.activePinId===e.poll.id&&a.activePinType==="poll"?7:-1),J(2),ct(e.poll.question),J(2),bt("ngForOf",e.poll.options),J(2),bt("ngIf",a.isOrganizer),J(2),Zi("Totale voti: ",a.getPollTotalVotes(e.poll))}}function Ene(i,n){if(i&1&&(z(0,"div",36),Je(1,yne,13,11,"div",37),Je(2,Cne,16,9,"div",38),V()),i&2){let e=n.$implicit;J(),et(e.type==="message"&&e.message?1:-1),J(),et(e.type==="poll"&&e.poll?2:-1)}}function Sne(i,n){i&1&&(z(0,"div",69),Z(1," Nessun messaggio ancora. "),V())}function Tne(i,n){i&1&&(z(0,"div",70),Z(1," Sei stato mutato: puoi leggere ma non inviare messaggi. "),V())}function Ine(i,n){if(i&1){let e=wt();z(0,"button",71),Ae("click",function(){Me(e);let d=ne();return De(d.openPollPopup())}),z(1,"mat-icon"),Z(2,"add"),V()()}if(i&2){let e=ne();bt("disabled",e.isMuted)}}function Mne(i,n){if(i&1&&(z(0,"div",72),Z(1),V()),i&2){let e=ne();J(),ct(e.messageError)}}function Dne(i,n){if(i&1){let e=wt();z(0,"button",87),Ae("click",function(){Me(e);let d=ne().index,r=ne(2);return De(r.removePollOption(d))}),z(1,"mat-icon"),Z(2,"remove_circle_outline"),V()()}}function Ane(i,n){if(i&1){let e=wt();z(0,"div",84)(1,"input",85),vo("ngModelChange",function(d){let r=Me(e).index,E=ne(2);return To(E.pollOptions[r],d)||(E.pollOptions[r]=d),De(d)}),V(),ji(2,Dne,3,0,"button",86),V()}if(i&2){let e=n.index,a=ne(2);J(),_o("ngModel",a.pollOptions[e]),bt("placeholder","Opzione "+(e+1)),J(),bt("ngIf",a.pollOptions.length>2)}}function Pne(i,n){if(i&1){let e=wt();z(0,"button",88),Ae("click",function(){Me(e);let d=ne(2);return De(d.addPollOption())}),z(1,"mat-icon"),Z(2,"add"),V(),Z(3," Aggiungi opzione "),V()}}function One(i,n){if(i&1&&(z(0,"div",89),Z(1),V()),i&2){let e=ne(2);J(),ct(e.pollError)}}function Rne(i,n){if(i&1){let e=wt();z(0,"div",73),Ae("click",function(){Me(e);let d=ne();return De(d.closePollPopup())}),z(1,"div",74),Ae("click",function(d){return Me(e),De(d.stopPropagation())}),z(2,"div",75)(3,"span"),Z(4,"Crea sondaggio"),V(),z(5,"button",76),Ae("click",function(){Me(e);let d=ne();return De(d.closePollPopup())}),z(6,"mat-icon"),Z(7,"close"),V()()(),z(8,"div",77)(9,"input",78),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.pollQuestion,d)||(r.pollQuestion=d),De(d)}),V(),z(10,"div",79),ji(11,Ane,3,3,"div",80),V(),ji(12,Pne,4,0,"button",81)(13,One,2,1,"div",82),z(14,"button",83),Ae("click",function(){Me(e);let d=ne();return De(d.createPoll())}),Z(15,"Crea sondaggio"),V()()()()}if(i&2){let e=ne();J(9),_o("ngModel",e.pollQuestion),J(2),bt("ngForOf",e.pollOptions)("ngForTrackBy",e.trackByIndex),J(),bt("ngIf",e.pollOptions.length<5),J(),bt("ngIf",e.pollError)}}var yv=class i{constructor(n){this.chatService=n}event;currentUserId=null;close=new $t;messagesContainer;messages=[];polls=[];mutes=[];mutedUserIds=new Set;isMuted=!1;isOrganizer=!1;messageText="";pollQuestion="";pollOptions=["","",""];pollSelections={};pollError="";showPollPopup=!1;pinnedId=null;pinnedType=null;pinnedItem=null;activePinId=null;activePinType=null;bannedPatterns=[];bannedRaw=[];messageError="";timelineItems=[];infoMessages=[];eventSource=null;ngOnInit(){this.initializeChat()}ngOnChanges(n){(n.event||n.currentUserId)&&this.initializeChat()}ngOnDestroy(){this.persistMessages(),this.eventSource?.close()}onClose(){this.close.emit()}openPollPopup(){this.pollQuestion="",this.pollOptions=["","",""],this.pollError="",this.showPollPopup=!0}closePollPopup(){this.showPollPopup=!1,this.pollError=""}addPollOption(){this.pollOptions.length<5&&this.pollOptions.push("")}removePollOption(n){this.pollOptions.length>2&&this.pollOptions.splice(n,1)}trackByIndex(n,e){return n}sendMessage(){if(!this.currentUserId||!this.messageText.trim())return;let n=this.messageText.trim();if(this.messageText="",this.isBannedMessage(n)){this.messageError="Messaggio non consentito.";return}this.messageError="",this.chatService.checkMessage(n).subscribe({next:e=>{if(e?.banned){this.messageError="Messaggio non consentito.";return}this.chatService.sendMessage(this.event.id,this.currentUserId,n).subscribe({next:a=>{this.addMessage(a)},error:a=>{let d=a?.error?.data?.content||a?.error?.error;d&&(this.messageError=d),console.error("Error sending message",a)}})},error:e=>{this.messageError="Messaggio non consentito.",console.error("Error checking message",e)}})}createPoll(){if(!this.currentUserId||!this.pollQuestion.trim())return;let n=this.pollOptions.map(d=>d.trim()).filter(Boolean);if(n.length<2){this.pollError="Inserisci almeno due opzioni.";return}if(n.length>5){this.pollError="Massimo 5 opzioni consentite.";return}let a=new Date(Date.now()+1e3*60*60*24*365*10).toISOString().split(".")[0];this.chatService.createPoll(this.event.id,this.currentUserId,this.pollQuestion.trim(),n,a).subscribe({next:d=>{this.upsertPoll(d),this.pollQuestion="",this.pollOptions=["","",""],this.showPollPopup=!1,this.pollError="",this.loadPolls()},error:d=>{console.error("Error creating poll",d),this.pollError="Errore nella creazione del sondaggio."}})}toggleVote(n,e){!this.currentUserId||n.closed||this.chatService.votePoll(this.event.id,n.id,this.currentUserId,[e]).subscribe({next:a=>this.upsertPoll(a),error:a=>console.error("Error voting poll",a)})}closePoll(n){this.currentUserId&&this.chatService.closePoll(this.event.id,n.id,this.currentUserId).subscribe({next:e=>this.upsertPoll(e),error:e=>console.error("Error closing poll",e)})}muteUser(n){this.currentUserId&&this.chatService.muteUser(this.event.id,this.currentUserId,n.id).subscribe({next:e=>{this.mutes=[...this.mutes.filter(a=>a.userId!==e.userId),e],this.mutedUserIds.add(e.userId)},error:e=>console.error("Error muting user",e)})}unmuteUser(n){this.currentUserId&&this.chatService.unmuteUser(this.event.id,this.currentUserId,n.id).subscribe({next:()=>{this.mutes=this.mutes.filter(e=>e.userId!==n.id),this.mutedUserIds.delete(n.id)},error:e=>console.error("Error unmuting user",e)})}isUserMuted(n){return this.mutedUserIds.has(n)}getParticipants(){return this.event.acceptedUsersList||[]}formatTimestamp(n){return n?new Date(n).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):""}formatDateTime(n){return n?new Date(n).toLocaleString("it-IT",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):""}getOptionVoters(n){return!n.voters||n.voters.length===0?"":n.voters.map(e=>e.userName).join(", ")}rebuildTimelineItems(){let n=[];this.messages.forEach(e=>n.push({type:"message",createdAt:e.createdAt,message:e})),this.polls.forEach(e=>n.push({type:"poll",createdAt:e.createdAt,poll:e})),this.timelineItems=n.sort((e,a)=>new Date(e.createdAt).getTime()-new Date(a.createdAt).getTime())}getPollTotalVotes(n){return n.options.reduce((e,a)=>e+(a.voters?.length||0),0)}getPollOptionCount(n){return n.voters?.length||0}getPollBarWidth(n,e){let a=this.getPollTotalVotes(n);if(!a)return"0%";let d=this.getPollOptionCount(e);return`${Math.round(d/a*100)}%`}getPinnedSenderName(){return this.pinnedItem?this.pinnedType==="poll"?"Sondaggio":this.pinnedItem.senderName||"Utente":""}getPinnedDisplayText(){return this.pinnedItem?this.pinnedType==="poll"?this.pinnedItem.question:this.pinnedItem.content:""}isPinned(n,e){return this.pinnedId===n&&this.pinnedType===e}openPinMenu(n,e,a){this.isOrganizer&&(a.stopPropagation(),this.activePinId=n.id,this.activePinType=e)}closePinMenu(){this.activePinId=null,this.activePinType=null}togglePinFromMenu(n,e,a){a.stopPropagation(),this.togglePin(n,e),this.activePinId=null,this.activePinType=null}togglePin(n,e){this.pinnedId===n.id&&this.pinnedType===e?(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null):(this.pinnedId=n.id,this.pinnedType=e,this.pinnedItem=n),this.persistPinnedItem()}scrollToItem(n,e){this.scrollToAnchor(this.getItemAnchorId(n,e))}scrollToAnchor(n){let e=this.messagesContainer?.nativeElement;if(!e)return;let a=e.querySelector(`#${n}`);if(!a)return;let d=e.getBoundingClientRect().top,r=a.getBoundingClientRect().top;e.scrollTo({top:e.scrollTop+r-d-12,behavior:"smooth"})}getItemAnchorId(n,e){return`chat-${e}-${n}`}getMessageAnchorId(n){return this.getItemAnchorId(n,"message")}loadBannedWords(){this.chatService.getBannedWords().subscribe({next:n=>this.buildBannedPatterns(n),error:n=>console.error("Error loading banned words",n)})}loadData(){this.currentUserId&&(this.chatService.getMessages(this.event.id).subscribe({next:n=>{n.length===0&&this.messages.length>0||(this.messages=n,this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())},error:n=>console.error("Error loading messages",n)}),this.loadPolls(),this.chatService.getMuteStatus(this.event.id,this.currentUserId).subscribe({next:n=>this.isMuted=n.muted,error:n=>console.error("Error loading mute status",n)}),this.isOrganizer&&this.chatService.getMutes(this.event.id,this.currentUserId).subscribe({next:n=>{this.mutes=n,this.mutedUserIds=new Set(n.map(e=>e.userId))},error:n=>console.error("Error loading mutes",n)}))}connectStream(){this.currentUserId&&(this.eventSource?.close(),this.eventSource=this.chatService.connect(this.event.id,this.currentUserId,(n,e)=>{if(n==="message"&&this.addMessage(e),(n==="poll"||n==="poll-vote"||n==="poll-close")&&this.upsertPoll(e),n==="mute"){let a=e;a.muted?this.mutedUserIds.add(a.userId):this.mutedUserIds.delete(a.userId),this.currentUserId&&Number(this.currentUserId)===a.userId&&(this.isMuted=a.muted)}}))}loadPolls(){this.currentUserId&&this.chatService.getPolls(this.event.id,this.currentUserId).subscribe({next:n=>{this.polls=n,n.forEach(e=>this.syncPollSelections(e)),this.rebuildTimelineItems(),this.scrollToBottom()},error:n=>console.error("Error loading polls",n)})}toIsoLocal(n){if(!n)return null;if(n.includes("T"))return n;let a=n.trim().match(/^(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})$/);if(!a)return null;let[,d,r,E,P,k]=a;return`${E}-${r}-${d}T${P}:${k}`}upsertPoll(n){let e=this.polls.findIndex(d=>d.id===n.id),a=e<0;if(a)this.polls=[n,...this.polls];else{let d=[...this.polls];d[e]=n,this.polls=d}this.syncPollSelections(n),this.rebuildTimelineItems(),a&&this.scrollToBottom()}syncPollSelections(n){if(!this.currentUserId)return;let e=new Set;n.options.forEach(a=>{a.voters?.some(r=>r.userId===Number(this.currentUserId))&&e.add(a.id)}),this.pollSelections[n.id]=e}addMessage(n){this.messages.some(e=>e.id===n.id)||(this.messages=[...this.messages,n],this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())}initializeChat(){this.event&&(this.messages=this.getCachedMessages(),this.loadPinnedItem(),this.buildInfoMessages(),this.rebuildTimelineItems(),this.activePinId=null,this.activePinType=null,this.loadBannedWords(),this.currentUserId&&(this.isOrganizer=this.event.creatorId?.toString()===this.currentUserId,this.loadData(),this.connectStream()))}getCacheKeys(){if(!this.event?.id)return[];let n=[`chat-cache:${this.event.id}`];return this.currentUserId&&n.push(`chat-cache:${this.event.id}:${this.currentUserId}`),n}getCachedMessages(){let n=this.getCacheKeys();if(n.length===0)return[];let e=new Map;for(let a of n){let d=localStorage.getItem(a);if(d)try{let r=JSON.parse(d);if(!Array.isArray(r))continue;r.forEach(E=>{E&&typeof E.id=="number"&&e.set(E.id,E)})}catch{continue}}return Array.from(e.values()).sort((a,d)=>new Date(a.createdAt).getTime()-new Date(d.createdAt).getTime())}persistMessages(){let n=this.getCacheKeys();if(n.length===0)return;let e=JSON.stringify(this.messages);n.forEach(a=>localStorage.setItem(a,e))}pinnedStorageKey(){return this.event?.id?`chat-pins:${this.event.id}`:null}loadPinnedItem(){let n=this.pinnedStorageKey();if(!n)return;let e=localStorage.getItem(n);if(!e){this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null;return}try{let a=JSON.parse(e);a&&typeof a.id=="number"?(this.pinnedId=a.id,this.pinnedType=a.type,this.refreshPinnedItem()):(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null)}catch{this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null}}persistPinnedItem(){let n=this.pinnedStorageKey();n&&(this.pinnedId!==null&&this.pinnedType!==null?localStorage.setItem(n,JSON.stringify({id:this.pinnedId,type:this.pinnedType})):localStorage.removeItem(n))}refreshPinnedItem(){if(this.pinnedId===null||this.pinnedType===null){this.pinnedItem=null;return}this.pinnedType==="message"?this.pinnedItem=this.messages.find(n=>n.id===this.pinnedId)||null:this.pinnedItem=this.polls.find(n=>n.id===this.pinnedId)||null}buildInfoMessages(){let n=[],e=this.formatEventTime();e&&n.push({key:"time",label:"Time",content:e,anchorId:"chat-info-time"});let a=this.formatEventPlace();a&&n.push({key:"place",label:"Location",content:a,anchorId:"chat-info-place"});let d=this.getMapLink();d&&n.push({key:"link",label:"Map Link",content:d,anchorId:"chat-info-link",link:d}),this.infoMessages=n}formatEventTime(){if(!this.event)return"";let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):"",a=this.event.endTime?this.event.endTime.slice(0,5):"",d=n?n.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"short"}):"",r=[e,a].filter(Boolean).join(" - ");return[d,r].filter(Boolean).join(" ")}formatEventPlace(){return this.event?this.event.city?this.event.city:Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`${this.event.latitude.toFixed(5)}, ${this.event.longitude.toFixed(5)}`:"":""}getMapLink(){return this.event?Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`:this.event.city?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.event.city)}`:"":""}scrollToBottom(){requestAnimationFrame(()=>{this.doScrollToBottom(),setTimeout(()=>this.doScrollToBottom(),50),setTimeout(()=>this.doScrollToBottom(),150)})}doScrollToBottom(){let n=this.messagesContainer?.nativeElement;n&&(n.scrollTop=n.scrollHeight)}buildBannedPatterns(n){this.bannedPatterns=[],this.bannedRaw=[],Array.isArray(n)&&n.forEach(e=>{let a=this.normalizeContent(e);if(!a){e&&this.bannedRaw.push(e);return}this.bannedPatterns.push(this.buildPhrasePattern(a))})}isBannedMessage(n){if(!n)return!1;for(let a of this.bannedRaw)if(a&&n.includes(a))return!0;let e=this.normalizeContent(n);return e?this.bannedPatterns.some(a=>a.test(e)):!1}normalizeContent(n){if(!n)return"";let e=n.toLowerCase();return this.replaceLeet(e).normalize("NFD").replace(/[\u0300-\u036f]+/g,"").replace(/[^a-z0-9]+/g," ").trim().replace(/\s+/g," ")}replaceLeet(n){let e={"@":"a",0:"o",1:"i","!":"i",3:"e",4:"a",5:"s",$:"s",7:"t",8:"b"};return n.split("").map(a=>e[a]??a).join("")}buildPhrasePattern(n){let d=n.split(/\s+/).filter(Boolean).map(r=>this.buildTokenPattern(r)).join("\\s+");return new RegExp(`(?:^|\\s)${d}(?:\\s|$)`)}buildTokenPattern(n){return n.split("").map(e=>this.escapeRegex(e)).join("\\s*")}escapeRegex(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static \u0275fac=function(e){return new(e||i)(Ft(bT))};static \u0275cmp=Sn({type:i,selectors:[["event-chat-modal"]],viewQuery:function(e,a){if(e&1&&ka(dne,5),e&2){let d;pa(d=fa())&&(a.messagesContainer=d.first)}},inputs:{event:"event",currentUserId:"currentUserId"},outputs:{close:"close"},features:[Gr],decls:31,vars:12,consts:[["messagesContainer",""],[1,"chat-backdrop",3,"click"],[1,"chat-container",3,"click"],[1,"chat-header"],[1,"header-left"],[1,"back-arrow",3,"click"],[1,"header-text"],[1,"title"],[1,"subtitle"],["aria-label","Close chat",1,"close-btn",3,"click"],[1,"chat-body"],[1,"chat-left"],[1,"pinned-bar"],[1,"messages",3,"click"],["class","info-message",4,"ngFor","ngForOf"],["class","timeline-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","mute-banner",4,"ngIf"],[1,"message-input"],["placeholder","Scrivi un messaggio...",3,"ngModelChange","input","keydown.enter","ngModel","disabled"],["class","add-btn",3,"disabled","click",4,"ngIf"],[1,"send-btn",3,"click","disabled"],["class","message-error",4,"ngIf"],[1,"poll-popup-backdrop"],[1,"pinned-bar",3,"click"],[1,"pin-icon"],[1,"pinned-content"],[1,"pinned-sender"],[1,"pinned-text"],["class","unpin-btn",3,"click",4,"ngIf"],[1,"unpin-btn",3,"click"],[1,"info-message"],[1,"info-label"],[1,"info-content"],["class","info-link","target","_blank","rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",1,"info-link",3,"href"],[1,"timeline-item"],[1,"message",3,"mine","pin-enabled"],[1,"poll-message-card",3,"pin-enabled"],[1,"message",3,"click"],[1,"avatar"],["alt","Avatar",3,"src",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"content"],[1,"meta"],[1,"name"],[1,"time"],[1,"pin-menu"],[1,"text"],["alt","Avatar",3,"src"],[1,"placeholder"],[1,"pin-menu",3,"click"],["type","button",1,"pin-menu-btn",3,"click"],[1,"poll-message-card",3,"click"],[1,"poll-message-header"],[1,"header-main"],[1,"poll-tag"],[1,"poll-message-question"],[1,"poll-bars"],["class","poll-bar-row",3,"selected","closed","click",4,"ngFor","ngForOf"],[1,"poll-actions"],["class","pill ghost",3,"disabled","click",4,"ngIf"],[1,"poll-total"],[1,"poll-bar-row",3,"click"],[1,"poll-bar-label"],[1,"poll-bar-count"],[1,"poll-bar-track"],[1,"poll-bar-fill"],[1,"pill","ghost",3,"click","disabled"],[1,"empty-state"],[1,"mute-banner"],[1,"add-btn",3,"click","disabled"],[1,"message-error"],[1,"poll-popup-backdrop",3,"click"],[1,"poll-popup",3,"click"],[1,"poll-popup-header"],[1,"icon-btn",3,"click"],[1,"poll-create"],["placeholder","Domanda del sondaggio",1,"poll-question-input",3,"ngModelChange","ngModel"],[1,"poll-options-list"],["class","poll-option-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","add-option-pill",3,"click",4,"ngIf"],["class","poll-error",4,"ngIf"],[1,"pill","create-poll-btn",3,"click"],[1,"poll-option-row"],[3,"ngModelChange","ngModel","placeholder"],["class","remove-option-btn",3,"click",4,"ngIf"],[1,"remove-option-btn",3,"click"],[1,"add-option-pill",3,"click"],[1,"poll-error"]],template:function(e,a){if(e&1){let d=wt();z(0,"div",1),Ae("click",function(){return Me(d),De(a.onClose())}),z(1,"div",2),Ae("click",function(E){return Me(d),De(E.stopPropagation())}),z(2,"div",3)(3,"div",4)(4,"mat-icon",5),Ae("click",function(){return Me(d),De(a.onClose())}),Z(5,"arrow_back"),V(),z(6,"div",6)(7,"span",7),Z(8,"Event Chat"),V(),z(9,"span",8),Z(10),V()()(),z(11,"button",9),Ae("click",function(){return Me(d),De(a.onClose())}),z(12,"mat-icon"),Z(13,"close"),V()()(),z(14,"div",10)(15,"div",11),Je(16,pne,9,3,"div",12),z(17,"div",13,0),Ae("click",function(){return Me(d),De(a.closePinMenu())}),ji(19,mne,6,4,"div",14)(20,Ene,3,2,"div",15)(21,Sne,2,0,"div",16),V(),ji(22,Tne,2,0,"div",17),z(23,"div",18)(24,"input",19),vo("ngModelChange",function(E){return Me(d),To(a.messageText,E)||(a.messageText=E),De(E)}),Ae("input",function(){return Me(d),De(a.messageError="")})("keydown.enter",function(){return Me(d),De(a.sendMessage())}),V(),ji(25,Ine,3,1,"button",20),z(26,"button",21),Ae("click",function(){return Me(d),De(a.sendMessage())}),z(27,"mat-icon"),Z(28,"send"),V()()(),ji(29,Mne,2,1,"div",22),V()(),Je(30,Rne,16,5,"div",23),V()()}e&2&&(J(10),ct(a.event.title),J(6),et(a.pinnedItem?16:-1),J(3),bt("ngForOf",a.infoMessages),J(),bt("ngForOf",a.timelineItems),J(),bt("ngIf",a.timelineItems.length===0),J(),bt("ngIf",a.isMuted),J(2),_o("ngModel",a.messageText),bt("disabled",a.isMuted),J(),bt("ngIf",a.currentUserId),J(),bt("disabled",a.isMuted||!a.messageText.trim()),J(3),bt("ngIf",a.messageError),J(),et(a.showPollPopup?30:-1))},dependencies:[xi,P_,cs,Ba,ws,Ws,_a,Ai,Di],styles:['.chat-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px;-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.chat-container[_ngcontent-%COMP%]{width:100%;max-width:760px;max-height:90vh;background:var(--modal-surface);border-radius:var(--modal-radius);box-shadow:var(--modal-shadow);display:flex;flex-direction:column;overflow:hidden;border:var(--modal-border);color:#f5f5f5}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}@media (max-width: 768px){.chat-backdrop[_ngcontent-%COMP%]{padding:0}.chat-container[_ngcontent-%COMP%]{width:100vw;height:100vh;max-height:100vh;border-radius:0}.mobile-only[_ngcontent-%COMP%]{display:inline-flex}.close-btn[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{color:var(--color-accent)}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:relative;padding:16px}.header-left[_ngcontent-%COMP%]{width:100%;justify-content:center;gap:0}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:16px;margin-right:0}.header-text[_ngcontent-%COMP%]{align-items:center;text-align:center}}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:var(--modal-header-border)}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.header-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.title[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#facc15}.subtitle[_ngcontent-%COMP%]{color:#bdbdbd;font-size:14px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;color:#f0f0f0;width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.12);display:grid;place-items:center;transition:background-color .15s ease,border-color .15s ease}.icon-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#fff3}.back-arrow[_ngcontent-%COMP%]{cursor:pointer;color:#fff;font-size:24px;margin-right:4px;transition:color .2s;display:flex;align-items:center;justify-content:center}.back-arrow[_ngcontent-%COMP%]:hover{color:var(--color-accent)}.chat-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:16px;padding:16px;overflow:hidden;flex:1;min-height:0;justify-content:center}.chat-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;min-height:0;height:100%}.pinned-toggle[_ngcontent-%COMP%]{width:100%;background:#ffffff0a;border:1px solid rgba(255,255,255,.1);color:#f3f3f3;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;cursor:pointer;border-radius:12px}.pinned-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:14px}.pinned-toggle[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:transform .2s ease}.pinned-toggle[_ngcontent-%COMP%]   .chevron.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.pinned-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:#fcc3241f;border:1px solid rgba(252,195,36,.25);border-radius:12px;padding:10px 12px;cursor:pointer;transition:background-color .15s ease}.pinned-bar[_ngcontent-%COMP%]:hover{background:#fcc3242e}.pinned-bar[_ngcontent-%COMP%]   .pin-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:20px;flex-shrink:0}.pinned-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1;min-width:0}.pinned-sender[_ngcontent-%COMP%]{font-size:12px;font-weight:700;color:var(--color-accent)}.pinned-text[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.unpin-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#888;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .15s ease,color .15s ease}.unpin-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.unpin-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.pinned-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:8px;margin-bottom:4px}.pinned-item[_ngcontent-%COMP%]{background:#ffffff0a;border:1px solid rgba(255,255,255,.08);color:#f0f0f0;border-radius:12px;padding:8px 10px;display:flex;flex-direction:column;gap:2px;text-align:left;cursor:pointer}.pinned-item[_ngcontent-%COMP%]:hover{border-color:#fff3;background:#ffffff14}.pin-label[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.2px;text-transform:uppercase;color:var(--color-accent)}.pin-preview[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.messages[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:16px;overflow-y:auto;scroll-behavior:smooth;flex:1;border:1px solid rgba(255,255,255,.06);scrollbar-width:none;-ms-overflow-style:none}.messages[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.timeline-item[_ngcontent-%COMP%]{margin-bottom:14px}.message[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:14px;align-items:flex-start;position:relative}.message.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.message.mine[_ngcontent-%COMP%]{flex-direction:row-reverse}.message.mine[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.message.mine[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{justify-content:flex-end}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{text-align:right}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .avatar[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ffffff1a;font-weight:600;pointer-events:none}.content[_ngcontent-%COMP%]{flex:1;max-width:70%;position:relative}.meta[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:12px;color:#9a9a9a;margin-bottom:4px;align-items:center}.name[_ngcontent-%COMP%]{font-weight:600;color:#f2f2f2}.text[_ngcontent-%COMP%]{background:#ffffff14;border-radius:12px;padding:10px 12px;box-shadow:0 8px 20px #00000040;border:1px solid rgba(255,255,255,.06);display:inline-block;width:auto;max-width:100%}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:#fcc3242e;border-color:#fcc32459;color:#fdf7e0}.pin-menu[_ngcontent-%COMP%]{position:static;z-index:1;display:inline-flex;align-items:center;margin-left:6px}.message.mine[_ngcontent-%COMP%]   .pin-menu[_ngcontent-%COMP%]{margin-right:6px;margin-left:0}.pin-menu-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:34px;height:30px;border-radius:0;border:none;background:transparent;color:#fff;cursor:pointer;position:relative}.pin-menu-btn.active[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32480}.pin-menu-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px}.pin-menu-btn.unpin[_ngcontent-%COMP%]:after{content:"";position:absolute;width:18px;height:3px;background:#000;border-radius:2px;transform:rotate(-35deg)}.pin-menu-btn.unpin[_ngcontent-%COMP%]{color:#fff}.info-message[_ngcontent-%COMP%]{border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;padding:10px 12px;margin-bottom:10px}.info-label[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;letter-spacing:.3px;color:var(--color-accent);margin-bottom:4px;font-weight:700}.info-content[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:pre-wrap}.info-link[_ngcontent-%COMP%]{display:inline-flex;margin-top:6px;font-size:12px;color:var(--color-accent);text-decoration:none}.info-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.poll-message-card[_ngcontent-%COMP%]{border-radius:14px;padding:12px;background:#ffffff0f;border:1px solid rgba(255,255,255,.1);transition:background-color .2s,border-color .2s;position:relative}.poll-message-card.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.poll-message-card.pin-enabled[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fcc32466}.poll-message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;font-size:12px;color:#b8b8b8;margin-bottom:8px}.poll-message-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.poll-tag[_ngcontent-%COMP%]{background:#fcc32433;color:var(--color-accent);padding:2px 8px;border-radius:999px;font-weight:600;font-size:11px}.poll-message-question[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:var(--color-accent);margin-bottom:12px}.poll-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.poll-bar-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:10px;cursor:pointer;transition:background-color .2s ease,border-color .2s ease;border:1px solid transparent;background:#ffffff0a}.poll-bar-row[_ngcontent-%COMP%]:hover:not(.closed){background:#ffffff14;border-color:#ffffff1a}.poll-bar-row.selected[_ngcontent-%COMP%]{background:#fcc3241f;border-color:#fcc3244d}.poll-bar-row.closed[_ngcontent-%COMP%]{cursor:default;opacity:.8}.poll-bar-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#d8d8d8}.poll-bar-track[_ngcontent-%COMP%]{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden}.poll-bar-fill[_ngcontent-%COMP%]{height:100%;background:var(--color-accent);box-shadow:0 4px 10px #fcc3244d}.poll-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:14px}.poll-total[_ngcontent-%COMP%]{margin-top:10px;font-size:11px;color:#b0b0b0}.empty-state[_ngcontent-%COMP%]{color:#b3b3b3;font-size:14px;text-align:center;padding:16px 0}.mute-banner[_ngcontent-%COMP%]{background:#ff606026;color:#ffb3b3;padding:10px 12px;border-radius:12px;font-size:13px;border:1px solid rgba(255,96,96,.3)}.message-input[_ngcontent-%COMP%]{display:flex;gap:8px}.message-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-top:4px}.message-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;background:#ffffff0a;color:#f4f4f4}.send-btn[_ngcontent-%COMP%]{background:var(--color-accent);color:#fff;border:none;border-radius:12px;padding:0 16px;cursor:pointer;display:flex;align-items:center;box-shadow:0 10px 20px #fcc32440}.add-btn[_ngcontent-%COMP%]{background:#ffffff14;color:#f5f5f5;border:1px solid rgba(255,255,255,.12);border-radius:12px;width:42px;display:flex;align-items:center;justify-content:center;cursor:pointer}.add-btn[_ngcontent-%COMP%]:hover{background:#ffffff24}.poll-create[_ngcontent-%COMP%]   .poll-question-input[_ngcontent-%COMP%]{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;margin-bottom:20px;background:#ffffff0a;color:#f4f4f4;font-weight:600}.poll-options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.poll-option-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.poll-option-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;background:#ffffff0a;color:#f4f4f4;font-size:14px}.remove-option-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ef4444;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:4px;opacity:.7;transition:opacity .2s}.remove-option-btn[_ngcontent-%COMP%]:hover{opacity:1}.add-option-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;background:#fcc3241a;color:var(--color-accent);border:1px dashed var(--color-accent);border-radius:12px;padding:8px 16px;cursor:pointer;font-size:13px;font-weight:600;width:100%;justify-content:center;margin-bottom:20px;transition:background-color .2s}.add-option-pill[_ngcontent-%COMP%]:hover{background:#fcc32426}.create-poll-btn[_ngcontent-%COMP%]{width:100%;padding:12px!important;font-weight:700!important;font-size:15px!important;margin-top:10px}.pill[_ngcontent-%COMP%]{border-radius:999px;border:none;background:var(--color-accent);color:#fff;padding:8px 14px;cursor:pointer;font-size:12px;box-shadow:0 8px 18px #fcc3242e}.pill.ghost[_ngcontent-%COMP%]{background:transparent;color:#f5f5f5;border:1px solid rgba(255,255,255,.2);box-shadow:none}.pill.danger[_ngcontent-%COMP%]{background:#d43d3d;color:#fff;box-shadow:none}.poll-popup-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));display:flex;align-items:center;justify-content:center;z-index:60}.poll-popup[_ngcontent-%COMP%]{width:min(460px,92vw);background:var(--modal-surface);border-radius:var(--modal-radius);border:var(--modal-border);padding:16px;box-shadow:var(--modal-shadow)}.poll-popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.poll-popup-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;color:var(--color-accent);font-size:18px}.poll-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-bottom:8px}.mobile-only[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]{flex:0 0 auto;width:36px;height:36px;flex-shrink:0;position:relative;z-index:1;display:block}']})};var bb=(i,n)=>n.id;function kne(i,n){i&1&&(z(0,"div",13),Z(1,"Loading..."),V())}function Fne(i,n){if(i&1){let e=wt();z(0,"span",31),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(3);return De(r.toggleRequests(d.id))}),Z(1),V()}if(i&2){let e=ne().$implicit;J(),Zi(" ",e.pendingUsersList==null?null:e.pendingUsersList.length," Requests ")}}function Lne(i,n){if(i&1){let e=wt();z(0,"div",43),Rn(1,"img",44),z(2,"span",45),Z(3),V(),z(4,"button",46),Ae("click",function(){let d=Me(e).$implicit,r=ne(3).$implicit,E=ne(3);return De(E.removeParticipant(r,d))}),z(5,"mat-icon"),Z(6,"person_remove"),V()()()}if(i&2){let e=n.$implicit;J(),bt("src",e.profileImage||"assets/placeholder-user.png",to),J(2),ma("",e.name," ",e.surname)}}function Nne(i,n){if(i&1&&(z(0,"div",37)(1,"h5",41),Z(2,"Accepted People"),V(),z(3,"div",42),qi(4,Lne,7,3,"div",43,bb),V()()),i&2){let e=ne(2).$implicit;J(4),Wi(e.acceptedUsersList)}}function zne(i,n){i&1&&(z(0,"p",38),Z(1,"No participants accepted yet."),V())}function Bne(i,n){if(i&1){let e=wt();z(0,"div",47)(1,"div",48),Rn(2,"img",49),z(3,"span"),Z(4),V()(),z(5,"div",50)(6,"button",51),Ae("click",function(){let d=Me(e).$implicit,r=ne(3).$implicit,E=ne(3);return De(E.acceptRequest(r,d))}),Z(7,"Accept"),V(),z(8,"button",52),Ae("click",function(){let d=Me(e).$implicit,r=ne(3).$implicit,E=ne(3);return De(E.rejectRequest(r,d))}),Z(9,"Reject"),V()()()}if(i&2){let e=n.$implicit;J(2),bt("src",e.profileImage||"assets/placeholder-user.png",to),J(2),ma("",e.name," ",e.surname)}}function Vne(i,n){if(i&1&&qi(0,Bne,10,3,"div",47,bb),i&2){let e=ne(2).$implicit;Wi(e.pendingUsersList)}}function Une(i,n){i&1&&(z(0,"p",40),Z(1,"No pending requests."),V())}function jne(i,n){if(i&1&&(z(0,"div",30)(1,"div",32)(2,"h4"),Z(3,"Event Overview"),V(),z(4,"div",33)(5,"div",34)(6,"span",35),Z(7,"Accepted Participants"),V(),z(8,"span",36),Z(9),V()(),z(10,"div",34)(11,"span",35),Z(12,"Capacity"),V(),z(13,"span",36),Z(14),V()()(),Je(15,Nne,6,0,"div",37)(16,zne,2,0,"p",38),V(),z(17,"div",39)(18,"h4"),Z(19),V(),Je(20,Vne,2,0)(21,Une,2,0,"p",40),V()()),i&2){let e=ne().$implicit;J(9),ct((e.acceptedUsersList==null?null:e.acceptedUsersList.length)||0),J(5),ma(" ",(e.acceptedUsersList==null?null:e.acceptedUsersList.length)||0," / ",e.nPartecipants," "),J(),et(e.acceptedUsersList!=null&&e.acceptedUsersList.length?15:16),J(4),Zi("Pending Requests (",(e.pendingUsersList==null?null:e.pendingUsersList.length)||0,")"),J(),et(e.pendingUsersList!=null&&e.pendingUsersList.length?20:21)}}function $ne(i,n){if(i&1){let e=wt();z(0,"div",20)(1,"div",21)(2,"div",22)(3,"h3"),Z(4),V(),z(5,"span",23),Z(6),V(),z(7,"span",24),Z(8),V(),ji(9,Fne,2,1,"span",25),V(),z(10,"div",26)(11,"button",27),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.openChat(d))}),z(12,"mat-icon"),Z(13,"chat"),V()(),z(14,"button",28),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.deleteEvent(d))}),z(15,"mat-icon"),Z(16,"delete"),V()(),z(17,"button",29),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.toggleRequests(d.id))}),z(18,"mat-icon"),Z(19,"group"),V()()()(),Je(20,jne,22,6,"div",30),V()}if(i&2){let e=n.$implicit,a=ne(3);hn("expanded",a.expandedEventRequestsId===e.id),J(4),ct(e.title),J(2),ct(e.city),J(2),ct(a.formatDateTime(e)),J(),bt("ngIf",e.pendingUsersList==null?null:e.pendingUsersList.length),J(11),et(a.expandedEventRequestsId===e.id?20:-1)}}function Hne(i,n){i&1&&(z(0,"div",19),Z(1,"No organized events found."),V())}function Gne(i,n){if(i&1&&(z(0,"div",17),qi(1,$ne,21,7,"div",18,bb,!1,Hne,2,0,"div",19),V()),i&2){let e=ne(2);hn("has-expanded-requests",e.expandedEventRequestsId),J(),Wi(e.organizedEvents)}}function qne(i,n){if(i&1){let e=wt();z(0,"app-event-card",54),Ae("shareEvent",function(){let d=Me(e).$implicit,r=ne(3);return De(r.openShare(d))}),V()}if(i&2){let e=n.$implicit,a=ne(3);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("isParticipating",!!e.isParticipating)("showDistance",!1)("showActions",!1)}}function Wne(i,n){i&1&&(z(0,"div",19),Z(1,"You haven't joined any events yet."),V())}function Zne(i,n){if(i&1&&(z(0,"div",15),qi(1,qne,1,9,"app-event-card",53,bb,!1,Wne,2,0,"div",19),V()),i&2){let e=ne(2);J(),Wi(e.joinedEvents)}}function Yne(i,n){if(i&1){let e=wt();z(0,"app-event-card",56),Ae("shareEvent",function(){let d=Me(e).$implicit,r=ne(3);return De(r.openShare(d))})("focusLocation",function(){let d=Me(e).$implicit,r=ne(3);return De(r.goToEvent(d))}),V()}if(i&2){let e=n.$implicit,a=ne(3);bt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("id",e.id)("isSaved",!0)("savedCount",e.savedCount)("isParticipating",!!e.isParticipating)("showDistance",!1)("showActions",!1)("showLocationPin",!0)}}function Xne(i,n){i&1&&(z(0,"div",19),Z(1,"You haven't saved any events yet."),V())}function Kne(i,n){if(i&1&&(z(0,"div",15),qi(1,Yne,1,10,"app-event-card",55,bb,!1,Xne,2,0,"div",19),V()),i&2){let e=ne(2);J(),Wi(e.savedEvents)}}function Qne(i,n){if(i&1){let e=wt();z(0,"app-event-share-modal",57),Ae("close",function(){Me(e);let d=ne(2);return De(d.sharingEvent=null)}),V()}if(i&2){let e=ne(2);bt("event",e.sharingEvent)}}function Jne(i,n){if(i&1){let e=wt();z(0,"div",1),Ae("click",function(){Me(e);let d=ne();return De(d.close.emit())}),V(),z(1,"div",2)(2,"div",3)(3,"mat-icon",4),Ae("click",function(){Me(e);let d=ne();return De(d.onBack())}),Z(4,"arrow_back"),V(),z(5,"div",5)(6,"button",6),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("ORGANIZED"))}),Z(7," My Events "),V(),z(8,"button",6),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("JOINED"))}),Z(9," Joined Events "),V(),z(10,"button",6),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("SAVED"))}),Z(11," Saved Events "),V()(),z(12,"div",7)(13,"h2",8),Z(14),V()(),z(15,"button",9),Ae("click",function(){Me(e);let d=ne();return De(d.close.emit())}),z(16,"mat-icon"),Z(17,"close"),V()()(),z(18,"div",10)(19,"button",11),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("ORGANIZED"))}),z(20,"mat-icon"),Z(21,"event"),V(),z(22,"span"),Z(23,"My Events"),V()(),z(24,"button",11),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("JOINED"))}),z(25,"mat-icon"),Z(26,"group"),V(),z(27,"span"),Z(28,"Joined"),V()(),z(29,"button",11),Ae("click",function(){Me(e);let d=ne();return De(d.switchTab("SAVED"))}),z(30,"mat-icon"),Z(31,"bookmark"),V(),z(32,"span"),Z(33,"Saved"),V()()(),z(34,"div",12),Je(35,kne,2,0,"div",13),Je(36,Gne,4,3,"div",14),Je(37,Zne,4,1,"div",15),Je(38,Kne,4,1,"div",15),V()(),Je(39,Qne,1,1,"app-event-share-modal",16)}if(i&2){let e=ne();J(6),hn("active",e.activeTab==="ORGANIZED"),J(2),hn("active",e.activeTab==="JOINED"),J(2),hn("active",e.activeTab==="SAVED"),J(4),ct(e.getViewTitle()),J(5),hn("active",e.activeTab==="ORGANIZED"),J(5),hn("active",e.activeTab==="JOINED"),J(5),hn("active",e.activeTab==="SAVED"),J(6),et(e.loading?35:-1),J(),et(!e.loading&&e.activeTab==="ORGANIZED"?36:-1),J(),et(!e.loading&&e.activeTab==="JOINED"?37:-1),J(),et(!e.loading&&e.activeTab==="SAVED"?38:-1),J(),et(e.sharingEvent?39:-1)}}function eie(i,n){if(i&1){let e=wt();z(0,"event-chat-modal",58),Ae("close",function(){Me(e);let d=ne();return De(d.closeChat())}),V()}if(i&2){let e=ne();bt("event",e.chatEvent)("currentUserId",e.userId.toString())}}var wT=class i{constructor(n,e){this.eventService=n;this.confirmation=e}userId;close=new $t;focusLocal=new $t;view="organized";getViewTitle(){return this.expandedEventRequestsId?"Manage Requests":this.activeTab==="ORGANIZED"?"My Events":this.activeTab==="JOINED"?"Joined Events":"Saved Events"}onBack(){this.expandedEventRequestsId?this.expandedEventRequestsId=null:this.close.emit()}activeTab="ORGANIZED";organizedEvents=[];joinedEvents=[];savedEvents=[];loading=!1;sharingEvent=null;expandedEventRequestsId=null;showChatModal=!1;chatEvent=null;ngOnInit(){this.loadData()}loadData(){this.loading=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>this.organizedEvents=n,error:n=>console.error("Error loading organized events",n)}),this.eventService.getJoinedEvents(this.userId).subscribe({next:n=>{this.joinedEvents=n},error:n=>{console.error("Error loading joined events",n)}}),this.eventService.getSavedEvents(this.userId).subscribe({next:n=>{this.savedEvents=n.filter(this.isFutureEvent),this.loading=!1},error:n=>{console.error("Error loading saved events",n),this.loading=!1}})}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};switchTab(n){this.activeTab=n,this.expandedEventRequestsId=null}toggleRequests(n){this.expandedEventRequestsId===n?this.expandedEventRequestsId=null:this.expandedEventRequestsId=n}deleteEvent(n){return Er(this,null,function*(){(yield this.confirmation.confirm({title:"Delete event",message:"Are you sure you want to delete this event?",confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.organizedEvents=this.organizedEvents.filter(a=>a.id!==n.id),this.expandedEventRequestsId===n.id&&(this.expandedEventRequestsId=null)},error:a=>console.error("Error deleting event",a)})})}openChat(n){this.chatEvent=n,this.showChatModal=!0}closeChat(){this.showChatModal=!1,this.chatEvent=null}acceptRequest(n,e){this.eventService.acceptParticipation(n.id,e.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(a=>a.id!==e.id)),n.acceptedUsersList||(n.acceptedUsersList=[]),n.acceptedUsersList.push(e),n.acceptedUsersList.sort((a,d)=>(a.name||"").localeCompare(d.name||"")),n.occupiedSpots=(n.occupiedSpots||0)+1},error:a=>console.error("Error accepting",a)})}rejectRequest(n,e){this.eventService.rejectParticipation(n.id,e.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(a=>a.id!==e.id))},error:a=>console.error("Error rejecting",a)})}removeParticipant(n,e){return Er(this,null,function*(){(yield this.confirmation.confirm({title:"Remove participant",message:`Remove ${e.name} ${e.surname} from this event?`,confirmText:"Remove",cancelText:"Cancel",tone:"danger"}))&&this.eventService.removeParticipant(n.id,e.id,this.userId).subscribe({next:()=>{n.acceptedUsersList&&(n.acceptedUsersList=n.acceptedUsersList.filter(d=>d.id!==e.id)),n.occupiedSpots=Math.max(0,(n.occupiedSpots||0)-1)},error:d=>console.error("Error removing participant",d)})})}openShare(n){this.sharingEvent=n}goToEvent(n){this.focusLocal.emit(n)}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"";return`${e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):""} | ${a}`}static \u0275fac=function(e){return new(e||i)(Ft(Zs),Ft(Na))};static \u0275cmp=Sn({type:i,selectors:[["app-my-events-modal"]],inputs:{userId:"userId"},outputs:{close:"close",focusLocal:"focusLocal"},decls:2,vars:2,consts:[[3,"event","currentUserId"],[1,"backdrop",3,"click"],[1,"modal-container"],[1,"modal-header"],[1,"back-arrow",3,"click"],[1,"tabs","tablet-desktop-only"],[1,"tab-btn",3,"click"],[1,"title-wrap","mobile-only"],[1,"yellow-title"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"mobile-tabs","mobile-only"],[1,"mobile-tab-btn",3,"click"],[1,"modal-content"],[1,"loading-state"],[1,"events-list",3,"has-expanded-requests"],[1,"events-grid"],[3,"event"],[1,"events-list"],[1,"organized-event-item",3,"expanded"],[1,"empty-state"],[1,"organized-event-item"],[1,"event-summary"],[1,"event-info"],[1,"event-location"],[1,"event-date"],["class","requests-badge",3,"click",4,"ngIf"],[1,"event-actions"],["title","Open chat",1,"icon-btn","chat",3,"click"],["title","Delete event",1,"icon-btn","danger",3,"click"],["title","Manage Requests",1,"icon-btn",3,"click"],[1,"requests-panel"],[1,"requests-badge",3,"click"],[1,"event-overview-section"],[1,"stats-card"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"participants-list"],[1,"no-data-msg"],[1,"pending-requests-section"],[1,"no-requests"],[1,"section-subtitle"],[1,"participants-grid"],[1,"participant-chip"],[1,"participant-avatar",3,"src"],[1,"participant-name"],["type","button","title","Remove participant",1,"participant-remove-btn",3,"click"],[1,"request-item"],[1,"user-info"],[1,"user-avatar",3,"src"],[1,"request-actions"],[1,"accept-btn",3,"click"],[1,"reject-btn",3,"click"],[3,"title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions"],[3,"shareEvent","title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions"],[3,"title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions","showLocationPin"],[3,"shareEvent","focusLocation","title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions","showLocationPin"],[3,"close","event"],[3,"close","event","currentUserId"]],template:function(e,a){e&1&&(Je(0,Jne,40,18),Je(1,eie,1,2,"event-chat-modal",0)),e&2&&(et(a.showChatModal?-1:0),J(),et(a.showChatModal&&a.chatEvent?1:-1))},dependencies:[xi,cs,Ai,Di,Yh,pv,yv],styles:['.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);z-index:var(--z-backdrop);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.modal-container[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:600px;height:80vh;background:var(--modal-surface);border-radius:var(--modal-radius);z-index:var(--z-popup);display:flex;flex-direction:column;overflow:hidden;box-shadow:var(--modal-shadow);border:var(--modal-border)}.modal-header[_ngcontent-%COMP%]{padding:16px 24px;background:transparent;display:flex;align-items:center;justify-content:space-between;border-bottom:var(--modal-header-border)}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}.back-arrow[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-white);font-size:24px;margin-right:16px;transition:color .2s}.back-arrow[_ngcontent-%COMP%]:hover{color:var(--color-accent)}.tabs[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:center;align-items:center;gap:0}.tab-btn[_ngcontent-%COMP%]{flex:1;background:none;border:none;color:#888;font-size:16px;font-weight:600;padding:10px 24px;cursor:pointer;position:relative;text-align:center;border-left:1px solid rgba(255,255,255,.12);transition:color .3s}.tab-btn[_ngcontent-%COMP%]:first-child{border-left:none}.tab-btn.active[_ngcontent-%COMP%]{color:#fbce4e}.tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-17px;left:0;width:100%;height:3px;background:#fbce4e;border-radius:3px 3px 0 0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.organized-event-item[_ngcontent-%COMP%]{background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);border:none;color:var(--color-white)}.event-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.event-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.icon-btn.chat[_ngcontent-%COMP%]{background:#fcc32424;color:var(--color-accent);border:1px solid rgba(252,195,36,.3);width:36px;height:36px;border-radius:8px}.icon-btn.chat[_ngcontent-%COMP%]:hover{background:#fcc3244d;color:#0b0b0b}.event-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.icon-btn.danger[_ngcontent-%COMP%]{background:#ea43351a;color:var(--color-danger);border:1px solid rgba(234,67,53,.2);width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:all .2s}.icon-btn.danger[_ngcontent-%COMP%]:hover{background:var(--color-danger);color:#fff}.icon-btn.danger[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.event-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.event-location[_ngcontent-%COMP%]{display:block;margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.event-date[_ngcontent-%COMP%]{display:block;margin:0;font-size:10px;color:#888}.requests-badge[_ngcontent-%COMP%]{display:inline-block;background:var(--color-accent);color:#000;font-size:10px;font-weight:700;padding:2px 8px;border-radius:12px;cursor:pointer;align-self:flex-start;margin-top:4px}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);border:none;color:var(--color-light-gray);padding:0;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:background-color .2s}.icon-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.icon-btn[_ngcontent-%COMP%]:hover{background-color:#555;color:var(--color-white)}.requests-panel[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1);animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.requests-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#ddd;font-size:14px;text-transform:uppercase;letter-spacing:.5px}.request-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:#fff}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;background:#444}.request-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.accept-btn[_ngcontent-%COMP%], .reject-btn[_ngcontent-%COMP%]{border:none;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer}.accept-btn[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.reject-btn[_ngcontent-%COMP%]{background:#f44336;color:#fff}.no-requests[_ngcontent-%COMP%]{color:#888;font-size:14px;font-style:italic}.event-overview-section[_ngcontent-%COMP%]{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(255,255,255,.1)}.pending-requests-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .event-overview-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#fbce4e;font-size:14px;text-transform:uppercase;letter-spacing:1px;font-weight:700}.stats-card[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;background:#ffffff08;padding:16px;border-radius:12px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.stat-label[_ngcontent-%COMP%]{color:#888;font-size:12px;text-transform:uppercase}.stat-value[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700}.section-subtitle[_ngcontent-%COMP%]{color:#ddd;font-size:14px;margin:0 0 12px;font-weight:600}.participants-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.participant-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#ffffff0d;padding:6px 10px;border-radius:20px;border:1px solid rgba(255,255,255,.05)}.participant-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;object-fit:cover}.participant-name[_ngcontent-%COMP%]{color:#eee;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.participant-remove-btn[_ngcontent-%COMP%]{margin-left:auto;width:22px;height:22px;border-radius:50%;border:1px solid rgba(244,67,54,.3);background:#f4433626;color:#f44336;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.participant-remove-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.participant-remove-btn[_ngcontent-%COMP%]:hover{background:#f44336;color:#fff}.no-data-msg[_ngcontent-%COMP%]{color:#888;font-size:13px;font-style:italic}.events-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#888;margin-top:40px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#333;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#444}@media (max-width: 768px){.backdrop[_ngcontent-%COMP%]{-webkit-backdrop-filter:none;backdrop-filter:none}.modal-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;transform:none;width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none}.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:var(--modal-header-border);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex!important;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.modal-content[_ngcontent-%COMP%]{padding:16px}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item[_ngcontent-%COMP%]:not(.expanded){display:none}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]{background:transparent!important;padding:0!important;border:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .event-summary[_ngcontent-%COMP%]{display:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .requests-panel[_ngcontent-%COMP%]{margin-top:0!important;border-top:none!important;padding-top:0!important}}.mobile-tabs[_ngcontent-%COMP%]{display:none;justify-content:space-around;background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);padding:8px 0}.mobile-tab-btn[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;color:#888;font-size:11px;cursor:pointer;padding:8px 0;transition:color .2s}.mobile-tab-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.mobile-tab-btn.active[_ngcontent-%COMP%]{color:var(--color-accent)}.mobile-tab-btn.active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}@media (max-width: 768px){.mobile-tabs[_ngcontent-%COMP%]{display:flex!important}}']})};var f6=ww(vR());function tie(i,n){if(i&1){let e=wt();z(0,"button",10),Ae("click",function(){Me(e);let d=ne();return De(d.onBack())}),z(1,"mat-icon"),Z(2,"arrow_back"),V()()}}function nie(i,n){if(i&1&&Rn(0,"img",16),i&2){let e=ne(2);bt("src",e.user==null?null:e.user.profileImage,to)}}function iie(i,n){if(i&1&&(z(0,"div",17),Z(1),V()),i&2){let e=ne(2);J(),ct(e.getInitials((e.user==null?null:e.user.name)||""))}}function rie(i,n){if(i&1){let e=wt();z(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15),Je(5,nie,1,1,"img",16)(6,iie,2,1,"div",17),z(7,"button",18),Ae("click",function(){Me(e);let d=ne();return De(d.onChangePhoto())}),z(8,"mat-icon"),Z(9,"edit"),V()()(),z(10,"h3",19),Z(11),V(),z(12,"p",20)(13,"mat-icon"),Z(14,"mail_outline"),V(),Z(15),V(),z(16,"p",21),Z(17),V(),z(18,"div",22)(19,"div",23),Ae("click",function(){Me(e);let d=ne();return De(d.showFollowers())}),z(20,"span",24),Z(21),V(),z(22,"span",25),Z(23,"Followers"),V()(),Rn(24,"div",26),z(25,"div",23),Ae("click",function(){Me(e);let d=ne();return De(d.showFollowing())}),z(26,"span",24),Z(27),V(),z(28,"span",25),Z(29,"Following"),V()()()(),z(30,"div",27)(31,"button",28),Ae("click",function(){Me(e);let d=ne();return De(d.showEditProfile())}),z(32,"mat-icon"),Z(33,"settings"),V(),Z(34," Edit Profile "),V()()(),Rn(35,"div",29),z(36,"div",30)(37,"div",31)(38,"span",32),Z(39,"Share Profile"),V(),z(40,"div",33),Rn(41,"img",34),V(),z(42,"div",35)(43,"div",36)(44,"button",37),Ae("click",function(){Me(e);let d=ne();return De(d.copyShareLink())}),z(45,"mat-icon"),Z(46,"content_copy"),V(),Z(47," Copy Link "),V()()()()()()()}if(i&2){let e=ne();J(5),et(e.user!=null&&e.user.profileImage?5:6),J(6),ct(e.user==null?null:e.user.name),J(4),Zi(" ",e.getDiscreteEmail(e.user==null?null:e.user.email)," "),J(2),ct((e.user==null?null:e.user.description)||"Find The Glow"),J(4),ct((e.user==null?null:e.user.followersCount)||0),J(6),ct((e.user==null?null:e.user.followingCount)||0),J(14),bt("src",e.getQrCodeUrl(),to)}}function oie(i,n){if(i&1){let e=wt();z(0,"div",38)(1,"div",39)(2,"div",40)(3,"h4"),Z(4,"Personal Information"),V(),z(5,"div",41)(6,"label"),Z(7,"Name"),V(),z(8,"input",42),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.editData.name,d)||(r.editData.name=d),De(d)}),V()(),z(9,"div",41)(10,"label"),Z(11,"Email"),V(),Rn(12,"input",43),V(),z(13,"div",41)(14,"label"),Z(15,"Description"),V(),z(16,"textarea",44),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.editData.description,d)||(r.editData.description=d),De(d)}),V()(),z(17,"button",45),Ae("click",function(){Me(e);let d=ne();return De(d.onSaveProfile())}),Z(18,"Update Details"),V()(),Rn(19,"div",29),z(20,"div",46)(21,"h4"),Z(22,"Change Password"),V(),z(23,"div",41)(24,"label"),Z(25,"Current Password"),V(),z(26,"input",47),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.passwordData.old,d)||(r.passwordData.old=d),De(d)}),V()(),z(27,"div",41)(28,"label"),Z(29,"New Password"),V(),z(30,"input",48),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.passwordData.new,d)||(r.passwordData.new=d),De(d)}),V()(),z(31,"div",41)(32,"label"),Z(33,"Confirm New Password"),V(),z(34,"input",49),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.passwordData.confirm,d)||(r.passwordData.confirm=d),De(d)}),V()(),z(35,"button",45),Ae("click",function(){Me(e);let d=ne();return De(d.onChangePassword())}),Z(36,"Change Password"),V()()()()}if(i&2){let e=ne();J(8),_o("ngModel",e.editData.name),J(4),bt("value",e.editData.email),J(4),_o("ngModel",e.editData.description),J(10),_o("ngModel",e.passwordData.old),J(4),_o("ngModel",e.passwordData.new),J(4),_o("ngModel",e.passwordData.confirm)}}function sie(i,n){if(i&1&&Rn(0,"img",62),i&2){let e=ne().$implicit;bt("src",e.profileImage,to)}}function aie(i,n){if(i&1&&(z(0,"div",63),Z(1),V()),i&2){let e=ne().$implicit,a=ne(3);J(),ct(a.getInitials(e.name))}}function lie(i,n){if(i&1){let e=wt();z(0,"button",64),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(3);return De(r.onUnfollow(d))}),Z(1," Unfollow "),V()}}function cie(i,n){if(i&1){let e=wt();z(0,"button",65),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(3);return De(r.onFollow(d))}),Z(1," Follow "),V()}}function uie(i,n){if(i&1){let e=wt();z(0,"div",55)(1,"div",56),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.openProfileFromList(d))}),ji(2,sie,1,1,"img",57)(3,aie,2,1,"div",58),z(4,"span",59),Z(5),V()(),ji(6,lie,2,0,"button",60)(7,cie,2,0,"button",61),V()}if(i&2){let e=n.$implicit,a=ne(3);J(2),bt("ngIf",e.profileImage),J(),bt("ngIf",!e.profileImage),J(2),ct(e.name),J(),bt("ngIf",a.view==="following"||a.view==="followers"&&a.followingIds.has(e.id.toString())),J(),bt("ngIf",a.view==="followers"&&!a.followingIds.has(e.id.toString()))}}function die(i,n){i&1&&(z(0,"div",66),Z(1," No users found. "),V())}function hie(i,n){if(i&1&&(z(0,"div",52),ji(1,uie,8,5,"div",53)(2,die,2,0,"div",54),V()),i&2){let e=ne(2);J(),bt("ngForOf",e.userList),J(),bt("ngIf",e.userList.length===0)}}function pie(i,n){i&1&&(z(0,"div",67),Z(1,"Loading..."),V())}function fie(i,n){if(i&1&&(z(0,"div",50),ji(1,hie,3,2,"div",51)(2,pie,2,0,"ng-template",null,0,cx),V()),i&2){let e=Bl(3),a=ne();J(),bt("ngIf",!a.loadingList)("ngIfElse",e)}}var CT=class i{constructor(n,e,a){this.userService=n;this.confirmation=e;this.snackBar=a}_user=null;qrCodeUrl="";set user(n){this._user=n,this.generateQrCode()}get user(){return this._user}close=new $t;changePhoto=new $t;openProfile=new $t;view="profile";userList=[];followingIds=new Set;loadingList=!1;editData={name:"",email:"",description:""};passwordData={old:"",new:"",confirm:""};onClose(){this.view="profile",this.close.emit()}onBack(){this.view!=="profile"&&(this.view="profile")}getViewTitle(){switch(this.view){case"edit-profile":return"Edit Profile";case"followers":return"Followers";case"following":return"Following";default:return"Account"}}onChangePhoto(){this.changePhoto.emit()}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}getDiscreteEmail(n){if(!n)return"";if(n.length<=25)return n;let e=n.split("@");if(e.length!==2)return n;let[a,d]=e;return`...${a.slice(-3)}@${d}`}showFollowers(){if(!this.user)return;let n=this.user.id;this.view="followers",this.loadingList=!0,this.userService.getFollowers(n).subscribe({next:e=>{this.userList=e,this.userService.getFollowing(n).subscribe({next:a=>{this.followingIds=new Set(a.map(d=>d.id.toString())),this.loadingList=!1},error:a=>{console.error("Error fetching following list",a),this.loadingList=!1}})},error:e=>{console.error(e),this.loadingList=!1}})}showFollowing(){this.user&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.user.id).subscribe({next:n=>{this.userList=n,this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}}))}onFollow(n){this.user&&this.userService.followUser(this.user.id,n.id).subscribe({next:()=>{this.followingIds.add(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||0)+1),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}onUnfollow(n){return Er(this,null,function*(){!this.user||!(yield this.confirmation.confirm({title:"Unfollow user",message:`Are you sure you want to unfollow ${n.name}?`,confirmText:"Unfollow",cancelText:"Cancel"}))||this.userService.unfollowUser(this.user.id,n.id).subscribe({next:()=>{this.view==="following"?this.userList=this.userList.filter(a=>a.id!==n.id):this.followingIds.delete(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||1)-1),this.userService.notifyUserUpdate()},error:a=>console.error(a)})})}openProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}showEditProfile(){this.user&&(this.view="edit-profile",this.editData={name:this.user.name,email:this.user.email,description:this.user.description||""},this.passwordData={old:"",new:"",confirm:""})}onSaveProfile(){this.user&&this.userService.updateUser(this.user.id,this.editData).subscribe({next:n=>{this.user&&(this.user.name=n.name,this.user.email=n.email,this.user.description=n.description),this.showToast("Profile updated successfully"),this.userService.notifyUserUpdate()},error:n=>{console.error(n),this.showToast("Failed to update profile","error")}})}getShareLink(){if(!this.user)return"";let n=window.location.protocol,e=window.location.host;return`${n}//${e}/?user=${this.user.id}`}generateQrCode(){if(!this.user){this.qrCodeUrl="";return}let n=this.getShareLink();f6.toDataURL(n,{width:200,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(e=>{this.qrCodeUrl=e}).catch(e=>{console.error("QR Code generation failed",e),this.qrCodeUrl=""})}getQrCodeUrl(){return this.qrCodeUrl}copyShareLink(){let n=this.getShareLink();navigator.clipboard.writeText(n).then(()=>{this.showToast("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy: ",e),this.showToast("Unable to copy the link.","error")})}onChangePassword(){if(this.user){if(this.passwordData.new!==this.passwordData.confirm){this.showToast("New passwords do not match","error");return}if(!this.passwordData.old||!this.passwordData.new){this.showToast("Please fill in default fields","error");return}this.userService.changePassword(this.user.id,this.passwordData.old,this.passwordData.new).subscribe({next:()=>{this.showToast("Password changed successfully"),this.passwordData={old:"",new:"",confirm:""}},error:n=>{console.error(n),this.showToast("Failed to change password. Existing password may be incorrect.","error")}})}}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:700,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Ft(Cs),Ft(Na),Ft(Lc))};static \u0275cmp=Sn({type:i,selectors:[["app-account-modal"]],inputs:{user:"user"},outputs:{close:"close",changePhoto:"changePhoto",openProfile:"openProfile"},decls:13,vars:7,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],["type","button","aria-label","Back",1,"back-arrow"],[1,"title-wrap"],["aria-label","Close",1,"close-btn","close","tablet-desktop-only",3,"click"],["class","account-content",4,"ngIf"],["class","edit-profile-view",4,"ngIf"],["class","user-list-view",4,"ngIf"],["type","button","aria-label","Back",1,"back-arrow",3,"click"],[1,"account-content"],[1,"content-row"],[1,"content-col","left-col"],[1,"profile-section"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"edit-photo-btn",3,"click"],[1,"user-name"],[1,"user-email"],[1,"user-description"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"actions-section"],[1,"action-btn",3,"click"],[1,"vertical-divider"],[1,"content-col","right-col"],[1,"share-section-embedded"],[1,"share-header"],[1,"qr-code-wrapper"],["alt","Profile QR Code",3,"src"],[1,"share-details"],[1,"mini-link-group"],[1,"mini-copy-btn",3,"click"],[1,"edit-profile-view"],[1,"edit-content-layout"],[1,"edit-section","left-section"],[1,"form-group"],["placeholder","Name",3,"ngModelChange","ngModel"],["readonly","","disabled","",1,"readonly-input",3,"value"],["placeholder","Description (e.g. Find The Glow)","rows","3",3,"ngModelChange","ngModel"],[1,"button",3,"click"],[1,"edit-section","right-section"],["type","password","placeholder","Current Password",3,"ngModelChange","ngModel"],["type","password","placeholder","New Password",3,"ngModelChange","ngModel"],["type","password","placeholder","Confirm Password",3,"ngModelChange","ngModel"],[1,"user-list-view"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],["class","user-item",4,"ngFor","ngForOf"],["class","empty-list",4,"ngIf"],[1,"user-item"],[1,"user-info",3,"click"],["class","list-avatar",3,"src",4,"ngIf"],["class","list-avatar-placeholder",4,"ngIf"],[1,"list-username"],["class","unfollow-btn",3,"click",4,"ngIf"],["class","follow-btn",3,"click",4,"ngIf"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"unfollow-btn",3,"click"],[1,"follow-btn",3,"click"],[1,"empty-list"],[1,"loading-spinner"]],template:function(e,a){e&1&&(z(0,"div",1),Ae("click",function(){return a.onClose()}),z(1,"div",2),Ae("click",function(r){return r.stopPropagation()}),z(2,"div",3),Je(3,tie,3,0,"button",4),z(4,"div",5)(5,"h2"),Z(6),V()(),z(7,"button",6),Ae("click",function(){return a.onClose()}),z(8,"mat-icon"),Z(9,"close"),V()()(),ji(10,rie,48,7,"div",7)(11,oie,37,6,"div",8)(12,fie,4,2,"div",9),V()()),e&2&&(J(3),et(a.view!=="profile"?3:-1),J(2),hn("yellow-title",a.view!=="profile"),J(),ct(a.getViewTitle()),J(4),bt("ngIf",a.view==="profile"),J(),bt("ngIf",a.view==="edit-profile"),J(),bt("ngIf",a.view!=="profile"&&a.view!=="edit-profile"))},dependencies:[xi,P_,cs,Ai,Di,Ru,Ba,ws,Ws,_a],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--modal-backdrop-color);display:flex;justify-content:center;align-items:center;z-index:99999;-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.modal-container[_ngcontent-%COMP%]{background:var(--modal-surface);width:800px;max-width:95vw;height:auto;border-radius:var(--modal-radius);padding:24px;border:var(--modal-border);box-shadow:var(--modal-shadow);animation:_ngcontent-%COMP%_slideUp .3s ease-out;display:flex;flex-direction:column;overflow:hidden;box-sizing:border-box}.edit-profile-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden}.edit-content-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;flex:1;overflow-y:auto;padding:5%}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-gray);border-radius:3px}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}.back-arrow[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-white);cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.back-arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:var(--modal-header-border);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.close[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:none!important}}.account-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;height:100%}.content-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex:1;gap:24px;align-items:stretch}.content-col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:flex-start}.left-col[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:10px}.right-col[_ngcontent-%COMP%]{align-items:center;justify-content:center}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:auto}.share-section-embedded[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:15px;background:#ffffff08;border-radius:12px;padding:24px;border:1px solid rgba(255,255,255,.05);width:100%;box-sizing:border-box;height:100%;justify-content:center}.vertical-divider[_ngcontent-%COMP%]{width:1px;background:#ffffff1a}.edit-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:15px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:160px;display:block}.section-divider[_ngcontent-%COMP%]{display:none}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:20px;font-weight:600}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.avatar-container[_ngcontent-%COMP%]{position:relative;margin-bottom:8px}.profile-image[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--color-accent)}.profile-placeholder[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:600;color:var(--color-white);border:2px solid var(--color-accent)}.edit-photo-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background:var(--color-accent);color:#000;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 8px #0000004d;transition:transform .2s}.edit-photo-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.edit-photo-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.user-name[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--color-white);font-size:24px;font-weight:700;letter-spacing:-.5px;line-height:1.1}.user-email[_ngcontent-%COMP%]{margin:4px 0 0;color:#ffffff80;font-size:13px;display:flex;align-items:center;justify-content:center;gap:6px;font-weight:400}.user-email[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;opacity:.8}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d!important;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white)!important;font-size:14px;font-family:inherit;resize:none;min-height:80px}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:20px;margin-top:10px;padding:8px 0;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:15px}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:12px;border:1px solid var(--color-gray);background:#ffffff0d;color:var(--color-white);font-size:15px;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:var(--color-light-gray)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:opacity .2s}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.user-list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:10px}.list-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:20px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;padding:0;display:flex;align-items:center}.back-btn[_ngcontent-%COMP%]:hover{color:var(--color-white)}.user-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;overflow-y:auto;flex:1;padding-right:5px;scrollbar-width:none}.user-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:#ffffff0d}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;color:var(--color-white);font-size:14px;font-weight:600}.list-username[_ngcontent-%COMP%]{color:var(--color-white);font-size:16px;font-weight:500}.unfollow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-error, #ff4444);color:var(--color-error, #ff4444);padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;transition:all .2s}.unfollow-btn[_ngcontent-%COMP%]:hover{background:var(--color-error, #ff4444);color:#fff}.empty-list[_ngcontent-%COMP%]{color:var(--color-light-gray);text-align:center;padding:20px}.loading-spinner[_ngcontent-%COMP%]{color:var(--color-accent);text-align:center;padding:20px}.follow-btn[_ngcontent-%COMP%]{background:var(--color-accent);border:1px solid var(--color-accent);color:#000;padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;font-weight:600;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{opacity:.9;transform:scale(1.05)}.edit-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-accent);margin:0 0 5px;font-size:16px;font-weight:600}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--color-light-gray);font-size:12px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px}.form-group[_ngcontent-%COMP%]   input.readonly-input[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;background:#ffffff05}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px;font-family:inherit;resize:none}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none;overflow-y:auto;padding:0 0 80px}.content-row[_ngcontent-%COMP%], .edit-content-layout[_ngcontent-%COMP%]{flex-direction:column;gap:24px;background:linear-gradient(160deg,#141414,#0c0c0c)}.vertical-divider[_ngcontent-%COMP%]{display:none}.content-col[_ngcontent-%COMP%], .left-col[_ngcontent-%COMP%], .right-col[_ngcontent-%COMP%], .edit-section[_ngcontent-%COMP%]{width:100%;flex:none;padding:24px;box-sizing:border-box}.share-section-embedded[_ngcontent-%COMP%]{padding:20px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:140px}.profile-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:0 8px}.edit-section[_ngcontent-%COMP%]{padding:0 8px}.user-list[_ngcontent-%COMP%]{padding:24px}}.share-header[_ngcontent-%COMP%]{color:var(--color-white);font-size:14px;font-weight:500;opacity:.8}.qr-code-wrapper[_ngcontent-%COMP%]{background:#fff;padding:6px;border-radius:10px;flex-shrink:0}.share-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}.mini-link-group[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.mini-copy-btn[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-accent);color:var(--color-accent);border-radius:8px;padding:8px 16px;font-size:14px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s;width:100%;justify-content:center}.mini-copy-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.mini-copy-btn[_ngcontent-%COMP%]:hover{background:var(--color-accent);color:#000}"]})};function mie(i,n){i&1&&Rn(0,"span",3)}function gie(i,n){if(i&1){let e=wt();z(0,"notification-menu",9),Ae("click",function(d){return Me(e),De(d.stopPropagation())})("openChat",function(d){Me(e);let r=ne();return De(r.onOpenChatFromNotification(d))})("close",function(){Me(e);let d=ne();return De(d.showNotifications=!1)}),V()}if(i&2){let e=ne();bt("userId",(e.loggedUser==null?null:e.loggedUser.id)||0)}}function _ie(i,n){if(i&1&&Rn(0,"img",6),i&2){let e=ne();bt("src",e.loggedUser==null?null:e.loggedUser.profileImage,to)}}function vie(i,n){if(i&1&&(z(0,"div",7),Z(1),V()),i&2){let e=ne();J(),ct(e.getInitials((e.loggedUser==null?null:e.loggedUser.name)||(e.loggedUser==null?null:e.loggedUser.email)||""))}}function yie(i,n){if(i&1){let e=wt();z(0,"UserMenu",10),Ae("click",function(d){return Me(e),De(d.stopPropagation())})("close",function(){Me(e);let d=ne();return De(d.showUserMenu=!1)})("action",function(d){Me(e);let r=ne();return De(r.onMenuAction(d))}),V()}}function xie(i,n){if(i&1){let e=wt();z(0,"app-my-events-modal",11),Ae("close",function(){Me(e);let d=ne();return De(d.showMyEventsModal=!1)})("focusLocal",function(d){Me(e);let r=ne();return De(r.onFocusEvent(d))}),V()}if(i&2){let e=ne();bt("userId",(e.loggedUser==null?null:e.loggedUser.id)||0)}}function bie(i,n){if(i&1){let e=wt();z(0,"app-account-modal",12),Ae("close",function(){Me(e);let d=ne();return De(d.showAccountModal=!1)})("changePhoto",function(){Me(e);let d=ne();return De(d.onChangePhotoFromAccount())})("openProfile",function(d){Me(e);let r=ne();return De(r.onOpenProfileFromAccount(d))}),V()}if(i&2){let e=ne();bt("user",e.loggedUser)}}var ET=class i{constructor(n,e,a){this.notificationService=n;this.elementRef=e;this.userService=a}loggedUser=null;action=new $t;openProfile=new $t;openChatFromNotification=new $t;focusEvent=new $t;showUserMenu=!1;showNotifications=!1;showMyEventsModal=!1;showAccountModal=!1;hasUnread=!1;pollSubscription=null;ngOnInit(){this.startPolling()}ngOnDestroy(){this.stopPolling()}ngOnChanges(){this.loggedUser?(this.checkUnreadNotifications(),this.startPolling()):this.stopPolling()}startPolling(){this.pollSubscription||this.loggedUser&&(this.pollSubscription=lf(5e3).pipe(So(()=>{let n=[];return this.loggedUser&&!this.showNotifications&&n.push(this.notificationService.getNotifications(this.loggedUser.id)),this.loggedUser&&this.userService.notifyUserUpdate(),n.length>0?this.notificationService.getNotifications(this.loggedUser.id):[]})).subscribe({next:n=>{Array.isArray(n)&&(this.hasUnread=n.some(e=>!e.isRead))},error:n=>console.error("Error polling notifications",n)}))}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}onClickOutside(n){this.elementRef.nativeElement.contains(n.target)||(this.showUserMenu=!1,this.showNotifications=!1)}checkUnreadNotifications(){this.loggedUser&&this.notificationService.getNotifications(this.loggedUser.id).subscribe({next:n=>{this.hasUnread=n.some(e=>!e.isRead)},error:n=>console.error("Error fetching notifications status",n)})}toggleUserMenu(n){n&&n.stopPropagation(),this.showUserMenu=!this.showUserMenu,this.showNotifications=!1}toggleNotifications(n){n.stopPropagation(),this.showNotifications=!this.showNotifications,this.showUserMenu=!1,this.showNotifications&&this.loggedUser?this.notificationService.markAllAsRead(this.loggedUser.id).subscribe({next:()=>{this.hasUnread=!1},error:e=>console.error("Error marking read",e)}):!this.showNotifications&&this.loggedUser&&this.checkUnreadNotifications()}onMenuAction(n){n==="my-events"?this.showMyEventsModal=!0:n==="account"?this.showAccountModal=!0:this.action.emit(n),this.showUserMenu=!1}onOpenProfileFromAccount(n){this.showAccountModal=!1,this.openProfile.emit(n)}onChangePhotoFromAccount(){this.showAccountModal=!1,this.action.emit("change-photo")}onOpenChatFromNotification(n){this.showNotifications=!1,this.openChatFromNotification.emit(n)}onFocusEvent(n){this.showMyEventsModal=!1,this.focusEvent.emit(n)}onAddEvent(){this.action.emit("add-event")}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}static \u0275fac=function(e){return new(e||i)(Ft(vv),Ft(pr),Ft(Cs))};static \u0275cmp=Sn({type:i,selectors:[["app-action-bar"]],hostBindings:function(e,a){e&1&&Ae("click",function(r){return a.onClickOutside(r)},tx)},inputs:{loggedUser:"loggedUser"},outputs:{action:"action",openProfile:"openProfile",openChatFromNotification:"openChatFromNotification",focusEvent:"focusEvent"},features:[Gr],decls:14,vars:6,consts:[[1,"action-bar"],[1,"add-event-btn","button",3,"click"],[1,"icon-circle","notification-icon",3,"click"],[1,"unread-indicator"],[3,"userId"],[1,"profile-trigger",3,"click"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[3,"user"],[3,"click","openChat","close","userId"],[3,"click","close","action"],[3,"close","focusLocal","userId"],[3,"close","changePhoto","openProfile","user"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"button",1),Ae("click",function(){return a.onAddEvent()}),Z(2,"Add Event"),V(),z(3,"div",2),Ae("click",function(r){return a.toggleNotifications(r)}),z(4,"mat-icon"),Z(5,"notifications"),V(),Je(6,mie,1,0,"span",3),Je(7,gie,1,1,"notification-menu",4),V(),z(8,"div",5),Ae("click",function(r){return a.toggleUserMenu(r)}),Je(9,_ie,1,1,"img",6)(10,vie,2,1,"div",7),Je(11,yie,1,0,"UserMenu"),V()(),Je(12,xie,1,1,"app-my-events-modal",4),Je(13,bie,1,1,"app-account-modal",8)),e&2&&(J(6),et(a.hasUnread?6:-1),J(),et(a.showNotifications?7:-1),J(2),et(a.loggedUser!=null&&a.loggedUser.profileImage?9:10),J(2),et(a.showUserMenu?11:-1),J(),et(a.showMyEventsModal?12:-1),J(),et(a.showAccountModal?13:-1))},dependencies:[xi,Ai,Di,yT,xT,wT,CT],styles:[".action-bar[_ngcontent-%COMP%]{height:72px;position:absolute;top:20px;right:20px;display:flex;align-items:center;justify-content:space-between;gap:10px;background:var(--color-dark-gray);padding:12px;border-radius:var(--radius-2xl);box-shadow:var(--shadow-lg);z-index:var(--z-action-bar);width:auto;box-sizing:border-box;border:1px solid var(--color-light-gray)}.action-bar[_ngcontent-%COMP%]   .add-event-btn[_ngcontent-%COMP%]{height:44px;cursor:pointer;transition:transform .1s ease,filter .2s}.add-event-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.1);transform:scale(1.02)}.profile-trigger[_ngcontent-%COMP%]{height:44px;width:44px;border-radius:var(--radius-full);overflow:hidden;cursor:pointer;border:1px solid transparent;transition:border-color .2s;background-color:var(--color-dark-gray);display:flex;justify-content:center;align-items:center}.profile-trigger[_ngcontent-%COMP%]:hover{border-color:var(--color-accent)}.profile-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-semibold);font-size:16px}.icon-circle[_ngcontent-%COMP%]{width:44px;height:44px;background:#ffffff1a;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s,transform .2s}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px;color:var(--color-white)}.icon-circle[_ngcontent-%COMP%]:hover{background:#fff3}.notification-icon[_ngcontent-%COMP%]{margin-right:4px;margin-left:4px;position:relative}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;width:10px;height:10px;background-color:var(--color-accent);border-radius:var(--radius-full);border:2px solid var(--color-dark-gray);z-index:10}notification-menu[_ngcontent-%COMP%]{position:absolute;top:70px;right:-70px;z-index:var(--z-dropdown)}@media (max-width: 768px){.action-bar[_ngcontent-%COMP%]{top:20px;bottom:auto;right:20px;padding:8px;height:60px}}"]})};var wie=["canvas"],ST=class i{imageFile;close=new $t;imageCropped=new $t;canvasRef;ctx;image=new Image;scale=1;offsetX=0;offsetY=0;isDragging=!1;lastX=0;lastY=0;VIEWPORT_SIZE=300;OUTPUT_SIZE=128;ngAfterViewInit(){let n=this.canvasRef.nativeElement;this.ctx=n.getContext("2d");let e=new FileReader;e.onload=a=>{this.image.src=a.target.result,this.image.onload=()=>{this.resetView(),this.draw()}},e.readAsDataURL(this.imageFile)}resetView(){let n=this.VIEWPORT_SIZE/this.image.width,e=this.VIEWPORT_SIZE/this.image.height;this.scale=Math.max(n,e),this.offsetX=(this.VIEWPORT_SIZE-this.image.width*this.scale)/2,this.offsetY=(this.VIEWPORT_SIZE-this.image.height*this.scale)/2}draw(){this.ctx&&(this.ctx.clearRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.ctx.drawImage(this.image,0,0),this.ctx.restore())}onMouseDown(n){this.isDragging=!0,this.lastX=n.clientX,this.lastY=n.clientY}onMouseMove(n){if(!this.isDragging)return;let e=n.clientX-this.lastX,a=n.clientY-this.lastY;this.offsetX+=e,this.offsetY+=a,this.lastX=n.clientX,this.lastY=n.clientY,this.draw()}onMouseUp(){this.isDragging=!1}onWheel(n){n.preventDefault();let a=this.scale-n.deltaY*.001;a>.1&&(this.scale=a,this.draw())}onZoomChange(n){this.scale=parseFloat(n.target.value),this.draw()}zoomIn(){this.scale=Math.min(this.scale+.1,5),this.draw()}zoomOut(){this.scale=Math.max(this.scale-.1,.1),this.draw()}crop(){let n=document.createElement("canvas");n.width=this.OUTPUT_SIZE,n.height=this.OUTPUT_SIZE;let e=n.getContext("2d"),a=(0-this.offsetX)/this.scale,d=(0-this.offsetY)/this.scale,r=this.VIEWPORT_SIZE/this.scale,E=this.VIEWPORT_SIZE/this.scale;e.drawImage(this.image,a,d,r,E,0,0,this.OUTPUT_SIZE,this.OUTPUT_SIZE),n.toBlob(P=>{P&&this.imageCropped.emit(P)},"image/jpeg",.9)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Sn({type:i,selectors:[["CropImagePopup"]],viewQuery:function(e,a){if(e&1&&ka(wie,5),e&2){let d;pa(d=fa())&&(a.canvasRef=d.first)}},inputs:{imageFile:"imageFile"},outputs:{close:"close",imageCropped:"imageCropped"},decls:23,vars:3,consts:[["canvas",""],[1,"crop-backdrop"],[1,"crop-container"],[1,"crop-header"],[1,"close-btn",3,"click"],[1,"canvas-wrapper"],[3,"mousedown","mousemove","mouseup","mouseleave","wheel","width","height"],[1,"overlay-guide"],[1,"controls"],[1,"zoom-icon",2,"cursor","pointer",3,"click"],["type","range","min","0.1","max","5","step","0.1",3,"input","value"],[1,"actions"],[1,"btn-cancel","button",3,"click"],[1,"button",3,"click"]],template:function(e,a){if(e&1){let d=wt();z(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3"),Z(4,"Crop Image"),V(),z(5,"button",4),Ae("click",function(){return Me(d),De(a.close.emit())}),z(6,"mat-icon"),Z(7,"close"),V()()(),z(8,"div",5)(9,"canvas",6,0),Ae("mousedown",function(E){return Me(d),De(a.onMouseDown(E))})("mousemove",function(E){return Me(d),De(a.onMouseMove(E))})("mouseup",function(){return Me(d),De(a.onMouseUp())})("mouseleave",function(){return Me(d),De(a.onMouseUp())})("wheel",function(E){return Me(d),De(a.onWheel(E))}),V(),Rn(11,"div",7),V(),z(12,"div",8)(13,"span",9),Ae("click",function(){return Me(d),De(a.zoomOut())}),Z(14,"\u2212"),V(),z(15,"input",10),Ae("input",function(E){return Me(d),De(a.onZoomChange(E))}),V(),z(16,"span",9),Ae("click",function(){return Me(d),De(a.zoomIn())}),Z(17,"+"),V()(),z(18,"div",11)(19,"button",12),Ae("click",function(){return Me(d),De(a.close.emit())}),Z(20,"Cancel"),V(),z(21,"button",13),Ae("click",function(){return Me(d),De(a.crop())}),Z(22,"Save Photo"),V()()()()}e&2&&(J(9),bt("width",a.VIEWPORT_SIZE)("height",a.VIEWPORT_SIZE),J(6),bt("value",a.scale))},dependencies:[xi,Ai,Di],styles:[".crop-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:1000;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.crop-container[_ngcontent-%COMP%]{background:var(--modal-surface);border-radius:var(--modal-radius);padding:24px;width:90%;max-width:400px;border:var(--modal-border);box-shadow:var(--modal-shadow);display:flex;flex-direction:column;gap:20px;position:relative}.crop-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.crop-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:18px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;width:300px;height:300px;margin:0 auto;border-radius:12px;overflow:hidden;background:var(--color-gray);cursor:move}.overlay-guide[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid var(--color-light-gray);box-sizing:border-box;pointer-events:none;border-radius:12px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-light-gray)}input[type=range][_ngcontent-%COMP%]{flex:1;accent-color:var(--color-accent);height:4px;background:var(--color-light-gray);border-radius:2px;appearance:none}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--color-white);border-radius:50%;cursor:pointer}.actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:10px}.btn-cancel[_ngcontent-%COMP%]{height:auto;border:1px solid var(--color-light-gray);background:var(--color-dark-gray)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}"]})};function Cie(i,n){if(i&1&&(z(0,"p",7),Z(1),V()),i&2){let e=ne();J(),ct(e.generalError)}}function Eie(i,n){if(i&1&&(z(0,"p",7),Z(1),Ls(2,"keyvalue"),V()),i&2){let e=ne();J(),ct(M_(2,1,e.errors)[0].value)}}var TT=class i{constructor(n,e,a){this.fb=n;this.http=e;this.mapboxService=a;this.form=this.fb.group({title:["",ku.required],description:["",ku.required],date:["",ku.required],endDate:[""],startTime:["",ku.required],endTime:[""],nPartecipants:["",[ku.required,ku.min(1)]],costPerPerson:["",[ku.min(0)]]},{validators:this.timeRangeValidator})}close=new $t;eventCreated=new $t;openLocationSelector=new $t;form;generalError="";errors={};latitude=null;longitude=null;locationText="Select position on map";selectedCity=null;timeRangeValidator(n){let e=n.get("startTime")?.value,a=n.get("endTime")?.value;if(e&&a){let[d,r]=e.split(":").map(Number),[E,P]=a.split(":").map(Number),k=d*60+r,X=E*60+P;if(X<=k)return{timeOrder:!0};if(X-k<60)return{minDuration:!0}}return null}onClose(){this.close.emit()}submitAttempted=!1;hasError(n){let e=this.form.get(n),a=n==="startTime"||n==="endTime",d=this.form.errors?.timeOrder||this.form.errors?.minDuration;return!!(this.submitAttempted&&(e?.invalid||a&&d))}selectLocationOnMap(){this.openLocationSelector.emit()}setLocation(n,e){this.latitude=n,this.longitude=e,this.selectedCity=null,this.locationText="Location selected",this.mapboxService.reverseGeocode(n,e).subscribe({next:a=>{a&&(this.selectedCity=a,this.locationText=`Location: ${a}`)},error:a=>console.error("Error reverse geocoding city",a)})}onSubmit(){this.submitAttempted=!0,this.errors={},this.generalError="",Object.keys(this.form.controls).forEach(E=>{this.form.get(E)?.markAsTouched()});let n=this.form.controls;if(n.title.invalid&&(this.errors.title="Title is required."),n.description.invalid&&(this.errors.description="Description is required."),n.date.invalid&&(this.errors.date="Date is required."),n.startTime.invalid&&(this.errors.startTime="Start time is required."),n.nPartecipants.invalid&&(n.nPartecipants.errors?.required?this.errors.nPartecipants="Number of participants is required.":n.nPartecipants.errors?.min&&(this.errors.nPartecipants="Number of participants must be at least 1.")),n.costPerPerson.invalid&&(n.costPerPerson.errors?.min?this.errors.costPerPerson="Cost cannot be negative.":this.errors.costPerPerson="Invalid cost."),this.form.errors?.timeOrder?this.errors.time="Start time must be before end time.":this.form.errors?.minDuration&&(this.errors.time="Event must last at least one hour."),this.latitude===null||this.longitude===null?this.errors.location="Select a location on the map.":this.selectedCity||(this.errors.location="Unable to detect city from selected location."),Object.keys(this.errors).length>0)return;let e=this.form.value,a={title:e.title,description:e.description,city:this.selectedCity,date:e.date,endDate:e.endDate||null,startTime:e.startTime,endTime:e.endTime,nPartecipants:parseInt(e.nPartecipants),costPerPerson:e.costPerPerson!==null&&e.costPerPerson!==""?Math.max(0,parseFloat(e.costPerPerson)):null,latitude:this.latitude,longitude:this.longitude},d=localStorage.getItem("user"),r=d?JSON.parse(d).id:null;this.http.post(`http://localhost:8080/api/events?userId=${r}`,a).subscribe({next:E=>{this.eventCreated.emit(E),this.onClose()},error:E=>{console.error("Error creating event:",E),this.generalError="Error creating event"}})}static \u0275fac=function(e){return new(e||i)(Ft(av),Ft(yo),Ft(Fu))};static \u0275cmp=Sn({type:i,selectors:[["create-event-popup"]],outputs:{close:"close",eventCreated:"eventCreated",openLocationSelector:"openLocationSelector"},decls:34,vars:29,consts:[[1,"backdrop",3,"click"],[1,"popup-container","desktop"],[1,"popup-content"],[1,"mobile-header"],[3,"click"],[1,"close-btn","close","tablet-desktop-only",3,"click"],[1,"header","desktop-header"],[1,"error"],[1,"form"],[1,"two-column","single-column"],["placeholder","Title",3,"error","control","type"],["placeholder","Description","customClass","tall-field",3,"error","control","type"],[1,"two-column"],["placeholder","From",3,"error","control","type"],["placeholder","To",3,"error","control","type"],["placeholder","Start",3,"error","control","type"],["placeholder","End",3,"error","control","type"],["placeholder","Max Participants",3,"error","control","type"],["placeholder","Cost (\u20AC)",3,"error","control","type","min"],["type","button",1,"button","location-btn",3,"click"],["type","button",1,"button",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.onClose()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Ae("click",function(){return a.onClose()}),Z(5,"arrow_back"),V(),z(6,"h1"),Z(7,"Create Event"),V()(),z(8,"button",5),Ae("click",function(){return a.onClose()}),z(9,"mat-icon"),Z(10,"close"),V()(),z(11,"div",6)(12,"h1"),Z(13,"Create Event"),V(),Je(14,Cie,2,1,"p",7),Ls(15,"keyvalue"),sx(16,Eie,3,3,"p",7),V(),z(17,"form",8)(18,"div",9),Rn(19,"FormField",10),V(),Rn(20,"FormField",11),z(21,"div",12),Rn(22,"FormField",13)(23,"FormField",14),V(),z(24,"div",12),Rn(25,"FormField",15)(26,"FormField",16),V(),z(27,"div",12),Rn(28,"FormField",17)(29,"FormField",18),V(),z(30,"button",19),Ae("click",function(){return a.selectLocationOnMap()}),Z(31),V(),z(32,"button",20),Ae("click",function(){return a.onSubmit()}),Z(33,"Create Event"),V()()()()),e&2&&(J(14),et(a.generalError?14:M_(15,27,a.errors).length>0?16:-1),J(5),bt("error",a.hasError("title"))("control",a.form.get("title"))("type","text"),J(),bt("error",a.hasError("description"))("control",a.form.get("description"))("type","textarea"),J(2),bt("error",a.hasError("date"))("control",a.form.get("date"))("type","date"),J(),bt("error",a.hasError("endDate"))("control",a.form.get("endDate"))("type","date"),J(2),bt("error",a.hasError("startTime"))("control",a.form.get("startTime"))("type","time"),J(),bt("error",a.hasError("endTime"))("control",a.form.get("endTime"))("type","time"),J(2),bt("error",a.hasError("nPartecipants"))("control",a.form.get("nPartecipants"))("type","number"),J(),bt("error",a.hasError("costPerPerson"))("control",a.form.get("costPerPerson"))("type","number")("min",0),J(2),Zi(" \u{1F4CD} ",a.locationText," "))},dependencies:[xi,tp,Wh,sv,ov,Ai,Di,vP],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:45%;max-height:95vh;background:var(--modal-surface);border-radius:var(--modal-radius);border:var(--modal-border);display:flex;flex-direction:column;overflow:visible}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{padding:20px 0 10px;text-align:center;width:100%}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-lg);padding:0 8% 24px;box-sizing:border-box}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.two-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md);width:100%}.single-column[_ngcontent-%COMP%]{grid-template-columns:1fr}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md);width:100%}.tall-field[_ngcontent-%COMP%]{min-height:80px}.tall-field[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.description-row[_ngcontent-%COMP%]{width:100%;min-height:80px}.description-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.time-section[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-sm)}.section-label[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-light-gray);margin:0}.time-inputs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-md);width:100%}.time-inputs[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.time-separator[_ngcontent-%COMP%]{font-size:18px;color:var(--color-light-gray);padding:0 var(--spacing-xs)}.location-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-sm);width:100%}.location-btn[_ngcontent-%COMP%]{background-color:var(--color-gray);width:100%;border:2px solid rgba(255,255,255,.12);box-sizing:border-box}.location-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.error[_ngcontent-%COMP%]{color:var(--color-error);font-size:18px;margin:0}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{width:100vw;height:100vh;max-width:none;max-height:none;border-radius:0;inset:0;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;max-width:none;max-height:none;border-radius:0;border:none;justify-content:flex-start;background:var(--modal-surface);overflow-y:auto}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md)}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px;font-size:18px}.button[_ngcontent-%COMP%]{height:60px;font-size:16px}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}.form[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg);padding:0 10%;height:100%}}"]})};var IT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api";createReport(n){return this.http.post(`${this.baseUrl}/reports`,n)}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};function Tie(i,n){if(i&1&&(z(0,"p",3),Z(1,"You are reporting: "),z(2,"strong"),Z(3),V()()),i&2){let e=ne();J(3),ct(e.targetLabel)}}function Iie(i,n){if(i&1){let e=wt();z(0,"div",11)(1,"span"),Z(2),V(),z(3,"button",15),Ae("click",function(){Me(e);let d=ne();return De(d.clearImage())}),z(4,"mat-icon"),Z(5,"close"),V()()()}if(i&2){let e=ne();J(2),ct(e.imageName)}}var xv=class i{constructor(n,e){this.reportService=n;this.snackBar=e}reporterId=null;targetType="USER";targetId=null;targetLabel="";close=new $t;submitted=new $t;reason="";details="";imageFile=null;imageName="";isSubmitting=!1;onClose(){this.close.emit()}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let a=e.files[0];this.imageFile=a,this.imageName=a.name}clearImage(){this.imageFile=null,this.imageName=""}submitReport(){if(!this.reporterId||!this.targetId){this.showToast("You must be logged in to report.","error");return}if(!this.reason.trim()){this.showToast("Please enter the main reason.","error");return}let n=new FormData;n.append("reporterId",this.reporterId),n.append("targetType",this.targetType),n.append("targetId",this.targetId),n.append("reason",this.reason.trim()),this.details.trim()&&n.append("details",this.details.trim()),this.imageFile&&n.append("image",this.imageFile,this.imageFile.name),this.isSubmitting=!0,this.reportService.createReport(n).subscribe({next:()=>{this.showToast("Report submitted."),this.isSubmitting=!1,this.submitted.emit(),this.onClose()},error:e=>{console.error("Error submitting report",e),this.showToast("Unable to submit the report.","error"),this.isSubmitting=!1}})}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1400:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Ft(IT),Ft(Lc))};static \u0275cmp=Sn({type:i,selectors:[["app-report-modal"]],inputs:{reporterId:"reporterId",targetType:"targetType",targetId:"targetId",targetLabel:"targetLabel"},outputs:{close:"close",submitted:"submitted"},decls:27,vars:7,consts:[[1,"report-backdrop",3,"click"],[1,"report-modal",3,"click"],[1,"report-header"],[1,"target-line"],["type","button",1,"icon-btn",3,"click"],[1,"report-body"],[1,"field-label"],["type","text","placeholder","E.g. Offensive language, scam, inappropriate behavior",1,"field-input",3,"ngModelChange","ngModel"],["rows","4","placeholder","Add any other helpful details...",1,"field-input","field-textarea",3,"ngModelChange","ngModel"],[1,"file-row"],["type","file","accept","image/*",1,"file-input",3,"change"],[1,"file-chip"],[1,"report-actions"],["type","button",1,"button","secondary",3,"click"],["type","button",1,"button",3,"click","disabled"],["type","button",1,"file-remove",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.onClose()}),z(1,"div",1),Ae("click",function(r){return r.stopPropagation()}),z(2,"div",2)(3,"div")(4,"h3"),Z(5),V(),Je(6,Tie,4,1,"p",3),V(),z(7,"button",4),Ae("click",function(){return a.onClose()}),z(8,"mat-icon"),Z(9,"close"),V()()(),z(10,"div",5)(11,"label",6),Z(12,"Main reason"),V(),z(13,"input",7),vo("ngModelChange",function(r){return To(a.reason,r)||(a.reason=r),r}),V(),z(14,"label",6),Z(15,"Details (optional)"),V(),z(16,"textarea",8),vo("ngModelChange",function(r){return To(a.details,r)||(a.details=r),r}),V(),z(17,"label",6),Z(18,"Image (optional)"),V(),z(19,"div",9)(20,"input",10),Ae("change",function(r){return a.onFileSelected(r)}),V(),Je(21,Iie,6,1,"div",11),V()(),z(22,"div",12)(23,"button",13),Ae("click",function(){return a.onClose()}),Z(24,"Cancel"),V(),z(25,"button",14),Ae("click",function(){return a.submitReport()}),Z(26),V()()()()),e&2&&(J(5),Zi("Report ",a.targetType==="USER"?"user":"event"),J(),et(a.targetLabel?6:-1),J(7),_o("ngModel",a.reason),J(3),_o("ngModel",a.details),J(5),et(a.imageName?21:-1),J(4),bt("disabled",a.isSubmitting||!a.reason.trim()),J(),Zi(" ",a.isSubmitting?"Sending...":"Submit report"," "))},dependencies:[xi,Ba,ws,Ws,_a,Ai,Di,Ru],styles:[".report-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;justify-content:center;align-items:center;z-index:2000;padding:24px}.report-modal[_ngcontent-%COMP%]{background:#141414f2;color:#fff;border-radius:20px;width:min(520px,100%);box-shadow:0 20px 60px #00000080;border:1px solid rgba(252,195,36,.2);padding:20px 22px;display:flex;flex-direction:column;gap:16px}.report-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-start}.report-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px;color:#f4c12a}.target-line[_ngcontent-%COMP%]{margin:4px 0 0;color:#ffffffb3;font-size:13px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;cursor:pointer}.report-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.field-label[_ngcontent-%COMP%]{font-size:13px;color:#fffc}.field-input[_ngcontent-%COMP%]{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#ffffff14;color:#fff;padding:10px 12px;font-size:14px;outline:none}.field-input[_ngcontent-%COMP%]:focus{border-color:#fcc32499}.field-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:96px}.file-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.file-input[_ngcontent-%COMP%]{width:100%;color:#fffc;background:#ffffff14;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:6px 8px;font-size:14px;outline:none}.file-input[_ngcontent-%COMP%]:focus{border-color:#fcc32499}.file-input[_ngcontent-%COMP%]::file-selector-button, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button{margin-right:12px;border:none;background-color:var(--color-accent, #f4c12a);color:#fff;padding:8px 14px;border-radius:10px;font-weight:700;font-family:inherit;cursor:pointer;transition:transform .2s,opacity .2s}.file-input[_ngcontent-%COMP%]::file-selector-button:hover, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button:hover{opacity:.9;transform:translateY(-1px)}.file-input[_ngcontent-%COMP%]::file-selector-button:active, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button:active{transform:translateY(0)}.file-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#fcc32426;border:1px solid rgba(252,195,36,.4);padding:6px 10px;border-radius:999px;font-size:12px;max-width:100%;overflow:hidden;text-overflow:ellipsis}.file-chip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:280px}.file-remove[_ngcontent-%COMP%]{border:none;background:transparent;color:#f4c12a;cursor:pointer;display:flex;align-items:center}.report-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px}@media (max-width: 600px){.report-modal[_ngcontent-%COMP%]{padding:18px 16px}}"]})};function Mie(i,n){if(i&1&&(z(0,"p",5)(1,"mat-icon",7),Z(2,"place"),V(),z(3,"span"),Z(4),V()()),i&2){let e=ne();J(4),ct(e.event.city)}}function Die(i,n){if(i&1&&(z(0,"p",5),Z(1),V()),i&2){let e=ne();J(),ct(e.getSubtitle())}}function Aie(i,n){if(i&1){let e=wt();z(0,"button",26),Ae("click",function(d){Me(e);let r=ne();return De(r.openInMaps(d))}),z(1,"mat-icon"),Z(2,"map"),V()()}}function Pie(i,n){if(i&1&&(z(0,"span",28),Z(1),V()),i&2){let e=ne(2);J(),ct(e.event.savedCount)}}function Oie(i,n){if(i&1){let e=wt();z(0,"button",27),Ae("click",function(d){return Me(e),ne().toggleFavorite.emit(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2),V(),Je(3,Pie,2,1,"span",28),V()}if(i&2){let e=ne();hn("saved",e.isSaved()),J(2),ct(e.isSaved()?"favorite":"favorite_border"),J(),et(e.event.savedCount!==void 0&&e.event.savedCount!==null?3:-1)}}function Rie(i,n){if(i&1){let e=wt();z(0,"button",29),Ae("click",function(d){return Me(e),ne().openReportModal(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2,"flag"),V()()}}function kie(i,n){if(i&1&&(z(0,"span",14)(1,"mat-icon"),Z(2,"event_available"),V(),z(3,"span"),Z(4),V()()),i&2){let e=ne();J(4),Zi("",e.event.nPartecipants-(e.event.occupiedSpots||0)," spots left")}}function Fie(i,n){if(i&1&&(z(0,"p",30),Z(1),V()),i&2){let e=ne();J(),ct(e.event.description)}}function Lie(i,n){if(i&1&&Rn(0,"img",20),i&2){let e=ne();bt("src",e.organizerImage,to)}}function Nie(i,n){if(i&1&&(z(0,"div",21),Z(1),V()),i&2){let e=ne();J(),ct(e.getInitials(e.organizerName))}}function zie(i,n){i&1&&(z(0,"span",31),Z(1,"You"),V())}function Bie(i,n){if(i&1){let e=wt();z(0,"button",34),Ae("click",function(d){return Me(e),ne(3).followOrganizer(),De(d.stopPropagation())}),z(1,"mat-icon"),Z(2,"person_add"),V()()}}function Vie(i,n){if(i&1){let e=wt();z(0,"div",33)(1,"button",35),Ae("click",function(d){Me(e);let r=ne(3);return De(r.toggleNotifications(d))}),z(2,"mat-icon"),Z(3),V()()()}if(i&2){let e=ne(3);J(),hn("active",e.notificationsEnabled),bt("disabled",e.notificationsLoading),J(2),ct(e.notificationsEnabled?"notifications":"notifications_off")}}function Uie(i,n){if(i&1&&Je(0,Bie,3,0,"button",32)(1,Vie,4,4,"div",33),i&2){let e=ne(2);et(!e.isFollowing&&!e.isLoadingFollowStatus?0:e.isFollowing?1:-1)}}function jie(i,n){if(i&1&&Je(0,zie,2,0,"span",31)(1,Uie,2,1),i&2){let e=ne();et(e.currentUserId.toString()===((e.creatorId||e.event.creatorId)==null?null:(e.creatorId||e.event.creatorId).toString())?0:1)}}function $ie(i,n){if(i&1){let e=wt();z(0,"div",36),Z(1,"You cannot join your own event"),V(),z(2,"button",37),Ae("click",function(){Me(e);let d=ne();return De(d.onDeleteEvent())}),Z(3,"Delete event"),V()}}function Hie(i,n){if(i&1){let e=wt();z(0,"div",38)(1,"button",41),Z(2,"Joined"),V(),z(3,"button",42),Ae("click",function(){Me(e);let d=ne(2);return De(d.onOpenChat())}),Z(4,"Chat"),V(),z(5,"button",43),Ae("click",function(){Me(e);let d=ne(2);return De(d.onLeave())}),Z(6,"Leave"),V()()}}function Gie(i,n){i&1&&(z(0,"button",39),Z(1,"Pending"),V())}function qie(i,n){if(i&1){let e=wt();z(0,"button",44),Ae("click",function(){Me(e);let d=ne(2);return De(d.onParticipate())}),Z(1,"Request to join"),V()}}function Wie(i,n){if(i&1&&Je(0,Hie,7,0,"div",38)(1,Gie,2,0,"button",39)(2,qie,2,0,"button",40),i&2){let e=ne();et(e.event.participationStatus==="ACCEPTED"?0:e.event.participationStatus==="PENDING"?1:2)}}function Zie(i,n){if(i&1){let e=wt();z(0,"app-report-modal",45),Ae("close",function(){Me(e);let d=ne();return De(d.closeReportModal())})("submitted",function(){Me(e);let d=ne();return De(d.closeReportModal())}),V()}if(i&2){let e=ne();bt("reporterId",e.currentUserId)("targetType","EVENT")("targetId",e.event.id?e.event.id.toString():null)("targetLabel",e.event.title)}}var MT=class i{constructor(n,e){this.elementRef=n;this.userService=e}event;organizerName="Eventer";organizerImage;eventPosition;currentUserId=null;creatorId;close=new $t;participate=new $t;toggleFavorite=new $t;openOrganizerProfile=new $t;leave=new $t;deleteEvent=new $t;shareEvent=new $t;openChat=new $t;isFollowing=!1;isLoadingFollowStatus=!0;notificationsEnabled=!1;notificationsLoading=!1;showReportModal=!1;ngAfterViewInit(){this.positionCard()}ngOnChanges(n){n.eventPosition&&this.positionCard(),(n.event||n.currentUserId||n.creatorId)&&this.checkIfFollowing()}checkIfFollowing(){let n=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!n||this.currentUserId===n.toString()){this.isFollowing=!1,this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1;return}this.isLoadingFollowStatus=!0,this.userService.isFollowing(this.currentUserId,n.toString()).subscribe({next:e=>{this.isFollowing=e.isFollowing,this.isLoadingFollowStatus=!1,this.isFollowing?this.loadNotificationPreference(n.toString()):this.notificationsEnabled=!1},error:e=>{console.error("Error checking follow status",e),this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1}})}onClick(n){n.stopPropagation()}onResize(){this.positionCard()}positionCard(){if(!this.eventPosition)return;let n=this.elementRef.nativeElement.querySelector(".card-container");if(n){let e=document.querySelector(".sidebar-container"),a=e?.getBoundingClientRect(),d=a&&!e?.classList.contains("collapsed")?a.right:0,r=12,E=d>0?d+r:r,P=r,X=window.innerWidth<=768?100:P,oe=n.offsetWidth||0,Se=n.offsetHeight||0,$e=window.innerWidth,ke=window.innerHeight,ht=-20,Nt=this.eventPosition.x,Mt=this.eventPosition.y+ht,Xt=Nt-oe/2,Vn=Nt+oe/2;Xt<E?Nt+=E-Xt:Vn>$e-P&&(Nt-=Vn-($e-P));let sr=Mt-Se;sr<X&&(Mt+=X-sr);let Li=document.querySelector(".action-bar")?.getBoundingClientRect();if(Li){let Or=Nt-oe/2,Ho=Nt+oe/2,Ys=Mt-Se,Nu=Mt,zu=Ho>Li.left-P&&Or<Li.right+P,ci=Nu>Li.top-P&&Ys<Li.bottom+P;if(zu&&ci){let Bu=Li.bottom+P;Ys<Bu&&(Mt+=Bu-Ys)}}Mt>ke-P&&(Mt=ke-P),n.style.left=`${Nt}px`,n.style.top=`${Mt}px`,n.style.transform="translate(-50%, -100%)"}}onClose(){this.close.emit()}onParticipate(){this.isOrganizer()||this.participate.emit(this.event)}onLeave(){this.leave.emit(this.event)}onOpenChat(){this.openChat.emit(this.event)}onDeleteEvent(){this.isOrganizer()&&this.deleteEvent.emit(this.event)}toggleNotifications(n){n.stopPropagation();let e=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!e||!this.isFollowing)return;let a=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,e.toString(),a).subscribe({next:d=>{this.notificationsEnabled=d.enabled,this.notificationsLoading=!1},error:d=>{console.error("Error updating follow notifications",d),this.notificationsLoading=!1}})}isOrganizer(){let n=this.creatorId??this.event?.creatorId;return!!this.currentUserId&&!!n&&this.currentUserId.toString()===n.toString()}getOrganizerId(){let n=this.creatorId??this.event?.creatorId??this.event?.creator?.id;return n!=null?String(n):null}formatHeroDate(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):null,a=n?n.toLocaleDateString("en-US",{weekday:"short"}):"",d=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"";return[[a,d].filter(Boolean).join(" "),e||""].filter(Boolean).join(", ")}getActualParticipants(){return this.event.occupiedSpots!==void 0&&this.event.occupiedSpots!==null?this.event.occupiedSpots:this.event.nPartecipants||0}getSubtitle(){return this.event.city?this.event.city:this.event.description?this.event.description:"Location TBD"}hasCoordinates(){return!!this.event&&Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)}openInMaps(n){if(n?.stopPropagation(),!this.hasCoordinates())return;let e=`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`;window.open(e,"_blank","noopener")}showDescription(){return!!this.event.description&&this.event.description!==this.getSubtitle()}formatDateTime(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):null,a=this.event.endTime?this.event.endTime.slice(0,5):null,d=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",r=a?`${e} \u2014 ${a}`:e;return[d,r].filter(Boolean).join(" / ")}formatCost(){return this.event.costPerPerson!==void 0&&this.event.costPerPerson!==null?`${this.event.costPerPerson} per person`:"Free"}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"OR"}isSaved(){return this.event.isSaved}followOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.followUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.userService.notifyUserUpdate()},error:e=>console.error("Error following",e)})}unfollowOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.unfollowUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!1,this.notificationsEnabled=!1,this.userService.notifyUserUpdate()},error:e=>console.error("Error unfollowing",e)})}onOrganizerClick(){let n=this.getOrganizerId();if(!n){console.log("[EventPopupCard] eventer click with missing id",{creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event});return}console.log("[EventPopupCard] open eventer",{organizerId:n,creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event}),this.openOrganizerProfile.emit(n)}openReportModal(){!this.currentUserId||this.isOrganizer()||(this.showReportModal=!0)}closeReportModal(){this.showReportModal=!1}loadNotificationPreference(n){this.currentUserId&&(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,n).subscribe({next:e=>{this.notificationsEnabled=!!e.enabled,this.notificationsLoading=!1},error:e=>{console.error("Error fetching follow notifications preference",e),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(e){return new(e||i)(Ft(pr),Ft(Cs))};static \u0275cmp=Sn({type:i,selectors:[["event-popup-card"]],hostBindings:function(e,a){e&1&&Ae("click",function(r){return a.onClick(r)})("resize",function(){return a.onResize()},v2)},inputs:{event:"event",organizerName:"organizerName",organizerImage:"organizerImage",eventPosition:"eventPosition",currentUserId:"currentUserId",creatorId:"creatorId"},outputs:{close:"close",participate:"participate",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",leave:"leave",deleteEvent:"deleteEvent",shareEvent:"shareEvent",openChat:"openChat"},features:[Gr],decls:47,vars:15,consts:[[1,"card-container"],[1,"card-content"],[1,"header-row"],[1,"title-block"],[1,"title"],[1,"subtitle"],[1,"accent-date"],[1,"inline-icon"],[1,"action-icons"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"saved"],["aria-label","Share event",1,"action-icon","share-icon",3,"click"],["aria-label","Report event",1,"action-icon","report-icon"],[1,"chip-row"],[1,"chip"],["class","chip",4,"ngIf"],["class","description",4,"ngIf"],[1,"eventer-section"],[1,"eventer-info"],["type","button",1,"eventer-hit",3,"click"],["alt","Eventer",1,"organizer-avatar",3,"src"],[1,"organizer-avatar","placeholder"],[1,"eventer-text"],[1,"eventer-label"],[1,"eventer-name"],[3,"reporterId","targetType","targetId","targetLabel"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon",3,"click"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"click"],[1,"favorite-count"],["aria-label","Report event",1,"action-icon","report-icon",3,"click"],[1,"description"],[1,"is-organizer-badge"],[1,"icon-circle","follow-btn-popup"],[1,"notify-toggle"],[1,"icon-circle","follow-btn-popup",3,"click"],[1,"icon-circle","bell-btn",3,"click","disabled"],[1,"owner-note"],["type","button",1,"button","cancel-btn",3,"click"],[1,"participation-actions"],["disabled","",1,"button","partecipa-btn","pending"],[1,"button","partecipa-btn"],["disabled","",1,"button","partecipa-btn","accepted"],["type","button",1,"button","chat-btn",3,"click"],["type","button",1,"button","leave-btn",3,"click"],[1,"button","partecipa-btn",3,"click"],[3,"close","submitted","reporterId","targetType","targetId","targetLabel"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),Z(5),V(),Je(6,Mie,5,1,"p",5)(7,Die,2,1,"p",5),z(8,"p",6)(9,"mat-icon",7),Z(10,"event"),V(),z(11,"span"),Z(12),V()()(),z(13,"div",8),Je(14,Aie,3,0,"button",9),Je(15,Oie,4,4,"button",10),z(16,"button",11),Ae("click",function(r){return a.shareEvent.emit(a.event),r.stopPropagation()}),z(17,"mat-icon"),Z(18,"share"),V()(),Je(19,Rie,3,0,"button",12),V()(),z(20,"div",13)(21,"span",14)(22,"mat-icon"),Z(23,"group"),V(),z(24,"span"),Z(25),V()(),ji(26,kie,5,1,"span",15),z(27,"span",14)(28,"mat-icon"),Z(29,"euro"),V(),z(30,"span"),Z(31),V()()(),ji(32,Fie,2,1,"p",16),z(33,"div",17)(34,"div",18)(35,"button",19),Ae("click",function(r){return a.onOrganizerClick(),r.stopPropagation()}),Je(36,Lie,1,1,"img",20)(37,Nie,2,1,"div",21),z(38,"div",22)(39,"span",23),Z(40,"Eventer"),V(),z(41,"span",24),Z(42),V()()()(),Je(43,jie,2,1),V(),Je(44,$ie,4,0)(45,Wie,3,1),V()(),Je(46,Zie,1,4,"app-report-modal",25)),e&2&&(J(5),ct(a.event.title),J(),et(a.event.city?6:7),J(6),ct(a.formatHeroDate()),J(2),et(a.hasCoordinates()?14:-1),J(),et(a.event.isParticipating?-1:15),J(4),et(a.currentUserId&&!a.isOrganizer()?19:-1),J(6),Zi("",a.getActualParticipants()," participants"),J(),bt("ngIf",a.event.occupiedSpots!==void 0),J(5),ct(a.formatCost()),J(),bt("ngIf",a.showDescription()),J(4),et(a.organizerImage?36:37),J(6),ct(a.organizerName),J(),et(a.currentUserId&&(a.creatorId||a.event.creatorId)?43:-1),J(),et(a.isOrganizer()?44:45),J(2),et(a.showReportModal&&a.event?46:-1))},dependencies:[xi,cs,Ai,Di,xv],styles:[".card-container[_ngcontent-%COMP%]{position:absolute;z-index:900;pointer-events:none}.card-content[_ngcontent-%COMP%]{position:relative;width:380px;max-width:calc(100vw - 32px);background:radial-gradient(circle at 15% 20%,rgba(252,195,36,.18),transparent 34%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:18px;padding:22px;display:flex;flex-direction:column;gap:10px;pointer-events:all;box-shadow:0 12px 30px #0000008c;border:1px solid rgba(255,255,255,.08);color:#f7f7f7;white-space:normal}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:10px 12px;flex-wrap:wrap}.title-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;flex:1 1 220px;min-width:0}.title[_ngcontent-%COMP%]{margin:0;font-size:32px;font-weight:var(--font-weight-bold);color:var(--color-white);line-height:1.05;text-transform:uppercase;letter-spacing:.4px;word-break:break-word;overflow-wrap:anywhere}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:var(--font-weight-regular);color:#e7e7e7;line-height:1.3;display:inline-flex;align-items:center;gap:6px}.inline-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.accent-date[_ngcontent-%COMP%]{margin:2px 0 6px;font-size:18px;font-weight:var(--font-weight-bold);color:var(--color-accent);text-transform:lowercase;display:inline-flex;align-items:center;gap:6px}.action-icons[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;flex:0 0 auto;flex-wrap:wrap;justify-content:flex-end;margin-left:auto;max-width:100%}.action-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.12);background:#ffffff12;border-radius:14px;width:42px;height:42px;display:grid;place-items:center;color:#d8d8d8;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease,border-color .15s ease,background-color .15s ease}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;min-width:16px;height:16px;padding:0 4px;border-radius:999px;background:#0c0c0ce6;border:1px solid rgba(255,255,255,.22);color:var(--color-accent);font-size:9px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.action-icon[_ngcontent-%COMP%]:hover{transform:translateY(-1px);border-color:#fff3;background:#ffffff1a}.favorite-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32499;box-shadow:0 0 12px #fcc32447}.action-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px}.report-icon[_ngcontent-%COMP%]{color:#ff8b8b}.report-icon[_ngcontent-%COMP%]:hover{border-color:#ff8b8b80;background:#ff8b8b1f}.brand-pill[_ngcontent-%COMP%]{align-self:flex-start;padding:6px 10px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.14);color:var(--color-accent);font-weight:var(--font-weight-bold);font-size:12px;letter-spacing:.8px}.chip-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:8px 0 6px}.chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:#f5f5f5;font-size:11px;line-height:1.2}.chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:var(--color-accent)}.description[_ngcontent-%COMP%]{margin:6px 0 8px;font-size:15px;font-weight:var(--font-weight-light);color:#e6e6e6;line-height:1.6}.eventer-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:6px}.eventer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.eventer-hit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;padding:0;border-radius:0;border:none;background:transparent;color:inherit;cursor:pointer;transition:opacity .15s ease}.eventer-hit[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.15)}.organizer-avatar.placeholder[_ngcontent-%COMP%]{background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.eventer-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;align-items:flex-start;text-align:left}.eventer-label[_ngcontent-%COMP%]{font-size:11px;font-weight:var(--font-weight-regular);color:#c7c7c7;letter-spacing:.6px;text-transform:uppercase}.eventer-name[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.is-organizer-badge[_ngcontent-%COMP%]{padding:8px 10px;border-radius:10px;background:#fcc3242e;border:1px solid rgba(252,195,36,.5);color:#f8f1d2;font-weight:var(--font-weight-semibold);font-size:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#ffffff14;border:1px solid rgba(255,255,255,.12);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:transform .15s ease,background-color .15s ease,border-color .15s ease}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#ffffff24;border-color:#fff3}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.94)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#f0f0f0}.follow-btn-popup.following[_ngcontent-%COMP%]{background-color:var(--color-accent);color:#0b0b0b;border-color:var(--color-accent)}.partecipa-btn[_ngcontent-%COMP%]{width:100%;margin-top:16px;background:var(--color-accent);color:var(--color-white);font-weight:var(--font-weight-bold);border:none;border-radius:12px;padding:10px 16px;font-size:15px;letter-spacing:.3px;box-shadow:0 8px 18px #fcc32440;transition:filter .15s ease,transform .1s ease}.partecipa-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.partecipa-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.partecipa-btn.pending[_ngcontent-%COMP%]{background-color:#ffb84d;color:#fff;opacity:.95}.partecipa-btn.accepted[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;opacity:.95}.partecipa-btn[_ngcontent-%COMP%]:disabled{pointer-events:none}.participation-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:16px}.participation-actions[_ngcontent-%COMP%]   .partecipa-btn[_ngcontent-%COMP%]{width:auto;margin-top:0;flex:1 1 auto}.chat-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:#ffffff14;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.chat-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f;border-color:#ffffff4d}.chat-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.leave-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:transparent;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.leave-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff47}.leave-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.owner-note[_ngcontent-%COMP%]{margin-top:16px;padding:12px 14px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);color:#f0f0f0;font-weight:var(--font-weight-semibold);font-size:14px}.notify-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.bell-btn[_ngcontent-%COMP%]{background:#ffffff14;border:1px solid rgba(255,255,255,.2)}.bell-btn.active[_ngcontent-%COMP%]{background:#fbbc0429;border-color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.notify-label[_ngcontent-%COMP%]{font-size:12px;color:#cfcfcf}.cancel-btn[_ngcontent-%COMP%]{width:100%;margin-top:10px;background:#b61e1e;color:#fff;font-weight:var(--font-weight-semibold);border:none;border-radius:12px;padding:10px 14px;letter-spacing:.2px;box-shadow:0 8px 18px #b61e1e59;transition:filter .15s ease,transform .1s ease}.cancel-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.cancel-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 480px){.card-content[_ngcontent-%COMP%]{width:calc(100vw - 24px);padding:18px}.title[_ngcontent-%COMP%]{font-size:26px}.subtitle[_ngcontent-%COMP%], .accent-date[_ngcontent-%COMP%]{font-size:16px}}"]})};var AT=ww(gO());var Yie=(i,n)=>n.name;function Xie(i,n){if(i&1){let e=wt();z(0,"mat-icon",10),Ae("click",function(){Me(e);let d=ne();return d.searchQuery="",De(d.cityResults=[])}),Z(1,"close"),V()}}function Kie(i,n){if(i&1){let e=wt();z(0,"div",12),Ae("click",function(){let d=Me(e).$implicit,r=ne(2);return De(r.selectCity(d))}),z(1,"mat-icon"),Z(2,"location_on"),V(),z(3,"span"),Z(4),V()()}if(i&2){let e=n.$implicit;J(4),ct(e.name)}}function Qie(i,n){if(i&1&&(z(0,"div",7),qi(1,Kie,5,1,"div",11,Yie),V()),i&2){let e=ne();J(),Wi(e.cityResults)}}var DT=class i{constructor(n){this.mapboxService=n}locationSelected=new $t;close=new $t;map;selectedMarker=null;selectedCoords=null;searchQuery="";cityResults=[];ngAfterViewInit(){this.map=new AT.Map({accessToken:ul.mapboxToken,container:"location-map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:12,pitch:0,bearing:0}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{let e=[n.coords.longitude,n.coords.latitude];this.map.flyTo({center:e,zoom:17,duration:1e3})},n=>console.warn("Geolocation error:",n)),this.map.on("click",n=>{this.selectedCoords=[n.lngLat.lng,n.lngLat.lat],this.selectedMarker&&this.selectedMarker.remove();let e=document.createElement("div");e.style.width="30px",e.style.height="30px",e.style.backgroundColor="#FCC324",e.style.borderRadius="50%",e.style.border="3px solid white",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",this.selectedMarker=new AT.Marker({element:e}).setLngLat(this.selectedCoords).addTo(this.map)})}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.cityResults=[];return}this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(e=>({name:e.place_name,center:e.center}))})}selectCity(n){this.map.flyTo({center:n.center,zoom:16,essential:!0}),this.searchQuery="",this.cityResults=[]}ngOnDestroy(){this.map&&this.map.remove()}onConfirm(){this.selectedCoords&&this.locationSelected.emit({lat:this.selectedCoords[1],lng:this.selectedCoords[0]})}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||i)(Ft(Fu))};static \u0275cmp=Sn({type:i,selectors:[["map-location-selector"]],outputs:{locationSelected:"locationSelected",close:"close"},decls:14,vars:4,consts:[[1,"backdrop",3,"click"],[1,"selector-container"],[1,"instruction-text"],[1,"search-section"],[1,"search-bar"],["type","text","placeholder","Search city or place...",3,"ngModelChange","input","ngModel"],[1,"clear-icon"],[1,"search-results"],["id","location-map",1,"map"],[1,"button","confirm-btn",3,"click","disabled"],[1,"clear-icon",3,"click"],[1,"result-item"],[1,"result-item",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Ae("click",function(){return a.onClose()}),V(),z(1,"div",1)(2,"div",2),Z(3," \u{1F4CD} Select a location for your event "),V(),z(4,"div",3)(5,"div",4)(6,"mat-icon"),Z(7,"search"),V(),z(8,"input",5),vo("ngModelChange",function(r){return To(a.searchQuery,r)||(a.searchQuery=r),r}),Ae("input",function(){return a.onSearch()}),V(),Je(9,Xie,2,0,"mat-icon",6),V(),Je(10,Qie,3,0,"div",7),V(),Rn(11,"div",8),z(12,"button",9),Ae("click",function(){return a.onConfirm()}),Z(13," Confirm Location "),V()()),e&2&&(J(8),_o("ngModel",a.searchQuery),J(),et(a.searchQuery?9:-1),J(),et(a.cityResults.length>0?10:-1),J(2),bt("disabled",!a.selectedCoords))},dependencies:[xi,Ba,ws,Ws,_a,Ai,Di],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.selector-container[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:var(--z-popup);pointer-events:none;display:flex;flex-direction:column;align-items:center;padding:20px;gap:20px;background-color:transparent}.instruction-text[_ngcontent-%COMP%]{pointer-events:all;background:var(--color-dark-gray);color:var(--color-white);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:var(--font-weight-semibold);border:1px solid var(--color-light-gray);box-shadow:0 4px 12px #0000004d;text-align:center}.map[_ngcontent-%COMP%]{flex:1;width:100%;border-radius:20px;overflow:hidden;pointer-events:all;box-shadow:0 8px 24px #0006}.confirm-btn[_ngcontent-%COMP%]{pointer-events:all;min-width:250px;box-shadow:0 4px 12px #0000004d}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.confirm-btn[_ngcontent-%COMP%]:disabled:hover{filter:grayscale(1);transform:none}.search-section[_ngcontent-%COMP%]{width:100%;max-width:400px;position:relative;pointer-events:all;z-index:2100}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;padding:8px 16px;box-shadow:0 4px 12px #0000004d}.search-bar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);margin-right:8px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;color:#fff;font-size:16px;outline:none}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--color-gray)}.clear-icon[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-gray);margin-left:8px}.clear-icon[_ngcontent-%COMP%]:hover{color:#fff}.search-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;margin-top:8px;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px #00000080;z-index:2200}.result-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;transition:background .2s;color:#fff}.result-item[_ngcontent-%COMP%]:hover{background:#ffffff1a}.result-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);font-size:20px;width:20px;height:20px}"]})};var wR=(i,n)=>n.id;function Jie(i,n){i&1&&(z(0,"div",6),Z(1,"Loading..."),V())}function ere(i,n){if(i&1&&Rn(0,"img",13),i&2){let e=ne(3);bt("src",e.user.profileImage,to)}}function tre(i,n){if(i&1&&(z(0,"div",14),Z(1),V()),i&2){let e=ne(3);J(),ct(e.getInitials(e.user.name))}}function nre(i,n){if(i&1&&(z(0,"p",23),Z(1),V()),i&2){let e=ne(3);J(),Zi(" ",e.user.email," ")}}function ire(i,n){if(i&1&&(z(0,"p",24),Z(1),V()),i&2){let e=ne(3);J(),ct(e.user.description)}}function rre(i,n){if(i&1){let e=wt();z(0,"button",29),Ae("click",function(d){Me(e);let r=ne(4);return De(r.toggleNotifications(d))}),z(1,"mat-icon"),Z(2),V()()}if(i&2){let e=ne(4);hn("active",e.notificationsEnabled),bt("disabled",e.notificationsLoading),J(2),ct(e.notificationsEnabled?"notifications":"notifications_off")}}function ore(i,n){if(i&1){let e=wt();z(0,"div",25)(1,"button",26),Ae("click",function(){Me(e);let d=ne(3);return De(d.toggleFollow())}),Z(2),V(),Je(3,rre,3,4,"button",27),V(),z(4,"button",28),Ae("click",function(){Me(e);let d=ne(3);return De(d.openReportModal())}),z(5,"mat-icon"),Z(6,"flag"),V(),Z(7," Segnala "),V()}if(i&2){let e=ne(3);J(),hn("following",e.isFollowing),J(),Zi(" ",e.isFollowing?"Following":"Follow"," "),J(),et(e.isFollowing?3:-1)}}function sre(i,n){if(i&1){let e=wt();z(0,"div",9)(1,"div",12),Je(2,ere,1,1,"img",13)(3,tre,2,1,"div",14),V(),z(4,"h3",15),Z(5),V(),ji(6,nre,2,1,"p",16)(7,ire,2,1,"p",17),Je(8,ore,8,4),z(9,"div",18)(10,"div",19),Ae("click",function(){Me(e);let d=ne(2);return De(d.showFollowers())}),z(11,"span",20),Z(12),V(),z(13,"span",21),Z(14,"Followers"),V()(),Rn(15,"div",22),z(16,"div",19),Ae("click",function(){Me(e);let d=ne(2);return De(d.showFollowing())}),z(17,"span",20),Z(18),V(),z(19,"span",21),Z(20,"Following"),V()(),Rn(21,"div",22),z(22,"div",19),Ae("click",function(){Me(e);let d=ne(2);return De(d.showEvents())}),z(23,"span",20),Z(24),V(),z(25,"span",21),Z(26,"Events"),V()()()()}if(i&2){let e=ne(2);J(2),et(e.user.profileImage?2:3),J(3),ct(e.user.name),J(),bt("ngIf",e.user.email&&e.currentUserId&&e.user.id.toString()===e.currentUserId),J(),bt("ngIf",e.user.description),J(),et(e.currentUserId&&e.user.id.toString()!==e.currentUserId?8:-1),J(4),ct(e.user.followersCount||0),J(6),ct(e.user.followingCount||0),J(6),ct(e.user.approvedEventsCount||0)}}function are(i,n){if(i&1&&Rn(0,"img",37),i&2){let e=ne().$implicit;bt("src",e.profileImage,to)}}function lre(i,n){if(i&1&&(z(0,"div",38),Z(1),V()),i&2){let e=ne().$implicit,a=ne(4);J(),ct(a.getInitials(e.name))}}function cre(i,n){if(i&1){let e=wt();z(0,"button",42),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne(4);return De(r.onListUnfollow(d))}),Z(1,"Unfollow"),V()}}function ure(i,n){if(i&1){let e=wt();z(0,"button",43),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne(4);return De(r.onListFollow(d))}),Z(1,"Follow"),V()}}function dre(i,n){if(i&1&&Je(0,cre,2,0,"button",40)(1,ure,2,0,"button",41),i&2){let e=ne().$implicit,a=ne(4);et(a.myFollowingIds.has(e.id.toString())?0:1)}}function hre(i,n){if(i&1){let e=wt();z(0,"div",34)(1,"div",36),Ae("click",function(){let d=Me(e).$implicit,r=ne(4);return De(r.onOpenProfileFromList(d))}),Je(2,are,1,1,"img",37)(3,lre,2,1,"div",38),z(4,"span",39),Z(5),V()(),Je(6,dre,2,1),V()}if(i&2){let e=n.$implicit,a=ne(4);J(2),et(e.profileImage?2:3),J(3),ct(e.name),J(),et(a.currentUserId&&e.id.toString()!==a.currentUserId?6:-1)}}function pre(i,n){i&1&&(z(0,"div",35),Z(1,"No users found."),V())}function fre(i,n){if(i&1&&(z(0,"div",33),qi(1,hre,7,3,"div",34,wR),Je(3,pre,2,0,"div",35),V()),i&2){let e=ne(3);J(),Wi(e.userList),J(2),et(e.userList.length===0?3:-1)}}function mre(i,n){i&1&&(z(0,"div",6),Z(1,"Loading list..."),V())}function gre(i,n){if(i&1){let e=wt();z(0,"div",10)(1,"div",30)(2,"button",31),Ae("click",function(){Me(e);let d=ne(2);return De(d.onClose())}),z(3,"mat-icon"),Z(4,"arrow_back"),V()(),z(5,"h3"),Z(6),V()(),ji(7,fre,4,1,"div",32)(8,mre,2,0,"ng-template",null,0,cx),V()}if(i&2){let e=Bl(9),a=ne(2);J(6),ct(a.view==="followers"?"Followers":"Following"),J(),bt("ngIf",!a.loadingList)("ngIfElse",e)}}function _re(i,n){i&1&&(z(0,"div",6),Z(1,"Loading events..."),V())}function vre(i,n){i&1&&(z(0,"div",35),Z(1,"No upcoming events."),V())}function yre(i,n){if(i&1&&(z(0,"div",45)(1,"div",46)(2,"p",47),Z(3),V(),z(4,"p",48)(5,"mat-icon",49),Z(6,"event"),V(),z(7,"span"),Z(8),V(),z(9,"mat-icon",49),Z(10,"place"),V(),z(11,"span"),Z(12),V()()(),z(13,"div",50)(14,"span",51)(15,"mat-icon"),Z(16,"group"),V(),z(17,"span"),Z(18),V()(),z(19,"span",51)(20,"mat-icon"),Z(21,"euro"),V(),z(22,"span"),Z(23),V()()()()),i&2){let e=n.$implicit,a=ne(4);J(3),ct(e.title),J(5),ct(a.formatEventDate(e)),J(4),ct(e.city),J(6),Zi("",a.eventStats(e).participants," participants"),J(5),ct(a.eventStats(e).cost)}}function xre(i,n){if(i&1&&qi(0,yre,24,5,"div",45,wR),i&2){let e=ne(3);Wi(e.upcomingEvents)}}function bre(i,n){i&1&&(z(0,"div",6),Z(1,"Loading events..."),V())}function wre(i,n){i&1&&(z(0,"div",35),Z(1,"No past events."),V())}function Cre(i,n){if(i&1&&(z(0,"div",52)(1,"div",46)(2,"p",47),Z(3),V(),z(4,"p",48)(5,"mat-icon",49),Z(6,"event"),V(),z(7,"span"),Z(8),V(),z(9,"mat-icon",49),Z(10,"place"),V(),z(11,"span"),Z(12),V()()(),z(13,"div",50)(14,"span",51)(15,"mat-icon"),Z(16,"group"),V(),z(17,"span"),Z(18),V()(),z(19,"span",51)(20,"mat-icon"),Z(21,"euro"),V(),z(22,"span"),Z(23),V()()()()),i&2){let e=n.$implicit,a=ne(4);J(3),ct(e.title),J(5),ct(a.formatEventDate(e)),J(4),ct(e.city),J(6),Zi("",a.eventStats(e).participants," participants"),J(5),ct(a.eventStats(e).cost)}}function Ere(i,n){if(i&1&&qi(0,Cre,24,5,"div",52,wR),i&2){let e=ne(3);Wi(e.pastEvents)}}function Sre(i,n){if(i&1&&(z(0,"div",11)(1,"div",44)(2,"h4"),Z(3,"Upcoming"),V(),Je(4,_re,2,0,"div",6)(5,vre,2,0,"div",35)(6,xre,2,0),V(),z(7,"div",44)(8,"h4"),Z(9,"Past"),V(),Je(10,bre,2,0,"div",6)(11,wre,2,0,"div",35)(12,Ere,2,0),V()()),i&2){let e=ne(2);J(4),et(e.loadingEvents?4:e.upcomingEvents.length===0?5:6),J(6),et(e.loadingEvents?10:e.pastEvents.length===0?11:12)}}function Tre(i,n){if(i&1&&(Je(0,sre,27,8,"div",9),Je(1,gre,10,3,"div",10),Je(2,Sre,13,2,"div",11)),i&2){let e=ne();et(e.view==="profile"?0:-1),J(),et(e.view==="followers"||e.view==="following"?1:-1),J(),et(e.view==="events"?2:-1)}}function Ire(i,n){i&1&&(z(0,"div",7),Z(1,"Unable to load profile."),V())}function Mre(i,n){if(i&1){let e=wt();z(0,"app-report-modal",53),Ae("close",function(){Me(e);let d=ne();return De(d.closeReportModal())})("submitted",function(){Me(e);let d=ne();return De(d.closeReportModal())}),V()}if(i&2){let e=ne();bt("reporterId",e.currentUserId)("targetType","USER")("targetId",e.user.id.toString())("targetLabel",e.user.name)}}var PT=class i{constructor(n,e,a){this.userService=n;this.eventService=e;this.confirmation=a}userId=null;currentUserId=null;close=new $t;openProfile=new $t;user=null;isFollowing=!1;loading=!1;notificationsEnabled=!1;notificationsLoading=!1;view="profile";userList=[];loadingList=!1;myFollowingIds=new Set;loadingEvents=!1;upcomingEvents=[];pastEvents=[];showReportModal=!1;ngOnChanges(n){n.userId&&this.userId&&(this.loadUser(),this.checkIfFollowing())}onClose(){this.view!=="profile"?this.view="profile":this.close.emit()}getViewTitle(){switch(this.view){case"followers":return"Followers";case"following":return"Following";case"events":return"Events";default:return"Profile"}}loadUser(){this.userId&&(this.loading=!0,this.userService.getUserById(this.userId).subscribe({next:n=>{this.user=n,this.loading=!1},error:n=>{console.error("Error loading user profile",n),this.loading=!1}}))}checkIfFollowing(){!this.userId||!this.currentUserId||this.userService.isFollowing(this.currentUserId,this.userId).subscribe({next:n=>{this.isFollowing=n.isFollowing,this.isFollowing?this.loadNotificationPreference():this.notificationsEnabled=!1},error:n=>console.error(n)})}toggleFollow(){return Er(this,null,function*(){if(!(!this.userId||!this.currentUserId))if(this.isFollowing){if(!(yield this.confirmation.confirm({title:"Unfollow user",message:"Are you sure you want to unfollow this user?",confirmText:"Unfollow",cancelText:"Cancel"})))return;this.userService.unfollowUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!1,this.user&&(this.user.followersCount=(this.user.followersCount||1)-1),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}else this.userService.followUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.user&&(this.user.followersCount=(this.user.followersCount||0)+1),this.userService.notifyUserUpdate()},error:n=>console.error(n)})})}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}showFollowers(){this.userId&&(this.view="followers",this.loadingList=!0,this.userService.getFollowers(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}showFollowing(){this.userId&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}fetchMyFollowing(){if(!this.currentUserId){this.loadingList=!1;return}this.userService.getFollowing(this.currentUserId).subscribe({next:n=>{this.myFollowingIds=new Set(n.map(e=>e.id.toString())),this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}})}onListFollow(n){this.currentUserId&&this.userService.followUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.add(n.id.toString()),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}onOpenProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}onListUnfollow(n){return Er(this,null,function*(){!this.currentUserId||!(yield this.confirmation.confirm({title:"Unfollow user",message:`Are you sure you want to unfollow ${n.name}?`,confirmText:"Unfollow",cancelText:"Cancel"}))||this.userService.unfollowUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.delete(n.id.toString()),this.userService.notifyUserUpdate()},error:a=>console.error(a)})})}showEvents(){this.userId&&(this.view="events",!(this.upcomingEvents.length||this.pastEvents.length||this.loadingEvents)&&(this.loadingEvents=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>{let e=new Date;this.upcomingEvents=[],this.pastEvents=[],n.forEach(a=>{new Date(`${a.date}T${a.endTime||a.startTime||"00:00"}`).getTime()>=e.getTime()?this.upcomingEvents.push(a):this.pastEvents.push(a)}),this.upcomingEvents.sort((a,d)=>new Date(`${a.date}T${a.startTime||"00:00"}`).getTime()-new Date(`${d.date}T${d.startTime||"00:00"}`).getTime()),this.pastEvents.sort((a,d)=>new Date(`${d.date}T${d.startTime||"00:00"}`).getTime()-new Date(`${a.date}T${a.startTime||"00:00"}`).getTime()),this.loadingEvents=!1},error:n=>{console.error("Error loading events by user",n),this.loadingEvents=!1}})))}formatEventDate(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=a&&d?`${a} - ${d}`:a||d;return[r,E].filter(Boolean).join(" \u2022 ")}eventStats(n){let e=n.occupiedSpots??0,a=n.nPartecipants??null,d=`${e}${a?`/${a}`:""}`,r;a!=null&&(r=Math.max(a-e,0).toString());let E=n.costPerPerson==null||n.costPerPerson===0?"Free":n.costPerPerson.toString();return{participants:d,freeSpots:r,cost:E}}toggleNotifications(n){if(n?.stopPropagation(),!this.currentUserId||!this.userId||!this.isFollowing)return;let e=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,this.userId,e).subscribe({next:a=>{this.notificationsEnabled=a.enabled,this.notificationsLoading=!1},error:a=>{console.error("Error updating follow notifications",a),this.notificationsLoading=!1}})}openReportModal(){!this.user||!this.currentUserId||this.user.id.toString()!==this.currentUserId&&(this.showReportModal=!0)}closeReportModal(){this.showReportModal=!1}loadNotificationPreference(){!this.currentUserId||!this.userId||(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,this.userId).subscribe({next:n=>{this.notificationsEnabled=!!n.enabled,this.notificationsLoading=!1},error:n=>{console.error("Error loading follow notification preference",n),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(e){return new(e||i)(Ft(Cs),Ft(Zs),Ft(Na))};static \u0275cmp=Sn({type:i,selectors:[["app-user-profile-modal"]],inputs:{userId:"userId",currentUserId:"currentUserId"},outputs:{close:"close",openProfile:"openProfile"},features:[Gr],decls:15,vars:7,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"back-btn","mobile-only",3,"click"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"loading-spinner"],[1,"error-state"],[3,"reporterId","targetType","targetId","targetLabel"],[1,"profile-content"],[1,"list-view"],[1,"events-view"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"user-name"],["class","user-email",4,"ngIf"],["class","user-description",4,"ngIf"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"user-email"],[1,"user-description"],[1,"follow-actions"],[1,"button","follow-main-btn",3,"click"],[1,"bell-btn",3,"active","disabled"],["type","button",1,"report-btn",3,"click"],[1,"bell-btn",3,"click","disabled"],[1,"list-header"],[1,"back-btn",3,"click"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],[1,"user-item"],[1,"empty-list"],[1,"user-info",3,"click"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"list-username"],[1,"unfollow-btn","small-btn"],[1,"follow-btn","small-btn"],[1,"unfollow-btn","small-btn",3,"click"],[1,"follow-btn","small-btn",3,"click"],[1,"events-section"],[1,"event-card"],[1,"event-card-header"],[1,"event-title"],[1,"event-sub"],[1,"inline-icon"],[1,"event-stats"],[1,"pill","stat-pill"],[1,"event-card","past"],[3,"close","submitted","reporterId","targetType","targetId","targetLabel"]],template:function(e,a){e&1&&(z(0,"div",1),Ae("click",function(){return a.onClose()}),z(1,"div",2),Ae("click",function(r){return r.stopPropagation()}),z(2,"div",3)(3,"button",4),Ae("click",function(){return a.onClose()}),z(4,"mat-icon"),Z(5,"arrow_back"),V()(),z(6,"h2"),Z(7),V(),z(8,"button",5),Ae("click",function(){return a.onClose()}),z(9,"mat-icon"),Z(10,"close"),V()()(),Je(11,Jie,2,0,"div",6)(12,Tre,3,3)(13,Ire,2,0,"div",7),V()(),Je(14,Mre,1,4,"app-report-modal",8)),e&2&&(J(),hn("events-mode",a.view==="events"),J(5),hn("yellow-title",a.view!=="profile"),J(),ct(a.getViewTitle()),J(4),et(a.loading?11:a.user?12:13),J(3),et(a.showReportModal&&a.user?14:-1))},dependencies:[xi,cs,Ai,Di,xv],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));display:flex;justify-content:center;align-items:center;z-index:2000}.modal-container[_ngcontent-%COMP%]{background:var(--modal-surface);width:90%;max-width:400px;border-radius:var(--modal-radius);padding:24px;color:#fff;border:var(--modal-border);box-shadow:var(--modal-shadow);max-height:85vh;display:flex;flex-direction:column;overflow:hidden}.modal-container.events-mode[_ngcontent-%COMP%]{background:var(--modal-surface)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;padding:24px 32px 80px}.profile-content[_ngcontent-%COMP%]{padding:0 8px}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-top:2px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;line-height:1.2}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{justify-content:space-between;gap:16px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:right;flex:1}}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.profile-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.avatar-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.profile-image[_ngcontent-%COMP%], .profile-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffb800,#ffdc73);color:#1a1a1a;font-size:36px;font-weight:700;display:flex;align-items:center;justify-content:center}.user-name[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:600}.user-email[_ngcontent-%COMP%]{margin:0;color:#888;font-size:14px}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9;text-align:center}.follow-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;margin:6px 0 12px}.report-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#ffffff0f;border:1px solid rgba(255,255,255,.2);color:#ff8b8b;padding:8px 14px;border-radius:18px;cursor:pointer;font-size:13px}.report-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.report-btn[_ngcontent-%COMP%]:hover{border-color:#ff8b8b99}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:0;margin-top:16px;background:#ffffff0d;padding:16px 12px;border-radius:12px;width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#ffb800}.stat-label[_ngcontent-%COMP%]{font-size:11px;color:#888;text-transform:uppercase;letter-spacing:.5px}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a;flex-shrink:0}.follow-main-btn[_ngcontent-%COMP%]{width:100%;max-width:220px;margin:0 auto;color:var(--color-black)!important}.follow-main-btn[_ngcontent-%COMP%]:not(.following){background-color:var(--color-accent)}.follow-main-btn.following[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.bell-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#ffffff0f;color:#f1f1f1;display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,border-color .2s ease,transform .1s ease}.bell-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f}.bell-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.bell-btn.active[_ngcontent-%COMP%]{border-color:var(--color-accent);background:#fbbc042e;color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.events-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;padding-right:4px;scrollbar-width:thin;scrollbar-color:var(--color-bit-gray) transparent;max-height:500px}.events-section[_ngcontent-%COMP%]{background:#ffffff0a;padding:12px;border-radius:14px;display:flex;flex-direction:column;gap:10px;border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 16px #0000004d}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.events-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;text-transform:uppercase;letter-spacing:.5px;color:#cfcfcf}.event-card[_ngcontent-%COMP%]{background:#ffffff0f;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 16px #0000004d}.event-card.past[_ngcontent-%COMP%]{opacity:.85}.event-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.event-title[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:800;color:#fdfdfd}.event-sub[_ngcontent-%COMP%]{margin:2px 0 0;font-size:13px;color:#d6d6d6;display:flex;align-items:center;gap:8px}.event-sub[_ngcontent-%COMP%]   .inline-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:18px;width:18px;height:18px;line-height:18px;flex-shrink:0}.event-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;align-items:center}.stat-pill[_ngcontent-%COMP%]{border-color:#ffffff26;background:#ffffff14;color:#f5f5f5;font-size:12px;padding:7px 9px;gap:5px;border-radius:999px;display:inline-flex;align-items:center}.stat-pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;line-height:16px;color:var(--color-accent);flex-shrink:0}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;line-height:0}.user-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:12px;padding-right:4px}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;background:#ffffff0d;border-radius:8px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%], .list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}.list-username[_ngcontent-%COMP%]{font-weight:500;font-size:14px}.small-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600;cursor:pointer;border:none}.small-btn.follow-btn[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a}.small-btn.unfollow-btn[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff}.loading-spinner[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-list[_ngcontent-%COMP%]{text-align:center;color:#888;padding:20px}"]})};function Dre(i,n){if(i&1){let e=wt();z(0,"div",2)(1,"a",10),Ae("click",function(){Me(e);let d=ne();return De(d.openSignUp())}),Z(2,"Sign Up"),V(),z(3,"a",10),Ae("click",function(){Me(e);let d=ne();return De(d.openSignIn())}),Z(4,"Sign In"),V()()}}function Are(i,n){if(i&1){let e=wt();z(0,"app-action-bar",11),Ae("action",function(d){Me(e);let r=ne();return De(r.onMenuAction(d))})("openProfile",function(d){Me(e);let r=ne();return De(r.openUserProfile(d))})("openChatFromNotification",function(d){Me(e);let r=ne();return De(r.onChatNotification(d))})("focusEvent",function(d){Me(e);let r=ne();return De(r.onFocusEventFromMenu(d))}),V(),z(1,"input",12),Ae("change",function(d){Me(e);let r=ne();return De(r.onFileSelected(d))}),V()}if(i&2){let e=ne();bt("loggedUser",e.loggedUser)}}function Pre(i,n){if(i&1){let e=wt();z(0,"SignUpPopup",13),Ae("switchToSignIn",function(){Me(e);let d=ne();return De(d.switchToSignIn())})("close",function(){Me(e);let d=ne();return De(d.closeAll())})("signUpSuccess",function(d){Me(e);let r=ne();return De(r.openVerifyPopup(d.email,d.token))})("signInSuccess",function(d){Me(e);let r=ne();return De(r.onSignInSuccess(d))}),V()}}function Ore(i,n){if(i&1){let e=wt();z(0,"VerifyEmailPopup",14),Ae("close",function(){Me(e);let d=ne();return De(d.closeAll())})("resendVerification",function(){Me(e);let d=ne();return De(d.resendEmail())}),V()}if(i&2){let e=ne();bt("email",e.recentEmail)("token",e.recentToken)("verified",e.emailVerified)}}function Rre(i,n){if(i&1){let e=wt();z(0,"SignInPopup",15),Ae("switchToSignUp",function(){Me(e);let d=ne();return De(d.switchToSignUp())})("close",function(){Me(e);let d=ne();return De(d.closeAll())})("signInSuccess",function(d){Me(e);let r=ne();return De(r.onSignInSuccess(d))}),V()}}function kre(i,n){if(i&1){let e=wt();z(0,"app-user-profile-modal",16),Ae("close",function(){Me(e);let d=ne();return De(d.closeAll())})("openProfile",function(d){Me(e);let r=ne();return De(r.openUserProfile(d))}),V()}if(i&2){let e=ne();bt("userId",e.selectedUserProfileId)("currentUserId",e.loggedUser?e.loggedUser.id.toString():null)}}function Fre(i,n){if(i&1){let e=wt();z(0,"CropImagePopup",17),Ae("close",function(){Me(e);let d=ne();return De(d.showCropPopup=!1)})("imageCropped",function(d){Me(e);let r=ne();return De(r.onImageCropped(d))}),V()}if(i&2){let e=ne();bt("imageFile",e.selectedImageFile)}}function Lre(i,n){if(i&1){let e=wt();z(0,"create-event-popup",18,0),Ae("close",function(){Me(e);let d=ne();return De(d.showCreateEventPopup=!1)})("eventCreated",function(){Me(e);let d=ne();return De(d.closeAll())})("openLocationSelector",function(){Me(e);let d=Bl(1),r=ne();return r.createEventPopupRef=d,De(r.openLocationSelector())}),V()}if(i&2){let e=ne();jo("display",e.showLocationSelector?"none":"block")}}function Nre(i,n){if(i&1){let e=wt();z(0,"map-location-selector",19),Ae("locationSelected",function(d){Me(e);let r=ne();return De(r.onLocationSelected(d))})("close",function(){Me(e);let d=ne();return De(d.showLocationSelector=!1)}),V()}}function zre(i,n){if(i&1){let e=wt();z(0,"event-popup-card",20),Ae("close",function(){Me(e);let d=ne();return De(d.closeEventPopup())})("participate",function(d){Me(e);let r=ne();return De(r.onParticipate(d))})("toggleFavorite",function(){Me(e);let d=ne();return De(d.onToggleFavorite())})("openOrganizerProfile",function(d){Me(e);let r=ne();return De(r.openUserProfile(d))})("leave",function(d){Me(e);let r=ne();return De(r.onLeaveEvent(d))})("deleteEvent",function(d){Me(e);let r=ne();return De(r.onDeleteEvent(d))})("shareEvent",function(d){Me(e);let r=ne();return De(r.openShare(d))})("openChat",function(d){Me(e);let r=ne();return De(r.openChat(d))}),V()}if(i&2){let e=ne();bt("event",e.selectedEvent)("eventPosition",e.eventScreenPosition||void 0)("organizerName",e.selectedEvent.organizerName||"")("organizerImage",e.selectedEvent.organizerImage)("currentUserId",e.loggedUser&&e.loggedUser.id?e.loggedUser.id.toString():null)("creatorId",e.selectedEvent.creatorId)}}function Bre(i,n){if(i&1){let e=wt();z(0,"event-chat-modal",21),Ae("close",function(){Me(e);let d=ne();return De(d.closeChat())}),V()}if(i&2){let e=ne();bt("event",e.chatEvent)("currentUserId",(e.loggedUser==null||e.loggedUser.id==null?null:e.loggedUser.id.toString())||null)}}var OT=class i{constructor(n,e,a,d,r,E,P){this.route=n;this.router=e;this.authService=a;this.http=d;this.eventService=r;this.userService=E;this.confirmation=P}mapView;showSignUp=!1;showSignIn=!1;showVerifyPopup=!1;showCropPopup=!1;selectedImageFile=null;showCreateEventPopup=!1;showChatModal=!1;showLocationSelector=!1;selectedEvent=null;chatEvent=null;previousSelectedEvent=null;eventScreenPosition=null;showUserProfile=!1;selectedUserProfileId=null;loggedUser=null;recentEmail="";recentToken="";emailVerified=!1;pendingSharedEventId=null;sharedEventRetryCount=0;sharedEventLoading=!1;ngOnInit(){this.refreshLocalUser(),this.checkAdminRedirect(),this.userService.userUpdates$.subscribe(()=>{this.refreshUserFromBackend()}),this.route.queryParams.subscribe(n=>{let e=n.token,a=n.email,d=n.user,r=n.event;if(d&&(this.openUserProfile(d),this.router.navigate([],{relativeTo:this.route,queryParams:{user:null},queryParamsHandling:"merge",replaceUrl:!0})),r){let E=Number(r);Number.isNaN(E)||(this.pendingSharedEventId=E,this.loadSharedEvent()),this.router.navigate([],{relativeTo:this.route,queryParams:{event:null},queryParamsHandling:"merge",replaceUrl:!0})}e&&(this.recentToken=e,this.recentEmail=a||"",this.openVerifyPopup(),this.authService.verifyEmail(e).subscribe({next:E=>{this.emailVerified=!0},error:()=>this.emailVerified=!1}))})}ngAfterViewInit(){this.loadSharedEvent()}checkAdminRedirect(){this.loggedUser&&this.loggedUser.isAdmin&&this.router.navigate(["/admin"])}refreshLocalUser(){let n=localStorage.getItem("user");if(n)try{this.loggedUser=JSON.parse(n)}catch(e){console.error("Error parsing local user",e),localStorage.removeItem("user")}}refreshUserFromBackend(){this.loggedUser&&this.userService.getUserById(this.loggedUser.id).subscribe({next:n=>{if(this.loggedUser={id:n.id||"",name:n.name||n.email||"User",email:n.email||"",description:n.description,profileImage:n.profileImage,followersCount:n.followersCount,followingCount:n.followingCount,isAdmin:n.isAdmin},this.loggedUser?.isAdmin){this.router.navigate(["/admin"]);return}localStorage.setItem("user",JSON.stringify(this.loggedUser)),console.log("User refreshed:",this.loggedUser)},error:n=>console.error("Error refreshing user",n)})}loadSharedEvent(){if(!this.pendingSharedEventId||this.sharedEventLoading)return;let n=this.pendingSharedEventId,e=this.loggedUser?this.loggedUser.id:void 0;this.sharedEventLoading=!0,this.eventService.getEventById(n,e).subscribe({next:a=>{this.sharedEventLoading=!1,this.openSharedEventOnMap(a)},error:a=>{this.sharedEventLoading=!1,this.pendingSharedEventId=null,console.error("Error loading shared event",a)}})}openSharedEventOnMap(n){if(!this.mapView?.map){this.sharedEventRetryCount<12&&(this.sharedEventRetryCount+=1,setTimeout(()=>this.openSharedEventOnMap(n),250));return}this.sharedEventRetryCount=0,this.pendingSharedEventId=null,this.mapView.flyToEvent(n)}openVerifyPopup(n,e){n!==void 0&&(this.recentEmail=n),e!==void 0&&(this.recentToken=e),this.closeAll(),this.showVerifyPopup=!0}resendEmail(){!this.recentToken&&!this.recentEmail||this.authService.resendEmail({oldToken:this.recentToken,email:this.recentEmail}).subscribe({next:n=>{n?.data?.token&&(this.recentToken=n.data.token),this.emailVerified=!1},error:n=>{console.error("Error resending verification email",n)}})}openSignUp(){this.closeAll(),this.showSignUp=!0}openSignIn(){this.closeAll(),this.showSignIn=!0}closeAll(){this.showSignUp=!1,this.showSignIn=!1,this.showVerifyPopup=!1,this.showCropPopup=!1,this.showCreateEventPopup=!1,this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent=null,this.showLocationSelector=!1,this.closeEventPopup(),this.mapView&&(this.mapView.managedPopupType=null),this.showUserProfile=!1,this.selectedUserProfileId=null}openUserProfile(n){console.log("[Home] openUserProfile",n),this.closeAll(),this.selectedUserProfileId=n,this.showUserProfile=!0}openEventPopup(n){this.selectedEvent=n,this.updateCardPosition(),this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.on("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this)),this.mapView.map.on("click",this.onMapClick.bind(this)));let e=this.loggedUser?this.loggedUser.id:void 0;this.eventService.getEventById(n.id,e).subscribe({next:a=>{this.selectedEvent=a,this.updateCardPosition()},error:a=>console.error("Error fetching fresh event data",a)}),setTimeout(()=>{document.addEventListener("click",this.onDocumentClick)},0)}openChat(n){if(!this.loggedUser){this.openSignIn();return}this.selectedEvent&&(this.previousSelectedEvent=this.selectedEvent,this.closeEventPopup()),this.chatEvent=n,this.showChatModal=!0}onChatNotification(n){if(!this.loggedUser){this.openSignIn();return}this.eventService.getEventById(n,this.loggedUser.id).subscribe({next:e=>{this.closeAll(),this.openChat(e)},error:e=>console.error("Error opening chat from notification",e)})}closeChat(){if(this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent){let n=this.previousSelectedEvent;this.previousSelectedEvent=null,this.openEventPopup(n)}}onEventsUpdated(n){if(this.selectedEvent){let e=n.find(a=>a.id===this.selectedEvent.id);e&&(this.selectedEvent=e)}}updateCardPosition(){this.selectedEvent&&this.mapView&&(this.eventScreenPosition=this.mapView.getEventScreenPosition(this.selectedEvent))}onMapClick(n){n.defaultPrevented||this.closeEventPopup()}onDocumentClick=n=>{this.closeEventPopup()};closeEventPopup(){this.selectedEvent=null,this.eventScreenPosition=null,this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this))),document.removeEventListener("click",this.onDocumentClick)}onParticipate(n){if(console.log("onParticipate called for event:",n.id),!this.loggedUser){console.log("User not logged in, opening sign in"),this.openSignIn();return}console.log("Sending request for user:",this.loggedUser.id,"event:",n.id),this.eventService.requestParticipation(n.id,this.loggedUser.id).subscribe({next:()=>{console.log("Request success"),this.selectedEvent&&this.selectedEvent.id===n.id&&(console.log("Updating local state to PENDING"),this.selectedEvent.participationStatus="PENDING")},error:e=>console.error("Error requesting participation",e)})}onLeaveEvent(n){return Er(this,null,function*(){if(!this.loggedUser){this.openSignIn();return}(yield this.confirmation.confirm({title:"Leave event",message:"Are you sure you want to leave the event?",confirmText:"Leave",cancelText:"Cancel"}))&&this.eventService.leaveEvent(n.id,this.loggedUser.id).subscribe({next:()=>{if(this.selectedEvent&&this.selectedEvent.id===n.id&&(this.selectedEvent.participationStatus="NONE",this.selectedEvent.isParticipating=!1,typeof this.selectedEvent.occupiedSpots=="number"&&this.selectedEvent.occupiedSpots>0&&(this.selectedEvent.occupiedSpots-=1)),this.mapView){let a=this.mapView.events.find(d=>d.id===n.id);a&&(a.participationStatus="NONE",a.isParticipating=!1,typeof a.occupiedSpots=="number"&&a.occupiedSpots>0&&(a.occupiedSpots-=1))}},error:a=>console.error("Error leaving event",a)})})}onDeleteEvent(n){return Er(this,null,function*(){if(!this.loggedUser){this.openSignIn();return}if(n.creatorId&&n.creatorId.toString()!==this.loggedUser.id.toString()){console.warn("You are not the eventer of this event");return}(yield this.confirmation.confirm({title:"Delete event",message:"Are you sure you want to delete this event? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.mapView&&(this.mapView.events=this.mapView.events.filter(a=>a.id!==n.id),this.mapView.loadEvents?.()),this.closeEventPopup()},error:a=>console.error("Error deleting event",a)})})}onToggleFavorite(){this.selectedEvent&&this.mapView&&this.mapView.onToggleFavorite(this.selectedEvent)}openShare(n){this.mapView&&this.mapView.openShare(n)}createEventPopupRef=null;openLocationSelector(){this.showLocationSelector=!0}onLocationSelected(n){this.createEventPopupRef&&this.createEventPopupRef.setLocation(n.lat,n.lng),this.showLocationSelector=!1}switchToSignUp(){this.openSignUp()}switchToSignIn(){this.openSignIn()}onSignInSuccess(n){if(console.log("User received on sign in:",n),this.loggedUser={id:n?.id||"",name:n?.name||n?.email||"User",email:n?.email||"",profileImage:n.profileImage,isAdmin:n.isAdmin},this.loggedUser.isAdmin){this.router.navigate(["/admin"]);return}this.refreshUserFromBackend(),this.closeAll()}logout(){this.loggedUser=null,localStorage.removeItem("user"),this.closeAll()}onMenuAction(n){if(console.log("Menu action:",n),n==="logout")this.logout();else if(n==="change-photo"){let e=document.getElementById("hiddenFileInput");e&&e.click()}else n==="account"?console.log("Navigate to Account"):n==="events"?console.log("Navigate to Events"):n==="add-event"&&(console.log("Create Event clicked"),this.showCreateEventPopup=!0)}onFileSelected(n){let e=n.target.files[0];e&&(this.selectedImageFile=e,this.showCropPopup=!0,n.target.value="")}onImageCropped(n){if(this.loggedUser){let e=new FormData;e.append("file",n,"profile.jpg"),this.http.post(`http://localhost:8080/api/users/${this.loggedUser.id}/image`,e).subscribe({next:a=>{this.loggedUser&&(this.loggedUser.profileImage=a.imageUrl+"?t="+new Date().getTime(),localStorage.setItem("user",JSON.stringify(this.loggedUser)),this.closeAll())},error:a=>console.error("Error uploading image",a)})}}onFocusEventFromMenu(n){this.mapView&&this.mapView.flyToEvent(n)}static \u0275fac=function(e){return new(e||i)(Ft(La),Ft(bs),Ft(Lu),Ft(yo),Ft(Zs),Ft(Cs),Ft(Na))};static \u0275cmp=Sn({type:i,selectors:[["Home"]],viewQuery:function(e,a){if(e&1&&ka(xb,5),e&2){let d;pa(d=fa())&&(a.mapView=d.first)}},decls:13,vars:11,consts:[["createEventPopup",""],[1,"home-container"],[1,"top-bar"],[3,"email","token","verified"],[3,"userId","currentUserId"],[3,"eventSelected","mapInteract","requestLogin","eventsUpdated","openUserProfile","userId"],[3,"imageFile"],[3,"display"],[3,"event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"event","currentUserId"],[1,"button",3,"click"],[3,"action","openProfile","openChatFromNotification","focusEvent","loggedUser"],["id","hiddenFileInput","type","file","accept","image/*",2,"display","none",3,"change"],[3,"switchToSignIn","close","signUpSuccess","signInSuccess"],[3,"close","resendVerification","email","token","verified"],[3,"switchToSignUp","close","signInSuccess"],[3,"close","openProfile","userId","currentUserId"],[3,"close","imageCropped","imageFile"],[3,"close","eventCreated","openLocationSelector"],[3,"locationSelected","close"],[3,"close","participate","toggleFavorite","openOrganizerProfile","leave","deleteEvent","shareEvent","openChat","event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"close","event","currentUserId"]],template:function(e,a){e&1&&(z(0,"div",1),Je(1,Dre,5,0,"div",2)(2,Are,2,1),Je(3,Pre,1,0,"SignUpPopup"),Je(4,Ore,1,3,"VerifyEmailPopup",3),Je(5,Rre,1,0,"SignInPopup"),Je(6,kre,1,2,"app-user-profile-modal",4),z(7,"map-view",5),Ae("eventSelected",function(r){return a.openEventPopup(r)})("mapInteract",function(){return a.closeEventPopup()})("requestLogin",function(){return a.openSignIn()})("eventsUpdated",function(r){return a.onEventsUpdated(r)})("openUserProfile",function(r){return a.openUserProfile(r)}),V(),Je(8,Fre,1,1,"CropImagePopup",6),Je(9,Lre,2,2,"create-event-popup",7),Je(10,Nre,1,0,"map-location-selector"),Je(11,zre,1,6,"event-popup-card",8),Je(12,Bre,1,2,"event-chat-modal",9),V()),e&2&&(J(),et(a.loggedUser?2:1),J(2),et(a.showSignUp?3:-1),J(),et(a.showVerifyPopup?4:-1),J(),et(a.showSignIn?5:-1),J(),et(a.showUserProfile?6:-1),J(),bt("userId",a.loggedUser?a.loggedUser.id||"":null),J(),et(a.showCropPopup&&a.selectedImageFile?8:-1),J(),et(a.showCreateEventPopup?9:-1),J(),et(a.showLocationSelector?10:-1),J(),et(a.selectedEvent?11:-1),J(),et(a.showChatModal&&a.chatEvent?12:-1))},dependencies:[xb,gT,_T,vT,ET,ST,TT,MT,DT,PT,yv],styles:[".top-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;top:20px;right:20px;gap:8px;z-index:1000;background:var(--color-dark-gray);padding:8px;border-radius:16px;box-shadow:0 4px 20px #0000004d;box-sizing:border-box;border:1px solid var(--color-light-gray);align-items:center}@media (max-width: 768px){.top-bar[_ngcontent-%COMP%]{inset:20px auto auto 50%;transform:translate(-50%);width:90%;justify-content:center;background:#1a1a1af2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.top-bar[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{flex:1;font-size:14px;height:44px}}"]})};var Vre=()=>["/"];function Ure(i,n){if(i&1){let e=wt();z(0,"a",5),Ae("click",function(){Me(e);let d=ne();return De(d.verifyEmail())}),Z(1,"Verify Email"),V()}}function jre(i,n){i&1&&(z(0,"a",4),Z(1,"Back to Home"),V()),i&2&&bt("routerLink",U2(1,Vre))}var RT=class i{constructor(n,e){this.route=n;this.authService=e}token="";verified=!1;message="Click the button to verify your email.";ngOnInit(){this.route.queryParams.subscribe(n=>{this.token=n.token||""})}verifyEmail(){this.token&&this.authService.verifyEmail(this.token).subscribe({next:n=>{this.verified=!0,this.message="You have been successfully registered! Signing you in...",n.data&&localStorage.setItem("user",JSON.stringify(n.data)),setTimeout(()=>{window.location.href="/"},1500)},error:n=>{this.verified=!1,this.message=n.error?.error||"Token is invalid or expired."}})}static \u0275fac=function(e){return new(e||i)(Ft(La),Ft(Lu))};static \u0275cmp=Sn({type:i,selectors:[["VerifyEmailPage"]],decls:9,vars:2,consts:[[1,"container"],[1,"verify-container"],[1,"header"],[1,"button"],[1,"button",3,"routerLink"],[1,"button",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),Z(4,"Email Verification"),V(),z(5,"p"),Z(6),V()(),Je(7,Ure,2,0,"a",3)(8,jre,2,2,"a",4),V()()),e&2&&(J(6),ct(a.message),J(),et(a.verified?8:7))},dependencies:[pO,wS],styles:[".container[_ngcontent-%COMP%]{background-color:var(--color-dark-gray);width:100%;height:100vh;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .verify-container[_ngcontent-%COMP%]{text-align:center;position:relative;align-items:center;width:30%;height:auto;background-color:var(--color-gray);border-radius:20px;padding:40px;border:2px solid var(--color-dark-gray);display:flex;flex-direction:column;gap:24px}"]})};var kT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/admin";getUsers(){return this.http.get(`${this.baseUrl}/users`)}getAllEvents(){return this.http.get(`${this.baseUrl}/events`)}approveEvent(n){return this.http.post(`${this.baseUrl}/events/${n}/approve`,{})}rejectEvent(n,e){return this.http.post(`${this.baseUrl}/events/${n}/reject`,{reason:e})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/events/${n}`)}getReports(){return this.http.get(`${this.baseUrl}/reports`)}static \u0275fac=function(e){return new(e||i)(dn(yo))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};var LT=(i,n)=>n.id;function Hre(i,n){i&1&&(z(0,"h1"),Z(1,"Dashboard Overview"),V())}function Gre(i,n){i&1&&(z(0,"h1"),Z(1,"Event Management"),V())}function qre(i,n){i&1&&(z(0,"h1"),Z(1,"User Management"),V())}function Wre(i,n){i&1&&(z(0,"h1"),Z(1,"Reports"),V())}function Zre(i,n){if(i&1){let e=wt();z(0,"button",37),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(2);return De(r.approveEvent(d))}),z(1,"mat-icon"),Z(2,"check"),V()(),z(3,"button",38),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(2);return De(r.rejectEvent(d))}),z(4,"mat-icon"),Z(5,"close"),V()()}}function Yre(i,n){if(i&1){let e=wt();z(0,"div",35)(1,"input",39,0),Ae("keyup.enter",function(){Me(e);let d=Bl(2),r=ne().$implicit,E=ne(2);return De(E.confirmReject(r,d.value))}),V(),z(3,"button",40),Ae("click",function(){Me(e);let d=Bl(2),r=ne().$implicit,E=ne(2);return De(E.confirmReject(r,d.value))}),z(4,"mat-icon"),Z(5,"check"),V()(),z(6,"button",41),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(2);return De(r.cancelReject(d.id))}),z(7,"mat-icon"),Z(8,"close"),V()()()}}function Xre(i,n){if(i&1&&(z(0,"tr",36)(1,"td",42)(2,"div",43)(3,"div",44)(4,"span",45),Z(5,"Description"),V(),z(6,"span",46),Z(7),V()(),z(8,"div",47)(9,"span",45),Z(10,"Date"),V(),z(11,"span",48),Z(12),V()(),z(13,"div",47)(14,"span",45),Z(15,"Time"),V(),z(16,"span",48),Z(17),V()(),z(18,"div",47)(19,"span",45),Z(20,"City"),V(),z(21,"span",48),Z(22),V()(),z(23,"div",47)(24,"span",45),Z(25,"Capacity"),V(),z(26,"span",48),Z(27),V()(),z(28,"div",47)(29,"span",45),Z(30,"Cost"),V(),z(31,"span",48),Z(32),V()(),z(33,"div",47)(34,"span",45),Z(35,"Coordinates"),V(),z(36,"span",48),Z(37),V()(),z(38,"div",47)(39,"span",45),Z(40,"Created"),V(),z(41,"span",48),Z(42),V()(),z(43,"div",47)(44,"span",45),Z(45,"Organizer"),V(),z(46,"span",48),Z(47),V()(),z(48,"div",47)(49,"span",45),Z(50,"Event ID"),V(),z(51,"span",48),Z(52),V()()()()()),i&2){let e=ne().$implicit;J(7),ct(e.description||"No description provided."),J(5),ct(e.date||"-"),J(5),ma("",e.startTime||"-"," - ",e.endTime||"-"),J(5),ct(e.city||"-"),J(5),ct(e.nPartecipants||"-"),J(5),ct(e.costPerPerson!=null?e.costPerPerson+" EUR":"Free"),J(5),ct(e.latitude!=null&&e.longitude!=null?e.latitude+", "+e.longitude:"-"),J(5),ct(e.createdAt||"-"),J(5),ct(e.organizerName||e.organizer||"Unknown"),J(5),Zi("#",e.id)}}function Kre(i,n){if(i&1){let e=wt();z(0,"tr")(1,"td")(2,"div",29)(3,"strong"),Z(4),V(),z(5,"span",30),Z(6),V()()(),z(7,"td")(8,"div",31),Rn(9,"img",32),z(10,"span"),Z(11),V()()(),z(12,"td"),Z(13),V(),z(14,"td")(15,"div",33)(16,"button",34),Ae("click",function(){let d=Me(e).$implicit,r=ne(2);return De(r.toggleDetails(d.id))}),z(17,"mat-icon"),Z(18),V()(),Je(19,Zre,6,0)(20,Yre,9,0,"div",35),V()()(),Je(21,Xre,53,11,"tr",36)}if(i&2){let e=n.$implicit,a=ne(2);J(4),ct(e.title),J(2),ct(e.city),J(3),bt("src",e.organizerImg||"assets/img/default-avatar.png",to),J(2),ct(e.organizer),J(2),ct(e.date),J(5),ct(a.expandedEventId===e.id?"expand_less":"info"),J(),et(a.eventsCurrentlyRejecting.includes(e.id)?20:19),J(2),et(a.expandedEventId===e.id?21:-1)}}function Qre(i,n){i&1&&(z(0,"tr")(1,"td",49),Z(2,"No pending requests."),V()())}function Jre(i,n){if(i&1){let e=wt();z(0,"div",10)(1,"div",11),Ae("click",function(){Me(e);let d=ne();return De(d.setView("users"))}),z(2,"div",12)(3,"mat-icon"),Z(4,"people"),V()(),z(5,"div",13)(6,"span",14),Z(7),V(),z(8,"span",15),Z(9,"Registered Users"),V()()(),z(10,"div",11),Ae("click",function(){Me(e);let d=ne();return De(d.setView("events"))}),z(11,"div",16)(12,"mat-icon"),Z(13,"event"),V()(),z(14,"div",13)(15,"span",14),Z(16),V(),z(17,"span",15),Z(18,"Total Events"),V()()(),z(19,"div",17)(20,"div",18)(21,"mat-icon"),Z(22,"assignment"),V()(),z(23,"div",13)(24,"span",14),Z(25),V(),z(26,"span",15),Z(27,"Pending Approval"),V()()()(),z(28,"div",19)(29,"div",20)(30,"div",21)(31,"h3"),Z(32,"Recent Requests"),V(),z(33,"button",22),Ae("click",function(){Me(e);let d=ne();return De(d.setView("events"))}),Z(34,"See all"),V()(),z(35,"div",23)(36,"table")(37,"thead")(38,"tr")(39,"th"),Z(40,"EVENT"),V(),z(41,"th"),Z(42,"EVENTER"),V(),z(43,"th"),Z(44,"DATE"),V(),z(45,"th"),Z(46,"ACTIONS"),V()()(),z(47,"tbody"),qi(48,Kre,22,8,null,null,LT),Je(50,Qre,3,0,"tr"),V()()()(),z(51,"div",24)(52,"h3"),Z(53,"Quick Actions"),V(),z(54,"div",25)(55,"button",26),Ae("click",function(){Me(e);let d=ne();return De(d.setView("events"))}),z(56,"mat-icon",27),Z(57,"verified_user"),V(),z(58,"span"),Z(59,"Manage Events"),V()(),z(60,"button",28),Ae("click",function(){Me(e);let d=ne();return De(d.setView("users"))}),z(61,"mat-icon",27),Z(62,"search"),V(),z(63,"span"),Z(64,"Search Users"),V()()()()()}if(i&2){let e=ne();J(7),ct(e.totalUsers),J(9),ct(e.totalEvents),J(9),ct(e.pendingEventsCount),J(23),Wi(e.recentRequests.slice(0,5)),J(2),et(e.recentRequests.length===0?50:-1)}}function eoe(i,n){i&1&&(z(0,"span",53),Z(1,"Approved"),V())}function toe(i,n){i&1&&(z(0,"span",54),Z(1,"Pending"),V())}function noe(i,n){if(i&1){let e=wt();z(0,"button",37),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne(2);return De(r.approveEvent(d))}),z(1,"mat-icon"),Z(2,"check"),V()(),z(3,"button",38),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne(2);return De(r.rejectEvent(d))}),z(4,"mat-icon"),Z(5,"close"),V()()}}function ioe(i,n){if(i&1){let e=wt();z(0,"div",35)(1,"input",39,0),Ae("keyup.enter",function(){Me(e);let d=Bl(2),r=ne(2).$implicit,E=ne(2);return De(E.confirmReject(r,d.value))}),V(),z(3,"button",40),Ae("click",function(){Me(e);let d=Bl(2),r=ne(2).$implicit,E=ne(2);return De(E.confirmReject(r,d.value))}),z(4,"mat-icon"),Z(5,"check"),V()(),z(6,"button",41),Ae("click",function(){Me(e);let d=ne(2).$implicit,r=ne(2);return De(r.cancelReject(d.id))}),z(7,"mat-icon"),Z(8,"close"),V()()()}}function roe(i,n){if(i&1&&Je(0,noe,6,0)(1,ioe,9,0,"div",35),i&2){let e=ne().$implicit,a=ne(2);et(a.eventsCurrentlyRejecting.includes(e.id)?1:0)}}function ooe(i,n){if(i&1){let e=wt();z(0,"button",56),Ae("click",function(){Me(e);let d=ne().$implicit,r=ne(2);return De(r.deleteEvent(d))}),z(1,"mat-icon"),Z(2,"delete_outline"),V()()}}function soe(i,n){if(i&1&&(z(0,"tr",36)(1,"td",57)(2,"div",43)(3,"div",44)(4,"span",45),Z(5,"Description"),V(),z(6,"span",46),Z(7),V()(),z(8,"div",47)(9,"span",45),Z(10,"Date"),V(),z(11,"span",48),Z(12),V()(),z(13,"div",47)(14,"span",45),Z(15,"Time"),V(),z(16,"span",48),Z(17),V()(),z(18,"div",47)(19,"span",45),Z(20,"City"),V(),z(21,"span",48),Z(22),V()(),z(23,"div",47)(24,"span",45),Z(25,"Capacity"),V(),z(26,"span",48),Z(27),V()(),z(28,"div",47)(29,"span",45),Z(30,"Cost"),V(),z(31,"span",48),Z(32),V()(),z(33,"div",47)(34,"span",45),Z(35,"Coordinates"),V(),z(36,"span",48),Z(37),V()(),z(38,"div",47)(39,"span",45),Z(40,"Created"),V(),z(41,"span",48),Z(42),V()(),z(43,"div",47)(44,"span",45),Z(45,"Organizer"),V(),z(46,"span",48),Z(47),V()(),z(48,"div",47)(49,"span",45),Z(50,"Event ID"),V(),z(51,"span",48),Z(52),V()()()()()),i&2){let e=ne().$implicit;J(7),ct(e.description||"No description provided."),J(5),ct(e.date||"-"),J(5),ma("",e.startTime||"-"," - ",e.endTime||"-"),J(5),ct(e.city||"-"),J(5),ct(e.nPartecipants||"-"),J(5),ct(e.costPerPerson!=null?e.costPerPerson+" EUR":"Free"),J(5),ct(e.latitude!=null&&e.longitude!=null?e.latitude+", "+e.longitude:"-"),J(5),ct(e.createdAt||"-"),J(5),ct(e.organizerName||e.organizer||"Unknown"),J(5),Zi("#",e.id)}}function aoe(i,n){if(i&1){let e=wt();z(0,"tr")(1,"td"),Z(2),V(),z(3,"td")(4,"div",29)(5,"strong"),Z(6),V(),z(7,"span",30),Z(8),V()()(),z(9,"td")(10,"div",31),Rn(11,"img",32),z(12,"span"),Z(13),V()()(),z(14,"td"),Je(15,eoe,2,0,"span",53)(16,toe,2,0,"span",54),V(),z(17,"td"),Z(18),V(),z(19,"td")(20,"div",33)(21,"button",34),Ae("click",function(){let d=Me(e).$implicit,r=ne(2);return De(r.toggleDetails(d.id))}),z(22,"mat-icon"),Z(23),V()(),Je(24,roe,2,1),ji(25,ooe,3,0,"button",55),V()()(),Je(26,soe,53,11,"tr",36)}if(i&2){let e=n.$implicit,a=ne(2);J(2),Zi("#",e.id),J(4),ct(e.title),J(2),ct(e.city),J(3),bt("src",e.organizerImage||"assets/img/default-avatar.png",to),J(2),ct(e.organizerName||"Unknown"),J(2),et(e.isApproved?15:16),J(3),ct(e.date),J(5),ct(a.expandedEventId===e.id?"expand_less":"info"),J(),et(e.isApproved?-1:24),J(),bt("ngIf",e.isApproved),J(),et(a.expandedEventId===e.id?26:-1)}}function loe(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",50)(2,"mat-icon",51),Z(3,"search"),V(),z(4,"input",52),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.searchTermEvents,d)||(r.searchTermEvents=d),De(d)}),V()(),z(5,"div",23)(6,"table")(7,"thead")(8,"tr")(9,"th"),Z(10,"ID"),V(),z(11,"th"),Z(12,"EVENT"),V(),z(13,"th"),Z(14,"EVENTER"),V(),z(15,"th"),Z(16,"STATUS"),V(),z(17,"th"),Z(18,"DATE"),V(),z(19,"th"),Z(20,"ACTIONS"),V()()(),z(21,"tbody"),qi(22,aoe,27,11,null,null,LT),V()()()()}if(i&2){let e=ne();J(4),_o("ngModel",e.searchTermEvents),J(18),Wi(e.filteredEvents)}}function coe(i,n){i&1&&(z(0,"span",59),Z(1,"Admin"),V())}function uoe(i,n){i&1&&(z(0,"span",60),Z(1,"User"),V())}function doe(i,n){if(i&1&&(z(0,"tr")(1,"td"),Z(2),V(),z(3,"td")(4,"div",31),Rn(5,"img",32),z(6,"span"),Z(7),V()()(),z(8,"td"),Z(9),V(),z(10,"td"),Je(11,coe,2,0,"span",59)(12,uoe,2,0,"span",60),V()()),i&2){let e=n.$implicit;J(2),Zi("#",e.id),J(3),bt("src",e.profileImage||"assets/img/default-avatar.png",to),J(2),ct(e.name),J(2),ct(e.email),J(2),et(e.isAdmin?11:12)}}function hoe(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",50)(2,"mat-icon",51),Z(3,"search"),V(),z(4,"input",58),vo("ngModelChange",function(d){Me(e);let r=ne();return To(r.searchTermUsers,d)||(r.searchTermUsers=d),De(d)}),V()(),z(5,"div",23)(6,"table")(7,"thead")(8,"tr")(9,"th"),Z(10,"ID"),V(),z(11,"th"),Z(12,"USER"),V(),z(13,"th"),Z(14,"EMAIL"),V(),z(15,"th"),Z(16,"ROLE"),V()()(),z(17,"tbody"),qi(18,doe,13,5,"tr",null,LT),V()()()()}if(i&2){let e=ne();J(4),_o("ngModel",e.searchTermUsers),J(14),Wi(e.filteredUsers)}}function poe(i,n){i&1&&(z(0,"div",62),Z(1,"Loading reports..."),V())}function foe(i,n){if(i&1&&(z(0,"span"),Z(1,"\xB7"),V(),z(2,"span"),Z(3),Ls(4,"date"),V()),i&2){let e=ne().$implicit;J(3),ct(D_(4,1,e.createdAt,"short"))}}function moe(i,n){if(i&1){let e=wt();z(0,"div",66),Ae("click",function(){let d=Me(e).$implicit,r=ne(3);return De(r.selectReport(d))}),z(1,"div",67),Z(2),V(),z(3,"div",68)(4,"span"),Z(5),V(),z(6,"span"),Z(7,"\xB7"),V(),z(8,"span"),Z(9),V(),Je(10,foe,5,4),V()()}if(i&2){let e=n.$implicit,a=ne(3);hn("active",(a.selectedReport==null?null:a.selectedReport.id)===e.id),J(2),ct(e.reason),J(3),ct(e.targetType==="USER"?"User":"Event"),J(4),ct(e.targetName),J(),et(e.createdAt?10:-1)}}function goe(i,n){i&1&&(z(0,"div",62),Z(1,"No reports yet."),V())}function _oe(i,n){if(i&1&&(qi(0,moe,11,6,"div",65,LT),Je(2,goe,2,0,"div",62)),i&2){let e=ne(2);Wi(e.reports),J(2),et(e.reports.length===0?2:-1)}}function voe(i,n){if(i&1&&(z(0,"div",69)(1,"span",70),Z(2,"Created:"),V(),z(3,"span",71),Z(4),Ls(5,"date"),V()()),i&2){let e=ne(3);J(4),ct(D_(5,1,e.selectedReport.createdAt,"medium"))}}function yoe(i,n){if(i&1&&(z(0,"a",73)(1,"mat-icon"),Z(2,"download"),V(),Z(3," Download image "),V()),i&2){let e=ne(3);bt("href",e.selectedReport.imageUrl,to)}}function xoe(i,n){i&1&&(z(0,"div",62),Z(1,"No image attached."),V())}function boe(i,n){if(i&1&&(z(0,"div",64)(1,"h3"),Z(2),V(),z(3,"div",69)(4,"span",70),Z(5,"Reported:"),V(),z(6,"span",71),Z(7),V()(),z(8,"div",69)(9,"span",70),Z(10,"Type:"),V(),z(11,"span",71),Z(12),V()(),z(13,"div",69)(14,"span",70),Z(15,"Reporter:"),V(),z(16,"span",71),Z(17),V()(),Je(18,voe,6,4,"div",69),z(19,"div",72)(20,"span",70),Z(21,"Details:"),V(),z(22,"span",71),Z(23),V()(),Je(24,yoe,4,1,"a",73)(25,xoe,2,0,"div",62),V()),i&2){let e=ne(2);J(2),ct(e.selectedReport.reason),J(5),ct(e.selectedReport.targetName),J(5),ct(e.selectedReport.targetType),J(5),ct(e.selectedReport.reporterName),J(),et(e.selectedReport.createdAt?18:-1),J(5),ct(e.selectedReport.details||"No details provided."),J(),et(e.selectedReport.hasImage&&e.selectedReport.imageUrl?24:25)}}function woe(i,n){i&1&&(z(0,"div",62),Z(1,"Select a report to see details."),V())}function Coe(i,n){if(i&1&&(z(0,"div",9)(1,"div",61)(2,"div",21)(3,"h3"),Z(4,"All Reports"),V()(),Je(5,poe,2,0,"div",62)(6,_oe,3,1),V(),z(7,"div",63),Je(8,boe,26,7,"div",64)(9,woe,2,0,"div",62),V()()),i&2){let e=ne();J(5),et(e.loadingReports?5:6),J(3),et(e.selectedReport?8:9)}}var FT=class i{constructor(n,e,a,d){this.router=n;this.adminService=e;this.confirmation=a;this.snackBar=d}users=[];allEvents=[];recentRequests=[];totalUsers=0;totalEvents=0;pendingEventsCount=0;currentView="dashboard";reports=[];selectedReport=null;loadingReports=!1;searchTermEvents="";searchTermUsers="";expandedEventId=null;pollSubscription=null;ngOnInit(){this.loadData(),this.startPolling()}ngOnDestroy(){this.stopPolling()}startPolling(){this.pollSubscription=lf(5e3).subscribe(()=>{this.loadData()})}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}setView(n){this.currentView=n,this.expandedEventId=null,n==="reports"&&this.loadReports()}get filteredEvents(){if(!this.searchTermEvents.trim())return this.allEvents;let n=this.searchTermEvents.toLowerCase();return this.allEvents.filter(e=>e.title?.toLowerCase().includes(n)||e.city?.toLowerCase().includes(n)||e.organizerName?.toLowerCase().includes(n))}get filteredUsers(){if(!this.searchTermUsers.trim())return this.users;let n=this.searchTermUsers.toLowerCase();return this.users.filter(e=>e.name?.toLowerCase().includes(n)||e.email?.toLowerCase().includes(n))}loadData(){this.adminService.getUsers().subscribe(n=>{this.users=n,this.calculateStats()}),this.adminService.getAllEvents().subscribe(n=>{this.allEvents=n,this.calculateStats()}),this.loadReports()}calculateStats(){if(this.totalUsers=this.users.length,this.allEvents){this.totalEvents=this.allEvents.length;let n=this.allEvents.filter(e=>e.isApproved===!1);this.pendingEventsCount=n.length,this.recentRequests=n.map(e=>wi(Ht({},e),{organizer:e.organizerName||"Unknown",organizerImg:e.organizerImage}))}}toggleDetails(n){this.expandedEventId===n?this.expandedEventId=null:this.expandedEventId=n}approveEvent(n){this.adminService.approveEvent(n.id).subscribe(()=>{this.loadData()})}eventsCurrentlyRejecting=[];rejectEvent(n){this.eventsCurrentlyRejecting.includes(n.id)||this.eventsCurrentlyRejecting.push(n.id)}cancelReject(n){this.eventsCurrentlyRejecting=this.eventsCurrentlyRejecting.filter(e=>e!==n)}confirmReject(n,e){console.log("Confirming reject for event:",n.id,"Reason:",e),this.adminService.rejectEvent(n.id,e).subscribe({next:()=>{console.log("Rejection successful"),this.cancelReject(n.id),this.loadData()},error:a=>{console.error("Rejection failed:",a),this.showToast("Error while rejecting the event.","error")}})}deleteEvent(n){return Er(this,null,function*(){(yield this.confirmation.confirm({title:"Delete event",message:`Are you sure you want to permanently delete the event "${n.title}"? This action will remove the event from the map and all user lists. It cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.adminService.deleteEvent(n.id).subscribe({next:()=>{this.loadData()},error:a=>{console.error("Error deleting event",a),this.showToast("Error deleting the event.","error")}})})}loadReports(){this.loadingReports||(this.loadingReports=!0,this.adminService.getReports().subscribe({next:n=>{if(this.reports=n,this.selectedReport){let e=n.find(a=>a.id===this.selectedReport?.id)||null;this.selectedReport=e}this.loadingReports=!1},error:n=>{console.error("Error loading reports",n),this.loadingReports=!1}}))}selectReport(n){this.selectedReport=n}signOut(){localStorage.removeItem("user"),this.router.navigate(["/"])}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1600:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Ft(bs),Ft(kT),Ft(Na),Ft(Lc))};static \u0275cmp=Sn({type:i,selectors:[["app-admin-dashboard"]],decls:38,vars:13,consts:[["reasonInput",""],[1,"admin-container"],[1,"sidebar"],[1,"logo"],["href","javascript:void(0)",1,"nav-item",3,"click"],[1,"btn-logout",3,"click"],[1,"main-content"],[1,"header"],[1,"full-table-section"],[1,"reports-grid"],[1,"stats-grid"],[1,"stat-card",3,"click"],[1,"stat-icon","users-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-icon","events-icon"],[1,"stat-card"],[1,"stat-icon","pending-icon"],[1,"dashboard-grid"],[1,"requests-section"],[1,"section-header"],[1,"btn-link",3,"click"],[1,"table-container"],[1,"actions-section"],[1,"quick-actions"],[1,"action-card",3,"click"],[1,"action-icon"],[1,"action-card","outline",3,"click"],[1,"ev-cell-title"],[1,"ev-sub"],[1,"ev-organizer"],[1,"table-avatar",3,"src"],[1,"action-buttons"],["title","View details",1,"btn-icon","info",3,"click"],[1,"inline-reject"],[1,"event-details-row"],["title","Approve",1,"btn-icon","approve",3,"click"],["title","Reject",1,"btn-icon","reject",3,"click"],["type","text","placeholder","Reason...","autoFocus","",1,"input-reason",3,"keyup.enter"],[1,"btn-icon","approve",3,"click"],[1,"btn-icon","reject",3,"click"],["colspan","4"],[1,"event-details"],[1,"detail-item","full"],[1,"detail-label"],[1,"detail-value","description"],[1,"detail-item"],[1,"detail-value"],["colspan","4",1,"no-data"],[1,"search-container"],[1,"search-icon"],["type","text","placeholder","Search events by title, city or eventer...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","approved"],[1,"status-badge","pending"],["class","btn-icon delete","title","Delete Permanently",3,"click",4,"ngIf"],["title","Delete Permanently",1,"btn-icon","delete",3,"click"],["colspan","6"],["type","text","placeholder","Search users by name or email...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","admin"],[1,"status-badge","user"],[1,"reports-list"],[1,"no-data"],[1,"report-detail"],[1,"detail-card"],[1,"report-item",3,"active"],[1,"report-item",3,"click"],[1,"report-title"],[1,"report-meta"],[1,"detail-row"],[1,"report-detail-label"],[1,"report-detail-value"],[1,"detail-row","full"],["download","",1,"button","download-btn",3,"href"]],template:function(e,a){e&1&&(z(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),Z(4,"LUMO "),z(5,"span"),Z(6,"Admin"),V()()(),z(7,"nav")(8,"a",4),Ae("click",function(){return a.setView("dashboard")}),z(9,"mat-icon"),Z(10,"dashboard"),V(),Z(11," Dashboard "),V(),z(12,"a",4),Ae("click",function(){return a.setView("events")}),z(13,"mat-icon"),Z(14,"event"),V(),Z(15," Events "),V(),z(16,"a",4),Ae("click",function(){return a.setView("users")}),z(17,"mat-icon"),Z(18,"people"),V(),Z(19," Users "),V(),z(20,"a",4),Ae("click",function(){return a.setView("reports")}),z(21,"mat-icon"),Z(22,"flag"),V(),Z(23," Reports "),V()(),z(24,"button",5),Ae("click",function(){return a.signOut()}),z(25,"mat-icon"),Z(26,"logout"),V(),Z(27," Logout "),V()(),z(28,"div",6)(29,"div",7),Je(30,Hre,2,0,"h1")(31,Gre,2,0,"h1")(32,qre,2,0,"h1")(33,Wre,2,0,"h1"),V(),Je(34,Jre,65,4),Je(35,loe,24,1,"div",8),Je(36,hoe,20,1,"div",8),Je(37,Coe,10,2,"div",9),V()()),e&2&&(J(8),hn("active",a.currentView==="dashboard"),J(4),hn("active",a.currentView==="events"),J(4),hn("active",a.currentView==="users"),J(4),hn("active",a.currentView==="reports"),J(10),et(a.currentView==="dashboard"?30:a.currentView==="events"?31:a.currentView==="users"?32:a.currentView==="reports"?33:-1),J(4),et(a.currentView==="dashboard"?34:-1),J(),et(a.currentView==="events"?35:-1),J(),et(a.currentView==="users"?36:-1),J(),et(a.currentView==="reports"?37:-1))},dependencies:[xi,cs,Ai,Di,Ru,Ba,ws,Ws,_a,yx],styles:[".admin-container[_ngcontent-%COMP%]{display:flex;height:100vh;background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);color:var(--color-white);font-family:var(--font-stack-headline);overflow:hidden}.sidebar[_ngcontent-%COMP%]{width:250px;background:transparent;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;padding:20px;flex-shrink:0;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.logo[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--color-white);margin:0 0 40px;font-size:20px;font-weight:var(--font-weight-semibold)}.logo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--color-accent)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex-grow:1}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;color:var(--color-light-gray);text-decoration:none;border-radius:var(--radius-sm);transition:all .2s;font-size:14px;font-weight:var(--font-weight-medium)}.nav-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.nav-item.active[_ngcontent-%COMP%], .nav-item[_ngcontent-%COMP%]:hover{background-color:#fcc3241a;color:var(--color-accent)}.nav-item.active[_ngcontent-%COMP%]{border-left:3px solid var(--color-accent)}.btn-logout[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:transparent;border:1px solid var(--color-gray);color:var(--color-light-gray);border-radius:var(--radius-sm);cursor:pointer;margin-top:auto;width:100%;transition:all .2s;font-family:var(--font-stack-headline)}.btn-logout[_ngcontent-%COMP%]:hover{background:var(--color-gray);color:var(--color-white)}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:30px 40px;overflow-y:auto}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;margin:0 0 30px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}.stat-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;display:flex;align-items:center;gap:20px;border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.stat-card[_ngcontent-%COMP%]:hover{border-color:#fcc32480;box-shadow:0 0 15px #fcc3241a;transform:translateY(-2px)}.stat-icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--radius-md);background:#ffffff1a;display:flex;align-items:center;justify-content:center}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}.users-icon[_ngcontent-%COMP%]{background:#ffffff1a}.events-icon[_ngcontent-%COMP%]{background:#fcc3241a}.events-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.pending-icon[_ngcontent-%COMP%]{background:#ffffff1a}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:28px;font-weight:var(--font-weight-bold);color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:13px;color:var(--color-light-gray)}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:20px}.requests-section[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;border:1px solid rgba(255,255,255,.1)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:16px;font-weight:var(--font-weight-semibold)}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;font-size:12px;font-family:var(--font-stack-headline)}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}th[_ngcontent-%COMP%]{text-align:left;color:var(--color-light-gray);font-size:11px;text-transform:uppercase;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.1);font-weight:var(--font-weight-medium)}td[_ngcontent-%COMP%]{padding:16px 0;border-bottom:1px solid rgba(255,255,255,.1);vertical-align:middle}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.ev-cell-title[_ngcontent-%COMP%]{display:flex;flex-direction:column}.ev-cell-title[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-medium)}.ev-sub[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.ev-organizer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.table-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:var(--radius-full);object-fit:cover}.event-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-top:0}.event-details[_ngcontent-%COMP%]{background:#ffffff08;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px 24px}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.detail-item.full[_ngcontent-%COMP%]{grid-column:1 / -1}.detail-label[_ngcontent-%COMP%]{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--color-light-gray)}.detail-value[_ngcontent-%COMP%]{font-size:12px;color:var(--color-white)}.detail-value.description[_ngcontent-%COMP%]{color:#ddd;line-height:1.4;white-space:pre-wrap}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.btn-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.approve[_ngcontent-%COMP%]{background:#10b9811a;color:var(--success)}.approve[_ngcontent-%COMP%]{background:#4caf501a;color:#4caf50}.approve[_ngcontent-%COMP%]:hover{background:#4caf50;color:#fff}.reject[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.reject[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.delete[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.delete[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.info[_ngcontent-%COMP%]{background:#2196f31a;color:#2196f3}.info[_ngcontent-%COMP%]:hover{background:#2196f3;color:#fff}.inline-reject[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center}.input-reason[_ngcontent-%COMP%]{background:var(--color-dark-gray);border:1px solid var(--color-bit-gray);color:var(--color-white);padding:5px 8px;border-radius:4px;width:120px;height:32px;outline:none;font-family:var(--font-stack-headline)}.input-reason[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.actions-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;color:var(--color-white);font-weight:var(--font-weight-semibold)}.quick-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.action-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:24px;padding:20px;display:flex;align-items:center;gap:15px;cursor:pointer;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-medium);transition:transform .2s,border-color .2s;width:100%;text-align:left;font-family:var(--font-stack-headline)}.action-card[_ngcontent-%COMP%]:hover{border-color:var(--color-accent);transform:translateY(-2px)}.action-icon[_ngcontent-%COMP%]{background:transparent;color:var(--color-accent)}.no-data[_ngcontent-%COMP%]{text-align:center;color:var(--color-light-gray);font-style:italic}@media (max-width: 768px){.admin-container[_ngcontent-%COMP%]{flex-direction:column}.sidebar[_ngcontent-%COMP%]{width:100%;flex-direction:row;padding:12px 16px;border-right:none;border-bottom:1px solid var(--color-gray);position:fixed;top:0;left:0;z-index:100;background:var(--color-dark-gray)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{flex-direction:row;gap:8px;flex-grow:0}.nav-item[_ngcontent-%COMP%]{padding:10px 12px;font-size:12px;gap:6px}.nav-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .logo[_ngcontent-%COMP%]{display:none}.btn-logout[_ngcontent-%COMP%]{margin-top:0;margin-left:auto;width:auto;padding:10px 12px}.btn-logout[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.main-content[_ngcontent-%COMP%]{margin-left:0;padding:80px 16px 24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.stat-card[_ngcontent-%COMP%]{padding:16px}.stat-value[_ngcontent-%COMP%]{font-size:22px}table[_ngcontent-%COMP%]{font-size:12px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px 8px}.action-buttons[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-icon[_ngcontent-%COMP%]{width:28px;height:28px}.input-reason[_ngcontent-%COMP%]{width:80px}.event-details[_ngcontent-%COMP%]{grid-template-columns:1fr}.search-input[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 1024px){.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;margin-bottom:24px}.search-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:14px;color:var(--color-light-gray);font-size:20px;width:20px;height:20px;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:12px 16px 12px 44px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background-color:#ffffff0d;color:var(--color-white);font-family:var(--font-stack-headline);font-size:14px;outline:none;transition:border-color .2s,box-shadow .2s}.search-input[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.search-input[_ngcontent-%COMP%]:focus{border-color:var(--color-accent);box-shadow:0 0 0 2px #fcc32433}@media (max-width: 768px){.search-input[_ngcontent-%COMP%]{max-width:100%}}.reports-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(280px,1fr) minmax(320px,1.2fr);gap:18px;margin-top:10px}.reports-list[_ngcontent-%COMP%], .report-detail[_ngcontent-%COMP%]{background:#ffffff0a;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;min-height:300px}.report-item[_ngcontent-%COMP%]{padding:12px;border-radius:12px;border:1px solid transparent;background:#ffffff0d;cursor:pointer;margin-bottom:10px}.report-item[_ngcontent-%COMP%]:hover{border-color:#fff3}.report-item.active[_ngcontent-%COMP%]{border-color:#fcc32499;box-shadow:0 0 10px #fcc32433}.report-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.report-meta[_ngcontent-%COMP%]{font-size:12px;color:#b5b5b5;display:flex;flex-wrap:wrap;gap:6px}.detail-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:12px;font-size:13px}.detail-row.full[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.report-detail-label[_ngcontent-%COMP%]{color:#bdbdbd;font-weight:600}.report-detail-value[_ngcontent-%COMP%]{color:var(--color-white)}.download-btn[_ngcontent-%COMP%]{margin-top:6px;display:inline-flex;align-items:center;gap:8px;width:fit-content}@media (max-width: 980px){.reports-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};var m6=(i,n)=>{let e=Ve(bs),a=localStorage.getItem("user");if(a){let d=JSON.parse(a);if(d.isAdmin==="true"||d.isAdmin===!0)return!0}return e.navigate(["/"]),!1};var g6=[{path:"",component:OT},{path:"admin",component:FT,canActivate:[m6]},{path:"verify-email",component:RT}];var _6=(i,n)=>n(i).pipe(tl(e=>(console.error("HTTP ERROR intercepted",e),e instanceof Nh?bc(()=>e):bc(()=>e||"Unknown error"))));var v6={providers:[FP(LP([_6])),dO(g6),oA(),q2({eventCoalescing:!0})]};AP(SS,v6).catch(i=>console.error(i));
