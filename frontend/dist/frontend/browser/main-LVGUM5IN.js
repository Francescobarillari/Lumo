var j8=Object.create;var $I=Object.defineProperty,$8=Object.defineProperties,H8=Object.getOwnPropertyDescriptor,G8=Object.getOwnPropertyDescriptors,q8=Object.getOwnPropertyNames,L1=Object.getOwnPropertySymbols,W8=Object.getPrototypeOf,HI=Object.prototype.hasOwnProperty,JF=Object.prototype.propertyIsEnumerable;var QF=(r,n,t)=>n in r?$I(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t,$t=(r,n)=>{for(var t in n||={})HI.call(n,t)&&QF(r,t,n[t]);if(L1)for(var t of L1(n))JF.call(n,t)&&QF(r,t,n[t]);return r},bi=(r,n)=>$8(r,G8(n));var N1=(r,n)=>{var t={};for(var l in r)HI.call(r,l)&&n.indexOf(l)<0&&(t[l]=r[l]);if(r!=null&&L1)for(var l of L1(r))n.indexOf(l)<0&&JF.call(r,l)&&(t[l]=r[l]);return t};var Z8=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var X8=(r,n,t,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let h of q8(n))!HI.call(r,h)&&h!==t&&$I(r,h,{get:()=>n[h],enumerable:!(l=H8(n,h))||l.enumerable});return r};var eL=(r,n,t)=>(t=r!=null?j8(W8(r)):{},X8(n||!r||!r.__esModule?$I(t,"default",{value:r,enumerable:!0}):t,r));var Ko=(r,n,t)=>new Promise((l,h)=>{var i=N=>{try{O(t.next(N))}catch(K){h(K)}},E=N=>{try{O(t.throw(N))}catch(K){h(K)}},O=N=>N.done?l(N.value):Promise.resolve(N.value).then(i,E);O((t=t.apply(r,n)).next())});var yP=Z8((_P,vP)=>{"use strict";(function(r,n){typeof _P=="object"&&typeof vP<"u"?vP.exports=n():typeof define=="function"&&define.amd?define(n):(r=typeof globalThis<"u"?globalThis:r||self,r.mapboxgl=n())})(_P,function(){"use strict";var r,n,t;function l(i,E){if(!r)r=E;else if(!n)n=E;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",N={};r(N),t=E(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(t.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}l(["exports"],function(i){var E=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;function N(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s*m-d*u;return g?(a[0]=m*(g=1/g),a[1]=-u*g,a[2]=-d*g,a[3]=s*g,a):null}function K(){var a=new O(9);return O!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function le(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],C=e[7],T=e[8];return a[0]=g*T-v*C,a[1]=d*C-u*T,a[2]=u*v-d*g,a[3]=v*b-m*T,a[4]=s*T-d*b,a[5]=d*m-s*v,a[6]=m*C-g*b,a[7]=u*b-s*C,a[8]=s*g-u*m,a}function De(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],C=e[6],T=e[7],I=e[8],D=s[0],P=s[1],R=s[2],z=s[3],H=s[4],$=s[5],Z=s[6],Y=s[7],te=s[8];return a[0]=D*u+P*g+R*C,a[1]=D*d+P*v+R*T,a[2]=D*m+P*b+R*I,a[3]=z*u+H*g+$*C,a[4]=z*d+H*v+$*T,a[5]=z*m+H*b+$*I,a[6]=Z*u+Y*g+te*C,a[7]=Z*d+Y*v+te*T,a[8]=Z*m+Y*b+te*I,a}function Qe(){var a=new O(16);return O!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function Fe(a){var e=new O(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function gt(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function jt(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],C=e[7],T=e[8],I=e[9],D=e[10],P=e[11],R=e[12],z=e[13],H=e[14],$=e[15],Z=s*v-u*g,Y=s*b-d*g,te=s*C-m*g,he=u*b-d*v,ae=u*C-m*v,me=d*C-m*b,ye=T*z-I*R,we=T*H-D*R,je=T*$-P*R,Te=I*H-D*z,qe=I*$-P*z,Ye=D*$-P*H,Ke=Z*Ye-Y*qe+te*Te+he*je-ae*we+me*ye;return Ke?(a[0]=(v*Ye-b*qe+C*Te)*(Ke=1/Ke),a[1]=(d*qe-u*Ye-m*Te)*Ke,a[2]=(z*me-H*ae+$*he)*Ke,a[3]=(D*ae-I*me-P*he)*Ke,a[4]=(b*je-g*Ye-C*we)*Ke,a[5]=(s*Ye-d*je+m*we)*Ke,a[6]=(H*te-R*me-$*Y)*Ke,a[7]=(T*me-D*te+P*Y)*Ke,a[8]=(g*qe-v*je+C*ye)*Ke,a[9]=(u*je-s*qe-m*ye)*Ke,a[10]=(R*ae-z*te+$*Z)*Ke,a[11]=(I*te-T*ae-P*Z)*Ke,a[12]=(v*we-g*Te-b*ye)*Ke,a[13]=(s*Te-u*we+d*ye)*Ke,a[14]=(z*Y-R*he-H*Z)*Ke,a[15]=(T*he-I*Y+D*Z)*Ke,a):null}function Ot(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],C=e[6],T=e[7],I=e[8],D=e[9],P=e[10],R=e[11],z=e[12],H=e[13],$=e[14],Z=e[15],Y=s[0],te=s[1],he=s[2],ae=s[3];return a[0]=Y*u+te*v+he*I+ae*z,a[1]=Y*d+te*b+he*D+ae*H,a[2]=Y*m+te*C+he*P+ae*$,a[3]=Y*g+te*T+he*R+ae*Z,a[4]=(Y=s[4])*u+(te=s[5])*v+(he=s[6])*I+(ae=s[7])*z,a[5]=Y*d+te*b+he*D+ae*H,a[6]=Y*m+te*C+he*P+ae*$,a[7]=Y*g+te*T+he*R+ae*Z,a[8]=(Y=s[8])*u+(te=s[9])*v+(he=s[10])*I+(ae=s[11])*z,a[9]=Y*d+te*b+he*D+ae*H,a[10]=Y*m+te*C+he*P+ae*$,a[11]=Y*g+te*T+he*R+ae*Z,a[12]=(Y=s[12])*u+(te=s[13])*v+(he=s[14])*I+(ae=s[15])*z,a[13]=Y*d+te*b+he*D+ae*H,a[14]=Y*m+te*C+he*P+ae*$,a[15]=Y*g+te*T+he*R+ae*Z,a}function Kt(a,e,s){var u,d,m,g,v,b,C,T,I,D,P,R,z=s[0],H=s[1],$=s[2];return e===a?(a[12]=e[0]*z+e[4]*H+e[8]*$+e[12],a[13]=e[1]*z+e[5]*H+e[9]*$+e[13],a[14]=e[2]*z+e[6]*H+e[10]*$+e[14],a[15]=e[3]*z+e[7]*H+e[11]*$+e[15]):(d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],C=e[6],T=e[7],I=e[8],D=e[9],P=e[10],R=e[11],a[0]=u=e[0],a[1]=d,a[2]=m,a[3]=g,a[4]=v,a[5]=b,a[6]=C,a[7]=T,a[8]=I,a[9]=D,a[10]=P,a[11]=R,a[12]=u*z+v*H+I*$+e[12],a[13]=d*z+b*H+D*$+e[13],a[14]=m*z+C*H+P*$+e[14],a[15]=g*z+T*H+R*$+e[15]),a}function Hn(a,e,s){var u=s[0],d=s[1],m=s[2];return a[0]=e[0]*u,a[1]=e[1]*u,a[2]=e[2]*u,a[3]=e[3]*u,a[4]=e[4]*d,a[5]=e[5]*d,a[6]=e[6]*d,a[7]=e[7]*d,a[8]=e[8]*m,a[9]=e[9]*m,a[10]=e[10]*m,a[11]=e[11]*m,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function Er(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[4],g=e[5],v=e[6],b=e[7],C=e[8],T=e[9],I=e[10],D=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=m*d+C*u,a[5]=g*d+T*u,a[6]=v*d+I*u,a[7]=b*d+D*u,a[8]=C*d-m*u,a[9]=T*d-g*u,a[10]=I*d-v*u,a[11]=D*d-b*u,a}function _r(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[0],g=e[1],v=e[2],b=e[3],C=e[8],T=e[9],I=e[10],D=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=m*d-C*u,a[1]=g*d-T*u,a[2]=v*d-I*u,a[3]=b*d-D*u,a[8]=m*u+C*d,a[9]=g*u+T*d,a[10]=v*u+I*d,a[11]=b*u+D*d,a}function So(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[0],g=e[1],v=e[2],b=e[3],C=e[4],T=e[5],I=e[6],D=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=m*d+C*u,a[1]=g*d+T*u,a[2]=v*d+I*u,a[3]=b*d+D*u,a[4]=C*d-m*u,a[5]=T*d-g*u,a[6]=I*d-v*u,a[7]=D*d-b*u,a}function is(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function zl(a,e,s){var u,d,m,g=s[0],v=s[1],b=s[2],C=Math.sqrt(g*g+v*v+b*b);return C<E?null:(g*=C=1/C,v*=C,b*=C,u=Math.sin(e),d=Math.cos(e),a[0]=g*g*(m=1-d)+d,a[1]=v*g*m+b*u,a[2]=b*g*m-v*u,a[3]=0,a[4]=g*v*m-b*u,a[5]=v*v*m+d,a[6]=b*v*m+g*u,a[7]=0,a[8]=g*b*m+v*u,a[9]=v*b*m-g*u,a[10]=b*b*m+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Gh(a,e){var s=e[0],u=e[1],d=e[2],m=e[4],g=e[5],v=e[6],b=e[8],C=e[9],T=e[10];return a[0]=Math.sqrt(s*s+u*u+d*d),a[1]=Math.sqrt(m*m+g*g+v*v),a[2]=Math.sqrt(b*b+C*C+T*T),a}function qh(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s+s,v=u+u,b=d+d,C=s*g,T=u*g,I=u*v,D=d*g,P=d*v,R=d*b,z=m*g,H=m*v,$=m*b;return a[0]=1-I-R,a[1]=T+$,a[2]=D-H,a[3]=0,a[4]=T-$,a[5]=1-C-R,a[6]=P+z,a[7]=0,a[8]=D+H,a[9]=P-z,a[10]=1-C-I,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Wh=Ot;function gi(){var a=new O(3);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ff(a){var e=new O(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function ho(a){var e=a[0],s=a[1],u=a[2];return Math.sqrt(e*e+s*s+u*u)}function vr(a,e,s){var u=new O(3);return u[0]=a,u[1]=e,u[2]=s,u}function Yi(a,e,s,u){return a[0]=e,a[1]=s,a[2]=u,a}function jr(a,e,s){return a[0]=e[0]+s[0],a[1]=e[1]+s[1],a[2]=e[2]+s[2],a}function il(a,e,s){return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a[2]=e[2]-s[2],a}function Pa(a,e,s){return a[0]=e[0]*s[0],a[1]=e[1]*s[1],a[2]=e[2]*s[2],a}function rl(a,e,s){return a[0]=Math.min(e[0],s[0]),a[1]=Math.min(e[1],s[1]),a[2]=Math.min(e[2],s[2]),a}function Oa(a,e,s){return a[0]=Math.max(e[0],s[0]),a[1]=Math.max(e[1],s[1]),a[2]=Math.max(e[2],s[2]),a}function ur(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a[2]=e[2]*s,a}function $s(a,e,s,u){return a[0]=e[0]+s[0]*u,a[1]=e[1]+s[1]*u,a[2]=e[2]+s[2]*u,a}function Lf(a,e){var s=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return Math.sqrt(s*s+u*u+d*d)}function Zh(a,e){var s=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return s*s+u*u+d*d}function Nf(a){var e=a[0],s=a[1],u=a[2];return e*e+s*s+u*u}function Dc(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function ji(a,e){var s=e[0],u=e[1],d=e[2],m=s*s+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),a[0]=e[0]*m,a[1]=e[1]*m,a[2]=e[2]*m,a}function Sr(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function Fo(a,e,s){var u=e[0],d=e[1],m=e[2],g=s[0],v=s[1],b=s[2];return a[0]=d*b-m*v,a[1]=m*g-u*b,a[2]=u*v-d*g,a}function Au(a,e,s,u){var d=e[0],m=e[1],g=e[2];return a[0]=d+u*(s[0]-d),a[1]=m+u*(s[1]-m),a[2]=g+u*(s[2]-g),a}function Pr(a,e,s){var u=e[0],d=e[1],m=e[2],g=s[3]*u+s[7]*d+s[11]*m+s[15];return a[0]=(s[0]*u+s[4]*d+s[8]*m+s[12])/(g=g||1),a[1]=(s[1]*u+s[5]*d+s[9]*m+s[13])/g,a[2]=(s[2]*u+s[6]*d+s[10]*m+s[14])/g,a}function Ac(a,e,s){var u=e[0],d=e[1],m=e[2];return a[0]=u*s[0]+d*s[3]+m*s[6],a[1]=u*s[1]+d*s[4]+m*s[7],a[2]=u*s[2]+d*s[5]+m*s[8],a}function Pc(a,e,s){var u=s[0],d=s[1],m=s[2],g=s[3],v=e[0],b=e[1],C=e[2],T=d*C-m*b,I=m*v-u*C,D=u*b-d*v;return a[0]=v+g*(T+=T)+d*(D+=D)-m*(I+=I),a[1]=b+g*I+m*T-u*D,a[2]=C+g*D+u*I-d*T,a}function Os(a){return a[0]=0,a[1]=0,a[2]=0,a}function Wo(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var kr=il,W_=Pa,Pd=ho;function Pu(){var a=new O(4);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function Oc(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a[2]=e[2]*s,a[3]=e[3]*s,a}function Rc(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s*s+u*u+d*d+m*m;return g>0&&(g=1/Math.sqrt(g)),a[0]=s*g,a[1]=u*g,a[2]=d*g,a[3]=m*g,a}function Lo(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3];return a[0]=s[0]*u+s[4]*d+s[8]*m+s[12]*g,a[1]=s[1]*u+s[5]*d+s[9]*m+s[13]*g,a[2]=s[2]*u+s[6]*d+s[10]*m+s[14]*g,a[3]=s[3]*u+s[7]*d+s[11]*m+s[15]*g,a}function Bl(){var a=new O(4);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Od(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Ra(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+g*v,a[1]=d*b+m*v,a[2]=m*b-d*v,a[3]=g*b-u*v,a}function Vl(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b-m*v,a[1]=d*b+g*v,a[2]=m*b+u*v,a[3]=g*b-d*v,a}gi(),Pu();var rs,Ou,Ru,ku=Rc,Rd=(rs=gi(),Ou=vr(1,0,0),Ru=vr(0,1,0),function(a,e,s){var u=Sr(e,s);return u<-.999999?(Fo(rs,Ou,e),Pd(rs)<1e-6&&Fo(rs,Ru,e),ji(rs,rs),(function(d,m,g){g*=.5;var v=Math.sin(g);d[0]=v*m[0],d[1]=v*m[1],d[2]=v*m[2],d[3]=Math.cos(g)})(a,rs,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Fo(rs,e,s),a[0]=rs[0],a[1]=rs[1],a[2]=rs[2],a[3]=1+u,ku(a,a))});function po(){var a=new O(2);return O!=Float32Array&&(a[0]=0,a[1]=0),a}function vs(a,e){var s=new O(2);return s[0]=a,s[1]=e,s}function Xh(a,e,s){return a[0]=e,a[1]=s,a}function kc(a,e,s){return a[0]=e[0]+s[0],a[1]=e[1]+s[1],a}function ol(a,e,s){return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a}function Ul(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a}function ka(a){var e=a[0],s=a[1];return Math.sqrt(e*e+s*s)}function Yh(a,e){var s=e[0],u=e[1],d=s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),a[0]=e[0]*d,a[1]=e[1]*d,a}function Fu(a,e){return a[0]*e[0]+a[1]*e[1]}Bl(),Bl(),K();var rr,vo,zf=ol;function Lu(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}po();var Fa=(function(){if(vo)return rr;function a(e,s,u,d){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=u,this.p2y=d}return vo=1,rr=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,d=0;d<8;d++){var m=this.sampleCurveX(u)-e;if(Math.abs(m)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=m/g}var v=0,b=1;for(u=e,d=0;d<20&&(m=this.sampleCurveX(u),!(Math.abs(m-e)<s));d++)e>m?v=u:b=u,u=.5*(b-v)+v;return u},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},rr})(),Bf=Lu(Fa);function it(a,e){this.x=a,this.y=e}function jl(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(!jl(a[s],e[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(let s in a)if(!jl(a[s],e[s]))return!1;return!0}return a===e}it.prototype={clone(){return new it(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,e){return this.clone()._rotateAround(a,e)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){let e=a.x-this.x,s=a.y-this.y;return e*e+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,e){return Math.atan2(this.x*e-this.y*a,this.x*a+this.y*e)},_matMult(a){let e=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=e,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){let a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){let e=Math.cos(a),s=Math.sin(a),u=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=u,this},_rotateAround(a,e){let s=Math.cos(a),u=Math.sin(a),d=e.y+u*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-u*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:it},it.convert=function(a){if(a instanceof it)return a;if(Array.isArray(a))return new it(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new it(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};let Z_=Math.PI/180,Nu=180/Math.PI;function Zn(a){return a*Z_}function Zo(a){return a*Nu}let X_=[[0,0],[1,0],[1,1],[0,1]];function zu(a){if(a<=0)return 0;if(a>=1)return 1;let e=a*a,s=e*a;return 4*(a<.5?s:3*(a-e)+s-.75)}function Kh(a,e,s,u){let d=new Bf(a,e,s,u);return function(m){return d.solve(m)}}let Ae=Kh(.25,.1,.25,1);function G(a,e,s){return Math.min(s,Math.max(e,a))}function X(a,e,s){return(s=G((s-a)/(e-a),0,1))*s*(3-2*s)}function oe(a,e,s){let u=s-e,d=((a-e)%u+u)%u+e;return d===e?s:d}function xe(a,e,s){if(!a.length)return s(null,[]);let u=a.length,d=new Array(a.length),m=null;a.forEach((g,v)=>{e(g,(b,C)=>{b&&(m=b),d[v]=C,--u==0&&s(m,d)})})}let ve=1;function Ee(){return ve++}function ze(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Ie(a,e){a.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function Ne(a,e,s){let u={};for(let d in a)u[d]=e.call(this,a[d],d,a);return u}function at(a,e,s){let u={};for(let d in a)e.call(this,a[d],d,a)&&(u[d]=a[d]);return u}function Xe(a){return Array.isArray(a)?a.map(Xe):typeof a=="object"&&a?Ne(a,Xe):a}function Rt(a,e){for(let s=0;s<a.length;s++)if(e.indexOf(a[s])>=0)return!0;return!1}let Qt={};function Dt(a){Qt[a]||(typeof console<"u"&&console.warn(a),Qt[a]=!0)}function xn(a,e,s){return(s.y-a.y)*(e.x-a.x)>(e.y-a.y)*(s.x-a.x)}function vn(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}function gn([a,e,s]){let u=Zn(e+90),d=Zn(s);return{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d),azimuthal:e,polar:s}}function Vn(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function dr(a){let e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,m)=>{let g=d||m;return e[u]=!g||g.toLowerCase(),""}),e["max-age"]){let s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Fr=null;function yr(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function $r(a,e,s,u){for(;e<s;){let d=e+s>>1;a[d]<u?e=d+1:s=d}return e}function or(a,e,s,u){for(;e<s;){let d=e+s>>1;a[d]<=u?e=d+1:s=d}return e}function Gn(a){return a>0?1/(1.001-a):1+a}function sr(a){return a>0?1-1/(1.001-a):-a}function Mi(a,e,s){return(a-e.min)*(s.max-s.min)/(e.max-e.min)+s.min}let kn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!kn.API_URL)return null;try{let a=new URL(kn.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function xr(a){return kn.API_URL_REGEX.test(a)}function To(a){return kn.API_SPRITE_REGEX.test(a)}let No,ys,Bu,fo,Hs,Xo;function sl(){return No==null&&(No=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),No}let oo={now:()=>fo!==void 0?fo:performance.now(),setNow(a){fo=a},restoreNow(){fo=void 0},frame(a){let e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){let{width:s,height:u}=a;Hs||(Hs=document.createElement("canvas"));let d=Hs.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(s>Hs.width||u>Hs.height)&&(Hs.width=s,Hs.height=u),d.clearRect(-e,-e,s+2*e,u+2*e),d.drawImage(a,0,0,s,u),d.getImageData(-e,-e,s+2*e,u+2*e)},resolveURL:a=>(ys||(ys=document.createElement("a")),ys.href=a,ys.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Bu==null&&(Bu=window.matchMedia("(prefers-reduced-motion: reduce)")),Bu.matches)},hasCanvasFingerprintNoise(){if(Xo!==void 0)return Xo;if(!sl())return Xo=!1,!1;let a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0}),s=0;for(let d=0;d<a.width;++d)e.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,e.fillRect(d,0,1,1);let u=e.getImageData(0,0,a.width,a.height);s=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&s++!==u.data[d])return Xo=!0,!0;return Xo=!1,!1}};function Vu(a,e){let s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(e).toString()}`;let u=new URLSearchParams(a.slice(s));for(let d in e)u.set(d,e[d]);return`${a.slice(0,s)}?${u.toString()}`}function kd(a,e={persistentParams:[]}){let s=a.indexOf("?");if(s<0)return a;let u=new URLSearchParams,d=new URLSearchParams(a.slice(s));for(let g of e.persistentParams){let v=d.get(g);v&&u.set(g,v)}let m=u.toString();return`${a.slice(0,s)}${m.length>0?`?${m}`:""}`}let Vf="mapbox-tiles",Uf=500,jf=50,Qh=["language","worldview","jobid"],al,xs;function La(){try{return caches}catch{}}function Na(){let a=La();a&&al==null&&(al=a.open(Vf))}let da=1/0,ll={supported:!1,testSupport:function(a){!$f&&Uu&&(ju?zx(a):Fc=a)}},Fc,Uu,$f=!1,ju=!1,Hf=typeof self<"u"?self:{};function zx(a){let e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Uu),a.isContextLost())return;ll.supported=!0}catch{}a.deleteTexture(e),$f=!0}Hf.document&&(Uu=Hf.document.createElement("img"),Uu.onload=function(){Fc&&zx(Fc),Fc=null,ju=!0},Uu.onerror=function(){$f=!0,Fc=null},Uu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Jh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Jh);class Rs extends Error{constructor(e,s,u){s===401&&xr(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Gf=Vn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$u=function(a,e){if(!(/^file:/.test(s=a.url)||/^file:/.test(Gf())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,d){let m=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Gf(),referrerPolicy:u.referrerPolicy,signal:m.signal}),v=!1,b=!1,C=(T=g.url).indexOf("sku=")>0&&xr(T);var T;u.type==="json"&&g.headers.set("Accept","application/json");let I=(P,R,z)=>{if(b)return;if(P&&P.message!=="SecurityError"&&Dt(P.toString()),R&&z)return D(R);let H=Date.now();fetch(g).then($=>{if($.ok){let Z=C?$.clone():null;return D($,Z,H)}return d(new Rs($.statusText,$.status,u.url))}).catch($=>{$.name!=="AbortError"&&d(new Error(`${$.message} ${u.url}`))})},D=(P,R,z)=>{(u.type==="arrayBuffer"?P.arrayBuffer():u.type==="json"?P.json():P.text()).then(H=>{b||(R&&z&&(function($,Z,Y){if(Na(),al==null)return;let te=dr(Z.headers.get("Cache-Control")||"");if(te["no-store"])return;let he={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((ye,we)=>he.headers.set(we,ye)),te["max-age"]&&he.headers.set("Expires",new Date(Y+1e3*te["max-age"]).toUTCString());let ae=he.headers.get("Expires");if(!ae||new Date(ae).getTime()-Y<42e4)return;let me=kd($.url,{persistentParams:Qh});if(Z.status===206){let ye=$.headers.get("Range");if(!ye)return;he.status=200,me=Vu(me,{range:ye})}(function(ye,we){if(xs===void 0)try{new Response(new ReadableStream),xs=!0}catch{xs=!1}xs?we(ye.body):ye.blob().then(we).catch(je=>Dt(je.message))})(Z,ye=>{let we=new Response((je=Z.status)!==200&&je!==404&&[101,103,204,205,304].includes(je)?null:ye,he);var je;Na(),al?.then(Te=>Te.put(me,we)).catch(Te=>Dt(Te.message))})})(g,R,z),v=!0,d(null,H,P.headers))}).catch(H=>{b||d(new Error(H.message))})};return C?(function(P,R){if(Na(),al==null)return R(null);al.then(z=>{let H=kd(P.url,{persistentParams:Qh}),$=P.headers.get("Range");$&&(H=Vu(H,{range:$})),z.match(H).then(Z=>{let Y=(function(te){if(!te)return!1;let he=new Date(te.headers.get("Expires")||0),ae=dr(te.headers.get("Cache-Control")||"");return Number(he)>Date.now()&&!ae["no-cache"]})(Z);z.delete(H).catch(R),Y&&z.put(H,Z.clone()).catch(R),R(null,Z,Y)}).catch(R)}).catch(R)})(g,I):I(null,null),{cancel:()=>{b=!0,v||m.abort()}}})(a,e);if(Vn(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var s;return(function(u,d){let m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(b){return d(b)}let v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{let C=b.split(": "),T=C.shift(),I=C.join(": ");v.append(T,I)}),d(null,g,v)}else d(new Rs(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}})(a,e)},$l=function(a,e){return $u(Object.assign(a,{type:"arrayBuffer"}),e)};function HS(a){let e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}let Bx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ep,qn;ep=[],qn=0;let qf=function(a,e){if(ll.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),qn>=kn.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ep.push(m),m}qn++;let s=!1,u=()=>{if(!s)for(s=!0,qn--;ep.length&&qn<kn.MAX_PARALLEL_IMAGE_REQUESTS;){let m=ep.shift(),{requestParameters:g,callback:v,cancelled:b}=m;b||(m.cancel=qf(g,v).cancel)}},d=$l(a,(m,g,v)=>{u(),m?e(m):g&&(self.createImageBitmap?(function(b,C){let T=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(T).then(I=>{C(null,I)}).catch(I=>{C(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(g,(b,C)=>e(b,C,v)):(function(b,C){let T=new Image;T.onload=()=>{C(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Bx})},T.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let I=new Blob([new Uint8Array(b)],{type:"image/png"});T.src=b.byteLength?URL.createObjectURL(I):Bx})(g,(b,C)=>e(b,C,v)))});return{cancel:()=>{d.cancel(),u()}}};var Y_,Vx,Ux,Lc={exports:{}},tp={exports:{}},np={exports:{}},K_=(function(){if(Ux)return Lc.exports;Ux=1;var a=(Y_||(Y_=1,tp.exports=function(s,u){var d,m,g,v,b,C,T,I;for(m=s.length-(d=3&s.length),g=u,b=3432918353,C=461845907,I=0;I<m;)T=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,d){case 3:T^=(255&s.charCodeAt(I+2))<<16;case 2:T^=(255&s.charCodeAt(I+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&s.charCodeAt(I)))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),tp.exports),e=(Vx||(Vx=1,np.exports=function(s,u){for(var d,m=s.length,g=u^m,v=0;m>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),np.exports);return Lc.exports=a,Lc.exports.murmur3=a,Lc.exports.murmur2=e,Lc.exports})(),Wf=Lu(K_);class cl{constructor(e,...s){Object.assign(this,s[0]||{}),this.type=e}}class ip extends cl{constructor(e,s={}){super("error",Object.assign({error:e},s))}}function Q_(a,e,s){s[a]&&s[a].indexOf(e)!==-1||(s[a]=s[a]||[],s[a].push(e))}function Nc(a,e,s){if(s&&s[a]){let u=s[a].indexOf(e);u!==-1&&s[a].splice(u,1)}}class Hu{on(e,s){return this._listeners=this._listeners||{},Q_(e,s,this._listeners),this}off(e,s){return Nc(e,s,this._listeners),Nc(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Q_(e,s,this._oneTimeListeners),this):new Promise(u=>{this.once(e,u)})}fire(e,s){let u=typeof e=="string"?new cl(e,s):e,d=u.type;if(this.listens(d)){u.target=this;let m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(let b of m)b.call(this,u);let g=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(let b of g)Nc(d,b,this._oneTimeListeners),b.call(this,u);let v=this._eventedParent;if(v){let b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,b),v.fire(u)}}else u instanceof ip&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}class Yo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Yo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){let[s,u]=e.split("");return new Yo({name:s,iconsetId:u})}static isEqual(e,s){return e.name===s.name&&e.iconsetId===s.iconsetId}toString(){return Yo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Zf,rp={},ha=(function(){if(Zf)return rp;Zf=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function s(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function d(m,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(g-m)*v*6:2*v<1?g:3*v<2?m+(g-m)*(2/3-v)*6:m}try{rp.parseCSSColor=function(m){var g,v=m.replace(/ /g,"").toLowerCase();if(v in a)return a[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var b=v.indexOf("("),C=v.indexOf(")");if(b!==-1&&C+1===v.length){var T=v.substr(0,b),I=v.substr(b+1,C-(b+1)).split(","),D=1;switch(T){case"rgba":if(I.length!==4)return null;D=u(I.pop());case"rgb":return I.length!==3?null:[s(I[0]),s(I[1]),s(I[2]),D];case"hsla":if(I.length!==4)return null;D=u(I.pop());case"hsl":if(I.length!==3)return null;var P=(parseFloat(I[0])%360+360)%360/360,R=u(I[1]),z=u(I[2]),H=z<=.5?z*(R+1):z+R-z*R,$=2*z-H;return[e(255*d($,H,P+1/3)),e(255*d($,H,P)),e(255*d($,H,P-1/3)),D];default:return null}}return null}}catch{}return rp})();class ci{constructor(e,s,u,d=1){this.r=e,this.g=s,this.b=u,this.a=d}static parse(e){if(!e)return;if(e instanceof ci)return e;if(typeof e!="string")return;let s=ha.parseCSSColor(e);return s?new ci(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){let[e,s,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(e){let{r:s,g:u,b:d,a:m}=this;return new $x(e,s,u,d,m)}toPremultipliedRenderColor(e){let{r:s,g:u,b:d,a:m}=this;return new Hx(e,s*m,u*m,d*m,m)}clone(){return new ci(this.r,this.g,this.b,this.a)}}class jx{constructor(e,s,u,d,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){let v=e.image.height,b=v*v;this.premultiplied?(s=m===0?0:s/m*(v-1),u=m===0?0:u/m*(v-1),d=m===0?0:d/m*(v-1)):(s*=v-1,u*=v-1,d*=v-1);let C=Math.floor(s),T=Math.floor(u),I=Math.floor(d),D=Math.ceil(s),P=Math.ceil(u),R=Math.ceil(d),z=s-C,H=u-T,$=d-I,Z=e.image.data,Y=4*(C+T*b+I*v),te=4*(C+T*b+R*v),he=4*(C+P*b+I*v),ae=4*(C+P*b+R*v),me=4*(D+T*b+I*v),ye=4*(D+T*b+R*v),we=4*(D+P*b+I*v),je=4*(D+P*b+R*v);if(Y<0||je>=Z.length)throw new Error("out of range");this.r=on(on(on(Z[Y],Z[te],$),on(Z[he],Z[ae],$),H),on(on(Z[me],Z[ye],$),on(Z[we],Z[je],$),H),z)/255*(this.premultiplied?m:1),this.g=on(on(on(Z[Y+1],Z[te+1],$),on(Z[he+1],Z[ae+1],$),H),on(on(Z[me+1],Z[ye+1],$),on(Z[we+1],Z[je+1],$),H),z)/255*(this.premultiplied?m:1),this.b=on(on(on(Z[Y+2],Z[te+2],$),on(Z[he+2],Z[ae+2],$),H),on(on(Z[me+2],Z[ye+2],$),on(Z[we+2],Z[je+2],$),H),z)/255*(this.premultiplied?m:1),this.a=m}else this.r=s,this.g=u,this.b=d,this.a=m}toArray(){let{r:e,g:s,b:u,a:d}=this;return[255*e,255*s,255*u,d]}toHslaArray(){let{r:e,g:s,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];let R=1/d;e*=R,s*=R,u*=R}let m=Math.min(Math.max(e,0),1),g=Math.min(Math.max(s,0),1),v=Math.min(Math.max(u,0),1),b=Math.min(m,g,v),C=Math.max(m,g,v),T=C-b,I=.5*(b+C);if(T===0)return[0,0,100*I,d];let D=I>.5?T/(2-C-b):T/(C+b),P;switch(C){case m:P=60*((g-v)/T+(g<v?6:0));break;case g:P=60*((v-m)/T+2);break;default:P=60*((m-g)/T+4)}return[P,100*D,100*I,d]}toArray01(){let{r:e,g:s,b:u,a:d}=this;return[e,s,u,d]}toArray01Scaled(e){let{r:s,g:u,b:d}=this;return[s*e,u*e,d*e]}toArray01Linear(){let{r:e,g:s,b:u,a:d}=this;return[Math.pow(e,2.2),Math.pow(s,2.2),Math.pow(u,2.2),d]}}class $x extends jx{constructor(e,s,u,d,m){super(e,s,u,d,m,!1)}}class Hx extends jx{constructor(e,s,u,d,m){super(e,s,u,d,m,!0)}}function on(a,e,s){return a*(1-s)+e*s}function J_(a,e,s){return a.map((u,d)=>on(u,e[d],s))}ci.black=new ci(0,0,0,1),ci.white=new ci(1,1,1,1),ci.transparent=new ci(0,0,0,0),ci.red=new ci(1,0,0,1),ci.blue=new ci(0,0,1,1);var op=Object.freeze({__proto__:null,array:J_,color:function(a,e,s){return new ci(on(a.r,e.r,s),on(a.g,e.g,s),on(a.b,e.b,s),on(a.a,e.a,s))},number:on});class pa extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Fd{constructor(e,s=[]){this.parent=e,this.bindings={};for(let[u,d]of s)this.bindings[u]=d}concat(e){return new Fd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let za={kind:"null"},Wt={kind:"number"},Bn={kind:"string"},pi={kind:"boolean"},bs={kind:"color"},ul={kind:"object"},ai={kind:"value"},Xf={kind:"collator"},sp={kind:"formatted"},ap={kind:"resolvedImage"};function zo(a,e){return{kind:"array",itemType:a,N:e}}function Lr(a){if(a.kind==="array"){let e=Lr(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}let GS=[za,Wt,Bn,pi,bs,sp,ul,zo(ai),ap];function zc(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!zc(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(let s of GS)if(!zc(s,e))return null}}return`Expected ${Lr(a)} but found ${Lr(e)} instead.`}function ev(a,e){return e.some(s=>s.kind===a.kind)}function lp(a,e){return e.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function Yf(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&Yf(a.itemType,e.itemType):a.kind===e.kind}class tv{constructor(e,s,u){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kf{constructor(e,s,u,d,m){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=u,this.fontStack=d,this.textColor=m}}class os{constructor(e){this.sections=e}static fromString(e){return new os([new Kf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof os?e:os.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let s of this.sections){if(s.image){let d=s.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(s.text);let u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class Hl{constructor(e,s={}){this.id=Yo.from(e),this.params=s.params,this.sx=s.sx||1,this.sy=s.sy||1}toString(){return JSON.stringify(this)}static parse(e){let s,u,d,m;try{({id:s,params:u,sx:d,sy:m}=JSON.parse(e)||{})}catch{return null}return s?new Hl(s,{params:u,sx:d,sy:m}):null}scaleSelf(e,s=e){return this.sx*=e,this.sy*=s,this}}class ss{constructor(e,s,u,d,m=!1){this.primaryId=Yo.from(e),this.primaryOptions=s,u&&(this.secondaryId=Yo.from(u)),this.secondaryOptions=d,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Hl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Hl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ss.build({name:e}):e}static build(e,s,u,d){return!e||typeof e=="object"&&!("name"in e)?null:new ss(e,u,s,d)}}function Gu(a,e,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,e,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,e,s,u]:[a,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ld(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ci||a instanceof tv||a instanceof os||a instanceof ss)return!0;if(Array.isArray(a)){for(let e of a)if(!Ld(e))return!1;return!0}if(typeof a=="object"){for(let e in a)if(!Ld(a[e]))return!1;return!0}return!1}function so(a){if(a===null)return za;if(typeof a=="string")return Bn;if(typeof a=="boolean")return pi;if(typeof a=="number")return Wt;if(a instanceof ci)return bs;if(a instanceof tv)return Xf;if(a instanceof os)return sp;if(a instanceof ss)return ap;if(Array.isArray(a)){let e=a.length,s;for(let u of a){let d=so(u);if(s){if(s===d)continue;s=ai;break}s=d}return zo(s||ai,e)}return ul}function fa(a){let e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof os||a instanceof ss||a instanceof ci?a.toString():JSON.stringify(a)}class Gl{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ld(e[1]))return s.error("invalid value");let u=e[1],d=so(u),m=s.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Gl(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ci?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof os?this.value.serialize():this.value}}class Jr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let nv={string:Bn,number:Wt,boolean:pi,object:ul};class Ba{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u,d=1,m=e[0];if(m==="array"){let v,b;if(e.length>2){let C=e[1];if(typeof C!="string"||!(C in nv)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=nv[C],d++}else v=ai;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=e[2],d++}u=zo(v,b)}else u=nv[m];let g=[];for(;d<e.length;d++){let v=s.parse(e[d],d,ai);if(!v)return null;g.push(v)}return new Ba(u,g)}evaluate(e){for(let s=0;s<this.args.length;s++){let u=this.args[s].evaluate(e);if(!zc(this.type,so(u)))return u;if(s===this.args.length-1)throw new Jr(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Lr(so(u))} but was expected to be of type ${Lr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,s=[e.kind];if(e.kind==="array"){let u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);let d=e.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(u=>u.serialize()))}}class dl{constructor(e){this.type=sp,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u=e[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");let d=[],m=!1;for(let g=1;g<=e.length-1;++g){let v=e[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let b=null;if(v["font-scale"]&&(b=s.parseObjectValue(v["font-scale"],g,"font-scale",Wt),!b))return null;let C=null;if(v["text-font"]&&(C=s.parseObjectValue(v["text-font"],g,"text-font",zo(Bn)),!C))return null;let T=null;if(v["text-color"]&&(T=s.parseObjectValue(v["text-color"],g,"text-color",bs),!T))return null;let I=d[d.length-1];I.scale=b,I.font=C,I.textColor=T}else{let b=s.parse(e[g],g,ai);if(!b)return null;let C=b.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:b,scale:null,font:null,textColor:null})}}return new dl(d)}evaluate(e){return new os(this.sections.map(s=>{let u=s.content.evaluate(e);return Yf(so(u),ap)?new Kf("",u,null,null,null):new Kf(fa(u),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(let s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let s of this.sections){e.push(s.content.serialize());let u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),e.push(u)}return e}}class yn{constructor(e,s,u,d){this._imageWarnHistory={},this.type=ap,this.namePrimary=e,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,s){if(e.length<2)return s.error("Expected two or more arguments.");let u=1,d=[];function m(){if(u<e.length){let v=s.parse(e[u],u++,Bn);return v?(d.push({image:v,options:{}}),!0):(s.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<e.length){let b=e[u];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;let C=b.params,T=b.iconset,I=s.concat(u);if(!C&&!T)return u++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return I.error('Image options "params" should be an object'),!1;let D={},P=I.concat(void 0,"params");for(let R in C){if(!R)return P.error("Image parameter name should be non-empty"),!1;let z=P.concat(void 0,R).parse(C[R],void 0,bs,void 0,{typeAnnotation:"coerce"});if(!z)return!1;D[R]=z}d[d.length-1].options.params=D}if(T){if(typeof T!="object"||T.constructor!==Object)return I.error('Image options "iconset" should be an object'),!1;if(!T.id)return I.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=T}return u++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!g())return;return new yn(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,s){let u={};if(s){for(let d in s)if(s[d])try{u[d]=s[d].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){let s={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=ss.build(s,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){let m=d.getPrimary().id;if(d.available=e.availableImages.some(g=>Yo.isEqual(g,m)),d.available){let g=d.getSecondary()?d.getSecondary().id:null;g&&(d.available=e.availableImages.some(v=>Yo.isEqual(v,g)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(let s in this.paramsPrimary)this.paramsPrimary[s]&&e(this.paramsPrimary[s]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(let s in this.paramsSecondary)this.paramsSecondary[s]&&e(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(e,s){let u={};if(s&&(u.iconset={id:s}),e){u.params={};for(let d in e)e[d]&&(u.params[d]=e[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){let e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&e.push(s)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&e.push(s)}return e}}function Ht(a){return ln(a)?"string":Nd(a)?"number":Jf(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Qf(a)?"object":typeof a}function Qf(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function ln(a){return typeof a=="string"||a instanceof String}function Nd(a){return typeof a=="number"||a instanceof Number}function Jf(a){return typeof a=="boolean"||a instanceof Boolean}let an={"to-boolean":pi,"to-color":bs,"to-number":Wt,"to-string":Bn};class hl{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u=e[0],d=[],m=za;if(u==="to-array"){if(!Array.isArray(e[1]))return null;let g=e[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);m=zo(s.expectedType.itemType,g)}else{if(!(g>0&&Ld(e[1][0])))return null;m=zo(so(e[1][0]),g)}for(let v=0;v<g;v++){let b=e[1][v],C;if(Array.isArray(b))C=s.parse(b,void 0,m.itemType);else{let T=Ht(b);if(T!==m.itemType.kind)return s.error(`Expected ${m.itemType.kind} but found ${T}.`);C=s.registry.literal.parse(["literal",b===void 0?null:b],s)}if(!C)return null;d.push(C)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return s.error("Expected one argument.");m=an[u];for(let g=1;g<e.length;g++){let v=s.parse(e[g],g,ai);if(!v)return null;d.push(v)}}return new hl(m,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,u;for(let d of this.args){if(s=d.evaluate(e),u=null,s instanceof ci)return s;if(typeof s=="string"){let m=e.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Gu(s[0],s[1],s[2],s[3]),!u))return new ci(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Jr(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(let u of this.args){if(s=u.evaluate(e),s===null)return 0;let d=Number(s);if(!isNaN(d))return d}throw new Jr(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?os.fromString(fa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ss.build(fa(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(s=>s.evaluate(e)):fa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yn(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}let iv=["Unknown","Point","LineString","Polygon"];class em{constructor(e,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?iv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-e[0])+this.featureDistanceData.bearing[1]*(d*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=ci.parse(e)),s}getConfig(e){return this.options?this.options.get(e):null}}class as{constructor(e,s,u,d,m){this.name=e,this.type=s,this._evaluate=u,this.args=d,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let s=as.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){let u=e[0],d=as.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(d)?d[0]:d.type,g=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[],b=null,C=-1;for(let[T,I]of g){if(Array.isArray(T)&&T.length!==e.length-1)continue;v.push(T),C++,b=new hm(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);let D=[],P=!1;for(let R=1;R<e.length;R++){let z=e[R],H=Array.isArray(T)?T[R-1]:T.type,$=b.parse(z,1+D.length,H);if(!$){P=!0;break}D.push($)}if(!P)if(Array.isArray(T)&&T.length!==D.length)b.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){let z=Array.isArray(T)?T[R]:T.type,H=D[R];b.concat(R+1).checkSubtype(z,H.type)}if(b.errors.length===0)return new as(u,m,I,D,C)}}if(v.length===1)s.errors.push(...b.errors);else{let T=(v.length?v:g.map(([D])=>D)).map(tm).join(" | "),I=[];for(let D=1;D<e.length;D++){let P=s.parse(e[D],1+I.length);if(!P)return null;I.push(Lr(P.type))}s.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,s){as.definitions=s;for(let u in s)e[u]=as}}function tm(a){return Array.isArray(a)?`(${a.map(Lr).join(", ")})`:`(${Lr(a.type)}...)`}class mo{constructor(e,s,u){this.type=Xf,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");let u=e[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");let d=u["case-sensitive"]===void 0?s.parse(!1,1,pi):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",pi);if(!d)return null;let m=u["diacritic-sensitive"]===void 0?s.parse(!1,1,pi):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",pi);if(!m)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",Bn),!g)?null:new mo(d,m,g)}evaluate(e){return new tv(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function nm(a,e,s=0,u=a.length-1,d=rv){for(;u>s;){if(u-s>600){let b=u-s+1,C=e-s+1,T=Math.log(b),I=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*I*(b-I)/b)*(C-b/2<0?-1:1);nm(a,e,Math.max(s,Math.floor(e-C*I/b+D)),Math.min(u,Math.floor(e+(b-C)*I/b+D)),d)}let m=a[e],g=s,v=u;for(Va(a,s,e),d(a[u],m)>0&&Va(a,s,u);g<v;){for(Va(a,g,v),g++,v--;d(a[g],m)<0;)g++;for(;d(a[v],m)>0;)v--}d(a[s],m)===0?Va(a,s,v):(v++,Va(a,v,u)),v<=e&&(s=v+1),e<=v&&(u=v-1)}}function Va(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}function rv(a,e){return a<e?-1:a>e?1:0}function Bc(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}function ma(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function cp(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function qS(a,e,s){let u=a[0]-e[0],d=a[1]-e[1],m=a[0]-s[0],g=a[1]-s[1];return u*g-m*d==0&&u*m<=0&&d*g<=0}function zd(a,e,s=!1){let u=!1;for(let v=0,b=e.length;v<b;v++){let C=e[v];for(let T=0,I=C.length,D=I-1;T<I;D=T++){let P=C[D],R=C[T];if(qS(a,P,R))return s;(m=P)[1]>(d=a)[1]!=(g=R)[1]>d[1]&&d[0]<(g[0]-m[0])*(d[1]-m[1])/(g[1]-m[1])+m[0]&&(u=!u)}}var d,m,g;return u}function up(a,e,s,u){let d=u[0]-s[0],m=u[1]-s[1],g=(a[0]-s[0])*m-d*(a[1]-s[1]),v=(e[0]-s[0])*m-d*(e[1]-s[1]);return g>0&&v<0||g<0&&v>0}function dp(a,e,s,u){return(d=[u[0]-s[0],u[1]-s[1]])[0]*(m=[e[0]-a[0],e[1]-a[1]])[1]-d[1]*m[0]!=0&&!(!up(a,e,s,u)||!up(s,u,a,e));var d,m}function ql(a){let e=new it(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new it(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u of a[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:e,max:s}}let Vc=8192;function WS(a,e){let s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(s*d*Vc),Math.round(u*d*Vc)]}function ov(a,e){for(let s=0;s<e.length;s++)if(zd(a,e[s]))return!0;return!1}function ZS(a,e,s){for(let u of s)for(let d=0,m=u.length,g=m-1;d<m;g=d++)if(dp(a,e,u[g],u[d]))return!0;return!1}function Gx(a,e){for(let s=0;s<a.length;++s)if(!zd(a[s],e))return!1;for(let s=0;s<a.length-1;++s)if(ZS(a[s],a[s+1],e))return!1;return!0}function qx(a,e){for(let s=0;s<e.length;s++)if(Gx(a,e[s]))return!0;return!1}function sv(a,e,s){let u=[];for(let d=0;d<a.length;d++){let m=[];for(let g=0;g<a[d].length;g++){let v=WS(a[d][g],s);ma(e,v),m.push(v)}u.push(m)}return u}function Uc(a,e,s){let u=[];for(let d=0;d<a.length;d++){let m=sv(a[d],e,s);u.push(m)}return u}function Wx(a,e,s,u){if(a[0]<s[0]||a[0]>s[2]){let d=.5*u,m=a[0]-s[0]>d?-u:s[0]-a[0]>d?u:0;m===0&&(m=a[0]-s[2]>d?-u:s[2]-a[0]>d?u:0),a[0]+=m}ma(e,a)}function Zx(a,e,s,u){let d=Math.pow(2,u.z)*Vc,m=[u.x*Vc,u.y*Vc],g=[];if(!a)return g;for(let v of a)for(let b of v){let C=[b.x+m[0],b.y+m[1]];Wx(C,e,s,d),g.push(C)}return g}function im(a,e,s,u){let d=Math.pow(2,u.z)*Vc,m=[u.x*Vc,u.y*Vc],g=[];if(!a)return g;for(let b of a){let C=[];for(let T of b){let I=[T.x+m[0],T.y+m[1]];ma(e,I),C.push(I)}g.push(C)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of g)for(let C of b)Wx(C,e,s,d)}var v;return g}class jc{constructor(e,s){this.type=pi,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ld(e[1])){let u=e[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){let m=u.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new jc(u,u.features[d].geometry)}else if(u.type==="Feature"){let d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new jc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new jc(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(s,u){let d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=sv(u.coordinates,m,g),b=Zx(s.geometry(),d,m,g);if(!cp(d,m))return!1;for(let C of b)if(!zd(C,v))return!1}if(u.type==="MultiPolygon"){let v=Uc(u.coordinates,m,g),b=Zx(s.geometry(),d,m,g);if(!cp(d,m))return!1;for(let C of b)if(!ov(C,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(s,u){let d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=sv(u.coordinates,m,g),b=im(s.geometry(),d,m,g);if(!cp(d,m))return!1;for(let C of b)if(!Gx(C,v))return!1}if(u.type==="MultiPolygon"){let v=Uc(u.coordinates,m,g),b=im(s.geometry(),d,m,g);if(!cp(d,m))return!1;for(let C of b)if(!qx(C,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let hp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ga=1/298.257223563,Xx=ga*(2-ga),Bd=Math.PI/180;class Vd{static fromTile(e,s,u){let d=Math.PI*(1-2*(e+.5)/Math.pow(2,s)),m=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Bd;return new Vd(m,u)}static get units(){return hp}constructor(e,s){if(e===void 0)throw new Error("No latitude given.");if(s&&!hp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(hp).join(", ")}`);let u=6378.137*Bd*(s?hp[s]:1),d=Math.cos(e*Bd),m=1/(1-Xx*(1-d*d)),g=Math.sqrt(m);this.kx=u*g*d,this.ky=u*g*m*(1-Xx)}distance(e,s){let u=Gs(e[0]-s[0])*this.kx,d=(e[1]-s[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(e,s){let u=Gs(s[0]-e[0])*this.kx;return Math.atan2(u,(s[1]-e[1])*this.ky)/Bd}destination(e,s,u){let d=u*Bd;return this.offset(e,Math.sin(d)*s,Math.cos(d)*s)}offset(e,s,u){return[e[0]+s/this.kx,e[1]+u/this.ky]}lineDistance(e){let s=0;for(let u=0;u<e.length-1;u++)s+=this.distance(e[u],e[u+1]);return s}area(e){let s=0;for(let u=0;u<e.length;u++){let d=e[u];for(let m=0,g=d.length,v=g-1;m<g;v=m++)s+=Gs(d[m][0]-d[v][0])*(d[m][1]+d[v][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(e,s){let u=0;if(s<=0)return e[0];for(let d=0;d<e.length-1;d++){let m=e[d],g=e[d+1],v=this.distance(m,g);if(u+=v,u>s)return rm(m,g,(s-(u-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,s,u){let[d,m]=s,g=Gs(u[0]-d)*this.kx,v=(u[1]-m)*this.ky;if(g!==0||v!==0){let b=(Gs(e[0]-d)*this.kx*g+(e[1]-m)*this.ky*v)/(g*g+v*v);b>1?(d=u[0],m=u[1]):b>0&&(d+=g/this.kx*b,m+=v/this.ky*b)}return g=Gs(e[0]-d)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(g*g+v*v)}pointOnLine(e,s){let u=1/0,d=e[0][0],m=e[0][1],g=0,v=0;for(let b=0;b<e.length-1;b++){let C=e[b][0],T=e[b][1],I=Gs(e[b+1][0]-C)*this.kx,D=(e[b+1][1]-T)*this.ky,P=0;I===0&&D===0||(P=(Gs(s[0]-C)*this.kx*I+(s[1]-T)*this.ky*D)/(I*I+D*D),P>1?(C=e[b+1][0],T=e[b+1][1]):P>0&&(C+=I/this.kx*P,T+=D/this.ky*P)),I=Gs(s[0]-C)*this.kx,D=(s[1]-T)*this.ky;let R=I*I+D*D;R<u&&(u=R,d=C,m=T,g=b,v=P)}return{point:[d,m],index:g,t:Math.max(0,Math.min(1,v))}}lineSlice(e,s,u){let d=this.pointOnLine(u,e),m=this.pointOnLine(u,s);if(d.index>m.index||d.index===m.index&&d.t>m.t){let C=d;d=m,m=C}let g=[d.point],v=d.index+1,b=m.index;!av(u[v],g[0])&&v<=b&&g.push(u[v]);for(let C=v+1;C<=b;C++)g.push(u[C]);return av(u[b],m.point)||g.push(m.point),g}lineSliceAlong(e,s,u){let d=0,m=[];for(let g=0;g<u.length-1;g++){let v=u[g],b=u[g+1],C=this.distance(v,b);if(d+=C,d>e&&m.length===0&&m.push(rm(v,b,(e-(d-C))/C)),d>=s)return m.push(rm(v,b,(s-(d-C))/C)),m;d>e&&m.push(b)}return m}bufferPoint(e,s){let u=s/this.ky,d=s/this.kx;return[e[0]-d,e[1]-u,e[0]+d,e[1]+u]}bufferBBox(e,s){let u=s/this.ky,d=s/this.kx;return[e[0]-d,e[1]-u,e[2]+d,e[3]+u]}insideBBox(e,s){return Gs(e[0]-s[0])>=0&&Gs(e[0]-s[2])<=0&&e[1]>=s[1]&&e[1]<=s[3]}}function av(a,e){return a[0]===e[0]&&a[1]===e[1]}function rm(a,e,s){let u=Gs(e[0]-a[0]);return[a[0]+u*s,a[1]+(e[1]-a[1])*s]}function Gs(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class om{constructor(e=[],s=(u,d)=>u<d?-1:u>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:s,compare:u}=this,d=s[e];for(;e>0;){let m=e-1>>1,g=s[m];if(u(d,g)>=0)break;s[e]=g,e=m}s[e]=d}_down(e){let{data:s,compare:u}=this,d=this.length>>1,m=s[e];for(;e<d;){let g=1+(e<<1),v=g+1;if(v<this.length&&u(s[v],s[g])<0&&(g=v),u(s[g],m)>=0)break;s[e]=s[g],e=g}s[e]=m}}var _t=8192;function lv(a,e){return e.dist-a.dist}let sm=100,am=50;function cv(a){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==a[s])return!1;return!0}function pp(a){return a[1]-a[0]+1}function pl(a,e){let s=a[1]>=a[0]&&a[1]<e;return s||console.warn("Distance Expression: Index is out of range"),s}function uv(a,e){if(a[0]>a[1])return[null,null];let s=pp(a);if(e){if(s===2)return[a,null];let u=Math.floor(s/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(s===1)return[a,null];let u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function qu(a,e){let s=[1/0,1/0,-1/0,-1/0];if(!pl(e,a.length))return s;for(let u=e[0];u<=e[1];++u)ma(s,a[u]);return s}function Wu(a){let e=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let u=0;u<a[s].length;++u)ma(e,a[s][u]);return e}function $c(a,e,s){if(cv(a)||cv(e))return NaN;let u=0,d=0;return a[2]<e[0]&&(u=e[0]-a[2]),a[0]>e[2]&&(u=a[0]-e[2]),a[1]>e[3]&&(d=a[1]-e[3]),a[3]<e[1]&&(d=e[1]-a[3]),s.distance([0,0],[u,d])}function lm(a){return 360*a-180}function Yx(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function cm(a,e){let s=Math.pow(2,e.z),u=(a.y/_t+e.y)/s;return[lm((a.x/_t+e.x)/s),Yx(u)]}function XS(a,e){let s=[];for(let u=0;u<a.length;++u)s.push(cm(a[u],e));return s}function Kx(a,e,s){let u=s.pointOnLine(e,a).point;return s.distance(a,u)}function dv(a,e,s,u,d){let m=s.slice(u[0],u[1]+1),g=1/0;for(let v=e[0];v<=e[1];++v)if((g=Math.min(g,Kx(a[v],m,d)))===0)return 0;return g}function Hc(a,e,s,u,d){let m=Math.min(d.pointToSegmentDistance(a,s,u),d.pointToSegmentDistance(e,s,u)),g=Math.min(d.pointToSegmentDistance(s,a,e),d.pointToSegmentDistance(u,a,e));return Math.min(m,g)}function Un(a,e,s,u,d){if(!pl(e,a.length)||!pl(u,s.length))return NaN;let m=1/0;for(let g=e[0];g<e[1];++g)for(let v=u[0];v<u[1];++v){if(dp(a[g],a[g+1],s[v],s[v+1]))return 0;m=Math.min(m,Hc(a[g],a[g+1],s[v],s[v+1],d))}return m}function YS(a,e,s,u,d){if(!pl(e,a.length)||!pl(u,s.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let v=u[0];v<=u[1];++v)if((m=Math.min(m,d.distance(a[g],s[v])))===0)return m;return m}function KS(a,e,s){if(zd(a,e,!0))return 0;let u=1/0;for(let d of e){let m=d.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[m-1]&&(u=Math.min(u,s.pointToSegmentDistance(a,d[m-1],d[0])))===0||(u=Math.min(u,Kx(a,d,s)))===0)return u}return u}function QS(a,e,s,u){if(!pl(e,a.length))return NaN;for(let m=e[0];m<=e[1];++m)if(zd(a[m],s,!0))return 0;let d=1/0;for(let m=e[0];m<e[1];++m)for(let g of s)for(let v=0,b=g.length,C=b-1;v<b;C=v++){if(dp(a[m],a[m+1],g[C],g[v]))return 0;d=Math.min(d,Hc(a[m],a[m+1],g[C],g[v],u))}return d}function hv(a,e){for(let s of a)for(let u=0;u<=s.length-1;++u)if(zd(s[u],e,!0))return!0;return!1}function JS(a,e,s,u=1/0){let d=Wu(a),m=Wu(e);if(u!==1/0&&$c(d,m,s)>=u)return u;if(cp(d,m)){if(hv(a,e))return 0}else if(hv(e,a))return 0;let g=u;for(let v of a)for(let b=0,C=v.length,T=C-1;b<C;T=b++)for(let I of e)for(let D=0,P=I.length,R=P-1;D<P;R=D++){if(dp(v[T],v[b],I[R],I[D]))return 0;g=Math.min(g,Hc(v[T],v[b],I[R],I[D],s))}return g}function Ki(a,e,s,u,d,m,g){if(m===null||g===null)return;let v=$c(qu(u,m),qu(d,g),s);v<e&&a.push({dist:v,range1:m,range2:g})}function eT(a,e,s,u,d=1/0){let m=Math.min(u.distance(a[0],s[0][0]),d);if(m===0)return m;let g=new om([{dist:0,range1:[0,a.length-1],range2:[0,0]}],lv),v=e?am:sm,b=Wu(s);for(;g.length;){let C=g.pop();if(C.dist>=m)continue;let T=C.range1;if(pp(T)<=v){if(!pl(T,a.length))return NaN;if(e){let I=QS(a,T,s,u);if((m=Math.min(m,I))===0)return m}else for(let I=T[0];I<=T[1];++I){let D=KS(a[I],s,u);if((m=Math.min(m,D))===0)return m}}else{let I=uv(T,e);if(I[0]!==null){let D=$c(qu(a,I[0]),b,u);D<m&&g.push({dist:D,range1:I[0],range2:[0,0]})}if(I[1]!==null){let D=$c(qu(a,I[1]),b,u);D<m&&g.push({dist:D,range1:I[1],range2:[0,0]})}}}return m}function Qx(a,e,s,u,d,m=1/0){let g=Math.min(m,d.distance(a[0],s[0]));if(g===0)return g;let v=new om([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],lv),b=e?am:sm,C=u?am:sm;for(;v.length;){let T=v.pop();if(T.dist>=g)continue;let I=T.range1,D=T.range2;if(pp(I)<=b&&pp(D)<=C){if(!pl(I,a.length)||!pl(D,s.length))return NaN;if(e&&u?g=Math.min(g,Un(a,I,s,D,d)):e||u?e&&!u?g=Math.min(g,dv(s,D,a,I,d)):!e&&u&&(g=Math.min(g,dv(a,I,s,D,d))):g=Math.min(g,YS(a,I,s,D,d)),g===0)return g}else{let P=uv(I,e),R=uv(D,u);Ki(v,g,d,a,s,P[0],R[0]),Ki(v,g,d,a,s,P[0],R[1]),Ki(v,g,d,a,s,P[1],R[0]),Ki(v,g,d,a,s,P[1],R[1])}}return g}function pv(a,e,s,u,d=1/0){let m=d,g=qu(a,[0,a.length-1]);for(let v of s)if(!(m!==1/0&&$c(g,qu(v,[0,v.length-1]),u)>=m)&&(m=Math.min(m,Qx(a,e,v,!0,u,m)),m===0))return m;return m}function um(a,e,s,u,d=1/0){let m=d,g=qu(a,[0,a.length-1]);for(let v of s){if(m!==1/0&&$c(g,Wu(v),u)>=m)continue;let b=eT(a,e,v,u,m);if(isNaN(b))return b;if((m=Math.min(m,b))===0)return m}return m}function fv(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Zu{constructor(e,s){this.type=Wt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ld(e[1])){let u=e[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(fv(u.features[d].geometry.type))return new Zu(u,u.features[d].geometry)}else if(u.type==="Feature"){if(fv(u.geometry.type))return new Zu(u,u.geometry)}else if(fv(u.type))return new Zu(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let s=e.geometry(),u=e.canonicalID();if(s!=null&&u!=null){if(e.geometryType()==="Point")return(function(d,m,g){let v=[];for(let C of d)for(let T of C)v.push(cm(T,m));let b=new Vd(v[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Qx(v,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?pv(v,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?um(v,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null})(s,u,this.geometries);if(e.geometryType()==="LineString")return(function(d,m,g){let v=[];for(let C of d){let T=[];for(let I of C)T.push(cm(I,m));v.push(T)}let b=new Vd(v[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return pv(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let C=1/0;for(let T=0;T<g.coordinates.length;T++){let I=pv(g.coordinates[T],!0,v,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}if(g.type==="Polygon"||g.type==="MultiPolygon"){let C=1/0;for(let T=0;T<v.length;T++){let I=um(v[T],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}return null})(s,u,this.geometries);if(e.geometryType()==="Polygon")return(function(d,m,g){let v=[];for(let C of(function(T,I){let D=T.length;if(D<=1)return[T];let P=[],R,z;for(let H=0;H<D;H++){let $=Bc(T[H]);$!==0&&(T[H].area=Math.abs($),z===void 0&&(z=$<0),z===$<0?(R&&P.push(R),R=[T[H]]):R.push(T[H]))}return R&&P.push(R),P})(d)){let T=[];for(let I=0;I<C.length;++I)T.push(XS(C[I],m));v.push(T)}let b=new Vd(v[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return um(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let C=1/0;for(let T=0;T<g.coordinates.length;T++){let I=um(g.coordinates[T],!0,v,b,C);if(isNaN(I))return I;if((C=Math.min(C,I))===0)return C}return C}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(C,T,I){let D=1/0;for(let P of C)for(let R of T){let z=JS(P,R,I,D);if(isNaN(z))return z;if((D=Math.min(D,z))===0)return D}return D})(g.type==="Polygon"?[g.coordinates]:g.coordinates,v,b):null})(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ud(a){if(a instanceof as&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof jc||a instanceof Zu)return!1;if(a instanceof $d)return a.featureConstant;let e=!0;return a.eachChild(s=>{e&&!Ud(s)&&(e=!1)}),e}function fp(a){if(a instanceof as&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(s=>{e&&!fp(s)&&(e=!1)}),e}function jd(a,e){if(a instanceof as&&e.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!jd(u,e)&&(s=!1)}),s}function Jx(a,e,s){return[a,e,s].filter(Boolean).join("")}function mv(a,e){switch(a){case"string":return fa(e);case"number":return+e;case"boolean":return!!e;case"color":return ci.parse(e);case"formatted":return os.fromString(fa(e));case"resolvedImage":return ss.build(fa(e))}return e}function eb(a,e,s,u){return u!==void 0&&(a=u*Math.round(a/u)),e!==void 0&&a<e&&(a=e),s!==void 0&&a>s&&(a=s),a}class $d{constructor(e,s,u,d=!1){this.type=e,this.key=s,this.scope=u,this.featureConstant=d}static parse(e,s){let u=s.expectedType;if(u==null&&(u=ai),e.length<2||e.length>3)return s.error("Invalid number of arguments for 'config' expression.");let d=s.parse(e[1],1);if(!(d instanceof Gl))return s.error("Key name of 'config' expression must be a string literal.");let m,g=!0,v=fa(d.value);if(e.length>=3){let b=s.parse(e[2],2);if(!(b instanceof Gl))return s.error("Scope of 'config' expression must be a string literal.");m=fa(b.value)}if(s.options){let b=Jx(v,m,s._scope),C=s.options.get(b);C&&(g=Ud(C.value||C.default))}return new $d(u,v,m,g)}evaluate(e){let s=Jx(this.key,this.scope,e.scope),u=e.getConfig(s);if(!u)return null;let{type:d,value:m,values:g,minValue:v,maxValue:b,stepValue:C}=u,T=u.default.evaluate(e),I=T;if(m){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),I=m.evaluate(e),e.scope=D}return d&&(I=mv(d,I)),I===void 0||v===void 0&&b===void 0&&C===void 0||(typeof I=="number"?I=eb(I,v,b,C):Array.isArray(I)&&(I=I.map(D=>typeof D=="number"?eb(D,v,b,C):D))),m!==void 0&&I!==void 0&&g&&!g.includes(I)&&(I=T,d&&(I=mv(d,I))),(d&&d!==this.type||I!==void 0&&!Yf(so(I),this.type))&&(I=mv(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class dm{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");let u=e[1];return s.scope.has(u)?new dm(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class hm{constructor(e,s=[],u,d=new Fd,m=[],g,v,b){this.registry=e,this.path=s,this.key=s.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=d,this.errors=m,this.expectedType=u,this._scope=g,this.options=v,this.iconImageUseTheme=b}parse(e,s,u,d,m={}){return s||u?this.concat(s,null,u,d)._parse(e,m):this._parse(e,m)}parseObjectValue(e,s,u,d,m,g={}){return this.concat(s,u,d,m)._parse(e,g)}_parse(e,s){function u(d,m,g){return g==="assert"?new Ba(m,[d]):g==="coerce"?new hl(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){let g=this.expectedType,v=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else m=u(m,g,s.typeAnnotation||"coerce");else m=u(m,g,s.typeAnnotation||"assert")}if(!(m instanceof Gl)&&m.type.kind!=="resolvedImage"&&gv(m)){let g=new em(this._scope,this.options,this.iconImageUseTheme);try{m=new Gl(m.type,m.evaluate(g))}catch(v){return this.error(v.message),null}}return m}return hl.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,u,d){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof s=="string"?m.concat(s):m;let g=d?this.scope.concat(d):this.scope;return new hm(this.registry,m,u||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...s){let u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new pa(u,e))}checkSubtype(e,s){let u=zc(e,s);return u&&this.error(u),u}}function gv(a){if(a instanceof dm)return gv(a.boundExpression);if(a instanceof as&&a.name==="error"||a instanceof mo||a instanceof jc||a instanceof Zu||a instanceof $d)return!1;let e=a instanceof hl||a instanceof Ba,s=!0;return a.eachChild(u=>{s=e?s&&gv(u):s&&u instanceof Gl}),!!s&&Ud(a)&&jd(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function pm(a,e){let s=a.length-1,u,d,m=0,g=s,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),u=a[v],d=a[v+1],u<=e){if(v===s||e<d)return v;m=v+1}else{if(!(u>e))throw new Jr("Input is not a number.");g=v-1}return 0}class mp{constructor(e,s,u){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(let[d,m]of u)this.labels.push(d),this.outputs.push(m)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");let u=s.parse(e[1],1,Wt);if(!u)return null;let d=[],m=null;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(let g=1;g<e.length;g+=2){let v=g===1?-1/0:e[g],b=e[g+1],C=g,T=g+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(d.length&&d[d.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);let I=s.parse(b,T,m);if(!I)return null;m=m||I.type,d.push([v,I])}return new mp(m,u,d)}evaluate(e){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);let d=this.input.evaluate(e);if(d<=s[0])return u[0].evaluate(e);let m=s.length;return d>=s[m-1]?u[m-1].evaluate(e):u[pm(s,d)].evaluate(e)}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}let tb=.95047,nb=1.08883,ib=4/29,Hd=6/29,rb=3*Hd*Hd,tT=Hd*Hd*Hd,nT=Math.PI/180,iT=180/Math.PI;function _v(a){return a>tT?Math.pow(a,1/3):a/rb+ib}function vv(a){return a>Hd?a*a*a:rb*(a-ib)}function yv(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function xv(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ob(a){let e=xv(a.r),s=xv(a.g),u=xv(a.b),d=_v((.4124564*e+.3575761*s+.1804375*u)/tb),m=_v((.2126729*e+.7151522*s+.072175*u)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-_v((.0193339*e+.119192*s+.9503041*u)/nb)),alpha:a.a}}function fm(a){let e=(a.l+16)/116,s=isNaN(a.a)?e:e+a.a/500,u=isNaN(a.b)?e:e-a.b/200;return e=1*vv(e),s=tb*vv(s),u=nb*vv(u),new ci(yv(3.2404542*s-1.5371385*e-.4985314*u),yv(-.969266*s+1.8760108*e+.041556*u),yv(.0556434*s-.2040259*e+1.0572252*u),a.alpha)}function mm(a,e,s){let u=e-a;return a+s*(u>180||u<-180?u-360*Math.round(u/360):u)}let Gd={forward:ob,reverse:fm,interpolate:function(a,e,s){return{l:on(a.l,e.l,s),a:on(a.a,e.a,s),b:on(a.b,e.b,s),alpha:on(a.alpha,e.alpha,s)}}},gp={forward:function(a){let{l:e,a:s,b:u}=ob(a),d=Math.atan2(u,s)*iT;return{h:d<0?d+360:d,c:Math.sqrt(s*s+u*u),l:e,alpha:a.a}},reverse:function(a){let e=a.h*nT,s=a.c;return fm({l:a.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:a.alpha})},interpolate:function(a,e,s){return{h:mm(a.h,e.h,s),c:on(a.c,e.c,s),l:on(a.l,e.l,s),alpha:on(a.alpha,e.alpha,s)}}};var sb=Object.freeze({__proto__:null,hcl:gp,lab:Gd});class qs{constructor(e,s,u,d,m){this.type=e,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(let[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,s,u,d){let m=0;if(e.name==="exponential")m=gm(s,e.base,u,d);else if(e.name==="linear")m=gm(s,1,u,d);else if(e.name==="cubic-bezier"){let g=e.controlPoints;m=new Bf(g[0],g[1],g[2],g[3]).solve(gm(s,1,u,d))}return m}static parse(e,s){let[u,d,m,...g]=e;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){let C=d[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:C}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{let C=d.slice(1);if(C.length!==4||C.some(T=>typeof T!="number"||T<0||T>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,Wt),!m)return null;let v=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=bs:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let C=0;C<g.length;C+=2){let T=g[C],I=g[C+1],D=C+3,P=C+4;if(typeof T!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=T)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let R=s.parse(I,P,b);if(!R)return null;b=b||R.type,v.push([T,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new qs(b,u,d,m,v):s.error(`Type ${Lr(b)} is not interpolatable.`)}evaluate(e){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);let d=this.input.evaluate(e);if(d<=s[0])return u[0].evaluate(e);let m=s.length;if(d>=s[m-1])return u[m-1].evaluate(e);let g=pm(s,d),v=qs.interpolationFactor(this.interpolation,d,s[g],s[g+1]),b=u[g].evaluate(e),C=u[g+1].evaluate(e);return this.operator==="interpolate"?op[this.type.kind.toLowerCase()](b,C,v):this.operator==="interpolate-hcl"?gp.reverse(gp.interpolate(gp.forward(b),gp.forward(C),v)):Gd.reverse(Gd.interpolate(Gd.forward(b),Gd.forward(C),v))}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let s=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function gm(a,e,s,u){let d=u-s,m=a-s;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class _p{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let u=null,d=s.expectedType;d&&d.kind!=="value"&&(u=d);let m=[];for(let v of e.slice(1)){let b=s.parse(v,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,m.push(b)}let g=d&&m.some(v=>zc(d,v.type));return new _p(g?ai:u,m)}evaluate(e){let s,u=null,d=0;for(let m of this.args){if(d++,u=m.evaluate(e),u&&u instanceof ss&&!u.available&&(s||(s=u),u=null,d===this.args.length))return s;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Wl{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let u=[];for(let m=1;m<e.length-1;m+=2){let g=e[m];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);let v=s.parse(e[m+1],m+1);if(!v)return null;u.push([g,v])}let d=s.parse(e[e.length-1],e.length-1,s.expectedType,u);return d?new Wl(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[s,u]of this.bindings)e.push(s,u.serialize());return e.push(this.result.serialize()),e}}class _m{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Wt),d=s.parse(e[2],2,zo(s.expectedType||ai));return u&&d?new _m(d.type.itemType,u,d):null}evaluate(e){let s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new Jr("Array index out of bounds: negative index");if(s>=u.length)throw new Jr("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new Jr("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vm{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Wt),d=s.parse(e[2],2,zo(s.expectedType||ai));return u&&d?new vm(d.type.itemType,u,d):null}evaluate(e){let s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new Jr(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new Jr(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];let d=Math.floor(s),m=Math.ceil(s),g=u[d],v=u[m];if(typeof g!="number"||typeof v!="number")throw new Jr(`Cannot interpolate between non-number values at index ${s}.`);let b=s-d;return g*(1-b)+v*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class bv{constructor(e,s){this.type=pi,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,ai),d=s.parse(e[2],2,ai);return u&&d?ev(u.type,[pi,Bn,Wt,za,ai])?new bv(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(u.type)} instead`):null}evaluate(e){let s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!lp(s,["boolean","string","number","null"]))throw new Jr(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(so(s))} instead.`);if(!lp(u,["string","array"]))throw new Jr(`Expected second argument to be of type array or string, but found ${Lr(so(u))} instead.`);return u.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qd{constructor(e,s,u){this.type=Wt,this.needle=e,this.haystack=s,this.fromIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,ai),d=s.parse(e[2],2,ai);if(!u||!d)return null;if(!ev(u.type,[pi,Bn,Wt,za,ai]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(u.type)} instead`);if(e.length===4){let m=s.parse(e[3],3,Wt);return m?new qd(u,d,m):null}return new qd(u,d)}evaluate(e){let s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!lp(s,["boolean","string","number","null"]))throw new Jr(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(so(s))} instead.`);if(!lp(u,["string","array"]))throw new Jr(`Expected second argument to be of type array or string, but found ${Lr(so(u))} instead.`);if(this.fromIndex){let d=this.fromIndex.evaluate(e);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class vp{constructor(e,s,u,d,m,g){this.inputType=e,this.type=s,this.input=u,this.cases=d,this.outputs=m,this.otherwise=g}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);let m={},g=[];for(let C=2;C<e.length-1;C+=2){let T=e[C],I=e[C+1];Array.isArray(T)||(T=[T]);let D=s.concat(C);if(T.length===0)return D.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,so(R)))return null}else u=so(R);if(m[String(R)]!==void 0)return D.error("Branch labels must be unique.");m[String(R)]=g.length}let P=s.parse(I,C,d);if(!P)return null;d=d||P.type,g.push(P)}let v=s.parse(e[1],1,ai);if(!v)return null;let b=s.parse(e[e.length-1],e.length-1,d);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(u,v.type)?null:new vp(u,d,v,m,g,b):null}evaluate(e){let s=this.input.evaluate(e);return(Yf(so(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],d={};for(let g of s){let v=d[this.cases[g]];v===void 0?(d[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[v][1].push(g)}let m=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,v]of u)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class yp{constructor(e,s,u){this.type=e,this.branches=s,this.otherwise=u}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);let d=[];for(let g=1;g<e.length-1;g+=2){let v=s.parse(e[g],g,pi);if(!v)return null;let b=s.parse(e[g+1],g+1,u);if(!b)return null;d.push([v,b]),u=u||b.type}let m=s.parse(e[e.length-1],e.length-1,u);return m?new yp(u,d,m):null}evaluate(e){for(let[s,u]of this.branches)if(s.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[s,u]of this.branches)e(s),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class ym{constructor(e,s,u,d){this.type=e,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,ai),d=s.parse(e[2],2,Wt);if(!u||!d)return null;if(!ev(u.type,[zo(ai),Bn,ai]))return s.error(`Expected first argument to be of type array or string, but found ${Lr(u.type)} instead`);if(e.length===4){let m=s.parse(e[3],3,Wt);return m?new ym(u.type,u,d,m):null}return new ym(u.type,u,d)}evaluate(e){let s=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!lp(s,["string","array"]))throw new Jr(`Expected first argument to be of type array or string, but found ${Lr(so(s))} instead.`);if(this.endIndex){let d=this.endIndex.evaluate(e);return s.slice(u,d)}return s.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class wv{constructor(e,s){this.type=zo(Bn),this.str=e,this.delimiter=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Bn),d=s.parse(e[2],2,Bn);return u&&d?new wv(u,d):void 0}evaluate(e){let s=this.str.evaluate(e),u=this.delimiter.evaluate(e);return s.split(u)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Cv(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ev(a,e,s,u){return u.compare(e,s)===0}function Wd(a,e,s){let u=a!=="=="&&a!=="!=";return class h4{constructor(m,g,v){this.type=pi,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");let v=m[0],b=g.parse(m[1],1,ai);if(!b)return null;if(!Cv(v,b.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Lr(b.type)}'.`);let C=g.parse(m[2],2,ai);if(!C)return null;if(!Cv(v,C.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Lr(C.type)}'.`);if(b.type.kind!==C.type.kind&&b.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${Lr(b.type)}' and '${Lr(C.type)}'.`);u&&(b.type.kind==="value"&&C.type.kind!=="value"?b=new Ba(C.type,[b]):b.type.kind!=="value"&&C.type.kind==="value"&&(C=new Ba(b.type,[C])));let T=null;if(m.length===4){if(b.type.kind!=="string"&&C.type.kind!=="string"&&b.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(T=g.parse(m[3],3,Xf),!T)return null}return new h4(b,C,T)}evaluate(m){let g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){let b=so(g),C=so(v);if(b.kind!==C.kind||b.kind!=="string"&&b.kind!=="number")throw new Jr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${b.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=so(g),C=so(v);if(b.kind!=="string"||C.kind!=="string")return e(m,g,v)}return this.collator?s(m,g,v,this.collator.evaluate(m)):e(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[a];return this.eachChild(g=>{m.push(g.serialize())}),m}}}let rT=Wd("==",function(a,e,s){return e===s},Ev),oT=Wd("!=",function(a,e,s){return e!==s},function(a,e,s,u){return!Ev(0,e,s,u)}),ab=Wd("<",function(a,e,s){return e<s},function(a,e,s,u){return u.compare(e,s)<0}),lb=Wd(">",function(a,e,s){return e>s},function(a,e,s,u){return u.compare(e,s)>0}),xm=Wd("<=",function(a,e,s){return e<=s},function(a,e,s,u){return u.compare(e,s)<=0}),sT=Wd(">=",function(a,e,s){return e>=s},function(a,e,s,u){return u.compare(e,s)>=0});class bm{constructor(e,s,u,d,m,g){this.type=Bn,this.number=e,this.locale=s,this.currency=u,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");let u=s.parse(e[1],1,Wt);if(!u)return null;let d=e[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=s.parseObjectValue(d.locale,2,"locale",Bn),!m))return null;let g=null;if(d.currency&&(g=s.parseObjectValue(d.currency,2,"currency",Bn),!g))return null;let v=null;if(d.unit&&(v=s.parseObjectValue(d.unit,2,"unit",Bn),!v))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",Wt),!b))return null;let C=null;return d["max-fraction-digits"]&&(C=s.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",Wt),!C)?null:new bm(u,m,g,v,b,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Sv{constructor(e){this.type=Wt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);let u=s.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Lr(u.type)} instead.`):new Sv(u):null}evaluate(e){let s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Jr(`Expected value to be of type string or array, but found ${Lr(so(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}function cb(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Zd={"==":rT,"!=":oT,">":lb,"<":ab,">=":sT,"<=":xm,array:Ba,at:_m,"at-interpolated":vm,boolean:Ba,case:yp,coalesce:_p,collator:mo,format:dl,image:yn,in:bv,"index-of":qd,interpolate:qs,"interpolate-hcl":qs,"interpolate-lab":qs,length:Sv,let:Wl,literal:Gl,match:vp,number:Ba,"number-format":bm,object:Ba,slice:ym,step:mp,string:Ba,"to-boolean":hl,"to-color":hl,"to-number":hl,"to-string":hl,var:dm,within:jc,distance:Zu,config:$d,split:wv};function Tv(a,[e,s,u,d]){e=e.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);let m=d?d.evaluate(a):1,g=Gu(e,s,u,m);if(g)throw new Jr(g);return new ci(e/255,s/255,u/255,m)}function Iv(a,[e,s,u,d]){e=e.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);let m=d?d.evaluate(a):1,g=(function(C,T,I,D){return typeof C=="number"&&C>=0&&C<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[C,T,I,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[C,T,I,D]:[C,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[C,T,I,D]:[C,T,I]).join(", ")}]: 'h' must be between 0 and 360.`})(e,s,u,m);if(g)throw new Jr(g);let v=`hsla(${e}, ${s}%, ${u}%, ${m})`,b=ci.parse(v);if(!b)throw new Jr(`Failed to parse HSLA color: ${v}`);return b}function ub(a,e){return a in e}function Mv(a,e){let s=e[a];return s===void 0?null:s}function Gc(a){return{type:a}}function Xu(a){if(a instanceof $d)return new Set([a.key]);let e=new Set;return a.eachChild(s=>{e=new Set([...e,...Xu(s)])}),e}function wm(a){if(a instanceof as&&a.name==="is-active-floor")return!0;let e=!1;return a.eachChild(s=>{!e&&wm(s)&&(e=!0)}),e}function db(a){return{result:"success",value:a}}function qc(a){return{result:"error",value:a}}function Dv(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function xp(a){return a["property-type"]==="data-driven"}function hb(a){return Dv(a.expression,"measure-light")}function pb(a){return Dv(a.expression,"zoom")}function Cm(a){return!!a.expression&&a.expression.interpolated}function Em(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function fb(a){return a}function mb(a,e){let s=e.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),m=a.type||(Cm(e)?"exponential":"interval");if(s&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(C=>[C[0],ci.parse(C[1])])),a.default=ci.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!sb[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,v,b;if(m==="exponential")g=gb;else if(m==="interval")g=lT;else if(m==="categorical"){g=aT,v=Object.create(null);for(let C of a.stops)v[C[0]]=C[1];b=typeof a.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=_b}if(u){let C={},T=[];for(let P=0;P<a.stops.length;P++){let R=a.stops[P],z=R[0].zoom;C[z]===void 0&&(C[z]={zoom:z,type:a.type,property:a.property,default:a.default,stops:[]},T.push(z)),C[z].stops.push([R[0].value,R[1]])}let I=[];for(let P of T)I.push([C[P].zoom,mb(C[P],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:qs.interpolationFactor.bind(void 0,D),zoomStops:I.map(P=>P[0]),evaluate:({zoom:P},R)=>gb({stops:I,base:a.base},e,P).evaluate(P,R)}}if(d){let C=m==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:qs.interpolationFactor.bind(void 0,C),zoomStops:a.stops.map(T=>T[0]),evaluate:({zoom:T})=>g(a,e,T,v,b)}}return{kind:"source",evaluate(C,T){let I=T&&T.properties?T.properties[a.property]:void 0;return I===void 0?fl(a.default,e.default):g(a,e,I,v,b)}}}function fl(a,e,s){return a!==void 0?a:e!==void 0?e:s!==void 0?s:void 0}function aT(a,e,s,u,d){return fl(typeof s===d?u[s]:void 0,a.default,e.default)}function lT(a,e,s){if(!Nd(s))return fl(a.default,e.default);let u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];let d=pm(a.stops.map(m=>m[0]),s);return a.stops[d][1]}function gb(a,e,s){let u=a.base!==void 0?a.base:1;if(!Nd(s))return fl(a.default,e.default);let d=a.stops.length;if(d===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[d-1][0])return a.stops[d-1][1];let m=pm(a.stops.map(T=>T[0]),s),g=(function(T,I,D,P){let R=P-D,z=T-D;return R===0?0:I===1?z/R:(Math.pow(I,z)-1)/(Math.pow(I,R)-1)})(s,u,a.stops[m][0],a.stops[m+1][0]),v=a.stops[m][1],b=a.stops[m+1][1],C=op[e.type]||fb;if(a.colorSpace&&a.colorSpace!=="rgb"){let T=sb[a.colorSpace];C=(I,D)=>T.reverse(T.interpolate(T.forward(I),T.forward(D),g))}return typeof v.evaluate=="function"?{evaluate(...T){let I=v.evaluate.apply(void 0,T),D=b.evaluate.apply(void 0,T);if(I!==void 0&&D!==void 0)return C(I,D,g)}}:C(v,b,g)}function _b(a,e,s){return e.type==="color"?s=ci.parse(s):e.type==="formatted"?s=os.fromString(s.toString()):e.type==="resolvedImage"?s=ss.build(s.toString()):Ht(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),fl(s,a.default,e.default)}as.register(Zd,{error:[{kind:"error"},[Bn],(a,[e])=>{throw new Jr(e.evaluate(a))}],typeof:[Bn,[ai],(a,[e])=>Lr(so(e.evaluate(a)))],"to-rgba":[zo(Wt,4),[bs],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[zo(Wt,4),[bs],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[bs,[Wt,Wt,Wt],Tv],rgba:[bs,[Wt,Wt,Wt,Wt],Tv],hsl:[bs,[Wt,Wt,Wt],Iv],hsla:[bs,[Wt,Wt,Wt,Wt],Iv],has:{type:pi,overloads:[[[Bn],(a,[e])=>ub(e.evaluate(a),a.properties())],[[Bn,ul],(a,[e,s])=>ub(e.evaluate(a),s.evaluate(a))]]},get:{type:ai,overloads:[[[Bn],(a,[e])=>Mv(e.evaluate(a),a.properties())],[[Bn,ul],(a,[e,s])=>Mv(e.evaluate(a),s.evaluate(a))]]},"feature-state":[ai,[Bn],(a,[e])=>Mv(e.evaluate(a),a.featureState||{})],properties:[ul,[],a=>a.properties()],"geometry-type":[Bn,[],a=>a.geometryType()],worldview:[Bn,[],a=>a.globals.worldview||""],"is-active-floor":[pi,Gc(Bn),(a,e)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;let s=a.globals.activeFloors;return e.some(u=>{let d=u.evaluate(a);return s.has(d)})}],id:[ai,[],a=>a.id()],zoom:[Wt,[],a=>a.globals.zoom],pitch:[Wt,[],a=>a.globals.pitch||0],"distance-from-center":[Wt,[],a=>a.distanceFromCenter()],"measure-light":[Wt,[Bn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[Wt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Wt,[],a=>a.globals.lineProgress||0],"raster-value":[Wt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Wt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Wt,[],a=>a.globals.skyRadialProgress||0],accumulated:[ai,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Wt,Gc(Wt),(a,e)=>{let s=0;for(let u of e)s+=u.evaluate(a);return s}],"*":[Wt,Gc(Wt),(a,e)=>{let s=1;for(let u of e)s*=u.evaluate(a);return s}],"-":{type:Wt,overloads:[[[Wt,Wt],(a,[e,s])=>e.evaluate(a)-s.evaluate(a)],[[Wt],(a,[e])=>-e.evaluate(a)]]},"/":[Wt,[Wt,Wt],(a,[e,s])=>e.evaluate(a)/s.evaluate(a)],"%":[Wt,[Wt,Wt],(a,[e,s])=>e.evaluate(a)%s.evaluate(a)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(a,[e,s])=>Math.pow(e.evaluate(a),s.evaluate(a))],sqrt:[Wt,[Wt],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[Wt,[Wt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[Wt,[Wt],(a,[e])=>Math.log(e.evaluate(a))],log2:[Wt,[Wt],(a,[e])=>Math.log2(e.evaluate(a))],sin:[Wt,[Wt],(a,[e])=>Math.sin(e.evaluate(a))],cos:[Wt,[Wt],(a,[e])=>Math.cos(e.evaluate(a))],tan:[Wt,[Wt],(a,[e])=>Math.tan(e.evaluate(a))],asin:[Wt,[Wt],(a,[e])=>Math.asin(e.evaluate(a))],acos:[Wt,[Wt],(a,[e])=>Math.acos(e.evaluate(a))],atan:[Wt,[Wt],(a,[e])=>Math.atan(e.evaluate(a))],min:[Wt,Gc(Wt),(a,e)=>Math.min(...e.map(s=>s.evaluate(a)))],max:[Wt,Gc(Wt),(a,e)=>Math.max(...e.map(s=>s.evaluate(a)))],abs:[Wt,[Wt],(a,[e])=>Math.abs(e.evaluate(a))],round:[Wt,[Wt],(a,[e])=>{let s=e.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Wt,[Wt],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[Wt,[Wt],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[pi,[Bn,ai],(a,[e,s])=>a.properties()[e.value]===s.value],"filter-id-==":[pi,[ai],(a,[e])=>a.id()===e.value],"filter-type-==":[pi,[Bn],(a,[e])=>a.geometryType()===e.value],"filter-<":[pi,[Bn,ai],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[pi,[ai],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s<u}],"filter->":[pi,[Bn,ai],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[pi,[ai],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s>u}],"filter-<=":[pi,[Bn,ai],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[pi,[ai],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s<=u}],"filter->=":[pi,[Bn,ai],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[pi,[ai],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s>=u}],"filter-has":[pi,[ai],(a,[e])=>e.value in a.properties()],"filter-has-id":[pi,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[pi,[zo(Bn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[pi,[zo(ai)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[pi,[Bn,zo(ai)],(a,[e,s])=>s.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[pi,[Bn,zo(ai)],(a,[e,s])=>(function(u,d,m,g){for(;m<=g;){let v=m+g>>1;if(d[v]===u)return!0;d[v]>u?g=v-1:m=v+1}return!1})(a.properties()[e.value],s.value,0,s.value.length-1)],all:{type:pi,overloads:[[[pi,pi],(a,[e,s])=>e.evaluate(a)&&s.evaluate(a)],[Gc(pi),(a,e)=>{for(let s of e)if(!s.evaluate(a))return!1;return!0}]]},any:{type:pi,overloads:[[[pi,pi],(a,[e,s])=>e.evaluate(a)||s.evaluate(a)],[Gc(pi),(a,e)=>{for(let s of e)if(s.evaluate(a))return!0;return!1}]]},"!":[pi,[pi],(a,[e])=>!e.evaluate(a)],"is-supported-script":[pi,[Bn],(a,[e])=>{let s=a.globals&&a.globals.isSupportedScript;return!s||s(e.evaluate(a))}],upcase:[Bn,[Bn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[Bn,[Bn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[Bn,Gc(ai),(a,e)=>e.map(s=>fa(s.evaluate(a))).join("")],"resolved-locale":[Bn,[Xf],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[Wt,[Wt,Wt,ai],(a,e)=>{let[s,u,d]=e.map(g=>g.evaluate(a));if(s>u||s===u)return s;let m;if(typeof d=="string")m=(function(g){let v=0;if(g.length===0)return v;for(let b=0;b<g.length;b++)v=(v<<5)-v+g.charCodeAt(b),v|=0;return v})(d);else{if(typeof d!="number")throw new Jr(`Invalid seed input: ${d}`);m=d}return s+cb(m)()*(u-s)}]});class Sm{constructor(e,s,u,d,m){this.expression=e,this._warningHistory={},this._scope=u,this._options=d,this._iconImageUseTheme=m,this._evaluator=new em(u,d,m),this._defaultValue=s?(function(g){return g.type==="color"&&(Em(g.default)||Array.isArray(g.default))?new ci(0,0,0,0):g.type==="color"?ci.parse(g.default)||null:g.default===void 0?null:g.default})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Xu(e),this.isIndoorDependent=wm(e)}evaluateWithoutErrorHandling(e,s,u,d,m,g,v,b){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,u,d,m,g,v,b,C){this._evaluator||(this._evaluator=new em(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=C||null;try{let T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Jr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){let I=T;return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function bp(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Zd}function Wc(a,e,s,u,d){let m=new hm(Zd,[],e?(function(v){let b={color:bs,string:Bn,number:Wt,enum:Bn,boolean:pi,formatted:sp,resolvedImage:ap};return v.type==="array"?zo(b[v.value]||ai,v.length):b[v.type]})(e):void 0,void 0,void 0,s,u,d),g=m.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?db(new Sm(g,e,s,u,d)):qc(m.errors)}class Xd{constructor(e,s,u,d){this.kind=e,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!fp(s.expression),this.configDependencies=Xu(s.expression),this.isIndoorDependent=wm(s.expression)}evaluateWithoutErrorHandling(e,s,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,d,m,g)}evaluate(e,s,u,d,m,g,v){return this._styleExpression.evaluate(e,s,u,d,m,g,void 0,void 0,v)}}class Yu{constructor(e,s,u,d,m,g){this.kind=e,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!fp(s.expression),this.isIndoorDependent=wm(s.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=Xu(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,s,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,d,m,g)}evaluate(e,s,u,d,m,g){return this._styleExpression.evaluate(e,s,u,d,m,g)}interpolationFactor(e,s,u){return this.interpolationType?qs.interpolationFactor(this.interpolationType,e,s,u):0}}function Av(a,e,s,u,d){if((a=Wc(a,e,s,u,d)).result==="error")return a;let m=a.value.expression,g=Ud(m);if(!g&&!xp(e))return qc([new pa("","data expressions not supported")]);let v=jd(m,["zoom","pitch","distance-from-center"]);if(!v&&!pb(e))return qc([new pa("","zoom expressions not supported")]);let b=jd(m,["measure-light"]);if(!b&&!hb(e))return qc([new pa("","measure-light expression not supported")]);let C=jd(m,["line-progress"]);if(!C&&!(function(D){return Dv(D.expression,"line-progress")})(e))return qc([new pa("","line-progress expression not supported")]);let T=e.expression&&e.expression.relaxZoomRestriction,I=wp(m);return I||v||T?I instanceof pa?qc([I]):I instanceof qs&&!Cm(e)?qc([new pa("",'"interpolate" expressions cannot be used with this property')]):db(I?new Yu(g&&C?"camera":"composite",a.value,I.labels,I instanceof qs?I.interpolation:void 0,b,C):new Xd(g&&C?"constant":"source",a.value,b,C)):qc([new pa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Tm{constructor(e,s){this._parameters=e,this._specification=s,Object.assign(this,mb(this._parameters,this._specification))}static deserialize(e){return new Tm(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function wp(a){let e=null;if(a instanceof Wl)e=wp(a.result);else if(a instanceof _p){for(let s of a.args)if(e=wp(s),e)break}else(a instanceof mp||a instanceof qs)&&a.input instanceof as&&a.input.name==="zoom"&&(e=a);return e instanceof pa||a.eachChild(s=>{let u=wp(s);u instanceof pa?e=u:e&&u&&e!==u&&(e=new pa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Pv,vb,yb=(function(){if(vb)return Pv;vb=1,Pv=e;var a=3;function e(s,u,d){var m=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(d=g[2]);for(var v=0;v<this.d*this.d;v++){var b=g[a+v],C=g[a+v+1];m.push(b===C?null:g.subarray(b,C))}var T=g[a+m.length+1];this.keys=g.subarray(g[a+m.length],T),this.bboxes=g.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var I=0;I<this.d*this.d;I++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=d,this.scale=u/s,this.uid=0;var D=d/u*s;this.min=-D,this.max=s+D}return e.prototype.insert=function(s,u,d,m,g){this._forEachCell(u,d,m,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(s,u,d,m,g,v){this.cells[g].push(v)},e.prototype.query=function(s,u,d,m,g){var v=this.min,b=this.max;if(s<=v&&u<=v&&b<=d&&b<=m&&!g)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(s,u,d,m,this._queryCell,C,{},g),C},e.prototype._queryCell=function(s,u,d,m,g,v,b,C){var T=this.cells[g];if(T!==null)for(var I=this.keys,D=this.bboxes,P=0;P<T.length;P++){var R=T[P];if(b[R]===void 0){var z=4*R;(C?C(D[z+0],D[z+1],D[z+2],D[z+3]):s<=D[z+2]&&u<=D[z+3]&&d>=D[z+0]&&m>=D[z+1])?(b[R]=!0,v.push(I[R])):b[R]=!1}}},e.prototype._forEachCell=function(s,u,d,m,g,v,b,C){for(var T=this._convertToCellCoord(s),I=this._convertToCellCoord(u),D=this._convertToCellCoord(d),P=this._convertToCellCoord(m),R=T;R<=D;R++)for(var z=I;z<=P;z++){var H=this.d*z+R;if((!C||C(this._convertFromCellCoord(R),this._convertFromCellCoord(z),this._convertFromCellCoord(R+1),this._convertFromCellCoord(z+1)))&&g.call(this,s,u,d,m,H,v,b,C))return}},e.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},e.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=a+this.cells.length+1+1,d=0,m=0;m<this.cells.length;m++)d+=this.cells[m].length;var g=new Int32Array(u+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=u,b=0;b<s.length;b++){var C=s[b];g[a+b]=v,g.set(C,v),v+=C.length}return g[a+s.length]=v,g.set(this.keys,v),g[a+s.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer},Pv})(),Yd=Lu(yb);let Ku={};function kt(a,e,s={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Ku[e]={klass:a,omit:s.omit||[]}}kt(Object,"Object"),Yd.serialize=function(a,e){let s=a.toArrayBuffer();return e&&e.add(s),{buffer:s}},Yd.deserialize=function(a){return new Yd(a.buffer)},Object.defineProperty(Yd,"name",{value:"Grid"}),kt(Yd,"Grid"),delete it.prototype.constructor,kt(ci,"Color"),kt(Error,"Error"),kt(os,"Formatted"),kt(Kf,"FormattedSection"),kt(Rs,"AJAXError"),kt(ss,"ResolvedImage"),kt(Tm,"StylePropertyFunction"),kt(Sm,"StyleExpression",{omit:["_evaluator"]}),kt(Yo,"ImageId"),kt(Hl,"ImageVariant"),kt(Yu,"ZoomDependentExpression"),kt(Xd,"ZoomConstantExpression"),kt(as,"CompoundExpression",{omit:["_evaluate"]});for(let a in Zd)Ku[Zd[a]._classRegistryKey]||kt(Zd[a],`Expression${a}`);function Cp(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Zl(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Cp(a)||a instanceof ImageBitmap)return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){let s=[];for(let u of a)s.push(Zl(u,e));return s}if(a instanceof Map){let s={$name:"Map",entries:[]};for(let[u,d]of a.entries())s.entries.push(Zl(u),Zl(d,e));return s}if(a instanceof Set){let s={$name:"Set"},u=0;for(let d of a.values())s[++u]=Zl(d);return s}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){let s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);let d=s.serialize?s.serialize(a,e):{};if(!s.serialize){for(let m in a)a.hasOwnProperty(m)&&(Ku[u].omit.indexOf(m)>=0||(d[m]=Zl(a[m],e)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function Zc(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Cp(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Zc);if(typeof a=="object"){let e=a.$name||"Object";if(e==="Map"){let d=a.entries||[],m=new Map;for(let g=0;g<d.length;g+=2)m.set(Zc(d[g]),Zc(d[g+1]));return m}if(e==="Set"){let d=new Set;for(let m of Object.keys(a))m!=="$name"&&d.add(Zc(a[m]));return d}if(e==="BigInt")return BigInt(a.value);let{klass:s}=Ku[e];if(!s)throw new Error(`Can't deserialize unregistered class "${e}".`);if(s.deserialize)return s.deserialize(a);let u=Object.create(s.prototype);for(let d of Object.keys(a))d!=="$name"&&(u[d]=Zc(a[d]));return u}throw new Error("can't deserialize object of type "+typeof a)}let en={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Ep(a){for(let e of a)if(Im(e.charCodeAt(0)))return!0;return!1}function Ov(a){for(let e of a)if(!xb(e.charCodeAt(0)))return!1;return!0}function xb(a){return!(en.Arabic(a)||en["Arabic Supplement"](a)||en["Arabic Extended-A"](a)||en["Arabic Presentation Forms-A"](a)||en["Arabic Presentation Forms-B"](a))}function Im(a){return!(a!==746&&a!==747&&(a<4352||!(en["Bopomofo Extended"](a)||en.Bopomofo(a)||en["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||en["CJK Compatibility Ideographs"](a)||en["CJK Compatibility"](a)||en["CJK Radicals Supplement"](a)||en["CJK Strokes"](a)||!(!en["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||en["CJK Unified Ideographs Extension A"](a)||en["CJK Unified Ideographs"](a)||en["Enclosed CJK Letters and Months"](a)||en["Hangul Compatibility Jamo"](a)||en["Hangul Jamo Extended-A"](a)||en["Hangul Jamo Extended-B"](a)||en["Hangul Jamo"](a)||en["Hangul Syllables"](a)||en.Hiragana(a)||en["Ideographic Description Characters"](a)||en.Kanbun(a)||en["Kangxi Radicals"](a)||en["Katakana Phonetic Extensions"](a)||en.Katakana(a)&&a!==12540||!(!en["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!en["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||en["Unified Canadian Aboriginal Syllabics"](a)||en["Unified Canadian Aboriginal Syllabics Extended"](a)||en["Vertical Forms"](a)||en["Yijing Hexagram Symbols"](a)||en["Yi Syllables"](a)||en["Yi Radicals"](a))))}function Mm(a){return!(Im(a)||(function(e){return!!(en["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||en["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||en["Letterlike Symbols"](e)||en["Number Forms"](e)||en["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||en["Control Pictures"](e)&&e!==9251||en["Optical Character Recognition"](e)||en["Enclosed Alphanumerics"](e)||en["Geometric Shapes"](e)||en["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||en["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||en["CJK Symbols and Punctuation"](e)||en.Katakana(e)||en["Private Use Area"](e)||en["CJK Compatibility Forms"](e)||en["Small Form Variants"](e)||en["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(a))}function Dm(a){return en.Arabic(a)||en["Arabic Supplement"](a)||en["Arabic Extended-A"](a)||en["Arabic Presentation Forms-A"](a)||en["Arabic Presentation Forms-B"](a)}function Rv(a){return a>=1424&&a<=2303||en["Arabic Presentation Forms-A"](a)||en["Arabic Presentation Forms-B"](a)}function Xl(a,e){return!(!e&&Rv(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||en.Khmer(a))}function cT(a){for(let e of a)if(Rv(e.charCodeAt(0)))return!0;return!1}let ks={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"},kv=null,ls=ks.unavailable,Yl=null,Sp=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ls=ks.error),kv&&kv(a)};function Am(){Pm.fire(new cl("pluginStateChange",{pluginStatus:ls,pluginURL:Yl}))}let Pm=new Hu,Tp=function(){return ls},bb=function(){if(ls!==ks.deferred||!Yl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ls=ks.loading,Am(),Yl&&$l({url:Yl},a=>{a?Sp(a):(ls=ks.loaded,Am())})},Kl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ls===ks.loaded||Kl.applyArabicShaping!=null,isLoading:()=>ls===ks.loading,setState(a){ls=a.pluginStatus,Yl=a.pluginURL},isParsing:()=>ls===ks.parsing,isParsed:()=>ls===ks.parsed,getPluginURL:()=>Yl};class Ni{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(s,u){for(let d of s)if(!Xl(d.charCodeAt(0),u))return!1;return!0})(e,Kl.isLoaded())}}class Om{constructor(e,s,u,d,m){this.property=e,this.value=s,this.expression=(function(g,v,b,C,T){if(Em(g))return new Tm(g,v);if(bp(g)||Array.isArray(g)&&g.length>0){let I=Av(g,v,b,C,T);if(I.result==="error")throw new Error(I.value.map(D=>`${D.key}: ${D.message}`).join(", "));return I.value}{let I=g;return typeof g=="string"&&v.type==="color"&&(I=ci.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>I}}})(s===void 0?e.specification.default:s,e.specification,u,d,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,u,d){return this.property.possiblyEvaluate(this,e,s,u,d)}}class Fv{constructor(e,s,u,d){this.property=e,this.value=new Om(e,void 0,s,u,d)}transitioned(e,s){return new Cb(this.property,this.value,s,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Cb(this.property,this.value,null,{},0)}}class wb{constructor(e,s,u,d){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Xe(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Fv(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Om(this._values[e].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,s){s&&(this._options=s);let u=this._properties.properties;if(e)for(let d in e){let m=e[d];if(d.endsWith("-transition")){let g=d.slice(0,-11);u[g]&&this.setTransition(g,m)}else u.hasOwnProperty(d)&&this.setValue(d,m)}}getTransition(e){return Xe(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Fv(this._values[e].property)),this._values[e].transition=Xe(s)||void 0}serialize(){let e={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(e[s]=u);let d=this.getTransition(s);d!==void 0&&(e[`${s}-transition`]=d)}return e}transitioned(e,s){let u=new Eb(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(e,s._values[d]);return u}untransitioned(){let e=new Eb(this._properties);for(let s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Cb{constructor(e,s,u,d,m){let g=d.delay||0,v=d.duration||0;m=m||0,this.property=e,this.value=s,this.begin=m+g,this.end=this.begin+v,e.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(e,s,u){let d=e.now||0,m=this.value.possiblyEvaluate(e,s,u),g=this.prior;if(g){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return g.possiblyEvaluate(e,s,u);{let v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,s,u),m,zu(v))}}return m}}class Eb{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,u){let d=new Ju(this._properties);for(let m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,s,u);return d}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Sb{constructor(e,s,u,d){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Xe(this._values[e].value)}setValue(e,s){this._values[e]=new Om(this._values[e].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){let e={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(e[s]=u)}return e}possiblyEvaluate(e,s,u,d){let m=new Ju(this._properties);for(let g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(e,s,u,d);return m}isIndoorDependent(){return this._isIndoorDependent}}class Qu{constructor(e,s,u,d){this.property=e,this.value=s,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,u,d){return this.property.evaluate(this.value,this.parameters,e,s,u,d,this.iconImageUseTheme)}}class Ju{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ht{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,u){let d=op[this.specification.type];return d?d(e,s,u):e}}class wt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,u,d,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Qu(this,{kind:"constant",value:e.expression.evaluate(s,null,{},u,d,void 0,m)},s):new Qu(this,e.expression,s,m)}interpolate(e,s,u){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Qu(this,{kind:"constant",value:void 0},e.parameters);let d=op[this.specification.type];return d?new Qu(this,{kind:"constant",value:d(e.value.value,s.value.value,u)},e.parameters):e}evaluate(e,s,u,d,m,g,v){return e.kind==="constant"?e.value:e.evaluate(s,u,d,m,g,void 0,v)}}class ed{constructor(e){this.specification=e}possiblyEvaluate(e,s,u,d){return!!e.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class hr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let s=new Ni(0,{});for(let u in e){let d=e[u];d.specification.overridable&&this.overridableProperties.push(u);let m=this.defaultPropertyValues[u]=new Om(d,void 0),g=this.defaultTransitionablePropertyValues[u]=new Fv(d);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(s)}}}kt(wt,"DataDrivenProperty"),kt(ht,"DataConstantProperty"),kt(ed,"ColorRampProperty");var Me=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Tb(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Rm(a){if(Array.isArray(a))return a.map(Rm);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let e={};for(let s in a)e[s]=Rm(a[s]);return e}return Tb(a)}function ml(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let e of a.slice(1))if(!ml(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function km(a,e="",s=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ml(a)||(a=Fm(a));let d=a,m=!0;try{m=(function(T){if(!Kd(T))return T;let I=Rm(T);return Ib(I),I=td(I),I})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let g=null,v=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){v=Me[`filter_${u}`];let T=Wc(m,v,e,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));g=(I,D,P)=>T.value.evaluate(I,D,{},P)}let b=null,C=null;if(m!==d){let T=Wc(d,v,e,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,D,P,R,z)=>T.value.evaluate(I,D,{},P,void 0,void 0,R,z),C=!Ud(T.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:Mb(m),needFeature:!!C}}function td(a){if(!Array.isArray(a))return a;let e=(function(s){if(uT.has(s[0])){for(let u=1;u<s.length;u++)if(Kd(s[u]))return!0}return s})(a);return e===!0?e:e.map(s=>td(s))}function Ib(a){let e=!1,s=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)e=e||Kd(a[u]),s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="match"){e=e||Kd(a[1]);for(let u=2;u<a.length-1;u+=2)s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="step"){e=e||Kd(a[1]);for(let u=1;u<a.length-1;u+=2)s.push(a[u+1])}e&&(a.length=0,a.push("any",...s));for(let u=1;u<a.length;u++)Ib(a[u])}function Kd(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<a.length;s++)if(Kd(a[s]))return!0;return!1}let uT=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dT(a,e){return a<e?-1:a>e?1:0}function Mb(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(Mb(a[e]))return!0;return!1}function Fm(a){if(!a)return!0;let e=a[0];return a.length<=1?e!=="any":e==="=="?Lm(a[1],a[2],"=="):e==="!="?Ip(Lm(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Lm(a[1],a[2],e):e==="any"?(s=a.slice(1),["any"].concat(s.map(Fm))):e==="all"?["all"].concat(a.slice(1).map(Fm)):e==="none"?["all"].concat(a.slice(1).map(Fm).map(Ip)):e==="in"?Nm(a[1],a.slice(2)):e==="!in"?Ip(Nm(a[1],a.slice(2))):e==="has"?zm(a[1]):e!=="!has"||Ip(zm(a[1]));var s}function Lm(a,e,s){switch(a){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,a,e]}}function Nm(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",a,["literal",e.sort(dT)]]:["filter-in-small",a,["literal",e]]}}function zm(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ip(a){return["!",a]}let nd="";function Ua(a,e){return e?`${a}${nd}${e}`:a}let Db,Ab=()=>Db||(Db=new hr({"icon-size":new wt(Me.layout_symbol["icon-size"]),"icon-image":new wt(Me.layout_symbol["icon-image"]),"icon-rotate":new wt(Me.layout_symbol["icon-rotate"]),"icon-offset":new wt(Me.layout_symbol["icon-offset"]),"text-size":new wt(Me.layout_symbol["text-size"]),"text-rotate":new wt(Me.layout_symbol["text-rotate"]),"text-offset":new wt(Me.layout_symbol["text-offset"])}));class Pb{constructor(e,s,u,d,m,g){let v=Wc(e,Me.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=s,u){this.properties=new Ju(Ab()),this.unevaluatedLayout=new Sb(Ab(),d,m,g);for(let b in u)this.unevaluatedLayout.setValue(b,u[b])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,s,u))}serialize(){let e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){let e=this.hasProperty("icon-image"),s=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return e||s||u||d}hasTextProperties(){let e=this.hasProperty("text-size"),s=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return e||s||u}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}let Ob="-transition",gl=new Set(["fill","line","background","hillshade","raster"]);class cs extends Hu{constructor(e,s,u,d,m,g){if(super(),this.id=e.id,this.fqid=Ua(this.id,u),this.type=e.type,this.scope=u,this.lut=d,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let v=Wc(this.filter,Me[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),s.layout&&(this._unevaluatedLayout=new Sb(s.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new wb(s.paint,this.scope,m);for(let v in e.paint)this.setPaintProperty(v,e.paint[v]);for(let v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ju(s.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&gl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s){if(this.type==="custom"&&e==="visibility")return void(this.visibility=s);let u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(s=>{this.appearances.push(new Pb(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Ob)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,s){let u=this._transitionablePaint,d=u._properties.properties;if(e.endsWith(Ob)){let I=e.slice(0,-11);return d[I]&&u.setTransition(I,s||void 0),!1}if(!d[e])return!1;let m=u._values[e],g=m.value.isDataDriven(),v=m.value;u.setValue(e,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);let b=u._values[e].value,C=b.isDataDriven(),T=e.endsWith("pattern")||e==="line-dasharray";return C||g||T||this._handleOverridablePaintPropertyUpdate(e,v,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,s,u){return null}_handleOverridablePaintPropertyUpdate(e,s,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){let e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(s=>s.serialize())),at(e,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(let e in this.paint._values){let s=this.paint.get(e);if(s instanceof Qu&&xp(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(let e of this.appearances)if(!fp(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=km(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,s,u){return{}}queryRadius(e){}queryIntersectsFeature(e,s,u,d,m,g,v,b,C){}}let Rb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Mp{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}let hT=new ArrayBuffer(0);class Gi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,s){return e._trim(),s&&e.arrayBuffer&&s.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,e.arrayBuffer?s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement:(s.capacity=0,s.arrayBuffer=hT),s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pn(a,e=1){let s=0,u=0;return{members:a.map(d=>{let m=Rb[d.type].BYTES_PER_ELEMENT,g=s=kb(s,Math.max(e,m)),v=d.components||1;return u=Math.max(u,m),s+=m*v,{name:d.name,type:d.type,components:v,offset:g}}),size:kb(s,Math.max(u,e)),alignment:e}}function kb(a,e){return Math.ceil(a/e)*e}class Xc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.int16[d+0]=s,this.int16[d+1]=u,e}}Xc.prototype.bytesPerElement=4,kt(Xc,"StructArrayLayout2i4");class Qd extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=d,e}}Qd.prototype.bytesPerElement=6,kt(Qd,"StructArrayLayout3i6");class Jd extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,this.int16[g+3]=m,e}}Jd.prototype.bytesPerElement=8,kt(Jd,"StructArrayLayout4i8");class Ql extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}Ql.prototype.bytesPerElement=4,kt(Ql,"StructArrayLayout1f4");class Lv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=4*e,g=2*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.float32[g+1]=d,e}}Lv.prototype.bytesPerElement=8,kt(Lv,"StructArrayLayout2i1f8");class Nv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=4*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=d,e}}Nv.prototype.bytesPerElement=8,kt(Nv,"StructArrayLayout3i8");class zv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=5*e;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=d,this.int16[v+3]=m,this.int16[v+4]=g,e}}zv.prototype.bytesPerElement=10,kt(zv,"StructArrayLayout5i10");class Bm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let C=6*e,T=12*e,I=3*e;return this.int16[C+0]=s,this.int16[C+1]=u,this.uint8[T+4]=d,this.uint8[T+5]=m,this.uint8[T+6]=g,this.uint8[T+7]=v,this.float32[I+2]=b,e}}Bm.prototype.bytesPerElement=12,kt(Bm,"StructArrayLayout2i4ub1f12");class Ws extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.float32[m+0]=s,this.float32[m+1]=u,this.float32[m+2]=d,e}}Ws.prototype.bytesPerElement=12,kt(Ws,"StructArrayLayout3f12");class ws extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=6*e,b=3*e;return this.uint16[v+0]=s,this.uint16[v+1]=u,this.uint16[v+2]=d,this.uint16[v+3]=m,this.float32[b+2]=g,e}}ws.prototype.bytesPerElement=12,kt(ws,"StructArrayLayout4ui1f12");class id extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=d,this.uint16[g+3]=m,e}}id.prototype.bytesPerElement=8,kt(id,"StructArrayLayout4ui8");class Vm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=6*e;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=v,e}}Vm.prototype.bytesPerElement=12,kt(Vm,"StructArrayLayout6i12");class Bv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I,D){let P=this.length;return this.resize(P+1),this.emplace(P,e,s,u,d,m,g,v,b,C,T,I,D)}emplace(e,s,u,d,m,g,v,b,C,T,I,D,P){let R=12*e;return this.int16[R+0]=s,this.int16[R+1]=u,this.int16[R+2]=d,this.int16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=v,this.uint16[R+6]=b,this.uint16[R+7]=C,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=D,this.int16[R+11]=P,e}}Bv.prototype.bytesPerElement=24,kt(Bv,"StructArrayLayout4i4ui4i24");class Vv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=10*e,C=5*e;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=d,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=v,e}}Vv.prototype.bytesPerElement=20,kt(Vv,"StructArrayLayout3i3f20");class Yc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=d,this.float32[g+3]=m,e}}Yc.prototype.bytesPerElement=16,kt(Yc,"StructArrayLayout4f16");class Um extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}Um.prototype.bytesPerElement=4,kt(Um,"StructArrayLayout1ul4");class Zs extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.uint16[d+0]=s,this.uint16[d+1]=u,e}}Zs.prototype.bytesPerElement=4,kt(Zs,"StructArrayLayout2ui4");class jm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I,D,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,s,u,d,m,g,v,b,C,T,I,D,P)}emplace(e,s,u,d,m,g,v,b,C,T,I,D,P,R){let z=20*e,H=10*e;return this.int16[z+0]=s,this.int16[z+1]=u,this.int16[z+2]=d,this.int16[z+3]=m,this.int16[z+4]=g,this.float32[H+3]=v,this.float32[H+4]=b,this.float32[H+5]=C,this.float32[H+6]=T,this.int16[z+14]=I,this.uint32[H+8]=D,this.uint16[z+18]=P,this.uint16[z+19]=R,e}}jm.prototype.bytesPerElement=40,kt(jm,"StructArrayLayout5i4f1i1ul2ui40");class $m extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let C=8*e;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+4]=m,this.int16[C+5]=g,this.int16[C+6]=v,this.int16[C+7]=b,e}}$m.prototype.bytesPerElement=16,kt($m,"StructArrayLayout3i2i2i16");class Hm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=4*e,b=8*e;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=d,this.int16[b+6]=m,this.int16[b+7]=g,e}}Hm.prototype.bytesPerElement=16,kt(Hm,"StructArrayLayout2f1f2i16");class Uv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=20*e,C=5*e;return this.uint8[b+0]=s,this.uint8[b+1]=u,this.float32[C+1]=d,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=v,e}}Uv.prototype.bytesPerElement=20,kt(Uv,"StructArrayLayout2ub4f20");class qr extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.uint16[m+0]=s,this.uint16[m+1]=u,this.uint16[m+2]=d,e}}qr.prototype.bytesPerElement=6,kt(qr,"StructArrayLayout3ui6");class eh extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he){let ae=this.length;return this.resize(ae+1),this.emplace(ae,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he)}emplace(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he,ae){let me=30*e,ye=15*e,we=60*e;return this.int16[me+0]=s,this.int16[me+1]=u,this.int16[me+2]=d,this.float32[ye+2]=m,this.float32[ye+3]=g,this.uint16[me+8]=v,this.uint16[me+9]=b,this.uint32[ye+5]=C,this.uint32[ye+6]=T,this.uint32[ye+7]=I,this.uint16[me+16]=D,this.uint16[me+17]=P,this.uint16[me+18]=R,this.float32[ye+10]=z,this.float32[ye+11]=H,this.uint8[we+48]=$,this.uint8[we+49]=Z,this.uint8[we+50]=Y,this.uint32[ye+13]=te,this.int16[me+28]=he,this.uint8[we+58]=ae,e}}eh.prototype.bytesPerElement=60,kt(eh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he,ae,me,ye,we,je,Te,qe,Ye,Ke,rt,st,et){let tt=this.length;return this.resize(tt+1),this.emplace(tt,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he,ae,me,ye,we,je,Te,qe,Ye,Ke,rt,st,et)}emplace(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he,ae,me,ye,we,je,Te,qe,Ye,Ke,rt,st,et,tt){let Ge=20*e,$e=40*e,nt=80*e;return this.float32[Ge+0]=s,this.float32[Ge+1]=u,this.int16[$e+4]=d,this.int16[$e+5]=m,this.int16[$e+6]=g,this.int16[$e+7]=v,this.int16[$e+8]=b,this.int16[$e+9]=C,this.int16[$e+10]=T,this.int16[$e+11]=I,this.int16[$e+12]=D,this.uint16[$e+13]=P,this.uint16[$e+14]=R,this.uint16[$e+15]=z,this.uint16[$e+16]=H,this.uint16[$e+17]=$,this.uint16[$e+18]=Z,this.uint16[$e+19]=Y,this.uint16[$e+20]=te,this.uint16[$e+21]=he,this.uint16[$e+22]=ae,this.uint16[$e+23]=me,this.uint16[$e+24]=ye,this.uint16[$e+25]=we,this.uint16[$e+26]=je,this.uint16[$e+27]=Te,this.uint32[Ge+14]=qe,this.float32[Ge+15]=Ye,this.float32[Ge+16]=Ke,this.float32[Ge+17]=rt,this.float32[Ge+18]=st,this.uint8[nt+76]=et,this.uint16[$e+39]=tt,e}}jv.prototype.bytesPerElement=80,kt(jv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class $v extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=6*e;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=g,this.float32[b+5]=v,e}}$v.prototype.bytesPerElement=24,kt($v,"StructArrayLayout6f24");class rd extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=5*e;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=d,this.float32[v+3]=m,this.float32[v+4]=g,e}}rd.prototype.bytesPerElement=20,kt(rd,"StructArrayLayout5f20");class Hv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let C=7*e;return this.float32[C+0]=s,this.float32[C+1]=u,this.float32[C+2]=d,this.float32[C+3]=m,this.float32[C+4]=g,this.float32[C+5]=v,this.float32[C+6]=b,e}}Hv.prototype.bytesPerElement=28,kt(Hv,"StructArrayLayout7f28");class Gv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I){let D=this.length;return this.resize(D+1),this.emplace(D,e,s,u,d,m,g,v,b,C,T,I)}emplace(e,s,u,d,m,g,v,b,C,T,I,D){let P=11*e;return this.float32[P+0]=s,this.float32[P+1]=u,this.float32[P+2]=d,this.float32[P+3]=m,this.float32[P+4]=g,this.float32[P+5]=v,this.float32[P+6]=b,this.float32[P+7]=C,this.float32[P+8]=T,this.float32[P+9]=I,this.float32[P+10]=D,e}}Gv.prototype.bytesPerElement=44,kt(Gv,"StructArrayLayout11f44");class th extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C){let T=this.length;return this.resize(T+1),this.emplace(T,e,s,u,d,m,g,v,b,C)}emplace(e,s,u,d,m,g,v,b,C,T){let I=9*e;return this.float32[I+0]=s,this.float32[I+1]=u,this.float32[I+2]=d,this.float32[I+3]=m,this.float32[I+4]=g,this.float32[I+5]=v,this.float32[I+6]=b,this.float32[I+7]=C,this.float32[I+8]=T,e}}th.prototype.bytesPerElement=36,kt(th,"StructArrayLayout9f36");class _l extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.float32[d+0]=s,this.float32[d+1]=u,e}}_l.prototype.bytesPerElement=8,kt(_l,"StructArrayLayout2f8");class Cs extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=6*e;return this.uint32[3*e+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=d,this.uint16[g+4]=m,e}}Cs.prototype.bytesPerElement=12,kt(Cs,"StructArrayLayout1ul3ui12");class Kc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}Kc.prototype.bytesPerElement=2,kt(Kc,"StructArrayLayout1ui2");class qv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H){let $=this.length;return this.resize($+1),this.emplace($,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H)}emplace(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$){let Z=16*e;return this.float32[Z+0]=s,this.float32[Z+1]=u,this.float32[Z+2]=d,this.float32[Z+3]=m,this.float32[Z+4]=g,this.float32[Z+5]=v,this.float32[Z+6]=b,this.float32[Z+7]=C,this.float32[Z+8]=T,this.float32[Z+9]=I,this.float32[Z+10]=D,this.float32[Z+11]=P,this.float32[Z+12]=R,this.float32[Z+13]=z,this.float32[Z+14]=H,this.float32[Z+15]=$,e}}qv.prototype.bytesPerElement=64,kt(qv,"StructArrayLayout16f64");class Gm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let C=10*e,T=5*e;return this.uint16[C+0]=s,this.uint16[C+1]=u,this.uint16[C+2]=d,this.uint16[C+3]=m,this.float32[T+2]=g,this.float32[T+3]=v,this.float32[T+4]=b,e}}Gm.prototype.bytesPerElement=20,kt(Gm,"StructArrayLayout4ui3f20");class Wv extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.int16[1*e+0]=s,e}}Wv.prototype.bytesPerElement=2,kt(Wv,"StructArrayLayout1i2");class qm extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint8[1*e+0]=s,e}}qm.prototype.bytesPerElement=1,kt(qm,"StructArrayLayout1ub1");class Wm extends Mp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Wm.prototype.size=40;class Fb extends jm{get(e){return new Wm(this,e)}}kt(Fb,"CollisionBoxArray");class Zm extends Mp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Zm.prototype.size=60;class Lb extends eh{get(e){return new Zm(this,e)}}kt(Lb,"PlacedSymbolArray");class Nb extends Mp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Nb.prototype.size=80;class Zv extends jv{get(e){return new Nb(this,e)}}kt(Zv,"SymbolInstanceArray");class Xm extends Ql{getoffsetX(e){return this.float32[1*e+0]}}kt(Xm,"GlyphOffsetArray");class zb extends Xc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}kt(zb,"SymbolLineVertexArray");class Xv extends Mp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xv.prototype.size=12;class Yv extends Cs{get(e){return new Xv(this,e)}}kt(Yv,"FeatureIndexArray");class Bb extends Zs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}kt(Bb,"FillExtrusionCentroidArray");class Ym extends Mp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ym.prototype.size=6;class Dp extends Qd{get(e){return new Ym(this,e)}}kt(Dp,"FillExtrusionWallArray");let Vb=Pn([{name:"a_pos",components:2,type:"Int16"}],4),pT=Pn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ub=Pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ji{constructor(e=[]){this.segments=e}_prepareSegment(e,s,u,d){let m=this.segments[this.segments.length-1];return e>Ji.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${Ji.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Ji.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}prepareSegment(e,s,u,d){return this._prepareSegment(e,s.length,u.length,d)}get(){return this.segments}destroy(){for(let e of this.segments)for(let s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,u,d){return new Ji([{vertexOffset:e,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function Km(a,e){return 256*(a=G(Math.floor(a),0,255))+G(Math.floor(e),0,255)}Ji.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt(Ji,"SegmentVector");let fT=Pn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mT=Pn([{name:"a_pattern_b",components:4,type:"Uint16"}]),gT=Pn([{name:"a_dash",components:4,type:"Uint16"}]);class Ap{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,s,u,d){this.ids.push(Kv(e)),this.positions.push(s,u,d)}eachPosition(e,s){let u=Kv(e),d=0,m=this.ids.length-1;for(;d<m;){let g=d+m>>1;this.ids[g]>=u?m=g:d=g+1}for(;this.ids[d]===u;)s(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,s){let u=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Qv(u,d,0,u.length-1),s&&(s.add(u.buffer),s.add(d.buffer)),{ids:u,positions:d}}static deserialize(e){let s=new Ap,u;s.ids=e.ids,s.positions=e.positions;for(let d of s.ids)d!==u&&s.uniqueIds.push(d),u=d;return s.indexed=!0,s}}function Kv(a){let e=+a;return Number.isSafeInteger(e)?e:Wf(String(a))}function Qv(a,e,s,u){for(;s<u;){let d=a[s+u>>1],m=s-1,g=u+1;for(;;){do m++;while(a[m]<d);do g--;while(a[g]>d);if(m>=g)break;Qm(a,m,g),Qm(e,3*m,3*g),Qm(e,3*m+1,3*g+1),Qm(e,3*m+2,3*g+2)}g-s<u-g?(Qv(a,e,s,g),s=g+1):(Qv(a,e,g+1,u),u=g)}}function Qm(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}kt(Ap,"FeaturePositionMap");class Jl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}set(e,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Jm extends Jl{constructor(e){super(e),this.current=0}set(e,s,u){this.fetchUniformLocation(e,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Wr extends Jl{constructor(e){super(e),this.current=0}set(e,s,u){this.fetchUniformLocation(e,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class vl extends Jl{constructor(e){super(e),this.current=[0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Pp extends Jl{constructor(e){super(e),this.current=[0,0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class eg extends Jl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Op extends Jl{constructor(e){super(e),this.current=ci.transparent.toPremultipliedRenderColor(null)}set(e,s,u){this.fetchUniformLocation(e,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let _T=new Float32Array(16);class Rp extends Jl{constructor(e){super(e),this.current=_T}set(e,s,u){if(this.fetchUniformLocation(e,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}let tg=new Float32Array(9),vT=new Float32Array(4);class ng extends Jl{constructor(e){super(e),this.current=vT}set(e,s,u){if(this.fetchUniformLocation(e,s)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Jv(a){return[Km(255*a.r,255*a.g),Km(255*a.b,255*a.a)]}function kp(a,e,s,u,d,m,g,v){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new Ni(0,{brightness:m,worldview:v}),e,s,d,u,g)==="none":a.value==="none")}class Fp{constructor(e,s,u,d){this.value=e,this.uniformNames=s.map(m=>`u_${m}`),this.type=u,this.context=d}setUniform(e,s,u,d,m){let g=d.constantOr(this.value);s.set(e,m,g instanceof ci?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,s){return this.type==="color"?new Op(e):new Wr(e)}}class nh{constructor(e,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,s){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(e,s,u,d,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&s.set(e,m,g)}getBinding(e,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new eg(e):new Wr(e)}}class ec{constructor(e,s,u,d){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,s,u,d,m,g,v,b){let C=this.paintVertexArray.length,T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ni(0,{brightness:g,worldview:b}),s,{},m,d,v):this.expression.kind==="constant"&&this.expression.value,I=kp(this.lutExpression,s,{},d,m,g,v,b);this.paintVertexArray.resize(e),this._setPaintValue(C,e,T,I?null:this.context.lut)}updatePaintArray(e,s,u,d,m,g,v,b){let C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},u,d,void 0,m):this.expression.kind==="constant"&&this.expression.value,T=kp(this.lutExpression,u,d,m,void 0,v,void 0,b);this._setPaintValue(e,s,C,T?null:this.context.lut)}_setPaintValue(e,s,u,d){if(this.type==="color"){let m=Jv(u.toPremultipliedRenderColor(d));for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tc{constructor(e,s,u,d,m,g){this.expression=e,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=d,this.context=m,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,s,u,d,m,g,v,b){let C=this.expression.evaluate(new Ni(this.context.zoom,{brightness:g,worldview:b}),s,{},m,d,v),T=this.expression.evaluate(new Ni(this.context.zoom+1,{brightness:g,worldview:b}),s,{},m,d,v),I=kp(this.lutExpression,s,{},d,m,g,v,b),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,C,T,I?null:this.context.lut)}updatePaintArray(e,s,u,d,m,g,v,b){let C=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},u,d,void 0,m),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},u,d,void 0,m),I=kp(this.lutExpression,u,d,m,void 0,v,void 0,b);this._setPaintValue(e,s,C,T,I?null:this.context.lut)}_setPaintValue(e,s,u,d,m){if(this.type==="color"){let g=Jv(u.toPremultipliedRenderColor(m)),v=Jv(u.toPremultipliedRenderColor(m));for(let b=e;b<s;b++)this.paintVertexArray.emplace(b,g[0],g[1],v[0],v[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,u,d,m){let g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=G(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(e,m,v)}getBinding(e,s){return new Wr(e)}}class nc{constructor(e,s,u,d,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(u==="array"?gT:fT).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new d,this.paintTransitionVertexArray=new id}populatePaintArray(e,s,u,d){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(e,s,u,d,m,g,v){this._setPaintValues(e,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(e,s,u,d){if(!d||!u)return;let m=d[u[0]],g=d[u[1]];if(m){if(m){let{tl:v,br:b,pixelRatio:C}=m;for(let T=e;T<s;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1],C)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:v,br:b}=g;for(let C=e;C<s;C++)this.paintTransitionVertexArray.emplace(C,v[0],v[1],b[0],b[1])}}}upload(e){let s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,mT.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Qc{constructor(e,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;let d=[];for(let m in e.paint._values){let g=e.paint.get(m);if(m.endsWith("-use-theme")||!u(m)||!(g instanceof Qu&&xp(g.property.specification)))continue;let v=xT(m,e.type),b=g.value,C=g.property.specification.type,T=!!g.property.useIntegerZoom,I=m==="line-dasharray"||m.endsWith("pattern"),D=e.paint.get(`${m}-use-theme`),P=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||I){let R=e0(m,C,"source");this.binders[m]=I?new nc(b,v,C,R,e.id):new ec(b,v,C,R),d.push(`/a_${m}`)}else{let R=e0(m,C,"composite");this.binders[m]=new tc(b,v,C,T,s,R),d.push(`/z_${m}`)}else this.binders[m]=I?new nh(b.value,v):new Fp(b.value,v,C,s),d.push(`/u_${m}`);D&&(this.binders[m].lutExpression=D.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){let s=this.binders[e];return s instanceof ec||s instanceof tc?s.maxValue:0}populatePaintArrays(e,s,u,d,m,g,v,b){for(let C in this.binders){let T=this.binders[C];T.context=this.context,(T instanceof ec||T instanceof tc||T instanceof nc)&&T.populatePaintArray(e,s,u,d,m,g,v,b)}}setConstantPatternPositions(e,s){for(let u in this.binders){let d=this.binders[u];d instanceof nh&&d.setConstantPatternPositions(e,s)}}getPatternTransitionVertexBuffer(e){let s=this.binders[e];return s instanceof nc?s.paintTransitionVertexBuffer:null}updatePaintArrays(e,s,u,d,m,g,v,b,C,T){let I=!1,D=Object.keys(e),P=D.length!==0&&!b,R=P?D:s.uniqueIds;this.context.lut=m.lut;for(let z in this.binders){let H=this.binders[z];if(H.context=this.context,(H instanceof ec||H instanceof tc||H instanceof nc)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){let $=m.paint.get(z);H.expression=$.value;for(let Z of R){let Y=e[Z.toString()];s.eachPosition(Z,(te,he,ae)=>{let me=d.feature(te);H.updatePaintArray(he,ae,me,Y,g,v,C,T)})}if(!P)for(let Z of u.uniqueIds){let Y=e[Z.toString()];u.eachPosition(Z,(te,he,ae)=>{let me=d.feature(te);H.updatePaintArray(he,ae,me,Y,g,v,C,T)})}I=!0}}return I}defines(){let e=[];for(let s in this.binders){let u=this.binders[s];(u instanceof Fp||u instanceof nh)&&e.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let s=[];for(let u in this.binders){let d=this.binders[u];if(d instanceof Fp||d instanceof nh||d instanceof tc)for(let m of d.uniformNames)s.push({name:m,property:u,binding:d.getBinding(e,m)})}return s}setUniforms(e,s,u,d,m){for(let{name:g,property:v,binding:b}of u)this.binders[v].setUniform(e,b,m,d.get(v),g)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let s=this.binders[e];(s instanceof ec||s instanceof tc||s instanceof nc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof nc&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(e){for(let s in this.binders){let u=this.binders[s];(u instanceof ec||u instanceof tc||u instanceof nc)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let s=this.binders[e];(s instanceof ec||s instanceof tc||s instanceof nc)&&s.destroy()}}}class ja{constructor(e,s,u=()=>!0){this.programConfigurations={};for(let d of e)this.programConfigurations[d.id]=new Qc(d,s,u);this.needsUpload=!1,this._featureMap=new Ap,this._featureMapWithoutIds=new Ap,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,s,u,d,m,g,v,b,C){for(let T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,s,d,m,g,v,b,C);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,u,d,m,g,v,b){for(let C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,s,C,d,m,g,v||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let yT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function xT(a,e){return yT[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}let bT={"line-pattern":{source:ws,composite:ws},"fill-pattern":{source:ws,composite:ws},"fill-extrusion-pattern":{source:ws,composite:ws},"line-dasharray":{source:id,composite:id}},wT={color:{source:_l,composite:Yc},number:{source:Ql,composite:_l}};function e0(a,e,s){let u=bT[a];return u&&u[s]||wT[e][s]}kt(Fp,"ConstantBinder"),kt(nh,"PatternConstantBinder"),kt(ec,"SourceExpressionBinder"),kt(nc,"PatternCompositeBinder"),kt(tc,"CompositeExpressionBinder"),kt(Qc,"ProgramConfiguration",{omit:["_buffers"]}),kt(ja,"ProgramConfigurationSet");let Bo=_t/Math.PI/2,_a=5,ig=6,CT=16383,ih=64,t0=[ih,32,16],va=-Bo,ya=Bo;function od(a,e,s,u=Bo){return s=Zn(s),[a*Math.sin(s)*u,-e*u,a*Math.cos(s)*u]}function rh(a,e,s){return od(Math.cos(Zn(a)),Math.sin(Zn(a)),e,s)}let p=63710088e-1,o=2*Math.PI*p;class c{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let s=Math.PI/180,u=this.lat*s,d=e.lat*s,m=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((e.lng-this.lng)*s);return p*Math.acos(Math.min(m,1))}toBounds(e=0){let s=360*e/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new f({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(e){return rh(this.lat,this.lng,Bo+e*Bo/p)}static convert(e){if(e instanceof c)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new c(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new c(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class f{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof c?new c(e.lng,e.lat):c.convert(e),this}setSouthWest(e){return this._sw=e instanceof c?new c(e.lng,e.lat):c.convert(e),this}extend(e){let s=this._sw,u=this._ne,d,m;if(e instanceof c)d=e,m=e;else{if(!(e instanceof f))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(f.convert(e)):this.extend(c.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(c.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new c(d.lng,d.lat),this._ne=new c(m.lng,m.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:s,lat:u}=c.convert(e),d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){if(e)return e instanceof f?e:new f(e)}}let _=0,y=25.5;function x(a){return o*Math.cos(a*Math.PI/180)}function w(a){return(180+a)/360}function S(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function M(a,e){return a/x(e)}function A(a){return 360*a-180}function F(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function k(a,e){return a*x(F(e))}let L=85.051129;function j(a){return Math.cos(Zn(G(a,-L,L)))}function V(a,e){let s=G(e,_,y),u=Math.pow(2,s);return j(a)*o/(512*u)}function W(a){return 1/Math.cos(a*Math.PI/180)}function q(a,e=0){let s=Math.exp(Math.PI*(1-(a.y+e/_t)/(1<<a.z)*2));return 80150034*s/(s*s+1)/_t/(1<<a.z)}class J{constructor(e,s,u=0){this.x=+e,this.y=+s,this.z=+u}static fromLngLat(e,s=0){let u=c.convert(e);return new J(w(u.lng),S(u.lat),M(s,u.lat))}toLngLat(){return new c(A(this.x),F(this.y))}toAltitude(){return k(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*W(F(this.y))}}function ie(a,e,s,u,d,m,g,v,b){let C=(e+u)/2,T=(s+d)/2,I=new it(C,T);v(I),(function(D,P,R,z,H,$){let Z=R-H,Y=z-$;return Math.abs((z-P)*Z-(R-D)*Y)/Math.hypot(Z,Y)})(I.x,I.y,m.x,m.y,g.x,g.y)>=b?(ie(a,e,s,C,T,m,I,v,b),ie(a,C,T,u,d,I,g,v,b)):a.push(g)}function ee(a,e,s){let u=a[0],d=u.x,m=u.y;e(u);let g=[u];for(let v=1;v<a.length;v++){let b=a[v],{x:C,y:T}=b;e(b),ie(g,d,m,C,T,u,b,e,s),d=C,m=T,u=b}return g}function ge(a,e,s,u){if(u(e,s)){let d=e.add(s)._mult(.5);ge(a,e,d,u),ge(a,d,s,u)}else a.push(s)}function de(a,e){let s=a[0],u=[s];for(let d=1;d<a.length;d++){let m=a[d];ge(u,s,m,e),s=m}return u}let fe=Math.pow(2,14)-1,ue=-fe-1;function se(a,e){let s=Math.round(a.x*e),u=Math.round(a.y*e);return a.x=G(s,ue,fe),a.y=G(u,ue,fe),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function _e(a,e,s){let u=a.loadGeometry(),d=a.extent,m=_t/d;if(e&&s&&s.projection.isReprojectedInTileSpace){let g=1<<e.z,{scale:v,x:b,y:C,projection:T}=s,I=D=>{let P=A((e.x+D.x/d)/g),R=F((e.y+D.y/d)/g),z=T.project(P,R);D.x=(z.x*v-b)*d,D.y=(z.y*v-C)*d};for(let D=0;D<u.length;D++)if(a.type!==1)u[D]=ee(u[D],I,1);else{let P=[];for(let R of u[D])R.x<0||R.x>=d||R.y<0||R.y>=d||(I(R),P.push(R));u[D]=P}}for(let g of u)for(let v of g)se(v,m);return u}function Se(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?_e(a):[]}}class Ce{constructor(e,s,u,d,m){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=m,e.readFields(Be,this,s)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let s=e.readVarint()+e.pos,u=[],d,m=1,g=0,v=0,b=0;for(;e.pos<s;){if(g<=0){let C=e.readVarint();m=7&C,g=C>>3}if(g--,m===1||m===2)v+=e.readSVarint(),b+=e.readSVarint(),m===1&&(d&&u.push(d),d=[]),d&&d.push(new it(v,b));else{if(m!==7)throw new Error(`unknown command ${m}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){let e=this._pbf;e.pos=this._geometry;let s=e.readVarint()+e.pos,u=1,d=0,m=0,g=0,v=1/0,b=-1/0,C=1/0,T=-1/0;for(;e.pos<s;){if(d<=0){let I=e.readVarint();u=7&I,d=I>>3}if(d--,u===1||u===2)m+=e.readSVarint(),g+=e.readSVarint(),m<v&&(v=m),m>b&&(b=m),g<C&&(C=g),g>T&&(T=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[v,C,b,T]}toGeoJSON(e,s,u){let d=this.extent*Math.pow(2,u),m=this.extent*e,g=this.extent*s,v=this.loadGeometry();function b(D){return[360*(D.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+g)/d)*Math.PI))-90]}function C(D){return D.map(b)}let T;if(this.type===1){let D=[];for(let R of v)D.push(R[0]);let P=C(D);T=D.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){let D=v.map(C);T=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{let D=(function(R){let z=R.length;if(z<=1)return[R];let H=[],$,Z;for(let Y=0;Y<z;Y++){let te=Ue(R[Y]);te!==0&&(Z===void 0&&(Z=te<0),Z===te<0?($&&H.push($),$=[R[Y]]):$&&$.push(R[Y]))}return $&&H.push($),H})(v),P=[];for(let R of D)P.push(R.map(C));T=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}let I={type:"Feature",geometry:T,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Be(a,e,s){a===1?e.id=s.readVarint():a===2?(function(u,d){let m=u.readVarint()+u.pos;for(;u.pos<m;){let g=d._keys[u.readVarint()],v=d._values[u.readVarint()];d.properties[g]=v}})(s,e):a===3?e.type=s.readVarint():a===4&&(e._geometry=s.pos)}function Ue(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}Ce.types=["Unknown","Point","LineString","Polygon"];class Ze{constructor(e,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(lt,this,s),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let s=this._pbf.readVarint()+this._pbf.pos;return new Ce(this._pbf,s,this.extent,this._keys,this._values)}}function lt(a,e,s){a===15?e.version=s.readVarint():a===1?e.name=s.readString():a===5?e.extent=s.readVarint():a===2?e._features.push(s.pos):a===3?e._keys.push(s.readString()):a===4&&e._values.push((function(u){let d=null,m=u.readVarint()+u.pos;for(;u.pos<m;){let g=u.readVarint()>>3;d=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(s))}class ke{constructor(e,s){this.layers=e.readFields(be,{},s)}}function be(a,e,s){if(a===3){let u=new Ze(s,s.readVarint()+s.pos);u.length&&(e[u.name]=u)}}let He="3d_elevation_id",Le="level";class Je{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,s){return this._valid&&e(s(this._geometry)),this}require(e,s,u){return this.get(e,!0,s,u)}optional(e,s,u){return this.get(e,!1,s,u)}success(){return this._valid}get(e,s,u,d){let m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?u(d?d(m):m):s&&(this._valid=!1),this}}class yt{constructor(e,s){this.featureFunc=e,this.vertexFunc=s}parseFeature(e,s,u){return this.featureFunc(e,s,u)}parseVertex(e,s,u){return this.vertexFunc(e,s,u)}}let Mt=new yt((a,e,s)=>a.reset(e).require(He,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},ct.decodeRelativeHeight).geometry(u=>{s.bounds=u},ql).success(),(a,e,s)=>a.reset(e).require(He,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},ct.decodeRelativeHeight).geometry(u=>{s.position=u},ct.getPoint).success()),pt=new yt((a,e,s)=>a.reset(e).require(He,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},ct.decodeMetricHeight).geometry(u=>{s.bounds=u},ql).success(),(a,e,s)=>a.reset(e).require(He,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},ct.decodeMetricHeight).geometry(u=>{s.position=u},ct.getPoint).success());class ct{static getPoint(e){return vs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?pt:void 0:Mt}static parse(e){let s=[],u=[],d=e.length,m=new Je;for(let g=0;g<d;g++){let v=e.feature(g),b=v.properties.version,C=ct.getVersionSchema(b);if(C===void 0){Dt(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}let T=v.properties.type;if(!T)continue;let I=Ce.types[v.type];if(I==="Point"&&T==="curve_point"){let D={};C.parseVertex(m,v,D)&&s.push(D)}else if(I==="Polygon"&&T==="curve_meta"){let D={};C.parseFeature(m,v,D)&&u.push(D)}}return{vertices:s,features:u}}}class Vt{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,u){let d=Fu(s,this.dir);if(Math.abs(d)<1e-6)return!1;let m=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1])/d;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,!0}}class Lt{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,u){let d=Sr(s,this.dir);if(Math.abs(d)<1e-6)return!1;let m=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/d;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,s,u){if((function(P,R){var z=P[0],H=P[1],$=P[2],Z=R[0],Y=R[1],te=R[2];return Math.abs(z-Z)<=E*Math.max(1,Math.abs(z),Math.abs(Z))&&Math.abs(H-Y)<=E*Math.max(1,Math.abs(H),Math.abs(Y))&&Math.abs($-te)<=E*Math.max(1,Math.abs($),Math.abs(te))})(this.pos,e)||s===0)return u[0]=u[1]=u[2]=0,!1;let[d,m,g]=this.dir,v=this.pos[0]-e[0],b=this.pos[1]-e[1],C=this.pos[2]-e[2],T=d*d+m*m+g*g,I=2*(v*d+b*m+C*g),D=I*I-4*T*(v*v+b*b+C*C-s*s);if(D<0){let P=Math.max(-I/2,0),R=v+d*P,z=b+m*P,H=C+g*P,$=Math.hypot(R,z,H);return u[0]=R*s/$,u[1]=z*s/$,u[2]=H*s/$,!1}{let P=(-I-Math.sqrt(D))/(2*T);if(P<0){let R=Math.hypot(v,b,C);return u[0]=v*s/R,u[1]=b*s/R,u[2]=C*s/R,!1}return u[0]=v+d*P,u[1]=b+m*P,u[2]=C+g*P,!0}}}class St{constructor(e,s,u,d,m){this.TL=e,this.TR=s,this.BR=u,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(e,s,u){let d=[-1,1,1],m=[1,1,1],g=[1,-1,1],v=[-1,-1,1],b=Pr(d,d,e),C=Pr(m,m,e),T=Pr(g,g,e),I=Pr(v,v,e);return new St(b,C,T,I,s/u)}}function At(a,e,s){let u=1/0,d=-1/0,m=[];for(let g of a){kr(m,g,e);let v=Sr(m,s);u=Math.min(u,v),d=Math.max(d,v)}return[u,d]}function Jt(a,e){let s=!0;for(let u=0;u<a.planes.length;u++){let d=a.planes[u],m=0;for(let g=0;g<e.length;g++)m+=+(Sr(d,e[g])+d[3]>=0);if(m===0)return 0;m!==e.length&&(s=!1)}return s?2:1}function pn(a,e){for(let s of a.projections){let u=At(e,a.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Fn(a,e){let s=0,u=[0,0,0,0];for(let g=0;g<a.length;g++)u[0]=a[g][0],u[1]=a[g][1],u[2]=a[g][2],u[3]=1,(d=u)[0]*(m=e)[0]+d[1]*m[1]+d[2]*m[2]+d[3]*m[3]>=0&&s++;var d,m;return s}class Jn{constructor(e,s){this.points=e||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=Ut.fromPoints(this.points),this.projections=[],this.frustumEdges=[kr([],this.points[2],this.points[3]),kr([],this.points[0],this.points[3]),kr([],this.points[4],this.points[0]),kr([],this.points[5],this.points[1]),kr([],this.points[6],this.points[2]),kr([],this.points[7],this.points[3])];for(let u of this.frustumEdges){let d=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:d,projection:At(this.points,this.points[0],d)}),this.projections.push({axis:m,projection:At(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,s,u,d){let m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{let T=Lo([],C,e),I=1/T[3]/s*m;return(D=T)[0]=(P=T)[0]*(R=[I,I,d?1/T[3]:I,I])[0],D[1]=P[1]*R[1],D[2]=P[2]*R[2],D[3]=P[3]*R[3],D;var D,P,R}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{let T=ji([],Fo([],kr([],g[C[0]],g[C[1]]),kr([],g[C[2]],g[C[1]]))),I=-Sr(T,g[C[1]]);return T.concat(I)}),b=[];for(let C=0;C<g.length;C++)b.push([g[C][0],g[C][1],g[C][2]]);return new Jn(b,v)}intersectsPrecise(e,s,u){for(let d=0;d<s.length;d++)if(!Fn(e,s[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Fn(e,this.planes[d]))return 0;for(let d of u)for(let m of this.frustumEdges){let g=Fo([],d,m),v=ho(g);if(v===0)continue;ur(g,g,1/v);let b=At(this.points,this.points[0],g),C=At(e,this.points[0],g);if(b[0]>C[1]||C[0]>b[1])return 0}return 1}containsPoint(e){for(let s of this.planes){let u=s[3];if(Sr([s[0],s[1],s[2]],e)+u<0)return!1}return!0}}class Ut{static fromPoints(e){let s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let d of e)rl(s,s,d),Oa(u,u,d);return new Ut(s,u)}static fromTileIdAndHeight(e,s,u){let d=1<<e.canonical.z,m=e.canonical.x,g=e.canonical.y;return new Ut([m/d,g/d,s],[(m+1)/d,(g+1)/d,u])}static applyTransform(e,s){let u=e.getCorners();for(let d=0;d<u.length;++d)Pr(u[d],u[d],s);return Ut.fromPoints(u)}static applyTransformFast(e,s){let u=[s[12],s[13],s[14]],d=[...u];for(let m=0;m<3;m++)for(let g=0;g<3;g++){let v=s[4*g+m],b=v*e.min[g],C=v*e.max[g];u[m]+=Math.min(b,C),d[m]+=Math.max(b,C)}return new Ut(u,d)}static projectAabbCorners(e,s){let u=e.getCorners();for(let d=0;d<u.length;++d)Pr(u[d],u[d],s);return u}constructor(e,s){this.min=e,this.max=s,this.center=ur([],jr([],this.min,this.max),.5)}quadrant(e){let s=[e%2==0,e<2],u=Ff(this.min),d=Ff(this.max);for(let m=0;m<s.length;m++)u[m]=s[m]?this.min[m]:this.center[m],d[m]=s[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Ut(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Jt(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Jt(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,s){return s||this.intersects(e)?pn(e,this.getCorners()):0}intersectsPreciseFlat(e,s){return s||this.intersectsFlat(e)?pn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let s=0;s<3;++s)if(this.min[s]>e.max[s]||e.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e.min[s]),this.max[s]=Math.max(this.max[s],e.max[s])}encapsulatePoint(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e[s]),this.max[s]=Math.max(this.max[s],e[s])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}kt(Ut,"Aabb");class Xn{constructor(e,s){this.feature=e,this.metersToTile=s,this.index=0}get(){let e=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],d=-s[0],m=(e.extent+1)*this.metersToTile;return[new it(Math.trunc(e.position[0]+u*m),Math.trunc(e.position[1]+d*m)),new it(Math.trunc(e.position[0]-u*m),Math.trunc(e.position[1]-d*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class hn{constructor(e,s,u,d,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[po(),po(),po(),po(),po(),po(),po()],this.id=e,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(C=this.vertices[v.b].position)[0]&&b[1]===C[1]);var b,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let v of this.vertices)this.vertexProps.push({dir:vs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(let v of this.edges){let b=this.vertices[v.a].position,C=this.vertices[v.b].position,T=ol(po(),C,b),I=ka(T),D=Ul(po(),T,1/I);this.edgeProps.push({vec:T,dir:D,len:I});let P=this.vertexProps[v.a].dir,R=this.vertexProps[v.b].dir;kc(P,P,D),kc(R,R,D)}for(let v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Yh(v.dir,v.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;let s=this.getClosestEdge(e);if(s==null)return 0;let[u,d]=s;return on(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(e,s){let u=this.getClosestEdge(e);if(!u)return vr(0,0,1);let d=u[0],m=this.edges[d],g=this.edgeProps[d].vec,v=vr(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*s),b=vr(v[1],-v[0],0);Fo(b,b,v);let C=ho(b);return C>0?ur(b,b,1/C):Yi(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,d=0,[m,g,v,b,C,T,I]=this._tmpVec2;Xh(I,e.x,e.y);let D=new Vt(I,null);for(let P=0;P<this.edges.length;P++){let R=this.edges[P],z=this.edgeProps[P].dir;D.dir=z;let H=this.vertices[R.a].position,$=this.vertices[R.b].position,Z=D.intersectsPlane(H,this.vertexProps[R.a].dir,m),Y=D.intersectsPlane($,this.vertexProps[R.b].dir,g);if(!Z||!Y)continue;ol(v,g,m),ol(b,I,m);let te=Fu(v,v),he=te>0?Fu(b,v)/te:0,ae=G(he,0,1),me=Math.abs((he-ae)*this.edgeProps[P].len);ol(C,I,H),Xh(T,z[1],-z[0]);let ye=me+Math.abs(Fu(C,T));ye<u&&(s=P,u=ye,d=ae)}return[s,d]}tessellate(e){let s=gi(),u=gi(),d=gi(),m=gi();for(let g=this.edges.length-1;g>=0;--g){let v=this.edges[g].a,b=this.edges[g].b,{position:C,height:T,extent:I}=this.vertices[v],{position:D,height:P,extent:R}=this.vertices[b],z=this.vertexProps[v].dir,H=this.vertexProps[b].dir;if(Yi(s,C[0]/e,C[1]/e,T),Yi(u,D[0]/e,D[1]/e,P),Yi(d,z[1],-z[0],0),ur(d,d,I),Yi(m,H[1],-H[0],0),ur(m,m,R),this.distSqLines(vr(s[0]+.5*d[0],s[1]+.5*d[1],s[2]+.5*d[2]),vr(u[0]-.5*m[0],u[1]-.5*m[1],u[2]-.5*m[2]),vr(s[0]-.5*d[0],s[1]-.5*d[1],s[2]-.5*d[2]),vr(u[0]+.5*m[0],u[1]+.5*m[1],u[2]+.5*m[2]))<=.0025000000000000005)continue;let $=this.vertices.length,Z=kc(po(),C,D);this.vertices.push({position:Ul(Z,Z,.5),height:.5*(T+P),extent:.5*(I+R)});let Y=kc(po(),z,H);this.vertexProps.push({dir:Yh(Y,Y)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:v,b:$}),this.edges.push({a:$,b});let te=ol(po(),this.vertices[$].position,C),he=ka(te),ae={vec:te,dir:Ul(po(),te,1/he),len:he};this.edgeProps.push(ae),this.edgeProps.push(ae)}}distSqLines(e,s,u,d){let m=il(gi(),s,e),g=il(gi(),d,u),v=il(gi(),e,u),b=Sr(m,m),C=Sr(m,g),T=Sr(m,v),I=Sr(g,g),D=Sr(g,v),P=b*I-C*C;if(P===0)return Zh(Au(m,u,d,Sr(v,g)/Sr(g,g)),e);let R=(b*D-C*T)/P;return Zh(Au(m,e,s,(C*D-T*I)/P),Au(g,u,d,R))}}class ii{static parseFrom(e,s){let u=ct.parse(e);if(!u)return[];let{vertices:d,features:m}=u,g=1/q(s);m.sort((T,I)=>T.id-I.id),d.sort((T,I)=>T.id-I.id||T.idx-I.idx),d=d.filter((T,I,D)=>I===D.findIndex(P=>P.id===T.id&&P.idx===T.idx));let v=new Array,b=0,C=d.length;for(let T of m){if(T.constantHeight){v.push(new hn(T.id,T.bounds,T.constantHeight));continue}for(;b!==C&&d[b].id<T.id;)b++;if(b===C||d[b].id!==T.id)continue;let I=new Array,D=new Array,P=b;for(;b!==C&&d[b].id===T.id;){let R=d[b];if(I.push({position:R.position,height:R.height,extent:R.extent}),b!==P&&d[b-1].idx===R.idx-1){let z=b-P;D.push({a:z-1,b:z})}b++}v.push(new hn(T.id,T.bounds,void 0,I,D,g))}return v}static getElevationFeature(e,s){if(!s)return;let u=+e.properties[He];return Number.isNaN(u)?void 0:s.find(d=>d.id===u)}}class fi{constructor(e,s){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(s)||(this.zScale=Math.pow(2,s.z-e.z),this.xOffset=(e.x*this.zScale-s.x)*_t,this.yOffset=(e.y*this.zScale-s.y)*_t)}constantElevation(e,s){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,s)}pointElevation(e,s,u){let d=this.constantElevation(s,u);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(e),u))}computeBiasedHeight(e,s){return s<=0?e:e+s*X(0,s,e>=0?e:Math.abs(.5*e))}}kt(hn,"ElevationFeature");class ui{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xc,this.indexArray=new qr,this.segments=new Ji,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ql),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){let m=this.layers[0],g=[],v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(let{feature:C,id:T,index:I,sourceLayerIndex:D}of e){let P=this.layers[0]._featureFilter.needGeometry,R=Se(C,P);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;let z=v?v.evaluate(R,{},u):void 0,H={id:T,properties:C.properties,type:C.type,sourceLayerIndex:D,index:I,geometry:P?R.geometry:_e(C,u,d),patterns:{},sortKey:z};g.push(H)}v&&g.sort((C,T)=>C.sortKey-T.sortKey);let b=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Vm,b=d.projection);for(let C of g){let{geometry:T,index:I,sourceLayerIndex:D}=C,P=e[I].feature;this.addFeature(C,T,I,s.availableImages,u,b,s.brightness,s.elevationFeatures),s.featureIndex.insert(P,T,I,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ub.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,pT.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,s,u,d,m,g,v,b){let C;this.elevationMode!=="none"&&(C=ii.getElevationFeature(e,b));for(let T of s)for(let I of T){let D=I.x,P=I.y;if(D<0||D>=_t||P<0||P>=_t)continue;if(g){let H=g.projectTilePoint(D,P,m),$=g.upVector(m,D,P);this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$)}let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=R.vertexLength;if(this.addCircleVertex(D,P,-1,-1),this.addCircleVertex(D,P,1,-1),this.addCircleVertex(D,P,1,1),this.addCircleVertex(D,P,-1,1),this.elevationMode!=="none"){let H=C?C.pointElevation(new it(D,P)):0;this.hasElevation=this.hasElevation||H!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},d,m,v,void 0,this.worldview)}addCircleVertex(e,s,u,d){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*s+(d+1)/2)}addGlobeExtVertex(e,s){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Wn(a,e){for(let s=0;s<a.length;s++)if(Ei(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(Ei(a,e[s]))return!0;return!!qi(a,e)}function bn(a,e,s){return!!Ei(a,e)||!!Bi(e,a,s)}function ti(a,e){if(a.length===1)return er(e,a[0]);for(let s=0;s<e.length;s++){let u=e[s];for(let d=0;d<u.length;d++)if(Ei(a,u[d]))return!0}for(let s=0;s<a.length;s++)if(er(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(qi(a,e[s]))return!0;return!1}function ar(a,e,s){if(a.length>1){if(qi(a,e))return!0;for(let u=0;u<e.length;u++)if(Bi(e[u],a,s))return!0}for(let u=0;u<a.length;u++)if(Bi(a[u],e,s))return!0;return!1}function qi(a,e){if(a.length===0||e.length===0)return!1;for(let s=0;s<a.length-1;s++){let u=a[s],d=a[s+1];for(let m=0;m<e.length-1;m++)if(ri(u,d,e[m],e[m+1]))return!0}return!1}function ri(a,e,s,u){return xn(a,s,u)!==xn(e,s,u)&&xn(a,e,s)!==xn(a,e,u)}function jn(a,e,s){return(a.x-s.x)*(e.y-s.y)-(a.y-s.y)*(e.x-s.x)}function wn(a,e,s,u){let d=jn(a,e,u),m=jn(a,e,s);if(Math.sign(d)===Math.sign(m))return;let g=jn(s,u,a),v=g+m-d;return Math.sign(g)!==Math.sign(v)?[g/(g-v),m/(m-d)]:void 0}function Bi(a,e,s){let u=s*s;if(e.length===1)return a.distSqr(e[0])<u;for(let d=1;d<e.length;d++)if(br(a,e[d-1],e[d])<u)return!0;return!1}function br(a,e,s){let u=e.distSqr(s);if(u===0)return a.distSqr(e);let d=((a.x-e.x)*(s.x-e.x)+(a.y-e.y)*(s.y-e.y))/u;return a.distSqr(d<0?e:d>1?s:s.sub(e)._mult(d)._add(e))}function er(a,e){let s,u,d,m=!1;for(let g=0;g<a.length;g++){s=a[g];for(let v=0,b=s.length-1;v<s.length;b=v++)u=s[v],d=s[b],u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(m=!m)}return m}function Ei(a,e){let s=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){let m=a[u],g=a[d];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(s=!s)}return s}function us(a,e,s,u,d){for(let g of a)if(e<=g.x&&s<=g.y&&u>=g.x&&d>=g.y)return!0;let m=[new it(e,s),new it(e,d),new it(u,d),new it(u,s)];if(a.length>2){for(let g of m)if(Ei(a,g))return!0}for(let g=0;g<a.length-1;g++)if(Io(a[g],a[g+1],m))return!0;return!1}function Io(a,e,s){let u=s[0],d=s[2];if(a.x<u.x&&e.x<u.x||a.x>d.x&&e.x>d.x||a.y<u.y&&e.y<u.y||a.y>d.y&&e.y>d.y)return!1;let m=xn(a,e,s[0]);return m!==xn(a,e,s[1])||m!==xn(a,e,s[2])||m!==xn(a,e,s[3])}function Zr(a,e,s,u,d,m){let g=e.y-a.y,v=a.x-e.x;if(m=m||0){let b=g*g+v*v;if(b===0)return!0;let C=Math.sqrt(b);g/=C,v/=C}return!((s.x-a.x)*g+(s.y-a.y)*v-m<0||(u.x-a.x)*g+(u.y-a.y)*v-m<0||(d.x-a.x)*g+(d.y-a.y)*v-m<0)}function Vo(a,e,s,u,d,m,g){return!(Zr(a,e,u,d,m,g)||Zr(e,s,u,d,m,g)||Zr(s,a,u,d,m,g)||Zr(u,d,a,e,s,g)||Zr(d,m,a,e,s,g)||Zr(m,u,a,e,s,g))}function Uo(a,e,s){let u=e.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(e.id).getMaxValue(a)}function yo(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Xs(a,e,s,u,d){if(!e[0]&&!e[1])return a;let m=it.convert(e)._mult(d);s==="viewport"&&m._rotate(-u);let g=[];for(let v=0;v<a.length;v++)g.push(a[v].sub(m));return g}function xa(a,e,s,u){let d=it.convert(a)._mult(u);return e==="viewport"&&d._rotate(-s),d}let Es,pr;function Tr(a,e,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}kt(ui,"CircleBucket",{omit:["layers"]});class Si{constructor(e,s,u){this.z=e,this.x=s,this.y=u,this.key=tr(0,e,e,s,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){let s=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>s&&e.y===this.y>>s}url(e,s){let u=(function(m,g,v){var b=Tr(256*m,256*(g=Math.pow(2,v)-g-1),v),C=Tr(256*(m+1),256*(g+1),v);return b[0]+","+b[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),d=(function(m,g,v){let b,C="";for(let T=m;T>0;T--)b=1<<T-1,C+=(g&b?1:0)+(v&b?2:0);return C})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Or{constructor(e,s){this.wrap=e,this.canonical=s,this.key=tr(e,s.z,s.z,s.x,s.y)}}class lr{constructor(e,s,u,d,m){this.overscaledZ=e,this.wrap=s,this.canonical=new Si(u,+d,+m),this.key=s===0&&e===u?this.canonical.key:tr(s,e,u,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let s=this.canonical.z-e;return e>this.canonical.z?new lr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lr(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return tr(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-e;return tr(this.wrap*+s,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new lr(s,this.wrap,s,u,d),new lr(s,this.wrap,s,u+1,d),new lr(s,this.wrap,s,u,d+1),new lr(s,this.wrap,s,u+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Or(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function tr(a,e,s,u,d){let m=1<<Math.min(s,22),g=m*(d%m)+u%m;return a&&s<22&&(g+=m*m*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*g+s)+(e-s)}let ba=[a=>{let e=a.canonical.x-1,s=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,s--),new lr(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,s=a.wrap;return e===1<<a.canonical.z&&(e=0,s++),new lr(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>new lr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new lr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];kt(Si,"CanonicalTileID"),kt(lr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Lp=Pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$a}=Lp,Np=Pn([{name:"a_pos_3",components:3,type:"Int16"}]);var oh=Pn([{name:"a_pos",type:"Int16",components:2}]);function yl(a){return a*Bo/p}let ic=[new Ut([va,va,va],[ya,ya,ya]),new Ut([va,va,va],[0,0,ya]),new Ut([0,va,va],[ya,0,ya]),new Ut([va,0,va],[0,ya,ya]),new Ut([0,0,va],[ya,ya,ya])];function sh(a,e,s,u=!0){let d=ur([],a._camera.position,a.worldSize),m=[e,s,1,1];Lo(m,m,a.pixelMatrixInverse),Oc(m,m,1/m[3]);let g=ji([],kr([],m,d)),v=a.globeMatrix,b=[v[12],v[13],v[14]],C=kr([],b,d),T=ho(C),I=ji([],C),D=a.worldSize/(2*Math.PI),P=Sr(I,g),R=Math.asin(D/T);if(R<Math.acos(P)){if(!u)return null;let je=[],Te=[];ur(je,g,T/P),ji(Te,kr(Te,je,C)),ji(g,jr(g,C,ur(g,Te,Math.tan(R)*T)))}let z=[];new Lt(d,g).closestPointOnSphere(b,D,z);let H=ji([],yr(v,0)),$=ji([],yr(v,1)),Z=ji([],yr(v,2)),Y=Sr(H,z),te=Sr($,z),he=Sr(Z,z),ae=Zo(Math.asin(-te/D)),me=Zo(Math.atan2(Y,he));me=a.center.lng+(function(je,Te){let qe=(Te-je+180)%360-180;return qe<-180?qe+360:qe})(a.center.lng,me);let ye=w(me),we=G(S(ae),0,1);return new J(ye,we)}class Jc{constructor(e,s,u){this.a=kr([],e,u),this.b=kr([],s,u),this.center=u;let d=ji([],this.a),m=ji([],this.b);this.angle=Math.acos(Sr(d,m))}}function rc(a,e){if(a.angle===0)return null;let s;return s=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:(function(u,d,m,g){let v=Math.sin(m);return u*(Math.sin((1-g)*m)/v)+d*(Math.sin(g*m)/v)})(a.a[e],a.b[e],a.angle,G(s,0,1))+a.center[e]}function Ha(a){if(a.z<=1)return ic[a.z+2*a.y+a.x];let e=ET(jb(a));return Ut.fromPoints(e)}function oc(a,e,s){return ur(a,a,1-s),$s(a,a,e,s)}function nO(a,e,s){for(let u of a)Pr(u,u,e),ur(u,u,s)}function iO(a,e,s,u){let d=e/a.worldSize,m=a.globeMatrix;if(s.z<=1){let we=Ha(s).getCorners();return nO(we,m,d),Ut.fromPoints(we)}let g=jb(s,u),v=ET(g,Bo+yl(a._tileCoverLift));nO(v,m,d);let b=Number.MAX_VALUE,C=[-b,-b,-b],T=[b,b,b];if(g.contains(a.center)){for(let Te of v)rl(T,T,Te),Oa(C,C,Te);C[2]=0;let we=a.point,je=[we.x*d,we.y*d,0];return rl(T,T,je),Oa(C,C,je),new Ut(T,C)}if(a._tileCoverLift>0){for(let we of v)rl(T,T,we),Oa(C,C,we);return new Ut(T,C)}let I=[m[12]*d,m[13]*d,m[14]*d],D=g.getCenter(),P=G(a.center.lat,-L,L),R=G(D.lat,-L,L),z=w(a.center.lng),H=S(P),$=z-w(D.lng),Z=H-S(R);$>.5?$-=1:$<-.5&&($+=1);let Y=0;Math.abs($)>Math.abs(Z)?Y=$>=0?1:3:(Y=Z>=0?0:2,$s(I,I,[m[4]*d,m[5]*d,m[6]*d],-Math.sin(Zn(Z>=0?g.getSouth():g.getNorth()))*Bo));let te=v[Y],he=v[(Y+1)%4],ae=new Jc(te,he,I),me=[rc(ae,0)||te[0],rc(ae,1)||te[1],rc(ae,2)||te[2]],ye=ah(a.zoom);if(ye>0){let we=(function({x:Te,y:qe,z:Ye},Ke,rt,st,et){let tt=1/(1<<Ye),Ge=Te*tt,$e=Ge+tt,nt=qe*tt,vt=nt+tt,ut=0,Gt=(Ge+$e)/2-st;return Gt>.5?ut=-1:Gt<-.5&&(ut=1),Ge=((Ge+ut)*Ke-(st*=Ke))*rt+st,$e=(($e+ut)*Ke-st)*rt+st,nt=(nt*Ke-(et*=Ke))*rt+et,vt=(vt*Ke-et)*rt+et,[[Ge,vt,0],[$e,vt,0],[$e,nt,0],[Ge,nt,0]]})(s,e,a._pixelsPerMercatorPixel,z,H);for(let Te=0;Te<v.length;Te++)oc(v[Te],we[Te],ye);let je=jr([],we[Y],we[(Y+1)%4]);ur(je,je,.5),oc(me,je,ye)}for(let we of v)rl(T,T,we),Oa(C,C,we);return T[2]=Math.min(te[2],he[2]),rl(T,T,me),Oa(C,C,me),new Ut(T,C)}function jb({x:a,y:e,z:s},u=!1){let d=1/(1<<s),m=new c(A(a*d),e===(1<<s)-1&&u?-90:F((e+1)*d)),g=new c(A((a+1)*d),e===0&&u?90:F(e*d));return new f(m,g)}function ET(a,e=Bo){let s=Zn(a.getNorth()),u=Zn(a.getSouth()),d=Math.cos(s),m=Math.cos(u),g=Math.sin(s),v=Math.sin(u),b=a.getWest(),C=a.getEast();return[od(m,v,b,e),od(m,v,C,e),od(d,g,C,e),od(d,g,b,e)]}function n0(a,e,s,u){let d=1<<s.z,m=(a/_t+s.x)/d;return rh(F((e/_t+s.y)/d),A(m),u)}function $b({min:a,max:e}){return CT/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}let rO=new Float64Array(16);function Hb(a){let e=$b(a),s=is(rO,[e,e,e]);return Kt(s,s,Dc([],a.min))}function ST(a){let e=(u=a.min,(s=rO)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;let d=1/$b(a);return Hn(e,e,[d,d,d])}function TT(a){let e=_t/(2*Math.PI);return a/(2*Math.PI)/e}function oO(a,e){return _t/(512*Math.pow(2,a))*$b(Ha(e))}function sO(a,e,s,u,d){let m=TT(s),g=[a,e,-s/(2*Math.PI)],v=gt(new Float64Array(16));return Kt(v,v,g),Hn(v,v,[m,m,m]),Er(v,v,Zn(-d)),_r(v,v,Zn(-u)),v}function ah(a){return X(_a,ig,a)}function aO(a,e){let s=rh(e.lat,e.lng),u=(function(R){let z=rh(R._center.lat,R._center.lng),H=Fo([],vr(0,1,0),z),$=zl([],-R.angle,z);H=Pr(H,H,$),zl($,-R._pitch,H);let Z=ji([],z);return ur(Z,Z,yl(R.cameraToCenterDistance/R.pixelsPerMeter)),Pr(Z,Z,$),jr([],z,Z)})(a);return g=(d=il([],u,s))[0],v=d[1],b=d[2],C=(m=s)[0],T=m[1],I=m[2],P=(D=Math.sqrt((g*g+v*v+b*b)*(C*C+T*T+I*I)))&&Sr(d,m)/D,Math.acos(Math.min(Math.max(P,-1),1));var d,m,g,v,b,C,T,I,D,P}function IT(a,e){return aO(a,e)>Math.PI/2*1.01}let lO=Zn(85),r5=Math.cos(lO),o5=Math.sin(lO),s5=Qe(),cO=a=>{let e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function uO(a,e,s,u,d,m,g,v,b){if(m&&a.queryGeometry.isAboveHorizon)return!1;m&&(b*=a.pixelToTileUnitsFactor);let C=a.tileID.canonical,T=s.projection.upVectorScale(C,s.center.lat,s.worldSize).metersToTile;for(let I of e)for(let D of I){let P=D.add(v),R=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(P.x,P.y,!0):0,z=s.projection.projectTilePoint(P.x,P.y,C);if(R>0){let Y=s.projection.upVector(C,P.x,P.y);z.x+=Y[0]*T*R,z.y+=Y[1]*T*R,z.z+=Y[2]*T*R}let H=m?P:a5(z.x,z.y,z.z,u),$=m?a.tilespaceRays.map(Y=>c5(Y,R)):a.queryGeometry.screenGeometry,Z=Lo([],[z.x,z.y,z.z,1],u);if(!g&&m?b*=Z[3]/s.cameraToCenterDistance:g&&!m&&(b*=s.cameraToCenterDistance/Z[3]),m){let Y=F((D.y/_t+C.y)/(1<<C.z));b/=s.projection.pixelsPerMeter(Y,1)/M(1,Y)}if(bn($,H,b))return!0}return!1}function a5(a,e,s,u){let d=Lo([],[a,e,s,1],u);return new it(d[0]/d[3],d[1]/d[3])}let dO=vr(0,0,0),l5=vr(0,0,1);function c5(a,e){let s=gi();return dO[2]=e,a.intersectsPlane(dO,l5,s),new it(s[0],s[1])}class hO extends ui{}let pO,fO,mO,gO;function _O(a,{width:e,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*s*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*s*u);return a.width=e,a.height=s,a.data=d,a}function vO(a,e,s){let{width:u,height:d}=e;u===a.width&&d===a.height||(MT(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,d)},s,null),a.width=u,a.height=d,a.data=e.data)}function MT(a,e,s,u,d,m,g,v){if(d.width===0||d.height===0)return e;if(d.width>a.width||d.height>a.height||s.x>a.width-d.width||s.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||u.x>e.width-d.width||u.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");let b=a.data,C=e.data,T=m===4&&v;for(let I=0;I<d.height;I++){let D=((s.y+I)*a.width+s.x)*m,P=((u.y+I)*e.width+u.x)*m;if(T)for(let R=0;R<d.width;R++){let z=D+R*m+3,H=P+R*m;C[H+0]=255,C[H+1]=255,C[H+2]=255,C[H+3]=b[z]}else if(g)for(let R=0;R<d.width;R++){let z=D+R*m,H=P+R*m,$=new ci(b[z+0]/255,b[z+1]/255,b[z+2]/255,b[z+3]).toNonPremultipliedRenderColor(g).toArray();C[H+0]=$[0],C[H+1]=$[1],C[H+2]=$[2],C[H+3]=$[3]}else for(let R=0;R<d.width*m;R++)C[P+R]=b[D+R]}return e}kt(hO,"HeatmapBucket",{omit:["layers"]});class lh{constructor(e,s){_O(this,e,1,s)}resize(e){vO(this,new lh(e),1)}clone(){return new lh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,d,m){MT(e,s,u,d,m,1,null)}}class jo{constructor(e,s){_O(this,e,4,s)}resize(e){vO(this,new jo(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,d,m,g,v){MT(e,s,u,d,m,4,g,v)}}class yO{constructor(e,s){this.width=e.width,this.height=e.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function i0(a){let e={},s=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new jo({width:s,height:u}),m=(g,v,b)=>{e[a.evaluationKey]=b;let C=a.expression.evaluate(e),T=C?C.toNonPremultipliedRenderColor(null):null;T&&(d.data[g+v+0]=Math.floor(255*T.r),d.data[g+v+1]=Math.floor(255*T.g),d.data[g+v+2]=Math.floor(255*T.b),d.data[g+v+3]=Math.floor(255*T.a))};if(a.clips)for(let g=0,v=0;g<u;++g,v+=4*s)for(let b=0,C=0;b<s;b++,C+=4){let T=b/(s-1),{start:I,end:D}=a.clips[g];m(v,C,I*(1-T)+D*T)}else for(let g=0,v=0;g<s;g++,v+=4)m(0,v,g/(s-1));return d}kt(lh,"AlphaImage"),kt(jo,"RGBAImage");let u5=Pn([{name:"a_pos",components:2,type:"Int16"}],4),d5=Pn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),h5=Pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),p5=Pn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function rg(a,e,s=2){let u=e&&e.length,d=u?e[0]*s:a.length,m=xO(a,0,d,s,!0),g=[];if(!m||m.next===m.prev)return g;let v,b,C;if(u&&(m=(function(T,I,D,P){let R=[];for(let z=0,H=I.length;z<H;z++){let $=xO(T,I[z]*P,z<H-1?I[z+1]*P:T.length,P,!1);$===$.next&&($.steiner=!0),R.push(b5($))}R.sort(v5);for(let z=0;z<R.length;z++)D=y5(R[z],D);return D})(a,e,m,s)),a.length>80*s){v=a[0],b=a[1];let T=v,I=b;for(let D=s;D<d;D+=s){let P=a[D],R=a[D+1];P<v&&(v=P),R<b&&(b=R),P>T&&(T=P),R>I&&(I=R)}C=Math.max(T-v,I-b),C=C!==0?32767/C:0}return r0(m,g,s,v,b,C,0),g}function xO(a,e,s,u,d){let m;if(d===(function(g,v,b,C){let T=0;for(let I=v,D=b-C;I<b;I+=C)T+=(g[D]-g[I])*(g[I+1]+g[D+1]),D=I;return T})(a,e,s,u)>0)for(let g=e;g<s;g+=u)m=EO(g/u|0,a[g],a[g+1],m);else for(let g=s-u;g>=e;g-=u)m=EO(g/u|0,a[g],a[g+1],m);return m&&og(m,m.next)&&(a0(m),m=m.next),m}function zp(a,e){if(!a)return a;e||(e=a);let s,u=a;do if(s=!1,u.steiner||!og(u,u.next)&&go(u.prev,u,u.next)!==0)u=u.next;else{if(a0(u),u=e=u.prev,u===u.next)break;s=!0}while(s||u!==e);return e}function r0(a,e,s,u,d,m,g){if(!a)return;!g&&m&&(function(b,C,T,I){let D=b;do D.z===0&&(D.z=DT(D.x,D.y,C,T,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==b);D.prevZ.nextZ=null,D.prevZ=null,(function(P){let R,z=1;do{let H,$=P;P=null;let Z=null;for(R=0;$;){R++;let Y=$,te=0;for(let ae=0;ae<z&&(te++,Y=Y.nextZ,Y);ae++);let he=z;for(;te>0||he>0&&Y;)te!==0&&(he===0||!Y||$.z<=Y.z)?(H=$,$=$.nextZ,te--):(H=Y,Y=Y.nextZ,he--),Z?Z.nextZ=H:P=H,H.prevZ=Z,Z=H;$=Y}Z.nextZ=null,z*=2}while(R>1)})(D)})(a,u,d,m);let v=a;for(;a.prev!==a.next;){let b=a.prev,C=a.next;if(m?m5(a,u,d,m):f5(a))e.push(b.i,a.i,C.i),a0(a),a=C.next,v=C.next;else if((a=C)===v){g?g===1?r0(a=g5(zp(a),e),e,s,u,d,m,2):g===2&&_5(a,e,s,u,d,m):r0(zp(a),e,s,u,d,m,1);break}}}function f5(a){let e=a.prev,s=a,u=a.next;if(go(e,s,u)>=0)return!1;let d=e.x,m=s.x,g=u.x,v=e.y,b=s.y,C=u.y,T=Math.min(d,m,g),I=Math.min(v,b,C),D=Math.max(d,m,g),P=Math.max(v,b,C),R=u.next;for(;R!==e;){if(R.x>=T&&R.x<=D&&R.y>=I&&R.y<=P&&o0(d,v,m,b,g,C,R.x,R.y)&&go(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function m5(a,e,s,u){let d=a.prev,m=a,g=a.next;if(go(d,m,g)>=0)return!1;let v=d.x,b=m.x,C=g.x,T=d.y,I=m.y,D=g.y,P=Math.min(v,b,C),R=Math.min(T,I,D),z=Math.max(v,b,C),H=Math.max(T,I,D),$=DT(P,R,e,s,u),Z=DT(z,H,e,s,u),Y=a.prevZ,te=a.nextZ;for(;Y&&Y.z>=$&&te&&te.z<=Z;){if(Y.x>=P&&Y.x<=z&&Y.y>=R&&Y.y<=H&&Y!==d&&Y!==g&&o0(v,T,b,I,C,D,Y.x,Y.y)&&go(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,te.x>=P&&te.x<=z&&te.y>=R&&te.y<=H&&te!==d&&te!==g&&o0(v,T,b,I,C,D,te.x,te.y)&&go(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Y&&Y.z>=$;){if(Y.x>=P&&Y.x<=z&&Y.y>=R&&Y.y<=H&&Y!==d&&Y!==g&&o0(v,T,b,I,C,D,Y.x,Y.y)&&go(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;te&&te.z<=Z;){if(te.x>=P&&te.x<=z&&te.y>=R&&te.y<=H&&te!==d&&te!==g&&o0(v,T,b,I,C,D,te.x,te.y)&&go(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function g5(a,e){let s=a;do{let u=s.prev,d=s.next.next;!og(u,d)&&wO(u,s,s.next,d)&&s0(u,d)&&s0(d,u)&&(e.push(u.i,s.i,d.i),a0(s),a0(s.next),s=a=d),s=s.next}while(s!==a);return zp(s)}function _5(a,e,s,u,d,m){let g=a;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&w5(g,v)){let b=CO(g,v);return g=zp(g,g.next),b=zp(b,b.next),r0(g,e,s,u,d,m,0),void r0(b,e,s,u,d,m,0)}v=v.next}g=g.next}while(g!==a)}function v5(a,e){let s=a.x-e.x;return s===0&&(s=a.y-e.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function y5(a,e){let s=(function(d,m){let g=m,v=d.x,b=d.y,C,T=-1/0;if(og(d,g))return g;do{if(og(d,g.next))return g.next;if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){let z=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(z<=v&&z>T&&(T=z,C=g.x<g.next.x?g:g.next,z===v))return C}g=g.next}while(g!==m);if(!C)return null;let I=C,D=C.x,P=C.y,R=1/0;g=C;do{if(v>=g.x&&g.x>=D&&v!==g.x&&bO(b<P?v:T,b,D,P,b<P?T:v,b,g.x,g.y)){let z=Math.abs(b-g.y)/(v-g.x);s0(g,d)&&(z<R||z===R&&(g.x>C.x||g.x===C.x&&x5(C,g)))&&(C=g,R=z)}g=g.next}while(g!==I);return C})(a,e);if(!s)return e;let u=CO(s,a);return zp(u,u.next),zp(s,s.next)}function x5(a,e){return go(a.prev,a,e.prev)<0&&go(e.next,a,a.next)<0}function DT(a,e,s,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function b5(a){let e=a,s=a;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==a);return s}function bO(a,e,s,u,d,m,g,v){return(d-g)*(e-v)>=(a-g)*(m-v)&&(a-g)*(u-v)>=(s-g)*(e-v)&&(s-g)*(m-v)>=(d-g)*(u-v)}function o0(a,e,s,u,d,m,g,v){return!(a===g&&e===v)&&bO(a,e,s,u,d,m,g,v)}function w5(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!(function(s,u){let d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&wO(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1})(a,e)&&(s0(a,e)&&s0(e,a)&&(function(s,u){let d=s,m=!1,g=(s.x+u.x)/2,v=(s.y+u.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&g<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==s);return m})(a,e)&&(go(a.prev,a,e.prev)||go(a,e.prev,e))||og(a,e)&&go(a.prev,a,a.next)>0&&go(e.prev,e,e.next)>0)}function go(a,e,s){return(e.y-a.y)*(s.x-e.x)-(e.x-a.x)*(s.y-e.y)}function og(a,e){return a.x===e.x&&a.y===e.y}function wO(a,e,s,u){let d=qb(go(a,e,s)),m=qb(go(a,e,u)),g=qb(go(s,u,a)),v=qb(go(s,u,e));return d!==m&&g!==v||!(d!==0||!Gb(a,s,e))||!(m!==0||!Gb(a,u,e))||!(g!==0||!Gb(s,a,u))||!(v!==0||!Gb(s,e,u))}function Gb(a,e,s){return e.x<=Math.max(a.x,s.x)&&e.x>=Math.min(a.x,s.x)&&e.y<=Math.max(a.y,s.y)&&e.y>=Math.min(a.y,s.y)}function qb(a){return a>0?1:a<0?-1:0}function s0(a,e){return go(a.prev,a,a.next)<0?go(a,e,a.next)>=0&&go(a,a.prev,e)>=0:go(a,e,a.prev)<0||go(a,a.next,e)<0}function CO(a,e){let s=AT(a.i,a.x,a.y),u=AT(e.i,e.x,e.y),d=a.next,m=e.prev;return a.next=e,e.prev=a,s.next=d,d.prev=s,u.next=s,s.prev=u,m.next=u,u.prev=m,u}function EO(a,e,s,u){let d=AT(a,e,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function a0(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function AT(a,e,s){return{i:a,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function l0(a,e){let s=a.length;if(s<=1)return[a];let u=[],d,m;for(let g=0;g<s;g++){let v=vn(a[g]);v!==0&&(a[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(d&&u.push(d),d=[a[g]]):d.push(a[g]))}if(d&&u.push(d),e>1)for(let g=0;g<u.length;g++)u[g].length<=e||(nm(u[g],e,1,u[g].length-1,C5),u[g]=u[g].slice(0,e));return u}function C5(a,e){return e.area-a.area}function SO(a,e,s=1){if(!a)return null;let u=typeof a=="string"?ss.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(let m of[u,d]){if(!m)continue;let g=m.id.toString();e.has(g)||e.set(g,[]),m.scaleSelf(s),e.get(g).push(m)}return{primary:u.toString(),secondary:d?d.toString():null}}function PT(a,e,s,u){let d=u.patternDependencies,m=!1;for(let g of e){let v=g.paint.get(`${a}-pattern`);v.isConstant()||(m=!0),SO(v.constantOr(null),d,s)&&(m=!0)}return m}function OT(a,e,s,u,d,m){let g=m.patternDependencies;for(let v of e){let b=v.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let C=b.evaluate({zoom:u},s,{},m.availableImages);C=C&&C.name?C.name:C;let T=SO(C,g,d);if(!T)continue;let{primary:I,secondary:D}=T;I&&(s.patterns[v.id]=[I,D].filter(Boolean))}}return s}class TO{constructor(){this.polygons=new Map}add(e,...s){let u=this.polygons.get(e);u?u.push(...s):this.polygons.set(e,s)}merge(e){for(let[s,u]of e.polygons)this.add(s,...u)}}class sd{constructor(){this.portals=[]}static isOnBorder(e,s){return e<=0&&s<=0||e>=_t&&s>=_t}static evaluate(e){if(e.length===0)return new sd;let s=[];for(let b of e)s.push(...b.portals);if(s.length===0)return new sd;for(let b of s){let C=b.va,T=b.vb;(sd.isOnBorder(C.x,T.x)||sd.isOnBorder(C.y,T.y))&&(b.type="border")}let u=s.filter(b=>b.type!=="unevaluated"),d=s.filter(b=>b.type==="unevaluated");if(d.length===0)return new sd;d.sort((b,C)=>b.hash===C.hash?b.isTunnel===C.isTunnel?0:b.isTunnel?-1:1:b.hash<C.hash?1:-1),s=u.concat(d);let m=u.length,g=m,v=m;do if(g++,g===s.length||s[m].hash!==s[g].hash){if(g-m==2){v<m&&(s[v]=s[m],s[m]=null);let b=s[v],C=s[g-1];b.type=b.isTunnel!==C.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:C.connection.a},v++}m=g}while(m!==s.length);return s.splice(v),s.sort((b,C)=>b.hash<C.hash?1:-1),{portals:s}}}kt(sd,"ElevationPortalGraph"),kt(TO,"ElevationPolygons");class E5{constructor(e,s,u){this.outPositions=e,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(e,s,u){let d=e[2];u!=null&&(d*=u);let m=`${e[0]},${e[1]},${e[2]},${s[0]},${s[1]},${s[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;let v=this.outPositions.length;this.vertexLookup.set(m,v);let b=Math.trunc(16384*s[0]),C=Math.trunc(16384*s[1]),T=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(b,C,T),v}addTriangle(e,s,u){this.outIndices.emplaceBack(e,s,u)}addTriangles(e,s,u){if(e.length===0)return;let d=u.length===1,m=gi(),g=gi();for(let v=0;v<e.length;v+=3){let b=s[e[v+0]],C=s[e[v+1]],T=s[e[v+2]],I=d?u[0]:u[e[v+1]],D=d?u[0]:u[e[v+2]];Yi(m,b.x,b.y,d?u[0]:u[e[v+0]]);let P=this.addVertex(m,g);Yi(m,C.x,C.y,I);let R=this.addVertex(m,g);Yi(m,T.x,T.y,D);let z=this.addVertex(m,g);this.outIndices.emplaceBack(P,R,z)}}addQuad(e,s,u,d,m,g){let v=this.addVertex(e,m,g),b=this.addVertex(s,m,g),C=this.addVertex(u,m,g),T=this.addVertex(d,m,g);this.addTriangle(v,b,C),this.addTriangle(C,T,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ys{constructor(e,s,u,d){this.unevaluatedPortals=new sd,this.portalPolygons=new TO,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Lv,this.vertexNormals=new Nv,this.indexArray=new qr,this.tileToMeters=q(e),this.bridgeProgramConfigurations=new ja(s,{zoom:u,lut:d},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new ja(s,{zoom:u,lut:d},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,s){let u=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(s[d]);return u}addTriangles(e,s,u){let d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(let m of e)d.push(m+s)}addRenderableRing(e,s,u,d,m,g){let v=[new it(m.min.x,m.min.y),new it(m.max.x,m.min.y),new it(m.max.x,m.max.y),new it(m.min.x,m.max.y)];for(let b=0;b<u-1;b++){let C=s+b,T=C+1,I=this.unevalVertices[C],D=this.unevalVertices[T];if(!(I.x>=m.min.x&&I.x<=m.max.x&&I.y>=m.min.y&&I.y<=m.max.y||D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||Io(I,D,v))||this.isOnBorder(I.x,D.x)||this.isOnBorder(I.y,D.y))continue;let P=Ys.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[T]),R,z=this.vertexHashLookup.get(Ys.computePosHash(I));z!=null?R=z.next:(z=this.vertexHashLookup.get(Ys.computePosHash(D)),R=z!=null?z.prev:P),this.unevalEdges.push({polygonIdx:e,a:C,b:T,hash:P,portalHash:R,isTunnel:d,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,s,u,d,m){if(s.length===0)return;this.portalPolygons.add(e,{geometry:s,zLevel:m});let g=s[0];this.vertexHashLookup.clear();let v=Ys.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let b=0;b<g.length-1;b++){let C=g[b+0],T=g[b+1],I=vs(T.x-C.x,T.y-C.y),D=ka(I);if(D===0)continue;let P="unevaluated",R=d.pointElevation(C),z=d.pointElevation(T);Math.abs(R)<.01&&Math.abs(z)<.01?P="entrance":(this.isOnBorder(C.x,T.x)||this.isOnBorder(C.y,T.y))&&(P="border");let H=Ys.computeEdgeHash(C,T);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:C,vb:T,vab:I,length:D,hash:H,isTunnel:u,type:P});let $=Ys.computePosHash(C);this.vertexHashLookup.set($,{prev:v,next:H}),v=H}}construct(e){if(this.unevalVertices.length===0)return;let s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},d=new E5(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);let m=s(),g=s(),v=s(),b=(D,P)=>{D.sort((z,H)=>z.type===P&&H.type!==P?-1:z.type!==P&&H.type===P?1:0);let R=D.findIndex(z=>z.type!==P);return R>=0?R:D.length},C=0;this.unevalEdges.length>0&&(C=b(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),u(v);let T=s(),I=s();if(this.unevalEdges.length>0){let D=this.unevalEdges.splice(C),P=b(D,"tunnel")+C;this.unevalEdges.push(...D),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:P})}u(T),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(I),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(m),this.maskSegments=Ji.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.depthSegments=Ji.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=Ji.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Ji.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.shadowCasterSegments=Ji.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,s,u,d,m,g,v,b){this.bridgeProgramConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b),this.tunnelProgramConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,h5.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,p5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,s,u,d,m){let g=(v,b)=>{for(let C=0;C<b.length-1;C++){let T=b[C].featureIndex,I=b[C+1].vertexStart,D=e.feature(T);v.populatePaintArrays(I,D,T,{},u,s,d,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,s,u,d,m){let g=new Map;for(let v=d;v<m;v++){let b=u[v],C=b.a,T=b.b,I=Ys.computePosHash(e[C]),D=Ys.computePosHash(e[T]),P=g.get(I);P||(P={},g.set(I,P));let R=g.get(D);R||(R={},g.set(D,R)),s[C]<=0&&s[T]<=0||(P.to=T,R.from=C)}return g}isTerminalVertex(e,s){let u=Ys.computePosHash(this.unevalVertices[e]),d=s.get(u);return!d||!d.from||!d.to}constructBridgeStructures(e,s,u,d,m,g){e.clearVertexLookup();let v=this.computeVertexConnections(s,u,d,m.min,m.max),b=1/g,C=.5*b,T=(rt,st)=>Yi(rt,s[st].x,s[st].y,u[st]*b),I=gi(),D=gi(),P=gi(),R=gi(),z=gi(),H=(rt,st)=>{let et=v.get(Ys.computePosHash(s[st])),tt=et.from,Ge=et.to;if(!tt||!Ge)return;T(I,tt),T(D,st),T(P,Ge),Os(R),Wo(I,D)||(kr(z,D,I),ji(R,z)),Wo(P,D)||(kr(z,P,D),jr(R,R,ji(z,z)));let $e=Pd(R);return $e>0?ur(rt,R,1/$e):void 0},$=Number.POSITIVE_INFINITY;this.sortSubarray(d,m.min,m.max,(rt,st)=>rt.featureInfo.featureIndex-st.featureInfo.featureIndex);let Z=gi(),Y=gi(),te=gi(),he=gi(),ae=gi(),me=gi(),ye=gi(),we=gi(),je=gi(),Te=[gi(),gi(),gi(),gi()],qe=[gi(),gi(),gi(),gi()],Ye=[{coord:new it(0,0),height:0},{coord:new it(0,0),height:0}],Ke=(rt,st)=>rt>st;for(let rt=m.min;rt<m.max;rt++){let st=d[rt];if(!st.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ye,s,u,st,Ke))continue;let[et,tt]=Ye;if(Yi(Z,et.coord.x,et.coord.y,b*et.height),Yi(Y,tt.coord.x,tt.coord.y,b*tt.height),Wo(Z,Y))continue;kr(te,Y,Z),ji(te,te);let Ge=H(we,st.a)||te,$e=H(je,st.b)||te;Yi(he,Ge[1],-Ge[0],0),ji(he,he),Yi(ae,$e[1],-$e[0],0),ji(ae,ae),Fo(we,he,Ge),ji(me,we),Fo(we,ae,$e),ji(ye,we),jr(Te[0],Z,ur(we,kr(we,he,me),C)),jr(Te[1],Z,ur(we,jr(we,he,me),C)),jr(Te[2],Z,ur(we,me,C)),Te[3]=Z,jr(qe[0],Y,ur(we,kr(we,ae,ye),C)),jr(qe[1],Y,ur(we,jr(we,ae,ye),C)),jr(qe[2],Y,ur(we,ye,C)),qe[3]=Y,$=this.addFeatureSection(st.featureInfo.featureIndex,$,this.bridgeFeatureSections,e);let nt=e.addVertex(Te[0],he,g),vt=e.addVertex(Te[1],he,g),ut=e.addVertex(qe[0],ae,g),Gt=e.addVertex(qe[1],ae,g);e.addTriangle(nt,vt,ut),e.addTriangle(vt,Gt,ut);let Tt=e.addVertex(Te[1],me,g),Pt=e.addVertex(Te[2],me,g),Nt=e.addVertex(qe[1],ye,g),Tn=e.addVertex(qe[2],ye,g);e.addTriangle(Tt,Pt,Nt),e.addTriangle(Pt,Tn,Nt),Dc(he,he),Dc(ae,ae);let dt=e.addVertex(Te[2],he,g),zt=e.addVertex(Te[3],he,g),un=e.addVertex(qe[2],ae,g),Ln=e.addVertex(qe[3],ae,g);e.addTriangle(dt,zt,un),e.addTriangle(zt,Ln,un);let zn=this.isTerminalVertex(st.a,v),_n=this.isTerminalVertex(st.b,v);et.height<.01&&zn&&e.addQuad(Te[3],Te[2],Te[1],Te[0],Dc(Ge,Ge),g),tt.height<.01&&_n&&e.addQuad(qe[0],qe[1],qe[2],qe[3],$e,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,s,u,d,m,g){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY,b=($,Z)=>$.featureInfo.featureIndex-Z.featureInfo.featureIndex;this.sortSubarray(d,m.min,m.max,b),this.sortSubarray(d,g.min,g.max,b);let C=$=>ji($,$),T=[{coord:new it(0,0),height:0},{coord:new it(0,0),height:0}],I=($,Z)=>$<Z,D=gi(),P=gi(),R=gi(),z=gi(),H=gi();for(let $=m.min;$<m.max;$++){if(!this.prepareEdgePoints(T,s,u,d[$],I))continue;let[Z,Y]=T,te=C(Yi(H,-(Y.coord.y-Z.coord.y),Y.coord.x-Z.coord.x,0));v=this.addFeatureSection(d[$].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Yi(D,Z.coord.x,Z.coord.y,Z.height),Yi(P,Y.coord.x,Y.coord.y,Y.height),Yi(R,Y.coord.x,Y.coord.y,d[$].isTunnel?-.1:0),Yi(z,Z.coord.x,Z.coord.y,d[$].isTunnel?-.1:0),te)}for(let $=g.min;$<g.max;$++){let Z=d[$];Z.isTunnel&&([Z.a,Z.b]=[Z.b,Z.a]);let Y=s[Z.a],te=s[Z.b],he=C(Yi(H,-(te.y-Y.y),te.x-Y.x,0));v=this.addFeatureSection(Z.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Yi(D,te.x,te.y,0),Yi(P,Y.x,Y.y,0),Yi(R,Y.x,Y.y,u[Z.a]+4),Yi(z,te.x,te.y,u[Z.b]+4),he),e.addQuad(Yi(D,Y.x,Y.y,0),Yi(P,te.x,te.y,0),Yi(R,te.x,te.y,u[Z.b]+4),Yi(z,Y.x,Y.y,u[Z.a]+4),he)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,s,u,d){e.coord.x=s,e.coord.y=u,e.height=d}prepareEdgePoints(e,s,u,d,m){let g=s[d.a].x,v=s[d.a].y,b=s[d.b].x,C=s[d.b].y,T=u[d.a],I=u[d.b],D=m(T,0),P=m(I,0);if(D&&P)return this.setElevatedPoint(e[0],g,v,T),this.setElevatedPoint(e[1],b,C,I),!0;if(!D&&!P)return!1;if(D){if(!P){let R=I/(I-T);b=on(b,g,R),C=on(C,v,R),I=on(I,T,R)}}else{let R=T/(T-I);g=on(g,b,R),v=on(v,C,R),T=on(T,I,R)}return this.setElevatedPoint(e[0],g,v,T),this.setElevatedPoint(e[1],b,C,I),!0}prepareEdges(e,s){if(s.length===0)return;s.sort((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1);let u=0,d=0,m=0,g=s[u].polygonIdx;do d++,(d===s.length||s[u].hash!==s[d].hash)&&((d-u==1||s[d-1].polygonIdx!==g)&&(m<u&&(s[m]=s[u],s[u]=null),s[m].type="none",m++),u=d,u!==s.length&&(g=s[u].polygonIdx));while(u!==s.length);if(s.splice(m),s.length!==0&&e.length!==0){s.sort((C,T)=>C.portalHash<T.portalHash?1:-1);let v=0,b=0;for(;v!==s.length&&b!==e.length;){let C=s[v],T=e[b];C.portalHash>T.hash?v++:T.hash>C.portalHash?b++:(C.type=T.type,v++)}}}isOnBorder(e,s){return e<=0&&s<=0||e>=_t&&s>=_t}addFeatureSection(e,s,u,d){return e!==s&&(s=e,u.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),s}sortSubarray(e,s,u,d){let m=e.slice(s,u);m.sort(d),e.splice(s,m.length,...m)}static computeEdgeHash(e,s){return(e.y===s.y&&e.x>s.x||e.y>s.y)&&([e,s]=[s,e]),BigInt(Ys.computePosHash(e))<<32n|BigInt(Ys.computePosHash(s))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var IO,MO={exports:{}},DO=(IO||(IO=1,(function(a){function e(ce,pe){return ce>pe?1:ce<pe?-1:0}var s=function(ce,pe){ce===void 0&&(ce=e),pe===void 0&&(pe=!1),this._compare=ce,this._root=null,this._size=0,this._noDuplicates=!!pe},u={size:{configurable:!0}};function d(ce,pe,We,ot,Ct){var Et=Ct-ot;if(Et>0){var qt=ot+Math.floor(Et/2),Xt={key:pe[qt],data:We[qt],parent:ce};return Xt.left=d(Xt,pe,We,ot,qt),Xt.right=d(Xt,pe,We,qt+1,Ct),Xt}return null}function m(ce,pe,We,ot,Ct){if(!(We>=ot)){for(var Et=ce[We+ot>>1],qt=We-1,Xt=ot+1;;){do qt++;while(Ct(ce[qt],Et)<0);do Xt--;while(Ct(ce[Xt],Et)>0);if(qt>=Xt)break;var mn=ce[qt];ce[qt]=ce[Xt],ce[Xt]=mn,mn=pe[qt],pe[qt]=pe[Xt],pe[Xt]=mn}m(ce,pe,We,Xt,Ct),m(ce,pe,Xt+1,ot,Ct)}}s.prototype.rotateLeft=function(ce){var pe=ce.right;pe&&(ce.right=pe.left,pe.left&&(pe.left.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.left=ce),ce.parent=pe},s.prototype.rotateRight=function(ce){var pe=ce.left;pe&&(ce.left=pe.right,pe.right&&(pe.right.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.right=ce),ce.parent=pe},s.prototype._splay=function(ce){for(;ce.parent;){var pe=ce.parent;pe.parent?pe.left===ce&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===ce&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===ce&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===ce?this.rotateRight(pe):this.rotateLeft(pe)}},s.prototype.splay=function(ce){for(var pe,We,ot,Ct,Et;ce.parent;)(We=(pe=ce.parent).parent)&&We.parent?((ot=We.parent).left===We?ot.left=ce:ot.right=ce,ce.parent=ot):(ce.parent=null,this._root=ce),Ct=ce.left,Et=ce.right,ce===pe.left?(We&&(We.left===pe?(pe.right?(We.left=pe.right,We.left.parent=We):We.left=null,pe.right=We,We.parent=pe):(Ct?(We.right=Ct,Ct.parent=We):We.right=null,ce.left=We,We.parent=ce)),Et?(pe.left=Et,Et.parent=pe):pe.left=null,ce.right=pe,pe.parent=ce):(We&&(We.right===pe?(pe.left?(We.right=pe.left,We.right.parent=We):We.right=null,pe.left=We,We.parent=pe):(Et?(We.left=Et,Et.parent=We):We.left=null,ce.right=We,We.parent=ce)),Ct?(pe.right=Ct,Ct.parent=pe):pe.right=null,ce.left=pe,pe.parent=ce)},s.prototype.replace=function(ce,pe){ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.parent=ce.parent)},s.prototype.minNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.left;)ce=ce.left;return ce},s.prototype.maxNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.right;)ce=ce.right;return ce},s.prototype.insert=function(ce,pe){var We=this._root,ot=null,Ct=this._compare;if(this._noDuplicates)for(;We;){if(ot=We,Ct(We.key,ce)===0)return;We=Ct(We.key,ce)<0?We.right:We.left}else for(;We;)ot=We,We=Ct(We.key,ce)<0?We.right:We.left;return We={key:ce,data:pe,left:null,right:null,parent:ot},ot?Ct(ot.key,We.key)<0?ot.right=We:ot.left=We:this._root=We,this.splay(We),this._size++,We},s.prototype.find=function(ce){for(var pe=this._root,We=this._compare;pe;){var ot=We(pe.key,ce);if(ot<0)pe=pe.right;else{if(!(ot>0))return pe;pe=pe.left}}return null},s.prototype.contains=function(ce){for(var pe=this._root,We=this._compare;pe;){var ot=We(ce,pe.key);if(ot===0)return!0;pe=ot<0?pe.left:pe.right}return!1},s.prototype.remove=function(ce){var pe=this.find(ce);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var We=this.minNode(pe.right);We.parent!==pe&&(this.replace(We,We.right),We.right=pe.right,We.right.parent=We),this.replace(pe,We),We.left=pe.left,We.left.parent=We}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},s.prototype.removeNode=function(ce){if(!ce)return!1;if(this.splay(ce),ce.left)if(ce.right){var pe=this.minNode(ce.right);pe.parent!==ce&&(this.replace(pe,pe.right),pe.right=ce.right,pe.right.parent=pe),this.replace(ce,pe),pe.left=ce.left,pe.left.parent=pe}else this.replace(ce,ce.left);else this.replace(ce,ce.right);return this._size--,!0},s.prototype.erase=function(ce){var pe=this.find(ce);if(pe){this.splay(pe);var We=pe.left,ot=pe.right,Ct=null;We&&(We.parent=null,Ct=this.maxNode(We),this.splay(Ct),this._root=Ct),ot&&(We?Ct.right=ot:this._root=ot,ot.parent=Ct),this._size--}},s.prototype.pop=function(){var ce=this._root,pe=null;if(ce){for(;ce.left;)ce=ce.left;pe={key:ce.key,data:ce.data},this.remove(ce.key)}return pe},s.prototype.next=function(ce){var pe=ce;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=ce.parent;pe&&pe.right===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.prev=function(ce){var pe=ce;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=ce.parent;pe&&pe.left===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.forEach=function(ce){for(var pe=this._root,We=[],ot=!1,Ct=0;!ot;)pe?(We.push(pe),pe=pe.left):We.length>0?(ce(pe=We.pop(),Ct++),pe=pe.right):ot=!0;return this},s.prototype.range=function(ce,pe,We,ot){for(var Ct=[],Et=this._compare,qt=this._root;Ct.length!==0||qt;)if(qt)Ct.push(qt),qt=qt.left;else{if(Et((qt=Ct.pop()).key,pe)>0)break;if(Et(qt.key,ce)>=0&&We.call(ot,qt))return this;qt=qt.right}return this},s.prototype.keys=function(){for(var ce=this._root,pe=[],We=[],ot=!1;!ot;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),We.push(ce.key),ce=ce.right):ot=!0;return We},s.prototype.values=function(){for(var ce=this._root,pe=[],We=[],ot=!1;!ot;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),We.push(ce.data),ce=ce.right):ot=!0;return We},s.prototype.at=function(ce){for(var pe=this._root,We=[],ot=!1,Ct=0;!ot;)if(pe)We.push(pe),pe=pe.left;else if(We.length>0){if(pe=We.pop(),Ct===ce)return pe;Ct++,pe=pe.right}else ot=!0;return null},s.prototype.load=function(ce,pe,We){if(ce===void 0&&(ce=[]),pe===void 0&&(pe=[]),We===void 0&&(We=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ot=ce.length;return We&&m(ce,pe,0,ot-1,this._compare),this._root=d(null,ce,pe,0,ot),this._size=ot,this},s.prototype.min=function(){var ce=this.minNode(this._root);return ce?ce.key:null},s.prototype.max=function(){var ce=this.maxNode(this._root);return ce?ce.key:null},s.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},s.createTree=function(ce,pe,We,ot,Ct){return new s(We,Ct).load(ce,pe,ot)},Object.defineProperties(s.prototype,u);var g=0,v=1,b=2,C=3,T=0,I=1,D=2,P=3;function R(ce,pe,We){pe===null?(ce.inOut=!1,ce.otherInOut=!0):(ce.isSubject===pe.isSubject?(ce.inOut=!pe.inOut,ce.otherInOut=pe.otherInOut):(ce.inOut=!pe.otherInOut,ce.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(ce.prevInResult=!z(pe,We)||pe.isVertical()?pe.prevInResult:pe));var ot=z(ce,We);ce.resultTransition=ot?(function(Ct,Et){var qt,Xt=!Ct.inOut,mn=!Ct.otherInOut;switch(Et){case T:qt=Xt&&mn;break;case I:qt=Xt||mn;break;case P:qt=Xt^mn;break;case D:qt=Ct.isSubject?Xt&&!mn:mn&&!Xt}return qt?1:-1})(ce,We):0}function z(ce,pe){switch(ce.type){case g:switch(pe){case T:return!ce.otherInOut;case I:return ce.otherInOut;case D:return ce.isSubject&&ce.otherInOut||!ce.isSubject&&!ce.otherInOut;case P:return!0}break;case b:return pe===T||pe===I;case C:return pe===D;case v:return!1}return!1}var H=function(ce,pe,We,ot,Ct){this.left=pe,this.point=ce,this.otherEvent=We,this.isSubject=ot,this.type=Ct||g,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},$={inResult:{configurable:!0}};function Z(ce,pe){return ce[0]===pe[0]&&ce[1]===pe[1]}H.prototype.isBelow=function(ce){var pe=this.point,We=this.otherEvent.point;return this.left?(pe[0]-ce[0])*(We[1]-ce[1])-(We[0]-ce[0])*(pe[1]-ce[1])>0:(We[0]-ce[0])*(pe[1]-ce[1])-(pe[0]-ce[0])*(We[1]-ce[1])>0},H.prototype.isAbove=function(ce){return!this.isBelow(ce)},H.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},$.inResult.get=function(){return this.resultTransition!==0},H.prototype.clone=function(){var ce=new H(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ce.contourId=this.contourId,ce.resultTransition=this.resultTransition,ce.prevInResult=this.prevInResult,ce.isExteriorRing=this.isExteriorRing,ce.inOut=this.inOut,ce.otherInOut=this.otherInOut,ce},Object.defineProperties(H.prototype,$);var Y=11102230246251565e-32,te=134217729,he=(3+8*Y)*Y;function ae(ce,pe,We,ot,Ct){var Et,qt,Xt,mn,Cn=pe[0],Sn=ot[0],On=0,rn=0;Sn>Cn==Sn>-Cn?(Et=Cn,Cn=pe[++On]):(Et=Sn,Sn=ot[++rn]);var cn=0;if(On<ce&&rn<We)for(Sn>Cn==Sn>-Cn?(Xt=Et-((qt=Cn+Et)-Cn),Cn=pe[++On]):(Xt=Et-((qt=Sn+Et)-Sn),Sn=ot[++rn]),Et=qt,Xt!==0&&(Ct[cn++]=Xt);On<ce&&rn<We;)Sn>Cn==Sn>-Cn?(Xt=Et-((qt=Et+Cn)-(mn=qt-Et))+(Cn-mn),Cn=pe[++On]):(Xt=Et-((qt=Et+Sn)-(mn=qt-Et))+(Sn-mn),Sn=ot[++rn]),Et=qt,Xt!==0&&(Ct[cn++]=Xt);for(;On<ce;)Xt=Et-((qt=Et+Cn)-(mn=qt-Et))+(Cn-mn),Cn=pe[++On],Et=qt,Xt!==0&&(Ct[cn++]=Xt);for(;rn<We;)Xt=Et-((qt=Et+Sn)-(mn=qt-Et))+(Sn-mn),Sn=ot[++rn],Et=qt,Xt!==0&&(Ct[cn++]=Xt);return Et===0&&cn!==0||(Ct[cn++]=Et),cn}function me(ce){return new Float64Array(ce)}var ye=33306690738754716e-32,we=22204460492503146e-32,je=11093356479670487e-47,Te=me(4),qe=me(8),Ye=me(12),Ke=me(16),rt=me(4);function st(ce,pe,We){var ot=(function(Ct,Et,qt,Xt,mn,Cn){var Sn=(Et-Cn)*(qt-mn),On=(Ct-mn)*(Xt-Cn),rn=Sn-On;if(Sn===0||On===0||Sn>0!=On>0)return rn;var cn=Math.abs(Sn+On);return Math.abs(rn)>=ye*cn?rn:-(function($n,Yn,Kn,di,Ti,vi,ei){var oi,En,Nn,Qi,tn,Rn,xi,Di,zi,Ir,Ri,nn,nr,hi,Wi,Xr,lo,Nr,zr=$n-Ti,to=Kn-Ti,Ss=Yn-vi,ki=di-vi;Te[0]=(Wi=(Di=zr-(xi=(Rn=te*zr)-(Rn-zr)))*(Ir=ki-(zi=(Rn=te*ki)-(Rn-ki)))-((hi=zr*ki)-xi*zi-Di*zi-xi*Ir))-((Ri=Wi-(lo=(Di=Ss-(xi=(Rn=te*Ss)-(Rn-Ss)))*(Ir=to-(zi=(Rn=te*to)-(Rn-to)))-((Xr=Ss*to)-xi*zi-Di*zi-xi*Ir)))+(tn=Wi-Ri))+(tn-lo),Te[1]=(nr=hi-((nn=hi+Ri)-(tn=nn-hi))+(Ri-tn))-((Ri=nr-Xr)+(tn=nr-Ri))+(tn-Xr),Te[2]=nn-((Nr=nn+Ri)-(tn=Nr-nn))+(Ri-tn),Te[3]=Nr;var wr=(function(nu,Mo){for(var ds=Mo[0],Qs=1;Qs<4;Qs++)ds+=Mo[Qs];return ds})(0,Te),Mr=we*ei;if(wr>=Mr||-wr>=Mr||(oi=$n-(zr+(tn=$n-zr))+(tn-Ti),Nn=Kn-(to+(tn=Kn-to))+(tn-Ti),En=Yn-(Ss+(tn=Yn-Ss))+(tn-vi),Qi=di-(ki+(tn=di-ki))+(tn-vi),oi===0&&En===0&&Nn===0&&Qi===0)||(Mr=je*ei+he*Math.abs(wr),(wr+=zr*Qi+ki*oi-(Ss*Nn+to*En))>=Mr||-wr>=Mr))return wr;rt[0]=(Wi=(Di=oi-(xi=(Rn=te*oi)-(Rn-oi)))*(Ir=ki-(zi=(Rn=te*ki)-(Rn-ki)))-((hi=oi*ki)-xi*zi-Di*zi-xi*Ir))-((Ri=Wi-(lo=(Di=En-(xi=(Rn=te*En)-(Rn-En)))*(Ir=to-(zi=(Rn=te*to)-(Rn-to)))-((Xr=En*to)-xi*zi-Di*zi-xi*Ir)))+(tn=Wi-Ri))+(tn-lo),rt[1]=(nr=hi-((nn=hi+Ri)-(tn=nn-hi))+(Ri-tn))-((Ri=nr-Xr)+(tn=nr-Ri))+(tn-Xr),rt[2]=nn-((Nr=nn+Ri)-(tn=Nr-nn))+(Ri-tn),rt[3]=Nr;var Fs=ae(4,Te,4,rt,qe);rt[0]=(Wi=(Di=zr-(xi=(Rn=te*zr)-(Rn-zr)))*(Ir=Qi-(zi=(Rn=te*Qi)-(Rn-Qi)))-((hi=zr*Qi)-xi*zi-Di*zi-xi*Ir))-((Ri=Wi-(lo=(Di=Ss-(xi=(Rn=te*Ss)-(Rn-Ss)))*(Ir=Nn-(zi=(Rn=te*Nn)-(Rn-Nn)))-((Xr=Ss*Nn)-xi*zi-Di*zi-xi*Ir)))+(tn=Wi-Ri))+(tn-lo),rt[1]=(nr=hi-((nn=hi+Ri)-(tn=nn-hi))+(Ri-tn))-((Ri=nr-Xr)+(tn=nr-Ri))+(tn-Xr),rt[2]=nn-((Nr=nn+Ri)-(tn=Nr-nn))+(Ri-tn),rt[3]=Nr;var Yr=ae(Fs,qe,4,rt,Ye);rt[0]=(Wi=(Di=oi-(xi=(Rn=te*oi)-(Rn-oi)))*(Ir=Qi-(zi=(Rn=te*Qi)-(Rn-Qi)))-((hi=oi*Qi)-xi*zi-Di*zi-xi*Ir))-((Ri=Wi-(lo=(Di=En-(xi=(Rn=te*En)-(Rn-En)))*(Ir=Nn-(zi=(Rn=te*Nn)-(Rn-Nn)))-((Xr=En*Nn)-xi*zi-Di*zi-xi*Ir)))+(tn=Wi-Ri))+(tn-lo),rt[1]=(nr=hi-((nn=hi+Ri)-(tn=nn-hi))+(Ri-tn))-((Ri=nr-Xr)+(tn=nr-Ri))+(tn-Xr),rt[2]=nn-((Nr=nn+Ri)-(tn=Nr-nn))+(Ri-tn),rt[3]=Nr;var bl=ae(Yr,Ye,4,rt,Ke);return Ke[bl-1]})(Ct,Et,qt,Xt,mn,Cn,cn)})(ce[0],ce[1],pe[0],pe[1],We[0],We[1]);return ot>0?-1:ot<0?1:0}function et(ce,pe){var We=ce.point,ot=pe.point;return We[0]>ot[0]?1:We[0]<ot[0]?-1:We[1]!==ot[1]?We[1]>ot[1]?1:-1:(function(Ct,Et,qt,Xt){return Ct.left!==Et.left?Ct.left?1:-1:st(qt,Ct.otherEvent.point,Et.otherEvent.point)!==0?Ct.isBelow(Et.otherEvent.point)?-1:1:!Ct.isSubject&&Et.isSubject?1:-1})(ce,pe,We)}function tt(ce,pe,We){var ot=new H(pe,!1,ce,ce.isSubject),Ct=new H(pe,!0,ce.otherEvent,ce.isSubject);return Z(ce.point,ce.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ce),ot.contourId=Ct.contourId=ce.contourId,et(Ct,ce.otherEvent)>0&&(ce.otherEvent.left=!0,Ct.left=!1),ce.otherEvent.otherEvent=Ct,ce.otherEvent=ot,We.push(Ct),We.push(ot),We}function Ge(ce,pe){return ce[0]*pe[1]-ce[1]*pe[0]}function $e(ce,pe){return ce[0]*pe[0]+ce[1]*pe[1]}function nt(ce,pe,We){var ot=(function(mn,Cn,Sn,On,rn){var cn=[Cn[0]-mn[0],Cn[1]-mn[1]],$n=[On[0]-Sn[0],On[1]-Sn[1]];function Yn(Rn,xi,Di){return[Rn[0]+xi*Di[0],Rn[1]+xi*Di[1]]}var Kn=[Sn[0]-mn[0],Sn[1]-mn[1]],di=Ge(cn,$n),Ti=di*di,vi=$e(cn,cn);if(Ti>0){var ei=Ge(Kn,$n)/di;if(ei<0||ei>1)return null;var oi=Ge(Kn,cn)/di;return oi<0||oi>1?null:ei===0||ei===1?[Yn(mn,ei,cn)]:oi===0||oi===1?[Yn(Sn,oi,$n)]:[Yn(mn,ei,cn)]}if((Ti=(di=Ge(Kn,cn))*di)>0)return null;var En=$e(cn,Kn)/vi,Nn=En+$e(cn,$n)/vi,Qi=Math.min(En,Nn),tn=Math.max(En,Nn);return Qi<=1&&tn>=0?Qi===1?[Yn(mn,Qi>0?Qi:0,cn)]:tn===0?[Yn(mn,tn<1?tn:1,cn)]:[Yn(mn,Qi>0?Qi:0,cn),Yn(mn,tn<1?tn:1,cn)]:null})(ce.point,ce.otherEvent.point,pe.point,pe.otherEvent.point),Ct=ot?ot.length:0;if(Ct===0||Ct===1&&(Z(ce.point,pe.point)||Z(ce.otherEvent.point,pe.otherEvent.point))||Ct===2&&ce.isSubject===pe.isSubject)return 0;if(Ct===1)return Z(ce.point,ot[0])||Z(ce.otherEvent.point,ot[0])||tt(ce,ot[0],We),Z(pe.point,ot[0])||Z(pe.otherEvent.point,ot[0])||tt(pe,ot[0],We),1;var Et=[],qt=!1,Xt=!1;return Z(ce.point,pe.point)?qt=!0:et(ce,pe)===1?Et.push(pe,ce):Et.push(ce,pe),Z(ce.otherEvent.point,pe.otherEvent.point)?Xt=!0:et(ce.otherEvent,pe.otherEvent)===1?Et.push(pe.otherEvent,ce.otherEvent):Et.push(ce.otherEvent,pe.otherEvent),qt&&Xt||qt?(pe.type=v,ce.type=pe.inOut===ce.inOut?b:C,qt&&!Xt&&tt(Et[1].otherEvent,Et[0].point,We),2):Xt?(tt(Et[0],Et[1].point,We),3):Et[0]!==Et[3].otherEvent?(tt(Et[0],Et[1].point,We),tt(Et[1],Et[2].point,We),3):(tt(Et[0],Et[1].point,We),tt(Et[3].otherEvent,Et[2].point,We),3)}function vt(ce,pe){if(ce===pe)return 0;if(st(ce.point,ce.otherEvent.point,pe.point)!==0||st(ce.point,ce.otherEvent.point,pe.otherEvent.point)!==0)return Z(ce.point,pe.point)?ce.isBelow(pe.otherEvent.point)?-1:1:ce.point[0]===pe.point[0]?ce.point[1]<pe.point[1]?-1:1:et(ce,pe)===1?pe.isAbove(ce.point)?-1:1:ce.isBelow(pe.point)?-1:1;if(ce.isSubject!==pe.isSubject)return ce.isSubject?-1:1;var We=ce.point,ot=pe.point;return We[0]===ot[0]&&We[1]===ot[1]?(We=ce.otherEvent.point)[0]===(ot=pe.otherEvent.point)[0]&&We[1]===ot[1]?0:ce.contourId>pe.contourId?1:-1:et(ce,pe)===1?1:-1}var ut=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Gt(ce,pe,We,ot){var Ct,Et=ce+1,qt=pe[ce].point,Xt=pe.length;for(Et<Xt&&(Ct=pe[Et].point);Et<Xt&&Ct[0]===qt[0]&&Ct[1]===qt[1];){if(!We[Et])return Et;++Et<Xt&&(Ct=pe[Et].point)}for(Et=ce-1;We[Et]&&Et>ot;)Et--;return Et}ut.prototype.isExterior=function(){return this.holeOf==null};var Tt=Nt,Pt=Nt;function Nt(ce,pe){if(!(this instanceof Nt))return new Nt(ce,pe);if(this.data=ce||[],this.length=this.data.length,this.compare=pe||Tn,this.length>0)for(var We=(this.length>>1)-1;We>=0;We--)this._down(We)}function Tn(ce,pe){return ce<pe?-1:ce>pe?1:0}Nt.prototype={push:function(ce){this.data.push(ce),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ce=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ce}},peek:function(){return this.data[0]},_up:function(ce){for(var pe=this.data,We=this.compare,ot=pe[ce];ce>0;){var Ct=ce-1>>1,Et=pe[Ct];if(We(ot,Et)>=0)break;pe[ce]=Et,ce=Ct}pe[ce]=ot},_down:function(ce){for(var pe=this.data,We=this.compare,ot=this.length>>1,Ct=pe[ce];ce<ot;){var Et=1+(ce<<1),qt=Et+1,Xt=pe[Et];if(qt<this.length&&We(pe[qt],Xt)<0&&(Et=qt,Xt=pe[qt]),We(Xt,Ct)>=0)break;pe[ce]=Xt,ce=Et}pe[ce]=Ct}},Tt.default=Pt;var dt=Math.max,zt=Math.min,un=0;function Ln(ce,pe,We,ot,Ct,Et){var qt,Xt,mn,Cn,Sn,On;for(qt=0,Xt=ce.length-1;qt<Xt;qt++)if(Cn=ce[qt+1],Sn=new H(mn=ce[qt],!1,void 0,pe),On=new H(Cn,!1,Sn,pe),Sn.otherEvent=On,mn[0]!==Cn[0]||mn[1]!==Cn[1]){Sn.contourId=On.contourId=We,Et||(Sn.isExteriorRing=!1,On.isExteriorRing=!1),et(Sn,On)>0?On.left=!0:Sn.left=!0;var rn=mn[0],cn=mn[1];Ct[0]=zt(Ct[0],rn),Ct[1]=zt(Ct[1],cn),Ct[2]=dt(Ct[2],rn),Ct[3]=dt(Ct[3],cn),ot.push(Sn),ot.push(On)}}var zn=[];function _n(ce,pe,We){typeof ce[0][0][0]=="number"&&(ce=[ce]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var ot=(function(cn,$n,Yn){var Kn=null;return cn.length*$n.length==0&&(Yn===T?Kn=zn:Yn===D?Kn=cn:Yn!==I&&Yn!==P||(Kn=cn.length===0?$n:cn)),Kn})(ce,pe,We);if(ot)return ot===zn?null:ot;var Ct=[1/0,1/0,-1/0,-1/0],Et=[1/0,1/0,-1/0,-1/0],qt=(function(cn,$n,Yn,Kn,di){var Ti,vi,ei,oi,En,Nn,Qi=new Tt(null,et);for(ei=0,oi=cn.length;ei<oi;ei++)for(En=0,Nn=(Ti=cn[ei]).length;En<Nn;En++)(vi=En===0)&&un++,Ln(Ti[En],!0,un,Qi,Yn,vi);for(ei=0,oi=$n.length;ei<oi;ei++)for(En=0,Nn=(Ti=$n[ei]).length;En<Nn;En++)vi=En===0,di===D&&(vi=!1),vi&&un++,Ln(Ti[En],!1,un,Qi,Kn,vi);return Qi})(ce,pe,Ct,Et,We);if(ot=(function(cn,$n,Yn,Kn,di){var Ti=null;return(Yn[0]>Kn[2]||Kn[0]>Yn[2]||Yn[1]>Kn[3]||Kn[1]>Yn[3])&&(di===T?Ti=zn:di===D?Ti=cn:di!==I&&di!==P||(Ti=cn.concat($n))),Ti})(ce,pe,Ct,Et,We))return ot===zn?null:ot;for(var Xt=(function(cn){var $n,Yn,Kn=(function(ei){var oi,En,Nn,Qi,tn=[];for(En=0,Nn=ei.length;En<Nn;En++)((oi=ei[En]).left&&oi.inResult||!oi.left&&oi.otherEvent.inResult)&&tn.push(oi);for(var Rn=!1;!Rn;)for(Rn=!0,En=0,Nn=tn.length;En<Nn;En++)En+1<Nn&&et(tn[En],tn[En+1])===1&&(Qi=tn[En],tn[En]=tn[En+1],tn[En+1]=Qi,Rn=!1);for(En=0,Nn=tn.length;En<Nn;En++)(oi=tn[En]).otherPos=En;for(En=0,Nn=tn.length;En<Nn;En++)(oi=tn[En]).left||(Qi=oi.otherPos,oi.otherPos=oi.otherEvent.otherPos,oi.otherEvent.otherPos=Qi);return tn})(cn),di={},Ti=[],vi=function(){if(!di[$n]){var ei=Ti.length,oi=(function(tn,Rn,xi){var Di=new ut;if(tn.prevInResult!=null){var zi=tn.prevInResult,Ir=zi.outputContourId;if(zi.resultTransition>0){var Ri=Rn[Ir];if(Ri.holeOf!=null){var nn=Ri.holeOf;Rn[nn].holeIds.push(xi),Di.holeOf=nn,Di.depth=Rn[Ir].depth}else Rn[Ir].holeIds.push(xi),Di.holeOf=Ir,Di.depth=Rn[Ir].depth+1}else Di.holeOf=null,Di.depth=Rn[Ir].depth}else Di.holeOf=null,Di.depth=0;return Di})(Kn[$n],Ti,ei),En=function(tn){di[tn]=!0,tn<Kn.length&&Kn[tn]&&(Kn[tn].outputContourId=ei)},Nn=$n,Qi=$n;for(oi.points.push(Kn[$n].point);En(Nn),En(Nn=Kn[Nn].otherPos),oi.points.push(Kn[Nn].point),!((Nn=Gt(Nn,Kn,di,Qi))==Qi||Nn>=Kn.length)&&Kn[Nn];);Ti.push(oi)}};for($n=0,Yn=Kn.length;$n<Yn;$n++)vi();return Ti})((function(cn,$n,Yn,Kn,di,Ti){for(var vi,ei,oi,En=new s(vt),Nn=[],Qi=Math.min(Kn[2],di[2]);cn.length!==0;){var tn=cn.pop();if(Nn.push(tn),Ti===T&&tn.point[0]>Qi||Ti===D&&tn.point[0]>Kn[2])break;if(tn.left){ei=vi=En.insert(tn),vi=vi!==(oi=En.minNode())?En.prev(vi):null,ei=En.next(ei);var Rn=vi?vi.key:null;if(R(tn,Rn,Ti),ei&&nt(tn,ei.key,cn)===2&&(R(tn,Rn,Ti),R(ei.key,tn,Ti)),vi&&nt(vi.key,tn,cn)===2){var xi=vi;R(Rn,(xi=xi!==oi?En.prev(xi):null)?xi.key:null,Ti),R(tn,Rn,Ti)}}else ei=vi=En.find(tn=tn.otherEvent),vi&&ei&&(vi=vi!==oi?En.prev(vi):null,ei=En.next(ei),En.remove(tn),ei&&vi&&nt(vi.key,ei.key,cn))}return Nn})(qt,0,0,Ct,Et,We)),mn=[],Cn=0;Cn<Xt.length;Cn++){var Sn=Xt[Cn];if(Sn.isExterior()){for(var On=[Sn.points],rn=0;rn<Sn.holeIds.length;rn++)On.push(Xt[Sn.holeIds[rn]].points);mn.push(On)}}return mn}var _i={UNION:I,DIFFERENCE:D,INTERSECTION:T,XOR:P};a.diff=function(ce,pe){return _n(ce,pe,D)},a.intersection=function(ce,pe){return _n(ce,pe,T)},a.operations=_i,a.union=function(ce,pe){return _n(ce,pe,I)},a.xor=function(ce,pe){return _n(ce,pe,P)},Object.defineProperty(a,"__esModule",{value:!0})})(MO.exports)),MO.exports);function Wb(a,e,s,u){let d=[],m=u===0?(g,v,b,C,T,I)=>{g.push(new it(I,b+(I-v)/(C-v)*(T-b)))}:(g,v,b,C,T,I)=>{g.push(new it(v+(I-b)/(T-b)*(C-v),I))};for(let g of a){let v=[];for(let b of g){if(b.length<=2)continue;let C=[];for(let D=0;D<b.length-1;D++){let P=b[D].x,R=b[D].y,z=b[D+1].x,H=b[D+1].y,$=u===0?P:R,Z=u===0?z:H;$<e?Z>e&&m(C,P,R,z,H,e):$>s?Z<s&&m(C,P,R,z,H,s):C.push(b[D]),Z<e&&$>=e&&m(C,P,R,z,H,e),Z>s&&$<=s&&m(C,P,R,z,H,s)}let T=b[b.length-1],I=u===0?T.x:T.y;I>=e&&I<=s&&C.push(T),C.length&&(T=C[C.length-1],C[0].x===T.x&&C[0].y===T.y||C.push(C[0]),v.push(C))}v.length&&d.push(v)}return d}function S5(a,e){let s=RT(a),u=RT([e]),d=DO.intersection(s,u);return d==null?[]:AO(d)}function T5(a,e){let u=RT(a,65536),d=[];for(;e.valid();e.next()){let[m,g]=e.get(),v=m.x*65536,b=m.y*65536,C=g.x*65536,T=g.y*65536,I=C-v,D=T-b,P=Math.hypot(I,D);if(P===0)continue;let R=Math.trunc(D/P*3),z=-Math.trunc(I/P*3);d.push([[[v,b],[C,T],[C+R,T+z],[v+R,b+z],[v,b]]])}return d.length>0&&(u=DO.diff(u,d)),AO(u,1/65536)}function RT(a,e=1){return[a.map(s=>s.map(u=>[u.x*e,u.y*e]))]}function AO(a,e=1){return a.map(s=>s.map((u,d)=>{let m=u.map(g=>new it(g[0]*e,g[1]*e).round());return d>0&&m.reverse(),m}))}class kT{constructor(e,s){this.layoutVertexArray=new Xc,this.indexArray=new qr,this.lineIndexArray=new Zs,this.triangleSegments=new Ji,this.lineSegments=new Ji,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new Ql)}update(e,s,u,d,m,g,v,b){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,u5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,d5.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,s,u,d,m,g,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,d,m,g,void 0,v)}}class FT{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new kT(e,!1),this.elevationBufferData=new kT(e,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.hasPattern=PT("fill",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:v,id:b,index:C,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,D=Se(v,I);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;let P=m?m.evaluate(D,{},u,s.availableImages):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:T,index:C,geometry:I?D.geometry:_e(v,u,d),patterns:{},sortKey:P};g.push(R)}m&&g.sort((v,b)=>v.sortKey-b.sortKey);for(let v of g){let{geometry:b,index:C,sourceLayerIndex:T}=v;if(this.hasPattern){let I=OT("fill",this.layers,v,this.zoom,this.pixelRatio,s);this.patternFeatures.push(I)}else this.addFeature(v,b,C,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(e[C].feature,b,C,T,this.index)}}update(e,s,u,d,m,g,v){this.bufferData.update(e,s,u,d,m,g,v,this.worldview),this.elevationBufferData.update(e,s,u,d,m,g,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,s,u,d,m,g,v,this.worldview)}addFeatures(e,s,u,d,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,d,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,s,u,d,m,g=[],v,b){let C=l0(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,C,d,u,b):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(e,u,m,g,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,m,g,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,s,u,d,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(s,u,d,m,this.worldview))}addElevatedRoadFeature(e,s,u,d,m){let g=new Array,v=ii.getElevationFeature(e,m);if(!v)return void this.addGeometry(s,this.bufferData);{let C=this.clipPolygonsToTile(s,1);C.length>0&&g.push({polygons:C,elevationFeature:v,elevationTileID:u})}let b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:d};for(let C of g)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ys(C.elevationTileID,this.layers,this.zoom,this.lut));let I=C.elevationFeature.isTunnel(),D=0;e.properties.hasOwnProperty(Le)&&(D=+e.properties[Le]);for(let P of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,P,I,C.elevationFeature,D)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));let T=new fi(u,C.elevationTileID);this.addElevatedGeometry(C.polygons,T,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,b)}}addElevatedGeometry(e,s,u,d,m,g){let v={elevation:u,elevationSampler:s,bias:d,index:m,featureInfo:g},[b,C]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(e,s,u){let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(d=g,m=g));let v=(b,C,T)=>{if(u!=null)if(C.push(b),g!=null)s.elevatedLayoutVertexArray.emplaceBack(g),T.push(g);else{let I=u.elevationSampler.pointElevation(b,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(I),T.push(I),d=Math.min(d,I),m=Math.max(m,I)}};for(let b of e){let C=0;for(let Y of b)C+=Y.length;let T=s.triangleSegments.prepareSegment(C,s.layoutVertexArray,s.indexArray),I=T.vertexLength,D=[],P=[],R=[],z=[],H=[],$=s.layoutVertexArray.length;for(let Y of b){if(Y.length===0)continue;Y!==b[0]&&P.push(D.length/2);let te=s.lineSegments.prepareSegment(Y.length,s.layoutVertexArray,s.lineIndexArray),he=te.vertexLength;u&&H.push(s.layoutVertexArray.length-$),v(Y[0],R,z),s.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),s.lineIndexArray.emplaceBack(he+Y.length-1,he),D.push(Y[0].x),D.push(Y[0].y);for(let ae=1;ae<Y.length;ae++)v(Y[ae],R,z),s.layoutVertexArray.emplaceBack(Y[ae].x,Y[ae].y),s.lineIndexArray.emplaceBack(he+ae-1,he+ae),D.push(Y[ae].x),D.push(Y[ae].y);te.vertexLength+=Y.length,te.primitiveLength+=Y.length}let Z=rg(D,P);for(let Y=0;Y<Z.length;Y+=3)s.indexArray.emplaceBack(I+Z[Y],I+Z[Y+1],I+Z[Y+2]);if(Z.length>0&&u&&this.elevationMode==="hd-road-base"){let Y=u.elevation.isTunnel(),te=u.elevation.safeArea,he=this.elevatedStructures.addVertices(R,z);this.elevatedStructures.addTriangles(Z,he,Y);let ae=H.length;if(ae>0){for(let me=0;me<ae-1;me++)this.elevatedStructures.addRenderableRing(u.index,H[me]+he,H[me+1]-H[me],Y,te,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,H[ae-1]+he,R.length-H[ae-1],Y,te,u.featureInfo)}}T.vertexLength+=C,T.primitiveLength+=Z.length/3}return[d,m]}prepareElevatedPolygons(e,s,u){let d=1/q(u),m=[];for(let g of e){let v=T5(g,new Xn(s,d));m.push(...v)}return m}clipPolygonsToTile(e,s){let u=-s,d=-s,m=_t+s,g=_t+s,v=0,b=[],C=[];for(;v<e.length;v++){let D=e[v],P=ql(D);(P.min.x>=u&&P.max.x<=m&&P.min.y>=d&&P.max.y<=g?b:C).push(D)}if(b.length===e.length)return e;let T=[new it(u,d),new it(m,d),new it(m,g),new it(u,g),new it(u,d)],I=b;for(let D of C)I.push(...S5(D,T));return I}}let PO,OO,RO,kO;kt(FT,"FillBucket",{omit:["layers","patternFeatures"]}),kt(kT,"FillBufferData"),kt(Ys,"ElevatedStructures");class Zb{constructor(e,s,u,d){if(this.triangleCount=s.length/3,this.min=new it(0,0),this.max=new it(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,g]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let D=e[I];m.x=Math.min(m.x,D.x),m.y=Math.min(m.y,D.y),g.x=Math.max(g.x,D.x),g.y=Math.max(g.y,D.y)}if(d){let I=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/d);u=Math.max(u,I)}if(u===0)return;this.min=m,this.max=g;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let b=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;let C=[];for(let I=0;I<this.triangleCount;I++){let D=e[s[3*I+0]].sub(this.min),P=e[s[3*I+1]].sub(this.min),R=e[s[3*I+2]].sub(this.min),z=eu(Math.floor(Math.min(D.x,P.x,R.x)),this.xScale,this.cellsX),H=eu(Math.floor(Math.max(D.x,P.x,R.x)),this.xScale,this.cellsX),$=eu(Math.floor(Math.min(D.y,P.y,R.y)),this.yScale,this.cellsY),Z=eu(Math.floor(Math.max(D.y,P.y,R.y)),this.yScale,this.cellsY),Y=new it(0,0),te=new it(0,0),he=new it(0,0),ae=new it(0,0);for(let me=$;me<=Z;++me){Y.y=te.y=me*b,he.y=ae.y=(me+1)*b;for(let ye=z;ye<=H;++ye)Y.x=he.x=ye*b,te.x=ae.x=(ye+1)*b,(Vo(D,P,R,Y,te,ae)||Vo(D,P,R,Y,ae,he))&&C.push({cellIdx:me*this.cellsX+ye,triIdx:I})}}if(C.length===0)return;C.sort((I,D)=>I.cellIdx-D.cellIdx||I.triIdx-D.triIdx);let T=0;for(;T<C.length;){let I=C[T].cellIdx,D={start:this.payload.length,len:0};for(;T<C.length&&C[T].cellIdx===I;)++D.len,this.payload.push(C[T++].triIdx);this.cells[I]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let u=eu(e.x-this.min.x,this.xScale,this.cellsX),d=eu(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[d*this.cellsX+u];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){let v=this.payload[m.start+g],b=Math.floor(v/8),C=1<<v%8;if(!(this.lookup[b]&C)&&(this.lookup[b]|=C,s.push(v),s.length===this.triangleCount))return}}}query(e,s,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>s.x||e.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();let d=eu(e.x-this.min.x,this.xScale,this.cellsX),m=eu(s.x-this.min.x,this.xScale,this.cellsX),g=eu(e.y-this.min.y,this.yScale,this.cellsY),v=eu(s.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=v;b++)for(let C=d;C<=m;C++){let T=this.cells[b*this.cellsX+C];if(T)for(let I=0;I<T.len;I++){let D=this.payload[T.start+I],P=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,u.push(D),u.length===this.triangleCount))return}}}}function eu(a,e,s){return Math.max(0,Math.min(s-1,Math.floor(a*e)))}kt(Zb,"TriangleGridIndex");class FO{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){for(let u of this.footprints)s.push({footprint:u,id:e})}updateAppearances(e,s,u,d){}populate(e,s,u,d){let m=[];for(let{feature:g,id:v,index:b,sourceLayerIndex:C}of e){let T=this.layers[0]._featureFilter.needGeometry,I=Se(g,T);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:v,properties:g.properties,type:g.type,sourceLayerIndex:C,index:b,geometry:T?I.geometry:_e(g,u,d),patterns:{}};m.push(D)}for(let g of m){let{geometry:v,index:b,sourceLayerIndex:C}=g;this.addFeature(g,v,b,u,{},s.availableImages,s.brightness),s.featureIndex.insert(e[b].feature,v,b,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,s,u,d,m,g,v){}destroy(){}addFeature(e,s,u,d,m,g=[],v){for(let b of l0(s,2)){let C=[],T=[],I=[],D=new it(1/0,1/0),P=new it(-1/0,-1/0);for(let H of b)if(H.length!==0){H!==b[0]&&I.push(T.length/2);for(let $=0;$<H.length;$++)T.push(H[$].x),T.push(H[$].y),C.push(H[$]),D.x=Math.min(D.x,H[$].x),D.y=Math.min(D.y,H[$].y),P.x=Math.max(P.x,H[$].x),P.y=Math.max(P.y,H[$].y)}let R=rg(T,I),z=new Zb(C,R,8,256);this.footprints.push({vertices:C,indices:R,grid:z,min:D,max:P})}}}kt(FO,"ClipBucket",{omit:["layers"]});let I5=Pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),M5=Pn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),D5=Pn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),A5=Pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),P5=Pn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),O5=Pn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),R5=Pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:k5}=I5,c0=Number.MAX_SAFE_INTEGER,LO=c0-1;function NO(a,e,s,u){return a.order<e||a.order===c0||!(a.clipMask&s)||(function(d,m){return m.length!==0&&m.find(g=>g===d)===void 0})(u,a.clipScope)}function Xb(a,e){return a.x-e.x||a.y-e.y}function zO(a,e){return Xb(a.min,e.min)===0&&Xb(a.max,e.max)===0}function LT(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function Yb(a,e){if(a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==e[s].sourceId||!zO(a[s],e[s])||a[s].order!==e[s].order||a[s].clipMask!==e[s].clipMask||!jl(a[s].clipScope,e[s].clipScope))return!1;return!0}function BO(a,e,s){let u=1/_t,d=1/(1<<s.canonical.z),m=(e.x*u+s.canonical.x)*d+s.wrap,g=(e.y*u+s.canonical.y)*d;return{min:new it((a.x*u+s.canonical.x)*d+s.wrap,(a.y*u+s.canonical.y)*d),max:new it(m,g)}}function F5(a,e,s){let u=1<<s.canonical.z,d=((e.x-s.wrap)*u-s.canonical.x)*_t,m=(e.y*u-s.canonical.y)*_t;return{min:new it(((a.x-s.wrap)*u-s.canonical.x)*_t,(a.y*u-s.canonical.y)*_t),max:new it(d,m)}}function NT(a,e,s,u,d,m,g){let v=a.indices,b=a.vertices,C=[];for(let T=u;T<u+d;T+=3){let I=e[s[T+0]+m],D=e[s[T+1]+m],P=e[s[T+2]+m],R=Math.min(I.x,D.x,P.x),z=Math.max(I.x,D.x,P.x),H=Math.min(I.y,D.y,P.y),$=Math.max(I.y,D.y,P.y);C.length=0,a.grid.query(new it(R,H),new it(z,$),C);for(let Z=0;Z<C.length;Z++){let Y=C[Z];if(Vo(b[v[3*Y+0]],b[v[3*Y+1]],b[v[3*Y+2]],I,D,P,g))return!0}}return!1}function VO(a,e,s,u){if(!a||!s)return!1;let d=a.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(s.vertices.length<a.vertices.length)return VO(s,u,a,e);let m=e.canonical,g=u.canonical,v=Math.pow(2,g.z-m.z);d=a.vertices.map(b=>new it((b.x+m.x*_t)*v-g.x*_t,(b.y+m.y*_t)*v-g.y*_t))}return NT(s,d,a.indices,0,a.indices.length,0,0)}function UO(a,e,s,u){let d=Math.pow(2,u.z-s.z);return new it((a+s.x*_t)*d-u.x*_t,(e+s.y*_t)*d-u.y*_t)}function jO(a,e){let s=[];e.grid.queryPoint(a,s);let u=e.indices,d=e.vertices;for(let m=0;m<s.length;m++){let g=s[m];if(Ei([d[u[3*g+0]],d[u[3*g+1]],d[u[3*g+2]]],a))return!0}return!1}let zT=[new it(0,0),new it(_t,0),new it(_t,_t),new it(0,_t)];function $O(a,e){let s=[],u=[];if(!e||a.length<2)return[a];if(a.length===2)return Io(a[0],a[1],zT)?[a]:[];for(let d=0;d<a.length+2;d++){let m=a[d%a.length],g=a[(d+1)%a.length],v=Io(d===0?a[a.length-1]:a[(d-1)%a.length],m,zT),b=Io(m,g,zT),C=v||b;C&&u.push(m),C&&b||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}let BT=Ce.types,L5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],N5=["fill-extrusion-flood-light-ground-radius"],z5=Math.pow(2,13),B5=Math.pow(2,15)-1,HO=new it(0,1),ad=2147483648,GO=7,qO=450;function u0(a,e,s,u,d,m,g,v){a.emplaceBack((e<<1)+g,(s<<1)+m,(Math.floor(u*z5)<<1)+d,Math.round(v))}function d0(a,e,s){a.emplaceBack(e.x*_t,e.y*_t,s?1:0)}function Kb(a,e,s,u,d,m){a.emplaceBack(e.x,e.y,(s.x<<1)+u,(s.y<<1)+d,m)}function h0(a,e,s){a.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class WO{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ZO{constructor(){this.centroidXY=new it(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new it(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new it(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new it(this.max.x-this.min.x,this.max.y-this.min.y)}}class XO{constructor(){this.acc=new it(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,s){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=s.x,e.min.y=e.max.y=s.y)}appendEdge(e,s,u){this.accCount++,this.acc._add(s);let d=!!this.borders;s.x<e.min.x?(e.min.x=s.x,d=!0):s.x>e.max.x&&(e.max.x=s.x,d=!0),s.y<e.min.y?(e.min.y=s.y,d=!0):s.y>e.max.y&&(e.max.y=s.y,d=!0),((s.x===0||s.x===_t)&&s.x===u.x)!=((s.y===0||s.y===_t)&&s.y===u.y)&&this.processBorderOverlap(s,u),d&&this.checkBorderIntersection(s,u)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,on(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>_t!=e.x>_t&&this.addBorderIntersection(1,on(s.y,e.y,(_t-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,on(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>_t!=e.y>_t&&this.addBorderIntersection(3,on(s.x,e.x,(_t-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[e];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;let u=e.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,e.y)}else{let u=e.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new it(0,0):new it(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0):0}}function YO(a,e){let s=a.add(e)._unit(),u=G(a.x*s.x+a.y*s.y,-1,1);var d,m,g;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*B5*((m=a).x*(g=e).y-m.y*g.x<0?-1:1)}let V5=[a=>a.x<0,a=>a.x>_t,a=>a.y<0,a=>a.y>_t];function U5(a,e,s,u){let d=[4];if(u===0)return d;s._mult(u);let m=a.sub(s),g=e.sub(s),v=[a,e,m,g];for(let b=0;b<4;b++)for(let C of v)if(V5[b](C)){d.push(b);break}return d}class VT{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new zv,this.indexArray=new qr,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut},s=>N5.includes(s)),this._segments=new Ji,this.hiddenByLandmarkVertexArray=new qm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ji}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,s,u,d=!1){let m=e.length;if(m>2){let g=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let C=e[0],T=e[1];b=YO(C.sub(e[m-1])._perp()._unit(),T.sub(C)._perp()._unit())}for(let C=0;C<m;C++){let T=C===m-1?0:C+1,I=e[C],D=e[T],P=e[T===m-1?0:T+1],R=D.sub(I)._perp()._unit(),z=YO(R,P.sub(D)._perp()._unit()),H=b,$=z;if(UT(I,D,s)||d&&JO(I,s)&&JO(D,s)){b=z;continue}let Z=v.vertexLength;Kb(this.vertexArray,I,D,1,1,H),Kb(this.vertexArray,I,D,1,0,H),Kb(this.vertexArray,I,D,0,1,$),Kb(this.vertexArray,I,D,0,0,$),v.vertexLength+=4;let Y=U5(I,D,R,u);for(let te of Y)this._segmentToGroundQuads[g].push({id:Z,region:te}),this._segmentToRegionTriCounts[g][te]+=2,v.primitiveLength+=2;b=z}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),s=e.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((d,m)=>d.region-m.region);for(let u=0;u<s;u++){let d=this._segmentToGroundQuads[u],m=e[u],g=this._segmentToRegionTriCounts[u];g.reduce((b,C)=>b+C,0);let v=0;for(let b=0;b<=4;b++){let C=g[b];if(C!==0){let T=this.regionSegments[b];T||(T=this.regionSegments[b]=new Ji);let I={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:C};T.get().push(I)}v+=C}for(let b=0;b<d.length;b++){let C=d[b].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,s,u,d,m,g,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,s,u,d,m,g,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,M5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,D5.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,s,u,d,m,g,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,s,u,d,m,g,v,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&ad))}updateHiddenByLandmarkRange(e,s,u){if(!this.hasData())return;let d=s+e;if(s!==0){for(let m=e;m<d;++m)this.hiddenByLandmarkVertexArray.emplace(m,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,O5.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let s=this.regionSegments[e];s&&s.destroy()}}}}class Qb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qr,this.footprintVertices=new Xc,this.footprintSegments=[],this.layoutVertexArray=new Jd,this.centroidVertexArray=new Bb,this.wallVertexArray=new Dp,this.indexArray=new qr,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut},s=>L5.includes(s)),this.segments=new Ji,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new VT(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.features=[],this.hasPattern=PT("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=q(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:m,id:g,index:v,sourceLayerIndex:b}of e){let C=this.layers[0]._featureFilter.needGeometry,T=Se(m,C);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),T,u))continue;let I={id:g,sourceLayerIndex:b,index:v,geometry:C?T.geometry:_e(m,u,d),properties:m.properties,type:m.type,patterns:{}},D=this.layoutVertexArray.length,P=BT[I.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:OT("fill-extrusion",this.layers,I,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(let R of I.geometry)for(let z of $O(R,P))this.addFeature(m.id,I,[z],v,u,{},s.availableImages,d,s.brightness);else this.addFeature(m.id,I,I.geometry,v,u,{},s.availableImages,d,s.brightness);s.featureIndex.insert(m,I.geometry,v,b,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,s,u,d,m,g){for(let{featureId:v,feature:b}of this.features){let C=BT[b.type]==="Polygon",{geometry:T}=b;if(this.wallMode)for(let I of T)for(let D of $O(I,C))this.addFeature(v,b,[D],b.index,s,u,d,m,g);else this.addFeature(v,b,T,b.index,s,u,d,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview),this.groundEffect.update(e,s,m,u,d,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,k5),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,P5.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,R5.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,A5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,u,d,m,g,v,b,C){let T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,I=[new it(0,0),new it(_t,_t)],D=b.projection,P=D.name==="globe",R=this.wallMode||BT[s.type]==="Polygon",z=new XO;z.centroidDataIndex=this.centroidData.length;let H=new ZO;H.buildingId=e,s.properties&&s.properties.hasOwnProperty("building_id")&&(H.buildingId=s.properties.building_id);let $=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},m)<=0,Z=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},m),Y;if(H.height=Z,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vm),this.wallMode){if(P)return void Dt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;Y=(function(Te){let qe=Te[0].x===Te[Te.length-1].x&&Te[0].y===Te[Te.length-1].y;(function(Pt){let Nt=0,Tn=Pt.length;for(let dt=0;dt<Tn;dt++)Nt+=(Pt[(dt+1)%Tn].x-Pt[dt].x)*(Pt[(dt+1)%Tn].y+Pt[dt].y);return Nt>=0})(Te)||(Te=Te.reverse());let Ke={geometry:[],joinNormals:[],indices:[]},rt=[],st=[],et=[],tt=Te.length;for(;tt>=2&&Te[tt-1].equals(Te[tt-2]);)tt--;if(tt<(qe?3:2))return Ke;let Ge,$e,nt,vt,ut,Gt=0;for(;Gt<tt-1&&Te[Gt].equals(Te[Gt+1]);)Gt++;qe&&(Ge=Te[tt-2],ut=Te[Gt].sub(Ge)._unit()._perp());for(let Pt=Gt;Pt<tt;Pt++){if(nt=Pt===tt-1?qe?Te[Gt+1]:void 0:Te[Pt+1],nt&&Te[Pt].equals(nt))continue;ut&&(vt=ut),Ge&&($e=Ge),Ge=Te[Pt],ut=nt?nt.sub(Ge)._unit()._perp():vt,vt=vt||ut;let Nt=vt.add(ut);Nt.x===0&&Nt.y===0||Nt._unit();let Tn=Nt.x*ut.x+Nt.y*ut.y,dt=Tn!==0?1/Tn:1/0,zt=vt.x*ut.y-vt.y*ut.x>0,un="miter",Ln=2;un==="miter"&&dt>Ln&&(un="bevel"),un==="bevel"&&(dt>100&&(un="flipbevel"),dt<Ln&&(un="miter"));let zn=(_n,_i,ce,pe)=>{let We=new it(_n.x,_n.y),ot=new it(_n.x,_n.y);We.x+=_i.x*pe,We.y+=_i.y*pe,ot.x-=_i.x*Math.max(ce,1),ot.y-=_i.y*Math.max(ce,1),et.push(_i),rt.push(We),st.push(ot)};if(un==="miter")Nt._mult(dt),zn(Ge,Nt,0,0);else if(un==="flipbevel")Nt=ut.mult(-1),zn(Ge,Nt,0,0),zn(Ge,Nt.mult(-1),0,0);else{let _n=-Math.sqrt(dt*dt-1),_i=zt?_n:0,ce=zt?0:_n;$e&&zn(Ge,vt,_i,ce),nt&&zn(Ge,ut,_i,ce)}}Ke.geometry=[...rt,...st.reverse(),rt[0]],Ke.joinNormals=[...et,...et.reverse(),et[et.length-1]];let Tt=Ke.geometry.length-1;for(let Pt=0;Pt<Tt/2;Pt++)if(Pt+1<Tt/2){let Nt=Pt,Tn=Pt+1,dt=Tt-1-Pt,zt=Tt-2-Pt;Nt=Nt===0?Tt-1:Nt-1,Tn=Tn===0?Tt-1:Tn-1,dt=dt===0?Tt-1:dt-1,zt=zt===0?Tt-1:zt-1,Ke.indices.push(dt),Ke.indices.push(Tn),Ke.indices.push(Nt),Ke.indices.push(dt),Ke.indices.push(zt),Ke.indices.push(Tn)}return Ke})(u[0]),u=[Y.geometry]}let te=(Te,qe)=>Te<(qe.length-1)/2||Te===qe.length-1,he=this.wallMode?[u]:l0(u,500);for(let Te=he.length-1;Te>=0;Te--){let qe=he[Te];(qe.length===0||(ae=qe[0]).every(Ye=>Ye.x<=0)||ae.every(Ye=>Ye.x>=_t)||ae.every(Ye=>Ye.y<=0)||ae.every(Ye=>Ye.y>=_t))&&he.splice(Te,1)}var ae;let me;if(P)me=iR(he,I,m);else{me=[];for(let Te of he)me.push({polygon:Te,bounds:I})}let ye=R?this.edgeRadius:0,we=ye>0&&this.zoom<17,je=(Te,qe)=>{if(Te.length===0)return!1;let Ye=Te[Te.length-1];return qe.x===Ye.x&&qe.y===Ye.y};for(let{polygon:Te,bounds:qe}of me){let Ye=0,Ke=0;for(let tt of Te)R&&!tt[0].equals(tt[tt.length-1])&&tt.push(tt[0]),Ke+=R?tt.length-1:tt.length;let rt=this.segments.prepareSegment((R?5:4)*Ke,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);let st={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},et=new WO;if(et.vertexOffset=this.footprintVertices.length,et.indexOffset=3*this.footprintIndices.length,et.ringIndices=[],R){let tt=[],Ge=[];Ye=rt.vertexLength;for(let nt=0;nt<Te.length;nt++){let vt=Te[nt];vt.length&&nt!==0&&Ge.push(tt.length/2);let ut=[],Gt,Tt;Gt=vt[1].sub(vt[0])._perp()._unit(),et.ringIndices.push(vt.length-1);for(let Pt=1;Pt<vt.length;Pt++){let Nt=vt[Pt],Tn=vt[Pt===vt.length-1?1:Pt+1],dt=Nt.clone();if(ye){Tt=Tn.sub(Nt)._perp()._unit();let zt=Gt.add(Tt)._unit(),un=ye*Math.min(4,1/(Gt.x*zt.x+Gt.y*zt.y));dt.x+=un*zt.x,dt.y+=un*zt.y,dt.x=Math.round(dt.x),dt.y=Math.round(dt.y),Gt=Tt}if(!$||ye!==0&&!we||je(ut,dt)||ut.push(dt),u0(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),this.wallMode){let zt=te(Pt,vt);d0(this.wallVertexArray,Y.joinNormals[Pt],!zt)}rt.vertexLength++,this.footprintVertices.emplaceBack(Nt.x,Nt.y),tt.push(Nt.x,Nt.y),P&&h0(this.layoutVertexExtArray,D.projectTilePoint(dt.x,dt.y,m),D.upVector(m,dt.x,dt.y))}$&&(ye===0||we)&&(ut.length!==0&&je(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,qe,T))}let $e=this.wallMode?Y.indices:rg(tt,Ge);for(let nt=0;nt<$e.length;nt+=3)this.footprintIndices.emplaceBack(et.vertexOffset+$e[nt+0],et.vertexOffset+$e[nt+1],et.vertexOffset+$e[nt+2]),this.indexArray.emplaceBack(Ye+$e[nt],Ye+$e[nt+2],Ye+$e[nt+1]),rt.primitiveLength++;et.indexCount+=$e.length,et.vertexCount+=this.footprintVertices.length-et.vertexOffset}for(let tt=0;tt<Te.length;tt++){let Ge=Te[tt];z.startRing(H,Ge[0]);let $e=Ge.length>4&&eR(Ge[Ge.length-2],Ge[0],Ge[1]),nt=ye?j5(Ge[Ge.length-2],Ge[0],Ge[1],ye):0,vt=[],ut,Gt,Tt;Gt=Ge[1].sub(Ge[0])._perp()._unit();let Pt=!0;for(let Nt=1,Tn=0;Nt<Ge.length;Nt++){let dt=Ge[Nt-1],zt=Ge[Nt],un=Ge[Nt===Ge.length-1?1:Nt+1];if(z.appendEdge(H,zt,dt),UT(zt,dt,qe)){ye&&(Gt=un.sub(zt)._perp()._unit(),Pt=!Pt);continue}let Ln=zt.sub(dt)._perp(),zn=Ln.x/(Math.abs(Ln.x)+Math.abs(Ln.y)),_n=Ln.y>0?1:0,_i=dt.dist(zt);if(Tn+_i>32768&&(Tn=0),ye){Tt=un.sub(zt)._perp()._unit();let ot=QO(dt,zt,un,KO(Gt,Tt),ye);isNaN(ot)&&(ot=0);let Ct=zt.sub(dt)._unit();dt=dt.add(Ct.mult(nt))._round(),zt=zt.add(Ct.mult(-ot))._round(),nt=ot,Gt=Tt,$&&this.zoom>=17&&(je(vt,dt)||vt.push(dt),je(vt,zt)||vt.push(zt))}let ce=rt.vertexLength,pe=Ge.length>4&&eR(dt,zt,un),We=tR(Tn,$e,Pt);if(u0(this.layoutVertexArray,dt.x,dt.y,zn,_n,0,0,We),u0(this.layoutVertexArray,dt.x,dt.y,zn,_n,0,1,We),this.wallMode){let ot=te(Nt-1,Ge),Ct=Y.joinNormals[Nt-1];d0(this.wallVertexArray,Ct,ot),d0(this.wallVertexArray,Ct,ot)}if(Tn+=_i,We=tR(Tn,pe,!Pt),$e=pe,u0(this.layoutVertexArray,zt.x,zt.y,zn,_n,0,0,We),u0(this.layoutVertexArray,zt.x,zt.y,zn,_n,0,1,We),this.wallMode){let ot=te(Nt,Ge),Ct=Y.joinNormals[Nt];d0(this.wallVertexArray,Ct,ot),d0(this.wallVertexArray,Ct,ot)}if(rt.vertexLength+=4,this.indexArray.emplaceBack(ce+0,ce+1,ce+2),this.indexArray.emplaceBack(ce+1,ce+3,ce+2),rt.primitiveLength+=2,ye){let ot=Ye+(Nt===1?Ge.length-2:Nt-2),Ct=Nt===1?Ye:ot+1;if(this.indexArray.emplaceBack(ce+1,ot,ce+3),this.indexArray.emplaceBack(ot,Ct,ce+3),rt.primitiveLength+=2,ut===void 0&&(ut=ce),!UT(un,Ge[Nt],qe)){let Et=Nt===Ge.length-1?ut:rt.vertexLength;this.indexArray.emplaceBack(ce+2,ce+3,Et),this.indexArray.emplaceBack(ce+3,Et+1,Et),this.indexArray.emplaceBack(ce+3,Ct,Et+1),rt.primitiveLength+=3}Pt=!Pt}if(P){let ot=this.layoutVertexExtArray,Ct=D.projectTilePoint(dt.x,dt.y,m),Et=D.projectTilePoint(zt.x,zt.y,m),qt=D.upVector(m,dt.x,dt.y),Xt=D.upVector(m,zt.x,zt.y);h0(ot,Ct,qt),h0(ot,Ct,qt),h0(ot,Et,Xt),h0(ot,Et,Xt)}}R&&(Ye+=Ge.length-1),$&&ye&&this.zoom>=17&&(vt.length!==0&&je(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,qe,T,ye>0))}this.footprintSegments.push(et),st.triangleCount=this.indexArray.length-st.triangleArrayOffset,this.polygonSegments.push(st),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=z.borders?HO:this.encodeCentroid(z,H),this.centroidData.push(H),z.borders){this.featuresOnBorder.push(z);let Te=this.featuresOnBorder.length-1;for(let qe=0;qe<z.borders.length;qe++)z.borders[qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[qe].push(Te)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,g,v,m,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,d,g,v,m,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,Z)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((s,u)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}splitToSubtiles(){let e=[];for(let v=0;v<this.centroidData.length;v++){let b=this.centroidData[v],C=+(b.min.y+b.max.y>_t),T=2*C+(+(b.min.x+b.max.x>_t)^C);for(let I=0;I<b.polygonSegLen;I++){let D=b.polygonSegIdx+I;e.push({centroidIdx:v,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let s=new qr;e.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let u=0,d=0,m=0;for(let v of e){if(v.triangleSegmentIdx!==u)break;m++}let g=e.length;for(;d!==e.length;){u=e[d].triangleSegmentIdx;let v=0,b=d,C=d;for(let T=b;T<m&&e[T].subtile===v;T++)C++;for(;b!==m;){let T=e[b];v=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=b;R<C;R++){let z=e[R],H=this.polygonSegments[z.polygonSegmentIdx],$=this.centroidData[z.centroidIdx].min,Z=this.centroidData[z.centroidIdx].max,Y=this.indexArray.uint16;for(let te=H.triangleArrayOffset;te<H.triangleArrayOffset+H.triangleCount;te++)s.emplaceBack(Y[3*te],Y[3*te+1],Y[3*te+2]);P.primitiveLength+=H.triangleCount,I.x=Math.min(I.x,$.x),I.y=Math.min(I.y,$.y),D.x=Math.max(D.x,Z.x),D.y=Math.max(D.y,Z.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:I,max:D}),b=C;for(let R=b;R<m&&e[R].subtile===e[b].subtile;R++)C++}d=m;for(let T=d;T<g&&e[T].triangleSegmentIdx===e[d].triangleSegmentIdx;T++)m++}s._trim(),this.indexArray=s}getVisibleSegments(e,s,u){let d=new Ji;if(this.wallMode){for(let z of this.triangleSubSegments)d.segments.push(z.segment);return d}let m=0,g=0,v=1<<e.canonical.z;if(s){let z=s.getMinMaxForTile(e);z&&(m=z.min,g=z.max)}g+=this.maxHeight;let b=e.toUnwrapped(),C,T=[b.canonical.x/v+b.wrap,b.canonical.y/v],I=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],D=(z,H,$)=>[z[0]*(1-$[0])+H[0]*$[0],z[1]*(1-$[1])+H[1]*$[1]],P=[],R=[];for(let z of this.triangleSubSegments){P[0]=z.min.x/_t,P[1]=z.min.y/_t,R[0]=z.max.x/_t,R[1]=z.max.y/_t;let H=D(T,I,P),$=D(T,I,R);if(new Ut([H[0],H[1],m],[$[0],$[1],g]).intersectsPrecise(u)===0){C&&(d.segments.push(C),C=void 0);continue}let Z=z.segment;C&&C.vertexOffset!==Z.vertexOffset&&(d.segments.push(C),C=void 0),C?(C.vertexLength+=Z.vertexLength,C.primitiveLength+=Z.primitiveLength):C={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&d.segments.push(C),d}encodeCentroid(e,s){let u=e.centroid(),d=s.span(),m=Math.min(7,Math.round(d.x*this.tileToMeter/10)),g=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new it(G(u.x,1,_t-1)<<3|m,G(u.y,1,_t-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new it(0,0);let s=e.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){let d=s[0][0]!==u?0:1;return new it(6|(s[0][0]!==u?0:65528),(s[d][0]+s[d][1])/2<<3|6)}{let d=s[2][0]!==u?2:3;return new it((s[d][0]+s[d][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(e){let s=this.centroidData[e.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let s=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,d=e.flags&ad?HO:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==d.y||m!==d.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let d=s.getReplacementRegionsForTile(e.toUnwrapped());if(Yb(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let g of this.centroidData)g.flags&=2147483647;let m=[];for(let g of this.activeReplacements){if(g.order<u)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingIds)for(let b of this.centroidData)b.flags&ad||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y||g.footprint.buildingIds.has(b.buildingId)&&(b.flags|=ad);else for(let b of this.centroidData)if(!(b.flags&ad||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y))for(let C=0;C<b.footprintSegLen;C++){let T=this.footprintSegments[b.footprintSegIdx+C];if(m.length=0,$5(this.footprintVertices,T.vertexOffset,T.vertexCount,g.footprintTileId.canonical,e.canonical,m),NT(g.footprint,m,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-v)){b.flags|=ad;break}}}for(let g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,s,u){let d=!1;for(let m=0;m<u.footprintSegLen;m++){let g=this.footprintSegments[u.footprintSegIdx+m],v=0;for(let b of g.ringIndices){for(let C=v,T=b+v-1;C<b+v;T=C++){let I=this.footprintVertices.int16[2*(C+g.vertexOffset)+0],D=this.footprintVertices.int16[2*(C+g.vertexOffset)+1],P=this.footprintVertices.int16[2*(T+g.vertexOffset)+1];D>s!=P>s&&e<(this.footprintVertices.int16[2*(T+g.vertexOffset)+0]-I)*(s-D)/(P-D)+I&&(d=!d)}v=b}}return d}getHeightAtTileCoord(e,s){let u=Number.NEGATIVE_INFINITY,d=!0,m=4*(e+_t)*_t+(s+_t);if(this.partLookup.hasOwnProperty(m)){let g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&ad)}:void 0}for(let g of this.centroidData)e>g.max.x||g.min.x>e||s>g.max.y||g.min.y>s||g.height<=u||this.footprintContainsPoint(e,s,g)&&(u=g.height,this.partLookup[m]=g,d=!!(g.flags&ad));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[m]=void 0}}function KO(a,e){let s=a.add(e)._unit();return a.x*s.x+a.y*s.y}function j5(a,e,s,u){let d=e.sub(a)._perp()._unit(),m=s.sub(e)._perp()._unit();return QO(a,e,s,KO(d,m),u)}function QO(a,e,s,u,d){let m=Math.sqrt(1-u*u);return Math.min(a.dist(e)/3,e.dist(s)/3,d*m/u)}function UT(a,e,s){return a.x<s[0].x&&e.x<s[0].x||a.x>s[1].x&&e.x>s[1].x||a.y<s[0].y&&e.y<s[0].y||a.y>s[1].y&&e.y>s[1].y}function JO(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function eR(a,e,s){if(a.x<0||a.x>=_t||e.x<0||e.x>=_t||s.x<0||s.x>=_t)return!1;let u=s.sub(e),d=u.perp(),m=a.sub(e);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function tR(a,e,s){let u=e?2|a:-3&a;return s?1|u:-2&u}function nR(){let a=Math.PI/32,e=Math.tan(a),s=p;return s*Math.sqrt(1+2*e*e)-s}function iR(a,e,s){let u=1<<s.z,d=A(s.x/u),m=A((s.x+1)/u),g=F(s.y/u),v=F((s.y+1)/u);return(function(b,C,T,I,D=0,P){let R=[];if(!b.length||!T||!I)return R;let z=(ae,me)=>{for(let ye of ae)R.push({polygon:ye,bounds:me})},H=Math.ceil(Math.log2(T)),$=Math.ceil(Math.log2(I)),Z=H-$,Y=[];for(let ae=0;ae<Math.abs(Z);ae++)Y.push(Z>0?0:1);for(let ae=0;ae<Math.min(H,$);ae++)Y.push(0),Y.push(1);let te=b;if(te=Wb(te,C[0].y-D,C[1].y+D,1),te=Wb(te,C[0].x-D,C[1].x+D,0),!te.length)return R;let he=[];for(Y.length?he.push({polygons:te,bounds:C,depth:0}):z(te,C);he.length;){let ae=he.pop(),me=ae.depth,ye=Y[me],we=ae.bounds[0],je=ae.bounds[1],Te=ye===0?we.x:we.y,qe=ye===0?je.x:je.y,Ye=P?P(ye,Te,qe):.5*(Te+qe),Ke=Wb(ae.polygons,Te-D,Ye+D,ye),rt=Wb(ae.polygons,Ye-D,qe+D,ye);if(Ke.length){let st=[we,new it(ye===0?Ye:je.x,ye===1?Ye:je.y)];Y.length>me+1?he.push({polygons:Ke,bounds:st,depth:me+1}):z(Ke,st)}if(rt.length){let st=[new it(ye===0?Ye:we.x,ye===1?Ye:we.y),je];Y.length>me+1?he.push({polygons:rt,bounds:st,depth:me+1}):z(rt,st)}}return R})(a,e,Math.ceil((m-d)/11.25),Math.ceil((g-v)/11.25),1,(b,C,T)=>{if(b===0)return .5*(C+T);{let I=F((s.y+C/_t)/u);return(S(.5*(F((s.y+T/_t)/u)+I))*u-s.y)*_t}})}function $5(a,e,s,u,d,m){let g=Math.pow(2,u.z-d.z);for(let v=0;v<s;v++){let b=a.int16[2*(v+e)+0],C=a.int16[2*(v+e)+1];b=(b+d.x*_t)*g-u.x*_t,C=(C+d.y*_t)*g-u.y*_t,m.push(new it(b,C))}}let rR,oR;kt(Qb,"FillExtrusionBucket",{omit:["layers","features"]}),kt(ZO,"PartData"),kt(WO,"FootprintSegment"),kt(XO,"BorderCentroidData"),kt(VT,"GroundEffect");class Bp extends it{constructor(e,s,u){super(e,s),this.z=u}}class sR extends Bp{constructor(e,s,u,d){super(e,s,u),this.w=d}}function aR(a,e,s,u){let d=s==="x"?"y":"x",m=(u-a[s])/(e[s]-a[s]);a[d]=Math.round(a[d]+(e[d]-a[d])*m),a[s]=u,a.hasOwnProperty("z")&&(a.z=on(a.z,e.z,m)),a.hasOwnProperty("w")&&(a.w=on(a.w,e.w,m))}function lR(a,e,s,u){let d=s,m=u;for(let g of["x","y"]){let v=a,b=e;v[g]>=b[g]&&(v=e,b=a),v[g]<d&&b[g]>d&&aR(v,b,g,d),v[g]<m&&b[g]>m&&aR(b,v,g,m)}}function Jb(a,e,s,u,d,m){let g=[];for(let v=0;v<a.length;v++){let b=a[v],C,T=g.length,I=0;for(let D=0;D<b.length-1;D++){let P=b[D],R=b[D+1],z=0,H=I,$,Z;m&&(z=Math.hypot(R.x-P.x,R.y-P.y),I+=z,$=P,Z=R),P.x<e&&R.x<e||(P.x<e?P=new it(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<e&&(R=new it(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<s&&R.y<s||(P.y<s?P=new it(P.x+(s-P.y)/(R.y-P.y)*(R.x-P.x),s)._round():R.y<s&&(R=new it(P.x+(s-P.y)/(R.y-P.y)*(R.x-P.x),s)._round()),P.x>=u&&R.x>=u||(P.x>=u?P=new it(u,P.y+(u-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=u&&(R=new it(u,P.y+(u-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=d&&R.y>=d||(P.y>=d?P=new it(P.x+(d-P.y)/(R.y-P.y)*(R.x-P.x),d)._round():R.y>=d&&(R=new it(P.x+(d-P.y)/(R.y-P.y)*(R.x-P.x),d)._round()),C&&P.equals(C[C.length-1])||(C=[P],g.push(C),m&&m.push({progress:{min:H+cR($,Z,P)*z,max:1},parentIndex:v,prevPoint:$,nextPoint:Z})),C.push(R),m&&(m[m.length-1].progress.max=H+cR($,Z,R)*z,m[m.length-1].nextPoint=Z)))))}if(m&&I>0)for(let D=T;D<g.length;D++)m[D].progress.min/=I,m[D].progress.max/=I}return g}function H5(a,e,s,u,d){if(a.length<2)return void u.push(a);let m=[];for(;e.valid();){let[C,T]=e.get();for(let I=0;I<a.length-1;I++){let D=a[I],P=a[I+1],R=wn(D,P,C,T);if(R){let[z]=R,H=new it(on(D.x,P.x,z),on(D.y,P.y,z));m.push({t:I+z,distance:0,point:H})}}e.next()}if(m.length===0)return void u.push(a);m.sort((C,T)=>C.t-T.t);let g=0,v=0,b=[];for(u.push(b);g!==a.length;){if(v===m.length){for(;g!==a.length;)b.length!==0&&b[b.length-1].equals(a[g])||b.push(a[g]),g++;break}m[v].t<=g?(b.length!==0&&b[b.length-1].equals(m[v].point)||b.push(m[v].point),Math.trunc(m[v].t),v++):(b.length!==0&&b[b.length-1].equals(a[g])||b.push(a[g]),g++)}}function cR(a,e,s){return a.x!==e.x?(s.x-a.x)/(e.x-a.x):a.y!==e.y?(s.y-a.y)/(e.y-a.y):0}function p0(a,e){return a.x*e.x+a.y*e.y}function uR(a,e){if(a.length===1){let s=0,u=e[s++],d;for(;!d||u.equals(d);)if(d=e[s++],!d)return 1/0;for(;s<e.length;s++){let m=e[s],g=a[0],v=d.sub(u),b=m.sub(u),C=g.sub(u),T=p0(v,v),I=p0(v,b),D=p0(b,b),P=p0(C,v),R=p0(C,b),z=T*D-I*I,H=(D*P-I*R)/z,$=(T*R-I*P)/z,Z=u.z*(1-H-$)+d.z*H+m.z*$;if(isFinite(Z))return Z}return 1/0}{let s=1/0;for(let u of e)s=Math.min(s,u.z);return s}}function dR(a,e,s){let u=1/0;ti(s,e)&&(u=uR(s,e[0]));for(let d=0;d<e.length;d++){let m=e[d],g=a[d];for(let v=0;v<m.length-1;v++){let b=m[v],C=[b,m[v+1],g[v+1],g[v],b];Wn(s,C)&&(u=Math.min(u,uR(s,C)))}}return u!==1/0&&u}function hR(a,e,s,u,d,m,g,v,b,C,T){return a.projection.name==="globe"?(function(I,D,P,R,z,H,$,Z,Y,te,he){let ae=[],me=[],ye=I.projection.upVectorScale(he,I.center.lat,I.worldSize).metersToTile,we=[0,0,0,1],je=[0,0,0,1],Te=(Ye,Ke,rt,st)=>{Ye[0]=Ke,Ye[1]=rt,Ye[2]=st,Ye[3]=1},qe=nR();P>0&&(P+=qe),R+=qe;for(let Ye of D){let Ke=[],rt=[];for(let st of Ye){let et=st.x+z.x,tt=st.y+z.y,Ge=I.projection.projectTilePoint(et,tt,he),$e=I.projection.upVector(he,st.x,st.y),nt=P,vt=R;if($){let ut=pR(et,tt,P,R,$,Z,Y,te);nt+=ut.base,vt+=ut.top}P!==0?Te(we,Ge.x+$e[0]*ye*nt,Ge.y+$e[1]*ye*nt,Ge.z+$e[2]*ye*nt):Te(we,Ge.x,Ge.y,Ge.z),Te(je,Ge.x+$e[0]*ye*vt,Ge.y+$e[1]*ye*vt,Ge.z+$e[2]*ye*vt),Pr(we,we,H),Pr(je,je,H),Ke.push(new Bp(we[0],we[1],we[2])),rt.push(new Bp(je[0],je[1],je[2]))}ae.push(Ke),me.push(rt)}return[ae,me]})(a,e,s,u,d,m,g,v,b,C,T):g?(function(I,D,P,R,z,H,$,Z,Y){let te=[],he=[],ae=[0,0,0,1];for(let me of I){let ye=[],we=[];for(let je of me){let Te=je.x+R.x,qe=je.y+R.y,Ye=pR(Te,qe,D,P,H,$,Z,Y);ae[0]=Te,ae[1]=qe,ae[2]=Ye.base,ae[3]=1,Lo(ae,ae,z),ae[3]=Math.max(ae[3],1e-5);let Ke=new Bp(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);ae[0]=Te,ae[1]=qe,ae[2]=Ye.top,ae[3]=1,Lo(ae,ae,z),ae[3]=Math.max(ae[3],1e-5);let rt=new Bp(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);ye.push(Ke),we.push(rt)}te.push(ye),he.push(we)}return[te,he]})(e,s,u,d,m,g,v,b,C):(function(I,D,P,R,z){let H=[],$=[],Z=z[8]*D,Y=z[9]*D,te=z[10]*D,he=z[11]*D,ae=z[8]*P,me=z[9]*P,ye=z[10]*P,we=z[11]*P;for(let je of I){let Te=[],qe=[];for(let Ye of je){let Ke=Ye.x+R.x,rt=Ye.y+R.y,st=z[0]*Ke+z[4]*rt+z[12],et=z[1]*Ke+z[5]*rt+z[13],tt=z[2]*Ke+z[6]*rt+z[14],Ge=z[3]*Ke+z[7]*rt+z[15],$e=st+Z,nt=et+Y,vt=tt+te,ut=Math.max(Ge+he,1e-5),Gt=st+ae,Tt=et+me,Pt=tt+ye,Nt=Math.max(Ge+we,1e-5);Te.push(new Bp($e/ut,nt/ut,vt/ut)),qe.push(new Bp(Gt/Nt,Tt/Nt,Pt/Nt))}H.push(Te),$.push(qe)}return[H,$]})(e,s,u,d,m)}function pR(a,e,s,u,d,m,g,v){let b=g*d.getElevationAt(a,e,!0,!0),C=m[0]!==0,T=C?m[1]===0?g*(m[0]/GO-qO):g*(function(I,D,P){let R=Math.floor(D[0]/8),z=Math.floor(D[1]/8),H=10*(D[0]-8*R),$=10*(D[1]-8*z),Z=I.getElevationAt(R,z,!0,!0),Y=I.getMeterToDEM(P),te=Math.floor(.5*(H*Y-1)),he=Math.floor(.5*($*Y-1)),ae=I.tileCoordToPixel(R,z),me=2*te+1,ye=2*he+1,we=(function(rt,st,et,tt,Ge){return[rt.getElevationAtPixel(st,et,!0),rt.getElevationAtPixel(st+Ge,et,!0),rt.getElevationAtPixel(st,et+Ge,!0),rt.getElevationAtPixel(st+tt,et+Ge,!0)]})(I,ae.x-te,ae.y-he,me,ye),je=Math.abs(we[0]-we[1]),Te=Math.abs(we[2]-we[3]),qe=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Ye=Math.min(.25,.5*Y*(je+Te)/me),Ke=Math.min(.25,.5*Y*qe/ye);return Z+Math.max(Ye*H,Ke*$)})(d,m,v):b;return{base:b+(s===0?-1:s),top:C?Math.max(T+u,b+s+2):b+u}}class G5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class q5{constructor(){this.tasks={},this.taskQueue=[],Ie(["process"],this),this.invoker=new G5(this.process),this.nextId=0}add(e,s){let u=this.nextId++,d=(function({type:m,isSymbolTile:g,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-v:m==="maybePrepare"&&g?400-v:500:200-v:100-v})(s);if(d===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:s,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){let m=this.tasks[this.taskQueue[d]];m.priority<s&&(s=m.priority,e=d)}if(e===null)return null;let u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class fR{constructor(e,s,u){this.target=e,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ie(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new q5}send(e,s,u,d,m=!1,g){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[v]=u);let b=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!u,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:Zl(s,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){let s=e.data;if(!s)return;let u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){let d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(s.mustQueue||Vn(self)){let d=this.callbacks[u],m=this.scheduler.add(()=>this.processTask(u,s),d&&d.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,s)}processTask(e,s){if(delete this.cancelCallbacks[e],s.type==="<response>"){let u=this.callbacks[e];delete this.callbacks[e],u&&(s.error?u(Zc(s.error)):u(null,Zc(s.data)))}else{let u=new Set,d=s.hasCallback?(g,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Zl(g):null,data:Zl(v,u)},u)}:()=>{},m=Zc(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,m,d);else if(this.parent.getWorkerSource){let g=s.type.split("."),{source:v,scope:b}=m;this.parent.getWorkerSource(s.sourceMapId,g[0],v,b)[g[1]](m,d)}else d(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var f0={workerUrl:"",workerClass:null,workerParams:void 0};let jT="mapboxgl_preloaded_worker_pool",e1=(()=>{class a{constructor(s){this.active={},this.name=s}acquire(s,u=a.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;){let m=(d=`${this.name||""}WorkerPool: ${s}-${this.workers.length}`,f0.workerClass!=null?new f0.workerClass:new self.Worker(f0.workerUrl,Object.assign({name:d},f0.workerParams)));this.workers.push(m)}var d;return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jT]}numActive(){return Object.keys(this.active).length}}return a.workerCount=2,a})();class sg{constructor(e,s,u="Worker",d=e1.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ee();let m=this.workerPool.acquire(this.id,d);for(let g=0;g<m.length;g++){let v=new sg.Actor(m[g],s,this.id);v.name=`${u} ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,s,u){xe(this.actors,(d,m)=>{d.send(e,s,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let m0,$T;function t1(){return m0||(m0=new e1),m0}sg.Actor=fR;let HT=4096;class W5{constructor(e){this.module=e,this.memoryStack=this.module.malloc(HT),this.memoryStackNextFree=this.memoryStack}createIntArray(e){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>HT?-1:(new Int32Array(this.module.heap32.buffer,s,e.length).set(e),s)}createFloatArray(e){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>HT?-1:(new Float32Array(this.module.heapF32.buffer,s,e.length).set(e),s)}readStringBuffer(e){let s="";for(;this.module.heapU8[e]!==0;)s+=String.fromCharCode(this.module.heapU8[e]),++e;return s}setStyle(e){let s=e.normalScale;this.module.setStyle(s[0],s[1],s[2],e.tileToMeters)}setAOOptions(e,s){this.module.setAOOptions(e?1:0,s)}setMetricOptions(e,s){this.module.setMetricOptions(e?1:0,s)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,s){this.module.setFacadeOptions(e,s?1:0)}setFauxFacadeOptions(e,s,u){this.module.setFauxFacadeOptions(e?1:0,s?1:0,u)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,s){this.memoryStackNextFree=this.memoryStack;for(let v of e){let b=this.createIntArray(v.ringIndices),C=this.createFloatArray(v.coordinates);if(b===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,C,b,v.ringIndices.length-1)}for(let v of s){let b;b=v.entrances?JSON.parse(v.entrances):[];let C=this.createFloatArray(b),T=this.createFloatArray(v.coordinates);if(C===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,C,b.length,T,v.coordinates.length)}if(!this.module.generateMesh()){let v=this.module.getLastError();return this.readStringBuffer(v)}let u=this.module.getMeshCount(),d=new Array(u);for(let v=0;v<u;v++){let b=this.module.getPositionsPtr(v),C=this.module.getPositionsLength(v),T=new Float32Array(this.module.heapF32.buffer,b,C),I=this.module.getNormalsPtr(v),D=this.module.getNormalsLength(v),P=new Float32Array(this.module.heapF32.buffer,I,D),R=this.module.getAOPtr(v),z=this.module.getAOLength(v),H=new Float32Array(this.module.heapF32.buffer,R,z),$=this.module.getUVPtr(v),Z=this.module.getUVLength(v),Y=new Float32Array(this.module.heapF32.buffer,$,Z),te=this.module.getFauxFacadePtr(v),he=this.module.getFauxFacadeLength(v),ae=new Uint8Array(this.module.heapU8.buffer,te,he),me=this.module.getIndicesPtr(v),ye=this.module.getIndicesLength(v),we=new Int16Array(this.module.heap16.buffer,me,ye),je=this.module.getBuildingPart(v);d[v]={positions:T,normals:P,ao:H,uv:Y,isFauxFacade:ae,indices:we,buildingPart:je}}let m=this.module.getRingCount(),g=[];for(let v=0;v<m;v++){let b=this.module.getRingPtr(v),C=this.module.getRingLength(v),T=new Float32Array(this.module.heapF32.buffer,b,C);g.push(T)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let g0,GT,sc,ag,qT,lg=null,cg=null,mR=null,n1=null;function gR(){return Vn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:GT||kn.DRACO_URL}function _R(){if(Vn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ag)return ag;let a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ag=WebAssembly.validate(a)?kn.MESHOPT_SIMD_URL:kn.MESHOPT_URL,ag}function Z5(){return n1}let i1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},X5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},_0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function vR(a,e,s){let u=s.json.bufferViews.length,d=s.buffers.length;e.bufferView=u,s.json.bufferViews[u]={buffer:d,byteLength:a.byteLength},s.buffers[d]=a}let WT="KHR_draco_mesh_compression";function Y5(a,e){let s=a.extensions&&a.extensions[WT];if(!s)return;let u=new sc.Decoder,d=wR(e,s.bufferView),m=new sc.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,m))throw new Error("Failed to decode Draco mesh");let g=e.json.accessors[a.indices],v=i1[g.componentType],b=g.count*v.BYTES_PER_ELEMENT,C=sc._malloc(b);v===Uint16Array?u.GetTrianglesUInt16Array(m,b,C):u.GetTrianglesUInt32Array(m,b,C),vR(sc.memory.buffer.slice(C,C+b),g,e),sc._free(C);for(let T of Object.keys(s.attributes)){let I=u.GetAttributeByUniqueId(m,s.attributes[T]),D=e.json.accessors[a.attributes[T]],P=X5[D.componentType],R=D.count*_0[D.type]*i1[D.componentType].BYTES_PER_ELEMENT,z=sc._malloc(R);u.GetAttributeDataArrayForAllPoints(m,I,sc[P],R,z),vR(sc.memory.buffer.slice(z,z+R),D,e),sc._free(z)}u.destroy(),m.destroy(),delete a.extensions[WT]}let r1="EXT_meshopt_compression";function K5(a,e){if(!a.extensions||!a.extensions[r1])return;let s=a.extensions[r1],u=new Uint8Array(e.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),d=new Uint8Array(s.count*s.byteStride);qT.decodeGltfBuffer(d,s.count,s.byteStride,u,s.mode,s.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=d.buffer,delete a.extensions[r1]}let yR=1179937895,xR=new TextDecoder("utf8");function bR(a,e){return new URL(a,e).href}function Q5(a,e,s,u){return fetch(bR(a.uri,u)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[s]=d})}function wR(a,e){let s=a.json.bufferViews[e];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function J5(a,e,s,u){if(a.uri){let d=bR(a.uri,u);return fetch(d).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[s]=m})}if(a.bufferView!==void 0){let d=wR(e,a.bufferView),m=new Blob([d],{type:a.mimeType});return createImageBitmap(m).then(g=>{e.images[s]=g})}}function CR(a,e=0,s){let u={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===yR){let T=new Uint32Array(a,e),I=2,D=(T[I++]>>2)-3,P=T[I++]>>2;if(I++,u.json=JSON.parse(xR.decode(T.subarray(I,I+P))),I+=P,I<D){let R=T[I++];I++;let z=e+(I<<2);u.buffers[0]=a.slice(z,z+R)}}else u.json=JSON.parse(xR.decode(new Uint8Array(a,e)));let{buffers:d,images:m,meshes:g,extensionsUsed:v,bufferViews:b}=u.json,C=Promise.resolve();if(d){let T=[];for(let I=0;I<d.length;I++){let D=d[I];D.uri?T.push(Q5(D,u,I,s)):u.buffers[I]||(u.buffers[I]=null)}C=Promise.all(T)}return C.then(()=>{let T=[],I=v&&v.includes(WT),D=v&&v.includes(r1);if(I&&T.push((function(){if(!sc)return g0??(g0=(function(P){let R,z=null;function H(){R=new Uint8Array(z.buffer)}function $(){throw new Error("Unexpected Draco error.")}let Z={a:{a:$,d:function(Y,te,he){return R.copyWithin(Y,te,te+he)},c:function(Y){let te=R.length,he=Math.max(Y>>>0,Math.ceil(1.2*te)),ae=Math.ceil((he-te)/65536);try{return z.grow(ae),H(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,Z):P.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,Z))).then(Y=>{let{Rb:te,Qb:he,P:ae,T:me,X:ye,Ja:we,La:je,Qa:Te,Va:qe,Wa:Ye,eb:Ke,jb:rt,f:st,e:et,yb:tt,zb:Ge,Ab:$e,Bb:nt,Db:vt,Gb:ut}=Y.instance.exports;z=et;let Gt=(()=>{let Tt=0,Pt=0,Nt=0,Tn=0;return dt=>{Nt&&(te(Tn),te(Tt),Pt+=Nt,Nt=Tt=0),Tt||(Pt+=128,Tt=he(Pt));let zt=dt.length+7&-8,un=Tt;zt>=Pt&&(Nt=zt,un=Tn=he(zt));for(let Ln=0;Ln<dt.length;Ln++)R[un+Ln]=dt[Ln];return un}})();return H(),st(),{memory:et,_free:te,_malloc:he,Mesh:class{constructor(){this.ptr=ae()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){rt(this.ptr)}DecodeArrayToMesh(Tt,Pt,Nt){let Tn=Gt(Tt),dt=je(this.ptr,Tn,Pt,Nt.ptr);return!!ye(dt)}GetAttributeByUniqueId(Tt,Pt){return{ptr:Te(this.ptr,Tt.ptr,Pt)}}GetTrianglesUInt16Array(Tt,Pt,Nt){qe(this.ptr,Tt.ptr,Pt,Nt)}GetTrianglesUInt32Array(Tt,Pt,Nt){Ye(this.ptr,Tt.ptr,Pt,Nt)}GetAttributeDataArrayForAllPoints(Tt,Pt,Nt,Tn,dt){Ke(this.ptr,Tt.ptr,Pt.ptr,Nt,Tn,dt)}},DT_INT8:tt(),DT_UINT8:Ge(),DT_INT16:$e(),DT_UINT16:nt(),DT_UINT32:vt(),DT_FLOAT32:ut()}})})(fetch(gR())),g0.then(P=>{sc=P,g0=void 0}))})()),D&&T.push((function(){if(qT)return;let P=(function(R){let z,H=WebAssembly.instantiateStreaming(R,{}).then(Y=>{z=Y.instance,z.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(Y,te,he,ae,me,ye){(function(we,je,Te,qe,Ye,Ke,rt){let st=we.exports.sbrk,et=qe+3&-4,tt=st(et*Ye),Ge=st(Ke.length),$e=new Uint8Array(we.exports.memory.buffer);$e.set(Ke,Ge);let nt=je(tt,qe,Ye,Ge,Ke.length);if(nt===0&&rt&&rt(tt,et,Ye),Te.set($e.subarray(tt,tt+qe*Ye)),st(tt-st(0)),nt!==0)throw new Error(`Malformed buffer data: ${nt}`)})(z,z.exports[Z[me]],Y,te,he,ae,z.exports[$[ye]])}}})(fetch(_R()));return P.ready.then(()=>{qT=P})})()),m)for(let P=0;P<m.length;P++)T.push(J5(m[P],u,P,s));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&g)for(let{primitives:P}of g)for(let R of P)Y5(R,u);if(D&&g&&b)for(let P of b)K5(P,u);return u})})}function ER(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>CR(e,0,a))}function ZT(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function XT(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class YT{constructor(e,s,u,d){this.context=e,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(s,{premultiply:d&&d.premultiply})}update(e,s){let u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:g}=m,{x:v,y:b}=s&&s.position?s.position:{x:0,y:0},C=v+u,T=b+d;!this.size||this.size[0]===C&&this.size[1]===T||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));let I=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&C>0&&T>0){let D=this.useMipmap?Math.floor(Math.log2(Math.max(C,T)))+1:1;g.texStorage2D(g.TEXTURE_2D,D,this.format,C,T),this.size=[C,T]}this.size&&(I?g.texSubImage2D(g.TEXTURE_2D,0,v,b,ZT(this.format),XT(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,v,b,u,d,ZT(this.format),XT(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,s,u=!1){let{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(e,s,u,d,m){let{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),this.magFilter=s),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class v0{constructor(e,s){this.context=e,this.texture=s}bind(e,s){let{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}}let ej=Pn([{name:"a_pos_3f",components:3,type:"Float32"}]),tj=Pn([{name:"a_color_3f",components:3,type:"Float32"}]),nj=Pn([{name:"a_color_4f",components:4,type:"Float32"}]),ij=Pn([{name:"a_uv_2f",components:2,type:"Float32"}]),rj=Pn([{name:"a_normal_3f",components:3,type:"Float32"}]),oj=Pn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sj=Pn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function SR(a,e){let s=o1(a.projection,a.zoom,a.width,a.height),u=(function(m,g,v,b,C){let T=new c(v.lng-180*ch,v.lat),I=new c(v.lng+180*ch,v.lat),D=m.project(T.lng,T.lat),P=m.project(I.lng,I.lat),R=-Math.atan2(P.y-D.y,P.x-D.x),z=J.fromLngLat(v);z.y=G(z.y,-1+ch,1-ch);let H=z.toLngLat(),$=m.project(H.lng,H.lat),Z=J.fromLngLat(H);Z.x+=ch;let Y=Z.toLngLat(),te=m.project(Y.lng,Y.lat),he=IR(te.x-$.x,te.y-$.y,R),ae=J.fromLngLat(H);ae.y+=ch;let me=ae.toLngLat(),ye=m.project(me.lng,me.lat),we=IR(ye.x-$.x,ye.y-$.y,R),je=Math.abs(he.x)/Math.abs(we.y),Te=gt([]);So(Te,Te,-R*(1-(C?0:b)));let qe=gt([]);return Hn(qe,qe,[1,1-(1-je)*b,1]),qe[4]=-we.x/we.y*b,So(qe,qe,R),Ot(qe,Te,qe),qe})(a.projection,0,a.center,s,e),d=TR(a);return Hn(u,u,[d,d,1]),u}function TR(a){let e=a.projection,s=o1(a.projection,a.zoom,a.width,a.height),u=KT(e,a.center),d=KT(e,c.convert(e.center));return Math.pow(2,u*s+(1-s)*d)}function o1(a,e,s,u,d=1/0){let m=a.range;if(!m)return 0;let g=Math.min(d,Math.max(s,u)),v=Math.log2(g/1024);return X(m[0]+v,m[1]+v,e)}let ch=1/4e4;function KT(a,e){let s=G(e.lat,-L,L),u=new c(e.lng-180*ch,s),d=new c(e.lng+180*ch,s),m=a.project(u.lng,s),g=a.project(d.lng,s),v=J.fromLngLat(u),b=J.fromLngLat(d),C=g.x-m.x,T=g.y-m.y,I=b.x-v.x,D=b.y-v.y,P=Math.sqrt((I*I+D*D)/(C*C+T*T));return Math.log2(P)}function IR(a,e,s){let u=Math.cos(s),d=Math.sin(s);return{x:a*u-e*d,y:a*d+e*u}}function MR(a,e,s){gt(a),So(a,a,Zn(e[2])),Er(a,a,Zn(e[0])),_r(a,a,Zn(e[1])),Hn(a,a,s),Ot(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function s1(a,e,s,u,d,m,g,v){let b=[s[0]-e[0],s[1]-e[1],0],C=[u[0]-e[0],u[1]-e[1],0];if(ho(b)<1e-12||ho(C)<1e-12)return Od(a);let T=Fo([],b,C);ji(T,T),il(C,u,e),b[2]=(m-d)*v,C[2]=(g-d)*v;let I=b;return Fo(I,b,C),ji(I,I),Rd(a,T,I)}function a1(a,e,s=!1){let u=ah(e.zoom),d=(function(m,g,v){let b=g.worldSize,C=[m[12],m[13],m[14]],T=F(C[1]/b),I=A(C[0]/b),D=gt([]),P=M(1,T)*b,R=M(1,0)*b*V(T,g.zoom),z=1/TT(b),H=R*z;if(v){let te=o1(g.projection,g.zoom,g.width,g.height,1024);H=z*g.projection.pixelSpaceConversion(g.center.lat,b,te)}let $=rh(T,I);jr($,$,ur([],ji([],$),P*H*C[2]));let Z=(function(te){let he=[te[0],te[1],te[2]],ae=[0,1,0],me=Fo([],ae,he);return Fo(ae,he,me),Nf(ae)===0&&(ae=[0,1,0],Fo(me,he,ae)),ji(me,me),ji(ae,ae),ji(he,he),[me[0],me[1],me[2],0,ae[0],ae[1],ae[2],0,he[0],he[1],he[2],0,te[0],te[1],te[2],1]})($);Hn(D,D,[H,H,H*P]),Kt(D,D,[-C[0],-C[1],-C[2]]);let Y=Ot([],g.globeMatrix,Z);return Ot(Y,Y,D),Ot(Y,Y,m),Y})(a,e,s);if(u>0){let m=(function(g,v){let b=v.worldSize,C=M(1,0)*b*V(v.center.lat,v.zoom)/TT(b),T=M(1,v.center.lat)*b,I=gt([]);_r(I,I,Zn(v.center.lng)),Er(I,I,Zn(v.center.lat)),Kt(I,I,[0,0,Bo]),Hn(I,I,[C,C,C*T]);let D=v.point;return Kt(I,I,[-D.x,-D.y,0]),Ot(I,I,g),Ot(I,v.globeMatrix,I)})(a,e);return(function(g,v,b){let C=(R,z,H)=>{let $=ho(R),Z=ho(z),Y=oc(R,z,H);return ur(Y,Y,1/ho(Y)*on($,Z,H))},T=C([g[0],g[1],g[2]],[v[0],v[1],v[2]],b),I=C([g[4],g[5],g[6]],[v[4],v[5],v[6]],b),D=C([g[8],g[9],g[10]],[v[8],v[9],v[10]],b),P=oc([g[12],g[13],g[14]],[v[12],v[13],v[14]],b);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],0,P[0],P[1],P[2],1]})(d,m,u)}return d}function QT(a,e,s,u){let d=Ut.projectAabbCorners(u,s),m=Number.MAX_VALUE;for(let v=0;v<d.length;++v){let b=d[v];b[0]=(.5*b[0]+.5)*e.width,b[1]=(.5-.5*b[1])*e.height,b[2]<m&&(m=b[2])}let g=(function(v){let b=[],C=0;for(let P=1;P<v.length;P++)(v[P][0]<v[C][0]||v[P][0]===v[C][0]&&v[P][1]<v[C][1])&&(C=P);let T,I=C,D=new Uint8Array(v.length);do{if(D[I])break;b.push(new it(v[I][0],v[I][1])),D[I]=1,T=(I+1)%v.length;for(let P=0;P<v.length;P++){if(v[P][0]===v[T][0]&&v[P][1]===v[T][1]||v[P][0]===v[I][0]&&v[P][1]===v[I][1])continue;let R=[v[P][0]-v[I][0],v[P][1]-v[I][1]],z=[v[T][0]-v[I][0],v[T][1]-v[I][1]],H=R[0]*z[1]-R[1]*z[0];(H>0||H===0&&R[0]*z[0]+R[1]*z[1]>=0&&R[0]*R[0]+R[1]*R[1]>z[0]*z[0]+z[1]*z[1])&&(T=P)}I=T}while(I!==C);return b.length>0&&b.push(b[0]),b})(d);if(Wn(a,g))return m}let Vp=64,ug={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function l1(a,e,s,u,d,m,g,v,b,C=!1){let T=s.zoom,I=s.project(u),D=V(u.lat,T),P=1/D;gt(a),Kt(a,a,[I.x+g[0]*P,I.y+g[1]*P,g[2]]);let R=1,z=1,H=s.worldSize;if(C){if(s.projection.name==="mercator"){let te=0;s.elevation&&(te=s.elevation.getAtPointOrZero(new J(I.x/H,I.y/H),0));let he=Lo([],[I.x,I.y,te,1],s.projMatrix)[3]/s.cameraToCenterDistance;R=he,z=he*V(s.center.lat,T)}else if(s.projection.name==="globe"){let te=a1(a,s),he=[0,0,0,1];Lo(he,he,Ot([],s.projMatrix,te));let ae=he[3]/s.cameraToCenterDistance,me=ah(T),ye=s.projection.pixelsPerMeter(u.lat,H)*V(u.lat,T),we=s.projection.pixelsPerMeter(s.center.lat,H)*V(s.center.lat,T);R=ae/on(ye,j(s.center.lat),me),z=ae*D/ye,R*=we,z*=we}}else R=P;Hn(a,a,[R,R,z]);let $=[...a],Z=e.orientation,Y=[];if(MR(Y,[Z[0]+(d?d[0]:0),Z[1]+(d?d[1]:0),Z[2]+(d?d[2]:0)],m),Ot(a,$,Y),v&&s.elevation){let te=0,he=[];if(b&&s.elevation){te=(function(me,ye,we,je,Te){let qe=ye.elevation;if(!qe)return 0;let Ye=Ut.projectAabbCorners(we,je),Ke=M(1,Te.lat)*ye.worldSize,rt=(function(Pt,Nt){let Tn=[0,0,1],dt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let zt of dt){let un=Pt[zt.corners[0]],Ln=Pt[zt.corners[1]],zn=Pt[zt.corners[2]],_n=[Ln[0]-un[0],Ln[1]-un[1],Nt*(Ln[2]-un[2])],_i=Fo(_n,_n,[zn[0]-un[0],zn[1]-un[1],Nt*(zn[2]-un[2])]);ji(_i,_i),zt.dotProductWithUp=Sr(_i,Tn)}return dt.sort((zt,un)=>zt.dotProductWithUp-un.dotProductWithUp),dt[0].corners})(Ye,Ke),st=Ye[rt[0]],et=Ye[rt[1]],tt=Ye[rt[2]],Ge=Ye[rt[3]],$e=qe.getAtPointOrZero(new J(st[0]/ye.worldSize,st[1]/ye.worldSize),0),nt=qe.getAtPointOrZero(new J(et[0]/ye.worldSize,et[1]/ye.worldSize),0),vt=qe.getAtPointOrZero(new J(tt[0]/ye.worldSize,tt[1]/ye.worldSize),0),ut=qe.getAtPointOrZero(new J(Ge[0]/ye.worldSize,Ge[1]/ye.worldSize),0),Gt=($e+ut)/2,Tt=(nt+vt)/2;return Gt>Tt?nt<vt?s1(me,et,Ge,st,nt,ut,$e,Ke):s1(me,tt,st,Ge,vt,$e,ut,Ke):$e<ut?s1(me,st,et,tt,$e,nt,vt,Ke):s1(me,Ge,tt,et,ut,vt,nt,Ke),Math.max(Gt,Tt)})(he,s,e.aabb,a,u);let ae=Ot([],qh([],he),Y);Ot(a,$,ae)}else te=s.elevation.getAtPointOrZero(new J(I.x/H,I.y/H),0);te!==0&&(a[14]+=te)}}class DR{constructor(e,s,u,d,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=s,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=d??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,s){Ot(e.globalMatrix,s,e.localMatrix);let u=this.nodeOverrides.get(e.name);if(u!==void 0){let g=[];m=u.orientation,gt(d=g),_r(d,d,Zn(m[1])),So(d,d,Zn(m[2])),Er(d,d,Zn(m[0])),Ot(e.globalMatrix,e.globalMatrix,g)}var d,m;if(e.meshes)for(let g of e.meshes){let v=Ut.applyTransformFast(g.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(let g of e.children)this._applyTransformations(g,e.globalMatrix)}computeBoundsAndApplyParent(){let e=gt([]);this.aabb=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.nodes)this._applyTransformations(s,e)}computeModelMatrix(e,s,u,d,m,g,v=!1){l1(this.matrix,this,e.transform,this.position,s,u,d,m,g,v)}upload(e){if(!this.uploaded){for(let s of this.nodes)JT(s,e);for(let s of this.nodes)c1(s);this.uploaded=!0}}destroy(){for(let e of this.nodes)eI(e)}}function y0(a,e,s=!1){a.uploaded||(a.gfxTexture=new YT(e,a.image,s?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function aj(a,e,s){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,ej.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,rj.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,ij.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?tj:nj).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,sj.members,!0)),a.segments=Ji.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);let u=a.material;u.pbrMetallicRoughness.baseColorTexture&&y0(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&y0(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&y0(u.normalTexture,e),u.occlusionTexture&&y0(u.occlusionTexture,e,s),u.emissionTexture&&y0(u.emissionTexture,e)}function JT(a,e,s){if(a.meshes)for(let u of a.meshes)aj(u,e,s);if(a.children)for(let u of a.children)JT(u,e,s)}function c1(a){if(a.meshes)for(let e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(let e of a.children)c1(e)}function eI(a){if(a.meshes)for(let s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((e=s.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(let s of a.children)eI(s)}function Up(a,e){let s=a.json.bufferViews[e.bufferView],u=i1[e.componentType];return new u(a.buffers[s.buffer],(e.byteOffset||0)+(s.byteOffset||0),e.count*(s.byteStride&&s.byteStride!==_0[e.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:_0[e.type]))}function tI(a,e,s,u){let d=i1[e.componentType],m=(function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),g=a.json.bufferViews[e.bufferView],v=g.byteStride?g.byteStride/d.BYTES_PER_ELEMENT:_0[e.type],b=s.float32,C=b.length/s.capacity;for(let T=0,I=0;T<e.count*v;T+=v,I+=C)for(let D=0;D<C;D++)b[I+D]=u[T+D]*m;s._trim()}function lj(a,e,s){let u=a.indices,d=a.attributes,m={};m.indexArray=new qr;let g=e.json.accessors[u],v=g.count/3;m.indexArray.reserve(v);let b=Up(e,g);for(let D=0;D<v;D++)m.indexArray.emplaceBack(b[3*D],b[3*D+1],b[3*D+2]);m.indexArray._trim(),m.vertexArray=new Ws;let C=e.json.accessors[d.POSITION];m.vertexArray.reserve(C.count);let T=Up(e,C);for(let D=0;D<C.count;D++)m.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(m.vertexArray._trim(),m.aabb=new Ut(C.min,C.max),m.centroid=(function(D,P){let R=[0,0,0],z=D.length;if(z>0){for(let H=0;H<z;H++){let $=3*D[H];R[0]+=P[$],R[1]+=P[$+1],R[2]+=P[$+2]}R[0]/=z,R[1]/=z,R[2]/=z}return R})(b,T),d.COLOR_0!==void 0){let D=e.json.accessors[d.COLOR_0],P=_0[D.type],R=Up(e,D);m.colorArray=P===3?new Ws:new Yc,m.colorArray.resize(D.count),tI(e,D,m.colorArray,R)}if(d.NORMAL!==void 0){m.normalArray=new Ws;let D=e.json.accessors[d.NORMAL];m.normalArray.resize(D.count);let P=Up(e,D);tI(e,D,m.normalArray,P)}if(d.TEXCOORD_0!==void 0&&s.length>0){m.texcoordArray=new _l;let D=e.json.accessors[d.TEXCOORD_0];m.texcoordArray.resize(D.count);let P=Up(e,D);tI(e,D,m.texcoordArray,P)}if(d._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Up(e,D))}d._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Up(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));let I=a.material;return m.material=(function(D,P){let{emissiveFactor:R=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:H=.5,normalTexture:$,occlusionTexture:Z,emissiveTexture:Y,doubleSided:te,name:he}=D,{baseColorFactor:ae=[1,1,1,1],metallicFactor:me=1,roughnessFactor:ye=1,baseColorTexture:we,metallicRoughnessTexture:je}=D.pbrMetallicRoughness||{},Te=Z?P[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&Te){let qe=Z.extensions.KHR_texture_transform;Te.offsetScale=[qe.offset[0],qe.offset[1],qe.scale[0],qe.scale[1]]}return{name:he,pbrMetallicRoughness:{baseColorFactor:new ci(...ae),metallicFactor:me,roughnessFactor:ye,baseColorTexture:we?P[we.index]:void 0,metallicRoughnessTexture:je?P[je.index]:void 0},doubleSided:te,emissiveFactor:new ci(...R),alphaMode:z,alphaCutoff:H,normalTexture:$?P[$.index]:void 0,occlusionTexture:Te,emissionTexture:Y?P[Y.index]:void 0,defined:D.defined===void 0}})(I!==void 0?e.json.materials[I]:{defined:!1},s),m}function AR(a,e,s){let{matrix:u,rotation:d,translation:m,scale:g,mesh:v,extras:b,children:C,name:T}=a,I={};if(I.name=T,I.localMatrix=u||(function(D,P,R,z){var H=P[0],$=P[1],Z=P[2],Y=P[3],te=H+H,he=$+$,ae=Z+Z,me=H*te,ye=H*he,we=H*ae,je=$*he,Te=$*ae,qe=Z*ae,Ye=Y*te,Ke=Y*he,rt=Y*ae,st=z[0],et=z[1],tt=z[2];return D[0]=(1-(je+qe))*st,D[1]=(ye+rt)*st,D[2]=(we-Ke)*st,D[3]=0,D[4]=(ye-rt)*et,D[5]=(1-(me+qe))*et,D[6]=(Te+Ye)*et,D[7]=0,D[8]=(we+Ke)*tt,D[9]=(Te-Ye)*tt,D[10]=(1-(me+je))*tt,D[11]=0,D[12]=R[0],D[13]=R[1],D[14]=R[2],D[15]=1,D})([],d||[0,0,0,1],m||[0,0,0],g||[1,1,1]),I.globalMatrix=Fe(I.localMatrix),v!==void 0){I.meshes=s[v];let D=I.anchor=[0,0];for(let P of I.meshes){let{min:R,max:z}=P.aabb;D[0]+=R[0]+z[0],D[1]+=R[1]+z[1]}D[0]=Math.floor(D[0]/I.meshes.length/2),D[1]=Math.floor(D[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=(function(D){if(!D.length)return[];let P=(function(Z){let Y=atob(Z),te=new Uint8Array(Y.length);for(let he=0;he<Y.length;he++)te[he]=Y.codePointAt(he);return te})(D),R=[],z=P.length/24,H=new Uint16Array(P.buffer),$=new Float32Array(P.buffer);for(let Z=0;Z<z;Z++){let Y=H[2*Z*6]/30,te=H[2*Z*6+1]/30,he=H[2*Z*6+10]/100,ae=$[6*Z+1],me=$[6*Z+2],ye=$[6*Z+3],we=$[6*Z+4],je=ye-ae,Te=we-me,qe=Math.hypot(je,Te);R.push({pos:[ae+.5*je,me+.5*Te,te],normal:[Te/qe,-je/qe,0],width:qe,height:Y,depth:he,points:[ae,me,ye,we]})}return R})(b.lights)),b.MAPBOX_geometry_bloom&&(I.isGeometryBloom=b.MAPBOX_geometry_bloom)),C){let D=[];for(let P of C)D.push(AR(e.json.nodes[P],e,s));I.children=D}return I}function cj(a){if(a.vertices.length===0||a.indices.length===0)return null;let e=new Zb(a.vertices,a.indices,8,256),[s,u]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:s,max:u}}function uj(a){if(!a.extras||!a.extras.ground)return null;let e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let s=e[0];if(!s||!Array.isArray(s)||s.length===0)return null;let u=[];for(let g of s){if(!Array.isArray(g)||g.length!==2)continue;let v=g[0],b=g[1];typeof v=="number"&&typeof b=="number"&&u.push(new it(v,b))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let g=0;g<u.length;g++){let v=u[g],b=u[(g+1)%u.length],C=u[(g+2)%u.length];d+=(v.x-b.x)*(C.y-b.y)-(C.x-b.x)*(v.y-b.y)}d>0&&u.reverse();let m=rg(u.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:u,indices:m}}function dj(a,e){let s=[],u=[],d=0,m=[];for(let g of a){d=s.length;let v=g.vertexArray.float32,b=g.indexArray.uint16;for(let C=0;C<g.vertexArray.length;C++)m[0]=v[3*C+0],m[1]=v[3*C+1],m[2]=v[3*C+2],Pr(m,m,e),s.push(new it(m[0],m[1]));for(let C=0;C<3*g.indexArray.length;C++)u.push(b[C]+d)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){let v=s[u[g+0]],b=s[u[g+1]],C=s[u[g+2]];(v.x-b.x)*(C.y-b.y)-(C.x-b.x)*(v.y-b.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function nI(a){let e=(function(b,C){let T=[],I=WebGL2RenderingContext;if(b.json.textures)for(let D of b.json.textures){let P={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};D.sampler!==void 0&&Object.assign(P,b.json.samplers[D.sampler]),T.push({image:C[D.source],sampler:P,uploaded:!1})}return T})(a,a.images),s=(function(b,C){let T=[];for(let I of b.json.meshes){let D=[];for(let P of I.primitives)D.push(lj(P,b,C));T.push(D)}return T})(a,e),{scenes:u,scene:d,nodes:m}=a.json,g=u?u[d||0].nodes:[...m.keys()],v=[];for(let b of g)v.push(AR(m[b],a,s));return(function(b,C,T){let I={},D=new Set;for(let P=0;P<b.length;P++){let R=T[C[P]];if(!R.extras)continue;let z=R.extras["mapbox:footprint:version"],H=R.extras["mapbox:footprint:id"];(z||H)&&D.add(P),z==="1.0.0"&&H&&(I[H]=P)}for(let P=0;P<b.length;P++){if(D.has(P))continue;let R=b[P],z=T[C[P]];if(!z.extras)continue;let H=null;R.id in I&&(H=dj(b[I[R.id]].meshes,R.localMatrix)),H||(H=uj(z)),H&&(R.footprint=cj(H))}if(D.size>0){let P=Array.from(D.values()).sort((R,z)=>R-z);for(let R=P.length-1;R>=0;R--)b.splice(P[R],1)}})(v,g,a.json.nodes),v}function hj(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);let e=a.vertexArray.float32,s=a.aabb.min[0]-1,u=a.aabb.min[1]-1,d=Vp/(a.aabb.max[0]-s+2),m=Vp/(a.aabb.max[1]-u+2);for(let g=0;g<e.length;g+=3){let v=e[g+2],b=(e[g+0]-s)*d|0,C=(e[g+1]-u)*m|0;v>a.heightmap[C*Vp+b]&&(a.heightmap[C*Vp+b]=v)}}function PR(a,e,s,u,d){s.reserve(s.length+4*a.length),u.reserve(u.length+10*a.length),d.reserve(d.length+10*a.length);let m=u.length;for(let g of a){let v=Math.min(10,Math.max(4,1.3*g.height))*e,b=[-g.normal[1],g.normal[0],0],C=Math.min(.29,.1*g.width/g.depth),T=g.width-2*g.depth*e*(C+.01),I=$s([],g.pos,b,T/2),D=$s([],g.pos,b,-T/2),P=[I[0],I[1],I[2]+g.height],R=[D[0],D[1],D[2]+g.height],z=$s([],g.normal,b,C);ur(z,z,v);let H=$s([],g.normal,b,-C);ur(H,H,v),jr(z,I,z),jr(H,D,H),I[2]+=.1,D[2]+=.1,u.emplaceBack(z[0],z[1],z[2]),u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(P[0],P[1],P[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(z[0],z[1],z[2]),u.emplaceBack(H[0],H[1],H[2]);let $=T/v/2;d.emplaceBack(-$-C,-1,$,.8),d.emplaceBack($+C,-1,$,.8),d.emplaceBack(-$,0,$,1.3),d.emplaceBack($,0,$,1.3),d.emplaceBack($+C,-.8,$,.7),d.emplaceBack($+C,-.8,$,.7),d.emplaceBack(0,0,$,1.3),d.emplaceBack(0,0,$,1.3),d.emplaceBack($+C,-1.2,$,.8),d.emplaceBack($+C,-1.2,$,.8),s.emplaceBack(6+m,4+m,8+m),s.emplaceBack(7+m,9+m,5+m),s.emplaceBack(0+m,1+m,2+m),s.emplaceBack(1+m,3+m,2+m),m+=10}}function pj(a,e){let s={};s.indexArray=new qr,s.vertexArray=new Ws,s.colorArray=new Yc,PR(a,e,s.indexArray,s.vertexArray,s.colorArray);let u={defined:!0};u.emissiveFactor=ci.black;let d={};return d.baseColorFactor=ci.white,u.pbrMetallicRoughness=d,s.material=u,s.aabb=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}let OR=Pn([{name:"a_pos_3f",components:3,type:"Float32"}]),fj=Pn([{name:"a_normal_3",components:3,type:"Int16"}]),mj=Pn([{name:"a_centroid_3",components:3,type:"Int16"}]),RR=Pn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),gj=Pn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),_j=Pn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),vj=Pn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),yj=Pn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),xj=Pn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),kR=Ce.types,u1=32767;function bj(a,e){let s=_t+e;for(let u of a)for(let d of u)if(d.x<-e||d.x>s||d.y<-e||d.y>s)return!1;return!0}function wj(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class iI{constructor(){this.layoutVertexArray=new Ws,this.layoutAttenuationArray=new Yc,this.layoutColorArray=new Zs,this.indexArray=new qr,this.indexArrayForConflation=new qr,this.segmentsBucket=new Ji}}class rI{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Ji,this.entranceBloom=new iI;let s=66560;this.layoutVertexArray=new Ws,this.layoutVertexArray.reserve(s),this.layoutNormalArray=new Qd,this.layoutNormalArray.reserve(s),this.layoutCentroidArray=new Qd,this.layoutCentroidArray.reserve(s),this.layoutColorArray=new Zs,this.layoutColorArray.reserve(s),this.layoutFloodLightDataArray=new Kc,this.layoutFloodLightDataArray.reserve(s),this.layoutAOArray=new qm,this.layoutAOArray.reserve(s),this.indexArray=new qr,this.indexArray.reserve(66560),this.indexArrayForConflation=new qr,this.segmentsBucket=new Ji,this.entranceBloom=new iI,e&&(this.layoutFacadePaintArray=new Zs,this.layoutFacadeDataArray=new id,this.layoutFacadeVerticalRangeArray=new Zs)}reserve(e,s,u){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(s),u&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class FR{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new _l,this.footprintsIndices=new Kc,this.footprintsMin=new it(1/0,1/0),this.footprintsMax=new it(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new rI(!1),this.buildingWithFacade=new rI(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.groundEffect=new VT(e),this.groundEffect.groundRadiusArray=new Ql,this.hasAppearances=null}updateFootprints(e,s){let u=new Zb([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};s.push({footprint:d,id:e})}updateAppearances(e,s,u,d){}prepare(){return(function(){if(n1!=null||mR!=null)return null;if(cg!=null)return cg;let e=fetch(kn.BUILDING_GEN_URL);return cg=(function(s){let u,d,m,g,v;function b(){u=new Uint8Array(v.buffer),d=new Int16Array(v.buffer),m=new Int32Array(v.buffer),g=new Float32Array(v.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}let T=()=>{},I={a:{a:C,f:function(D){let P=u.length,R=Math.max(D>>>0,Math.ceil(1.2*P)),z=Math.ceil((R-P)/65536);try{return v.grow(z),b(),!0}catch{return!1}},g:C,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,I):s.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,I))).then(D=>{let P=D.instance.exports;return(0,P.g)(),v=P.f,b(),new W5({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setStructuralOptions:P.k,setFacadeOptions:P.l,setFauxFacadeOptions:P.m,setFacadeClassifierOptions:P.n,addFeature:P.o,addFacade:P.p,generateMesh:P.q,getLastError:P.r,getOuterRingLength:P.s,getMeshCount:P.t,getPositionsPtr:P.u,getPositionsLength:P.v,getNormalsPtr:P.w,getNormalsLength:P.x,getAOPtr:P.y,getAOLength:P.z,getUVPtr:P.A,getUVLength:P.B,getFauxFacadePtr:P.C,getFauxFacadeLength:P.D,getIndicesPtr:P.E,getIndicesLength:P.F,getBuildingPart:P.G,getRingCount:P.H,getRingPtr:P.I,getRingLength:P.J,malloc:P.K,free:P.L,heapU8:u,heap16:d,heap32:m,heapF32:g})})})(e).then(s=>(cg=null,n1=s,n1)).catch(s=>{Dt("Could not load building-gen"),cg=null,mR=s}),cg})()}populate(e,s,u,d){let m=Z5();if(!m)return;let g=q(u);this.tileToMeter=g,this.brightness=s.brightness,m.setStyle({normalScale:[1,-1,g],tileToMeters:g}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);let v=new Map,b=new Map,C=0;for(let{feature:$}of e){if(kR[$.type]!=="LineString"){v.set($.id,$.properties.source_id);continue}let Z=this.layers[0]._featureFilter.needGeometry;if(Z&&!this.layers[0]._featureFilter.filter(new Ni(this.zoom),$,u))continue;let Y=Se($,Z);if(!Z&&!this.layers[0]._featureFilter.filter(new Ni(this.zoom),Y,u))continue;let te=Z?Y.geometry:_e($,u,d),he=[];for(let we of te)for(let je of we)he.push(je.x),he.push(je.y);let ae={coordinates:he,crossPerc:$.properties.cross_perc,distanceToRoad:$.properties.distance_to_road,entrances:$.properties.entrances,sourceId:0},me=$.properties.source_id,ye=b.get(me);ye||(ye=[],b.set(me,ye)),ye.push(ae),++C}this.maxHeight=0;let T=new Array,I=new Set,D=$=>{$!=null&&I.add($)},P=($,Z)=>{$!=null&&T.push({buildingId:$,footprintIndex:Z})},R=64*(e.length-C),z=R/2;this.buildingWithFacade.reserve(R,z,!0),this.buildingWithoutFacade.reserve(2*R,2*z,!1),this.footprintsIndices.reserve(16*(e.length-C)),this.footprintsVertices.reserve(8*(e.length-C));for(let{feature:$,id:Z,index:Y,sourceLayerIndex:te}of e){if(kR[$.type]==="LineString")continue;let he=this.layers[0]._featureFilter.needGeometry;if(he&&!this.layers[0]._featureFilter.filter(new Ni(this.zoom),$,u))continue;let ae=null;if($.properties&&$.properties.hasOwnProperty("building_id")&&(ae=$.properties.building_id,I.has(ae)))continue;let me=Se($,he);if(!he&&!this.layers[0]._featureFilter.filter(new Ni(this.zoom),me,u))continue;let ye=he?me.geometry:_e($,u,d),we=l0(ye,500),je=!1;for(let nn of we)if(nn.length!==1){je=!0;break}if(je){D(ae);continue}if(!bj(ye,163)){D(ae);continue}let Te=this.layers[0],qe=wj(Te.layout.get("building-roof-shape").evaluate($,{},u)),Ye=Te.layout.get("building-base").evaluate($,{},u),Ke=Te.layout.get("building-height").evaluate($,{},u),rt=Te.layout.get("building-flood-light-ground-radius").evaluate($,{},u),st=Te.paint.get("building-ambient-occlusion-intensity"),et=rt/this.tileToMeter;$.properties["building-part"]="roof";let tt=Te.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),Ge=Te.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="wall";let $e=Te.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),nt=Te.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="window";let vt=Te.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),ut=Te.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="door";let Gt=Te.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),Tt=Te.paint.get("building-emissive-strength").evaluate($,{},this.canonical),Pt=Te.layout.get("building-flood-light-wall-radius").evaluate($,{},u);Pt=G(Pt,0,2048);let Nt=Pt/2048*u1,Tn=v.get(Z),dt=b.get(Tn)||[],zt=dt.length!==0&&Te.layout.get("building-facade").evaluate($,{},u);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(zt,!1,1);let un=0,Ln=0,zn=0,_n=0,_i=0,ce=0,pe=0,We=0,ot=0,Ct=0,Et=0;if(zt){let nn=Math.round(Te.layout.get("building-facade-floors").evaluate($,{},u));if(Ye===0){nn=Math.max(1,nn-(dt.length>0?1:0));let hi=4;if(Ke>100){let Wi=[10,13,15];hi=Wi[$.id?$.id%Wi.length:0]}else Ke<=10&&(hi=3);m.setFacadeOptions(hi,!0),_i=(Ke<15?1.3:1.61803)*hi/g}else _i=Ye/g;ce=Ke/g,_i=Math.min(_i,ce),zn=Te.layout.get("building-facade-unit-width").evaluate($,{},u)/g,_n=(ce-_i)/nn,m.setFauxFacadeOptions(!0,!0,zn);let nr=Te.layout.get("building-facade-window").evaluate($,{},u);un=nr[0],Ln=nr[1],pe=Math.floor(65535*Math.min(1,_i/_t)),We=Math.floor(65535*Math.min(1,ce/_t)),ot=Math.floor(255*un)<<8|Math.floor(255*Ln),Ct=Math.floor(65535*Math.min(1,zn/_t)),Et=Math.floor(65535*Math.min(1,_n/_t))}let qt=Array(we.length),Xt={x:1/0,y:1/0},mn={x:-1/0,y:-1/0},Cn={x:0,y:0},Sn=0;for(let nn=0;nn<we.length;nn++){let nr=we[nn];if(nr.length>0){let hi=[],Wi=Array(nr.length+1);Wi[0]=0;for(let Xr=0;Xr<nr.length;Xr++){let lo=nr[Xr];for(let Nr=0;Nr<lo.length;Nr++){let zr=lo[lo.length-Nr-1];Xt.x=Math.min(Xt.x,zr.x),Xt.y=Math.min(Xt.y,zr.y),mn.x=Math.max(mn.x,zr.x),mn.y=Math.max(mn.y,zr.y),Cn.x+=zr.x,Cn.y+=zr.y,Sn++,hi.push(zr.x),hi.push(zr.y)}Wi[Xr+1]=hi.length}qt[nn]={id:$.id?$.id:0,height:Ke,minHeight:Ye,sourceId:0,roofType:qe,coordinates:hi,ringIndices:Wi}}}Cn.x/=Sn||1,Cn.y/=Sn||1;let On=m.generateMesh(qt,dt);if(typeof On=="string"){Dt(`Unable to generate building ${$.id}: ${On}`),D(ae);continue}if(On.meshes.length===0||On.modifiedPolygonRings.length===0){D(ae);continue}let rn=zt?this.buildingWithFacade:this.buildingWithoutFacade,cn=0;for(let nn of On.meshes)cn+=nn.positions.length/3;let $n=rn.segmentsBucket.prepareSegment(cn,rn.layoutVertexArray,rn.indexArray),Yn=[],Kn=null,di=0,Ti=-1,vi=rn.layoutVertexArray.length,ei=vi+cn;rn.layoutVertexArray.resize(ei),rn.layoutCentroidArray.resize(ei),rn.layoutNormalArray.resize(ei),rn.layoutAOArray.resize(ei),rn.layoutColorArray.resize(ei),rn.layoutFloodLightDataArray.resize(ei),zt&&(rn.layoutFacadePaintArray.resize(ei),rn.layoutFacadeDataArray.resize(ei),rn.layoutFacadeVerticalRangeArray.resize(ei));let oi=rn.indexArray.length,En=0,Nn=vi;for(let nn of On.meshes){let nr,hi;if(nn.buildingPart===1)nr=tt,hi=Ge;else if(nn.buildingPart===0)nr=$e,hi=nt;else if(nn.buildingPart===2)nr=vt,hi=ut;else{if(nn.buildingPart!==3)continue;nr=Gt,hi=Tt}if(hi=G(hi,0,1),nn.buildingPart===3){let ki=new Array;for(let Yr=0;Yr<nn.positions.length;Yr+=12){let bl=nn.positions[Yr+0],nu=nn.positions[Yr+1],Mo=nn.positions[Yr+3],ds=nn.positions[Yr+4],Qs=nn.positions[Yr+2],ph=nn.positions[Yr+8]-Qs,Cg=1,dc=Mo-bl,hc=ds-nu,$0=Math.hypot(dc,hc);ki.push({pos:[bl+.5*dc,nu+.5*hc,Qs],normal:[hc/$0,-dc/$0,0],width:$0,height:ph,depth:Cg,points:[bl,nu,Mo,ds]})}let wr=rn.entranceBloom.segmentsBucket.prepareSegment(10*ki.length,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.indexArray),Mr=rn.entranceBloom.layoutVertexArray.length;di=rn.entranceBloom.indexArray.length,PR(ki,.5/this.tileToMeter,rn.entranceBloom.indexArray,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.layoutAttenuationArray);let Fs=rn.entranceBloom.layoutVertexArray.length-Mr;Ti=rn.entranceBloom.indexArray.length-di;for(let Yr=0;Yr<Fs;Yr++)rn.entranceBloom.layoutColorArray.emplaceBack(255*Gt.r<<8|255*Gt.g,255*Gt.b<<8|51*Tt);wr.vertexLength+=Fs,wr.primitiveLength+=Ti,Kn={part:nn.buildingPart,vertexOffset:Mr,vertexLength:Fs}}rn.layoutVertexArray.float32.set(nn.positions,3*Nn);let Wi=nn.positions.length/3;for(let ki=0;ki<Wi;++ki){let wr=3*ki;En=Math.max(En,nn.positions[wr+2]);let Mr=nn.normals[wr+1]*u1,Fs=nn.normals[wr+2]*u1,Yr=3*(Nn+ki);rn.layoutNormalArray.int16[Yr]=nn.normals[wr]*u1,rn.layoutNormalArray.int16[Yr+1]=Mr,rn.layoutNormalArray.int16[Yr+2]=Fs;let bl=nn.ao[ki];rn.layoutAOArray.uint8[Nn+ki]=255*bl;let nu=1+(bl-1)*st,Mo=255*nr.b*nu<<8|255*hi;rn.layoutColorArray.uint16[2*(Nn+ki)]=255*nr.r*nu<<8|255*nr.g*nu,rn.layoutColorArray.uint16[2*(Nn+ki)+1]=Mo}let Xr=Math.floor(Cn.x),lo=Math.floor(Cn.y),Nr=Math.floor(Ke);for(let ki=0;ki<Wi;++ki){let wr=3*(Nn+ki);rn.layoutCentroidArray.int16[wr]=Xr,rn.layoutCentroidArray.int16[wr+1]=lo,rn.layoutCentroidArray.int16[wr+2]=Nr}if(rn.layoutFloodLightDataArray.uint16.fill(nn.buildingPart===0?Nt:0,Nn,Nn+Wi),zt){let ki=255*vt.r<<8|255*vt.g,wr=255*vt.b<<8|255*ut;for(let Mr=0;Mr<Wi;++Mr){let Fs=2*(Nn+Mr);rn.layoutFacadePaintArray.uint16[Fs]=ki,rn.layoutFacadePaintArray.uint16[Fs+1]=wr}for(let Mr=0;Mr<Wi;++Mr)if(nn.isFauxFacade[Mr]){let Fs=Math.min(65535,Math.floor(nn.uv[2*Mr]*On.outerRingLength));rn.layoutFacadeDataArray.emplace(Nn+Mr,1|Fs,ot,Ct,Et),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Mr,pe,We)}else rn.layoutFacadeDataArray.emplace(Nn+Mr,0,0,0,0),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Mr,0,0)}let zr=$n.vertexLength,to=nn.indices.length/3,Ss=rn.indexArray.length;rn.indexArray.resize(Ss+to);for(let ki=0;ki<to;++ki){let wr=3*ki,Mr=3*Ss+wr;rn.indexArray.uint16[Mr]=zr+nn.indices[wr],rn.indexArray.uint16[Mr+1]=zr+nn.indices[wr+1],rn.indexArray.uint16[Mr+2]=zr+nn.indices[wr+2]}nn.buildingPart!==1&&nn.buildingPart!==0&&nn.buildingPart!==2&&nn.buildingPart!==3||Yn.push({part:nn.buildingPart,vertexOffset:Nn,vertexLength:nn.positions.length/3}),Nn+=Wi,$n.vertexLength+=Wi,$n.primitiveLength+=nn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,En);let Qi=rn.indexArray.length-oi,tn=this.footprintsIndices.length,Rn=this.footprintsVertices.length,xi=[],Di=new it(1/0,1/0),zi=new it(-1/0,-1/0),Ir=this.groundEffect.vertexArray.length;for(let nn of On.modifiedPolygonRings){let nr=[],hi=new it(1/0,1/0),Wi=new it(-1/0,-1/0);for(let Xr=0;Xr<nn.length;Xr+=2){let lo=nn.length-Xr-2;hi.x=Math.min(hi.x,nn[lo]),hi.y=Math.min(hi.y,nn[lo+1]),Wi.x=Math.max(Wi.x,nn[lo]),Wi.y=Math.max(Wi.y,nn[lo+1]);let Nr=new it(nn[lo],nn[lo+1]);nr.push(Nr),xi.push(Nr.x,Nr.y),this.footprintsVertices.emplaceBack(Nr.x,Nr.y)}Di.x=Math.min(Di.x,hi.x),Di.y=Math.min(Di.y,hi.y),zi.x=Math.max(zi.x,Wi.x),zi.y=Math.max(zi.y,Wi.y),this.groundEffect.addData(nr,[hi,Wi],et)}let Ri=this.groundEffect.vertexArray.length-Ir;this.groundEffect.groundRadiusArray.reserveForAdditional(Ri);for(let nn=0;nn<Ri;nn++)this.groundEffect.groundRadiusArray.emplaceBack(rt);(Xt.x<0||mn.x>_t||Xt.y<0||mn.y>_t)&&this.featuresOnBorder.push({featureId:$.id,footprintIndex:this.footprints.length});{let nn=rg(xi,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+nn.length),this.footprintsIndices.uint16.set(nn,tn),this.buildingIds.add(ae??$.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Di.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Di.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,zi.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,zi.y);let nr={footprintVertexOffset:Rn,footprintVertexLength:this.footprintsVertices.length-Rn,footprintIndexOffset:tn,footprintIndexLength:this.footprintsIndices.length-tn,min:Di,max:zi,hiddenFlags:0,indicesOffset:oi,indicesLength:Qi,bloomIndicesOffset:di,bloomIndicesLength:Ti,groundEffectVertexOffset:Ir,groundEffectVertexLength:Ri,hasFauxFacade:zt,height:En,promoteId:Z,feature:me,parts:Yn,buildingBloom:Kn},hi=this.footprints.length;$.id!==void 0&&this.featureFootprintLookup.set($.id,hi),P(ae,hi),this.footprints.push(nr)}this.programConfigurations.populatePaintArrays(rn.layoutVertexArray.length,$,Y,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData($,Y,{},s.availableImages,u,s.brightness),s.featureIndex.insert($,ye,Y,te,this.index,vi)}T.forEach(({buildingId:$,footprintIndex:Z})=>{I.has($)&&(this.footprints[Z].hiddenFlags|=4)});let H=new Set;this.buildingIds.forEach(($,Z,Y)=>{I.has($)||H.add($)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v),this.groundEffect.update(e,s,m,u,d,g,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){let s=u=>{u.layoutVertexBuffer=e.createVertexBuffer(u.layoutVertexArray,OR.members),u.layoutNormalBuffer=e.createVertexBuffer(u.layoutNormalArray,fj.members),u.layoutCentroidBuffer=e.createVertexBuffer(u.layoutCentroidArray,mj.members),u.layoutFloodLightDataBuffer=e.createVertexBuffer(u.layoutFloodLightDataArray,xj.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=e.createVertexBuffer(u.layoutFacadeDataArray,_j.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(u.layoutFacadeVerticalRangeArray,vj.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(u.entranceBloom.layoutVertexArray,OR.members),u.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,yj.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){let e=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,s,u=!0){let d=!1,m=u?s:0,g=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let v of e){let b=this.footprints[v],C=b.hiddenFlags&g|m;b.hiddenFlags!==C&&(b.hiddenFlags=C,d=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;let s=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(let d of this.footprints){let m=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let b=d.indicesOffset;b<g;b++)m.indexArrayForConflation.uint16[3*b+0]=0,m.indexArrayForConflation.uint16[3*b+1]=0,m.indexArrayForConflation.uint16[3*b+2]=0;let v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let b=d.bloomIndicesOffset;b<v;b++)m.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}let u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=e.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=e.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){let s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=e.createVertexBuffer(u.layoutColorArray,RR.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=e.createVertexBuffer(u.layoutFacadePaintArray,gj.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=e.createVertexBuffer(u.entranceBloom.layoutColorArray,RR.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,s){let u=e.paint.get("building-ambient-occlusion-intensity");for(let d of this.footprints){if(4&d.hiddenFlags)continue;let m=s[d.promoteId],g=d.feature;g.properties["building-part"]="roof";let v=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";let C=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),T=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";let I=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),D=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";let P=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),z=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(let $ of d.parts){let Z,Y=v;$.part===1?(Y=v,Z=b):$.part===0?(Y=C,Z=T):$.part===2?(Y=I,Z=D):$.part===3&&(Y=P,Z=R),Z=G(Z,0,1);for(let te=0;te<$.vertexLength;te++){let he=$.vertexOffset+te,ae=1+(z.layoutAOArray.uint8[he]/255-1)*u;z.layoutColorArray.emplace(he,Y.r*ae*255<<8|Y.g*ae*255,Y.b*ae*255<<8|255*Z),d.hasFauxFacade&&z.layoutFacadePaintArray.emplace(he,255*I.r<<8|255*I.g,255*I.b<<8|255*D)}}let H=d.buildingBloom;if(H)for(let $=0;$<H.vertexLength;$++)z.entranceBloom.layoutColorArray.emplace(H.vertexOffset+$,255*P.r<<8|255*P.g,255*P.b<<8|51*R)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let d=s.getReplacementRegionsForTile(e.toUnwrapped());if(Yb(this.activeReplacements,d))return;this.activeReplacements=d;for(let g of this.footprints)g.hiddenFlags&=-2;let m=[];for(let g of this.activeReplacements){if(g.order<=LO)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(let b of this.footprints)b.min.x>g.max.x||b.max.x<g.min.x||b.min.y>g.max.y||b.max.y<g.min.y||(m.length=0,Ej(this.footprintsVertices,b.footprintVertexOffset,b.footprintVertexLength,g.footprintTileId.canonical,e.canonical,m),NT(g.footprint,m,this.footprintsIndices.uint16,b.footprintIndexOffset,b.footprintIndexLength,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){let s=this.featureFootprintLookup.get(e.id);return this.footprints[s]}return null}getHeightAtTileCoord(e,s){let u=Number.NEGATIVE_INFINITY,d=!0,m=4*(e+_t)*_t+(s+_t);if(this.footprintLookup.hasOwnProperty(m)){let v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}let g=new it(e,s);for(let v of this.footprints)e>v.max.x||v.min.x>e||s>v.max.y||v.min.y>s||v.height<=u||Cj(g,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(u=v.height,this.footprintLookup[m]=v,d=v.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[m]=void 0}}function Cj(a,e,s){for(let u=0;u<s.length;u+=3){let d=s[u],m=s[u+1],g=s[u+2],v=e[2*d+0],b=e[2*d+1],C=e[2*m+0],T=e[2*m+1],I=e[2*g+0],D=e[2*g+1],P=(v-I)*(a.y-D)-(b-D)*(a.x-I),R=(C-v)*(a.y-b)-(T-b)*(a.x-v);if(P<0!=R<0&&P!==0&&R!==0)continue;let z=(I-C)*(a.y-T)-(D-T)*(a.x-C);if(z===0||z<0==P+R<=0)return!0}return!1}function Ej(a,e,s,u,d,m){let g=Math.pow(2,u.z-d.z);for(let v=0;v<s;v++){let b=a.float32[2*(v+e)+0],C=a.float32[2*(v+e)+1];b=(b+d.x*_t)*g-u.x*_t,C=(C+d.y*_t)*g-u.y*_t,m.push(new it(b,C))}}let LR,NR;kt(FR,"BuildingBucket",{omit:["layers"]}),kt(rI,"BuildingGeometry"),kt(iI,"BuildingBloomGeometry");let Sj=Pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Tj=Pn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ij}=Sj,Mj=Pn([{name:"a_packed",components:3,type:"Float32"}]),{members:Dj}=Mj,Aj=Pn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Pj}=Aj;class zR{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new lh({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){let u=this.getKey(e,s);return this.positions[u]}trim(){let e=this.width,s=this.height=ze(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,u){let d=[],m=e.length%2==1?-e[e.length-1]*u:0,g=e[0]*u,v=!0;d.push({left:m,right:g,isDash:v,zeroLength:e[0]===0});let b=e[0];for(let C=1;C<e.length;C++){v=!v;let T=e[C];m=b*u,b+=T,g=b*u,d.push({left:m,right:g,isDash:v,zeroLength:T===0})}return d}addRoundDash(e,s,u){let d=s/2;for(let m=-u;m<=u;m++){let g=this.width*(this.nextRow+u+m),v=0,b=e[v];for(let C=0;C<this.width;C++){C/b.right>1&&(b=e[++v]);let T=Math.abs(C-b.left),I=Math.abs(C-b.right),D=Math.min(T,I),P,R=m/u*(d+1);if(b.isDash){let z=d-Math.abs(R);P=Math.sqrt(D*D+z*z)}else P=d-Math.sqrt(D*D+R*R);this.image.data[g+C]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,s){for(let b=e.length-1;b>=0;--b){let C=e[b],T=e[b+1];C.zeroLength?e.splice(b,1):T&&T.isDash===C.isDash&&(T.left=C.left,e.splice(b,1))}let u=e[0],d=e[e.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);let m=this.width*this.nextRow,g=0,v=e[g];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++g]);let C=Math.abs(b-v.left),T=Math.abs(b-v.right),I=Math.min(C,T);this.image.data[m+b]=Math.max(0,Math.min(255,(v.isDash?I:-I)+s+128))}}addDash(e,s){let u=this.getKey(e,s);if(this.positions[u])return this.positions[u];let d=s==="round",m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Dt("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let T=0;T<e.length;T++)e[T]<0&&(Dt("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),v+=e[T];if(v!==0){let T=this.width/v,I=this.getDashRanges(e,this.width,T);d?this.addRoundDash(I,T,m):this.addRegularDash(I,s==="square"?.5*T:0)}let b=this.nextRow+m;this.nextRow+=g;let C={tl:[b,m],br:[v,0]};return this.positions[u]=C,C}}kt(zR,"LineAtlas");let Oj=Ce.types,Rj=Math.cos(Math.PI/180*37.5),kj=Math.cos(Math.PI/180*5);class oI{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Bm,this.layoutVertexArray2=new Ws,this.patternVertexArray=new Ws,this.indexArray=new qr,this.programConfigurations=new ja(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ji,this.maxLineLength=0,this.zOffsetVertexArray=new Ws,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:_t/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.hasPattern=PT("line",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=q(u);let g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{let D=this.layers[0].layout.get("line-z-offset"),P=D.isConstant()&&!D.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&P?"none":"offset",this.elevationType==="offset"&&g==="none"&&Dt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;let b=[];for(let{feature:D,id:P,index:R,sourceLayerIndex:z}of e){let H=this.layers[0]._featureFilter.needGeometry,$=Se(D,H);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),$,u))continue;let Z=m?m.evaluate($,{},u):void 0,Y={id:P,properties:D.properties,type:D.type,sourceLayerIndex:z,index:R,geometry:H?$.geometry:_e(D,u,d),patterns:{},sortKey:Z};b.push(Y)}m&&b.sort((D,P)=>D.sortKey-P.sortKey);let{lineAtlas:C,featureIndex:T}=s,I=this.addConstantDashes(C);for(let D of b){let{geometry:P,index:R,sourceLayerIndex:z}=D;if(I&&this.addFeatureDashes(D,C),this.hasPattern){let H=OT("line",this.layers,D,this.zoom,this.pixelRatio,s);this.patternFeatures.push(H)}else this.addFeature(D,P,R,u,C.positions,s.availableImages,s.brightness,s.elevationFeatures);T.insert(e[R].feature,P,R,z,this.index)}}addConstantDashes(e){let s=!1;for(let u of this.layers){let d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")s=!0;else{let g=m.value,v=d.value;if(!v)continue;e.addDash(v,g)}}return s}addFeatureDashes(e,s){let u=this.zoom;for(let d of this.layers){let m=d.paint.get("line-dasharray").value,g=d.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let v,b;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:u},e);b=g.kind==="constant"?g.value:g.evaluate({zoom:u},e),s.addDash(v,b),e.patterns[d.id]=[s.getKey(v,b)]}}update(e,s,u,d,m,g,v,b){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}addFeatures(e,s,u,d,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,d,g,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Dj)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Pj)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Tj.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ij),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,s){let u,d;if(s&&s>0?(u=`mapbox_clip_start_${s}`,d=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",d="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(u)&&e.properties.hasOwnProperty(d))return{start:+e.properties[u],end:+e.properties[d]}}addFeature(e,s,u,d,m,g,v,b){let C=this.layers[0].layout,T=C.get("line-join").evaluate(e,{}),I=C.get("line-cap").evaluate(e,{}),D=C.get("line-miter-limit"),P=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;let R=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;let z=this.layers[0].paint.get("line-width").value;if(z.kind!=="constant"&&z.isLineProgressConstant===!1&&(this.variableWidthValue=z),this.elevationType==="road"){let H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,s,d,b,T,I,D,P)){let[$,Z]=this.clipRuntimeLinesToTile(s,1);for(let Y=0;Y<$.length;Y++){let te=$[Y],he=Z[Y],ae={progress:{min:he.progress.min,max:he.progress.max},nextDir:this.computeSegNextDir(he,te),prevDir:this.computeSegPrevDir(he,te)};this.addLine(te,e,d,T,I,D,P,ae,R&&he.parentIndex>0?he.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<s.length;H++)this.addLine(s[H],e,d,T,I,D,P,void 0,R&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,m,g,d,v,void 0,this.worldview)}computeSegNextDir(e,s){return e.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(e,s){return s[1].sub(e.prevPoint).unit()}clipLinesToTile(e,s){return Jb(e,-s,-s,_t+s,_t+s)}clipRuntimeLinesToTile(e,s){let u=[];return[Jb(e,-s,-s,_t+s,_t+s,u),u]}addElevatedRoadFeature(e,s,u,d,m,g,v,b){let C=[],T=ii.getElevationFeature(e,d);if(T){let I=this.clipLinesToTile(s,1),D=this.prepareElevatedLines(I,T,u);for(let P of D)C.push({geometry:P,elevation:T,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(let I of C){let D=this.layoutVertexArray.length;this.addLine(I.geometry,e,u,m,g,v,b);let P=new fi(u,I.elevationTileID);if(I.elevation)for(let R=D;R<this.layoutVertexArray.length;R++){let z=new it(this.layoutVertexArray.int16[6*R]>>1,this.layoutVertexArray.int16[6*R+1]>>1),H=P.pointElevation(z,I.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(e,s,u){if(s.constantHeight!=null)return e;let d=[],m=1/q(u);for(let g of e)H5(g,new Xn(s,m),0,d);return d}fillNonElevatedRoadSegment(e){for(let s=e;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,s,u,d,m,g,v,b,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(s,C):this.lineClips;let T=d==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let I=b&&b.progress.min>0,D=b&&b.progress.max<1;if(this.lineClips){let we={min:this.lineClips.start,max:this.lineClips.end},je=1;if(b){let Ye=this.lineClips.end-this.lineClips.start;we=(function(Ke,rt,st){return{min:Mi(Ke.min,rt,st),max:Mi(Ke.max,rt,st)}})(b.progress,{min:0,max:1},we),Ye>0&&(je=(we.max-we.min)/Ye)}let Te=+s.properties.mapbox_clip_feature_len,qe=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Te)||Number.isNaN(qe)){for(let Ke=0;Ke<e.length-1;Ke++)this.totalDistance+=e[Ke].dist(e[Ke+1]);let Ye=this.totalDistance/(we.max-we.min);this.totalFeatureLength=Number.isFinite(Ye)?Ye:0,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Te,this.distance=qe*je,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let P=Oj[s.type]==="Polygon",R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let z=0;for(;z<R-1&&e[z].equals(e[z+1]);)z++;if(R<(P?3:2))return;d==="bevel"&&(g=1.05);let H=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray),$,Z,Y,te,he,ae,me,ye;b&&b.prevDir&&(ae=b.prevDir.perp()),b&&b.nextDir&&(me=b.nextDir.perp()),this.e1=this.e2=-1,P&&($=e[R-2],he=e[z].sub($)._unit()._perp());for(let we=z;we<R;we++){if(Y=we===R-1?P?e[z+1]:void 0:e[we+1],Y&&e[we].equals(Y))continue;he&&(te=he),$&&(Z=$),$=e[we],ye=this.evaluateLineProgressFeatures(Z?Z.dist($):0),he=Y?Y.sub($)._unit()._perp():te,te=te||he;let je=Z&&Y,Te=je?d:P||T?"butt":m,qe=te.x*he.x+te.y*he.y;if(T){let $e=function(nt){if(nt.patternJoinNone){let vt=nt.segmentPoints.length/2,ut=nt.lineSoFar-nt.segmentStart;for(let Gt=0;Gt<vt;++Gt){let Tt=nt.segmentPoints[2*Gt+1],Pt=Math.round(nt.segmentPoints[2*Gt])+.5+.25*Tt;nt.patternVertexArray.emplaceBack(Pt,ut,nt.segmentStart),nt.patternVertexArray.emplaceBack(Pt,ut,nt.segmentStart)}nt.segmentPoints.length=0}nt.e1=nt.e2=-1};if(je&&qe<kj){this.updateDistance(Z,$),this.addCurrentVertex($,te,1,1,H,ye),$e(this),this.addCurrentVertex($,he,-1,-1,H,ye);continue}if(Z){if(!Y){this.updateDistance(Z,$),this.addCurrentVertex($,te,1,1,H,ye),$e(this);continue}Te="miter"}}let Ye=te.add(he);Ye.x===0&&Ye.y===0||Ye._unit();let Ke=Ye.x*he.x+Ye.y*he.y,rt=Ke!==0?1/Ke:1/0,st=2*Math.sqrt(2-2*Ke),et=Ke<Rj&&Z&&Y,tt=te.x*he.y-te.y*he.x>0,Ge=this.overscaling<=16?15*_t/(512*this.overscaling):0;if(je&&Te==="round"){if(rt<v)Te="miter";else if(rt<=2){let $e=sI($,-10,_t+10);Te=this.elevationType==="offset"&&($e||this.hasCrossSlope)?"miter":"fakeround"}}if(Te==="miter"&&rt>g&&(Te="bevel"),Te==="bevel"&&(rt>2&&(Te="flipbevel"),rt<g&&(Te="miter")),Z&&!(Te==="miter"&&et)&&this.updateDistance(Z,$),Te==="miter")if(et){let $e=$.dist(Z);if($e>2*Ge){let vt=$.sub($.sub(Z)._mult(Ge/$e)._round());this.updateDistance(Z,vt),this.addCurrentVertex(vt,te,0,0,H,ye),Z=vt}this.updateDistance(Z,$),Ye._mult(rt),this.addCurrentVertex($,Ye,0,0,H,ye);let nt=$.dist(Y);if(nt>2*Ge){let vt=$.add(Y.sub($)._mult(Ge/nt)._round());this.updateDistance($,vt),this.addCurrentVertex(vt,he,0,0,H,ye),$=vt}}else Ye._mult(rt),this.addCurrentVertex($,Ye,0,0,H,ye);else if(Te==="flipbevel"){if(rt>100)Ye=he.mult(-1);else{let $e=rt*te.add(he).mag()/te.sub(he).mag();Ye._perp()._mult($e*(tt?-1:1))}this.addCurrentVertex($,Ye,0,0,H,ye),this.addCurrentVertex($,Ye.mult(-1),0,0,H,ye)}else if(Te==="bevel"||Te==="fakeround"){ye!=null&&Z&&this.addCurrentVertex($,me||te,-1,-1,H,ye);let $e=$.dist(Z)<=2*Ge&&Te!=="bevel",nt=Ye.mult(tt?1:-1);nt._mult(rt);let vt=he.mult(tt?-1:1),ut=te.mult(tt?-1:1),Gt=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex($,nt.x,nt.y,!1,!tt,0,H,Gt),$e||this.addHalfVertex($,nt.x+2*ut.x,nt.y+2*ut.y,!1,tt,0,H,Gt)),Te==="fakeround"){let Tt=Math.round(180*st/Math.PI/20);this.addHalfVertex($,ut.x,ut.y,!1,tt,0,H,Gt);for(let Pt=0;Pt<Tt;Pt++){let Nt=Pt/Tt;if(Nt!==.5){let dt=Nt-.5;Nt+=Nt*dt*(Nt-1)*((1.0904+qe*(qe*(3.55645-1.43519*qe)-3.2452))*dt*dt+(.848013+qe*(.215638*qe-1.06021)))}let Tn=vt.sub(ut)._mult(Nt)._add(ut)._unit();this.addHalfVertex($,Tn.x,Tn.y,!1,tt,0,H,Gt)}this.addHalfVertex($,vt.x,vt.y,!1,tt,0,H,Gt)}$e||ye!=null||this.addHalfVertex($,nt.x+2*vt.x,nt.y+2*vt.y,!1,tt,0,H,Gt),ye!=null&&Y&&this.addCurrentVertex($,ae||he,1,1,H,ye)}else if(Te==="butt")this.addCurrentVertex($,Ye,0,0,H,ye);else if(Te==="square"){if(!Z){let $e=I?0:-1;this.addCurrentVertex($,Ye,$e,$e,H,ye)}if(this.addCurrentVertex($,Ye,0,0,H,ye),Z){let $e=D?0:1;this.addCurrentVertex($,Ye,$e,$e,H,ye)}}else if(Te==="round"){if(Z){let $e=!je&&me?me:te;this.addCurrentVertex($,$e,0,0,H,ye),!je&&D||this.addCurrentVertex($,$e,1,1,H,ye,!0)}if(Y){let $e=!je&&ae?ae:he;!je&&I||this.addCurrentVertex($,$e,-1,-1,H,ye,!0),this.addCurrentVertex($,$e,0,0,H,ye)}}}}addVerticesTo(e,s,u,d,m,g,v,b,C,T){let I=(s.w-e.w)/this.tessellationStep|0,D=0,P=this.scaledDistance;if(I>1){this.lineSoFar=e.w;let z=(s.x-e.x)/I,H=(s.y-e.y)/I,$=(s.z-e.z)/I,Z=(s.w-e.w)/I;for(let Y=1;Y<I;++Y){e.x+=z,e.y+=H,e.z+=$,this.lineSoFar+=Z,D+=Z;let te=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,u,d,T,!1,v,C,te),this.addHalfVertex(e,m,g,T,!0,-b,C,te)}}this.lineSoFar=s.w,this.scaledDistance=P;let R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,d,T,!1,v,C,R),this.addHalfVertex(s,m,g,T,!0,-b,C,R)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Dt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(e,s,u,d,m,g,v=!1){let b=s.x+s.y*u,C=s.y-s.x*u,T=s.y*d-s.x,I=-s.y-s.x*d;if(g!=null){let D=this.elevationType==="offset",P=-10,R=_t+10,z=g.zOffset,H=new sR(e.x,e.y,z,this.lineSoFar),$=!!D&&sI(e,P,R),Z=this.lineSoFar,Y=this.distance;if(this.currentVertex)if($){let te=this.currentVertexIsOutside,he=this.currentVertex,ae=new sR(e.x,e.y,z,this.lineSoFar);if(lR(he,ae,P,R),!sI(ae,P,R)){if(te){this.e1=this.e2=-1,this.distance-=he.dist(H),this.lineSoFar=he.w;let me=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,b,C,v,!1,u,m,me),this.addHalfVertex(he,T,I,v,!0,-d,m,me),this.prevDistance=this.distance}this.distance=this.prevDistance+he.dist(ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(he,ae,b,C,T,I,u,d,m,v),this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}}else{let te=this.currentVertex;if(this.currentVertexIsOutside){lR(te,H,P,R),this.e1=this.e2=-1,this.distance-=te.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;let he=this.evaluateLineProgressFeatures(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,b,C,v,!1,u,m,he),this.addHalfVertex(te,T,I,v,!0,-d,m,he),this.prevDistance=this.distance,this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,H,b,C,T,I,u,d,m,v)}else $||(this.addHalfVertex(e,b,C,v,!1,u,m,g),this.addHalfVertex(e,T,I,v,!0,-d,m,g));this.currentVertex=H,this.currentVertexIsOutside=$,this.lineSoFar=Z}else this.addHalfVertex(e,b,C,v,!1,u,m,g),this.addHalfVertex(e,T,I,v,!0,-d,m,g)}addHalfVertex({x:e,y:s},u,d,m,g,v,b,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let I=on(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,I)}let T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),g?this.e2=T:this.e1=T,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,s){this.prevDistance=this.distance,this.distance+=e.dist(s),this.updateScaledDistance()}}function sI(a,e,s){return a.x<e||a.x>s||a.y<e||a.y>s}let BR,VR;function UR(a,e,s){return e*(_t/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}kt(oI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let jR=(a,e,s)=>(1-s)*a+s*e;function $R(a,e){return 1/UR(a,1,e.tileZoom)}function HR(a,e,s,u){return a.translatePosMatrix(u||e.tileID.projMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}let GR=a=>{let e=[];qR(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let u=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return u&&d&&e.push("LINE_JOIN_NONE"),e};function qR(a){let e=a.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let aI,WR=()=>aI||(aI={layout:BR||(BR=new hr({"line-cap":new wt(Me.layout_line["line-cap"]),"line-join":new wt(Me.layout_line["line-join"]),"line-miter-limit":new ht(Me.layout_line["line-miter-limit"]),"line-round-limit":new ht(Me.layout_line["line-round-limit"]),"line-sort-key":new wt(Me.layout_line["line-sort-key"]),"line-z-offset":new wt(Me.layout_line["line-z-offset"]),"line-elevation-reference":new ht(Me.layout_line["line-elevation-reference"]),"line-cross-slope":new ht(Me.layout_line["line-cross-slope"]),visibility:new ht(Me.layout_line.visibility),"line-width-unit":new ht(Me.layout_line["line-width-unit"])})),paint:VR||(VR=new hr({"line-opacity":new wt(Me.paint_line["line-opacity"]),"line-color":new wt(Me.paint_line["line-color"]),"line-translate":new ht(Me.paint_line["line-translate"]),"line-translate-anchor":new ht(Me.paint_line["line-translate-anchor"]),"line-width":new wt(Me.paint_line["line-width"]),"line-gap-width":new wt(Me.paint_line["line-gap-width"]),"line-offset":new wt(Me.paint_line["line-offset"]),"line-blur":new wt(Me.paint_line["line-blur"]),"line-dasharray":new wt(Me.paint_line["line-dasharray"]),"line-pattern":new wt(Me.paint_line["line-pattern"]),"line-pattern-cross-fade":new ht(Me.paint_line["line-pattern-cross-fade"]),"line-gradient":new ed(Me.paint_line["line-gradient"]),"line-trim-offset":new ht(Me.paint_line["line-trim-offset"]),"line-trim-fade-range":new ht(Me.paint_line["line-trim-fade-range"]),"line-trim-color":new ht(Me.paint_line["line-trim-color"]),"line-emissive-strength":new wt(Me.paint_line["line-emissive-strength"]),"line-border-width":new wt(Me.paint_line["line-border-width"]),"line-border-color":new wt(Me.paint_line["line-border-color"]),"line-occlusion-opacity":new ht(Me.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},aI);class Fj extends wt{possiblyEvaluate(e,s){return s=new Ni(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(e,s)}evaluate(e,s,u,d){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,u,d)}}let x0;function ZR(a,e){return e>0?e+2*a:a}let Lj=Pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nj=Pn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zj=Pn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Bj=Pn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Vj=Pn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Uj=Pn([{name:"a_texb",components:2,type:"Uint16"}]),jj=Pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),$j=Pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let XR=Pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hj=Pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pn([{name:"triangle",components:3,type:"Uint16"}]),Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Pn([{type:"Float32",name:"offsetX"}]),Pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ao=24;function Gj(a,e,s){return a.sections.forEach(u=>{u.text=(function(d,m,g){let v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),Kl.applyArabicShaping&&(d=Kl.applyArabicShaping(d)),d})(u.text,e,s)}),a}let b0={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function qj(a){return a==="\uFE36"||a==="\uFE48"||a==="\uFE38"||a==="\uFE44"||a==="\uFE42"||a==="\uFE3E"||a==="\uFE3C"||a==="\uFE3A"||a==="\uFE18"||a==="\uFE40"||a==="\uFE10"||a==="\uFE13"||a==="\uFE14"||a==="\uFF40"||a==="\uFFE3"||a==="\uFE11"||a==="\uFE12"}function Wj(a){return a==="\uFE35"||a==="\uFE47"||a==="\uFE37"||a==="\uFE43"||a==="\uFE41"||a==="\uFE3D"||a==="\uFE3B"||a==="\uFE39"||a==="\uFE17"||a==="\uFE3F"}let lI=4294967296,YR=1/lI,KR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),d1=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,e,s=this.length){for(;this.pos<s;){let u=this.readVarint(),d=u>>3,m=this.pos;this.type=7&u,a(d,e,this),this.pos===m&&this.skip(u)}return e}readMessage(a,e){return this.readFields(a,e,this.readVarint()+this.pos)}readFixed32(){let a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){let a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){let a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*lI;return this.pos+=8,a}readSFixed64(){let a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*lI;return this.pos+=8,a}readFloat(){let a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){let a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){let e=this.buf,s,u;return u=e[this.pos++],s=127&u,u<128?s:(u=e[this.pos++],s|=(127&u)<<7,u<128?s:(u=e[this.pos++],s|=(127&u)<<14,u<128?s:(u=e[this.pos++],s|=(127&u)<<21,u<128?s:(u=e[this.pos],s|=(15&u)<<28,(function(d,m,g){let v=g.buf,b,C;if(C=v[g.pos++],b=(112&C)>>4,C<128||(C=v[g.pos++],b|=(127&C)<<3,C<128)||(C=v[g.pos++],b|=(127&C)<<10,C<128)||(C=v[g.pos++],b|=(127&C)<<17,C<128)||(C=v[g.pos++],b|=(127&C)<<24,C<128)||(C=v[g.pos++],b|=(1&C)<<31,C<128))return dg(d,b,m);throw new Error("Expected varint not more than 10 bytes")})(s,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){let a=this.readVarint()+this.pos,e=this.pos;return this.pos=a,a-e>=12&&KR?KR.decode(this.buf.subarray(e,a)):(function(s,u,d){let m="",g=u;for(;g<d;){let v=s[g],b,C,T,I=null,D=v>239?4:v>223?3:v>191?2:1;if(g+D>d)break;D===1?v<128&&(I=v):D===2?(b=s[g+1],(192&b)==128&&(I=(31&v)<<6|63&b,I<=127&&(I=null))):D===3?(b=s[g+1],C=s[g+2],(192&b)==128&&(192&C)==128&&(I=(15&v)<<12|(63&b)<<6|63&C,(I<=2047||I>=55296&&I<=57343)&&(I=null))):D===4&&(b=s[g+1],C=s[g+2],T=s[g+3],(192&b)==128&&(192&C)==128&&(192&T)==128&&(I=(15&v)<<18|(63&b)<<12|(63&C)<<6|63&T,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,D=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),g+=D}return m})(this.buf,e,a)}readBytes(){let a=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,a);return this.pos=a,e}readPackedVarint(a=[],e){let s=this.readPackedEnd();for(;this.pos<s;)a.push(this.readVarint(e));return a}readPackedSVarint(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFloat());return a}readPackedDouble(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){let e=7&a;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(a,e){this.writeVarint(a<<3|e)}realloc(a){let e=this.length||16;for(;e<this.pos+a;)e*=2;if(e!==this.length){let s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*YR),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*YR),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(e,s){let u,d;if(e>=0?(u=e%4294967296|0,d=e/4294967296|0):(u=~(-e%4294967296),d=~(-e/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(u,0,s),(function(m,g){let v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(d,s)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;let e=this.pos;this.pos=(function(u,d,m){for(let g,v,b=0;b<d.length;b++){if(g=d.charCodeAt(b),g>55295&&g<57344){if(!v){g>56319||b+1===d.length?(u[m++]=239,u[m++]=191,u[m++]=189):v=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(u[m++]=239,u[m++]=191,u[m++]=189,v=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m})(this.buf,a,this.pos);let s=this.pos-e;s>=128&&QR(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){let e=a.length;this.writeVarint(e),this.realloc(e);for(let s=0;s<e;s++)this.buf[this.pos++]=a[s]}writeRawMessage(a,e){this.pos++;let s=this.pos;a(e,this);let u=this.pos-s;u>=128&&QR(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(a,e,s){this.writeTag(a,2),this.writeRawMessage(e,s)}writePackedVarint(a,e){e.length&&this.writeMessage(a,Zj,e)}writePackedSVarint(a,e){e.length&&this.writeMessage(a,Xj,e)}writePackedBoolean(a,e){e.length&&this.writeMessage(a,Qj,e)}writePackedFloat(a,e){e.length&&this.writeMessage(a,Yj,e)}writePackedDouble(a,e){e.length&&this.writeMessage(a,Kj,e)}writePackedFixed32(a,e){e.length&&this.writeMessage(a,Jj,e)}writePackedSFixed32(a,e){e.length&&this.writeMessage(a,e6,e)}writePackedFixed64(a,e){e.length&&this.writeMessage(a,t6,e)}writePackedSFixed64(a,e){e.length&&this.writeMessage(a,n6,e)}writeBytesField(a,e){this.writeTag(a,2),this.writeBytes(e)}writeFixed32Field(a,e){this.writeTag(a,5),this.writeFixed32(e)}writeSFixed32Field(a,e){this.writeTag(a,5),this.writeSFixed32(e)}writeFixed64Field(a,e){this.writeTag(a,1),this.writeFixed64(e)}writeSFixed64Field(a,e){this.writeTag(a,1),this.writeSFixed64(e)}writeVarintField(a,e){this.writeTag(a,0),this.writeVarint(e)}writeSVarintField(a,e){this.writeTag(a,0),this.writeSVarint(e)}writeStringField(a,e){this.writeTag(a,2),this.writeString(e)}writeFloatField(a,e){this.writeTag(a,5),this.writeFloat(e)}writeDoubleField(a,e){this.writeTag(a,1),this.writeDouble(e)}writeBooleanField(a,e){this.writeVarintField(a,+e)}};function dg(a,e,s){return s?4294967296*e+(a>>>0):4294967296*(e>>>0)+(a>>>0)}function QR(a,e,s){let u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(u);for(let d=s.pos-1;d>=a;d--)s.buf[d+u]=s.buf[d]}function Zj(a,e){for(let s=0;s<a.length;s++)e.writeVarint(a[s])}function Xj(a,e){for(let s=0;s<a.length;s++)e.writeSVarint(a[s])}function Yj(a,e){for(let s=0;s<a.length;s++)e.writeFloat(a[s])}function Kj(a,e){for(let s=0;s<a.length;s++)e.writeDouble(a[s])}function Qj(a,e){for(let s=0;s<a.length;s++)e.writeBoolean(a[s])}function Jj(a,e){for(let s=0;s<a.length;s++)e.writeFixed32(a[s])}function e6(a,e){for(let s=0;s<a.length;s++)e.writeSFixed32(a[s])}function t6(a,e){for(let s=0;s<a.length;s++)e.writeFixed64(a[s])}function n6(a,e){for(let s=0;s<a.length;s++)e.writeSFixed64(a[s])}let cI=3;function i6(a,e,s){e.glyphs=[],a===1&&s.readMessage(r6,e)}function r6(a,e,s){if(a===3){let{id:u,bitmap:d,width:m,height:g,left:v,top:b,advance:C}=s.readMessage(o6,{});e.glyphs.push({id:u,bitmap:new lh({width:m+2*cI,height:g+2*cI},d),metrics:{width:m,height:g,left:v,top:b,advance:C}})}else a===4?e.ascender=s.readSVarint():a===5&&(e.descender=s.readSVarint())}function o6(a,e,s){a===1?e.id=s.readVarint():a===2?e.bitmap=s.readBytes():a===3?e.width=s.readVarint():a===4?e.height=s.readVarint():a===5?e.left=s.readSVarint():a===6?e.top=s.readSVarint():a===7&&(e.advance=s.readVarint())}let JR=cI,Ks={horizontal:1,vertical:2,horizontalOnly:3};class w0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,s){let u=new w0;return u.scale=e||1,u.fontStack=s,u}static forImage(e){let s=new w0;return s.image=e,s}}class hg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s,u){let d=new hg;for(let m=0;m<e.sections.length;m++){let g=e.sections[m];g.image?d.addImageSection(g,u):d.addTextSection(g,s)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(s,u){let d="";for(let m=0;m<s.length;m++){let g=s.charCodeAt(m+1)||null,v=s.charCodeAt(m-1)||null;d+=!u&&(g&&Mm(g)&&!b0[s[m+1]]||v&&Mm(v)&&!b0[s[m-1]])||!b0[s[m]]?s[m]:b0[s[m]]}return d})(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&h1[this.text.charCodeAt(u)];u++)e++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&h1[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){let u=new hg;return u.text=this.text.substring(e,s),u.sectionIndex=this.sectionIndex.slice(e,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(w0.forText(e.scale,e.fontStack||s));let u=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(u)}addImageSection(e,s){let u=e.image?e.image.getPrimary():null;if(!u)return void Dt("Can't add FormattedSection with an empty image.");u.scaleSelf(s);let d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(w0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function uI(a,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z=1){let H=hg.fromFeature(a,d,z);I===Ks.vertical&&H.verticalizePunctuation(D);let $=[],Z=(function(me,ye,we,je,Te,qe){if(!me)return[];let Ye=[],Ke=(function(tt,Ge,$e,nt,vt,ut){let Gt=0;for(let Tt=0;Tt<tt.length();Tt++){let Pt=tt.getSection(Tt);Gt+=ek(tt.getCodePoint(Tt),Pt,nt,vt,Ge,ut)}return Gt/Math.max(1,Math.ceil(Gt/$e))})(me,ye,we,je,Te,qe),rt=me.text.indexOf("\u200B")>=0,st=0;for(let tt=0;tt<me.length();tt++){let Ge=me.getSection(tt),$e=me.getCodePoint(tt);if(h1[$e]||(st+=ek($e,Ge,je,Te,ye,qe)),tt<me.length()-1){let nt=!((et=$e)<11904||!(en["Bopomofo Extended"](et)||en.Bopomofo(et)||en["CJK Compatibility Forms"](et)||en["CJK Compatibility Ideographs"](et)||en["CJK Compatibility"](et)||en["CJK Radicals Supplement"](et)||en["CJK Strokes"](et)||en["CJK Symbols and Punctuation"](et)||en["CJK Unified Ideographs Extension A"](et)||en["CJK Unified Ideographs"](et)||en["Enclosed CJK Letters and Months"](et)||en["Halfwidth and Fullwidth Forms"](et)||en.Hiragana(et)||en["Ideographic Description Characters"](et)||en["Kangxi Radicals"](et)||en["Katakana Phonetic Extensions"](et)||en.Katakana(et)||en["Vertical Forms"](et)||en["Yi Radicals"](et)||en["Yi Syllables"](et)));(s6[$e]||nt||Ge.image)&&Ye.push(nk(tt+1,st,Ke,Ye,a6($e,me.getCodePoint(tt+1),nt&&rt),!1))}}var et;return ik(nk(me.length(),st,Ke,Ye,0,!0))})(H,C,m,e,u,P),{processBidirectionalText:Y,processStyledBidirectionalText:te}=Kl;if(Y&&H.sections.length===1){let me=Y(H.toString(),Z);for(let ye of me){let we=new hg;we.text=ye,we.sections=H.sections;for(let je=0;je<ye.length;je++)we.sectionIndex.push(0);$.push(we)}}else if(te){let me=te(H.text,H.sectionIndex,Z);for(let ye of me){let we=new hg;we.text=ye[0],we.sectionIndex=ye[1],we.sections=H.sections,$.push(we)}}else $=(function(me,ye){let we=[],je=me.text,Te=0;for(let qe of ye)we.push(me.substring(Te,qe)),Te=qe;return Te<je.length&&we.push(me.substring(Te,je.length)),we})(H,Z);let he=[],ae={positionedLines:he,text:H.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(me,ye,we,je,Te,qe,Ye,Ke,rt,st,et,tt){let Ge=0,$e=0,nt=0,vt=Ke==="right"?1:Ke==="left"?0:.5,ut=!1;for(let dt of Te){let zt=dt.getSections();for(let un of zt){if(un.image)continue;let Ln=ye[un.fontStack];if(Ln&&(ut=Ln.ascender!==void 0&&Ln.descender!==void 0,!ut))break}if(!ut)break}let Gt=0;for(let dt of Te){dt.trim();let zt=dt.getMaxScale(),un=(zt-1)*ao,Ln={positionedGlyphs:[],lineOffset:0};me.positionedLines[Gt]=Ln;let zn=Ln.positionedGlyphs,_n=0;if(!dt.length()){$e+=qe,++Gt;continue}let _i=0,ce=0;for(let We=0;We<dt.length();We++){let ot=dt.getSection(We),Ct=dt.getSectionIndex(We),Et=dt.getCodePoint(We),qt=ot.scale,Xt=null,mn=null,Cn=null,Sn=ao,On=0,rn=rt;rn===Ks.vertical&&((Tt=Et)===12312||Tt===12313||Tt===12316||Tt===12540||Tt===12448)&&(rn=Ks.horizontal);let cn=!(rn===Ks.horizontal||!et&&!Im(Et)||et&&(h1[Et]||Dm(Et)));if(ot.image){let $n=je.get(ot.image.toString());if(!$n)continue;Cn=ot.image,me.iconsInText=me.iconsInText||!0,mn=$n.paddedRect;let Yn=$n.displaySize;qt=qt*ao/tt,Xt={width:Yn[0],height:Yn[1],left:0,top:-JR,advance:cn?Yn[1]:Yn[0],localGlyph:!1},On=ut?-Xt.height*qt:zt*ao-17-Yn[1]*qt,Sn=Xt.advance;let Kn=(cn?Yn[0]:Yn[1])*qt-ao*zt;Kn>0&&Kn>_n&&(_n=Kn)}else{let $n=we[ot.fontStack];if(!$n)continue;$n[Et]&&(mn=$n[Et]);let Yn=ye[ot.fontStack];if(!Yn)continue;let Kn=Yn.glyphs[Et];if(!Kn)continue;if(Xt=Kn.metrics,Sn=Et!==8203?ao:0,ut){let di=Yn.ascender!==void 0?Math.abs(Yn.ascender):0,Ti=Yn.descender!==void 0?Math.abs(Yn.descender):0,vi=(di+Ti)*qt;_i<vi&&(_i=vi,ce=(di-Ti)/2*qt),On=-di*qt}else On=(zt-qt)*ao-17}cn?(me.verticalizable=!0,zn.push({glyph:Et,image:Cn,x:Ge,y:$e+On,vertical:cn,scale:qt,localGlyph:Xt.localGlyph,fontStack:ot.fontStack,sectionIndex:Ct,metrics:Xt,rect:mn}),Ge+=Sn*qt+st):(zn.push({glyph:Et,image:Cn,x:Ge,y:$e+On,vertical:cn,scale:qt,localGlyph:Xt.localGlyph,fontStack:ot.fontStack,sectionIndex:Ct,metrics:Xt,rect:mn}),Ge+=Xt.advance*qt+st)}zn.length!==0&&(nt=Math.max(Ge-st,nt),ut?rk(zn,vt,_n,ce,qe*zt/2):rk(zn,vt,_n,0,qe/2)),Ge=0;let pe=qe*zt+_n;Ln.lineOffset=Math.max(_n,un),$e+=pe,++Gt}var Tt;let Pt=$e,{horizontalAlign:Nt,verticalAlign:Tn}=dI(Ye);(function(dt,zt,un,Ln,zn,_n){let _i=(zt-un)*zn,ce=-_n*Ln;for(let pe of dt)for(let We of pe.positionedGlyphs)We.x+=_i,We.y+=ce})(me.positionedLines,vt,Nt,Tn,nt,Pt),me.top+=-Tn*Pt,me.bottom=me.top+Pt,me.left+=-Nt*nt,me.right=me.left+nt,me.hasBaseline=ut})(ae,e,s,u,$,g,v,b,I,C,D,R),!(function(me){for(let ye of me)if(ye.positionedGlyphs.length!==0)return!1;return!0})(he))return ae}let h1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},s6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ek(a,e,s,u,d,m){if(e.image){let g=u.get(e.image.toString());return g?g.displaySize[0]*e.scale*ao/m+d:0}{let g=s[e.fontStack],v=g&&g.glyphs[a];return v?v.metrics.advance*e.scale+d:0}}function tk(a,e,s,u){let d=Math.pow(a-e,2);return u?a<e?d/2:2*d:d+Math.abs(s)*s}function a6(a,e,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function nk(a,e,s,u,d,m){let g=null,v=tk(e,s,d,m);for(let b of u){let C=tk(e-b.x,s,d,m)+b.badness;C<=v&&(g=b,v=C)}return{index:a,x:e,priorBreak:g,badness:v}}function ik(a){return a?ik(a.priorBreak).concat(a.index):[]}function dI(a){let e=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function rk(a,e,s,u,d){if(!(e||s||u||d))return;let m=a.length-1,g=a[m],v=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=m;b++)a[b].x-=v,a[b].y+=s+u+d}function hI(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function p1(a,e,s,u){let{horizontalAlign:d,verticalAlign:m}=dI(u),g=s[0]-a.displaySize[0]*d,v=s[1]-a.displaySize[1]*m;return{imagePrimary:a,imageSecondary:e,top:v,bottom:v+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function pI(a,e,s,u,d,m){let g=a.imagePrimary,v;if(g.content){let H=g.content,$=g.pixelRatio||1;v=[H[0]/$,H[1]/$,g.displaySize[0]-H[2]/$,g.displaySize[1]-H[3]/$]}let b=e.left*m,C=e.right*m,T,I,D,P;s==="width"||s==="both"?(P=d[0]+b-u[3],I=d[0]+C+u[1]):(P=d[0]+(b+C-g.displaySize[0])/2,I=P+g.displaySize[0]);let R=e.top*m,z=e.bottom*m;return s==="height"||s==="both"?(T=d[1]+R-u[0],D=d[1]+z+u[2]):(T=d[1]+(R+z-g.displaySize[1])/2,D=T+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:T,right:I,bottom:D,left:P,collisionPadding:v}}function ok(a){return!a.imagePrimary.stretchX}function sk(a){return!a.imagePrimary.stretchY}function ak(a){return{width:a.right-a.left,height:a.bottom-a.top}}let ac=128;function pg(a,e,s){let{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ni(a+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{let{zoomStops:d,interpolationType:m}=u,g=0;for(;g<d.length&&d[g]<=a;)g++;g=Math.max(0,g-1);let v=g;for(;v<d.length&&d[v]<a+1;)v++;v=Math.min(d.length-1,v);let b=d[g],C=d[v];return u.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:C,minSize:u.evaluate(new Ni(b,{worldview:s})),maxSize:u.evaluate(new Ni(C,{worldview:s})),interpolationType:m}}}function fI(a,{uSize:e,uSizeT:s},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/ac:a.kind==="composite"?on(u/ac,d/ac,s):e}function fg(a,e,s=1){let u=0,d=0;if(a.kind==="constant")d=a.layoutSize*s;else if(a.kind!=="source"){let{interpolationType:m,minZoom:g,maxZoom:v}=a,b=m?G(qs.interpolationFactor(m,e,g,v),0,1):0;a.kind==="camera"?d=on(a.minSize,a.maxSize,b)*s:u=b*s}return{uSizeT:u,uSize:d}}class ld extends it{constructor(e,s,u,d,m){super(e,s),this.angle=d,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new ld(this.x,this.y,this.z,this.angle,this.segment)}}function lk(a,e,s,u,d){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,v=0;for(;v>-s/2;){if(g--,g<0)return!1;v-=a[g].dist(m),m=a[g]}v+=a[g].dist(a[g+1]),g++;let b=[],C=0;for(;v<s/2;){let T=a[g],I=a[g+1];if(!I)return!1;let D=a[g-1].angleTo(T)-T.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:D}),C+=D;v-b[0].distance>u;)C-=b.shift().angleDelta;if(C>d)return!1;g++,v+=T.dist(I)}return!0}function ck(a){let e=0;for(let s=0;s<a.length-1;s++)e+=a[s].dist(a[s+1]);return e}function uk(a,e,s){return a?.6*e*s:0}function dk(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function l6(a,e,s,u,d,m){let g=uk(s,d,m),v=dk(s,u)*m,b=0,C=ck(a)/2;for(let T=0;T<a.length-1;T++){let I=a[T],D=a[T+1],P=I.dist(D);if(b+P>C){let R=(C-b)/P,z=on(I.x,D.x,R),H=on(I.y,D.y,R),$=new ld(z,H,0,D.angleTo(I),T);return!g||lk(a,$,v,g,e)?$:void 0}b+=P}}function c6(a,e,s,u,d,m,g,v,b){let C=uk(u,m,g),T=dk(u,d),I=T*g,D=a[0].x===0||a[0].x===b||a[0].y===0||a[0].y===b;return e-I<e/4&&(e=I+e/4),hk(a,D?e/2*v%e:(T/2+2*m)*g*v%e,e,C,s,I,D,!1,b)}function hk(a,e,s,u,d,m,g,v,b){let C=m/2,T=ck(a),I=0,D=e-s,P=[];for(let R=0;R<a.length-1;R++){let z=a[R],H=a[R+1],$=z.dist(H),Z=H.angleTo(z);for(;D+s<I+$;){D+=s;let Y=(D-I)/$,te=on(z.x,H.x,Y),he=on(z.y,H.y,Y);if(te>=0&&te<b&&he>=0&&he<b&&D-C>=0&&D+C<=T){let ae=new ld(te,he,0,Z,R);u&&!lk(a,ae,m,u,d)||P.push(ae)}}I+=$}return v||P.length||g||(P=hk(a,I/2,s,u,d,m,g,!0,b)),P}function pk(a){let e=0,s=0;for(let g of a)e+=g.w*g.h,s=Math.max(s,g.w);a.sort((g,v)=>v.h-g.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}],d=0,m=0;for(let g of a)for(let v=u.length-1;v>=0;v--){let b=u[v];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,m=Math.max(m,g.y+g.h),d=Math.max(d,g.x+g.w),g.w===b.w&&g.h===b.h){let C=u.pop();C&&v<u.length&&(u[v]=C)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(u.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}kt(ld,"Anchor");let jp=1;class C0{static getImagePositionScale(e,s,u){if(s&&e){let{sx:d,sy:m}=e;return{x:d,y:m}}return{x:u,y:u}}constructor(e,s,u,d){this.paddedRect=e;let{pixelRatio:m,version:g,stretchX:v,stretchY:b,content:C,sdf:T,usvg:I}=s;this.pixelRatio=m,this.stretchX=v,this.stretchY=b,this.content=C,this.version=g,this.padding=u,this.sdf=T,this.usvg=I,this.scale=C0.getImagePositionScale(d,I,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function mI(a,e,s){let u=Hl.parse(a),d=(function(m,g,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*g,h:(m.data?m.data.height:m.height*v[1])+2*g}})(e,s,[u.sx,u.sy]);return{bin:d,imagePosition:new C0(d,e,s,u),imageVariant:u}}class fk{constructor(e,s,u){let d=new Map,m=new Map;this.haveRenderCallbacks=[];let g=[];this.addImages(e,d,jp,g),this.addImages(s,m,2,g);let{w:v,h:b}=pk(g),C=new jo({width:v||1,height:b||1});for(let[T,I]of e.entries()){let D=d.get(T).paddedRect;jo.copy(I.data,C,{x:0,y:0},{x:D.x+jp,y:D.y+jp},I.data,null,I.sdf)}for(let[T,I]of s.entries()){let D=m.get(T),P=D.paddedRect,R=D.padding,z=P.x+R,H=P.y+R,$=I.data.width,Z=I.data.height;R=R>1?R-1:R,jo.copy(I.data,C,{x:0,y:0},{x:z,y:H},I.data,u),jo.copy(I.data,C,{x:0,y:Z-R},{x:z,y:H-R},{width:$,height:R},u),jo.copy(I.data,C,{x:0,y:0},{x:z,y:H+Z},{width:$,height:R},u),jo.copy(I.data,C,{x:$-R,y:0},{x:z-R,y:H},{width:R,height:Z},u),jo.copy(I.data,C,{x:0,y:0},{x:z+$,y:H},{width:R,height:Z},u),jo.copy(I.data,C,{x:$-R,y:Z-R},{x:z-R,y:H-R},{width:R,height:R},u),jo.copy(I.data,C,{x:0,y:Z-R},{x:z+$,y:H-R},{width:R,height:R},u),jo.copy(I.data,C,{x:0,y:0},{x:z+$,y:H+Z},{width:R,height:R},u),jo.copy(I.data,C,{x:$-R,y:0},{x:z-R,y:H+Z},{width:R,height:R},u)}this.lut=u,this.image=C,this.iconPositions=d,this.patternPositions=m}addImages(e,s,u,d){for(let[m,g]of e.entries()){let{bin:v,imagePosition:b,imageVariant:C}=mI(m,g,u);s.set(m,b),d.push(v),g.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>e.hasImage(d,u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(let d of e.getUpdatedImages(u)){for(let m of this.iconPositions.keys()){let g=Hl.parse(m);if(Yo.isEqual(g.id,d)){let v=e.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(m),v,s,null)}}for(let m of this.patternPositions.keys()){let g=Hl.parse(m);if(Yo.isEqual(g.id,d)){let v=e.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(m),v,s,this.lut)}}}}patchUpdatedImage(e,s,u,d=null){if(!e||!s||e.version===s.version)return;e.version=s.version;let[m,g]=e.tl,v=e.sdf;if(this.lut||v){let b={width:s.data.width,height:s.data.height},C=new jo(b);jo.copy(s.data,C,{x:0,y:0},{x:0,y:0},b,d,v),u.update(C,{position:{x:m,y:g}})}else u.update(s.data,{position:{x:m,y:g}})}}kt(C0,"ImagePosition"),kt(fk,"ImageAtlas");let E0=1e20;function mk(a,e,s,u,d,m,g,v,b){for(let C=e;C<e+u;C++)gk(a,s*m+C,m,d,g,v,b);for(let C=s;C<s+d;C++)gk(a,C*m+e,1,u,g,v,b)}function gk(a,e,s,u,d,m,g){m[0]=0,g[0]=-E0,g[1]=E0,d[0]=a[e];for(let v=1,b=0,C=0;v<u;v++){d[v]=a[e+v*s];let T=v*v;do{let I=m[b];C=(d[v]-d[I]+T-I*I)/(v-I)/2}while(C<=g[b]&&--b>-1);b++,m[b]=v,g[b]=C,g[b+1]=E0}for(let v=0,b=0;v<u;v++){for(;g[b+1]<v;)b++;let C=m[b],T=v-C;a[e+v*s]=d[C]+T*T}}let lc=2,gI={none:0,ideographs:1,all:2};class mg{constructor(e,s,u){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){let u=[],d=this.url||kn.GLYPHS_URL;for(let m in e)for(let g of e[m])u.push({stack:m,id:g});xe(u,({stack:m,id:g},v)=>{let b=this.entries[m];b||(b=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[g];if(C!==void 0)return void v(null,{stack:m,id:g,glyph:C});if(C=this._tinySDF(b,m,g),C)return b.glyphs[g]=C,void v(null,{stack:m,id:g,glyph:C});let T=Math.floor(g/256);if(256*T>65535)return Dt("glyphs > 65535 not supported"),void v(null,{stack:m,id:g,glyph:C});if(b.ranges[T])return void v(null,{stack:m,id:g,glyph:C});let I=b.requests[T];I||(I=b.requests[T]=[],mg.loadGlyphRange(m,T,d,this.requestManager,(D,P)=>{if(P){b.ascender=P.ascender,b.descender=P.descender;for(let R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(b.glyphs[+R]=P.glyphs[+R]);b.ranges[T]=!0}for(let R of I)R(D,P);delete b.requests[T]})),I.push((D,P)=>{D?v(D):P&&v(null,{stack:m,id:g,glyph:P.glyphs[g]||null})})},(m,g)=>{if(m)s(m);else if(g){let v={};for(let{stack:b,id:C,glyph:T}of g)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[C]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==gI.none&&(this.localGlyphMode===gI.all?!!this.localFontFamily:!!this.localFontFamily&&(en["CJK Unified Ideographs"](e)||en["Hangul Syllables"](e)||en.Hiragana(e)||en.Katakana(e)||en["CJK Symbols and Punctuation"](e)||en["CJK Unified Ideographs Extension A"](e)||en["CJK Unified Ideographs Extension B"](e)||en.Osage(e)))}_tinySDF(e,s,u){let d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let m=e.tinySDF;if(!m){let z="400";/bold/i.test(s)?z="900":/medium/i.test(s)?z="500":/light/i.test(s)&&(z="200"),m=e.tinySDF=new mg.TinySDF({fontFamily:d,fontWeight:z,fontSize:24*lc,buffer:3*lc,radius:8*lc}),m.fontWeight=z}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];let g=String.fromCodePoint(u),{data:v,width:b,height:C,glyphWidth:T,glyphHeight:I,glyphLeft:D,glyphTop:P,glyphAdvance:R}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new lh({width:b,height:C},v),metrics:{width:T/lc,height:I/lc,left:D/lc,top:P/lc-27,advance:R/lc,localGlyph:!0}}}}mg.loadGlyphRange=function(a,e,s,u,d){let m=256*e,g=m+255,v=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${m}-${g}`),Jh.Glyphs);$l(v,(b,C)=>{if(b)d(b);else if(C){let T={},I=(function(D){return new d1(D).readFields(i6,{})})(C);for(let D of I.glyphs)T[D.id]=D;d(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},mg.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:v=null}={}){this.buffer=e,this.cutoff=u,this.radius=s,this.lang=v;let b=this.size=a+4*e,C=this._createCanvas(b),T=this.ctx=C.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${m} ${a}px ${d}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(a){let e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){let{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(a),g=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),b=Math.min(this.size-this.buffer,g+Math.ceil(u)),C=v+2*this.buffer,T=b+2*this.buffer,I=Math.max(C*T,0),D=new Uint8ClampedArray(I),P={data:D,width:C,height:T,glyphWidth:v,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(v===0||b===0)return P;let{ctx:R,buffer:z,gridInner:H,gridOuter:$}=this;this.lang&&(R.lang=this.lang),R.clearRect(z,z,v,b),R.fillText(a,z,z+g);let Z=R.getImageData(z,z,v,b);$.fill(E0,0,I),H.fill(0,0,I);for(let Y=0;Y<b;Y++)for(let te=0;te<v;te++){let he=Z.data[4*(Y*v+te)+3]/255;if(he===0)continue;let ae=(Y+z)*C+te+z;if(he===1)$[ae]=0,H[ae]=E0;else{let me=.5-he;$[ae]=me>0?me*me:0,H[ae]=me<0?me*me:0}}mk($,0,0,C,T,C,this.f,this.v,this.z),mk(H,z,z,v,b,C,this.f,this.v,this.z);for(let Y=0;Y<I;Y++){let te=Math.sqrt($[Y])-Math.sqrt(H[Y]);D[Y]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};let tu=jp;function _k(a,e){return a+e[1]-e[0]}function _I(a,e,s,u,d=1){let m=[],g=a.imagePrimary,v=g.pixelRatio,b=g.paddedRect.w-2*tu,C=g.paddedRect.h-2*tu,T=(a.right-a.left)*d,I=(a.bottom-a.top)*d,D=g.stretchX||[[0,b]],P=g.stretchY||[[0,C]],R=D.reduce(_k,0),z=P.reduce(_k,0),H=b-R,$=C-z,Z=0,Y=R,te=0,he=z,ae=0,me=H,ye=0,we=$;if(g.content&&u){let Te=g.content;Z=f1(D,0,Te[0]),te=f1(P,0,Te[1]),Y=f1(D,Te[0],Te[2]),he=f1(P,Te[1],Te[3]),ae=Te[0]-Z,ye=Te[1]-te,me=Te[2]-Te[0]-Y,we=Te[3]-Te[1]-he}let je=(Te,qe,Ye,Ke)=>{let rt=m1(Te.stretch-Z,Y,T,a.left*d),st=g1(Te.fixed-ae,me,Te.stretch,R),et=m1(qe.stretch-te,he,I,a.top*d),tt=g1(qe.fixed-ye,we,qe.stretch,z),Ge=m1(Ye.stretch-Z,Y,T,a.left*d),$e=g1(Ye.fixed-ae,me,Ye.stretch,R),nt=m1(Ke.stretch-te,he,I,a.top*d),vt=g1(Ke.fixed-ye,we,Ke.stretch,z),ut=new it(rt,et),Gt=new it(Ge,et),Tt=new it(Ge,nt),Pt=new it(rt,nt),Nt=new it(st/v,tt/v),Tn=new it($e/v,vt/v),dt=e*Math.PI/180;if(dt){let _i=Math.sin(dt),ce=Math.cos(dt),pe=[ce,-_i,_i,ce];ut._matMult(pe),Gt._matMult(pe),Pt._matMult(pe),Tt._matMult(pe)}let zt=Te.stretch+Te.fixed,un=Ye.stretch+Ye.fixed,Ln=qe.stretch+qe.fixed,zn=Ke.stretch+Ke.fixed,_n=a.imageSecondary;return{tl:ut,tr:Gt,bl:Pt,br:Tt,texPrimary:{x:g.paddedRect.x+tu+zt,y:g.paddedRect.y+tu+Ln,w:un-zt,h:zn-Ln},texSecondary:_n?{x:_n.paddedRect.x+tu+zt,y:_n.paddedRect.y+tu+Ln,w:un-zt,h:zn-Ln}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nt,pixelOffsetBR:Tn,minFontScaleX:me/v/T,minFontScaleY:we/v/I,isSDF:s}};if(u&&(g.stretchX||g.stretchY)){let Te=vk(D,H,R),qe=vk(P,$,z);for(let Ye=0;Ye<Te.length-1;Ye++){let Ke=Te[Ye],rt=Te[Ye+1];for(let st=0;st<qe.length-1;st++)m.push(je(Ke,qe[st],rt,qe[st+1]))}}else m.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return m}function u6(a,e){let s=a.stretchY||[[0,a.paddedRect.h-2*tu]];return e&&(a.stretchX||a.stretchY)?yk(a.stretchX||[[0,a.paddedRect.w-2*tu]])*yk(s):1}function f1(a,e,s){let u=0;for(let d of a)u+=Math.max(e,Math.min(s,d[1]))-Math.max(e,Math.min(s,d[0]));return u}function vk(a,e,s){let u=[{fixed:-tu,stretch:0}];for(let[d,m]of a){let g=u[u.length-1];u.push({fixed:d-g.stretch,stretch:g.stretch}),u.push({fixed:d-g.stretch,stretch:g.stretch+(m-d)})}return u.push({fixed:e+tu,stretch:s}),u}function yk(a){return 2*a.length+1}function m1(a,e,s,u){return a/e*s+u}function g1(a,e,s,u){return a-e*s/u}function d6(a,e,s,u){let d=e+a.positionedLines[u].lineOffset;return u===0?s+d/2:s+(d+(e+a.positionedLines[u-1].lineOffset))/2}function h6(a,e=1,s=!1){let u=1/0,d=1/0,m=-1/0,g=-1/0,v=a[0];for(let P=0;P<v.length;P++){let R=v[P];(!P||R.x<u)&&(u=R.x),(!P||R.y<d)&&(d=R.y),(!P||R.x>m)&&(m=R.x),(!P||R.y>g)&&(g=R.y)}let b=Math.min(m-u,g-d),C=b/2,T=new om([],p6);if(b===0)return new it(u,d);for(let P=u;P<m;P+=b)for(let R=d;R<g;R+=b)T.push(new gg(P+C,R+C,C,a));let I=(function(P){let R=0,z=0,H=0,$=P[0];for(let Z=0,Y=$.length,te=Y-1;Z<Y;te=Z++){let he=$[Z],ae=$[te],me=he.x*ae.y-ae.x*he.y;z+=(he.x+ae.x)*me,H+=(he.y+ae.y)*me,R+=3*me}return new gg(z/R,H/R,0,P)})(a),D=T.length;for(;T.length;){let P=T.pop();(P.d>I.d||!I.d)&&(I=P,s&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-I.d<=e||(C=P.h/2,T.push(new gg(P.p.x-C,P.p.y-C,C,a)),T.push(new gg(P.p.x+C,P.p.y-C,C,a)),T.push(new gg(P.p.x-C,P.p.y+C,C,a)),T.push(new gg(P.p.x+C,P.p.y+C,C,a)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function p6(a,e){return e.max-a.max}class gg{constructor(e,s,u,d){this.p=new it(e,s),this.h=u,this.d=(function(m,g){let v=!1,b=1/0;for(let C=0;C<g.length;C++){let T=g[C];for(let I=0,D=T.length,P=D-1;I<D;P=I++){let R=T[I],z=T[P];R.y>m.y!=z.y>m.y&&m.x<(z.x-R.x)*(m.y-R.y)/(z.y-R.y)+R.x&&(v=!v),b=Math.min(b,br(m,R,z))}}return(v?1:-1)*Math.sqrt(b)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}let f6=Object.keys,vI=Number.POSITIVE_INFINITY,m6=Math.sqrt(2);function uh(a,e,s,u,d){let m=hI(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],g={top:a.top-m[1],bottom:a.bottom+m[3],left:a.left-m[0],right:a.right+m[2],scaled:!1};return u!==void 0&&(function(v,b){v.top*=b,v.bottom*=b,v.left*=b,v.right*=b,v.scaled=!0})(g,u),s&&(function(v,b){if(!b)return;let C=Zn(b),T=new it(v.left,v.top),I=new it(v.right,v.top),D=new it(v.left,v.bottom),P=new it(v.right,v.bottom),R=new it(0,0);T._rotateAround(C,R),I._rotateAround(C,R),D._rotateAround(C,R),P._rotateAround(C,R),v.left=Math.min(T.x,I.x,D.x,P.x),v.right=Math.max(T.x,I.x,D.x,P.x),v.top=Math.min(T.y,I.y,D.y,P.y),v.bottom=Math.max(T.y,I.y,D.y,P.y)})(g,s),d&&(g.left+=d[0],g.right+=d[0],g.top+=d[1],g.bottom+=d[1]),e?{top:Math.min(e.top,g.top),bottom:Math.max(e.bottom,g.bottom),left:Math.min(e.left,g.left),right:Math.max(e.right,g.right),scaled:e.scaled||g.scaled}:g}function xk(a,[e,s]){let u=0,d=0;if(s===vI){e<0&&(e=0);let m=e/m6;switch(a){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(a){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),a){case"top-right":case"top-left":case"top":d=s-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-s}switch(a){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,d]}function g6(a,e,s,u,d,m,g,v,b,C,T,I,D,P){let R=a.layers[0],z=R.appearances;if(z.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};let H={iconBBox:null,iconVerticalBBox:null},$={textBBox:null,textVerticalBBox:null},{baseIconRotate:Z,baseTextRotate:Y,iconScaleFactor:te}=(function(ae,me,ye){let we=ae.get("icon-rotate").evaluate(me,{},ye),je=ae.get("text-rotate").evaluate(me,{},ye),[Te,qe]=ae.get("icon-size-scale-range");return{baseIconRotate:we,baseTextRotate:je,iconScaleFactor:G(1,Te,qe)}})(u,d,m);e&&(H.iconBBox=uh(e,H.iconBBox,Z,g),s)&&(H.iconVerticalBBox=uh(s,H.iconVerticalBBox,Z+90,g));let he=v1(I.horizontal);he&&($.textBBox=uh(he,$.textBBox,Y,1,P)),I.vertical&&($.textVerticalBBox=uh(I.vertical,$.textVerticalBBox,Y+90,1,P));for(let ae of z)ae.hasIconProperties()&&_6(H,a,R,ae,d,m,v,Z,g,b,e,C,te,T),ae.hasTextProperties()&&v6($,R,ae,d,m,P,Y,D,he,I.vertical);return{iconBBox:H.iconBBox,iconVerticalBBox:H.iconVerticalBBox,textBBox:$.textBBox,textVerticalBBox:$.textVerticalBBox}}function _6(a,e,s,u,d,m,g,v,b,C,T,I,D,P){let{appearanceIconOffset:R,appearanceIconRotate:z,appearanceIconSize:H}=(function(te,he,ae,me,ye,we,je,Te){let qe=te.hasProperty("icon-offset")?he.getAppearanceValueAndResolveTokens(te,"icon-offset",ae,me,[]):null,Ye=qe&&Array.isArray(qe)?qe:ye,Ke=te.hasProperty("icon-rotate")?he.getAppearanceValueAndResolveTokens(te,"icon-rotate",ae,me,[]):null,rt=typeof Ke=="number"?Ke:we,st=te.hasProperty("icon-size")?he.getAppearanceValueAndResolveTokens(te,"icon-size",ae,me,[]):null;return{appearanceIconOffset:Ye,appearanceIconRotate:rt,appearanceIconSize:typeof st=="number"?st*Te.iconScaleFactor:je}})(u,s,d,m,g,v,b,C),$=null,Z=null,Y=null;u.hasProperty("icon-image")?Y=(function(te,he,ae,me,ye,we,je){let Te=null,qe=he.getAppearanceValueAndResolveTokens(ae,"icon-image",me,ye,[]);if(qe){let Ye=te.getResolvedImageFromTokens(qe),Ke=ae.getUnevaluatedProperty("icon-size"),rt=S0(Ye,pg(te.zoom,Ke,te.worldview),Ke,ye,te.zoom,me,te.pixelRatio,je,te.worldview);Te=we.get(rt.iconPrimary.toString())}return Te})(e,s,u,d,m,I,D):T&&(Y=T.imagePrimary),Y&&($=p1(Y,null,R,P),e.allowVerticalPlacement&&(Z=p1(Y,null,R,P))),$&&(a.iconBBox=uh($,a.iconBBox,z,H)),Z&&(a.iconVerticalBBox=uh(Z,a.iconVerticalBBox,z+90,H))}function v6(a,e,s,u,d,m,g,v,b,C){let{appearanceTextOffset:T,appearanceTextRotate:I,appearanceTextSize:D}=(function(R,z,H,$,Z,Y,te){let he=R.hasProperty("text-offset")?z.getAppearanceValueAndResolveTokens(R,"text-offset",H,$,[]):null,ae=he&&Array.isArray(he)?[he[0]*ao,he[1]*ao]:Z,me=R.hasProperty("text-rotate")?z.getAppearanceValueAndResolveTokens(R,"text-rotate",H,$,[]):null,ye=typeof me=="number"?me:Y,we=R.hasProperty("text-size")?z.getAppearanceValueAndResolveTokens(R,"text-size",H,$,[]):null;return{appearanceTextOffset:ae,appearanceTextRotate:ye,appearanceTextSize:typeof we=="number"?we:te}})(s,e,u,d,m,g,v),P=D/v;b&&(a.textBBox=uh(b,a.textBBox,I,P,T)),C&&(a.textVerticalBBox=uh(C,a.textVerticalBBox,I+90,P,T))}function _1(a,e,s,u,d,m,g,v,b){if(!e||!e.usvg)return;let C=ak(u),T=ak(d),I=m!=="both"&&m!=="width"||!ok(u)?1:T.width/C.width,D=m!=="both"&&m!=="height"||!sk(u)?1:T.height/C.height;s.scaleSelf(I,D);let P=s.toString();g.set(P,s),v.set(P,e);let{imagePosition:R}=mI(P,e,jp);b.set(P,R)}function bk(a,e,s,u,d,m,g,v,b){if(!a)return;let C=(function(T,I,D,P,R,z){if(T.kind==="camera")return T.maxSize;if(T.kind==="composite"){let H=I.possiblyEvaluate(new Ni(T.maxZoom,{worldview:z}),D).evaluate(R,{},D),$=I.possiblyEvaluate(new Ni(T.minZoom,{worldview:z}),D).evaluate(R,{},D);return Math.max(H,$)}return I.possiblyEvaluate(new Ni(P,{worldview:z})).evaluate(R,{},D)})(e,s,u,d,m,b);return a.scaleSelf(C*v*g)}function S0(a,e,s,u,d,m,g,v,b){return{iconPrimary:bk(a.getPrimary(),e,s,u,d,m,g,v,b),iconSecondary:bk(a.getSecondary(),e,s,u,d,m,g,v,b)}}function y6(a,e,s){if(!e)return;let u=s.get(a.toString()),d=s.get(e.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||Dt(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),u.usvg!==d.usvg&&Dt(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function wk(a,e,s,u){if(!a)return;let d=e.get(s.toString());if(a.imagePrimary=d,u){let m=e.get(u.toString());a.imageSecondary=m}}function x6(a,e){for(let s in a.horizontal)Ck(a.horizontal[s],e);Ck(a.vertical,e)}function Ck(a,e){if(a){for(let s of a.positionedLines)for(let u of s.positionedGlyphs)if(u.image!==null){let d=u.image.toString();u.rect=e.get(d).paddedRect}}}function yI(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function b6(a,e,s,u,d,m,g,v,b){let C=v1(m.horizontal)||m.vertical,T=s.get("icon-text-fit-padding").evaluate(u,{},d),I,D=e;return e&&b!=="none"&&(a.allowVerticalPlacement&&m.vertical&&(I=pI(e,m.vertical,b,T,v,g)),C&&(D=pI(e,C,b,T,v,g))),{defaultShapedIcon:D,verticallyShapedIcon:I}}function w6(a,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z,Y,te,he,ae,me){let ye=g.textMaxSize.evaluate(e,{},D);ye===void 0?ye=v*g.textScaleFactor:ye*=g.textScaleFactor;let we=a.layers[0].layout,je=ao,Te=v*g.textScaleFactor/je,qe=v1(s.horizontal)||s.vertical;if(H!=="none"&&a.appearanceFeatureData&&e.index<a.appearanceFeatureData.length){let Tt=a.appearanceFeatureData[e.index];Tt&&(Tt.textShaping=qe,Tt.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(e,{},D),Tt.fontScale=Te)}let Ye=P.name==="globe",Ke=a.tilePixelRatio*ye/je,rt=(nt=a.overscaling,a.zoom>18&&nt>2&&(nt>>=1),Math.max(_t/(512*nt),1)*we.get("symbol-spacing")),st=we.get("text-padding")*a.tilePixelRatio,et=we.get("icon-padding")*a.tilePixelRatio,tt=Zn(we.get("text-max-angle")),Ge=we.get("icon-rotation-alignment")==="map"&&Y!=="point",$e=rt/2;var nt;a.hasAnyIconTextFit===!1&&H!=="none"&&(a.hasAnyIconTextFit=!0);let vt=e.properties?+e.properties[He]:null,ut=vt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(vt):65535,Gt=(Tt,Pt,Nt)=>{if(Pt.x<0||Pt.x>=_t||Pt.y<0||Pt.y>=_t)return;let Tn=null;if(Ye){let{x:dt,y:zt,z:un}=P.projectTilePoint(Pt.x,Pt.y,Nt);Tn={anchor:new ld(dt,zt,un,0,void 0),up:P.upVector(Nt,Pt.x,Pt.y)}}(function(dt,zt,un,Ln,zn,_n,_i,ce,pe,We,ot,Ct,Et,qt,Xt,mn,Cn,Sn,On,rn,cn,$n,Yn,Kn,di,Ti,vi,ei,oi,En,Nn,Qi,tn){let Rn=dt.addToLineVertexArray(zt,Ln),xi,Di,zi,Ir,Ri,nn,nr,hi=0,Wi=0,Xr=0,lo=0,Nr=-1,zr=-1,to={},Ss=Wf(""),ki=un?un.anchor:zt,wr=ei!=="none",Mr=0,Fs=0;if(pe._unevaluatedLayout.getValue("text-radial-offset")===void 0){let Mo=pe.layout.get("text-offset").evaluate(cn,{},di);Mr=Mo[0]*ao,Fs=Mo[1]*ao}else Mr=pe.layout.get("text-radial-offset").evaluate(cn,{},di)*ao,Fs=vI;if(dt.allowVerticalPlacement&&zn.vertical){let Mo=zn.vertical;if(Xt)nn=xI(Mo),ce&&(nr=xI(ce));else{let ds=pe.layout.get("text-rotate").evaluate(cn,{},di)+90;zi=y1(We,ki,zt,ot,Ct,Et,Mo,qt,ds,mn,Qi),ce&&(Ir=y1(We,ki,zt,ot,Ct,Et,ce,Sn,ds,null,Nn))}}if(_n){let Mo=dt.iconSizeData,ds=pe.layout.get("icon-rotate").evaluate(cn,{},di),Qs=_I(_n,ds,Yn,wr,$n.iconScaleFactor),ph=ce?_I(ce,ds,Yn,wr,$n.iconScaleFactor):void 0;Di=y1(We,ki,zt,ot,Ct,Et,_n,Sn,ds,null,En);let Cg=(function(hc,$0,jF,k8,$F,HF,F8,L8){let GF=hc.layers[0],qF=GF.appearances,Eg=$0.length;if(jF&&(Eg=Math.max(Eg,jF.length)),qF.length===0)return Eg;let[N8,z8]=k8.get("icon-size-scale-range"),B8=G(1,N8,z8);for(let WF of qF){let ZF=WF.getUnevaluatedProperties();if(ZF._values["icon-image"].value!==void 0){let XF=GF.getAppearanceValueAndResolveTokens(WF,"icon-image",$F,HF,[]);if(XF){let YF=hc.getResolvedImageFromTokens(XF);if(YF){let KF=ZF._values["icon-size"],V8=S0(YF,pg(hc.zoom,KF,hc.worldview),KF,HF,hc.zoom,$F,hc.pixelRatio,B8,hc.worldview),U8=F8.get(V8.iconPrimary.toString());Eg=Math.max(Eg,u6(U8,L8))}}}}return Eg})(dt,Qs,ph,pe.layout,cn,di,dt.iconAtlasPositions,wr);hi=4*Cg;let dc=null;Mo.kind==="source"?(dc=[ac*pe.layout.get("icon-size").evaluate(cn,{},di)*$n.iconScaleFactor],dc[0]>cd&&Dt(`${dt.layerIds[0]}: Value for "icon-size" is >= ${T0}. Reduce your "icon-size".`)):Mo.kind==="composite"&&(dc=[ac*$n.compositeIconSizes[0].evaluate(cn,{},di)*$n.iconScaleFactor,ac*$n.compositeIconSizes[1].evaluate(cn,{},di)*$n.iconScaleFactor],(dc[0]>cd||dc[1]>cd)&&Dt(`${dt.layerIds[0]}: Value for "icon-size" is >= ${T0}. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,Qs,dc,rn,On,cn,void 0,un,zt,Rn.lineStartIndex,Rn.lineLength,-1,Kn,di,Ti,vi,dt.symbolInstances.length,Cg),Nr=dt.icon.placedSymbolArray.length-1,ph&&(Wi=4*Cg,dt.addSymbols(dt.icon,ph,dc,rn,On,cn,Ks.vertical,un,zt,Rn.lineStartIndex,Rn.lineLength,-1,Kn,di,Ti,vi,dt.symbolInstances.length,Cg),zr=dt.icon.placedSymbolArray.length-1)}for(let Mo in zn.horizontal){let ds=Mo,Qs=zn.horizontal[ds];xi||(Ss=Wf(Qs.text),Xt?Ri=xI(Qs):xi=y1(We,ki,zt,ot,Ct,Et,Qs,qt,pe.layout.get("text-rotate").evaluate(cn,{},di),mn,Qi));let ph=Qs.positionedLines.length===1;if(Xr+=Ek(dt,un,zt,Qs,_i,pe,Xt,cn,mn,Rn,zn.vertical?Ks.horizontal:Ks.horizontalOnly,ph?f6(zn.horizontal):[ds],to,Nr,$n,Kn,di,dt.symbolInstances.length,Ti),ph)break}zn.vertical&&(lo+=Ek(dt,un,zt,zn.vertical,_i,pe,Xt,cn,mn,Rn,Ks.vertical,["vertical"],to,zr,$n,Kn,di,dt.symbolInstances.length,Ti));let Yr=-1,bl=(Mo,ds)=>Mo?Math.max(Mo,ds):ds;Yr=bl(Ri,Yr),Yr=bl(nn,Yr),Yr=bl(nr,Yr);let nu=Yr>-1?1:0;dt.glyphOffsetArray.length>=65535&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,cn.sortKey),dt.symbolInstances.emplaceBack(zt.x,zt.y,ki.x,ki.y,ki.z,to.right>=0?to.right:-1,to.center>=0?to.center:-1,to.left>=0?to.left:-1,to.vertical>=0?to.vertical:-1,Nr,zr,Ss,xi!==void 0?xi:dt.collisionBoxArray.length,xi!==void 0?xi+1:dt.collisionBoxArray.length,zi!==void 0?zi:dt.collisionBoxArray.length,zi!==void 0?zi+1:dt.collisionBoxArray.length,Di!==void 0?Di:dt.collisionBoxArray.length,Di!==void 0?Di+1:dt.collisionBoxArray.length,Ir||dt.collisionBoxArray.length,Ir?Ir+1:dt.collisionBoxArray.length,ot,Xr,lo,hi,Wi,nu,0,Mr,Fs,Yr,0,wr?1:0,oi)})(a,Pt,Tn,Tt,s,u,m,d,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,st,Z,C,0,et,Ge,$,e,g,T,I,D,R,z,H,ut,te,he,ae)};if(Y==="line")for(let Tt of Jb(e.geometry,0,0,_t,_t)){let Pt=c6(Tt,rt,tt,s.vertical||qe,u,je,Ke,a.overscaling,_t);for(let Nt of Pt)qe&&C6(a,qe.text,$e,Nt)||Gt(Tt,Nt,D)}else if(Y==="line-center"){for(let Tt of e.geometry)if(Tt.length>1){let Pt=l6(Tt,tt,s.vertical||qe,u,je,Ke);Pt&&Gt(Tt,Pt,D)}}else if(e.type==="Polygon")for(let Tt of l0(e.geometry,0)){let Pt=h6(Tt,16);Gt(Tt[0],new ld(Pt.x,Pt.y,0,0,void 0),D)}else if(e.type==="LineString")for(let Tt of e.geometry)Gt(Tt,new ld(Tt[0].x,Tt[0].y,0,0,void 0),D);else if(e.type==="Point")for(let Tt of e.geometry)for(let Pt of Tt)Gt([Pt],new ld(Pt.x,Pt.y,0,0,void 0),D)}let T0=255,cd=T0*ac;function Ek(a,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z){let Y=(function(ae,me,ye,we,je,Te,qe,Ye){let Ke=[];if(me.positionedLines.length===0)return Ke;let rt=we.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,st=(function(nt){let vt=nt[0],ut=nt[1],Gt=vt*ut;return Gt>0?[vt,-ut]:Gt<0?[-vt,ut]:vt===0?[ut,vt]:[ut,-vt]})(ye),et=Math.abs(me.top-me.bottom);for(let nt of me.positionedLines)et-=nt.lineOffset;let tt=me.positionedLines.length,Ge=et/tt,$e=me.top-ye[1];for(let nt=0;nt<tt;++nt){let vt=me.positionedLines[nt];$e=d6(me,Ge,$e,nt);for(let ut of vt.positionedGlyphs){if(!ut.rect)continue;let Gt=ut.rect||{},Tt=JR+1,Pt=!0,Nt=1,Tn=0;if(ut.image){let Cn=qe.get(ut.image.toString());if(!Cn)continue;if(Cn.sdf){Dt("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,Nt=Cn.pixelRatio,Tt=jp/Nt}let dt=(je||Ye)&&ut.vertical,zt=ut.metrics.advance*ut.scale/2,un=ut.metrics,Ln=ut.rect;if(Ln===null)continue;Ye&&me.verticalizable&&(Tn=ut.image?zt-ut.metrics.width*ut.scale/2:0);let zn=je?[ut.x+zt,ut.y]:[0,0],_n=[0,0],_i=[0,0],ce=!1;je||(dt?(_i=[ut.x+zt+st[0],ut.y+st[1]-Tn],ce=!0):_n=[ut.x+zt+ye[0],ut.y+ye[1]-Tn]);let pe=Ln.w*ut.scale/(Nt*(ut.localGlyph?lc:1)),We=Ln.h*ut.scale/(Nt*(ut.localGlyph?lc:1)),ot,Ct,Et,qt;if(dt){let Cn=ut.y-$e,Sn=new it(-zt,zt-Cn),On=-Math.PI/2,rn=new it(..._i);ot=new it(-zt+_n[0],_n[1]),ot._rotateAround(On,Sn)._add(rn),ot.x+=-Cn+zt,ot.y-=(un.left-Tt)*ut.scale;let cn=ut.image?un.advance*ut.scale:ao*ut.scale,$n=String.fromCodePoint(ut.glyph);qj($n)?ot.x+=(1-Tt)*ut.scale:Wj($n)?ot.x+=cn-un.height*ut.scale+(-Tt-1)*ut.scale:ot.x+=ut.image||un.width+2*Tt===Ln.w&&un.height+2*Tt===Ln.h?(cn-We)/2:(cn-(un.height+2*Tt)*ut.scale)/2,Ct=new it(ot.x,ot.y-pe),Et=new it(ot.x+We,ot.y),qt=new it(ot.x+We,ot.y-pe)}else{let Cn=(un.left-Tt)*ut.scale-zt+_n[0],Sn=(-un.top-Tt)*ut.scale+_n[1],On=Cn+pe,rn=Sn+We;ot=new it(Cn,Sn),Ct=new it(On,Sn),Et=new it(Cn,rn),qt=new it(On,rn)}if(rt){let Cn;Cn=je?new it(0,0):ce?new it(st[0],st[1]):new it(ye[0],ye[1]),ot._rotateAround(rt,Cn),Ct._rotateAround(rt,Cn),Et._rotateAround(rt,Cn),qt._rotateAround(rt,Cn)}let Xt=new it(0,0),mn=new it(0,0);Ke.push({tl:ot,tr:Ct,bl:Et,br:qt,texPrimary:Gt,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:zn,sectionIndex:ut.sectionIndex,isSDF:Pt,pixelOffsetTL:Xt,pixelOffsetBR:mn,minFontScaleX:0,minFontScaleY:0})}}return Ke})(0,u,b,m,g,v,d,a.allowVerticalPlacement),te=a.textSizeData,he=null;te.kind==="source"?(he=[ac*m.layout.get("text-size").evaluate(v,{},H)*R.textScaleFactor],he[0]>cd&&Dt(`${a.layerIds[0]}: Value for "text-size" is >= ${T0}. Reduce your "text-size".`)):te.kind==="composite"&&(he=[ac*R.compositeTextSizes[0].evaluate(v,{},H)*R.textScaleFactor,ac*R.compositeTextSizes[1].evaluate(v,{},H)*R.textScaleFactor],(he[0]>cd||he[1]>cd)&&Dt(`${a.layerIds[0]}: Value for "text-size" is >= ${T0}. Reduce your "text-size".`)),a.addSymbols(a.text,Y,he,b,g,v,T,e,s,C.lineStartIndex,C.lineLength,P,z,H,Z,!1,$,Y.length);for(let ae of I)D[ae]=a.text.placedSymbolArray.length-1;return 4*Y.length}function v1(a){for(let e in a)return a[e];return null}function y1(a,e,s,u,d,m,g,v,b,C,T){let I,D,P,R;if(I=T?T.top:g.top,D=T?T.bottom:g.bottom,P=T?T.left:g.left,R=T?T.right:g.right,hI(g)&&g.collisionPadding){let z=g.collisionPadding;P-=z[0],I-=z[1],R+=z[2],D+=z[3]}if(b){let z=new it(P,I),H=new it(R,I),$=new it(P,D),Z=new it(R,D),Y=Zn(b),te=new it(0,0);C&&(te=new it(C[0],C[1])),z._rotateAround(Y,te),H._rotateAround(Y,te),$._rotateAround(Y,te),Z._rotateAround(Y,te),P=Math.min(z.x,H.x,$.x,Z.x),R=Math.max(z.x,H.x,$.x,Z.x),I=Math.min(z.y,H.y,$.y,Z.y),D=Math.max(z.y,H.y,$.y,Z.y)}return a.emplaceBack(e.x,e.y,e.z,s.x,s.y,P,I,R,D,v,u,d,m),a.length-1}function xI(a){hI(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);let e=a.bottom-a.top;return e>0?Math.max(10,e):null}function C6(a,e,s,u){let d=a.compareText;if(e in d){let m=d[e];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<s)return!0}else d[e]=[];return d[e].push(u),!1}function Sk(a,e){let s=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,d=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),m=Math.sin(s)*d/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01)),g=Math.sin(a._pitch)*m+d,v=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let b=Math.max(a.zoom-17,0);a.isOrthographic&&(b/=10),g*=1+b}return Math.min(1.01*g,v)}function I0(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};let s=Math.pow(2,-a.z),u=a.x*s,d=(a.x+1)*s,m=a.y*s,g=(a.y+1)*s,v=A(u),b=A(d),C=F(m),T=F(g),I=e.project(v,C),D=e.project(b,C),P=e.project(b,T),R=e.project(v,T),z=Math.min(I.x,D.x,P.x,R.x),H=Math.min(I.y,D.y,P.y,R.y),$=Math.max(I.x,D.x,P.x,R.x),Z=Math.max(I.y,D.y,P.y,R.y),Y=s/16;function te(ae,me,ye,we,je,Te){let qe=(ye+je)/2,Ye=(we+Te)/2,Ke=e.project(A(qe),F(Ye)),rt=Math.max(0,z-Ke.x,H-Ke.y,Ke.x-$,Ke.y-Z);z=Math.min(z,Ke.x),$=Math.max($,Ke.x),H=Math.min(H,Ke.y),Z=Math.max(Z,Ke.y),rt>Y&&(te(ae,Ke,ye,we,qe,Ye),te(Ke,me,qe,Ye,je,Te))}te(I,D,u,m,d,m),te(D,P,d,m,d,g),te(P,R,d,g,u,g),te(R,I,u,g,u,m),z-=Y,H-=Y,$+=Y,Z+=Y;let he=1/Math.max($-z,Z-H);return{scale:he,x:z*he,y:H*he,x2:$*he,y2:Z*he,projection:e}}function Tk(a,{x:e,y:s},u=0){return new it(((e-u)*a.scale-a.x)*_t,(s*a.scale-a.y)*_t)}let E6=gt(new Float32Array(16));class dh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new c(0,0)}projectTilePoint(e,s,u){return{x:e,y:s,z:0}}locationPoint(e,s,u,d=!0){return e._coordinatePoint(e.locationCoordinate(s,u),d)}pixelsPerMeter(e,s){return M(1,e)*s}pixelSpaceConversion(e,s,u){return 1}farthestPixelDistance(e){return Sk(e,e.pixelsPerMeter)}pointCoordinate(e,s,u,d){let m=e.horizonLineFromTop(!1),g=new it(s,Math.max(m,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,d))}pointCoordinate3D(e,s,u){let d=new it(s,u);if(e.elevation)return e.elevation.pointCoordinate(d);{let m=this.pointCoordinate(e,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,s){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,s.x,s.y);let u=e.horizonLineFromTop();return s.y<u}createInversionMatrix(e,s){return E6}createTileMatrix(e,s,u){let d,m,g,v=u.canonical,b=gt(new Float64Array(16));if(this.isReprojectedInTileSpace){let C=I0(v,this);d=1,m=C.x+u.wrap*C.scale,g=C.y,Hn(b,b,[d/C.scale,d/C.scale,e.pixelsPerMeter/s])}else d=s/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*u.wrap)*d,g=v.y*d;return Kt(b,b,[m,g,0]),Hn(b,b,[d/_t,d/_t,1]),b}upVector(e,s,u){return[0,0,1]}upVectorScale(e,s,u){return{metersToTile:1}}}class S6 extends dh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[s,u]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(Zn(s));this.n=(d+Math.sin(Zn(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,s){let{n:u,c:d,r0:m}=this,g=Zn(e-this.center[0]),v=Zn(s),b=Math.sqrt(d-2*u*Math.sin(v))/u;return{x:b*Math.sin(g*u),y:b*Math.cos(g*u)-m,z:0}}unproject(e,s){let{n:u,c:d,r0:m}=this,g=m+s,v=Math.atan2(e,Math.abs(g))*Math.sign(g);g*u<0&&(v-=Math.PI*Math.sign(e)*Math.sign(g));let b=Zn(this.center[0])*u;v=oe(v,-Math.PI-b,Math.PI-b);let C=G(Zo(v/u)+this.center[0],-180,180),T=Math.asin(G((d-(e*e+g*g)*u*u)/(2*u),-1,1)),I=G(Zo(T),-L,L);return new c(C,I)}}let M0=1.340264,D0=-.081106,A0=893e-6,P0=.003796,x1=Math.sqrt(3)/2;class T6 extends dh{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;let u=Math.asin(x1*Math.sin(s)),d=u*u,m=d*d*d;return{x:.5*(e*Math.cos(u)/(x1*(M0+3*D0*d+m*(7*A0+9*P0*d)))/Math.PI+.5),y:1-.5*(u*(M0+D0*d+m*(A0+P0*d))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=u*u,m=d*d*d;for(let T,I,D,P=0;P<12&&(I=u*(M0+D0*d+m*(A0+P0*d))-s,D=M0+3*D0*d+m*(7*A0+9*P0*d),T=I/D,u=G(u-T,-Math.PI/3,Math.PI/3),d=u*u,m=d*d*d,!(Math.abs(T)<1e-12));++P);let g=x1*e*(M0+3*D0*d+m*(7*A0+9*P0*d))/Math.cos(u),v=Math.asin(Math.sin(u)/x1),b=G(180*g/Math.PI,-180,180),C=G(180*v/Math.PI,-L,L);return new c(b,C)}}class I6 extends dh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){let u=360*(e-.5),d=G(360*(.5-s),-L,L);return new c(u,d)}}let _g=Math.PI/2;function b1(a){return Math.tan((_g+a)/2)}class M6 extends dh{constructor(e){super(e),this.center=e.center||[0,30];let[s,u]=this.parallels=e.parallels||[30,30],d=Zn(s),m=Zn(u);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);let g=Math.cos(d),v=b1(d);this.n=d===m?Math.sin(d):Math.log(g/Math.cos(m))/Math.log(b1(m)/v),this.f=g*Math.pow(b1(d),this.n)/this.n}project(e,s){s=Zn(s),this.southernCenter&&(s=-s),e=Zn(e-this.center[0]);let u=1e-6,{n:d,f:m}=this;m>0?s<-_g+u&&(s=-_g+u):s>_g-u&&(s=_g-u);let g=m/Math.pow(b1(s),d),v=g*Math.sin(d*e),b=m-g*Math.cos(d*e);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;let{n:u,f:d}=this,m=d-s,g=Math.sign(m),v=Math.sign(u)*Math.sqrt(e*e+m*m),b=Math.atan2(e,Math.abs(m))*g;m*u<0&&(b-=Math.PI*Math.sign(e)*g);let C=G(Zo(b/u)+this.center[0],-180,180),T=G(Zo(2*Math.atan(Math.pow(d/v,1/u))-_g),-L,L);return new c(C,this.southernCenter?-T:T)}}class Ik extends dh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:w(e),y:S(s),z:0}}unproject(e,s){let u=A(e),d=F(s);return new c(u,d)}}let Mk=Zn(L);class D6 extends dh{project(e,s){let u=(s=Zn(s))*s,d=u*u;return{x:.5*((e=Zn(e))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=25,m=0,g=u*u;do{g=u*u;let C=g*g;m=(u*(1.007226+g*(.015085+C*(.028874*g-.044475-.005916*C)))-s)/(1.007226+g*(.045255+C*(.259866*g-.311325-.005916*11*C))),u=G(u-m,-Mk,Mk)}while(Math.abs(m)>1e-6&&--d>0);g=u*u;let v=G(Zo(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=Zo(u);return new c(v,b)}}let Dk=Zn(L);class A6 extends dh{project(e,s){s=Zn(s),e=Zn(e);let u=Math.cos(s),d=2/Math.PI,m=Math.acos(u*Math.cos(e/2)),g=Math.sin(m)/m,v=.5*(e*d+2*u*Math.sin(e/2)/g)||0,b=.5*(s+Math.sin(s)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,s){let u=e=(2*e-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,m=25,g=1e-6,v=0,b=0;do{let C=Math.cos(d),T=Math.sin(d),I=2*T*C,D=T*T,P=C*C,R=Math.cos(u/2),z=Math.sin(u/2),H=2*R*z,$=z*z,Z=1-P*R*R,Y=Z?1/Z:0,te=Z?Math.acos(C*R)*Math.sqrt(1/Z):0,he=.5*(2*te*C*z+2*u/Math.PI)-e,ae=.5*(te*T+d)-s,me=.5*Y*(P*$+te*C*R*D)+1/Math.PI,ye=Y*(H*I/4-te*T*z),we=.125*Y*(I*z-te*T*P*H),je=.5*Y*(D*R+te*$*C)+.5,Te=ye*we-je*me;v=(ae*ye-he*je)/Te,b=(he*we-ae*me)/Te,u=G(u-v,-Math.PI,Math.PI),d=G(d-b,-Dk,Dk)}while((Math.abs(v)>g||Math.abs(b)>g)&&--m>0);return new c(Zo(u),Zo(d))}}class Ak extends dh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){let{scale:u,cosPhi:d}=this;return{x:Zn(e)*d*u+.5,y:-Math.sin(Zn(s))/d*u+.5,z:0}}unproject(e,s){let{scale:u,cosPhi:d}=this,m=-(s-.5)/u,g=G(Zo((e-.5)/u)/d,-180,180),v=Math.asin(G(m*d,-1,1)),b=G(Zo(v),-L,L);return new c(g,b)}}class P6 extends Ik{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,u){let d=n0(e,s,u);return Pr(d,d,Hb(Ha(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,s,u){let d=rh(s.lat,s.lng),m=ji([],d),g=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;$s(d,d,m,M(1,0)*_t*g);let v=gt(new Float64Array(16));return Ot(v,e.pixelMatrix,e.globeMatrix),Pr(d,d,v),new it(d[0],d[1])}pixelsPerMeter(e,s){return M(1,0)*s}pixelSpaceConversion(e,s,u){let d=M(1,e)*s,m=on(M(1,45)*s,d,u);return this.pixelsPerMeter(e,s)/m}createTileMatrix(e,s,u){let d=ST(Ha(u.canonical));return Ot(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,s){let{center:u}=e,d=Hb(Ha(s));return _r(d,d,Zn(u.lng)),Er(d,d,Zn(u.lat)),Hn(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,s,u,d){return sh(e,s,u,!0)||new J(0,0)}pointCoordinate3D(e,s,u){let d=this.pointCoordinate(e,s,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,s){return!sh(e,s.x,s.y,!1)}farthestPixelDistance(e){let s=(function(d,m){let g=d.cameraToCenterDistance,v=d._centerAltitude*m,b=d._camera,C=d._camera.forward(),T=jr([],ur([],C,-g),[0,0,v]),I=d.worldSize/(2*Math.PI),D=[0,0,-I],P=d.width/d.height,R=Math.tan(d.fovAboveCenter),z=ur([],b.up(),R),H=ur([],b.right(),R*P),$=ji([],jr([],jr([],C,z),H)),Z=[],Y;if(new Lt(T,$).closestPointOnSphere(D,I,Z)){let te=jr([],Z,D),he=kr([],te,T);Y=Math.cos(d.fovAboveCenter)*ho(he)}else{let te=kr([],T,D),he=kr([],D,T);ji(he,he);let ae=ho(te)-I;Y=Math.sqrt(ae*(ae+2*I));let me=Math.acos(Y/(I+ae))-Math.acos(Sr(C,he));Y*=Math.cos(me)}return 1.01*Y})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=ah(e.zoom);if(u>0){let d=Sk(e,M(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return on(s,d+m*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(e,s,u){return n0(s,u,e,1)}upVectorScale(e){return{metersToTile:yl($b(Ha(e)))}}}function Pk(a){let e=a.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new Ik(a);case"equirectangular":return new I6(a);case"naturalEarth":return new D6(a);case"equalEarth":return new T6(a);case"winkelTripel":return new A6(a);case"albers":return s?new Ak(a):new S6(a);case"lambertConformalConic":return s?new Ak(a):new M6(a);case"globe":return new P6(a)}throw new Error(`Invalid projection name: ${a.name}`)}let O6=Ce.types,R6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function O0(a,e,s,u,d,m,g,v,b,C,T,I,D){let P=v?Math.min(cd,Math.round(v[0])):0,R=v?Math.min(cd,Math.round(v[1])):0;a.emplaceBack(e,s,Math.round(32*u),Math.round(32*d),m,g,(P<<1)+(b?1:0),0+(R<<1),16*C,16*T,256*I,256*D)}function R0(a,e,s){a.emplaceBack(e,s)}function k0(a,e,s,u,d,m,g){a.emplaceBack(e,s,u,d,m,g)}let w1=(a,e,s,u)=>{for(let d=0;d<e;d++)a.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function vg(a,e,s,u,d){a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d)}function k6(a){for(let e of a.sections)if(cT(e.text))return!0;return!1}class bI{constructor(e){this.layoutVertexArray=new Bv,this.indexArray=new qr,this.programConfigurations=e,this.segments=new Ji,this.dynamicLayoutVertexArray=new Yc,this.opacityVertexArray=new Um,this.placedSymbolArray=new Lb,this.iconTransitioningVertexArray=new Zs,this.globeExtVertexArray=new Vv,this.zOffsetVertexArray=new Ql,this.orientationVertexArray=new $v,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,s){let u=[],d=this.layoutVertexArray.uint16;for(let m=0;m<s;++m){let g=12*(e+m);u.push(...d.slice(g,g+12))}return u}updateIconVertexData(e,s,u,d,m,g,v,b,C,T,I,D,P){let R=this.layoutVertexArray.uint16,z=12*e;R[z]=s,R[z+1]=u,R[z+2]=d,R[z+3]=m,R[z+4]=g,R[z+5]=v,R[z+6]=b,R[z+7]=C,R[z+8]=T,R[z+9]=I,R[z+10]=D,R[z+11]=P}upload(e,s,u,d,m,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lj.members,!!g),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,zj.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,R6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Uj.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Nj.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Bj.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Vj.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}kt(bI,"SymbolBuffers");class wI{constructor(e,s,u){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Ji,this.collisionVertexArray=new Uv,this.collisionVertexArrayExt=new Yc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,$j.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}kt(wI,"CollisionBuffers");class C1{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gt([]),this.placementViewportMatrix=gt([]);let s=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=pg(this.zoom,s["text-size"],this.worldview),this.iconSizeData=pg(this.zoom,s["icon-size"],this.worldview);let u=this.layers[0].layout,d=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.lut=e.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>Ks[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){let s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(e)!=null)}createArrays(){this.text=new bI(new ja(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new bI(new ja(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Xm,this.lineVertexArray=new zb,this.symbolInstances=new Zv}calculateGlyphDependencies(e,s,u,d,m){for(let g of e){let v=g.codePointAt(0);if(v===void 0)break;if(s[v]=!0,d&&m&&v<=65535){let b=b0[g];b&&(s[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,s,u,d,m,g){let v=1,b=e.getUnevaluatedProperties()._values["icon-size"],C=pg(this.zoom,b,this.worldview),T=fg(C,s);if(C.kind!=="constant"&&C.kind!=="camera"||(v=T.uSize),C.kind==="composite"){let{minZoom:I,maxZoom:D}=C,P=b.possiblyEvaluate(new Ni(I,{worldview:this.worldview}),d),R=b.possiblyEvaluate(new Ni(D,{worldview:this.worldview}),d),z=P.evaluate(u,{},d,m);v=z+(R.evaluate(u,{},d,m)-z)*T.uSizeT}return C.kind==="source"&&(v=b.possiblyEvaluate(new Ni(this.zoom,{worldview:this.worldview}),d).evaluate(u,{},d,m)),v*g}updateFootprints(e,s){}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Yb(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?ss.build(e):e}populate(e,s,u,d){let m=this.layers[0],g=m.layout,v=this.projection.name==="globe",b=g.get("text-font"),C=g.get("text-field"),T=g.get("icon-image"),[I,D]=g.get("icon-size-scale-range"),P=G(s.scaleFactor||1,I,D),R=(C.value.kind!=="constant"||C.value.value instanceof os&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),$=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!R&&!z&&!H)return;let Z=s.iconDependencies,Y=s.glyphDependencies,te=s.availableImages,he=new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),ae=me=>{let ye=me.id.toString();Z.has(ye)?Z.get(ye).push(me):Z.set(ye,[me])};for(let me of e){let{feature:ye,id:we,index:je,sourceLayerIndex:Te}=me,qe=m._featureFilter.needGeometry,Ye=Se(ye,qe);if(!m._featureFilter.filter(he,Ye,u))continue;if(qe||(Ye.geometry=_e(ye,u,d)),v&&ye.type!==1&&u.z<=5){let nt=Ye.geometry,vt=.98078528056,ut=(Gt,Tt)=>Sr(n0(Gt.x,Gt.y,u,1),n0(Tt.x,Tt.y,u,1))<vt;for(let Gt=0;Gt<nt.length;Gt++)nt[Gt]=de(nt[Gt],ut)}let Ke,rt;if(R){let nt=m.getValueAndResolveTokens("text-field",Ye,u,te),vt=os.factory(nt);k6(vt)&&(this.hasRTLText=!0),(!this.hasRTLText||Tp()==="unavailable"||this.hasRTLText&&Kl.isParsed())&&(Ke=Gj(vt,m,Ye))}if(z){let nt=m.getValueAndResolveTokens("icon-image",Ye,u,te);rt=this.getResolvedImageFromTokens(nt)}let st=this.layers[0],et=!1;if(!rt&&H){let nt=st.getAppearances();for(let vt of nt)if(vt.getProperty("icon-image")){let ut=st.getAppearanceValueAndResolveTokens(vt,"icon-image",Ye,u,te);if(ut){rt=this.getResolvedImageFromTokens(ut),et=!0;break}}}if(!Ke&&!rt)continue;let tt=this.sortFeaturesByKey?$.evaluate(Ye,{},u):void 0,Ge={id:we,text:Ke,icon:rt,index:je,sourceLayerIndex:Te,geometry:Ye.geometry,properties:ye.properties,type:O6[ye.type],sortKey:tt};if(this.features.push(Ge),this.featureToAppearanceIndex[je]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:we,properties:ye.properties,usesAppearanceIconAsPlaceholder:et,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),rt){let nt=st._unevaluatedLayout._values,{iconPrimary:vt,iconSecondary:ut}=S0(rt,this.iconSizeData,nt["icon-size"],u,this.zoom,Ge,this.pixelRatio,P,this.worldview);ae(vt),ut&&(this.hasAnySecondaryIcon=!0,ae(ut))}let $e=st.getAppearances();if($e.length!==0&&$e.forEach(nt=>{if(!nt.getProperty("icon-image"))return;let vt=this.getCombinedIconPrimary(nt,st,Ye,u,te,Ge,P);vt&&ae(vt)}),Ke){let nt=b.evaluate(Ye,{},u).join(","),vt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ks.vertical)>=0;for(let ut of Ke.sections)if(ut.image){let Gt=ut.image.getPrimary().scaleSelf(this.pixelRatio),Tt=Gt.id.toString(),Pt=Z.get(Tt)||[];Pt.push(Gt),Z.set(Tt,Pt)}else{let Gt=Ep(Ke.toString()),Tt=ut.fontStack||nt,Pt=Y[Tt]=Y[Tt]||{};this.calculateGlyphDependencies(ut.text,Pt,vt,this.allowVerticalPlacement,Gt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(me){let ye={},we={},je=[],Te=0;function qe(st){je.push(me[st]),Te++}function Ye(st,et,tt){let Ge=we[st];return delete we[st],we[et]=Ge,je[Ge].geometry[0].pop(),je[Ge].geometry[0]=je[Ge].geometry[0].concat(tt[0]),Ge}function Ke(st,et,tt){let Ge=ye[et];return delete ye[et],ye[st]=Ge,je[Ge].geometry[0].shift(),je[Ge].geometry[0]=tt[0].concat(je[Ge].geometry[0]),Ge}function rt(st,et,tt){let Ge=tt?et[0][et[0].length-1]:et[0][0];return`${st}:${Ge.x}:${Ge.y}`}for(let st=0;st<me.length;st++){let et=me[st],tt=et.geometry,Ge=et.text?et.text.toString():null;if(!Ge){qe(st);continue}let $e=rt(Ge,tt),nt=rt(Ge,tt,!0);if($e in we&&nt in ye&&we[$e]!==ye[nt]){let vt=Ke($e,nt,tt),ut=Ye($e,nt,je[vt].geometry);delete ye[$e],delete we[nt],we[rt(Ge,je[ut].geometry,!0)]=ut,je[vt].geometry=null}else $e in we?Ye($e,nt,tt):nt in ye?Ke($e,nt,tt):(qe(st),ye[$e]=Te-1,we[nt]=Te-1)}return je.filter(st=>st.geometry)})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(let me of s.elevationFeatures)this.elevationFeatureIdToIndex.set(me.id,this.elevationFeatures.length),this.elevationFeatures.push(me)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((me,ye)=>me.sortKey-ye.sortKey)}getCombinedIconPrimary(e,s,u,d,m,g,v){let b,C,T=e.getUnevaluatedProperties();if(T._values["icon-image"].value!==void 0){let I=s.getAppearanceValueAndResolveTokens(e,"icon-image",u,d,m);b=this.getResolvedImageFromTokens(I)}else{let I=s.getValueAndResolveTokens("icon-image",u,d,m);b=this.getResolvedImageFromTokens(I)}if(b){let I=T._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];C=S0(b,pg(this.zoom,I,this.worldview),I,d,this.zoom,g,this.pixelRatio,v,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(e,s,u,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;let m=this.layers[0],g=!1,v=0,b=m.layout,[C,T]=b.get("icon-size-scale-range"),I=G(1,C,T);for(let D=0;D<this.symbolInstances.length;D++){let P=this.symbolInstances.get(D),R=this.featureToAppearanceIndex[P.featureIndex],z=R!==void 0?this.appearanceFeatureData[R]:void 0;if(z&&P.placedIconSymbolIndex>=0){let H=z.id,$=s&&H!==void 0?s[String(H)]:void 0,Z={type:"Point",id:z.id,properties:z.properties,geometry:[]},Y=this.layers[0].appearances&&this.layers[0].appearances.find(te=>te.isActive({globals:d,feature:Z,canonical:e,featureState:$}));if(z.activeAppearance===Y){v+=P.numIconVertices;continue}if(Y){z.activeAppearance=Y;let te=this.getCombinedIconPrimary(Y,m,Z,e,u,{sortKey:void 0,text:void 0,icon:null,index:P.featureIndex,sourceLayerIndex:P.featureIndex,geometry:[],properties:z.properties,type:"Point",id:z.id},I);if(!te)continue;let he=te.toString(),ae=this.iconAtlasPositions&&this.iconAtlasPositions.get(he);if(ae){let me=m.getAppearanceValueAndResolveTokens(Y,"icon-offset",Z,e,u),ye=me&&Array.isArray(me)?me:[0,0],we=p1(ae,void 0,ye,m.layout.get("icon-anchor").evaluate(Z,{},e)),je=m.getAppearanceValueAndResolveTokens(Y,"icon-rotate",Z,e,u),Te=typeof je=="number"?je:0,qe=ae.sdf,Ye=m.layout.get("icon-text-fit").constantOr("none");Ye!=="none"&&z.textShaping&&z.iconTextFitPadding&&z.fontScale&&(we=pI(we,z.textShaping,Ye,z.iconTextFitPadding,ye,z.fontScale));let Ke=this.calculateEffectiveAppearanceIconSize(Y,d.zoom,Z,e,u,I),rt=0,st=1+(Math.min(cd,Math.round(Ke*ac))<<1),et=_I(we,Te,qe,Ye!=="none",I);z.isUsingAppearanceVertexData||(z.isUsingAppearanceVertexData=!0,z.layoutBasedVertexData=this.icon.getIconVertexData(v,P.numIconVertices));for(let Ge=0;Ge<et.length;++Ge){let $e=et[Ge],nt=z.layoutBasedVertexData[0]||P.tileAnchorX,vt=z.layoutBasedVertexData[1]||P.tileAnchorY,ut=16*$e.pixelOffsetTL.x,Gt=16*$e.pixelOffsetTL.y,Tt=16*$e.pixelOffsetBR.x,Pt=16*$e.pixelOffsetBR.y,Nt=16*$e.minFontScaleX,Tn=16*$e.minFontScaleY;this.icon.updateIconVertexData(v,nt,vt,Math.round(32*$e.tl.x),Math.round(32*$e.tl.y),$e.texPrimary.x,$e.texPrimary.y,rt,st,ut,Gt,Nt,Tn),this.icon.updateIconVertexData(v+1,nt,vt,Math.round(32*$e.tr.x),Math.round(32*$e.tr.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y,rt,st,Tt,Gt,Nt,Tn),this.icon.updateIconVertexData(v+2,nt,vt,Math.round(32*$e.bl.x),Math.round(32*$e.bl.y),$e.texPrimary.x,$e.texPrimary.y+$e.texPrimary.h,rt,st,ut,Pt,Nt,Tn),this.icon.updateIconVertexData(v+3,nt,vt,Math.round(32*$e.br.x),Math.round(32*$e.br.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y+$e.texPrimary.h,rt,st,Tt,Pt,Nt,Tn),v+=4}let tt=P.numIconVertices-4*et.length;for(let Ge=0;Ge<tt;++Ge)this.icon.updateIconVertexData(v+Ge,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else v+=P.numIconVertices}else if(z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),v+=P.numIconVertices,z.activeAppearance=null;else if(z.isUsingAppearanceVertexData){let he=z.layoutBasedVertexData.length/12;for(let ae=0;ae<he;++ae){let me=ae*12;this.icon.updateIconVertexData(v+ae,z.layoutBasedVertexData[me+0],z.layoutBasedVertexData[me+1],z.layoutBasedVertexData[me+2],z.layoutBasedVertexData[me+3],z.layoutBasedVertexData[me+4],z.layoutBasedVertexData[me+5],z.layoutBasedVertexData[me+6],z.layoutBasedVertexData[me+7],z.layoutBasedVertexData[me+8],z.layoutBasedVertexData[me+9],z.layoutBasedVertexData[me+10],z.layoutBasedVertexData[me+11])}v+=he,z.isUsingAppearanceVertexData=!1,z.activeAppearance=null,g=!0}else v+=P.numIconVertices,z.activeAppearance=null}}return g}update(e,s,u,d,m,g,v){this.text.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1,u=q(e),d=1/u,m=!1,g=!1;for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v),C=vr(1,0,0),T=vr(0,1,0),{numHorizontalGlyphVertices:I,numVerticalGlyphVertices:D,numIconVertices:P,numVerticalIconVertices:R}=b,z=I>0||D>0,H=P>0,$=this.elevationFeatures[b.elevationFeatureIndex];if($){let Z=new it(b.tileAnchorX,b.tileAnchorY),Y=.075+$.pointElevation(Z);b.zOffset!==Y&&(s=!0,b.zOffset=Y),Y!==0&&(this.hasAnyZOffset=!0);let te=$.computeSlopeNormal(Z,d),he=Rd(Bl(),vr(0,0,1),te);Pc(C,C,he),Pc(T,T,he),C[2]*=u,T[2]*=u,C[0]===1&&C[1]===0&&C[2]===0&&T[0]===0&&T[1]===1&&T[2]===0||(m=m||z,g=g||H)}if(z&&(w1(this.text.orientationVertexArray,I,C,T),w1(this.text.orientationVertexArray,D,C,T)),H){let{placedIconSymbolIndex:Z,verticalPlacedIconSymbolIndex:Y}=b;Z>=0&&w1(this.icon.orientationVertexArray,P,C,T),Y>=0&&w1(this.icon.orientationVertexArray,R,C,T)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let e=(m,g,v)=>{u+=g,u>m.length&&m.resize(u);for(let b=-g;b<0;b++)m.emplace(b+u,v)},s=(m,g,v)=>{d+=g,d>m.length&&m.resize(d);for(let b=-g;b<0;b++)m.emplace(b+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let m=0;m<this.symbolInstances.length;m++){let g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:C}=g,T=g.zOffset,I=C>0;if((v>0||b>0)&&(e(this.text.zOffsetVertexArray,v,T),e(this.text.zOffsetVertexArray,b,T)),I){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:P}=g;D>=0&&s(this.icon.zOffsetVertexArray,C,T),P>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,s,u,d,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,s,u,d){return!!(e&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,s,u,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Pk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){let u=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:d,y:m}of s)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,s,u,d,m,g,v,b,C,T,I,D,P,R,z,H,$,Z){let Y=e.indexArray,te=e.layoutVertexArray,he=e.globeExtVertexArray,ae=e.segments.prepareSegment(4*Z,te,Y,this.canOverlap?g.sortKey:void 0),me=this.glyphOffsetArray.length,ye=ae.vertexLength,we=this.allowVerticalPlacement&&v===Ks.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let Ye=0;Ye<s.length;Ye++){let{tl:Ke,tr:rt,bl:st,br:et,texPrimary:tt,texSecondary:Ge,pixelOffsetTL:$e,pixelOffsetBR:nt,minFontScaleX:vt,minFontScaleY:ut,glyphOffset:Gt,isSDF:Tt,sectionIndex:Pt}=s[Ye],Nt=ae.vertexLength,Tn=Gt[1];if(O0(te,C.x,C.y,Ke.x,Tn+Ke.y,tt.x,tt.y,u,Tt,$e.x,$e.y,vt,ut),O0(te,C.x,C.y,rt.x,Tn+rt.y,tt.x+tt.w,tt.y,u,Tt,nt.x,$e.y,vt,ut),O0(te,C.x,C.y,st.x,Tn+st.y,tt.x,tt.y+tt.h,u,Tt,$e.x,nt.y,vt,ut),O0(te,C.x,C.y,et.x,Tn+et.y,tt.x+tt.w,tt.y+tt.h,u,Tt,nt.x,nt.y,vt,ut),b){let{x:dt,y:zt,z:un}=b.anchor,[Ln,zn,_n]=b.up;k0(he,dt,zt,un,Ln,zn,_n),k0(he,dt,zt,un,Ln,zn,_n),k0(he,dt,zt,un,Ln,zn,_n),k0(he,dt,zt,un,Ln,zn,_n),vg(e.dynamicLayoutVertexArray,dt,zt,un,we)}else vg(e.dynamicLayoutVertexArray,C.x,C.y,C.z,we);if(H){let dt=Ge||tt;R0(e.iconTransitioningVertexArray,dt.x,dt.y),R0(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y),R0(e.iconTransitioningVertexArray,dt.x,dt.y+dt.h),R0(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y+dt.h)}Y.emplaceBack(Nt,Nt+1,Nt+2),Y.emplaceBack(Nt+1,Nt+2,Nt+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),Ye!==s.length-1&&Pt===s[Ye+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,g,g.index,{},P,R,z,je&&je[Pt],this.worldview)}let Te=Z-s.length;Te!==0&&this._addNullVertices(Te,te,u,b,he,e,H,ae,Y);let qe=b?b.anchor:C;e.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,C.x,C.y,me,this.glyphOffsetArray.length-me,ye,T,I,C.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],v,0,0,0,D,0),e.symbolInstanceIndices.push($)}_addNullVertices(e,s,u,d,m,g,v,b,C){for(let T=0;T<e;T++){for(let D=0;D<4;D++)O0(s,0,0,0,0,0,0,u,!1,0,0,0,0),d&&k0(m,0,0,0,0,0,0),vg(g.dynamicLayoutVertexArray,0,0,0,0),v&&R0(g.iconTransitioningVertexArray,0,0);let I=b.vertexLength;C.emplaceBack(I,I+1,I+2),C.emplaceBack(I+1,I+2,I+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,s,u,d,m,g,v){e.emplaceBack(s,u,d,m,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,s,u,d,m,g,v){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=b.vertexLength,T=v.tileAnchorX,I=v.tileAnchorY;for(let P=0;P<4;P++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,e.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,T,I,new it(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,T,I,new it(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,T,I,new it(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,T,I,new it(e.x1,e.y2)),b.vertexLength+=4;let D=u.indexArray;D.emplaceBack(C,C+1),D.emplaceBack(C+1,C+2),D.emplaceBack(C+2,C+3),D.emplaceBack(C+3,C),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,u,d,m,g){for(let v=d;v<m;v++){let b=u.get(v),C=this.getSymbolInstanceTextSize(e,g,s,v);this._addCollisionDebugVertices(b,C,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,s,u,d,m,g){for(let v=d;v<m;v++){let b=u.get(v),C=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,C,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wI($m,XR.members,Zs),this.iconCollisionBox=new wI($m,XR.members,Zs);let d=fg(this.iconSizeData,e),m=fg(this.textSizeData,e,u);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,e,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,s,u,d){let m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),g=fI(this.textSizeData,e,m)/ao;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,s,u){let d=this.icon.placedSymbolArray.get(u),m=fI(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,s,u,d){e.emplaceBack(s,-u,-u,d),e.emplaceBack(s,u,-u,d),e.emplaceBack(s,u,u,d),e.emplaceBack(s,-u,u,d)}_updateTextDebugCollisionBoxes(e,s,u,d,m,g,v){for(let b=d;b<m;b++){let C=u.get(b),T=this.getSymbolInstanceTextSize(e,g,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,C.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,s,u,d,m,g,v){for(let b=d;b<m;b++){let C=u.get(b),T=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,C.padding,g.zOffset)}}updateCollisionDebugBuffers(e,s,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let m=fg(this.iconSizeData,e,d),g=fg(this.textSizeData,e,u);for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(g,e,s,b.textBoxStartIndex,b.textBoxEndIndex,b,u),this._updateTextDebugCollisionBoxes(g,e,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(m,e,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b,d),this._updateIconDebugCollisionBoxes(m,e,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,u,d,m,g,v,b,C){let T={};if(s<u){let{x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te,featureIndex:he}=e.get(s);T.textBox={x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te},T.textFeatureIndex=he}if(d<m){let{x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te,featureIndex:he}=e.get(d);T.verticalTextBox={x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te},T.verticalTextFeatureIndex=he}if(g<v){let{x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te,featureIndex:he}=e.get(g);T.iconBox={x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te},T.iconFeatureIndex=he}if(b<C){let{x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te,featureIndex:he}=e.get(b);T.verticalIconBox={x1:I,y1:D,x2:P,y2:R,padding:z,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:te},T.verticalIconFeatureIndex=he}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){let u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,s){let u=e.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let s=Math.sin(e),u=Math.cos(e),d=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);let b=this.symbolInstances.get(v);d.push(0|Math.round(s*b.tileAnchorX+u*b.tileAnchorY)),m.push(b.featureIndex)}return g.sort((v,b)=>d[v]-d[b]||m[b]-m[v]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,s){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let s of this.symbolInstanceIndexes){let u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:C}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){let s=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex,u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function Ok(a,e){return e.replace(/{([^{}]+)}/g,(s,u)=>u in a?String(a[u]):"")}let Rk,kk,CI;kt(C1,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),C1.addDynamicAttributes=vg;class Fk{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:za,this.defaultValue=e}evaluate(e){if(e.formattedSection){let s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt(Fk,"FormatSectionOverride",{omit:["defaultValue"]});let EI=()=>CI||(CI={layout:Rk||(Rk=new hr({"symbol-placement":new ht(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(Me.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ht(Me.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ht(Me.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ht(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ht(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Me.layout_symbol["icon-size"]),"icon-size-scale-range":new ht(Me.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new wt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Me.layout_symbol["icon-image"]),"icon-image-use-theme":new ht({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new wt(Me.layout_symbol["icon-rotate"]),"icon-padding":new ht(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Me.layout_symbol["icon-offset"]),"icon-anchor":new wt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(Me.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Me.layout_symbol["text-field"]),"text-font":new wt(Me.layout_symbol["text-font"]),"text-size":new wt(Me.layout_symbol["text-size"]),"text-size-scale-range":new ht(Me.layout_symbol["text-size-scale-range"]),"text-max-width":new wt(Me.layout_symbol["text-max-width"]),"text-line-height":new wt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Me.layout_symbol["text-justify"]),"text-radial-offset":new wt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Me.layout_symbol["text-anchor"]),"text-max-angle":new ht(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(Me.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Me.layout_symbol["text-rotate"]),"text-padding":new ht(Me.layout_symbol["text-padding"]),"text-keep-upright":new ht(Me.layout_symbol["text-keep-upright"]),"text-transform":new wt(Me.layout_symbol["text-transform"]),"text-offset":new wt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new ht(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ht(Me.layout_symbol["text-ignore-placement"]),"text-optional":new ht(Me.layout_symbol["text-optional"]),visibility:new ht(Me.layout_symbol.visibility)})),paint:kk||(kk=new hr({"icon-opacity":new wt(Me.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wt(Me.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wt(Me.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wt(Me.paint_symbol["text-emissive-strength"]),"icon-color":new wt(Me.paint_symbol["icon-color"]),"icon-halo-color":new wt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(Me.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ht(Me.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wt(Me.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wt(Me.paint_symbol["text-occlusion-opacity"]),"text-color":new wt(Me.paint_symbol["text-color"],{runtimeType:bs,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new wt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Me.paint_symbol["text-halo-blur"]),"text-translate":new ht(Me.paint_symbol["text-translate"]),"text-translate-anchor":new ht(Me.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ht(Me.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ht(Me.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ht(Me.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ht(Me.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new wt(Me.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},CI);class E1 extends cs{constructor(e,s,u,d){super(e,EI(),s,u,d,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=gt([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,s){super.recalculate(e,s),this.appearances&&this.appearances.forEach(d=>{d.recalculate(e,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let d=[];for(let m of u)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,s,u,d){return this._saturation===e&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(m,g,v,b){m=sr(m),g=Gn(g);let C=Qe(),T=m/3,I=1-2*T,D=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],P=.5-.5*g,R=b-v;return Ot(C,[R,0,0,0,0,R,0,0,0,0,R,0,v,v,v,1],[g,0,0,0,0,g,0,0,0,0,g,0,P,P,P,1]),Ot(C,C,D),C})(e,s,u,d),this._saturation=e,this._contrast=s,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,s,u,d){let m=this.layout.get(e).evaluate(s,{},u,d),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||bp(g.value)||!m?m:Ok(s.properties,m)}getAppearanceValueAndResolveTokens(e,s,u,d,m){let g=e.getProperty(s);if(!g)return;let v=g.evaluate(u,{},d,m),b=e.getUnevaluatedProperties()._values[s];return b.isDataDriven()||bp(b.value)||!v||typeof v!="string"?v:Ok(u.properties,v)}createBucket(e){return new C1(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of EI().paint.overridableProperties){if(!E1.hasPaintOverride(this.layout,e))continue;let s=this.paint.get(e),u=new Fk(s),d=new Sm(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme")),m=null;m=s.value.kind==="constant"||s.value.kind==="source"?new Xd("source",d):new Yu("composite",d,s.value.zoomStops,s.value.interpolationType),this.paint._values[e]=new Qu(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&E1.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){let u=e.get("text-field"),d=EI().paint.properties[s],m=!1,g=v=>{for(let b of v)if(d.overrides&&d.overrides.hasOverride(b))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof os)g(u.value.value.sections);else if(u.value.kind==="source"){let v=C=>{m||(C instanceof Gl&&so(C.value)===sp?g(C.value.sections):C instanceof dl?g(C.sections):C.eachChild(v))},b=u.value;b._styleExpression&&v(b._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,s,u){return{config:new Qc(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Lk,Nk,zk,Bk;var SI=Pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function S1(a,e,s,u,d,m,g,v){let b=[a,e,1,s,u,1,d,m,1],C=[g,v,1],T=le([],b),[I,D,P]=Ac(C,C,T);return De(b,b,[I,0,0,0,D,0,0,0,P])}function Vk(a,e,s,u,d,m,g,v){let b=(function(C,T,I,D,P,R,z,H){let $=S1(0,0,1,0,1,1,0,1),Z=S1(C,T,I,D,P,R,z,H);return De(Z,Z,le([],$))})(a,e,s,u,d,m,g,v);return[b[2]/b[8]/_t,b[5]/b[8]/_t]}function T1(a){return[a[0],Math.min(Math.max(a[1],-L),L)]}class Uk extends Hu{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=s,this._dirty=!1}load(e,s){if(this._loaded=s||!1,this.fire(new cl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=qf(this.map._requestManager.transformRequest(this.url,Jh.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ip(u)):d&&(this.image=d instanceof HTMLImageElement?oo.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new v0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new cl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof v0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=e[0][1],u=e[0][1];for(let m of e)m[1]>u&&(u=m[1]),m[1]<s&&(s=m[1]);let d=(u+s)/2;if(d>L?this.onNorthPole=!0:d<-L&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(J.fromLngLat);this.tileID=(function(g){let v=1/0,b=1/0,C=-1/0,T=-1/0;for(let z of g)v=Math.min(v,z.x),b=Math.min(b,z.y),C=Math.max(C,z.x),T=Math.max(T,z.y);let I=Math.max(C-v,T-b),D=Math.max(0,Math.floor(-Math.log2(I))),P=Math.pow(2,D),R=Math.floor((v+C)/2*P);return R>1&&(R-=1),new Si(D,R,Math.floor((b+T)/2*P))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new cl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof v0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let $ in this.tiles){let Z=this.tiles[$];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let s=I0(new Si(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function($){let Z=$[1].x-$[0].x,Y=$[1].y-$[0].y,te=$[2].x-$[1].x,he=$[2].y-$[1].y,ae=$[3].x-$[2].x,me=$[3].y-$[2].y,ye=$[0].x-$[3].x,we=$[0].y-$[3].y,je=Z*he-te*Y,Te=te*me-ae*he,qe=ae*we-ye*me,Ye=ye*Y-Z*we;return je>0&&Te>0&&qe>0&&Ye>0||je<0&&Te<0&&qe<0&&Ye<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let d=I0(this.tileID,this.map.transform.projection),[m,g,v,b]=this.coordinates.map($=>{let Z=d.projection.project($[0],$[1]);return Tk(d,Z)._round()});this.perspectiveTransform=Vk(m.x,m.y,g.x,g.y,v.x,v.y,b.x,b.y);let C=this._boundsArray=new Jd;C.emplaceBack(m.x,m.y,0,0),C.emplaceBack(g.x,g.y,_t,0),C.emplaceBack(b.x,b.y,0,_t),C.emplaceBack(v.x,v.y,_t,_t),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,SI.members),this.boundsSegments=Ji.simpleSegment(0,0,4,2);let T=[],I=[T1((D=this.coordinates)[0]),T1(D[1]),T1(D[2]),T1(D[3])];var D;let[P,R,z,H]=(function($){let Z=$[0][0],Y=Z,te=$[0][1],he=te;for(let ae=1;ae<$.length;ae++)$[ae][0]<Z?Z=$[ae][0]:$[ae][0]>Y&&(Y=$[ae][0]),$[ae][1]<te?te=$[ae][1]:$[ae][1]>he&&(he=$[ae][1]);return[Z,te,Y-Z,he-te]})(I);{let $=new Jd,[Z,Y,te,he]=(function(et){let tt=et[0].x,Ge=tt,$e=et[0].y,nt=$e;for(let vt=1;vt<et.length;vt++)et[vt].x<tt?tt=et[vt].x:et[vt].x>Ge&&(Ge=et[vt].x),et[vt].y<$e?$e=et[vt].y:et[vt].y>nt&&(nt=et[vt].y);return[tt,$e,Ge-tt,nt-$e]})(u),ae=et=>[(et.x-Z)/te,(et.y-Y)/he],[me,ye,we,je]=u.map(ae),Te=(function(et,tt,Ge,$e,nt,vt,ut,Gt){let Tt=S1(0,0,1,0,1,1,0,1);return De(Tt,Tt,le([],S1(et,tt,Ge,$e,nt,vt,ut,Gt)))})(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=Vk(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);let qe=(et,tt)=>{T.push(et.lng);let Ge=Math.round((et.lng-P)/z*_t),$e=Math.round((et.lat-R)/H*_t),nt=ae(tt),vt=Ac([],[nt[0],nt[1],1],Te),ut=Math.round(vt[0]/vt[2]*_t),Gt=Math.round(vt[1]/vt[2]*_t);$.emplaceBack(Ge,$e,ut,Gt)},Ye=u[3].x-u[0].x,Ke=u[3].y-u[0].y,rt=u[2].x-u[1].x,st=u[2].y-u[1].y;for(let et=0;et<65;et++){let tt=et/64,Ge=[u[0].x+tt*Ye,u[0].y+tt*Ke],$e=[u[1].x+tt*rt,u[1].y+tt*st],nt=$e[0]-Ge[0],vt=$e[1]-Ge[1];for(let ut=0;ut<65;ut++){let Gt=ut/64,Tt={x:Ge[0]+nt*Gt,y:Ge[1]+vt*Gt};qe(s.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,SI.members)}{this.maxLongitudeTriangleSize=0;let $=[],Z=new qr,Y=(te,he,ae)=>{Z.emplaceBack(te,he,ae);let me=T[te],ye=T[he],we=T[ae],je=Math.min(Math.min(me,ye),we),Te=Math.max(Math.max(me,ye),we)-je;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),$.push(je+Te/2)};for(let te=0;te<64;te++)for(let he=0;he<64;he++){let ae=65*te+he,me=ae+1,ye=ae+65,we=ye+1;Y(ae,ye,me),Y(me,ye,we)}[$,Z]=(function(te,he){let ae=Array.from({length:te.length},(we,je)=>je);ae.sort((we,je)=>te[we]-te[je]);let me=[],ye=new qr;for(let we=0;we<ae.length;we++){let je=ae[we];me.push(te[je]);let Te=3*je,qe=Te+1;ye.emplaceBack(he.uint16[Te],he.uint16[qe],he.uint16[qe+1])}return[me,ye]})($,Z),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=Ji.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/_t,0,H/_t,0,0,R,P,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof v0||(this.texture?this.texture.update(this.image):(this.texture=new YT(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(s)}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;let u=this.elevatedGlobeTrianglesCenterLongitudes,d=(m=e+180)+360*Math.round((u[0]-m)/360);var m;let g=new Ji,v=(I,D)=>{g.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=b){let I=or(u,0,u.length,d+b);return I===u.length||v(I,$r(u,I+1,u.length,d+360-b)-I),g}d<u[0]&&(d+=360);let C=$r(u,0,u.length,d-b);if(C===u.length)return v(0,u.length),g;v(0,C-0);let T=or(u,C+1,u.length,d+b);return T!==u.length&&v(T,u.length-T),g}}let F6=(Math.pow(256,2)-1)/16907520;class jk extends cs{constructor(e,s,u,d){super(e,{layout:zk||(zk=new hr({visibility:new ht(Me.layout_raster.visibility)})),paint:Bk||(Bk=new hr({"raster-opacity":new ht(Me.paint_raster["raster-opacity"]),"raster-color":new ed(Me.paint_raster["raster-color"]),"raster-color-mix":new ht(Me.paint_raster["raster-color-mix"]),"raster-color-range":new ht(Me.paint_raster["raster-color-range"]),"raster-hue-rotate":new ht(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(Me.paint_raster["raster-saturation"]),"raster-contrast":new ht(Me.paint_raster["raster-contrast"]),"raster-resampling":new ht(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(Me.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ht(Me.paint_raster["raster-emissive-strength"]),"raster-array-band":new ht(Me.paint_raster["raster-array-band"]),"raster-elevation":new ht(Me.paint_raster["raster-elevation"]),"raster-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Uk&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let s=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=i0({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let $k,Hk,Gk,qk,Wk;class Zk extends cs{constructor(e,s,u,d){super(e,{layout:$k||($k=new hr({visibility:new ht(Me["layout_raster-particle"].visibility)})),paint:Hk||(Hk=new hr({"raster-particle-array-band":new ht(Me["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ht(Me["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ed(Me["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ht(Me["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ht(Me["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ht(Me["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ht(Me["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ht(Me["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this._updateColorRamp(),this.lastInvalidatedAt=oo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=i0({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=oo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class L6 extends cs{constructor(e,s){super(e,{},s,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function TI(a,e,s){let u=[0,0,1],d=Od([]);return Vl(d,d,s?-Zn(a)+Math.PI:Zn(a)),Ra(d,d,-Zn(e)),Pc(u,u,d),ji(u,u)}let Xk={None:0,Model:1,Symbol:2,FillExtrusion:4};class I1{constructor(e,s,u,d){this.message=(e?`${e}: `:"")+u,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function II(a,e){let s=a.indexOf("://")===-1;try{return new URL(a,s&&e?"http://example.com":void 0),!0}catch{return!1}}class Yk{constructor(e,s){this.feature=e,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Kk{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new qv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){let s=16*e,u=this.instancedDataArray.float32,d=Math.floor(u[s+2]),m=1.05*(u[s+2]-d);return d/=100,[u[s]%1*1.05,u[s+1]%1*1.05,m,d]}tileCoordinatesForInstance(e){let s=16*e,u=this.instancedDataArray.float32,d=u[s+0];return d=d>_t?d-_t:d,new it(Math.trunc(d),Math.trunc(u[s+1]))}translationForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class MI{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.tileToMeter=q(u);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:v,index:b,sourceLayerIndex:C}of e){let T=v??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),I=Se(g,m);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:T,sourceLayerIndex:C,index:b,geometry:m?I.geometry:_e(g,u,d),properties:g.properties,type:g.type,patterns:{}},P=this.addFeature(D,D.geometry,I);P&&s.featureIndex.insert(g,D.geometry,b,C,this.index,this.instancesPerModel[P].instancedDataArray.length,_t/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){let e=this.layers[0].modelManager,s=this.layers[0].scope,u=0;for(let d of this.modelUris){let m=e.getModel(d,s);if(!m)continue;let g=this.instancesPerModel[d];if(g){let v=.5*Lf(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,b=Math.min(_t,Math.max(v/this.tileToMeter,_t/32));u=Math.max(b,u)}}return u}update(e,s,u,d){for(let m in this.instancesPerModel){let g=this.instancesPerModel[m];for(let v in e)g.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(g.features[g.idToFeaturesIndex[v]],e[v],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];for(let d of u.features){let m=this.layers[0],g=d.feature,v=this.canonical,b=m.paint.get("model-rotation").evaluate(g,{},v),C=m.paint.get("model-scale").evaluate(g,{},v),T=m.paint.get("model-translation").evaluate(g,{},v);Wo(d.rotation,b)&&Wo(d.scale,C)&&Wo(d.translation,T)||(this.evaluate(d,d.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,s,u,d){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let m=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Yb(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(let v in this.instancesPerModel){let b=this.instancesPerModel[v],C=b.instancedDataArray;for(let T of b.features){let I=T.instancedDataOffset,D=T.instancedDataCount;for(let P=0;P<D;P++){let R=16*(P+I),z=C.float32[R+0],H=z>_t;z=H?z-_t:z;let $=Math.floor(z),Z=Math.floor(C.float32[R+1]),Y=!1;for(let te of this.activeReplacements)if(!NO(te,u,Xk.Model,d)&&!(te.min.x>$||$>te.max.x||te.min.y>Z||Z>te.max.y)&&(Y=jO(UO($,Z,e.canonical,te.footprintTileId.canonical),te.footprint),Y))break;C.float32[R]=Y?z+_t:z,g=g||Y!==H}}}return g}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,oj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(let u in this.instancesPerModel){let d=this.instancesPerModel[u];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}let s=this.layers[0].modelManager;if(e&&s&&this.modelUris&&this.modelsRequested)for(let u of this.modelUris)s.removeModel(u,"",!0)}addFeature(e,s,u){let d=this.layers[0],m=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return Dt(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),m;(II(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new Kk);let g=this.instancesPerModel[m],v=g.instancedDataArray,b=new Yk(u,v.length);for(let C of s)for(let T of C){if(T.x<0||T.x>=_t||T.y<0||T.y>=_t)continue;if(this.lookupDim!==0){let D=(this.lookupDim-1)/_t,P=this.lookupDim*(T.y*D|0)+T.x*D|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}}this.instanceCount++;let I=v.length;v.resize(I+1),g.instancesEvaluatedElevation.push(0),v.float32[16*I]=T.x,v.float32[16*I+1]=T.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(e,s,u,d){let m=this.layers[0],g=e.feature,v=this.canonical,b=e.rotation=m.paint.get("model-rotation").evaluate(g,s,v),C=e.scale=m.paint.get("model-scale").evaluate(g,s,v),T=e.translation=m.paint.get("model-translation").evaluate(g,s,v),I=Object.assign({},m.paint.get("model-color").evaluate(g,s,v));I.a=m.paint.get("model-color-mix-intensity").evaluate(g,s,v);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]);let P=T[0]*T[0]+T[1]*T[1],R=P>0?Math.sqrt(P):0;u.maxScale=Math.max(Math.max(u.maxScale,C[0]),Math.max(C[1],C[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,R),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),MR(D,b,C);let z=Math.round(100*I.a)+I.b/1.05;for(let H=0;H<e.instancedDataCount;++H){let $=e.instancedDataOffset+H,Z=16*$,Y=u.instancedDataArray.float32,te=0;d&&(te=Y[Z+6]-u.instancesEvaluatedElevation[$]);let he=0|Y[Z+1];Y[Z]=(0|Y[Z])+I.r/1.05,Y[Z+1]=he+I.g/1.05,Y[Z+2]=z,Y[Z+3]=1/(v.z>10?this.tileToMeter:q(v,he)),Y[Z+4]=T[0],Y[Z+5]=T[1],Y[Z+6]=T[2]+te,Y[Z+7]=D[0],Y[Z+8]=D[1],Y[Z+9]=D[2],Y[Z+10]=D[4],Y[Z+11]=D[5],Y[Z+12]=D[6],Y[Z+13]=D[8],Y[Z+14]=D[9],Y[Z+15]=D[10],u.instancesEvaluatedElevation[$]=T[2]}}}let Qk,Jk;kt(MI,"ModelBucket",{omit:["layers"]}),kt(Kk,"PerModelAttributes"),kt(Yk,"ModelFeature");class yg{constructor(e,s,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(e,s,u){let d=u||e.findDEMTileFor(s);if(!d||!d.dem)return;let m=d.dem,g=d.tileID,v=1<<s.canonical.z-g.canonical.z;return new yg(d,m.dim/_t/v,[(s.canonical.x/v-g.canonical.x)*m.dim,(s.canonical.y/v-g.canonical.y)*m.dim])}tileCoordToPixel(e,s){let u=s*this._scale+this._offset[1];return new it(Math.floor(e*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(e,s,u,d){let m=e*this._scale+this._offset[0],g=s*this._scale+this._offset[1],v=Math.floor(m),b=Math.floor(g),C=this._dem;return d=!!d,u?on(on(C.get(v,b,d),C.get(v,b+1,d),g-b),on(C.get(v+1,b,d),C.get(v+1,b+1,d),g-b),m-v):C.get(v,b,d)}getElevationAtPixel(e,s,u){return this._dem.get(e,s,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*M(1,e)*this._dem.stride}}let DI=new Float32Array(262144),$p=new Uint8Array(262144);function eF(a){let e=0;if(a.meshes)for(let s of a.meshes)e=Math.max(e,s.aabb.max[2]);if(a.children)for(let s of a.children)e=Math.max(e,eF(s));return e}function tF(a,e,s){if(a.meshes)for(let u of a.meshes){if(u.aabb.min[0]===1/0)continue;let d=Ut.applyTransform(u.aabb,a.globalMatrix);s.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(let u of a.children)tF(u,e,s)}let nF=["","wall","door","roof","window","lamp","logo"];class iF{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:eF(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,s=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=Ut.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),e++;this.aabb=s}return this.aabb}}class M1{constructor(e,s,u,d,m,g,v,b){this.id=u,this.layers=e,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=ug.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=ug.HasMapboxMeshFeatures),m&&(this.modelTraits|=ug.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(let C of s)this.nodesInfo.push(new iF(C)),tF(C,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,s){for(let u of this.getNodesInfo()){let d=u.node;d.footprint&&s.push({footprint:d.footprint,id:e})}}updateAppearances(e,s,u,d){}update(e){let s=Object.keys(e).length!==0;if(s&&!this.stateDependentLayers.length)return;let u=s?this.stateDependentLayers:this.layers;if(!jl(e,this.states))for(let d of u)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let s=this.getNodesInfo();for(let u of s){let d=u.node;this.uploaded?this.updatePbrBuffer(d):JT(d,e,!0)}for(let u of s)c1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let s=!1;if(!e.meshes)return s;for(let u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(e,s,u){let d=e.transform.projectionOptions,m=e.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||d.name!==this.projection.name||F0(u.paint.get("model-color").value,g)||F0(u.paint.get("model-color-mix-intensity").value,g)||F0(u.paint.get("model-roughness").value,g)||F0(u.paint.get("model-emissive-strength").value,g)||F0(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=d,this.brightness=m;let v=this.getNodesInfo();for(let b of v)b.state=null;return!0}return!1}evaluateTransform(e,s){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let u=this.getNodesInfo(),d=this.id.canonical;for(let m of u){let g=m.feature;m.evaluatedTranslation=s.paint.get("model-translation").evaluate(g,{},d),m.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},d)}}evaluate(e,s){let u=this.getNodesInfo();for(let d of u){if(!d.node.meshes)continue;let m=d.feature,g=s&&s[m.id];if(jl(g,d.state))continue;d.state=structuredClone(g);let v=d.node.meshes&&d.node.meshes[0].featureData,b=d.evaluatedColor[2],C=d.evaluatedRMEA[2],T=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let I=0;I<nF.length;I++){let D=nF[I];D.length&&(m.properties.part=D);let P=e.paint.get("model-color").evaluate(m,g,T).toPremultipliedRenderColor(null),R=e.paint.get("model-color-mix-intensity").evaluate(m,g,T);d.evaluatedColor[I]=[P.r,P.g,P.b,R],d.evaluatedRMEA[I][0]=e.paint.get("model-roughness").evaluate(m,g,T),d.evaluatedRMEA[I][2]=e.paint.get("model-emissive-strength").evaluate(m,g,T),d.evaluatedRMEA[I][3]=P.a,d.emissionHeightBasedParams[I]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,T),!d.hasTranslucentParts&&P.a<1&&(d.hasTranslucentParts=!0)}delete m.properties.part,z6(d,b!==d.evaluatedColor[2]||C!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,g,T);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,g,T),d.evaluatedScale=e.paint.get("model-scale").evaluate(m,g,T),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,s,u,d){let m=e.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let g=yg.create(e,u,m);if(!g)return;this.modelTraits&ug.HasMapboxMeshFeatures&&this.updateDEM(e,g,u,d);for(let v of this.getNodesInfo()){let b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let C=b.footprint.vertices,T=g.getElevationAt(C[0].x,C[0].y,!0,!0);for(let I=1;I<C.length;I++)T=Math.min(T,g.getElevationAt(C[I].x,C[I].y,!0,!0));b.elevation=T}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=s}}updateDEM(e,s,u,d){let m=s._dem._modifiedForSources[d];if(m===void 0&&(s._dem._modifiedForSources[d]=[],m=s._dem._modifiedForSources[d]),m.includes(u.canonical))return;let g=s._dem.dim;m.push(u.canonical);let v=!1;for(let b of this.getNodesInfo()){let C=b.node;if(!C.footprint||!C.footprint.grid)continue;let T=C.footprint.grid,I=s.tileCoordToPixel(T.min.x,T.min.y),D=s.tileCoordToPixel(T.max.x,T.max.y),P=Math.min(Math.min(g-D.y,I.x),Math.min(I.y,g-D.x));if(P<0)continue;let R=G(P,2,5),z=Math.max(0,I.x-R),H=Math.max(0,I.y-R),$=Math.min(D.x+R,g-1),Z=Math.min(D.y+R,g-1);for(let ae=H;ae<=Z;++ae)for(let me=z;me<=$;++me)$p[ae*g+me]=255;let Y=0,te=0;for(let ae=0;ae<T.cellsY;++ae)for(let me=0;me<T.cellsX;++me){if(!T.cells[ae*T.cellsX+me])continue;let ye=s.tileCoordToPixel(T.min.x+me/T.xScale,T.min.y+ae/T.yScale),we=s.tileCoordToPixel(T.min.x+(me+1)/T.xScale,T.min.y+(ae+1)/T.yScale);for(let je=ye.y;je<=Math.min(we.y+1,g-1);++je)for(let Te=ye.x;Te<=Math.min(we.x+1,g-1);++Te)$p[je*g+Te]===255&&($p[je*g+Te]=0,Y+=s.getElevationAtPixel(Te,je),te++)}let he=Y/te;z=Math.max(1,I.x-R),H=Math.max(1,I.y-R),$=Math.min(D.x+R,g-2),Z=Math.min(D.y+R,g-2),v=!0;for(let ae=H;ae<=Z;++ae)for(let me=z;me<=$;++me)$p[ae*g+me]===0&&(DI[ae*g+me]=s._dem.set(me,ae,he));for(let ae=1;ae<R;++ae){z=Math.max(1,I.x-ae),H=Math.max(1,I.y-ae),$=Math.min(D.x+ae,g-2),Z=Math.min(D.y+ae,g-2);for(let me=H;me<=Z;++me)for(let ye=z;ye<=$;++ye){let we=me*g+ye;if($p[we]===255){let je=0,Te=0,qe=-1,Ye=-1;for(let Ke=-1;Ke<=1;++Ke)for(let rt=-1;rt<=1;++rt){let st=(me+Ke)*g+ye+rt;if($p[st]>=ae)continue;let et=DI[st],tt=Math.abs(et);tt>Te&&(je=et,Te=tt,qe=rt,Ye=Ke)}if(Te>.1){let Ke=1-(ae+.5*Math.abs(qe*Ye))/R,rt=s._dem.get(ye,me)+je*Ke,st=s._dem.get(ye+qe,me+Ye),et=s._dem.get(ye-qe,me-Ye,!0);(rt-st)*(rt-et)>0&&(rt=(st+et)/2),DI[we]=s._dem.set(ye,me,rt),$p[we]=ae}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=oo.now())}setFilter(e){this.filter=e?km(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Ni(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let s of e)c1(s.node),eI(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(e.toUnwrapped());for(let d of this.getNodesInfo()){let m=d.node.footprint;d.hiddenByReplacement=!!m&&!u.find(g=>g.footprint===m)}}getHeightAtTileCoord(e,s){let u=[],d=[0,0,0],m=gt([]);for(let g of this.getNodesInfo()){let v=g.node.meshes[0],b=v.transformedAabb;if(e<b.min[0]||s<b.min[1]||e>b.max[0]||s>b.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};jt(m,g.node.globalMatrix),d[0]=e,d[1]=s,Pr(d,d,m);let C=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Vp|0,T=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Vp|0)*Vp+Math.min(63,C),I=v.heightmap[T];if(!(I<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:I,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new it(e,s),new it(e,s),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function F0(a,e){return a instanceof Xd&&!a.isLightConstant&&e}function N6(a,e,s,u,d,m,g,v){let b=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;s[3]>0&&(b=on(b,255*s[0],s[3]),C=on(C,255*s[1],s[3]),T=on(T,255*s[2],s[3]));let I=b<<8|C,D=T<<8|Math.floor(255*u[3]),P=(function(ae){let me=G(ae,0,2);return Math.min(Math.round(.5*me*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],R=G(d[0],0,1),z=G(d[1],0,1),H=G(d[2],0,1),$=G(d[3],0,1),Z,Y,te,he;if(R!==z&&g!==m&&z!==R){let ae=g-m;Y=1/(ae*(z-R)),te=-(m+ae*R)/(ae*(z-R));let me=G(d[4],-1,1);he=Math.pow(10,me),Z=255*H<<8|255*$}else Z=65535,Y=0,te=1,he=1;if(a.emplaceBack(I,D,P,Z,Y,te,he),v){let ae=v.length;v.clear();for(let me=0;me<ae;me++)v.emplaceBack(I,D,P,Z,Y,te,he)}}function z6(a,e,s){let u=a.node,d=0,m=s&ug.HasMeshoptCompression;for(let g of u.meshes){if(u.lights&&u.lightMeshIndex===d||!g.featureData)continue;g.featureArray=new Gm,g.featureArray.reserve(g.featureData.length);let v=e;for(let b of g.featureData){let C=m?65535&b:b>>16&65535,T=m?b>>16&65535:65535&b,I=(15&T)<8?15&T:0,D=a.evaluatedRMEA[I],P=a.evaluatedColor[I],R=a.emissionHeightBasedParams[I],z;if(v&&I===2&&u.lights&&(z=new Gm,z.resize(10*u.lights.length)),N6(g.featureArray,C,P,D,R,g.aabb.min[2],g.aabb.max[2],z),z&&v){v=!1;let H=u.meshes[u.lightMeshIndex];H.featureArray=z,H.featureArray._trim()}}g.featureArray._trim(),d++}}kt(M1,"Tiled3dModelBucket",{omit:["layers"]}),kt(iF,"Tiled3dModelFeature");let B6=["id","tile","layer","source","sourceLayer","state"];class Hp{constructor(e,s,u,d,m){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=u,this._y=d,this.properties=e?e.properties:{},this.id=m}clone(){let e=new Hp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let s of B6)this[s]!==void 0&&(e[s]=this[s]);return e}}class Gp extends Hu{constructor(e,s,u,d){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){let e=[];for(let s in this._options.models){let u=this._options.models[s],d=this._modelsInfo.get(s);if(d){let m=d.model;m.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),m.orientation=u.orientation!=null?u.orientation:[0,0,0],d.modelSpec=u,Gp.applyModelSpecification(m,u),m.computeBoundsAndApplyParent(),this.models.push(m)}else{let m=ER(this.map._requestManager.transformRequest(u.uri,Jh.Model).url).then(g=>{if(!g)return;let v=nI(g),b=new DR(s,u.uri,u.position,u.orientation,v);Gp.applyModelSpecification(b,u),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(s,{modelSpec:u,model:b})}).catch(g=>{this.fire(new ip(new Error(`Could not load model ${s} from ${u.uri}: ${g.message}`)))});e.push(m)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new cl("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new ip(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(e,s){s.nodeOverrides&&Gp.convertNodeOverrides(e,s.nodeOverrides),s.materialOverrides&&Gp.convertMaterialOverrides(e,s.materialOverrides),s.nodeOverrideNames&&(e.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(e.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(e.featureProperties=s.featureProperties)}static convertNodeOverrides(e,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){e.nodeOverrideNames=[];for(let u of s)e.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{let m={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){let g=d.orientation;g&&(m.orientation=g)}e.nodeOverrides.set(u,m)})}static convertMaterialOverrides(e,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){e.materialOverrideNames=[];for(let u of s)e.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{let m={color:new ci(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=d["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);let v=d["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);let b=d["model-emissive-strength"];b!==void 0&&(m.emissionStrength=b);let C=d["model-opacity"];C!==void 0&&(m.opacity=C),e.materialOverrides.set(u,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,s){}serialize(){return this._options}setProperty(e,s){return!1}reload(){let e=Ua(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];let s=new Map;for(let u in e){let d=e[u];if(this._modelsInfo.has(u)){let m=this._modelsInfo.get(u);m&&m.modelSpec.uri===d.uri&&s.set(u,m)}}this._modelsInfo=s,this._options.models=e,this._loaded=!1,this.load()}}function AI(a,e,s,u){let d=1<<a.z;e.lat=F((u/_t+a.y)/d),e.lng=A((s/_t+a.x)/d)}function V6(a,e,s,u){let d=a.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let m=Number.MAX_VALUE,g=d.node,v=s.tile,b=u.calculatePosMatrix(v.tileID.toUnwrapped(),u.worldSize),C=d.evaluatedScale,T=0;u.elevation&&g.elevation&&(T=g.elevation*u.elevation.exaggeration()),Kt(b,b,[(g.anchor?g.anchor[0]:0)*(C[0]-1),(g.anchor?g.anchor[1]:0)*(C[1]-1),T]),Hn(b,b,C);let I=s.queryGeometry,D=I.isPointQuery()?I.screenBounds:I.screenGeometry,P=function(z){let H=Ot([],b,z.globalMatrix);Ot(H,u.expandedFarZProjMatrix,H);for(let $=0;$<z.meshes.length;++$){let Z=z.meshes[$];if($===z.lightMeshIndex)continue;let Y=QT(D,u,H,Z.aabb);Y!=null&&(m=Math.min(Y,m))}if(z.children)for(let $ of z.children)P($)};if(P(g),m===Number.MAX_VALUE)return;let R=new c(0,0);return AI(v.tileID.canonical,R,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:m,position:R,feature:d.feature}}let U6={circle:class extends cs{constructor(a,e,s,u){super(a,{layout:Es||(Es=new hr({"circle-sort-key":new wt(Me.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ht(Me.layout_circle["circle-elevation-reference"]),visibility:new ht(Me.layout_circle.visibility)})),paint:pr||(pr=new hr({"circle-radius":new wt(Me.paint_circle["circle-radius"]),"circle-color":new wt(Me.paint_circle["circle-color"]),"circle-blur":new wt(Me.paint_circle["circle-blur"]),"circle-opacity":new wt(Me.paint_circle["circle-opacity"]),"circle-translate":new ht(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Me.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ht(Me.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}createBucket(a){return new ui(a)}queryRadius(a){let e=a;return Uo("circle-radius",this,e)+Uo("circle-stroke-width",this,e)+yo(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,s,u,d,m,g,v){let b=xa(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return uO(a,u,m,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,s){let u=cO(this);return{config:new Qc(this,{zoom:e,lut:s}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends cs{createBucket(a){return new hO(a)}constructor(a,e,s,u){super(a,{layout:pO||(pO=new hr({visibility:new ht(Me.layout_heatmap.visibility)})),paint:fO||(fO=new hr({"heatmap-radius":new wt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ed(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(Me.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=i0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Uo("heatmap-radius",this,a)}queryIntersectsFeature(a,e,s,u,d,m,g,v){let b=this.paint.get("heatmap-radius").evaluate(e,s);return uO(a,u,m,g,v,!0,!0,new it(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,s){return a==="heatmap"?{config:new Qc(this,{zoom:e,lut:s}),overrideFog:!1}:{}}},hillshade:class extends cs{constructor(a,e,s,u){super(a,{layout:mO||(mO=new hr({visibility:new ht(Me.layout_hillshade.visibility)})),paint:gO||(gO=new hr({"hillshade-illumination-direction":new ht(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(Me.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ht(Me.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}},fill:class extends cs{constructor(a,e,s,u){super(a,{layout:PO||(PO=new hr({"fill-sort-key":new wt(Me.layout_fill["fill-sort-key"]),visibility:new ht(Me.layout_fill.visibility),"fill-elevation-reference":new ht(Me.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new wt(Me.layout_fill["fill-construct-bridge-guard-rail"])})),paint:OO||(OO=new hr({"fill-antialias":new ht(Me.paint_fill["fill-antialias"]),"fill-opacity":new wt(Me.paint_fill["fill-opacity"]),"fill-color":new wt(Me.paint_fill["fill-color"]),"fill-outline-color":new wt(Me.paint_fill["fill-outline-color"]),"fill-translate":new ht(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new wt(Me.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ht(Me.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ht(Me.paint_fill["fill-emissive-strength"]),"fill-z-offset":new wt(Me.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new wt(Me.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new wt(Me.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}getProgramIds(){let a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,e,s){return{config:new Qc(this,{zoom:e,lut:s}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);let s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new FT(a)}queryRadius(){return yo(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,s,u,d,m){return!a.queryGeometry.isAboveHorizon&&ti(Xs(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;let e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends cs{constructor(a,e,s,u){super(a,{layout:rR||(rR=new hr({visibility:new ht(Me["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ht(Me["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oR||(oR=new hr({"fill-extrusion-opacity":new ht(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wt(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ht(Me["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new wt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ht(Me["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ht(Me["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ht(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ht(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ht(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ht(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ht(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ht(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ht(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ht(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ht(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ht(Me["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ht(Me["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ht(Me["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wt(Me["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new wt(Me["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ht(Me["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Qb(a)}queryRadius(){return yo(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,s,u,d,m,g,v,b){let C=xa(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,s),I=this.paint.get("fill-extrusion-base").evaluate(e,s),D=[0,0],P=v&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,z=a.tile.getBucket(this);if(P&&z instanceof Qb){let te=z.centroidVertexArray,he=b+1;he<te.length&&(D[0]=te.geta_centroid_pos0(he),D[1]=te.geta_centroid_pos1(he))}if(D[0]===0&&D[1]===1)return!1;m.projection.name==="globe"&&(u=iR([u],[new it(0,0),new it(_t,_t)],a.tileID.canonical).map(te=>te.polygon).flat());let H=P?v:null,[$,Z]=hR(m,u,I,T,C,g,H,D,R,m.center.lat,a.tileID.canonical),Y=a.queryGeometry;return dR($,Z,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},building:class extends cs{constructor(a,e,s,u){super(a,{layout:LR||(LR=new hr({visibility:new ht(Me.layout_building.visibility),"building-facade":new wt(Me.layout_building["building-facade"]),"building-facade-floors":new wt(Me.layout_building["building-facade-floors"]),"building-facade-unit-width":new wt(Me.layout_building["building-facade-unit-width"]),"building-facade-window":new wt(Me.layout_building["building-facade-window"]),"building-roof-shape":new wt(Me.layout_building["building-roof-shape"]),"building-height":new wt(Me.layout_building["building-height"]),"building-base":new wt(Me.layout_building["building-base"]),"building-flood-light-wall-radius":new wt(Me.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new wt(Me.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new wt(Me.layout_building["building-flip-roof-orientation"])})),paint:NR||(NR=new hr({"building-opacity":new ht(Me.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ht(Me.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ht(Me.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ht(Me.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ht(Me.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ht(Me.paint_building["building-vertical-scale"]),"building-cast-shadows":new ht(Me.paint_building["building-cast-shadows"]),"building-color":new wt(Me.paint_building["building-color"]),"building-emissive-strength":new wt(Me.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ht(Me.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ht(Me.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ht(Me.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ht(Me.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ht(Me.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new FR(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,e,s,u,d,m,g,v,b){let C=this.layout.get("building-height").evaluate(e,s),T=this.layout.get("building-base").evaluate(e,s),I=a.tile.getBucket(this).getFootprint(e);if(I){if(I.hiddenFlags!==0)return!1;C=I.height}let[D,P]=hR(m,u,T,C,new it(0,0),g,null,[0,0],1,m.center.lat,a.tileID.canonical),R=a.queryGeometry;return dR(D,P,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends cs{constructor(a,e,s,u){let d=WR();super(a,d,e,s,u),d.layout&&(this.layout=new Ju(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(x0)return x0;let s=WR();return x0=new Fj(s.paint.properties["line-width"].specification),x0.useIntegerZoom=!0,x0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new oI(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,s){let u=GR(this);return{config:new Qc(this,{zoom:e,lut:s}),defines:u,overrideFog:!1}}queryRadius(a){let e=a,s=ZR(Uo("line-width",this,e),Uo("line-gap-width",this,e)),u=Uo("line-offset",this,e);return s/2+Math.abs(u)+yo(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,s,u,d,m){if(a.queryGeometry.isAboveHorizon)return!1;let g=Xs(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*ZR(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),b=this.paint.get("line-offset").evaluate(e,s);return b&&(u=(function(C,T){let I=[],D=new it(0,0);for(let P=0;P<C.length;P++){let R=C[P],z=[];for(let H=0;H<R.length;H++){let $=R[H],Z=R[H+1],Y=H===0?D:$.sub(R[H-1])._unit()._perp(),te=H===R.length-1?D:Z.sub($)._unit()._perp(),he=Y._add(te)._unit();he._mult(1/(he.x*te.x+he.y*te.y)),z.push(he._mult(T)._add($))}I.push(z)}return I})(u,b*a.pixelToTileUnitsFactor)),(function(C,T,I){for(let D=0;D<T.length;D++){let P=T[D];if(C.length>=3){for(let R=0;R<P.length;R++)if(Ei(C,P[R]))return!0}if(ar(C,P,I))return!0}return!1})(g,u,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:E1,background:class extends cs{constructor(a,e,s,u){super(a,{layout:Lk||(Lk=new hr({visibility:new ht(Me.layout_background.visibility)})),paint:Nk||(Nk=new hr({"background-pitch-alignment":new ht(Me.paint_background["background-pitch-alignment"]),"background-color":new ht(Me.paint_background["background-color"]),"background-pattern":new ht(Me.paint_background["background-pattern"]),"background-opacity":new ht(Me.paint_background["background-opacity"]),"background-emissive-strength":new ht(Me.paint_background["background-emissive-strength"]),"background-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:jk,"raster-particle":Zk,sky:class extends cs{constructor(a,e,s,u){super(a,{layout:Gk||(Gk=new hr({visibility:new ht(Me.layout_sky.visibility)})),paint:qk||(qk=new hr({"sky-type":new ht(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new ht(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ht(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ht(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ht(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new ed(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ht(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ht(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ht(Me.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=i0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),d=!u,m=a.style.light,g=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&Dt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?TI(g.azimuthal,90-g.polar,e):TI(u[0],90-u[1],e)}let s=this.paint.get("sky-gradient-center");return TI(s[0],90-s[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends cs{constructor(a,e,s,u){super(a,{paint:Wk||(Wk=new hr({}))},e,null)}},model:class extends cs{constructor(a,e,s,u){super(a,{layout:Qk||(Qk=new hr({visibility:new ht(Me.layout_model.visibility),"model-id":new wt(Me.layout_model["model-id"])})),paint:Jk||(Jk=new hr({"model-opacity":new wt(Me.paint_model["model-opacity"]),"model-rotation":new wt(Me.paint_model["model-rotation"]),"model-scale":new wt(Me.paint_model["model-scale"]),"model-translation":new wt(Me.paint_model["model-translation"]),"model-color":new wt(Me.paint_model["model-color"]),"model-color-mix-intensity":new wt(Me.paint_model["model-color-mix-intensity"]),"model-type":new ht(Me.paint_model["model-type"]),"model-cast-shadows":new ht(Me.paint_model["model-cast-shadows"]),"model-receive-shadows":new ht(Me.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ht(Me.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wt(Me.paint_model["model-emissive-strength"]),"model-roughness":new wt(Me.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wt(Me.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ht(Me.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ht(Me.paint_model["model-front-cutoff"]),"model-elevation-reference":new ht(Me.paint_model["model-elevation-reference"]),"model-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new MI(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof M1?_t-1:0}queryRenderedFeatures(a,e,s){let u=e.getSource();if(!(u&&u instanceof Gp))return{};let d=u,m={};m[this.id]=[];let g=m[this.id],v=0;for(let b of d.models){let C=e.getFeatureState(this.sourceLayer,b.id),T={type:"Unknown",id:b.id,properties:b.featureProperties},I=this.paint.get("model-rotation").evaluate(T,C),D=this.paint.get("model-scale").evaluate(T,C),P=this.paint.get("model-translation").evaluate(T,C),R=this.paint.get("model-elevation-reference"),z=[];l1(z,b,s,b.position,I,D,P,R==="ground",R==="ground",!1),s.projection.name==="globe"&&(z=a1(z,s));let H=Ot([],s.projMatrix,z),$=QT(a.isPointQuery()?a.screenBounds:a.screenGeometry,s,H,b.aabb);if($!=null){let Z=new Hp(void 0,0,0,0,b.id);Z.layer=this.layer,Z.properties=structuredClone(b.featureProperties),Z.properties.layer=this.id,Z.properties.uri=b.uri,Z.properties.orientation=b.orientation,Z.sourceLayer=this.sourceLayer,Z.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},Z.state=C,Z.source=this.source,g.push({featureIndex:v,feature:Z,intersectionZ:$})}++v}return m}queryIntersectsFeature(a,e,s,u,d,m){if(!this.modelManager)return!1;let g=this.modelManager,v=a.tile.getBucket(this);if(!(v&&v instanceof MI))return!1;for(let b in v.instancesPerModel){let C=v.instancesPerModel[b],T=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(T)){let I=C.features[C.idToFeaturesIndex[T]],D=g.getModel(b,this.scope);if(!D)return!1;let P=[],R=new c(0,0),z=v.canonical,H=Number.MAX_VALUE;for(let $=0;$<I.instancedDataCount;++$){let Z=16*(I.instancedDataOffset+$),Y=C.instancedDataArray.float32,te=[Y[Z+4],Y[Z+5],Y[Z+6]];AI(z,R,Math.floor(Y[Z]),Math.floor(Y[Z+1])),l1(P,D,m,R,I.rotation,I.scale,te,!1,!1,!1),m.projection.name==="globe"&&(P=a1(P,m));let he=Ot([],m.projMatrix,P),ae=a.queryGeometry,me=QT(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,m,he,D.aabb);me!=null&&(H=Math.min(me,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(a,e,s){return!(!this.layout||e.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){let e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Yu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends cs{constructor(a,e,s,u){super(a,{layout:RO||(RO=new hr({"clip-layer-types":new ht(Me.layout_clip["clip-layer-types"]),"clip-layer-scope":new ht(Me.layout_clip["clip-layer-scope"])})),paint:kO||(kO=new hr({}))},e,s,u)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new FO(a)}is3D(a){return!0}}},PI=new ci(0,0,0),OI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},RI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},D1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},j6={PAINT_ORDER_FILL_AND_STROKE:1},L0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},rF={MASK_TYPE_LUMINANCE:1};function $6(a,e,s){a===1&&e.icons.push((function(u,d){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;let{metadata:g}=m;if(g.content_area){let{content_area:v}=g;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(g.text_placeholder){let{text_placeholder:v}=g;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return g.stretch_x&&g.stretch_x.length&&oF(g,"x"),g.stretch_y&&g.stretch_y.length&&oF(g,"y"),m})(u.readFields(H6,{name:void 0},d))})(s,s.readVarint()+s.pos))}function oF(a,e){let s=[],u=a[`stretch_${e}`],d=null;for(let m=0;m<u.length;m++)d===null?d=s.length===0?u[0]:s[s.length-1][1]+u[m]:(s.push([d,d+u[m]]),d=null);a[`stretch_${e}_areas`]=s}function H6(a,e,s){a===1?e.name=s.readString():a===2?e.metadata=(function(u,d){return u.readFields(G6,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(s,s.readVarint()+s.pos):a===3&&(e.usvg_tree=(function(u,d){return u.readFields(Z6,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(s,s.readVarint()+s.pos),e.data="usvg_tree")}function G6(a,e,s){a===1?e.stretch_x=s.readPackedVarint():a===2?e.stretch_y=s.readPackedVarint():a===3?e.content_area=sF(s,s.readVarint()+s.pos):a===4?e.variables.push((function(u,d){return u.readFields(W6,{name:void 0},d)})(s,s.readVarint()+s.pos)):a===5&&(e.text_placeholder=sF(s,s.readVarint()+s.pos))}function sF(a,e){return a.readFields(q6,{},e)}function q6(a,e,s){a===1?e.left=s.readVarint():a===2?e.width=s.readVarint():a===3?e.top=s.readVarint():a===4&&(e.height=s.readVarint())}function W6(a,e,s){a===1?e.name=s.readString():a===2&&(e.rgb_color=O1(s.readVarint()),e.value="rgb_color")}function Z6(a,e,s){a===1?e.width=e.height=s.readVarint():a===2?e.height=s.readVarint():a===3?e.children.push(A1(s,s.readVarint()+s.pos)):a===4?e.linear_gradients.push((function(u,d){return u.readFields(t8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(s,s.readVarint()+s.pos)):a===5?e.radial_gradients.push((function(u,d){return u.readFields(i8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(s,s.readVarint()+s.pos)):a===7?e.clip_paths.push((function(u,d){return u.readFields(r8,{children:[]},d)})(s,s.readVarint()+s.pos)):a===8&&e.masks.push((function(u,d){let m=u.readFields(o8,{left:0,width:20,mask_type:rF.MASK_TYPE_LUMINANCE,children:[]},d);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(s,s.readVarint()+s.pos))}function A1(a,e){return a.readFields(X6,{},e)}function X6(a,e,s){a===1?(e.group=(function(u,d){return u.readFields(Y6,{opacity:255,children:[]},d)})(s,s.readVarint()+s.pos),e.node="group"):a===2&&(e.path=(function(u,d){return u.readFields(Q6,{paint_order:1,commands:[],step:1,diffs:[],rule:OI.PATH_RULE_NON_ZERO},d)})(s,s.readVarint()+s.pos),e.node="path")}function Y6(a,e,s){a===1?e.transform=P1(s,s.readVarint()+s.pos):a===2?e.opacity=s.readVarint():a===5?e.clip_path_idx=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(A1(s,s.readVarint()+s.pos))}function P1(a,e){return a.readFields(K6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function K6(a,e,s){a===1?e.sx=s.readFloat():a===2?e.ky=s.readFloat():a===3?e.kx=s.readFloat():a===4?e.sy=s.readFloat():a===5?e.tx=s.readFloat():a===6&&(e.ty=s.readFloat())}function Q6(a,e,s){a===1?e.fill=(function(u,d){return u.readFields(J6,{rgb_color:PI,paint:"rgb_color",opacity:255},d)})(s,s.readVarint()+s.pos):a===2?e.stroke=(function(u,d){return u.readFields(e8,{rgb_color:PI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(s,s.readVarint()+s.pos):a===3?e.paint_order=s.readVarint():a===5?s.readPackedVarint(e.commands):a===6?e.step=s.readFloat():a===7?s.readPackedSVarint(e.diffs):a===8&&(e.rule=s.readVarint())}function J6(a,e,s){a===1?(e.rgb_color=O1(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=s.readVarint())}function O1(a){return new ci((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function e8(a,e,s){a===1?(e.rgb_color=O1(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5?s.readPackedFloat(e.dasharray):a===6?e.dashoffset=s.readFloat():a===7?e.miterlimit=s.readFloat():a===8?e.opacity=s.readVarint():a===9?e.width=s.readFloat():a===10?e.linecap=s.readVarint():a===11&&(e.linejoin=s.readVarint())}function t8(a,e,s){a===1?e.transform=P1(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(aF(s,s.readVarint()+s.pos)):a===4?e.x1=s.readFloat():a===5?e.y1=s.readFloat():a===6?e.x2=s.readFloat():a===7&&(e.y2=s.readFloat())}function aF(a,e){return a.readFields(n8,{offset:0,opacity:255,rgb_color:PI},e)}function n8(a,e,s){a===1?e.offset=s.readFloat():a===2?e.opacity=s.readVarint():a===3&&(e.rgb_color=O1(s.readVarint()))}function i8(a,e,s){a===1?e.transform=P1(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(aF(s,s.readVarint()+s.pos)):a===4?e.cx=s.readFloat():a===5?e.cy=s.readFloat():a===6?e.r=s.readFloat():a===7?e.fx=s.readFloat():a===8?e.fy=s.readFloat():a===9&&(e.fr=s.readFloat())}function r8(a,e,s){a===1?e.transform=P1(s,s.readVarint()+s.pos):a===2?e.clip_path_idx=s.readVarint():a===3&&e.children.push(A1(s,s.readVarint()+s.pos))}function o8(a,e,s){a===1?e.left=e.top=s.readFloat():a===2?e.width=e.height=s.readFloat():a===3?e.top=s.readFloat():a===4?e.height=s.readFloat():a===5?e.mask_type=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(A1(s,s.readVarint()+s.pos))}class s8{static calculate(e={},s=[]){let u=new Map,d=new Map;if(Object.keys(e).length===0)return u;s.forEach(m=>{d.set(m.name,m.rgb_color||new ci(0,0,0))});for(let[m,g]of Object.entries(e))d.has(m)?u.set(d.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return u}}function xg(a,e=255,s){let u=e/255,d=a.toString(),m=s.has(d)?s.get(d).clone():a.clone();return m.a*=u,m.toString()}function N0(a,e){if(!sl()){let s=document.createElement("canvas");return s.width=a,s.height=e,s}return new OffscreenCanvas(a,e)}let kI,z0=null;function FI(a,e,s,u,d){for(let m of u.children)lF(a,e,s,m,d)}function lF(a,e,s,u,d){u.group?(a.save(),(function(m,g,v,b,C){let T=b.mask_idx!=null?v.masks[b.mask_idx]:null,I=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(g=bg(b.transform).preMultiplySelf(g)),!(function(R,z,H){return R.opacity!==255||z||H})(b,I!=null,T!=null))return void FI(m,g,v,b,C);let D=N0(m.canvas.width,m.canvas.height),P=D.getContext("2d");FI(P,g,v,b,C),I&&mF(P,g,v,I),T&&gF(P,g,v,T,C),m.globalAlpha=b.opacity/255,m.drawImage(D,0,0)})(a,e,s,u.group,d),a.restore()):u.path&&(a.save(),(function(m,g,v,b,C){m.setTransform(g),b.paint_order===j6.PAINT_ORDER_FILL_AND_STROKE?(cF(m,v,b,C),dF(m,v,b,C)):(dF(m,v,b,C),cF(m,v,b,C))})(a,e,s,u.path,d),a.restore())}function cF(a,e,s,u){let d=s.fill;if(!d)return;let m=d.opacity/255;switch(a.save(),a.beginPath(),_F(s,a),d.paint){case"rgb_color":a.fillStyle=xg(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{let g=e.linear_gradients[d.linear_gradient_idx];g.transform&&a.setTransform(bg(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=hF(a,g,m,u);break}case"radial_gradient_idx":{let g=e.radial_gradients[d.radial_gradient_idx];g.transform&&a.setTransform(bg(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=pF(a,g,m,u)}}a.fill(uF(s)),a.restore()}function uF(a){return a.rule===OI.PATH_RULE_NON_ZERO?"nonzero":a.rule===OI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function dF(a,e,s,u){let d=s.stroke;if(!d)return;let m=vF(s);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;let g=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=xg(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=hF(a,e.linear_gradients[d.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":a.strokeStyle=pF(a,e.radial_gradients[d.radial_gradient_idx],g,u,!0)}switch(d.linejoin){case D1.LINE_JOIN_MITER_CLIP:case D1.LINE_JOIN_MITER:a.lineJoin="miter";break;case D1.LINE_JOIN_ROUND:a.lineJoin="round";break;case D1.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(d.linecap){case RI.LINE_CAP_BUTT:a.lineCap="butt";break;case RI.LINE_CAP_ROUND:a.lineCap="round";break;case RI.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(m)}function hF(a,e,s,u,d=!1){if(e.stops.length===1){let D=e.stops[0];return xg(D.rgb_color,D.opacity*s,u)}let{x1:m,y1:g,x2:v,y2:b}=e,C=new DOMPoint(m,g),T=new DOMPoint(v,b);if(d){let D=bg(e.transform);C=D.transformPoint(C),T=D.transformPoint(T)}let I=a.createLinearGradient(C.x,C.y,T.x,T.y);for(let D of e.stops)I.addColorStop(D.offset,xg(D.rgb_color,D.opacity*s,u));return I}function pF(a,e,s,u,d=!1){if(e.stops.length===1){let $=e.stops[0];return xg($.rgb_color,$.opacity*s,u)}let m=bg(e.transform),{fx:g,fy:v,fr:b,cx:C,cy:T,r:I}=e,D=new DOMPoint(g,v),P=new DOMPoint(C,T),R=b,z=I;if(d){D=m.transformPoint(D),P=m.transformPoint(P);let $=(m.a+m.d)/2;R=b*$,z=e.r*$}let H=a.createRadialGradient(D.x,D.y,R,P.x,P.y,z);for(let $ of e.stops)H.addColorStop($.offset,xg($.rgb_color,$.opacity*s,u));return H}function fF(a,e,s,u){let d=u.transform?bg(u.transform).preMultiplySelf(e):e,m=N0(a.canvas.width,a.canvas.height),g=m.getContext("2d");for(let b of u.children)if(b.group)fF(g,d,s,b.group);else if(b.path){let C=b.path,T=new Path2D;T.addPath(vF(C),d),g.fill(T,uF(C))}let v=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;v&&mF(g,d,s,v),a.globalCompositeOperation="source-over",a.drawImage(m,0,0)}function mF(a,e,s,u){let d=N0(a.canvas.width,a.canvas.height);fF(d.getContext("2d"),e,s,u),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function gF(a,e,s,u,d){if(u.children.length===0)return;let m=u.mask_idx!=null?s.masks[u.mask_idx]:null;m&&gF(a,e,s,m,d);let g=a.canvas.width,v=a.canvas.height,b=N0(g,v),C=b.getContext("2d"),T=u.width,I=u.height,D=u.left,P=u.top,R=new Path2D,z=new Path2D;z.rect(D,P,T,I),R.addPath(z,e),C.clip(R);for(let Z of u.children)lF(C,e,s,Z,d);let H=C.getImageData(0,0,g,v),$=H.data;if(u.mask_type===rF.MASK_TYPE_LUMINANCE)for(let Z=0;Z<$.length;Z+=4)$[Z+3]=$[Z+3]/255*(.2126*$[Z]+.7152*$[Z+1]+.0722*$[Z+2]);C.putImageData(H,0,0),a.globalCompositeOperation="destination-in",a.drawImage(b,0,0)}function bg(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function _F(a,e){let s=a.step,u=a.diffs[0]*s,d=a.diffs[1]*s;e.moveTo(u,d);for(let m=0,g=2;m<a.commands.length;m++)switch(a.commands[m]){case L0.PATH_COMMAND_MOVE:u+=a.diffs[g++]*s,d+=a.diffs[g++]*s,e.moveTo(u,d);break;case L0.PATH_COMMAND_LINE:u+=a.diffs[g++]*s,d+=a.diffs[g++]*s,e.lineTo(u,d);break;case L0.PATH_COMMAND_QUAD:{let v=u+a.diffs[g++]*s,b=d+a.diffs[g++]*s;u=v+a.diffs[g++]*s,d=b+a.diffs[g++]*s,e.quadraticCurveTo(v,b,u,d);break}case L0.PATH_COMMAND_CUBIC:{let v=u+a.diffs[g++]*s,b=d+a.diffs[g++]*s,C=v+a.diffs[g++]*s,T=b+a.diffs[g++]*s;u=C+a.diffs[g++]*s,d=T+a.diffs[g++]*s,e.bezierCurveTo(v,b,C,T,u,d);break}case L0.PATH_COMMAND_CLOSE:e.closePath()}return e}function vF(a){return _F(a,new Path2D)}class R1{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let s=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,s),s}put(e,s){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,s)}delete(e){this.cache.delete(e)}}kt(R1,"LRUCache");class LI{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new jo(e,e.data)}getFromCache(e,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new R1(150)),this.cacheMap.get(u).get(Ua(e.toString(),s))}setInCache(e,s,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new R1(150));let m=this.cacheDependenciesMap.get(d),g=Ua(e.id.toString(),u);m.get(g)||m.set(g,new Set);let v=this.cacheMap.get(d),b=e.toString();m.get(g).add(b),v.put(Ua(e.toString(),u),s)}removeImagesFromCacheByIds(e,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;let d=this.cacheMap.get(u),m=this.cacheDependenciesMap.get(u);for(let g of e){let v=Ua(g.toString(),s);if(m.has(v)){for(let b of m.get(v))d.delete(b);m.delete(v)}}}rasterize(e,s,u,d){let m=this.getFromCache(e,u,d);if(m)return m.clone();let g=(function(b,C){let T=s8.calculate(C.params,b.metadata?b.metadata.variables:[]),I=b.usvg_tree,D=I.width,P=I.height,R=Math.max(1,Math.round(D*C.sx)),z=Math.max(1,Math.round(P*C.sy)),H=new DOMMatrix([R/D,0,0,z/P,0,0]);return z0===null&&(z0=N0(10,10),kI=z0.getContext("2d",{willReadFrequently:!0})),z0.width=R,z0.height=z,FI(kI,H,I,I,T),kI.getImageData(0,0,R,z)})(s.icon,e),v=LI._getImage(g);return this.setInCache(e,v,u,d),v.clone()}}class yF{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){let u=this.toIdx(e,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function xF(a,e,s,u){let d=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<a[g]||s[g]>e[g])return null}else{let v=1/u[g],b=(a[g]-s[g])*v,C=(e[g]-s[g])*v;if(b>C){let T=b;b=C,C=T}if(b>d&&(d=b),C<m&&(m=C),d>m)return null}return d}function bF(a,e,s,u,d,m,g,v,b,C,T){let I=u-a,D=d-e,P=m-s,R=g-a,z=v-e,H=b-s,$=T[1]*H-T[2]*z,Z=T[2]*R-T[0]*H,Y=T[0]*z-T[1]*R,te=I*$+D*Z+P*Y;if(Math.abs(te)<1e-15)return null;let he=1/te,ae=C[0]-a,me=C[1]-e,ye=C[2]-s,we=(ae*$+me*Z+ye*Y)*he;if(we<0||we>1)return null;let je=me*P-ye*D,Te=ye*I-ae*P,qe=ae*D-me*I,Ye=(T[0]*je+T[1]*Te+T[2]*qe)*he;return Ye<0||we+Ye>1?null:(R*je+z*Te+H*qe)*he}function wF(a,e,s){return(a-e)/(s-e)}function CF(a,e,s,u,d,m,g,v,b){let C=1<<s,T=m-u,I=g-d,D=(a+1)/C*T+u,P=(e+0)/C*I+d,R=(e+1)/C*I+d;v[0]=(a+0)/C*T+u,v[1]=P,b[0]=D,b[1]=R}class EF{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let s=(function(m){let g=Math.ceil(Math.log2(m.dim/8)),v=[],b=Math.ceil(Math.pow(2,g)),C=1/b,T=(P,R,z,H,$)=>{let Z=H?1:0,Y=(P+1)*z-Z,te=R*z,he=(R+1)*z-Z;$[0]=P*z,$[1]=te,$[2]=Y,$[3]=he},I=new yF(b),D=[];for(let P=0;P<b*b;P++){T(P%b,Math.floor(P/b),C,!1,D);let R=hh(D[0],D[1],m),z=hh(D[2],D[1],m),H=hh(D[2],D[3],m),$=hh(D[0],D[3],m);I.minimums.push(Math.min(R,z,H,$)),I.maximums.push(Math.max(R,z,H,$)),I.leaves.push(1)}for(v.push(I),b/=2;b>=1;b/=2){let P=v[v.length-1];I=new yF(b);for(let R=0;R<b*b;R++){T(R%b,Math.floor(R/b),2,!0,D);let z=P.getElevation(D[0],D[1]),H=P.getElevation(D[2],D[1]),$=P.getElevation(D[2],D[3]),Z=P.getElevation(D[0],D[3]),Y=P.isLeaf(D[0],D[1]),te=P.isLeaf(D[2],D[1]),he=P.isLeaf(D[2],D[3]),ae=P.isLeaf(D[0],D[3]),me=Math.min(z.min,H.min,$.min,Z.min),ye=Math.max(z.max,H.max,$.max,Z.max),we=Y&&te&&he&&ae;I.maximums.push(ye),I.minimums.push(me),I.leaves.push(ye-me<=5&&we?1:0)}v.push(I)}return v})(this.dem),u=s.length-1,d=s[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(e,s,u,d,m,g,v=1){return xF([e,s,-100],[u,d,this.maximums[0]*v],m,g)}raycast(e,s,u,d,m,g,v=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,s,u,d,m,g,v);if(b==null)return null;let C=[],T=[],I=[],D=[],P=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:z,nodex:H,nodey:$,depth:Z}=P.pop();if(this.leaves[R]){CF(H,$,Z,e,s,u,d,I,D);let te=1<<Z,he=(H+0)/te,ae=(H+1)/te,me=($+0)/te,ye=($+1)/te,we=hh(he,me,this.dem)*v,je=hh(ae,me,this.dem)*v,Te=hh(ae,ye,this.dem)*v,qe=hh(he,ye,this.dem)*v,Ye=bF(I[0],I[1],we,D[0],I[1],je,D[0],D[1],Te,m,g),Ke=bF(D[0],D[1],Te,I[0],D[1],qe,I[0],I[1],we,m,g),rt=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Ke!==null?Ke:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{let st=$s([],m,g,z);if(SF(we,je,qe,Te,wF(st[0],I[0],D[0]),wF(st[1],I[1],D[1]))>=st[2])return z}continue}let Y=0;for(let te=0;te<this._siblingOffset.length;te++){CF((H<<1)+this._siblingOffset[te][0],($<<1)+this._siblingOffset[te][1],Z+1,e,s,u,d,I,D),I[2]=-100,D[2]=this.maximums[this.childOffsets[R]+te]*v;let he=xF(I,D,m,g);if(he!=null){let ae=he;C[te]=ae;let me=!1;for(let ye=0;ye<Y&&!me;ye++)ae>=C[T[ye]]&&(T.splice(ye,0,te),me=!0);me||(T[Y]=te),Y++}}for(let te=0;te<Y;te++){let he=T[te];P.push({idx:this.childOffsets[R]+he,t:C[he],nodex:(H<<1)+this._siblingOffset[he][0],nodey:($<<1)+this._siblingOffset[he][1],depth:Z+1})}}return null}_addNode(e,s,u){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,u,d,m){if(e[d].isLeaf(s,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let g=d-1,v=e[g],b=0,C=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*s+this._siblingOffset[T][0],D=2*u+this._siblingOffset[T][1],P=v.getElevation(I,D),R=v.isLeaf(I,D),z=this._addNode(P.min,P.max,R);R&&(b|=1<<T),C||(C=z)}for(let T=0;T<this._siblingOffset.length;T++)b&1<<T||this._construct(e,2*s+this._siblingOffset[T][0],2*u+this._siblingOffset[T][1],g,C+T)}}function SF(a,e,s,u,d,m){return on(on(a,s,m),on(e,u,m),d)}function hh(a,e,s){let u=s.dim,d=G(a*u-.5,0,u-1),m=G(e*u-.5,0,u-1),g=Math.floor(d),v=Math.floor(m),b=Math.min(g+1,u-1),C=Math.min(v+1,u-1);return SF(s.get(g,v),s.get(b,v),s.get(g,C),s.get(b,C),d-g,m-v)}let a8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function l8(a,e,s){return(256*a*256+256*e+s)/10-1e4}function c8(a,e,s){return 256*a+e+s/256-32768}class k1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,u,d=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Dt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;let m=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let b=0;b<m;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(m,b)]=g[this._idx(m-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,m)]=g[this._idx(b,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}let v=u==="terrarium"?c8:l8;for(let b=0;b<g.length;++b){let C=4*b;this.floatView[b]=v(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=oo.now()}_buildQuadTree(){this._tree=new EF(this)}get(e,s,u=!1){u&&(e=G(e,-1,this.dim),s=G(s,-1,this.dim));let d=this._idx(e,s);return this.floatView[d]}set(e,s,u){let d=this._idx(e,s),m=this.floatView[d];return this.floatView[d]=u,u-m}static getUnpackVector(e){return a8[e]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){let u=[0,0,0,0],d=k1.getUnpackVector(s),m=Math.floor((e+d[3])/d[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new yO({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,m=s*this.dim+this.dim,g=u*this.dim,v=u*this.dim+this.dim;switch(s){case-1:d=m-1;break;case 1:m=d+1}switch(u){case-1:g=v-1;break;case 1:v=g+1}let b=-s*this.dim,C=-u*this.dim;for(let T=g;T<v;T++)for(let I=d;I<m;I++){let D=4*this._idx(I,T),P=4*this._idx(I+b,T+C);this.pixels[D+0]=e.pixels[P+0],this.pixels[D+1]=e.pixels[P+1],this.pixels[D+2]=e.pixels[P+2],this.pixels[D+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function u8(a,e,s){a===1?e.headerLength=s.readFixed32():a===2?e.x=s.readVarint():a===3?e.y=s.readVarint():a===4?e.z=s.readVarint():a===5&&e.layers.push((function(u,d){return u.readFields(m8,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(s,s.readVarint()+s.pos))}function d8(a,e,s){a===1?(e.delta_filter=(function(u,d){return u.readFields(h8,{blockSize:0},d)})(s,s.readVarint()+s.pos),e.filter="delta_filter"):a===2?(s.readVarint(),e.filter="zigzag_filter"):a===3?(s.readVarint(),e.filter="bitshuffle_filter"):a===4&&(s.readVarint(),e.filter="byteshuffle_filter")}function h8(a,e,s){a===1&&(e.blockSize=s.readVarint())}function p8(a,e,s){a===1?(s.readVarint(),e.codec="gzip_data"):a===2?(s.readVarint(),e.codec="jpeg_image"):a===3?(s.readVarint(),e.codec="webp_image"):a===4&&(s.readVarint(),e.codec="png_image")}function f8(a,e,s){let u=0,d=0;a===1?e.firstByte=s.readFixed64():a===2?e.lastByte=s.readFixed64():a===3?e.filters.push((function(m,g){return m.readFields(d8,{},g)})(s,s.readVarint()+s.pos)):a===4?e.codec=(function(m,g){return m.readFields(p8,{},g)})(s,s.readVarint()+s.pos):a===5?d=s.readFloat():a===6?u=s.readFloat():a===7?e.bands.push(s.readString()):a===8?e.offset=s.readDouble():a===9&&(e.scale=s.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=u)}function m8(a,e,s){a===1?e.version=s.readVarint():a===2?e.name=s.readString():a===3?e.units=s.readString():a===4?e.tileSize=s.readVarint():a===5?e.buffer=s.readVarint():a===6?e.pixelFormat=s.readVarint():a===7&&e.dataIndex.push((function(u,d){return u.readFields(f8,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(s,s.readVarint()+s.pos))}function g8(a,e,s){if(a===2)(function(u,d,m){u.readFields(_8,m,d)})(s,s.readVarint()+s.pos,e);else if(a===3)throw new Error("Not implemented")}function _8(a,e,s){if(a===1){let u=0,d=s.readVarint()+s.pos;for(;s.pos<d;)e[u++]=s.readVarint()}}function v8(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let s=e[3];for(let u=2;u>=1;u--){let d=u===1?1:0,m=u===2?1:0;for(let g=0;g<e[0];g++){let v=e[1]*g;for(let b=d;b<e[1];b++){let C=e[2]*(b+v);for(let T=m;T<e[2];T++){let I=e[3]*(T+C);for(let D=0;D<e[3];D++){let P=I+D;a[P]+=a[P-s]}}}}s*=e[u]}return a}function y8(a){for(let e=0,s=a.length;e<s;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function x8(a,e){switch(e){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){let u=a[s],d=a[s+1];a[s]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,a[s+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){let u=a[s],d=a[s+1],m=a[s+2],g=a[s+3];a[s+0]=(192&u)>>6|(192&d)>>4|(192&m)>>2|192&g,a[s+1]=(48&u)>>4|(48&d)>>2|48&m|(48&g)<<2,a[s+2]=(12&u)>>2|12&d|(12&m)<<2|(12&g)<<4,a[s+3]=3&u|(3&d)<<2|(3&m)<<4|(3&g)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}kt(k1,"DEMData"),kt(EF,"DemMinMaxQuadTree",{omit:["dem"]});var Ga=Uint8Array,B0=Uint16Array,b8=Int32Array,TF=new Ga([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),IF=new Ga([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),w8=new Ga([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MF=function(a,e){for(var s=new B0(31),u=0;u<31;++u)s[u]=e+=1<<a[u-1];var d=new b8(s[30]);for(u=1;u<30;++u)for(var m=s[u];m<s[u+1];++m)d[m]=m-s[u]<<5|u;return{b:s,r:d}},DF=MF(TF,2),AF=DF.b,C8=DF.r;AF[28]=258,C8[258]=28;for(var E8=MF(IF,0).b,PF=new B0(32768),eo=0;eo<32768;++eo){var wg=(43690&eo)>>1|(21845&eo)<<1;PF[eo]=((65280&(wg=(61680&(wg=(52428&wg)>>2|(13107&wg)<<2))>>4|(3855&wg)<<4))>>8|(255&wg)<<8)>>1}var V0=function(a,e,s){for(var u=a.length,d=0,m=new B0(e);d<u;++d)a[d]&&++m[a[d]-1];var g,v=new B0(e);for(d=1;d<e;++d)v[d]=v[d-1]+m[d-1]<<1;g=new B0(1<<e);var b=15-e;for(d=0;d<u;++d)if(a[d])for(var C=d<<4|a[d],T=e-a[d],I=v[a[d]-1]++<<T,D=I|(1<<T)-1;I<=D;++I)g[PF[I]>>b]=C;return g},U0=new Ga(288);for(eo=0;eo<144;++eo)U0[eo]=8;for(eo=144;eo<256;++eo)U0[eo]=9;for(eo=256;eo<280;++eo)U0[eo]=7;for(eo=280;eo<288;++eo)U0[eo]=8;var OF=new Ga(32);for(eo=0;eo<32;++eo)OF[eo]=5;var S8=V0(U0,9),T8=V0(OF,5),NI=function(a){for(var e=a[0],s=1;s<a.length;++s)a[s]>e&&(e=a[s]);return e},cc=function(a,e,s){var u=e/8|0;return(a[u]|a[u+1]<<8)>>(7&e)&s},zI=function(a,e){var s=e/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&e)},I8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],uc=function(a,e,s){var u=new Error(e||I8[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,uc),!s)throw u;return u},M8=new Ga(0),D8=typeof TextDecoder<"u"&&new TextDecoder;try{D8.decode(M8,{stream:!0})}catch{}let A8={gzip_data:"gzip"};class xl extends Error{constructor(e){super(e),this.name="MRTError"}}let P8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},RF={uint32:1,uint16:2,uint8:4},O8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},BI;class F1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let s=this.layers[e];if(!s)throw new xl(`Layer '${e}' not found`);return s}getHeaderLength(e){let s=new Uint8Array(e),u=new DataView(e);if(s[0]!==13)throw new xl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){let s=new Uint8Array(e),u=this.getHeaderLength(e);if(s.length<u)throw new xl(`Expected header with length >= ${u} but got buffer of length ${s.length}`);let d=new BI(s.subarray(0,u)).readFields(u8,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new xl(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let m of d.layers)this.layers[m.name]=new kF(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let s=[],u=this.getLayer(e.layerName);for(let d of e.blockIndices){let m=u.dataIndex[d],g=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(u._blocksInProgress.has(d))continue;let b={layerName:u.name,firstByte:g,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map(C=>C.filter)};u._blocksInProgress.add(d),s.push(b)}return new FF(s,()=>{s.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,m)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),d)throw d;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class kF{constructor({version:e,name:s,units:u,tileSize:d,pixelFormat:m,buffer:g,dataIndex:v},b){if(this.version=e,this.version!==1)throw new xl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=s,this.units=u,this.tileSize=d,this.buffer=g,this.pixelFormat=P8[m],this.dataIndex=v,this.bandShape=[d+2*g,d+2*g,RF[this.pixelFormat]],this._decodedBlocks=new R1(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return RF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let s=e.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,e.data)}getBlockForBand(e){let s=0;switch(typeof e){case"string":for(let[u,d]of this.dataIndex.entries()){for(let[m,g]of d.bands.entries())if(g===e)return{bandIndex:s+m,blockIndex:u,blockBandIndex:m};s+=d.bands.length}break;case"number":for(let[u,d]of this.dataIndex.entries()){if(e>=s&&e<s+d.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-s};s+=d.bands.length}break;default:throw new xl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let s=1/0,u=-1/0,d=[],m=new Set;for(let g of e){let{blockIndex:v}=this.getBlockForBand(g);if(v<0)throw new xl(`Invalid band: ${JSON.stringify(g)}`);let b=this.dataIndex[v];d.includes(v)||d.push(v),m.add(v),s=Math.min(s,b.firstByte),u=Math.max(u,b.lastByte)}if(m.size>this.cacheSize)throw new xl(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:d}}hasBand(e){let{blockIndex:s}=this.getBlockForBand(e);return s>=0}hasDataForBand(e){let{blockIndex:s}=this.getBlockForBand(e);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(e){let{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(e);if(s<0)throw new xl(`Band not found: ${JSON.stringify(e)}`);let d=this._decodedBlocks.get(s.toString());if(!d)throw new xl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[s],g=this.bandShape.reduce((C,T)=>C*T,1),v=u*g,b=d.subarray(v,v+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}F1.setPbf=function(a){BI=a};class FF{constructor(e,s,u){this.tasks=e,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,s){this._finalized||(this._onComplete(e,s),this._finalized=!0)}}F1.performDecoding=function(a,e){let s=new Uint8Array(a);return Promise.all(e.tasks.map(u=>{let{layerName:d,firstByte:m,lastByte:g,pixelFormat:v,blockShape:b,blockIndex:C,filters:T,codec:I}=u,D=s.subarray(m,g+1),P=new Uint32Array(b[0]*b[1]*b[2]),R;if(I!=="gzip_data")throw new xl(`Unhandled codec: ${I}`);return R=(function(z,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((te=(function(me){me[0]==31&&me[1]==139&&me[2]==8||uc(6,"invalid gzip data");var ye=me[3],we=10;4&ye&&(we+=2+(me[10]|me[11]<<8));for(var je=(ye>>3&1)+(ye>>4&1);je>0;je-=!me[we++]);return we+(2&ye)})(Y=z))+8>Y.length&&uc(6,"invalid gzip data"),(function(me,ye,we,je){var Te=me.length;if(!Te||ye.f&&!ye.l)return we||new Ga(0);var qe=!we,Ye=qe||ye.i!=2,Ke=ye.i;qe&&(we=new Ga(3*Te));var rt,st,et=function(vi){var ei=we.length;if(vi>ei){var oi=new Ga(Math.max(2*ei,vi));oi.set(we),we=oi}},tt=ye.f||0,Ge=ye.p||0,$e=ye.b||0,nt=ye.l,vt=ye.d,ut=ye.m,Gt=ye.n,Tt=8*Te;do{if(!nt){tt=cc(me,Ge,1);var Pt=cc(me,Ge+1,3);if(Ge+=3,!Pt){var Nt=me[(We=4+((Ge+7)/8|0))-4]|me[We-3]<<8,Tn=We+Nt;if(Tn>Te){Ke&&uc(0);break}Ye&&et($e+Nt),we.set(me.subarray(We,Tn),$e),ye.b=$e+=Nt,ye.p=Ge=8*Tn,ye.f=tt;continue}if(Pt==1)nt=S8,vt=T8,ut=9,Gt=5;else if(Pt==2){var dt=cc(me,Ge,31)+257,zt=cc(me,Ge+10,15)+4,un=dt+cc(me,Ge+5,31)+1;Ge+=14;for(var Ln=new Ga(un),zn=new Ga(19),_n=0;_n<zt;++_n)zn[w8[_n]]=cc(me,Ge+3*_n,7);Ge+=3*zt;var _i=NI(zn),ce=(1<<_i)-1,pe=V0(zn,_i);for(_n=0;_n<un;){var We,ot=pe[cc(me,Ge,ce)];if(Ge+=15&ot,(We=ot>>4)<16)Ln[_n++]=We;else{var Ct=0,Et=0;for(We==16?(Et=3+cc(me,Ge,3),Ge+=2,Ct=Ln[_n-1]):We==17?(Et=3+cc(me,Ge,7),Ge+=3):We==18&&(Et=11+cc(me,Ge,127),Ge+=7);Et--;)Ln[_n++]=Ct}}var qt=Ln.subarray(0,dt),Xt=Ln.subarray(dt);ut=NI(qt),Gt=NI(Xt),nt=V0(qt,ut),vt=V0(Xt,Gt)}else uc(1);if(Ge>Tt){Ke&&uc(0);break}}Ye&&et($e+131072);for(var mn=(1<<ut)-1,Cn=(1<<Gt)-1,Sn=Ge;;Sn=Ge){var On=(Ct=nt[zI(me,Ge)&mn])>>4;if((Ge+=15&Ct)>Tt){Ke&&uc(0);break}if(Ct||uc(2),On<256)we[$e++]=On;else{if(On==256){Sn=Ge,nt=null;break}var rn=On-254;On>264&&(rn=cc(me,Ge,(1<<(Yn=TF[_n=On-257]))-1)+AF[_n],Ge+=Yn);var cn=vt[zI(me,Ge)&Cn],$n=cn>>4;if(cn||uc(3),Ge+=15&cn,Xt=E8[$n],$n>3){var Yn=IF[$n];Xt+=zI(me,Ge)&(1<<Yn)-1,Ge+=Yn}if(Ge>Tt){Ke&&uc(0);break}Ye&&et($e+131072);var Kn=$e+rn;if($e<Xt){var di=0-Xt,Ti=Math.min(Xt,Kn);for(di+$e<0&&uc(3);$e<Ti;++$e)we[$e]=(void 0)[di+$e]}for(;$e<Kn;++$e)we[$e]=we[$e-Xt]}}ye.l=nt,ye.p=Sn,ye.b=$e,ye.f=tt,nt&&(tt=1,ye.m=ut,ye.d=vt,ye.n=Gt)}while(!tt);return $e!=we.length&&qe?(rt=we,((st=$e)==null||st>rt.length)&&(st=rt.length),new Ga(rt.subarray(0,st))):we.subarray(0,$e)})(Y.subarray(te,-8),{i:2},new Ga((($=Y)[(Z=$.length)-4]|$[Z-3]<<8|$[Z-2]<<16|$[Z-1]<<24)>>>0))));var $,Z,Y,te;let he=A8[H];if(!he)throw new Error(`Unhandled codec: ${H}`);let ae=new globalThis.DecompressionStream(he);return new Response(new Blob([z]).stream().pipeThrough(ae)).arrayBuffer().then(me=>new Uint8Array(me))})(D,I).then(z=>((function(H,$){H.readFields(g8,$)})(new BI(z),P),new O8[v](P.buffer))),R.then(z=>{for(let H=T.length-1;H>=0;H--)switch(T[H]){case"delta_filter":v8(z,b);break;case"zigzag_filter":y8(z);break;case"bitshuffle_filter":x8(z,v);break;default:throw new xl(`Unhandled filter "${T[H]}"`)}return{layerName:d,blockIndex:C,data:z}}).catch(z=>{throw z})}))},kt(FF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),kt(F1,"MapboxRasterTile"),kt(kF,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class LF{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){let u=e[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class NF{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Yd(_t,16,0),this.featureIndexArray=new Yv,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,s,u,d,m,g=0,v=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,m,g);let C=this.grid;for(let T=0;T<s.length;T++){let I=s[T],D=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){let R=I[P];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}v!==0&&(D[0]-=v,D[1]-=v,D[2]+=v,D[3]+=v),D[0]<_t&&D[1]<_t&&D[2]>=0&&D[3]>=0&&C.insert(b,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ke(new d1(this.rawTileData)).layers,this.sourceLayerCoder=new LF(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s){let{tilespaceGeometry:u,transform:d,tileTransform:m,pixelPosMatrix:g,availableImages:v,worldview:b}=s;this.loadVTLayers(),this.serializedLayersCache.clear();let C=s.queryRadius?s.queryRadius:0,T=u.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(z,H,$,Z)=>us(u.bufferedTilespaceGeometry,z-C,H-C,$+C,Z+C));I.sort(R8);let D=null;d.elevation&&I.length>0&&(D=yg.create(d.elevation,this.tileID));let P={},R;for(let z=0;z<I.length;z++){let H=I[z];if(H===R)continue;R=H;let $=this.featureIndexArray.get(H),Z=null;this.is3DTile?this.loadMatchingModelFeature(P,$,e,u,d,b):this.loadMatchingFeature(P,$,e,v,b,(Y,te,he,ae=0)=>(Z||(Z=_e(Y,this.tileID.canonical,m)),te.queryIntersectsFeature(u,Y,he,Z,this.z,d,g,D,ae)))}return P}loadMatchingFeature(e,s,u,d,m,g){let{featureIndex:v,bucketIndex:b,sourceLayerIndex:C,layoutVertexArrayOffset:T}=s,I=this.bucketLayerIDs[b],D=u.layers,P=Object.keys(D);if(P.length&&!Rt(P,I))return;let R=u.sourceCache,z=this.sourceLayerCoder.decode(C),H=this.vtLayers[z].feature(v),$=this.getId(H,z);for(let Z=0;Z<I.length;Z++){let Y=I[Z];if(!D[Y])continue;let{styleLayer:te,targets:he}=D[Y],ae={};$!==void 0&&(ae=R.getFeatureState(te.sourceLayer,$));let me=!g||g(H,te,ae,T);if(!me)continue;let ye=new Hp(H,this.z,this.x,this.y,$);ye.tile=this.tileID.canonical,ye.state=ae;let we=this.serializedLayersCache.get(Y);we||(we=te.serialize(),we.id=Y,this.serializedLayersCache.set(Y,we)),ye.source=we.source,ye.sourceLayer=we["source-layer"],ye.layer=Object.assign({},we),ye.layer.paint=zF(we.paint,te.paint,H,ae,d),ye.layer.layout=zF(we.layout,te.layout,H,ae,d);let je=!1;for(let Te of he){this.updateFeatureProperties(ye,Te);let{filter:qe}=Te;if(qe){if(H.properties=ye.properties,qe.needGeometry){let Ye=Se(H,!0);if(!qe.filter(new Ni(this.tileID.overscaledZ,{worldview:m}),Ye,this.tileID.canonical))continue}else if(!qe.filter(new Ni(this.tileID.overscaledZ,{worldview:m}),H))continue}je=!0,Te.targetId&&this.addFeatureVariant(ye,Te)}je&&this.appendToResult(e,Y,v,ye,me)}}loadMatchingModelFeature(e,s,u,d,m,g){let{featureIndex:v,bucketIndex:b}=s,C=this.bucketLayerIDs[b],T=u.layers,I=Object.keys(T);if(!I.length||Rt(I,C))for(let D=0;D<C.length;D++){let P=C[D],{styleLayer:R,targets:z}=T[P];if(R.type!=="model")continue;let H=d.tile,$=H.getBucket(R);if(!($&&$ instanceof M1))continue;let Z=V6($,v,d,m);if(!Z)continue;let{z:Y,x:te,y:he}=H.tileID.canonical,{feature:ae,intersectionZ:me,position:ye}=Z,we={};ae.id!==void 0&&(we=u.sourceCache.getFeatureState(R.sourceLayer,ae.id));let je=new Hp({},Y,te,he,ae.id);je.tile=this.tileID.canonical,je.state=we,je.properties=ae.properties,je.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Te=this.serializedLayersCache.get(P);Te||(Te=R.serialize(),Te.id=P,this.serializedLayersCache.set(P,Te)),je.source=Te.source,je.sourceLayer=Te["source-layer"],je.layer=Object.assign({},Te);let qe=!1;for(let Ye of z){this.updateFeatureProperties(je,Ye);let{filter:Ke}=Ye;if(Ke){if(ae.properties=je.properties,Ke.needGeometry){if(!Ke.filter(new Ni(this.tileID.overscaledZ,{worldview:g}),ae,this.tileID.canonical))continue}else if(!Ke.filter(new Ni(this.tileID.overscaledZ,{worldview:g}),ae))continue}qe=!0,Ye.targetId&&this.addFeatureVariant(je,Ye)}qe&&this.appendToResult(e,P,v,je,me)}}updateFeatureProperties(e,s,u){if(s.properties){let d={};for(let m in s.properties){let g=s.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);g!=null&&(d[m]=g)}e.properties=d}}addFeatureVariant(e,s,u){let d={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[s.targetId]=e.variants[s.targetId]||[],e.variants[s.targetId].push(d)}appendToResult(e,s,u,d,m){let g=e[s];g===void 0&&(g=e[s]=[]),g.push({featureIndex:u,feature:d,intersectionZ:m})}lookupSymbolFeatures(e,s,u,d,m,g){let v={};this.loadVTLayers();for(let b of e)this.loadMatchingFeature(v,{bucketIndex:s,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},d,m,g);return v}loadFeature(e){let{featureIndex:s,sourceLayerIndex:u}=e;this.loadVTLayers();let d=this.sourceLayerCoder.decode(u),m=this.vtFeatures[d];if(m[s])return m[s];let g=this.vtLayers[d].feature(s);return m[s]=g,g}hasLayer(e){for(let s of this.bucketLayerIDs)for(let u of s)if(e===u)return!0;return!1}getId(e,s){let u=e.id;if(this.promoteId){let d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){let m=Wc(d);if(m.result!=="success"){let g=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Dt(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function zF(a,e,s,u,d){return Ne(a,(m,g)=>{let v=e instanceof Ju?e.get(g):null;return v&&v.evaluate?v.evaluate(s,u,void 0,d):v})}function R8(a,e){return e-a}kt(NF,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let BF=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VI{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,u]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);let m=BF[15&u];if(!m)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new VI(v,g,m,e)}constructor(e,s=64,u=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=BF.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=s,u}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return UI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:g,nodeSize:v}=this,b=[0,m.length-1,0],C=[];for(;b.length;){let T=b.pop()||0,I=b.pop()||0,D=b.pop()||0;if(I-D<=v){for(let H=D;H<=I;H++){let $=g[2*H],Z=g[2*H+1];$>=e&&$<=u&&Z>=s&&Z<=d&&C.push(m[H])}continue}let P=D+I>>1,R=g[2*P],z=g[2*P+1];R>=e&&R<=u&&z>=s&&z<=d&&C.push(m[P]),(T===0?e<=R:s<=z)&&(b.push(D),b.push(P-1),b.push(1-T)),(T===0?u>=R:d>=z)&&(b.push(P+1),b.push(I),b.push(1-T))}return C}within(e,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:m,nodeSize:g}=this,v=[0,d.length-1,0],b=[],C=u*u;for(;v.length;){let T=v.pop()||0,I=v.pop()||0,D=v.pop()||0;if(I-D<=g){for(let H=D;H<=I;H++)UF(m[2*H],m[2*H+1],e,s)<=C&&b.push(d[H]);continue}let P=D+I>>1,R=m[2*P],z=m[2*P+1];UF(R,z,e,s)<=C&&b.push(d[P]),(T===0?e-u<=R:s-u<=z)&&(v.push(D),v.push(P-1),v.push(1-T)),(T===0?e+u>=R:s+u>=z)&&(v.push(P+1),v.push(I),v.push(1-T))}return b}}function UI(a,e,s,u,d,m){if(d-u<=s)return;let g=u+d>>1;VF(a,e,g,u,d,m),UI(a,e,s,u,g-1,1-m),UI(a,e,s,g+1,d,1-m)}function VF(a,e,s,u,d,m){for(;d>u;){if(d-u>600){let C=d-u+1,T=s-u+1,I=Math.log(C),D=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*D*(C-D)/C)*(T-C/2<0?-1:1);VF(a,e,s,Math.max(u,Math.floor(s-T*D/C+P)),Math.min(d,Math.floor(s+(C-T)*D/C+P)),m)}let g=e[2*s+m],v=u,b=d;for(j0(a,e,u,s),e[2*d+m]>g&&j0(a,e,u,d);v<b;){for(j0(a,e,v,b),v++,b--;e[2*v+m]<g;)v++;for(;e[2*b+m]>g;)b--}e[2*u+m]===g?j0(a,e,u,b):(b++,j0(a,e,b,d)),b<=s&&(u=b+1),s<=b&&(d=b-1)}}function j0(a,e,s,u){jI(a,s,u),jI(e,2*s,2*u),jI(e,2*s+1,2*u+1)}function jI(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}function UF(a,e,s,u){let d=a-s,m=e-u;return d*d+m*m}i.$=Jf,i.A=Hl,i.B=Ua,i.C=2,i.D=sg,i.E=Hu,i.F=C0,i.G=pk,i.H=Qf,i.I=Yo,i.J=Tb,i.K=Ht,i.L=Nd,i.M=Cm,i.N=xp,i.O=pb,i.P=it,i.Q=bp,i.R=Jh,i.S=Rm,i.T=YT,i.U=Wc,i.V=I1,i.W=Av,i.X=jd,i.Y=Ud,i.Z=fp,i._=as,i.a=function(a){return kn.API_CDN_URL_REGEX.test(a)},i.a$=F,i.a0=ln,i.a1=ha,i.a2=ml,i.a3=class extends I1{},i.a4=Em,i.a5=hb,i.a6=Me,i.a7=function(a){let e=a.value;return e?ln(e)?II(e,!0)?[]:[new I1(a.key,e,`invalid url "${e}"`)]:[new I1(a.key,e,`string expected, "${Ht(e)}" found`)]:[]},i.a8=wb,i.a9=hr,i.aA=G,i.aB=Ot,i.aC=Lo,i.aD=Bo,i.aE=Ei,i.aF=w,i.aG=ee,i.aH=function(a,e){let s={};for(let u=0;u<e.length;u++){let d=e[u];d in a&&(s[d]=a[d])}return s},i.aI=f,i.aJ=S,i.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,s,u){let d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){let[m,g]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,g)},e):u(m,g),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=s((m,g)=>{d.result=[m,g];for(let v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,g)},e):v(m,g);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},i.aL=function(a,e,s){let u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{let m=$l(a.request,(g,v,b)=>{g?d(g):v&&d(null,{rawData:v,vectorTile:s?void 0:new ke(new d1(v)),responseHeaders:new Map(b.entries())})});return()=>{m.cancel(),d()}},e)},i.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=Rs,i.aO=function(a){da++,da>jf&&(a.getActor().send("enforceCacheSizeLimit",Uf),da=0)},i.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},i.aQ=lr,i.aR=jk,i.aS=Zk,i.aT=c,i.aU=Uk,i.aV=function(a,e){let s=document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let u=0;u<a.length;u++){let d=document.createElement("source");HS(a[u])||(s.crossOrigin="Anonymous"),d.src=a[u],s.appendChild(d)}return{cancel:()=>{}}},i.aW=v0,i.aX=Gp,i.aY=Ie,i.aZ=I0,i.a_=A,i.aa=ht,i.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return gn(a.expression.evaluate(e))}interpolate(a,e,s){return{x:on(a.x,e.x,s),y:on(a.y,e.y,s),z:on(a.z,e.z,s),azimuthal:on(a.azimuthal,e.azimuthal,s),polar:on(a.polar,e.polar,s)}}},i.ac=Ni,i.ad=Yu,i.ae=J,i.af=Pr,i.ag=ho,i.ah=X,i.ai=Ju,i.aj=ah,i.ak=on,i.al=_t,i.am=J_,i.an=Zn,i.ao=ci,i.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return(function([s,u]){let d=gn([1,s,u]);return{x:d.x,y:d.y,z:d.z}})(a.expression.evaluate(e))}interpolate(a,e,s){return{x:on(a.x,e.x,s),y:on(a.y,e.y,s),z:on(a.z,e.z,s)}}},i.aq=function(a,e,s=0,u=!0){let d=new it(s,s),m=a.sub(d),g=e.add(d),v=[m,new it(g.x,m.y),g,new it(m.x,g.y)];return u&&v.push(m.clone()),v},i.ar=function(a,e){let s=[];for(let u=0;u<a.length;u++){let d=oe(u-1,-1,a.length-1),m=oe(u+1,-1,a.length-1),g=a[u],v=a[m],b=a[d].sub(g).unit(),C=v.sub(g).unit(),T=C.angleWithSep(b.x,b.y),I=b.add(C).unit().mult(-1*e/Math.sin(T/2));s.push(g.add(I))}return s},i.as=Tk,i.at=us,i.au=function(a,e,s=0){return vr(((e.x-s)*a.scale-a.x)*_t,(e.y*a.scale-a.y)*_t,k(e.z,e.y))},i.av=kr,i.aw=ji,i.ax=Lt,i.ay=UR,i.az=function(a){let e=1/0,s=1/0,u=-1/0,d=-1/0;for(let m of a)e=Math.min(e,m.x),s=Math.min(s,m.y),u=Math.max(u,m.x),d=Math.max(d,m.y);return{min:new it(e,s),max:new it(u,d)}},i.b=function(a){return kn.API_FONTS_REGEX.test(a)},i.b$=UO,i.b0=qr,i.b1=Jd,i.b2=Ee,i.b3=Fb,i.b4=C1,i.b5=function(){Kl.isLoading()||Kl.isLoaded()||Tp()!=="deferred"||bb()},i.b6=km,i.b7=Se,i.b8=Hp,i.b9=dr,i.bA=gt,i.bB=So,i.bC=Qe,i.bD=function(a,e){let{x:s,y:u}=a.point,d=sO(s,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Ot(d,d,ST(Ha(e)))},i.bE=N,i.bF=Os,i.bG=Lf,i.bH=$s,i.bI=Fo,i.bJ=Sr,i.bK=fg,i.bL=Ks,i.bM=fI,i.bN=function(a,e,s,u,d){let m=5*e+2;a.float32[m+0]=s,a.float32[m+1]=u,a.float32[m+2]=d},i.bO=vg,i.bP=vs,i.bQ=Ul,i.bR=kc,i.bS=zf,i.bT=oe,i.bU=function(a,e,s,u){var d=new O(4);return d[0]=a,d[1]=e,d[2]=s,d[3]=u,d},i.bV=class{isDataAvailableAtPoint(a){let e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;let s=e.getSource().maxzoom,u=1<<s,d=Math.floor(a.x),m=Math.floor((a.x-d)*u),g=Math.floor(a.y*u),v=this.findDEMTileFor(new lr(s,d,s,m,g));return!(!v||!v.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let u=this._source();if(!u||a.y<0||a.y>1)return e;let d=u.getSource().maxzoom,m=1<<d,g=Math.floor(a.x),v=a.x-g,b=new lr(d,g,d,Math.floor(v*m),Math.floor(a.y*m)),C=this.findDEMTileFor(b);if(!C||!C.dem)return e;let T=C.dem,I=1<<C.tileID.canonical.z,D=(v*I-C.tileID.canonical.x)*T.dim,P=(a.y*I-C.tileID.canonical.y)*T.dim,R=Math.floor(D),z=Math.floor(P);return(s?this.exaggeration():1)*on(on(T.get(R,z),T.get(R,z+1),P-z),on(T.get(R+1,z),T.get(R+1,z+1),P-z),D-R)}static getAtTileOffset(a,e,s,u){let d=1<<a.canonical.z;return u?u.pointElevation(e):s?s.getAtPointOrZero(new J(a.wrap+(a.canonical.x+e.x/_t)/d,(a.canonical.y+e.y/_t)/d)):0}static getAtTileOffsetFunc(a,e,s,u){return(d,m,g)=>{let v=this.getAtTileOffset(a,d,m,g),b=u.upVector(a.canonical,d.x,d.y);return ur(b,b,v*u.upVectorScale(a.canonical,e,s).metersToTile),b}}getForTilePoints(a,e,s,u){if(this.isUsingMockSource())return!1;let d=yg.create(this,a,u);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(a);if(!e||!e.dem)return null;let s=e.dem.tree,u=e.tileID,d=1<<a.canonical.z-u.canonical.z,m=a.canonical.x/d-u.canonical.x,g=a.canonical.y/d-u.canonical.y,v=0;for(let b=0;b<a.canonical.z-u.canonical.z&&!s.leaves[v];b++){m*=2,g*=2;let C=2*Math.floor(g)+Math.floor(m);v=s.childOffsets[v]+C,m%=1,g%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(let d of a){let m=this.getMinMaxForTile(d.tileID);m&&(s=Math.min(s,m.min),u=Math.max(u,m.max),e=!0)}return e?{min:s,max:u}:null}},i.bW=Jb,i.bX=Wn,i.bY=ao,i.bZ=NO,i.b_=Xk,i.ba=oI,i.bb=FT,i.bc=_e,i.bd=Xc,i.be=Kc,i.bf=oh,i.bg=Ji,i.bh=rg,i.bi=SI,i.bj=function(a,e){let s=ah(e.zoom);if(s===0)return Ha(a);let u=jb(a),d=ET(u),m=w(u.getWest())*e.worldSize,g=w(u.getEast())*e.worldSize,v=S(u.getNorth())*e.worldSize,b=S(u.getSouth())*e.worldSize,C=[m,v,0],T=[g,v,0],I=[m,b,0],D=[g,b,0],P=jt([],e.globeMatrix);return Pr(C,C,P),Pr(T,T,P),Pr(I,I,P),Pr(D,D,P),d[0]=oc(d[0],I,s),d[1]=oc(d[1],D,s),d[2]=oc(d[2],T,s),d[3]=oc(d[3],C,s),Ut.fromPoints(d)},i.bk=Hb,i.bl=jt,i.bm=n0,i.bn=oc,i.bo=Qd,i.bp=Np,i.bq=is,i.br=Kt,i.bs=F1,i.bt=d1,i.bu=$l,i.bv=function(a,e){let s=[];for(let u in a)u in e||s.push(u);return s},i.bw=xe,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=jl,i.bz=Fe,i.c=To,i.c$=function(a,e,s){let u=0;for(let d=0;d<2;++d)a[d]>0&&(u+=(a[d]-0)*(a[d]-0)),e[d]<0&&(u+=(0-e[d])*(0-e[d]));return u},i.c0=jO,i.c1=dI,i.c2=xk,i.c3=yI,i.c4=VI,i.c5=ur,i.c6=Pd,i.c7=Od,i.c8=function(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+d*v,a[1]=d*b-u*v,a[2]=m*b+g*v,a[3]=g*b-m*v,a},i.c9=Ra,i.cA=gi,i.cB=Jn,i.cC=TR,i.cD=Si,i.cE=iO,i.cF=function(a,e,s,u,d,m,g,v,b){if(b.name==="globe")return iO(a,e,new Si(s,u,d),!1);let C=I0({z:s,x:u,y:d},b);return new Ut([(m+C.x/C.scale)*e,e*(C.y/C.scale),g],[(m+C.x2/C.scale)*e,e*(C.y2/C.scale),v])},i.cG=function(a,e,s){return a[0]=Math.min(e[0],s[0]),a[1]=Math.min(e[1],s[1]),a[2]=Math.min(e[2],s[2]),a[3]=Math.min(e[3],s[3]),a},i.cH=function(a,e,s){return a[0]=Math.max(e[0],s[0]),a[1]=Math.max(e[1],s[1]),a[2]=Math.max(e[2],s[2]),a[3]=Math.max(e[3],s[3]),a},i.cI=function(a){let e=Math.round((a+45+360)%360/90)%4;return X_[e]},i.cJ=L,i.cK=Oc,i.cL=ig,i.cM=function(a){let e=gt(new Float64Array(16));Ot(e,a.pixelMatrix,a.globeMatrix);let s=[0,va,0],u=[0,ya,0];return Pr(s,s,e),Pr(u,u,e),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!IT(a,new c(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!IT(a,new c(a.center.lat,-90))]},i.cN=function(a,e){let{scale:s}=a.tileTransform,u=s*_t/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(d,m,g){var v=m[1],b=m[2],C=m[3],T=g[0],I=g[1];return d[0]=m[0]*T,d[1]=v*T,d[2]=b*I,d[3]=C*I,d})(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},i.cO=o1,i.cP=Wh,i.cQ=SR,i.cR=function(a){let e=SR(a,!0);return N([],[e[0],e[1],e[4],e[5]])},i.cS=Hn,i.cT=St,i.cU=Er,i.cV=function(a){let{x:e,y:s}=a.point,{lng:u,lat:d}=a._center;return sO(e,s,a.worldSize,u,d)},i.cW=Pa,i.cX=Zo,i.cY=tr,i.cZ=Io,i.c_=_a,i.ca=yr,i.cb=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},i.cc=qh,i.cd=function(a,e,s,u,d){var m=1/Math.tan(e/2);if(a[0]=m/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=m,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0){var g=1/(u-d);a[10]=(d+u)*g,a[14]=2*d*u*g}else a[10]=-1,a[14]=-2*u;return a},i.ce=function(a,e,s,u,d,m,g){var v=1/(e-s),b=1/(u-d),C=1/(m-g);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*C,a[11]=0,a[12]=(e+s)*v,a[13]=(d+u)*b,a[14]=(g+m)*C,a[15]=1,a},i.cf=M,i.cg=function(a,e,s){a[4*e+0]=s[0],a[4*e+1]=s[1],a[4*e+2]=s[2],a[4*e+3]=s[3]},i.ch=Jm,i.ci=Pp,i.cj=Wr,i.ck=vl,i.cl=Rp,i.cm=Pk,i.cn=function(){var a=new O(4);return O!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},i.co=function(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+m*v,a[1]=d*b+g*v,a[2]=u*-v+m*b,a[3]=d*-v+g*b,a},i.cp=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},i.cq=Wo,i.cr=function(a){var e=a[0],s=a[1],u=a[2],d=a[3];return Math.sqrt(e*e+s*s+u*u+d*d)},i.cs=ku,i.ct=Pc,i.cu=Or,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Au,i.d=function(a){return kn.API_TILEJSON_REGEX.test(a)},i.d$=class{constructor(a,e,s,u){this.context=a,this.format=u,this.size=s,this.texture=a.gl.createTexture();let[d,m,g]=this.size,{gl:v}=a;v.bindTexture(v.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,m,g,0,ZT(this.format),XT(this.format),e.data)}bind(a,e){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},i.d0=function(a){return a*a*a*a*a},i.d1=x,i.d2=45,i.d3=eg,i.d4=function(a,e,s){let u=Math.sqrt(a*a+e*e+s*s),d=u>0?Math.acos(s/u)*Nu:0,m=a!==0||e!==0?Math.atan2(-e,-a)*Nu+90:0;return m<0&&(m+=360),[u,m,d]},i.d5=vr,i.d6=gn,i.d7=q,i.d8=jr,i.d9=Ut,i.dA=function(a){return a({pluginStatus:ls,pluginURL:Yl}),Pm.on("pluginStateChange",a),a},i.dB=Op,i.dC=class extends Jl{constructor(a){super(a),this.current=tg}set(a,e,s){if(this.fetchUniformLocation(a,e)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},i.dD=zu,i.dE=function(a,e,s){let u=ah(s.zoom),d=a.style.map._antialias,m=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!d&&!m},i.dF=function(a){let e=a.pixelsPerMeter,s=e/M(1,a.center.lat),u=gt(new Float64Array(16));return Kt(u,u,[a.point.x,a.point.y,0]),Hn(u,u,[s,s,e]),Float32Array.from(u)},i.dG=jb,i.dH=function(a){let e=L-5;a=G(a,-e,e)/e*90;let s=Math.pow(Math.abs(Math.sin(Zn(a))),3);return Math.round(s*(t0.length-1))},i.dI=function(a,e,s,u){let d=e.getNorth(),m=e.getSouth(),g=e.getWest(),v=e.getEast(),b=1<<a.z,C=v-g,T=d-m,I=C/ih,D=-T/t0[s],P=[0,I,0,D,0,0,d,g,0];if(a.z>0){let R=180/u;De(P,P,[R/C+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/D,1])}return P[2]=b,P[5]=a.x,P[8]=a.y,P},i.dJ=Ha,i.dK=function(a,e,s){let u=gt(new Float64Array(16)),d=(e/(1<<a)-.5)*Math.PI*2;return _r(u,s.globeMatrix,d),Float32Array.from(u)},i.dL=yO,i.dM=yl,i.dN=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},i.dO=K,i.dP=function(a,e){var s=Math.sin(e),u=Math.cos(e);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},i.dQ=Ac,i.dR=oO,i.dS=Gn,i.dT=sr,i.dU=256,i.dV=function(a,e){let s=[0,0,0];return Pr(s,s,Hb(Ha(e.canonical))),Pr(s,s,a),s},i.dW=a=>({u_matrix:new Rp(a),u_texsize:new vl(a),u_pixels_to_tile_units:new ng(a),u_device_pixel_ratio:new Wr(a),u_width_scale:new Wr(a),u_floor_width_scale:new Wr(a),u_image:new Jm(a),u_units_to_pixels:new vl(a),u_tile_units_to_pixels:new Wr(a),u_alpha_discard_threshold:new Wr(a),u_trim_offset:new vl(a),u_trim_fade_range:new vl(a),u_trim_color:new eg(a),u_zbias_factor:new Wr(a),u_tile_to_meter:new Wr(a),u_ground_shadow_factor:new Pp(a),u_pattern_transition:new Wr(a)}),i.dX=a=>({u_matrix:new Rp(a),u_pixels_to_tile_units:new ng(a),u_device_pixel_ratio:new Wr(a),u_width_scale:new Wr(a),u_floor_width_scale:new Wr(a),u_units_to_pixels:new vl(a),u_dash_image:new Jm(a),u_gradient_image:new Jm(a),u_image_height:new Wr(a),u_texsize:new vl(a),u_tile_units_to_pixels:new Wr(a),u_alpha_discard_threshold:new Wr(a),u_trim_offset:new vl(a),u_trim_fade_range:new vl(a),u_trim_color:new eg(a),u_zbias_factor:new Wr(a),u_tile_to_meter:new Wr(a),u_ground_shadow_factor:new Pp(a)}),i.dY=a=>({u_camera_to_center_distance:new Wr(a),u_extrude_scale:new ng(a),u_device_pixel_ratio:new Wr(a),u_matrix:new Rp(a),u_inv_rot_matrix:new Rp(a),u_merc_center:new vl(a),u_tile_id:new Pp(a),u_zoom_transition:new Wr(a),u_up_dir:new Pp(a),u_emissive_strength:new Wr(a)}),i.dZ=Hm,i.d_=Hj,i.da=il,i.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},i.dc=ER,i.dd=nI,i.de=DR,i.df=II,i.dg=function(a,e){return a.readFields($6,{icons:[]},e)},i.dh=t1,i.di=mg,i.dj=gI,i.dk=Gf,i.dl=Sp,i.dm=kd,i.dn=Wf,i.dp=Xe,i.dq=function(a){let e=a.indexOf(nd);return e>=0?a.slice(0,e):a},i.dr=function(a){return a.indexOf(nd)>=0},i.ds=function(a){let e=a.lastIndexOf(nd);return e>=0?a.slice(e+1):""},i.dt=function(a){let e=[],s=a.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},i.du=function(a,e,s,u){return a.type==="custom"?new L6(a,e):new U6[a.type](a,e,s,u)},i.dv=at,i.dw=function(a){let e=a.indexOf(nd);return e>=0?a.slice(e+1):""},i.dx=class extends Hp{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){let a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},i.dy=Pm,i.dz=$u,i.e=kn,i.e$=Yi,i.e0=cO,i.e1=(a,e,s,u,d,m)=>{let g=a.transform,v=g.projection.name==="globe",b;if(m.paint.get("circle-pitch-alignment")==="map")if(v){let T=oO(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([T,0,0,T])}else b=g.calculatePixelsToTileUnitsMatrix(s);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let C={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(g.projection),u_matrix:a.translatePosMatrix(e.projMatrix,s,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:oo.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:s5,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){C.u_inv_rot_matrix=u,C.u_merc_center=d,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=ah(g.zoom);let T=d[0]*_t,I=d[1]*_t;C.u_up_dir=g.projection.upVector(new Si(0,0,0),T,I)}return C},i.e2=GR,i.e3=ss,i.e4=(a,e,s,u,d,m,g,v,b,C)=>{let T=a.transform,I=T.pitch<15?jR(.07,.7,G((14-T.zoom)/5,0,1)):.07,D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:HR(a,e,s,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:$R(e,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:I,u_tile_to_meter:q(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:C}},i.e5=(a,e,s,u,d,m,g,v,b,C)=>{let T=a.transform,I=T.calculatePixelsToTileUnitsMatrix(e),D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=T.pitch<15?jR(.07,.7,G((14-T.zoom)/5,0,1)):.07;return{u_matrix:HR(a,e,s,u),u_pixels_to_tile_units:I,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:qR(s)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$R(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:P,u_tile_to_meter:q(e.tileID.canonical,0),u_ground_shadow_factor:C}},i.e6=ze,i.e7=i0,i.e8=k,i.e9=ba,i.eA=function(a,e){var s=2*Math.acos(e[3]),u=Math.sin(s/2);return u>E?(a[0]=e[0]/u,a[1]=e[1]/u,a[2]=e[2]/u):(a[0]=1,a[1]=0,a[2]=0),s},i.eB=AI,i.eC=l1,i.eD=a1,i.eE=[1,1,1],i.eF=yg,i.eG=Pu,i.eH=function(a,e,s,u){var d=e[0],m=e[1],g=e[2],v=e[3];return a[0]=d+u*(s[0]-d),a[1]=m+u*(s[1]-m),a[2]=g+u*(s[2]-g),a[3]=v+u*(s[3]-v),a},i.eI=ug,i.eJ=Zs,i.eK=_l,i.eL=function(a,e,s,u,d,m,g,v,b,C,T,I,D,P,R,z){var H=new O(16);return H[0]=a,H[1]=e,H[2]=s,H[3]=u,H[4]=d,H[5]=m,H[6]=g,H[7]=v,H[8]=b,H[9]=C,H[10]=T,H[11]=I,H[12]=D,H[13]=P,H[14]=R,H[15]=z,H},i.eM=p,i.eN=th,i.eO=Gv,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new it(1/0,1/0),max:new it(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){let s=BO(new it(0,0),new it(_t,_t),a),u=[];if(e&&!LT(s,this._globalClipBounds))return u;for(let d of this._activeRegions){if(d.hiddenByOverlap||!LT(s,d))continue;let m=F5(d.min,d.max,a);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let s=[];for(let u of e.cache.getVisibleCoordinates()){let d=e.cache.getTile(u).buckets[e.layer];d&&d.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){let e=a.getFootprints();if(e.length===0)return;let s=a.getOrder(),u=a.getClipMask(),d=a.getClipScope();for(let m of e){if(!m.footprint)continue;let g=BO(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:s,clipMask:u,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,s)=>e.priority-s.priority||Xb(e.min,s.min)||Xb(e.max,s.max)||e.order-s.order||e.clipMask-s.clipMask||(function(u,d){let m=(g,v)=>g+v;return u.length-d.length||u.reduce(m,"").localeCompare(d.reduce(m,""))})(e.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){let s=this._activeRegions[e],u=this._prevRegions[e];a=s.priority!==u.priority||!zO(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!jl(s.clipScope,u.clipScope),this._activeRegions[e].hiddenByOverlap=u.hiddenByOverlap,++e}}if(a){++this._updateTime;for(let s of this._activeRegions)s.order!==c0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));let e=s=>{let u=this._activeRegions;if(s>=u.length)return s;let d=u[s].priority;for(;s<u.length&&u[s].priority===d;)++s;return s};if(this._sourceIds.length>1){let s=0,u=e(s);for(;s!==u;){let d=s,m=s;for(;d!==u;){let g=this._activeRegions[d];g.hiddenByOverlap=!1;for(let v=0;v<m;v++){let b=this._activeRegions[v];if(!b.hiddenByOverlap&&g.order===c0&&LT(g,b)&&(g.hiddenByOverlap=VO(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++d}s=u,u=e(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},i.eQ=c0,i.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let a of this._poleSegments)a.destroy();for(let a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){let s=new Xc,u=new qr,d=[],m=a+1+2,g=e[0]+1,v=e[0]+1+(1+e.length),b=(C,T,I)=>{let D=C===m-1?C-2:C===0?C:C-1;return D+=I?24575:0,[D,T]};for(let C=0;C<m;++C)s.emplaceBack(...b(C,0,!0));for(let C=0;C<g;++C)for(let T=0;T<m;++T)s.emplaceBack(...b(T,C,(T===0||T===m-1)&&!0));for(let C=0;C<e.length;++C){let T=e[C];for(let I=0;I<m;++I)s.emplaceBack(...b(I,T,!0))}for(let C=0;C<e.length;++C){let T=u.length,I=e[C]+1+2,D=new qr;for(let z=0;z<I-1;z++){let H=z===I-2,$=H?m*(v-e.length+C-z):m;for(let Z=0;Z<m-1;Z++){let Y=z*m+Z;z===0||H||Z===0||Z===m-2?(D.emplaceBack(Y+1,Y,Y+$),D.emplaceBack(Y+$,Y+$+1,Y+1)):(u.emplaceBack(Y+1,Y,Y+$),u.emplaceBack(Y+$,Y+$+1,Y+1))}}let P=Ji.simpleSegment(0,T,s.length,u.length-T);for(let z=0;z<D.uint16.length;z+=3)u.emplaceBack(D.uint16[z],D.uint16[z+1],D.uint16[z+2]);let R=Ji.simpleSegment(0,T,s.length,u.length-T);d.push({withoutSkirts:P,withSkirts:R})}return{vertices:s,indices:u,segments:d}}_createGrid(a){let e=this._fillGridMeshWithLods(ih,t0);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,oh.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){let e=new qr;for(let g=0;g<=ih;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);let s=new rd,u=new rd,d=new rd,m=new rd;this._poleSegments=[];for(let g=0,v=0;g<_a;g++){let b=360/(1<<g);s.emplaceBack(0,-Bo,0,.5,0),u.emplaceBack(0,-Bo,0,.5,1),d.emplaceBack(0,-Bo,0,.5,.5),m.emplaceBack(0,-Bo,0,.5,.5);for(let C=0;C<=ih;C++){let T=C/ih,I=0,D=on(0,b,T),[P,R,z]=od(r5,o5,D,Bo);s.emplaceBack(P,R,z,T,I),u.emplaceBack(P,R,z,T,1-I);let H=Zn(D);T=.5+.5*Math.sin(H),I=.5+.5*Math.cos(H),d.emplaceBack(P,R,z,T,I),m.emplaceBack(P,R,z,T,1-I)}this._poleSegments.push(Ji.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,$a,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,$a,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,$a,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(m,$a,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},i.eS=LO,i.eT=Kh,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=Ae,i.eW=W,i.eX=function(a,e,s){return a[0]=e[0]/s[0],a[1]=e[1]/s[1],a[2]=e[2]/s[2],a},i.eY=W_,i.eZ=rh,i.e_=Nf,i.ea=Qb,i.eb=nR,i.ec=ad,i.ed=qO,i.ee=GO,i.ef=V,i.eg=function(a,e){if(a===e){var s=e[1],u=e[2],d=e[3],m=e[6],g=e[7],v=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=s,a[6]=e[9],a[7]=e[13],a[8]=u,a[9]=m,a[11]=e[14],a[12]=d,a[13]=g,a[14]=v}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},i.eh=F6,i.ei=Pn,i.ej=Wv,i.ek=256,i.el=ST,i.em=Ws,i.en=_r,i.eo=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},i.ep=rd,i.eq=cb,i.er=Hv,i.es=function(a,e,s,u,d){return G((a-e)/(s-e)*(d-u)+u,u,d)},i.et=Vl,i.eu=function(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],C=e[7],T=e[8],I=T*g-v*C,D=-T*m+v*b,P=C*m-g*b,R=s*I+u*D+d*P;return R?(a[0]=I*(R=1/R),a[1]=(-T*u+d*C)*R,a[2]=(v*u-d*g)*R,a[3]=D*R,a[4]=(T*s-d*b)*R,a[5]=(-v*s+d*m)*R,a[6]=P*R,a[7]=(-C*s+u*b)*R,a[8]=(g*s-u*m)*R,a):null},i.ev=2,i.ew=Dc,i.ex=Bl,i.ey=Gh,i.ez=function(a,e){var s=new O(3);Gh(s,e);var u=1/s[0],d=1/s[1],m=1/s[2],g=e[0]*u,v=e[1]*d,b=e[2]*m,C=e[4]*u,T=e[5]*d,I=e[6]*m,D=e[8]*u,P=e[9]*d,R=e[10]*m,z=g+T+R,H=0;return z>0?(H=2*Math.sqrt(z+1),a[3]=.25*H,a[0]=(I-P)/H,a[1]=(D-b)/H,a[2]=(v-C)/H):g>T&&g>R?(H=2*Math.sqrt(1+g-T-R),a[3]=(I-P)/H,a[0]=.25*H,a[1]=(v+C)/H,a[2]=(D+b)/H):T>R?(H=2*Math.sqrt(1+T-g-R),a[3]=(D-b)/H,a[0]=(v+C)/H,a[1]=.25*H,a[2]=(I+P)/H):(H=2*Math.sqrt(1+R-g-T),a[3]=(v-C)/H,a[0]=(D+b)/H,a[1]=(I+P)/H,a[2]=.25*H),a},i.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,s)=>String.fromCharCode(+("0x"+s))))},i.f0=function([a,e,s]){let u=Math.hypot(a,e,s),d=Math.atan2(a,s),m=.5*Math.PI-Math.acos(-e/u);return new c(Zo(d),Zo(m))},i.f1=Rc,i.f2=KT,i.f3=function(a){let e=a.navigator?a.navigator.userAgent:null;return!!(function(s){if(Fr==null){let u=s.navigator?s.navigator.userAgent:null;Fr=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Fr})(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(a,e){Uf=a,jf=e},i.f5=IT,i.f6=aO,i.f7=function(a){let e=[0,0,0],s=gt(new Float64Array(16));return Ot(s,a.pixelMatrix,a.globeMatrix),Pr(e,e,s),new it(e[0],e[1])},i.f8=function(){let a=m0;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(jT),m0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){t1().acquire(jT)},i.fA=k1,i.fB=Ce,i.fC=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==yR){let s=new Uint32Array(a,0,7),[,,u,d,m,g]=s;e=s.byteLength+d+m+g+m,(u!==a.byteLength||e>=a.byteLength)&&Dt("Invalid b3dm header information.")}return CR(a,e)},i.fD=function(a,e){let s=nI(a);for(let u of s){for(let d of u.meshes)hj(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(pj(u.lights,e)))}return s},i.fE=M1,i.fF=Vn,i.fG=fR,i.fH=Kl,i.fI=ks,i.fJ=function(a){Na(),al?.then(e=>{e.keys().then(s=>{for(let u=0;u<s.length-a;u++)e.delete(s[u]).catch(d=>Dt(d.message))}).catch(s=>Dt(s.message))}).catch(e=>Dt(e.message))},i.fa=Tp,i.fb=function(a,e,s=!1){if(ls===ks.deferred||ls===ks.loading||ls===ks.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Yl=oo.resolveURL(a),ls=ks.deferred,kv=e,Am(),s||bb()},i.fc=function(a){ag=oo.resolveURL(a),lg||(lg=new sg(t1(),new Hu)),lg.broadcast("setMeshoptUrl",ag)},i.fd=_R,i.fe=function(a){GT=oo.resolveURL(a),lg||(lg=new sg(t1(),new Hu)),lg.broadcast("setDracoUrl",GT)},i.ff=gR,i.fg=f0,i.fh=function(a){let e=La();if(!e)return;let s=e.delete(Vf);a&&s.then(()=>a()).catch(a)},i.fi=e1,i.fj=kt,i.fk=lh,i.fl=lc,i.fm=LF,i.fn=NF,i.fo=zR,i.fp=He,i.fq="hd_road_elevation",i.fr=ii,i.fs=Ne,i.ft=sd,i.fu=mI,i.fv=jp,i.fw=function(a,e,s,u,d,m,g,v=1,b,C,T){a.createArrays(),a.tilePixelRatio=_t/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;let I=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=v,P.textSizeScaleRange=I.get("text-size-scale-range"),P.iconSizeScaleRange=I.get("icon-size-scale-range");let[R,z]=P.textSizeScaleRange,[H,$]=P.iconSizeScaleRange;P.textScaleFactor=G(P.scaleFactor,R,z),P.iconScaleFactor=G(P.scaleFactor,H,$);let Z=D["text-size"],Y=D["icon-size"];if(a.textSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=a.textSizeData;P.compositeTextSizes=[Z.possiblyEvaluate(new Ni(we,{worldview:T}),m),Z.possiblyEvaluate(new Ni(je,{worldview:T}),m)]}if(a.iconSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=a.iconSizeData;P.compositeIconSizes=[Y.possiblyEvaluate(new Ni(we,{worldview:T}),m),Y.possiblyEvaluate(new Ni(je,{worldview:T}),m)]}P.layoutTextSize=Z.possiblyEvaluate(new Ni(g+1,{worldview:T}),m),P.layoutIconSize=Y.possiblyEvaluate(new Ni(g+1,{worldview:T}),m),P.textMaxSize=Z.possiblyEvaluate(new Ni(18,{worldview:T}),m);let te=I.get("symbol-placement"),he=I.get("text-rotation-alignment")==="map"&&te!=="point",ae=I.get("text-size"),me=!1,ye=[];for(let we of a.features){let je=I.get("text-font").evaluate(we,{},m).join(","),Te=ae.evaluate(we,{},m)*P.textScaleFactor,qe=P.layoutTextSize.evaluate(we,{},m)*P.textScaleFactor,Ye=P.layoutIconSize.evaluate(we,{},m)*P.iconScaleFactor,Ke={horizontal:{},vertical:void 0},rt=we.text,st,et=[0,0];if(rt){let _n=rt.toString(),_i=I.get("text-letter-spacing").evaluate(we,{},m)*ao,ce=I.get("text-line-height").evaluate(we,{},m)*ao,pe=Ov(_n)?_i:0,We=I.get("text-anchor").evaluate(we,{},m),ot=I.get("text-variable-anchor");if(!ot){let mn=I.get("text-radial-offset").evaluate(we,{},m);if(mn)et=xk(We,[mn*ao,vI]);else{let Cn=I.get("text-offset").evaluate(we,{},m);et=[Cn[0]*ao,Cn[1]*ao]}}let Ct=he?"center":I.get("text-justify").evaluate(we,{},m),Et=te==="point",qt=Et?I.get("text-max-width").evaluate(we,{},m)*ao:1/0,Xt=mn=>{a.allowVerticalPlacement&&Ep(_n)&&(Ke.vertical=uI(rt,e,s,d,je,qt,ce,We,mn,pe,et,Ks.vertical,!0,qe,Te,b))};if(!he&&ot){let mn=Ct==="auto"?ot.map(Sn=>yI(Sn)):[Ct],Cn=!1;for(let Sn=0;Sn<mn.length;Sn++){let On=mn[Sn];if(!Ke.horizontal[On])if(Cn)Ke.horizontal[On]=Ke.horizontal[0];else{let rn=uI(rt,e,s,d,je,qt,ce,"center",On,pe,et,Ks.horizontal,!1,qe,Te,b);rn&&(Ke.horizontal[On]=rn,Cn=rn.positionedLines.length===1)}}Xt("left")}else{if(Ct==="auto"&&(Ct=yI(We)),Et||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ep(_n)){let mn=uI(rt,e,s,d,je,qt,ce,We,Ct,pe,et,Ks.horizontal,!1,qe,Te,b);mn&&(Ke.horizontal[Ct]=mn)}Xt(Et?"left":Ct)}}let tt,Ge,$e,nt,vt,ut,Gt=!1,Tt=I.get("icon-text-fit").evaluate(we,{},m);if(we.icon&&we.icon.hasPrimary()){let _n=S0(we.icon,a.iconSizeData,D["icon-size"],m,a.zoom,we,b,P.iconScaleFactor,T);tt=_n.iconPrimary,$e=_n.iconSecondary;let _i=tt.toString();if(Ge=u.get(_i),Ge&&(vt=I.get("icon-offset").evaluate(we,{},m),ut=I.get("icon-anchor").evaluate(we,{},m),st=p1(d.get(_i),$e?d.get($e.toString()):void 0,vt,ut),Gt=Ge.sdf,a.sdfIcons===void 0?a.sdfIcons=Ge.sdf:a.sdfIcons!==Ge.sdf&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==a.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),$e){let ce=$e.toString();nt=u.get(ce)}}me=me||!(!we.icon||!we.icon.hasSecondary());let Pt=v1(Ke.horizontal)||Ke.vertical;a.iconsInText||(a.iconsInText=!!Pt&&Pt.iconsInText);let Nt=qe*P.textScaleFactor/ao,{defaultShapedIcon:Tn,verticallyShapedIcon:dt}=b6(a,st,I,we,m,Ke,Nt,vt,Tt);Tt!=="none"&&st&&(ok(st)||sk(st))&&(_1(0,Ge,tt,st,Tn,Tt,C,u,d),_1(0,nt,$e,st,Tn,Tt,C,u,d),dt&&(_1(0,Ge,tt,st,dt,Tt,C,u,d),_1(0,nt,$e,st,dt,Tt,C,u,d))),st=Tn;let{iconBBox:zt,iconVerticalBBox:un,textBBox:Ln,textVerticalBBox:zn}=g6(a,st,dt,I,we,m,Ye,vt,P,d,ut,Ke,qe,et);ye.push({feature:we,shapedTextOrientations:Ke,shapedText:Pt,shapedIcon:st,iconPrimary:tt,iconSecondary:$e,iconOffset:vt,iconAnchor:ut,verticallyShapedIcon:dt,layoutTextSize:qe,layoutIconSize:Ye,textOffset:et,isSDFIcon:Gt,iconTextFit:Tt,iconCollisionBounds:zt,iconVerticalCollisionBounds:un,textCollisionBounds:Ln,textVerticalCollisionBounds:zn})}return{featureData:ye,sizes:P,hasAnySecondaryIcon:me,textAlongLine:he,symbolPlacement:te}},i.fx=fk,i.fy=function(a,e,s,u,d,m,g,v,b,C){a.iconAtlasPositions=C.iconPositions;let{featureData:T,hasAnySecondaryIcon:I,sizes:D,textAlongLine:P,symbolPlacement:R}=e;for(let z of T){let{shapedIcon:H,verticallyShapedIcon:$,feature:Z,shapedTextOrientations:Y,shapedText:te,layoutTextSize:he,textOffset:ae,isSDFIcon:me,iconPrimary:ye,iconSecondary:we,iconTextFit:je,iconOffset:Te,iconCollisionBounds:qe,iconVerticalCollisionBounds:Ye,textCollisionBounds:Ke}=z;wk(H,C.iconPositions,ye,we),wk($,C.iconPositions,ye,we),x6(Y,C.iconPositions),y6(ye,we,C.iconPositions),(te||H)&&w6(a,Z,Y,H,$,b,D,he,0,ae,me,u,d,g,v,I,je,Te,P,R,qe,Ye,Ke)}s&&a.generateCollisionDebugBuffers(m,a.collisionBoxArray,D.textScaleFactor)},i.fz=ke,i.g=function(a,e){return $u(Object.assign(a,{method:"GET"}),e)},i.h=function(a){return a.indexOf("mapbox:")===0},i.i=function(a){return kn.API_STYLE_REGEX.test(a)&&!To(a)},i.j=xr,i.k=ll,i.l=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(a,e){return $u(Object.assign(a,{type:"json"}),e)},i.n=qf,i.o=oo,i.p=function(a,e){return $u(Object.assign(a,{method:"POST"}),e)},i.q=jo,i.r=sl,i.s=function(a){try{let e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return $T||($T=new e1("ImageRasterizer")),$T},i.u=function(){return(function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},i.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},i.w=Dt,i.x=LI,i.y=ip,i.z=cl}),l(["./shared"],function(i){function E(Ae){let G=Ae?Ae.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function O(Ae){if(typeof Ae=="number"||typeof Ae=="boolean"||typeof Ae=="string"||Ae==null)return JSON.stringify(Ae);if(Array.isArray(Ae)){let X="[";for(let oe of Ae)X+=`${O(oe)},`;return`${X}]`}let G="{";for(let X of Object.keys(Ae).sort())G+=`${X}:${O(Ae[X])},`;return`${G}}`}function N(Ae){let G="";for(let X of i.bx)G+=`/${O(Ae[X])}`;return G}class K{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,X){this._layerConfigs={},this._layers={},this.update(G,[],X)}update(G,X,oe){this._options=oe;for(let ve of G)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=i.du(ve,this.scope,null,this._options)).compileFilter(oe),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(let ve of X)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};let xe=(function(ve,Ee){let ze={};for(let Ne=0;Ne<ve.length;Ne++){let at=ve[Ne],Xe=Ee&&Ee[at.id];Xe||(at.type==="symbol"?Xe=at.id:(Xe=N(at),at.type==="line"&&at.paint&&(function Qt(Dt){return typeof Dt=="string"&&Dt==="line-progress"||(Array.isArray(Dt)?Dt.some(Qt):!(!Dt||typeof Dt!="object")&&Object.values(Dt).some(Qt))})(at.paint["line-width"])&&(Xe+=`/${O(at.paint["line-width"])}`))),Ee&&(Ee[at.id]=Xe);let Rt=ze[Xe];Rt||(Rt=ze[Xe]=[]),Rt.push(at)}let Ie=[];for(let Ne in ze)Ie.push(ze[Ne]);return Ie})(Object.values(this._layerConfigs),this.keyCache);for(let ve of xe){let Ee=ve.map(Rt=>this._layers[Rt.id]),ze=Ee[0];if(ze.visibility==="none")continue;let Ie=ze.source||"",Ne=this.familiesBySource[Ie];Ne||(Ne=this.familiesBySource[Ie]={});let at=ze.sourceLayer||"_geojsonTileLayer",Xe=Ne[at];Xe||(Xe=Ne[at]=[]),Xe.push(Ee)}}}let le=1*i.fl;class De{constructor(G){let X={},oe=[];for(let ze in G){let Ie=G[ze],Ne=X[ze]={};for(let at in Ie.glyphs){let Xe=Ie.glyphs[+at];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let Rt=Xe.metrics.localGlyph?le:1,Qt={x:0,y:0,w:Xe.bitmap.width+2*Rt,h:Xe.bitmap.height+2*Rt};oe.push(Qt),Ne[at]=Qt}}let{w:xe,h:ve}=i.G(oe),Ee=new i.fk({width:xe||1,height:ve||1});for(let ze in G){let Ie=G[ze];for(let Ne in Ie.glyphs){let at=Ie.glyphs[+Ne];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;let Xe=X[ze][Ne],Rt=at.metrics.localGlyph?le:1;i.fk.copy(at.bitmap,Ee,{x:0,y:0},{x:Xe.x+Rt,y:Xe.y+Rt},at.bitmap)}}this.image=Ee,this.positions=X}}function Qe(Ae,G,X){Ae[G]?X&&(Ae[G].center=X):Ae[G]={floorIds:new Set,center:X||[0,0],floors:{}}}function Fe(Ae,G,X,oe){for(let xe of G)Qe(Ae,xe),Ae[xe].floors[X]=oe,Ae[xe].floorIds.add(X)}function gt(Ae){return{id:Ae.properties.id.toString(),center:Ae.properties.center.toString().split(";").map(Number)}}function jt(Ae){return{id:Ae.properties.id.toString(),isDefault:!!Ae.properties.is_default&&Ae.properties.is_default,connections:Ae.properties.connected_floor_ids?new Set(Ae.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ae.properties.conflicted_floor_ids?new Set(Ae.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ae.properties.building_ids?new Set(Ae.properties.building_ids.toString().split(";")):new Set,name:Ae.properties.name.toString(),zIndex:Ae.properties.z_index}}function Ot(Ae,G){return G.every(X=>Ae.properties&&Ae.properties[X]!=null)}function Kt(Ae){return Ot(Ae,["type","id","name"])&&Ae.properties.type==="building"}function Hn(Ae){return Ot(Ae,["type","id","name","z_index"])&&Ae.properties.type==="floor"}i.fj(De,"GlyphAtlas");class Er{constructor(G){this.tileID=new i.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=i.aZ(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor,this.worldview=G.worldview,this.indoor=G.indoor}parse(G,X,oe,xe,ve,Ee){this.status="parsing",this.data=G,this.collisionBoxArray=new i.b3;let ze=new i.fm(Object.keys(G.layers).sort()),Ie=new i.fn(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];let Ne={},at=new i.fo(256,256),Xe={featureIndex:Ie,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:at,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){let xn=this.indoor.indoorState.activeFloorsVisible,vn=(function(gn,Vn,dr){let Fr=(function(or,Gn){if(!or)return i.w("No source layers defined in indoor specification"),Gn;if(or.size===0)return Gn;let sr=or.difference(Gn);for(let Mi of sr)i.w(`Missing source layer required in indoor specification: ${Mi}`);return Gn.intersection(Gn)})(Vn.sourceLayers,new Set(Object.keys(gn.layers))),yr=Vn.indoorState,$r=(function(or,Gn,sr,Mi){let kn=new Set,xr=new Set,To=new Set,No=new Map,ys={},Bu=fo=>{let Hs=No.get(fo)||new Set;for(let Xo of kn)if((No.get(Xo)||new Set).has(fo)||Hs.has(Xo))return!0;return!1};for(let fo of Gn){let Hs=or.layers[fo];if(Hs)for(let Xo=0;Xo<Hs.length;Xo++){let sl=Hs.feature(Xo);if(Kt(sl)){let{id:oo,center:Vu}=gt(sl);Qe(ys,oo,Vu),kn.add(oo)}else if(Hn(sl)){let{id:oo,isDefault:Vu,connections:kd,conflicts:Vf,buildings:Uf,name:jf,zIndex:Qh}=jt(sl);Fe(ys,Uf,oo,{name:jf,zIndex:Qh}),No.set(oo,Vf),(oo===Mi||kd.has(Mi))&&kn.add(oo),xr.add(oo),Vu&&To.add(oo)}}else i.w(`indoor source layer not found: ${fo}`)}if(sr)for(let fo of sr)xr.has(fo)&&(Bu(fo)||kn.add(fo));for(let fo of To)kn.has(fo)||Bu(fo)||kn.add(fo);return{buildings:ys,activeFloors:kn}})(gn,Fr,yr.lastActiveFloors,yr.selectedFloorId);return dr.send("setIndoorData",$r),$r})(G,this.indoor,ve);Xe.activeFloors=xn?vn.activeFloors:void 0}let Rt=[],Qt=X.familiesBySource[this.source];for(let xn in Qt){let vn=G.layers[xn];if(!vn)continue;let gn=!1,Vn=!1,dr=!1;for(let Gn of Qt[xn])Gn[0].type==="symbol"?gn=!0:Vn=!0,Gn[0].is3D()&&Gn[0].type!=="model"&&(dr=!0);if(this.extraShadowCaster&&!dr||this.isSymbolTile===!0&&!gn||this.isSymbolTile===!1&&!Vn)continue;vn.version===1&&i.w(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Fr=ze.encode(xn),yr=[],$r=this.localizableLayerIds&&this.localizableLayerIds.has(xn),or=!1;for(let Gn=0,sr=0;Gn<vn.length;Gn++){let Mi=vn.feature(Gn),kn=Ie.getId(Mi,xn),xr=Mi.properties?Mi.properties.worldview:null;if($r&&this.worldview&&typeof xr=="string")if(xr==="all")Mi.properties.$localized=!0;else{if(!xr.split(",").includes(this.worldview))continue;Mi.properties.$localized=!0,Mi.properties.worldview=this.worldview}!or&&Mi.properties&&Mi.properties.hasOwnProperty(i.fp)&&(or=!0),yr.push({feature:Mi,id:kn,index:sr,sourceLayerIndex:Fr}),sr++}or&&!Xe.elevationFeatures&&G.layers.hasOwnProperty(i.fq)&&(Xe.elevationFeatures=i.fr.parseFrom(G.layers[i.fq],this.canonical));for(let Gn of Qt[xn]){let sr=Gn[0];if(this.extraShadowCaster&&(!sr.is3D()||sr.type==="model")||this.isSymbolTile!==void 0&&sr.type==="symbol"!==this.isSymbolTile||sr.minzoom&&this.zoom<Math.floor(sr.minzoom)||sr.maxzoom&&this.zoom>=sr.maxzoom||sr.visibility==="none")continue;_r(Gn,this.zoom,Xe.brightness,oe,this.worldview);let Mi=Ne[sr.id]=sr.createBucket({index:Ie.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview,localizable:$r});Ie.bucketLayerIDs.push(Gn.map(xr=>i.B(xr.id,xr.scope)));let kn=Mi.prepare?Mi.prepare():null;kn!=null?(kn=kn.then(()=>Mi.populate(yr,Xe,this.tileID.canonical,this.tileTransform)),Rt.push(kn)):Mi.populate(yr,Xe,this.tileID.canonical,this.tileTransform)}}let Dt=()=>{let xn,vn,gn,Vn,dr,Fr;at.trim();let yr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$r=()=>{if(xn)return this.status="done",Ee(xn);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:Object.values(Ne).filter(Gn=>!Gn.isEmpty()),featureIndex:Ie,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(vn&&gn&&Vn){let Gn=new De(vn),sr=new Map;for(let[xr,To]of gn.entries()){let{imagePosition:No}=i.fu(xr,To,i.fv);sr.set(xr,No)}let Mi={};for(let xr in Ne){let To=Ne[xr];To instanceof i.b4&&(_r(To.layers,this.zoom,Xe.brightness,oe,this.worldview),Mi[xr]=i.fw(To,vn,Gn.positions,gn,sr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,dr,this.worldview))}let kn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,gn,dr,()=>{kn.iconsPending=!1,or(Mi,Gn,kn)}),this.rasterizeIfNeeded(ve,Vn,Fr,()=>{kn.patternsPending=!1,or(Mi,Gn,kn)})}},or=(Gn,sr,Mi,kn)=>{if(Mi.iconsPending||Mi.patternsPending)return;let xr=new i.fx(gn,Vn,this.lut);for(let To in Ne){let No=Ne[To];if(To in Gn)i.fy(No,Gn[To],this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gn,xr);else if(No.hasPattern&&(No instanceof i.ba||No instanceof i.bb||No instanceof i.ea)){_r(No.layers,this.zoom,Xe.brightness,oe,this.worldview);let ys=Object.fromEntries(xr.patternPositions);No.addFeatures(Xe,this.tileID.canonical,ys,oe,this.tileTransform,this.brightness)}}this.status="done",Ee(null,{buckets:Object.values(Ne).filter(To=>!To.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,lineAtlas:at,imageAtlas:xr,brightness:Xe.brightness})};if(!this.extraShadowCaster){let Gn=i.fs(Xe.glyphDependencies,kn=>Object.keys(kn).map(Number));Object.keys(Gn).length?ve.send("getGlyphs",{uid:this.uid,stacks:Gn},(kn,xr)=>{xn||(xn=kn,vn=xr,$r())},void 0,!1,yr):vn={};let sr=Array.from(Xe.iconDependencies.keys()).map(kn=>i.I.parse(kn));sr.length?ve.send("getImages",{images:sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(kn,xr)=>{xn||(xn=kn,gn=new Map,dr=this.updateImageMapAndGetImageTaskQueue(gn,xr,Xe.iconDependencies),$r())},void 0,!1,yr):(gn=new Map,dr=new Map);let Mi=Array.from(Xe.patternDependencies.keys()).map(kn=>i.I.parse(kn));Mi.length?ve.send("getImages",{images:Mi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(kn,xr)=>{xn||(xn=kn,Vn=new Map,Fr=this.updateImageMapAndGetImageTaskQueue(Vn,xr,Xe.patternDependencies),$r())},void 0,!1,yr):(Vn=new Map,Fr=new Map)}if(Xe.elevationFeatures&&Xe.elevationFeatures.length>0){let Gn=[];for(let Mi of Object.values(Ne))if(Mi instanceof i.bb){let kn=Mi.getUnevaluatedPortalGraph();kn&&Gn.push(kn)}let sr=i.ft.evaluate(Gn);for(let Mi of Object.values(Ne))if(Mi instanceof i.bb){let kn=G.layers[ze.decode(Mi.sourceLayerIndex)];Mi.setEvaluatedPortalGraph(sr,kn,this.tileID.canonical,Xe.availableImages,Xe.brightness)}}$r()};Rt.length>0?Promise.allSettled(Rt).then(Dt).catch(Ee):Dt()}updateParameters(G){this.scaleFactor=G.scaleFactor,this.showCollisionBoxes=G.showCollisionBoxes,this.projection=G.projection,this.brightness=G.brightness,this.tileTransform=i.aZ(G.tileID.canonical,G.projection),this.extraShadowCaster=G.extraShadowCaster,this.lut=G.lut,this.worldview=G.worldview,this.indoor=G.indoor}rasterizeIfNeeded(G,X,oe,xe){Array.from(X.values()).some(ve=>ve.usvg)?this.rasterize(G,X,oe,xe):xe()}updateImageMapAndGetImageTaskQueue(G,X,oe){let xe=new Map;for(let ve of X.keys()){let Ee=oe.get(ve)||[];for(let ze of Ee){let Ie=ze.toString(),Ne=X.get(ze.id.toString());Ne.usvg?xe.has(Ie)||(xe.set(Ie,ze),G.set(Ie,Object.assign({},Ne))):G.set(Ie,Ne)}}return xe}rasterize(G,X,oe,xe){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:oe},(ve,Ee)=>{if(!ve)for(let[ze,Ie]of Ee.entries()){let Ne=Object.assign(X.get(ze),{data:Ie});X.set(ze,Ne)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function _r(Ae,G,X,oe,xe){let ve=new i.ac(G,{brightness:X,worldview:xe});for(let Ee of Ae)Ee.recalculate(ve,oe)}class So extends i.E{constructor(G,X,oe,xe,ve,Ee,ze){super(),this.actor=G,this.layerIndex=X,this.availableImages=oe,this.availableModels=xe,this.loadVectorData=Ee||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(G.scheduler),this.isSpriteLoaded=ve,this.scheduler=G.scheduler,this.brightness=ze}loadTile(G,X){let oe=G.uid,xe=G&&G.request,ve=xe&&xe.collectResourceTiming,Ee=this.loading[oe]=new Er(G);Ee.abort=this.loadVectorData(G,(ze,Ie)=>{let Ne=!this.loading[oe];if(delete this.loading[oe],Ee.cancelRasterize(),Ne||ze||!Ie)return Ee.status="done",Ne||(this.loaded[oe]=Ee),X(ze);let at=Ie.rawData,Xe={},Rt=i.aM(Ie.responseHeaders);Rt&&Rt.expires&&(Xe.expires=Rt.expires),Rt&&Rt.cacheControl&&(Xe.cacheControl=Rt.cacheControl),Ee.vectorTile=Ie.vectorTile||new i.fz(new i.bt(at));let Qt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Dt,xn)=>{if(Dt||!xn)return X(Dt);let vn={};if(ve){let gn=E(xe);gn.length>0&&(vn.resourceTiming=JSON.parse(JSON.stringify(gn)))}X(null,Object.assign({rawTileData:at.slice(0),responseHeaders:Ie.responseHeaders},xn,Xe,vn))})};this.isSpriteLoaded?Qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Qt()}),this.loaded=this.loaded||{},this.loaded[oe]=Ee})}reloadTile(G,X){let oe=this.loaded,xe=G.uid;if(oe&&oe[xe]){let ve=oe[xe];ve.updateParameters(G);let Ee=(ze,Ie)=>{let Ne=ve.reloadCallback;Ne&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ne)),X(ze,Ie)};ve.status==="parsing"?ve.reloadCallback=Ee:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ee):Ee())}else X(null,void 0)}abortTile(G,X){let oe=G.uid,xe=this.loading[oe];xe&&(xe.abort&&xe.abort(),delete this.loading[oe]),X()}removeTile(G,X){let oe=this.loaded,xe=G.uid;oe&&oe[xe]&&delete oe[xe],X()}}class is{loadTile(G,X){let{uid:oe,encoding:xe,rawImageData:ve,padding:Ee}=G,ze=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Ee):ve;X(null,new i.fA(oe,ze,xe,Ee<1))}reloadTile(G,X){X(null,null)}abortTile(G,X){X()}removeTile(G,X){X()}getImageData(G,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let oe=this.offscreenCanvasContext.getImageData(-X,-X,G.width+2*X,G.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}i.bs.setPbf(i.bt);class zl{constructor(G){this._mrt=new i.bs(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,X){let oe=this._mrt;this.status="parsing",this._entireBuffer=G;try{oe.parseHeader(G),this._isHeaderLoaded=!0;let xe=[];for(let ve in oe.layers){let Ee=oe.getLayer(ve),ze=Ee.getDataRange(Ee.getBandList()),Ie=oe.createDecodingTask(ze),Ne=G.slice(ze.firstByte,ze.lastByte+1),at=i.bs.performDecoding(Ne,Ie).then(Xe=>Ie.complete(null,Xe)).catch(Xe=>Ie.complete(Xe,null));xe.push(at)}Promise.allSettled(xe).then(()=>X(null,oe)).catch(ve=>X(ve))}catch(xe){X(xe)}}}class Gh{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,X){let oe=G.uid,xe=G.request,ve=this.loading[oe]=new zl(G),{cancel:Ee}=i.bu(xe,(ze,Ie,Ne)=>{let at=!this.loading[oe];if(delete this.loading[oe],at||ze||!Ie)return ve.status="done",at||(this.loaded[oe]=ve),X(ze);ve.parse(Ie,(Xe,Rt)=>{if(Xe||!Rt)return X(Xe);X(null,Rt,Ne)}),this.loaded[oe]=ve});ve.abort=Ee}reloadTile(G,X){X(null,void 0)}abortTile(G,X){let oe=G.uid,xe=this.loading[oe];xe&&(xe.abort&&xe.abort(),delete this.loading[oe]),X()}removeTile(G,X){let oe=G.uid;this.loaded[oe]&&delete this.loaded[oe],X()}decodeRasterArray(G,X){i.bs.performDecoding(G.buffer,G.task).then(oe=>X(null,oe)).catch(oe=>X(oe))}}let qh=i.fB.prototype.toGeoJSON;class Wh{constructor(G){this._feature=G,this.extent=i.al,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){let G=[];for(let X of this._feature.geometry)G.push([new i.P(X[0],X[1])]);return G}{let G=[];for(let X of this._feature.geometry){let oe=[];for(let xe of X)oe.push(new i.P(xe[0],xe[1]));G.push(oe)}return G}}toGeoJSON(G,X,oe){return qh.call(this,G,X,oe)}}class gi{constructor(G,X){this.name=G,this.extent=i.al,this.length=X.length,this._jsonFeatures=X}feature(G){return new Wh(this._jsonFeatures[G])}}class Ff{constructor(G){this.layers={},this.extent=i.al;for(let X of Object.keys(G))this.layers[X]=new gi(X,G[X])}}let ho=64/4096,vr=128;class Yi{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],X){for(let oe of G){let xe=oe.id;if(xe==null)continue;let ve=this.features.get(xe);ve&&this.updateCache(ve,X),oe.geometry?(ve=il(oe),this.updateCache(ve,X),this.features.set(xe,ve)):this.features.delete(xe),this.updateCache(ve,X)}}updateCache(G,X){for(let{canonical:oe,uid:xe}of Object.values(X)){let{z:ve,x:Ee,y:ze}=oe;jr(G,Math.pow(2,ve),Ee,ze)&&delete X[xe]}}getTile(G,X,oe){let xe=Math.pow(2,G),ve=[];for(let Ee of this.features.values())jr(Ee,xe,X,oe)&&ve.push(ur(Ee,xe,X,oe));return{features:ve}}getFeatures(){return[...this.features.values()]}}function jr({minX:Ae,minY:G,maxX:X,maxY:oe},xe,ve,Ee){return Ae<(ve+1+ho)/xe&&G<(Ee+1+ho)/xe&&X>(ve-ho)/xe&&oe>(Ee-ho)/xe}function il(Ae){let{id:G,geometry:X,properties:oe}=Ae;if(!X)return;if(X.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:xe,coordinates:ve}=X,Ee={id:G,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ze=Ee.geometry;if(xe==="Point")Pa(ve,ze,Ee);else if(xe==="MultiPoint")for(let Ie of ve)Pa(Ie,ze,Ee);else if(xe==="LineString")Ee.type=2,rl(ve,ze,Ee);else if(xe==="MultiLineString")Ee.type=2,Oa(ve,ze,Ee);else if(xe==="Polygon")Ee.type=3,Oa(ve,ze,Ee,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(let Ie of ve)Oa(Ie,ze,Ee,!0)}return Ee}function Pa([Ae,G],X,oe){let xe=i.aF(Ae),ve=i.aJ(G);ve=ve<0?0:ve>1?1:ve,X.push(xe,ve),oe.minX=Math.min(oe.minX,xe),oe.minY=Math.min(oe.minY,ve),oe.maxX=Math.max(oe.maxX,xe),oe.maxY=Math.max(oe.maxY,ve)}function rl(Ae,G,X,oe=!1,xe=!1){let ve=[];for(let Ee of Ae)Pa(Ee,ve,X);G.push(ve),oe&&(function(Ee,ze){let Ie=0;for(let Ne=0,at=Ee.length,Xe=at-2;Ne<at;Xe=Ne,Ne+=2)Ie+=(Ee[Ne]-Ee[Xe])*(Ee[Ne+1]+Ee[Xe+1]);if(Ie>0===ze)for(let Ne=0,at=Ee.length;Ne<at/2;Ne+=2){let Xe=Ee[Ne],Rt=Ee[Ne+1];Ee[Ne]=Ee[at-2-Ne],Ee[Ne+1]=Ee[at-1-Ne],Ee[at-2-Ne]=Xe,Ee[at-1-Ne]=Rt}})(ve,xe)}function Oa(Ae,G,X,oe=!1){for(let xe=0;xe<Ae.length;xe++)rl(Ae[xe],G,X,oe,xe===0)}function ur(Ae,G,X,oe){let{id:xe,type:ve,geometry:Ee,tags:ze}=Ae,Ie=[];if(ve===1)(function(Ne,at,Xe,Rt,Qt){for(let Dt=0;Dt<Ne.length;Dt+=2){let xn=Math.round(i.al*(Ne[Dt+0]*at-Xe)),vn=Math.round(i.al*(Ne[Dt+1]*at-Rt));Qt.push([xn,vn])}})(Ee,G,X,oe,Ie);else if(ve===2)for(let Ne of Ee)$s(Ne,G,X,oe,Ie);else if(ve===3)for(let Ne of Ee)Lf(Ne,G,X,oe,Ie);return{id:xe,type:ve,geometry:Ie,tags:ze}}function $s(Ae,G,X,oe,xe){let ve=-vr,Ee=i.al+vr,ze;for(let Ie=0;Ie<Ae.length-2;Ie+=2){let Ne=Math.round(i.al*(Ae[Ie+0]*G-X)),at=Math.round(i.al*(Ae[Ie+1]*G-oe)),Xe=Math.round(i.al*(Ae[Ie+2]*G-X)),Rt=Math.round(i.al*(Ae[Ie+3]*G-oe)),Qt=Xe-Ne,Dt=Rt-at;Ne<ve&&Xe<ve||(Ne<ve?(at+=Math.round(Dt*((ve-Ne)/Qt)),Ne=ve):Xe<ve&&(Rt=at+Math.round(Dt*((ve-Ne)/Qt)),Xe=ve),at<ve&&Rt<ve||(at<ve?(Ne+=Math.round(Qt*((ve-at)/Dt)),at=ve):Rt<ve&&(Xe=Ne+Math.round(Qt*((ve-at)/Dt)),Rt=ve),Ne>=Ee&&Xe>=Ee||(Ne>=Ee?(at+=Math.round(Dt*((Ee-Ne)/Qt)),Ne=Ee):Xe>=Ee&&(Rt=at+Math.round(Dt*((Ee-Ne)/Qt)),Xe=Ee),at>=Ee&&Rt>=Ee||(at>=Ee?(Ne+=Math.round(Qt*((Ee-at)/Dt)),at=Ee):Rt>=Ee&&(Xe=Ne+Math.round(Qt*((Ee-at)/Dt)),Rt=Ee),ze&&Ne===ze[ze.length-1][0]&&at===ze[ze.length-1][1]||(ze=[[Ne,at]],xe.push(ze)),ze.push([Xe,Rt])))))}}function Lf(Ae,G,X,oe,xe){let ve=(X-ho)/G,Ee=(oe-ho)/G,ze=(X+1+ho)/G,Ie=(oe+1+ho)/G;function Ne(Rt,Qt){let Dt=0;return Rt<ve?Dt|=1:Rt>ze&&(Dt|=2),Qt<Ee?Dt|=4:Qt>Ie&&(Dt|=8),Dt}let at=[];for(let Rt=1;Rt<=8;Rt*=2){let Qt=Ae[Ae.length-2],Dt=Ae[Ae.length-1],xn=!(Ne(Qt,Dt)&Rt);for(let vn=0;vn<Ae.length;vn+=2){let gn=Ae[vn],Vn=Ae[vn+1],dr=!(Ne(gn,Vn)&Rt);dr!==xn&&(8&Rt?at.push(Qt+(gn-Qt)*(Ie-Dt)/(Vn-Dt),Ie):4&Rt?at.push(Qt+(gn-Qt)*(Ee-Dt)/(Vn-Dt),Ee):2&Rt?at.push(ze,Dt+(Vn-Dt)*(ze-Qt)/(gn-Qt)):1&Rt&&at.push(ve,Dt+(Vn-Dt)*(ve-Qt)/(gn-Qt))),dr&&at.push(gn,Vn),Qt=gn,Dt=Vn,xn=dr}if(!(Ae=at).length||Rt===8)break;at=[]}let Xe=[];for(let Rt=0;Rt<at.length;Rt+=2)Xe.push([Math.round(i.al*(at[Rt]*G-X)),Math.round(i.al*(at[Rt+1]*G-oe))]);xe.push(Xe)}function Zh({name:Ae,features:G},X){X.writeStringField(1,Ae),X.writeVarintField(5,i.al);let oe=new Map,xe=new Map,ve={keys:oe,values:xe,feature:null};for(let Ee of G)ve.feature=Ee,X.writeMessage(2,Nf,ve);for(let Ee of oe.keys())X.writeStringField(3,Ee);for(let Ee of xe.keys())X.writeMessage(4,Au,Ee)}function Nf(Ae,G){let X=Ae.feature;X.id!==void 0&&Number.isSafeInteger(+X.id)&&G.writeVarintField(1,+X.id),X.tags&&G.writeMessage(2,Dc,Ae),G.writeVarintField(3,X.type),G.writeMessage(4,Fo,X)}function Dc({keys:Ae,values:G,feature:X},oe){for(let xe of Object.keys(X.tags)){let ve=X.tags[xe];if(ve===null)continue;let Ee=Ae.get(xe);Ee===void 0&&(Ee=Ae.size,Ae.set(xe,Ee)),oe.writeVarint(Ee);let ze=typeof ve;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(ve=JSON.stringify(ve));let Ie=G.get(ve);Ie===void 0&&(Ie=G.size,G.set(ve,Ie)),oe.writeVarint(Ie)}}function ji(Ae,G){return(G<<3)+(7&Ae)}function Sr(Ae){return Ae<<1^Ae>>31}function Fo(Ae,G){let{geometry:X,type:oe}=Ae,xe=0,ve=0;if(oe===1){G.writeVarint(ji(1,X.length));for(let Ee of X){let ze=Ee[0]-xe,Ie=Ee[1]-ve;G.writeVarint(Sr(ze)),G.writeVarint(Sr(Ie)),xe+=ze,ve+=Ie}}else for(let Ee of X){G.writeVarint(ji(1,1));let ze=Ee.length-(oe===3?1:0);for(let Ie=0;Ie<ze;Ie++){Ie===1&&G.writeVarint(ji(2,ze-1));let Ne=Ee[Ie][0]-xe,at=Ee[Ie][1]-ve;G.writeVarint(Sr(Ne)),G.writeVarint(Sr(at)),xe+=Ne,ve+=at}oe===3&&G.writeVarint(ji(7,1))}}function Au(Ae,G){let X=typeof Ae;X==="string"?G.writeStringField(1,Ae):X==="boolean"?G.writeBooleanField(7,Ae):X==="number"&&(Ae%1!=0?G.writeDoubleField(3,Ae):Ae<0?G.writeSVarintField(6,Ae):G.writeVarintField(5,Ae))}let Pr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Ac=Math.fround||(Pc=new Float32Array(1),Ae=>(Pc[0]=+Ae,Pc[0]));var Pc;let Os=3,Wo=5,kr=6;class W_{constructor(G){this.options=Object.assign(Object.create(Pr),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:X,minZoom:oe,maxZoom:xe}=this.options;X&&console.time("total time");let ve=`prepare ${G.length} points`;X&&console.time(ve),this.points=G;let Ee=[];for(let Ie=0;Ie<G.length;Ie++){let Ne=G[Ie];if(!Ne.geometry)continue;let[at,Xe]=Ne.geometry.coordinates,Rt=Ac(Oc(at)),Qt=Ac(Rc(Xe));Ee.push(Rt,Qt,1/0,Ie,-1,1),this.options.reduce&&Ee.push(0)}let ze=this.trees[xe+1]=this._createTree(Ee);X&&console.timeEnd(ve);for(let Ie=xe;Ie>=oe;Ie--){let Ne=+Date.now();ze=this.trees[Ie]=this._createTree(this._cluster(ze,Ie)),X&&console.log("z%d: %d clusters in %dms",Ie,ze.numItems,+Date.now()-Ne)}return X&&console.timeEnd("total time"),this}getClusters(G,X){let oe=((G[0]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,G[1])),ve=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)oe=-180,ve=180;else if(oe>ve){let Xe=this.getClusters([oe,xe,180,Ee],X),Rt=this.getClusters([-180,xe,ve,Ee],X);return Xe.concat(Rt)}let ze=this.trees[this._limitZoom(X)],Ie=ze.range(Oc(oe),Rc(Ee),Oc(ve),Rc(xe)),Ne=ze.data,at=[];for(let Xe of Ie){let Rt=this.stride*Xe;at.push(Ne[Rt+Wo]>1?Pd(Ne,Rt,this.clusterProps):this.points[Ne[Rt+Os]])}return at}getChildren(G){let X=this._getOriginId(G),oe=this._getOriginZoom(G),xe="No cluster with the specified id.",ve=this.trees[oe];if(!ve)throw new Error(xe);let Ee=ve.data;if(X*this.stride>=Ee.length)throw new Error(xe);let ze=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Ie=ve.within(Ee[X*this.stride],Ee[X*this.stride+1],ze),Ne=[];for(let at of Ie){let Xe=at*this.stride;Ee[Xe+4]===G&&Ne.push(Ee[Xe+Wo]>1?Pd(Ee,Xe,this.clusterProps):this.points[Ee[Xe+Os]])}if(Ne.length===0)throw new Error(xe);return Ne}getLeaves(G,X,oe){let xe=[];return this._appendLeaves(xe,G,X=X||10,oe=oe||0,0),xe}getTile(G,X,oe){let xe=this.trees[this._limitZoom(G)],ve=Math.pow(2,G),{extent:Ee,radius:ze}=this.options,Ie=ze/Ee,Ne=(oe-Ie)/ve,at=(oe+1+Ie)/ve,Xe={features:[]};return this._addTileFeatures(xe.range((X-Ie)/ve,Ne,(X+1+Ie)/ve,at),xe.data,X,oe,ve,Xe),X===0&&this._addTileFeatures(xe.range(1-Ie/ve,Ne,1,at),xe.data,ve,oe,ve,Xe),X===ve-1&&this._addTileFeatures(xe.range(0,Ne,Ie/ve,at),xe.data,-1,oe,ve,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(G){let X=this._getOriginZoom(G)-1;for(;X<=this.options.maxZoom;){let oe=this.getChildren(G);if(X++,oe.length!==1)break;G=oe[0].properties.cluster_id}return X}_appendLeaves(G,X,oe,xe,ve){let Ee=this.getChildren(X);for(let ze of Ee){let Ie=ze.properties;if(Ie&&Ie.cluster?ve+Ie.point_count<=xe?ve+=Ie.point_count:ve=this._appendLeaves(G,Ie.cluster_id,oe,xe,ve):ve<xe?ve++:G.push(ze),G.length===oe)break}return ve}_createTree(G){let X=new i.c4(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<G.length;oe+=this.stride)X.add(G[oe],G[oe+1]);return X.finish(),X.data=G,X}_addTileFeatures(G,X,oe,xe,ve,Ee){for(let ze of G){let Ie=ze*this.stride,Ne=X[Ie+Wo]>1,at,Xe,Rt;if(Ne)at=Pu(X,Ie,this.clusterProps),Xe=X[Ie],Rt=X[Ie+1];else{let xn=this.points[X[Ie+Os]];at=xn.properties;let[vn,gn]=xn.geometry.coordinates;Xe=Oc(vn),Rt=Rc(gn)}let Qt={type:1,geometry:[[Math.round(this.options.extent*(Xe*ve-oe)),Math.round(this.options.extent*(Rt*ve-xe))]],tags:at},Dt;Dt=Ne||this.options.generateId?X[Ie+Os]:this.points[X[Ie+Os]].id,Dt!==void 0&&(Qt.id=Dt),Ee.features.push(Qt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,X){let{radius:oe,extent:xe,reduce:ve,minPoints:Ee}=this.options,ze=oe/(xe*Math.pow(2,X)),Ie=G.data,Ne=[],at=this.stride;for(let Xe=0;Xe<Ie.length;Xe+=at){if(Ie[Xe+2]<=X)continue;Ie[Xe+2]=X;let Rt=Ie[Xe],Qt=Ie[Xe+1],Dt=G.within(Ie[Xe],Ie[Xe+1],ze),xn=Ie[Xe+Wo],vn=xn;for(let gn of Dt){let Vn=gn*at;Ie[Vn+2]>X&&(vn+=Ie[Vn+Wo])}if(vn>xn&&vn>=Ee){let gn,Vn=Rt*xn,dr=Qt*xn,Fr=-1,yr=(Xe/at<<5)+(X+1)+this.points.length;for(let $r of Dt){let or=$r*at;if(Ie[or+2]<=X)continue;Ie[or+2]=X;let Gn=Ie[or+Wo];Vn+=Ie[or]*Gn,dr+=Ie[or+1]*Gn,Ie[or+4]=yr,ve&&(gn||(gn=this._map(Ie,Xe,!0),Fr=this.clusterProps.length,this.clusterProps.push(gn)),ve(gn,this._map(Ie,or)))}Ie[Xe+4]=yr,Ne.push(Vn/vn,dr/vn,1/0,yr,-1,vn),ve&&Ne.push(Fr)}else{for(let gn=0;gn<at;gn++)Ne.push(Ie[Xe+gn]);if(vn>1)for(let gn of Dt){let Vn=gn*at;if(!(Ie[Vn+2]<=X)){Ie[Vn+2]=X;for(let dr=0;dr<at;dr++)Ne.push(Ie[Vn+dr])}}}}return Ne}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,X,oe){if(G[X+Wo]>1){let Ee=this.clusterProps[G[X+kr]];return oe?Object.assign({},Ee):Ee}let xe=this.points[G[X+Os]].properties,ve=this.options.map(xe);return oe&&ve===xe?Object.assign({},ve):ve}}function Pd(Ae,G,X){return{type:"Feature",id:Ae[G+Os],properties:Pu(Ae,G,X),geometry:{type:"Point",coordinates:[(oe=Ae[G],360*(oe-.5)),Lo(Ae[G+1])]}};var oe}function Pu(Ae,G,X){let oe=Ae[G+Wo],xe=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,ve=Ae[G+kr],Ee=ve===-1?{}:Object.assign({},X[ve]);return Object.assign(Ee,{cluster:!0,cluster_id:Ae[G+Os],point_count:oe,point_count_abbreviated:xe})}function Oc(Ae){return Ae/360+.5}function Rc(Ae){let G=Math.sin(Ae*Math.PI/180),X=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return X<0?0:X>1?1:X}function Lo(Ae){let G=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Bl(Ae,G,X,oe){let xe=oe,ve=G+(X-G>>1),Ee,ze=X-G,Ie=Ae[G],Ne=Ae[G+1],at=Ae[X],Xe=Ae[X+1];for(let Rt=G+3;Rt<X;Rt+=3){let Qt=Od(Ae[Rt],Ae[Rt+1],Ie,Ne,at,Xe);if(Qt>xe)Ee=Rt,xe=Qt;else if(Qt===xe){let Dt=Math.abs(Rt-ve);Dt<ze&&(Ee=Rt,ze=Dt)}}xe>oe&&(Ee-G>3&&Bl(Ae,G,Ee,oe),Ae[Ee+2]=xe,X-Ee>3&&Bl(Ae,Ee,X,oe))}function Od(Ae,G,X,oe,xe,ve){let Ee=xe-X,ze=ve-oe;if(Ee!==0||ze!==0){let Ie=((Ae-X)*Ee+(G-oe)*ze)/(Ee*Ee+ze*ze);Ie>1?(X=xe,oe=ve):Ie>0&&(X+=Ee*Ie,oe+=ze*Ie)}return Ee=Ae-X,ze=G-oe,Ee*Ee+ze*ze}function Ra(Ae,G,X,oe){let xe={id:Ae??null,type:G,geometry:X,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")Vl(xe,X);else if(G==="Polygon")Vl(xe,X[0]);else if(G==="MultiLineString")for(let ve of X)Vl(xe,ve);else if(G==="MultiPolygon")for(let ve of X)Vl(xe,ve[0]);return xe}function Vl(Ae,G){for(let X=0;X<G.length;X+=3)Ae.minX=Math.min(Ae.minX,G[X]),Ae.minY=Math.min(Ae.minY,G[X+1]),Ae.maxX=Math.max(Ae.maxX,G[X]),Ae.maxY=Math.max(Ae.maxY,G[X+1])}function rs(Ae,G,X,oe){if(!G.geometry)return;let xe=G.geometry.coordinates;if(xe&&xe.length===0)return;let ve=G.geometry.type,Ee=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),ze=[],Ie=G.id;if(X.promoteId?Ie=G.properties[X.promoteId]:X.generateId&&(Ie=oe||0),ve==="Point")Ou(xe,ze);else if(ve==="MultiPoint")for(let Ne of xe)Ou(Ne,ze);else if(ve==="LineString")Ru(xe,ze,Ee,!1);else if(ve==="MultiLineString"){if(X.lineMetrics){for(let Ne of xe)ze=[],Ru(Ne,ze,Ee,!1),Ae.push(Ra(Ie,"LineString",ze,G.properties));return}ku(xe,ze,Ee,!1)}else if(ve==="Polygon")ku(xe,ze,Ee,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(let Ne of G.geometry.geometries)rs(Ae,{id:Ie,geometry:Ne,properties:G.properties},X,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ne of xe){let at=[];ku(Ne,at,Ee,!0),ze.push(at)}}Ae.push(Ra(Ie,ve,ze,G.properties))}function Ou(Ae,G){G.push(Rd(Ae[0]),po(Ae[1]),0)}function Ru(Ae,G,X,oe){let xe,ve,Ee=0;for(let Ie=0;Ie<Ae.length;Ie++){let Ne=Rd(Ae[Ie][0]),at=po(Ae[Ie][1]);G.push(Ne,at,0),Ie>0&&(Ee+=oe?(xe*at-Ne*ve)/2:Math.sqrt(Math.pow(Ne-xe,2)+Math.pow(at-ve,2))),xe=Ne,ve=at}let ze=G.length-3;G[2]=1,Bl(G,0,ze,X),G[ze+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function ku(Ae,G,X,oe){for(let xe=0;xe<Ae.length;xe++){let ve=[];Ru(Ae[xe],ve,X,oe),G.push(ve)}}function Rd(Ae){return Ae/360+.5}function po(Ae){let G=Math.sin(Ae*Math.PI/180),X=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return X<0?0:X>1?1:X}function vs(Ae,G,X,oe,xe,ve,Ee,ze){if(oe/=G,ve>=(X/=G)&&Ee<oe)return Ae;if(Ee<X||ve>=oe)return null;let Ie=[];for(let Ne of Ae){let at=Ne.geometry,Xe=Ne.type,Rt=xe===0?Ne.minX:Ne.minY,Qt=xe===0?Ne.maxX:Ne.maxY;if(Rt>=X&&Qt<oe){Ie.push(Ne);continue}if(Qt<X||Rt>=oe)continue;let Dt=[];if(Xe==="Point"||Xe==="MultiPoint")Xh(at,Dt,X,oe,xe);else if(Xe==="LineString")kc(at,Dt,X,oe,xe,!1,ze.lineMetrics);else if(Xe==="MultiLineString")Ul(at,Dt,X,oe,xe,!1);else if(Xe==="Polygon")Ul(at,Dt,X,oe,xe,!0);else if(Xe==="MultiPolygon")for(let xn of at){let vn=[];Ul(xn,vn,X,oe,xe,!0),vn.length&&Dt.push(vn)}if(Dt.length){if(ze.lineMetrics&&Xe==="LineString"){for(let xn of Dt)Ie.push(Ra(Ne.id,Xe,xn,Ne.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Dt.length===1?(Xe="LineString",Dt=Dt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Dt.length===3?"Point":"MultiPoint"),Ie.push(Ra(Ne.id,Xe,Dt,Ne.tags))}}return Ie.length?Ie:null}function Xh(Ae,G,X,oe,xe){for(let ve=0;ve<Ae.length;ve+=3){let Ee=Ae[ve+xe];Ee>=X&&Ee<=oe&&ka(G,Ae[ve],Ae[ve+1],Ae[ve+2])}}function kc(Ae,G,X,oe,xe,ve,Ee){let ze=ol(Ae),Ie=xe===0?Yh:Fu,Ne,at,Xe=Ae.start;for(let vn=0;vn<Ae.length-3;vn+=3){let gn=Ae[vn],Vn=Ae[vn+1],dr=Ae[vn+2],Fr=Ae[vn+3],yr=Ae[vn+4],$r=xe===0?gn:Vn,or=xe===0?Fr:yr,Gn=!1;Ee&&(Ne=Math.sqrt(Math.pow(gn-Fr,2)+Math.pow(Vn-yr,2))),$r<X?or>X&&(at=Ie(ze,gn,Vn,Fr,yr,X),Ee&&(ze.start=Xe+Ne*at)):$r>oe?or<oe&&(at=Ie(ze,gn,Vn,Fr,yr,oe),Ee&&(ze.start=Xe+Ne*at)):ka(ze,gn,Vn,dr),or<X&&$r>=X&&(at=Ie(ze,gn,Vn,Fr,yr,X),Gn=!0),or>oe&&$r<=oe&&(at=Ie(ze,gn,Vn,Fr,yr,oe),Gn=!0),!ve&&Gn&&(Ee&&(ze.end=Xe+Ne*at),G.push(ze),ze=ol(Ae)),Ee&&(Xe+=Ne)}let Rt=Ae.length-3,Qt=Ae[Rt],Dt=Ae[Rt+1],xn=xe===0?Qt:Dt;xn>=X&&xn<=oe&&ka(ze,Qt,Dt,Ae[Rt+2]),Rt=ze.length-3,ve&&Rt>=3&&(ze[Rt]!==ze[0]||ze[Rt+1]!==ze[1])&&ka(ze,ze[0],ze[1],ze[2]),ze.length&&G.push(ze)}function ol(Ae){let G=[];return G.size=Ae.size,G.start=Ae.start,G.end=Ae.end,G}function Ul(Ae,G,X,oe,xe,ve){for(let Ee of Ae)kc(Ee,G,X,oe,xe,ve,!1)}function ka(Ae,G,X,oe){Ae.push(G,X,oe)}function Yh(Ae,G,X,oe,xe,ve){let Ee=(ve-G)/(oe-G);return ka(Ae,ve,X+(xe-X)*Ee,1),Ee}function Fu(Ae,G,X,oe,xe,ve){let Ee=(ve-X)/(xe-X);return ka(Ae,G+(oe-G)*Ee,ve,1),Ee}function rr(Ae,G){let X=[];for(let oe=0;oe<Ae.length;oe++){let xe=Ae[oe],ve=xe.type,Ee;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ee=vo(xe.geometry,G);else if(ve==="MultiLineString"||ve==="Polygon"){Ee=[];for(let ze of xe.geometry)Ee.push(vo(ze,G))}else if(ve==="MultiPolygon"){Ee=[];for(let ze of xe.geometry){let Ie=[];for(let Ne of ze)Ie.push(vo(Ne,G));Ee.push(Ie)}}X.push(Ra(xe.id,ve,Ee,xe.tags))}return X}function vo(Ae,G){let X=[];X.size=Ae.size,Ae.start!==void 0&&(X.start=Ae.start,X.end=Ae.end);for(let oe=0;oe<Ae.length;oe+=3)X.push(Ae[oe]+G,Ae[oe+1],Ae[oe+2]);return X}function zf(Ae,G){if(Ae.transformed)return Ae;let X=1<<Ae.z,oe=Ae.x,xe=Ae.y;for(let ve of Ae.features){let Ee=ve.geometry,ze=ve.type;if(ve.geometry=[],ze===1)for(let Ie=0;Ie<Ee.length;Ie+=2)ve.geometry.push(Lu(Ee[Ie],Ee[Ie+1],G,X,oe,xe));else for(let Ie=0;Ie<Ee.length;Ie++){let Ne=[];for(let at=0;at<Ee[Ie].length;at+=2)Ne.push(Lu(Ee[Ie][at],Ee[Ie][at+1],G,X,oe,xe));ve.geometry.push(Ne)}}return Ae.transformed=!0,Ae}function Lu(Ae,G,X,oe,xe,ve){return[Math.round(X*(Ae*oe-xe)),Math.round(X*(G*oe-ve))]}function Fa(Ae,G,X,oe,xe){let ve=G===xe.maxZoom?0:xe.tolerance/((1<<G)*xe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:X,y:oe,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ze of Ae)Bf(Ee,ze,ve,xe);return Ee}function Bf(Ae,G,X,oe){let xe=G.geometry,ve=G.type,Ee=[];if(Ae.minX=Math.min(Ae.minX,G.minX),Ae.minY=Math.min(Ae.minY,G.minY),Ae.maxX=Math.max(Ae.maxX,G.maxX),Ae.maxY=Math.max(Ae.maxY,G.maxY),ve==="Point"||ve==="MultiPoint")for(let ze=0;ze<xe.length;ze+=3)Ee.push(xe[ze],xe[ze+1]),Ae.numPoints++,Ae.numSimplified++;else if(ve==="LineString")it(Ee,xe,Ae,X,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let ze=0;ze<xe.length;ze++)it(Ee,xe[ze],Ae,X,ve==="Polygon",ze===0);else if(ve==="MultiPolygon")for(let ze=0;ze<xe.length;ze++){let Ie=xe[ze];for(let Ne=0;Ne<Ie.length;Ne++)it(Ee,Ie[Ne],Ae,X,!0,Ne===0)}if(Ee.length){let ze=G.tags||null;if(ve==="LineString"&&oe.lineMetrics){ze={};for(let Ne in G.tags)ze[Ne]=G.tags[Ne];ze.mapbox_clip_start=xe.start/xe.size,ze.mapbox_clip_end=xe.end/xe.size}let Ie={geometry:Ee,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:ze};G.id!==null&&(Ie.id=G.id),Ae.features.push(Ie)}}function it(Ae,G,X,oe,xe,ve){let Ee=oe*oe;if(oe>0&&G.size<(xe?Ee:oe))return void(X.numPoints+=G.length/3);let ze=[];for(let Ie=0;Ie<G.length;Ie+=3)(oe===0||G[Ie+2]>Ee)&&(X.numSimplified++,ze.push(G[Ie],G[Ie+1])),X.numPoints++;xe&&(function(Ie,Ne){let at=0;for(let Xe=0,Rt=Ie.length,Qt=Rt-2;Xe<Rt;Qt=Xe,Xe+=2)at+=(Ie[Xe]-Ie[Qt])*(Ie[Xe+1]+Ie[Qt+1]);if(at>0===Ne)for(let Xe=0,Rt=Ie.length;Xe<Rt/2;Xe+=2){let Qt=Ie[Xe],Dt=Ie[Xe+1];Ie[Xe]=Ie[Rt-2-Xe],Ie[Xe+1]=Ie[Rt-1-Xe],Ie[Rt-2-Xe]=Qt,Ie[Rt-1-Xe]=Dt}})(ze,ve),Ae.push(ze)}let jl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Z_{constructor(G,X){let oe=(X=this.options=(function(ve,Ee){for(let ze in Ee)ve[ze]=Ee[ze];return ve})(Object.create(jl),X)).debug;if(oe&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(ve,Ee){let ze=[];if(ve.type==="FeatureCollection")for(let Ie=0;Ie<ve.features.length;Ie++)rs(ze,ve.features[Ie],Ee,Ie);else rs(ze,ve.type==="Feature"?ve:{geometry:ve},Ee);return ze})(G,X);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(ve,Ee){let ze=Ee.buffer/Ee.extent,Ie=ve,Ne=vs(ve,1,-1-ze,ze,0,-1,2,Ee),at=vs(ve,1,1-ze,2+ze,0,-1,2,Ee);return(Ne||at)&&(Ie=vs(ve,1,-ze,1+ze,0,-1,2,Ee)||[],Ne&&(Ie=rr(Ne,1).concat(Ie)),at&&(Ie=Ie.concat(rr(at,-1)))),Ie})(xe,X),xe.length&&this.splitTile(xe,0,0,0),oe&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,X,oe,xe,ve,Ee,ze){let Ie=[G,X,oe,xe],Ne=this.options,at=Ne.debug;for(;Ie.length;){xe=Ie.pop(),oe=Ie.pop(),X=Ie.pop(),G=Ie.pop();let Xe=1<<X,Rt=Nu(X,oe,xe),Qt=this.tiles[Rt];if(!Qt&&(at>1&&console.time("creation"),Qt=this.tiles[Rt]=Fa(G,X,oe,xe,Ne),this.tileCoords.push({z:X,x:oe,y:xe}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,oe,xe,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));let Gn=`z${X}`;this.stats[Gn]=(this.stats[Gn]||0)+1,this.total++}if(Qt.source=G,ve==null){if(X===Ne.indexMaxZoom||Qt.numPoints<=Ne.indexMaxPoints)continue}else{if(X===Ne.maxZoom||X===ve)continue;if(ve!=null){let Gn=ve-X;if(oe!==Ee>>Gn||xe!==ze>>Gn)continue}}if(Qt.source=null,G.length===0)continue;at>1&&console.time("clipping");let Dt=.5*Ne.buffer/Ne.extent,xn=.5-Dt,vn=.5+Dt,gn=1+Dt,Vn=null,dr=null,Fr=null,yr=null,$r=vs(G,Xe,oe-Dt,oe+vn,0,Qt.minX,Qt.maxX,Ne),or=vs(G,Xe,oe+xn,oe+gn,0,Qt.minX,Qt.maxX,Ne);G=null,$r&&(Vn=vs($r,Xe,xe-Dt,xe+vn,1,Qt.minY,Qt.maxY,Ne),dr=vs($r,Xe,xe+xn,xe+gn,1,Qt.minY,Qt.maxY,Ne),$r=null),or&&(Fr=vs(or,Xe,xe-Dt,xe+vn,1,Qt.minY,Qt.maxY,Ne),yr=vs(or,Xe,xe+xn,xe+gn,1,Qt.minY,Qt.maxY,Ne),or=null),at>1&&console.timeEnd("clipping"),Ie.push(Vn||[],X+1,2*oe,2*xe),Ie.push(dr||[],X+1,2*oe,2*xe+1),Ie.push(Fr||[],X+1,2*oe+1,2*xe),Ie.push(yr||[],X+1,2*oe+1,2*xe+1)}}getTile(G,X,oe){G=+G,X=+X,oe=+oe;let xe=this.options,{extent:ve,debug:Ee}=xe;if(G<0||G>24)return null;let ze=1<<G,Ie=Nu(G,X=X+ze&ze-1,oe);if(this.tiles[Ie])return zf(this.tiles[Ie],ve);Ee>1&&console.log("drilling down to z%d-%d-%d",G,X,oe);let Ne,at=G,Xe=X,Rt=oe;for(;!Ne&&at>0;)at--,Xe>>=1,Rt>>=1,Ne=this.tiles[Nu(at,Xe,Rt)];return Ne&&Ne.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",at,Xe,Rt),console.time("drilling down")),this.splitTile(Ne.source,at,Xe,Rt,G,X,oe),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?zf(this.tiles[Ie],ve):null):null}}function Nu(Ae,G,X){return 32*((1<<Ae)*X+G)+Ae}function Zn(Ae,G){let X=Ae.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);let oe=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!oe)return void G(null,null);let xe=Ne=>Ne.tags&&"3d_elevation_id"in Ne.tags&&"source"in Ne.tags&&Ne.tags.source==="elevation",ve=oe.features.filter(Ne=>xe(Ne)),Ee={_geojsonTileLayer:oe.features};ve.length>0&&(Ee={_geojsonTileLayer:oe.features.filter(Ne=>!xe(Ne)),hd_road_elevation:ve});let ze=new Ff(Ee),Ie=(function(Ne){let at=new i.bt;for(let Xe of Object.keys(Ne))at.writeMessage(3,Zh,{name:Xe,features:Ne[Xe]});return at.finish()})(Ee).buffer;G(null,{vectorTile:ze,rawData:Ie})}class Zo extends So{constructor(G,X,oe,xe,ve,Ee,ze){super(G,X,oe,xe,ve,Zn,ze),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new Yi}loadData(G,X){let oe=G&&G.request,xe=oe&&oe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(G,(ve,Ee)=>{if(ve||!Ee)return X(ve);if(typeof Ee!="object")return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Ie=i.U(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(Ne=>`${Ne.key}: ${Ne.message}`).join(", "));Ee.features=Ee.features.filter(Ne=>Ie.value.evaluate({zoom:0},Ne))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new W_((function({superclusterOptions:Ie,clusterProperties:Ne}){if(!Ne||!Ie)return Ie;let at={},Xe={},Rt={accumulated:null,zoom:0},Qt={properties:null},Dt=Object.keys(Ne);for(let xn of Dt){let[vn,gn]=Ne[xn],Vn=i.U(gn),dr=i.U(typeof vn=="string"?[vn,["accumulated"],["get",xn]]:vn);at[xn]=Vn.value,Xe[xn]=dr.value}return Ie.map=xn=>{Qt.properties=xn;let vn={};for(let gn of Dt)vn[gn]=at[gn].evaluate(Rt,Qt);return vn},Ie.reduce=(xn,vn)=>{Qt.properties=vn;for(let gn of Dt)Rt.accumulated=xn[gn],xn[gn]=Xe[gn].evaluate(Rt,Qt)},Ie})(G)).load(Ee.features):G.dynamic?this._dynamicIndex:(function(Ie,Ne){return new Z_(Ie,Ne)})(Ee,G.geojsonVtOptions)}catch(Ie){return X(Ie)}let ze={};if(xe){let Ie=E(oe);Ie&&(ze.resourceTiming={},ze.resourceTiming[G.source]=JSON.parse(JSON.stringify(Ie)))}X(null,ze)}})}reloadTile(G,X){let oe=this.loaded;return oe&&oe[G.uid]?G.partial?X(null,void 0):super.reloadTile(G,X):this.loadTile(G,X)}loadGeoJSON(G,X){if(G.request)i.m(G.request,X);else{if(typeof G.data!="string")return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return X(null,JSON.parse(G.data))}catch{return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(G,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(oe){X(oe)}}getClusterChildren(G,X){try{X(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(oe){X(oe)}}getClusterLeaves(G,X){try{X(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(oe){X(oe)}}}class X_{constructor(G,X,oe){this.tileID=new i.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=X,this.worldview=oe}parse(G,X,oe,xe){this.status="parsing";let ve=new i.aQ(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),Ee=[],ze=X.familiesBySource[oe.source],Ie=new i.fn(ve,oe.promoteId);Ie.bucketLayerIDs=[],Ie.is3DTile=!0,i.fC(G).then(Ne=>{if(!Ne)return xe(new Error("Could not parse tile"));let at=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ne.json.asset.extras&&Ne.json.asset.extras.MAPBOX_mesh_features,Xe=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("EXT_meshopt_compression"),Rt=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(let Qt in ze)for(let Dt of ze[Qt]){let xn=Dt[0];Ie.bucketLayerIDs.push(Dt.map(Vn=>i.B(Vn.id,Vn.scope))),xn.recalculate(Rt,[]);let vn=i.fD(Ne,1/i.d7(oe.tileID.canonical)),gn=new i.fE(Dt,vn,ve,at,Xe,this.brightness,Ie,this.worldview);at||(gn.needsUpload=!0),Ee.push(gn),gn.evaluate(xn)}this.status="done",xe(null,{buckets:Ee,featureIndex:Ie,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ne=>xe(new Error(Ne.message)))}}class zu{constructor(G,X,oe,xe,ve,Ee,ze,Ie){this.actor=G,this.layerIndex=X,this.availableImages=oe,this.availableModels=xe,this.brightness=ze,this.loading={},this.loaded={},this.worldview=Ie}loadTile(G,X){let oe=G.uid,xe=this.loading[oe]=new X_(G,this.brightness,this.worldview);i.bu(G.request,(ve,Ee)=>{let ze=!this.loading[oe];return delete this.loading[oe],ze||ve?(xe.status="done",ze||(this.loaded[oe]=xe),X(ve)):Ee&&Ee.byteLength!==0?void xe.parse(Ee,this.layerIndex,G,(Ie,Ne)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[oe]=xe,Ie||!Ne?X(Ie):X(null,Ne)}):(xe.status="done",this.loaded[oe]=xe,X())})}reloadTile(G,X){let oe=this.loaded,xe=G.uid;if(oe&&oe[xe]){let ve=oe[xe];ve.projection=G.projection,ve.brightness=G.brightness;let Ee=(ze,Ie)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(G,X)),X(ze,Ie)};ve.status==="parsing"?ve.reloadCallback=Ee:ve.status==="done"&&this.loadTile(G,X)}}abortTile(G,X){let oe=G.uid;this.loading[oe]&&delete this.loading[oe],X()}removeTile(G,X){let oe=this.loaded,xe=G.uid;oe&&oe[xe]&&delete oe[xe],X()}}class Kh{constructor(G){this.self=G,this.actor=new i.fG(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:So,geojson:Zo,"raster-dem":is,"raster-array":Gh,"batched-model":zu},this.workerSources={},this.self.registerWorkerSource=(X,oe)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=oe},this.self.registerRTLTextPlugin=X=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=X.applyArabicShaping,i.fH.processBidirectionalText=X.processBidirectionalText,i.fH.processStyledBidirectionalText=X.processStyledBidirectionalText;for(let oe of this.rtlPluginParsingListeners)oe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(G,X,oe){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],oe()}checkIfReady(G,X,oe){oe()}setReferrer(G,X){this.referrer=X}spriteLoaded(G,X){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});let{scope:oe,isLoaded:xe}=X;if(this.isSpriteLoaded[G][oe]=xe,this.workerSources[G]&&this.workerSources[G][oe])for(let ve in this.workerSources[G][oe]){let Ee=this.workerSources[G][oe][ve];for(let ze in Ee){let Ie=Ee[ze];Ie instanceof So&&(Ie.isSpriteLoaded=xe,Ie.fire(new i.z("isSpriteLoaded")))}}}setImages(G,X,oe){this.availableImages[G]||(this.availableImages[G]={});let{scope:xe,images:ve}=X;if(this.availableImages[G][xe]=ve,this.workerSources[G]&&this.workerSources[G][xe]){for(let Ee in this.workerSources[G][xe]){let ze=this.workerSources[G][xe][Ee];for(let Ie in ze)ze[Ie].availableImages=ve}oe()}else oe()}setModels(G,{scope:X,models:oe},xe){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][X]=oe,this.workerSources[G]&&this.workerSources[G][X]){for(let ve in this.workerSources[G][X]){let Ee=this.workerSources[G][X][ve];for(let ze in Ee)Ee[ze].availableModels=oe}xe()}else xe()}setProjection(G,X){this.projections[G]=i.cm(X)}setBrightness(G,X,oe){this.brightness=X,oe()}setWorldview(G,X,oe){this.worldview=X,oe()}setLayers(G,X,oe){this.getLayerIndex(G,X.scope).replace(X.layers,X.options),oe()}updateLayers(G,X,oe){this.getLayerIndex(G,X.scope).update(X.layers,X.removedIds,X.options),oe()}loadTile(G,X,oe){X.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,X.type,X.source,X.scope).loadTile(X,oe)}decodeRasterArray(G,X,oe){this.getWorkerSource(G,X.type,X.source,X.scope).decodeRasterArray(X,oe)}reloadTile(G,X,oe){X.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,X.type,X.source,X.scope).reloadTile(X,oe)}abortTile(G,X,oe){this.getWorkerSource(G,X.type,X.source,X.scope).abortTile(X,oe)}removeTile(G,X,oe){this.getWorkerSource(G,X.type,X.source,X.scope).removeTile(X,oe)}removeSource(G,X,oe){if(!(this.workerSources[G]&&this.workerSources[G][X.scope]&&this.workerSources[G][X.scope][X.type]&&this.workerSources[G][X.scope][X.type][X.source]))return;let xe=this.workerSources[G][X.scope][X.type][X.source];delete this.workerSources[G][X.scope][X.type][X.source],xe.removeSource!==void 0?xe.removeSource(X,oe):oe()}loadWorkerSource(G,X,oe){try{this.self.importScripts(X.url),oe()}catch(xe){oe(xe)}}syncRTLPluginState(G,X,oe){if(i.fH.isParsed())oe(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(oe);else try{i.fH.setState(X);let xe=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||xe==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(xe),i.fH.isParsed()?oe(null,!0):this.rtlPluginParsingListeners.push(oe))}catch(xe){oe(xe)}}setDracoUrl(G,X){this.dracoUrl=X}getAvailableImages(G,X){this.availableImages[G]||(this.availableImages[G]={});let oe=this.availableImages[G][X];return oe||(oe=[]),oe}getAvailableModels(G,X){this.availableModels[G]||(this.availableModels[G]={});let oe=this.availableModels[G][X];return oe||(oe={}),oe}getLayerIndex(G,X){this.layerIndexes[G]||(this.layerIndexes[G]={});let oe=this.layerIndexes[G][X];return oe||(oe=this.layerIndexes[G][X]=new K,oe.scope=X),oe}getWorkerSource(G,X,oe,xe){let ve=this.workerSources;return ve[G]||(ve[G]={}),ve[G][xe]||(ve[G][xe]={}),ve[G][xe][X]||(ve[G][xe][X]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),ve[G][xe][X][oe]||(ve[G][xe][X][oe]=new this.workerSourceTypes[X]({send:(Ee,ze,Ie,Ne,at,Xe)=>this.actor.send(Ee,ze,Ie,G,at,Xe),scheduler:this.actor.scheduler},this.getLayerIndex(G,xe),this.getAvailableImages(G,xe),this.getAvailableModels(G,xe),this.isSpriteLoaded[G][xe],void 0,this.brightness,this.worldview)),ve[G][xe][X][oe]}rasterizeImagesWorker(G,X,oe){let xe=new Map;for(let[ve,{image:Ee,imageVariant:ze}]of X.tasks.entries()){let Ie=this.imageRasterizer.rasterize(ze,Ee,X.scope,G);xe.set(ve,Ie)}oe(void 0,xe)}removeRasterizedImages(G,X,oe){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,G),oe()}enforceCacheSizeLimit(G,X){i.fJ(X)}getWorkerPerformanceMetrics(G,X,oe){oe(void 0,void 0)}}return i.fF(self)&&(self.worker=new Kh(self)),Kh}),l(["./shared"],function(i){var E="3.17.0";let O={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(p){performance.mark(p)},measure(p,o,c){performance.measure(p,o,c)}};function K(p){let o=p.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var le,De={},Qe=(function(){if(le)return De;function p(f){return!o(f)}function o(f){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(S),y})()?(function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===y.width})()?(c[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(c[_]=(function(y){var x,w=(function(S){var M=document.createElement("canvas"),A=Object.create(p.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=S,M.getContext("webgl2",A)})(y);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)})(_)),c[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}le=1,De.supported=p,De.notSupportedReason=o;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},De})();function Fe(p,o,c){let f=document.createElement(p);return o!=null&&(f.className=o),c&&c.appendChild(f),f}function gt(p,o,c){let f=document.createElementNS("http://www.w3.org/2000/svg",p);for(let _ of Object.keys(o))f.setAttributeNS(null,_,String(o[_]));return c&&c.appendChild(f),f}let jt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ot=jt&&jt.userSelect!==void 0?"userSelect":"WebkitUserSelect",Kt;function Hn(){jt&&Ot&&(Kt=jt[Ot],jt[Ot]="none")}function Er(){jt&&Ot&&(jt[Ot]=Kt)}function _r(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",_r,!0)}function So(){window.addEventListener("click",_r,!0),window.setTimeout(()=>{window.removeEventListener("click",_r,!0)},0)}function is(p,o){let c=p.getBoundingClientRect();return qh(p,c,o)}function zl(p,o){let c=p.getBoundingClientRect(),f=[];for(let _=0;_<o.length;_++)f.push(qh(p,c,o[_]));return f}function Gh(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function qh(p,o,c){let f=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new i.P((c.clientX-o.left)*f,(c.clientY-o.top)*f)}let Wh="01",gi="NO_ACCESS_TOKEN";class Ff{constructor(o,c,f){this._transformRequestFn=o,this._customAccessToken=c,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){let o=(function(){let c="";for(let f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Wh,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeStyleURL(o,c){if(!i.h(o))return o;let f=vr(o);return f.params.push(`sdk=js-${E}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeGlyphsURL(o,c){if(!i.h(o))return o;let f=vr(o);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeModelURL(o,c){if(!i.h(o))return o;let f=vr(o);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeSourceURL(o,c,f,_){if(!i.h(o))return o;let y=vr(o);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),f&&y.params.push(`language=${f}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||c)}normalizeIconsetURL(o,c){let f=vr(o);return i.h(o)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||c)):Yi(f)}normalizeSpriteURL(o,c,f,_){let y=vr(o);return i.h(o)?(y.path=`/styles/v1${y.path}/sprite${c}${f}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${c}${f}`,Yi(y))}normalizeTileURL(o,c,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.h(o))return o;let _=vr(o);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||f&&_.authority!=="raster"&&f===512?"@2x":""}${i.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${i.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${i.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${i.e.TILE_URL_VERSION}${_.path}`);let y=this._customAccessToken||(function(x){for(let w of x){let S=w.match(/^access_token=(.*)$/);if(S)return S[1]}return null})(_.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(o,c){let f=vr(o);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return o;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let y=f.params;return c&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(o,c){let f=!!c&&i.h(c),_=[];for(let y of o.tiles||[])i.j(y)?_.push(this.canonicalizeTileURL(y,f)):_.push(y);return _}_makeAPIURL(o,c){let f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=vr(i.e.API_URL);if(o.protocol=_.protocol,o.authority=_.authority,o.protocol==="http"){let y=o.params.indexOf("secure");y>=0&&o.params.splice(y,1)}if(_.path!=="/"&&(o.path=`${_.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Yi(o);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return o.params=o.params.filter(y=>y.indexOf("access_token")===-1),o.params.push(`access_token=${c||""}`),Yi(o)}}let ho=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vr(p){let o=p.match(ho);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Yi(p){let o=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${o}`}let jr="mapbox.eventData";function il(p){if(!p)return null;let o=p.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.l(o[1]))}catch{return null}}class Pa{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){let c=il(i.e.ACCESS_TOKEN),f="";return f=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",o?`${jr}.${o}:${f}`:`${jr}:${f}`}fetchEventData(){let o=i.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(o)try{let y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));let x=localStorage.getItem(f);x&&(this.anonId=x);let w=localStorage.getItem(_);w&&(this.anonIdTimestamp=Number(w));let S=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<S)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){let o=i.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),y=this.anonId,x=this.anonIdTimestamp;if(o&&y)try{localStorage.setItem(f,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),x&&localStorage.setItem(_,x.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,f,_){if(!i.e.EVENTS_URL)return;let y=vr(i.e.EVENTS_URL);y.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(o).toISOString()},w=c?Object.assign(x,c):x,S={url:Yi(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=i.p(S,M=>{this.pendingRequest=null,f(M),this.saveEventData(),this.processRequests(_)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}class rl extends Pa{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!i.e.EVENTS_URL||!o&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();let c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:c,payload:f}=this.queue.shift();this.postEvent(c,f,()=>{},o)}}let Oa=new class extends Pa{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>i.h(c)||i.j(c))&&this.queueRequest(Date.now(),o)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let o=il(i.e.ACCESS_TOKEN),c=o?o.u:i.e.ACCESS_TOKEN,f=c!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),f=!0);let _=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(_),w=(_-this.eventData.lastSuccess)/864e5;f=f||w>=1||w<-1||y.getDate()!==x.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Wh,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=c)},p):this.processRequests()}},ur=Oa.postTurnstileEvent.bind(Oa),$s=new class extends Pa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,o,c,f){this.skuToken=o,this.errorCb=f,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(gi)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Wh,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p))}remove(){this.errorCb=null}},Lf=$s.postMapLoadEvent.bind($s),Zh=new class extends Pa{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let o=this.mapInstanceIdMap.get(p);return o||(o=i.u(),this.mapInstanceIdMap.set(p,o)),o}getEventId(p){let o=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,o+1),o}postStyleLoadEvent(p,o){let{map:c,style:f,importedStyles:_}=o;if(!i.e.EVENTS_URL||!p&&!i.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(c),x={mapInstanceId:y,eventId:this.getEventId(y),style:f};_.length&&(x.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:x},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,payload:c}=this.queue.shift();this.postEvent(o,c,()=>{},p)}},Nf=Zh.postStyleLoadEvent.bind(Zh),Dc=new rl({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ji=Dc.postMetricsEvent.bind(Dc),Sr=new rl({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Fo=Sr.postMetricsEvent.bind(Sr),Au=new class extends Pa{constructor(){super("gljs.performance")}postPerformanceEvent(p,o){i.e.EVENTS_URL&&(p||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,performanceData:c}=this.queue.shift(),f=(function(_){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),w=(function(L){let j={};if(L){for(let V in L)if(V!=="other")for(let W of L[V]){let q=`${V}ResolveRangeMin`,J=`${V}ResolveRangeMax`,ie=`${V}RequestCount`,ee=`${V}RequestCachedCount`;j[q]=Math.min(j[q]||1/0,W.startTime),j[J]=Math.max(j[J]||-1/0,W.responseEnd);let ge=de=>{j[de]===void 0&&(j[de]=0),++j[de]};W.transferSize!==void 0&&W.transferSize===0&&ge(ee),ge(ie)}}return j})((function(L,j){let V={};if(L)for(let W of L){let q=j(W);V[q]===void 0&&(V[q]=[]),V[q].push(W)}return V})(y,K)),S=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=M?M.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},k=(L,j,V)=>{V!=null&&L.push({name:j,value:V.toString()})};for(let L in w)k(F.counters,L,w[L]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(k(F.counters,"interactionRangeMin",_.interactionRange[0]),k(F.counters,"interactionRangeMax",_.interactionRange[1])),x)for(let L of Object.values(O)){let j=x.find(V=>V.name===L);j&&k(F.counters,L,j.startTime)}return k(F.counters,"visibilityHidden",_.visibilityHidden),k(F.attributes,"style",(function(L){if(L)for(let j of L){let V=j.name.split("?")[0];if(i.i(V)){let W=V.split("/").slice(-2);if(W.length===2)return`mapbox://styles/${W[0]}/${W[1]}`}}})(y)),k(F.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),k(F.attributes,"fogEnabled",_.fogEnabled?"true":"false"),k(F.attributes,"projection",_.projection),k(F.attributes,"zoom",_.zoom),k(F.metadata,"devicePixelRatio",S),k(F.metadata,"connectionEffectiveType",A),k(F.metadata,"navigatorUserAgent",navigator.userAgent),k(F.metadata,"screenWidth",window.screen.width),k(F.metadata,"screenHeight",window.screen.height),k(F.metadata,"windowWidth",window.innerWidth),k(F.metadata,"windowHeight",window.innerHeight),k(F.metadata,"mapWidth",_.width/S),k(F.metadata,"mapHeight",_.height/S),k(F.metadata,"webglRenderer",_.renderer),k(F.metadata,"webglVendor",_.vendor),k(F.metadata,"sdkVersion",E),k(F.metadata,"sdkIdentifier","mapbox-gl-js"),F})(c);for(let _ of f.metadata);for(let _ of f.counters);for(let _ of f.attributes);this.postEvent(o,f,()=>{},p)}},Pr=Au.postPerformanceEvent.bind(Au),Ac=new class extends Pa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,o,c,f){if(!i.e.API_URL||!i.e.SESSION_PATH)return;let _=vr(i.e.API_URL+i.e.SESSION_PATH);_.params.push(`sku=${o||""}`),_.params.push(`access_token=${f||i.e.ACCESS_TOKEN||""}`);let y={url:Yi(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(y,x=>{this.pendingRequest=null,c(x),this.saveEventData(),this.processRequests(f)})}getSessionAPI(p,o,c,f){this.skuToken=o,this.errorCb=f,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(gi)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p)}remove(){this.errorCb=null}},Pc=Ac.getSessionAPI.bind(Ac),Os=new Set;function Wo(p,o){o?Os.add(p):Os.delete(p)}class kr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,c){this._updatedSourceCaches[o]=c,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let c=o.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(o.id),this.setDirty()}removeLayer(o){let c=o.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][o.id]=o,this._updatedLayers[c].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let c in this._updatedLayers)o[c]=o[c]||{},o[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)o[c]=o[c]||{},o[c].removedIds=Object.keys(this._removedLayers[c]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function W_(p){let{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class Pd extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);let c=this.atlasTexture.get(o);c&&(c.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(o.id,o)}removeImageProvider(o,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(o)}getPendingImageProviders(){let o=[];for(let c of this.imageProviders.values())for(let f of c.values())f.hasPendingRequests()&&o.push(f);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(let o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,c){if(this.loaded.get(c)!==o&&(this.loaded.set(c,o),o)){for(let{ids:f,callback:_}of this.requestors)this._notify(f,c,_);this.requestors=[]}}hasImage(o,c){return!!this.getImage(o,c)}getImage(o,c){return this.images.get(c).get(o.toString())}addImage(o,c,f){this._validate(o,f)&&this.images.get(c).set(o.toString(),f)}_validate(o,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "content" value`))),f=!1),f}_validateStretch(o,c){if(!o)return!0;let f=0;for(let _ of o){if(_[0]<f||_[1]<_[0]||c<_[1])return!1;f=_[1]}return!0}_validateContent(o,c){return o?o.length!==4||!c.usvg&&(o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,c,f){let _=this.images.get(c).get(o.toString());f.version=_.version+1,this.images.get(c).set(o.toString(),f),this.updatedImages.get(c).add(o),this.removeFromImageRasterizerCache(o,c)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,c){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([o],c))}removeImage(o,c){let f=this.images.get(c),_=f.get(o.toString());f.delete(o.toString()),this.patterns.get(c).delete(o.toString()),this.removeFromImageRasterizerCache(o,c),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(c=>i.I.from(c))}getImages(o,c,f){let _=[],y=[],x=this.imageProviders.get(c);for(let A of o){if(!A.iconsetId){_.push(A);continue}let F=x.get(A.iconsetId);F&&(this.getImage(A,c)?y.push(A):F.addPendingRequest(A))}if(_.length===0)return void this._notify(y,c,f);let w=!0,S=!!this.loaded.get(c),M=this.images.get(c);if(!S)for(let A of _)M.has(A.toString())||(w=!1);S||w?this._notify(_,c,f):this.requestors.push({ids:_,scope:c,callback:f})}rasterizeImages(o,c){let f=new Map,{tasks:_,scope:y}=o;for(let[x,w]of _.entries()){let S=this.getImage(w.id,y);S&&f.set(x,{image:S,imageVariant:w})}this._rasterizeImages(y,f,c)}_rasterizeImages(o,c,f){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:o},f);else{let _=new Map;for(let[y,{image:x,imageVariant:w}]of c.entries())_.set(y,this.imageRasterizer.rasterize(w,x,o,0));f(void 0,_)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,c,f){let _=this.images.get(c),y=new Map;for(let x of o){if(!_.get(x.toString())){if(x.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:x.name}))}let w=_.get(x.toString());if(!w){i.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let S={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(S,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),y.set(i.I.toString(x),S)}f(null,y)}getPixelSize(o){let{width:c,height:f}=this.atlasImage.get(o);return{width:c,height:f}}getPattern(o,c,f){let _=o.toString(),y=this.patterns.get(c),x=y.get(_),w=this.getImage(o,c);if(!w)return null;if(x){if(x.position.version===w.version)return x.position;x.position.version=w.version}else{if(w.usvg&&!w.data){let S=this.getPatternInFlightId(_,c);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);let M=new i.A(o).scaleSelf(i.o.devicePixelRatio),A=new Map([[M.toString(),{image:w,imageVariant:M}]]);return this._rasterizeImages(c,A,(F,k)=>this.storePatternImage(M,c,w,f,k)),null}this.storePattern(o,c,w)}return this._updatePatternAtlas(c,f),y.get(_).position}getPatternInFlightId(o,c){return i.B(o,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,c,f,_,y){let x=o.toString(),w=y?y.get(x):void 0;w&&(f.data=w,this.storePattern(o.id,c,f),this._updatePatternAtlas(c,_),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),c)))}storePattern(o,c,f){let _={w:f.data.width+2*i.C,h:f.data.height+2*i.C,x:0,y:0},y=new i.F(_,f,i.C);this.patterns.get(c).set(o.toString(),{bin:_,position:y})}destroyAtlasTextures(){for(let o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,c){let f=o.gl,_=this.atlasTexture.get(c);_?this.dirty&&(_.update(this.atlasImage.get(c)),this.dirty=!1):(_=new i.T(o,this.atlasImage.get(c),f.RGBA8),this.atlasTexture.set(c,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(o,c){let f=this.patterns.get(o),_=Array.from(f.values()).map(({bin:M})=>M),{w:y,h:x}=i.G(_),w=this.atlasImage.get(o);w.resize({width:y||1,height:x||1});let S=this.images.get(o);for(let[M,{bin:A,position:F}]of f.entries()){let k=F.padding,L=A.x+k,j=A.y+k,V=S.get(M).data,W=V.width,q=V.height;k=k>1?k-1:k,i.q.copy(V,w,{x:0,y:0},{x:L,y:j},{width:W,height:q},c),i.q.copy(V,w,{x:0,y:q-k},{x:L,y:j-k},{width:W,height:k},c),i.q.copy(V,w,{x:0,y:0},{x:L,y:j+q},{width:W,height:k},c),i.q.copy(V,w,{x:W-k,y:0},{x:L-k,y:j},{width:k,height:q},c),i.q.copy(V,w,{x:0,y:0},{x:L+W,y:j},{width:k,height:q},c),i.q.copy(V,w,{x:W-k,y:q-k},{x:L-k,y:j-k},{width:k,height:k},c),i.q.copy(V,w,{x:0,y:q-k},{x:L+W,y:j-k},{width:k,height:k},c),i.q.copy(V,w,{x:0,y:0},{x:L+W,y:j+q},{width:k,height:k},c),i.q.copy(V,w,{x:W-k,y:0},{x:L-k,y:j+q},{width:k,height:k},c)}this.dirty=!0}beginFrame(){for(let o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,c){let f=this.images.get(c);for(let _ of o){if(this.callbackDispatchedThisFrame.get(c).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(_.toString());let y=f.get(_.toString());W_(y)&&this.updateImage(_,c,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Pu(p){let o=p.value,c=p.valueSpec,f=p.style,_=p.styleSpec,y=p.key,x=p.arrayElementValidator||rr;if(!Array.isArray(o))return[new i.V(y,o,`array expected, ${i.K(o)} found`)];if(c.length&&o.length!==c.length)return[new i.V(y,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new i.V(y,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let w={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};_.$version<7&&(w.function=c.function),i.H(c.value)&&(w=c.value);let S=[];for(let M=0;M<o.length;M++)S=S.concat(x({array:o,arrayIndex:M,value:o[M],valueSpec:w,style:f,styleSpec:_,key:`${y}[${M}]`},!0));return S}function Oc(p){let o=p.key,c=p.value,f=p.valueSpec;if(!i.L(c))return[new i.V(o,c,`number expected, ${i.K(c)} found`)];if(c!=c)return[new i.V(o,c,"number expected, NaN found")];if("minimum"in f){let _=f.minimum;if(Array.isArray(f.minimum)&&(_=f.minimum[p.arrayIndex]),c<_)return[new i.V(o,c,`${c} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(Array.isArray(f.maximum)&&(_=f.maximum[p.arrayIndex]),c>_)return[new i.V(o,c,`${c} is greater than the maximum value ${_}`)]}return[]}function Rc(p){let o=p.key,c=p.value;if(!i.H(c))return[new i.V(o,c,`object expected, ${i.K(c)} found`)];let f=p.valueSpec,_=i.J(c.type),y,x,w,S={},M=_!=="categorical"&&c.property===void 0,A=!M,F=(function(V){let W=V.stops;return Array.isArray(W)&&Array.isArray(W[0])&&i.H(W[0][0])})(c),k=vo({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(V){if(_==="identity")return[new i.V(V.key,V.value,'identity function may not have a "stops" property')];let W=[],q=V.value;return W=W.concat(Pu({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),Array.isArray(q)&&q.length===0&&W.push(new i.V(V.key,q,"array must have at least one stop")),W},default:function(V){return rr({key:V.key,value:V.value,valueSpec:f,style:V.style,styleSpec:V.styleSpec})}}});return _==="identity"&&M&&k.push(new i.V(p.key,p.value,'missing required property "property"')),_==="identity"||c.stops||k.push(new i.V(p.key,p.value,'missing required property "stops"')),_==="exponential"&&f.expression&&!i.M(f)&&k.push(new i.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(A&&!i.N(f)?k.push(new i.V(p.key,p.value,"property functions not supported")):M&&!i.O(f)&&k.push(new i.V(p.key,p.value,"zoom functions not supported"))),_!=="categorical"&&!F||c.property!==void 0||k.push(new i.V(p.key,p.value,'"property" property is required')),k;function L(V){let W=[],q=V.value,J=V.key;if(!Array.isArray(q))return[new i.V(J,q,`array expected, ${i.K(q)} found`)];if(q.length!==2)return[new i.V(J,q,`array length 2 expected, length ${q.length} found`)];if(F){if(!i.H(q[0]))return[new i.V(J,q,`object expected, ${i.K(q[0])} found`)];let ie=q[0];if(ie.zoom===void 0)return[new i.V(J,q,"object stop key must have zoom")];if(ie.value===void 0)return[new i.V(J,q,"object stop key must have value")];let ee=i.J(ie.zoom);if(typeof ee!="number")return[new i.V(J,ie.zoom,"stop zoom values must be numbers")];if(w&&w>ee)return[new i.V(J,ie.zoom,"stop zoom values must appear in ascending order")];ee!==w&&(w=ee,x=void 0,S={}),W=W.concat(vo({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Oc,value:j}}))}else W=W.concat(j({key:`${J}[0]`,value:q[0],style:V.style,styleSpec:V.styleSpec},q));return i.Q(i.S(q[1]))?W.concat([new i.V(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):W.concat(rr({key:`${J}[1]`,value:q[1],valueSpec:f,style:V.style,styleSpec:V.styleSpec}))}function j(V,W){let q=i.K(V.value),J=i.J(V.value),ie=V.value!==null?V.value:W;if(y){if(q!==y)return[new i.V(V.key,ie,`${q} stop domain type must match previous stop domain type ${y}`)]}else y=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new i.V(V.key,ie,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&_!=="categorical"){let ee=`number expected, ${q} found`;return i.N(f)&&_===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(V.key,ie,ee)]}return _!=="categorical"||q!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?_!=="categorical"&&q==="number"&&typeof J=="number"&&typeof x=="number"&&x!==void 0&&J<x?[new i.V(V.key,ie,"stop domain values must appear in ascending order")]:(x=J,_==="categorical"&&J in S?[new i.V(V.key,ie,"stop domain values must be unique")]:(S[J]=!0,[])):[new i.V(V.key,ie,`integer expected, found ${String(J)}`)]}}function Lo(p){let o=(p.expressionContext==="property"?i.W:i.U)(i.S(p.value),p.valueSpec);if(o.result==="error")return o.value.map(f=>new i.V(`${p.key}${f.key}`,p.value,f.message));let c=o.value.expression||o.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!i.Z(c))return[new i.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Bl(c,p);if(p.expressionContext==="appearance")return Od(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!i.X(c,["zoom","feature-state"]))return[new i.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!i.Y(c))return[new i.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bl(p,o){let c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.delete(_);if(c.size===0)return[];let f=[];return p instanceof i._&&c.has(p.name)?[new i.V(o.key,o.value,`["${p.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(p.eachChild(_=>{f.push(...Bl(_,o))}),f)}function Od(p,o){let c=new Set;if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.add(_);if(c.size===0)return[];let f=[];return p instanceof i._&&!c.has(p.name)?[new i.V(o.key,o.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(_=>{f.push(...Od(_,o))}),f)}function Ra(p){let o=p.key,c=p.value,f=p.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(i.J(c))===-1&&_.push(new i.V(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(i.J(c))===-1&&_.push(new i.V(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Vl(p){return i.a2(i.S(p.value))?Lo(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):rs(p)}function rs(p){let o=p.value,c=p.key;if(!Array.isArray(o))return[new i.V(c,o,`array expected, ${i.K(o)} found`)];if(o.length<1)return[new i.V(c,o,"filter array must have at least 1 element")];let f=p.styleSpec,_=Ra({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator}),y=()=>{o.length>=2&&(i.a0(o[1])||_.push(new i.V(`${c}[1]`,o[1],`string expected, ${i.K(o[1])} found`)));for(let x=2;x<o.length;x++)i.J(o[1])==="$type"?_=_.concat(Ra({key:`${c}[${x}]`,value:o[x],valueSpec:f.geometry_type})):i.a0(o[x])||i.L(o[x])||i.$(o[x])||_.push(new i.V(`${c}[${x}]`,o[x],`string, number, or boolean expected, ${i.K(o[x])} found.`))};switch(i.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.J(o[1])==="$type"&&_.push(new i.V(c,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&_.push(new i.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"==":case"!=":o.length!==3&&_.push(new i.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"in":case"!in":y();break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)_=_.concat(rs({key:`${c}[${x}]`,value:o[x],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":o.length!==2?_.push(new i.V(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):i.a0(o[1])||_.push(new i.V(`${c}[1]`,o[1],`string expected, ${i.K(o[1])} found`))}return _}function Ou(p,o){let c=p.key,f=p.style,_=p.layer,y=p.styleSpec,x=p.value,w=p.objectKey,S=y[`${o}_${p.layerType}`];if(!S)return[];let M=w.match(/^(.*)-use-theme$/);if(M&&S[M[1]])return i.Q(i.S(x))?[].concat(rr({key:c,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w})):rr({key:c,value:x,valueSpec:{type:"string"},style:f,styleSpec:y});let A=w.match(/^(.*)-transition$/);if(o==="paint"&&A&&S[A[1]]&&S[A[1]].transition)return rr({key:c,value:x,valueSpec:y.transition,style:f,styleSpec:y});let F=p.valueSpec||S[w];if(!F)return[new i.a3(c,x,`unknown property "${w}"`)];let k;if(i.a0(x)&&i.N(F)&&!F.tokens&&(k=/^{([^}]+)}$/.exec(x))){let j=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new i.V(c,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let L=[];if(p.layerType==="symbol")w!=="text-field"||!f||f.glyphs||f.imports||L.push(new i.V(c,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&i.a4(i.S(x))&&i.J(x.type)==="identity"&&L.push(new i.V(c,x,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&o==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&i.N(F)&&(i.a5(F)||i.O(F))){let j=i.W(i.S(x),F).value,V="expression"in j&&j.expression||"_styleExpression"in j&&j._styleExpression&&j._styleExpression.expression;V&&!i.X(V,["measure-light"])&&(w==="model-emissive-strength"&&i.Y(V)&&i.Z(V)||L.push(new i.V(c,x,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return L.concat(rr({key:p.key,value:x,valueSpec:F,style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w}))}function Ru(p){return Ou(p,"paint")}function ku(p){return Ou(p,"layout")}function Rd(p){let o=[],c=p.value,f=p.key,_=p.style,y=p.styleSpec;if(!i.H(c))return[new i.V(f,c,"object expected")];c.type||c.ref||o.push(new i.V(f,c,'either "type" or "ref" is required'));let x=i.J(c.type),w=i.J(c.ref);if(c.id){let S=i.J(c.id);for(let M=0;M<p.arrayIndex;M++){let A=_.layers[M];i.J(A.id)===S&&o.push(new i.V(f,c.id,`duplicate layer id "${S}", previously used at line ${A.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&o.push(new i.V(f,c[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{i.J(M.id)===w&&(S=M)}),S?S.ref?o.push(new i.V(f,c.ref,"ref cannot reference another ref layer")):x=i.J(S.type):typeof w=="string"&&o.push(new i.V(f,c.ref,`ref layer "${w}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(c.source)if(i.a0(c.source)){let S=_.sources&&_.sources[c.source],M=S&&i.J(S.type);S?M==="vector"&&x==="raster"?o.push(new i.V(f,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&x!=="raster"?o.push(new i.V(f,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&x!=="hillshade"?o.push(new i.V(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&M==="geojson"&&!S.lineMetrics?o.push(new i.V(f,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&M!=="raster-array"&&o.push(new i.V(f,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):o.push(new i.V(f,c.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new i.V(f,c.source,`source "${c.source}" not found`))}else o.push(new i.V(`${f}.source`,c.source,'"source" must be a string'));else o.push(new i.V(f,c,'missing required property "source"'));return o=o.concat(vo({key:f,value:c,valueSpec:y.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rr({key:`${f}.type`,value:c.type,valueSpec:y.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:S=>Vl(Object.assign({layerType:x},S)),layout:S=>vo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>ku(Object.assign({layerType:x},M))}}),paint:S=>vo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Ru(Object.assign({layerType:x,layer:c},M))}}),appearances(S){let M=Pu({key:S.key,value:S.value,valueSpec:S.valueSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:k=>(function(L){let{key:j,layer:V,layerType:W}=L,q=i.J(L.value),J=i.J(q.name),ie=i.J(q.condition),ee=vo({key:j,value:q,valueSpec:L.styleSpec.appearance,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{condition:ge=>(function(de){let fe=[];return fe.push(...Lo({key:de.key,value:de.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),fe})(Object.assign({layer:V,layerType:W},ge)),properties:ge=>(function(de){let fe=[],{styleSpec:ue,layer:se,layerType:_e}=de,Se=ue[`paint_${_e}`],Ce=ue[`layout_${_e}`],Be=de.object[de.objectKey];for(let Ue in Be){let Ze=Ue in Se?"paint":Ue in Ce?"layout":void 0;if(!Ze){fe.push(new i.V(de.key,Ue,`unknown property "${Ue}" for layer type "${_e}"`));continue}let lt=Object.assign({},de,{key:`${de.key}.${Ue}`,object:Be,objectKey:Ue,layer:se,layerType:_e,value:Be[Ue],valueSpec:Ze==="paint"?Se[Ue]:Ce[Ue]});fe.push(...Ou(lt,Ze))}return fe})(Object.assign({layer:V,layerType:W},ge))}});return J!=="hidden"&&ie===void 0&&ee.push(new i.V(L.key,"name",'Appearance with name different than "hidden" must have a condition')),ee})(Object.assign({layerType:x,layer:c},k))}),A=Array.isArray(S.value)?S.value:[],F=new Set;return A.forEach((k,L)=>{let j=i.J(k.name);if(j)if(F.has(j)){let V=i.J(c.id);M.push(new i.V(S.key,j,`Duplicated appearance name "${j}" for layer "${V}"`))}else F.add(j)}),M}}})),o}function po({key:p,value:o}){return i.a0(o)?[]:[new i.V(p,o,`string expected, ${i.K(o)} found`)]}let vs={promoteId:function p({key:o,value:c}){if(i.a0(c))return po({key:o,value:c});if(Array.isArray(c)){let _=[],y=i.S(c),x=i.U(y);return x.result==="error"&&x.value.forEach(w=>{_.push(new i.V(`${o}${w.key}`,null,`${w.message}`))}),i.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),_}if(!i.H(c))return[new i.V(o,c,`string, expression or object expected, "${i.K(c)}" found`)];let f=[];for(let _ in c)f.push(...p({key:`${o}.${_}`,value:c[_]}));return f}};function Xh(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!i.H(o))return[new i.V(c,o,`object expected, ${i.K(o)} found`)];if(!("type"in o))return[new i.V(c,o,'"type" is required')];let y=i.J(o.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in o||"tiles"in o||x.push(new i.a3(c,o,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(vo({key:c,value:o,valueSpec:f[`source_${y.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:vs})),x;case"geojson":if(x=vo({key:c,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:vs}),"cluster"in o&&"clusterProperties"in o){if(!i.H(o.clusterProperties))return[new i.V(`${c}.clusterProperties`,o,`object expected, ${i.K(o)} found`)];for(let w in o.clusterProperties){let S=o.clusterProperties[w];if(!Array.isArray(S))return[new i.V(`${c}.clusterProperties.${w}`,S,"array expected")];let[M,A]=S,F=typeof M=="string"?[M,["accumulated"],["get",w]]:M;x.push(...Lo({key:`${c}.${w}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Lo({key:`${c}.${w}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return x;case"video":return vo({key:c,value:o,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return vo({key:c,value:o,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ra({key:`${c}.type`,value:o.type,valueSpec:{values:kc(f)}})}}function kc(p){return p.source.reduce((o,c)=>{let f=p[c];return f.type.type==="enum"&&(o=o.concat(Object.keys(f.type.values||{}))),o},[])}function ol(p){let o=p.value,c=p.styleSpec,f=c.light,_=p.style;if(o===void 0)return[];if(!i.H(o))return[new i.V("light",o,`object expected, ${i.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&f[S[1]]?rr({key:x,value:o[x],valueSpec:{type:"string"},style:_,styleSpec:c}):w&&f[w[1]]&&f[w[1]].transition?rr({key:x,value:o[x],valueSpec:c.transition,style:_,styleSpec:c}):f[x]?rr({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}):[new i.V(x,o[x],`unknown property "${x}"`)])}return y}function Ul(p){let o=p.value;if(!o)return[];let c=p.key;if(!i.H(o))return[new i.V(c,o,`object expected, ${i.K(o)} found`)];let f=[],_=p.styleSpec,y=_["light-3d"],x=p.style,w=p.style.lights;for(let A of["type","id"])if(!(A in o))return f=f.concat([new i.V(c,o,`missing property "${A}"`)]),f;if(!i.a0(o.type))return f=f.concat([new i.V(`${c}.type`,o.type,"string expected")]),f;if(w)for(let A=0;A<p.arrayIndex;A++){let F=i.J(o.type),k=w[A];i.J(k.type)===F&&f.push(new i.V(c,o.id,`duplicate light type "${o.type}", previously defined at line ${k.id.__line__}`))}let S=`properties_light_${o.type}`;if(!(S in _))return f=f.concat([new i.V(`${c}.type`,o,`Invalid light type ${o.type}`)]),f;let M=_[S];for(let A in o)if(A==="properties"){let F=o[A];if(!i.H(F))return f=f.concat([new i.V("properties",F,`object expected, ${i.K(F)} found`)]),f;for(let k in F){let L=k.match(/^(.*)-transition$/),j=k.match(/^(.*)-use-theme$/);f=f.concat(j&&M[j[1]]?rr({key:A,value:F[k],valueSpec:{type:"string"},style:x,styleSpec:_}):L&&M[L[1]]&&M[L[1]].transition?rr({key:A,value:o[A],valueSpec:_.transition,style:x,styleSpec:_}):M[k]?rr({key:k,value:F[k],valueSpec:M[k],style:x,styleSpec:_}):[new i.a3(p.key,F[k],`unknown property "${k}"`)])}}else f=f.concat(y[A]?rr({key:A,value:o[A],valueSpec:y[A],style:x,styleSpec:_}):[new i.a3(A,o[A],`unknown property "${A}"`)]);return f}function ka(p){let o=p.value,c=p.key,f=p.style,_=p.styleSpec,y=_.terrain;if(o==null)return[];if(!i.H(o))return[new i.V("terrain",o,`object expected, ${i.K(o)} found`)];let x=[];for(let w in o){let S=w.match(/^(.*)-transition$/),M=w.match(/^(.*)-use-theme$/);x=x.concat(M&&y[M[1]]?rr({key:w,value:o[w],valueSpec:{type:"string"},style:f,styleSpec:_}):S&&y[S[1]]&&y[S[1]].transition?rr({key:w,value:o[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?rr({key:w,value:o[w],valueSpec:y[w],style:f,styleSpec:_}):[new i.a3(w,o[w],`unknown property "${w}"`)])}if(o.source)if(i.a0(o.source)){let w=f.sources&&f.sources[o.source],S=w&&i.J(w.type);w?S!=="raster-dem"&&x.push(new i.V(`${c}.source`,o.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):x.push(new i.V(`${c}.source`,o.source,`source "${o.source}" not found`))}else x.push(new i.V(`${c}.source`,o.source,"source must be a string"));else x.push(new i.V(c,o,'terrain is missing required property "source"'));return x}function Yh(p){let o=p.value,c=p.style,f=p.styleSpec,_=f.fog;if(o===void 0)return[];if(!i.H(o))return[new i.V("fog",o,`object expected, ${i.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&_[S[1]]?rr({key:x,value:o[x],valueSpec:{type:"string"},style:c,styleSpec:f}):w&&_[w[1]]&&_[w[1]].transition?rr({key:x,value:o[x],valueSpec:f.transition,style:c,styleSpec:f}):_[x]?rr({key:x,value:o[x],valueSpec:_[x],style:c,styleSpec:f}):[new i.a3(x,o[x],`unknown property "${x}"`)])}return y}let Fu={"*":()=>[],array:Pu,boolean:function(p){let o=p.value,c=p.key;return i.$(o)?[]:[new i.V(c,o,`boolean expected, ${i.K(o)} found`)]},number:Oc,color:function({key:p,value:o}){return i.a0(o)?i.a1.parseCSSColor(o)===null?[new i.V(p,o,`color expected, "${o}" found`)]:[]:[new i.V(p,o,`color expected, ${i.K(o)} found`)]},enum:Ra,filter:Vl,function:Rc,layer:Rd,object:vo,source:Xh,model:i.a7,light:ol,"light-3d":Ul,terrain:ka,fog:Yh,string:po,formatted:function(p){return po(p).length===0?[]:Lo(p)},resolvedImage:function(p){return po(p).length===0?[]:Lo(p)},projection:function(p){let o=p.value,c=p.styleSpec,f=c.projection,_=p.style;if(i.H(o)){let y=[];for(let x in o)y=y.concat(rr({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}));return y}return i.a0(o)?[]:[new i.V("projection",o,`object or string expected, ${i.K(o)} found`)]},import:function(p){let o=p.key,{value:c,styleSpec:f}=p;if(!i.H(c))return[new i.V(o,c,"import must be an object")];let w=c,{data:_}=w,y=N1(w,["data"]);Object.defineProperty(y,"__line__",{value:c.__line__,enumerable:!1});let x=vo(Object.assign({},p,{value:y,valueSpec:f.import}));return i.J(y.id)===""&&x.push(new i.V(`${p.key}.id`,y,"import id can't be an empty string")),_&&(x=x.concat(Lu(_,f,{key:`${p.key}.data`}))),x},iconset:function(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!i.H(o))return[new i.V(c,o,"object expected")];if(!o.type)return[new i.V(c,o,'"type" is required')];let y=i.J(o.type),x=[];if(x=x.concat(vo({key:c,value:o,valueSpec:f[`iconset_${y}`],style:_,styleSpec:f})),(function(w,S){return!(w!=="source"||!S.source)})(y,o)){let w=_.sources&&_.sources[o.source],S=w&&i.J(w.type);w?S!=="raster-array"&&x.push(new i.V(c,o.source,`iconset cannot be used with a source of type ${String(S)}, it only be used with a "raster-array" source type`)):x.push(new i.V(c,o.source,`source "${o.source}" not found`))}return x}};function rr(p,o=!1){let c=p.value,f=p.valueSpec,_=p.styleSpec;if(f.expression){if(i.a4(i.J(c)))return Rc(p);if(i.Q(i.S(c)))return Lo(p)}if(f.type&&Fu[f.type]){let y=Fu[f.type](p);return o===!0&&y.length>0&&Array.isArray(p.value)?Lo(p):y}return vo(Object.assign({},p,{valueSpec:f.type?_[f.type]:f}))}function vo(p){let o=p.key,c=p.value,f=p.valueSpec||{},_=p.objectElementValidators||{},y=p.style,x=p.styleSpec;if(!i.H(c))return[new i.V(o,c,`object expected, ${i.K(c)} found`)];let w=[];for(let S in c){let M=S.split(".")[0],A;_[M]?A=_[M]:f[M]?A=rr:_["*"]?A=_["*"]:f["*"]&&(A=rr),A?w=w.concat(A({key:(o&&`${o}.`)+S,value:c[S],valueSpec:f[M]||f["*"],style:y,styleSpec:x,object:c,objectKey:S},c)):w.push(new i.a3(o,c[S],`unknown property "${S}"`))}for(let S in f){if(_[S])continue;let M=f[S];M.required&&M.default===void 0&&c[S]===void 0&&w.push(new i.V(o,c,`missing required property "${S}"`))}return w}function zf({key:p,value:o}){let c=po({key:p,value:o});if(c.length)return c;let f=o;return f.indexOf("{fontstack}")===-1&&c.push(new i.V(p,o,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&c.push(new i.V(p,o,'"glyphs" url must include a "{range}" token')),c}function Lu(p,o=i.a6,c={}){return vo({key:c.key||"",value:p,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:p,objectElementValidators:{glyphs:zf}})}function Fa(p,o=i.a6){return X(Lu(p,o))}let Bf=p=>X(Xh(p)),it=p=>X(ol(p)),jl=p=>X(Ul(p)),Z_=p=>X(ka(p)),Nu=p=>X(Yh(p)),Zn=p=>X((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.snow;if(c===void 0)return[];if(!i.H(c))return[new i.V("snow",c,`object expected, ${i.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?rr({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?rr({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new i.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),Zo=p=>X((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.rain;if(c===void 0)return[];if(!i.H(c))return[new i.V("rain",c,`object expected, ${i.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?rr({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?rr({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new i.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),X_=p=>X(Rd(p)),zu=p=>X(Vl(p)),Kh=p=>X(Ru(p)),Ae=p=>X(ku(p)),G=p=>X(i.a7(p));function X(p){return p.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function oe(p,o){let c=!1;if(o&&o.length)for(let f of o)f instanceof i.a3?i.w(f.message):(p.fire(new i.y(new Error(f.message))),c=!0);return c}let xe=i.a6.light,ve;class Ee extends i.E{constructor(o,c="flat"){super(),this._transitionable=new i.a8(ve||(ve=new i.a9({anchor:new i.aa(xe.anchor),position:new i.ab(xe.position),color:new i.aa(xe.color),intensity:new i.aa(xe.intensity)}))),this.setLight(o,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c,f={}){this._validate(it,o,f)||(this._transitionable.setTransitionOrValue(o),this.id=c)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&oe(this,o.call(Fa,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let ze=i.a6.terrain,Ie=class extends i.E{constructor(p,o,c,f,_){super(),this.scope=c,this._transitionable=new i.a8(new i.a9({source:new i.aa(ze.source),exaggeration:new i.aa(ze.exaggeration)}),c,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=_}get(){return this._transitionable.serialize()}set(p,o){this._transitionable.setTransitionOrValue(p,o)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new i.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let p=this._transitionable._values.exaggeration;if(!p)return null;let o=p.value.expression;if(!o)return null;let c=-1,f=-1,_=1;for(let y of o.zoomStops)_=o.evaluate(new i.ac(y,{worldview:this.worldview})),_>.01?(c=y,f=-1):f=y;return _<.01&&c>0&&f>c?[c,f]:null}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof i.ad}},Ne=45,at=65,Xe=.05;function Rt(p,o,c,f){let _=i.ah(Ne,at,c),[y,x]=Qt(p,f),w=1-Math.min(1,Math.exp((o-y)/(x-y)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*_*p.alpha}function Qt(p,o){let c=.5/Math.tan(.5*o);return[p.range[0]+c,p.range[1]+c]}function Dt(p,o,c,f,_){let y=i.af([],[o,c,f],_.mercatorFogMatrix);return Rt(p,i.ag(y),_.pitch,_._fov)}function xn(p,o,c,f,_,y,x){let w=[[c,f,0],[_,f,0],[_,y,0],[c,y,0]],S=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let A of w){let F=i.af([],A,o),k=i.ag(F);S=Math.min(S,k),M=Math.max(M,k)}return[Rt(p,S,x.pitch,x._fov),Rt(p,M,x.pitch,x._fov)]}let vn=i.a6.fog;class gn extends i.E{constructor(o,c,f,_){super();let y=new i.a9({range:new i.aa(vn.range),color:new i.aa(vn.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(vn["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(vn["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(vn["horizon-blend"]),"star-intensity":new i.aa(vn["star-intensity"]),"vertical-range":new i.aa(vn["vertical-range"])});this._transitionable=new i.a8(y,f,new Map(_)),this.set(o,_),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ai(y),this.scope=f}get state(){let o=this._transform,c=o.projection.name==="globe",f=i.aj(o.zoom),_=this.properties.get("range"),y=[.5,3];return{range:c?[i.ak(y[0],_[0],f),i.ak(y[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c,f={}){if(this._validate(Nu,o,f))return;let _=Object.assign({},o);for(let y of Object.keys(vn))_[y]===void 0&&(_[y]=vn[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(Ne,at,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?(function(f,_,y){let x=i.ae.fromLngLat(_),w=y.elevation?y.elevation.getAtPointOrZero(x):0;return Dt(f,x.x,x.y,w,y)})(this.state,o,c):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(o.toUnwrapped());return xn(this.state,c,0,0,i.al,i.al,this._transform)}getOpacityForBounds(o,c,f,_,y){return this._transform.projection.supportsFog?xn(this.state,o,c,f,_,y,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Qt(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let f of c){let _=o.points[f],y;if(_[2]>=0)y=_;else{let x=o.points[f-4];y=i.am(x,_,x[2]/(x[2]-_[2]))}if(Dt(this.state,y[0],y[1],0,this._transform)>=Xe)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&oe(this,o.call(Fa,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Vn,dr,Fr,yr,$r=class extends i.E{constructor(p,o,c,f){super();let _=Vn||(Vn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=i.an(c[0]),_=-Math.max(i.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(Zn,p,c))return;let f=Object.assign({},p),_=i.a6.snow;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&oe(this,p.call(Fa,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},or=class extends i.E{constructor(p,o,c,f){super();let _=dr||(dr=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=i.an(c[0]),_=-Math.max(i.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(Zo,p,c))return;let f=Object.assign({},p),_=i.a6.rain;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&oe(this,p.call(Fa,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class Gn extends i.E{constructor(o,c,f,_){super(),this.scope=f,this._options=o,this.properties=new i.ai(c),this._transitionable=new i.a8(c,f,new Map(_)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,c){this._options=o,this._transitionable.setTransitionOrValue(o.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class sr{constructor(o,c,f){this.screenBounds=o,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(o,c){let f,_;if(o instanceof i.P||typeof o[0]=="number"){let y=i.P.convert(o);f=[y],_=c.isPointAboveHorizon(y)}else{let y=i.P.convert(o[0]),x=i.P.convert(o[1]),w=y.add(x)._div(2);f=[y,x],_=i.aq(y,x).every(S=>c.isPointAboveHorizon(S))&&c.isPointAboveHorizon(w)}return new sr(f,_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.aq(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),i.ar(_,o)}bufferedCameraGeometryGlobe(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.aq(c,f,o),y=this.cameraPoint.clone();switch(3*((y.y>c.y)+(y.y>f.y))+((y.x>c.x)+(y.x>f.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(o,c,f,_=0){let y=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,x=f?this._bufferedCameraMercator(y,c):this._bufferedScreenMercator(y,c),w=o.tileID.wrap+(x.unwrapped?_:0),S=x.polygon.map(W=>i.as(o.tileTransform,W,w));if(!i.at(S,0,0,i.al,i.al))return;w=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let M=this.screenGeometryMercator.polygon.map(W=>i.au(o.tileTransform,W,w)),A=M.map(W=>new i.P(W[0],W[1])),F=c.getFreeCameraOptions().position||new i.ae(0,0,0),k=i.au(o.tileTransform,F,w),L=M.map(W=>{let q=i.av(W,W,k);return i.aw(q,q),new i.ax(k,q)}),j=i.ay(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:L,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(V=i.az(S),V.min.x=i.aA(V.min.x,0,i.al),V.min.y=i.aA(V.min.y,0,i.al),V.max.x=i.aA(V.max.x,0,i.al),V.max.y=i.aA(V.max.y,0,i.al),V),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var V}_bufferedScreenMercator(o,c){let f=xr(o);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(o,c){let f=xr(o);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(o,c){let f=(function(y,x){let w=i.aB([],x.pixelMatrix,x.globeMatrix),S=[0,-i.aD,0,1],M=[0,i.aD,0,1],A=[0,0,0,1];i.aC(S,S,w),i.aC(M,M,w),i.aC(A,A,w);let F=new i.P(S[0]/S[3],S[1]/S[3]),k=new i.P(M[0]/M[3],M[1]/M[3]),L=i.aE(y,F)&&S[3]<A[3],j=i.aE(y,k)&&M[3]<A[3];if(!L&&!j)return null;let V=(function(fe,ue,se){for(let _e=1;_e<fe.length;_e++){let Se=kn(ue.pointCoordinate3D(fe[_e-1]).x),Ce=kn(ue.pointCoordinate3D(fe[_e]).x);if(se<0){if(Se<Ce)return{idx:_e,t:-Se/(Ce-1-Se)}}else if(Ce<Se)return{idx:_e,t:(1-Se)/(Ce+1-Se)}}return null})(y,x,L?-1:1);if(!V)return null;let{idx:W,t:q}=V,J=W>1?Mi(y.slice(0,W),x):[],ie=W<y.length?Mi(y.slice(W),x):[];J=J.map(fe=>new i.P(kn(fe.x),fe.y)),ie=ie.map(fe=>new i.P(kn(fe.x),fe.y));let ee=[...J];ee.length===0&&ee.push(ie[ie.length-1]);let ge=i.ak(ee[ee.length-1].y,(ie.length===0?J[0]:ie[0]).y,q),de;return de=L?[new i.P(0,ge),new i.P(0,0),new i.P(1,0),new i.P(1,ge)]:[new i.P(1,ge),new i.P(1,1),new i.P(0,1),new i.P(0,ge)],ee.push(...de),ie.length===0?ee.push(J[0]):ee.push(...ie),{polygon:ee.map(fe=>new i.ae(fe.x,fe.y)),unwrapped:!1}})(o,c);if(f)return f;let _=(function(y,x){let w=!1,S=-1/0,M=0;for(let F=0;F<y.length-1;F++)y[F].x>S&&(S=y[F].x,M=F);for(let F=0;F<y.length-1;F++){let k=(M+F)%(y.length-1),L=y[k],j=y[k+1];Math.abs(L.x-j.x)>.5&&(L.x<j.x?(L.x+=1,k===0&&(y[y.length-1].x+=1)):(j.x+=1,k+1===y.length-1&&(y[0].x+=1)),w=!0)}let A=i.aF(x.center.lng);return w&&A<Math.abs(A-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:w}})(Mi(o,c).map(y=>new i.P(kn(y.x),y.y)),c);return{polygon:_.polygon.map(y=>new i.ae(y.x,y.y)),unwrapped:_.unwrapped}}}function Mi(p,o){return i.aG(p,c=>{let f=o.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function kn(p){return p<0?1+p%1:p%1}function xr(p){return 100*p|0}function To(p,o,c,f,_){let y=function(w,S){if(w)return _(w);if(S){if(p.url&&S.tiles&&p.tiles&&delete p.tiles,S.variants){if(!Array.isArray(S.variants))return _(new Error("variants must be an array"));for(let A of S.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return _(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){S=Object.assign(S,A);break}}}let M=i.aH(Object.assign({},S,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=o.canonicalizeTileset(M,p.url),_(null,M)}},x=(function(w,S,M){if(!w)return null;if(!S&&!M)return w;M=M||w.worldview_default;let A=Object.values(w.language||{});if(A.length===0)return null;let F=Object.values(w.worldview||{});if(F.length===0)return null;let k=A.every(j=>j===S),L=F.every(j=>j===M);return k&&L?w:S in(w.language_options||{})||M in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null})(p.data,c,f);return x?i.o.frame(()=>y(null,x)):p.url?i.m(o.transformRequest(o.normalizeSourceURL(p.url,null,c,f),i.R.Source),y):i.o.frame(()=>{let M=p,{data:w}=M,S=N1(M,["data"]);y(null,S)})}function No(p,o){let c=Math.pow(2,o.z),f=Math.floor(i.aF(p.getWest())*c),_=Math.floor(i.aJ(p.getNorth())*c),y=Math.ceil(i.aF(p.getEast())*c),x=Math.ceil(i.aJ(p.getSouth())*c);return o.x>=f&&o.x<y&&o.y>=_&&o.y<x}class ys{constructor(o,c,f){this.bounds=o?i.aI.convert(this.validateBounds(o)):null,this.minzoom=c||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(let c of o)this.extraBounds.push(i.aI.convert(this.validateBounds(c)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!No(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(let c of this.extraBounds)if(No(c,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;let c=new ys(o.bounds,o.minzoom,o.maxzoom);return c.addExtraBounds(o.extra_bounds),c}}class Bu extends i.E{constructor(o,c,f,_){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new i.aK}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=To(this._options,this.map._requestManager,c,f,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.y(_));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=ys.fromTileJSON(y),ur(y.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,c){let f=o.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),y=this.map._requestManager.transformRequest(_,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w=x?{image:x.image.clone()}:null,S={request:y,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(f)&&(S.localizableLayerIds=this.localizableLayerIds),S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",S,M.bind(this));else if(o.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",S,M.bind(this),void 0,!0);else{let A=i.aL.call({deduped:this._deduped},S,(F,k)=>{if(F||!k)M.call(this,F);else{let L=i.aM(k.responseHeaders);S.data={rawData:k.rawData.slice(0),expires:L.expires,cacheControl:L.cacheControl},o.actor&&o.actor.send("loadTile",S,M.bind(this),void 0,!0)}},!0);o.request={cancel:A}}function M(A,F){return delete o.request,o.aborted?c(null):A&&A instanceof i.aN&&A.status!==404?c(A):(F&&F.resourceTiming&&(o.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&o.setExpiryData(F),o.loadVectorData(F,this.map.painter),i.aO(this.dispatcher),c(null,F),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fo extends i.E{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,i.aH(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));let c=this.map.getWorldview();this._tileJSONRequest=To(this._options,this.map._requestManager,null,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new i.y(f)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=ys.fromTileJSON(_),ur(_.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(f)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){let f=i.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);o.request=i.n(this.map._requestManager.transformRequest(_,i.R.Tile),(y,x,w)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(y)return o.state="errored",c(y);if(!x)return c(null);let S=i.aM(w);this.map._refreshExpiredTiles&&o.setExpiryData(S),o.setTexture(x,this.map.painter),o.state="loaded",i.aO(this.dispatcher),c(null)})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c&&c()}unloadTile(o,c){o.texture&&o.texture instanceof i.T?(o.destroy(!1),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Hs([p,o],c,f,{scaled:_=!0}={}){let{tileSize:y,buffer:x}=f,{x:w,y:S,z:M}=c;if(!isFinite(w)||!isFinite(S)||!isFinite(M))throw new Error("Invalid MRT header");let A=2**M,F=A*i.aF(p),k=A*i.aJ(o);return(function([L,j],V,{scaled:W=!0}={}){if(!V)throw new Error("bandView is undefined");let{data:q,tileSize:J,buffer:ie,offset:ee,scale:ge,dimension:de}=V;if(L<-ie||L>J+ie||j<-ie||j>J+ie)throw new Error(`Point (${L}, ${j}) out of bounds for tileSize=${J}, buffer=${ie}`);let fe=(j+ie)*(J+2*ie)+(L+ie);if(new Uint32Array(q.buffer)[fe]===4294967295)return null;let ue=[];ue=W?[]:new V.data.constructor(de);for(let se=0;se<de;se++)ue[se]=Math.round(1e12*(q[de*fe+se]*ge+ee))/1e12;return ue})([Math.min(Math.max(-x,Math.floor((F-w)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((k-S)*y)),y-1+x)],f,{scaled:_})}class Xo extends fo{constructor(o,c,f,_){super(o,c,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(o){let c=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);c&&c.enabled&&f&&c._clearRenderCacheForTile(f.id,o.tileID),this.map.triggerRepaint()}loadTile(o,c){let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,i.R.Tile),y={request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=_,o.actor||(o.actor=this.dispatcher.getActor());let x=(w,S,M)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(w)return w.name==="AbortError"?void 0:(o.state="errored",c(w));if(this.map._refreshExpiredTiles&&S){let A=i.aM(M);o.setExpiryData(A)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!S)return c(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=S}c(null)};o.request=this.partial?o.fetchHeader(void 0,x.bind(this)):o.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){let f=o.texturePerLayer;if(o.flushAllQueues(),f.size){o.destroy(!1);for(let _ of f.values())this.map.painter.saveTileTexture(_)}else o.destroy()}prepareTile(o,c,f,_){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(c,f,_,(y,x)=>{if(y)return o.state="errored",this.fire(new i.y(y)),void this.triggerRepaint(o);x&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(f,x,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let c=this.rasterLayers.find(({id:y})=>y===o),f=c&&c.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(o,c,f){if(!o)return;let _=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;c instanceof i.aR?y=c.paint.get("raster-array-band"):c instanceof i.aS&&(y=c.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(_);if(x==null)return;if(!o.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(o,_,c.id,x);if(o.updateNeeded(c.id,x)&&!f)return;let w=o.textureDescriptorPerLayer.get(c.id);return Object.assign({},w,{texture:o.texturePerLayer.get(c.id)})}getImages(o,c){let f=new Map;for(let _ of o)for(let y of c){let[x,w]=y.split("/"),S=_.getLayer(x);if(!S||!S.hasBand(w)||!S.hasDataForBand(w))continue;let{bytes:M,tileSize:A,buffer:F}=S.getBandView(w),k=A+2*F,L={data:new i.q({width:k,height:k},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(y,L)}return f}queryRasterArrayValueByBandId(o,c,f){let _=c._mrt;return new Promise(y=>{let x={},w=new Set;for(let[S,M]of Object.entries(_.layers)){if(f.layerName&&S!==f.layerName)continue;let A={};x[S]=A;for(let{bands:F}of M.dataIndex)for(let k of F)f.bands&&!f.bands.includes(k)||(w.add(i.B(S,k)),c.fetchBand(S,null,k,L=>{i.o.frame(()=>{A[k]=L?null:Hs([o.lng,o.lat],_,M.getBandView(k)),w.delete(i.B(S,k)),w.size===0&&y(x)})},!1))}w.size===0&&y(x)})}_loadTileForQuery(o,c){if(this._loadTileLoaded[o.uid])return void c(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(c);this._loadTilePending[o.uid]=[c];let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,i.R.Tile);o.actor.send("loadTile",{request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,w)=>{if(y)return this._loadTilePending[o.uid].forEach(S=>S(y,null)),void delete this._loadTilePending[o.uid];if(!x)return this._loadTilePending[o.uid].forEach(S=>S(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&x){let S=i.aM(w);o.setExpiryData(S)}o._mrt=x,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(S=>S(null,x)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,c,f){return new Promise((_,y)=>{this._loadTileForQuery(c,(x,w)=>{x?y(x):_(w?this.queryRasterArrayValueByBandId(o,c,f):null)})})}queryRasterArrayValue(o,c){let f=i.aT.convert(o),_=this.findLoadedParent(f);return _&&_._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(f,_,c):this.queryRasterArrayValueByAllBands(f,_,c):Promise.resolve(null)}findLoadedParent(o){let c=i.ae.fromLngLat(o,this.map.transform.tileSize),f=this.maxzoom+1,_=1<<f,y=Math.floor(c.x),x=Math.floor((c.x-y)*_),w=Math.floor(c.y*_),S=this.map.style.getSourceCache(this.id),M=new i.aQ(f,y,f,x,w);return S.findLoadedParent(M,this.minzoom)}}let sl={vector:Bu,raster:fo,"raster-dem":class extends fo{constructor(p,o,c,f){super(p,o,c,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(p.state="errored",o(_)),y&&(p.dem=y,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=i.n(this.map._requestManager.transformRequest(c,i.R.Tile),(function(_,y,x){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(_)p.state="errored",o(_);else if(y){let w=i.aM(x);this.map._refreshExpiredTiles&&p.setExpiryData(w);let S=ImageBitmap&&y instanceof ImageBitmap&&i.r(),M=1-(y.width-i.aP(y.width))/2;M<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let A=S?y:i.o.getImageData(y,M),F={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:M};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",F,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let o=p.canonical,c=Math.pow(2,o.z),f=(o.x-1+c)%c,_=o.x===0?p.wrap-1:p.wrap,y=(o.x+1+c)%c,x=o.x+1===c?p.wrap+1:p.wrap,w={};return w[new i.aQ(p.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},w[new i.aQ(p.overscaledZ,x,o.z,y,o.y).key]={backfilled:!1},o.y>0&&(w[new i.aQ(p.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},w[new i.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},w[new i.aQ(p.overscaledZ,x,o.z,y,o.y-1).key]={backfilled:!1}),o.y+1<c&&(w[new i.aQ(p.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},w[new i.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},w[new i.aQ(p.overscaledZ,x,o.z,y,o.y+1).key]={backfilled:!1}),w}},"raster-array":Xo,geojson:class extends i.E{constructor(p,o,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let _=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:i.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let o=new Map;for(let c of this._data.features)o.set(c.id,c);for(let c of p.features)o.set(c.id,c);this._data.features=[...o.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterLeaves(p,o,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:o,offset:c},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;let o=Object.assign({append:p},this.workerOptions);o.scope=this.scope;let c=this._data;typeof c=="string"?(o.request=this.map._requestManager.transformRequest(i.o.resolveURL(c),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.y(f));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new i.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let p=i.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,o){let c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,x,(w,S)=>y&&!S?(p.state="loaded",o(null)):(delete p.request,p.destroy(!1),p.aborted?o(null):w?o(w):(p.loadVectorData(S,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,o){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(p,o,c,f){super(p,o,c,f),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aV(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new i.y(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(p,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(p,o,c,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();let p=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=To(this._options,this.map._requestManager,o,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.y(f))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new ys(_.bounds,this.minzoom,this.maxzoom)),ur(_.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=o;else{if(p.buckets){let y=Object.values(p.buckets);for(let x of y)x.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,_.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(y,x){return p.aborted?o(null):y&&y.status!==404?o(y):(this.map._refreshExpiredTiles&&x&&p.setExpiryData(x),p.loadModelData(x,this.map.painter),p.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(p,o,c,f){super(p,o,c,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new i.y(new i.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends i.E{constructor(p,o,c,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ys(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:o,y:c,z:f}=p.canonical;return this._implementation.hasTile({x:o,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){let{x:c,y:f,z:_}=p.tileID.canonical,y=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:_},{signal:y.signal})).then((function(x){return delete p.request,p.aborted?(p.state="unloaded",o(null)):x===void 0?(p.state="errored",o(null)):x===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null)):(function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement})(x)?(this.loadTileData(p,x),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(p.state="errored",o(x))}),p.request.cancel=()=>y.abort()}loadTileData(p,o){p.setTexture(o,this.map.painter)}unloadTile(p,o){if(p.texture&&p.texture instanceof i.T?(p.destroy(!1),p.texture&&p.texture instanceof i.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:c,y:f,z:_}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:_})}o&&o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=i.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},oo=function(p,o,c,f){let _=new sl[o.type](p,o,c,f);if(_.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${_.id}`);return i.aY(["load","abort","unload","serialize","prepare"],_),_};function Vu(p,o,c=""){return`${c}:${o.id||""}:${o.layer.id}:${(function(f){if("layerId"in f)return`layer:${f.layerId}`;{let{featuresetId:_,importId:y}=f;return`featureset:${_}${y?`:import:${y}`:""}`}})(p.target)}`}function kd(p,o,c,f=""){if(p.uniqueFeatureID){let _=Vu(p,o,f);if(c.has(_))return!0;c.add(_)}return!1}function Vf(p,o,c,f,_=!1){let y=o.sourceCache.transform,x=o.sourceCache.tilesIn(p,o.has3DLayers,_);x.sort(Qh);let w=[];for(let S of x){let M=S.tile.queryRenderedFeatures(o,S,c,f,y,_);Object.keys(M).length&&w.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:M})}for(let S in o.layers){let M=o.layers[S];if(M.styleLayer){let A=M.styleLayer.queryRenderedFeatures(p,o.sourceCache,f);Object.keys(A).length&&w.push({wrappedTileID:0,queryResults:A})}}return w.length===0?{}:(function(S){let M={},A={};for(let F of S){let k=F.queryResults,L=F.wrappedTileID,j=A[L]=A[L]||{};for(let V in k){let W=k[V],q=j[V]=j[V]||{},J=M[V]=M[V]||[];for(let ie of W)q[ie.featureIndex]||(q[ie.featureIndex]=!0,J.push(ie))}}return M})(w)}function Uf(p,o,c,f,_,y){let x={},w=f.queryRenderedSymbols(p),S=[];for(let M of Object.keys(w).map(Number))S.push(_[M]);S.sort(Qh);for(let M of S){let A=M.featureIndex.lookupSymbolFeatures(w[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,o,c,y);for(let F in A){let k=x[F]=x[F]||[],L=A[F];L.sort((j,V)=>{let W=M.featureSortOrder;if(W){let q=W.indexOf(j.featureIndex);return W.indexOf(V.featureIndex)-q}return V.featureIndex-j.featureIndex});for(let j of L)k.push(j)}}return x}function jf(p,o){let c=p.getRenderableIds().map(y=>p.getTileByID(y)),f=[],_={};for(let y=0;y<c.length;y++){let x=c[y],w=x.tileID.canonical.key;_[w]||(_[w]=!0,x.querySourceFeatures(f,o))}return f}function Qh(p,o){let c=p.tileID,f=o.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function al(p,o){let c={};if(!o)return c;for(let f of p){let _=f.layerIds.map(y=>o.getLayer(y)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(y=>_.filter(x=>x.id===y)[0]));for(let y of _)c[y.fqid]=f}}return c}let xs=32,La=33,Na=new Uint16Array(8184);for(let p=0;p<2046;p++){let o=p+2,c=0,f=0,_=0,y=0,x=0,w=0;for(1&o?_=y=x=xs:c=f=w=xs;(o>>=1)>1;){let M=c+_>>1,A=f+y>>1;1&o?(_=c,y=f,c=x,f=w):(c=_,f=y,_=x,y=w),x=M,w=A}let S=4*p;Na[S+0]=c,Na[S+1]=f,Na[S+2]=_,Na[S+3]=y}let da=new Uint16Array(2178),ll=new Uint8Array(1089),Fc=new Uint16Array(1089);function Uu(p){return p===0?-.03125:p===32?.03125:0}let $f={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class ju{constructor(o,c,f,_,y,x){this.tileID=o,this.uid=i.b2(),this.uses=0,this.tileSize=c,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(o){let c=o+this.timeAdded;c<i.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=al(o.buckets,c.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof i.b4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof i.b4&&y.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(let _ in this.buckets){let y=this.buckets[_],x=c.style.getOwnLayer(_);if(!x)continue;let w=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,w)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,c,f){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,al(o.buckets,c.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,c){for(let y in this.buckets){let x=this.buckets[y];if(x.uploadPending()){let w={},S=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){S=c.style.listImages();let A=x.layers[0],F=A.sourceLayer||"_geojsonTileLayer",k=c.style.getLayerSourceCache(A);k&&(w=k._state.getState(F,void 0))}M={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}x.upload(o,this.tileID.canonical,w,S,M)}}let f=o.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new i.T(o,_.image,f.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(o,c,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,f),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let o=0;for(let c in this.buckets){let f=this.buckets[c];f.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,f.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,c,f,_,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let w=this.evaluateQueryRenderedFeaturePadding(),S=(function(M,A){let F=i.bq([],[.5*M.width,.5*-M.height,1]);return i.br(F,F,[1,-1,0]),i.aB(F,F,M.calculateProjMatrix(A.toUnwrapped())),Float32Array.from(F)})(y,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:c,pixelPosMatrix:S,transform:_,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:w})}querySourceFeatures(o,c){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let _=f.loadVTLayers(),y=c?c.sourceLayer:"",x=_._geojsonTileLayer||_[y];if(!x)return;let w=i.b6(c&&c.filter),{z:S,x:M,y:A}=this.tileID.canonical,F={z:S,x:M,y:A};for(let k=0;k<x.length;k++){let L=x.feature(k);if(w.needGeometry){let W=i.b7(L,!0);if(!w.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W,this.tileID.canonical))continue}else if(!w.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),L))continue;let j=f.getId(L,y),V=new i.b8(L,S,M,A,j);V.tile=F,o.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){let c=this.expirationTime;if(o.cacheControl){let f=i.b9(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let f=Date.now(),_=!1;if(this.expirationTime>f)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{let y=this.expirationTime-c;y?this.expirationTime=f+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(let c in this.buckets)if(o.style.hasLayer(c)&&this.buckets[c].layers.some(f=>f.appearances&&f.appearances.length>0))return!0;return!1}updateBuckets(o,c){if(!this.latestFeatureIndex||!o.style)return;let f=o.style.listImages(),_=o.style.getBrightness();for(let y in this.buckets){if(!o.style.hasLayer(y))continue;let x=this.buckets[y],w=x.layers[0],S=w.sourceLayer||"_geojsonTileLayer",M=o.style.getLayerSourceCache(w),A={};M&&(A=M._state.getState(S,void 0));let F=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},k=Object.keys(A).length>0&&!c;x.hasAppearances=x.layers.some(V=>V.appearances&&V.appearances.length>0);let L=k?x.stateDependentLayers:x.layers;if(k&&x.stateDependentLayers.length!==0||c){let V=this.latestFeatureIndex.loadVTLayers();x.update(A,V[S],f,F,L,c,_)}if(k&&x.stateDependentLayers.length!==0||c||x.hasAppearances){let V={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};x.updateAppearances(this.tileID.canonical,A,f,V)}(x instanceof i.ba||x instanceof i.bb)&&o._terrain&&o._terrain.enabled&&M&&x.uploadPending()&&o._terrain._clearRenderCacheForTile(M.id,this.tileID);let j=o&&o.style&&o.style.getOwnLayer(y);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.o.now()+o}setTexture(o,c){let f=c.context,_=f.gl;this.texture=this.texture||c.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(f,o,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(o,c){let f={};for(let _ of c)f[_]=!0;this.dependencies[o]=f}hasDependency(o,c){for(let f of o){let _=this.dependencies[f];if(_){for(let y of c)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;let f=i.bc($f,this.tileID.canonical,this.tileTransform)[0],_=new i.bd,y=new i.be;for(let x=0;x<f.length;x++){let{x:w,y:S}=f[x];_.emplaceBack(w,S),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(_,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;let f=i.bc($f,this.tileID.canonical,this.tileTransform)[0],_,y;if(this.isRaster){let x=(function(w,S){let M=i.aZ(w,S),A=Math.pow(2,w.z);for(let W=0;W<La;W++)for(let q=0;q<La;q++){let J=i.a_((w.x+(q+Uu(q))/xs)/A),ie=i.a$((w.y+(W+Uu(W))/xs)/A),ee=S.project(J,ie),ge=W*La+q;da[2*ge+0]=Math.round((ee.x*M.scale-M.x)*i.al),da[2*ge+1]=Math.round((ee.y*M.scale-M.y)*i.al)}ll.fill(0),Fc.fill(0);for(let W=2045;W>=0;W--){let q=4*W,J=Na[q+0],ie=Na[q+1],ee=Na[q+2],ge=Na[q+3],de=J+ee>>1,fe=ie+ge>>1,ue=de+fe-ie,se=fe+J-de,_e=ie*La+J,Se=ge*La+ee,Ce=fe*La+de,Be=Math.hypot((da[2*_e+0]+da[2*Se+0])/2-da[2*Ce+0],(da[2*_e+1]+da[2*Se+1])/2-da[2*Ce+1])>=16;ll[Ce]=ll[Ce]||(Be?1:0),W<1022&&(ll[Ce]=ll[Ce]||ll[(ie+se>>1)*La+(J+ue>>1)]||ll[(ge+se>>1)*La+(ee+ue>>1)])}let F=new i.b1,k=new i.b0,L=0;function j(W,q){let J=q*La+W;return Fc[J]===0&&(F.emplaceBack(da[2*J+0],da[2*J+1],W*i.al/xs,q*i.al/xs),Fc[J]=++L),Fc[J]-1}function V(W,q,J,ie,ee,ge){let de=W+J>>1,fe=q+ie>>1;if(Math.abs(W-ee)+Math.abs(q-ge)>1&&ll[fe*La+de])V(ee,ge,W,q,de,fe),V(J,ie,ee,ge,de,fe);else{let ue=j(W,q),se=j(J,ie),_e=j(ee,ge);k.emplaceBack(ue,se,_e)}}return V(0,0,xs,xs,xs,0),V(xs,xs,0,0,0,xs),{vertices:F,indices:k}})(this.tileID.canonical,c);_=x.vertices,y=x.indices}else{_=new i.b1,y=new i.b0;for(let{x:w,y:S}of f)_.emplaceBack(w,S,0,0);let x=i.bh(_.int16.subarray(0,4*_.length),void 0,4);for(let w=0;w<x.length;w+=3)y.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(_,i.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=i.bg.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(o,c){let f=c.projection;if(!f||f.name!=="globe"||c.freezeTileCoverage)return;let _=this.tileID.canonical,y=i.bj(_,c),x=i.bk(y),w=i.aj(c.zoom),S;w>0&&(S=i.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,_,c,x,S,w),this._makeGlobeTileDebugTextBuffer(o,_,c,x,S,w)}_globePoint(o,c,f,_,y,x,w){let S=i.bm(o,c,f);if(x){let M=1<<f.z,A=i.aF(_.center.lng),F=i.aJ(_.center.lat),k=(f.x+.5)/M-A,L=0;k>.5?L=-1:k<-.5&&(L=1);let j=(o/i.al+f.x)/M+L,V=(c/i.al+f.y)/M;j=(j-A)*_._pixelsPerMercatorPixel+A,V=(V-F)*_._pixelsPerMercatorPixel+F;let W=[j*_.worldSize,V*_.worldSize,0];i.af(W,W,x),S=i.bn(S,W,w)}return i.af(S,S,y)}_makeGlobeTileDebugBorderBuffer(o,c,f,_,y,x){let w=new i.bd,S=new i.be,M=new i.bo,A=(k,L,j,V,W)=>{let q=(j-k)/(W-1),J=(V-L)/(W-1),ie=w.length;for(let ee=0;ee<W;ee++){let ge=k+ee*q,de=L+ee*J;w.emplaceBack(ge,de);let fe=this._globePoint(ge,de,c,f,_,y,x);M.emplaceBack(fe[0],fe[1],fe[2]),S.emplaceBack(ie+ee)}},F=i.al;A(0,0,F,0,16),A(F,0,F,F,16),A(F,F,0,F,16),A(0,F,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(S),this._tileDebugBuffer=o.createVertexBuffer(w,i.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(M,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,w.length,S.length)}_makeGlobeTileDebugTextBuffer(o,c,f,_,y,x){let w=i.al/4,S=new i.bd,M=new i.b0,A=new i.bo,F=25;M.reserve(32),S.reserve(F),A.reserve(F);let k=(L,j)=>F*L+j;for(let L=0;L<F;L++){let j=L*w;for(let V=0;V<F;V++){let W=V*w;S.emplaceBack(W,j);let q=this._globePoint(W,j,c,f,_,y,x);A.emplaceBack(q[0],q[1],q[2])}}for(let L=0;L<4;L++)for(let j=0;j<4;j++){let V=k(L,j),W=k(L,j+1),q=k(L+1,j),J=k(L+1,j+1);M.emplaceBack(V,W,q),M.emplaceBack(q,W,J)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(M),this._tileDebugTextBuffer=o.createVertexBuffer(S,i.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(A,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,F,32)}destroy(o=!0){for(let c in this.buckets)this.buckets[c].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class Hf extends ju{constructor(o,c,f,_,y){super(o,c,f,_,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,c,f){let _=f.context,y=_.gl,x=this.texturePerLayer.get(o)||f.getTileTexture(c.width);x&&x instanceof i.T?x.update(c,{premultiply:!1}):x=new i.T(_,c,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,x)}flushQueues(o){let c=this._workQueuePerLayer.get(o)||[],f=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(let o of this._workQueuePerLayer.keys()){let c=this._workQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}for(let o of this._fetchQueuePerLayer.keys()){let c=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}}fetchHeader(o=16384,c){let f=this._mrt=new i.bs(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.bu(_,(y,x,w)=>{if(y)c(y);else try{let S=f.getHeaderLength(x);if(S>o)return void(this.request=this.fetchHeader(S,c));f.parseHeader(x),this._isHeaderLoaded=!0;let M=0;for(let A of Object.values(f.layers))M=Math.max(M,A.dataIndex[A.dataIndex.length-1].lastByte);x.byteLength>=M&&(this.entireBuffer=x),c(null,this.entireBuffer||x,w)}catch(S){c(S)}}),this.request}fetchBandForRender(o,c,f,_){this.fetchBand(o,c,f,y=>{if(y)return void _(y);this.updateTextureDescriptor(o,c,f);let x=this.textureDescriptorPerLayer.get(c);_(null,x?x.img:null)})}fetchBand(o,c,f,_,y=!0){let x=this._mrt;if(!this._isHeaderLoaded||!x)return void _(new Error("Tile header is not ready"));let w=this.actor;if(!w)return void _(new Error("Can't fetch tile band without an actor"));let S,M=i.B(String(f),i.B(this.tileID.key,o)),A=this._taskQueue.get(M);A?A.add(_):(A=new Set,A.add(_),this._taskQueue.set(M,A));let F=(V,W)=>{S.complete(V,W),V?_(V):(A.forEach(q=>q(null,W)),this._taskQueue.delete(M))},k=(V,W)=>{if(V)return _(V);let q=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:W,task:S},F,void 0,!0);if(c!==null){let J=this._workQueuePerLayer.get(c)||[];J.push(()=>{q&&q.cancel(),S.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,J)}},L;try{L=x.getLayer(o)}catch(V){if(this.state==="reloading")return;throw V}if(!L)return void _(new Error(`Unknown sourceLayer "${o}"`));if(L.hasDataForBand(f))return A.forEach(V=>V(null,null)),void this._taskQueue.delete(M);let j=L.getDataRange([f]);if(S=x.createDecodingTask(j),!S||S.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)k(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{let V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),W=i.bu(V,k);if(c!==null){let q=this._fetchQueuePerLayer.get(c)||[];q.push(()=>{W.cancel(),S.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,q)}}}updateNeeded(o,c){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,c,f){if(!this._mrt)return;let _=this._mrt.getLayer(o);if(!_||!_.hasBand(f)||!_.hasDataForBand(f))return;let{bytes:y,tileSize:x,buffer:w,offset:S,scale:M}=_.getBandView(f),A=x+2*w,F=new i.q({width:A,height:A},y),k=this.texturePerLayer.get(c);k&&k instanceof i.T&&k.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:o,band:f,img:F,buffer:w,offset:S,tileSize:x,format:_.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(let c of this.texturePerLayer.values())c&&c instanceof i.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class zx{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(let o in this.data)for(let c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,f){let _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let y={value:c,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(o,y)},f)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){let c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;let f=o.wrapped().key,_=c===void 0?0:this.data[f].indexOf(c),y=this.data[f][_];return this.data[f].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){let c=[];for(let f in this.data)for(let _ of this.data[f])o(_.value)||c.push(_);for(let f of c)this.remove(f.value.tileID,f)}}class Jh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,f){let _=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},Object.assign(this.stateChanges[o][_],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(let y in this.state[o])y!==_&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(let y in this.state[o][_])f[y]||(this.deletedStates[o][_][y]=null)}else for(let y in f)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][y]===null&&delete this.deletedStates[o][_][y]}removeFeatureState(o,c,f){if(this.deletedStates[o]===null)return;let _=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&c!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][f]=null);else if(c!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(f in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][f]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,c){let f=this.state[o]||{},_=this.stateChanges[o]||{},y=this.deletedStates[o];if(y===null)return{};if(c!==void 0){let w=String(c),S=Object.assign({},f[w],_[w]);if(y){let M=y[c];if(M===null)return{};for(let A in M)delete S[A]}return S}let x=Object.assign({},f,_);if(y)for(let w in y)delete x[w];return x}initializeTileState(o,c){o.refreshFeatureState(c)}coalesceChanges(o,c){let f={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let y={};for(let x in this.stateChanges[_])this.state[_][x]||(this.state[_][x]={}),Object.assign(this.state[_][x],this.stateChanges[_][x]),y[x]=this.state[_][x];f[_]=y}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let y={};if(this.deletedStates[_]===null)for(let x in this.state[_])y[x]={},this.state[_][x]={};else for(let x in this.deletedStates[_]){if(this.deletedStates[_][x]===null)this.state[_][x]={};else if(this.state[_][x])for(let w of Object.keys(this.deletedStates[_][x]))delete this.state[_][x][w];y[x]=this.state[_][x]}f[_]=f[_]||{},Object.assign(f[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let _ in o)o[_].refreshFeatureState(c)}}class Rs extends i.E{constructor(o,c,f){super(),this.id=o,this._onlySymbols=f,c.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new zx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let c in this._tiles){let f=this._tiles[c];f.upload(o,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Gf).map(o=>o.key)}getRenderableIds(o,c){let f=[];for(let _ in this._tiles)this._isIdRenderable(+_,o,c)&&f.push(this._tiles[_]);return o?f.sort((_,y)=>{let x=_.tileID,w=y.tileID,S=new i.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new i.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||M.y-S.y||M.x-S.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Gf).map(_=>_.key)}hasRenderableParent(o){let c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c,f){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())&&(f||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){let f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,o,c)))}_tileLoaded(o,c,f,_,y){if(_){if(o.state="errored",_.status!==404)this._source.fire(new i.y(_,{tile:o}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=i.o.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let x=new Map;y&&y.responseHeaders&&(x=y.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(o){let c=this.getRenderableIds();for(let _=0;_<c.length;_++){let y=c[_];if(o.neighboringTiles&&o.neighboringTiles[y]){let x=this.getTileByID(y);f(o,x),f(x,o)}}function f(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-_.tileID.canonical.x,w=y.tileID.canonical.y-_.tileID.canonical.y,S=Math.pow(2,_.tileID.canonical.z),M=y.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+S)===1?x+=S:Math.abs(x-S)===1&&(x-=S)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,x,w),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,f,_){for(let y in this._tiles){let x=this._tiles[y];if(_[y]||!x.hasData()||x.tileID.overscaledZ<=c||x.tileID.overscaledZ>f)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>c+1;){let M=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[M.key],x&&x.hasData()&&(w=M)}let S=w;for(;S.overscaledZ>c;)if(S=S.scaledTo(S.overscaledZ-1),o[S.key]){_[w.key]=w;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){let f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=o.overscaledZ-1;f>=c;f--){let _=o.scaledTo(f),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(o){let c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;let f=Math.ceil(o.width/c)+1,_=Math.ceil(o.height/c)+1,y=Math.floor(f*_*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(o){let c=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,c){let f={};for(let _ in this._tiles){let y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+c),f[y.tileID.key]=y}this._tiles=f;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(o,c,f,_,y){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(o,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let x=this._source.type==="batched-model",w,S=this._source.maxzoom,M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){let k=M.attenuationRange()[0],L=Math.floor(k)-Math.log2(M.getDemUpscale());S>L&&(S=L)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new i.aQ(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){let k=o.clone();k.tileCoverLift=this.tileCoverLift,w=k.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&o.projection.name==="globe"&&(w.push(new i.aQ(1,0,1,0,0)),w.push(new i.aQ(1,0,1,1,0)),w.push(new i.aQ(1,0,1,0,1)),w.push(new i.aQ(1,0,1,1,1)))}else if(w=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){let k=this._source.hasTile.bind(this._source);w=w.filter(L=>k(L))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!$u(this._source.type)){let k=o.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),L=Math.min(k,this._source.maxzoom);if(x){let j=o.extendTileCover(w,L);for(let V of j)w.push(V)}else if(y){let j=o.extendTileCoverToNearPlane(w,this.transform.getFrustum(L),L);for(let V of j)w.push(V)}else if(this.castsShadows&&_){let j=o.extendTileCover(w,L,_,16);for(let V of j)this._shadowCasterTiles[V.key]=!0,w.push(V)}}let A=this._updateRetainedTiles(w);if($u(this._source.type)&&w.length!==0){let k={},L={},j=Object.keys(A);for(let W of j){let q=A[W],J=this._tiles[W];if(!J||J.fadeEndTime&&J.fadeEndTime<=i.o.now())continue;let ie=this.findLoadedParent(q,Math.max(q.overscaledZ-Rs.maxOverzooming,this._source.minzoom));ie&&(this._addTile(ie.tileID),k[ie.tileID.key]=ie.tileID),L[W]=q}let V=w[w.length-1].overscaledZ;for(let W in this._tiles){let q=this._tiles[W];if(A[W]||!q.hasData())continue;let J=q.tileID;for(;J.overscaledZ>V;){J=J.scaledTo(J.overscaledZ-1);let ie=this._tiles[J.key];if(ie&&ie.hasData()&&L[J.key]){A[W]=q.tileID;break}}}for(let W in k)A[W]||(this._coveredTiles[W]=!0,A[W]=k[W])}for(let k in A)this._tiles[k].clearFadeHold();let F=i.bv(this._tiles,A);for(let k of F){let L=this._tiles[k];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let c={};if(o.length===0)return c;let f={},_=o.reduce((M,A)=>Math.min(M,A.overscaledZ),1/0),y=o[0].overscaledZ,x=Math.max(y-Rs.maxOverzooming,this._source.minzoom),w=Math.max(y+Rs.maxUnderzooming,this._source.minzoom),S={};for(let M of o){let A=this._addTile(M);c[M.key]=M,A.hasData()||_<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,_,w,c);for(let M of o){let A=this._tiles[M.key];if(A.hasData())continue;if(M.canonical.z>=this._source.maxzoom){let k=M.children(this._source.maxzoom)[0],L=this.getTile(k);if(L&&L.hasData()){c[k.key]=k;continue}}else{let k=M.children(this._source.maxzoom);if(c[k[0].key]&&c[k[1].key]&&c[k[2].key]&&c[k[3].key])continue}let F=A.wasRequested();for(let k=M.overscaledZ-1;k>=x;--k){let L=M.scaledTo(k);if(f[L.key]||(f[L.key]=!0,A=this.getTile(L),!A&&F&&(A=this._addTile(L)),A&&(c[L.key]=L,F=A.wasRequested(),A.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let c=[],f,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}c.push(_.key);let y=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;_=y}for(let y of c)this._loadedParentTiles[y]=f}}_addTile(o){let c=this._tiles[o.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));let f=!!c;if(!f){let _=this.map?this.map.painter:null,y=this._source.tileSize*o.overscaleFactor();c=this._source.type==="raster-array"?new Hf(o,y,this.transform.tileZoom,_,this._isRaster):new ju(o,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c.uses++,this._tiles[o.key]=c,f||this._source.fire(new i.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let f=c.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){let c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,f){let _=[],y=this.transform;if(!y)return _;let x=y.projection.name==="globe",w=i.aF(y.center.lng);for(let S in this._tiles){let M=this._tiles[S];if(f&&M.clearQueryDebugViz(),M.holdingForFade())continue;let A;if(x){let F=M.tileID.canonical;if(F.z===0){let k=[Math.abs(i.aA(w,...$l(F,-1))-w),Math.abs(i.aA(w,...$l(F,1))-w)];A=[0,2*k.indexOf(Math.min(...k))-1]}else{let k=[Math.abs(i.aA(w,...$l(F,-1))-w),Math.abs(i.aA(w,...$l(F,0))-w),Math.abs(i.aA(w,...$l(F,1))-w)];A=[k.indexOf(Math.min(...k))-1]}}else A=[0];for(let F of A){let k=o.containsTile(M,y,c,F);k&&_.push(k)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,c){let f=this.getRenderableIds(o,c).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(let y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(o){let c=o.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(let x of c){let w=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*w+x.wrap-f[0])*_[0]+((x.canonical.y+.5)*w-f[1])*_[1]-f[2]*_[2]}return c.sort((x,w)=>y[x.key]-y[w.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if($u(this._source.type))for(let o in this._tiles){let c=this._tiles[o];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(o,c,f){this._state.updateState(o=o||"_geojsonTileLayer",c,f)}removeFeatureState(o,c,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,f)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,f){let _=this._tiles[o];_&&_.setDependencies(c,f)}reloadTilesForDependencies(o,c){for(let f in this._tiles)this._tiles[f].hasDependency(o,c)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,c))}_preloadTiles(o,c){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,c))};return void this._source.on("data",S)}let f=new Map,_=Array.isArray(o)?o:[o],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let S of _){let M=S.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of M)f.set(A.key,A);this.usedForTerrain&&S.updateElevation(!1)}let w=Array.from(f.values());i.bw(w,(S,M)=>{let A=new ju(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(A,F=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),M(F,A)})},c)}}function Gf(p,o){let c=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return p.overscaledZ-o.overscaledZ||f-c||o.canonical.y-p.canonical.y||o.canonical.x-p.canonical.x}function $u(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function $l(p,o){let c=1<<p.z;return[p.x/c+o,(p.x+1)/c+o]}Rs.maxOverzooming=10,Rs.maxUnderzooming=3;class HS{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,c=!1;for(let f in this.style._mergedLayers){let _=this.style._mergedLayers[f];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:o,visibilityChanged:c});else if(_.type==="model"){let y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:o,visibilityChanged:c})}}}onNewFrame(o){this.layersGotHidden=!1;for(let c of this.layers){let f=c.layer,_=!1;f.type==="fill-extrusion"?_=!f.isHidden(o)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?_=!f.isHidden(o)&&f.paint.get("building-opacity")>0:f.type==="model"&&(_=!f.isHidden(o)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&c.visible,c.visible=_}}updateZOffset(o,c){this.currentBuildingBuckets=[];for(let _ of this.layers){let y=_.layer,x=this.style.getLayerSourceCache(y),w=1;y.type==="fill-extrusion"?w=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(w=_.visible?y.paint.get("building-vertical-scale"):0);let S=x?x.getTile(c):null;if(!S&&x)for(let M in x._tiles){let A=x._tiles[M];if(c.canonical.isChildOf(A.tileID.canonical)){S=A;break}}this.currentBuildingBuckets.push({bucket:S?S.getBucket(y):null,tileID:S?S.tileID:c,verticalScale:w})}o.hasAnyZOffset=!1;let f=!1;for(let _=0;_<o.symbolInstances.length;_++){let y=o.symbolInstances.get(_),x=y.zOffset,w=this._getHeightAtTileOffset(c,y.tileAnchorX,y.tileAnchorY);y.zOffset=w!==Number.NEGATIVE_INFINITY?w:x,f||x===y.zOffset||(f=!0),o.hasAnyZOffset||y.zOffset===0||(o.hasAnyZOffset=!0)}f&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,c,f,_){let y=c,x=f;if(o.canonical.z!==_.canonical.z){let w=_.canonical,S=1/(1<<o.canonical.z-w.z);y=(c+o.canonical.x*i.al)*S-w.x*i.al|0,x=(f+o.canonical.y*i.al)*S-w.y*i.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(o,c,f){let _,y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;let{bucket:S,tileID:M,verticalScale:A}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:F,tileY:k}=this._mapCoordToOverlappingTile(o,c,f,M),L=S.getHeightAtTileCoord(F,k);L&&L.height!==void 0&&(L.hidden?_=L.height:y=Math.max(L.height*A,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x];if(w.layer.type!=="model"||!w.visible)continue;let{bucket:S,tileID:M}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:A,tileY:F}=this._mapCoordToOverlappingTile(o,c,f,M),k=S.getHeightAtTileCoord(A,F);if(k&&!k.hidden)return k.height===void 0&&_!==void 0?Math.min(k.maxHeight,_)*k.verticalScale:k.height?k.height*k.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Bx(p,o){let c={};for(let f in p)f!=="ref"&&(c[f]=p[f]);return i.bx.forEach(f=>{f in o&&(c[f]=o[f])}),c}function ep(p){p=p.slice();let o=Object.create(null);for(let c=0;c<p.length;c++)o[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Bx(p[c],o[p[c].ref]));return p}let qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function qf(p,o,c){c.push({command:qn.addSource,args:[p,o[p]]})}function Y_(p,o,c){o.push({command:qn.removeSource,args:[p]}),c[p]=!0}function Vx(p,o,c,f){Y_(p,c,f),qf(p,o,c)}function Ux(p,o,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!i.by(p[c][f],o[c][f]))return!1;for(f in o[c])if(o[c].hasOwnProperty(f)&&f!=="data"&&!i.by(p[c][f],o[c][f]))return!1;return!0}function Lc(p,o,c,f,_,y){let x;for(x in o=o||{},p=p||{})p.hasOwnProperty(x)&&(i.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}));for(x in o)o.hasOwnProperty(x)&&!p.hasOwnProperty(x)&&(i.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}))}function tp(p){return p.id}function np(p,o){return p[o.id]=o,p}function K_(p,o,c){let f=o.createTileMatrix(p,p.worldSize,c.toUnwrapped());return i.aB(new Float32Array(16),p.projMatrix,f)}function Wf(p,o,c){if(o.projection.name===c.projection.name)return p.projMatrix;let f=c.clone();return f.setProjection(o.projection),K_(f,o.getProjection(),p)}function cl(p,o,c){return o.name===c.projection.name?p.projMatrix:K_(c,o,p)}class ip{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.aA(o,0,1);let c=1,f=this._distances[c],_=o*this.paddedLength+this.padding;for(;f<_&&c<this._distances.length;)f=this._distances[++c];let y=c-1,x=this._distances[y],w=f-x,S=w>0?(_-x)/w:0;return this.points[y].mult(1-S).add(this.points[c].mult(S))}}class Q_{constructor(o,c,f){let _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(c/f);for(let x=0;x<this.xCellCount*this.yCellCount;x++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,f,_,y){this._forEachCell(c,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(o,c,f,_){this._forEachCell(c-_,f-_,c+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(f),this.circles.push(_)}_insertBoxCell(o,c,f,_,y,x){this.boxCells[y].push(x)}_insertCircleCell(o,c,f,_,y,x){this.circleCells[y].push(x)}_query(o,c,f,_,y,x){if(f<0||o>this.width||_<0||c>this.height)return!y&&[];let w=[];if(o<=0&&c<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let S=0;S<this.boxKeys.length;S++)w.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let M=this.circles[3*S],A=this.circles[3*S+1],F=this.circles[3*S+2];w.push({key:this.circleKeys[S],x1:M-F,y1:A-F,x2:M+F,y2:A+F})}return x?w.filter(x):w}return this._forEachCell(o,c,f,_,this._queryCell,w,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?w.length>0:w}_queryCircle(o,c,f,_,y){let x=o-f,w=o+f,S=c-f,M=c+f;if(w<0||x>this.width||M<0||S>this.height)return!_&&[];let A=[];return this._forEachCell(x,S,w,M,this._queryCellCircle,A,{hitTest:_,circle:{x:o,y:c,radius:f},seenUids:{box:{},circle:{}}},y),_?A.length>0:A}query(o,c,f,_,y){return this._query(o,c,f,_,!1,y)}hitTest(o,c,f,_,y){return this._query(o,c,f,_,!0,y)}hitTestCircle(o,c,f,_){return this._queryCircle(o,c,f,!0,_)}_queryCell(o,c,f,_,y,x,w,S){let M=w.seenUids,A=this.boxCells[y];if(A!==null){let k=this.bboxes;for(let L of A)if(!M.box[L]){M.box[L]=!0;let j=4*L;if(o<=k[j+2]&&c<=k[j+3]&&f>=k[j+0]&&_>=k[j+1]&&(!S||S(this.boxKeys[L]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[L],x1:k[j],y1:k[j+1],x2:k[j+2],y2:k[j+3]})}}}let F=this.circleCells[y];if(F!==null){let k=this.circles;for(let L of F)if(!M.circle[L]){M.circle[L]=!0;let j=3*L;if(this._circleAndRectCollide(k[j],k[j+1],k[j+2],o,c,f,_)&&(!S||S(this.circleKeys[L]))){if(w.hitTest)return x.push(!0),!0;{let V=k[j],W=k[j+1],q=k[j+2];x.push({key:this.circleKeys[L],x1:V-q,y1:W-q,x2:V+q,y2:W+q})}}}}}_queryCellCircle(o,c,f,_,y,x,w,S){let M=w.circle,A=w.seenUids,F=this.boxCells[y];if(F!==null){let L=this.bboxes;for(let j of F)if(!A.box[j]){A.box[j]=!0;let V=4*j;if(this._circleAndRectCollide(M.x,M.y,M.radius,L[V+0],L[V+1],L[V+2],L[V+3])&&(!S||S(this.boxKeys[j])))return x.push(!0),!0}}let k=this.circleCells[y];if(k!==null){let L=this.circles;for(let j of k)if(!A.circle[j]){A.circle[j]=!0;let V=3*j;if(this._circlesCollide(L[V],L[V+1],L[V+2],M.x,M.y,M.radius)&&(!S||S(this.circleKeys[j])))return x.push(!0),!0}}}_forEachCell(o,c,f,_,y,x,w,S){let M=this._convertToXCellCoord(o),A=this._convertToYCellCoord(c),F=this._convertToXCellCoord(f),k=this._convertToYCellCoord(_);for(let L=M;L<=F;L++)for(let j=A;j<=k;j++)if(y.call(this,o,c,f,_,this.xCellCount*j+L,x,w,S))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,f,_,y,x){let w=_-o,S=y-c,M=f+x;return M*M>w*w+S*S}_circleAndRectCollide(o,c,f,_,y,x,w){let S=(x-_)/2,M=Math.abs(o-(_+S));if(M>S+f)return!1;let A=(w-y)/2,F=Math.abs(c-(y+A));if(F>A+f)return!1;if(M<=S||F<=A)return!0;let k=M-S,L=F-A;return k*k+L*L<=f*f}}let Nc={unknown:0,flipRequired:1,flipNotRequired:2},Hu=Math.tan(85*Math.PI/180);function Yo(p,o,c,f,_,y,x){let w=i.bC();if(c)if(y.name==="globe"){let S=i.bD(_,o);i.aB(w,w,S)}else{let S=i.bE([],x);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3],f||i.bB(w,w,_.angle)}else i.aB(w,_.labelPlaneMatrix,p);return w}function Zf(p,o,c,f,_,y,x){let w=Yo(p,o,c,f,_,y,x);return y.name==="globe"&&c||(w[2]=w[6]=w[10]=w[14]=0),w}function rp(p,o,c,f,_,y,x){if(c){if(y.name==="globe"){let w=Yo(p,o,c,f,_,y,x);return i.bl(w,w),i.aB(w,p,w),w}{let w=i.bz(p),S=i.bA([]);return S[0]=x[0],S[1]=x[1],S[4]=x[2],S[5]=x[3],i.aB(w,w,S),f||i.bB(w,w,-_.angle),w}}return _.glCoordMatrix}function ha(p,o,c,f){let _=[p,o,c,1];c?i.aC(_,_,f):Wt(_,_,f);let y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function ci(p,o){return Math.min(.5+p/o*.5,1.5)}function jx(p,o){let c=p[0]/p[3],f=p[1]/p[3];return c>=-o[0]&&c<=o[0]&&f>=-o[1]&&f<=o[1]}function $x(p,o,c,f,_,y,x,w,S,M,A=1){let F=c.transform,k=f?p.textSizeData:p.iconSizeData,L=i.bK(k,c.transform.zoom,A),j=F.projection.name==="globe",V=[256/c.width*2+1,256/c.height*2+1],W=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();let q=null;j&&(q=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let J=p.lineVertexArray,ie=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,ee=c.transform.width/c.transform.height,ge,de=!1;for(let fe=0;fe<ie.length;fe++){let ue=ie.get(fe),{numGlyphs:se,writingMode:_e}=ue;if(_e!==i.bL.vertical||de||ge===i.bL.horizontal||(de=!0),ge=_e,(ue.hidden||_e===i.bL.vertical)&&!de){za(se,W);continue}de=!1;let Se=new i.P(ue.tileAnchorX,ue.tileAnchorY),Ce=p.elevationType==="road",Be=!!F.elevation||Ce,{x:Ue,y:Ze,z:lt}=F.projection.projectTilePoint(Se.x,Se.y,M.canonical),ke=null;if(Be){let At=Ce?p.getElevationFeatureForText(fe):null;ke={getElevation:S,elevation:F.elevation,elevationFeature:At};let[Jt,pn,Fn]=S(Se,F.elevation,At);Ue+=Jt,Ze+=pn,lt+=Fn}let be=[Ue,Ze,lt,1];if(i.aC(be,be,o),!jx(be,V)){za(se,W);continue}let He=be[3],Le=ci(c.transform.getCameraToCenterDistance(F.projection),He),Je=i.bM(k,L,ue),yt=x?Je/Le:Je*Le,Mt=ha(Ue,Ze,lt,_);if(Mt[3]<=0){za(se,W);continue}let pt={},ct=i.an(p.layers[0].layout.get("text-max-angle")),Vt=Math.cos(ct),Lt=x?null:ke,St=J_(ue,yt,!1,w,o,_,y,p.glyphOffsetArray,J,W,q,Mt,Se,pt,ee,Lt,F.projection,M,x,Vt);de=St.useVertical,Lt&&St.needsFlipping&&(pt={}),(St.notEnoughRoom||de||St.needsFlipping&&J_(ue,yt,!0,w,o,_,y,p.glyphOffsetArray,J,W,q,Mt,Se,pt,ee,Lt,F.projection,M,x,Vt).notEnoughRoom)&&za(se,W)}f?(p.text.dynamicLayoutVertexBuffer.updateData(W),q&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(W),q&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(q))}function Hx(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W){let{lineStartIndex:q,glyphStartIndex:J,segment:ie}=w,ee=J+w.numGlyphs,ge=q+w.lineLength,de=o.getoffsetX(J),fe=o.getoffsetX(ee-1),ue=Fd(p*de,c,f,_,y,x,ie,q,ge,S,M,A,F,k,!0,L,j,V,W);if(!ue)return null;let se=Fd(p*fe,c,f,_,y,x,ie,q,ge,S,M,A,F,k,!0,L,j,V,W);return se?{first:ue,last:se}:null}function on(p,o,c,f){return p===i.bL.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:p===i.bL.vertical?f>0?{needsFlipping:!0}:null:o!==Nc.unknown&&(function(_,y){return _===0||Math.abs(y/_)>Hu})(c,f)?o===Nc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function J_(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J,ie){let ee=o/24,ge=p.lineOffsetX*ee,de=p.lineOffsetY*ee,{lineStartIndex:fe,glyphStartIndex:ue,numGlyphs:se,segment:_e,writingMode:Se,flipState:Ce}=p,Be=fe+p.lineLength,Ue=Ze=>{if(A){let[He,Le,Je]=Ze.up,yt=M.length;i.bN(A,yt+0,He,Le,Je),i.bN(A,yt+1,He,Le,Je),i.bN(A,yt+2,He,Le,Je),i.bN(A,yt+3,He,Le,Je)}let[lt,ke,be]=Ze.point;i.bO(M,lt,ke,be,Ze.angle)};if(se>1){let Ze=Hx(ee,w,ge,de,c,F,k,p,S,y,L,V,!1,W,q,J,ie);if(!Ze)return{notEnoughRoom:!0};if(f&&!c){let[lt,ke,be]=Ze.first.point,[He,Le,Je]=Ze.last.point;[lt,ke]=ha(lt,ke,be,x),[He,Le]=ha(He,Le,Je,x);let yt=on(Se,Ce,(He-lt)*j,Le-ke);if(p.flipState=yt&&yt.needsFlipping?Nc.flipRequired:Nc.flipNotRequired,yt)return yt}Ue(Ze.first);for(let lt=ue+1;lt<ue+se-1;lt++){let ke=Fd(ee*w.getoffsetX(lt),ge,de,c,F,k,_e,fe,Be,S,y,L,V,!1,!1,W,q,J,ie);if(!ke)return M.length-=4*(lt-ue),{notEnoughRoom:!0};Ue(ke)}Ue(Ze.last)}else{if(f&&!c){let lt=ha(k.x,k.y,0,_),ke=fe+_e+1,be=new i.P(S.getx(ke),S.gety(ke)),He=ha(be.x,be.y,0,_),Le=He[3]>0?He:pa(k,be,lt,1,_,void 0,W,q.canonical),Je=on(Se,Ce,(Le[0]-lt[0])*j,Le[1]-lt[1]);if(p.flipState=Je&&Je.needsFlipping?Nc.flipRequired:Nc.flipNotRequired,Je)return Je}let Ze=Fd(ee*w.getoffsetX(ue),ge,de,c,F,k,_e,fe,Be,S,y,L,V,!1,!1,W,q,J,ie);if(!Ze)return{notEnoughRoom:!0};Ue(Ze)}return{}}function op(p,o,c,f,_){let{x:y,y:x,z:w}=f.projectTilePoint(p.x,p.y,o);if(!_)return ha(y,x,w,c);let[S,M,A]=_.getElevation(p,_.elevation,_.elevationFeature);return ha(y+S,x+M,w+A,c)}function pa(p,o,c,f,_,y,x,w){let S=op(p.sub(o)._unit()._add(p),w,_,x,y);return i.av(S,c,S),i.aw(S,S),i.bH(S,c,S,f)}function Fd(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J){let ie=f?p-o:p+o,ee=ie>0?1:-1,ge=0;f&&(ee*=-1,ge=Math.PI),ee<0&&(ge+=Math.PI);let de=w+x+(ee>0?0:1)|0,fe=_,ue=_,se=0,_e=0,Se=Math.abs(ie),Ce=[],Be=[],Ue=y,Ze=Ue,lt=i.bF([]),ke=()=>pa(Ze,Ue,ue,Se-se+1,A,k,V,W.canonical);for(;se+_e<=Se;){if(de+=ee,de<w||de>=S)return null;if(ue=fe,Ze=Ue,Ce.push(ue),L&&Be.push(Ze),Ue=new i.P(M.getx(de),M.gety(de)),fe=F[de],!fe){let Lt=op(Ue,W.canonical,A,V,k);fe=Lt[3]>0?F[de]=Lt:ke()}se+=_e;let ct=i.av([],fe,ue),Vt=i.bG(ue,fe);if(c&&Vt>0&&_e>0&&i.bJ(lt,ct)/(_e*Vt)<J)return null;_e=Vt,lt=ct}j&&k&&(F[de]&&(fe=ke(),_e=i.bG(ue,fe),lt=i.av([],fe,ue)),F[de]=fe);let be=(Se-se)/_e,He=Ue.sub(Ze)._mult(be)._add(Ze),Le=i.bH([],ue,lt,be),Je=[0,0,1],yt=lt[0],Mt=lt[1];if(q&&(Je=V.upVector(W.canonical,He.x,He.y),Je[0]!==0||Je[1]!==0||Je[2]!==1)){let ct=[Je[2],0,-Je[0]],Vt=i.bI([],Je,ct);i.aw(ct,ct),i.aw(Vt,Vt),yt=i.bJ(lt,ct),Mt=i.bJ(lt,Vt)}if(c){let ct=i.bI([],Je,lt);i.aw(ct,ct),i.bH(Le,Le,ct,c*ee)}let pt=ge+Math.atan2(Mt,yt);return Ce.push(Le),L&&Be.push(He),{point:Le,angle:pt,path:Ce,tilePath:Be,up:Je}}function za(p,o){let c=o.length,f=c+4*p;o.resize(f),o.float32.fill(-1/0,4*c,4*f)}function Wt(p,o,c){let f=o[0],_=o[1];return p[0]=c[0]*f+c[4]*_+c[12],p[1]=c[1]*f+c[5]*_+c[13],p[3]=c[3]*f+c[7]*_+c[15],p}let Bn=100;class pi{constructor(o,c,f=new Q_(o.width+200,o.height+200,25),_=new Q_(o.width+200,o.height+200,25)){this.transform=o,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Bn,this.screenBottomBoundary=o.height+Bn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,f,_,y,x,w,S,M,A,F){let k=f.projectedAnchorX,L=f.projectedAnchorY,j=f.projectedAnchorZ,V=f.tileAnchorX,W=f.tileAnchorY,q=f.elevation,J=f.tileID,ie=o.getProjection();if(q&&J){let[Be,Ue,Ze]=ie.upVector(J.canonical,f.tileAnchorX,f.tileAnchorY),lt=ie.upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=Be*q*lt,L+=Ue*q*lt,j+=Ze*q*lt}let ee=o.projection.name==="globe",ge=o.projection.name==="globe"?i.aj(this.transform.zoom):0;if(J&&ee&&ge<1&&!x){let Be=1<<J.canonical.z,Ue=i.bP(V,W);i.bQ(Ue,Ue,1/i.al),i.bR(Ue,Ue,i.bP(J.canonical.x,J.canonical.y)),i.bQ(Ue,Ue,1/Be),i.bS(Ue,Ue,i.bP(_[0],_[1])),Ue[0]=i.bT(Ue[0],-.5,.5),i.bQ(Ue,Ue,i.al);let Ze=i.bU(Ue[0],Ue[1],i.al/(2*Math.PI),1);i.aC(Ze,Ze,y),k=i.ak(k,Ze[0],ge),L=i.ak(L,Ze[1],ge),j=i.ak(j,Ze[2],ge)}let de=this.projectAndGetPerspectiveRatio(A,k,L,j,f.tileID,ie.name==="globe"||!!q||this.transform.pitch>0,ie),fe=M*de.perspectiveRatio,ue=(f.x1*c+w.x-f.padding)*fe+de.point.x,se=(f.y1*c+w.y-f.padding)*fe+de.point.y,_e=(f.x2*c+w.x+f.padding)*fe+de.point.x,Se=(f.y2*c+w.y+f.padding)*fe+de.point.y,Ce=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(ue,se,_e,Se)||!S&&this.grid.hitTest(ue,se,_e,Se,F)||Ce?{box:[],offscreen:!1,occluded:de.occluded}:{box:[ue,se,_e,Se],offscreen:this.isOffscreen(ue,se,_e,Se),occluded:!1}}placeCollisionCircles(o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W){let q=[],J=this.transform.elevation,ie=o.getProjection(),ee=o.elevationType==="road",ge=!!J||ee,de=i.bV.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ie),fe=new i.P(f.tileAnchorX,f.tileAnchorY),ue=new i.P(f.tileAnchorX,f.tileAnchorY),{x:se,y:_e,z:Se}=ie.projectTilePoint(ue.x,ue.y,W.canonical),Ce=null;if(ge){let Vt=ee?o.getElevationFeatureForText(_):null;Ce={getElevation:de,elevation:J,elevationFeature:Vt};let[Lt,St,At]=de(fe,J,Vt);se+=Lt,_e+=St,Se+=At}let Be=ie.name==="globe",Ue=this.projectAndGetPerspectiveRatio(S,se,_e,Se,W,Be||!!J||this.transform.pitch>0,ie),{perspectiveRatio:Ze}=Ue,lt=(k?w/Ze:w*Ze)/i.bY,ke=ha(se,_e,Se,M),be=f.lineOffsetX*lt,He=f.lineOffsetY*lt,Le=i.an(o.layers[0].layout.get("text-max-angle")),Je=Math.cos(Le),yt=Ue.signedDistanceFromCamera>0?Hx(lt,x,be,He,ee&&f.flipState===1,ke,ue,f,y,M,{},ge&&!k?Ce:null,k&&ge,ie,W,k,Je):null,Mt=!1,pt=!1,ct=!0;if(yt&&!Ue.occluded){let Vt=.5*j*Ze+V,Lt=new i.P(-100,-100),St=new i.P(this.screenRightBoundary,this.screenBottomBoundary),At=new ip,{first:Jt,last:pn}=yt,Fn=Jt.path.length,Jn=[];for(let hn=Fn-1;hn>=1;hn--)Jn.push(Jt.path[hn]);for(let hn=1;hn<pn.path.length;hn++)Jn.push(pn.path[hn]);let Ut=2.5*Vt;A&&(Jn=Jn.map(([hn,ii,fi],ui)=>(ge&&!Be&&(fi=de(ui<Fn-1?Jt.tilePath[Fn-1-ui]:pn.tilePath[ui-Fn+2],J,Ce.elevationFeature)[2]),ha(hn,ii,fi,A))),Jn.some(hn=>hn[3]<=0)&&(Jn=[]));let Xn=[];if(Jn.length>0){let hn=1/0,ii=-1/0,fi=1/0,ui=-1/0;for(let Wn of Jn)hn=Math.min(hn,Wn[0]),fi=Math.min(fi,Wn[1]),ii=Math.max(ii,Wn[0]),ui=Math.max(ui,Wn[1]);ii>=Lt.x&&hn<=St.x&&ui>=Lt.y&&fi<=St.y&&(Xn=[Jn.map(Wn=>new i.P(Wn[0],Wn[1]))],(hn<Lt.x||ii>St.x||fi<Lt.y||ui>St.y)&&(Xn=i.bW(Xn,Lt.x,Lt.y,St.x,St.y)))}for(let hn of Xn){At.reset(hn,.25*Vt);let ii=0;ii=At.length<=.5*Vt?1:Math.ceil(At.paddedLength/Ut)+1;for(let fi=0;fi<ii;fi++){let ui=fi/Math.max(ii-1,1),Wn=At.lerp(ui),bn=Wn.x+Bn,ti=Wn.y+Bn;q.push(bn,ti,Vt,0);let ar=bn-Vt,qi=ti-Vt,ri=bn+Vt,jn=ti+Vt;if(ct=ct&&this.isOffscreen(ar,qi,ri,jn),pt=pt||this.isInsideGrid(ar,qi,ri,jn),!c&&this.grid.hitTestCircle(bn,ti,Vt,L)&&(Mt=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Mt,occluded:!1}}}}return{circles:!F&&Mt||!pt?[]:q,offscreen:ct,collisionDetected:Mt,occluded:Ue.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],f=1/0,_=1/0,y=-1/0,x=-1/0;for(let A of o){let F=new i.P(A.x+Bn,A.y+Bn);f=Math.min(f,F.x),_=Math.min(_,F.y),y=Math.max(y,F.x),x=Math.max(x,F.y),c.push(F)}let w=this.grid.query(f,_,y,x).concat(this.ignoredGrid.query(f,_,y,x)),S={},M={};for(let A of w){let F=A.key;if(S[F.bucketInstanceId]===void 0&&(S[F.bucketInstanceId]={}),S[F.bucketInstanceId][F.featureIndex])continue;let k=[new i.P(A.x1,A.y1),new i.P(A.x2,A.y1),new i.P(A.x2,A.y2),new i.P(A.x1,A.y2)];i.bX(c,k)&&(S[F.bucketInstanceId][F.featureIndex]=!0,M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]=[]),M[F.bucketInstanceId].push(F.featureIndex))}return M}insertCollisionBox(o,c,f,_,y){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,f,_,y){let x=c?this.ignoredGrid:this.grid,w={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let S=0;S<o.length;S+=4)x.insertCircle(w,o[S],o[S+1],o[S+2])}projectAndGetPerspectiveRatio(o,c,f,_,y,x,w){let S=[c,f,_,1],M=!1;_||this.transform.pitch>0?(i.aC(S,S,o),this.fogState&&y&&w.name!=="globe"&&(M=(function(k,L,j,V,W,q){let J=q.calculateFogTileMatrix(W),ie=[L,j,V];return i.af(ie,ie,J),Rt(k,i.ag(ie),q.pitch,q._fov)})(this.fogState,c,f,_,y.toUnwrapped(),this.transform)>.9)):Wt(S,S,o);let A=S[3];return{point:new i.P((S[0]/A+1)/2*this.transform.width+Bn,(-S[1]/A+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/A*.5,1.5),signedDistanceFromCamera:A,occluded:x&&S[2]>A||M}}isOffscreen(o,c,f,_){return f<Bn||o>=this.screenRightBoundary||_<Bn||c>this.screenBottomBoundary}isInsideGrid(o,c,f,_){return f>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let o=i.bA([]);return i.br(o,o,[-100,-100,0]),o}}class bs{constructor(o,c,f,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ul{constructor(o,c,f,_,y,x=!1){this.text=new bs(o?o.text:null,c,f,y),this.icon=new bs(o?o.icon:null,c,_,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ai{constructor(o,c,f,_=!1){this.text=o,this.icon=c,this.skipFade=f,this.clipped=_}}class Xf{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class sp{constructor(o,c,f,_,y){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class ap{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[o]}}function zo(p,o,c,f,_){let{horizontalAlign:y,verticalAlign:x}=i.c1(p),w=-(y-.5)*o,S=-(x-.5)*c,M=i.c2(p,f);return new i.P(w+M[0]*_,S+M[1]*_)}function Lr(p,o,c,f,_){let y=new i.P(p,o);return c&&y._rotate(f?_:-_),y}class GS{constructor(o,c,f,_,y,x){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new pi(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ap(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,c,f,_,y=1){let x=f.getBucket(c),w=f.latestFeatureIndex;if(!x||!w||c.fqid!==x.layerIds[0])return;let S=x.layers[0].layout,M=x.layers[0].paint,A=f.collisionBoxArray,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),k=f.tileSize/i.al,L=f.tileID.toUnwrapped();this.transform.setProjection(x.projection);let j=(V=f.tileID,W=x.getProjection(),q=this.transform,W.name===this.projection?q.calculateProjMatrix(V.toUnwrapped()):K_(q,W,V));var V,W,q;let J=S.get("text-pitch-alignment")==="map",ie=S.get("text-rotation-alignment")==="map";c.compileFilter(c.options);let ee=c.dynamicFilter(),ge=c.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(f),fe=Zf(j,f.tileID.canonical,J,ie,this.transform,x.getProjection(),de),ue=null,se=x.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(J){let be=rp(j,f.tileID.canonical,J,ie,this.transform,x.getProjection(),de);ue=i.aB([],this.transform.labelPlaneMatrix,be)}let _e=null;ee&&f.latestFeatureIndex&&(_e={unwrappedTileID:L,dynamicFilter:ee,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new sp(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,f.tileID);let[Se,Ce]=x.layers[0].layout.get("text-size-scale-range"),Be=i.aA(y,Se,Ce),[Ue,Ze]=S.get("icon-size-scale-range"),lt=i.aA(y,Ue,Ze),ke={bucket:x,layout:S,paint:M,posMatrix:j,invMatrix:se,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:fe,labelToScreenMatrix:ue,clippingData:_e,scale:F,textPixelRatio:k,holdingForFade:f.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:i.bK(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:i.bK(x.iconSizeData,this.transform.zoom,lt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(let be of x.sortKeyRanges){let{sortKey:He,symbolInstanceStart:Le,symbolInstanceEnd:Je}=be;o.push({sortKey:He,symbolInstanceStart:Le,symbolInstanceEnd:Je,parameters:ke})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J,ie,ee,ge){let{textOffset0:de,textOffset1:fe,crossTileID:ue}=V,se=[de,fe],_e=zo(o,x,w,se,S),Se=this.collisionIndex.placeCollisionBox(q,S,c,f,_,y,Lr(_e.x,_e.y,M,A,this.transform.angle),j,F,k,L.predicate);if(ie){let Ce=q.getSymbolInstanceIconSize(ge,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ce,ie,f,_,y,Lr(_e.x,_e.y,M,A,this.transform.angle),j,F,k,L.predicate).box.length===0)return}if(Se.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Ce=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:se,width:x,height:w,anchor:o,textScale:S,prevAnchor:Ce},this.markUsedJustification(q,o,V,J),q.allowVerticalPlacement&&(this.markUsedOrientation(q,J,V),this.placedOrientations[ue]=J),{shift:_e,placedGlyphBoxes:Se}}}placeLayerBucketPart(o,c,f,_,y=1){let{bucket:x,layout:w,paint:S,posMatrix:M,textLabelPlaneMatrix:A,labelToScreenMatrix:F,clippingData:k,textPixelRatio:L,mercatorCenter:j,invMatrix:V,holdingForFade:W,collisionBoxArray:q,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:ie,collisionGroup:ee,latestFeatureIndex:ge}=o.parameters,de=w.get("text-optional"),fe=w.get("icon-optional"),ue=w.get("text-allow-overlap"),se=w.get("icon-allow-overlap"),_e=w.get("text-rotation-alignment")==="map",Se=w.get("icon-rotation-alignment")==="map",Ce=w.get("text-pitch-alignment")==="map",Be=S.get("symbol-z-offset"),Ue=w.get("symbol-elevation-reference")==="sea",Ze=w.get("symbol-placement"),[lt,ke]=w.get("text-size-scale-range"),[be,He]=w.get("icon-size-scale-range"),Le=i.aA(y,lt,ke),Je=i.aA(y,be,He),yt=w.get("text-variable-anchor"),Mt=_e&&Ze!=="point",pt=Se&&Ze!=="point",ct=yt&&x.hasTextData(),Vt=x.hasIconTextFit()&&ct&&x.hasIconData();this.transform.setProjection(x.projection);let Lt=ct||Mt,St=pt||Vt,At=ue&&(se||!x.hasIconData()||fe),Jt=se&&(ue||!x.hasTextData()||de),pn=!Be.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),f&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,q,Le,Je);let Fn=(Ut,Xn,hn)=>{let{crossTileID:ii,numVerticalGlyphVertices:fi}=Ut,ui=null;if(k&&k.dynamicFilterNeedsFeature||pn){let pr=this.retainedQueryData[x.bucketInstanceId];ui=ge.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:pr.bucketIndex,sourceLayerIndex:pr.sourceLayerIndex,layoutVertexArrayOffset:0});let Tr=ui.properties?ui.properties.worldview:null;if(x.localizable&&x.worldview&&typeof Tr=="string")if(Tr==="all")ui.properties.$localized=!0;else{if(!Tr.split(",").includes(x.worldview))return;ui.properties.$localized=!0,ui.properties.worldview=x.worldview}}if(k&&!(0,k.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},ui,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[ii]=new ai(!1,!1,!1,!0),void c.add(ii);let Wn=Be.evaluate(ui,{});if(c.has(ii))return;if(W)return void(this.placements[ii]=new ai(!1,!1,!1));let bn=!1,ti=!1,ar=!0,qi=!1,ri=!1,jn=null,wn={box:null,offscreen:null,occluded:null},Bi={box:null},br=null,er=null,Ei=null,us=0,Io=0,Zr=0;hn.textFeatureIndex?us=hn.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(us=Ut.featureIndex),hn.verticalTextFeatureIndex&&(Io=hn.verticalTextFeatureIndex);let Vo=x.elevationFeatures?x.elevationFeatures[Ut.elevationFeatureIndex]:void 0,Uo=pr=>{pr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Tr=this.transform.elevation;pr.elevation=Ue?Wn:Wn+i.bV.getAtTileOffset(pr.tileID,new i.P(pr.tileAnchorX,pr.tileAnchorY),Tr,Vo),pr.elevation+=Ut.zOffset},yo=hn.textBox;if(yo){Uo(yo);let pr=Si=>{let Or=i.bL.horizontal;if(x.allowVerticalPlacement&&!Si&&this.prevPlacement){let lr=this.prevPlacement.placedOrientations[ii];lr&&(this.placedOrientations[ii]=lr,Or=lr,this.markUsedOrientation(x,Or,Ut))}return Or},Tr=(Si,Or)=>{if(x.allowVerticalPlacement&&fi>0&&hn.verticalTextBox){for(let lr of x.writingModes)if(lr===i.bL.vertical?(wn=Or(),Bi=wn):wn=Si(),wn&&wn.box&&wn.box.length)break}else wn=Si()};if(yt){let Si=yt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ii]){let tr=this.prevPlacement.variableOffsets[ii];Si.indexOf(tr.anchor)>0&&(Si=Si.filter(ba=>ba!==tr.anchor),Si.unshift(tr.anchor))}let Or=(tr,ba,Lp)=>{let $a=x.getSymbolInstanceTextSize(J,Ut,this.transform.zoom,Xn),Np=(tr.x2-tr.x1)*$a+2*tr.padding,oh=(tr.y2-tr.y1)*$a+2*tr.padding,yl=Ut.hasIconTextFit&&!se?ba:null;yl&&Uo(yl);let ic={box:[],offscreen:!1,occluded:!1},sh=ue?2*Si.length:Si.length;for(let Jc=0;Jc<sh;++Jc){let rc=this.attemptAnchorPlacement(Si[Jc%Si.length],tr,j,V,Lt,Np,oh,$a,_e,Ce,L,M,ee,Jc>=Si.length,Ut,Xn,x,Lp,yl,J,ie);if(rc&&(ic=rc.placedGlyphBoxes,ic&&ic.box&&ic.box.length)){bn=!0,jn=rc.shift;break}}return ic};Tr(()=>Or(yo,hn.iconBox,i.bL.horizontal),()=>{let tr=hn.verticalTextBox;return tr&&Uo(tr),x.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&fi>0&&tr?Or(tr,hn.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(bn=wn.box,ar=wn.offscreen,qi=wn.occluded);let lr=pr(!(!wn||!wn.box));if(!bn&&this.prevPlacement){let tr=this.prevPlacement.variableOffsets[ii];tr&&(this.variableOffsets[ii]=tr,this.markUsedJustification(x,tr.anchor,Ut,lr))}}else{let Si=(Or,lr)=>{let tr=x.getSymbolInstanceTextSize(J,Ut,this.transform.zoom,Xn),ba=this.collisionIndex.placeCollisionBox(x,tr,Or,j,V,Lt,new i.P(0,0),ue,L,M,ee.predicate);return ba&&ba.box&&ba.box.length&&(this.markUsedOrientation(x,lr,Ut),this.placedOrientations[ii]=lr),ba};Tr(()=>Si(yo,i.bL.horizontal),()=>{let Or=hn.verticalTextBox;return x.allowVerticalPlacement&&fi>0&&Or?(Uo(Or),Si(Or,i.bL.vertical)):{box:null,offscreen:null,occluded:null}}),pr(!!(wn&&wn.box&&wn.box.length))}}if(br=wn,bn=br&&br.box&&br.box.length>0,ar=br&&br.offscreen,qi=br&&br.occluded,Ut.useRuntimeCollisionCircles){let pr=Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex,Tr=x.text.placedSymbolArray.get(pr),Si=i.bM(x.textSizeData,J,Tr),Or=w.get("text-padding");er=this.collisionIndex.placeCollisionCircles(x,ue,Tr,pr,x.lineVertexArray,x.glyphOffsetArray,Si,M,A,F,f,Ce,ee.predicate,Ut.collisionCircleDiameter*Si/i.bY,Or,this.retainedQueryData[x.bucketInstanceId].tileID),bn=ue||er.circles.length>0&&!er.collisionDetected,ar=ar&&er.offscreen,qi=er.occluded}if(hn.iconFeatureIndex&&(Zr=hn.iconFeatureIndex),hn.iconBox){let pr=Tr=>{Uo(Tr);let Si=Ut.hasIconTextFit&&jn?Lr(jn.x,jn.y,_e,Ce,this.transform.angle):new i.P(0,0),Or=x.getSymbolInstanceIconSize(ie,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Or,Tr,j,V,St,Si,se,L,M,ee.predicate)};Bi&&Bi.box&&Bi.box.length&&hn.verticalIconBox?(Ei=pr(hn.verticalIconBox),ti=Ei.box.length>0):(Ei=pr(hn.iconBox),ti=Ei.box.length>0),ar=ar&&Ei.offscreen,ri=Ei.occluded}let Xs=de||Ut.numHorizontalGlyphVertices===0&&fi===0,xa=fe||Ut.numIconVertices===0;if(Xs||xa?xa?Xs||(ti=ti&&bn):bn=ti&&bn:ti=bn=ti&&bn,bn&&br&&br.box&&this.collisionIndex.insertCollisionBox(br.box,w.get("text-ignore-placement"),x.bucketInstanceId,Bi&&Bi.box&&Io?Io:us,ee.ID),ti&&Ei&&this.collisionIndex.insertCollisionBox(Ei.box,w.get("icon-ignore-placement"),x.bucketInstanceId,Zr,ee.ID),er&&(bn&&this.collisionIndex.insertCollisionCircles(er.circles,w.get("text-ignore-placement"),x.bucketInstanceId,us,ee.ID),f)){let pr=x.bucketInstanceId,Tr=this.collisionCircleArrays[pr];Tr===void 0&&(Tr=this.collisionCircleArrays[pr]=new Xf);for(let Si=0;Si<er.circles.length;Si+=4)Tr.circles.push(er.circles[Si+0]),Tr.circles.push(er.circles[Si+1]),Tr.circles.push(er.circles[Si+2]),Tr.circles.push(er.collisionDetected?1:0)}let Es=x.projection.name!=="globe";At=At&&(Es||!qi),Jt=Jt&&(Es||!ri),this.placements[ii]=new ai(bn||At,ti||Jt,ar||x.justReloaded),c.add(ii)},Jn=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,Jn),x.elevationType==="road"&&x.updateRoadElevation(Jn.canonical),x.updateZOffset(),x.sortFeaturesByY){let Ut=x.getSortedSymbolIndexes(this.transform.angle);for(let Xn=Ut.length-1;Xn>=0;--Xn){let hn=Ut[Xn];Fn(x.symbolInstances.get(hn),hn,x.collisionArrays[hn])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let Ut=x.getSortedIndexesByZOffset();for(let Xn=0;Xn<Ut.length;++Xn){let hn=Ut[Xn];Fn(x.symbolInstances.get(hn),hn,x.collisionArrays[hn])}}else for(let Ut=o.symbolInstanceStart;Ut<o.symbolInstanceEnd;Ut++)Fn(x.symbolInstances.get(Ut),Ut,x.collisionArrays[Ut]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){let Ut=this.collisionCircleArrays[x.bucketInstanceId];i.bl(Ut.invProjMatrix,M),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,f,_){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:S,crossTileID:M}=f,A=i.c3(c),F=_===i.bL.vertical?S:A==="left"?y:A==="center"?x:A==="right"?w:-1;y>=0&&(o.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:M),x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:M),w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:M),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:M)}markUsedOrientation(o,c,f){let _=c===i.bL.horizontal||c===i.bL.horizontalOnly?c:0,y=c===i.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M}=f,A=o.text.placedSymbolArray;x>=0&&(A.get(x).placedOrientation=_),w>=0&&(A.get(w).placedOrientation=_),S>=0&&(A.get(S).placedOrientation=_),M>=0&&(A.get(M).placedOrientation=y)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let _=c?c.symbolFadeChange(o):1,y=c?c.opacities:{},x=c?c.variableOffsets:{},w=c?c.placedOrientations:{};for(let S in this.placements){let M=this.placements[S],A=y[S];A?(this.opacities[S]=new ul(A,_,M.text,M.icon,null,M.clipped),f=f||M.text!==A.text.placed||M.icon!==A.icon.placed):(this.opacities[S]=new ul(null,_,M.text,M.icon,M.skipFade,M.clipped),f=f||M.text||M.icon)}for(let S in y){let M=y[S];if(!this.opacities[S]){let A=new ul(M,_,!1,!1);A.isHidden()||(this.opacities[S]=A,f=f||M.text.placed||M.icon.placed)}}for(let S in x)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=x[S]);for(let S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c,f,_){_&&(this.lastReplacementSourceUpdateTime=_.updateTime);let y=new Set;for(let x of c){let w=x.getBucket(o);w&&x.latestFeatureIndex&&o.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,y,x,x.collisionBoxArray,f,_,x.tileID,o.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,x.tileID),w.elevationType==="road"&&w.updateRoadElevation(x.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(o,c,f,_,y,x,w,S){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let M=o.layers[0].layout,A=o.layers[0].paint,F=!!o.layers[0].dynamicFilter(),k=new ul(null,0,!1,!1,!0),L=M.get("text-allow-overlap"),j=M.get("icon-allow-overlap"),V=M.get("text-variable-anchor"),W=M.get("text-rotation-alignment")==="map",q=M.get("text-pitch-alignment")==="map",J=A.get("symbol-z-offset"),ie=M.get("symbol-elevation-reference")==="sea",ee=!J.isConstant(),ge=new ul(null,0,L&&(j||!o.hasIconData()||M.get("icon-optional")),j&&(L||!o.hasTextData()||M.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);let de=(ue,se,_e)=>{for(let Se=0;Se<se/4;Se++)ue.opacityVertexArray.emplaceBack(_e)},fe=0;x&&o.updateReplacement(w,x);for(let ue=0;ue<o.symbolInstances.length;ue++){let se=o.symbolInstances.get(ue),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:Se,crossTileID:Ce,numIconVertices:Be,tileAnchorX:Ue,tileAnchorY:Ze}=se,lt=null,ke=this.retainedQueryData[o.bucketInstanceId];ee&&se&&ke&&(lt=f.latestFeatureIndex.loadFeature({featureIndex:se.featureIndex,bucketIndex:ke.bucketIndex,sourceLayerIndex:ke.sourceLayerIndex,layoutVertexArrayOffset:0}));let be=J.evaluate(lt,{}),He=c.has(Ce),Le=this.opacities[Ce];He?Le=k:Le||(Le=ge,this.opacities[Ce]=Le),c.add(Ce);let Je=_e>0||Se>0,yt=Be>0,Mt=this.placedOrientations[Ce],pt=Mt===i.bL.vertical,ct=Mt===i.bL.horizontal||Mt===i.bL.horizontalOnly;!Je&&!yt||Le.isHidden()||fe++;let Vt=!1;if((Je||yt)&&x)for(let Lt of o.activeReplacements){if(i.bZ(Lt,y,i.b_.Symbol,S)||Lt.min.x>Ue||Ue>Lt.max.x||Lt.min.y>Ze||Ze>Lt.max.y)continue;let St=i.b$(Ue,Ze,w.canonical,Lt.footprintTileId.canonical);if(Vt=i.c0(St,Lt.footprint),Vt)break}if(Je){let Lt=Vt?Gu:ss(Le.text);de(o.text,_e,pt?Gu:Lt),de(o.text,Se,ct?Gu:Lt);let St=Le.text.isHidden(),{leftJustifiedTextSymbolIndex:At,centerJustifiedTextSymbolIndex:Jt,rightJustifiedTextSymbolIndex:pn,verticalPlacedTextSymbolIndex:Fn}=se,Jn=o.text.placedSymbolArray,Ut=St||pt?1:0;At>=0&&(Jn.get(At).hidden=Ut),Jt>=0&&(Jn.get(Jt).hidden=Ut),pn>=0&&(Jn.get(pn).hidden=Ut),Fn>=0&&(Jn.get(Fn).hidden=St||ct?1:0);let Xn=this.variableOffsets[Ce];Xn&&this.markUsedJustification(o,Xn.anchor,se,Mt);let hn=this.placedOrientations[Ce];hn&&(this.markUsedJustification(o,"left",se,hn),this.markUsedOrientation(o,hn,se))}if(yt){let Lt=Vt?Gu:ss(Le.icon),{placedIconSymbolIndex:St,verticalPlacedIconSymbolIndex:At}=se,Jt=o.icon.placedSymbolArray,pn=Le.icon.isHidden()?1:0;St>=0&&(de(o.icon,Be,pt?Gu:Lt),Jt.get(St).hidden=pn),At>=0&&(de(o.icon,se.numVerticalIconVertices,ct?Gu:Lt),Jt.get(At).hidden=pn)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Lt=o.collisionArrays[ue];if(Lt){let St=new i.P(0,0),At=!0;if(Lt.textBox||Lt.verticalTextBox){if(V){let pn=this.variableOffsets[Ce];pn?(St=zo(pn.anchor,pn.width,pn.height,pn.textOffset,pn.textScale),W&&St._rotate(q?this.transform.angle:-this.transform.angle)):At=!1}F&&(At=!Le.clipped),Lt.textBox&&zc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!At||pt,be,ie,St.x,St.y),Lt.verticalTextBox&&zc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!At||ct,be,ie,St.x,St.y)}let Jt=At&&!!(!ct&&Lt.verticalIconBox);Lt.iconBox&&zc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,Jt,be,ie,se.hasIconTextFit?St.x:0,se.hasIconTextFit?St.y:0),Lt.verticalIconBox&&zc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,!Jt,be,ie,se.hasIconTextFit?St.x:0,se.hasIconTextFit?St.y:0)}}}if(o.fullyClipped=fe===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ue.invProjMatrix,o.placementViewportMatrix=ue.viewportMatrix,o.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){let f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>o}isStale(){return this.stale}setStale(){this.stale=!0}}function zc(p,o,c,f,_,y,x){p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0)}let ev=Math.pow(2,25),lp=Math.pow(2,24),Yf=Math.pow(2,17),tv=Math.pow(2,16),Kf=Math.pow(2,9),os=Math.pow(2,8),Hl=Math.pow(2,1);function ss(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let o=p.placed?1:0,c=Math.floor(127*p.opacity);return c*ev+o*lp+c*Yf+o*tv+c*Kf+o*os+c*Hl+o}let Gu=0;class Ld{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,f,_,y,x){let w=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(w,_,o[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<w.length;){let S=w[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class so{constructor(o,c,f,_,y,x,w,S,M){this.placement=new GS(o,y,x,w,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,f,_,y){let x=i.o.now(),w=()=>{let S=i.o.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){let S=c[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&S.visibility!=="none"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){let A=S,F=A.layout.get("symbol-z-elevate"),k=A.layout.get("symbol-sort-key").constantOr(1)!==void 0,L=A.layout.get("symbol-z-order"),j=L==="viewport-y"||L==="auto"&&!(L!=="viewport-y"&&k),V=A.layout.get("text-allow-overlap")||A.layout.get("icon-allow-overlap")||A.layout.get("text-ignore-placement")||A.layout.get("icon-ignore-placement"),W=j&&V,q=this._inProgressLayer=this._inProgressLayer||new Ld(A),J=i.B(S.source,S.scope);if(q.continuePlacement(F||W?_[J]:f[J],this.placement,this._showCollisionBoxes,S,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let fa=512/i.al/2;class Gl{constructor(o,c,f){this.tileID=o,this.bucketInstanceId=f,this.index=new i.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=o.canonical.x*i.al,y=o.canonical.y*i.al;for(let x=0;x<c.length;x++){let{key:w,crossTileID:S,tileAnchorX:M,tileAnchorY:A}=c.get(x),F=Math.floor((_+M)*fa),k=Math.floor((y+A)*fa);this.index.add(F,k),this.keys.push(w),this.crossTileIDs.push(S)}this.index.finish()}findMatches(o,c,f){let _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),y=fa/Math.pow(2,c.canonical.z-this.tileID.canonical.z),x=c.canonical.x*i.al,w=c.canonical.y*i.al;for(let S=0;S<o.length;S++){let M=o.get(S);if(M.crossTileID)continue;let{key:A,tileAnchorX:F,tileAnchorY:k}=M,L=Math.floor((x+F)*y),j=Math.floor((w+k)*y),V=this.index.range(L-_,j-_,L+_,j+_).sort((W,q)=>W-q);for(let W of V){let q=this.crossTileIDs[W];if(this.keys[W]===A&&!f.has(q)){f.add(q),M.crossTileID=q;break}}}}}class Jr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let c=Math.round((o-this.lng)/360);if(c!==0)for(let f in this.indexes){let _=this.indexes[f],y={};for(let x in _){let w=_[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),y[w.tileID.key]=w}this.indexes[f]=y}this.lng=o}addBucket(o,c,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let y=0;y<c.symbolInstances.length;y++)c.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let _=this.usedCrossTileIDs[o.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>o.overscaledZ)for(let w in x){let S=x[w];S.tileID.isChildOf(o)&&S.findMatches(c.symbolInstances,o,_)}else{let w=x[o.scaledTo(Number(y)).key];w&&w.findMatches(c.symbolInstances,o,_)}}for(let y=0;y<c.symbolInstances.length;y++){let x=c.symbolInstances.get(y);x.crossTileID||(x.crossTileID=f.generate(),_.add(x.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Gl(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(let f of c.crossTileIDs)this.usedCrossTileIDs[o].delete(f)}removeStaleBuckets(o){let c=!1;for(let f in this.indexes){let _=this.indexes[f];for(let y in _)o[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],c=!0)}return c}}class Ba{constructor(){this.layerIndexes={},this.crossTileIDs=new Jr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,f,_){let y=this.layerIndexes[o.fqid];y===void 0&&(y=this.layerIndexes[o.fqid]=new nv);let x=!1,w={};_.name!=="globe"&&y.handleWrapJump(f);for(let S of c){let M=S.getBucket(o);M&&o.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,M,this.crossTileIDs)&&(x=!0),w[M.bucketInstanceId]=!0)}return y.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(o){let c={};o.forEach(f=>{c[f]=!0});for(let f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}let dl=771;class yn{constructor(o,c,f,_){this.blendFunction=o,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=_}}yn.Replace=[1,0,1,0],yn.disabled=new yn(yn.Replace,i.ao.transparent,[!1,!1,!1,!1]),yn.unblended=new yn(yn.Replace,i.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlended=new yn([1,dl,1,dl],i.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlendedNonPremultiplied=new yn([770,dl,770,dl],i.ao.transparent,[!0,!0,!0,!0]),yn.multiply=new yn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),yn.additive=new yn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Ht{constructor(o,c,f){this.func=o,this.mask=c,this.range=f}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);let Qf=7680;class ln{constructor(o,c,f,_,y,x){this.test=o,this.ref=c,this.mask=f,this.fail=_,this.depthFail=y,this.pass=x}}ln.disabled=new ln({func:519,mask:0},0,0,Qf,Qf,Qf);let Nd=1029,Jf=2305;class an{constructor(o,c,f){this.enable=o,this.mode=c,this.frontFace=f}}function hl(p,o){let c=i.ca(p,3);i.cc(p,o),i.cg(p,3,c)}function iv(p,o){let c=i.c7([]);return i.c8(c,c,-o),i.c9(c,c,-p),c}function em(p,o){let c=[p[0],p[1],0],f=[o[0],o[1],0];if(i.ag(c)>=1e-15){let x=i.aw([],c);i.c5(f,x,i.bJ(f,x)),o[0]=f[0],o[1]=f[1]}let _=i.bI([],o,p);if(i.c6(_)<1e-15)return null;let y=Math.atan2(-_[1],_[0]);return iv(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),y)}an.disabled=new an(!1,Nd,Jf),an.backCCW=new an(!0,Nd,Jf),an.backCW=new an(!0,Nd,2304),an.frontCW=new an(!0,1028,2304),an.frontCCW=new an(!0,1028,Jf);class as{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){let c=o instanceof i.ae?o:new i.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=i.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c,f){if(this.orientation=null,!this.position)return;let _=this.position,y=f||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(o)):0),x=i.ae.fromLngLat(o,y),w=[x.x-_.x,x.y-_.y,x.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=em(w,c)}setPitchBearing(o,c){this.orientation=iv(i.an(o),i.an(-c))}}class tm{constructor(o,c){this._transform=i.bA([]),this.orientation=c,this.position=o}get mercatorPosition(){let o=this.position;return new i.ae(o[0],o[1],o[2])}get position(){let o=i.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&i.cg(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.c7([]),o&&hl(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=iv(o,c),hl(this._transform,this._orientation)}forward(){let o=i.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=i.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=i.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){let f=new Float64Array(16);return i.bl(f,this.getWorldToCamera(o,c)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,c,f){let _=this.position;i.c5(_,_,-o);let y=new Float64Array(16);return i.bq(y,[f,f,f]),i.br(y,y,_),y[10]*=c,y}getWorldToCamera(o,c){let f=new Float64Array(16),_=new Float64Array(4),y=this.position;return i.cb(_,this._orientation),i.c5(y,y,-o),i.cc(f,_),i.br(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(o,c,f,_){let y=new Float64Array(16);return i.cd(y,o,c,f,_),y}getCameraToClipOrthographic(o,c,f,_,y,x){let w=new Float64Array(16);return i.ce(w,o,c,f,_,y,x),w}getDistanceToElevation(o,c=!1){let f=o===0?0:i.cf(o,c?i.a$(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new tm([...this.position],[...this.orientation])}}let mo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class nm{constructor(o=0,c=0,f=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=f,this.right=_}interpolate(o,c,f){return c.top!=null&&o.top!=null&&(this.top=i.ak(o.top,c.top,f)),c.bottom!=null&&o.bottom!=null&&(this.bottom=i.ak(o.bottom,c.bottom,f)),c.left!=null&&o.left!=null&&(this.left=i.ak(o.left,c.left,f)),c.right!=null&&o.right!=null&&(this.right=i.ak(o.right,c.right,f)),this}getCenter(o,c){let f=i.aA((this.left+o-this.right)/2,0,o),_=i.aA((this.top+c-this.bottom)/2,0,c);return new i.P(f,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new nm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Va=15;class rv{constructor(o,c,f,_,y,x,w){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new nm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new tm,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let o=new rv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Va}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,c=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(o||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);let f=this.getProjection(),_=!i.by(c,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});let c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let c=-o*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let c=i.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;let o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),_=0,y=0;for(let x=0;x<c.length;x++){let w=new i.P(c[x][0]*this.width,f+c[x][1]*(this.height-f)),S=o.pointCoordinate(w);if(!S)continue;let M=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);_+=S[3]*M,y+=M}return y===0?NaN:_/y}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){let c=this.elevation,f=o.elevation,_=c!=null!=(f!=null)||c&&f&&c.exaggeration()!==f.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!_}computeZoomRelativeTo(o){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),f;f=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];let _=i.ag(i.av([],this._camera.position,f));return i.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!i.cp(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){let f=[o.position.x,o.position.y,o.position.z];i.cq(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,c=new as;return c.position=new i.ae(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!i.cr(o))return!1;i.cs(o,o);let c=i.ct([],[0,0,-1],o),f=i.ct([],[0,-1,0],o);if(f[2]<0)return!1;let _=em(c,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){let c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=i.aA(o[2],_/f,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,f){this._unmodified=!1,this._edgeInsets.interpolate(o,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){let c=[new i.cu(0,o)];if(this.renderWorldCopies){let f=this.pointCoordinate(new i.P(0,0)),_=this.pointCoordinate(new i.P(this.width,0)),y=this.pointCoordinate(new i.P(this.width,this.height)),x=this.pointCoordinate(new i.P(0,this.height)),w=Math.floor(Math.min(f.x,_.x,y.x,x.x)),S=Math.floor(Math.max(f.x,_.x,y.x,x.x)),M=1;for(let A=w-M;A<=S+M;A++)A!==0&&c.push(new i.cu(A,o))}return c}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,c,f,_){let y=[],x=f!=null,w=!x;if(w&&this.zoom<c||x&&f[0]===0&&f[1]===0)return y;let S=new Set,M=(F,k,L,j,V)=>{let W=i.cY(k,F,L,j,V);S.has(W)||(y.push(new i.aQ(F,k,L,j,V)),S.add(W))};for(let F=0;F<o.length;F++){let k=o[F];if(w&&k.canonical.z!==c||x&&_!==void 0&&_>k.canonical.z)continue;let L=k.canonical,j=k.overscaledZ,V=k.wrap,W=1<<L.z,q=L.x+1<W,J=L.x>0,ie=L.y+1<W,ee=L.y>0,ge=k.wrap-(J?0:1),de=k.wrap+(q?0:1),fe=J?L.x-1:W-1,ue=q?L.x+1:0;if(x)f[0]<0?(M(j,de,L.z,ue,L.y),f[1]<0&&ie&&(M(j,V,L.z,L.x,L.y+1),M(j,de,L.z,ue,L.y+1)),f[1]>0&&ee&&(M(j,V,L.z,L.x,L.y-1),M(j,de,L.z,ue,L.y-1))):f[0]>0?(M(j,ge,L.z,fe,L.y),f[1]<0&&ie&&(M(j,V,L.z,L.x,L.y+1),M(j,ge,L.z,fe,L.y+1)),f[1]>0&&ee&&(M(j,V,L.z,L.x,L.y-1),M(j,ge,L.z,fe,L.y-1))):f[1]<0&&ie?M(j,V,L.z,L.x,L.y+1):ee&&M(j,V,L.z,L.x,L.y-1);else{let se=k.visibleQuadrants;1&se&&(M(j,ge,L.z,fe,L.y),ee&&(M(j,V,L.z,L.x,L.y-1),M(j,ge,L.z,fe,L.y-1))),2&se&&(M(j,de,L.z,ue,L.y),ee&&(M(j,V,L.z,L.x,L.y-1),M(j,de,L.z,ue,L.y-1))),4&se&&(M(j,ge,L.z,fe,L.y),ie&&(M(j,V,L.z,L.x,L.y+1),M(j,ge,L.z,fe,L.y+1))),8&se&&(M(j,de,L.z,ue,L.y),ie&&(M(j,V,L.z,L.x,L.y+1),M(j,de,L.z,ue,L.y+1)))}}let A=[];for(let F of y)y.some(k=>F.isChildOf(k))||A.push(F);if(y=A.filter(F=>!o.some(k=>!!(F.overscaledZ<c&&k.isChildOf(F))||F.equals(k)||F.isChildOf(k))),w){let F=1<<c,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),L=[F*k.x,F*k.y],j=4,V=j*j;y=y.filter(W=>{let q=W.canonical.x+.5-L[0],J=W.canonical.y+.5-L[1];return q*q+J*J<V})}return y}extendTileCoverToNearPlane(o,c,f){let _=[],y=new Set;for(let J of o)y.add(J.key);let x=(J,ie,ee,ge,de)=>{let fe=i.cY(ie,J,ee,ge,de);y.has(fe)||(_.push(new i.aQ(J,ie,ee,ge,de)),y.add(fe))},w=o.reduce((J,ie)=>Math.max(J,ie.overscaledZ),f),S=1<<f,M=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],A=new i.P(0,0),F=new i.P(0,0),k=(J,ie)=>{let ee=Math.floor(J[0]),ge=Math.floor(J[1]),de=(J[0]-ee)*i.al,fe=(J[1]-ge)*i.al,ue=Math.floor(ie[0]),se=Math.floor(ie[1]),_e=(ie[0]-ue)*i.al,Se=(ie[1]-se)*i.al;for(let Ce=-1;Ce<=1;Ce++){let Be=ee+Ce;if(!(Be<0||Be>=S)){A.x=de-Ce*i.al,F.x=_e-(Be-ue)*i.al;for(let Ue=-1;Ue<=1;Ue++){let Ze=ge+Ue;A.y=fe-Ue*i.al,F.y=Se-(Ze-se)*i.al,i.cZ(A,F,M)&&x(w,0,f,Be,Ze)}}}},L=c.points,j=L[i.cv],V=L[i.cw],W=this._projectToGround(j,L[i.cx]),q=this._projectToGround(V,L[i.cy]);return k(j,W),k(V,q),_}_projectToGround(o,c){return i.cz(i.cA(),o,c,o[2]/(o[2]-c[2]))}coveringTiles(o){let c=this.coveringZoomLevel(o),f=c,_=this.elevation&&this.elevation.exaggeration(),y=_&&!o.isTerrainDEM,x=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);let w=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,A=[M*w.x,M*w.y,0],F=this.projection.name==="globe",k=!F,L=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,k),j=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=M*i.cf(1,this.center.lat),W=this._camera.position[2]/i.cf(1,this.center.lat),q=[M*j.x,M*j.y,W*(k?1:V)],J=F||_,ie=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ee=this.isLODDisabled(!0)?c:0,ge;if(this._elevation&&o.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let be=this._elevation.getMinMaxForVisibleTiles();ge=be?be.max:this._centerAltitude}else ge=this._centerAltitude;let de=o.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?i.cC(this):1,ue=be=>{let Le=new i.ae(be.x+25e-6,be.y,be.z),Je=new i.ae(be.x,be.y+25e-6,be.z),yt=be.toLngLat(),Mt=Le.toLngLat(),pt=Je.toLngLat(),ct=this.locationCoordinate(yt),Vt=this.locationCoordinate(Mt),Lt=this.locationCoordinate(pt),St=Math.hypot(Vt.x-ct.x,Vt.y-ct.y),At=Math.hypot(Lt.x-ct.x,Lt.y-ct.y);return Math.sqrt(St*At)*fe/25e-6},se=be=>{let He=ge,Le=de;return{aabb:i.cF(this,M,0,0,0,be,Le,He,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:He,wrap:be,fullyVisible:!1}},_e=[],Se=[],Ce=c,Be=o.reparseOverscaled?f:c,Ue=(W-this._centerAltitude)*V,Ze=be=>{if(!this._elevation||!be.tileID||!x)return;let He=this._elevation.getMinMaxForTile(be.tileID),Le=be.aabb;He?(Le.min[2]=He.min,Le.max[2]=He.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(be.shouldSplit=ke(be),be.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},lt=(be,He)=>{if(.707*He<be)return 1;let Le=He/be;return Le/(1.4144271570014144+(Math.pow(1.1,Le-1.4144271570014144+1)-1)/(1.1-1)-1)},ke=be=>{if(be.zoom<ee)return!0;if(be.zoom===Ce)return!1;if(be.shouldSplit!=null)return be.shouldSplit;let He=be.aabb.distanceX(q),Le=be.aabb.distanceY(q),Je=Ue,yt=1;if(F){Je=be.aabb.distanceZ(q);let At=Math.pow(2,be.zoom),Jt=i.a$((be.y+1)/At),pn=i.a$(be.y/At),Fn=Math.min(Math.max(S,Jt),pn),Jn=i.d1(Fn)/i.d1(S);if(yt=Fn===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jn/this._mercatorScaleRatio),this.zoom<=i.c_&&be.zoom===Ce-1&&Jn>=.9)return!0}else if(y&&(Je=be.aabb.distanceZ(q)*V),this.projection.isReprojectedInTileSpace&&f<=5){let At=Math.pow(2,be.zoom),Jt=ue(new i.ae((be.x+.5)/At,(be.y+.5)/At));yt=Jt>.85?1:Jt}if(!x&&!F){let At=Math.sqrt(He*He+Le*Le+Je*Je),Jt=(1<<Ce-be.zoom)*ie*yt;return Jt*=lt(Math.max(Je,Ue),At),At<Jt}let Mt=Number.MAX_VALUE,pt=0,ct=be.aabb.getCorners(),Vt=[];for(let At of ct){i.av(Vt,At,q),F||(y?Vt[2]*=V:Vt[2]=Ue);let Jt=i.bJ(Vt,this._camera.forward());Jt<Mt&&(Mt=Jt,pt=Math.abs(Vt[2]))}let Lt=(1<<Ce-be.zoom)*ie*yt;if(Lt*=lt(Math.max(pt,Ue),Mt),Mt<Lt)return!0;let St=be.aabb.closestPoint(A);return St[0]===A[0]&&St[1]===A[1]};if(this.renderWorldCopies)for(let be=1;be<=3;be++)_e.push(se(-be)),_e.push(se(be));for(_e.push(se(0));_e.length>0;){let be=_e.pop(),He=be.x,Le=be.y,Je=be.fullyVisible,yt=()=>this.projection.name==="globe"&&(be.y===0||be.y===(1<<be.zoom)-1);if(!Je){let Mt=J?be.aabb.intersects(L):be.aabb.intersectsFlat(L);if(Mt===0&&yt()){let pt=new i.cD(be.zoom,He,Le);Mt=i.cE(this,M,pt,!0).intersects(L)}if(Mt===0)continue;Je=Mt===2}if(be.zoom!==Ce&&ke(be))for(let Mt=0;Mt<4;Mt++){let pt=(He<<1)+Mt%2,ct=(Le<<1)+(Mt>>1),Vt={aabb:x?be.aabb.quadrant(Mt):i.cF(this,M,be.zoom+1,pt,ct,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:pt,y:ct,wrap:be.wrap,fullyVisible:Je,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};y&&!F&&(Vt.tileID=new i.aQ(be.zoom+1===Ce?Be:be.zoom+1,be.wrap,be.zoom+1,pt,ct),Ze(Vt)),_e.push(Vt)}else{let Mt=be.zoom===Ce?Be:be.zoom;if(o.minzoom&&o.minzoom>Mt)continue;let pt=0;if(!Je){let St=J?be.aabb.intersectsPrecise(L):be.aabb.intersectsPreciseFlat(L);if(St===0&&yt()){let At=new i.cD(be.zoom,He,Le);St=i.cE(this,M,At,!0).intersectsPrecise(L)}if(St===0)continue;if(o.calculateQuadrantVisibility)if(L.containsPoint(be.aabb.center))pt=15;else for(let At=0;At<4;At++)be.aabb.quadrant(At).intersects(L)!==0&&(pt|=1<<At)}let ct=A[0]-(.5+He+(be.wrap<<be.zoom))*(1<<c-be.zoom),Vt=A[1]-.5-Le,Lt=be.tileID?be.tileID:new i.aQ(Mt,be.wrap,be.zoom,He,Le);o.calculateQuadrantVisibility&&(Lt.visibleQuadrants=pt),Se.push({tileID:Lt,distanceSq:ct*ct+Vt*Vt})}}if(this.fogCullDistSq){let be=this.fogCullDistSq,He=this.horizonLineFromTop();Se=Se.filter(Le=>{let Je=[0,0,0,1],yt=[i.al,i.al,0,1],Mt=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());i.aC(Je,Je,Mt),i.aC(yt,yt,Mt);let pt=i.cG([],Je,yt),ct=i.cH([],Je,yt),Vt=i.c$(pt,ct);if(Vt===0)return!0;let Lt=!1,St=this._elevation;if(St&&Vt>be&&He!==0){let At=this.calculateProjMatrix(Le.tileID.toUnwrapped()),Jt;o.isTerrainDEM||(Jt=St.getMinMaxForTile(Le.tileID)),Jt||(Jt={min:de,max:ge});let pn=i.cI(this.rotation),Fn=[pn[0]*i.al,pn[1]*i.al,Jt.max];i.af(Fn,Fn,At),Lt=(1-Fn[1])*this.height*.5<He}return Vt<be||Lt})}return Se.sort((be,He)=>be.distanceSq-He.distanceSq).map(be=>be.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){let c=i.aA(o.lat,-i.cJ,i.cJ),f=this.projection.project(o.lng,c);return new i.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let f,_,y=this.centerPoint;if(this.projection.name==="globe"){let w=this.worldSize;f=(c.x-y.x)/w,_=(c.y-y.y)/w}else{let w=this.pointCoordinate(c),S=this.pointCoordinate(y);f=w.x-S.x,_=w.y-S.y}let x=this.locationCoordinate(o);this.setLocation(new i.ae(x.x-f,x.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,c){return this.projection.locationPoint(this,o,c)}locationPoint3D(o,c){return this.projection.locationPoint(this,o,c,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,c){return this.coordinateLocation(this.pointCoordinate3D(o,c))}locationCoordinate(o,c){let f=c?i.cf(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new i.ae(_.x,_.y,f)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){let f=c??this._centerAltitude,_=[o.x,o.y,0,1],y=[o.x,o.y,1,1];i.aC(_,_,this.pixelMatrixInverse),i.aC(y,y,this.pixelMatrixInverse);let x=y[3];i.cK(_,_,1/_[3]),i.cK(y,y,1/x);let w=_[2],S=y[2];return{p0:_,p1:y,t:w===S?0:(f-w)/(S-w)}}screenPointToMercatorRay(o){let c=[o.x,o.y,0,1],f=[o.x,o.y,1,1];return i.aC(c,c,this.pixelMatrixInverse),i.aC(f,f,this.pixelMatrixInverse),i.cK(c,c,1/c[3]),i.cK(f,f,1/f[3]),c[2]=i.cf(c[2],this._center.lat)*this.worldSize,f[2]=i.cf(f[2],this._center.lat)*this.worldSize,i.cK(c,c,1/this.worldSize),i.cK(f,f,1/this.worldSize),new i.ax([c[0],c[1],c[2]],i.aw([],i.av([],f,c)))}rayIntersectionCoordinate(o){let{p0:c,p1:f,t:_}=o,y=i.cf(c[2],this._center.lat),x=i.cf(f[2],this._center.lat);return new i.ae(i.ak(c[0],f[0],_)/this.worldSize,i.ak(c[1],f[1],_)/this.worldSize,i.ak(y,x,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o,c){if(!this.elevation)return this.pointCoordinate(o,c);let f=this.projection.pointCoordinate3D(this,o.x,o.y);if(f)return new i.ae(f[0],f[1],f[2]);let _=0,y=this.horizonLineFromTop();if(o.y>y)return this.pointCoordinate(o,c);let x=.02*y,w=o.clone();for(let S=0;S<10&&y-_>x;S++){w.y=i.ak(_,y,.66);let M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(y=w.y,f=M):_=w.y}return f?new i.ae(f[0],f[1],f[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(o);let c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){let f=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,f+o.toAltitude(),1];return i.aC(_,_,this.pixelMatrix),_[3]>0?new i.P(_[0]/_[3],_[1]/_[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new i.P(c,o)),x=this.pointLocation3D(new i.P(_,o)),w=this.pointLocation3D(new i.P(_,f)),S=this.pointLocation3D(new i.P(c,f)),M=Math.min(y.lng,x.lng,w.lng,S.lng),A=Math.max(y.lng,x.lng,w.lng,S.lng),F=Math.min(y.lat,x.lat,w.lat,S.lat),k=Math.max(y.lat,x.lat,w.lat,S.lat),L=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,V=(W,q,J,ie,ee)=>{let ge=(W+J)/2,de=(q+ie)/2,fe=new i.P(ge,de),{lng:ue,lat:se}=this.pointLocation3D(fe),_e=Math.max(0,M-ue,F-se,ue-A,se-k);M=Math.min(M,ue),A=Math.max(A,ue),F=Math.min(F,se),k=Math.max(k,se),(ee<j||_e>L)&&(V(W,q,ge,de,ee+1),V(ge,de,J,ie,ee+1))};if(V(c,o,_,o,1),V(_,o,_,f,1),V(_,f,c,f,1),V(c,f,c,o,1),this.projection.name==="globe"){let[W,q]=i.cM(this);W?(k=90,A=180,M=-180):q&&(F=-90,A=180,M=-180)}return new i.aI(new i.aT(M,F),new i.aT(A,k))}_getBoundsRectangular(o,c){let{top:f,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=new i.P(_,f),S=new i.P(x,f),M=new i.P(x,y),A=new i.P(_,y),F=this.pointCoordinate(w,o),k=this.pointCoordinate(S,o),L=this.pointCoordinate(M,c),j=this.pointCoordinate(A,c),V=(W,q)=>(q.y-W.y)/(q.x-W.x);return F.y>1&&k.y>=0?F=new i.ae((1-j.y)/V(j,F)+j.x,1):F.y<0&&k.y<=1&&(F=new i.ae(-j.y/V(j,F)+j.x,0)),k.y>1&&F.y>=0?k=new i.ae((1-L.y)/V(L,k)+L.x,1):k.y<0&&F.y<=1&&(k=new i.ae(-L.y/V(L,k)+L.x,0)),new i.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(L))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=o.visibleDemTiles.reduce((f,_)=>{if(_.dem){let y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){let c=o.key,f=this._distanceTileDataCache;if(f[c])return f[c];let _=o.canonical,y=1/this.height,x=this.cameraWorldSize,w=x/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*o.wrap)*w,M=_.y*w,A=this.point;A.x*=x/this.worldSize,A.y*=x/this.worldSize;let F=this.angle,k=Math.sin(-F),L=-Math.cos(-F);return f[c]={bearing:[k,L],center:[(A.x-S)*y,(A.y-M)*y],scale:w/i.al*y},f[c]}calculateFogTileMatrix(o){let c=o.key,f=this._fogTileMatrixCache;if(f[c])return f[c];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.aB(_,this.worldToFogMatrix,_),f[c]=new Float32Array(_),f[c]}calculateProjMatrix(o,c=!1,f=!1){let _=o.key,y;if(y=f?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];let x=this.calculatePosMatrix(o,this.worldSize),w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.aB(x,w,x),y[_]=new Float32Array(x),y[_]}calculatePixelsToTileUnitsMatrix(o){let c=o.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];let _=i.cN(o,this);return f[c]=_,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,c=i.bq([],[o,o,o]);return i.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let c=i.cf(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=this._camera.forward(),y=i.cf(1,this._center.lat);f[2]/=y,_[2]/=y,i.aw(_,_);let x=o.raycast(f,_,o.exaggeration());if(x){let w=i.bH([],f,_,x),S=new i.ae(w[0],w[1],i.cf(w[2],i.a$(w[1]))),M=(S.z+i.ag([S.x-f[0],S.y-f[1],S.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let c=this._elevation,f=i.cf(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),y=c.getAtPointOrZero(new i.ae(..._)),x=this.pixelsPerMeter/this.worldSize*y,w=this._minimumHeightOverTerrain(),S=_[2]-x;if(S<=w)if(S<0||o){let M=this.locationCoordinate(this._center,this._centerAltitude),A=[_[0],_[1],M.z-_[2]],F=i.ag(A);A[2]-=(w-S)/this._pixelsPerMercatorPixel;let k=i.ag(A);if(k===0)return;i.c5(A,A,F/k*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let k=this.center;return k.lat=i.aA(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(k.lng=i.aA(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}let c=this._unmodified,{x:f,y:_}=this.point,y=0,x=f,w=_,S=this.width/2,M=this.height/2,A=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(_-M<A&&(w=A+M),_+M>F&&(w=F-M),F-A<this.height&&(y=Math.max(y,this.height/(F-A)),w=(F+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let k=this.worldMinX*this.scale,L=this.worldMaxX*this.scale,j=this.worldSize/2-(k+L)/2;x=(f+j+this.worldSize)%this.worldSize-j,x-S<k&&(x=k+S),x+S>L&&(x=L-S),L-k<this.width&&(y=Math.max(y,this.width/(L-k)),x=(L+k)/2)}x===f&&w===_||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(x,w))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,c=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));let _=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?f:1,x=this._camera.getWorldToCamera(this.worldSize,y),w,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-o.x/this.width,S[9]=2*o.y/this.height,this.isOrthographic){let se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),_e=se*this.aspect,Se=-_e,Ce=-se;_e-=o.x,Se-=o.x,se+=o.y,Ce+=o.y,w=this._camera.getCameraToClipOrthographic(Se,_e,Ce,se,this._nearZ,this._farZ),((Be,Ue,Ze,lt)=>{for(let ke=0;ke<16;ke++)Be[ke]=i.ak(Ue[ke],Ze[ke],lt)})(w,w,S,i.d0(this.pitch>=Va?1:this.pitch/Va))}else w=S;let M=i.cP([],S,x),A=i.cP([],w,x);if(this.projection.isReprojectedInTileSpace){let se=this.locationCoordinate(this.center),_e=i.bA([]);i.br(_e,_e,[se.x*this.worldSize,se.y*this.worldSize,0]),i.aB(_e,_e,i.cQ(this)),i.br(_e,_e,[-se.x*this.worldSize,-se.y*this.worldSize,0]),i.aB(A,A,_e),i.aB(M,M,_e),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),c){let se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);se[8]=2*-o.x/this.width,se[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cP([],se,x)}else this.expandedFarZProjMatrix=this.projMatrix;let F=i.bl([],w);this.frustumCorners=i.cT.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let k=new Float32Array(16);i.bA(k),i.cS(k,k,[1,-1,1]),i.cU(k,k,this._pitch),i.bB(k,k,this.angle);let L=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(L);let j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-o.x/this.width,L[9]=2*(o.y+j)/this.height,this.skyboxMatrix=i.aB(k,L,k);let V=this.point,W=V.x,q=V.y,J=this.width%2/2,ie=this.height%2/2,ee=Math.cos(this.angle),ge=Math.sin(this.angle),de=W-Math.round(W)+ee*J+ge*ie,fe=q-Math.round(q)+ee*ie+ge*J,ue=new Float64Array(A);if(i.br(ue,ue,[de>.5?de-1:de,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ue,A=i.bC(),i.cS(A,A,[this.width/2,-this.height/2,1]),i.br(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=i.bC(),i.cS(A,A,[1,-1,1]),i.br(A,A,[-1,-1,0]),i.cS(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},A=i.bl(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);let se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(se,se,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[o,o,c];i.c5(y,y,_),i.c5(f,f,-1),i.cW(f,f,y);let x=i.bC();i.br(x,x,f),i.cS(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){let c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,o/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=o[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((c-f)/_,1)),this._camera.position=i.bH([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),w=Math.max((o[2]-y)/Math.cos(f),x),S=this._zoomFromMercatorZ(w);i.bH(o,o,c,w),this._pitch=i.aA(f,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(_,-Math.PI,Math.PI),this._setZoom(i.aA(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,f=i.cL,_=0,y=1/0;for(;f-c>1e-6&&f>c;){let x=c+.5*(f-c),w=this.tileSize*Math.pow(2,x),S=this.getCameraToCenterDistance(this.projection,x,w),M=this.scaleZoom(S/(Math.max(0,o)*this.tileSize)),A=Math.abs(x-M);A<y&&(y=A,_=x),x<M?c=x:f=x}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){let f=Math.min(o.x,c.x),_=Math.max(o.x,c.x),y=Math.min(o.y,c.y),x=Math.max(o.y,c.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let w=[new i.P(f,y),new i.P(_,x),new i.P(f,x),new i.P(_,y)],S=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let A of w){let F=this.pointRayIntersection(A);if(F.t<0)return!0;let k=this.rayIntersectionCoordinate(F);if(k.x<S||k.y<0||k.x>M||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,c){let f=i.ag(i.av([],this._camera.position,o)),_=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let o=(function([c,f,_],y){let x=[c,f,_,1];i.aC(x,x,y);let w=x[3]=Math.max(x[3],1e-6);return x[0]/=w,x[1]/=w,x[2]/=w,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,c=this.zoom,f=this.worldSize){let _=i.cO(o,c,this.width,this.height,1024),y=o.pixelSpaceConversion(this.center.lat,f,_),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=i.ak(1,x,i.d0(this.pitch>=Va?1:this.pitch/Va))),x}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(o,o,this.globeMatrix),o}getFrustum(o){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Bc=(p,o)=>{if(o>0&&p.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=p.transform,f=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),_=c.isLODDisabled(!1)?i.ah(60,45,c.pitch):i.ah(30,15,c.pitch),y=c._farZ-c._nearZ,x=o*c.height,w=((1-(S=_))*c.cameraToCenterDistance+S*(c._farZ+x))*f;var S;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(w-c._nearZ)/y,(w-x-c._nearZ)/y]}}},ma=2048;class cp{constructor(o,c){this.aabb=o,this.lastCascade=c}}class qS{add(o,c){let f=this.receivers[o.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],c.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],c.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],c.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],c.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],c.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],c.max[2])):this.receivers[o.key]=new cp(c,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,c,f){let _=i.d9.fromPoints(o.points),y=0;for(let x in this.receivers){let w=this.receivers[x];if(!w||!_.intersectsAabb(w.aabb))continue;w.aabb.min=_.closestPoint(w.aabb.min),w.aabb.max=_.closestPoint(w.aabb.max);let S=w.aabb.getCorners();for(let M=0;M<f.length;M++){let A=!0;for(let F of S){let k=[F[0]*c,F[1]*c,F[2]];if(i.af(k,k,f[M].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){A=!1;break}}if(w.lastCascade=M,y=Math.max(y,M),A)break}}return y+1}}class zd{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new qS,this._depthMode=new Ht(o.context.gl.LEQUAL,Ht.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,c){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let _=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((j,V)=>{let W=f.style._mergedLayers[V];return j+(W.hasShadowPass()&&!W.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=f.context,x=ma,w=ma;if(this._cascades.length===0||ma!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<2;++j){let V=f._shadowMapDebug,W=y.gl,q=y.createFramebuffer(x,w,V?1:0,"texture"),J=new i.T(y,{width:x,height:w,data:null},W.DEPTH_COMPONENT16);if(q.depthAttachment.set(J.texture),V){let ie=new i.T(y,{width:x,height:w,data:null},W.RGBA8);q.colorAttachment0.set(ie.texture)}this._cascades.push({framebuffer:q,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=dp(c);let S=0;if(o.elevation){let j=o.elevation,V=[1e4,-1e4];j.visibleDemTiles.filter(W=>W.dem).forEach(W=>{let q=W.dem.tree;V[0]=Math.min(V[0],q.minimums[0]),V[1]=Math.max(V[1],q.maximums[0])}),V[0]!==1e4&&(S=(V[1]-V[0])*j.exaggeration())}let M=1.5*o.cameraToCenterDistance,A=3*M,F=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){let V=this._cascades[j],W=o.height/50,q=1;j===0?q=M:(W=M,q=A);let[J,ie]=Vc(o,this.shadowDirection,W,q,ma,S);V.scale=o.scale,V.matrix=J,V.boundingSphereRadius=ie,i.bl(F,V.matrix),V.frustum=i.cB.fromInvProjectionMatrix(F,1,0,!0),V.far=q}let k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=ma,this._uniformValues.u_shadowmap_0=mo.ShadowMap0,this._uniformValues.u_shadowmap_1=mo.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let L=f.transform.elevation;for(let j of this._groundShadowTiles){let V={min:0,max:0};if(L){let W=L.getMinMaxForTile(j);W&&(V=W)}this.addShadowReceiver(j.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,c){if(!this.enabled)return;let f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,ma,ma]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:i.ao.white,depth:1});for(let x of o.order){let w=o._mergedLayers[x];if(!w.hasShadowPass()||w.isHidden(f.transform.zoom))continue;let S=o.getLayerSourceCache(w),M=S?c[S.id]:void 0;(w.type==="model"||M&&M.length)&&f.renderLayer(f,S,w,M)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,c=o.style,f=o.context,_=f.gl,y=c.directionalLight,x=c.ambientLight;if(!y||!x)return;let w=[],S=Bc(o,o.longestCutoffRange);S.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");let M=ql(c,y,x),A=new Ht(_.LEQUAL,Ht.ReadOnly,o.depthRangeFor3D),F=new ln({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(let k of this._groundShadowTiles){let L=k.toUnwrapped(),j=o.isTileAffectedByFog(k),V=o.getOrCreateProgram("groundShadow",{defines:w,overrideFog:j});this.setupShadows(L,V),o.uploadCommonUniforms(f,V,L,null,S);let W={u_matrix:o.transform.calculateProjMatrix(L),u_ground_shadow_factor:M};V.draw(o,_.TRIANGLES,A,F,yn.multiply,an.disabled,W,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yn.unblended:yn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let c=this.painter.transform,f=c.calculatePosMatrix(o,c.worldSize);return i.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(o){let c=i.bz(o);return i.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,o),c}setupShadows(o,c,f){if(!this.enabled)return;let _=this.painter.transform,y=this.painter.context,x=y.gl,w=this._uniformValues,S=new Float64Array(16),M=_.calculatePosMatrix(o,_.worldSize);for(let A=0;A<this._cascades.length;A++)i.aB(S,this._cascades[A].matrix,M),w[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),y.activeTexture.set(x.TEXTURE0+mo.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){let A=i.d7(o.canonical),F=2/_.tileSize*i.al/ma,k=F*this._cascades[0].boundingSphereRadius,L=F*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(f==="vector-tile"?1:3)*(function(V,W,q,J,ie){let ee=i.aA((V-22)/-22,0,1);return .125*(1-ee)+4*ee})(_.zoom);w.u_shadow_normal_offset=[A,k*j,L*j],w.u_shadow_bias=[1e-4,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,w)}setupShadowsFromMatrix(o,c,f=!1){if(!this.enabled)return;let _=this.painter.context,y=_.gl,x=this._uniformValues,w=new Float64Array(16);for(let S=0;S<2;S++)i.aB(w,this._cascades[S].matrix,o),x[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),_.activeTexture.set(y.TEXTURE0+mo.ShadowMap0+S),this._cascades[S].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);this.useNormalOffset=f,f?(x.u_shadow_normal_offset=[1,3,3],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(_,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,c,f,_){if(_[2]>=0)return{};let y=(function(S,M,A){let F=A/(1<<S.canonical.z);return new i.d9([S.canonical.x*F+S.wrap*A,S.canonical.y*F+S.wrap*A,0],[(S.canonical.x+1)*F+S.wrap*A,(S.canonical.y+1)*F+S.wrap*A,M])})(o,c,f).getCorners(),x=c/-_[2];_[0]<0?(i.d8(y[0],y[0],[_[0]*x,0,0]),i.d8(y[3],y[3],[_[0]*x,0,0])):_[0]>0&&(i.d8(y[1],y[1],[_[0]*x,0,0]),i.d8(y[2],y[2],[_[0]*x,0,0])),_[1]<0?(i.d8(y[0],y[0],[0,_[1]*x,0]),i.d8(y[1],y[1],[0,_[1]*x,0])):_[1]>0&&(i.d8(y[2],y[2],[0,_[1]*x,0]),i.d8(y[3],y[3],[0,_[1]*x,0]));let w={};return w.vertices=y,w.planes=[up(y[1],y[0],y[4]),up(y[2],y[1],y[5]),up(y[3],y[2],y[6]),up(y[0],y[3],y[7])],w}addShadowReceiver(o,c,f){this._receivers.add(o,i.d9.fromTileIdAndHeight(o,c,f))}getMaxCascadeForTile(o){let c=this._receivers.get(o);return c&&c.lastCascade?c.lastCascade:0}}function up(p,o,c){let f=i.av([],c,o),_=i.av([],p,o),y=i.bI([],f,_),x=i.ag(y);return x===0?[0,0,1,0]:(i.c5(y,y,1/x),[y[0],y[1],y[2],-i.bJ(y,o)])}function dp(p){let o=p.properties.get("direction"),c=i.d4(o.x,o.y,o.z);c[2]=i.aA(c[2],0,75);let f=i.d6([c[0],c[1],c[2]]);return i.d5(f.x,f.y,f.z)}function ql(p,o,c){let f=o.properties.get("color-use-theme")==="none",_=o.properties.get("color"),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=[x.x,x.y,x.z],S=c.properties.get("color-use-theme")==="none",M=c.properties.get("color"),A=c.properties.get("intensity"),F=Math.max(i.bJ([0,0,1],w),0),k=[0,0,0];i.c5(k,M.toPremultipliedRenderColor(S?null:p.getLut(o.scope)).toArray01Linear().slice(0,3),A);let L=[0,0,0];return i.c5(L,_.toPremultipliedRenderColor(f?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),F*y),i.db([k[0]>0?k[0]/(k[0]+L[0]):0,k[1]>0?k[1]/(k[1]+L[1]):0,k[2]>0?k[2]/(k[2]+L[2]):0])}function Vc(p,o,c,f,_,y){let x=p.zoom,w=p.scale,S=p.worldSize,M=1/S,A=p.aspect,F=Math.sqrt(1+A*A)*Math.tan(.5*p.fovX),k=F*F,L=f-c,j=f+c,V,W;k>L/j?(V=f,W=f*F):(V=.5*j*(1+k),W=.5*Math.sqrt(L*L+2*(f*f+c*c)*k+j*j*k*k));let q=p.projection.pixelsPerMeter(p.center.lat,S),J=p._camera.getCameraToWorldMercator(),ie=[0,0,-V*M];i.af(ie,ie,J);let ee=W*M,ge=p._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let Je=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?q:1),yt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,f);yt[8]=2*-p.centerOffset.x/p.width,yt[9]=2*p.centerOffset.y/p.height;let Mt=new Float64Array(16);i.cP(Mt,yt,Je);let pt=new Float64Array(16);i.bl(pt,Mt);let ct=i.cB.fromInvProjectionMatrix(pt,S,x,!0);for(let Vt of ct.points){let Lt=((de=Vt)[0]/=w,de[1]/=w,de[2]=i.cf(de[2],p._center.lat),de);ee=Math.max(ee,i.c6(i.da([],ie,Lt)))}}var de;ee*=_/(_-1);let fe=Math.acos(o[2]),ue=Math.atan2(-o[0],-o[1]),se=new tm;se.position=ie,se.setPitchBearing(fe,ue);let _e=se.getWorldToCamera(S,q),Se=ee*S,Ce=Math.min(p._mercatorZfromZoom(17)*S*-2,-2*Se),Be=se.getCameraToClipOrthographic(-Se,Se,-Se,Se,Ce,(Se+y*q)/o[2]),Ue=new Float64Array(16);i.aB(Ue,Be,_e);let Ze=i.d5(Math.floor(1e6*ie[0])/1e6*S,Math.floor(1e6*ie[1])/1e6*S,0),lt=.5*_,ke=[0,0,0];i.af(ke,Ze,Ue),i.c5(ke,ke,lt);let be=[Math.floor(ke[0]),Math.floor(ke[1]),Math.floor(ke[2])],He=[0,0,0];i.av(He,ke,be),i.c5(He,He,-1/lt);let Le=new Float64Array(16);return i.bA(Le),i.br(Le,Le,He),i.aB(Ue,Le,Ue),[Ue,Se]}class WS extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,c){return i.dc(this.requestManager.transformRequest(c,i.R.Model).url).then(f=>{if(!f)return;let _=i.dd(f),y=new i.de(o,c,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${o} from ${c}: ${f.message}`)))})}load(o,c,f={forceReload:!1}){this.models[c]||(this.models[c]={});let _=Object.keys(o),y=[],x=[];for(let w of _){let S=o[w];this.hasURLBeenRequested(S)&&!f.forceReload||(this.modelByURL[S]={modelId:w,scope:c},y.push(this.loadModel(w,S)),x.push(w)),this.models[c][w]||(this.models[c][w]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+x.length,Promise.allSettled(y).then(w=>{for(let S=0;S<w.length;S++){let{status:M}=w[S];if(M==="rejected")continue;let{value:A}=w[S];this.models[c][x[S]]||(this.models[c][x[S]]={model:null,numReferences:1}),this.models[c][x[S]].model=A}this.numModelsLoading[c]-=x.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(w=>{this.fire(new i.y(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,c,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(o,c):this.getModelByURL(this.modelUris[c][o]))}getModel(o,c){return this.models[c]||(this.models[c]={}),this.models[c][o]?this.models[c][o].model:void 0}getModelByURL(o){if(!o)return null;let c=this.modelByURL[o];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(o,c){return this.models[c]&&this.models[c][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,c,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});let _=this.requestManager.normalizeModelURL(c);if((this.hasModel(o,f,{exactIdMatch:!0})||this.hasModelBeenAdded(o,f))&&this.modelUris[f][o]===_)this.models[f][o].numReferences++;else if(this.hasURLBeenRequested(_)){let{scope:y,modelId:x}=this.modelByURL[_];this.models[y][x].numReferences++}else this.modelUris[f][o]=_,this.load({[o]:this.modelUris[f][o]},f)}addModelURLs(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f=this.modelUris[c];for(let _ in o)f[_]=this.requestManager.normalizeModelURL(o[_])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f={};for(let _ of o)this.hasModel(_,c,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[c][_].numReferences++:this.modelUris[c][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[c][_]:!this.hasURLBeenRequested(_)&&i.df(_,!1)&&(this.modelUris[c][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[c][_]);this.load(f,c)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,c,f=!1,_=!1){if(this.models[c]&&this.models[c][o]&&(this.models[c][o].numReferences--,this.models[c][o].numReferences===0||_)){let y=this.modelUris[c][o];f||delete this.modelUris[c][o],delete this.modelByURL[y];let x=this.models[c][o].model;if(!x)return;delete this.models[c][o],x.destroy()}}destroy(){for(let o of Object.keys(this.models))for(let c of Object.keys(this.models[o])){let f=this.models[o][c].model;delete this.models[o][c],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,c){this.models[c]||(this.models[c]={});for(let f in this.models[c])this.models[c][f].model&&this.models[c][f].model.upload(o.context)}}let ov=i.a6.colorTheme,ZS=new i.a9({data:new i.aa(ov.data)});function Gx(p){if(!p.metadata||!p.metadata.content_area)return;let o=i.o.devicePixelRatio,{left:c,top:f,width:_,height:y}=p.metadata.content_area,x=c*o,w=f*o;return[x,w,x+_*o,w+y*o]}function qx(p){if(p)return p.map(([o,c])=>[o*i.o.devicePixelRatio,c*i.o.devicePixelRatio])}class sv{constructor(o,c,f){this.id=o,this.scope=c,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let o=new Map;if(!this.sourceCache.loaded())return o;let c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return o;let f=this.sourceCache.getSource();if(!(f instanceof Xo))return o;let _=c.map(x=>this.sourceCache.getTile(x)),y=f.getImages(_,Array.from(this.pendingRequests));for(let[x,w]of y)o.set(i.I.from({name:x,iconsetId:this.id}),w),this.pendingRequests.delete(x);for(let x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),o}}let Uc=(p,o)=>oe(p,o&&o.filter(c=>c.identifier!=="source.canvas")),Wx=i.aH(qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Zx=i.aH(qn,["setCenter","setZoom","setBearing","setPitch"]),im=new Set(["background","sky","slot","custom"]),jc={version:8,layers:[],sources:{}},hp={duration:300,delay:0};class ga extends i.E{constructor(o,c={}){super(),this.map=o,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},hp),this._buildingIndex=new HS(this),this.crossTileSymbolIndex=new Ba,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new kr,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Pd(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.di(o._requestManager,c.localFontFamily?i.dj.all:c.localIdeographFontFamily?i.dj.ideographs:i.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new WS(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());let f=this;this._rtlTextPluginCallback=ga.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,x)=>{if(i.dl(y),x&&x.every(w=>w))for(let w in f._sourceCaches){let S=f._sourceCaches[w],M=S.getSource().type;M!=="vector"&&M!=="geojson"||S.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let w=this._layers[x];w.source===y.id&&this._validateLayer(w)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.h(o))return o;let c=i.dm(o);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.dn(JSON.stringify(o))}`}_diffStyle(o,c,f){this.globalId=this._getGlobalId(o);let _=(y,x)=>{try{x(null,this.setState(y,f))}catch(w){x(w,!1)}};if(typeof o=="string"){let y=this.map._requestManager.normalizeStyleURL(o),x=this.map._requestManager.transformRequest(y,i.R.Style);i.m(x,(w,S)=>{w?this.fire(new i.y(w)):S&&_(S,c)})}else typeof o=="object"&&_(o,c)}loadURL(o,c={}){this.fire(new i.z("dataloading",{dataType:"style"}));let f=typeof c.validate=="boolean"?c.validate:!i.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,c.accessToken),this.resolvedImports.add(o);let _=this.importsCache.get(o);if(_)return this._load(_,f);let y=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.m(y,(x,w)=>{if(this._request=null,x)this.fire(new i.y(x));else if(w)return this.importsCache.set(o,w),this._load(w,f)})}loadJSON(o,c={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.o.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(jc,!1)}_loadImports(o,c,f){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let y of o){let x=this._createFragmentStyle(y),w=new Promise(A=>{x.once("style.import.load",A),x.once("error",A)}).then(()=>this.mergeAll());if(_.push(w),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let S=y.data||this.importsCache.get(y.url);S?(x.loadJSON(S,{validate:c}),this._isInternalStyle(S)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:c}):x.loadEmpty();let M={style:x,id:y.id,config:y.config};if(f){let A=this.fragments.findIndex(({id:F})=>F===f);this.fragments=this.fragments.slice(0,A).concat(M).concat(this.fragments.slice(A))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(o=this,c=new Set){for(let f of o.fragments)f.style.globalId&&c.add(f.style.globalId),this.getImportGlobalIds(f.style,c);return[...c.values()]}_createFragmentStyle(o){let c=this.scope?i.B(o.id,this.scope):o.id,f,_=this._initialConfig&&this._initialConfig[c];(o.config||_)&&(f=Object.assign({},o.config,_));let y=new ga(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,c){if(this._isInternalStyle(o)){let y=Object.assign({},jc,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(y,c)}if(this.updateConfig(this._config,o.schema),c&&Uc(this,Fa(o)))return;this._loaded=!0,this.stylesheet=i.dp(o);let f=()=>{for(let S in o.sources)this.addSource(S,o.sources[S],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(let S in o.iconsets)this.addIconset(S,o.iconsets[S]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);let y=ep(this.stylesheet.layers);if(this._order=y.map(S=>S.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let S=this.stylesheet.lights[0];this.light=new Ee(S.properties,S.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ee(this.stylesheet.light)),this._layers={};for(let S of y){let M=i.du(S,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;let A=this.getOwnLayerSourceCache(M),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&M.canCastShadows()&&F&&(A.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));let w=this.isRootStyle();o.imports?this._loadImports(o.imports,c).then(()=>{this._reloadImports(),this.fire(new i.z(w?"style.load":"style.import.load"))}).catch(S=>{this.fire(new i.y(new Error("Failed to load imports",S))),this.fire(new i.z(w?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(w?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){let y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{f()}).catch(x=>{i.w(`Couldn't load color theme from the stylesheet: ${x}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,c,f,_,y,x,w,S,M,A,F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(k.light!=null&&(o=k.light),k.stylesheet.lights)for(let L of k.stylesheet.lights)L.type==="ambient"&&k.ambientLight!=null&&(c=k.ambientLight),L.type==="directional"&&k.directionalLight!=null&&(f=k.directionalLight);_=this._prioritizeTerrain(_,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&k.fog!=null&&(y=k.fog),k.stylesheet.snow&&k.snow!=null&&(x=k.snow),k.stylesheet.rain&&k.rain!=null&&(w=k.rain),k.stylesheet.camera!=null&&(A=k.stylesheet.camera),k.stylesheet.projection!=null&&(S=k.stylesheet.projection),k.stylesheet.transition!=null&&(M=k.stylesheet.transition),F[k.scope]=k._styleColorTheme}}),this.light=o,this.ambientLight=c,this.directionalLight=f,this.fog=y,this.snow=x,this.rain=w,this._styleColorThemeForScope=F,_===null?delete this.terrain:this.terrain=_,this.camera=A||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=Object.assign({},hp,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){let c=f=>{for(let _ of f.fragments)c(_.style);o(f)};c(this)}_prioritizeTerrain(o,c,f){let _=o&&o.drapeRenderMode===0;return f===null?c&&c.drapeRenderMode===0?c:_?o:null:c!=null&&(!o||_||c&&c.drapeRenderMode===1)?c:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(o=c.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},c={},f={};this.forEachFragmentStyle(_=>{for(let y in _._sourceCaches){let x=i.B(y,_.scope);o[x]=_._sourceCaches[y]}for(let y in _._otherSourceCaches){let x=i.B(y,_.scope);c[x]=_._otherSourceCaches[y]}for(let y in _._symbolSourceCaches){let x=i.B(y,_.scope);f[x]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(let c of Object.values(o.stylesheet.indoor)){let f=c,_=i.B(f.sourceId,o.scope);this._mergedIndoor[_]=new Set(f.sourceLayers||[])}})}mergeLayers(){let o={},c=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(let w of x._order){let S=x._layers[w];if(S.type==="slot"){let M=i.dq(w);if(o[M])continue;o[M]=[]}S.slot&&o[S.slot]?o[S.slot].push(S):c.push(S)}}),this._mergedOrder=[];let _=-1,y=(x=[])=>{for(let w of x)if(w.type==="slot"){let S=i.dq(w.id);o[S]&&y(o[S]),this._mergedSlots.push(S)}else{let S=i.B(w.id,w.scope);this._mergedOrder.push(S),f[S]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(c),this._has3DLayers){let x={};for(let w=0;w<this._mergedOrder.length;++w){let S=this._mergedOrder[w];x[S]=w===_?1:w<_?f[S].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((w,S)=>x[w]-x[S])}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?(function(c,f,_,y){let x=Object.assign({},f);for(let S of Object.keys(ov))x[S]===void 0&&(x[S]=ov[S].default);let w=new i.a8(ZS,c,new Map(_));return w.setTransitionOrValue(x,_),w.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))})(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{let y="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let x=o;x.startsWith(y)||(x=y+x);let w=i.I.from("mapbox-reserved-lut"),S=new Image;S.src=x,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},S.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void f();this._styleColorTheme.lutLoading=!1;let{width:M,height:A,data:F}=i.o.getImageData(S);if(A>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==A*A)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new i.q({width:M,height:A},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});let k=this.imageManager.getImage(w,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:o},f()):_(new Error("Missing LUT image."))}})}getLut(o){let c=this._styleColorThemeForScope[o];return c?c.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=(function(c,f,_){let y,x,w,S=i.o.devicePixelRatio>1?"@2x":"",M=i.m(f.transformRequest(f.normalizeSpriteURL(c,S,".json"),i.R.SpriteJSON),(k,L)=>{M=null,w||(w=k,y=L,F())}),A=i.n(f.transformRequest(f.normalizeSpriteURL(c,S,".png"),i.R.SpriteImage),(k,L)=>{A=null,w||(w=k,x=L,F())});function F(){if(w)_(w);else if(y&&x){let k=i.o.getImageData(x),L={};for(let j in y){let{width:V,height:W,x:q,y:J,sdf:ie,pixelRatio:ee,stretchX:ge,stretchY:de,content:fe}=y[j],ue=new i.q({width:V,height:W});i.q.copy(k,ue,{x:q,y:J},{x:0,y:0},{width:V,height:W},null),L[j]={data:ue,pixelRatio:ee!==void 0?ee:1,sdf:ie!==void 0&&ie,stretchX:ge,stretchY:de,content:fe,usvg:!1,version:0}}_(null,L)}}return{cancel(){M&&(M.cancel(),M=null),A&&(A.cancel(),A=null)}}})(o,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new i.y(c));else if(f){let _=new Map;for(let y in f)_.set(i.I.from(y),f[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(o,c){if(c.type==="sprite")return void this._loadSprite(c.url);let f=this.getOwnSourceCache(c.source);if(!f)return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));let _=f.getSource();if(_.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;let y=new sv(o,this.scope,f);this.imageManager.addImageProvider(y,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);let c=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(y,x)=>{if(this._spriteRequest=null,y)c?this._loadSprite(o):this.fire(new i.y(y));else if(x){let w=new Map;for(let S in x)w.set(i.I.from(S),x[S]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(o),i.R.Iconset),(y,x)=>{if(y)return void _(y);let w={},S=i.dg(new i.bt(x));for(let M of S.icons){let A={version:1,pixelRatio:i.o.devicePixelRatio,content:Gx(M),stretchX:M.metadata?qx(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?qx(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};w[M.name]=A}_(null,w)}))}_validateLayer(o){let c=this.getOwnSource(o.source);if(!c)return;let f=o.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.y(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,c)=>{let f=this.fragments[c];return f&&f.style&&(o.data=f.style.serialize()),o})}_serializeSources(){let o={};for(let c in this._sourceCaches){let f=this._sourceCaches[c].getSource();o[f.id]||(o[f.id]=f.serialize())}return o}_serializeLayers(o){let c=[];for(let f of o){let _=this._layers[f];_&&_.type!=="custom"&&c.push(_.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];if(c._transitionablePaint&&c._transitionablePaint._values){let f=c._transitionablePaint._values["line-emissive-strength"];if(f&&f.value&&f.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let c=this.getOwnLayer(o);if(c)return c;this.fire(new i.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let c=this.getOwnSource(o);if(c)return c;this.fire(new i.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,c){let f=this.map.painter;if(f)for(let _=o.minzoom||0;_<(o.maxzoom||25.5);_++){let y=o.getProgramIds();if(y)for(let x of y){let w=o.getDefaultProgramParams(x,c.zoom,this._styleColorTheme.lut);w&&(f.style=this,this.fog&&(f._fogVisible=!0,w.overrideFog=!0,f.getOrCreateProgram(x,w)),f._fogVisible=!1,w.overrideFog=!1,f.getOrCreateProgram(x,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,f.getOrCreateProgram(x,w)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let c=this.calculateLightsBrightness();o.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));let f=this._changes.isDirty(),_=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let S in w){let{updatedIds:M,removedIds:A}=w[S];(M||A)&&(this._updateWorkerLayers(S,M,A),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}let y={};for(let w in this._mergedSourceCaches){let S=this._mergedSourceCaches[w];y[w]=S.used,S.used=!1,S.tileCoverLift=0}for(let w of this._mergedOrder){let S=this._mergedLayers[w];if(S.visibility!=="none"&&S.recalculate(o,this._availableImages),!S.isHidden(o.zoom)){let M=this.getLayerSourceCache(S);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,o)}):this.precompilePrograms(S,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();let x=this.imageManager.getPendingImageProviders();for(let w of x)w.sourceCache.used=!0;for(let w in y){let S=this._mergedSourceCaches[w];y[w]!==S.used&&S.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){let o=this.imageManager.getPendingImageProviders();for(let c of o){let f=c.resolvePendingRequests(),_=this.getFragmentStyle(c.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){let o={};for(let c in this._mergedSourceCaches){let f=this._mergedSourceCaches[c].getSource().scope;o[f]=o[f]||this._changes.getUpdatedImages(f),o[f].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o[f])}for(let c in o)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(o,c,f){let _=this.getFragmentStyle(o);_&&this.dispatcher.broadcast("updateLayers",{layers:c?_._serializeLayers(c):[],scope:o,removedIds:f||[],options:_.options})}setState(o,c){if(this._checkLoaded(),Uc(this,Fa(o)))return!1;(o=i.dp(o)).layers=ep(o.layers);let f=(function(x,w){if(!x)return[{command:qn.setStyle,args:[w]}];let S=[];try{if(!i.by(x.version,w.version))return[{command:qn.setStyle,args:[w]}];if(i.by(x.center,w.center)||S.push({command:qn.setCenter,args:[w.center]}),i.by(x.zoom,w.zoom)||S.push({command:qn.setZoom,args:[w.zoom]}),i.by(x.bearing,w.bearing)||S.push({command:qn.setBearing,args:[w.bearing]}),i.by(x.pitch,w.pitch)||S.push({command:qn.setPitch,args:[w.pitch]}),i.by(x.sprite,w.sprite)||S.push({command:qn.setSprite,args:[w.sprite]}),i.by(x.glyphs,w.glyphs)||S.push({command:qn.setGlyphs,args:[w.glyphs]}),i.by(x.imports,w.imports)||(function(L=[],j=[],V){j=j||[];let W=(L=L||[]).map(tp),q=j.map(tp),J=L.reduce(np,{}),ie=j.reduce(np,{}),ee=W.slice(),ge,de,fe,ue;for(ge=0,de=0;ge<W.length;ge++)fe=W[ge],ie.hasOwnProperty(fe)?de++:(V.push({command:qn.removeImport,args:[fe]}),ee.splice(ee.indexOf(fe,de),1));for(ge=0,de=0;ge<q.length;ge++)fe=q[q.length-1-ge],ee[ee.length-1-ge]!==fe&&(J.hasOwnProperty(fe)?(V.push({command:qn.removeImport,args:[fe]}),ee.splice(ee.lastIndexOf(fe,ee.length-de),1)):de++,ue=ee[ee.length-ge],V.push({command:qn.addImport,args:[ie[fe],ue]}),ee.splice(ee.length-ge,0,fe));for(let se of j){let _e=J[se.id];_e&&(delete _e.data,i.by(_e,se)||V.push({command:qn.updateImport,args:[se.id,se]}))}})(x.imports,w.imports,S),i.by(x.transition,w.transition)||S.push({command:qn.setTransition,args:[w.transition]}),i.by(x.light,w.light)||S.push({command:qn.setLight,args:[w.light]}),i.by(x.fog,w.fog)||S.push({command:qn.setFog,args:[w.fog]}),i.by(x.snow,w.snow)||S.push({command:qn.setSnow,args:[w.snow]}),i.by(x.rain,w.rain)||S.push({command:qn.setRain,args:[w.rain]}),i.by(x.projection,w.projection)||S.push({command:qn.setProjection,args:[w.projection]}),i.by(x.lights,w.lights)||S.push({command:qn.setLights,args:[w.lights]}),i.by(x.camera,w.camera)||S.push({command:qn.setCamera,args:[w.camera]}),i.by(x.iconsets,w.iconsets)||(function(L,j,V){let W;for(W in j=j||{},L=L||{})L.hasOwnProperty(W)&&(j.hasOwnProperty(W)||V.push({command:qn.removeIconset,args:[W]}));for(W in j){if(!j.hasOwnProperty(W))continue;let q=j[W];L.hasOwnProperty(W)?i.by(L[W],q)||(V.push({command:qn.removeIconset,args:[W]}),V.push({command:qn.addIconset,args:[W,q]})):V.push({command:qn.addIconset,args:[W,q]})}})(x.iconsets,w.iconsets,S),!i.by(x["color-theme"],w["color-theme"]))return[{command:qn.setStyle,args:[w]}];let M={},A=[];(function(L,j,V,W){let q;for(q in j=j||{},L=L||{})L.hasOwnProperty(q)&&(j.hasOwnProperty(q)||Y_(q,V,W));for(q in j){if(!j.hasOwnProperty(q))continue;let J=j[q];L.hasOwnProperty(q)?i.by(L[q],J)||(L[q].type==="geojson"&&J.type==="geojson"&&Ux(L,j,q)?V.push({command:qn.setGeoJSONSourceData,args:[q,J.data]}):Vx(q,j,V,W)):qf(q,j,V)}})(x.sources,w.sources,A,M);let F=[];x.layers&&x.layers.forEach(L=>{L.source&&M[L.source]?S.push({command:qn.removeLayer,args:[L.id]}):F.push(L)});let k=x.terrain;k&&M[k.source]&&(S.push({command:qn.setTerrain,args:[void 0]}),k=void 0),S=S.concat(A),i.by(k,w.terrain)||S.push({command:qn.setTerrain,args:[w.terrain]}),(function(L,j,V){j=j||[];let W=(L=L||[]).map(tp),q=j.map(tp),J=L.reduce(np,{}),ie=j.reduce(np,{}),ee=W.slice(),ge=Object.create(null),de,fe,ue,se,_e,Se,Ce;for(de=0,fe=0;de<W.length;de++)ue=W[de],ie.hasOwnProperty(ue)?fe++:(V.push({command:qn.removeLayer,args:[ue]}),ee.splice(ee.indexOf(ue,fe),1));for(de=0,fe=0;de<q.length;de++)ue=q[q.length-1-de],ee[ee.length-1-de]!==ue&&(J.hasOwnProperty(ue)?(V.push({command:qn.removeLayer,args:[ue]}),ee.splice(ee.lastIndexOf(ue,ee.length-fe),1)):fe++,Se=ee[ee.length-de],V.push({command:qn.addLayer,args:[ie[ue],Se]}),ee.splice(ee.length-de,0,ue),ge[ue]=!0);for(de=0;de<q.length;de++)if(ue=q[de],se=J[ue],_e=ie[ue],!ge[ue]&&!i.by(se,_e))if(i.by(se.source,_e.source)&&i.by(se["source-layer"],_e["source-layer"])&&i.by(se.type,_e.type)){for(Ce in Lc(se.layout,_e.layout,V,ue,null,qn.setLayoutProperty),Lc(se.paint,_e.paint,V,ue,null,qn.setPaintProperty),i.by(se.slot,_e.slot)||V.push({command:qn.setSlot,args:[ue,_e.slot]}),i.by(se.filter,_e.filter)||V.push({command:qn.setFilter,args:[ue,_e.filter]}),i.by(se.minzoom,_e.minzoom)&&i.by(se.maxzoom,_e.maxzoom)||V.push({command:qn.setLayerZoomRange,args:[ue,_e.minzoom,_e.maxzoom]}),se)se.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Lc(se[Ce],_e[Ce],V,ue,Ce.slice(6),qn.setPaintProperty):i.by(se[Ce],_e[Ce])||V.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}));for(Ce in _e)_e.hasOwnProperty(Ce)&&!se.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Lc(se[Ce],_e[Ce],V,ue,Ce.slice(6),qn.setPaintProperty):i.by(se[Ce],_e[Ce])||V.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}))}else V.push({command:qn.removeLayer,args:[ue]}),Se=ee[ee.lastIndexOf(ue)+1],V.push({command:qn.addLayer,args:[_e,Se]})})(F,w.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:qn.setStyle,args:[w]}]}return S})(this.serialize(),o).filter(x=>!(x.command in Zx));if(f.length===0)return!1;let _=f.filter(x=>!(x.command in Wx));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);let y=[];return f.forEach(x=>{y.push(this[x.command](...x.args))}),c&&Promise.all(y).then(c).catch(c),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(let[c,f]of o.entries()){if(this.getImage(c))return this.fire(new i.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,f),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(o,c){return this.getImage(o)?this.fire(new i.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,c),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(o,c,f=!1){this.imageManager.updateImage(o,this.scope,c),f&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(o,c,f={}){return this._checkLoaded(),this._validate(G,`models.${o}`,c,null,f)||(this.modelManager.addModel(o,c,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,c,f={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Bf,`sources.${o}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let _=oo(o,c,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let y=x=>{let w=(x?"symbol:":"other:")+_.id,S=i.B(w,this.scope),M=this._sourceCaches[w]=new Rs(S,_,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};y(!1),c.type!=="vector"&&c.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let c=this.getOwnSource(o);if(!c)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let _=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===o);if(_)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while iconset "${_[0]}" is using it.`)))}let f=this.getOwnSourceCaches(o);for(let _ of f){let y=i.dq(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getOwnSource(o).setData(c),this._changes.setDirty()}getOwnSource(o){let c=this.getOwnSourceCache(o);return c&&c.getSource()}getOwnSources(){let o=[];for(let c in this._otherSourceCaches){let f=this.getOwnSourceCache(c);f&&o.push(f.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let c in o){let f=o[c]._tiles;for(let _ in f){let y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let y of o){if(this._validate(jl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(y),x.updateTransitions(c)}else this.ambientLight=new Gn(y,Fr||(Fr=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(y),x.updateTransitions(c)}else this.directionalLight=new Gn(y,yr||(yr=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=Object.assign(c,{worldview:this.map.getWorldview()}),_=new i.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,c=this.ambientLight;if(!o||!c)return;let f=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),_=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=1-i.d4(x.x,x.y,x.z)[2]/90,S=f(_)*y*w,M=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),A=c.properties.get("intensity"),F=f(M)*A;return Number(((S+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.dr(o)){let c=i.ds(o),f=this.fragments.find(({id:y})=>y===c);if(!f)return;let _=i.dq(o);return f.style.getFragmentStyle(_)}{let c=this.fragments.find(({id:f})=>f===o);return c?c.style:void 0}}setFeaturesetSelectors(o){if(!o)return;let c={},f=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(let _ in o){let y=this._featuresetSelectors[_]=[];for(let x of o[_].selectors){if(x.featureNamespace){let S=this.getOwnLayer(x.layer);if(!S){i.w(`Layer is undefined for selector: ${x.layer}`);continue}let M=f(S.source,S.sourceLayer);if(M in c&&c[M]!==x.featureNamespace){i.w(`"featureNamespace ${x.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}c[M]=x.featureNamespace}let w;if(x.properties)for(let S in x.properties){let M=i.U(x.properties[S]);M.result==="success"&&(w=w||{},w[S]=M.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:w,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(o){let c=this.getFragmentStyle(o);if(!c||!c.stylesheet.featuresets)return[];let f=[];for(let _ in c.stylesheet.featuresets)f.push({featuresetId:_,importId:c.scope?c.scope:void 0});return f}getFeaturesetLayers(o,c){let f=this.getFragmentStyle(c),_=f.stylesheet.featuresets;if(!_||!_[o])return this.fire(new i.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of _[o].selectors){let w=f.getOwnLayer(x.layer);w&&y.push(w)}return y}getConfigProperty(o,c){let f=this.getFragmentStyle(o);if(!f)return null;let _=i.B(c,f.scope),y=f.options.get(_),x=y?y.value||y.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,c){let f=i.B(o,c);return this._mergedIndoor[f]}setIndoorData(o,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,c,f){let _=this.getFragmentStyle(o);if(!_)return;let y=_.stylesheet.schema;if(!y||!y[c])return;let x=i.U(f);if(x.result!=="success")return void Uc(this,x.value);let w=x.value.expression,S=i.B(c,_.scope),M=_.options.get(S);if(!M)return;let A,{minValue:F,maxValue:k,stepValue:L,type:j,values:V}=y[c],W=i.U(y[c].default);W.result==="success"&&(A=W.value.expression),A?(this.options.set(S,Object.assign({},M,{value:w,default:A,minValue:F,maxValue:k,stepValue:L,type:j,values:V})),this.updateConfigDependencies(c)):this.fire(new i.y(new Error(`No schema defined for the config option "${c}" in the "${o}" fragment.`)))}getConfig(o){let c=this.getFragmentStyle(o);if(!c)return null;let f=c.stylesheet.schema;if(!f)return null;let _={};for(let y in f){let x=i.B(y,c.scope),w=c.options.get(x),S=w?w.value||w.default:null;_[y]=S?S.serialize():null}return _}setConfig(o,c){let f=this.getFragmentStyle(o);f&&(f.updateConfig(c,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let c=this.getFragmentStyle(o);return c?c.stylesheet.schema:null}setSchema(o,c){let f=this.getFragmentStyle(o);f&&(f.stylesheet.schema=c,f.updateConfig(f._config,c),this.updateConfigDependencies())}updateConfig(o,c){if(this._config=o,o||c)if(c)for(let f in c){let _,y,x=i.U(c[f].default);if(x.result==="success"&&(_=x.value.expression),o&&o[f]!==void 0){let k=i.U(o[f]);k.result==="success"&&(y=k.value.expression)}let{minValue:w,maxValue:S,stepValue:M,type:A,values:F}=c[f];if(_){let k=i.B(f,this.scope);this.options.set(k,{default:_,value:y,minValue:w,maxValue:S,stepValue:M,type:A,values:F})}else this.fire(new i.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,c=()=>!0){for(let f of o){let _=this.getLayer(f);_&&c(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,c=>!o||c.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{let f=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(f){let _=c._evaluateColorThemeData(f);(!c._styleColorTheme.lut&&_!==""||c._styleColorTheme.lut&&_!==c._styleColorTheme.lut.data)&&c.setColorTheme(f)}}),this._changes.setDirty()}addLayer(o,c,f={}){this._checkLoaded();let _=o.id;if(this._layers[_])return void this.fire(new i.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(o.type==="custom"){if(Uc(this,i.dt(o)))return;y=i.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=i.dp(o),o=Object.assign(o,{source:_})),this._validate(X_,`layers.${_}`,o,{arrayIndex:-1},f))return;y=i.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}let x=i.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let w=this._order.length;if(c){let F=this._order.indexOf(c);if(F===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));y.slot===this._layers[c].slot?w=F:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;let S=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&M&&(S.castsShadows=!0);let A=this._changes.getRemovedLayer(y);if(A&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let F=i.B(y.source,y.scope);A.type!==y.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(o,c){this._checkLoaded();let f=this._checkLayer(o);if(!f||o===c)return;let _=this._order.indexOf(o);this._order.splice(_,1);let y=this._order.length;if(c){let x=this._order.indexOf(c);if(x===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));f.slot===this._layers[c].slot?y=x:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let c=this._checkLayer(o);if(!c)return;c.setEventedParent(null);let f=this._order.indexOf(o);this._order.splice(f,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let _=this.getOwnLayerSourceCache(c);if(_&&_.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===c.source&&this._layers[x].canCastShadows()){y=!0;break}_.castsShadows=y}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,f){this._checkLoaded();let _=this._checkLayer(o);_&&(_.minzoom===c&&_.maxzoom===f||(c!=null&&(_.minzoom=c),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,c){this._checkLoaded();let f=this._checkLayer(o);f&&f.slot!==c&&(f.slot=c,this._updateLayer(f))}setFilter(o,c,f={}){this._checkLoaded();let _=this._checkLayer(o);if(_&&!i.by(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(zu,`layers.${_.id}.filter`,c,{layerType:_.type},f)||(_.filter=i.dp(c),this._updateLayer(_)))}getFilter(o){let c=this._checkLayer(o);if(c)return i.dp(c.filter)}setLayoutProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(y&&!i.by(y.getLayoutProperty(c),f)){if(f!=null&&(!_||_.validate!==!1)&&Uc(y,Ae.call(Fa,{key:`layers.${o}.layout.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(c,f),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);y&&(c==="appearances"?(y.setAppearances(f),this._changes.setDirty()):y.isPaintProperty(c)?this.setPaintProperty(o,c,f,_):this.setLayoutProperty(o,c,f,_))}getLayoutProperty(o,c){let f=this._checkLayer(o);if(f)return f.getLayoutProperty(c)}setPaintProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(!y||i.by(y.getPaintProperty(c),f)||f!=null&&(!_||_.validate!==!1)&&Uc(y,Kh.call(Fa,{key:`layers.${o}.paint.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:i.a6})))return;let x=y.setPaintProperty(c,f);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(o,c){let f=this._checkLayer(o);if(f)return f.getPaintProperty(c)}setFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),F=A.getFeaturesetLayers(S);for(let{source:k,sourceLayer:L}of F)A.setFeatureState({id:o.id,source:k,sourceLayer:L},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.setFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=o.sourceLayer,y=this._checkSource(f);if(!y)return;let x=y.type;if(x==="geojson"&&_)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!_)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.setFeatureState(_,o.id,c)}removeFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),F=A.getFeaturesetLayers(S);for(let{source:k,sourceLayer:L}of F)A.removeFeatureState({id:o.id,source:k,sourceLayer:L},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.removeFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=this._checkSource(f);if(!_)return;let y=_.type,x=y==="vector"?o.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.removeFeatureState(x,o.id,c)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let y;if("featuresetId"in o.target){let{featuresetId:x,importId:w}=o.target,S=this.getFragmentStyle(w),M=S.getFeaturesetLayers(x);for(let{source:A,sourceLayer:F}of M){let k=S.getFeatureState({id:o.id,source:A,sourceLayer:F});if(k&&!y)y=k;else if(!i.by(y,k))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){let{layerId:x}=o.target,w=this.getLayer(x);y=this.getFeatureState({id:o.id,source:w.source,sourceLayer:w.sourceLayer})}return y}let c=o.source,f=o.sourceLayer,_=this._checkSource(c);if(_){if(_.type!=="vector"||f)return o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,o.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),c=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(o){for(let c of Object.values(this._mergedLayers))o(c)&&this._updateLayer(c)}_updateLayer(o){this._changes.updateLayer(o);let c=this.getLayerSourceCache(o),f=i.B(o.source,o.scope),_=this._changes.getUpdatedSourceCaches();o.source&&!_[f]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),c.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let c=w=>this._mergedLayers[w].is3D(!!this.terrain),f=this.order,_={},y=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S)){_[S]=w;for(let M of o){let A=M[S];if(A)for(let F of A)y.push(F)}}}y.sort((w,S)=>S.intersectionZ-w.intersectionZ);let x=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S))for(let M=y.length-1;M>=0;M--){let A=y[M].feature;if(A.layer&&_[A.layer.id]<w)break;x.push(A),y.pop()}else for(let M of o){let A=M[S];if(A)for(let F of A)x.push(F.feature)}}return x}queryRasterValue(o,c,f){let _=this.getOwnSource(o);return _?_.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(c,f):(this.fire(new i.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(zu,"queryRenderedFeatures.filter",c.filter,null,c),_=i.b6(c.filter));let y={},x=A=>{if(im.has(A.type))return;let F=this.getOwnLayerSourceCache(A),k=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};A.is3D(!!this.terrain)&&(k.has3DLayers=!0),k.layers[A.fqid]=k.layers[A.fqid]||{styleLayer:A,targets:[]},k.layers[A.fqid].targets.push({filter:_})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(let A of c.layers){let F=this._layers[A];if(!F)return this.fire(new i.y(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(let A in this._layers)x(this._layers[A]);let w=this._queryRenderedFeatures(o,y,f),S=this._flattenAndSortRenderedFeatures(w),M=[];for(let A of S)i.dw(A.layer.id)===this.scope&&M.push(A);return M}queryRenderedFeatureset(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(zu,"queryRenderedFeatures.filter",c.filter,null,c),_=i.b6(c.filter));let y="mock",x=[];if(c&&c.target)x.push(Object.assign({},c,{targetId:y,filter:_}));else{let A=this.getFeaturesetDescriptors();for(let F of A)x.push({targetId:y,filter:_,target:F});for(let{style:F}of this.fragments){let k=F.getFeaturesetDescriptors();for(let L of k)x.push({targetId:y,filter:_,target:L})}}let w=this.queryRenderedTargets(o,x,f),S=[],M=new Set;for(let A of w)for(let F of A.variants[y])kd(F,A,M)||S.push(new i.dx(A,F));return S}queryRenderedTargets(o,c,f){let _={},y=(w,S,M,A)=>{let F=_[S.id]=_[S.id]||{sourceCache:S,layers:{},has3DLayers:!1};if(F.layers[w.fqid]=F.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(F.has3DLayers=!0),!A)return M.uniqueFeatureID=!1,void F.layers[w.fqid].targets.push(M);F.layers[w.fqid].targets.push(Object.assign({},M,{namespace:A.namespace,properties:A.properties,uniqueFeatureID:A.uniqueFeatureID}))};for(let w of c)if("featuresetId"in w.target){let{featuresetId:S,importId:M}=w.target,A=this.getFragmentStyle(M);if(!A||!A._featuresetSelectors)continue;let F=A._featuresetSelectors[S];if(!F){this.fire(new i.y(new Error(`The featureset '${S}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let k of F){let L=A.getOwnLayer(k.layerId);L&&!im.has(L.type)&&y(L,A.getOwnLayerSourceCache(L),w,k)}}else if("layerId"in w.target){let{layerId:S}=w.target,M=this.getLayer(S);if(!M||im.has(M.type))continue;y(M,this.getLayerSourceCache(M),w)}let x=this._queryRenderedFeatures(o,_,f);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(o,c,f){let _=[],y=!!this.map._showQueryGeometry,x=sr.createFromScreenPoints(o,f);for(let w in c){let S=Vf(x,c[w],this._availableImages,f,y);Object.keys(S).length&&_.push(S)}if(this.placement)for(let w in c){if(!c[w].sourceCache._onlySymbols)continue;let S=Uf(x.screenGeometry,c[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(S).length&&_.push(S)}return _}querySourceFeatures(o,c){let f=c&&c.filter;f&&this._validate(zu,"querySourceFeatures.filter",f,null,c);let _=[],y=this.getOwnSourceCaches(o);for(let x of y)_=_.concat(jf(x,c));return _}addSourceType(o,c,f){return ga.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(ga.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,c,f={}){this._checkLoaded();let _=this.light.getLight(),y=!1;for(let w in o)if(!i.by(o[w],_[w])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(o,c,f),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,c=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=o,_=!("source"in o)||o.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in f&&typeof f.source=="object"){let w="terrain-dem-src";this.addSource(w,f.source),f=i.dp(f),f=Object.assign(f,{source:w})}let y=Object.assign({},f),x={};if(this.terrain&&_){y.source=this.terrain.get().source;let w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(x.style=w.serialize())}if(this._validate(Z_,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c),this.fire(new i.z("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let w of Object.keys(i.a6.terrain))!f.hasOwnProperty(w)&&i.a6.terrain[w].default&&(f[w]=i.a6.terrain[w].default);for(let w in o)if(!i.by(o[w],x[w])){y.set(o,this.options),this.stylesheet.terrain=o;let S=this._getTransitionParameters({duration:0});y.updateTransitions(S),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let c=this.fog=new gn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createSnow(o){let c=this.snow=new $r(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createRain(o){let c=this.rain=new or(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let c=this.snow;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let c=this.rain;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){let o=()=>{for(let _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(let _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void o();let f=this._evaluateColorThemeData(c);this._loadColorTheme(f).then(()=>{this.fire(new i.z("colorthemeset")),o()}).catch(_=>{i.w(`Couldn't set color theme: ${_}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,c){let f=this.getFragmentStyle(o);f&&(f._styleColorTheme.colorThemeOverride=c,f._reloadColorTheme())}_getTransitionParameters(o){return{now:i.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],c=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?o.push(f):c.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){let f=this.terrain=new Ie(o,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,f,_,y={}){if(y&&y.validate===!1)return!1;let x=Object.assign({},this.serialize());return Uc(this,o.call(Fa,Object.assign({key:c,style:x,value:f,styleSpec:i.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){let c=this.getSourceCaches(o);for(let f of c)f.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];c._clear&&c._clear()}}reloadSource(o){let c=this.getSourceCaches(o);for(let f of c)f.resume(),f.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let c;this.directionalLight&&(c=dp(this.directionalLight));let f=new Set,_=new Set;for(let y in this._mergedLayers){let x=this._mergedLayers[y];x.type==="building"&&f.add(x.source),x.hasElevation()&&!_.has(x.source)&&_.add(x.source)}for(let y in this._mergedSourceCaches){let x=this._mergedSourceCaches[y],w=_.has(x._source.id);f.has(x._source.id)&&(x._source.reparseOverscaled=!1),x.update(o,void 0,void 0,c,w)}}_generateCollisionBoxes(){for(let o in this._sourceCaches){let c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,f,_,y,x,w=!1){let S=!1,M=!1,A={},F={};for(let V of this._mergedOrder){let W=this._mergedLayers[V];if(W.type!=="symbol")continue;let q=i.B(W.source,W.scope),J=A[q];if(!J){let ee=this.getLayerSourceCache(W);if(!ee)continue;let ge=ee.getRenderableIds(!0).map(de=>ee.getTileByID(de));F[q]=ge.slice(),J=A[q]=ge.sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}let ie=this.crossTileSymbolIndex.addLayer(W,J,c.center.lng,c.projection);S=S||ie}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));let k=!!(this.placement&&!c.equals(this.placement.transform)),L=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!x||this.placement.lastReplacementSourceUpdateTime!==x.updateTime)),j=(k||L||S||this.placement&&this.placement.isStale())&&_===0;if((w||!this.pauseablePlacement||j||_!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),c.zoom))&&(this.pauseablePlacement=new so(c,this._mergedOrder,w||_===0,f,_,y,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,A,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S){this._buildingIndex.onNewFrame(c.zoom);for(let V=0;V<this._mergedOrder.length;V++){let W=this._mergedLayers[this._mergedOrder[V]];if(W.type!=="symbol"||W.visibility==="none")continue;let q=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,A[i.B(W.source,W.scope)],V,q?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,c){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===o.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!c)return f.push(o),this._loadImports([o],!0);let _=f.findIndex(({id:y})=>y===c);return _===-1&&this.fire(new i.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(o).concat(f.slice(_)),this._loadImports([o],!0,c)}updateImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);return _===-1?this:typeof c=="string"?(this.setImportUrl(o,c),this):(c.url&&c.url!==f[_].url&&this.setImportUrl(o,c.url),i.by(c.config,f[_].config)||this.setImportConfig(o,c.config,c.data.schema),i.by(c.data,f[_].data)||this.setImportData(o,c.data),this)}moveImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;let y=this.getImportIndex(c);if(y===-1)return this;let x=f[_],w=this.fragments[_];return f=f.filter(({id:S})=>S!==o),this.fragments=this.fragments.filter(({id:S})=>S!==o),this.stylesheet.imports=f.slice(0,y).concat(x).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(w).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;f[_].url=c;let y=this.fragments[_];return y.style=this._createFragmentStyle(f[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(c),this}setImportData(o,c){this._checkLoaded();let f=this.getImportIndex(o),_=this.stylesheet.imports||[];return f===-1?this:c?(this.fragments[f].style.setState(c),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(o,_[f].url))}setImportConfig(o,c,f){this._checkLoaded();let _=this.getImportIndex(o),y=this.stylesheet.imports||[];if(_===-1)return this;c?y[_].config=c:delete y[_].config;let x=this.fragments[_];f&&x.style.stylesheet&&(x.style.stylesheet.schema=f);let w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.updateConfig(c,w),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(o);f!==-1&&(c.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(o){let c=(this.stylesheet.imports||[]).findIndex(f=>f.id===o);return c===-1&&this.fire(new i.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),c}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let c in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[c];f&&o.push(f.getSource())}return o}getSource(o,c){let f=this.getSourceCache(o,c);return f&&f.getSource()}getLayerSource(o){let c=this.getLayerSourceCache(o);return c&&c.getSource()}getSourceCache(o,c){let f=i.B(o,c);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(o){let c=i.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let c=[];return this._mergedOtherSourceCaches[o]&&c.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&c.push(this._mergedSymbolSourceCaches[o]),c}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let c in o){let f=o[c];f==="reload"?this.reloadSource(c):f==="clear"&&this.clearSource(c)}}updateLayers(o){let c=this._changes.getUpdatedPaintProperties();for(let f of c){let _=this.getLayer(f);_&&_.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,c,f){this.imageManager.getImages(c.images,c.scope,f),this._updateTilesForChangedImages();let _=x=>{if(x){let w=c.images.map(S=>i.I.toString(S));x.setDependencies(c.tileID.key,c.type,w)}},y=i.B(c.source,c.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y]),c.images.some(x=>x.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(o,c,f){this.imageManager.rasterizeImages(c,f)}getGlyphs(o,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(o,c,f){return i.dz(c,f)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){let c=this.getOwnSourceCaches(o);return c.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${o}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,c){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;let f=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),_=o.type==="building";if(o.is3D(!!this.terrain)){if(f||_||c&&c.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ga.getSourceType=function(p){return sl[p]},ga.setSourceType=function(p,o){sl[p]=o},ga.registerForPluginStateChange=i.dA;class Xx extends i.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(let[c,f]of Object.entries(o.buildings))if(this._buildings[c])for(let _ of f.floorIds)this._buildings[c].floors[_]||(this._buildings[c].floors[_]=f.floors[_]);else this._buildings[c]=f;for(let c of o.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(o,c){let f=this._style.getIndoorSourceLayers(o,c);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(o,c,f){let _=(function(y,x,w,S){let M=null,A=Number.MAX_SAFE_INTEGER;if(S<16)return null;for(let[F,k]of Object.entries(y)){let L=k.center;if(L){let j=x.distanceTo(i.aT.convert(L));j<A&&w.contains(L)&&(A=j,M=F)}}return M})(this._buildings,c,f,o);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){let o=this._buildings,c=this._closestBuildingId,f=c&&o?o[c]:void 0;if(!f)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(let x of f.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){_=x;break}let y=Array.from(f.floorIds).map(x=>({id:x,name:f.floors[x].name,zIndex:f.floors[x].zIndex})).sort((x,w)=>w.zIndex-x.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){let o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Bd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Vd=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,av=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,rm="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,om=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_t=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,lv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,sm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,am=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,cv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let pp=/#include\s+"([^"]+)"/g,pl=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,uv=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,qu=new Set(["ifdef","ifndef","elif","if","defined"]),Wu=new Set;Hc(Bd,Wu),Hc(av,Wu),Hc(Vd,Wu);let $c={"_prelude_fog.vertex.glsl":om,"_prelude_terrain.vertex.glsl":Gs,"_prelude_shadow.vertex.glsl":am,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":_t,"_prelude_shadow.fragment.glsl":cv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":lv,"_prelude_raster_particle.glsl":sm},lm={};Un("",Gs),Un(_t,om),Un(cv,am),Un(lv,""),Un(sm,"");let Yx=Un(Vd,av),cm=Bd,XS=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",cm,Yx.fragmentSource].join(`
`),Kx=["precision highp float;",cm,Yx.vertexSource].join(`
`);var dv={background:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Un(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Un("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Un("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Un("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Un(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Un(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Un(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Un(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Un(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Un("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Un("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Un(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Un(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Un("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Un(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rm),skyboxGradient:Un(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rm),skyboxCapture:Un(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Un(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Un(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Un("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Un("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Un("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Un("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Hc(p,o){let c=p.split(`
`);for(let f of c){if(f=f.trimStart(),f[0]!=="#"||!f.includes("if")||f.startsWith("#endif"))continue;let _=f.match(uv);if(_)for(let y of _)qu.has(y)||o.add(y)}}function Un(p,o){let c=new Set,f=[],_=[];p=p.replace(pp,(x,w)=>(_.push(w),"")),o=o.replace(pp,(x,w)=>(f.push(w),""));let y=new Set(Wu);Hc(p,y),Hc(o,y);for(let x of[...f,..._])lm[x]||(lm[x]=new Set,Hc($c[x],lm[x])),y=new Set([...y,...lm[x]]);return{fragmentSource:p=p.replace(pl,(x,w,S,M,A)=>(c.add(A),w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?`
#ifdef HAS_UNIFORM_u_${A}
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(pl,(x,w,S,M,A)=>{let F=`MATERIAL_ATTRIBUTE_OFFSET_${A}`,k=M==="float"?"vec2":M,L=`GET_ATTRIBUTE_${k}(a_${A}, materialInfo, ${F})`,j=A.match(/color/)?"color":k;return w==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${A}
in ${S} ${M} a_${A};
#endif
`:c.has(A)?w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${F})
        in ${S} ${k} a_${A};
    #endif
out ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${A})
    #ifdef ${F}
        ${A} = unpack_mix_${j}(${L}, u_${A}_t);
    #else
        ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} a_${A};
    out ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${A} = a_${A};
#endif
`:void 0:w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${F})
        in ${S} ${k} a_${A};
    #endif
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${A}0;
in vec4 a_${A}1;
in vec4 a_${A}2;
in vec4 a_${A}3;
#else
uniform ${S} ${M} u_${A};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${S} ${k} a_${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${S} ${M} ${A} = a_${A};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${F}
        ${S} ${M} ${A} = ${L};
    #else
        ${S} ${M} ${A} = a_${A};
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${F}
        ${S} ${M} ${A} = unpack_mix_${j}(${L}, u_${A}_t);
    #else
        ${S} ${M} ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`}),usedDefines:y,vertexIncludes:f,fragmentIncludes:_}}class YS{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,f,_,y,x,w,S){this.context=o;let M=this.boundPaintVertexBuffers.length!==_.length;for(let F=0;!M&&F<_.length;F++)this.boundPaintVertexBuffers[F]!==_[F]&&(M=!0);let A=this.boundDynamicVertexBuffers.length!==w.length;for(let F=0;!A&&F<w.length;F++)this.boundDynamicVertexBuffers[F]!==w[F]&&(A=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||M||A||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(c,f,_,y,x,w,S);else{o.bindVertexArrayOES.set(this.vao);for(let F of w)F&&(F.bind(),S&&F.instanceCount&&F.setVertexAttribDivisor(o.gl,c,S));y&&y.dynamicDraw&&y.bind()}}freshBind(o,c,f,_,y,x,w){let S=this.context,M=S.gl;this.vao&&this.destroy(),this.vao=S.gl.createVertexArray(),S.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,c.enableAttributes(M,o),c.bind(),c.setVertexAttribPointers(M,o,y);for(let A of f)A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y);for(let A of x)A&&(A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y),w&&A.instanceCount&&A.setVertexAttribDivisor(M,o,w));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function KS(p,o){let c=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new i.ae(0,f/c).toLngLat().lat,new i.ae(0,(f+1)/c).toLngLat().lat]}function QS(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=c.hillshadeFBO;if(!M)return;p.prepareDrawTile();let A=p.isTileAffectedByFog(o),F=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&F.push("USE_MRT1");let k=p.getOrCreateProgram("hillshade",{overrideFog:A,defines:F});w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment0.get());let L=((q,J,ie,ee)=>{let ge=ie.paint.get("hillshade-shadow-color"),de=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=ie.paint.get("hillshade-highlight-color"),ue=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",se=ie.paint.get("hillshade-accent-color"),_e=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Se=ie.paint.get("hillshade-emissive-strength"),Ce=i.an(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")Ce-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let Ue=q.style.directionalLight.properties.get("direction"),Ze=i.d4(Ue.x,Ue.y,Ue.z);Ce=i.an(Ze[1])}let Be=!q.options.moving;return{u_matrix:ee||q.transform.calculateProjMatrix(J.tileID.toUnwrapped(),Be),u_image:0,u_latrange:KS(0,J.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Ce],u_shadow:ge.toPremultipliedRenderColor(de?null:ie.lut),u_highlight:fe.toPremultipliedRenderColor(ue?null:ie.lut),u_emissive_strength:Se,u_accent:se.toPremultipliedRenderColor(_e?null:ie.lut)}})(p,c,f,p.terrain?o.projMatrix:null);p.uploadCommonUniforms(w,k,o.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=p.getTileBoundsBuffers(c);k.draw(p,S.TRIANGLES,_,y,x,an.disabled,L,f.id,j,V,W)}function hv(p,o,c){if(!o.needsDEMTextureUpload)return;let f=p.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(c.stride);let y=c.getPixels();o.demTexture?o.demTexture.update(y,{premultiply:!1}):o.demTexture=new i.T(f,y,_.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function JS(p,o,c){let f=p.context,_=f.gl;if(!o.dem)return;let y=o.dem;if(f.activeTexture.set(_.TEXTURE1),hv(p,o,y),!o.demTexture)return;o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let x=y.dim;f.activeTexture.set(_.TEXTURE0);let w=o.hillshadeFBO;if(!w){let k=new i.T(f,{width:x,height:x,data:null},_.RGBA8);k.bind(_.LINEAR,_.CLAMP_TO_EDGE),w=o.hillshadeFBO=f.createFramebuffer(x,x,1,"renderbuffer"),w.colorAttachment0.set(k.texture)}f.bindFramebuffer.set(w.framebuffer),f.viewport.set([0,0,x,x]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:M,tileBoundsSegments:A}=p.getMercatorTileBoundsBuffers(),F=[];p.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&F.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(p,_.TRIANGLES,Ht.disabled,ln.disabled,yn.unblended,an.disabled,((k,L)=>{let j=L.stride,V=i.bC();return i.ce(V,0,i.al,-i.al,0,0,1),i.br(V,V,[0,-i.al,0]),{u_matrix:V,u_image:1,u_dimension:[j,j],u_zoom:k.overscaledZ}})(o.tileID,y),c.id,S,M,A),o.needsHillshadePrepare=!1}class Ki{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class eT extends Ki{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Qx extends Ki{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class pv extends Ki{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class um extends Ki{getDefault(){return[!0,!0,!0,!0]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fv extends Ki{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Zu extends Ki{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ud extends Ki{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class fp extends Ki{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class jd extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class Jx extends Ki{getDefault(){return[0,1]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class mv extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class eb extends Ki{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class $d extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class dm extends Ki{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class hm extends Ki{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class gv extends Ki{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class pm extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class mp extends Ki{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class tb extends Ki{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let nb=class extends Ki{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class ib extends Ki{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Hd extends Ki{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class rb extends Ki{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class tT extends Ki{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class nT extends Ki{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class iT extends Ki{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _v extends Ki{getDefault(){return null}set(o){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class vv extends Ki{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class yv extends Ki{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class xv extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ob extends Ki{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class fm extends Ki{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class mm extends fm{constructor(o,c,f=0){super(o,c),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+f}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Gd extends fm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class gp extends fm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class sb extends Gd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let qs=(p,o,c,f)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:c,u_emissive_texture_available:f}),gm=(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_image1:1,u_frustum_tl:x,u_frustum_tr:w,u_frustum_br:S,u_frustum_bl:M,u_globe_pos:A,u_globe_radius:F,u_viewport:k,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:L,u_far_z_cutoff:j,u_emissive_texture_available:V});function _p(p,o){return p!=null&&o!=null&&!(!p.hasData()||!o.hasData())&&p.demTexture!=null&&o.demTexture!=null&&p.tileID.key!==o.tileID.key}let Wl=new class{constructor(){this.operations={}}newMorphing(p,o,c,f,_){if(p in this.operations){let y=this.operations[p];y.to.tileID.key!==c.tileID.key&&(y.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(let o in this.operations){let c=this.operations[o];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},_m={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vm(p,o,c){if(o===0)return 0;let f=o<1&&c===514?.25/o:1;return 6*Math.pow(1.5,22-p)*Math.max(o,1)*f}function bv(p,o){let c=1<<p.z;return!o&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}function qd(p,o){if(!p.style||!p.style.enable3dLights())return;let c=p.context,f=c.gl;c.activeTexture.set(f.TEXTURE1),o?o.bind(f.LINEAR,f.CLAMP_TO_EDGE):p.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}let vp=p=>({u_matrix:p});function yp(p,o,c,f,_){if(_>0){let y=i.o.now(),x=(y-p.timeAdded)/_,w=o?(y-o.timeAdded)/_:-1,S=c.getSource(),M=f.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),A=!o||Math.abs(o.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),F=A&&p.refreshedUponExpiration?1:i.aA(A?x:1-w,0,1);return o?{opacity:1,mix:1-F,isFading:x<1}:{opacity:F,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class ym extends Rs{constructor(o){let c=oo("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class wv extends Rs{constructor(o){let c=oo("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,f){if(o.freezeTileCoverage)return;this.transform=o;let _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let w=new ju(x,this._source.tileSize*x.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[x.key]=w}return y},{});for(let y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(o){let c=this.proxyCachedFBO[o];if(c!==void 0){let f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Cv extends i.aQ{constructor(o,c,f){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class Ev extends i.bV{constructor(o,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,_,y]=(function(S){let M=new i.bd,A=new i.b0,F=131;M.reserve(17161),A.reserve(33800);let k=i.al/128,L=i.al+k/2,j=L+k;for(let W=-k;W<j;W+=k)for(let q=-k;q<j;q+=k){let J=q<0||q>L||W<0||W>L?24575:0,ie=i.aA(Math.round(q),0,i.al),ee=i.aA(Math.round(W),0,i.al);M.emplaceBack(ie+J,ee)}let V=(W,q)=>{let J=q*F+W;A.emplaceBack(J+1,J,J+F),A.emplaceBack(J+F,J+F+1,J+1)};for(let W=1;W<129;W++)for(let q=1;q<129;q++)V(q,W);return[0,129].forEach(W=>{for(let q=0;q<130;q++)V(q,W),V(W,q)}),[M,A,32768]})(),x=o.context;this.gridBuffer=x.createVertexBuffer(f,i.bf.members),this.gridIndexBuffer=x.createIndexBuffer(_),this.gridSegments=i.bg.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new wv(c.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);let w=x.gl;this._overlapStencilMode=new ln({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ym(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,f){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let _=o.terrain.properties,y=o.terrain.drapeRenderMode===0,x=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();let w=o.terrain&&o.terrain.scope,S=_.get("source"),M=y?this._mockSourceCache:o.getSourceCache(S,w);if(!M)return void i.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=M,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(c):_.get("exaggeration"),!c.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let A=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(c,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);let c=this._previousCameraAltitude,f=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=f;let _=c!=null?f-c:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let y=o.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let w=y-this._previousZoom,S=this._previousUpdateTimestamp,M=y;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(y-M)>.5&&(w=.5*(y-M+w)),w*_<0&&(M+=w)),this._evaluationZoom=M;let A=x.getExaggeration(M),F=A===x.getExaggeration(Math.max(0,M-.1));if(F&&Math.abs(A-this._exaggeration)<.01)return A;let k=Math.min(.1,.00375*(this._updateTimestamp-S));return(F||A<.1||Math.abs(w)<1e-4)&&(k=Math.min(.2,4*k)),i.ak(this._exaggeration,A,k)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=c.getIds().map(S=>{let M=c.getTileByID(S).tileID;return M.projMatrix=f.calculateProjMatrix(M.toUnwrapped()),M});(function(S,M){let A=M.transform.pointCoordinate(M.transform.getCameraPoint()),F=new i.P(A.x,A.y);S.sort((k,L)=>{if(L.overscaledZ-k.overscaledZ)return L.overscaledZ-k.overscaledZ;let j=new i.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),V=new i.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),W=F.mult(1<<k.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr(j)-W.distSqr(V)})})(_,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},_.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let S in x){let M=x[S];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,o[S],y),M.usedForTerrain))continue;let A=o[S];M.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[c.id]=_.map(S=>new Cv(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let w={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let M=this.terrainTileForTile[S.key];if(!M)continue;let A=M.tileID.key;A in w||(this._visibleDemTiles.push(M),w[A]=A)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;let f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){let o=this.painter.context,c=o.gl;for(let f in this.terrainTileForTile){let _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),hv(this.painter,_,y))}}_prepareDemTileUniforms(o,c,f,_){if(!c||c.demTexture==null)return!1;let y=o.tileID.canonical,x=Math.pow(2,c.tileID.canonical.z-y.z),w=_||"";return f[`u_dem_tl${w}`]=[y.x*x%1,y.y*x%1],f[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,c=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;let y=_.dem.tree.minimums[0];return y>0&&o++,f+y},0);return o?c/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);let f=this._getLoadedAreaMinimum(),_=new i.dL({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new i.T(o,_,c.R32F,{premultiply:!1}),y}setupElevationDraw(o,c,f){let _=this.painter.context,y=_.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let w=null,S=null,M=1;if(f&&f.morphing&&this._useVertexMorphing){let L=f.morphing.srcDemTile,j=f.morphing.dstDemTile;M=f.morphing.phase,L&&j&&(this._prepareDemTileUniforms(o,L,x,"_prev")&&(S=L),this._prepareDemTileUniforms(o,j,x)&&(w=j))}let A=L=>L&&L.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,F=null;var k;if(this.enabled?S&&w?(F=w.demTexture,_.activeTexture.set(y.TEXTURE4),S.demTexture.bind(A(S),y.CLAMP_TO_EDGE),x.u_dem_lerp=M):(w=this.terrainTileForTile[o.tileID.key],F=this._prepareDemTileUniforms(o,w,x)?w.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),F&&(x.u_dem_size=(k=F).size[0]===1?1:k.size[0]-2,F.bind(A(w),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,c,x),f&&f.useMeterToDem&&w){let L=(1<<w.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=L}if(f&&f.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(_,x),this.painter.transform.projection.name==="globe"){let L=this.globeUniformValues(this.painter.transform,o.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,L)}}globeUniformValues(o,c,f){let _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,i.al,0),u_tile_br_up:_.upVector(c,i.al,i.al),u_tile_bl_up:_.upVector(c,0,i.al),u_tile_up_scale:f?i.dM(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let c=this.painter,f=this.painter.context;o.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,y,x,w,S){if(_.transform.projection.name==="globe")(function(M,A,F,k,L){let j=M.context,V=j.gl,W,q,J=M.transform,ie=i.dE(M,j,J),ee=(Be,Ue)=>{if(q===Ue)return;let Ze=[_m[Ue],"PROJECTION_GLOBE_VIEW"];ie&&Ze.push("CUSTOM_ANTIALIASING");let lt=M.isTileAffectedByFog(Be);W=M.getOrCreateProgram("globeRaster",{defines:Ze,overrideFog:lt}),q=Ue},ge=M.colorModeForRenderPass(),de=new Ht(V.LEQUAL,Ht.ReadWrite,M.depthRangeFor3D);Wl.update(L);let fe=i.dF(J),ue=[i.aF(J.center.lng),i.aJ(J.center.lat)],se=M.globeSharedBuffers,_e=[J.width*i.o.devicePixelRatio,J.height*i.o.devicePixelRatio],Se=Float32Array.from(J.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};{let Be=M.transform,Ue=vm(Be.zoom,A.exaggeration(),A.sourceCache._source.tileSize);q=-1;let Ze=V.TRIANGLES;for(let lt of k){let ke=F.getTile(lt),be=ln.disabled,He=A.prevTerrainTileForTile[lt.key],Le=A.terrainTileForTile[lt.key];_p(He,Le)&&Wl.newMorphing(lt.key,He,Le,L,250),qd(M,ke.emissiveTexture),j.activeTexture.set(V.TEXTURE0),ke.texture&&ke.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Je=Wl.getMorphValuesForProxy(lt.key),yt=Je?1:0;Je&&Object.assign(Ce,{morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:i.dD(Je.phase)}});let Mt=i.dG(lt.canonical),pt=i.dH(Mt.getCenter().lat),ct=i.dI(lt.canonical,Mt,pt,Be.worldSize/Be._pixelsPerMercatorPixel),Vt=i.bk(i.dJ(lt.canonical)),Lt=M.emissiveMode==="mrt-fallback"?1:0,St=gm(Be.expandedFarZProjMatrix,Se,fe,Vt,i.aj(Be.zoom),ue,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,_e,Ue,Be._farZ,Lt,ct);if(ee(lt,yt),W&&(A.setupElevationDraw(ke,W,Ce),M.uploadCommonUniforms(j,W,lt.toUnwrapped()),se)){let[At,Jt,pn]=se.getGridBuffers(pt,Ue!==0);W.draw(M,Ze,de,be,ge,an.backCCW,St,"globe_raster",At,Jt,pn)}}}if(se&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let Be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&Be.push("CUSTOM_ANTIALIASING"),W=M.getOrCreateProgram("globeRaster",{defines:Be});for(let Ue of k){let{x:Ze,y:lt,z:ke}=Ue.canonical,be=lt===0,He=lt===(1<<ke)-1,[Le,Je,yt,Mt]=se.getPoleBuffers(ke,!1);if(Mt&&(be||He)){let pt=F.getTile(Ue);qd(M,pt.emissiveTexture),j.activeTexture.set(V.TEXTURE0),pt.texture&&pt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let ct=i.dK(ke,Ze,J),Vt=i.bk(i.dJ(Ue.canonical)),Lt=M.emissiveMode==="mrt-fallback"?1:0,St=(At,Jt)=>At.draw(M,V.TRIANGLES,de,ln.disabled,ge,an.disabled,gm(J.expandedFarZProjMatrix,ct,ct,Vt,0,ue,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,_e,0,J._farZ,Lt),"globe_pole_raster",Jt,yt,Mt);A.setupElevationDraw(pt,W,Ce),M.uploadCommonUniforms(j,W,Ue.toUnwrapped()),be&&M.renderDefaultNorthPole&&St(W,Le),He&&M.renderDefaultSouthPole&&(ct=i.cS(i.bC(),ct,[1,-1,1]),St(W,Je))}}}})(_,y,x,w,S);else{let M=_.context,A=M.gl,F,k,L=_.shadowRenderer,j=Bc(_,_.longestCutoffRange),V=ge=>{if(k===ge)return;let de=[];de.push(_m[ge]),j.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),L&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),L.useNormalOffset&&de.push("NORMAL_OFFSET")),F=_.getOrCreateProgram("terrainRaster",{defines:de}),k=ge},W=_.colorModeForRenderPass(),q=new Ht(A.LEQUAL,Ht.ReadWrite,_.depthRangeFor3D);Wl.update(S);let J=_.transform,ie=vm(J.zoom,y.exaggeration(),y.sourceCache._source.tileSize),ee=[0,0,0];if(L){let ge=_.style.directionalLight,de=_.style.ambientLight;ge&&de&&(ee=ql(_.style,ge,de))}{k=-1;let ge=A.TRIANGLES,[de,fe]=[y.gridIndexBuffer,y.gridSegments];for(let ue of w){let se=x.getTile(ue),_e=ln.disabled,Se=y.prevTerrainTileForTile[ue.key],Ce=y.terrainTileForTile[ue.key];_p(Se,Ce)&&Wl.newMorphing(ue.key,Se,Ce,S,250),qd(_,se.emissiveTexture),M.activeTexture.set(A.TEXTURE0),se.texture&&se.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let Be=Wl.getMorphValuesForProxy(ue.key),Ue=Be?1:0,Ze;Be&&(Ze={morphing:{srcDemTile:Be.from,dstDemTile:Be.to,phase:i.dD(Be.phase)}});let lt=_.emissiveMode==="mrt-fallback"?1:0,ke=qs(ue.projMatrix,bv(ue.canonical,J.renderWorldCopies)?ie/10:ie,ee,lt);if(V(Ue),!F)continue;y.setupElevationDraw(se,F,Ze);let be=ue.toUnwrapped();L&&L.setupShadows(be,F),_.uploadCommonUniforms(M,F,be,null,j),F.draw(_,ge,q,_e,W,an.backCCW,ke,"terrain_raster",y.gridBuffer,de,fe)}}}})(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let c=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],x=this._drapedRenderBatches.shift(),w=c.style.order,S=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let M=0;for(let A of y){let F=_.getTileByID(A.proxyTileKey),k=_.proxyCachedFBO[A.key]?_.proxyCachedFBO[A.key][o]:void 0,L=k!==void 0?_.renderCache[k]:this.pool[M++],j=k!==void 0;if(F.texture=L.tex,F.emissiveTexture=L.emissiveTex,j&&!L.dirty){S.push(F.tileID);continue}f.bindFramebuffer.set(L.fb.framebuffer);let V=f.gl,W;V.drawBuffers(c.emissiveMode==="mrt-fallback"?[V.COLOR_ATTACHMENT0,V.COLOR_ATTACHMENT1]:[V.COLOR_ATTACHMENT0]),this.renderedToTile=!1,L.dirty&&(f.clear({color:i.ao.transparent,stencil:0}),L.dirty=!1);for(let q=x.start;q<=x.end;++q){let J=c.style._mergedLayers[w[q]];if(J.isHidden(c.transform.zoom))continue;let ie=c.style.getLayerSourceCache(J),ee=ie?this.proxyToSource[A.key][ie.id]:[A];if(!ee)continue;let ge=ee;f.viewport.set([0,0,L.fb.width,L.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(L,ee,J,ie),W=ie?ie.id:null),c.renderLayer(c,ie,J,ge)}if(V.drawBuffers([V.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let J=c.style._mergedLayers[w[q]];if(J.isHidden(c.transform.zoom))continue;let ie=c.style.getLayerSourceCache(J),ee=ie?this.proxyToSource[A.key][ie.id]:[A];if(!ee)continue;let ge=ee;f.viewport.set([0,0,L.fb.width,L.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(L,ee,J,ie),W=ie?ie.id:null),c.renderLayer(c,ie,J,ge)}this.renderedToTile?(L.dirty=!0,S.push(F.tileID)):j||--M,M===5&&(M=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),x.end+1}postRender(){}isLayerOrderingCorrect(o){let c=o.order.length,f=-1,_=c;for(let y=0;y<c;++y)this._style.isLayerDraped(o._mergedLayers[o.order[y]])?f=Math.max(f,y):_=Math.min(_,y);return _>f}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,f){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,w=1<<x.overscaledZ,{x:S,y:M}=x.canonical,A=S/w,F=(S+1)/w,k=M/w,L=(M+1)/w;return{minx:A,miny:k,maxx:F,maxy:L,t:y.dem.tree.raycastRoot(A,k,F,L,o,c,f),tile:y}});_.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of _){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,o,c,f);if(x!=null)return x}return null}_createFBO(){let o=this.painter.context,c=o.gl,f=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);let _=new i.T(o,{width:f[0],height:f[1],data:null},c.RGBA8);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);let y=o.createFramebuffer(f[0],f[1],1,null),x;return y.colorAttachment0.set(_.texture),this._emissiveTexture&&(x=new i.T(o,{width:f[0],height:f[1],data:null},c.R8),x.bind(c.LINEAR,c.CLAMP_TO_EDGE),y.createColorAttachment(o,1),y.colorAttachment1.set(x.texture)),y.depthAttachment=new sb(o,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:y,tex:_,emissiveTex:x,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(let c of this.pool)this._updateFBO(c,o);for(let c of this.proxySourceCache.renderCache)this._updateFBO(c,o);this._emissiveTexture=o}}_updateFBO(o,c){let f=o.fb,_=this.painter.context,y=_.gl,x=this.drapeBufferSize;if(c){let w=new i.T(_,{width:x[0],height:x[1],data:null},y.R8);w.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.emissiveTex=w,f.createColorAttachment(_,1),f.colorAttachment1.set(w.texture)}else o.emissiveTex=void 0,f.removeColorAttachment(_,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let c=this._style._mergedLayers[o],f=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let f of this._style.getSources())if(f instanceof Bu){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="line")continue;let x=_.widthExpression(),w=_.emissiveStrengthExpression();if(x instanceof i.ad||w instanceof i.ad){c[y.id]=!0;for(let S of this.proxyCoords){let M=this.proxyToSource[S.key][y.id];if(M)for(let A of M)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof fo){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let x=_.paint.get("raster-fade-duration");for(let w of this.proxyCoords){let S=this.proxyToSource[w.key][y.id];if(S)for(let M of S){let A=yp(y.getTile(M),y.findLoadedParent(M,0),y,this.painter.transform,x);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(y.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let o=this._style.order,c=o.length;if(c===0)return;let f=[];this._pendingGroundEffectLayers=[];let _,y=0,x=this._style._mergedLayers[o[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<c;)x=this._style._mergedLayers[o[y]];for(;y<c;++y){let w=this._style._mergedLayers[o[y]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?_===void 0&&(_=y):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(f.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:y-1}),f.length!==0){let w=f[f.length-1];this._pendingGroundEffectLayers.every(S=>S>w.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(o){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let x=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let w=0;w<x.length;++w){let S=Object.values(x[w]);c.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,_=this._tilesDirty;for(let x=f.length-1;x>=0;x--){let w=f[x];if(c.getTileByID(w.key),c.proxyCachedFBO[w.key]!==void 0){let S=o[w.key],M=this.proxyToSource[w.key],A=0;for(let F in M){let k=M[F],L=S[F];if(!L||L.length!==k.length||k.some((j,V)=>j!==L[V]||_[F]&&_[F].hasOwnProperty(j.key))){A=-1;break}++A}for(let F in c.proxyCachedFBO[w.key])c.renderCache[c.proxyCachedFBO[w.key][F]].dirty=A<0||A!==Object.values(S).length}}let y=[...this._drapedRenderBatches];y.sort((x,w)=>w.end-w.start-(x.end-x.start));for(let x of y)for(let w of f){if(c.proxyCachedFBO[w.key])continue;let S=c.renderCachePool.pop();S===void 0&&c.renderCache.length<50&&(S=c.renderCache.length,c.renderCache.push(this._createFBO())),S!==void 0&&(c.proxyCachedFBO[w.key]={},c.proxyCachedFBO[w.key][x.start]=S,c.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let w;if(f.isTileClipped())w=c.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):ln.disabled}_renderTileClippingMasks(o,c){let f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(yn.disabled),_.setDepthMode(Ht.disabled);let x=f.getOrCreateProgram("clippingMask");for(let w of o){let S=f._tileClippingMaskIDs[w.key]=--c;x.draw(f,y.TRIANGLES,Ht.disabled,new ln({func:y.ALWAYS,mask:0},S,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,an.disabled,vp(w.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(o){let c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;let f=[o.x,o.y,1,1];i.aC(f,f,c.pixelMatrixInverse),i.cK(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;let _=c._camera.position,y=i.cf(1,c.center.lat),x=[_[0],_[1],_[2]/y,0],w=i.da([],f.slice(0,3),x);i.aw(w,w);let S=this.raycast(x,w,this._exaggeration);return S!==null&&S?(i.bH(x,x,w,S),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(o,c,f){if(o.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(o,c,f);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords;for(let S=0;S<y.length;S++){let M=y[S],A=this._findTileCoveringTileID(M,o);if(A){let F=this._createProxiedId(M,A,f[M.key]&&f[M.key][o.id]);_.push(F),this.proxyToSource[M.key][o.id]=[F]}}let x=!1,w=new Set;for(let S=0;S<c.length;S++){let M=o.getTile(c[S]);if(!M||!M.hasData())continue;let A=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==M.tileID.canonical.z){let F=this.proxyToSource[A.tileID.key][o.id],k=this._createProxiedId(A.tileID,M,f[A.tileID.key]&&f[A.tileID.key][o.id]);F?F.splice(F.length-1,0,k):this.proxyToSource[A.tileID.key][o.id]=[k];let L=this.proxyToSource[A.tileID.key][o.id];w.has(L)||w.add(L),_.push(k),x=!0}}if(this._sourceTilesOverlap[o.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let S of w)S.sort((M,A)=>A.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(o,c,f){if(!o.getSource().loaded())return;let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords,x=o.getSource(),w=x.tileID;if(!w)return;let S=new i.P(w.x,w.y)._div(1<<w.z),M=x.coordinates.map(i.ae.fromLngLat).reduce((F,k)=>(F.min.x=Math.min(F.min.x,k.x-S.x),F.min.y=Math.min(F.min.y,k.y-S.y),F.max.x=Math.max(F.max.x,k.x-S.x),F.max.y=Math.max(F.max.y,k.y-S.y),F),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(F,k)=>{let L=F.wrap+F.canonical.x/(1<<F.canonical.z),j=F.canonical.y/(1<<F.canonical.z),V=i.al/(1<<F.canonical.z),W=k.wrap+k.canonical.x/(1<<k.canonical.z),q=k.canonical.y/(1<<k.canonical.z);return L+V<W+M.min.x||L>W+M.max.x||j+V<q+M.min.y||j>q+M.max.y};for(let F=0;F<y.length;F++){let k=y[F];for(let L=0;L<c.length;L++){let j=o.getTile(c[L]);if(!j||!j.hasData()||A(k,j.tileID))continue;let V=this._createProxiedId(k,j,f[k.key]&&f[k.key][o.id]),W=this.proxyToSource[k.key][o.id];W?W.push(V):this.proxyToSource[k.key][o.id]=[V],_.push(V)}}}_createProxiedId(o,c,f){let _=this.orthoMatrix;if(f){let y=f.find(x=>x.key===c.tileID.key);if(y)return y}if(c.tileID.key!==o.key){let y=o.canonical.z-c.tileID.canonical.z,x,w,S;_=i.bC();let M=c.tileID.wrap-o.wrap<<o.overscaledZ;y>0?(x=i.al>>y,w=x*((c.tileID.canonical.x<<y)-o.canonical.x+M),S=x*((c.tileID.canonical.y<<y)-o.canonical.y)):(x=i.al<<-y,w=i.al*(c.tileID.canonical.x-(o.canonical.x+M<<-y)),S=i.al*(c.tileID.canonical.y-(o.canonical.y<<-y))),i.ce(_,0,x,0,x,0,1),i.br(_,_,[w,S,0])}return new Cv(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let f=c.getTile(o);if(f&&f.hasData())return f;let _=this._findCoveringTileCache[c.id],y=_[o.key];if(f=y?c.getTileByID(y):null,f&&f.hasData()||y===null)return f;let x=f?f.tileID:o,w=x.overscaledZ,S=c.getSource().minzoom,M=[];if(!y){let F=c.getSource().maxzoom;if(o.canonical.z>=F){let k=o.canonical.z-F;c.getSource().reparseOverscaled?(w=Math.max(o.canonical.z+2,c.transform.tileZoom),x=new i.aQ(w,o.wrap,F,o.canonical.x>>k,o.canonical.y>>k)):k!==0&&(w=F,x=new i.aQ(w,o.wrap,F,o.canonical.x>>k,o.canonical.y>>k))}x.key!==o.key&&(M.push(x.key),f=c.getTile(x))}let A=F=>{M.forEach(k=>{_[k]=F}),M.length=0};for(w-=1;w>=S&&(!f||!f.hasData());w--){f&&A(f.tileID.key);let F=x.calculateScaledKey(w);if(f=c.getTileByID(F),f&&f.hasData())break;let k=_[F];if(k===null)break;k===void 0?M.push(F):f=c.getTileByID(k)}return A(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let f=this._tilesDirty[o];f||(f=this._tilesDirty[o]={}),f[c.key]=!0}}function Wd(p,o,c){let f=(function(w,S,M){let A=i.bJ(S,w),F=i.bJ(M,[.2126,.7152,.0722]),k=(j,V,W)=>(1-W)*j+W*V,L=k(1-.3*Math.min(F,1),1,Math.min(A+1,1));return k(.92,1,Math.asin(i.aA(S[2],-1,1))/Math.PI+.5)*L})(p,[0,0,1],o),_=[0,0,0];i.c5(_,c.slice(0,3),f);let y=[0,0,0];i.c5(y,o.slice(0,3),p[2]);let x=[0,0,0];return i.d8(x,_,y),i.db(x)}let rT=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],oT=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class ab{static cacheKey(o,c,f,_){let y=[c];_&&y.push(_.cacheKey);for(let x of f)o.usedDefines.has(x)&&y.push(x);return y.join("/")}constructor(o,c,f,_,y,x){let w=o.gl;this.program=w.createProgram(),this.configuration=_,this.name=c,this.fixedDefines=[...x];let S=`#version 300 es
${(_?_.defines():[]).concat(x.map(V=>`#define ${V}`)).join(`
`)}`,M=[S,XS];for(let V of f.fragmentIncludes)M.push($c[V]);M.push(f.fragmentSource);let A=M.join(`
`),F=[S,Kx];for(let V of f.vertexIncludes)F.push($c[V]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&f.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&F.push("uniform int u_instanceID;"),F.push(f.vertexSource);let k=F.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(k=k.replaceAll("gl_InstanceID","u_instanceID"));let L=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(L,A),w.compileShader(L),w.attachShader(this.program,L);let j=w.createShader(w.VERTEX_SHADER);w.isContextLost()?this.failedToCreate=!0:(w.shaderSource(j,k),w.compileShader(j),w.attachShader(this.program,j),this.attributes={},w.linkProgram(this.program),w.deleteShader(j),w.deleteShader(L),this.fixedUniforms=y(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=_?_.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(V=>({u_instanceID:new i.ch(V)}))(o)),(x.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(V=>({u_dem:new i.ch(V),u_dem_prev:new i.ch(V),u_dem_tl:new i.ck(V),u_dem_scale:new i.cj(V),u_dem_tl_prev:new i.ck(V),u_dem_scale_prev:new i.cj(V),u_dem_size:new i.cj(V),u_dem_lerp:new i.cj(V),u_exaggeration:new i.cj(V),u_depth:new i.ch(V),u_depth_size_inv:new i.ck(V),u_depth_range_unpack:new i.ck(V),u_occluder_half_size:new i.cj(V),u_occlusion_depth_offset:new i.cj(V),u_meter_to_dem:new i.cj(V),u_label_plane_matrix_inv:new i.cl(V)}))(o)),x.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new i.ci(V),u_tile_tr_up:new i.ci(V),u_tile_br_up:new i.ci(V),u_tile_bl_up:new i.ci(V),u_tile_up_scale:new i.cj(V)}))(o)),x.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new i.cl(V),u_fog_range:new i.ck(V),u_fog_color:new i.d3(V),u_fog_horizon_blend:new i.cj(V),u_fog_vertical_limit:new i.ck(V),u_fog_temporal_offset:new i.cj(V),u_frustum_tl:new i.ci(V),u_frustum_tr:new i.ci(V),u_frustum_br:new i.ci(V),u_frustum_bl:new i.ci(V),u_globe_pos:new i.ci(V),u_globe_radius:new i.cj(V),u_globe_transition:new i.cj(V),u_is_globe:new i.ch(V),u_viewport:new i.ck(V)}))(o)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(V=>({u_cutoff_params:new i.d3(V)}))(o)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(V=>({u_lighting_ambient_color:new i.ci(V),u_lighting_directional_dir:new i.ci(V),u_lighting_directional_color:new i.ci(V),u_ground_radiance:new i.ci(V)}))(o)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(V=>({u_light_matrix_0:new i.cl(V),u_light_matrix_1:new i.cl(V),u_fade_range:new i.ck(V),u_shadow_normal_offset:new i.ci(V),u_shadow_intensity:new i.cj(V),u_shadow_texel_size:new i.cj(V),u_shadow_map_resolution:new i.cj(V),u_shadow_direction:new i.ci(V),u_shadow_bias:new i.ci(V),u_shadowmap_0:new i.ch(V),u_shadowmap_1:new i.ch(V)}))(o)))}getAttributeLocation(o,c){let f=this.attributes[c];return f===void 0&&(f=this.attributes[c]=o.getAttribLocation(this.program,c)),f}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setCutoffUniformValues(o,c){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setLightsUniformValues(o,c){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setShadowUniformValues(o,c){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}_drawDebugWireframe(o,c,f,_,y,x,w,S,M,A){let F=o.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let k=o.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||o._terrain&&o._terrain.renderingToTexture||!rT.includes(this.name))||!(!F.layers3D||!oT.includes(this.name))))return;let L=k.gl,j=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,y,k);if(!j)return;let V=[...this.fixedDefines,"DEBUG_WIREFRAME"],W=o.getOrCreateProgram(this.name,{config:this.configuration,defines:V});k.program.set(W.program);let q=(ee,ge,de)=>{if(ge[ee]&&de[ee])for(let fe in ge[ee])de[ee][fe]&&de[ee][fe].set(de.program,fe,ge[ee][fe].current)};M&&M.setUniforms(W.program,k,W.binderUniforms,w,{zoom:S}),q("fixedUniforms",this,W),q("terrainUniforms",this,W),q("globeUniforms",this,W),q("fogUniforms",this,W),q("lightsUniforms",this,W),q("shadowUniforms",this,W),j.bind(),k.setColorMode(new yn([L.ONE,L.ONE_MINUS_SRC_ALPHA,L.ZERO,L.ONE],i.ao.transparent,[!0,!0,!0,!1])),k.setDepthMode(new Ht(c.func===L.LESS?L.LEQUAL:c.func,Ht.ReadOnly,c.range)),k.setStencilMode(ln.disabled);let J=3*x.primitiveLength*2,ie=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let ee=A||1;for(let ge=0;ge<ee;++ge)W.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),L.drawElements(L.LINES,J,L.UNSIGNED_SHORT,ie)}else A&&A>1?L.drawElementsInstanced(L.LINES,J,L.UNSIGNED_SHORT,ie,A):L.drawElements(L.LINES,J,L.UNSIGNED_SHORT,ie);y.bind(),k.program.set(this.program),k.setDepthMode(c),k.setStencilMode(f),k.setColorMode(_)}checkUniforms(o,c,f){if(this.fixedDefines.includes(c)){for(let _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${_} not set but required by ${c} being defined`)}}draw(o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W){let q=o.context,J=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(f),q.setStencilMode(_),q.setColorMode(y),q.setCullFace(x);for(let[ue,se]of this.fixedUniformsEntries)se.set(this.program,ue,w[ue]);j&&j.setUniforms(this.program,q,this.binderUniforms,k,{zoom:L});let ie={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[c];this.checkUniforms(S,"RENDER_SHADOWS",this.shadowUniforms);let ee=V||[],ge=j?j.getPaintVertexBuffers():[],de=c===J.TRIANGLES&&A,fe=W&&W>0?1:void 0;for(let ue of F.get()){let se=ue.vaos||(ue.vaos={});if((se[S]||(se[S]=new YS)).bind(q,this,M,ge,A,ue.vertexOffset,ee,fe),this.forceManualRenderingForInstanceIDShaders){let _e=W||1;for(let Se=0;Se<_e;++Se)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),A?J.drawElements(c,ue.primitiveLength*ie,J.UNSIGNED_SHORT,ue.primitiveOffset*ie*2):J.drawArrays(c,ue.vertexOffset,ue.vertexLength)}else W&&W>1?J.drawElementsInstanced(c,ue.primitiveLength*ie,J.UNSIGNED_SHORT,ue.primitiveOffset*ie*2,W):A?J.drawElements(c,ue.primitiveLength*ie,J.UNSIGNED_SHORT,ue.primitiveOffset*ie*2):J.drawArrays(c,ue.vertexOffset,ue.vertexLength);de&&this._drawDebugWireframe(o,f,_,y,A,ue,k,L,j,W)}}}function lb(p,o,c=0){let f=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,p.transform.tileZoom)/f,y=_*(o.tileID.canonical.x+o.tileID.wrap*f),x=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(o,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:c}}let xm={terrain:0,flat:1},sT=i.bC(),bm=(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q)=>{let J=o.style.light,ie=J.properties.get("position"),ee=[ie.x,ie.y,ie.z],ge=i.dO();J.properties.get("anchor")==="viewport"&&(i.dP(ge,-o.transform.angle),i.dQ(ee,ee,ge));let de=J.properties.get("color").toPremultipliedRenderColor(null),fe=o.transform,ue={u_matrix:p,u_lightpos:ee,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:xm[M],u_base_type:xm[A],u_ao:_,u_edge_radius:y,u_width_scale:x,u_flood_light_color:j,u_vertical_scale:V,u_flood_light_intensity:W,u_ground_shadow_factor:q};return fe.projection.name==="globe"&&(ue.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],ue.u_zoom_transition=F,ue.u_inv_rot_matrix=L,ue.u_merc_center=k,ue.u_up_dir=fe.projection.upVector(new i.cD(0,0,0),k[0]*i.al,k[1]*i.al),ue.u_height_lift=S),ue},Sv=(p,o,c,f,_,y)=>({u_matrix:p,u_edge_radius:o,u_width_scale:c,u_vertical_scale:f,u_height_type:xm[_],u_base_type:xm[y]}),cb=(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q)=>{let J=bm(p,o,c,f,_,y,x,w,M,A,F,k,L,j,V,W,1,[0,0,0]),ie={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return Object.assign(J,lb(o,S,q),ie)},Zd=(p,o,c,f,_,y,x,w,S,M,A)=>({u_matrix:o,u_opacity:c,u_ao_pass:f?1:0,u_meter_to_tile:_,u_ao:y,u_flood_light_intensity:x,u_flood_light_color:w,u_attenuation:S,u_edge_radius:M,u_fb:0,u_fb_size:A,u_dynamic_offset:1}),Tv=(p,o,c)=>({u_matrix:p,u_emissive_strength:o,u_ground_shadow_factor:c}),Iv=(p,o,c,f,_,y=0)=>Object.assign(Tv(p,o,_),lb(c,f,y)),ub=(p,o,c,f)=>({u_matrix:p,u_world:c,u_emissive_strength:o,u_ground_shadow_factor:f}),Mv=(p,o,c,f,_,y,x=0)=>Object.assign(Iv(p,o,c,f,y,x),{u_world:_}),Gc=(p,o)=>({u_matrix:p,u_ground_shadow_factor:o}),Xu=(p,o,c,f,_)=>({u_matrix:p,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:c,u_height_scale:f,u_reset_depth:_}),wm=(p,o,c,f,_,y,x,w,S)=>({u_matrix:p,u_normal_matrix:o,u_opacity:c,u_faux_facade_ao_intensity:f,u_camera_pos:_,u_tile_to_meter:y,u_facade_emissive_chance:x,u_flood_light_color:w,u_flood_light_intensity:S}),db=p=>({u_matrix:p}),qc=p=>({u_matrix:p}),Dv=(p,o,c,f,_,y,x,w)=>{let S=i.al/y.tileSize;return{u_matrix:p,u_inv_rot_matrix:o,u_camera_to_center_distance:c.getCameraToCenterDistance(w),u_extrude_scale:[c.pixelsToGLUnits[0]/S,c.pixelsToGLUnits[1]/S],u_zoom_transition:f,u_tile_id:x,u_merc_center:_}},xp=(p,o,c=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:c}),hb=i.bC(),pb=(p,o,c,f,_,y,x)=>{let w=p.transform,S=w.projection.name==="globe",M=S?i.dR(w.zoom,o.canonical)*w._pixelsPerMercatorPixel:i.ay(c,1,y),A={u_matrix:o.projMatrix,u_extrude_scale:M,u_intensity:x,u_inv_rot_matrix:hb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){A.u_inv_rot_matrix=f,A.u_merc_center=_,A.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],A.u_zoom_transition=i.aj(w.zoom);let F=_[0]*i.al,k=_[1]*i.al;A.u_up_dir=w.projection.upVector(new i.cD(0,0,0),F,k)}return A};function Cm(p,[o,c,f,_],[y,x]){if(y===x)return[0,0,0,0];let w=255*(p-1)/(p*(x-y));return[o*w,c*w,f*w,_*w]}function Em(p,o,[c,f]){return c===f?0:.5/p+(o-c)*(p-1)/(p*(f-c))}let fb=(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J,ie,ee)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(F.paint.get("raster-saturation")),u_contrast_factor:i.dS(F.paint.get("raster-contrast")),u_spin_weights:mb(F.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:L,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S,u_colorization_mix:Cm(i.dU,V,q),u_colorization_offset:Em(i.dU,W,q),u_color_ramp:j,u_texture_offset:[ie/(J+2*ie),J/(J+2*ie)],u_texture_res:[J+2*ie,J+2*ie],u_emissive_strength:ee});function mb(p){p*=Math.PI/180;let o=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}let fl=.05,aT=(p,o,c,f,_,y,x,w,S,M,A,F)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S}),lT=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_tile_offset:c,u_velocity:f,u_color_ramp:y,u_velocity_res:_,u_max_speed:x,u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[fl,fl]}),gb=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_velocity:c,u_velocity_res:f,u_max_speed:_,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[fl,fl]}),_b=i.bC(),Sm=(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J,ie,ee,ge,de,fe)=>{let ue=_.transform,se={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(J),u_rotate_symbol:+c,u_aspect_ratio:ue.width/ue.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+M,u_elevation_from_sea:S?1:0,u_pitch_with_map:+f,u_texsize:A,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_b,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:_b,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:de||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(J)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:fe||1,u_ground_shadow_factor:ie,u_inv_matrix:i.bl(i.bC(),x),u_normal_scale:ee,u_lutTexture:mo.LUT};return J.name==="globe"&&(se.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],se.u_zoom_transition=j,se.u_inv_rot_matrix=W,se.u_merc_center=V,se.u_camera_forward=ue._camera.forward(),se.u_ecef_origin=i.dV(ue.globeMatrix,L.toUnwrapped()),se.u_tile_matrix=Float32Array.from(ue.globeMatrix),se.u_up_vector=q),se},bp=(p,o,c,f)=>({u_matrix:p,u_emissive_strength:o,u_opacity:c,u_color:f}),Wc=(p,o,c,f,_,y,x,w,S)=>Object.assign((function(M,A,F,k,L,j){let{width:V,height:W}=k.imageManager.getPixelSize(A),q=Math.pow(2,j.tileID.overscaledZ),J=j.tileSize*Math.pow(2,k.transform.tileZoom)/q,ie=J*(j.tileID.canonical.x+j.tileID.wrap*q),ee=J*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[V,W],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:L?[k.transform.width,-1*k.transform.height]:[1/i.ay(j,1,k.transform.tileZoom),1/i.ay(j,1,k.transform.tileZoom)],u_pixel_coord_upper:[ie>>16,ee>>16],u_pixel_coord_lower:[65535&ie,65535&ee]}})(0,y,x,f,w,S),{u_matrix:p,u_emissive_strength:o,u_opacity:c}),Xd=new Float32Array(i.bA([])),Yu=(p,o,c,f,_,y,x,w,S,M,A,F,k,L=[0,0,0],j,V,W)=>{let q=_.style.light,J=q.properties.get("position"),ie=[-J.x,-J.y,J.z],ee=i.dO();q.properties.get("anchor")==="viewport"&&(i.dP(ee,-_.transform.angle),i.dQ(ie,ie,ee));let ge=A.alphaMode==="MASK",de=q.properties.get("color").toNonPremultipliedRenderColor(null),fe=k.paint.get("model-ambient-occlusion-intensity"),ue=k.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return ue.a=k.paint.get("model-color-mix-intensity").constantOr(0),W&&(ue.r=W[0],ue.g=W[1],ue.b=W[2],ue.a=W[3]),V&&(ue.r=V.color.r,ue.g=V.color.g,ue.b=V.color.b,ue.a=V.colorMix,F=V.emissionStrength,y*=V.opacity),{u_matrix:p,u_lighting_matrix:o,u_normal_matrix:c,u_node_matrix:f||Xd,u_lightpos:ie,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:L,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:A.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:S,u_roughnessFactor:M,u_baseColorTexture:mo.BaseColor,u_metallicRoughnessTexture:mo.MetallicRoughness,u_normalTexture:mo.Normal,u_occlusionTexture:mo.Occlusion,u_emissionTexture:mo.Emission,u_lutTexture:mo.LUT,u_color_mix:ue.toArray01(),u_aoIntensity:fe,u_emissive_strength:F,u_occlusionTextureTransform:j||[0,0,0,0]}},Av=(p,o=Xd,c=Xd)=>({u_matrix:p,u_instance:o,u_node_matrix:c}),Tm={fillExtrusion:p=>({u_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_vertical_gradient:new i.cj(p),u_opacity:new i.cj(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_ao:new i.ck(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_up_dir:new i.ci(p),u_height_lift:new i.cj(p),u_flood_light_color:new i.ci(p),u_vertical_scale:new i.cj(p),u_flood_light_intensity:new i.cj(p),u_ground_shadow_factor:new i.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new i.cl(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_vertical_scale:new i.cj(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_vertical_gradient:new i.cj(p),u_height_factor:new i.cj(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_ao:new i.ck(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_up_dir:new i.ci(p),u_height_lift:new i.cj(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_opacity:new i.cj(p),u_pattern_transition:new i.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new i.cl(p),u_opacity:new i.cj(p),u_ao_pass:new i.cj(p),u_meter_to_tile:new i.cj(p),u_ao:new i.ck(p),u_flood_light_intensity:new i.cj(p),u_flood_light_color:new i.ci(p),u_attenuation:new i.cj(p),u_edge_radius:new i.cj(p),u_fb:new i.ch(p),u_fb_size:new i.cj(p),u_dynamic_offset:new i.cj(p)}),fill:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_ground_shadow_factor:new i.ci(p)}),fillPattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_pattern_transition:new i.cj(p)}),fillOutline:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_world:new i.ck(p),u_ground_shadow_factor:new i.ci(p)}),fillOutlinePattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_world:new i.ck(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_pattern_transition:new i.cj(p)}),building:p=>({u_matrix:new i.cl(p),u_normal_matrix:new i.cl(p),u_opacity:new i.cj(p),u_faux_facade_ao_intensity:new i.cj(p),u_camera_pos:new i.ci(p),u_tile_to_meter:new i.cj(p),u_facade_emissive_chance:new i.cj(p),u_flood_light_color:new i.ci(p),u_flood_light_intensity:new i.cj(p)}),buildingBloom:p=>({u_matrix:new i.cl(p)}),buildingDepth:p=>({u_matrix:new i.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new i.cl(p),u_depth_bias:new i.cj(p)}),elevatedStructures:p=>({u_matrix:new i.cl(p),u_ground_shadow_factor:new i.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new i.cl(p),u_camera_pos:new i.ci(p),u_depth_bias:new i.cj(p),u_height_scale:new i.cj(p),u_reset_depth:new i.cj(p)}),circle:i.dY,collisionBox:p=>({u_matrix:new i.cl(p),u_inv_rot_matrix:new i.cl(p),u_camera_to_center_distance:new i.cj(p),u_extrude_scale:new i.ck(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_tile_id:new i.ci(p)}),collisionCircle:p=>({u_matrix:new i.cl(p),u_inv_matrix:new i.cl(p),u_camera_to_center_distance:new i.cj(p),u_viewport_size:new i.ck(p)}),debug:p=>({u_color:new i.dB(p),u_matrix:new i.cl(p),u_overlay:new i.ch(p),u_overlay_scale:new i.cj(p)}),clippingMask:p=>({u_matrix:new i.cl(p)}),heatmap:p=>({u_extrude_scale:new i.cj(p),u_intensity:new i.cj(p),u_matrix:new i.cl(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_up_dir:new i.ci(p)}),heatmapTexture:p=>({u_image:new i.ch(p),u_color_ramp:new i.ch(p),u_opacity:new i.cj(p)}),hillshade:p=>({u_matrix:new i.cl(p),u_image:new i.ch(p),u_latrange:new i.ck(p),u_light:new i.ck(p),u_shadow:new i.dB(p),u_highlight:new i.dB(p),u_emissive_strength:new i.cj(p),u_accent:new i.dB(p)}),hillshadePrepare:p=>({u_matrix:new i.cl(p),u_image:new i.ch(p),u_dimension:new i.ck(p),u_zoom:new i.cj(p)}),line:i.dX,linePattern:i.dW,raster:p=>({u_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_grid_matrix:new i.dC(p),u_tl_parent:new i.ck(p),u_scale_parent:new i.cj(p),u_fade_t:new i.cj(p),u_opacity:new i.cj(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_brightness_low:new i.cj(p),u_brightness_high:new i.cj(p),u_saturation_factor:new i.cj(p),u_contrast_factor:new i.cj(p),u_spin_weights:new i.ci(p),u_perspective_transform:new i.ck(p),u_raster_elevation:new i.cj(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_cutoff_params:new i.d3(p),u_colorization_mix:new i.d3(p),u_colorization_offset:new i.cj(p),u_color_ramp:new i.ch(p),u_texture_offset:new i.ck(p),u_texture_res:new i.ck(p),u_emissive_strength:new i.cj(p)}),rasterParticle:p=>({u_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_grid_matrix:new i.dC(p),u_tl_parent:new i.ck(p),u_scale_parent:new i.cj(p),u_fade_t:new i.cj(p),u_opacity:new i.cj(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_raster_elevation:new i.cj(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_cutoff_params:new i.d3(p)}),rasterParticleTexture:p=>({u_texture:new i.ch(p),u_opacity:new i.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new i.ch(p),u_particle_texture_side_len:new i.cj(p),u_tile_offset:new i.ck(p),u_velocity:new i.ch(p),u_color_ramp:new i.ch(p),u_velocity_res:new i.ck(p),u_max_speed:new i.cj(p),u_uv_offset:new i.ck(p),u_data_scale:new i.ck(p),u_data_offset:new i.cj(p),u_particle_pos_scale:new i.cj(p),u_particle_pos_offset:new i.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new i.ch(p),u_particle_texture_side_len:new i.cj(p),u_velocity:new i.ch(p),u_velocity_res:new i.ck(p),u_max_speed:new i.cj(p),u_speed_factor:new i.cj(p),u_reset_rate:new i.cj(p),u_rand_seed:new i.cj(p),u_uv_offset:new i.ck(p),u_data_scale:new i.ck(p),u_data_offset:new i.cj(p),u_particle_pos_scale:new i.cj(p),u_particle_pos_offset:new i.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new i.ch(p),u_is_size_feature_constant:new i.ch(p),u_size_t:new i.cj(p),u_size:new i.cj(p),u_camera_to_center_distance:new i.cj(p),u_rotate_symbol:new i.ch(p),u_aspect_ratio:new i.cj(p),u_fade_change:new i.cj(p),u_matrix:new i.cl(p),u_label_plane_matrix:new i.cl(p),u_coord_matrix:new i.cl(p),u_is_text:new i.ch(p),u_elevation_from_sea:new i.ch(p),u_pitch_with_map:new i.ch(p),u_texsize:new i.ck(p),u_texsize_icon:new i.ck(p),u_texture:new i.ch(p),u_texture_icon:new i.ch(p),u_gamma_scale:new i.cj(p),u_device_pixel_ratio:new i.cj(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_camera_forward:new i.ci(p),u_tile_matrix:new i.cl(p),u_up_vector:new i.ci(p),u_ecef_origin:new i.ci(p),u_is_halo:new i.ch(p),u_icon_transition:new i.cj(p),u_color_adj_mat:new i.cl(p),u_scale_factor:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_inv_matrix:new i.cl(p),u_normal_scale:new i.cj(p),u_lutTexture:new i.ch(p)}),background:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_opacity:new i.cj(p),u_color:new i.dB(p)}),backgroundPattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_opacity:new i.cj(p),u_image:new i.ch(p),u_pattern_tl:new i.ck(p),u_pattern_br:new i.ck(p),u_texsize:new i.ck(p),u_pattern_size:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_pattern_units_to_pixels:new i.ck(p)}),terrainRaster:p=>({u_matrix:new i.cl(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_skirt_height:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_emissive_texture_available:new i.cj(p)}),skybox:p=>({u_matrix:new i.cl(p),u_sun_direction:new i.ci(p),u_cubemap:new i.ch(p),u_opacity:new i.cj(p),u_temporal_offset:new i.cj(p)}),skyboxGradient:p=>({u_matrix:new i.cl(p),u_color_ramp:new i.ch(p),u_center_direction:new i.ci(p),u_radius:new i.cj(p),u_opacity:new i.cj(p),u_temporal_offset:new i.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new i.dC(p),u_sun_direction:new i.ci(p),u_sun_intensity:new i.cj(p),u_color_tint_r:new i.d3(p),u_color_tint_m:new i.d3(p),u_luminance:new i.cj(p)}),globeRaster:p=>({u_proj_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_grid_matrix:new i.dC(p),u_skirt_height:new i.cj(p),u_far_z_cutoff:new i.cj(p),u_frustum_tl:new i.ci(p),u_frustum_tr:new i.ci(p),u_frustum_br:new i.ci(p),u_frustum_bl:new i.ci(p),u_globe_pos:new i.ci(p),u_globe_radius:new i.cj(p),u_viewport:new i.ck(p),u_emissive_texture_available:new i.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new i.ci(p),u_frustum_tr:new i.ci(p),u_frustum_br:new i.ci(p),u_frustum_bl:new i.ci(p),u_horizon:new i.cj(p),u_transition:new i.cj(p),u_fadeout_range:new i.cj(p),u_atmosphere_fog_color:new i.d3(p),u_high_color:new i.d3(p),u_space_color:new i.d3(p),u_temporal_offset:new i.cj(p),u_horizon_angle:new i.cj(p)}),model:p=>({u_matrix:new i.cl(p),u_lighting_matrix:new i.cl(p),u_normal_matrix:new i.cl(p),u_node_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_camera_pos:new i.ci(p),u_opacity:new i.cj(p),u_baseColorFactor:new i.d3(p),u_emissiveFactor:new i.d3(p),u_metallicFactor:new i.cj(p),u_roughnessFactor:new i.cj(p),u_baseTextureIsAlpha:new i.ch(p),u_alphaMask:new i.ch(p),u_alphaCutoff:new i.cj(p),u_baseColorTexture:new i.ch(p),u_metallicRoughnessTexture:new i.ch(p),u_normalTexture:new i.ch(p),u_occlusionTexture:new i.ch(p),u_emissionTexture:new i.ch(p),u_lutTexture:new i.ch(p),u_color_mix:new i.d3(p),u_aoIntensity:new i.cj(p),u_emissive_strength:new i.cj(p),u_occlusionTextureTransform:new i.d3(p)}),modelDepth:p=>({u_matrix:new i.cl(p),u_instance:new i.cl(p),u_node_matrix:new i.cl(p)}),groundShadow:p=>({u_matrix:new i.cl(p),u_ground_shadow_factor:new i.ci(p)}),stars:p=>({u_matrix:new i.cl(p),u_up:new i.ci(p),u_right:new i.ci(p),u_intensity_multiplier:new i.cj(p)}),snowParticle:p=>({u_modelview:new i.cl(p),u_projection:new i.cl(p),u_time:new i.cj(p),u_cam_pos:new i.ci(p),u_velocityConeAperture:new i.cj(p),u_velocity:new i.cj(p),u_horizontalOscillationRadius:new i.cj(p),u_horizontalOscillationRate:new i.cj(p),u_boxSize:new i.cj(p),u_billboardSize:new i.cj(p),u_simpleShapeParameters:new i.ck(p),u_screenSize:new i.ck(p),u_thinningCenterPos:new i.ck(p),u_thinningShape:new i.ci(p),u_thinningAffectedRatio:new i.cj(p),u_thinningParticleOffset:new i.cj(p),u_particleColor:new i.d3(p),u_direction:new i.ci(p)}),rainParticle:p=>({u_modelview:new i.cl(p),u_projection:new i.cl(p),u_time:new i.cj(p),u_cam_pos:new i.ci(p),u_texScreen:new i.ch(p),u_velocityConeAperture:new i.cj(p),u_velocity:new i.cj(p),u_boxSize:new i.cj(p),u_rainDropletSize:new i.ck(p),u_distortionStrength:new i.cj(p),u_rainDirection:new i.ci(p),u_color:new i.d3(p),u_screenSize:new i.ck(p),u_thinningCenterPos:new i.ck(p),u_thinningShape:new i.ci(p),u_thinningAffectedRatio:new i.cj(p),u_thinningParticleOffset:new i.cj(p),u_shapeDirectionalPower:new i.cj(p),u_shapeNormalPower:new i.cj(p),u_mode:new i.cj(p)}),vignette:p=>({u_vignetteShape:new i.ci(p),u_vignetteColor:new i.d3(p)}),occlusion:p=>({u_matrix:new i.cl(p),u_anchorPos:new i.ci(p),u_screenSizePx:new i.ck(p),u_occluderSizePx:new i.ck(p),u_color:new i.d3(p)})},wp=(()=>{class p{constructor(c,f,_,y){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++,this.context=c;let x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return p.uniqueIdxCounter=0,p})(),Pv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vb{constructor(o,c,f,_,y,x){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.instanceCount=x,this.context=o;let w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let f=0;f<this.attributes.length;f++){let _=c.getAttributeLocation(o,this.attributes[f].name);_!==-1&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=this.attributes[_],x=c.getAttributeLocation(o,y.name);x!==-1&&o.vertexAttribPointer(x,y.components,o[Pv[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=c.getAttributeLocation(o,this.attributes[_].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yb{constructor(o,c,f,_,y){this.context=o,this.width=c,this.height=f;let x=this.framebuffer=o.gl.createFramebuffer();_>0&&(this.colorAttachment0=new mm(o,x,0)),_>1&&(this.colorAttachment1=new mm(o,x,1)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Gd(o,x):new gp(o,x))}createColorAttachment(o,c){c===0?this.colorAttachment0=new mm(o,this.framebuffer,0):c===1&&(this.colorAttachment1=new mm(o,this.framebuffer,1))}removeColorAttachment(o,c){let f=this.context.gl,_;c===0?(_=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(_=this.colorAttachment1.get(),this.colorAttachment1=void 0),_&&f.deleteTexture(_)}destroy(){let o=this.context.gl;if(this.colorAttachment0){let c=this.colorAttachment0.get();c&&o.deleteTexture(c)}if(this.colorAttachment1){let c=this.colorAttachment1.get();c&&o.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&o.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&o.deleteTexture(c)}o.deleteFramebuffer(this.framebuffer)}}class Yd{constructor(o,c){this.gl=o,this.clearColor=new eT(this),this.clearDepth=new Qx(this),this.clearStencil=new pv(this),this.colorMask=new um(this),this.depthMask=new fv(this),this.stencilMask=new Zu(this),this.stencilFunc=new Ud(this),this.stencilOp=new fp(this),this.stencilTest=new jd(this),this.depthRange=new Jx(this),this.depthTest=new mv(this),this.depthFunc=new eb(this),this.blend=new $d(this),this.blendFunc=new dm(this),this.blendColor=new hm(this),this.blendEquation=new gv(this),this.cullFace=new pm(this),this.cullFaceSide=new mp(this),this.frontFace=new tb(this),this.program=new nb(this),this.activeTexture=new ib(this),this.viewport=new Hd(this),this.bindFramebuffer=new rb(this),this.bindRenderbuffer=new tT(this),this.bindTexture=new nT(this),this.bindVertexBuffer=new iT(this),this.bindElementBuffer=new _v(this),this.bindVertexArrayOES=new vv(this),this.pixelStoreUnpack=new yv(this),this.pixelStoreUnpackPremultiplyAlpha=new xv(this),this.pixelStoreUnpackFlipY=new ob(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c,f){return new wp(this,o,c,f)}createVertexBuffer(o,c,f,_,y){return new vb(this,o,c,f,_,y)}createRenderbuffer(o,c,f){let _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,o,c,f),this.bindRenderbuffer.set(null),y}createFramebuffer(o,c,f,_){return new yb(this,o,c,f,_)}clear({color:o,depth:c,stencil:f,colorMask:_}){let y=this.gl,x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.by(o.blendFunction,yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ku;function kt(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=p.transform,A=[i.aF(M.center.lng),i.aJ(M.center.lat)],F=c.layout.get("symbol-placement"),k=c.layout.get("text-variable-anchor"),L=c.layout.get("icon-rotation-alignment")==="map",j=c.layout.get("text-rotation-alignment")==="map",V=F!=="point",W=[],q=0,J=0;for(let se=0;se<f.length;se++){let _e=f[se],Se=o.getTile(_e),Ce=Se.getBucket(c);if(!Ce)continue;let Be=Ce.getProjection().createInversionMatrix(M,_e.canonical),Ue=[],Ze=Wf(_e,Ce,M),lt=!x&&L&&V,ke=x&&j&&V,be=k&&Ce.hasTextData(),He=Ce.hasIconTextFit()&&be&&Ce.hasIconData(),Le=lt||ke||x&&be||He,Je=Ce.projection.name==="globe",yt=Je?i.aj(M.zoom):0;Je&&(Ue.push("PROJECTION_GLOBE_VIEW"),Le&&Ue.push("PROJECTED_POS_ON_VIEWPORT"));let Mt=p.getOrCreateProgram("collisionBox",{defines:Ue}),pt=Ze;_[0]===0&&_[1]===0||(pt=p.translatePosMatrix(Ze,Se,_,y));let ct=x?Ce.textCollisionBox:Ce.iconCollisionBox,Vt=Ce.collisionCircleArray;if(Vt.length>0){let St=i.bC(),At=pt;i.cP(St,Ce.placementInvProjMatrix,M.glCoordMatrix),i.cP(St,St,Ce.placementViewportMatrix),W.push({circleArray:Vt,circleOffset:J,transform:At,invTransform:St,projection:Ce.getProjection()}),q+=Vt.length/4,J=q}if(!ct)continue;p.terrain&&p.terrain.setupElevationDraw(Se,Mt);let Lt=Je?[_e.canonical.x,_e.canonical.y,1<<_e.canonical.z]:[0,0,0];Mt.draw(p,S.LINES,Ht.disabled,ln.disabled,p.colorModeForRenderPass(),an.disabled,Dv(pt,Be,M,yt,A,Se,Lt,Ce.getProjection()),c.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,M.zoom,null,[ct.collisionVertexBuffer,ct.collisionVertexBufferExt])}if(!x||!W.length)return;let ie=p.getOrCreateProgram("collisionCircle"),ee=new i.dZ;ee.resize(4*q),ee._trim();let ge=0;for(let se of W)for(let _e=0;_e<se.circleArray.length/4;_e++){let Se=4*_e,Ce=se.circleArray[Se+0],Be=se.circleArray[Se+1],Ue=se.circleArray[Se+2],Ze=se.circleArray[Se+3];ee.emplace(ge++,Ce,Be,Ue,Ze,0),ee.emplace(ge++,Ce,Be,Ue,Ze,1),ee.emplace(ge++,Ce,Be,Ue,Ze,2),ee.emplace(ge++,Ce,Be,Ue,Ze,3)}(!Ku||Ku.length<2*q)&&(Ku=(function(se){let _e=2*se,Se=new i.b0;Se.resize(_e),Se._trim();for(let Ce=0;Ce<_e;Ce++){let Be=6*Ce;Se.uint16[Be+0]=4*Ce+0,Se.uint16[Be+1]=4*Ce+1,Se.uint16[Be+2]=4*Ce+2,Se.uint16[Be+3]=4*Ce+2,Se.uint16[Be+4]=4*Ce+3,Se.uint16[Be+5]=4*Ce+0}return Se})(q));let de=w.createIndexBuffer(Ku,!0),fe=w.createVertexBuffer(ee,i.d_.members,!0);for(let se of W){let _e={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ue=M).getCameraToCenterDistance(se.projection),u_viewport_size:[ue.width,ue.height]};ie.draw(p,S.TRIANGLES,Ht.disabled,ln.disabled,p.colorModeForRenderPass(),an.disabled,_e,c.id,fe,de,i.bg.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,M.zoom)}var ue;fe.destroy(),de.destroy()}let Cp=i.bC();function Zl(p){let o=p._camera.getWorldToCamera(p.worldSize,1),c=i.aB([],o,p.globeMatrix);i.bl(c,c);let f=[0,0,0],_=[0,1,0,0];return i.aC(_,_,c),f[0]=_[0],f[1]=_[1],f[2]=_[2],i.aw(f,f),f}function Zc({width:p,height:o,anchor:c,textOffset:f,textScale:_},y){let{horizontalAlign:x,verticalAlign:w}=i.c1(c),S=-(x-.5)*p,M=-(w-.5)*o,A=i.c2(c,f);return new i.P((S/_+A[0])*y,(M/_+A[1])*y)}function en(p,o,c,f,_,y,x,w,S,M){let A=p.text.placedSymbolArray,F=p.text.dynamicLayoutVertexArray,k=p.icon.dynamicLayoutVertexArray,L={},j=p.getProjection(),V=cl(x,j,_),W=_.elevation,q=j.upVectorScale(x.canonical,_.center.lat,_.worldSize).metersToTile;F.clear();for(let J=0;J<A.length;J++){let ie=A.get(J),{tileAnchorX:ee,tileAnchorY:ge,numGlyphs:de}=ie,fe=ie.hidden||!ie.crossTileID||p.allowVerticalPlacement&&!ie.placedOrientation?null:f[ie.crossTileID];if(fe){let ue=0,se=0,_e=0,Se=p.elevationType==="road";if(W||Se){let Le=Se?p.getElevationFeatureForText(J):null,Je=i.bV.getAtTileOffset(x,new i.P(ee,ge),W,Le),[yt,Mt,pt]=j.upVector(x.canonical,ee,ge);ue=Je*yt*q,se=Je*Mt*q,_e=Je*pt*q}let[Ce,Be,Ue,Ze]=ha(ie.projectedAnchorX+ue,ie.projectedAnchorY+se,ie.projectedAnchorZ+_e,c?V:y),lt=ci(_.getCameraToCenterDistance(j),Ze),ke=i.bM(p.textSizeData,S,ie)*lt/i.bY;c&&(ke*=p.tilePixelRatio/w);let be=Zc(fe,ke);c?({x:Ce,y:Be,z:Ue}=j.projectTilePoint(ee+be.x,ge+be.y,x.canonical),[Ce,Be,Ue]=ha(Ce+ue,Be+se,Ue+_e,y)):(o&&be._rotate(-_.angle),Ce+=be.x,Be+=be.y,Ue=0);let He=p.allowVerticalPlacement&&ie.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let Le=0;Le<de;Le++)i.bO(F,Ce,Be,Ue,He);M&&ie.associatedIconIndex>=0&&(L[ie.associatedIconIndex]={x:Ce,y:Be,z:Ue,angle:He})}else za(de,F)}if(M){k.clear();let J=p.icon.placedSymbolArray;for(let ie=0;ie<J.length;ie++){let ee=J.get(ie),{numGlyphs:ge}=ee,de=L[ie];if(ee.hidden||!de)za(ge,k);else{let{x:fe,y:ue,z:se,angle:_e}=de;for(let Se=0;Se<ge;Se++)i.bO(k,fe,ue,se,_e)}}p.icon.dynamicLayoutVertexBuffer.updateData(k)}p.text.dynamicLayoutVertexBuffer.updateData(F)}function Ep(p,o,c,f,_,y,x={}){let w=c.paint.get("icon-translate"),S=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),A=c.paint.get("text-translate-anchor"),F=c.layout.get("icon-rotation-alignment"),k=c.layout.get("text-rotation-alignment"),L=c.layout.get("icon-pitch-alignment"),j=c.layout.get("text-pitch-alignment"),V=c.layout.get("icon-keep-upright"),W=c.layout.get("text-keep-upright"),q=c.paint.get("icon-color-saturation"),J=c.paint.get("icon-color-contrast"),ie=c.paint.get("icon-color-brightness-min"),ee=c.paint.get("icon-color-brightness-max"),ge=c.layout.get("symbol-elevation-reference")==="sea",de=c.layout.get("icon-image-use-theme")==="none",fe=p.context,ue=fe.gl,se=p.transform,_e=F==="map",Se=k==="map",Ce=L==="map",Be=j==="map",Ue=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ze=!1,lt=p.depthModeForSublayer(0,Ht.ReadOnly),ke=new Ht(p.context.gl.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D),be=[i.aF(se.center.lng),i.aJ(se.center.lat)],He=c.layout.get("text-variable-anchor"),Le=se.projection.name==="globe",Je=[],yt=[0,-1,0];for(let Mt of f){let pt=o.getTile(Mt),ct=pt.getBucket(c);if(!ct||ct.projection.name==="mercator"&&Le||ct.fullyClipped)continue;let Vt=ct.projection.name==="globe",Lt=Vt?i.aj(se.zoom):0,St=cl(Mt,ct.getProjection(),se),At=se.calculatePixelsToTileUnitsMatrix(pt),Jt=He&&ct.hasTextData(),pn=ct.hasIconTextFit()&&Jt&&ct.hasIconData(),Fn=ct.getProjection().createInversionMatrix(se,Mt.canonical),Jn=(1<<pt.tileID.canonical.z)*i.al/p.transform.worldSize,Ut=ri=>{let jn=[0,0,0];if(ri){let wn=p.style.directionalLight,Bi=p.style.ambientLight;wn&&Bi&&(jn=ql(p.style,wn,Bi))}return jn},Xn=ri=>{se.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},hn=ri=>{c.lut&&!de&&(c.lut.texture||(c.lut.texture=new i.d$(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],fe.gl.RGBA8)),fe.activeTexture.set(fe.gl.TEXTURE0+mo.LUT),c.lut.texture&&c.lut.texture.bind(fe.gl.LINEAR,fe.gl.CLAMP_TO_EDGE),ri.push("APPLY_LUT_ON_GPU"))},ii=()=>{let ri=_e&&c.layout.get("symbol-placement")!=="point",jn=[];Xn(jn),hn(jn);let wn=ri||pn,Bi=ct.elevationType==="road",br=p.shadowRenderer,er=Bi&&Ce&&!!br&&br.enabled,Ei=Ut(er),us=Bi&&Ce&&!p.terrain?ke:lt,Io=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ce&&jn.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(jn.push("PROJECTION_GLOBE_VIEW"),wn&&jn.push("PROJECTED_POS_ON_VIEWPORT")),Io>0&&ct.hasAnySecondaryIcon&&jn.push("ICON_TRANSITION"),!ct.icon.zOffsetVertexBuffer||Bi&&p.terrain||jn.push("Z_OFFSET"),q===0&&J===0&&ie===0&&ee===1||jn.push("COLOR_ADJUSTMENT"),ct.sdfIcons&&jn.push("RENDER_SDF"),er&&jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bi&&Ce&&!p.terrain&&ct.icon.orientationVertexBuffer&&jn.push("ELEVATED_ROADS");let Zr=ct.icon.programConfigurations.get(c.id),Vo=p.getOrCreateProgram("symbol",{config:Zr,defines:jn}),Uo=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],yo=ct.iconSizeData,Xs=i.bK(yo,se.zoom),xa=Ce||!se.isOrthographic,Es=Yo(St,pt.tileID.canonical,Ce,_e,se,ct.getProjection(),At),pr=rp(St,pt.tileID.canonical,Ce,_e,se,ct.getProjection(),At),Tr=p.translatePosMatrix(pr,pt,w,M,!0),Si=p.translatePosMatrix(St,pt,w,M),Or=wn?Cp:Es,lr=_e&&!Ce&&!ri,tr=yt;!Le&&!se.mercatorFromTransition||_e||(tr=Zl(se));let ba=Vt?tr:yt,Lp=c.getColorAdjustmentMatrix(q,J,ie,ee),$a=Sm(yo.kind,Xs,lr,Ce,p,Si,Or,Tr,ge,!1,Uo,[0,0],0,Mt,Lt,be,Fn,ba,ct.getProjection(),Ei,Jn,Lp,Io,null),Np=pt.imageAtlasTexture?pt.imageAtlasTexture:null,oh=c.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear,yl=ct.sdfIcons||p.options.rotating||p.options.zooming||oh||xa?ue.LINEAR:ue.NEAREST,ic=ct.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,sh=p.terrain&&Ce&&ri?i.bl(i.bC(),Es):Cp;if(ri&&ct.icon){let Jc=i.bV.getAtTileOffsetFunc(Mt,se.center.lat,se.worldSize,ct.getProjection()),rc=Zf(St,pt.tileID.canonical,Ce,_e,se,ct.getProjection(),At),Ha=c.layout.get("icon-size-scale-range"),oc=i.aA(p.scaleFactor,Ha[0],Ha[1]);$x(ct,St,p,!1,rc,pr,Ce,V,Jc,Mt,oc)}return{program:Vo,buffers:ct.icon,uniformValues:$a,atlasTexture:Np,atlasTextureIcon:null,atlasInterpolation:yl,atlasInterpolationIcon:null,isSDF:ct.sdfIcons,hasHalo:ic,depthMode:us,tile:pt,renderWithShadows:er,labelPlaneMatrixInv:sh}},fi=()=>{let ri=Se&&c.layout.get("symbol-placement")!=="point",jn=[],wn=ri||He||pn,Bi=ct.elevationType==="road",br=p.shadowRenderer,er=Bi&&Be&&!!br&&br.enabled,Ei=Ut(er),us=Bi&&Be&&!p.terrain?ke:lt;p.terrainRenderModeElevated()&&Be&&jn.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(jn.push("PROJECTION_GLOBE_VIEW"),wn&&jn.push("PROJECTED_POS_ON_VIEWPORT")),!ct.text.zOffsetVertexBuffer||Bi&&p.terrain||jn.push("Z_OFFSET"),ct.iconsInText&&jn.push("RENDER_TEXT_AND_SYMBOL"),jn.push("RENDER_SDF"),er&&jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bi&&Be&&!p.terrain&&ct.text.orientationVertexBuffer&&jn.push("ELEVATED_ROADS"),Xn(jn);let Io=ct.text.programConfigurations.get(c.id),Zr=p.getOrCreateProgram("symbol",{config:Io,defines:jn}),Vo,Uo=[0,0],yo=null,Xs=ct.textSizeData;ct.iconsInText&&(Uo=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],yo=pt.imageAtlasTexture?pt.imageAtlasTexture:null,Vo=Be||!se.isOrthographic||p.options.rotating||p.options.zooming||Xs.kind==="composite"||Xs.kind==="camera"?ue.LINEAR:ue.NEAREST);let xa=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],Es=c.layout.get("text-size-scale-range"),pr=i.aA(p.scaleFactor,Es[0],Es[1]),Tr=i.bK(Xs,se.zoom,pr),Si=Yo(St,pt.tileID.canonical,Be,Se,se,ct.getProjection(),At),Or=rp(St,pt.tileID.canonical,Be,Se,se,ct.getProjection(),At),lr=p.translatePosMatrix(Or,pt,S,A,!0),tr=p.translatePosMatrix(St,pt,S,A),ba=wn?Cp:Si,Lp=Se&&!Be&&!ri,$a=yt;!Le&&!se.mercatorFromTransition||Se||($a=Zl(se));let Np=Sm(Xs.kind,Tr,Lp,Be,p,tr,ba,lr,ge,!0,xa,Uo,0,Mt,Lt,be,Fn,Vt?$a:yt,ct.getProjection(),Ei,Jn,null,null,pr),oh=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,yl=ue.LINEAR,ic=c.paint.get("text-halo-width").constantOr(1)!==0,sh=p.terrain&&Be&&ri?i.bl(i.bC(),Si):Cp;if(ri&&ct.text){let Jc=i.bV.getAtTileOffsetFunc(Mt,se.center.lat,se.worldSize,ct.getProjection()),rc=Zf(St,pt.tileID.canonical,Be,Se,se,ct.getProjection(),At);$x(ct,St,p,!0,rc,Or,Be,W,Jc,Mt,pr)}return{program:Zr,buffers:ct.text,uniformValues:Np,atlasTexture:oh,atlasTextureIcon:yo,atlasInterpolation:yl,atlasInterpolationIcon:Vo,isSDF:!0,hasHalo:ic,depthMode:us,tile:pt,renderWithShadows:er,labelPlaneMatrixInv:sh}},ui=ct.icon.segments.get().length,Wn=ct.text.segments.get().length,bn=ui&&!x.onlyText?ii():null,ti=Wn&&!x.onlyIcons?fi():null,ar=c.paint.get("icon-opacity").constantOr(1),qi=c.paint.get("text-opacity").constantOr(1);if(Ue&&ct.canOverlap){Ze=!0;let ri=ar&&!x.onlyText?ct.icon.segments.get():[],jn=qi&&!x.onlyIcons?ct.text.segments.get():[];for(let wn of ri)Je.push({segments:new i.bg([wn]),sortKey:wn.sortKey,state:bn});for(let wn of jn)Je.push({segments:new i.bg([wn]),sortKey:wn.sortKey,state:ti})}else x.onlyText||Je.push({segments:ar?ct.icon.segments:new i.bg([]),sortKey:0,state:bn}),x.onlyIcons||Je.push({segments:qi?ct.text.segments:new i.bg([]),sortKey:0,state:ti})}Ze&&Je.sort((Mt,pt)=>Mt.sortKey-pt.sortKey);for(let Mt of Je){let pt=Mt.state;if(pt)if(p.terrain?p.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:se.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(se.depthOcclusionForSymbolsAndCircles,pt.program),fe.activeTexture.set(ue.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,ue.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(fe.activeTexture.set(ue.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,ue.CLAMP_TO_EDGE,!0)),pt.renderWithShadows&&p.shadowRenderer.setupShadows(pt.tile.tileID.toUnwrapped(),pt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,pt.program),pt.hasHalo){let ct=pt.uniformValues;ct.u_is_halo=1,Ov(pt.buffers,Mt.segments,c,p,pt.program,pt.depthMode,_,y,ct,2),ct.u_is_halo=0}else{if(pt.isSDF){let ct=pt.uniformValues;pt.hasHalo&&(ct.u_is_halo=1,Ov(pt.buffers,Mt.segments,c,p,pt.program,pt.depthMode,_,y,ct,1)),ct.u_is_halo=0}Ov(pt.buffers,Mt.segments,c,p,pt.program,pt.depthMode,_,y,pt.uniformValues,1)}}}function Ov(p,o,c,f,_,y,x,w,S,M){let A=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,y,x,w,an.disabled,S,c.id,p.layoutVertexBuffer,p.indexBuffer,o,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),A,M)}function xb(p,o){let c=1<<p.canonical.z,f=(o.x*c-p.canonical.x-p.wrap*c)*i.al,_=(o.y*c-p.canonical.y)*i.al,y=i.e8(o.z,o.y);return i.d5(f,_,y)}function Im(p,o,c,f,_){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let y=p.context.gl,x=new Ht(p.context.gl.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D),w=new Ht(p.context.gl.GREATER,Ht.ReadWrite,p.depthRangeFor3D),S=(function(L){let j=.01;return L.isOrthographic&&(j=i.ak(1e-4,j,i.d0(L.pitch>=Va?1:L.pitch/Va))),2*j})(p.transform),M=p.transform.getFreeCameraOptions().position,A="elevatedStructuresDepthReconstruct",F=p.getOrCreateProgram(A,{defines:["DEPTH_RECONSTRUCTION"]}),k=p.getOrCreateProgram(A);for(let L of f){let j=o.getTile(L),V=j.getBucket(c);if(!V)continue;let W=V.elevatedStructures;if(!W)continue;let q=V.elevationBufferData.heightRange,J=xb(L.toUnwrapped(),M),ie=p.translatePosMatrix(L.projMatrix,j,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),ee,ge,de,fe;if(_==="initialize"){if(!q||q.min>=1||W.depthSegments.segments[0].primitiveLength===0)continue;ee=Xu(ie,J,S,1,0),ge=x,de=W.depthSegments,fe=F}else if(_==="reset"){if(!q||q.min>=0||W.maskSegments.segments[0].primitiveLength===0)continue;ee=Xu(ie,J,0,0,1),ge=w,de=W.maskSegments,fe=F}else if(_==="geometry"){if(W.depthSegments.segments[0].primitiveLength===0)continue;ee=Xu(ie,J,S,1,0),ge=x,de=W.depthSegments,fe=k}fe.draw(p,y.TRIANGLES,ge,ln.disabled,yn.disabled,an.disabled,ee,c.id,W.vertexBuffer,W.indexBuffer,de,c.paint,p.transform.zoom)}}function Mm(p,o,c,f){let{painter:_,sourceCache:y,layer:x,coords:w,colorMode:S,elevationType:M,terrainEnabled:A,pass:F}=p,k=_.context.gl,L=x.paint.get("fill-pattern"),j=x.paint.get("fill-pattern-cross-fade"),V=L.constantOr(null),W=M;M!=="road"||o&&!A||(W="none");let q=W==="road",J=p.painter.shadowRenderer,ie=q&&!!J&&J.enabled,ee=new Ht(_.context.gl.LEQUAL,Ht.ReadOnly,_.depthRangeFor3D),ge=[0,0,0];if(ie){let se=_.style.directionalLight,_e=_.style.ambientLight;se&&_e&&(ge=ql(_.style,se,_e))}let de=L&&L.constantOr(1),fe=_.terrain&&_.terrain.renderingToTexture,ue=(se,_e)=>{let Se,Ce,Be,Ue,Ze;_e?(Se=de&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=k.LINES):(Se=de?"fillPattern":"fill",Be=k.TRIANGLES);for(let lt of w){let ke=y.getTile(lt);if(de&&!ke.patternsLoaded())continue;let be=ke.getBucket(x);if(!be)continue;let He=o?be.elevationBufferData:be.bufferData;if(He.isEmpty())continue;_.prepareDrawTile();let Le=He.programConfigurations.get(x.id),Je=_.isTileAffectedByFog(lt),yt=[],Mt=[];q&&(yt.push("ELEVATED_ROADS"),Mt.push(He.elevatedLayoutVertexBuffer)),ie&&yt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fe&&c&&yt.push("USE_MRT1"),de&&(_.context.activeTexture.set(k.TEXTURE0),ke.imageAtlasTexture&&ke.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Le.updatePaintBuffers());let pt=!1;if(V&&ke.imageAtlas){let At=ke.imageAtlas,Jt=i.e3.from(V),pn=Jt.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Fn=Jt.getSecondary(),Jn=At.patternPositions.get(pn),Ut=Fn?At.patternPositions.get(Fn.scaleSelf(i.o.devicePixelRatio).toString()):null;pt=!!Jn&&!!Ut,Jn&&Le.setConstantPatternPositions(Jn,Ut)}j>0&&(pt||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&yt.push("FILL_PATTERN_TRANSITION");let ct=_.getOrCreateProgram(Se,{config:Le,overrideFog:Je,defines:yt}),Vt=_.translatePosMatrix(lt.projMatrix,ke,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ie&&J.setupShadows(ke.tileID.toUnwrapped(),ct,"vector-tile");let Lt=x.paint.get("fill-emissive-strength");if(_e){Ue=He.lineIndexBuffer,Ze=He.lineSegments;let At=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Ce=Se==="fillOutlinePattern"&&de?Mv(Vt,Lt,_,ke,At,ge,j):ub(Vt,Lt,At,ge)}else Ue=He.indexBuffer,Ze=He.triangleSegments,Ce=de?Iv(Vt,Lt,_,ke,ge,j):Tv(Vt,Lt,ge);_.uploadCommonUniforms(_.context,ct,lt.toUnwrapped());let St=se;(M==="road"&&!A||M==="offset")&&(St=ee),ct.draw(_,Be,St,f||_.stencilModeForClipping(lt),S,an.disabled,Ce,x.id,He.layoutVertexBuffer,Ue,Ze,x.paint,_.transform.zoom,Le,Mt)}};_.renderPass===F&&ue(_.depthModeForSublayer(1,_.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly),!1),W==="none"&&_.renderPass==="translucent"&&x.paint.get("fill-antialias")&&ue(_.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly),!0)}function Dm(p,o,c,f,_,y,x,w){c.resetLayerRenderingStats(p);let S=p.context,M=S.gl,A=p.transform,F=c.paint.get("fill-extrusion-pattern"),k=c.paint.get("fill-extrusion-pattern-cross-fade"),L=F.constantOr(null),j=F.constantOr(1),V=c.paint.get("fill-extrusion-opacity"),W=p.style.enable3dLights(),q=c.paint.get(W&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],ie=c.layout.get("fill-extrusion-edge-radius"),ee=ie>0&&!c.paint.get("fill-extrusion-rounded-roof"),ge=ee?0:ie,de=A.projection.name==="globe"?i.eb():0,fe=A.projection.name==="globe",ue=fe?i.aj(A.zoom):0,se=[i.aF(A.center.lng),i.aJ(A.center.lat)],_e=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(_e?null:c.lut).toArray01().slice(0,3),Ce=c.paint.get("fill-extrusion-flood-light-intensity"),Be=c.paint.get("fill-extrusion-vertical-scale"),Ue=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ze=c.paint.get("fill-extrusion-height-alignment"),lt=c.paint.get("fill-extrusion-base-alignment"),ke=Bc(p,c.paint.get("fill-extrusion-cutoff-fade-range")),be=[],He;fe&&be.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&be.push("FAUX_AO"),ee&&be.push("ZERO_ROOF_RADIUS"),w&&be.push("HAS_CENTROID"),Ce>0&&be.push("FLOOD_LIGHT"),ke.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),Ue&&be.push("RENDER_WALL_MODE");let Le=p.renderPass==="shadow",Je=p.shadowRenderer,yt=Le&&!!Je,Mt=Le?an.disabled:an.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let pt=[0,0,0];if(Je){let Lt=p.style.directionalLight,St=p.style.ambientLight;Lt&&St&&(pt=ql(p.style,Lt,St)),Le||(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Je.useNormalOffset&&be.push("NORMAL_OFFSET")),He=be.concat(["SHADOWS_SINGLE_CASCADE"])}let ct=yt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",Vt=c.getLayerRenderingStats();for(let Lt of f){let St=o.getTile(Lt),At=St.getBucket(c);if(!At||At.projection.name!==A.projection.name)continue;let Jt=!1;Je&&(Jt=Je.getMaxCascadeForTile(Lt.toUnwrapped())===0);let pn=p.isTileAffectedByFog(Lt),Fn=At.programConfigurations.get(c.id),Jn=!1;if(L&&St.imageAtlas){let Wn=St.imageAtlas,bn=i.e3.from(L),ti=bn.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),ar=bn.getSecondary(),qi=Wn.patternPositions.get(ti),ri=ar?Wn.patternPositions.get(ar.scaleSelf(i.o.devicePixelRatio).toString()):null;Jn=!!qi&&!!ri,qi&&Fn.setConstantPatternPositions(qi,ri)}k>0&&(Jn||Fn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&be.push("FILL_EXTRUSION_PATTERN_TRANSITION");let Ut=p.getOrCreateProgram(ct,{config:Fn,defines:Jt?He:be,overrideFog:pn});if(p.terrain&&p.terrain.setupElevationDraw(St,Ut,{useMeterToDem:!0}),!At.centroidVertexBuffer){let Wn=Ut.getAttributeLocation(M,"a_centroid_pos");Wn!==-1&&M.vertexAttrib2f(Wn,0,0)}!Le&&Je&&Je.setupShadows(St.tileID.toUnwrapped(),Ut,"vector-tile"),j&&(p.context.activeTexture.set(M.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Fn.updatePaintBuffers());let Xn=c.paint.get("fill-extrusion-vertical-gradient"),hn=1/At.tileToMeter,ii;if(Le&&Je){if(Yl(St.tileID,At.maxHeight,p))continue;let Wn=Je.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());ii=Sv(Wn,ge,hn,Be,Ze,lt)}else{let Wn=p.translatePosMatrix(Lt.expandedProjMatrix,St,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),bn=A.projection.createInversionMatrix(A,Lt.canonical);ii=j?cb(Wn,p,Xn,V,J,ge,hn,Lt,St,de,Ze,lt,ue,se,bn,Se,Be,k):bm(Wn,p,Xn,V,J,ge,hn,Lt,de,Ze,lt,ue,se,bn,Se,Be,Ce,pt)}p.uploadCommonUniforms(S,Ut,Lt.toUnwrapped(),null,ke);let fi=At.segments;if(A.projection.name==="mercator"&&!Le&&(fi=At.getVisibleSegments(St.tileID,p.terrain,p.transform.getFrustum(0)),!fi.get().length))continue;if(Vt)if(Le)for(let Wn of fi.get())Vt.numRenderedVerticesInShadowPass+=Wn.primitiveLength;else for(let Wn of fi.get())Vt.numRenderedVerticesInTransparentPass+=Wn.primitiveLength;let ui=[];(p.terrain||w)&&ui.push(At.centroidVertexBuffer),fe&&ui.push(At.layoutVertexExtBuffer),Ue&&ui.push(At.wallVertexBuffer),Ut.draw(p,S.gl.TRIANGLES,_,y,x,Mt,ii,c.id,At.layoutVertexBuffer,At.indexBuffer,fi,c.paint,p.transform.zoom,Fn,ui)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Rv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Xl(p,o,c,f,_,y,x,w,S,M,A,F,k,L,j,V,W,q,J,ie){let ee=o.context,ge=ee.gl,de=o.transform,fe=o.transform.zoom,ue=[],se=p.translate,_e=p.translateAnchor,Se=p.edgeRadius,Ce=Bc(o,p.cutoffFadeRange);A==="clear"?(ue.push("CLEAR_SUBPASS"),ie&&(ue.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(ge.TEXTURE0),ie.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):A==="sdf"?ue.push("SDF_SUBPASS"):A==="emissive"&&(ue.push("USE_MRT1"),ee.activeTexture.set(ge.TEXTURE0),ie.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)),q&&ue.push("HAS_CENTROID"),Ce.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");let Be=(Ue,Ze,lt,ke,be)=>{let He=ue;Ze.groundRadiusBuffer!=null&&(He=ue.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));let Le=Ze.programConfigurations.get(f.id),Je=o.isTileAffectedByFog(Ue),yt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Le,defines:He,overrideFog:Je}),Mt=Zd(o,ke,F,M,be,[k,L*be],j,V,W,fe>=17?0:Se*be,ie?ie.size[0]:0),pt=[];q&&pt.push(Ze.hiddenByLandmarkVertexBuffer),Ze.groundRadiusBuffer!=null&&pt.push(Ze.groundRadiusBuffer),o.uploadCommonUniforms(ee,yt,Ue.toUnwrapped(),null,Ce),yt.draw(o,ee.gl.TRIANGLES,y,x,w,S,Mt,f.id,Ze.vertexBuffer,Ze.indexBuffer,lt,f.paint,fe,Le,pt)};for(let Ue of _){let Ze=c.getTile(Ue),lt=Ze.getBucket(f);if(!lt||lt.projection.name!==de.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;let ke=lt.groundEffect,be=1/lt.tileToMeter;{let He=o.translatePosMatrix(Ue.projMatrix,Ze,se,_e),Le=ke.getDefaultSegment();Be(Ue,ke,Le,He,be)}if(J)for(let He=0;He<4;He++){let Le=i.e9[He](Ue),Je=c.getTile(Le);if(!Je)continue;let yt=Je.getBucket(f);if(!yt||yt.projection.name!==de.projection.name||!yt.groundEffect||yt.groundEffect&&!yt.groundEffect.hasData())continue;let Mt=yt.groundEffect,pt,ct;He===0?(pt=[-i.al,0,0],ct=1):He===1?(pt=[i.al,0,0],ct=0):He===2?(pt=[0,-i.al,0],ct=3):(pt=[0,i.al,0],ct=2);let Vt=Mt.regionSegments[ct];if(!Vt)continue;let Lt=new Float32Array(16);i.br(Lt,Ue.projMatrix,pt),Be(Ue,Mt,Vt,o.translatePosMatrix(Lt,Ze,se,_e),be)}}}function cT(p,o,c,f,_,y,x){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let w=y?y.findDEMTileFor(c):null;if(!(w&&w.dem||x))return;y&&w&&w.dem&&f.selfDEMTileTimestamp!==w.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=w.dem._timestamp);let S=q=>new i.P(Math.ceil((q+i.ed)*i.ee),0),M=q=>{let J=o.getSource().minzoom,ie=ge=>{let de=o.getTileByID(ge);if(de&&de.hasData())return de.getBucket(_)},ee=[0,-1,1];for(let ge of ee){if(q.overscaledZ+ge<J)continue;let de=ie(q.calculateScaledKey(q.overscaledZ+ge));if(de)return de}},A=[0,0,0],F=(q,J)=>(A[0]=Math.min(q.min.y,J.min.y),A[1]=Math.max(q.max.y,J.max.y),A[2]=i.al-J.min.x>q.max.x?J.min.x-i.al:q.max.x,A),k=(q,J)=>(A[0]=Math.min(q.min.x,J.min.x),A[1]=Math.max(q.max.x,J.max.x),A[2]=i.al-J.min.y>q.max.y?J.min.y-i.al:q.max.y,A),L=[(q,J)=>F(q,J),(q,J)=>F(J,q),(q,J)=>k(q,J),(q,J)=>k(J,q)],j=(q,J,ie,ee,ge,de,fe)=>{if(!y)return 0;let ue=[[de?ie:q,de?q:ie,0],[de?ie:J,de?J:ie,0]],se=fe<0?i.al+fe:fe,_e=[de?se:(q+J)/2,de?(q+J)/2:se,0];return ie===0&&fe<0||ie!==0&&fe>0?y.getForTilePoints(ge,[_e],!0,ee):ue.push(_e),y.getForTilePoints(c,ue,!0,w),Math.max(ue[0][2],ue[1][2],_e[2])/y.exaggeration()};for(let q=0;q<4;q++){let J=f.borderFeatureIndices[q];if(J.length===0)continue;let ie=i.e9[q](c),ee=M(ie);if(!(ee&&ee instanceof i.ea))continue;let ge=y?y.findDEMTileFor(ie):null;if(!(ge&&ge.dem||x)||(y&&ge&&ge.dem&&f.borderDEMTileTimestamp[q]!==ge.dem._timestamp&&(f.borderDoneWithNeighborZ[q]=-1,f.borderDEMTileTimestamp[q]=ge.dem._timestamp),f.borderDoneWithNeighborZ[q]===ee.canonical.z))continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();let de=(q<2?1:5)-q,fe=ee.borderDoneWithNeighborZ[de]!==f.canonical.z,ue=ee.borderFeatureIndices[de],se=0;if(f.canonical.z!==ee.canonical.z){for(let _e of J)f.showCentroid(f.featuresOnBorder[_e]);if(fe)for(let _e of ue)ee.showCentroid(ee.featuresOnBorder[_e]);f.borderDoneWithNeighborZ[q]=ee.canonical.z,ee.borderDoneWithNeighborZ[de]=f.canonical.z}for(let _e of J){let Se=f.featuresOnBorder[_e],Ce=f.centroidData[Se.centroidDataIndex],Be=Se.borders[q],Ue;for(;se<ue.length;){Ue=ee.featuresOnBorder[ue[se]];let Ze=Ue.borders[de];if(Ze[1]>Be[0]+3||Ze[0]>Be[0]-3)break;ee.showCentroid(Ue),se++}if(Ue&&se<ue.length){let Ze=se,lt=0;for(;!(Ue.borders[de][0]>Be[1]-3)&&(lt++,++se!==ue.length);)Ue=ee.featuresOnBorder[ue[se]];Ue=ee.featuresOnBorder[ue[Ze]];let ke=!1;if(lt>=1){let Le=Ue.borders[de];Math.abs(Be[0]-Le[0])<3&&Math.abs(Be[1]-Le[1])<3&&(lt=1,ke=!0,se=Ze+1)}else if(lt===0){f.showCentroid(Se);continue}let be=ee.centroidData[Ue.centroidDataIndex];x&&ke&&(((V=Ce).flags|(W=be).flags)&i.ec?(V.flags|=i.ec,W.flags|=i.ec):(V.flags&=~i.ec,W.flags&=~i.ec));let He=Se.intersectsCount()>1||Ue.intersectsCount()>1;if(lt>1)se=Ze,Ce.centroidXY=be.centroidXY=new i.P(0,0);else if(ge&&ge.dem&&!He){let Le=L[q](Ce,be),Je=q%2?i.al-1:0,yt=j(Le[0],Math.min(i.al-1,Le[1]),Je,ge,ie,q<2,Le[2]);Ce.centroidXY=be.centroidXY=S(yt)}else He?Ce.centroidXY=be.centroidXY=new i.P(0,0):(Ce.centroidXY=f.encodeBorderCentroid(Se),be.centroidXY=ee.encodeBorderCentroid(Ue));f.writeCentroidToBuffer(Ce),ee.writeCentroidToBuffer(be)}else f.showCentroid(Se)}f.borderDoneWithNeighborZ[q]=ee.canonical.z,ee.borderDoneWithNeighborZ[de]=f.canonical.z}var V,W;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}let ks=[1,0,0],kv=[0,1,0],ls=[0,0,1];function Yl(p,o,c){let f=c.transform,_=c.shadowRenderer;if(!_)return!0;let y=p.toUnwrapped(),x=f.tileSize*_._cascades[c.currentShadowCascade].scale,w=o;if(f.elevation){let V=f.elevation.getMinMaxForTile(p);V&&(w+=V.max)}let S=[..._.shadowDirection];S[2]=-S[2];let M=_.computeSimplifiedTileShadowVolume(y,w,x,S);if(!M)return!1;let A=[ks,kv,ls,S,[S[0],0,S[2]],[0,S[1],S[2]]],F=f.projection.name==="globe",k=f.scaleZoom(x),L=i.cB.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,k,!F),j=_.getCurrentCascadeFrustum();return L.intersectsPrecise(M.vertices,M.planes,A)===0||j.intersectsPrecise(M.vertices,M.planes,A)===0}function Sp(p){let{painter:o,source:c,layer:f,coords:_}=p,y=p.defines,x=o.context,w=o.renderPass==="shadow",S=o.renderPass==="light-beam",M=o.shadowRenderer,A=i.ef(o.transform.center.lat,o.transform.zoom),F=Bc(o,f.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(let k of _){let L=c.getTile(k),j=L.getBucket(f);if(!j)continue;M&&M.getMaxCascadeForTile(k.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));let V=j.programConfigurations.get(f.id),W,q,J,ie=o.translatePosMatrix(k.expandedProjMatrix,L,[0,0],"map");if(ie=i.cS(i.bC(),ie,[1,1,p.verticalScale]),w&&M){if(Yl(L.tileID,j.maxHeight*A,o))continue;let ge=M.calculateShadowPassMatrixFromTile(L.tileID.toUnwrapped());ge=i.cS(i.bC(),ge,[1,1,p.verticalScale]),J=qc(ge),W=q=o.getOrCreateProgram("buildingDepth",{config:V,defines:y,overrideFog:!1})}else if(S)W=q=o.getOrCreateProgram("buildingBloom",{config:V,defines:y,overrideFog:!1}),J=db(ie);else{let ge=o.transform.calculatePosMatrix(k.toUnwrapped(),o.transform.worldSize);i.cS(ge,ge,[1,1,p.verticalScale]);let de=i.bC();i.cS(de,ge,[1,-1,1/A]),i.bl(de,de),i.eg(de,de);let fe=o.transform.getFreeCameraOptions().position,ue=1<<k.canonical.z;if(J=wm(ie,de,p.opacity,p.facadeAOIntensity,[((fe.x-k.wrap)*ue-k.canonical.x)*i.al,(fe.y*ue-k.canonical.y)*i.al,fe.z*ue*i.al],j.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),q=o.getOrCreateProgram("building",{config:V,defines:y,overrideFog:!1}),p.depthOnly===!0)W=q;else{let se=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);W=o.getOrCreateProgram("building",{config:V,defines:se,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(ge,q,!0),W!==q&&M.setupShadowsFromMatrix(ge,W,!0))}let ee=(ge,de)=>{if(S){let fe=ge.entranceBloom;de.draw(o,x.gl.TRIANGLES,p.depthMode,ln.disabled,p.blendMode,an.disabled,J,f.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segmentsBucket,f.paint,o.transform.zoom,V,[fe.layoutAttenuationBuffer,fe.layoutColorBuffer])}else{let fe=ge.segmentsBucket,ue=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(ue=ue.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),de.draw(o,x.gl.TRIANGLES,p.depthMode,ln.disabled,p.blendMode,w?an.disabled:an.backCW,J,f.id,ge.layoutVertexBuffer,ge.indexBuffer,fe,f.paint,o.transform.zoom,V,ue)}};o.uploadCommonUniforms(x,q,k.toUnwrapped(),null,F),j.buildingWithoutFacade&&ee(j.buildingWithoutFacade,q),j.buildingWithFacade&&(W!==q&&o.uploadCommonUniforms(x,W,k.toUnwrapped(),null,F),ee(j.buildingWithFacade,W))}}function Am(p,o,c,f,_,y,x,w,S,M,A,F,k){let L=p.context.gl,j=p.depthModeForSublayer(1,Ht.ReadOnly,L.LEQUAL,!0),V=.1*(1-(W=A))+3*W;var W;let q=p._showOverdrawInspector,J=F,ie=new Rv;q||Xl(ie,p,o,c,f,j,new ln({func:L.ALWAYS,mask:255},255,255,L.KEEP,L.KEEP,L.REPLACE),new yn([L.ONE,L.ONE,L.ONE,L.ONE],i.ao.transparent,[!1,!1,!1,!0],L.MIN),an.disabled,_,"sdf",y,x,w,S,M,V,J,!1);{let ee=q?ln.disabled:new ln({func:L.EQUAL,mask:255},255,255,L.KEEP,L.DECR,L.DECR),ge=q?p.colorModeForRenderPass():new yn([L.ONE_MINUS_DST_ALPHA,L.DST_ALPHA,L.ONE,L.ONE],i.ao.transparent,[!0,!0,!0,!0]);Xl(ie,p,o,c,f,j,ee,ge,an.disabled,_,"color",y,x,w,S,M,V,J,!1)}}function Pm(p){return[p[0]*i.eh,p[1]*i.eh,p[2]*i.eh,0]}function Tp(p,o,c,f,_,y,x,w,S){let M=f.getSource(),A=c.globeSharedBuffers;if(!A)return;let F,k,L;if(o&&(F=f.getTile(o)),M instanceof i.aU?(k=M.texture,L=i.dK(0,0,c.transform)):F&&o&&(k=F.texture,L=i.dK(o.canonical.z,o.canonical.x,c.transform)),!k||!L)return;p||(L=i.cS(i.bC(),L,[1,-1,1]));let j=c.context,V=j.gl,W=_.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,q=c.colorModeForDrapableLayerRenderPass(y),J=x.defines;J.push("GLOBE_POLES");let ie=new Ht(V.LEQUAL,Ht.ReadWrite,c.depthRangeFor3D),ee=Float32Array.from(c.transform.expandedFarZProjMatrix),ge=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),j.activeTexture.set(V.TEXTURE0),k.bind(W,V.CLAMP_TO_EDGE),j.activeTexture.set(V.TEXTURE1),k.bind(W,V.CLAMP_TO_EDGE),"useMipmap"in k&&j.extTextureFilterAnisotropic&&c.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);let[de,fe,ue,se]=o?A.getPoleBuffers(o.canonical.z,!1):A.getPoleBuffers(0,!0),_e=_.paint.get("raster-elevation"),Se;p?(Se=de,c.renderDefaultNorthPole=_e!==0):(Se=fe,c.renderDefaultSouthPole=_e!==0);let Ce=Pm(x.mix),Be=((Ze,lt,ke,be,He,Le,Je,yt,Mt,pt,ct,Vt,Lt)=>fb(Ze,lt,ke,new Float32Array(16),new Float32Array(9),[0,0],be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Le,[0,0],yt,2,pt,ct,Vt,1,0,Lt))(ee,ge,L,i.aj(c.transform.zoom),0,_,0,_e,0,Ce,x.offset,x.range,y),Ue=c.getOrCreateProgram("raster",{defines:J});c.uploadCommonUniforms(j,Ue,null),Ue.draw(c,V.TRIANGLES,ie,S,q,w,Be,_.id,Se,ue,se)}function bb(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}function Kl(p,o,c,f){if(p)return o instanceof Xo&&p instanceof Hf?o.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Pm(f.mix),offset:f.offset,buffer:0,tileSize:1}}var Ni=i.ei([{name:"a_index",type:"Int16",components:1}]);class Om{constructor(o,c,f,_){let y={width:f[0],height:f[1],data:null},x=o.gl;this.targetColorTexture=new i.T(o,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,y,x.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(c,_),this.lastInvalidatedAt=0}updateParticleTexture(o,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,_=c.width*c.height;this.particleTexture0=new i.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1});let y=new i.ej;y.reserve(_);for(let x=0;x<_;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Ni.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Fv(p,o,c){if(!p)return null;let f=o.getTextureDescriptor(p,c,!0);if(!f)return null;let{texture:_,mix:y,offset:x,tileSize:w,buffer:S,format:M}=f;if(!_||!M)return null;let A=!1;return M==="uint32"&&(A=!0,y[3]=0,y=Cm(i.ek,y,[0,c.paint.get("raster-particle-max-speed")]),x=Em(i.ek,x,[0,c.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[S/(w+2*S),w/(w+2*S)],tileSize:w,scalarData:A,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function wb(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}let Cb=new i.ao(1,0,0,1),Eb=new i.ao(0,1,0,1),Sb=new i.ao(0,0,1,1),Qu=new i.ao(1,0,1,1),Ju=new i.ao(0,1,1,1);function ht(p,o,c,f,_,y){for(let x=0;x<c.length;x++)if(_){let M=new i.ao(f.r*.8,f.g*.8,f.b*.8,1);wt(p,o,c[x],f,-1,-1,y),wt(p,o,c[x],f,-1,1,y),wt(p,o,c[x],f,1,1,y),wt(p,o,c[x],f,1,-1,y),wt(p,o,c[x],M,0,0,y)}else wt(p,o,c[x],f,0,0,y)}function wt(p,o,c,f,_,y,x){let w=p.context,S=p.transform,M=w.gl,A=S.projection.name==="globe",F=A?["PROJECTION_GLOBE_VIEW"]:[],k=i.bz(c.projMatrix);if(A&&i.aj(S.zoom)>0){let Ce=i.bj(c.canonical,S),Be=i.el(Ce);k=i.aB(new Float32Array(16),S.globeMatrix,Be),i.aB(k,S.projMatrix,k)}let L=i.bC();L[12]+=2*_/(i.o.devicePixelRatio*S.width),L[13]+=2*y/(i.o.devicePixelRatio*S.height),i.aB(k,L,k);let j=p.getOrCreateProgram("debug",{defines:F}),V=o.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(V,j);let W=Ht.disabled,q=ln.disabled,J=p.colorModeForRenderPass(),ie="$debug";w.activeTexture.set(M.TEXTURE0),p.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),A?V._makeGlobeTileDebugBuffers(p.context,S):V._makeDebugTileBoundsBuffers(p.context,S.projection);let ee=V._tileDebugBuffer||p.debugBuffer,ge=V._tileDebugIndexBuffer||p.debugIndexBuffer,de=V._tileDebugSegments||p.debugSegments;if(j.draw(p,M.LINE_STRIP,W,q,J,an.disabled,xp(k,f.toPremultipliedRenderColor(null)),ie,ee,ge,de,null,null,null,[V._globeTileDebugBorderBuffer]),x){let Ce=V.latestRawTileData,Be=Math.floor((Ce&&Ce.byteLength||0)/1024),Ue=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ue+=` => ${c.overscaledZ}`),Ue+=` ${V.state}`,Ue+=` ${Be}kb`,(function(Ze,lt){Ze.initDebugOverlayCanvas();let ke=Ze.debugOverlayCanvas,be=Ze.context.gl,He=Ze.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,ke.width,ke.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(lt,5,5),He.strokeText(lt,5,5),Ze.debugOverlayTexture.update(ke),Ze.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)})(p,Ue)}let fe=o.getTile(c).tileSize,ue=512/Math.min(fe,512)*(c.overscaledZ/S.zoom)*.5,se=V._tileDebugTextBuffer||p.debugBuffer,_e=V._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Se=V._tileDebugTextSegments||p.debugSegments;j.draw(p,M.TRIANGLES,W,q,yn.alphaBlended,an.disabled,xp(k,i.ao.transparent.toPremultipliedRenderColor(null),ue),ie,se,_e,Se,null,null,null,[V._globeTileDebugTextBuffer])}function ed(p,o,c,f){Me(p,0,o+c/2,p.transform.width,c,f)}function hr(p,o,c,f){Me(p,o-c/2,0,c,p.transform.height,f)}function Me(p,o,c,f,_,y){let x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(o*i.o.devicePixelRatio,c*i.o.devicePixelRatio,f*i.o.devicePixelRatio,_*i.o.devicePixelRatio),x.clear({color:y}),w.disable(w.SCISSOR_TEST)}let Tb=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rm}=Tb;function ml(p,o,c,f){p.emplaceBack(o,c,f)}class km{constructor(o){this.vertexArray=new i.em,this.indices=new i.b0,ml(this.vertexArray,-1,-1,1),ml(this.vertexArray,1,-1,1),ml(this.vertexArray,-1,1,1),ml(this.vertexArray,1,1,1),ml(this.vertexArray,-1,-1,-1),ml(this.vertexArray,1,-1,-1),ml(this.vertexArray,-1,1,-1),ml(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Rm),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function td(p,o,c,f,_,y){let x=p.context.gl,w=o.paint.get("sky-atmosphere-color"),S=o.paint.get("sky-atmosphere-halo-color"),M=o.paint.get("sky-atmosphere-sun-intensity"),A=((F,k,L,j,V)=>({u_matrix_3f:F,u_sun_direction:k,u_sun_intensity:L,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(i.eo(i.dO(),f),_,M,w.toPremultipliedRenderColor(null),S.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,o.skyboxTexture,0),c.draw(p,x.TRIANGLES,Ht.disabled,ln.disabled,yn.unblended,an.frontCW,A,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let Ib=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kd{constructor(o){let c=new i.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let f=new i.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,Ib.members),this.indexBuffer=o.createIndexBuffer(f),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let uT=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class dT{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mb{constructor(o){this.colorModeAlphaBlendedWriteRGB=new yn([1,dl,1,dl],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new dT,this.updateNeeded=!0}update(o){let c=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Kd(c);let f=this.params.sizeRange,_=this.params.intensityRange,y=(function(A){let F=i.eq(30),k=[];for(let L=0;L<A;++L){let j=2*Math.PI*F(),V=Math.acos(1-2*F())-.5*Math.PI;k.push(i.d5(Math.cos(V)*Math.cos(j),Math.cos(V)*Math.sin(j),Math.sin(V)))}return k})(this.params.starsCount),x=i.eq(300),w=new i.er,S=new i.b0,M=0;for(let A=0;A<y.length;++A){let F=i.c5([],y[A],200),k=Math.max(0,1+.01*f*(1*x()-.5)),L=Math.max(0,1+.01*_*(1*x()-.5));w.emplaceBack(F[0],F[1],F[2],-1,-1,k,L),w.emplaceBack(F[0],F[1],F[2],1,-1,k,L),w.emplaceBack(F[0],F[1],F[2],1,1,k,L),w.emplaceBack(F[0],F[1],F[2],-1,1,k,L),S.emplaceBack(M+0,M+1,M+2),S.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(w,uT.members),this.starsIdx=c.createIndexBuffer(S),this.starsSegments=i.bg.simpleSegment(0,0,w.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,c){let f=o.context,_=f.gl,y=o.transform,x=new Ht(_.LEQUAL,Ht.ReadOnly,[0,1]),w=i.aj(y.zoom),S=o.style.getLut(c.scope),M=c.properties.get("color-use-theme")==="none",A=c.properties.get("color").toNonPremultipliedRenderColor(M?null:S),F=c.properties.get("high-color-use-theme")==="none",k=c.properties.get("high-color").toNonPremultipliedRenderColor(F?null:S),L=c.properties.get("space-color-use-theme")==="none",j=c.properties.get("space-color").toNonPremultipliedRenderColor(L?null:S),V=5e-4,W=i.es(c.properties.get("horizon-blend"),0,1,V,.25),q=i.dE(o,f,y)&&W===V?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,J=o.frameCounter/1e3%1,ie=i.ag(y.globeCenterInViewSpace),ee=Math.sqrt(Math.pow(ie,2)-Math.pow(q,2)),ge=Math.acos(ee/ie),de=fe=>{let ue=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&ue.push("ALPHA_PASS");let se=o.getOrCreateProgram("globeAtmosphere",{defines:ue}),_e=((Ce,Be,Ue,Ze,lt,ke,be,He,Le,Je,yt,Mt)=>({u_frustum_tl:Ce,u_frustum_tr:Be,u_frustum_br:Ue,u_frustum_bl:Ze,u_horizon:lt,u_transition:ke,u_fadeout_range:be,u_atmosphere_fog_color:He.toArray01(),u_high_color:Le.toArray01(),u_space_color:Je.toArray01(),u_temporal_offset:yt,u_horizon_angle:Mt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,w,W,A,k,j,J,ge);o.uploadCommonUniforms(f,se);let Se=this.atmosphereBuffer;Se&&se.draw(o,_.TRIANGLES,x,ln.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,an.backCW,_e,fe?"atmosphere_glow_alpha":"atmosphere_glow",Se.vertexBuffer,Se.indexBuffer,Se.segments)};de(!1),de(!0)}drawStars(o,c){let f=i.aA(c.properties.get("star-intensity"),0,1);if(f===0)return;let _=o.context,y=_.gl,x=o.transform,w=o.getOrCreateProgram("stars"),S=i.c7([]);i.c9(S,S,-x._pitch),i.c8(S,S,-x.angle),i.c9(S,S,i.an(x._center.lat)),i.et(S,S,-i.an(x._center.lng));let M=i.cc(new Float32Array(16),S),A=i.aB([],x.starsProjMatrix,M),F=i.eo([],M),k=i.eu([],F),L=[0,1,0];i.dQ(L,L,k),i.c5(L,L,this.params.sizeMultiplier);let j=[1,0,0];i.dQ(j,j,k),i.c5(j,j,this.params.sizeMultiplier);let V=(W=L,q=j,J=f,{u_matrix:Float32Array.from(A),u_up:W,u_right:q,u_intensity_multiplier:J});var W,q,J;o.uploadCommonUniforms(_,w),this.starsVx&&this.starsIdx&&w.draw(o,y.TRIANGLES,Ht.disabled,ln.disabled,this.colorModeAlphaBlendedWriteRGB,an.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Fm{constructor(){this.visibleTiles=[]}updateBorders(o,c){let f=[],_=[],y=o._getRenderableCoordinates(!1,!0);for(let S of y){let M=o.getTile(S);if(!M.hasData())continue;let A=M.getBucket(c);A&&(A.isEmpty()||(f.push(S.key),_.push({bucket:A,tileID:S.canonical})))}let x=f.length!==this.visibleTiles.length;if(!x){f.sort();for(let S=0;S<f.length;S++)if(f[S]!==this.visibleTiles[S]){x=!0;break}}if(!x)return;let w=new Set;this.visibleTiles=f,_.sort((S,M)=>S.tileID.z-M.tileID.z||S.tileID.x-M.tileID.x||S.tileID.y-M.tileID.y);for(let S of _){let M=new Array,A=new Array,F=S.bucket;for(let k of F.featuresOnBorder)w.has(k.featureId)?A.push(k.footprintIndex):(w.add(k.featureId),M.push(k.footprintIndex));F.updateFootprintHiddenFlags(M,i.ev,!1),F.updateFootprintHiddenFlags(A,i.ev,!0)}}}function Lm(p,o){let c=[...p],f=o.cameraWorldSizeForFog/o.worldSize,_=i.bA([]);return i.cS(_,_,[f,f,1]),i.aB(c,_,c),i.aB(c,o.worldToFogMatrix,c),c}function Nm(p,o,c,f,_){let y=c.material,x=f.context,{baseColorTexture:w,metallicRoughnessTexture:S}=y.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:A,emissionTexture:F}=y;function k(j,V,W){if(j&&(p.push(V),x.activeTexture.set(x.gl.TEXTURE0+W),j.gfxTexture)){let{minFilter:q,magFilter:J,wrapS:ie,wrapT:ee}=j.sampler;j.gfxTexture.bindExtraParam(q,J,ie,ee)}}k(w,"HAS_TEXTURE_u_baseColorTexture",mo.BaseColor),k(S,"HAS_TEXTURE_u_metallicRoughnessTexture",mo.MetallicRoughness),k(M,"HAS_TEXTURE_u_normalTexture",mo.Normal),k(A,"HAS_TEXTURE_u_occlusionTexture",mo.Occlusion),k(F,"HAS_TEXTURE_u_emissionTexture",mo.Emission),_&&(_.texture||(_.texture=new i.d$(f.context,_.image,[_.image.height,_.image.height,_.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+mo.LUT),_.texture&&_.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(c.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||p.push("DIFFUSE_SHADED");let L=f.shadowRenderer;L&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),L.useNormalOffset&&p.push("NORMAL_OFFSET"))}function zm(p,o,c,f,_,y){let x=p.modelOpacity,w=o.context,S=new Ht(o.context.gl.LEQUAL,p.isLightMesh?Ht.ReadOnly:Ht.ReadWrite,o.depthRangeFor3D),M=o.transform,A=p.mesh,F=A.material,k=F.pbrMetallicRoughness,L=o.style.fog,j;j=o.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:i.aB([],f.zScaleMatrix,p.nodeModelMatrix),i.aB(j,f.negCameraPosMatrix,j);let V=i.bl([],j);i.eg(V,V);let W=c.paint.get("model-color-use-theme").constantOr("default")==="none",q=c.paint.get("model-emissive-strength").constantOr(0),J=Yu(new Float32Array(p.worldViewProjection),new Float32Array(j),new Float32Array(V),null,o,x,k.baseColorFactor,F.emissiveFactor,k.metallicFactor,k.roughnessFactor,F,q,c,void 0,void 0,p.materialOverride,p.modelColor),ie={defines:[]},ee=[],ge=o.shadowRenderer;ge&&(ge.useNormalOffset=!1),Nm(ie.defines,ee,A,o,W?null:c.lut);let de=null;if(L){let se=Lm(p.nodeModelMatrix,o.transform);if(de=new Float32Array(se),M.projection.name!=="globe"){let _e=A.aabb.min,Se=A.aabb.max,[Ce,Be]=L.getOpacityForBounds(se,_e[0],_e[1],Se[0],Se[1]);ie.overrideFog=Ce>=Xe||Be>=Xe}}let fe=Bc(o,c.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&ie.defines.push("RENDER_CUTOFF");let ue=o.getOrCreateProgram("model",ie);o.uploadCommonUniforms(w,ue,null,de,fe),o.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(p.nodeModelMatrix,ue),ue.draw(o,w.gl.TRIANGLES,S,_,y,A.material.doubleSided?an.disabled:an.backCCW,J,c.id,A.vertexBuffer,A.indexBuffer,A.segments,c.paint,o.transform.zoom,void 0,ee)}function Ip(p,o){return p.style._importedAsBasemap?"basemap":o.scope}function nd(p,o,c,f,_,y,x,w,S,M){let A=p.transform,F=!!o.isGeometryBloom&&o.isGeometryBloom;if(F&&p.renderPass==="shadow")return;let k=A.projection.name==="globe"?i.eD(c,A):[...c];i.aB(k,k,o.globalMatrix);let L=i.aB([],f,k);if(o.meshes)for(let j of o.meshes){let V=w.get(j.material.name);if(V&&V.opacity<=0)continue;if(j.material.alphaMode!=="BLEND"){x.push({mesh:j,depth:0,modelIndex:_,worldViewProjection:L,nodeModelMatrix:k,isLightMesh:F,materialOverride:V,modelOpacity:S,modelColor:M});continue}let W=i.af([],j.centroid,L);!A.isOrthographic&&W[2]<=0||y.push({mesh:j,depth:W[2],modelIndex:_,worldViewProjection:L,nodeModelMatrix:k,isLightMesh:F,materialOverride:V,modelOpacity:S,modelColor:M})}if(o.children)for(let j of o.children)nd(p,j,c,f,_,y,x,w,S,M)}function Ua(p,o,c,f){let _=c.shadowRenderer;if(!_)return;let y=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode(),w=_.calculateShadowPassMatrixFromMatrix(o),S=Av(w);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,y,ln.disabled,x,an.disabled,S,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,c.transform.zoom,void 0,void 0)}function Db(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={orientation:p.paint.get("model-rotation").evaluate(S,c)};y.set(x,M)}}function Ab(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={color:p.paint.get("model-color").evaluate(S,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(S,c),opacity:p.paint.get("model-opacity").evaluate(S,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(S,c)};y.set(x,M)}}function Pb(p,o,c,f,_){let y=!1;for(let w of f)w.modelOpacity!==1&&(zm(w,p,o,_[w.modelIndex],ln.disabled,yn.disabled),y=!0);for(let w of f)zm(w,p,o,_[w.modelIndex],w.modelOpacity!==1?p.stencilModeFor3D():ln.disabled,p.colorModeForRenderPass());y&&p.resetStencilClippingMasks();let x=yn.additive;for(let w of c)zm(w,p,o,_[w.modelIndex],ln.disabled,w.isLightMesh?x:p.colorModeForRenderPass())}function Ob(p,o,c){let f=o.updateZoomBasedPaintProperties(),_=(function(y,x,w){let S,M,A,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){let k=y.terrain,L=k.findDEMTileFor(w);L&&L.dem?S=i.eF.create(k,w,L):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||S&&S._demTile&&S._demTile.tileID===x.validForDEMTile.id&&S._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let k in x.instancesPerModel){let L=x.instancesPerModel[k];for(let j=0;j<L.instancedDataArray.length;++j){let V=(S?F*S.getElevationAt(0|L.instancedDataArray.float32[16*j],0|L.instancedDataArray.float32[16*j+1],!0,!0):0)+L.instancesEvaluatedElevation[j];L.instancedDataArray.float32[16*j+6]=V,M=M?Math.min(x.terrainElevationMin,V):V,A=A?Math.max(x.terrainElevationMax,V):V}}return x.terrainElevationMin=M||0,x.terrainElevationMax=A||0,x.validForExaggeration=F,x.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,o,c);(f||_)&&(o.uploaded=!1,o.upload(p.context))}let gl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function cs(p,o){let c=1<<p.canonical.z,f=o.getFreeCameraOptions().position,_=o.elevation,y=p.canonical.x/c,x=(p.canonical.x+1)/c,w=p.canonical.y/c,S=(p.canonical.y+1)/c,M=o._centerAltitude;if(_){let L=_.getMinMaxForTile(p);L&&L.max>M&&(M=L.max)}let A=i.aA(f.x,y,x)-f.x,F=i.aA(f.y,w,S)-f.y,k=i.cf(M,o.center.lat)-f.z;return o._zoomFromMercatorZ(Math.sqrt(A*A+F*F+k*k))}function Rb(p,o,c,f,_,y,x){let w=p.context,S=p.renderPass==="shadow",M=p.shadowRenderer,A=S&&M?M.getShadowPassDepthMode():new Ht(w.gl.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D),F=p.isTileAffectedByFog(y),k=p.transform.projection.name==="globe";if(c.meshes)for(let L of c.meshes){let j=k?[]:["MODEL_POSITION_ON_GPU"],V=[],W,q,J,ie=!k&&f.instancedDataArray.length>20;ie&&j.push("INSTANCED_ARRAYS");let ee=Bc(p,o.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),S&&M)W=p.getOrCreateProgram("modelDepth",{defines:j}),q=Av(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(c.globalMatrix)),J=M.getShadowPassColorMode();else{Nm(j,V,L,p,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),W=p.getOrCreateProgram("model",{defines:j,overrideFog:F});let de=L.material,fe=de.pbrMetallicRoughness,ue=o.paint.get("model-opacity").constantOr(1),se=o.paint.get("model-emissive-strength").constantOr(0);q=Yu(y.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,ue,fe.baseColorFactor,de.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,de,se,o,_),M&&(x.shadowUniformsInitialized?W.setShadowUniformValues(w,M.getShadowUniformValues()):(M.setupShadows(y.toUnwrapped(),W,"model-tile"),x.shadowUniformsInitialized=!0)),J=ee.shouldRenderCutoff||ue<1||de.alphaMode!=="OPAQUE"?yn.alphaBlended:yn.unblended}p.uploadCommonUniforms(w,W,y.toUnwrapped(),null,ee);let ge=L.material.doubleSided?an.disabled:an.backCCW;if(ie)V.push(f.instancedDataBuffer),W.draw(p,w.gl.TRIANGLES,A,ln.disabled,J,ge,q,o.id,L.vertexBuffer,L.indexBuffer,L.segments,o.paint,p.transform.zoom,void 0,V,f.instancedDataArray.length);else{let de=S?"u_instance":"u_normal_matrix";for(let fe=0;fe<f.instancedDataArray.length;++fe)q[de]=new Float32Array(f.instancedDataArray.arrayBuffer,64*fe,16),W.draw(p,w.gl.TRIANGLES,A,ln.disabled,J,ge,q,o.id,L.vertexBuffer,L.indexBuffer,L.segments,o.paint,p.transform.zoom,void 0,V)}}if(c.children)for(let L of c.children)Rb(p,o,L,f,_,y,x)}let Mp=[1,-1,1];function hT(p,o,c,f){if(!c.modelManager)return!0;let _=c.modelManager;if(!c.shadowRenderer)return!0;let y=c.shadowRenderer,x=o.aabb,w=!0,S=p.maxHeight;if(S===0){let A=0;for(let F in p.instancesPerModel){let k=_.getModel(F,f);k?A=Math.max(A,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):w=!1}S=p.maxScale*A*1.41+p.maxVerticalOffset,w&&(p.maxHeight=S)}x.max[2]=S,x.min[2]+=p.terrainElevationMin,x.max[2]+=p.terrainElevationMax,i.af(x.min,x.min,o.tileMatrix),i.af(x.max,x.max,o.tileMatrix);let M=x.intersects(y.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=M===2),M===0}function Gi(p,o){let c=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],_=p.uniformValues.u_cutoff_params[2],y=p.uniformValues.u_cutoff_params[3];return f===c||y===_?1:i.aA(((o-c)/(f-c)-_)/(y-_),0,1)}function Pn(p,o,c,f){if(o.pitch<20)return 1;let _=o.getWorldToCameraMatrix();i.aB(_,_,p);let y=i.bU(c.min[0],c.min[1],c.min[2],1),x=i.aC(i.eG(),y,_),w=x,S=x;y[1]=c.max[1],x=i.aC(i.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[0]=c.max[0],x=i.aC(i.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[1]=c.min[1],x=i.aC(i.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S;let M=i.aA(f[0],0,1),A=100*o.pixelsPerMeter*i.aA(f[1],0,1),F=i.aA(f[2],0,1),k=i.eH(i.eG(),w,S,M),L=Math.tan(.5*o.fovX),j=-k[2]*L;if(A===0)return k[1]<-Math.abs(j)?F:1;let V=(-Math.abs(j)-k[1])/A,W=(J,ie,ee)=>(1-ee)*J+ee*ie,q=i.aA(W(1,F,V),F,1);return W(1,q,i.aA((o.pitch-20)/20,0,1))}class kb{}class Xc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,c,f){{let F=this._storage.get(c.id);if(F)return F.lastUsedFrameIdx=o,F.buf}let _=f.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),x=new ArrayBuffer(y),w=new Int16Array(x);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let S=new i.eJ;for(let F=0;F<y/2;F+=3){let k=w[F],L=w[F+1],j=w[F+2];S.emplaceBack(k,L),S.emplaceBack(L,j),S.emplaceBack(j,k)}let M=f.bindVertexArrayOES.current,A=new kb;return A.buf=new wp(f,S),A.lastUsedFrameIdx=o,this._storage.set(c.id,A),f.bindVertexArrayOES.set(M),A.buf}update(o){for(let[c,f]of this._storage)o-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(c))}destroy(){for(let[o,c]of this._storage)c.buf.destroy(),this._storage.delete(o)}}class Qd{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}let Jd=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ql{constructor(o){this.revealStart=11,this.revealRange=2}}let Lv=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Nv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,c){let f=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new i.eK,w=new i.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(x,Lv.members),this.vignetteIdx=o.context.createIndexBuffer(w)}let _=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,f);let x={u_vignetteShape:(y={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};f.draw(o,o.context.gl.TRIANGLES,Ht.disabled,ln.disabled,yn.alphaBlended,an.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class zv{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,c){let f=o.getFreeCameraOptions().position,_=f.toAltitude(),y=f.toLngLat(),x=i.an(y.lng),w=i.an(y.lat),S=o.pixelsPerMeter/c,M=x*i.eM,A=i.eM*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let F=-this._offsetYPrev+A,k=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*S,this._accumulatedOffsetY+=F*S,this._accumulatedElevation+=k*S,this._offsetXPrev=M,this._offsetYPrev=A,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Bm(p,o){return[-(p[0]-Math.floor(p[0]/o)*o),-(p[1]-Math.floor(p[1]/o)*o),-(p[2]-Math.floor(p[2]/o)*o)]}function Ws(p){let o=i.eq(1323123451230),c=[];for(let f=0;f<p;++f){let _=2*o()-1,y=2*o()-1,x=2*o()-1;c.push(i.d5(_,y,x))}return c}function ws(p,o,c,f,_){let y=i.aA((_-c)/(f-c),0,1);return(1-y)*p+y*o}class id{constructor(o){this._movement=new zv,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Nv,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,c){let f=o.transform;this._movement.update(f,this._ppmScaleFactor);let _=f.starsProjMatrix,y=i.c7([]);i.c9(y,y,i.an(90)-f._pitch),i.c8(y,y,-f.angle);let x=i.cc(new Float32Array(16),y),w=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),S=i.eg([],w),M=i.aB([],S,x),A=Date.now()/1e3;return this._accumulatedTimeFromStart+=(A-this._prevTime)*c,this._prevTime=A,{projectionMatrix:_,modelviewMatrix:M}}}class Vm extends id{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ql("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=Ws(this.particlesCount),_=new i.eN,y=new i.b0,x=0,w=i.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=[2*w()-1,w(),w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,1,...A),_.emplaceBack(M[0],M[1],M[2],-1,1,...A),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,Jd.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;let c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=o.transform.zoom;if(c.revealStart>f)return;let _=ws(0,1,c.revealStart,c.revealStart+c.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;let y=structuredClone(this._params),x=[-y.direction.x,y.direction.y,-100];i.aw(x,x);let w=structuredClone(this._vignetteParams);w.strength*=_,y.overrideStyleParameters||(y.intensity=o.style.rain.state.density,y.timeFactor=o.style.rain.state.intensity,y.color=structuredClone(o.style.rain.state.color),x=structuredClone(o.style.rain.state.direction),y.screenThinning.intensity=o.style.rain.state.centerThinning,y.dropletSizeX=o.style.rain.state.dropletSize[0],y.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],y.distortionStrength=100*o.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(o.style.rain.state.vignetteColor));let S=this.updateOnRender(o,y.timeFactor),M=o.context,A=M.gl,F=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(M,{width:o.width,height:o.height,data:null},A.RGBA8)),y.distortionStrength>0&&(M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,o.width,o.height));let k=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(M,k),M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let L=[y.color.r,y.color.g,y.color.b,y.color.a],j=(V,W)=>{let q=Bm(this._movement.getPosition(),V),J=y.dropletSizeX,ie=y.dropletSizeX*y.dropletSizeYScale,ee=o.width/2,ge=o.height/2,de=ws(0,y.screenThinning.start,0,1,y.screenThinning.intensity),fe=ws(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),ue=ws(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),se=(_e={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:V,rainDropletSize:[J,ie],distortionStrength:y.distortionStrength,rainDirection:x,color:L,screenSize:[F.width,F.height],thinningCenterPos:[ee,ge],thinningShape:[de,fe,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:W?0:1},{u_modelview:Float32Array.from(_e.modelview),u_projection:Float32Array.from(_e.projection),u_time:_e.time,u_cam_pos:_e.camPos,u_texScreen:0,u_velocityConeAperture:_e.velocityConeAperture,u_velocity:_e.velocity,u_boxSize:_e.boxSize,u_rainDropletSize:_e.rainDropletSize,u_distortionStrength:_e.distortionStrength,u_rainDirection:_e.rainDirection,u_color:_e.color,u_screenSize:_e.screenSize,u_thinningCenterPos:_e.thinningCenterPos,u_thinningShape:_e.thinningShape,u_thinningAffectedRatio:_e.thinningAffectedRatio,u_thinningParticleOffset:_e.thinningParticleOffset,u_shapeDirectionalPower:_e.shapeDirectionalPower,u_shapeNormalPower:_e.shapeNormalPower,u_mode:_e.mode});var _e;let Se=Math.round(y.intensity*this.particlesCount),Ce=i.bg.simpleSegment(0,0,4*Se,2*Se);k.draw(o,A.TRIANGLES,Ht.disabled,ln.disabled,yn.alphaBlended,an.disabled,se,"rain_particles",this.particlesVx,this.particlesIdx,Ce)};y.distortionStrength>0&&j(y.boxSize,!0),j(y.boxSize,!1),this._vignette.draw(o,w)}}let Bv=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Vv extends id{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ql("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=Ws(this.particlesCount),_=new i.eO,y=new i.b0,x=0,w=i.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=w(),F=w(),k=w(),L=[S/f.length,A,F,k],j=[w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...L,...j),_.emplaceBack(M[0],M[1],M[2],1,-1,...L,...j),_.emplaceBack(M[0],M[1],M[2],1,1,...L,...j),_.emplaceBack(M[0],M[1],M[2],-1,1,...L,...j),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,Bv.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;let c=structuredClone(this._params),f=[-c.direction.x,c.direction.y,-100];i.aw(f,f);let _=structuredClone(this._vignetteParams),y=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=o.transform.zoom;if(y.revealStart>x)return;let w=ws(0,1,y.revealStart,y.revealStart+y.revealRange,x);_.strength*=w,c.overrideStyleParameters||(c.intensity=o.style.snow.state.density,c.timeFactor=o.style.snow.state.intensity,c.color=structuredClone(o.style.snow.state.color),f=structuredClone(o.style.snow.state.direction),c.screenThinning.intensity=o.style.snow.state.centerThinning,c.billboardSize=2.79*o.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(o.style.snow.state.vignetteColor));let S=this.updateOnRender(o,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let M=o.context,A=M.gl,F=o.transform,k=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(M,k),((L,j,V)=>{let W=Bm(this._movement.getPosition(),L),q=F.width/2,J=F.height/2,ie=ws(0,V.screenThinning.start,0,1,V.screenThinning.intensity),ee=ws(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),ge=ws(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),de=(fe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:W,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:L,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[q,J],thinningShape:[ie,ee,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:f},{u_modelview:Float32Array.from(fe.modelview),u_projection:Float32Array.from(fe.projection),u_time:fe.time,u_cam_pos:fe.camPos,u_velocityConeAperture:fe.velocityConeAperture,u_velocity:fe.velocity,u_horizontalOscillationRadius:fe.horizontalOscillationRadius,u_horizontalOscillationRate:fe.horizontalOscillationRate,u_boxSize:fe.boxSize,u_billboardSize:fe.billboardSize,u_simpleShapeParameters:fe.simpleShapeParameters,u_screenSize:fe.screenSize,u_thinningCenterPos:fe.thinningCenterPos,u_thinningShape:fe.thinningShape,u_thinningAffectedRatio:fe.thinningAffectedRatio,u_thinningParticleOffset:fe.thinningParticleOffset,u_particleColor:fe.color,u_direction:fe.direction});var fe;let ue=Math.round(V.intensity*this.particlesCount),se=i.bg.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&k.draw(o,A.TRIANGLES,Ht.disabled,ln.disabled,yn.alphaBlended,an.disabled,de,"snow_particles",this.particlesVx,this.particlesIdx,se)})(c.boxSize,0,c),this._vignette.draw(o,_)}}let Yc={symbol:function(p,o,c,f,_){if(p.renderPass!=="translucent")return;let y=ln.disabled,x=p.colorModeForRenderPass(),w=c.layout.get("text-variable-anchor"),S=c.layout.get("text-size-scale-range"),M=i.aA(p.scaleFactor,S[0],S[1]);w&&(function(k,L,j,V,W,q,J,ie){let ee=L.transform,ge=W==="map",de=q==="map";for(let fe of k){let ue=V.getTile(fe),se=ue.getBucket(j);if(!se||!se.text||!se.text.segments.get().length)continue;let _e=i.bK(se.textSizeData,ee.zoom,ie),Se=cl(fe,se.getProjection(),ee),Ce=ee.calculatePixelsToTileUnitsMatrix(ue),Be=Yo(Se,ue.tileID.canonical,de,ge,ee,se.getProjection(),Ce),Ue=se.hasIconTextFit()&&se.hasIconData();_e&&en(se,ge,de,J,ee,Be,fe,Math.pow(2,ee.zoom-ue.tileID.overscaledZ),_e,Ue)}})(f,p,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_,M);let A=c.paint.get("icon-opacity").constantOr(1)!==0,F=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||F)?Ep(p,o,c,f,y,x):(A&&Ep(p,o,c,f,y,x,{onlyIcons:!0}),F&&Ep(p,o,c,f,y,x,{onlyText:!0})),o.map.showCollisionBoxes&&(kt(p,o,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),kt(p,o,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("circle-opacity"),y=c.paint.get("circle-stroke-width"),x=c.paint.get("circle-stroke-opacity"),w=c.layout.get("circle-sort-key").constantOr(1)!==void 0,S=c.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let M=p.context,A=M.gl,F=p.transform,k=!(!p.terrain||!p.terrain.enabled),L=c.layout.get("circle-elevation-reference"),j=p.depthModeForSublayer(0,Ht.ReadOnly),V=new Ht(p.context.gl.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D),W=L==="none"||k?j:V,q=ln.disabled,J=p.colorModeForDrapableLayerRenderPass(S),ie=F.projection.name==="globe",ee=[i.aF(F.center.lng),i.aJ(F.center.lat)],ge=[];for(let fe=0;fe<f.length;fe++){let ue=f[fe],se=o.getTile(ue),_e=se.getBucket(c);if(!_e||_e.projection.name!==F.projection.name)continue;let Se=_e.programConfigurations.get(c.id),Ce=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,Ue=_e.indexBuffer,Ze=i.e0(c),lt=[Be],ke=p.isTileAffectedByFog(ue);ie&&Ze.push("PROJECTION_GLOBE_VIEW"),Ze.push("DEPTH_D24"),p.terrain&&F.depthOcclusionForSymbolsAndCircles&&Ze.push("DEPTH_OCCLUSION"),_e.hasElevation&&!p.terrain&&(Ze.push("ELEVATED_ROADS"),lt.push(_e.elevatedLayoutVertexBuffer));let be=p.getOrCreateProgram("circle",{config:Se,defines:Ze,overrideFog:ke}),He=F.projection.createInversionMatrix(F,ue.canonical),Le={programConfiguration:Se,program:be,layoutVertexBuffer:Ce,dynamicBuffers:lt,indexBuffer:Ue,uniformValues:i.e1(p,ue,se,He,ee,c),tile:se};if(w){let Je=_e.segments.get();for(let yt of Je)ge.push({segments:new i.bg([yt]),sortKey:yt.sortKey,state:Le})}else ge.push({segments:_e.segments,sortKey:0,state:Le})}w&&ge.sort((fe,ue)=>fe.sortKey-ue.sortKey);let de={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let fe of ge){let{programConfiguration:ue,program:se,layoutVertexBuffer:_e,dynamicBuffers:Se,indexBuffer:Ce,uniformValues:Be,tile:Ue}=fe.state,Ze=fe.segments;p.terrain&&p.terrain.setupElevationDraw(Ue,se,de),p.uploadCommonUniforms(M,se,Ue.tileID.toUnwrapped()),se.draw(p,A.TRIANGLES,W,q,J,an.disabled,Be,c.id,_e,Ce,Ze,c.paint,F.zoom,ue,Se)}},heatmap:function(p,o,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let _=p.context,y=_.gl,x=ln.disabled,w=new yn([y.ONE,y.ONE,y.ONE,y.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(L,j,V,W){let q=L.gl,J=j.width*W,ie=j.height*W;L.activeTexture.set(q.TEXTURE1),L.viewport.set([0,0,J,ie]);let ee=V.heatmapFbo;if(!ee||ee&&(ee.width!==J||ee.height!==ie)){ee&&ee.destroy();let ge=q.createTexture();q.bindTexture(q.TEXTURE_2D,ge),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ee=V.heatmapFbo=L.createFramebuffer(J,ie,1,null),(function(de,fe,ue,se,_e,Se){let Ce=de.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,_e,Se,0,Ce.RGBA,de.extRenderToTextureHalfFloat?Ce.HALF_FLOAT:Ce.UNSIGNED_BYTE,null),se.colorAttachment0.set(ue)})(L,0,ge,ee,J,ie)}else q.bindTexture(q.TEXTURE_2D,ee.colorAttachment0.get()),L.bindFramebuffer.set(ee.framebuffer)})(_,p,c,p.transform.projection.name==="globe"?.5:.25),_.clear({color:i.ao.transparent});let S=p.transform,M=S.projection.name==="globe",A=M?["PROJECTION_GLOBE_VIEW"]:[],F=M?an.frontCCW:an.disabled,k=[i.aF(S.center.lng),i.aJ(S.center.lat)];for(let L=0;L<f.length;L++){let j=f[L];if(o.hasRenderableParent(j))continue;let V=o.getTile(j),W=V.getBucket(c);if(!W||W.projection.name!==S.projection.name)continue;let q=p.isTileAffectedByFog(j),J=W.programConfigurations.get(c.id),ie=p.getOrCreateProgram("heatmap",{config:J,defines:A,overrideFog:q}),{zoom:ee}=p.transform;p.terrain&&p.terrain.setupElevationDraw(V,ie),p.uploadCommonUniforms(_,ie,j.toUnwrapped());let ge=S.projection.createInversionMatrix(S,j.canonical);ie.draw(p,y.TRIANGLES,Ht.disabled,x,w,F,pb(p,j,V,ge,k,ee,c.paint.get("heatmap-intensity")),c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,p.transform.zoom,J,M?[W.globeExtVertexBuffer]:null)}_.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(_,y){let x=_.context,w=x.gl,S=y.heatmapFbo;if(!S)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,S.colorAttachment0.get()),x.activeTexture.set(w.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new i.T(x,y.colorRamp,w.RGBA8)),M.bind(w.LINEAR,w.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,w.TRIANGLES,Ht.disabled,ln.disabled,_.colorModeForRenderPass(),an.disabled,((A,F,k,L)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)})(p,c))},line:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("line-opacity"),y=c.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;let x=c.paint.get("line-emissive-strength").isConstant(),w=c.paint.get("line-emissive-strength").constantOr(0),S=c.paint.get("line-occlusion-opacity"),M=c.layout.get("line-elevation-reference"),A=c.layout.get("line-width-unit")==="meters",F=M==="sea",k=!(!p.terrain||!p.terrain.enabled),L=p.context,j=L.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;let V=c.layout.get("line-cross-slope"),W=V!==void 0,q=V<1,J=p.colorModeForDrapableLayerRenderPass(x?w:null),ie=p.terrain&&p.terrain.renderingToTexture,ee=ie?1:i.o.devicePixelRatio,ge=c.paint.get("line-dasharray"),de=ge.constantOr(1),fe=c.layout.get("line-cap"),ue=ge.constantOr(null),se=fe.constantOr(null),_e=c.paint.get("line-pattern"),Se=_e.constantOr(1),Ce=c.paint.get("line-pattern-cross-fade"),Be=_e.constantOr(null),Ue=c.paint.get("line-opacity").constantOr(1),Ze=!Se&&Ue!==1||p.depthOcclusion&&S>0&&S<1,lt=c.paint.get("line-gradient"),ke=Se?"linePattern":"line",be=i.e2(c),He;if(ie&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Ze=!1),S!==0&&p.depthOcclusion){let Mt=c.paint._values["line-opacity"];Mt&&Mt.value&&Mt.value.kind==="constant"?He=Mt.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&be.push("VARIABLE_LINE_WIDTH"),ie&&(p.emissiveMode!=="dual-source-blending"||x?p.emissiveMode==="mrt-fallback"&&be.push("USE_MRT1"):be.push("DUAL_SOURCE_BLENDING"));let Le=(Mt,pt,ct,Vt,Lt,St)=>{for(let At of Mt){let Jt=o.getTile(At);if(Se&&!Jt.patternsLoaded())continue;let pn=Jt.getBucket(c);if(!pn||pn.elevationType!=="none"&&!Lt||pn.elevationType==="none"&&Lt)continue;p.prepareDrawTile();let Fn=[...pt],Jn=p.shadowRenderer,Ut=pn.elevationType==="road"&&!!Jn&&Jn.enabled,Xn=[0,0,0];if(Ut){let wn=p.style.directionalLight,Bi=p.style.ambientLight;wn&&Bi&&(Xn=ql(p.style,wn,Bi)),Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let hn=pn.programConfigurations.get(c.id),ii=!1;if(Be&&Jt.imageAtlas){let wn=i.e3.from(Be),Bi=wn.getPrimary().scaleSelf(ee).toString(),br=Jt.imageAtlas.patternPositions.get(Bi),er=wn.getSecondary(),Ei=er?Jt.imageAtlas.patternPositions.get(er.scaleSelf(ee).toString()):null;ii=!!br&&!!Ei,br&&hn.setConstantPatternPositions(br,Ei)}Ce>0&&(ii||hn.getPatternTransitionVertexBuffer("line-pattern"))&&Fn.push("LINE_PATTERN_TRANSITION");let fi=p.isTileAffectedByFog(At),ui=p.getOrCreateProgram(ke,{config:hn,defines:Fn,overrideFog:fi});if(!Se&&ue&&se&&Jt.lineAtlas){let wn=Jt.lineAtlas.getDash(ue,se);wn&&hn.setConstantPatternPositions(wn)}Ut&&Jn.setupShadows(Jt.tileID.toUnwrapped(),ui,"vector-tile");let[Wn,bn]=c.paint.get("line-trim-offset");(se==="round"||se==="square")&&Wn!==bn&&(Wn===0&&(Wn-=1),bn===1&&(bn+=1));let ti=ie?At.projMatrix:null,ar=A?1/pn.tileToMeter/i.ay(Jt,1,p.transform.zoom):1,qi=A?1/pn.tileToMeter/i.ay(Jt,1,Math.floor(p.transform.zoom)):1,ri=Se?i.e4(p,Jt,c,ti,ee,ar,qi,[Wn,bn],Xn,Ce):i.e5(p,Jt,c,ti,pn.lineClipsArray.length,ee,ar,qi,[Wn,bn],Xn);if(lt){let wn=pn.gradients[c.id],Bi=wn.texture;if(c.gradientVersion!==wn.version){let br=256;if(c.stepInterpolant){let er=o.getSource().maxzoom,Ei=At.canonical.z===er?Math.ceil(1<<p.transform.maxZoom-At.canonical.z):1;br=i.aA(i.e6(pn.maxLineLength/i.al*1024*Ei),256,L.maxTextureSize)}wn.gradient=i.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:br,image:wn.gradient||void 0,clips:pn.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new i.T(L,wn.gradient,j.RGBA8),wn.version=c.gradientVersion,Bi=wn.texture}L.activeTexture.set(j.TEXTURE1),Bi.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}de&&(L.activeTexture.set(j.TEXTURE0),Jt.lineAtlasTexture&&Jt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),hn.updatePaintBuffers()),Se&&(L.activeTexture.set(j.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),hn.updatePaintBuffers()),Lt&&!F&&p.terrain.setupElevationDraw(Jt,ui),p.uploadCommonUniforms(L,ui,At.toUnwrapped());let jn=wn=>{He!=null&&(He.value=Ue*S),ui.draw(p,j.TRIANGLES,ct,wn,J,an.disabled,ri,c.id,pn.layoutVertexBuffer,pn.indexBuffer,pn.segments,c.paint,p.transform.zoom,hn,[pn.layoutVertexBuffer2,pn.patternVertexBuffer,pn.zOffsetVertexBuffer]),He!=null&&(He.value=Ue)};if(Ze&&!Lt){let wn=p.stencilModeForClipping(At).ref;wn===0&&ie&&L.clear({stencil:0});let Bi={func:j.EQUAL,mask:255};ri.u_alpha_discard_threshold=.8,jn(new ln(Bi,wn,255,j.KEEP,j.KEEP,j.INVERT)),ri.u_alpha_discard_threshold=0,jn(new ln(Bi,wn,255,j.KEEP,j.KEEP,j.KEEP))}else ri.u_alpha_discard_threshold=Ze&&Lt&&St?.8:0,jn(Lt?Vt:p.stencilModeForClipping(At))}},Je=p.depthModeForSublayer(0,Ht.ReadOnly),yt=new Ht(p.depthOcclusion?j.GREATER:j.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){let Mt=!ie&&p.terrain;S!==0&&Mt?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Mt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Le(f,be,Je,ln.disabled,!1,!0)}if(c.hasElevatedBuckets){M==="hd-road-markup"?k||(Je=yt,be.push("ELEVATED_ROADS")):(be.push("ELEVATED"),Je=yt,W&&be.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&be.push("ELEVATION_REFERENCE_SEA"));let Mt=Ze?p.stencilModeFor3D():ln.disabled;p.forceTerrainMode=!0,Le(f,be,Je,Mt,!0,!0),Ze&&Le(f,be,Je,Mt,!0,!1),p.forceTerrainMode=!1}Ze&&(p.resetStencilClippingMasks(),ie&&L.clear({stencil:0})),S===0||p.depthOcclusion||ie||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,o,c,f){let _=c.paint.get("fill-color"),y=c.paint.get("fill-opacity");if(y.constantOr(1)===0)return;let x=c.paint.get("fill-emissive-strength"),w=p.colorModeForDrapableLayerRenderPass(x),S=c.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(i.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent",A="none";c.layout.get("fill-elevation-reference")!=="none"?A="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(A="offset");let F=!(!p.terrain||!p.terrain.enabled),k={painter:p,sourceCache:o,layer:c,coords:f,colorMode:w,elevationType:A,terrainEnabled:F,pass:M};if(p.renderPass==="shadow")return void(p.shadowRenderer&&A==="road"&&!F&&(function(j){let{painter:V,sourceCache:W,layer:q,coords:J}=j,ie=V.context.gl,ee=j.painter.shadowRenderer;for(let ge of J){let de=W.getTile(ge),fe=de.getBucket(q);if(!fe)continue;let ue=fe.elevatedStructures;if(!ue||!ue.shadowCasterSegments||ue.shadowCasterSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();let se=fe.bufferData.programConfigurations.get(q.id),_e=V.isTileAffectedByFog(ge),Se=V.getOrCreateProgram("elevatedStructuresDepth",{config:se,overrideFog:_e}),Ce=ee.calculateShadowPassMatrixFromTile(de.tileID.toUnwrapped());V.uploadCommonUniforms(V.context,Se,ge.toUnwrapped());let Be={u_matrix:Ce,u_depth_bias:0};Se.draw(V,ie.TRIANGLES,ee.getShadowPassDepthMode(),ln.disabled,ee.getShadowPassColorMode(),an.disabled,Be,q.id,ue.vertexBuffer,ue.indexBuffer,ue.shadowCasterSegments,q.paint,V.transform.zoom,se)}})(k));let L=p.emissiveMode==="mrt-fallback";if(A!=="offset"){if(Mm(k,!1,L),A==="road"){let j=!F&&p.renderPass==="translucent";j&&Im(p,o,c,f,"geometry"),Mm(k,!0,L,ln.disabled),j&&(function(V){let{painter:W,sourceCache:q,layer:J,coords:ie,colorMode:ee}=V,ge=W.context.gl,de=V.painter.shadowRenderer,fe=!!de&&de.enabled,ue=new Ht(W.context.gl.LEQUAL,Ht.ReadOnly,W.depthRangeFor3D),se=[0,0,0];if(fe){let Se=W.style.directionalLight,Ce=W.style.ambientLight;Se&&Ce&&(se=ql(W.style,Se,Ce))}let _e=Se=>{for(let Ce of ie){let Be=q.getTile(Ce),Ue=Be.getBucket(J);if(!Ue)continue;let Ze=Ue.elevatedStructures;if(!Ze)continue;let lt,ke;if(Se?(lt=Ze.renderableBridgeSegments,ke=Ze.bridgeProgramConfigurations.get(J.id)):(lt=Ze.renderableTunnelSegments,ke=Ze.tunnelProgramConfigurations.get(J.id)),!lt||lt.segments[0].primitiveLength===0)continue;ke.updatePaintBuffers(),W.prepareDrawTile();let be=W.isTileAffectedByFog(Ce),He=[];fe&&He.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let Le=W.getOrCreateProgram("elevatedStructures",{config:ke,overrideFog:be,defines:He}),Je=W.translatePosMatrix(Ce.projMatrix,Be,J.paint.get("fill-translate"),J.paint.get("fill-translate-anchor"));fe&&de.setupShadows(Be.tileID.toUnwrapped(),Le,"vector-tile");let yt=Gc(Je,se);W.uploadCommonUniforms(W.context,Le,Ce.toUnwrapped()),Le.draw(W,ge.TRIANGLES,ue,ln.disabled,ee,an.backCCW,yt,J.id,Ze.vertexBuffer,Ze.indexBuffer,lt,J.paint,W.transform.zoom,ke,[Ze.vertexBufferNormal])}};_e(!0),_e(!1)})(k)}}else Mm(k,!1,L,p.stencilModeFor3D())},"fill-extrusion":function(p,o,c,f){let _=c.paint.get("fill-extrusion-opacity"),y=p.context,x=y.gl,w=p.terrain,S=w&&w.renderingToTexture;if(_===0)return;let M=p.emissiveMode==="mrt-fallback",A=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),F=p.style.order.indexOf(c.fqid);if(A&&(function(k,L,j,V,W){for(let q of V){let J=L.getTile(q).getBucket(j);J&&(J.updateReplacement(q,k.replacementSource,W),J.uploadCentroid(k.context))}})(p,o,c,f,F),w||A)for(let k of f){let L=o.getTile(k).getBucket(c);L&&cT(p.context,o,k,L,c,w,A)}if(p.renderPass==="shadow"&&p.shadowRenderer){let k=p.shadowRenderer;if(w&&_<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;let L=k.getShadowPassDepthMode(),j=k.getShadowPassColorMode();Dm(p,o,c,f,L,ln.disabled,j,A)}else if(p.renderPass==="translucent"){let k=!c.paint.get("fill-extrusion-pattern").constantOr(1),L=c.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!S&&L.a!==0){let j=new Ht(p.context.gl.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D);_===1&&k?Dm(p,o,c,f,j,ln.disabled,yn.unblended,A):(Dm(p,o,c,f,j,ln.disabled,yn.disabled,A),Dm(p,o,c,f,j,p.stencilModeFor3D(),p.colorModeForRenderPass(),A),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&k&&(!w&&p.transform.projection.name!=="globe"||S)){let j=c.paint.get("fill-extrusion-opacity"),V=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=c.paint.get("fill-extrusion-flood-light-intensity"),J=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(J?null:c.lut).toArray01().slice(0,3),ee=V>0&&W>0,ge=q>0,de=(se,_e,Se)=>(1-Se)*se+Se*_e,fe=new Rv;fe.translate=c.paint.get("fill-extrusion-translate"),fe.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),fe.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),fe.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");let ue=se=>{let _e=p.depthModeForSublayer(1,Ht.ReadOnly,x.LEQUAL,!0),Se=c.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=de(.1,3,Se),Be=p._showOverdrawInspector;if(!Be){let Ue=new ln({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ze=new yn([x.ONE,x.ONE,x.ONE,x.ONE],i.ao.transparent,[!1,!1,!1,!0],x.MIN);Xl(fe,p,o,c,f,_e,Ue,Ze,an.disabled,se,"sdf",j,V,W,q,ie,Ce,A,!1)}{let Ue=Be?ln.disabled:new ln({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ze=Be?p.colorModeForRenderPass():new yn([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],i.ao.transparent,[!0,!0,!0,!0]);Xl(fe,p,o,c,f,_e,Ue,Ze,an.disabled,se,"color",j,V,W,q,ie,Ce,A,!1)}};if(S){let se=()=>{let Se=w.drapeBufferSize[0],Ce=w.drapeBufferSize[1],Be=w.framebufferCopyTexture;return Be&&(!Be||Be.size[0]===Se&&Be.size[1]===Ce)||(Be&&Be.destroy(),Be=w.framebufferCopyTexture=new i.T(y,new i.q({width:Se,height:Ce}),x.RGBA8)),Be.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,Se,Ce),Be},_e=(Se,Ce,Be)=>{let Ue=p.depthModeForSublayer(1,Ht.ReadOnly,x.LEQUAL,!1),Ze=c.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),lt=de(.1,3,Ze);{let ke=new yn([x.ONE,x.ONE,x.ONE,x.ONE],i.ao.transparent,[!1,!1,!1,!0]);Xl(fe,p,o,c,f,Ue,ln.disabled,ke,an.disabled,Se,"clear",j,V,W,q,ie,lt,A,Ce)}{let ke=new ln({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),be=new yn([x.ONE,x.ONE,x.ONE,x.ONE],i.ao.transparent,[!1,!1,!1,!0],x.MIN);Xl(fe,p,o,c,f,Ue,ke,be,an.disabled,Se,"sdf",j,V,W,q,ie,lt,A,Ce)}M&&!Se&&(Be=se());{let ke=Se?x.ZERO:x.ONE_MINUS_DST_ALPHA,be=new ln({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),He=new yn([ke,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Xl(fe,p,o,c,f,Ue,be,He,an.disabled,Se,"color",j,V,W,q,ie,lt,A,Ce)}if(!M||Se){let ke=new yn([x.ONE,x.ONE,x.ONE,Se?x.ZERO:x.ONE],i.ao.transparent,[!1,!1,!1,!0],Se?x.FUNC_ADD:x.MAX);Xl(fe,p,o,c,f,Ue,ln.disabled,ke,an.disabled,Se,"clear",j,V,W,q,ie,lt,A,Ce,Be)}else{x.drawBuffers([x.NONE,x.COLOR_ATTACHMENT1]);let ke=new ln({func:x.EQUAL,mask:255},254,255,x.KEEP,x.DECR,x.DECR),be=new yn([x.ONE,x.ONE,x.ONE,x.ONE],i.ao.transparent,[!0,!1,!1,!1],x.MAX);Xl(fe,p,o,c,f,Ue,ke,be,an.disabled,Se,"emissive",j,V,W,q,ie,lt,A,Ce,Be),x.drawBuffers([x.COLOR_ATTACHMENT0])}};if(ee||ge){let Se;p.prepareDrawTile(),M&&!ee||(Se=se()),ee&&_e(!0,!1,Se),ge&&_e(!1,!0,Se)}}else ee&&ue(!0),ge&&ue(!1),(ee||ge)&&p.resetStencilClippingMasks()}}},building:function(p,o,c,f){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);let _=c.paint.get("building-ambient-occlusion-ground-intensity"),y=c.paint.get("building-ambient-occlusion-ground-radius"),x=c.paint.get("building-ambient-occlusion-ground-attenuation"),w=c.paint.get("building-opacity");if(w<=0)return;let S=_>0&&y>0,M=!0,A=c.paint.get("building-vertical-scale");if(A<=0)return;p.shadowRenderer||(M=!1);let F=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),k=p.style.order.indexOf(c.fqid);if((function(L,j,V,W,q,J){for(let ie of J){let ee=j.getTile(ie).getBucket(V);ee&&(q&&ee.updateReplacement(ie,L.replacementSource,W),ee.uploadUpdatedIndexBuffer(L.context))}})(p,o,c,k,F,f),(function(L,j,V,W){for(let q of W){let J=j.getTile(q).getBucket(V);J&&J.needsEvaluation()&&J.uploadUpdatedColorBuffer(L.context)}})(p,o,c,f),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){let L=p.shadowRenderer,j=[],V=L.getShadowPassDepthMode();Sp({painter:p,source:o,layer:c,coords:f,defines:j,blendMode:L.getShadowPassColorMode(),depthMode:V,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let L=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(L=L.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(L=L.concat("NORMAL_OFFSET"));let j=c.paint.get("building-facade-emissive-chance"),V=c.paint.get("building-ambient-occlusion-intensity"),W=c.paint.get("building-flood-light-intensity"),q=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",J=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(q?null:c.lut).toArray01().slice(0,3),ie=c.paint.get("building-flood-light-ground-attenuation"),ee=W>0,ge=new Ht(p.context.gl.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D);w<1&&Sp({painter:p,source:o,layer:c,coords:f,defines:L,blendMode:yn.disabled,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:V,floodLightIntensity:W,floodLightColor:J,depthOnly:!0});let de=p.colorModeForRenderPass();Sp({painter:p,source:o,layer:c,coords:f,defines:L,blendMode:de,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:V,floodLightIntensity:W,floodLightColor:J}),S&&Am(p,o,c,f,!0,w,_,y,W,J,x,F),ee&&Am(p,o,c,f,!1,w,_,y,W,J,ie,F)}else if(p.renderPass==="light-beam"){let L=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],j=new Ht(p.context.gl.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D);Sp({painter:p,source:o,layer:c,coords:f,defines:L,blendMode:yn.alphaBlended,depthMode:j,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,o,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let _=p.context,y=p.terrain&&p.terrain.renderingToTexture,[x,w]=p.renderPass!=="translucent"||y?[{},f]:p.stencilConfigForOverlap(f);for(let S of w){let M=o.getTile(S);if(M.needsHillshadePrepare&&p.renderPass==="offscreen")JS(p,M,c);else if(p.renderPass==="translucent"){let A=p.depthModeForSublayer(0,Ht.ReadOnly),F=c.paint.get("hillshade-emissive-strength"),k=p.colorModeForDrapableLayerRenderPass(F),L=y&&p.terrain?p.terrain.stencilModeForRTTOverlap(S):x[S.overscaledZ];QS(p,S,M,c,A,L,k)}}_.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,c,f,_,y){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let x=p.transform.projection.name==="globe",w=c.paint.get("raster-elevation")!==0,S=w&&x;if(p.renderElevatedRasterBackface&&!S)return;let M=p.context,A=M.gl,F=o.getSource(),k=(function(de,fe,ue,se,_e){let Se=fe.paint.get("raster-color"),Ce=de.type==="raster-array",Be=[],Ue=fe.paint.get("raster-resampling"),Ze=fe.paint.get("raster-color-mix"),lt=fe.paint.get("raster-color-range"),ke=[Ze[0],Ze[1],Ze[2],0],be=Ze[3],He=Ue==="nearest"?se.NEAREST:se.LINEAR;if(Ce&&(Be.push("RASTER_ARRAY"),Se||Be.push("RASTER_COLOR"),Ue==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),He=se.NEAREST,!lt&&de.rasterLayers)){let Le=de.rasterLayers.find(({id:Je})=>Je===fe.sourceLayer);Le&&Le.fields&&Le.fields.range&&(lt=Le.fields.range)}if(lt=lt||[0,1],Se){Be.push("RASTER_COLOR"),ue.activeTexture.set(se.TEXTURE2),fe.updateColorRamp(lt);let Le=fe.colorRampTexture;Le||(Le=fe.colorRampTexture=new i.T(ue,fe.colorRamp,se.RGBA8)),Le.bind(se.LINEAR,se.CLAMP_TO_EDGE)}return _e&&Be.push("USE_MRT1"),{mix:ke,range:lt,offset:be,defines:Be,resampling:He}})(F,c,M,A,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(F instanceof i.aU&&!f.length&&!x)return;let L=c.paint.get("raster-emissive-strength"),j=p.colorModeForDrapableLayerRenderPass(L),V=p.terrain&&p.terrain.renderingToTexture,W=!p.options.moving,q=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(F instanceof i.aU&&!f.length&&(F.onNorthPole||F.onSouthPole)){let de=w?p.stencilModeFor3D():ln.disabled;return void Tp(!!F.onNorthPole,null,p,o,c,L,k,an.disabled,de)}if(!f.length)return;let[J,ie]=F instanceof i.aU||V?[{},f]:p.stencilConfigForOverlap(f),ee=ie[ie.length-1].overscaledZ;S&&k.defines.push("PROJECTION_GLOBE_VIEW"),w&&k.defines.push("RENDER_CUTOFF");let ge=(de,fe,ue)=>{for(let se of de){let _e=se.toUnwrapped(),Se=o.getTile(se);if(V&&(!Se||!Se.hasData()))continue;M.activeTexture.set(A.TEXTURE0);let Ce=Kl(Se,F,c,k);if(!Ce||!Ce.texture)continue;let{texture:Be,mix:Ue,offset:Ze,tileSize:lt,buffer:ke}=Ce,be,He;V?(be=Ht.disabled,He=se.projMatrix):w?(be=new Ht(A.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D),He=x?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(_e,W)):(be=p.depthModeForSublayer(se.overscaledZ-ee,c.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,A.LESS),He=p.transform.calculateProjMatrix(_e,W));let Le=p.terrain&&V?p.terrain.stencilModeForRTTOverlap(se):J[se.overscaledZ],Je=y?0:c.paint.get("raster-fade-duration");Se.registerFadeDuration(Je);let yt=o.findLoadedParent(se,0),Mt=yp(Se,yt,o,p.transform,Je),pt,ct;!Mt.isFading&&Se.refreshedUponExpiration&&(Se.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),M.activeTexture.set(A.TEXTURE0),Be.bind(q,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),yt?(yt.texture&&yt.texture.bind(q,A.CLAMP_TO_EDGE),pt=Math.pow(2,yt.tileID.overscaledZ-Se.tileID.overscaledZ),ct=[Se.tileID.canonical.x*pt%1,Se.tileID.canonical.y*pt%1]):Be.bind(q,A.CLAMP_TO_EDGE),"useMipmap"in Be&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let Vt=p.transform,Lt,St=w?bb(Vt):[0,0,0,0],At,Jt,pn,Fn,Jn,Ut=0;if(S&&F instanceof i.aU&&F.coordinates.length>3)At=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),Jt=Float32Array.from(Vt.globeMatrix),pn=Float32Array.from(i.dF(Vt)),Fn=[i.aF(Vt.center.lng),i.aJ(Vt.center.lat)],Lt=F.elevatedGlobePerspectiveTransform,Jn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let fi=i.dG(se.canonical);Ut=i.dH(fi.getCenter().lat),At=Float32Array.from(i.bk(i.dJ(se.canonical))),Jt=Float32Array.from(Vt.globeMatrix),pn=Float32Array.from(i.dF(Vt)),Fn=[i.aF(Vt.center.lng),i.aJ(Vt.center.lat)],Lt=[0,0],Jn=Float32Array.from(i.dI(se.canonical,fi,Ut,Vt.worldSize/Vt._pixelsPerMercatorPixel))}else Lt=F instanceof i.aU?F.perspectiveTransform:[0,0],At=new Float32Array(16),Jt=new Float32Array(9),pn=new Float32Array(16),Fn=[0,0],Jn=new Float32Array(9);let Xn=fb(He,At,Jt,pn,Jn,ct||[0,0],i.aj(p.transform.zoom),Fn,St,pt||1,Mt,c,Lt,w?c.paint.get("raster-elevation"):0,2,Ue,Ze,k.range,lt,ke,L),hn=p.isTileAffectedByFog(se),ii=p.getOrCreateProgram("raster",{defines:k.defines,overrideFog:hn});if(p.uploadCommonUniforms(M,ii,_e),F instanceof i.aU){let fi=F.elevatedGlobeVertexBuffer,ui=F.elevatedGlobeIndexBuffer;if(V||!x)F.boundsBuffer&&F.boundsSegments&&ii.draw(p,A.TRIANGLES,be,ln.disabled,j,an.disabled,Xn,c.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments);else if(fi&&ui){let Wn=Vt.zoom<=i.c_?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Vt.center.lng);Wn&&ii.draw(p,A.TRIANGLES,be,ln.disabled,j,fe,Xn,c.id,fi,ui,Wn)}}else if(S){be=new Ht(A.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D);let fi=p.globeSharedBuffers;if(fi){let[ui,Wn,bn]=fi.getGridBuffers(Ut,!1);ii.draw(p,A.TRIANGLES,be,ue||Le,p.colorModeForRenderPass(),fe,Xn,c.id,ui,Wn,bn)}}else{let{tileBoundsBuffer:fi,tileBoundsIndexBuffer:ui,tileBoundsSegments:Wn}=p.getTileBoundsBuffers(Se);ii.draw(p,A.TRIANGLES,be,Le,j,an.disabled,Xn,c.id,fi,ui,Wn)}}if(!(F instanceof i.aU)&&S)for(let se of de){let _e=se.canonical.y===(1<<se.canonical.z)-1;se.canonical.y===0&&Tp(!0,se,p,o,c,L,k,fe,ue||ln.disabled),_e&&Tp(!1,se,p,o,c,L,k,fe===an.frontCW?an.backCW:an.frontCW,ue||ln.disabled)}};S?ge(ie,p.renderElevatedRasterBackface?an.backCW:an.frontCW,p.stencilModeFor3D()):ge(ie,an.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,o,c,f,_,y){p.renderPass==="offscreen"&&(function(x,w,S,M){if(!M.length)return;let A=x.context,F=A.gl,k=w.getSource();if(!(k instanceof Xo))return;let L=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count"))),j=S.particlePositionRGBAImage;if(!j||j.width!==L){let ie=(function(ee){let ge=ee*ee,de=new Uint8Array(4*ge),fe=function(se){return se|=0,se=Math.imul(2747636419^se,2654435769),se=Math.imul(se^se>>>16,2654435769),((se=Math.imul(se^se>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let se=0;se<ge;se++){let _e=ue*(fe(2*se+0)+fl),Se=ue*(fe(2*se+1)+fl),Ce=255*_e%1,Be=255*Se%1,Ue=Ce,Ze=Se-Be/255,lt=Be;de[4*se+0]=255*(_e-Ce/255),de[4*se+1]=255*Ue,de[4*se+2]=255*Ze,de[4*se+3]=255*lt}return de})(L);j=S.particlePositionRGBAImage=new i.q({width:L,height:L},ie)}let V=S.particleFramebuffer;V?V.width!==L&&(V.destroy(),V=S.particleFramebuffer=A.createFramebuffer(L,L,1,null)):V=S.particleFramebuffer=A.createFramebuffer(L,L,1,null);let W=[];for(let ie of M){let ee=w.getTile(ie);if(!(ee instanceof Hf))continue;let ge=Fv(ee,k,S);if(!ge)continue;let de=[ee.tileSize,ee.tileSize],fe=S.tileFramebuffer;fe||(fe=S.tileFramebuffer=A.createFramebuffer(de[0],de[1],1,null));let ue=ee.rasterParticleState;ue||(ue=ee.rasterParticleState=new Om(A,ie,de,j));let se=ue.update(S.lastInvalidatedAt);ue.particleTextureDimension!==L&&ue.updateParticleTexture(ie,j);let _e=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=_e;let Se=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=Se,W.push([ie,ge,ue,se])}if(W.length===0)return;let q=i.o.now(),J=S.previousDrawTimestamp?.001*(q-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=q,S.hasColorMap()){A.activeTexture.set(F.TEXTURE0+2);let ie=S.colorRampTexture;ie||(ie=S.colorRampTexture=new i.T(A,S.colorRamp,F.RGBA8)),ie.bind(F.LINEAR,F.CLAMP_TO_EDGE)}A.bindFramebuffer.set(S.tileFramebuffer.framebuffer),(function(ie,ee,ge){let de=ie.context,fe=de.gl,ue=ee.tileFramebuffer;de.activeTexture.set(fe.TEXTURE0);let se={u_texture:0,u_opacity:1.05*(Se=ee.paint.get("raster-particle-fade-opacity-factor"))/(Se+.05)},_e=ie.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Se;for(let Ce of ge){let[,,Be,Ue]=Ce;ue.colorAttachment0.set(Be.targetColorTexture.texture),de.viewport.set([0,0,ue.width,ue.height]),de.clear({color:i.ao.transparent}),Ue&&(Be.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),_e.draw(ie,fe.TRIANGLES,Ht.disabled,ln.disabled,yn.alphaBlended,an.disabled,se,ee.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments))}})(x,S,W),(function(ie,ee,ge,de){let fe=ie.context,ue=fe.gl,se=ge.tileFramebuffer,_e=ie.transform.projection.name==="globe",Se=ge.paint.get("raster-particle-max-speed");for(let Ce of de){let[Be,Ue,Ze]=Ce;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),se.colorAttachment0.set(Ze.targetColorTexture.texture);let lt=ie.getOrCreateProgram("rasterParticleDraw",{defines:Ue.defines,overrideFog:!1});fe.activeTexture.set(ue.TEXTURE0+1);let ke=Ue.scalarData?[]:[0,1,2,3].map(Le=>i.e9[Le](Be));ke.push(Be);let be=Be.canonical.x,He=Be.canonical.y;for(let Le of ke){let Je=ee.getTile(_e?Le.wrapped():Le);if(!Je)continue;let yt=Je.rasterParticleState;if(!yt)continue;let Mt=Le.canonical.x+(1<<Le.canonical.z)*(Le.wrap-Be.wrap),pt=Le.canonical.y;yt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let ct=lT(1,yt.particleTexture0.size[0],[Mt-be,pt-He],0,Ue.texture.size,2,Se,Ue.textureOffset,Ue.scale,Ue.offset);lt.draw(ie,ue.POINTS,Ht.disabled,ln.disabled,yn.alphaBlended,an.disabled,ct,ge.id,yt.particleIndexBuffer,void 0,yt.particleSegment)}}})(x,w,S,W),A.bindFramebuffer.set(S.particleFramebuffer.framebuffer),(function(ie,ee,ge,de){let fe=ie.context,ue=fe.gl,se=ee.paint.get("raster-particle-max-speed"),_e=de*ee.paint.get("raster-particle-speed-factor")*.15,Se=(function(Be){return Math.pow(Be,6)})(.01+1*ee.paint.get("raster-particle-reset-rate-factor")),Ce=ee.particleFramebuffer;fe.viewport.set([0,0,Ce.width,Ce.height]);for(let Be of ge){let[,Ue,Ze]=Be;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),fe.activeTexture.set(ue.TEXTURE0+1);let lt=Ze.particleTexture0;lt.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let ke=gb(1,lt.size[0],0,Ue.texture.size,se,_e,Se,Ue.textureOffset,Ue.scale,Ue.offset);Ce.colorAttachment0.set(Ze.particleTexture1.texture),fe.clear({color:i.ao.transparent}),ie.getOrCreateProgram("rasterParticleUpdate",{defines:Ue.defines}).draw(ie,ue.TRIANGLES,Ht.disabled,ln.disabled,yn.unblended,an.disabled,ke,ee.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments)}})(x,S,W,J)})(p,o,c,f),p.renderPass==="translucent"&&((function(x,w,S,M,A){let F=x.context,k=F.gl,L=w.getSource().tileSize,j=5*(1-i.ah(i.cL,i.cL+1,x.transform.zoom))*L+S.paint.get("raster-particle-elevation"),V=!x.options.moving,W=x.transform.projection.name==="globe";if(!M.length)return;let[q,J]=x.stencilConfigForOverlap(M),ie=[];W&&ie.push("PROJECTION_GLOBE_VIEW");let ee=x.stencilModeFor3D();for(let ge of J){let de=ge.toUnwrapped(),fe=w.getTile(ge);if(!fe.rasterParticleState)continue;let ue=fe.rasterParticleState,se=100;fe.registerFadeDuration(se);let _e=w.findLoadedParent(ge,0),Se=yp(fe,_e,w,x.transform,se),Ce,Be;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(k.TEXTURE0),ue.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),F.activeTexture.set(k.TEXTURE1),_e&&_e.rasterParticleState?(_e.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ce=Math.pow(2,_e.tileID.overscaledZ-fe.tileID.overscaledZ),Be=[fe.tileID.canonical.x*Ce%1,fe.tileID.canonical.y*Ce%1]):ue.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);let Ue=W?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(de,V),Ze=x.transform,lt=wb(Ze),ke=i.dG(ge.canonical),be=i.dH(ke.getCenter().lat),He,Le,Je,yt,Mt;W?(He=Float32Array.from(i.bk(i.dJ(ge.canonical))),Le=Float32Array.from(Ze.globeMatrix),Je=Float32Array.from(i.dF(Ze)),yt=[i.aF(Ze.center.lng),i.aJ(Ze.center.lat)],Mt=Float32Array.from(i.dI(ge.canonical,ke,be,Ze.worldSize/Ze._pixelsPerMercatorPixel))):(He=new Float32Array(16),Le=new Float32Array(9),Je=new Float32Array(16),yt=[0,0],Mt=new Float32Array(9));let pt=aT(Ue,He,Le,Je,Mt,Be||[0,0],i.aj(x.transform.zoom),yt,lt,Ce||1,Se,j),ct=x.isTileAffectedByFog(ge),Vt=x.getOrCreateProgram("rasterParticle",{defines:ie,overrideFog:ct});if(x.uploadCommonUniforms(F,Vt,de),W){let Lt=new Ht(k.LEQUAL,Ht.ReadOnly,x.depthRangeFor3D),St=0,At=x.globeSharedBuffers;if(At){let[Jt,pn,Fn]=At.getGridBuffers(be,St!==0);Vt.draw(x,k.TRIANGLES,Lt,ee,yn.alphaBlended,x.renderElevatedRasterBackface?an.frontCCW:an.backCCW,pt,S.id,Jt,pn,Fn)}}else{let Lt=x.depthModeForSublayer(0,Ht.ReadOnly),St=q[ge.overscaledZ],{tileBoundsBuffer:At,tileBoundsIndexBuffer:Jt,tileBoundsSegments:pn}=x.getTileBoundsBuffers(fe);Vt.draw(x,k.TRIANGLES,Lt,St,yn.alphaBlended,an.disabled,pt,S.id,At,Jt,pn)}}x.resetStencilClippingMasks()})(p,o,c,f),p.style.map.triggerRepaint())},background:function(p,o,c,f){let _=c.paint.get("background-color"),y=c.paint.get("background-color-use-theme").constantOr("default")==="none",x=c.paint.get("background-opacity"),w=c.paint.get("background-emissive-strength"),S=c.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let M=p.context,A=M.gl,F=p.transform,k=F.tileSize,L=c.paint.get("background-pattern"),j;if(L!==void 0&&(L===null||(j=p.imageManager.getPattern(i.I.from(L.toString()),c.scope,p.style.getLut(c.scope)),!j)))return;let V=!L&&_.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==V)return;let W=ln.disabled,q=p.depthModeForSublayer(0,V==="opaque"?Ht.ReadWrite:Ht.ReadOnly),J=p.colorModeForDrapableLayerRenderPass(w),ie=L?"backgroundPattern":"background",ee,ge=f;ge||(ee=p.getBackgroundTiles(),ge=Object.values(ee).map(fe=>fe.tileID)),L&&(M.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context,c.scope));let de=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&de.push("USE_MRT1"),S){let fe=p.getOrCreateProgram(ie,{overrideFog:!1,overrideRtt:!0,defines:de}),ue=new Float32Array(i.bA([])),se=new i.aQ(0,0,0,0,0),_e=L?Wc(ue,w,x,p,0,c.scope,j,S,{tileID:se,tileSize:k}):bp(ue,w,x,_.toPremultipliedRenderColor(y?null:c.lut));fe.draw(p,A.TRIANGLES,q,W,J,an.disabled,_e,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(let fe of ge){let ue=p.isTileAffectedByFog(fe),se=p.getOrCreateProgram(ie,{overrideFog:ue,defines:de}),_e=fe.toUnwrapped(),Se=f?fe.projMatrix:p.transform.calculateProjMatrix(_e);p.prepareDrawTile();let Ce=o?o.getTile(fe):ee?ee[fe.key]:new ju(fe,k,F.zoom,p),Be=L?Wc(Se,w,x,p,0,c.scope,j,S,{tileID:fe,tileSize:k}):bp(Se,w,x,_.toPremultipliedRenderColor(y?null:c.lut));p.uploadCommonUniforms(M,se,_e);let{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Ze,tileBoundsSegments:lt}=p.getTileBoundsBuffers(Ce);se.draw(p,A.TRIANGLES,q,W,J,an.disabled,Be,c.id,Ue,Ze,lt)}},sky:function(p,o,c){let f=p._atmosphere?i.aj(p.transform.zoom):1,_=c.paint.get("sky-opacity")*f;if(_===0)return;let y=p.context,x=c.paint.get("sky-type"),w=new Ht(y.gl.LEQUAL,Ht.ReadOnly,[0,1]),S=p.frameCounter/1e3%1;x==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&((function(M,A,F,k){let L=M.context,j=L.gl,V=A.skyboxFbo;if(!V){V=A.skyboxFbo=L.createFramebuffer(32,32,1,null),A.skyboxGeometry=new km(L),A.skyboxTexture=L.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,A.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ie=0;ie<6;++ie)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}L.bindFramebuffer.set(V.framebuffer),L.viewport.set([0,0,32,32]);let W=A.getCenter(M,!0),q=M.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);i.bA(J),i.en(J,J,.5*-Math.PI),td(M,A,q,J,W,0),i.bA(J),i.en(J,J,.5*Math.PI),td(M,A,q,J,W,1),i.bA(J),i.cU(J,J,.5*-Math.PI),td(M,A,q,J,W,2),i.bA(J),i.cU(J,J,.5*Math.PI),td(M,A,q,J,W,3),i.bA(J),td(M,A,q,J,W,4),i.bA(J),i.en(J,J,Math.PI),td(M,A,q,J,W,5),L.viewport.set([0,0,M.width,M.height])})(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&(function(M,A,F,k,L){let j=M.context,V=j.gl,W=M.transform,q=M.getOrCreateProgram("skybox");j.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,A.skyboxTexture);let J=((ie,ee,ge,de,fe)=>({u_matrix:ie,u_sun_direction:ee,u_cubemap:0,u_opacity:de,u_temporal_offset:fe}))(W.skyboxMatrix,A.getCenter(M,!1),0,k,L);M.uploadCommonUniforms(j,q),q.draw(M,V.TRIANGLES,F,ln.disabled,M.colorModeForRenderPass(),an.backCW,J,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S):x==="gradient"&&p.renderPass==="sky"&&(function(M,A,F,k,L){let j=M.context,V=j.gl,W=M.transform,q=M.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new km(j)),j.activeTexture.set(V.TEXTURE0);let J=A.colorRampTexture;J||(J=A.colorRampTexture=new i.T(j,A.colorRamp,V.RGBA8)),J.bind(V.LINEAR,V.CLAMP_TO_EDGE);let ie=((ee,ge,de,fe,ue)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:ge,u_radius:i.an(de),u_opacity:fe,u_temporal_offset:ue}))(W.skyboxMatrix,A.getCenter(M,!1),A.paint.get("sky-gradient-radius"),k,L);M.uploadCommonUniforms(j,q),q.draw(M,V.TRIANGLES,F,ln.disabled,M.colorModeForRenderPass(),an.backCW,ie,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S)},custom:function(p,o,c,f){let _=p.context,y=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(o)){if(p.renderPass==="offscreen"){let x=y.prerender;if(x){if(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;x.call(y,_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else x.call(y,_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let w=y.renderToTile;if(w){let S=f[0].canonical,M={x:S.x+f[0].wrap*(y.wrapTileId?0:1<<S.z),y:S.y,z:S.z};_.setDepthMode(Ht.disabled),_.setStencilMode(ln.disabled),_.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),w.call(y,_.gl,M),_.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(ln.disabled);let x=y.renderingMode==="3d"?new Ht(p.context.gl.LEQUAL,Ht.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Ht.ReadOnly);if(_.setDepthMode(x),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;y.render(_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else y.render(_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,o,c,f){if(p.renderPass==="opaque")return;let _=c.paint.get("model-opacity").constantOr(1),y=c.paint.get("model-elevation-reference"),x=y==="ground",w=y==="ground";if(_===0)return;let S=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!S||p.terrain&&_<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;let M=p.shadowRenderer,A=c.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,A||(M.enabled=!1));let F=()=>{M&&(M.useNormalOffset=!0,A||(M.enabled=!0))},k=o.getSource();if(p.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return(function(ee,ge,de,fe,ue){let se=ee.transform,_e=se.projection.name==="globe",Se=se.getFreeCameraOptions().position;if(!ee.modelManager)return;let Ce=ee.modelManager;de.modelManager=Ce;let Be=ee.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Ue=de._unevaluatedLayout._values["model-id"],Ze=Object.assign({},de.layout.get("model-id").parameters),lt=ee.style.order.indexOf(de.fqid),ke=de.paint.get("model-opacity").constantOr(1);for(let be of fe){let He=ge.getTile(be).getBucket(de);if(!He||He.projection.name!==se.projection.name)continue;let Le=He.getModelUris();if(Le&&!He.modelsRequested&&(Ce.addModelsFromBucket(Le,ue),He.modelsRequested=!0),_e)Ze.zoom=be.overscaledZ;else{let St=cs(be,se);Ze.zoom=St}let Je=Ue.possiblyEvaluate(Ze);if(Ob(ee,He,be),gl.shadowUniformsInitialized=!1,gl.useSingleShadowCascade=!!Be&&Be.getMaxCascadeForTile(be.toUnwrapped())===0,ee.renderPass==="shadow"&&Be){if(ee.currentShadowCascade===1&&He.isInsideFirstShadowMapFrustum)continue;let St=se.calculatePosMatrix(be.toUnwrapped(),se.worldSize);if(gl.tileMatrix.set(St),gl.shadowTileMatrix=Float32Array.from(Be.calculateShadowPassMatrixFromMatrix(St)),gl.aabb.min=[0,0,0],gl.aabb.max[0]=gl.aabb.max[1]=i.al,gl.aabb.max[2]=0,hT(He,gl,ee,de.scope))continue}let yt=1<<be.canonical.z,Mt=[((Se.x-be.wrap)*yt-be.canonical.x)*i.al,(Se.y*yt-be.canonical.y)*i.al,Se.z*yt*i.al];ee.conflationActive&&Object.keys(He.instancesPerModel).length>0&&ee.style.isLayerClipped(de,ge.getSource())&&He.updateReplacement(be,ee.replacementSource,lt,de.scope)&&(He.uploaded=!1,He.upload(ee.context));let pt=0,ct=new Array,Vt=new Array,Lt=new Array;for(let St in He.instancesPerModel){let At=He.instancesPerModel[St];At.features.length>0&&!_e&&(St=Je.evaluate(At.features[0].feature,{}));let Jt=Ce.getModel(St,ue);if(Jt||Ce.hasURLBeenRequested(St)||He.modelUris.includes(St)||(He.modelUris.push(St),He.modelsRequested=!1),Jt&&Jt.uploaded)if(_e){let pn=i.c5([],[Se.x,Se.y,Se.z],ee.transform.worldSize);i.ew(pn,pn);for(let Fn=0;Fn<At.instancedDataArray.length;++Fn){let Jn=[0,0,0],Ut=[1,1,1],Xn=i.ex(),hn=At.tileCoordinatesForInstance(Fn),ii=At.transformForInstance(Fn);i.ey(Ut,ii),i.ez(Xn,ii),i.eA(Jn,Xn);let fi=At.translationForInstance(Fn),ui=new i.aT(0,0);i.eB(He.canonical,ui,hn.x,hn.y);let Wn=i.bC();i.eC(Wn,Jt,ee.transform,ui,Jn,Ut,fi,!0,!1,!1);let bn=At.colorForInstance(Fn),ti=i.bA([]),ar=i.ef(ui.lat,ee.transform.zoom),qi=i.bq([],[1,1,1/ar]);i.br(ti,ti,pn),Lt.push({zScaleMatrix:qi,negCameraPosMatrix:ti});for(let ri of Jt.nodes)nd(ee,ri,Wn,ee.transform.expandedFarZProjMatrix,pt,ct,Vt,Jt.materialOverrides,ke,bn);++pt}}else for(let pn of Jt.nodes)Rb(ee,de,pn,At,Mt,be,gl)}if(_e)if(ee.renderPass==="shadow"){for(let St of Vt)Ua(St.mesh,St.nodeModelMatrix,ee,de);for(let St of ct)Ua(St.mesh,St.nodeModelMatrix,ee,de)}else Pb(ee,de,ct,Vt,Lt)}})(p,o,c,f,Ip(p,c)),void F();if(!k.loaded())return;if(k.type==="batched-model")return(function(ee,ge,de,fe){de.resetLayerRenderingStats(ee);let ue=ee.context,se=ee.transform,_e=ee.style.fog,Se=ee.shadowRenderer;if(se.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${se.projection.name} projection is not yet implemented`);let Ce=ee.transform.getFreeCameraOptions().position,Be=i.c5([],[Ce.x,Ce.y,Ce.z],ee.transform.worldSize),Ue=i.ew([],Be),Ze=i.bA([]),lt=i.ef(se.center.lat,se.zoom),ke=i.bq([],[1,1,1/lt]);i.br(Ze,Ze,Ue);let be=de.paint.get("model-opacity").constantOr(1),He=new Ht(ue.gl.LEQUAL,Ht.ReadWrite,ee.depthRangeFor3D),Le=new Ht(ue.gl.LEQUAL,Ht.ReadOnly,ee.depthRangeFor3D),Je=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),yt=ee.renderPass==="shadow",Mt=yt&&Se?Se.getCurrentCascadeFrustum():se.getFrustum(se.scaleZoom(se.worldSize)),pt=de.paint.get("model-front-cutoff"),ct=pt[2]<1,Vt=Bc(ee,de.paint.get("model-cutoff-fade-range")),Lt=de.getLayerRenderingStats();(function(St,At,Jt,pn){let Fn=St.terrain?St.terrain.exaggeration():0,Jn=St.transform.zoom;for(let Ut of pn){let Xn=At.getTile(Ut).getBucket(Jt);Xn&&(Xn.setFilter(Jt.filter),St.conflationActive&&Xn.updateReplacement(Ut,St.replacementSource),Xn.evaluateTransform(St,Jt),St.terrain&&Fn>0&&Xn.elevationUpdate(St.terrain,Fn,Ut,Jt.source),Xn.needsReEvaluation(St,Jn,Jt)&&Xn.evaluate(Jt))}})(ee,ge,de,fe),(function(){let St,At,Jt;ct?(St=fe.length-1,At=-1,Jt=-1):(St=0,At=fe.length,Jt=1);let pn=new Float64Array(16),Fn=i.cA(),Jn=new i.P(0,0);for(let Ut=St;Ut!==At;Ut+=Jt){let Xn=fe[Ut],hn=ge.getTile(Xn).getBucket(de);if(!hn||!hn.uploaded)continue;let ii=!1;Se&&(ii=Se.getMaxCascadeForTile(Xn.toUnwrapped())===0);let fi=se.calculatePosMatrix(Xn.toUnwrapped(),se.worldSize),ui=hn.modelTraits;!yt&&ct&&(i.bl(pn,fi),i.af(Fn,Be,pn),Jn.x=Fn[0],Jn.y=Fn[1]);let Wn=[];hn.setFilter(de.filter);for(let bn of hn.getNodesInfo()){if(bn.hiddenByReplacement||!bn.node.meshes)continue;let ti=bn.node,ar=0;ee.terrain&&ti.elevation&&(ar=ti.elevation*ee.terrain.exaggeration());let qi=(()=>{let Vo=bn.aabb;return Je.min=[...Vo.min],Je.max=[...Vo.max],Je.min[2]+=ar,Je.max[2]+=ar,i.af(Je.min,Je.min,fi),i.af(Je.max,Je.max,fi),Je})(),ri=bn.evaluatedScale;if(ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&qi.intersects(Mt)===0)continue;if(!yt&&ct){let Vo=.16666666666666666;bn.cameraCollisionOpacity=Be[0]>qi.min[0]&&Be[0]<qi.max[0]&&Be[1]>qi.min[1]&&Be[1]<qi.max[1]&&Be[2]*lt<qi.max[2]&&ti.footprint&&i.c0(Jn,ti.footprint)?Math.max(bn.cameraCollisionOpacity-Vo,0):Math.min(1,bn.cameraCollisionOpacity+Vo)}let jn=[...fi],wn=1/i.d7(Xn.canonical),Bi=ti.anchor?ti.anchor[0]:0,br=ti.anchor?ti.anchor[1]:0;i.br(jn,jn,[Bi*(ri[0]-1)+bn.evaluatedTranslation[0]*wn,br*(ri[1]-1)+bn.evaluatedTranslation[1]*wn,ar+bn.evaluatedTranslation[2]]),i.cq(ri,i.eE)||i.cS(jn,jn,ri);let er=i.aB([],jn,ti.globalMatrix),Ei=i.aB([],se.expandedFarZProjMatrix,er),us=i.aB([],se.expandedFarZProjMatrix,jn),Io=i.aC([],[Bi,br,ar,1],Ei)[2];ti.hidden=!1;let Zr=be;yt||(ct&&(Zr*=bn.cameraCollisionOpacity,Zr*=Pn(jn,se,bn.aabb,pt)),Zr*=Gi(Vt,Io)),Zr!==0?Wn.push({nodeInfo:bn,depth:Io,opacity:Zr,wvpForNode:Ei,wvpForTile:us,nodeModelMatrix:er,tileModelMatrix:jn}):ti.hidden=!0}yt||Wn.sort((bn,ti)=>!ct||bn.opacity===1&&ti.opacity===1?bn.depth<ti.depth?-1:1:bn.opacity===1?-1:ti.opacity===1?1:bn.depth>ti.depth?-1:1);for(let bn of Wn){let ti=bn.nodeInfo,ar=ti.node,qi=i.aB([],ke,bn.tileModelMatrix);i.aB(qi,Ze,qi);let ri=i.bl([],qi);i.eg(ri,ri),i.cS(ri,ri,Mp),qi=i.aB(qi,qi,ar.globalMatrix);let jn=ee.renderPass==="light-beam",wn=de.paint.get("model-color-use-theme").constantOr("default")==="none",Bi=ui&i.eI.HasMapboxMeshFeatures,br=Bi?0:ti.evaluatedRMEA[0][2];for(let er=0;er<ar.meshes.length;++er){let Ei=ar.meshes[er],us=er===ar.lightMeshIndex,Io=bn.wvpForNode;if(us){if(!jn&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}Io=bn.wvpForTile}else if(jn)continue;let Zr={defines:[]},Vo=[];if(!yt&&Se&&(Se.useNormalOffset=!!Ei.normalBuffer),Nm(Zr.defines,Vo,Ei,ee,wn?null:de.lut),Bi||Zr.defines.push("DIFFUSE_SHADED"),ii&&Zr.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(yt?Lt.numRenderedVerticesInShadowPass+=Ei.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=Ei.vertexArray.length),yt){Ua(Ei,bn.nodeModelMatrix,ee,de);continue}let Uo=null;if(_e){let Tr=Lm(bn.nodeModelMatrix,ee.transform);if(Uo=new Float32Array(Tr),se.projection.name!=="globe"){let Si=Ei.aabb.min,Or=Ei.aabb.max,[lr,tr]=_e.getOpacityForBounds(Tr,Si[0],Si[1],Or[0],Or[1]);Zr.overrideFog=lr>=Xe||tr>=Xe}}let yo=Ei.material,Xs;yo.occlusionTexture&&yo.occlusionTexture.offsetScale&&(Xs=yo.occlusionTexture.offsetScale,Zr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let xa=ee.getOrCreateProgram("model",Zr);!yt&&Se&&Se.setupShadowsFromMatrix(bn.tileModelMatrix,xa,Se.useNormalOffset),ee.uploadCommonUniforms(ue,xa,null,Uo);let Es=yo.pbrMetallicRoughness;Es.metallicFactor=.9,Es.roughnessFactor=.5;let pr=Yu(new Float32Array(Io),new Float32Array(qi),new Float32Array(ri),new Float32Array(ar.globalMatrix),ee,bn.opacity,Es.baseColorFactor,yo.emissiveFactor,Es.metallicFactor,Es.roughnessFactor,yo,br,de,[0,0,0],Xs);!us&&(ti.hasTranslucentParts||bn.opacity<1)&&xa.draw(ee,ue.gl.TRIANGLES,He,ln.disabled,yn.disabled,an.backCCW,pr,de.id,Ei.vertexBuffer,Ei.indexBuffer,Ei.segments,de.paint,ee.transform.zoom,void 0,Vo),xa.draw(ee,ue.gl.TRIANGLES,us?Le:He,ln.disabled,us||bn.opacity<1||ti.hasTranslucentParts?yn.alphaBlended:yn.unblended,an.backCCW,pr,de.id,Ei.vertexBuffer,Ei.indexBuffer,Ei.segments,de.paint,ee.transform.zoom,void 0,Vo)}}}})()})(p,o,c,f),void F();if(k.type!=="model")return;let L=k.getModels(),j=[],V=p.transform.getFreeCameraOptions().position,W=i.c5([],[V.x,V.y,V.z],p.transform.worldSize);i.ew(W,W);let q=[],J=[],ie=0;for(let ee of L){let ge=o.getFeatureState("",ee.id),de={type:"Unknown",id:ee.id,properties:ee.featureProperties},fe=c.paint.get("model-rotation").evaluate(de,ge),ue=c.paint.get("model-scale").evaluate(de,ge),se=c.paint.get("model-translation").evaluate(de,ge),_e=c.paint.get("model-opacity").evaluate(de,ge);Db(c,ee.id,ge,ee.featureProperties,ee.nodeOverrideNames,ee.nodeOverrides),Ab(c,ee.id,ge,ee.featureProperties,ee.materialOverrideNames,ee.materialOverrides),ee.nodeOverrides.size>0&&ee.computeBoundsAndApplyParent(),ee.computeModelMatrix(p,fe,ue,se,w,x,!1);let Se=i.bA([]),Ce=i.ef(ee.position.lat,p.transform.zoom),Be=i.bq([],[1,1,1/Ce]);i.br(Se,Se,W),j.push({zScaleMatrix:Be,negCameraPosMatrix:Se});for(let Ue of ee.nodes)nd(p,Ue,ee.matrix,p.transform.expandedFarZProjMatrix,ie,q,J,ee.materialOverrides,_e);ie++}if(q.sort((ee,ge)=>ge.depth-ee.depth),p.renderPass!=="shadow")Pb(p,c,q,J,j),F();else{for(let ee of J)Ua(ee.mesh,ee.nodeModelMatrix,p,c);for(let ee of q)Ua(ee.mesh,ee.nodeModelMatrix,p,c);F()}}},Um={line:function(p,o,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){let f=o.getVisibleCoordinates();for(let _ of f){let y=o.getTile(_).getBucket(p);if(y&&(y.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,o,c){let f=o.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Ip(c,p)));if(f.type==="batched-model"||f.type!=="model")return;let _=f.getModels();for(let y of _)y.upload(c.context)},raster:function(p,o,c){let f=o.getSource();if(!(f instanceof Xo&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)},"raster-particle":function(p,o,c){let f=o.getSource();if(!(f instanceof Xo&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)}},Zs={fill:Im},jm={fill:function(p,o,c,f){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let _=p.context.gl,y=new Ht(_.LEQUAL,Ht.ReadOnly,p.depthRangeFor3D),x=new ln({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),w=p.transform.getFreeCameraOptions().position,S=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(let M of f){let A=o.getTile(M),F=A.getBucket(c);if(!F)continue;let k=F.elevatedStructures;if(!k||k.depthSegments.segments[0].primitiveLength===0)continue;let L=xb(M.toUnwrapped(),w),j=p.translatePosMatrix(M.projMatrix,A,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),V=Xu(j,L,0,1,0);S.draw(p,_.TRIANGLES,y,x,yn.disabled,an.disabled,V,c.id,k.vertexBuffer,k.indexBuffer,k.depthSegments,c.paint,p.transform.zoom)}}};class $m{constructor(o,c,f,_,y){this.context=new Yd(o,c),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;for(let S of x);this.occlusionParams=new Qd,this.setup(),this.numSublayers=Rs.maxUnderzooming+Rs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new zd(this),this._wireframeDebugCache=new Xc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let w=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,w,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=y,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,c){let f=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ev(this,o));let _=this._terrain;this.transform.elevation=f?_:null,_.update(o,this.transform,c),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(o){let c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,_]=c.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);let y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Ev(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,c){if(this.width=o*i.o.devicePixelRatio,this.height=c*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let o=this.context,c=new i.bd;c.emplaceBack(0,0),c.emplaceBack(i.al,0),c.emplaceBack(0,i.al),c.emplaceBack(i.al,i.al),this.tileExtentBuffer=o.createVertexBuffer(c,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);let f=new i.bd;f.emplaceBack(0,0),f.emplaceBack(i.al,0),f.emplaceBack(0,i.al),f.emplaceBack(i.al,i.al),this.debugBuffer=o.createVertexBuffer(f,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);let _=new i.bd;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);let y=new i.b1;y.emplaceBack(0,0,0,0),y.emplaceBack(i.al,0,i.al,0),y.emplaceBack(0,i.al,0,i.al),y.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=o.createVertexBuffer(y,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);let x=new i.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(x);let w=new i.be;for(let M of[0,1,3,2,0])w.emplaceBack(M);this.debugIndexBuffer=o.createIndexBuffer(w),this.emptyTexture=new i.T(o,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bC();let S=this.context.gl;this.stencilClearMode=new ln({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Ht.disabled,this.stencilClearMode,yn.disabled,an.disabled,vp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,f){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(let S of f)if(this._tileClippingMaskIDs[S.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=c.id;let _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(yn.disabled),_.setDepthMode(Ht.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let w of f){let S=c.getTile(w),M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:F,tileBoundsSegments:k}=this.getTileBoundsBuffers(S);x.draw(this,y.TRIANGLES,Ht.disabled,new ln({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,an.disabled,vp(w.projMatrix),"$clipping",A,F,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,c=this.context.gl;return new ln({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let c=this.context.gl;return new ln({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){let c=this.context.gl,f=o.sort((x,w)=>w.overscaledZ-x.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let w=0;w<y;w++)x[w+_]=new ln({func:c.GEQUAL,mask:255},w+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=y,[x,f]}return[{[_]:ln.disabled},f]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new yn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yn.unblended:yn.alphaBlended}colorModeForDrapableLayerRenderPass(o){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new yn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new yn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,c,f,_=!1){if(this.depthOcclusion)return new Ht(this.context.gl.GREATER,Ht.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Ht.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Ht(f||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let o=this.context.gl,c=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&f!==0&&(this.depthFBO=new yb(this.context,c,f,0,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:f,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),o.bindTexture(o.TEXTURE_2D,y),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,c,f,0,0,c,f,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,c)=>o+c/this._fpsHistory.length,0))}render(o,c){let f=i.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=c;let _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(ke=>{let be=_[ke];return!(be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[be.type]}),w=x(),S=!1,M=!1,A=null,F=0,k=!1;for(let ke of w){let be=_[ke];be.visibility!=="none"&&(be.type==="circle"?S=!0:be.type==="building"?(A=be,++F):be.type==="symbol"&&(be.hasOcclusionOpacityProperties?M=!0:S=!0))}this.updateEmissiveMode();let L=w.map(ke=>_[ke]),j=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(let ke in j){let be=j[ke];be.used&&(be.prepare(this.context),be.getSource().usedInConflation&&++F)}let V=!1;for(let ke of L)ke.isHidden(this.transform.zoom)||(ke.type==="clip"&&(V=!0),this.prepareLayer(ke));let W={},q={},J={},ie={},ee={};for(let ke in j){let be=j[ke];W[ke]=be.getVisibleCoordinates(),q[ke]=W[ke].slice().reverse(),J[ke]=be.getVisibleCoordinates(!0).reverse(),ie[ke]=be.getShadowCasterCoordinates(),ee[ke]=be.sortCoordinatesByDistance(W[ke])}let ge=ke=>{let be=this.style.getLayerSourceCache(ke);return be&&be.used?be.getSource():null};if(F||V||this._clippingActiveLastFrame){let ke=[],be=[],He=0;for(let Le of L)this.isSourceForClippingOrConflation(Le,ge(Le))&&(ke.push(Le),be.push(He)),He++;if(ke&&(V||ke.length>1)||this._clippingActiveLastFrame){V=!1;let Le=[];for(let Je=0;Je<ke.length;Je++){let yt=ke[Je],Mt=be[Je],pt=this.style.getLayerSourceCache(yt);if(!pt||!pt.used||!pt.getSource().usedInConflation&&yt.type!=="clip"&&yt.type!=="building")continue;let ct=i.eQ,Vt=i.b_.None,Lt=[],St=!0;if(yt.type==="building")ct=i.eS;else if(yt.type==="clip"){ct=Mt;for(let At of yt.layout.get("clip-layer-types"))Vt|=At==="model"?i.b_.Model:At==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(let At of yt.layout.get("clip-layer-scope"))Lt.push(At);yt.isHidden(this.transform.zoom)?St=!1:V=!0}St&&Le.push({layer:yt.fqid,cache:pt,order:ct,clipMask:Vt,clipScope:Lt})}this.replacementSource.setSources(Le),k=!0}}this._clippingActiveLastFrame=V,k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<L.length;ke++){let be=L[ke];if(be.visibility==="none")continue;let He=be.cutoffRange();if(this.longestCutoffRange=Math.max(He,this.longestCutoffRange),He>0){let Le=ge(be);Le&&(this.minCutoffZoom=Math.max(Le.minzoom,this.minCutoffZoom)),be.minzoom&&(this.minCutoffZoom=Math.max(be.minzoom,this.minCutoffZoom))}be.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}let de=this.style&&this.style.fog;de?(this._fogVisible=de.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=de.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(J),this.opaquePassCutoff=0,w=x(),L=w.map(ke=>_[ke]));let fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(let ke in j)for(let be of W[ke]){let He={min:0,max:0};this.terrain&&(He=this.terrain.getMinMaxForTile(be)||He),fe.addShadowReceiver(be.toUnwrapped(),He.min,He.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mb(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ue&&!this._snow&&(this._snow=new Vv(this)),!ue&&this._snow&&(this._snow.destroy(),delete this._snow),se&&!this._rain&&(this._rain=new Vm(this)),!se&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),A){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Fm);let ke=this.style.getLayerSourceCache(A);this.buildingTileBorderManager.updateBorders(ke,A)}if(!Os.has(this.context.gl))return;this.renderPass="offscreen";for(let ke of L){let be=o.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;let He=be?q[be.id]:void 0;(ke.type==="custom"||ke.type==="raster"||ke.type==="raster-particle"||ke.isSky()||He&&He.length)&&this.renderLayer(this,be,ke,He)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Se=(()=>{if(c.showOverdrawInspector)return i.ao.black;let ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){let be=this.style.getLut(ke.scope);if(!_e){let He=ke.properties.get("color-use-theme")==="none",Le=ke.properties.get("color").toNonPremultipliedRenderColor(He?null:be).toArray01();return new i.ao(...Le)}if(_e){let He=ke.properties.get("space-color-use-theme")==="none",Le=ke.properties.get("space-color").toNonPremultipliedRenderColor(He?null:be).toArray01();return new i.ao(...Le)}}return i.ao.transparent})();if(this.context.clear({color:Se,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){let ke=L[this.currentLayer],be=o.getLayerSourceCache(ke);if(ke.isSky())continue;let He=be?(ke.is3D(y)?ee:q)[be.id]:void 0;this._renderTileClippingMasks(ke,be,He),this.renderLayer(this,be,ke,He)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){let ke=L[this.currentLayer],be=o.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,be,ke,be?q[be.id]:void 0)}function Ce(ke,be){let He;return be&&(He=(ke.type==="symbol"?J:ke.is3D(y)?ee:q)[be.id]),He}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){let ke=L[this.currentLayer];if(ke.type==="raster"||ke.type==="raster-particle"){let be=o.getLayerSourceCache(ke);this.renderLayer(this,be,ke,Ce(ke,be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;fe&&(Be=fe.getShadowCastingLayerCount());let Ue=!1,Ze=-1;for(let ke=0;ke<w.length;++ke){let be=L[ke];be.isHidden(this.transform.zoom)||be.is3D(y)&&(Ze=ke)}M&&Ze===-1&&(S=!0);let lt=!1;for(;this.currentLayer<w.length;){let ke=L[this.currentLayer],be=o.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!lt&&ke.is3D(y)&&!y){let He=this.currentLayer,Le=Je=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){let yt=L[this.currentLayer];if(Zs[yt.type]){let Mt=this.style.getLayerSourceCache(yt);Zs[yt.type](this,Mt,yt,Ce(yt,Mt),Je)}}};Le("initialize"),Le("reset"),this.currentLayer=He,lt=!0}if(S&&!Ue&&this.terrain&&!this.transform.isOrthographic&&(Ue=!0,this.blitDepth()),M&&Ze!==-1&&this.currentLayer===Ze+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ke,be,be?W[be.id]:void 0),this.renderLayer(this,be,ke,Ce(ke,be)),!this.terrain&&fe&&Be>0&&ke.hasShadowPass()&&--Be==0){{this.clearStencil(),this.resetStencilClippingMasks();let He=this.currentLayer;for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){let Le=L[this.currentLayer];if(jm[Le.type]){let Je=this.style.getLayerSourceCache(Le);jm[Le.type](this,Je,Le,Ce(Le,Je))}}this.currentLayer=He}if(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){let He=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=He;this.currentLayer++){let Le=L[this.currentLayer];if(!Le.hasLightBeamPass())continue;let Je=o.getLayerSourceCache(Le);this.renderLayer(this,Je,Le,Je?q[Je.id]:void 0)}this.currentLayer=He,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let He=this.currentLayer;this.depthOcclusion=!0;for(let Le of this.layersWithOcclusionOpacity){this.currentLayer=Le;let Je=L[this.currentLayer],yt=o.getLayerSourceCache(Je),Mt=yt?q[yt.id]:void 0;this.terrain||this._renderTileClippingMasks(Je,yt,yt?W[yt.id]:void 0),this.renderLayer(this,yt,Je,Mt)}this.depthOcclusion=!1,this.currentLayer=He,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;L.forEach(be=>{let He=o.getLayerSourceCache(be);He&&!be.isHidden(this.transform.zoom)&&He.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<He.getSource().maxzoom)&&(ke=He)}),ke&&this.options.showTileBoundaries&&ht(this,ke,ke.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ht(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(ke){let be=ke.transform.padding;ed(ke,ke.transform.height-(be.top||0),3,Cb),ed(ke,be.bottom||0,3,Eb),hr(ke,be.left||0,3,Sb),hr(ke,ke.transform.width-(be.right||0),3,Qu);let He=ke.transform.centerPoint;(function(Le,Je,yt,Mt){Me(Le,Je-1,yt-10,2,20,Mt),Me(Le,Je-10,yt-1,20,2,Mt)})(ke,He.x,ke.transform.height-He.y,Ju)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:c}=this.transform.projection,f=!c||!c.includes(o.type);if(Um[o.type]&&(f||this.terrain&&o.type==="custom")){let _=this.style.getLayerSourceCache(o);Um[o.type](o,_,this)}this.gpuTimingEnd()}renderLayer(o,c,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(f.type)&&(!o.terrain||f.type!=="custom")||f.type==="clip"||Yc[f.type](o,c,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,f=this.context.gl,_=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,c=this.context.gl,f=c.createQuery();this.deferredRenderGpuTimeQueries.push(f),c.beginQuery(o.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let c={};for(let f in o){let _=o[f],y=this.context.extTimerQuery,x=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),c[f]=x}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.gl,f=0;for(let _ of o)f+=c.getQueryParameter(_,c.QUERY_RESULT)/1e6,c.deleteQuery(_);return f}translatePosMatrix(o,c,f,_,y){if(!f[0]&&!f[1])return o;let x=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(x){let M=Math.sin(x),A=Math.cos(x);f=[f[0]*A-f[1]*M,f[0]*M+f[1]*A]}let w=[y?f[0]:i.ay(c,f[0],this.transform.zoom),y?f[1]:i.ay(c,f[1],this.transform.zoom),0],S=new Float32Array(16);return i.br(S,o,w),S}saveTileTexture(o){if(o.context!==this.context)return;let c=o.size[0],f=this._tileTextures[c];f?f.push(o):this._tileTextures[c]=[o]}getTileTexture(o){let c=this._tileTextures[o];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,c,f){let _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||c!==void 0&&!c||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(o,c){this.cache=this.cache||{};let f=c&&c.defines||[],_=c&&c.config,y=this.currentGlobalDefines(o,c&&c.overrideFog,c&&c.overrideRtt).concat(f),x=ab.cacheKey(dv[o],o,y,_);return this.cache[x]||(this.cache[x]=new ab(this.context,o,dv[o],_,Tm[o],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,c){if(this.style.enable3dLights()){let f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){let y=((x,w,S)=>{let M=x.properties.get("direction"),A=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toNonPremultipliedRenderColor(A?null:S.getLut(x.scope)).toArray01(),k=x.properties.get("intensity"),L=w.properties.get("color-use-theme")==="none",j=w.properties.get("color").toNonPremultipliedRenderColor(L?null:S.getLut(w.scope)).toArray01(),V=w.properties.get("intensity"),W=[M.x,M.y,M.z],q=i.dN(j,V),J=i.dN(F,k);return{u_lighting_ambient_color:q,u_lighting_directional_dir:W,u_lighting_directional_color:J,u_ground_radiance:Wd(W,J,q)}})(f,_,this.style);c.setLightsUniformValues(o,y)}}}uploadCommonUniforms(o,c,f,_,y){if(this.uploadCommonLightUniforms(o,c),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let w=x.getOpacity(this.transform.pitch),S=((M,A,F,k,L,j,V,W,q,J,ie,ee)=>{let ge=M.transform,de=A.properties.get("color-use-theme")==="none",fe=A.properties.get("color").toNonPremultipliedRenderColor(de?null:M.style.getLut(A.scope)).toArray01();fe[3]=k;let ue=M.frameCounter/1e3%1,[se,_e]=A.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):ee||M.identityMat,u_fog_range:A.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(se,_e),_e],u_fog_temporal_offset:ue,u_frustum_tl:L,u_frustum_tr:j,u_frustum_br:V,u_frustum_bl:W,u_globe_pos:q,u_globe_radius:J,u_viewport:ie,u_globe_transition:i.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,f,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],_);c.setFogUniformValues(o,S)}y&&c.setCutoffUniformValues(o,y.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let _ of f)c[_.key]=o[_.key]||new ju(_,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,c){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[o.key];return c||(this._cachedTileFogOpacities[o.key]=c=this.style.fog.getOpacityForTile(o)),c[0]>=Xe||c[1]>=Xe}setupDepthForOcclusion(o,c,f){let _=this.context,y=_.gl,x=!!f;var w;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),x||c.setTerrainUniformValues(_,f)}updateEmissiveMode(){if(this._forceEmissiveMode)return;let o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Hm(p,o){let c=!1,f=null,_=()=>{f=null,c&&(p(),f=setTimeout(_,o),c=!1)};return()=>(c=!0,f||_(),f)}class Uv{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hm(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let c=qr(o);if(this._hashName){let f=this._hashName,_=!1,y=location.hash.slice(1).split("&").map(x=>{let w=x.split("=")[0];return w===f?(_=!0,`${w}=${c}`):x}).filter(x=>x);return _||y.push(`${f}=${c}`),`#${y.join("&")}`}return`#${c}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(Number(f)))){let f=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function qr(p,o){let c=p.getCenter(),f=Math.round(100*p.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),x=Math.round(c.lng*y)/y,w=Math.round(c.lat*y)/y,S=p.getBearing(),M=p.getPitch(),A=o?`/${x}/${w}/${f}`:`${f}/${w}/${x}`;return(S||M)&&(A+="/"+Math.round(10*S)/10),M&&(A+=`/${Math.round(M)}`),A}let eh={linearity:.3,easing:i.eT(0,0,.3,1)},jv=Object.assign({deceleration:2500,maxSpeed:1400},eh),$v=Object.assign({deceleration:20,maxSpeed:1400},eh),rd=Object.assign({deceleration:1e3,maxSpeed:360},eh),Hv=Object.assign({deceleration:1e3,maxSpeed:90},eh);class Gv{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,c=i.o.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)c.zoom+=y.zoomDelta||0,c.bearing+=y.bearingDelta||0,c.pitch+=y.pitchDelta||0,y.panDelta&&c.pan._add(y.panDelta),y.around&&(c.around=y.around),y.pinchAround&&(c.pinchAround=y.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){let y=_l(c.pan.mag(),f,Object.assign({},jv,o||{}));_.offset=c.pan.mult(y.amount/c.pan.mag()),_.center=this._map.transform.center,th(_,y)}if(c.zoom){let y=_l(c.zoom,f,$v);_.zoom=this._map.transform.zoom+y.amount,th(_,y)}if(c.bearing){let y=_l(c.bearing,f,rd);_.bearing=this._map.transform.bearing+i.aA(y.amount,-179,179),th(_,y)}if(c.pitch){let y=_l(c.pitch,f,Hv);_.pitch=this._map.transform.pitch+y.amount,th(_,y)}if(_.zoom||_.bearing){let y=c.pinchAround===void 0?c.around:c.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function th(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function _l(p,o,c){let{maxSpeed:f,linearity:_,deceleration:y}=c,x=i.aA(p*_/(o/1e3),-f,f),w=Math.abs(x)/(y*_);return{easing:c.easing,duration:1e3*w,amount:x*(w/2)}}class Cs extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f,_={}){let y=is(c.getCanvasContainer(),f),x=c.unproject(y);super(o,Object.assign({point:y,lngLat:x,originalEvent:f},_)),this._defaultPrevented=!1,this.target=c}}class Kc extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){let _=o==="touchend"?f.changedTouches:f.touches,y=zl(c.getCanvasContainer(),_),x=y.map(S=>c.unproject(S)),w=y.reduce((S,M,A,F)=>S.add(M.div(F.length)),new i.P(0,0));super(o,{points:y,point:w,lngLats:x,lngLat:c.unproject(w),originalEvent:f}),this._defaultPrevented=!1}}class qv extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Gm{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new qv(this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Cs(o.type,this._map,o))}mouseup(o){this._map.fire(new Cs(o.type,this._map,o))}preclick(o){let c=new MouseEvent("preclick",o);this._map.fire(new Cs(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Cs(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Cs(o.type,this._map,o))}mouseover(o){this._map.fire(new Cs(o.type,this._map,o))}mouseout(o){this._map.fire(new Cs(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Kc(o.type,this._map,o))}touchmove(o){this._map.fire(new Kc(o.type,this._map,o))}touchend(o){this._map.fire(new Kc(o.type,this._map,o))}touchcancel(o){this._map.fire(new Kc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Cs(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Cs(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(Hn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;let f=c,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Fe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let x=Math.min(_.x,f.x),w=Math.max(_.x,f.x),S=Math.min(_.y,f.y),M=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${S}px)`,this._box.style.width=w-x+"px",this._box.style.height=M-S+"px")})}mouseupWindow(o,c){if(!this._active)return;let f=this._startPos,_=c;if(f&&o.button===0){if(this.reset(),So(),f.x!==_.x||f.y!==_.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:o})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Er(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new i.z(o,{originalEvent:c}))}}function Wm(p,o){let c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=o[f];return c}class Fb{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=(function(_){let y=new i.P(0,0);for(let x of _)y._add(x);return y.div(_.length)})(c),this.touches=Wm(f,c)))}touchmove(o,c,f){if(this.aborted||!this.centroid)return;let _=Wm(f,c);for(let y in this.touches){let x=_[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(o,c,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Zm{constructor(o){this.singleTap=new Fb(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,f){this.singleTap.touchstart(o,c,f)}touchmove(o,c,f){this.singleTap.touchmove(o,c,f)}touchend(o,c,f){let _=this.singleTap.touchend(o,c,f);if(_){let y=o.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(_)<30;if(y&&x||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Lb{constructor(){this._zoomIn=new Zm({numTouches:1,numTaps:2}),this._zoomOut=new Zm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,f){this._zoomIn.touchstart(o,c,f),this._zoomOut.touchstart(o,c,f)}touchmove(o,c,f){this._zoomIn.touchmove(o,c,f),this._zoomOut.touchmove(o,c,f)}touchend(o,c,f){let _=this._zoomIn.touchend(o,c,f),y=this._zoomOut.touchend(o,c,f);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(_)},{originalEvent:o})}):y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Nb={0:1,2:2},Zv={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Xm{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;let f=Gh(o);this._correctButton(o,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(o,c){let f=this._lastPoint;if(f){if(o.preventDefault(),this._eventButton!=null&&(function(_,y){let x=Nb[y];return _.buttons===void 0||(_.buttons&x)!==x})(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(o){this._lastPoint&&Gh(o)===this._eventButton&&(this._moved&&So(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zb extends Xm{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Xv extends Xm{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Zv[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=.8*(c.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Yv extends Xm{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Zv[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=-.5*(c.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Bb{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,c,f){return this._calculateTransform(o,c,f)}touchmove(o,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,f)}}touchend(o,c,f){this._calculateTransform(o,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,f){f.length>0&&(this._active=!0);let _=Wm(f,c),y=new i.P(0,0),x=new i.P(0,0),w=0;for(let M in _){let A=_[M],F=this._touches[M];F&&(y._add(A),x._add(A.sub(F)),w++,_[M]=A)}if(this._touches=_,w<this._minTouches||!x.mag())return;let S=x.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(w),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ym{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,f){return{}}touchstart(o,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,f){let _=this._firstTwoTouches;if(!_)return;o.preventDefault();let[y,x]=_,w=Dp(f,c,y),S=Dp(f,c,x);if(!w||!S)return;let M=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],M,o)}touchend(o,c,f){if(!this._firstTwoTouches)return;let[_,y]=this._firstTwoTouches,x=Dp(f,c,_),w=Dp(f,c,y);x&&w||(this._active&&So(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dp(p,o,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return o[f]}function Vb(p,o){return Math.log2(p/o)}class pT extends Ym{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){let f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Vb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vb(this._distance,f),pinchAround:c}}}function Ub(p,o){return 180*p.angleWith(o)/Math.PI}class Ji extends Ym{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){let f=this._vector;if(this._vector=o[0].sub(o[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ub(this._vector,f),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let _=Ub(o,f);return Math.abs(_)<c}}function Km(p){return Math.abs(p.y)>Math.abs(p.x)}class fT extends Ym{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Km(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,f){let _=this._lastPoints;if(!_)return;let y=o[0].sub(_[0]),x=o[1].sub(_[1]);return this._map._cooperativeGestures&&!i.eU()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,f.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(o,c,f){if(this._valid!==void 0)return this._valid;let _=o.mag()>=2,y=c.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let x=o.y>0==c.y>0;return Km(o)&&Km(c)&&x}}let mT={panStep:100,bearingStep:15,pitchStep:10};class gT{constructor(){let o=mT;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,f=0,_=0,y=0,x=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),y=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),y=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),x=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:w=>{let S=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Ap,zoom:c?Math.round(S)+c*(o.shiftKey?2:1):S,bearing:w.getBearing()+f*this._bearingStep,pitch:w.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ap(p){return p*(2-p)}let Kv=4.000244140625,Qv=1/450;class Qm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qv,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,f=i.o.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%Kv==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=is(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>Kv?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);let F=c(),k=Math.pow(2,F),L=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(L*A))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,y=this._easing,x,w=!1;if(this._type==="wheel"&&_&&y){let M=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),A=y(M);x=i.ak(_,f,A),M<1?this._frameId||(this._frameId=!0):w=!0}else x=f,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=x-c();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=i.eV;if(this._prevEase){let f=this._prevEase,_=(i.o.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),x=.27/Math.sqrt(y*y+1e-4)*.01,w=Math.sqrt(.0729-x*x);c=i.eT(x,w,.25,1)}return this._prevEase={start:i.o.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Jl{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wr{constructor(){this._tap=new Zm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,c,f))}touchmove(o,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let _=c[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(o,c,f)}touchend(o,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(o,c,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vl{constructor(o,c,f){this._el=o,this._mousePan=c,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pp{constructor(o,c,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class eg{constructor(o,c,f,_){this._el=o,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Op=p=>p.zoom||p.drag||p.pitch||p.rotate;class _T extends i.z{}class Rp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){let f=i.av([],c,o);this.radius=i.ag(f[2]<0?i.eX([],f,this.constants):[f[0],f[1],0])}projectRay(o){i.eX(o,o,this.constants),i.aw(o,o),i.eY(o,o,this.constants);let c=i.c5([],o,this.radius);if(c[2]>0){let f=i.c5([],[0,0,1],i.bJ(c,[0,0,1])),_=i.c5([],i.aw([],[c[0],c[1],0]),this.radius),y=i.d8([],c,i.c5([],i.av([],i.d8([],_,f),c),2));c[0]=y[0],c[1]=y[1]}return c}}function tg(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class vT{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gv(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aY(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,y,x]of this._listeners){let w=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,w,x)}}destroy(){for(let[o,c,f]of this._listeners){let _=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(c,_,f)}}_addDefaultHandlers(o){let c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new Gm(c,o));let _=c.boxZoom=new qm(c,o);this._add("boxZoom",_);let y=new Lb,x=new Jm;c.doubleClickZoom=new Jl(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let w=new Wr;this._add("tapDragZoom",w);let S=c.touchPitch=new fT(c);this._add("touchPitch",S);let M=new Xv(o),A=new Yv(o);c.dragRotate=new Pp(o,M,A),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);let F=new zb(o),k=new Bb(c,o);c.dragPan=new vl(f,F,k),this._add("mousePan",F),this._add("touchPan",k,["touchZoom","touchRotate"]);let L=new Ji,j=new pT;c.touchZoomRotate=new eg(f,j,L,w),this._add("touchRotate",L,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wv(c));let V=c.scrollZoom=new Qm(c,this);this._add("scrollZoom",V,["mousePan"]);let W=c.keyboard=new gT;this._add("keyboard",W);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[q]&&c[q].enable(o[q])}_add(o,c,f){this._handlers.push({handlerName:o,handler:c,allowed:f}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Op(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,f){for(let _ in o)if(_!==f&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let c=[];for(let f of o)this._el.contains(f.target)&&c.push(f);return c}handleEvent(o,c){this._updatingCamera=!0;let f=o.type==="renderFrame",_=f?void 0:o,y={needsRenderFrame:!1},x={},w={},S=o.touches?this._getMapTouches(o.touches):void 0,M=S?zl(this._el,S):f?void 0:is(this._el,o);for(let{handlerName:k,handler:L,allowed:j}of this._handlers){if(!L.isEnabled())continue;let V;this._blockedByActive(w,j,k)?L.reset():L[c||o.type]&&(V=L[c||o.type](o,M,S),this.mergeHandlerResult(y,x,V,k,_),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||L.isActive())&&(w[k]=L)}let A={};for(let k in this._previousActiveHandlers)w[k]||(A[k]=_);this._previousActiveHandlers=w,(Object.keys(A).length||tg(y))&&(this._changes.push([y,x,A]),this._triggerRenderFrame()),(Object.keys(w).length||tg(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(o,c,f,_,y){if(!f)return;Object.assign(o,f);let x={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(c.zoom=x),f.panDelta!==void 0&&(c.drag=x),f.pitchDelta!==void 0&&(c.pitch=x),f.bearingDelta!==void 0&&(c.rotate=x)}_applyChanges(){let o={},c={},f={};for(let[_,y,x]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),Object.assign(c,y),Object.assign(f,x);this._updateMapTransform(o,c,f),this._changes=[]}_updateMapTransform(o,c,f){let _=this._map,y=_.transform,x=J=>[J.x,J.y,J.z];if((J=>{let ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!tg(o)){let J=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),J!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!tg(o))return void this._fireEvents(c,f,!0);let{panDelta:w,zoomDelta:S,bearingDelta:M,pitchDelta:A,around:F,aroundCoord:k,pinchAround:L}=o;y._isCameraConstrained&&(S>0&&(S=0),y._isCameraConstrained=!1),L!==void 0&&(F=L),(S||(J=>c[J]&&!this._eventsInProgress[J])("drag"))&&F&&(this._dragOrigin=x(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),F=F||_.transform.centerPoint,M&&(y.bearing+=M),A&&(y.pitch+=A),y._updateCameraState();let j=[0,0,0];if(w)if(y.projection.name==="mercator"){let J=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),ie=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(w)).dir);j[0]=ie[0]-J[0],j[1]=ie[1]-J[1]}else{let J=y.pointCoordinate(F);if(y.projection.name==="globe"){w=w.rotate(-y.angle);let ie=y._pixelsPerMercatorPixel/y.worldSize;j[0]=-w.x*i.eW(i.a$(J.y))*ie,j[1]=-w.y*i.eW(y.center.lat)*ie}else{let ie=y.pointCoordinate(F.sub(w));J&&ie&&(j[0]=ie.x-J.x,j[1]=ie.y-J.y)}}let V=y.zoom,W=[0,0,0];if(S){let J=x(k||y.pointCoordinate3D(F)),ie={dir:i.aw([],i.av([],J,y._camera.position))};if(ie.dir[2]<0){let ee=y.zoomDeltaToMovement(J,S);i.c5(W,ie.dir,ee)}}let q=i.d8(j,j,W);y._translateCameraConstrained(q),S&&Math.abs(y.zoom-V)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,f,!0)}_fireEvents(o,c,f){let _=Op(this._eventsInProgress),y=Op(o),x={};for(let A in o){let{originalEvent:F}=o[A];this._eventsInProgress[A]||(x[`${A}start`]=F),this._eventsInProgress[A]=o[A]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(let A in x)this._fireEvent(A,x[A]);y&&this._fireEvent("move",y.originalEvent);for(let A in o){let{originalEvent:F}=o[A];this._fireEvent(A,F)}let w={},S;for(let A in this._eventsInProgress){let{handlerName:F,originalEvent:k}=this._eventsInProgress[A];this._handlersById[F].isActive()||(delete this._eventsInProgress[A],S=c[F]||k,w[`${A}end`]=S)}for(let A in w)this._fireEvent(A,w[A]);let M=Op(this._eventsInProgress);if(f&&(_||y)&&!M){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;A?(F(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:S})):(this._map.fire(new i.z("moveend",{originalEvent:S})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new i.z(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new _T("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let ng="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jv extends i.E{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,f){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},c),f)}panTo(o,c,f){return this.easeTo(Object.assign({center:o},c),f)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,f){return this.easeTo(Object.assign({zoom:o},c),f)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,f){return this.easeTo(Object.assign({bearing:o},c),f)}resetNorth(o,c){return this.rotateTo(0,Object.assign({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=i.aI.convert(o);let f=c&&c.bearing||0,_=c&&c.pitch||0,y=o.getNorthWest(),x=o.getSouthEast();return this._cameraForBounds(this.transform,y,x,f,_,c)}_extendPadding(o){let c={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},c,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},c,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,c){let f=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return f/_>o.aspect?f/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,f,_,y,x){let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=i.aT.convert(c),A=i.aT.convert(f),F=.5*(M.lat+A.lat),k=.5*(M.lng+A.lng),L=i.eZ(F,k),j=i.aw([],L),V=i.aw([],i.bI([],j,[0,1,0])),W=i.bI([],V,j),q=[V[0],V[1],V[2],0,W[0],W[1],W[2],0,j[0],j[1],j[2],0,0,0,0,1],J=[L,i.eZ(M.lat,M.lng),i.eZ(A.lat,M.lng),i.eZ(A.lat,A.lng),i.eZ(M.lat,A.lng),i.eZ(F,M.lng),i.eZ(F,A.lng),i.eZ(M.lat,k),i.eZ(A.lat,k)],ie=i.d9.fromPoints(J.map(Le=>[i.bJ(V,Le),i.bJ(W,Le),i.bJ(j,Le)])),ee=i.af([],ie.center,q);i.e_(ee)===0&&i.e$(ee,0,0,1),i.aw(ee,ee),i.c5(ee,ee,i.aD),w.center=i.f0(ee);let ge=w.getWorldToCameraMatrix(),de=i.bl(new Float64Array(16),ge);ie=i.d9.applyTransform(ie,i.aB([],ge,q));let fe=this._extendAABB(ie,w,S,_);if(!fe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=fe,i.af(ee,ee,ge);let ue=.5*(ie.max[2]-ie.min[2]),se=this._minimumAABBFrustumDistance(w,ie),_e=i.c5([],[0,0,1],ue),Se=i.d8(_e,ee,_e),Ce=se+(w.pitch===0?0:i.bG(ee,Se)),Be=w.globeCenterInViewSpace,Ue=i.av([],ee,[Be[0],Be[1],Be[2]]);i.aw(Ue,Ue),i.c5(Ue,Ue,Ce);let Ze=i.d8([],ee,Ue);i.af(Ze,Ze,de);let lt=i.eM/i.aD,ke=i.ag(Ze),be=i.cf(Math.max(ke*lt-i.eM,Number.EPSILON),0),He=Math.min(w.zoomFromMercatorZAdjusted(be),S.maxZoom);return He>.5*(i.c_+i.cL)?(w.setProjection({name:"mercator"}),w.zoom=He,this._cameraForBounds(w,c,f,_,y,x)):{center:w.center,zoom:He,bearing:_,pitch:y}}_extendAABB(o,c,f,_){let y=.5*((f.padding.left||0)+(f.padding.right||0)),x=.5*((f.padding.top||0)+(f.padding.bottom||0)),w=x,S=y,M=y,A=x,F=c.width-(S+M),k=c.height-(w+A),L=i.av([],o.max,o.min),j=Math.min(F/L[0],k/L[1]),V=Math.min(c.scaleZoom(c.scale*j),f.maxZoom);if(isNaN(V))return null;let W=c.scale/c.zoomScale(V),q=new i.d9([o.min[0]-S*W,o.min[1]-A*W,o.min[2]],[o.max[0]+M*W,o.max[1]+w*W,o.max[2]]),J=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new i.P(f.offset.x,f.offset.y):i.P.convert(f.offset)).rotate(-i.an(_));return q.center[0]-=J.x*W,q.center[1]+=J.y*W,q}queryTerrainElevation(o,c){let f=this.transform.elevation;return f?(c=Object.assign({},{exaggerated:!0},c),f.getAtPoint(i.ae.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,f,_,y,x){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,f,_,y,x);let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=i.aT.convert(c),A=i.aT.convert(f),F=new i.aT(M.lng,A.lat),k=new i.aT(A.lng,M.lat),L=w.project(M),j=w.project(A),V=this.queryTerrainElevation(M),W=this.queryTerrainElevation(A),q=this.queryTerrainElevation(F),J=this.queryTerrainElevation(k),ie=[[L.x,L.y,Math.min(V||0,W||0,q||0,J||0)],[j.x,j.y,Math.max(V||0,W||0,q||0,J||0)]],ee=i.d9.fromPoints(ie),ge=w.getWorldToCameraMatrix(),de=i.bl(new Float64Array(16),ge);ee=i.d9.applyTransform(ee,ge);let fe=this._extendAABB(ee,w,S,_);if(!fe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=fe;let ue=.5*i.av([],ee.max,ee.min)[2],se=this._minimumAABBFrustumDistance(w,ee),_e=[0,0,1,0];i.aC(_e,_e,ge),i.f1(_e,_e);let Se=i.c5([],_e,se+ue),Ce=i.d8([],ee.center,Se);i.af(ee.center,ee.center,de),i.af(Ce,Ce,de);let Be=w.unproject(new i.P(ee.center[0],ee.center[1])),Ue=i.f2(w.projection,Be),Ze=Math.pow(2,Ue),lt=Math.min(w._zoomFromMercatorZ(Ce[2]*w.pixelsPerMeter*Ze/w.worldSize),S.maxZoom);return w.mercatorFromTransition&&lt<.5*(i.c_+i.cL)?(w.setProjection({name:"globe"}),w.zoom=lt,this._cameraForBounds(w,c,f,_,y,x)):{center:Be,zoom:lt,bearing:_,pitch:y}}fitBounds(o,c,f){let _=this.cameraForBounds(o,c);return this._fitInternal(_,c,f)}fitScreenCoordinates(o,c,f,_,y){let x=i.P.convert(o),w=i.P.convert(c),S=new i.P(Math.min(x.x,w.x),Math.min(x.y,w.y)),M=new i.P(Math.max(x.x,w.x),Math.max(x.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,w))return this;let A=this.transform.pointLocation3D(S),F=this.transform.pointLocation3D(M),k=this.transform.pointLocation3D(new i.P(S.x,M.y)),L=this.transform.pointLocation3D(new i.P(M.x,S.y)),j=[Math.min(A.lng,F.lng,k.lng,L.lng),Math.min(A.lat,F.lat,k.lat,L.lat)],V=[Math.max(A.lng,F.lng,k.lng,L.lng),Math.max(A.lat,F.lat,k.lat,L.lat)],W=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,j,V,f,W,_);return this._fitInternal(q,_,y)}_fitInternal(o,c,f){return o?(c=Object.assign(o,c)).linear?this.easeTo(c,f):this.flyTo(c,f):this}jumpTo(o,c){this.stop();let f=o.preloadOnly?this.transform.clone():this.transform,_=!1,y=!1,x=!1;"zoom"in o&&f.zoom!==+o.zoom&&(_=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=i.aT.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(y=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(x=!0,f.pitch=+o.pitch);let w=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!f.isPaddingEqual(w))if(o.retainPadding===!1){let S=f.clone();S.padding=w,f.setLocationAtPoint(f.center,S.centerPoint)}else f.padding=w;return o.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),_&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),y&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),x&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(ng),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){let f=this.transform;if(!f.projection.supportsFreeCamera)return i.w(ng),this;this.stop();let _=f.zoom,y=f.pitch,x=f.bearing;f.setFreeCameraOptions(o);let w=_!==f.zoom,S=y!==f.pitch,M=x!==f.bearing;return this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),w&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),M&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),S&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:i.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?+o.zoom:_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,F=this._extendPadding(o.padding),k=i.P.convert(o.offset),L,j,V;if(f.projection.name==="globe"){let _e=i.ae.fromLngLat(f.center),Se=k.rotate(-f.angle);_e.x+=Se.x/f.worldSize,_e.y+=Se.y/f.worldSize;let Ce=_e.toLngLat(),Be=i.aT.convert(o.center||Ce);this._normalizeCenter(Be),L=f.centerPoint.add(Se),j=new i.P(_e.x,_e.y).mult(f.worldSize),V=new i.P(i.aF(Be.lng),i.aJ(Be.lat)).mult(f.worldSize).sub(j)}else{L=f.centerPoint.add(k);let _e=f.pointLocation(L),Se=i.aT.convert(o.center||_e);this._normalizeCenter(Se),j=f.project(_e),V=f.project(Se).sub(j)}let W=f.zoomScale(S-_),q,J;o.around&&(q=i.aT.convert(o.around),J=f.locationPoint(q));let ie=this._zooming||S!==_,ee=this._rotating||y!==M,ge=this._pitching||A!==x,de=!f.isPaddingEqual(F),fe=o.retainPadding===!1?f.clone():f,ue=_e=>Se=>{if(ie&&(_e.zoom=i.ak(_,S,Se)),ee&&(_e.bearing=i.ak(y,M,Se)),ge&&(_e.pitch=i.ak(x,A,Se)),de&&(fe.interpolatePadding(w,F,Se),L=fe.centerPoint.add(k)),q)_e.setLocationAtPoint(q,J);else{let Ce=_e.zoomScale(_e.zoom-_),Be=S>_?Math.min(2,W):Math.max(.5,W),Ue=Math.pow(Be,1-Se),Ze=_e.unproject(j.add(V.mult(Se*Ue)).mult(Ce));_e.setLocationAtPoint(_e.renderWorldCopies?Ze.wrap():Ze,L)}return o.preloadOnly||this._fireMoveEvents(c),_e};if(o.preloadOnly){let _e=this._emulate(ue,o.duration,f);return this._preloadTiles(_e),this}let se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=ee,this._pitching=ge,this._padding=de,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,se),this._ease(ue(f),_e=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(c,_e)},o),this}_prepareEase(o,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||f.moving||this.fire(new i.z("movestart",o)),this._zooming&&!f.zooming&&this.fire(new i.z("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new i.z("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new i.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.z("move",o)),this._zooming&&this.fire(new i.z("zoom",o)),this._rotating&&this.fire(new i.z("rotate",o)),this._pitching&&this.fire(new i.z("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.z("zoomend",o)),_&&this.fire(new i.z("rotateend",o)),y&&this.fire(new i.z("pitchend",o)),this.fire(new i.z("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){let Le=i.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Le,c)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},o);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?i.aA(+o.zoom,f.minZoom,f.maxZoom):_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,F=this._extendPadding(o.padding),k=f.zoomScale(S-_),L=i.P.convert(o.offset),j=f.centerPoint.add(L),V=f.pointLocation(j),W=i.aT.convert(o.center||V);this._normalizeCenter(W);let q=f.project(V),J=f.project(W).sub(q),ie=o.curve,ee=Math.max(f.width,f.height),ge=ee/k,de=J.mag();if("minZoom"in o){let Le=i.aA(Math.min(o.minZoom,_,S),f.minZoom,f.maxZoom),Je=ee/f.zoomScale(Le-_);ie=Math.sqrt(Je/de*2)}let fe=ie*ie;function ue(Le){let Je=(ge*ge-ee*ee+(Le?-1:1)*fe*fe*de*de)/(2*(Le?ge:ee)*fe*de);return Math.log(Math.sqrt(Je*Je+1)-Je)}function se(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function _e(Le){return(Math.exp(Le)+Math.exp(-Le))/2}let Se=ue(0),Ce=function(Le){return _e(Se)/_e(Se+ie*Le)},Be=function(Le){return ee*((_e(Se)*(se(Je=Se+ie*Le)/_e(Je))-se(Se))/fe)/de;var Je},Ue=(ue(1)-Se)/ie;if(Math.abs(de)<1e-6||!isFinite(Ue)){if(Math.abs(ee-ge)<1e-6)return this.easeTo(o,c);let Le=ge<ee?-1:1;Ue=Math.abs(Math.log(ge/ee))/ie,Be=function(){return 0},Ce=function(Je){return Math.exp(Le*ie*Je)}}o.duration="duration"in o?+o.duration:1e3*Ue/("screenSpeed"in o?+o.screenSpeed/ie:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let Ze=y!==M,lt=A!==x,ke=!f.isPaddingEqual(F),be=o.retainPadding===!1?f.clone():f,He=Le=>Je=>{let yt=Je*Ue,Mt=1/Ce(yt);Le.zoom=Je===1?S:_+Le.scaleZoom(Mt),Ze&&(Le.bearing=i.ak(y,M,Je)),lt&&(Le.pitch=i.ak(x,A,Je)),ke&&(be.interpolatePadding(w,F,Je),j=be.centerPoint.add(L));let pt=Je===1?W:Le.unproject(q.add(J.mult(Be(yt))).mult(Mt));return Le.setLocationAtPoint(Le.renderWorldCopies?pt.wrap():pt,j),Le._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Le};if(o.preloadOnly){let Le=this._emulate(He,o.duration,f);return this._preloadTiles(Le),this}return this._zooming=!0,this._rotating=Ze,this._pitching=lt,this._padding=ke,this._prepareEase(c,!1),this._ease(He(f),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!o){let f=this.handlers;f&&f.stop(!1)}return this}_ease(o,c,f){f.animate===!1||f.duration===0?(o(1),c()):(this._easeStart=i.o.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=i.bT(o,-180,180);let f=Math.abs(o-c);return Math.abs(o-360-c)<f&&(o-=360),Math.abs(o+360-c)<f&&(o+=360),o}_normalizeCenter(o){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let f=o.lng-c.center.lng;o.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,f){let _=Math.ceil(15*c/1e3),y=[],x=o(f.clone());for(let w=0;w<=_;w++){let S=x(w/_);y.push(S.clone())}return y}_preloadTiles(o,c){}}class kp{constructor(o={}){this.options=o,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let c=this.options&&this.options.compact,f=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Fe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let _=Fe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=Fe("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){let f=c.reduce((_,y,x)=>(y.value&&(_+=`${y.key}=${y.value}${x<c.length-1?"&":""}`),_),"?");o.href=`${i.e.FEEDBACK_URL}/${f}#${qr(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let c=this._map.style._mergedSourceCaches;for(let _ in c){let y=c[_];if(y.used){let x=y.getSource();x.attribution&&o.indexOf(x.attribution)<0&&o.push(x.attribution)}}o.sort((_,y)=>_.length-y.length),o=o.filter((_,y)=>{for(let x=y+1;x<o.length;x++)if(o[x].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let f=o.map(_=>(function(y){let x=new DOMParser().parseFromString(y,"text/html");return Array.from(x.body.querySelectorAll("*")).forEach(w=>{let S=w.textContent||"";if(w.tagName!=="A")return void w.replaceWith(x.createTextNode(S));let M=w.getAttribute("href");if(!M||!/^(https?:|mailto:)/i.test(M))return void w.replaceWith(x.createTextNode(S));let A=x.createElement("a");A.href=M,A.textContent=S,A.rel="noopener nofollow";let F=w.getAttribute("class");F&&(A.className=F),w.replaceWith(A)}),x.body.innerHTML})(_)).join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fp{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Fe("div","mapboxgl-ctrl");let c=Fe("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let c in o){let f=o[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class nh{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(o,c){let f=Fe("button",o,this._container);return f.type="button",f.addEventListener("click",c),f}_createSeparator(){return Fe("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,c){this._map&&(o.setAttribute("aria-label",c),o.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");let c=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(f=>f.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){let o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{let c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Fe("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){let o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,c){for(let f=0;f<o.length;f++){let _=o[f],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(y,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&c&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),f<o.length-1&&this._createSeparator()}}}class ec{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){let c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(let _ of f)if(_.id===o)return void(_.cancelled=!0)}run(o=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let f of c)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class tc{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let c=i.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,f){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+f}}let nc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Qc extends i.z{constructor(o,c,f,_){let{point:y,lngLat:x,originalEvent:w,target:S}=o;super(o.type,{point:y,lngLat:x,originalEvent:w,target:S}),this.preventDefault=()=>{o.preventDefault()},this.id=c,this.interaction=f,this.feature=_}}class ja{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,c){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);let f=c.filter,_=c.type;f&&this.filters.set(o,i.b6(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");let y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,c)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(o,c),this.typeById.set(o,_)}get(o){let c=this.typeById.get(o);if(!c)return;let f=this.interactionsByType.get(c);return f?f.get(o):void 0}remove(o){let c=this.typeById.get(o);if(!c)return;this.typeById.delete(o),this.filters.delete(o);let f=this.interactionsByType.get(c);f&&(f.delete(o),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(c,this.handleType))}queryTargets(o,c){let f=[];for(let[_,y]of c)y.target&&f.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(o,f,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let c=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());c.length&&(o.type="mouseenter",this.handleType(o,c));let f=new Map;for(let[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(y.id,y);f.size&&(o.type="mouseleave",this.handleType(o,Array.from(f.values())))}handleOut(o){let c=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);c.length&&(o.type="mouseleave",this.handleType(o,c)),this.hoveredFeatures.clear()}handleType(o,c){let f=o.type==="mouseenter";if(f&&!this.interactionsByType.has(o.type))return void i.w("mouseenter interaction required for mouseleave to work.");let _=Array.from(this.interactionsByType.get(o.type)).reverse(),y=!!c;c=c||this.queryTargets(o.point,_);let x=!1,w=new Set;for(let S of c){for(let[M,A]of _){if(!A.target)continue;let F=S.variants?S.variants[M]:null;if(F){for(let k of F){if(kd(k,S,w,M))continue;let L=new i.dx(S,k),j=Vu(k,S,M);y&&L.id!==void 0&&(L.state=this.map.getFeatureState(L));let V=f?this.prevHoveredFeatures.get(j):null,W=new Qc(o,M,A,L),q=V?V.stop:A.handler(W);if(f&&this.hoveredFeatures.set(j,{feature:S,stop:q}),q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[S,M]of _){let{handler:A,target:F}=M;if(!F&&A(new Qc(o,S,M,null))!==!1)break}}}function yT(p,o){if(Array.isArray(p)&&Array.isArray(o)){let c=new Set(p),f=new Set(o);return c.size===f.size&&p.every(_=>f.has(_))}return i.by(p,o)}let xT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},bT={showCompass:!0,showZoom:!0,visualizePitch:!1};class wT{constructor(o,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Xv({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new Yv({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Hn()}move(o,c){let f=this.map,_=this.mouseRotate.mousemoveWindow(o,c),y=_&&_.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(o,c),w=x&&x.pitchDelta;w&&f.setPitch(f.getPitch()+w)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Er(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),is(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,is(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=zl(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=zl(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function e0(p,o,c){if(p=new i.aT(p.lng,p.lat),o){let f=new i.aT(p.lng-360,p.lat),_=new i.aT(p.lng+360,p.lat),y=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),x=c.locationPoint3D(p).distSqr(o),w=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint3D(f).distSqr(o)<x&&(w||Math.abs(f.lng-c.center.lng)<y)?p=f:c.locationPoint3D(_).distSqr(o)<x&&(w||Math.abs(_.lng-c.center.lng)<y)&&(p=_)}for(;Math.abs(p.lng-c.center.lng)>180;){let f=c.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}let Bo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},_a={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ig extends i.E{constructor(o,c){super(),(o instanceof HTMLElement||c)&&(o=Object.assign({element:o},c)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:f="center",color:_="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:w=0,rotation:S=_a.rotation,rotationAlignment:M=_a.rotationAlignment,pitchAlignment:A=_a.pitchAlignment,occludedOpacity:F=_a.occludedOpacity,altitude:k=_a.altitude}=o||{};this._anchor=f,this._color=_,this._scale=y,this._draggable=x,this._clickTolerance=w,this._rotation=S,this._rotationAlignment=M,this._pitchAlignment=A,this._occludedOpacity=F,this._altitude=k,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});let L=this._element.classList;for(let V in Bo)L.remove(`mapboxgl-marker-anchor-${V}`);L.add(`mapboxgl-marker-anchor-${this._anchor}`);let j=o&&o.className?o.className.trim().split(/\s+/):[];L.add(...j),this._popup=null}_createDefaultMarker(){let o=Fe("div"),c=gt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){let f=gt("radialGradient",{id:"shadowGradient"},gt("defs",{},c));gt("stop",{offset:"10%","stop-opacity":.4},f),gt("stop",{offset:"100%","stop-opacity":.05},f),gt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return gt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),gt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),gt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||_a.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let c=o.code,f=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(o){let c=o.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,c=this._pos;if(!o||!c)return!1;let f=o.unproject(c,this._altitude),_=o.getFreeCameraOptions();if(!_.position)return!1;let y=_.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();let f=o.unproject(c,this._altitude),_;o._showingGlobe()&&i.f5(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(f),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Bo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let o=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!o||f!=="map")return"";if(!c._showingGlobe()){let S=c.getPitch();return S?`rotateX(${S}deg)`:""}let _=i.cX(i.f6(c.transform,this._lngLat)),y=o.sub(i.f7(c.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let w=_/x;return`rotateX(${-y.y*w}deg) rotateY(${y.x*w}deg)`}_calculateZTransform(){let o=this._pos,c=this._map;if(!c||!o)return"";let f=0,_=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){let y=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);f=i.cX(Math.atan2(x.y,x.x))-90}else f=-c.getBearing();else if(_==="horizon"){let y=i.ah(4,6,c.getZoom()),x=i.f7(c.transform);x.y+=y*c.transform.height;let w=o.sub(x),S=i.cX(Math.atan2(w.y,w.x));f=(S>90?S-270:S+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=e0(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let c=this._map;if(!c)return;let f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){let y=this._clickTolerance||c._clickTolerance;if(o.point.dist(f)<y)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(o){let c=this._map,f=this._pos;c&&f&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(f),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||_a.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||_a.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||_a.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||_a.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let CT={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ih={maxWidth:100,unit:"metric"},t0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},va={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ya=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function od(p=new i.P(0,0),o="bottom"){if(typeof p=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new i.P(0,p);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-p);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(p,0);case"right":return new i.P(-p,0)}return new i.P(0,0)}return p instanceof i.P||Array.isArray(p)?i.P.convert(p):i.P.convert(p[o]||[0,0])}return{version:E,supported:Qe.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends Jv{constructor(p){N.mark(O.create);let o=p;if((p=Object.assign({},xT,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&i.f3(window)&&(p.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new rv(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new ec,this._domRenderTaskQueue=new ec,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},nc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new Ff(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){let c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new vT(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||i.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Uv(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new kp({customAttribution:p.customAttribution})),this._logoControl=new Fp,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.z(`${c.dataType}dataloading`,c))}),this._interactions=new ja(this)}_getMapId(){return this._mapId}addControl(p,o){if(o===void 0&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=p.onAdd(this);this._controls.push(p);let f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new i.z("movestart",p)).fire(new i.z("move",p)),this.fire(new i.z("resize",p)),o&&this.fire(new i.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(i.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(o=>o==="auto"?navigator.language:o):p}setLanguage(p){let o=this._parseLanguage(p);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,o=p.projection.name,c;o==="globe"&&p.zoom>=i.cL?(p.setMercatorFromTransition(),c=!0):o==="mercator"&&p.zoom<i.cL&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,o){return this._updateProjection(p||o||{name:"mercator"})}_updateProjection(p){let o,c=this.transform.mercatorFromTransition;o=p.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();let f=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(o||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,o){return this.transform.locationPoint3D(i.aT.convert(p),o)}unproject(p,o){return this.transform.pointLocation3D(i.P.convert(p),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,o,c){let f=_=>{let y=[];if(Array.isArray(o)){let x=o.filter(w=>this.getLayer(w));y=x.length?this.queryRenderedFeatures(_,{layers:x}):[]}else y=this.queryRenderedFeatures(_,{target:o});return y};if(p==="mouseenter"||p==="mouseover"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:x=>{let w=f(x.point);w.length?_||(_=!0,c.call(this,new Cs(p,this,x.originalEvent,{features:w}))):_=!1},mouseout:()=>{_=!1}}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:w=>{f(w.point).length?_=!0:_&&(_=!1,c.call(this,new Cs(p,this,w.originalEvent)))},mouseout:w=>{_&&(_=!1,c.call(this,new Cs(p,this,w.originalEvent)))}}}}{let _=y=>{let x=f(y.point);x.length&&(y.features=x,c.call(this,y),delete y.features)};return{listener:c,targets:o,delegates:{[p]:_}}}}on(p,o,c){if(typeof o=="function"||c===void 0)return super.on(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(let _ in f.delegates)this.on(_,f.delegates[_]);return this}once(p,o,c){if(typeof o=="function"||c===void 0)return super.once(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);for(let _ in f.delegates)this.once(_,f.delegates[_]);return this}off(p,o,c){if(typeof o=="function"||c===void 0)return super.off(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(_=>{for(let y=0;y<_.length;y++){let x=_[y];if(x.listener===c&&yT(x.targets,o)){for(let w in x.delegates)this.off(w,x.delegates[w]);return _.splice(y,1),this}}})(f),this}queryRenderedFeatures(p,o){if(!this.style)return[];if(p===void 0||p instanceof i.P||Array.isArray(p)||o!==void 0||(o=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!o){let y=this.style.queryRenderedFeatures(p,void 0,this.transform),x=this.style.queryRenderedFeatureset(p,void 0,this.transform);return y.concat(x)}let c=!0;if(o.target&&(c=this._isTargetValid(o.target),c&&!o.layers))return this.style.queryRenderedFeatureset(p,o,this.transform);let f=!0;if(o.layers&&Array.isArray(o.layers)){for(let y of o.layers)if(!this._isValidId(y)){f=!1;break}if(f&&!o.target)return this.style.queryRenderedFeatures(p,o,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(p,o,this.transform))),c&&(_=_.concat(this.style.queryRenderedFeatureset(p,o,this.transform))),_}querySourceFeatures(p,o){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,o)}queryRasterValue(p,o,c){return this._isValidId(p)?this.style.queryRasterValue(p,o,c):Promise.resolve(null)}isPointOnSurface(p){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(p))}addInteraction(p,o){return this._interactions.add(p,o),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&p&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(p,(c,f)=>{if(c){let _=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(p,o)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){let o=this._locale[p];if(o==null)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){let c=Object.assign({},o);o&&o.config&&(c.initialConfig=o.config,delete c.config),this.style=new ga(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ga(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(p)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(let o of p)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(p)}addSource(p,o){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,o,{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();let w=i.I.from(p);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:S,height:M,data:A}=i.o.getImageData(o);this.style.addImage(w,{data:new i.q({width:S,height:M},A),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:S,height:M}=o,A=o;this.style.addImage(w,{data:new i.q({width:S,height:M},new Uint8Array(A.data)),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,usvg:!1,version:0,userImage:A}),A.onAdd&&A.onAdd(this,p)}}updateImage(p,o){this._lazyInitEmptyStyle();let c=i.I.from(p),f=this.style.getImage(c);if(!f)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.o.getImageData(o):o,{width:y,height:x,data:w}=_;if(y===void 0||x===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||x!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));let S=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap),M=!1;f.usvg?(f.data=new i.q({width:y,height:x},new Uint8Array(w)),f.usvg=!1,f.icon=void 0,M=!0):f.data.replace(w,S),this.style.updateImage(c,f,M)}hasImage(p){return p?!!this.style&&!!this.style.getImage(i.I.from(p)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(i.I.from(p))}loadImage(p,o){i.n(this._requestManager.transformRequest(p,i.R.Image),(c,f)=>{o(c,f instanceof HTMLImageElement?i.o.getImageData(f):f)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,o){this._lazyInitEmptyStyle(),this.style.addModel(p,o)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,o){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)):this}getSlot(p){let o=this.getLayer(p);return o&&o.slot||null}setSlot(p,o){return this.style.setSlot(p,o),this.style.mergeLayers(),this._update(!0)}addImport(p,o){return this.style.addImport(p,o).catch(c=>this.fire(new i.y(new Error("Failed to add import",c)))),this}updateImport(p,o){return typeof o!="string"&&o.id!==p?(this.removeImport(p),this.addImport(o)):(this.style.updateImport(p,o),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,o){return this.style.moveImport(p,o),this._update(!0)}moveLayer(p,o){return this._isValidId(p)?(this.style.moveLayer(p,o),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;let o=this.style.getOwnLayer(p);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,o,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,o,c),this._update(!0)):this}setFilter(p,o,c={}){return this._isValidId(p)?(this.style.setFilter(p,o,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,o,c,f),this._update(!0)):this}getPaintProperty(p,o){return this._isValidId(p)?this.style.getPaintProperty(p,o):null}setLayoutProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,o,c,f),this._update(!0)):this}getLayoutProperty(p,o){return this._isValidId(p)?this.style.getLayoutProperty(p,o):null}setLayerProperty(p,o,c,f={}){return this._isValidId(p)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,o,c,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,o){return this.style.setSchema(p,o),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,o){return this.style.setConfig(p,o),this._update(!0)}getConfigProperty(p,o){return this.style.getConfigProperty(p,o)}setConfigProperty(p,o,c){return this.style.setConfigProperty(p,o,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let o=p[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,o),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(p),this.transform):0}setFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,o),this._update())}removeFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,o),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new nh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,c,f,_,y=this._container;for(;y&&(!f||!_);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(c=x.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),y=y.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Xx(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Fe("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=Fe("div","mapboxgl-canvas-container",p);this._canvas=Fe("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=Fe("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=Fe("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){let c=i.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let o=this._markers.indexOf(p);o!==-1&&this._markers.splice(o,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let o=this._popups.indexOf(p);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let p=Object.assign({},Qe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",p);o?(Wo(o,!0),this.painter=new $m(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(o)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;this.fire(new i.z("renderstart")),++this._frameId;let c=this.painter.context.extTimerQuery,f=i.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=_.createQuery(),_.beginQuery(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let M=this.transform.zoom,A=this.transform.pitch,F=i.o.now(),k=new i.ac(M,{now:F,fadeDuration:y,pitch:A,transition:this.style.transition,worldview:this._worldview});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(f);let w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(O.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let M=i.o.now()-f;_.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let A=_.getQueryParameter(o,_.QUERY_RESULT)/1e6;_.deleteQuery(o),this.fire(new i.z("gpu-timing-frame",{cpuTime:M,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){let M=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(M);this.fire(new i.z("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(M);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:A}))},50)}let S=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(S||this._repaint)this.triggerRepaint();else{let M=this.idle();if(M&&(x=this._updateAverageElevation(f,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,N.mark(O.fullLoad),this._performanceMetricsCollection&&Pr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let o of this._markers)p&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!p||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(p,o=!1){let c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let _=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=p;let x=Math.abs(_-y);if(x>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){Pc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===gi||p.status===401)){let o=this.painter.context.gl;Wo(o,!1),this._logoControl instanceof Fp&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Lf(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Nf(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ji(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Fo(this._requestManager._customAccessToken)}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let c=this.painter.context.gl,f=c.createFramebuffer();function _(y){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0);let x=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,x),x}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(_(p),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(p,o,c){let f=c[1]-c[0],_=p.length/4;for(let y=0;y<o.length;y++){let x=o[y],w=0;for(let S=0;S<x.length;S+=4)x[S]===p[S]&&x[S+1]===p[S+1]&&x[S+2]===p[S+2]&&x[S+3]===p[S+3]&&(w+=1);f+=(c[y+2]-c[y+1])*(1-w/_)}return f}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Os.delete(this.painter.context.gl),Ac.remove(),$s.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=i.o.frame(o=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(p){let o=this.style?this.style.getSourceCaches():[];return i.bw(o,(c,f)=>c._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,o){i.f4(p,o)}get version(){return E}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},bT,p),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Fe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Fe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=Fe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let o=p.getZoom(),c=o===p.getMaxZoom(),f=o===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wT(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){let c=Fe("button",p,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(p,o){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(p={}){super();let o=navigator.geolocation;this.options=Object.assign({geolocation:o},CT,p),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(p){let o=this._map.getMaxBounds(),c=p.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){let o=new i.aT(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),_=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(p){if(p){let o=new i.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,o=i.cf(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Fe("button","mapboxgl-ctrl-geolocate",this._container),Fe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Fe("div","mapboxgl-user-location"),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ig({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Fe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ig({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kp,ScaleControl:class{constructor(p={}){this.options=Object.assign({},ih,p),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,f=o._containerWidth/2-p/2,_=o.unproject([f,c]),y=o.unproject([f+p,c]),x=_.distanceTo(y);if(this.options.unit==="imperial"){let w=3.2808*x;w>5280?this._setScale(p,w/5280,"mile"):this._setScale(p,w,"foot")}else this.options.unit==="nautical"?this._setScale(p,x/1852,"nautical-mile"):x>=1e3?this._setScale(p,x/1e3,"kilometer"):this._setScale(p,x,"meter")}_setScale(p,o,c){this._map._requestDomTask(()=>{let f=(function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),w=y/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){let M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M})(w),x*w})(o),_=f/o;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${t0[c]}`,this._container.style.width=p*_+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=Fe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Fe("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:nh,Popup:class extends i.E{constructor(p){super(),this.options=Object.assign(Object.create(va),p),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=i.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let o=document.createDocumentFragment(),c=document.createElement("body"),f;for(c.innerHTML=p;f=c.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Fe("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){let c=this._closeButton=Fe("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let o=this._map,c=this._container,f=this._pos;if(!o||!c||!f)return"bottom";let _=c.offsetWidth,y=c.offsetHeight,x=f.x<_/2,w=f.x>o.transform.width-_/2;if(f.y+p<y)return x?"top-left":w?"top-right":"top";if(f.y>o.transform.height-y){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){let o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=Fe("div","mapboxgl-popup",o.getContainer()),this._tip=Fe("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=e0(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){let _=this._pos=this._trackPointer&&p instanceof i.P?p:o.project(this._lngLat,this._altitude),y=od(this.options.offset),x=this._anchor=this._getAnchor(y.y),w=od(this.options.offset,x),S=_.add(w).round();o._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Bo[x]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&o._showingGlobe()){let _=i.f5(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(ya);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:ig,Style:ga,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:as,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(p){i.e.ACCESS_TOKEN=p},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(p){i.e.API_URL=p},get workerCount(){return i.fi.workerCount},set workerCount(p){i.fi.workerCount=p},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){i.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){i.fh(p)},get workerUrl(){return i.fg.workerUrl},set workerUrl(p){i.fg.workerUrl=p},get workerClass(){return i.fg.workerClass},set workerClass(p){i.fg.workerClass=p},get workerParams(){return i.fg.workerParams},set workerParams(p){i.fg.workerParams=p},get dracoUrl(){return i.ff()},set dracoUrl(p){i.fe(p)},get meshoptUrl(){return i.fd()},set meshoptUrl(p){i.fc(p)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var h=t;return h})});var GI;function z1(){return GI}function iu(r){let n=GI;return GI=r,n}var tL=Symbol("NotFound");function Sg(r){return r===tL||r?.name==="\u0275NotFound"}var Ls=null,B1=!1,qI=1,Y8=null,Ns=Symbol("SIGNAL");function wi(r){let n=Ls;return Ls=r,n}function $1(){return Ls}var Tg={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Ig(r){if(B1)throw new Error("");if(Ls===null)return;Ls.consumerOnSignalRead(r);let n=Ls.producersTail;if(n!==void 0&&n.producer===r)return;let t,l=Ls.recomputing;if(l&&(t=n!==void 0?n.nextProducer:Ls.producers,t!==void 0&&t.producer===r)){Ls.producersTail=t,t.lastReadVersion=r.version;return}let h=r.consumersTail;if(h!==void 0&&h.consumer===Ls&&(!l||Q8(h,Ls)))return;let i=Dg(Ls),E={producer:r,consumer:Ls,nextProducer:t,prevConsumer:h,lastReadVersion:r.version,nextConsumer:void 0};Ls.producersTail=E,n!==void 0?n.nextProducer=E:Ls.producers=E,i&&oL(r,E)}function nL(){qI++}function H1(r){if(!(Dg(r)&&!r.dirty)&&!(!r.dirty&&r.lastCleanEpoch===qI)){if(!r.producerMustRecompute(r)&&!q0(r)){j1(r);return}r.producerRecomputeValue(r),j1(r)}}function WI(r){if(r.consumers===void 0)return;let n=B1;B1=!0;try{for(let t=r.consumers;t!==void 0;t=t.nextConsumer){let l=t.consumer;l.dirty||K8(l)}}finally{B1=n}}function ZI(){return Ls?.consumerAllowSignalWrites!==!1}function K8(r){r.dirty=!0,WI(r),r.consumerMarkedDirty?.(r)}function j1(r){r.dirty=!1,r.lastCleanEpoch=qI}function Mg(r){return r&&iL(r),wi(r)}function iL(r){r.producersTail=void 0,r.recomputing=!0}function G0(r,n){wi(n),r&&rL(r)}function rL(r){r.recomputing=!1;let n=r.producersTail,t=n!==void 0?n.nextProducer:r.producers;if(t!==void 0){if(Dg(r))do t=XI(t);while(t!==void 0);n!==void 0?n.nextProducer=void 0:r.producers=void 0}}function q0(r){for(let n=r.producers;n!==void 0;n=n.nextProducer){let t=n.producer,l=n.lastReadVersion;if(l!==t.version||(H1(t),l!==t.version))return!0}return!1}function W0(r){if(Dg(r)){let n=r.producers;for(;n!==void 0;)n=XI(n)}r.producers=void 0,r.producersTail=void 0,r.consumers=void 0,r.consumersTail=void 0}function oL(r,n){let t=r.consumersTail,l=Dg(r);if(t!==void 0?(n.nextConsumer=t.nextConsumer,t.nextConsumer=n):(n.nextConsumer=void 0,r.consumers=n),n.prevConsumer=t,r.consumersTail=n,!l)for(let h=r.producers;h!==void 0;h=h.nextProducer)oL(h.producer,h)}function XI(r){let n=r.producer,t=r.nextProducer,l=r.nextConsumer,h=r.prevConsumer;if(r.nextConsumer=void 0,r.prevConsumer=void 0,l!==void 0?l.prevConsumer=h:n.consumersTail=h,h!==void 0)h.nextConsumer=l;else if(n.consumers=l,!Dg(n)){let i=n.producers;for(;i!==void 0;)i=XI(i)}return t}function Dg(r){return r.consumerIsAlwaysLive||r.consumers!==void 0}function G1(r){Y8?.(r)}function Q8(r,n){let t=n.producersTail;if(t!==void 0){let l=n.producers;do{if(l===r)return!0;if(l===t)break;l=l.nextProducer}while(l!==void 0)}return!1}function q1(r,n){return Object.is(r,n)}function W1(r,n){let t=Object.create(J8);t.computation=r,n!==void 0&&(t.equal=n);let l=()=>{if(H1(t),Ig(t),t.value===H0)throw t.error;return t.value};return l[Ns]=t,G1(t),l}var V1=Symbol("UNSET"),U1=Symbol("COMPUTING"),H0=Symbol("ERRORED"),J8=bi($t({},Tg),{value:V1,dirty:!0,error:null,equal:q1,kind:"computed",producerMustRecompute(r){return r.value===V1||r.value===U1},producerRecomputeValue(r){if(r.value===U1)throw new Error("");let n=r.value;r.value=U1;let t=Mg(r),l,h=!1;try{l=r.computation(),wi(null),h=n!==V1&&n!==H0&&l!==H0&&r.equal(n,l)}catch(i){l=H0,r.error=i}finally{G0(r,t)}if(h){r.value=n;return}r.value=l,r.version++}});function e$(){throw new Error}var sL=e$;function aL(r){sL(r)}function YI(r){sL=r}var t$=null;function KI(r,n){let t=Object.create(Z1);t.value=r,n!==void 0&&(t.equal=n);let l=()=>lL(t);return l[Ns]=t,G1(t),[l,E=>Ag(t,E),E=>QI(t,E)]}function lL(r){return Ig(r),r.value}function Ag(r,n){ZI()||aL(r),r.equal(r.value,n)||(r.value=n,n$(r))}function QI(r,n){ZI()||aL(r),Ag(r,n(r.value))}var Z1=bi($t({},Tg),{equal:q1,value:void 0,kind:"signal"});function n$(r){r.version++,nL(),WI(r),t$?.(r)}function Ai(r){return typeof r=="function"}function Pg(r){let t=r(l=>{Error.call(l),l.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var X1=Pg(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((l,h)=>`${h+1}) ${l.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function qp(r,n){if(r){let t=r.indexOf(n);0<=t&&r.splice(t,1)}}var Br=class r{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let i of t)i.remove(this);else t.remove(this);let{initialTeardown:l}=this;if(Ai(l))try{l()}catch(i){n=i instanceof X1?i.errors:[i]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let i of h)try{cL(i)}catch(E){n=n??[],E instanceof X1?n=[...n,...E.errors]:n.push(E)}}if(n)throw new X1(n)}}add(n){var t;if(n&&n!==this)if(this.closed)cL(n);else{if(n instanceof r){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(n)}}_hasParent(n){let{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){let{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&qp(t,n)}remove(n){let{_finalizers:t}=this;t&&qp(t,n),n instanceof r&&n._removeParent(this)}};Br.EMPTY=(()=>{let r=new Br;return r.closed=!0,r})();var JI=Br.EMPTY;function Y1(r){return r instanceof Br||r&&"closed"in r&&Ai(r.remove)&&Ai(r.add)&&Ai(r.unsubscribe)}function cL(r){Ai(r)?r():r.unsubscribe()}var pc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Og={setTimeout(r,n,...t){let{delegate:l}=Og;return l?.setTimeout?l.setTimeout(r,n,...t):setTimeout(r,n,...t)},clearTimeout(r){let{delegate:n}=Og;return(n?.clearTimeout||clearTimeout)(r)},delegate:void 0};function K1(r){Og.setTimeout(()=>{let{onUnhandledError:n}=pc;if(n)n(r);else throw r})}function Z0(){}var uL=eM("C",void 0,void 0);function dL(r){return eM("E",void 0,r)}function hL(r){return eM("N",r,void 0)}function eM(r,n,t){return{kind:r,value:n,error:t}}var Wp=null;function Rg(r){if(pc.useDeprecatedSynchronousErrorHandling){let n=!Wp;if(n&&(Wp={errorThrown:!1,error:null}),r(),n){let{errorThrown:t,error:l}=Wp;if(Wp=null,t)throw l}}else r()}function pL(r){pc.useDeprecatedSynchronousErrorHandling&&Wp&&(Wp.errorThrown=!0,Wp.error=r)}var Zp=class extends Br{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Y1(n)&&n.add(this)):this.destination=o$}static create(n,t,l){return new ud(n,t,l)}next(n){this.isStopped?nM(hL(n),this):this._next(n)}error(n){this.isStopped?nM(dL(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?nM(uL,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},i$=Function.prototype.bind;function tM(r,n){return i$.call(r,n)}var iM=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(l){Q1(l)}}error(n){let{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(l){Q1(l)}else Q1(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){Q1(t)}}},ud=class extends Zp{constructor(n,t,l){super();let h;if(Ai(n)||!n)h={next:n??void 0,error:t??void 0,complete:l??void 0};else{let i;this&&pc.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),h={next:n.next&&tM(n.next,i),error:n.error&&tM(n.error,i),complete:n.complete&&tM(n.complete,i)}):h=n}this.destination=new iM(h)}};function Q1(r){pc.useDeprecatedSynchronousErrorHandling?pL(r):K1(r)}function r$(r){throw r}function nM(r,n){let{onStoppedNotification:t}=pc;t&&Og.setTimeout(()=>t(r,n))}var o$={closed:!0,next:Z0,error:r$,complete:Z0};var kg=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Js(r){return r}function rM(...r){return oM(r)}function oM(r){return r.length===0?Js:r.length===1?r[0]:function(t){return r.reduce((l,h)=>h(l),t)}}var Pi=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){let l=new r;return l.source=this,l.operator=t,l}subscribe(t,l,h){let i=a$(t)?t:new ud(t,l,h);return Rg(()=>{let{operator:E,source:O}=this;i.add(E?E.call(i,O):O?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(t){try{return this._subscribe(t)}catch(l){t.error(l)}}forEach(t,l){return l=fL(l),new l((h,i)=>{let E=new ud({next:O=>{try{t(O)}catch(N){i(N),E.unsubscribe()}},error:i,complete:h});this.subscribe(E)})}_subscribe(t){var l;return(l=this.source)===null||l===void 0?void 0:l.subscribe(t)}[kg](){return this}pipe(...t){return oM(t)(this)}toPromise(t){return t=fL(t),new t((l,h)=>{let i;this.subscribe(E=>i=E,E=>h(E),()=>l(i))})}}return r.create=n=>new r(n),r})();function fL(r){var n;return(n=r??pc.Promise)!==null&&n!==void 0?n:Promise}function s$(r){return r&&Ai(r.next)&&Ai(r.error)&&Ai(r.complete)}function a$(r){return r&&r instanceof Zp||s$(r)&&Y1(r)}function sM(r){return Ai(r?.lift)}function Fi(r){return n=>{if(sM(n))return n.lift(function(t){try{return r(t,this)}catch(l){this.error(l)}});throw new TypeError("Unable to lift unknown Observable type")}}function Oi(r,n,t,l,h){return new aM(r,n,t,l,h)}var aM=class extends Zp{constructor(n,t,l,h,i,E){super(n),this.onFinalize=i,this.shouldUnsubscribe=E,this._next=t?function(O){try{t(O)}catch(N){n.error(N)}}:super._next,this._error=h?function(O){try{h(O)}catch(N){n.error(N)}finally{this.unsubscribe()}}:super._error,this._complete=l?function(){try{l()}catch(O){n.error(O)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Fg(){return Fi((r,n)=>{let t=null;r._refCount++;let l=Oi(n,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount){t=null;return}let h=r._connection,i=t;t=null,h&&(!i||h===i)&&h.unsubscribe(),n.unsubscribe()});r.subscribe(l),l.closed||(t=r.connect())})}var Lg=class extends Pi{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,sM(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Br;let t=this.getSubject();n.add(this.source.subscribe(Oi(t,void 0,()=>{this._teardown(),t.complete()},l=>{this._teardown(),t.error(l)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Br.EMPTY)}return n}refCount(){return Fg()(this)}};var mL=Pg(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var li=(()=>{class r extends Pi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let l=new J1(this,this);return l.operator=t,l}_throwIfClosed(){if(this.closed)throw new mL}next(t){Rg(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let l of this.currentObservers)l.next(t)}})}error(t){Rg(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:l}=this;for(;l.length;)l.shift().error(t)}})}complete(){Rg(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:l,isStopped:h,observers:i}=this;return l||h?JI:(this.currentObservers=null,i.push(t),new Br(()=>{this.currentObservers=null,qp(i,t)}))}_checkFinalizedStatuses(t){let{hasError:l,thrownError:h,isStopped:i}=this;l?t.error(h):i&&t.complete()}asObservable(){let t=new Pi;return t.source=this,t}}return r.create=(n,t)=>new J1(n,t),r})(),J1=class extends li{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,l;(l=(t=this.destination)===null||t===void 0?void 0:t.next)===null||l===void 0||l.call(t,n)}error(n){var t,l;(l=(t=this.destination)===null||t===void 0?void 0:t.error)===null||l===void 0||l.call(t,n)}complete(){var n,t;(t=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||t===void 0||t.call(n)}_subscribe(n){var t,l;return(l=(t=this.source)===null||t===void 0?void 0:t.subscribe(n))!==null&&l!==void 0?l:JI}};var Qo=class extends li{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){let{hasError:n,thrownError:t,_value:l}=this;if(n)throw t;return this._throwIfClosed(),l}next(n){super.next(this._value=n)}};var lM={now(){return(lM.delegate||Date).now()},delegate:void 0};var ew=class extends Br{constructor(n,t){super()}schedule(n,t=0){return this}};var X0={setInterval(r,n,...t){let{delegate:l}=X0;return l?.setInterval?l.setInterval(r,n,...t):setInterval(r,n,...t)},clearInterval(r){let{delegate:n}=X0;return(n?.clearInterval||clearInterval)(r)},delegate:void 0};var tw=class extends ew{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var l;if(this.closed)return this;this.state=n;let h=this.id,i=this.scheduler;return h!=null&&(this.id=this.recycleAsyncId(i,h,t)),this.pending=!0,this.delay=t,this.id=(l=this.id)!==null&&l!==void 0?l:this.requestAsyncId(i,this.id,t),this}requestAsyncId(n,t,l=0){return X0.setInterval(n.flush.bind(n,this),l)}recycleAsyncId(n,t,l=0){if(l!=null&&this.delay===l&&this.pending===!1)return t;t!=null&&X0.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let l=this._execute(n,t);if(l)return l;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let l=!1,h;try{this.work(n)}catch(i){l=!0,h=i||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){let{id:n,scheduler:t}=this,{actions:l}=t;this.work=this.state=this.scheduler=null,this.pending=!1,qp(l,this),n!=null&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}};var Ng=class r{constructor(n,t=r.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,l){return new this.schedulerActionCtor(this,n).schedule(l,t)}};Ng.now=lM.now;var nw=class extends Ng{constructor(n,t=Ng.now){super(n,t),this.actions=[],this._active=!1}flush(n){let{actions:t}=this;if(this._active){t.push(n);return}let l;this._active=!0;do if(l=n.execute(n.state,n.delay))break;while(n=t.shift());if(this._active=!1,l){for(;n=t.shift();)n.unsubscribe();throw l}}};var Xp=new nw(tw),gL=Xp;var wa=new Pi(r=>r.complete());function iw(r){return r&&Ai(r.schedule)}function _L(r){return r[r.length-1]}function rw(r){return Ai(_L(r))?r.pop():void 0}function fh(r){return iw(_L(r))?r.pop():void 0}function yL(r,n,t,l){function h(i){return i instanceof t?i:new t(function(E){E(i)})}return new(t||(t=Promise))(function(i,E){function O(le){try{K(l.next(le))}catch(De){E(De)}}function N(le){try{K(l.throw(le))}catch(De){E(De)}}function K(le){le.done?i(le.value):h(le.value).then(O,N)}K((l=l.apply(r,n||[])).next())})}function vL(r){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&r[n],l=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yp(r){return this instanceof Yp?(this.v=r,this):new Yp(r)}function xL(r,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=t.apply(r,n||[]),h,i=[];return h=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),O("next"),O("throw"),O("return",E),h[Symbol.asyncIterator]=function(){return this},h;function E(Fe){return function(gt){return Promise.resolve(gt).then(Fe,De)}}function O(Fe,gt){l[Fe]&&(h[Fe]=function(jt){return new Promise(function(Ot,Kt){i.push([Fe,jt,Ot,Kt])>1||N(Fe,jt)})},gt&&(h[Fe]=gt(h[Fe])))}function N(Fe,gt){try{K(l[Fe](gt))}catch(jt){Qe(i[0][3],jt)}}function K(Fe){Fe.value instanceof Yp?Promise.resolve(Fe.value.v).then(le,De):Qe(i[0][2],Fe)}function le(Fe){N("next",Fe)}function De(Fe){N("throw",Fe)}function Qe(Fe,gt){Fe(gt),i.shift(),i.length&&N(i[0][0],i[0][1])}}function bL(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r[Symbol.asyncIterator],t;return n?n.call(r):(r=typeof vL=="function"?vL(r):r[Symbol.iterator](),t={},l("next"),l("throw"),l("return"),t[Symbol.asyncIterator]=function(){return this},t);function l(i){t[i]=r[i]&&function(E){return new Promise(function(O,N){E=r[i](E),h(O,N,E.done,E.value)})}}function h(i,E,O,N){Promise.resolve(N).then(function(K){i({value:K,done:O})},E)}}var ow=r=>r&&typeof r.length=="number"&&typeof r!="function";function sw(r){return Ai(r?.then)}function aw(r){return Ai(r[kg])}function lw(r){return Symbol.asyncIterator&&Ai(r?.[Symbol.asyncIterator])}function cw(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function l$(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var uw=l$();function dw(r){return Ai(r?.[uw])}function hw(r){return xL(this,arguments,function*(){let t=r.getReader();try{for(;;){let{value:l,done:h}=yield Yp(t.read());if(h)return yield Yp(void 0);yield yield Yp(l)}}finally{t.releaseLock()}})}function pw(r){return Ai(r?.getReader)}function no(r){if(r instanceof Pi)return r;if(r!=null){if(aw(r))return c$(r);if(ow(r))return u$(r);if(sw(r))return d$(r);if(lw(r))return wL(r);if(dw(r))return h$(r);if(pw(r))return p$(r)}throw cw(r)}function c$(r){return new Pi(n=>{let t=r[kg]();if(Ai(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function u$(r){return new Pi(n=>{for(let t=0;t<r.length&&!n.closed;t++)n.next(r[t]);n.complete()})}function d$(r){return new Pi(n=>{r.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,K1)})}function h$(r){return new Pi(n=>{for(let t of r)if(n.next(t),n.closed)return;n.complete()})}function wL(r){return new Pi(n=>{f$(r,n).catch(t=>n.error(t))})}function p$(r){return wL(hw(r))}function f$(r,n){var t,l,h,i;return yL(this,void 0,void 0,function*(){try{for(t=bL(r);l=yield t.next(),!l.done;){let E=l.value;if(n.next(E),n.closed)return}}catch(E){h={error:E}}finally{try{l&&!l.done&&(i=t.return)&&(yield i.call(t))}finally{if(h)throw h.error}}n.complete()})}function Ca(r,n,t,l=0,h=!1){let i=n.schedule(function(){t(),h?r.add(this.schedule(null,l)):this.unsubscribe()},l);if(r.add(i),!h)return i}function fw(r,n=0){return Fi((t,l)=>{t.subscribe(Oi(l,h=>Ca(l,r,()=>l.next(h),n),()=>Ca(l,r,()=>l.complete(),n),h=>Ca(l,r,()=>l.error(h),n)))})}function mw(r,n=0){return Fi((t,l)=>{l.add(r.schedule(()=>t.subscribe(l),n))})}function CL(r,n){return no(r).pipe(mw(n),fw(n))}function EL(r,n){return no(r).pipe(mw(n),fw(n))}function SL(r,n){return new Pi(t=>{let l=0;return n.schedule(function(){l===r.length?t.complete():(t.next(r[l++]),t.closed||this.schedule())})})}function TL(r,n){return new Pi(t=>{let l;return Ca(t,n,()=>{l=r[uw](),Ca(t,n,()=>{let h,i;try{({value:h,done:i}=l.next())}catch(E){t.error(E);return}i?t.complete():t.next(h)},0,!0)}),()=>Ai(l?.return)&&l.return()})}function gw(r,n){if(!r)throw new Error("Iterable cannot be null");return new Pi(t=>{Ca(t,n,()=>{let l=r[Symbol.asyncIterator]();Ca(t,n,()=>{l.next().then(h=>{h.done?t.complete():t.next(h.value)})},0,!0)})})}function IL(r,n){return gw(hw(r),n)}function ML(r,n){if(r!=null){if(aw(r))return CL(r,n);if(ow(r))return SL(r,n);if(sw(r))return EL(r,n);if(lw(r))return gw(r,n);if(dw(r))return TL(r,n);if(pw(r))return IL(r,n)}throw cw(r)}function co(r,n){return n?ML(r,n):no(r)}function Dn(...r){let n=fh(r);return co(r,n)}function fc(r,n){let t=Ai(r)?r:()=>r,l=h=>h.error(t());return new Pi(n?h=>n.schedule(l,0,h):l)}function _w(r){return!!r&&(r instanceof Pi||Ai(r.lift)&&Ai(r.subscribe))}var dd=Pg(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function DL(r){return r instanceof Date&&!isNaN(r)}function Qn(r,n){return Fi((t,l)=>{let h=0;t.subscribe(Oi(l,i=>{l.next(r.call(n,i,h++))}))})}var{isArray:m$}=Array;function g$(r,n){return m$(n)?r(...n):r(n)}function vw(r){return Qn(n=>g$(r,n))}var{isArray:_$}=Array,{getPrototypeOf:v$,prototype:y$,keys:x$}=Object;function yw(r){if(r.length===1){let n=r[0];if(_$(n))return{args:n,keys:null};if(b$(n)){let t=x$(n);return{args:t.map(l=>n[l]),keys:t}}}return{args:r,keys:null}}function b$(r){return r&&typeof r=="object"&&v$(r)===y$}function xw(r,n){return r.reduce((t,l,h)=>(t[l]=n[h],t),{})}function Kp(...r){let n=fh(r),t=rw(r),{args:l,keys:h}=yw(r);if(l.length===0)return co([],n);let i=new Pi(w$(l,n,h?E=>xw(h,E):Js));return t?i.pipe(vw(t)):i}function w$(r,n,t=Js){return l=>{AL(n,()=>{let{length:h}=r,i=new Array(h),E=h,O=h;for(let N=0;N<h;N++)AL(n,()=>{let K=co(r[N],n),le=!1;K.subscribe(Oi(l,De=>{i[N]=De,le||(le=!0,O--),O||l.next(t(i.slice()))},()=>{--E||l.complete()}))},l)},l)}}function AL(r,n,t){r?Ca(t,r,n):n()}function PL(r,n,t,l,h,i,E,O){let N=[],K=0,le=0,De=!1,Qe=()=>{De&&!N.length&&!K&&n.complete()},Fe=jt=>K<l?gt(jt):N.push(jt),gt=jt=>{i&&n.next(jt),K++;let Ot=!1;no(t(jt,le++)).subscribe(Oi(n,Kt=>{h?.(Kt),i?Fe(Kt):n.next(Kt)},()=>{Ot=!0},void 0,()=>{if(Ot)try{for(K--;N.length&&K<l;){let Kt=N.shift();E?Ca(n,E,()=>gt(Kt)):gt(Kt)}Qe()}catch(Kt){n.error(Kt)}}))};return r.subscribe(Oi(n,Fe,()=>{De=!0,Qe()})),()=>{O?.()}}function Do(r,n,t=1/0){return Ai(n)?Do((l,h)=>Qn((i,E)=>n(l,i,h,E))(no(r(l,h))),t):(typeof n=="number"&&(t=n),Fi((l,h)=>PL(l,h,r,t)))}function zg(r=1/0){return Do(Js,r)}function OL(){return zg(1)}function mh(...r){return OL()(co(r,fh(r)))}function Y0(r){return new Pi(n=>{no(r()).subscribe(n)})}function K0(...r){let n=rw(r),{args:t,keys:l}=yw(r),h=new Pi(i=>{let{length:E}=t;if(!E){i.complete();return}let O=new Array(E),N=E,K=E;for(let le=0;le<E;le++){let De=!1;no(t[le]).subscribe(Oi(i,Qe=>{De||(De=!0,K--),O[le]=Qe},()=>N--,void 0,()=>{(!N||!De)&&(K||i.next(l?xw(l,O):O),i.complete())}))}});return n?h.pipe(vw(n)):h}function bw(r=0,n,t=gL){let l=-1;return n!=null&&(iw(n)?t=n:l=n),new Pi(h=>{let i=DL(r)?+r-t.now():r;i<0&&(i=0);let E=0;return t.schedule(function(){h.closed||(h.next(E++),0<=l?this.schedule(void 0,l):h.complete())},i)})}function Q0(r=0,n=Xp){return r<0&&(r=0),bw(r,r,n)}function xo(r,n){return Fi((t,l)=>{let h=0;t.subscribe(Oi(l,i=>r.call(n,i,h++)&&l.next(i)))})}function RL(r){return Fi((n,t)=>{let l=!1,h=null,i=null,E=!1,O=()=>{if(i?.unsubscribe(),i=null,l){l=!1;let K=h;h=null,t.next(K)}E&&t.complete()},N=()=>{i=null,E&&t.complete()};n.subscribe(Oi(t,K=>{l=!0,h=K,i||no(r(K)).subscribe(i=Oi(t,O,N))},()=>{E=!0,(!l||!i||i.closed)&&t.complete()}))})}function ww(r,n=Xp){return RL(()=>bw(r,n))}function qa(r){return Fi((n,t)=>{let l=null,h=!1,i;l=n.subscribe(Oi(t,void 0,void 0,E=>{i=no(r(E,qa(r)(n))),l?(l.unsubscribe(),l=null,i.subscribe(t)):h=!0})),h&&(l.unsubscribe(),l=null,i.subscribe(t))})}function kL(r,n,t,l,h){return(i,E)=>{let O=t,N=n,K=0;i.subscribe(Oi(E,le=>{let De=K++;N=O?r(N,le,De):(O=!0,le),l&&E.next(N)},h&&(()=>{O&&E.next(N),E.complete()})))}}function ru(r,n){return Ai(n)?Do(r,n,1):Do(r,1)}function Bg(r,n=Xp){return Fi((t,l)=>{let h=null,i=null,E=null,O=()=>{if(h){h.unsubscribe(),h=null;let K=i;i=null,l.next(K)}};function N(){let K=E+r,le=n.now();if(le<K){h=this.schedule(void 0,K-le),l.add(h);return}O()}t.subscribe(Oi(l,K=>{i=K,E=n.now(),h||(h=n.schedule(N,r),l.add(h))},()=>{O(),l.complete()},void 0,()=>{i=h=null}))})}function gh(r){return Fi((n,t)=>{let l=!1;n.subscribe(Oi(t,h=>{l=!0,t.next(h)},()=>{l||t.next(r),t.complete()}))})}function Wa(r){return r<=0?()=>wa:Fi((n,t)=>{let l=0;n.subscribe(Oi(t,h=>{++l<=r&&(t.next(h),r<=l&&t.complete())}))})}function Qp(r,n=Js){return r=r??C$,Fi((t,l)=>{let h,i=!0;t.subscribe(Oi(l,E=>{let O=n(E);(i||!r(h,O))&&(i=!1,h=O,l.next(E))}))})}function C$(r,n){return r===n}function Cw(r=E$){return Fi((n,t)=>{let l=!1;n.subscribe(Oi(t,h=>{l=!0,t.next(h)},()=>l?t.complete():t.error(r())))})}function E$(){return new dd}function hd(r){return Fi((n,t)=>{try{n.subscribe(t)}finally{t.add(r)}})}function pd(r,n){let t=arguments.length>=2;return l=>l.pipe(r?xo((h,i)=>r(h,i,l)):Js,Wa(1),t?gh(n):Cw(()=>new dd))}function Vg(r){return r<=0?()=>wa:Fi((n,t)=>{let l=[];n.subscribe(Oi(t,h=>{l.push(h),r<l.length&&l.shift()},()=>{for(let h of l)t.next(h);t.complete()},void 0,()=>{l=null}))})}function cM(r,n){let t=arguments.length>=2;return l=>l.pipe(r?xo((h,i)=>r(h,i,l)):Js,Vg(1),t?gh(n):Cw(()=>new dd))}function uM(r,n){return Fi(kL(r,n,arguments.length>=2,!0))}function hM(r={}){let{connector:n=()=>new li,resetOnError:t=!0,resetOnComplete:l=!0,resetOnRefCountZero:h=!0}=r;return i=>{let E,O,N,K=0,le=!1,De=!1,Qe=()=>{O?.unsubscribe(),O=void 0},Fe=()=>{Qe(),E=N=void 0,le=De=!1},gt=()=>{let jt=E;Fe(),jt?.unsubscribe()};return Fi((jt,Ot)=>{K++,!De&&!le&&Qe();let Kt=N=N??n();Ot.add(()=>{K--,K===0&&!De&&!le&&(O=dM(gt,h))}),Kt.subscribe(Ot),!E&&K>0&&(E=new ud({next:Hn=>Kt.next(Hn),error:Hn=>{De=!0,Qe(),O=dM(Fe,t,Hn),Kt.error(Hn)},complete:()=>{le=!0,Qe(),O=dM(Fe,l),Kt.complete()}}),no(jt).subscribe(E))})(i)}}function dM(r,n,...t){if(n===!0){r();return}if(n===!1)return;let l=new ud({next:()=>{l.unsubscribe(),r()}});return no(n(...t)).subscribe(l)}function J0(r){return xo((n,t)=>r<=t)}function Ug(...r){let n=fh(r);return Fi((t,l)=>{(n?mh(r,t,n):mh(r,t)).subscribe(l)})}function _o(r,n){return Fi((t,l)=>{let h=null,i=0,E=!1,O=()=>E&&!h&&l.complete();t.subscribe(Oi(l,N=>{h?.unsubscribe();let K=0,le=i++;no(r(N,le)).subscribe(h=Oi(l,De=>l.next(n?n(N,De,le,K++):De),()=>{h=null,O()}))},()=>{E=!0,O()}))})}function mc(r){return Fi((n,t)=>{no(r).subscribe(Oi(t,()=>t.complete(),Z0)),!t.closed&&n.subscribe(t)})}function bo(r,n,t){let l=Ai(r)||n||t?{next:r,error:n,complete:t}:r;return l?Fi((h,i)=>{var E;(E=l.subscribe)===null||E===void 0||E.call(l);let O=!0;h.subscribe(Oi(i,N=>{var K;(K=l.next)===null||K===void 0||K.call(l,N),i.next(N)},()=>{var N;O=!1,(N=l.complete)===null||N===void 0||N.call(l),i.complete()},N=>{var K;O=!1,(K=l.error)===null||K===void 0||K.call(l,N),i.error(N)},()=>{var N,K;O&&((N=l.unsubscribe)===null||N===void 0||N.call(l)),(K=l.finalize)===null||K===void 0||K.call(l)}))}):Js}function FL(r){let n=wi(null);try{return r()}finally{wi(n)}}var Iw="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",sn=class extends Error{code;constructor(n,t){super(ou(n,t)),this.code=n}};function S$(r){return`NG0${Math.abs(r)}`}function ou(r,n){return`${S$(r)}${n?": "+n:""}`}var wl=globalThis;function Ar(r){for(let n in r)if(r[n]===Ar)return n;throw Error("")}function zL(r,n){for(let t in n)n.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=n[t])}function md(r){if(typeof r=="string")return r;if(Array.isArray(r))return`[${r.map(md).join(", ")}]`;if(r==null)return""+r;let n=r.overriddenName||r.name;if(n)return`${n}`;let t=r.toString();if(t==null)return""+t;let l=t.indexOf(`
`);return l>=0?t.slice(0,l):t}function Mw(r,n){return r?n?`${r} ${n}`:r:n||""}var T$=Ar({__forward_ref__:Ar});function su(r){return r.__forward_ref__=su,r.toString=function(){return md(this())},r}function Ts(r){return EM(r)?r():r}function EM(r){return typeof r=="function"&&r.hasOwnProperty(T$)&&r.__forward_ref__===su}function Ft(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function gr(r){return{providers:r.providers||[],imports:r.imports||[]}}function iy(r){return I$(r,Dw)}function SM(r){return iy(r)!==null}function I$(r,n){return r.hasOwnProperty(n)&&r[n]||null}function M$(r){let n=r?.[Dw]??null;return n||null}function fM(r){return r&&r.hasOwnProperty(Sw)?r[Sw]:null}var Dw=Ar({\u0275prov:Ar}),Sw=Ar({\u0275inj:Ar}),Yt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,t){this._desc=n,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Ft({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function TM(r){return r&&!!r.\u0275providers}var IM=Ar({\u0275cmp:Ar}),MM=Ar({\u0275dir:Ar}),DM=Ar({\u0275pipe:Ar}),AM=Ar({\u0275mod:Ar}),ty=Ar({\u0275fac:Ar}),rf=Ar({__NG_ELEMENT_ID__:Ar}),LL=Ar({__NG_ENV_ID__:Ar});function yh(r){return typeof r=="string"?r:r==null?"":String(r)}function BL(r){return typeof r=="function"?r.name||r.toString():typeof r=="object"&&r!=null&&typeof r.type=="function"?r.type.name||r.type.toString():yh(r)}var VL=Ar({ngErrorCode:Ar}),D$=Ar({ngErrorMessage:Ar}),A$=Ar({ngTokenPath:Ar});function PM(r,n){return UL("",-200,n)}function Aw(r,n){throw new sn(-201,!1)}function UL(r,n,t){let l=new sn(n,r);return l[VL]=n,l[D$]=r,t&&(l[A$]=t),l}function P$(r){return r[VL]}var mM;function jL(){return mM}function ea(r){let n=mM;return mM=r,n}function OM(r,n,t){let l=iy(r);if(l&&l.providedIn=="root")return l.value===void 0?l.value=l.factory():l.value;if(t&8)return null;if(n!==void 0)return n;Aw(r,"Injector")}var O$={},Jp=O$,R$="__NG_DI_FLAG__",gM=class{injector;constructor(n){this.injector=n}retrieve(n,t){let l=ef(t)||0;try{return this.injector.get(n,l&8?null:Jp,l)}catch(h){if(Sg(h))return h;throw h}}};function k$(r,n=0){let t=z1();if(t===void 0)throw new sn(-203,!1);if(t===null)return OM(r,void 0,n);{let l=F$(n),h=t.retrieve(r,l);if(Sg(h)){if(l.optional)return null;throw h}return h}}function dn(r,n=0){return(jL()||k$)(Ts(r),n)}function Ve(r,n){return dn(r,ef(n))}function ef(r){return typeof r>"u"||typeof r=="number"?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function F$(r){return{optional:!!(r&8),host:!!(r&1),self:!!(r&2),skipSelf:!!(r&4)}}function _M(r){let n=[];for(let t=0;t<r.length;t++){let l=Ts(r[t]);if(Array.isArray(l)){if(l.length===0)throw new sn(900,!1);let h,i=0;for(let E=0;E<l.length;E++){let O=l[E],N=L$(O);typeof N=="number"?N===-1?h=O.token:i|=N:h=O}n.push(dn(h,i))}else n.push(dn(l))}return n}function L$(r){return r[R$]}function _h(r,n){let t=r.hasOwnProperty(ty);return t?r[ty]:null}function $L(r,n,t){if(r.length!==n.length)return!1;for(let l=0;l<r.length;l++){let h=r[l],i=n[l];if(t&&(h=t(h),i=t(i)),i!==h)return!1}return!0}function HL(r){return r.flat(Number.POSITIVE_INFINITY)}function Pw(r,n){r.forEach(t=>Array.isArray(t)?Pw(t,n):n(t))}function RM(r,n,t){n>=r.length?r.push(t):r.splice(n,0,t)}function ry(r,n){return n>=r.length-1?r.pop():r.splice(n,1)[0]}function GL(r,n){let t=[];for(let l=0;l<r;l++)t.push(n);return t}function qL(r,n,t,l){let h=r.length;if(h==n)r.push(t,l);else if(h===1)r.push(l,r[0]),r[0]=t;else{for(h--,r.push(r[h-1],r[h]);h>n;){let i=h-2;r[h]=r[i],h--}r[n]=t,r[n+1]=l}}function Ow(r,n,t){let l=$g(r,n);return l>=0?r[l|1]=t:(l=~l,qL(r,l,n,t)),l}function Rw(r,n){let t=$g(r,n);if(t>=0)return r[t|1]}function $g(r,n){return N$(r,n,1)}function N$(r,n,t){let l=0,h=r.length>>t;for(;h!==l;){let i=l+(h-l>>1),E=r[i<<t];if(n===E)return i<<t;E>n?h=i:l=i+1}return~(h<<t)}var xh={},ta=[],au=new Yt(""),kM=new Yt("",-1),FM=new Yt(""),ny=class{get(n,t=Jp){if(t===Jp){let h=UL("",-201);throw h.name="\u0275NotFound",h}return t}};function LM(r){return r[AM]||null}function lu(r){return r[IM]||null}function NM(r){return r[MM]||null}function WL(r){return r[DM]||null}function gc(r){return{\u0275providers:r}}function ZL(r){return gc([{provide:au,multi:!0,useValue:r}])}function XL(...r){return{\u0275providers:zM(!0,r),\u0275fromNgModule:!0}}function zM(r,...n){let t=[],l=new Set,h,i=E=>{t.push(E)};return Pw(n,E=>{let O=E;Tw(O,i,[],l)&&(h||=[],h.push(O))}),h!==void 0&&YL(h,i),t}function YL(r,n){for(let t=0;t<r.length;t++){let{ngModule:l,providers:h}=r[t];BM(h,i=>{n(i,l)})}}function Tw(r,n,t,l){if(r=Ts(r),!r)return!1;let h=null,i=fM(r),E=!i&&lu(r);if(!i&&!E){let N=r.ngModule;if(i=fM(N),i)h=N;else return!1}else{if(E&&!E.standalone)return!1;h=r}let O=l.has(h);if(E){if(O)return!1;if(l.add(h),E.dependencies){let N=typeof E.dependencies=="function"?E.dependencies():E.dependencies;for(let K of N)Tw(K,n,t,l)}}else if(i){if(i.imports!=null&&!O){l.add(h);let K;try{Pw(i.imports,le=>{Tw(le,n,t,l)&&(K||=[],K.push(le))})}finally{}K!==void 0&&YL(K,n)}if(!O){let K=_h(h)||(()=>new h);n({provide:h,useFactory:K,deps:ta},h),n({provide:FM,useValue:h,multi:!0},h),n({provide:au,useValue:()=>dn(h),multi:!0},h)}let N=i.providers;if(N!=null&&!O){let K=r;BM(N,le=>{n(le,K)})}}else return!1;return h!==r&&r.providers!==void 0}function BM(r,n){for(let t of r)TM(t)&&(t=t.\u0275providers),Array.isArray(t)?BM(t,n):n(t)}var z$=Ar({provide:String,useValue:Ar});function KL(r){return r!==null&&typeof r=="object"&&z$ in r}function B$(r){return!!(r&&r.useExisting)}function V$(r){return!!(r&&r.useFactory)}function tf(r){return typeof r=="function"}function QL(r){return!!r.useClass}var oy=new Yt(""),Ew={},NL={},pM;function Hg(){return pM===void 0&&(pM=new ny),pM}var Hr=class{},nf=class extends Hr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,t,l,h){super(),this.parent=t,this.source=l,this.scopes=h,yM(n,E=>this.processProvider(E)),this.records.set(kM,jg(void 0,this)),h.has("environment")&&this.records.set(Hr,jg(void 0,this));let i=this.records.get(oy);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(FM,ta,{self:!0}))}retrieve(n,t){let l=ef(t)||0;try{return this.get(n,Jp,l)}catch(h){if(Sg(h))return h;throw h}}destroy(){ey(this),this._destroyed=!0;let n=wi(null);try{for(let l of this._ngOnDestroyHooks)l.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let l of t)l()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),wi(n)}}onDestroy(n){return ey(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){ey(this);let t=iu(this),l=ea(void 0),h;try{return n()}finally{iu(t),ea(l)}}get(n,t=Jp,l){if(ey(this),n.hasOwnProperty(LL))return n[LL](this);let h=ef(l),i,E=iu(this),O=ea(void 0);try{if(!(h&4)){let K=this.records.get(n);if(K===void 0){let le=G$(n)&&iy(n);le&&this.injectableDefInScope(le)?K=jg(vM(n),Ew):K=null,this.records.set(n,K)}if(K!=null)return this.hydrate(n,K,h)}let N=h&2?Hg():this.parent;return t=h&8&&t===Jp?null:t,N.get(n,t)}catch(N){let K=P$(N);throw K===-200||K===-201?new sn(K,null):N}finally{ea(O),iu(E)}}resolveInjectorInitializers(){let n=wi(null),t=iu(this),l=ea(void 0),h;try{let i=this.get(au,ta,{self:!0});for(let E of i)E()}finally{iu(t),ea(l),wi(n)}}toString(){let n=[],t=this.records;for(let l of t.keys())n.push(md(l));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Ts(n);let t=tf(n)?n:Ts(n&&n.provide),l=j$(n);if(!tf(n)&&n.multi===!0){let h=this.records.get(t);h||(h=jg(void 0,Ew,!0),h.factory=()=>_M(h.multi),this.records.set(t,h)),t=n,h.multi.push(n)}this.records.set(t,l)}hydrate(n,t,l){let h=wi(null);try{if(t.value===NL)throw PM(md(n));return t.value===Ew&&(t.value=NL,t.value=t.factory(void 0,l)),typeof t.value=="object"&&t.value&&H$(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{wi(h)}}injectableDefInScope(n){if(!n.providedIn)return!1;let t=Ts(n.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){let t=this._onDestroyHooks.indexOf(n);t!==-1&&this._onDestroyHooks.splice(t,1)}};function vM(r){let n=iy(r),t=n!==null?n.factory:_h(r);if(t!==null)return t;if(r instanceof Yt)throw new sn(204,!1);if(r instanceof Function)return U$(r);throw new sn(204,!1)}function U$(r){if(r.length>0)throw new sn(204,!1);let t=M$(r);return t!==null?()=>t.factory(r):()=>new r}function j$(r){if(KL(r))return jg(void 0,r.useValue);{let n=VM(r);return jg(n,Ew)}}function VM(r,n,t){let l;if(tf(r)){let h=Ts(r);return _h(h)||vM(h)}else if(KL(r))l=()=>Ts(r.useValue);else if(V$(r))l=()=>r.useFactory(..._M(r.deps||[]));else if(B$(r))l=(h,i)=>dn(Ts(r.useExisting),i!==void 0&&i&8?8:void 0);else{let h=Ts(r&&(r.useClass||r.provide));if($$(r))l=()=>new h(..._M(r.deps));else return _h(h)||vM(h)}return l}function ey(r){if(r.destroyed)throw new sn(205,!1)}function jg(r,n,t=!1){return{factory:r,value:n,multi:t?[]:void 0}}function $$(r){return!!r.deps}function H$(r){return r!==null&&typeof r=="object"&&typeof r.ngOnDestroy=="function"}function G$(r){return typeof r=="function"||typeof r=="object"&&r.ngMetadataName==="InjectionToken"}function yM(r,n){for(let t of r)Array.isArray(t)?yM(t,n):t&&TM(t)?yM(t.\u0275providers,n):n(t)}function hs(r,n){let t;r instanceof nf?(ey(r),t=r):t=new gM(r);let l,h=iu(t),i=ea(void 0);try{return n()}finally{iu(h),ea(i)}}function JL(){return jL()!==void 0||z1()!=null}var _c=0,ni=1,Ci=2,Jo=3,Cl=4,na=5,of=6,Gg=7,Ao=8,_d=9,cu=10,Kr=11,qg=12,UM=13,sf=14,ia=15,bh=16,af=17,uu=18,sy=19,jM=20,fd=21,kw=22,ay=23,Za=24,lf=25,cf=26,uo=27,eN=1,$M=6,wh=7,ly=8,uf=9,wo=10;function du(r){return Array.isArray(r)&&typeof r[eN]=="object"}function vc(r){return Array.isArray(r)&&r[eN]===!0}function HM(r){return(r.flags&4)!==0}function Ch(r){return r.componentOffset>-1}function cy(r){return(r.flags&1)===1}function hu(r){return!!r.template}function Wg(r){return(r[Ci]&512)!==0}function df(r){return(r[Ci]&256)===256}var tN="svg",nN="math";function El(r){for(;Array.isArray(r);)r=r[_c];return r}function GM(r,n){return El(n[r])}function yc(r,n){return El(n[r.index])}function uy(r,n){return r.data[n]}function Fw(r,n){return r[n]}function qM(r,n,t,l){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),n[t]=l}function Sl(r,n){let t=n[r];return du(t)?t:t[_c]}function iN(r){return(r[Ci]&4)===4}function Lw(r){return(r[Ci]&128)===128}function rN(r){return vc(r[Jo])}function Tl(r,n){return n==null?null:r[n]}function WM(r){r[af]=0}function ZM(r){r[Ci]&1024||(r[Ci]|=1024,Lw(r)&&Zg(r))}function oN(r,n){for(;r>0;)n=n[sf],r--;return n}function dy(r){return!!(r[Ci]&9216||r[Za]?.dirty)}function Nw(r){r[cu].changeDetectionScheduler?.notify(8),r[Ci]&64&&(r[Ci]|=1024),dy(r)&&Zg(r)}function Zg(r){r[cu].changeDetectionScheduler?.notify(0);let n=vh(r);for(;n!==null&&!(n[Ci]&8192||(n[Ci]|=8192,!Lw(n)));)n=vh(n)}function XM(r,n){if(df(r))throw new sn(911,!1);r[fd]===null&&(r[fd]=[]),r[fd].push(n)}function sN(r,n){if(r[fd]===null)return;let t=r[fd].indexOf(n);t!==-1&&r[fd].splice(t,1)}function vh(r){let n=r[Jo];return vc(n)?n[Jo]:n}function YM(r){return r[Gg]??=[]}function KM(r){return r.cleanup??=[]}function aN(r,n,t,l){let h=YM(n);h.push(t),r.firstCreatePass&&KM(r).push(l,h.length-1)}var Vi={lFrame:yN(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var xM=!1;function lN(){return Vi.lFrame.elementDepthCount}function cN(){Vi.lFrame.elementDepthCount++}function QM(){Vi.lFrame.elementDepthCount--}function JM(){return Vi.bindingsEnabled}function eD(){return Vi.skipHydrationRootTNode!==null}function tD(r){return Vi.skipHydrationRootTNode===r}function nD(){Vi.skipHydrationRootTNode=null}function mi(){return Vi.lFrame.lView}function Co(){return Vi.lFrame.tView}function Pe(r){return Vi.lFrame.contextLView=r,r[Ao]}function Oe(r){return Vi.lFrame.contextLView=null,r}function Is(){let r=iD();for(;r!==null&&r.type===64;)r=r.parent;return r}function iD(){return Vi.lFrame.currentTNode}function uN(){let r=Vi.lFrame,n=r.currentTNode;return r.isParent?n:n.parent}function Xg(r,n){let t=Vi.lFrame;t.currentTNode=r,t.isParent=n}function rD(){return Vi.lFrame.isParent}function oD(){Vi.lFrame.isParent=!1}function dN(){return Vi.lFrame.contextLView}function sD(){return xM}function aD(r){let n=xM;return xM=r,n}function zw(){let r=Vi.lFrame,n=r.bindingRootIndex;return n===-1&&(n=r.bindingRootIndex=r.tView.bindingStartIndex),n}function hN(){return Vi.lFrame.bindingIndex}function pN(r){return Vi.lFrame.bindingIndex=r}function vd(){return Vi.lFrame.bindingIndex++}function Bw(r){let n=Vi.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+r,t}function fN(){return Vi.lFrame.inI18n}function mN(r,n){let t=Vi.lFrame;t.bindingIndex=t.bindingRootIndex=r,Vw(n)}function gN(){return Vi.lFrame.currentDirectiveIndex}function Vw(r){Vi.lFrame.currentDirectiveIndex=r}function _N(r){let n=Vi.lFrame.currentDirectiveIndex;return n===-1?null:r[n]}function lD(){return Vi.lFrame.currentQueryIndex}function Uw(r){Vi.lFrame.currentQueryIndex=r}function q$(r){let n=r[ni];return n.type===2?n.declTNode:n.type===1?r[na]:null}function cD(r,n,t){if(t&4){let h=n,i=r;for(;h=h.parent,h===null&&!(t&1);)if(h=q$(i),h===null||(i=i[sf],h.type&10))break;if(h===null)return!1;n=h,r=i}let l=Vi.lFrame=vN();return l.currentTNode=n,l.lView=r,!0}function jw(r){let n=vN(),t=r[ni];Vi.lFrame=n,n.currentTNode=t.firstChild,n.lView=r,n.tView=t,n.contextLView=r,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function vN(){let r=Vi.lFrame,n=r===null?null:r.child;return n===null?yN(r):n}function yN(r){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return r!==null&&(r.child=n),n}function xN(){let r=Vi.lFrame;return Vi.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}var uD=xN;function $w(){let r=xN();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function bN(r){return(Vi.lFrame.contextLView=oN(r,Vi.lFrame.contextLView))[Ao]}function pu(){return Vi.lFrame.selectedIndex}function Eh(r){Vi.lFrame.selectedIndex=r}function hy(){let r=Vi.lFrame;return uy(r.tView,r.selectedIndex)}function wN(){return Vi.lFrame.currentNamespace}var CN=!0;function Hw(){return CN}function Gw(r){CN=r}function bM(r,n=null,t=null,l){let h=dD(r,n,t,l);return h.resolveInjectorInitializers(),h}function dD(r,n=null,t=null,l,h=new Set){let i=[t||ta,XL(r)];return l=l||(typeof r=="object"?void 0:md(r)),new nf(i,n||Hg(),l||null,h)}var cr=class r{static THROW_IF_NOT_FOUND=Jp;static NULL=new ny;static create(n,t){if(Array.isArray(n))return bM({name:""},t,n,"");{let l=n.name??"";return bM({name:l},n.parent,n.providers,l)}}static \u0275prov=Ft({token:r,providedIn:"any",factory:()=>dn(kM)});static __NG_ELEMENT_ID__=-1},si=new Yt(""),Il=(()=>{class r{static __NG_ELEMENT_ID__=W$;static __NG_ENV_ID__=t=>t}return r})(),wM=class extends Il{_lView;constructor(n){super(),this._lView=n}get destroyed(){return df(this._lView)}onDestroy(n){let t=this._lView;return XM(t,n),()=>sN(t,n)}};function W$(){return new wM(mi())}var zs=class{_console=console;handleError(n){this._console.error("ERROR",n)}},ra=new Yt("",{providedIn:"root",factory:()=>{let r=Ve(Hr),n;return t=>{r.destroyed&&!n?setTimeout(()=>{throw t}):(n??=r.get(zs),n.handleError(t))}}}),EN={provide:au,useValue:()=>void Ve(zs),multi:!0},Z$=new Yt("",{providedIn:"root",factory:()=>{let r=Ve(si).defaultView;if(!r)return;let n=Ve(ra),t=i=>{n(i.reason),i.preventDefault()},l=i=>{i.error?n(i.error):n(new Error(i.message,{cause:i})),i.preventDefault()},h=()=>{r.addEventListener("unhandledrejection",t),r.addEventListener("error",l)};typeof Zone<"u"?Zone.root.run(h):h(),Ve(Il).onDestroy(()=>{r.removeEventListener("error",l),r.removeEventListener("unhandledrejection",t)})}});function hD(){return gc([ZL(()=>void Ve(Z$))])}function pD(r){return typeof r=="function"&&r[Ns]!==void 0}function oa(r,n){let[t,l,h]=KI(r,n?.equal),i=t,E=i[Ns];return i.set=l,i.update=h,i.asReadonly=SN.bind(i),i}function SN(){let r=this[Ns];if(r.readonlyFn===void 0){let n=()=>this();n[Ns]=r,r.readonlyFn=n}return r.readonlyFn}function fD(r){return pD(r)&&typeof r.set=="function"}var qw=(()=>{class r{view;node;constructor(t,l){this.view=t,this.node=l}static __NG_ELEMENT_ID__=X$}return r})();function X$(){return new qw(mi(),Is())}var gd=class{},Yg=new Yt("",{providedIn:"root",factory:()=>!1});var mD=new Yt(""),gD=new Yt(""),fu=(()=>{class r{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Qo(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Pi(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}return r})(),Ww=(()=>{class r{internalPendingTasks=Ve(fu);scheduler=Ve(gd);errorHandler=Ve(ra);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let l=this.add();t().catch(this.errorHandler).finally(l)}static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}return r})();function py(...r){}var _D=(()=>{class r{static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new CM})}return r})(),CM=class{dirtyEffectCount=0;queues=new Map;add(n){this.enqueue(n),this.schedule(n)}schedule(n){n.dirty&&this.dirtyEffectCount++}remove(n){let t=n.zone,l=this.queues.get(t);l.has(n)&&(l.delete(n),n.dirty&&this.dirtyEffectCount--)}enqueue(n){let t=n.zone;this.queues.has(t)||this.queues.set(t,new Set);let l=this.queues.get(t);l.has(n)||l.add(n)}flush(){for(;this.dirtyEffectCount>0;){let n=!1;for(let[t,l]of this.queues)t===null?n||=this.flushQueue(l):n||=t.run(()=>this.flushQueue(l));n||(this.dirtyEffectCount=0)}}flushQueue(n){let t=!1;for(let l of n)l.dirty&&(this.dirtyEffectCount--,t=!0,l.run());return t}};function wy(r){return{toString:r}.toString()}function iH(r){return typeof r=="function"}var iC=class{previousValue;currentValue;firstChange;constructor(n,t,l){this.previousValue=n,this.currentValue=t,this.firstChange=l}isFirstChange(){return this.firstChange}};function s3(r,n,t,l){n!==null?n.applyValueToInputSignal(n,l):r[t]=l}var Vr=(()=>{let r=()=>a3;return r.ngInherit=!0,r})();function a3(r){return r.type.prototype.ngOnChanges&&(r.setInput=oH),rH}function rH(){let r=c3(this),n=r?.current;if(n){let t=r.previous;if(t===xh)r.previous=n;else for(let l in n)t[l]=n[l];r.current=null,this.ngOnChanges(n)}}function oH(r,n,t,l,h){let i=this.declaredInputs[l],E=c3(r)||sH(r,{previous:xh,current:null}),O=E.current||(E.current={}),N=E.previous,K=N[i];O[i]=new iC(K&&K.currentValue,t,N===xh),s3(r,n,h,t)}var l3="__ngSimpleChanges__";function c3(r){return r[l3]||null}function sH(r,n){return r[l3]=n}var TN=[];var Rr=function(r,n=null,t){for(let l=0;l<TN.length;l++){let h=TN[l];h(r,n,t)}};function aH(r,n,t){let{ngOnChanges:l,ngOnInit:h,ngDoCheck:i}=n.type.prototype;if(l){let E=a3(n);(t.preOrderHooks??=[]).push(r,E),(t.preOrderCheckHooks??=[]).push(r,E)}h&&(t.preOrderHooks??=[]).push(0-r,h),i&&((t.preOrderHooks??=[]).push(r,i),(t.preOrderCheckHooks??=[]).push(r,i))}function u3(r,n){for(let t=n.directiveStart,l=n.directiveEnd;t<l;t++){let i=r.data[t].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:O,ngAfterViewInit:N,ngAfterViewChecked:K,ngOnDestroy:le}=i;E&&(r.contentHooks??=[]).push(-t,E),O&&((r.contentHooks??=[]).push(t,O),(r.contentCheckHooks??=[]).push(t,O)),N&&(r.viewHooks??=[]).push(-t,N),K&&((r.viewHooks??=[]).push(t,K),(r.viewCheckHooks??=[]).push(t,K)),le!=null&&(r.destroyHooks??=[]).push(t,le)}}function Jw(r,n,t){d3(r,n,3,t)}function eC(r,n,t,l){(r[Ci]&3)===t&&d3(r,n,t,l)}function vD(r,n){let t=r[Ci];(t&3)===n&&(t&=16383,t+=1,r[Ci]=t)}function d3(r,n,t,l){let h=l!==void 0?r[af]&65535:0,i=l??-1,E=n.length-1,O=0;for(let N=h;N<E;N++)if(typeof n[N+1]=="number"){if(O=n[N],l!=null&&O>=l)break}else n[N]<0&&(r[af]+=65536),(O<i||i==-1)&&(lH(r,t,n,N),r[af]=(r[af]&4294901760)+N+2),N++}function IN(r,n){Rr(4,r,n);let t=wi(null);try{n.call(r)}finally{wi(t),Rr(5,r,n)}}function lH(r,n,t,l){let h=t[l]<0,i=t[l+1],E=h?-t[l]:t[l],O=r[E];h?r[Ci]>>14<r[af]>>16&&(r[Ci]&3)===n&&(r[Ci]+=16384,IN(O,i)):IN(O,i)}var Qg=-1,pf=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,t,l,h){this.factory=n,this.name=h,this.canSeeViewProviders=t,this.injectImpl=l}};function cH(r){return(r.flags&8)!==0}function uH(r){return(r.flags&16)!==0}function dH(r,n,t){let l=0;for(;l<t.length;){let h=t[l];if(typeof h=="number"){if(h!==0)break;l++;let i=t[l++],E=t[l++],O=t[l++];r.setAttribute(n,E,O,i)}else{let i=h,E=t[++l];hH(i)?r.setProperty(n,i,E):r.setAttribute(n,i,E),l++}}return l}function h3(r){return r===3||r===4||r===6}function hH(r){return r.charCodeAt(0)===64}function Jg(r,n){if(!(n===null||n.length===0))if(r===null||r.length===0)r=n.slice();else{let t=-1;for(let l=0;l<n.length;l++){let h=n[l];typeof h=="number"?t=h:t===0||(t===-1||t===2?MN(r,t,h,null,n[++l]):MN(r,t,h,null,null))}}return r}function MN(r,n,t,l,h){let i=0,E=r.length;if(n===-1)E=-1;else for(;i<r.length;){let O=r[i++];if(typeof O=="number"){if(O===n){E=-1;break}else if(O>n){E=i-1;break}}}for(;i<r.length;){let O=r[i];if(typeof O=="number")break;if(O===t){h!==null&&(r[i+1]=h);return}i++,h!==null&&i++}E!==-1&&(r.splice(E,0,n),i=E+1),r.splice(i++,0,t),h!==null&&r.splice(i++,0,h)}function p3(r){return r!==Qg}function rC(r){return r&32767}function pH(r){return r>>16}function oC(r,n){let t=pH(r),l=n;for(;t>0;)l=l[sf],t--;return l}var AD=!0;function sC(r){let n=AD;return AD=r,n}var fH=256,f3=fH-1,m3=5,mH=0,mu={};function gH(r,n,t){let l;typeof t=="string"?l=t.charCodeAt(0)||0:t.hasOwnProperty(rf)&&(l=t[rf]),l==null&&(l=t[rf]=mH++);let h=l&f3,i=1<<h;n.data[r+(h>>m3)]|=i}function aC(r,n){let t=g3(r,n);if(t!==-1)return t;let l=n[ni];l.firstCreatePass&&(r.injectorIndex=n.length,yD(l.data,r),yD(n,null),yD(l.blueprint,null));let h=mA(r,n),i=r.injectorIndex;if(p3(h)){let E=rC(h),O=oC(h,n),N=O[ni].data;for(let K=0;K<8;K++)n[i+K]=O[E+K]|N[E+K]}return n[i+8]=h,i}function yD(r,n){r.push(0,0,0,0,0,0,0,0,n)}function g3(r,n){return r.injectorIndex===-1||r.parent&&r.parent.injectorIndex===r.injectorIndex||n[r.injectorIndex+8]===null?-1:r.injectorIndex}function mA(r,n){if(r.parent&&r.parent.injectorIndex!==-1)return r.parent.injectorIndex;let t=0,l=null,h=n;for(;h!==null;){if(l=b3(h),l===null)return Qg;if(t++,h=h[sf],l.injectorIndex!==-1)return l.injectorIndex|t<<16}return Qg}function PD(r,n,t){gH(r,n,t)}function _H(r,n){if(n==="class")return r.classes;if(n==="style")return r.styles;let t=r.attrs;if(t){let l=t.length,h=0;for(;h<l;){let i=t[h];if(h3(i))break;if(i===0)h=h+2;else if(typeof i=="number")for(h++;h<l&&typeof t[h]=="string";)h++;else{if(i===n)return t[h+1];h=h+2}}}return null}function _3(r,n,t){if(t&8||r!==void 0)return r;Aw(n,"NodeInjector")}function v3(r,n,t,l){if(t&8&&l===void 0&&(l=null),(t&3)===0){let h=r[_d],i=ea(void 0);try{return h?h.get(n,l,t&8):OM(n,l,t&8)}finally{ea(i)}}return _3(l,n,t)}function y3(r,n,t,l=0,h){if(r!==null){if(n[Ci]&2048&&!(l&2)){let E=bH(r,n,t,l,mu);if(E!==mu)return E}let i=x3(r,n,t,l,mu);if(i!==mu)return i}return v3(n,t,l,h)}function x3(r,n,t,l,h){let i=yH(t);if(typeof i=="function"){if(!cD(n,r,l))return l&1?_3(h,t,l):v3(n,t,l,h);try{let E;if(E=i(l),E==null&&!(l&8))Aw(t);else return E}finally{uD()}}else if(typeof i=="number"){let E=null,O=g3(r,n),N=Qg,K=l&1?n[ia][na]:null;for((O===-1||l&4)&&(N=O===-1?mA(r,n):n[O+8],N===Qg||!AN(l,!1)?O=-1:(E=n[ni],O=rC(N),n=oC(N,n)));O!==-1;){let le=n[ni];if(DN(i,O,le.data)){let De=vH(O,n,t,E,l,K);if(De!==mu)return De}N=n[O+8],N!==Qg&&AN(l,n[ni].data[O+8]===K)&&DN(i,O,n)?(E=le,O=rC(N),n=oC(N,n)):O=-1}}return h}function vH(r,n,t,l,h,i){let E=n[ni],O=E.data[r+8],N=l==null?Ch(O)&&AD:l!=E&&(O.type&3)!==0,K=h&1&&i===O,le=tC(O,E,t,N,K);return le!==null?gy(n,E,le,O,h):mu}function tC(r,n,t,l,h){let i=r.providerIndexes,E=n.data,O=i&1048575,N=r.directiveStart,K=r.directiveEnd,le=i>>20,De=l?O:O+le,Qe=h?O+le:K;for(let Fe=De;Fe<Qe;Fe++){let gt=E[Fe];if(Fe<N&&t===gt||Fe>=N&&gt.type===t)return Fe}if(h){let Fe=E[N];if(Fe&&hu(Fe)&&Fe.type===t)return N}return null}function gy(r,n,t,l,h){let i=r[t],E=n.data;if(i instanceof pf){let O=i;if(O.resolving){let Fe=BL(E[t]);throw PM(Fe)}let N=sC(O.canSeeViewProviders);O.resolving=!0;let K=E[t].type||E[t],le,De=O.injectImpl?ea(O.injectImpl):null,Qe=cD(r,l,0);try{i=r[t]=O.factory(void 0,h,E,r,l),n.firstCreatePass&&t>=l.directiveStart&&aH(t,E[t],n)}finally{De!==null&&ea(De),sC(N),O.resolving=!1,uD()}}return i}function yH(r){if(typeof r=="string")return r.charCodeAt(0)||0;let n=r.hasOwnProperty(rf)?r[rf]:void 0;return typeof n=="number"?n>=0?n&f3:xH:n}function DN(r,n,t){let l=1<<r;return!!(t[n+(r>>m3)]&l)}function AN(r,n){return!(r&2)&&!(r&1&&n)}var hf=class{_tNode;_lView;constructor(n,t){this._tNode=n,this._lView=t}get(n,t,l){return y3(this._tNode,this._lView,n,ef(l),t)}};function xH(){return new hf(Is(),mi())}function Cc(r){return wy(()=>{let n=r.prototype.constructor,t=n[ty]||OD(n),l=Object.prototype,h=Object.getPrototypeOf(r.prototype).constructor;for(;h&&h!==l;){let i=h[ty]||OD(h);if(i&&i!==t)return i;h=Object.getPrototypeOf(h)}return i=>new i})}function OD(r){return EM(r)?()=>{let n=OD(Ts(r));return n&&n()}:_h(r)}function bH(r,n,t,l,h){let i=r,E=n;for(;i!==null&&E!==null&&E[Ci]&2048&&!Wg(E);){let O=x3(i,E,t,l|2,mu);if(O!==mu)return O;let N=i.parent;if(!N){let K=E[jM];if(K){let le=K.get(t,mu,l);if(le!==mu)return le}N=b3(E),E=E[sf]}i=N}return h}function b3(r){let n=r[ni],t=n.type;return t===2?n.declTNode:t===1?r[na]:null}function Cy(r){return _H(Is(),r)}function wH(){return i_(Is(),mi())}function i_(r,n){return new ir(yc(r,n))}var ir=(()=>{class r{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=wH}return r})();function CH(r){return r instanceof ir?r.nativeElement:r}function EH(){return this._results[Symbol.iterator]()}var lC=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new li}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;let l=HL(n);(this._changesDetected=!$L(this._results,l,t))&&(this._results=l,this.length=l.length,this.last=l[this.length-1],this.first=l[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=EH};function w3(r){return(r.flags&128)===128}var gA=(function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r})(gA||{}),C3=new Map,SH=0;function TH(){return SH++}function IH(r){C3.set(r[sy],r)}function RD(r){C3.delete(r[sy])}var PN="__ngContext__";function e_(r,n){du(n)?(r[PN]=n[sy],IH(n)):r[PN]=n}function E3(r){return T3(r[qg])}function S3(r){return T3(r[Cl])}function T3(r){for(;r!==null&&!vc(r);)r=r[Cl];return r}var kD;function _A(r){kD=r}function I3(){if(kD!==void 0)return kD;if(typeof document<"u")return document;throw new sn(210,!1)}var r_=new Yt("",{providedIn:"root",factory:()=>MH}),MH="ng",CC=new Yt(""),gf=new Yt("",{providedIn:"platform",factory:()=>"unknown"});var Ey=new Yt(""),o_=new Yt("",{providedIn:"root",factory:()=>I3().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var DH="h",AH="b";var M3="r";var D3="di";var A3=!1,P3=new Yt("",{providedIn:"root",factory:()=>A3});var EC=new Yt("");var PH=(r,n,t,l)=>{};function OH(r,n,t,l){PH(r,n,t,l)}function SC(r){return(r.flags&32)===32}var RH=()=>null;function O3(r,n,t=!1){return RH(r,n,t)}function R3(r,n){let t=r.contentQueries;if(t!==null){let l=wi(null);try{for(let h=0;h<t.length;h+=2){let i=t[h],E=t[h+1];if(E!==-1){let O=r.data[E];Uw(i),O.contentQueries(2,n[E],E)}}}finally{wi(l)}}}function FD(r,n,t){Uw(0);let l=wi(null);try{n(r,t)}finally{wi(l)}}function k3(r,n,t){if(HM(n)){let l=wi(null);try{let h=n.directiveStart,i=n.directiveEnd;for(let E=h;E<i;E++){let O=r.data[E];if(O.contentQueries){let N=t[E];O.contentQueries(1,N,E)}}}finally{wi(l)}}}var yd=(function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r})(yd||{});var Zw;function kH(){if(Zw===void 0&&(Zw=null,wl.trustedTypes))try{Zw=wl.trustedTypes.createPolicy("angular",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Zw}function TC(r){return kH()?.createHTML(r)||r}var Xw;function FH(){if(Xw===void 0&&(Xw=null,wl.trustedTypes))try{Xw=wl.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Xw}function ON(r){return FH()?.createScriptURL(r)||r}var xd=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Iw})`}},LD=class extends xd{getTypeName(){return"HTML"}},ND=class extends xd{getTypeName(){return"Style"}},zD=class extends xd{getTypeName(){return"Script"}},BD=class extends xd{getTypeName(){return"URL"}},VD=class extends xd{getTypeName(){return"ResourceURL"}};function Ml(r){return r instanceof xd?r.changingThisBreaksApplicationSecurity:r}function bd(r,n){let t=F3(r);if(t!=null&&t!==n){if(t==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${Iw})`)}return t===n}function F3(r){return r instanceof xd&&r.getTypeName()||null}function vA(r){return new LD(r)}function yA(r){return new ND(r)}function xA(r){return new zD(r)}function bA(r){return new BD(r)}function wA(r){return new VD(r)}function LH(r){let n=new jD(r);return NH()?new UD(n):n}var UD=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let t=new window.DOMParser().parseFromString(TC(n),"text/html").body;return t===null?this.inertDocumentHelper.getInertBodyElement(n):(t.firstChild?.remove(),t)}catch{return null}}},jD=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let t=this.inertDocument.createElement("template");return t.innerHTML=TC(n),t}};function NH(){try{return!!new window.DOMParser().parseFromString(TC(""),"text/html")}catch{return!1}}var zH=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Sy(r){return r=String(r),r.match(zH)?r:"unsafe:"+r}function wd(r){let n={};for(let t of r.split(","))n[t]=!0;return n}function Ty(...r){let n={};for(let t of r)for(let l in t)t.hasOwnProperty(l)&&(n[l]=!0);return n}var L3=wd("area,br,col,hr,img,wbr"),N3=wd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),z3=wd("rp,rt"),BH=Ty(z3,N3),VH=Ty(N3,wd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),UH=Ty(z3,wd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),RN=Ty(L3,VH,UH,BH),B3=wd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),jH=wd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),$H=wd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),HH=Ty(B3,jH,$H),GH=wd("script,style,template"),$D=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let t=n.firstChild,l=!0,h=[];for(;t;){if(t.nodeType===Node.ELEMENT_NODE?l=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,l&&t.firstChild){h.push(t),t=ZH(t);continue}for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let i=WH(t);if(i){t=i;break}t=h.pop()}}return this.buf.join("")}startElement(n){let t=kN(n).toLowerCase();if(!RN.hasOwnProperty(t))return this.sanitizedSomething=!0,!GH.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);let l=n.attributes;for(let h=0;h<l.length;h++){let i=l.item(h),E=i.name,O=E.toLowerCase();if(!HH.hasOwnProperty(O)){this.sanitizedSomething=!0;continue}let N=i.value;B3[O]&&(N=Sy(N)),this.buf.push(" ",E,'="',FN(N),'"')}return this.buf.push(">"),!0}endElement(n){let t=kN(n).toLowerCase();RN.hasOwnProperty(t)&&!L3.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(n){this.buf.push(FN(n))}};function qH(r,n){return(r.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function WH(r){let n=r.nextSibling;if(n&&r!==n.previousSibling)throw V3(n);return n}function ZH(r){let n=r.firstChild;if(n&&qH(r,n))throw V3(n);return n}function kN(r){let n=r.nodeName;return typeof n=="string"?n:"FORM"}function V3(r){return new Error(`Failed to sanitize html because the element is clobbered: ${r.outerHTML}`)}var XH=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,YH=/([^\#-~ |!])/g;function FN(r){return r.replace(/&/g,"&amp;").replace(XH,function(n){let t=n.charCodeAt(0),l=n.charCodeAt(1);return"&#"+((t-55296)*1024+(l-56320)+65536)+";"}).replace(YH,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Yw;function CA(r,n){let t=null;try{Yw=Yw||LH(r);let l=n?String(n):"";t=Yw.getInertBodyElement(l);let h=5,i=l;do{if(h===0)throw new Error("Failed to sanitize html because the input is unstable");h--,l=i,i=t.innerHTML,t=Yw.getInertBodyElement(l)}while(l!==i);let O=new $D().sanitizeChildren(LN(t)||t);return TC(O)}finally{if(t){let l=LN(t)||t;for(;l.firstChild;)l.firstChild.remove()}}}function LN(r){return"content"in r&&KH(r)?r.content:null}function KH(r){return r.nodeType===Node.ELEMENT_NODE&&r.nodeName==="TEMPLATE"}function QH(r,n){return r.createText(n)}function JH(r,n,t){r.setValue(n,t)}function U3(r,n,t){return r.createElement(n,t)}function cC(r,n,t,l,h){r.insertBefore(n,t,l,h)}function j3(r,n,t){r.appendChild(n,t)}function NN(r,n,t,l,h){l!==null?cC(r,n,t,l,h):j3(r,n,t)}function $3(r,n,t,l){r.removeChild(null,n,t,l)}function eG(r,n,t){r.setAttribute(n,"style",t)}function tG(r,n,t){t===""?r.removeAttribute(n,"class"):r.setAttribute(n,"class",t)}function H3(r,n,t){let{mergedAttrs:l,classes:h,styles:i}=t;l!==null&&dH(r,n,l),h!==null&&tG(r,n,h),i!==null&&eG(r,n,i)}var Ms=(function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r})(Ms||{});function Gr(r){let n=q3();return n?n.sanitize(Ms.URL,r)||"":bd(r,"URL")?Ml(r):Sy(yh(r))}function G3(r){let n=q3();if(n)return ON(n.sanitize(Ms.RESOURCE_URL,r)||"");if(bd(r,"ResourceURL"))return ON(Ml(r));throw new sn(904,!1)}function nG(r,n){return n==="src"&&(r==="embed"||r==="frame"||r==="iframe"||r==="media"||r==="script")||n==="href"&&(r==="base"||r==="link")?G3:Gr}function EA(r,n,t){return nG(n,t)(r)}function q3(){let r=mi();return r&&r[cu].sanitizer}function SA(r){return r.ownerDocument.defaultView}function TA(r){return r.ownerDocument}function W3(r){return r instanceof Function?r():r}function iG(r,n,t){let l=r.length;for(;;){let h=r.indexOf(n,t);if(h===-1)return h;if(h===0||r.charCodeAt(h-1)<=32){let i=n.length;if(h+i===l||r.charCodeAt(h+i)<=32)return h}t=h+1}}var Z3="ng-template";function rG(r,n,t,l){let h=0;if(l){for(;h<n.length&&typeof n[h]=="string";h+=2)if(n[h]==="class"&&iG(n[h+1].toLowerCase(),t,0)!==-1)return!0}else if(IA(r))return!1;if(h=n.indexOf(1,h),h>-1){let i;for(;++h<n.length&&typeof(i=n[h])=="string";)if(i.toLowerCase()===t)return!0}return!1}function IA(r){return r.type===4&&r.value!==Z3}function oG(r,n,t){let l=r.type===4&&!t?Z3:r.value;return n===l}function sG(r,n,t){let l=4,h=r.attrs,i=h!==null?cG(h):0,E=!1;for(let O=0;O<n.length;O++){let N=n[O];if(typeof N=="number"){if(!E&&!xc(l)&&!xc(N))return!1;if(E&&xc(N))continue;E=!1,l=N|l&1;continue}if(!E)if(l&4){if(l=2|l&1,N!==""&&!oG(r,N,t)||N===""&&n.length===1){if(xc(l))return!1;E=!0}}else if(l&8){if(h===null||!rG(r,h,N,t)){if(xc(l))return!1;E=!0}}else{let K=n[++O],le=aG(N,h,IA(r),t);if(le===-1){if(xc(l))return!1;E=!0;continue}if(K!==""){let De;if(le>i?De="":De=h[le+1].toLowerCase(),l&2&&K!==De){if(xc(l))return!1;E=!0}}}}return xc(l)||E}function xc(r){return(r&1)===0}function aG(r,n,t,l){if(n===null)return-1;let h=0;if(l||!t){let i=!1;for(;h<n.length;){let E=n[h];if(E===r)return h;if(E===3||E===6)i=!0;else if(E===1||E===2){let O=n[++h];for(;typeof O=="string";)O=n[++h];continue}else{if(E===4)break;if(E===0){h+=4;continue}}h+=i?1:2}return-1}else return uG(n,r)}function X3(r,n,t=!1){for(let l=0;l<n.length;l++)if(sG(r,n[l],t))return!0;return!1}function lG(r){let n=r.attrs;if(n!=null){let t=n.indexOf(5);if((t&1)===0)return n[t+1]}return null}function cG(r){for(let n=0;n<r.length;n++){let t=r[n];if(h3(t))return n}return r.length}function uG(r,n){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){let l=r[t];if(typeof l=="number")return-1;if(l===n)return t;t++}return-1}function dG(r,n){e:for(let t=0;t<n.length;t++){let l=n[t];if(r.length===l.length){for(let h=0;h<r.length;h++)if(r[h]!==l[h])continue e;return!0}}return!1}function zN(r,n){return r?":not("+n.trim()+")":n}function hG(r){let n=r[0],t=1,l=2,h="",i=!1;for(;t<r.length;){let E=r[t];if(typeof E=="string")if(l&2){let O=r[++t];h+="["+E+(O.length>0?'="'+O+'"':"")+"]"}else l&8?h+="."+E:l&4&&(h+=" "+E);else h!==""&&!xc(E)&&(n+=zN(i,h),h=""),l=E,i=i||!xc(l);t++}return h!==""&&(n+=zN(i,h)),n}function pG(r){return r.map(hG).join(",")}function fG(r){let n=[],t=[],l=1,h=2;for(;l<r.length;){let i=r[l];if(typeof i=="string")h===2?i!==""&&n.push(i,r[++l]):h===8&&t.push(i);else{if(!xc(h))break;h=i}l++}return t.length&&n.push(1,...t),n}var Bs={};function MA(r,n,t,l,h,i,E,O,N,K,le){let De=uo+l,Qe=De+h,Fe=mG(De,Qe),gt=typeof K=="function"?K():K;return Fe[ni]={type:r,blueprint:Fe,template:t,queries:null,viewQuery:O,declTNode:n,data:Fe.slice().fill(null,De),bindingStartIndex:De,expandoStartIndex:Qe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof E=="function"?E():E,firstChild:null,schemas:N,consts:gt,incompleteFirstPass:!1,ssrId:le}}function mG(r,n){let t=[];for(let l=0;l<n;l++)t.push(l<r?null:Bs);return t}function gG(r){let n=r.tView;return n===null||n.incompleteFirstPass?r.tView=MA(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):n}function DA(r,n,t,l,h,i,E,O,N,K,le){let De=n.blueprint.slice();return De[_c]=h,De[Ci]=l|4|128|8|64|1024,(K!==null||r&&r[Ci]&2048)&&(De[Ci]|=2048),WM(De),De[Jo]=De[sf]=r,De[Ao]=t,De[cu]=E||r&&r[cu],De[Kr]=O||r&&r[Kr],De[_d]=N||r&&r[_d]||null,De[na]=i,De[sy]=TH(),De[of]=le,De[jM]=K,De[ia]=n.type==2?r[ia]:De,De}function _G(r,n,t){let l=yc(n,r),h=gG(t),i=r[cu].rendererFactory,E=AA(r,DA(r,h,null,Y3(t),l,n,null,i.createRenderer(l,t),null,null,null));return r[n.index]=E}function Y3(r){let n=16;return r.signals?n=4096:r.onPush&&(n=64),n}function K3(r,n,t,l){if(t===0)return-1;let h=n.length;for(let i=0;i<t;i++)n.push(l),r.blueprint.push(l),r.data.push(null);return h}function AA(r,n){return r[qg]?r[UM][Cl]=n:r[qg]=n,r[UM]=n,n}function ne(r=1){Q3(Co(),mi(),pu()+r,!1)}function Q3(r,n,t,l){if(!l)if((n[Ci]&3)===3){let i=r.preOrderCheckHooks;i!==null&&Jw(n,i,t)}else{let i=r.preOrderHooks;i!==null&&eC(n,i,0,t)}Eh(t)}var IC=(function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r})(IC||{});function HD(r,n,t,l){let h=wi(null);try{let[i,E,O]=r.inputs[t],N=null;(E&IC.SignalBased)!==0&&(N=n[i][Ns]),N!==null&&N.transformFn!==void 0?l=N.transformFn(l):O!==null&&(l=O.call(n,l)),r.setInput!==null?r.setInput(n,N,l,t,i):s3(n,N,i,l)}finally{wi(h)}}var wc=(function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r})(wc||{}),vG;function PA(r,n){return vG(r,n)}var ff=new Set,MC=(function(r){return r[r.CHANGE_DETECTION=0]="CHANGE_DETECTION",r[r.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",r})(MC||{}),_f=new Yt(""),BN=new Set;function Ec(r){BN.has(r)||(BN.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}var J3=!1,GD=class extends li{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,JL()&&(this.destroyRef=Ve(Il,{optional:!0})??void 0,this.pendingTasks=Ve(fu,{optional:!0})??void 0)}emit(n){let t=wi(null);try{super.next(n)}finally{wi(t)}}subscribe(n,t,l){let h=n,i=t||(()=>null),E=l;if(n&&typeof n=="object"){let N=n;h=N.next?.bind(N),i=N.error?.bind(N),E=N.complete?.bind(N)}this.__isAsync&&(i=this.wrapInTimeout(i),h&&(h=this.wrapInTimeout(h)),E&&(E=this.wrapInTimeout(E)));let O=super.subscribe({next:h,error:i,complete:E});return n instanceof Br&&n.add(O),O}wrapInTimeout(n){return t=>{let l=this.pendingTasks?.add();setTimeout(()=>{try{n(t)}finally{l!==void 0&&this.pendingTasks?.remove(l)}})}}},Zt=GD;function ez(r){let n,t;function l(){r=py;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{r(),l()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{r(),l()})),()=>l()}function VN(r){return queueMicrotask(()=>r()),()=>{r=py}}var OA="isAngularZone",uC=OA+"_ID",yG=0,yi=class r{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Zt(!1);onMicrotaskEmpty=new Zt(!1);onStable=new Zt(!1);onError=new Zt(!1);constructor(n){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:h=!1,scheduleInRootZone:i=J3}=n;if(typeof Zone>"u")throw new sn(908,!1);Zone.assertZonePatched();let E=this;E._nesting=0,E._outer=E._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(E._inner=E._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(E._inner=E._inner.fork(Zone.longStackTraceZoneSpec)),E.shouldCoalesceEventChangeDetection=!h&&l,E.shouldCoalesceRunChangeDetection=h,E.callbackScheduled=!1,E.scheduleInRootZone=i,wG(E)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(OA)===!0}static assertInAngularZone(){if(!r.isInAngularZone())throw new sn(909,!1)}static assertNotInAngularZone(){if(r.isInAngularZone())throw new sn(909,!1)}run(n,t,l){return this._inner.run(n,t,l)}runTask(n,t,l,h){let i=this._inner,E=i.scheduleEventTask("NgZoneEvent: "+h,n,xG,py,py);try{return i.runTask(E,t,l)}finally{i.cancelTask(E)}}runGuarded(n,t,l){return this._inner.runGuarded(n,t,l)}runOutsideAngular(n){return this._outer.run(n)}},xG={};function RA(r){if(r._nesting==0&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function bG(r){if(r.isCheckStableRunning||r.callbackScheduled)return;r.callbackScheduled=!0;function n(){ez(()=>{r.callbackScheduled=!1,qD(r),r.isCheckStableRunning=!0,RA(r),r.isCheckStableRunning=!1})}r.scheduleInRootZone?Zone.root.run(()=>{n()}):r._outer.run(()=>{n()}),qD(r)}function wG(r){let n=()=>{bG(r)},t=yG++;r._inner=r._inner.fork({name:"angular",properties:{[OA]:!0,[uC]:t,[uC+t]:!0},onInvokeTask:(l,h,i,E,O,N)=>{if(CG(N))return l.invokeTask(i,E,O,N);try{return UN(r),l.invokeTask(i,E,O,N)}finally{(r.shouldCoalesceEventChangeDetection&&E.type==="eventTask"||r.shouldCoalesceRunChangeDetection)&&n(),jN(r)}},onInvoke:(l,h,i,E,O,N,K)=>{try{return UN(r),l.invoke(i,E,O,N,K)}finally{r.shouldCoalesceRunChangeDetection&&!r.callbackScheduled&&!EG(N)&&n(),jN(r)}},onHasTask:(l,h,i,E)=>{l.hasTask(i,E),h===i&&(E.change=="microTask"?(r._hasPendingMicrotasks=E.microTask,qD(r),RA(r)):E.change=="macroTask"&&(r.hasPendingMacrotasks=E.macroTask))},onHandleError:(l,h,i,E)=>(l.handleError(i,E),r.runOutsideAngular(()=>r.onError.emit(E)),!1)})}function qD(r){r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&r.callbackScheduled===!0?r.hasPendingMicrotasks=!0:r.hasPendingMicrotasks=!1}function UN(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function jN(r){r._nesting--,RA(r)}var dC=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Zt;onMicrotaskEmpty=new Zt;onStable=new Zt;onError=new Zt;run(n,t,l){return n.apply(t,l)}runGuarded(n,t,l){return n.apply(t,l)}runOutsideAngular(n){return n()}runTask(n,t,l,h){return n.apply(t,l)}};function CG(r){return tz(r,"__ignore_ng_zone__")}function EG(r){return tz(r,"__scheduler_tick__")}function tz(r,n){return!Array.isArray(r)||r.length!==1?!1:r[0]?.data?.[n]===!0}var kA=(()=>{class r{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}return r})(),nz=[0,1,2,3],iz=(()=>{class r{ngZone=Ve(yi);scheduler=Ve(gd);errorHandler=Ve(zs,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Ve(_f,{optional:!0})}execute(){let t=this.sequences.size>0;t&&Rr(16),this.executing=!0;for(let l of nz)for(let h of this.sequences)if(!(h.erroredOrDestroyed||!h.hooks[l]))try{h.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let i=h.hooks[l];return i(h.pipelinedValue)},h.snapshot))}catch(i){h.erroredOrDestroyed=!0,this.errorHandler?.handleError(i)}this.executing=!1;for(let l of this.sequences)l.afterRun(),l.once&&(this.sequences.delete(l),l.destroy());for(let l of this.deferredRegistrations)this.sequences.add(l);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),t&&Rr(17)}register(t){let{view:l}=t;l!==void 0?((l[lf]??=[]).push(t),Zg(l),l[Ci]|=8192):this.executing?this.deferredRegistrations.add(t):this.addSequence(t)}addSequence(t){this.sequences.add(t),this.scheduler.notify(7)}unregister(t){this.executing&&this.sequences.has(t)?(t.erroredOrDestroyed=!0,t.pipelinedValue=void 0,t.once=!0):(this.sequences.delete(t),this.deferredRegistrations.delete(t))}maybeTrace(t,l){return l?l.run(MC.AFTER_NEXT_RENDER,t):t()}static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}return r})(),hC=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(n,t,l,h,i,E=null){this.impl=n,this.hooks=t,this.view=l,this.once=h,this.snapshot=E,this.unregisterOnDestroy=i?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let n=this.view?.[lf];n&&(this.view[lf]=n.filter(t=>t!==this))}};function Dl(r,n){let t=n?.injector??Ve(cr);return Ec("NgAfterNextRender"),TG(r,t,n,!0)}function SG(r){return r instanceof Function?[void 0,void 0,r,void 0]:[r.earlyRead,r.write,r.mixedReadWrite,r.read]}function TG(r,n,t,l){let h=n.get(kA);h.impl??=n.get(iz);let i=n.get(_f,null,{optional:!0}),E=t?.manualCleanup!==!0?n.get(Il):null,O=n.get(qw,null,{optional:!0}),N=new hC(h.impl,SG(r),O?.view,l,E,i?.snapshot(null));return h.impl.register(N),N}var rz=new Yt("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function oz(r,n,t){let l=r.get(rz);if(Array.isArray(n))for(let h of n)l.queue.add(h),t?.detachedLeaveAnimationFns?.push(h);else l.queue.add(n),t?.detachedLeaveAnimationFns?.push(n);l.scheduler&&l.scheduler(r)}function IG(r,n){let t=r.get(rz);if(n.detachedLeaveAnimationFns){for(let l of n.detachedLeaveAnimationFns)t.queue.delete(l);n.detachedLeaveAnimationFns=void 0}}function MG(r,n){for(let[t,l]of n)oz(r,l.animateFns)}function $N(r,n,t,l){let h=r?.[cf]?.enter;n!==null&&h&&h.has(t.index)&&MG(l,h)}function Kg(r,n,t,l,h,i,E,O){if(h!=null){let N,K=!1;vc(h)?N=h:du(h)&&(K=!0,h=h[_c]);let le=El(h);r===0&&l!==null?($N(O,l,i,t),E==null?j3(n,l,le):cC(n,l,le,E||null,!0)):r===1&&l!==null?($N(O,l,i,t),cC(n,l,le,E||null,!0)):r===2?HN(O,i,t,De=>{$3(n,le,K,De)}):r===3&&HN(O,i,t,()=>{n.destroyNode(le)}),N!=null&&BG(n,r,t,N,i,l,E)}}function DG(r,n){sz(r,n),n[_c]=null,n[na]=null}function AG(r,n,t,l,h,i){l[_c]=h,l[na]=n,AC(r,l,t,1,h,i)}function sz(r,n){n[cu].changeDetectionScheduler?.notify(9),AC(r,n,n[Kr],2,null,null)}function PG(r){let n=r[qg];if(!n)return xD(r[ni],r);for(;n;){let t=null;if(du(n))t=n[qg];else{let l=n[wo];l&&(t=l)}if(!t){for(;n&&!n[Cl]&&n!==r;)du(n)&&xD(n[ni],n),n=n[Jo];n===null&&(n=r),du(n)&&xD(n[ni],n),t=n&&n[Cl]}n=t}}function FA(r,n){let t=r[uf],l=t.indexOf(n);t.splice(l,1)}function DC(r,n){if(df(n))return;let t=n[Kr];t.destroyNode&&AC(r,n,t,3,null,null),PG(n)}function xD(r,n){if(df(n))return;let t=wi(null);try{n[Ci]&=-129,n[Ci]|=256,n[Za]&&W0(n[Za]),kG(r,n),RG(r,n),n[ni].type===1&&n[Kr].destroy();let l=n[bh];if(l!==null&&vc(n[Jo])){l!==n[Jo]&&FA(l,n);let h=n[uu];h!==null&&h.detachView(r)}RD(n)}finally{wi(t)}}function HN(r,n,t,l){let h=r?.[cf];if(h==null||h.leave==null||!h.leave.has(n.index))return l(!1);r&&ff.add(r),oz(t,()=>{if(h.leave&&h.leave.has(n.index)){let E=h.leave.get(n.index),O=[];if(E){for(let N=0;N<E.animateFns.length;N++){let K=E.animateFns[N],{promise:le}=K();O.push(le)}h.detachedLeaveAnimationFns=void 0}h.running=Promise.allSettled(O),OG(r,l)}else r&&ff.delete(r),l(!1)},h)}function OG(r,n){let t=r[cf]?.running;if(t){t.then(()=>{r[cf].running=void 0,ff.delete(r),n(!0)});return}n(!1)}function RG(r,n){let t=r.cleanup,l=n[Gg];if(t!==null)for(let E=0;E<t.length-1;E+=2)if(typeof t[E]=="string"){let O=t[E+3];O>=0?l[O]():l[-O].unsubscribe(),E+=2}else{let O=l[t[E+1]];t[E].call(O)}l!==null&&(n[Gg]=null);let h=n[fd];if(h!==null){n[fd]=null;for(let E=0;E<h.length;E++){let O=h[E];O()}}let i=n[ay];if(i!==null){n[ay]=null;for(let E of i)E.destroy()}}function kG(r,n){let t;if(r!=null&&(t=r.destroyHooks)!=null)for(let l=0;l<t.length;l+=2){let h=n[t[l]];if(!(h instanceof pf)){let i=t[l+1];if(Array.isArray(i))for(let E=0;E<i.length;E+=2){let O=h[i[E]],N=i[E+1];Rr(4,O,N);try{N.call(O)}finally{Rr(5,O,N)}}else{Rr(4,h,i);try{i.call(h)}finally{Rr(5,h,i)}}}}}function az(r,n,t){return FG(r,n.parent,t)}function FG(r,n,t){let l=n;for(;l!==null&&l.type&168;)n=l,l=n.parent;if(l===null)return t[_c];if(Ch(l)){let{encapsulation:h}=r.data[l.directiveStart+l.componentOffset];if(h===yd.None||h===yd.Emulated)return null}return yc(l,t)}function lz(r,n,t){return NG(r,n,t)}function LG(r,n,t){return r.type&40?yc(r,t):null}var NG=LG,GN;function LA(r,n,t,l){let h=az(r,l,n),i=n[Kr],E=l.parent||n[na],O=lz(E,l,n);if(h!=null)if(Array.isArray(t))for(let N=0;N<t.length;N++)NN(i,h,t[N],O,!1);else NN(i,h,t,O,!1);GN!==void 0&&GN(i,l,n,t,h)}function fy(r,n){if(n!==null){let t=n.type;if(t&3)return yc(n,r);if(t&4)return WD(-1,r[n.index]);if(t&8){let l=n.child;if(l!==null)return fy(r,l);{let h=r[n.index];return vc(h)?WD(-1,h):El(h)}}else{if(t&128)return fy(r,n.next);if(t&32)return PA(n,r)()||El(r[n.index]);{let l=cz(r,n);if(l!==null){if(Array.isArray(l))return l[0];let h=vh(r[ia]);return fy(h,l)}else return fy(r,n.next)}}}return null}function cz(r,n){if(n!==null){let l=r[ia][na],h=n.projection;return l.projection[h]}return null}function WD(r,n){let t=wo+r+1;if(t<n.length){let l=n[t],h=l[ni].firstChild;if(h!==null)return fy(l,h)}return n[wh]}function NA(r,n,t,l,h,i,E){for(;t!=null;){let O=l[_d];if(t.type===128){t=t.next;continue}let N=l[t.index],K=t.type;if(E&&n===0&&(N&&e_(El(N),l),t.flags|=2),!SC(t))if(K&8)NA(r,n,t.child,l,h,i,!1),Kg(n,r,O,h,N,t,i,l);else if(K&32){let le=PA(t,l),De;for(;De=le();)Kg(n,r,O,h,De,t,i,l);Kg(n,r,O,h,N,t,i,l)}else K&16?uz(r,n,l,t,h,i):Kg(n,r,O,h,N,t,i,l);t=E?t.projectionNext:t.next}}function AC(r,n,t,l,h,i){NA(t,l,r.firstChild,n,h,i,!1)}function zG(r,n,t){let l=n[Kr],h=az(r,t,n),i=t.parent||n[na],E=lz(i,t,n);uz(l,0,n,t,h,E)}function uz(r,n,t,l,h,i){let E=t[ia],N=E[na].projection[l.projection];if(Array.isArray(N))for(let K=0;K<N.length;K++){let le=N[K];Kg(n,r,t[_d],h,le,l,i,t)}else{let K=N,le=E[Jo];w3(l)&&(K.flags|=128),NA(r,n,K,le,h,i,!0)}}function BG(r,n,t,l,h,i,E){let O=l[wh],N=El(l);O!==N&&Kg(n,r,t,i,O,h,E);for(let K=wo;K<l.length;K++){let le=l[K];AC(le[ni],le,r,n,i,O)}}function VG(r,n,t,l,h){if(n)h?r.addClass(t,l):r.removeClass(t,l);else{let i=l.indexOf("-")===-1?void 0:wc.DashCase;h==null?r.removeStyle(t,l,i):(typeof h=="string"&&h.endsWith("!important")&&(h=h.slice(0,-10),i|=wc.Important),r.setStyle(t,l,h,i))}}function dz(r,n,t,l,h){let i=pu(),E=l&2;try{Eh(-1),E&&n.length>uo&&Q3(r,n,uo,!1),Rr(E?2:0,h,t),t(l,h)}finally{Eh(i),Rr(E?3:1,h,t)}}function zA(r,n,t){qG(r,n,t),(t.flags&64)===64&&WG(r,n,t)}function PC(r,n,t=yc){let l=n.localNames;if(l!==null){let h=n.index+1;for(let i=0;i<l.length;i+=2){let E=l[i+1],O=E===-1?t(n,r):r[E];r[h++]=O}}}function UG(r,n,t,l){let i=l.get(P3,A3)||t===yd.ShadowDom,E=r.selectRootElement(n,i);return jG(E),E}function jG(r){$G(r)}var $G=()=>null;function HG(r){return r==="class"?"className":r==="for"?"htmlFor":r==="formaction"?"formAction":r==="innerHtml"?"innerHTML":r==="readonly"?"readOnly":r==="tabindex"?"tabIndex":r}function hz(r,n,t,l,h,i){let E=n[ni];if(BA(r,E,n,t,l)){Ch(r)&&GG(n,r.index);return}r.type&3&&(t=HG(t)),pz(r,n,t,l,h,i)}function pz(r,n,t,l,h,i){if(r.type&3){let E=yc(r,n);l=i!=null?i(l,r.value||"",t):l,h.setProperty(E,t,l)}else r.type&12}function GG(r,n){let t=Sl(n,r);t[Ci]&16||(t[Ci]|=64)}function qG(r,n,t){let l=t.directiveStart,h=t.directiveEnd;Ch(t)&&_G(n,t,r.data[l+t.componentOffset]),r.firstCreatePass||aC(t,n);let i=t.initialInputs;for(let E=l;E<h;E++){let O=r.data[E],N=gy(n,r,E,t);if(e_(N,n),i!==null&&KG(n,E-l,N,O,t,i),hu(O)){let K=Sl(t.index,n);K[Ao]=gy(n,r,E,t)}}}function WG(r,n,t){let l=t.directiveStart,h=t.directiveEnd,i=t.index,E=gN();try{Eh(i);for(let O=l;O<h;O++){let N=r.data[O],K=n[O];Vw(O),(N.hostBindings!==null||N.hostVars!==0||N.hostAttrs!==null)&&ZG(N,K)}}finally{Eh(-1),Vw(E)}}function ZG(r,n){r.hostBindings!==null&&r.hostBindings(1,n)}function fz(r,n){let t=r.directiveRegistry,l=null;if(t)for(let h=0;h<t.length;h++){let i=t[h];X3(n,i.selectors,!1)&&(l??=[],hu(i)?l.unshift(i):l.push(i))}return l}function XG(r,n,t,l,h,i){let E=yc(r,n);YG(n[Kr],E,i,r.value,t,l,h)}function YG(r,n,t,l,h,i,E){if(i==null)r.removeAttribute(n,h,t);else{let O=E==null?yh(i):E(i,l||"",h);r.setAttribute(n,h,O,t)}}function KG(r,n,t,l,h,i){let E=i[n];if(E!==null)for(let O=0;O<E.length;O+=2){let N=E[O],K=E[O+1];HD(l,t,N,K)}}function mz(r,n,t,l,h){let i=uo+t,E=n[ni],O=h(E,n,r,l,t);n[i]=O,Xg(r,!0);let N=r.type===2;return N?(H3(n[Kr],O,r),(lN()===0||cy(r))&&e_(O,n),cN()):e_(O,n),Hw()&&(!N||!SC(r))&&LA(E,n,O,r),r}function gz(r){let n=r;return rD()?oD():(n=n.parent,Xg(n,!1)),n}function QG(r,n){let t=r[_d];if(!t)return;let l;try{l=t.get(ra,null)}catch{l=null}l?.(n)}function BA(r,n,t,l,h){let i=r.inputs?.[l],E=r.hostDirectiveInputs?.[l],O=!1;if(E)for(let N=0;N<E.length;N+=2){let K=E[N],le=E[N+1],De=n.data[K];HD(De,t[K],le,h),O=!0}if(i)for(let N of i){let K=t[N],le=n.data[N];HD(le,K,l,h),O=!0}return O}function JG(r,n){let t=Sl(n,r),l=t[ni];eq(l,t);let h=t[_c];h!==null&&t[of]===null&&(t[of]=O3(h,t[_d])),Rr(18),VA(l,t,t[Ao]),Rr(19,t[Ao])}function eq(r,n){for(let t=n.length;t<r.blueprint.length;t++)n.push(r.blueprint[t])}function VA(r,n,t){jw(n);try{let l=r.viewQuery;l!==null&&FD(1,l,t);let h=r.template;h!==null&&dz(r,n,h,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),n[uu]?.finishViewCreation(r),r.staticContentQueries&&R3(r,n),r.staticViewQueries&&FD(2,r.viewQuery,t);let i=r.components;i!==null&&tq(n,i)}catch(l){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),l}finally{n[Ci]&=-5,$w()}}function tq(r,n){for(let t=0;t<n.length;t++)JG(r,n[t])}function Iy(r,n,t,l){let h=wi(null);try{let i=n.tView,O=r[Ci]&4096?4096:16,N=DA(r,i,t,O,null,n,null,null,l?.injector??null,l?.embeddedViewInjector??null,l?.dehydratedView??null),K=r[n.index];N[bh]=K;let le=r[uu];return le!==null&&(N[uu]=le.createEmbeddedView(i)),VA(i,N,t),N}finally{wi(h)}}function t_(r,n){return!n||n.firstChild===null||w3(r)}function _y(r,n,t,l,h=!1){for(;t!==null;){if(t.type===128){t=h?t.projectionNext:t.next;continue}let i=n[t.index];i!==null&&l.push(El(i)),vc(i)&&_z(i,l);let E=t.type;if(E&8)_y(r,n,t.child,l);else if(E&32){let O=PA(t,n),N;for(;N=O();)l.push(N)}else if(E&16){let O=cz(n,t);if(Array.isArray(O))l.push(...O);else{let N=vh(n[ia]);_y(N[ni],N,O,l,!0)}}t=h?t.projectionNext:t.next}return l}function _z(r,n){for(let t=wo;t<r.length;t++){let l=r[t],h=l[ni].firstChild;h!==null&&_y(l[ni],l,h,n)}r[wh]!==r[_c]&&n.push(r[wh])}function vz(r){if(r[lf]!==null){for(let n of r[lf])n.impl.addSequence(n);r[lf].length=0}}var yz=[];function nq(r){return r[Za]??iq(r)}function iq(r){let n=yz.pop()??Object.create(oq);return n.lView=r,n}function rq(r){r.lView[Za]!==r&&(r.lView=null,yz.push(r))}var oq=bi($t({},Tg),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{Zg(r.lView)},consumerOnSignalRead(){this.lView[Za]=this}});function sq(r){let n=r[Za]??Object.create(aq);return n.lView=r,n}var aq=bi($t({},Tg),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{let n=vh(r.lView);for(;n&&!xz(n[ni]);)n=vh(n);n&&ZM(n)},consumerOnSignalRead(){this.lView[Za]=this}});function xz(r){return r.type!==2}function bz(r){if(r[ay]===null)return;let n=!0;for(;n;){let t=!1;for(let l of r[ay])l.dirty&&(t=!0,l.zone===null||Zone.current===l.zone?l.run():l.zone.run(()=>l.run()));n=t&&!!(r[Ci]&8192)}}var lq=100;function wz(r,n=0){let l=r[cu].rendererFactory,h=!1;h||l.begin?.();try{cq(r,n)}finally{h||l.end?.()}}function cq(r,n){let t=sD();try{aD(!0),ZD(r,n);let l=0;for(;dy(r);){if(l===lq)throw new sn(103,!1);l++,ZD(r,1)}}finally{aD(t)}}function uq(r,n,t,l){if(df(n))return;let h=n[Ci],i=!1,E=!1;jw(n);let O=!0,N=null,K=null;i||(xz(r)?(K=nq(n),N=Mg(K)):$1()===null?(O=!1,K=sq(n),N=Mg(K)):n[Za]&&(W0(n[Za]),n[Za]=null));try{WM(n),pN(r.bindingStartIndex),t!==null&&dz(r,n,t,2,l);let le=(h&3)===3;if(!i)if(le){let Fe=r.preOrderCheckHooks;Fe!==null&&Jw(n,Fe,null)}else{let Fe=r.preOrderHooks;Fe!==null&&eC(n,Fe,0,null),vD(n,0)}if(E||dq(n),bz(n),Cz(n,0),r.contentQueries!==null&&R3(r,n),!i)if(le){let Fe=r.contentCheckHooks;Fe!==null&&Jw(n,Fe)}else{let Fe=r.contentHooks;Fe!==null&&eC(n,Fe,1),vD(n,1)}pq(r,n);let De=r.components;De!==null&&Sz(n,De,0);let Qe=r.viewQuery;if(Qe!==null&&FD(2,Qe,l),!i)if(le){let Fe=r.viewCheckHooks;Fe!==null&&Jw(n,Fe)}else{let Fe=r.viewHooks;Fe!==null&&eC(n,Fe,2),vD(n,2)}if(r.firstUpdatePass===!0&&(r.firstUpdatePass=!1),n[kw]){for(let Fe of n[kw])Fe();n[kw]=null}i||(vz(n),n[Ci]&=-73)}catch(le){throw i||Zg(n),le}finally{K!==null&&(G0(K,N),O&&rq(K)),$w()}}function Cz(r,n){for(let t=E3(r);t!==null;t=S3(t))for(let l=wo;l<t.length;l++){let h=t[l];Ez(h,n)}}function dq(r){for(let n=E3(r);n!==null;n=S3(n)){if(!(n[Ci]&2))continue;let t=n[uf];for(let l=0;l<t.length;l++){let h=t[l];ZM(h)}}}function hq(r,n,t){Rr(18);let l=Sl(n,r);Ez(l,t),Rr(19,l[Ao])}function Ez(r,n){Lw(r)&&ZD(r,n)}function ZD(r,n){let l=r[ni],h=r[Ci],i=r[Za],E=!!(n===0&&h&16);if(E||=!!(h&64&&n===0),E||=!!(h&1024),E||=!!(i?.dirty&&q0(i)),E||=!1,i&&(i.dirty=!1),r[Ci]&=-9217,E)uq(l,r,l.template,r[Ao]);else if(h&8192){let O=wi(null);try{bz(r),Cz(r,1);let N=l.components;N!==null&&Sz(r,N,1),vz(r)}finally{wi(O)}}}function Sz(r,n,t){for(let l=0;l<n.length;l++)hq(r,n[l],t)}function pq(r,n){let t=r.hostBindingOpCodes;if(t!==null)try{for(let l=0;l<t.length;l++){let h=t[l];if(h<0)Eh(~h);else{let i=h,E=t[++l],O=t[++l];mN(E,i);let N=n[i];Rr(24,N),O(2,N),Rr(25,N)}}}finally{Eh(-1)}}function UA(r,n){let t=sD()?64:1088;for(r[cu].changeDetectionScheduler?.notify(n);r;){r[Ci]|=t;let l=vh(r);if(Wg(r)&&!l)return r;r=l}return null}function Tz(r,n,t,l){return[r,!0,0,n,null,l,null,t,null,null]}function Iz(r,n){let t=wo+n;if(t<r.length)return r[t]}function My(r,n,t,l=!0){let h=n[ni];if(fq(h,n,r,t),l){let E=WD(t,r),O=n[Kr],N=O.parentNode(r[wh]);N!==null&&AG(h,r[na],O,n,N,E)}let i=n[of];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function Mz(r,n){let t=vy(r,n);return t!==void 0&&DC(t[ni],t),t}function vy(r,n){if(r.length<=wo)return;let t=wo+n,l=r[t];if(l){let h=l[bh];h!==null&&h!==r&&FA(h,l),n>0&&(r[t-1][Cl]=l[Cl]);let i=ry(r,wo+n);DG(l[ni],l);let E=i[uu];E!==null&&E.detachView(i[ni]),l[Jo]=null,l[Cl]=null,l[Ci]&=-129}return l}function fq(r,n,t,l){let h=wo+l,i=t.length;l>0&&(t[h-1][Cl]=n),l<i-wo?(n[Cl]=t[h],RM(t,wo+l,n)):(t.push(n),n[Cl]=null),n[Jo]=t;let E=n[bh];E!==null&&t!==E&&Dz(E,n);let O=n[uu];O!==null&&O.insertView(r),Nw(n),n[Ci]|=128}function Dz(r,n){let t=r[uf],l=n[Jo];if(du(l))r[Ci]|=2;else{let h=l[Jo][ia];n[ia]!==h&&(r[Ci]|=2)}t===null?r[uf]=[n]:t.push(n)}var Sh=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let n=this._lView,t=n[ni];return _y(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t}get context(){return this._lView[Ao]}set context(n){this._lView[Ao]=n}get destroyed(){return df(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Jo];if(vc(n)){let t=n[ly],l=t?t.indexOf(this):-1;l>-1&&(vy(n,l),ry(t,l))}this._attachedToViewContainer=!1}DC(this._lView[ni],this._lView)}onDestroy(n){XM(this._lView,n)}markForCheck(){UA(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ci]&=-129}reattach(){Nw(this._lView),this._lView[Ci]|=128}detectChanges(){this._lView[Ci]|=1024,wz(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new sn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=Wg(this._lView),t=this._lView[bh];t!==null&&!n&&FA(t,this._lView),sz(this._lView[ni],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new sn(902,!1);this._appRef=n;let t=Wg(this._lView),l=this._lView[bh];l!==null&&!t&&Dz(l,this._lView),Nw(this._lView)}};var Xa=(()=>{class r{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=mq;constructor(t,l,h){this._declarationLView=t,this._declarationTContainer=l,this.elementRef=h}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,l){return this.createEmbeddedViewImpl(t,l)}createEmbeddedViewImpl(t,l,h){let i=Iy(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:l,dehydratedView:h});return new Sh(i)}}return r})();function mq(){return OC(Is(),mi())}function OC(r,n){return r.type&4?new Xa(n,r,i_(r,n)):null}function s_(r,n,t,l,h){let i=r.data[n];if(i===null)i=gq(r,n,t,l,h),fN()&&(i.flags|=32);else if(i.type&64){i.type=t,i.value=l,i.attrs=h;let E=uN();i.injectorIndex=E===null?-1:E.injectorIndex}return Xg(i,!0),i}function gq(r,n,t,l,h){let i=iD(),E=rD(),O=E?i:i&&i.parent,N=r.data[n]=vq(r,O,t,n,l,h);return _q(r,N,i,E),N}function _q(r,n,t,l){r.firstChild===null&&(r.firstChild=n),t!==null&&(l?t.child==null&&n.parent!==null&&(t.child=n):t.next===null&&(t.next=n,n.prev=t))}function vq(r,n,t,l,h,i){let E=n?n.injectorIndex:-1,O=0;return eD()&&(O|=128),{type:t,index:l,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:O,providerIndexes:0,value:h,attrs:i,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var rue=new RegExp(`^(\\d+)*(${AH}|${DH})*(.*)`);function yq(r){let n=r[$M]??[],l=r[Jo][Kr],h=[];for(let i of n)i.data[D3]!==void 0?h.push(i):xq(i,l);r[$M]=h}function xq(r,n){let t=0,l=r.firstChild;if(l){let h=r.data[M3];for(;t<h;){let i=l.nextSibling;$3(n,l,!1),l=i,t++}}}var bq=()=>null,wq=()=>null;function pC(r,n){return bq(r,n)}function Az(r,n,t){return wq(r,n,t)}var Pz=class{},RC=class{},XD=class{resolveComponentFactory(n){throw new sn(917,!1)}},Dy=class{static NULL=new XD},ps=class{},sa=(()=>{class r{destroyNode=null;static __NG_ELEMENT_ID__=()=>Cq()}return r})();function Cq(){let r=mi(),n=Is(),t=Sl(n.index,r);return(du(t)?t:r)[Kr]}var Oz=(()=>{class r{static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>null})}return r})();var nC={},YD=class{injector;parentInjector;constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,l){let h=this.injector.get(n,nC,l);return h!==nC||t===nC?h:this.parentInjector.get(n,t,l)}};function fC(r,n,t){let l=t?r.styles:null,h=t?r.classes:null,i=0;if(n!==null)for(let E=0;E<n.length;E++){let O=n[E];if(typeof O=="number")i=O;else if(i==1)h=Mw(h,O);else if(i==2){let N=O,K=n[++E];l=Mw(l,N+": "+K+";")}}t?r.styles=l:r.stylesWithoutHost=l,t?r.classes=h:r.classesWithoutHost=h}function Bt(r,n=0){let t=mi();if(t===null)return dn(r,n);let l=Is();return y3(l,t,Ts(r),n)}function jA(){let r="invalid";throw new Error(r)}function Rz(r,n,t,l,h){let i=l===null?null:{"":-1},E=h(r,t);if(E!==null){let O=E,N=null,K=null;for(let le of E)if(le.resolveHostDirectives!==null){[O,N,K]=le.resolveHostDirectives(E);break}Tq(r,n,t,O,i,N,K)}i!==null&&l!==null&&Eq(t,l,i)}function Eq(r,n,t){let l=r.localNames=[];for(let h=0;h<n.length;h+=2){let i=t[n[h+1]];if(i==null)throw new sn(-301,!1);l.push(n[h],i)}}function Sq(r,n,t){n.componentOffset=t,(r.components??=[]).push(n.index)}function Tq(r,n,t,l,h,i,E){let O=l.length,N=!1;for(let Qe=0;Qe<O;Qe++){let Fe=l[Qe];!N&&hu(Fe)&&(N=!0,Sq(r,t,Qe)),PD(aC(t,n),r,Fe.type)}Oq(t,r.data.length,O);for(let Qe=0;Qe<O;Qe++){let Fe=l[Qe];Fe.providersResolver&&Fe.providersResolver(Fe)}let K=!1,le=!1,De=K3(r,n,O,null);O>0&&(t.directiveToIndex=new Map);for(let Qe=0;Qe<O;Qe++){let Fe=l[Qe];if(t.mergedAttrs=Jg(t.mergedAttrs,Fe.hostAttrs),Mq(r,t,n,De,Fe),Pq(De,Fe,h),E!==null&&E.has(Fe)){let[jt,Ot]=E.get(Fe);t.directiveToIndex.set(Fe.type,[De,jt+t.directiveStart,Ot+t.directiveStart])}else(i===null||!i.has(Fe))&&t.directiveToIndex.set(Fe.type,De);Fe.contentQueries!==null&&(t.flags|=4),(Fe.hostBindings!==null||Fe.hostAttrs!==null||Fe.hostVars!==0)&&(t.flags|=64);let gt=Fe.type.prototype;!K&&(gt.ngOnChanges||gt.ngOnInit||gt.ngDoCheck)&&((r.preOrderHooks??=[]).push(t.index),K=!0),!le&&(gt.ngOnChanges||gt.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(t.index),le=!0),De++}Iq(r,t,i)}function Iq(r,n,t){for(let l=n.directiveStart;l<n.directiveEnd;l++){let h=r.data[l];if(t===null||!t.has(h))qN(0,n,h,l),qN(1,n,h,l),ZN(n,l,!1);else{let i=t.get(h);WN(0,n,i,l),WN(1,n,i,l),ZN(n,l,!0)}}}function qN(r,n,t,l){let h=r===0?t.inputs:t.outputs;for(let i in h)if(h.hasOwnProperty(i)){let E;r===0?E=n.inputs??={}:E=n.outputs??={},E[i]??=[],E[i].push(l),kz(n,i)}}function WN(r,n,t,l){let h=r===0?t.inputs:t.outputs;for(let i in h)if(h.hasOwnProperty(i)){let E=h[i],O;r===0?O=n.hostDirectiveInputs??={}:O=n.hostDirectiveOutputs??={},O[E]??=[],O[E].push(l,i),kz(n,E)}}function kz(r,n){n==="class"?r.flags|=8:n==="style"&&(r.flags|=16)}function ZN(r,n,t){let{attrs:l,inputs:h,hostDirectiveInputs:i}=r;if(l===null||!t&&h===null||t&&i===null||IA(r)){r.initialInputs??=[],r.initialInputs.push(null);return}let E=null,O=0;for(;O<l.length;){let N=l[O];if(N===0){O+=4;continue}else if(N===5){O+=2;continue}else if(typeof N=="number")break;if(!t&&h.hasOwnProperty(N)){let K=h[N];for(let le of K)if(le===n){E??=[],E.push(N,l[O+1]);break}}else if(t&&i.hasOwnProperty(N)){let K=i[N];for(let le=0;le<K.length;le+=2)if(K[le]===n){E??=[],E.push(K[le+1],l[O+1]);break}}O+=2}r.initialInputs??=[],r.initialInputs.push(E)}function Mq(r,n,t,l,h){r.data[l]=h;let i=h.factory||(h.factory=_h(h.type,!0)),E=new pf(i,hu(h),Bt,null);r.blueprint[l]=E,t[l]=E,Dq(r,n,l,K3(r,t,h.hostVars,Bs),h)}function Dq(r,n,t,l,h){let i=h.hostBindings;if(i){let E=r.hostBindingOpCodes;E===null&&(E=r.hostBindingOpCodes=[]);let O=~n.index;Aq(E)!=O&&E.push(O),E.push(t,l,i)}}function Aq(r){let n=r.length;for(;n>0;){let t=r[--n];if(typeof t=="number"&&t<0)return t}return 0}function Pq(r,n,t){if(t){if(n.exportAs)for(let l=0;l<n.exportAs.length;l++)t[n.exportAs[l]]=r;hu(n)&&(t[""]=r)}}function Oq(r,n,t){r.flags|=1,r.directiveStart=n,r.directiveEnd=n+t,r.providerIndexes=n}function Fz(r,n,t,l,h,i,E,O){let N=n[ni],K=N.consts,le=Tl(K,E),De=s_(N,r,t,l,le);return i&&Rz(N,n,De,Tl(K,O),h),De.mergedAttrs=Jg(De.mergedAttrs,De.attrs),De.attrs!==null&&fC(De,De.attrs,!1),De.mergedAttrs!==null&&fC(De,De.mergedAttrs,!0),N.queries!==null&&N.queries.elementStart(N,De),De}function Lz(r,n){u3(r,n),HM(n)&&r.queries.elementEnd(n)}function Rq(r,n,t,l,h,i){let E=n.consts,O=Tl(E,h),N=s_(n,r,t,l,O);if(N.mergedAttrs=Jg(N.mergedAttrs,N.attrs),i!=null){let K=Tl(E,i);N.localNames=[];for(let le=0;le<K.length;le+=2)N.localNames.push(K[le],-1)}return N.attrs!==null&&fC(N,N.attrs,!1),N.mergedAttrs!==null&&fC(N,N.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,N),N}function $A(r){return kC(r)?Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r:!1}function Nz(r,n){if(Array.isArray(r))for(let t=0;t<r.length;t++)n(r[t]);else{let t=r[Symbol.iterator](),l;for(;!(l=t.next()).done;)n(l.value)}}function kC(r){return r!==null&&(typeof r=="function"||typeof r=="object")}function HA(r,n,t){return r[n]=t}function kq(r,n){return r[n]}function Ya(r,n,t){if(t===Bs)return!1;let l=r[n];return Object.is(l,t)?!1:(r[n]=t,!0)}function zz(r,n,t,l){let h=Ya(r,n,t);return Ya(r,n+1,l)||h}function bD(r,n,t){return function l(h){let i=Ch(r)?Sl(r.index,n):n;UA(i,5);let E=n[Ao],O=XN(n,E,t,h),N=l.__ngNextListenerFn__;for(;N;)O=XN(n,E,N,h)&&O,N=N.__ngNextListenerFn__;return O}}function XN(r,n,t,l){let h=wi(null);try{return Rr(6,n,t),t(l)!==!1}catch(i){return QG(r,i),!1}finally{Rr(7,n,t),wi(h)}}function Fq(r,n,t,l,h,i,E,O){let N=cy(r),K=!1,le=null;if(!l&&N&&(le=Nq(n,t,i,r.index)),le!==null){let De=le.__ngLastListenerFn__||le;De.__ngNextListenerFn__=E,le.__ngLastListenerFn__=E,K=!0}else{let De=yc(r,t),Qe=l?l(De):De;OH(t,Qe,i,O);let Fe=h.listen(Qe,i,O);if(!Lq(i)){let gt=l?jt=>l(El(jt[r.index])):r.index;Bz(gt,n,t,i,O,Fe,!1)}}return K}function Lq(r){return r.startsWith("animation")||r.startsWith("transition")}function Nq(r,n,t,l){let h=r.cleanup;if(h!=null)for(let i=0;i<h.length-1;i+=2){let E=h[i];if(E===t&&h[i+1]===l){let O=n[Gg],N=h[i+2];return O&&O.length>N?O[N]:null}typeof E=="string"&&(i+=2)}return null}function Bz(r,n,t,l,h,i,E){let O=n.firstCreatePass?KM(n):null,N=YM(t),K=N.length;N.push(h,i),O&&O.push(l,r,K,(K+1)*(E?-1:1))}function YN(r,n,t,l,h,i){let E=n[t],O=n[ni],K=O.data[t].outputs[l],De=E[K].subscribe(i);Bz(r.index,O,n,h,i,De,!0)}var KD=Symbol("BINDING");var mC=class extends Dy{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let t=lu(n);return new Th(t,this.ngModule)}};function zq(r){return Object.keys(r).map(n=>{let[t,l,h]=r[n],i={propName:t,templateName:n,isSignal:(l&IC.SignalBased)!==0};return h&&(i.transform=h),i})}function Bq(r){return Object.keys(r).map(n=>({propName:r[n],templateName:n}))}function Vq(r,n,t){let l=n instanceof Hr?n:n?.injector;return l&&r.getStandaloneInjector!==null&&(l=r.getStandaloneInjector(l)||l),l?new YD(t,l):t}function Uq(r){let n=r.get(ps,null);if(n===null)throw new sn(407,!1);let t=r.get(Oz,null),l=r.get(gd,null);return{rendererFactory:n,sanitizer:t,changeDetectionScheduler:l,ngReflect:!1}}function jq(r,n){let t=Vz(r);return U3(n,t,t==="svg"?tN:t==="math"?nN:null)}function Vz(r){return(r.selectors[0][0]||"div").toLowerCase()}var Th=class extends RC{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=zq(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=Bq(this.componentDef.outputs),this.cachedOutputs}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=pG(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!t}create(n,t,l,h,i,E){Rr(22);let O=wi(null);try{let N=this.componentDef,K=$q(l,N,E,i),le=Vq(N,h||this.ngModule,n),De=Uq(le),Qe=De.rendererFactory.createRenderer(null,N),Fe=l?UG(Qe,l,N.encapsulation,le):jq(N,Qe),gt=E?.some(KN)||i?.some(Kt=>typeof Kt!="function"&&Kt.bindings.some(KN)),jt=DA(null,K,null,512|Y3(N),null,null,De,Qe,le,null,O3(Fe,le,!0));jt[uo]=Fe,jw(jt);let Ot=null;try{let Kt=Fz(uo,jt,2,"#host",()=>K.directiveRegistry,!0,0);H3(Qe,Fe,Kt),e_(Fe,jt),zA(K,jt,Kt),k3(K,Kt,jt),Lz(K,Kt),t!==void 0&&Gq(Kt,this.ngContentSelectors,t),Ot=Sl(Kt.index,jt),jt[Ao]=Ot[Ao],VA(K,jt,null)}catch(Kt){throw Ot!==null&&RD(Ot),RD(jt),Kt}finally{Rr(23),$w()}return new gC(this.componentType,jt,!!gt)}finally{wi(O)}}};function $q(r,n,t,l){let h=r?["ng-version","20.3.15"]:fG(n.selectors[0]),i=null,E=null,O=0;if(t)for(let le of t)O+=le[KD].requiredVars,le.create&&(le.targetIdx=0,(i??=[]).push(le)),le.update&&(le.targetIdx=0,(E??=[]).push(le));if(l)for(let le=0;le<l.length;le++){let De=l[le];if(typeof De!="function")for(let Qe of De.bindings){O+=Qe[KD].requiredVars;let Fe=le+1;Qe.create&&(Qe.targetIdx=Fe,(i??=[]).push(Qe)),Qe.update&&(Qe.targetIdx=Fe,(E??=[]).push(Qe))}}let N=[n];if(l)for(let le of l){let De=typeof le=="function"?le:le.type,Qe=NM(De);N.push(Qe)}return MA(0,null,Hq(i,E),1,O,N,null,null,null,[h],null)}function Hq(r,n){return!r&&!n?null:t=>{if(t&1&&r)for(let l of r)l.create();if(t&2&&n)for(let l of n)l.update()}}function KN(r){let n=r[KD].kind;return n==="input"||n==="twoWay"}var gC=class extends Pz{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,t,l){super(),this._rootLView=t,this._hasInputBindings=l,this._tNode=uy(t[ni],uo),this.location=i_(this._tNode,t),this.instance=Sl(this._tNode.index,t)[Ao],this.hostView=this.changeDetectorRef=new Sh(t,void 0),this.componentType=n}setInput(n,t){this._hasInputBindings;let l=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;let h=this._rootLView,i=BA(l,h[ni],h,n,t);this.previousInputValues.set(n,t);let E=Sl(l.index,h);UA(E,1)}get injector(){return new hf(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function Gq(r,n,t){let l=r.projection=[];for(let h=0;h<n.length;h++){let i=t[h];l.push(i!=null&&i.length?Array.from(i):null)}}var Ka=(()=>{class r{static __NG_ELEMENT_ID__=qq}return r})();function qq(){let r=Is();return jz(r,mi())}var Wq=Ka,Uz=class extends Wq{_lContainer;_hostTNode;_hostLView;constructor(n,t,l){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=l}get element(){return i_(this._hostTNode,this._hostLView)}get injector(){return new hf(this._hostTNode,this._hostLView)}get parentInjector(){let n=mA(this._hostTNode,this._hostLView);if(p3(n)){let t=oC(n,this._hostLView),l=rC(n),h=t[ni].data[l+8];return new hf(h,t)}else return new hf(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let t=QN(this._lContainer);return t!==null&&t[n]||null}get length(){return this._lContainer.length-wo}createEmbeddedView(n,t,l){let h,i;typeof l=="number"?h=l:l!=null&&(h=l.index,i=l.injector);let E=pC(this._lContainer,n.ssrId),O=n.createEmbeddedViewImpl(t||{},i,E);return this.insertImpl(O,h,t_(this._hostTNode,E)),O}createComponent(n,t,l,h,i,E,O){let N=n&&!iH(n),K;if(N)K=t;else{let Ot=t||{};K=Ot.index,l=Ot.injector,h=Ot.projectableNodes,i=Ot.environmentInjector||Ot.ngModuleRef,E=Ot.directives,O=Ot.bindings}let le=N?n:new Th(lu(n)),De=l||this.parentInjector;if(!i&&le.ngModule==null){let Kt=(N?De:this.parentInjector).get(Hr,null);Kt&&(i=Kt)}let Qe=lu(le.componentType??{}),Fe=pC(this._lContainer,Qe?.id??null),gt=Fe?.firstChild??null,jt=le.create(De,h,gt,i,E,O);return this.insertImpl(jt.hostView,K,t_(this._hostTNode,Fe)),jt}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,l){let h=n._lView;if(rN(h)){let O=this.indexOf(n);if(O!==-1)this.detach(O);else{let N=h[Jo],K=new Uz(N,N[na],N[Jo]);K.detach(K.indexOf(n))}}let i=this._adjustIndex(t),E=this._lContainer;return My(E,h,i,l),n.attachToViewContainerRef(),RM(wD(E),i,n),n}move(n,t){return this.insert(n,t)}indexOf(n){let t=QN(this._lContainer);return t!==null?t.indexOf(n):-1}remove(n){let t=this._adjustIndex(n,-1),l=vy(this._lContainer,t);l&&(ry(wD(this._lContainer),t),DC(l[ni],l))}detach(n){let t=this._adjustIndex(n,-1),l=vy(this._lContainer,t);return l&&ry(wD(this._lContainer),t)!=null?new Sh(l):null}_adjustIndex(n,t=0){return n??this.length+t}};function QN(r){return r[ly]}function wD(r){return r[ly]||(r[ly]=[])}function jz(r,n){let t,l=n[r.index];return vc(l)?t=l:(t=Tz(l,n,null,r),n[r.index]=t,AA(n,t)),Xq(t,n,r,l),new Uz(t,r,n)}function Zq(r,n){let t=r[Kr],l=t.createComment(""),h=yc(n,r),i=t.parentNode(h);return cC(t,i,l,t.nextSibling(h),!1),l}var Xq=Qq,Yq=()=>!1;function Kq(r,n,t){return Yq(r,n,t)}function Qq(r,n,t,l){if(r[wh])return;let h;t.type&8?h=El(l):h=Zq(n,t),r[wh]=h}var QD=class r{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new r(this.queryList)}setDirty(){this.queryList.setDirty()}},JD=class r{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let t=n.queries;if(t!==null){let l=n.contentQueries!==null?n.contentQueries[0]:t.length,h=[];for(let i=0;i<l;i++){let E=t.getByIndex(i),O=this.queries[E.indexInDeclarationView];h.push(O.clone())}return new r(h)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)GA(n,t).matches!==null&&this.queries[t].setDirty()}},eA=class{flags;read;predicate;constructor(n,t,l=null){this.flags=t,this.read=l,typeof n=="string"?this.predicate=sW(n):this.predicate=n}},tA=class r{queries;constructor(n=[]){this.queries=n}elementStart(n,t){for(let l=0;l<this.queries.length;l++)this.queries[l].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let l=0;l<this.length;l++){let h=t!==null?t.length:0,i=this.getByIndex(l).embeddedTView(n,h);i&&(i.indexInDeclarationView=l,t!==null?t.push(i):t=[i])}return t!==null?new r(t):null}template(n,t){for(let l=0;l<this.queries.length;l++)this.queries[l].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},nA=class r{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,t=-1){this.metadata=n,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new r(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,l=n.parent;for(;l!==null&&l.type&8&&l.index!==t;)l=l.parent;return t===(l!==null?l.index:-1)}return this._appliesToNextNode}matchTNode(n,t){let l=this.metadata.predicate;if(Array.isArray(l))for(let h=0;h<l.length;h++){let i=l[h];this.matchTNodeWithReadOption(n,t,Jq(t,i)),this.matchTNodeWithReadOption(n,t,tC(t,n,i,!1,!1))}else l===Xa?t.type&4&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,tC(t,n,l,!1,!1))}matchTNodeWithReadOption(n,t,l){if(l!==null){let h=this.metadata.read;if(h!==null)if(h===ir||h===Ka||h===Xa&&t.type&4)this.addMatch(t.index,-2);else{let i=tC(t,n,h,!1,!1);i!==null&&this.addMatch(t.index,i)}else this.addMatch(t.index,l)}}addMatch(n,t){this.matches===null?this.matches=[n,t]:this.matches.push(n,t)}};function Jq(r,n){let t=r.localNames;if(t!==null){for(let l=0;l<t.length;l+=2)if(t[l]===n)return t[l+1]}return null}function eW(r,n){return r.type&11?i_(r,n):r.type&4?OC(r,n):null}function tW(r,n,t,l){return t===-1?eW(n,r):t===-2?nW(r,n,l):gy(r,r[ni],t,n)}function nW(r,n,t){if(t===ir)return i_(n,r);if(t===Xa)return OC(n,r);if(t===Ka)return jz(n,r)}function $z(r,n,t,l){let h=n[uu].queries[l];if(h.matches===null){let i=r.data,E=t.matches,O=[];for(let N=0;E!==null&&N<E.length;N+=2){let K=E[N];if(K<0)O.push(null);else{let le=i[K];O.push(tW(n,le,E[N+1],t.metadata.read))}}h.matches=O}return h.matches}function iA(r,n,t,l){let h=r.queries.getByIndex(t),i=h.matches;if(i!==null){let E=$z(r,n,h,t);for(let O=0;O<i.length;O+=2){let N=i[O];if(N>0)l.push(E[O/2]);else{let K=i[O+1],le=n[-N];for(let De=wo;De<le.length;De++){let Qe=le[De];Qe[bh]===Qe[Jo]&&iA(Qe[ni],Qe,K,l)}if(le[uf]!==null){let De=le[uf];for(let Qe=0;Qe<De.length;Qe++){let Fe=De[Qe];iA(Fe[ni],Fe,K,l)}}}}}return l}function iW(r,n){return r[uu].queries[n].queryList}function rW(r,n,t){let l=new lC((t&4)===4);return aN(r,n,l,l.destroy),(n[uu]??=new JD).queries.push(new QD(l))-1}function oW(r,n,t){let l=Co();return l.firstCreatePass&&(aW(l,new eA(r,n,t),-1),(n&2)===2&&(l.staticViewQueries=!0)),rW(l,mi(),n)}function sW(r){return r.split(",").map(n=>n.trim())}function aW(r,n,t){r.queries===null&&(r.queries=new tA),r.queries.track(new nA(n,t))}function GA(r,n){return r.queries.getByIndex(n)}function lW(r,n){let t=r[ni],l=GA(t,n);return l.crossesNgTemplate?iA(t,r,n,[]):$z(t,r,l,n)}var gu=class{},FC=class{};var _C=class extends gu{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new mC(this);constructor(n,t,l,h=!0){super(),this.ngModuleType=n,this._parent=t;let i=LM(n);this._bootstrapComponents=W3(i.bootstrap),this._r3Injector=dD(n,t,[{provide:gu,useValue:this},{provide:Dy,useValue:this.componentFactoryResolver},...l],md(n),new Set(["environment"])),h&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},vC=class extends FC{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new _C(this.moduleType,n,[])}};var yy=class extends gu{injector;componentFactoryResolver=new mC(this);instance=null;constructor(n){super();let t=new nf([...n.providers,{provide:gu,useValue:this},{provide:Dy,useValue:this.componentFactoryResolver}],n.parent||Hg(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function a_(r,n,t=null){return new yy({providers:r,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}var cW=(()=>{class r{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let l=zM(!1,t.type),h=l.length>0?a_([l],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,h)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ft({token:r,providedIn:"environment",factory:()=>new r(dn(Hr))})}return r})();function In(r){return wy(()=>{let n=Hz(r),t=bi($t({},n),{decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===gA.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&r.dependencies||null,getStandaloneInjector:n.standalone?h=>h.get(cW).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||yd.Emulated,styles:r.styles||ta,_:null,schemas:r.schemas||null,tView:null,id:""});n.standalone&&Ec("NgStandalone"),Gz(t);let l=r.dependencies;return t.directiveDefs=JN(l,uW),t.pipeDefs=JN(l,WL),t.id=pW(t),t})}function uW(r){return lu(r)||NM(r)}function Cr(r){return wy(()=>({type:r.type,bootstrap:r.bootstrap||ta,declarations:r.declarations||ta,imports:r.imports||ta,exports:r.exports||ta,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function dW(r,n){if(r==null)return xh;let t={};for(let l in r)if(r.hasOwnProperty(l)){let h=r[l],i,E,O,N;Array.isArray(h)?(O=h[0],i=h[1],E=h[2]??i,N=h[3]||null):(i=h,E=h,O=IC.None,N=null),t[i]=[l,O,N],n[i]=E}return t}function hW(r){if(r==null)return xh;let n={};for(let t in r)r.hasOwnProperty(t)&&(n[r[t]]=t);return n}function fr(r){return wy(()=>{let n=Hz(r);return Gz(n),n})}function LC(r){return{type:r.type,name:r.name,factory:null,pure:r.pure!==!1,standalone:r.standalone??!0,onDestroy:r.type.prototype.ngOnDestroy||null}}function Hz(r){let n={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:n,inputConfig:r.inputs||xh,exportAs:r.exportAs||null,standalone:r.standalone??!0,signals:r.signals===!0,selectors:r.selectors||ta,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:dW(r.inputs,n),outputs:hW(r.outputs),debugInfo:null}}function Gz(r){r.features?.forEach(n=>n(r))}function JN(r,n){return r?()=>{let t=typeof r=="function"?r():r,l=[];for(let h of t){let i=n(h);i!==null&&l.push(i)}return l}:null}function pW(r){let n=0,t=typeof r.consts=="function"?"":r.consts,l=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,t,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery];for(let i of l.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function fW(r){return Object.getPrototypeOf(r.prototype).constructor}function fs(r){let n=fW(r.type),t=!0,l=[r];for(;n;){let h;if(hu(r))h=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new sn(903,!1);h=n.\u0275dir}if(h){if(t){l.push(h);let E=r;E.inputs=CD(r.inputs),E.declaredInputs=CD(r.declaredInputs),E.outputs=CD(r.outputs);let O=h.hostBindings;O&&yW(r,O);let N=h.viewQuery,K=h.contentQueries;if(N&&_W(r,N),K&&vW(r,K),mW(r,h),zL(r.outputs,h.outputs),hu(h)&&h.data.animation){let le=r.data;le.animation=(le.animation||[]).concat(h.data.animation)}}let i=h.features;if(i)for(let E=0;E<i.length;E++){let O=i[E];O&&O.ngInherit&&O(r),O===fs&&(t=!1)}}n=Object.getPrototypeOf(n)}gW(l)}function mW(r,n){for(let t in n.inputs){if(!n.inputs.hasOwnProperty(t)||r.inputs.hasOwnProperty(t))continue;let l=n.inputs[t];l!==void 0&&(r.inputs[t]=l,r.declaredInputs[t]=n.declaredInputs[t])}}function gW(r){let n=0,t=null;for(let l=r.length-1;l>=0;l--){let h=r[l];h.hostVars=n+=h.hostVars,h.hostAttrs=Jg(h.hostAttrs,t=Jg(t,h.hostAttrs))}}function CD(r){return r===xh?{}:r===ta?[]:r}function _W(r,n){let t=r.viewQuery;t?r.viewQuery=(l,h)=>{n(l,h),t(l,h)}:r.viewQuery=n}function vW(r,n){let t=r.contentQueries;t?r.contentQueries=(l,h,i)=>{n(l,h,i),t(l,h,i)}:r.contentQueries=n}function yW(r,n){let t=r.hostBindings;t?r.hostBindings=(l,h)=>{n(l,h),t(l,h)}:r.hostBindings=n}function qz(r,n,t,l,h,i,E,O){if(t.firstCreatePass){r.mergedAttrs=Jg(r.mergedAttrs,r.attrs);let le=r.tView=MA(2,r,h,i,E,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);t.queries!==null&&(t.queries.template(t,r),le.queries=t.queries.embeddedTView(r))}O&&(r.flags|=O),Xg(r,!1);let N=bW(t,n,r,l);Hw()&&LA(t,n,N,r),e_(N,n);let K=Tz(N,n,N,r);n[l+uo]=K,AA(n,K),Kq(K,r,n)}function xW(r,n,t,l,h,i,E,O,N,K,le){let De=t+uo,Qe;return n.firstCreatePass?(Qe=s_(n,De,4,E||null,O||null),JM()&&Rz(n,r,Qe,Tl(n.consts,K),fz),u3(n,Qe)):Qe=n.data[De],qz(Qe,r,n,t,l,h,i,N),cy(Qe)&&zA(n,r,Qe),K!=null&&PC(r,Qe,le),Qe}function xy(r,n,t,l,h,i,E,O,N,K,le){let De=t+uo,Qe;if(n.firstCreatePass){if(Qe=s_(n,De,4,E||null,O||null),K!=null){let Fe=Tl(n.consts,K);Qe.localNames=[];for(let gt=0;gt<Fe.length;gt+=2)Qe.localNames.push(Fe[gt],-1)}}else Qe=n.data[De];return qz(Qe,r,n,t,l,h,i,N),K!=null&&PC(r,Qe,le),Qe}function Ui(r,n,t,l,h,i,E,O){let N=mi(),K=Co(),le=Tl(K.consts,i);return xW(N,K,r,n,t,l,h,le,void 0,E,O),Ui}var bW=wW;function wW(r,n,t,l){return Gw(!0),n[Kr].createComment("")}var NC=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();var qA=new Yt("");function Ih(r){return!!r&&typeof r.then=="function"}function WA(r){return!!r&&typeof r.subscribe=="function"}var ZA=new Yt("");function zC(r){return gc([{provide:ZA,multi:!0,useValue:r}])}var XA=(()=>{class r{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,l)=>{this.resolve=t,this.reject=l});appInits=Ve(ZA,{optional:!0})??[];injector=Ve(cr);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let h of this.appInits){let i=hs(this.injector,h);if(Ih(i))t.push(i);else if(WA(i)){let E=new Promise((O,N)=>{i.subscribe({complete:O,error:N})});t.push(E)}}let l=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{l()}).catch(h=>{this.reject(h)}),t.length===0&&l(),this.initialized=!0}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),Ay=new Yt("");function Wz(){YI(()=>{let r="";throw new sn(600,r)})}function Zz(r){return r.isBoundToModule}var CW=10;var Ea=(()=>{class r{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Ve(ra);afterRenderManager=Ve(kA);zonelessEnabled=Ve(Yg);rootEffectScheduler=Ve(_D);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new li;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=Ve(fu);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Qn(t=>!t))}constructor(){Ve(_f,{optional:!0})}whenStable(){let t;return new Promise(l=>{t=this.isStable.subscribe({next:h=>{h&&l()}})}).finally(()=>{t.unsubscribe()})}_injector=Ve(Hr);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,l){return this.bootstrapImpl(t,l)}bootstrapImpl(t,l,h=cr.NULL){return this._injector.get(yi).run(()=>{Rr(10);let E=t instanceof RC;if(!this._injector.get(XA).done){let gt="";throw new sn(405,gt)}let N;E?N=t:N=this._injector.get(Dy).resolveComponentFactory(t),this.componentTypes.push(N.componentType);let K=Zz(N)?void 0:this._injector.get(gu),le=l||N.selector,De=N.create(h,[],le,K),Qe=De.location.nativeElement,Fe=De.injector.get(qA,null);return Fe?.registerApplication(Qe),De.onDestroy(()=>{this.detachView(De.hostView),my(this.components,De),Fe?.unregisterApplication(Qe)}),this._loadComponent(De),Rr(11,De),De})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Rr(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(MC.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new sn(101,!1);let t=wi(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,wi(t),this.afterTick.next(),Rr(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(ps,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<CW;)Rr(14),this.synchronizeOnce(),Rr(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let l=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:h}of this.allViews){if(!l&&!dy(h))continue;let i=l&&!this.zonelessEnabled?0:1;wz(h,i),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>dy(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let l=t;this._views.push(l),l.attachToAppRef(this)}detachView(t){let l=t;my(this._views,l),l.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(h){this.internalErrorHandler(h)}this.components.push(t),this._injector.get(Ay,[]).forEach(h=>h(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>my(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new sn(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function my(r,n){let t=r.indexOf(n);t>-1&&r.splice(t,1)}function $o(r,n,t,l){let h=mi(),i=vd();if(Ya(h,i,n)){let E=Co(),O=hy();XG(O,h,r,n,t,l)}return $o}var due=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var rA=class{destroy(n){}updateValue(n,t){}swap(n,t){let l=Math.min(n,t),h=Math.max(n,t),i=this.detach(h);if(h-l>1){let E=this.detach(l);this.attach(l,i),this.attach(h,E)}else this.attach(l,i)}move(n,t){this.attach(t,this.detach(n))}};function ED(r,n,t,l,h){return r===t&&Object.is(n,l)?1:Object.is(h(r,n),h(t,l))?-1:0}function EW(r,n,t){let l,h,i=0,E=r.length-1,O=void 0;if(Array.isArray(n)){let N=n.length-1;for(;i<=E&&i<=N;){let K=r.at(i),le=n[i],De=ED(i,K,i,le,t);if(De!==0){De<0&&r.updateValue(i,le),i++;continue}let Qe=r.at(E),Fe=n[N],gt=ED(E,Qe,N,Fe,t);if(gt!==0){gt<0&&r.updateValue(E,Fe),E--,N--;continue}let jt=t(i,K),Ot=t(E,Qe),Kt=t(i,le);if(Object.is(Kt,Ot)){let Hn=t(N,Fe);Object.is(Hn,jt)?(r.swap(i,E),r.updateValue(E,Fe),N--,E--):r.move(E,i),r.updateValue(i,le),i++;continue}if(l??=new yC,h??=t3(r,i,E,t),oA(r,l,i,Kt))r.updateValue(i,le),i++,E++;else if(h.has(Kt))l.set(jt,r.detach(i)),E--;else{let Hn=r.create(i,n[i]);r.attach(i,Hn),i++,E++}}for(;i<=N;)e3(r,l,t,i,n[i]),i++}else if(n!=null){let N=n[Symbol.iterator](),K=N.next();for(;!K.done&&i<=E;){let le=r.at(i),De=K.value,Qe=ED(i,le,i,De,t);if(Qe!==0)Qe<0&&r.updateValue(i,De),i++,K=N.next();else{l??=new yC,h??=t3(r,i,E,t);let Fe=t(i,De);if(oA(r,l,i,Fe))r.updateValue(i,De),i++,E++,K=N.next();else if(!h.has(Fe))r.attach(i,r.create(i,De)),i++,E++,K=N.next();else{let gt=t(i,le);l.set(gt,r.detach(i)),E--}}}for(;!K.done;)e3(r,l,t,r.length,K.value),K=N.next()}for(;i<=E;)r.destroy(r.detach(E--));l?.forEach(N=>{r.destroy(N)})}function oA(r,n,t,l){return n!==void 0&&n.has(l)?(r.attach(t,n.get(l)),n.delete(l),!0):!1}function e3(r,n,t,l,h){if(oA(r,n,l,t(l,h)))r.updateValue(l,h);else{let i=r.create(l,h);r.attach(l,i)}}function t3(r,n,t,l){let h=new Set;for(let i=n;i<=t;i++)h.add(l(i,r.at(i)));return h}var yC=class{kvMap=new Map;_vMap=void 0;has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;let t=this.kvMap.get(n);return this._vMap!==void 0&&this._vMap.has(t)?(this.kvMap.set(n,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,t){if(this.kvMap.has(n)){let l=this.kvMap.get(n);this._vMap===void 0&&(this._vMap=new Map);let h=this._vMap;for(;h.has(l);)l=h.get(l);h.set(l,t)}else this.kvMap.set(n,t)}forEach(n){for(let[t,l]of this.kvMap)if(n(l,t),this._vMap!==void 0){let h=this._vMap;for(;h.has(l);)l=h.get(l),n(l,t)}}};function ft(r,n,t,l,h,i,E,O){Ec("NgControlFlow");let N=mi(),K=Co(),le=Tl(K.consts,i);return xy(N,K,r,n,t,l,h,le,256,E,O),Py}function Py(r,n,t,l,h,i,E,O){Ec("NgControlFlow");let N=mi(),K=Co(),le=Tl(K.consts,i);return xy(N,K,r,n,t,l,h,le,512,E,O),Py}function mt(r,n){Ec("NgControlFlow");let t=mi(),l=vd(),h=t[l]!==Bs?t[l]:-1,i=h!==-1?xC(t,uo+h):void 0,E=0;if(Ya(t,l,r)){let O=wi(null);try{if(i!==void 0&&Mz(i,E),r!==-1){let N=uo+r,K=xC(t,N),le=cA(t[ni],N),De=Az(K,le,t),Qe=Iy(t,le,n,{dehydratedView:De});My(K,Qe,E,t_(le,De))}}finally{wi(O)}}else if(i!==void 0){let O=Iz(i,E);O!==void 0&&(O[Ao]=n)}}var sA=class{lContainer;$implicit;$index;constructor(n,t,l){this.lContainer=n,this.$implicit=t,this.$index=l}get $count(){return this.lContainer.length-wo}};function es(r){return r}var aA=class{hasEmptyBlock;trackByFn;liveCollection;constructor(n,t,l){this.hasEmptyBlock=n,this.trackByFn=t,this.liveCollection=l}};function $i(r,n,t,l,h,i,E,O,N,K,le,De,Qe){Ec("NgControlFlow");let Fe=mi(),gt=Co(),jt=N!==void 0,Ot=mi(),Kt=O?E.bind(Ot[ia][Ao]):E,Hn=new aA(jt,Kt);Ot[uo+r]=Hn,xy(Fe,gt,r+1,n,t,l,h,Tl(gt.consts,i),256),jt&&xy(Fe,gt,r+2,N,K,le,De,Tl(gt.consts,Qe),512)}var lA=class extends rA{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(n,t,l){super(),this.lContainer=n,this.hostLView=t,this.templateTNode=l}get length(){return this.lContainer.length-wo}at(n){return this.getLView(n)[Ao].$implicit}attach(n,t){let l=t[of];this.needsIndexUpdate||=n!==this.length,My(this.lContainer,t,n,t_(this.templateTNode,l)),SW(this.lContainer,n)}detach(n){return this.needsIndexUpdate||=n!==this.length-1,TW(this.lContainer,n),IW(this.lContainer,n)}create(n,t){let l=pC(this.lContainer,this.templateTNode.tView.ssrId),h=Iy(this.hostLView,this.templateTNode,new sA(this.lContainer,t,n),{dehydratedView:l});return this.operationsCounter?.recordCreate(),h}destroy(n){DC(n[ni],n),this.operationsCounter?.recordDestroy()}updateValue(n,t){this.getLView(n)[Ao].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[Ao].$index=n}getLView(n){return MW(this.lContainer,n)}};function Hi(r){let n=wi(null),t=pu();try{let l=mi(),h=l[ni],i=l[t],E=t+1,O=xC(l,E);if(i.liveCollection===void 0){let K=cA(h,E);i.liveCollection=new lA(O,l,K)}else i.liveCollection.reset();let N=i.liveCollection;if(EW(N,r,i.trackByFn),N.updateIndexes(),i.hasEmptyBlock){let K=vd(),le=N.length===0;if(Ya(l,K,le)){let De=t+2,Qe=xC(l,De);if(le){let Fe=cA(h,De),gt=Az(Qe,Fe,l),jt=Iy(l,Fe,void 0,{dehydratedView:gt});My(Qe,jt,0,t_(Fe,gt))}else h.firstUpdatePass&&yq(Qe),Mz(Qe,0)}}}finally{wi(n)}}function xC(r,n){return r[n]}function SW(r,n){if(r.length<=wo)return;let t=wo+n,l=r[t],h=l?l[cf]:void 0;if(l&&h&&h.detachedLeaveAnimationFns&&h.detachedLeaveAnimationFns.length>0){let i=l[_d];IG(i,h),ff.delete(l),h.detachedLeaveAnimationFns=void 0}}function TW(r,n){if(r.length<=wo)return;let t=wo+n,l=r[t],h=l?l[cf]:void 0;h&&h.leave&&h.leave.size>0&&(h.detachedLeaveAnimationFns=[])}function IW(r,n){return vy(r,n)}function MW(r,n){return Iz(r,n)}function cA(r,n){return uy(r,n)}function bt(r,n,t){let l=mi(),h=vd();if(Ya(l,h,n)){let i=Co(),E=hy();hz(E,l,r,n,l[Kr],t)}return bt}function uA(r,n,t,l,h){BA(n,r,t,h?"class":"style",l)}function B(r,n,t,l){let h=mi(),i=h[ni],E=r+uo,O=i.firstCreatePass?Fz(E,h,2,n,fz,JM(),t,l):i.data[E];if(mz(O,h,r,n,Xz),cy(O)){let N=h[ni];zA(N,h,O),k3(N,O,h)}return l!=null&&PC(h,O),B}function U(){let r=Co(),n=Is(),t=gz(n);return r.firstCreatePass&&Lz(r,t),tD(t)&&nD(),QM(),t.classesWithoutHost!=null&&cH(t)&&uA(r,t,mi(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&uH(t)&&uA(r,t,mi(),t.stylesWithoutHost,!1),U}function Mn(r,n,t,l){return B(r,n,t,l),U(),Mn}function Mh(r,n,t,l){let h=mi(),i=h[ni],E=r+uo,O=i.firstCreatePass?Rq(E,i,2,n,t,l):i.data[E];return mz(O,h,r,n,Xz),l!=null&&PC(h,O),Mh}function Dh(){let r=Is(),n=gz(r);return tD(n)&&nD(),QM(),Dh}function Cd(r,n,t,l){return Mh(r,n,t,l),Dh(),Cd}var Xz=(r,n,t,l,h)=>(Gw(!0),U3(n[Kr],l,wN()));function It(){return mi()}function BC(r,n,t){let l=mi(),h=vd();if(Ya(l,h,n)){let i=Co(),E=hy();pz(E,l,r,n,l[Kr],t)}return BC}var Kw=void 0;function DW(r){let n=Math.floor(Math.abs(r)),t=r.toString().replace(/^[^.]*\.?/,"").length;return n===1&&t===0?1:5}var AW=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Kw,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Kw,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Kw,"{1} 'at' {0}",Kw],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",DW],SD={};function Qa(r){let n=PW(r),t=n3(n);if(t)return t;let l=n.split("-")[0];if(t=n3(l),t)return t;if(l==="en")return AW;throw new sn(701,!1)}function n3(r){return r in SD||(SD[r]=wl.ng&&wl.ng.common&&wl.ng.common.locales&&wl.ng.common.locales[r]),SD[r]}var Po=(function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r})(Po||{});function PW(r){return r.toLowerCase().replace(/_/g,"-")}var Oy="en-US";var OW=Oy;function Yz(r){typeof r=="string"&&(OW=r.toLowerCase().replace(/_/g,"-"))}function Re(r,n,t){let l=mi(),h=Co(),i=Is();return Kz(h,l,l[Kr],i,r,n,t),Re}function Kz(r,n,t,l,h,i,E){let O=!0,N=null;if((l.type&3||E)&&(N??=bD(l,n,i),Fq(l,r,n,E,t,h,i,N)&&(O=!1)),O){let K=l.outputs?.[h],le=l.hostDirectiveOutputs?.[h];if(le&&le.length)for(let De=0;De<le.length;De+=2){let Qe=le[De],Fe=le[De+1];N??=bD(l,n,i),YN(l,n,Qe,Fe,h,N)}if(K&&K.length)for(let De of K)N??=bD(l,n,i),YN(l,n,De,h,h,N)}}function re(r=1){return bN(r)}function RW(r,n){let t=null,l=lG(r);for(let h=0;h<n.length;h++){let i=n[h];if(i==="*"){t=h;continue}if(l===null?X3(r,i,!0):dG(l,i))return h}return t}function vf(r){let n=mi()[ia][na];if(!n.projection){let t=r?r.length:1,l=n.projection=GL(t,null),h=l.slice(),i=n.child;for(;i!==null;){if(i.type!==128){let E=r?RW(i,r):0;E!==null&&(h[E]?h[E].projectionNext=i:l[E]=i,h[E]=i)}i=i.next}}}function Ed(r,n=0,t,l,h,i){let E=mi(),O=Co(),N=l?r+1:null;N!==null&&xy(E,O,N,l,h,i,null,t);let K=s_(O,uo+r,16,null,t||null);K.projection===null&&(K.projection=n),oD();let De=!E[of]||eD();E[ia][na].projection[K.projection]===null&&N!==null?kW(E,O,N):De&&!SC(K)&&zG(O,E,K)}function kW(r,n,t){let l=uo+t,h=n.data[l],i=r[l],E=pC(i,h.tView.ssrId),O=Iy(r,h,void 0,{dehydratedView:E});My(i,O,0,t_(h,E))}function Sa(r,n,t){oW(r,n,t)}function aa(r){let n=mi(),t=Co(),l=lD();Uw(l+1);let h=GA(t,l);if(r.dirty&&iN(n)===((h.metadata.flags&2)===2)){if(h.matches===null)r.reset([]);else{let i=lW(n,l);r.reset(i,CH),r.notifyOnChanges()}return!0}return!1}function la(){return iW(mi(),lD())}function Al(r){let n=dN();return Fw(n,uo+r)}function Qw(r,n){return r<<17|n<<2}function mf(r){return r>>17&32767}function FW(r){return(r&2)==2}function LW(r,n){return r&131071|n<<17}function dA(r){return r|2}function n_(r){return(r&131068)>>2}function TD(r,n){return r&-131069|n<<2}function NW(r){return(r&1)===1}function hA(r){return r|1}function zW(r,n,t,l,h,i){let E=i?n.classBindings:n.styleBindings,O=mf(E),N=n_(E);r[l]=t;let K=!1,le;if(Array.isArray(t)){let De=t;le=De[1],(le===null||$g(De,le)>0)&&(K=!0)}else le=t;if(h)if(N!==0){let Qe=mf(r[O+1]);r[l+1]=Qw(Qe,O),Qe!==0&&(r[Qe+1]=TD(r[Qe+1],l)),r[O+1]=LW(r[O+1],l)}else r[l+1]=Qw(O,0),O!==0&&(r[O+1]=TD(r[O+1],l)),O=l;else r[l+1]=Qw(N,0),O===0?O=l:r[N+1]=TD(r[N+1],l),N=l;K&&(r[l+1]=dA(r[l+1])),i3(r,le,l,!0),i3(r,le,l,!1),BW(n,le,r,l,i),E=Qw(O,N),i?n.classBindings=E:n.styleBindings=E}function BW(r,n,t,l,h){let i=h?r.residualClasses:r.residualStyles;i!=null&&typeof n=="string"&&$g(i,n)>=0&&(t[l+1]=hA(t[l+1]))}function i3(r,n,t,l){let h=r[t+1],i=n===null,E=l?mf(h):n_(h),O=!1;for(;E!==0&&(O===!1||i);){let N=r[E],K=r[E+1];VW(N,n)&&(O=!0,r[E+1]=l?hA(K):dA(K)),E=l?mf(K):n_(K)}O&&(r[t+1]=l?dA(h):hA(h))}function VW(r,n){return r===null||n==null||(Array.isArray(r)?r[1]:r)===n?!0:Array.isArray(r)&&typeof n=="string"?$g(r,n)>=0:!1}var bc={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function UW(r){return r.substring(bc.key,bc.keyEnd)}function jW(r){return $W(r),Qz(r,Jz(r,0,bc.textEnd))}function Qz(r,n){let t=bc.textEnd;return t===n?-1:(n=bc.keyEnd=HW(r,bc.key=n,t),Jz(r,n,t))}function $W(r){bc.key=0,bc.keyEnd=0,bc.value=0,bc.valueEnd=0,bc.textEnd=r.length}function Jz(r,n,t){for(;n<t&&r.charCodeAt(n)<=32;)n++;return n}function HW(r,n,t){for(;n<t&&r.charCodeAt(n)>32;)n++;return n}function Ds(r,n,t){return eB(r,n,t,!1),Ds}function fn(r,n){return eB(r,n,null,!0),fn}function Ry(r){qW(QW,GW,r,!0)}function GW(r,n){for(let t=jW(n);t>=0;t=Qz(n,t))Ow(r,UW(n),!0)}function eB(r,n,t,l){let h=mi(),i=Co(),E=Bw(2);if(i.firstUpdatePass&&nB(i,r,E,l),n!==Bs&&Ya(h,E,n)){let O=i.data[pu()];iB(i,O,h,h[Kr],r,h[E+1]=e9(n,t),l,E)}}function qW(r,n,t,l){let h=Co(),i=Bw(2);h.firstUpdatePass&&nB(h,null,i,l);let E=mi();if(t!==Bs&&Ya(E,i,t)){let O=h.data[pu()];if(rB(O,l)&&!tB(h,i)){let N=l?O.classesWithoutHost:O.stylesWithoutHost;N!==null&&(t=Mw(N,t||"")),uA(h,O,E,t,l)}else JW(h,O,E,E[Kr],E[i+1],E[i+1]=KW(r,n,t),l,i)}}function tB(r,n){return n>=r.expandoStartIndex}function nB(r,n,t,l){let h=r.data;if(h[t+1]===null){let i=h[pu()],E=tB(r,t);rB(i,l)&&n===null&&!E&&(n=!1),n=WW(h,i,n,l),zW(h,i,n,t,E,l)}}function WW(r,n,t,l){let h=_N(r),i=l?n.residualClasses:n.residualStyles;if(h===null)(l?n.classBindings:n.styleBindings)===0&&(t=ID(null,r,n,t,l),t=by(t,n.attrs,l),i=null);else{let E=n.directiveStylingLast;if(E===-1||r[E]!==h)if(t=ID(h,r,n,t,l),i===null){let N=ZW(r,n,l);N!==void 0&&Array.isArray(N)&&(N=ID(null,r,n,N[1],l),N=by(N,n.attrs,l),XW(r,n,l,N))}else i=YW(r,n,l)}return i!==void 0&&(l?n.residualClasses=i:n.residualStyles=i),t}function ZW(r,n,t){let l=t?n.classBindings:n.styleBindings;if(n_(l)!==0)return r[mf(l)]}function XW(r,n,t,l){let h=t?n.classBindings:n.styleBindings;r[mf(h)]=l}function YW(r,n,t){let l,h=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<h;i++){let E=r[i].hostAttrs;l=by(l,E,t)}return by(l,n.attrs,t)}function ID(r,n,t,l,h){let i=null,E=t.directiveEnd,O=t.directiveStylingLast;for(O===-1?O=t.directiveStart:O++;O<E&&(i=n[O],l=by(l,i.hostAttrs,h),i!==r);)O++;return r!==null&&(t.directiveStylingLast=O),l}function by(r,n,t){let l=t?1:2,h=-1;if(n!==null)for(let i=0;i<n.length;i++){let E=n[i];typeof E=="number"?h=E:h===l&&(Array.isArray(r)||(r=r===void 0?[]:["",r]),Ow(r,E,t?!0:n[++i]))}return r===void 0?null:r}function KW(r,n,t){if(t==null||t==="")return ta;let l=[],h=Ml(t);if(Array.isArray(h))for(let i=0;i<h.length;i++)r(l,h[i],!0);else if(typeof h=="object")for(let i in h)h.hasOwnProperty(i)&&r(l,i,h[i]);else typeof h=="string"&&n(l,h);return l}function QW(r,n,t){let l=String(n);l!==""&&!l.includes(" ")&&Ow(r,l,t)}function JW(r,n,t,l,h,i,E,O){h===Bs&&(h=ta);let N=0,K=0,le=0<h.length?h[0]:null,De=0<i.length?i[0]:null;for(;le!==null||De!==null;){let Qe=N<h.length?h[N+1]:void 0,Fe=K<i.length?i[K+1]:void 0,gt=null,jt;le===De?(N+=2,K+=2,Qe!==Fe&&(gt=De,jt=Fe)):De===null||le!==null&&le<De?(N+=2,gt=le):(K+=2,gt=De,jt=Fe),gt!==null&&iB(r,n,t,l,gt,jt,E,O),le=N<h.length?h[N]:null,De=K<i.length?i[K]:null}}function iB(r,n,t,l,h,i,E,O){if(!(n.type&3))return;let N=r.data,K=N[O+1],le=NW(K)?r3(N,n,t,h,n_(K),E):void 0;if(!bC(le)){bC(i)||FW(K)&&(i=r3(N,null,t,h,O,E));let De=GM(pu(),t);VG(l,E,De,h,i)}}function r3(r,n,t,l,h,i){let E=n===null,O;for(;h>0;){let N=r[h],K=Array.isArray(N),le=K?N[1]:N,De=le===null,Qe=t[h+1];Qe===Bs&&(Qe=De?ta:void 0);let Fe=De?Rw(Qe,l):le===l?Qe:void 0;if(K&&!bC(Fe)&&(Fe=Rw(N,l)),bC(Fe)&&(O=Fe,E))return O;let gt=r[h+1];h=E?mf(gt):n_(gt)}if(n!==null){let N=i?n.residualClasses:n.residualStyles;N!=null&&(O=Rw(N,l))}return O}function bC(r){return r!==void 0}function e9(r,n){return r==null||r===""||(typeof n=="string"?r=r+n:typeof r=="object"&&(r=md(Ml(r)))),r}function rB(r,n){return(r.flags&(n?8:16))!==0}function Q(r,n=""){let t=mi(),l=Co(),h=r+uo,i=l.firstCreatePass?s_(l,h,1,n,null):l.data[h],E=t9(l,t,i,n,r);t[h]=E,Hw()&&LA(l,t,E,i),Xg(i,!1)}var t9=(r,n,t,l,h)=>(Gw(!0),QH(n[Kr],l));function n9(r,n,t,l=""){return Ya(r,vd(),t)?n+yh(t)+l:Bs}function i9(r,n,t,l,h,i=""){let E=hN(),O=zz(r,E,t,h);return Bw(2),O?n+yh(t)+l+yh(h)+i:Bs}function xt(r){return mr("",r),xt}function mr(r,n,t){let l=mi(),h=n9(l,r,n,t);return h!==Bs&&oB(l,pu(),h),mr}function ca(r,n,t,l,h){let i=mi(),E=i9(i,r,n,t,l,h);return E!==Bs&&oB(i,pu(),E),ca}function oB(r,n,t){let l=GM(n,r);JH(r[Kr],l,t)}function Oo(r,n,t){fD(n)&&(n=n());let l=mi(),h=vd();if(Ya(l,h,n)){let i=Co(),E=hy();hz(E,l,r,n,l[Kr],t)}return Oo}function Ho(r,n){let t=fD(r);return t&&r.set(n),t}function Ro(r,n){let t=mi(),l=Co(),h=Is();return Kz(l,t,t[Kr],h,r,n),Ro}function VC(r){return Ya(mi(),vd(),r)?yh(r):Bs}function r9(r,n,t){let l=Co();if(l.firstCreatePass){let h=hu(r);pA(t,l.data,l.blueprint,h,!0),pA(n,l.data,l.blueprint,h,!1)}}function pA(r,n,t,l,h){if(r=Ts(r),Array.isArray(r))for(let i=0;i<r.length;i++)pA(r[i],n,t,l,h);else{let i=Co(),E=mi(),O=Is(),N=tf(r)?r:Ts(r.provide),K=VM(r),le=O.providerIndexes&1048575,De=O.directiveStart,Qe=O.providerIndexes>>20;if(tf(r)||!r.multi){let Fe=new pf(K,h,Bt,null),gt=DD(N,n,h?le:le+Qe,De);gt===-1?(PD(aC(O,E),i,N),MD(i,r,n.length),n.push(N),O.directiveStart++,O.directiveEnd++,h&&(O.providerIndexes+=1048576),t.push(Fe),E.push(Fe)):(t[gt]=Fe,E[gt]=Fe)}else{let Fe=DD(N,n,le+Qe,De),gt=DD(N,n,le,le+Qe),jt=Fe>=0&&t[Fe],Ot=gt>=0&&t[gt];if(h&&!Ot||!h&&!jt){PD(aC(O,E),i,N);let Kt=a9(h?s9:o9,t.length,h,l,K,r);!h&&Ot&&(t[gt].providerFactory=Kt),MD(i,r,n.length,0),n.push(N),O.directiveStart++,O.directiveEnd++,h&&(O.providerIndexes+=1048576),t.push(Kt),E.push(Kt)}else{let Kt=sB(t[h?gt:Fe],K,!h&&l);MD(i,r,Fe>-1?Fe:gt,Kt)}!h&&l&&Ot&&t[gt].componentProviders++}}}function MD(r,n,t,l){let h=tf(n),i=QL(n);if(h||i){let N=(i?Ts(n.useClass):n).prototype.ngOnDestroy;if(N){let K=r.destroyHooks||(r.destroyHooks=[]);if(!h&&n.multi){let le=K.indexOf(t);le===-1?K.push(t,[l,N]):K[le+1].push(l,N)}else K.push(t,N)}}}function sB(r,n,t){return t&&r.componentProviders++,r.multi.push(n)-1}function DD(r,n,t,l){for(let h=t;h<l;h++)if(n[h]===r)return h;return-1}function o9(r,n,t,l,h){return fA(this.multi,[])}function s9(r,n,t,l,h){let i=this.multi,E;if(this.providerFactory){let O=this.providerFactory.componentProviders,N=gy(l,l[ni],this.providerFactory.index,h);E=N.slice(0,O),fA(i,E);for(let K=O;K<N.length;K++)E.push(N[K])}else E=[],fA(i,E);return E}function fA(r,n){for(let t=0;t<r.length;t++){let l=r[t];n.push(l())}return n}function a9(r,n,t,l,h,i){let E=new pf(r,t,Bt,null);return E.multi=[],E.index=n,E.componentProviders=0,sB(E,h,l&&!t),E}function Sd(r,n=[]){return t=>{t.providersResolver=(l,h)=>r9(l,h?h(r):r,n)}}function YA(r,n,t){let l=zw()+r,h=mi();return h[l]===Bs?HA(h,l,t?n.call(t):n()):kq(h,l)}function aB(r,n){let t=r[n];return t===Bs?void 0:t}function l9(r,n,t,l,h,i){let E=n+t;return Ya(r,E,h)?HA(r,E+1,i?l.call(i,h):l(h)):aB(r,E+1)}function c9(r,n,t,l,h,i,E){let O=n+t;return zz(r,O,h,i)?HA(r,O+2,E?l.call(E,h,i):l(h,i)):aB(r,O+2)}function l_(r,n){let t=Co(),l,h=r+uo;t.firstCreatePass?(l=u9(n,t.pipeRegistry),t.data[h]=l,l.onDestroy&&(t.destroyHooks??=[]).push(h,l.onDestroy)):l=t.data[h];let i=l.factory||(l.factory=_h(l.type,!0)),E,O=ea(Bt);try{let N=sC(!1),K=i();return sC(N),qM(t,mi(),h,K),K}finally{ea(O)}}function u9(r,n){if(n)for(let t=n.length-1;t>=0;t--){let l=n[t];if(r===l.name)return l}}function UC(r,n,t){let l=r+uo,h=mi(),i=Fw(h,l);return lB(h,l)?l9(h,zw(),n,i.transform,t,i):i.transform(t)}function KA(r,n,t,l){let h=r+uo,i=mi(),E=Fw(i,h);return lB(i,h)?c9(i,zw(),n,E.transform,t,l,E):E.transform(t,l)}function lB(r,n){return r[ni].data[n].pure}function ky(r,n){return OC(r,n)}var wC=class{ngModuleFactory;componentFactories;constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}},QA=(()=>{class r{compileModuleSync(t){return new vC(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let l=this.compileModuleSync(t),h=LM(t),i=W3(h.declarations).reduce((E,O)=>{let N=lu(O);return N&&E.push(new Th(N)),E},[]);return new wC(l,i)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var d9=(()=>{class r{zone=Ve(yi);changeDetectionScheduler=Ve(gd);applicationRef=Ve(Ea);applicationErrorHandler=Ve(ra);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),cB=new Yt("",{factory:()=>!1});function JA({ngZoneFactory:r,ignoreChangesOutsideZone:n,scheduleInRootZone:t}){return r??=()=>new yi(bi($t({},t2()),{scheduleInRootZone:t})),[{provide:yi,useFactory:r},{provide:au,multi:!0,useFactory:()=>{let l=Ve(d9,{optional:!0});return()=>l.initialize()}},{provide:au,multi:!0,useFactory:()=>{let l=Ve(h9);return()=>{l.initialize()}}},n===!0?{provide:mD,useValue:!0}:[],{provide:gD,useValue:t??J3},{provide:ra,useFactory:()=>{let l=Ve(yi),h=Ve(Hr),i;return E=>{l.runOutsideAngular(()=>{h.destroyed&&!i?setTimeout(()=>{throw E}):(i??=h.get(zs),i.handleError(E))})}}}]}function e2(r){let n=r?.ignoreChangesOutsideZone,t=r?.scheduleInRootZone,l=JA({ngZoneFactory:()=>{let h=t2(r);return h.scheduleInRootZone=t,h.shouldCoalesceEventChangeDetection&&Ec("NgZone_CoalesceEvent"),new yi(h)},ignoreChangesOutsideZone:n,scheduleInRootZone:t});return gc([{provide:cB,useValue:!0},{provide:Yg,useValue:!1},l])}function t2(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}var h9=(()=>{class r{subscription=new Br;initialized=!1;zone=Ve(yi);pendingTasks=Ve(fu);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{yi.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{yi.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var uB=(()=>{class r{applicationErrorHandler=Ve(ra);appRef=Ve(Ea);taskService=Ve(fu);ngZone=Ve(yi);zonelessEnabled=Ve(Yg);tracing=Ve(_f,{optional:!0});disableScheduling=Ve(mD,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Br;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(uC):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ve(gD,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof dC||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let l=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,l=!0;break}case 12:{this.appRef.dirtyFlags|=16,l=!0;break}case 13:{this.appRef.dirtyFlags|=2,l=!0;break}case 11:{l=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(l))return;let h=this.useMicrotaskScheduler?VN:ez;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>h(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>h(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(uC+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(l){this.taskService.remove(t),this.applicationErrorHandler(l)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,VN(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function p9(){return typeof $localize<"u"&&$localize.locale||Oy}var Fy=new Yt("",{providedIn:"root",factory:()=>Ve(Fy,{optional:!0,skipSelf:!0})||p9()});function ms(r){return FL(r)}function Ly(r,n){return W1(r,n?.equal)}var dB=class{[Ns];constructor(n){this[Ns]=n}destroy(){this[Ns].destroy()}};var _B=Symbol("InputSignalNode#UNSET"),D9=bi($t({},Z1),{transformFn:void 0,applyValueToInputSignal(r,n){Ag(r,n)}});function vB(r,n){let t=Object.create(D9);t.value=r,t.transformFn=n?.transform;function l(){if(Ig(t),t.value===_B){let h=null;throw new sn(-950,h)}return t.value}return l[Ns]=t,l}var c_=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>Cy(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},A9=new Yt("");A9.__NG_ELEMENT_ID__=r=>{let n=Is();if(n===null)throw new sn(204,!1);if(n.type&2)return n.value;if(r&8)return null;throw new sn(204,!1)};function hB(r,n){return vB(r,n)}function P9(r){return vB(_B,r)}var ro=(hB.required=P9,hB);var n2=new Yt(""),O9=new Yt("");function Ny(r){return!r.moduleRef}function R9(r){let n=Ny(r)?r.r3Injector:r.moduleRef.injector,t=n.get(yi);return t.run(()=>{Ny(r)?r.r3Injector.resolveInjectorInitializers():r.moduleRef.resolveInjectorInitializers();let l=n.get(ra),h;if(t.runOutsideAngular(()=>{h=t.onError.subscribe({next:l})}),Ny(r)){let i=()=>n.destroy(),E=r.platformInjector.get(n2);E.add(i),n.onDestroy(()=>{h.unsubscribe(),E.delete(i)})}else{let i=()=>r.moduleRef.destroy(),E=r.platformInjector.get(n2);E.add(i),r.moduleRef.onDestroy(()=>{my(r.allPlatformModules,r.moduleRef),h.unsubscribe(),E.delete(i)})}return F9(l,t,()=>{let i=n.get(fu),E=i.add(),O=n.get(XA);return O.runInitializers(),O.donePromise.then(()=>{let N=n.get(Fy,Oy);if(Yz(N||Oy),!n.get(O9,!0))return Ny(r)?n.get(Ea):(r.allPlatformModules.push(r.moduleRef),r.moduleRef);if(Ny(r)){let le=n.get(Ea);return r.rootComponent!==void 0&&le.bootstrap(r.rootComponent),le}else return k9?.(r.moduleRef,r.allPlatformModules),r.moduleRef}).finally(()=>void i.remove(E))})})}var k9;function F9(r,n,t){try{let l=t();return Ih(l)?l.catch(h=>{throw n.runOutsideAngular(()=>r(h)),h}):l}catch(l){throw n.runOutsideAngular(()=>r(l)),l}}var jC=null;function L9(r=[],n){return cr.create({name:n,providers:[{provide:oy,useValue:"platform"},{provide:n2,useValue:new Set([()=>jC=null])},...r]})}function N9(r=[]){if(jC)return jC;let n=L9(r);return jC=n,Wz(),z9(n),n}function z9(r){let n=r.get(CC,null);hs(r,()=>{n?.forEach(t=>t())})}var _u=(()=>{class r{static __NG_ELEMENT_ID__=B9}return r})();function B9(r){return V9(Is(),mi(),(r&16)===16)}function V9(r,n,t){if(Ch(r)&&!t){let l=Sl(r.index,n);return new Sh(l,l)}else if(r.type&175){let l=n[ia];return new Sh(l,n)}return null}var i2=class{constructor(){}supports(n){return $A(n)}create(n){return new r2(n)}},U9=(r,n)=>n,r2=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||U9}forEachItem(n){let t;for(t=this._itHead;t!==null;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,l=this._removalsHead,h=0,i=null;for(;t||l;){let E=!l||t&&t.currentIndex<pB(l,h,i)?t:l,O=pB(E,h,i),N=E.currentIndex;if(E===l)h--,l=l._nextRemoved;else if(t=t._next,E.previousIndex==null)h++;else{i||(i=[]);let K=O-h,le=N-h;if(K!=le){for(let Qe=0;Qe<K;Qe++){let Fe=Qe<i.length?i[Qe]:i[Qe]=0,gt=Fe+Qe;le<=gt&&gt<K&&(i[Qe]=Fe+1)}let De=E.previousIndex;i[De]=le-K}}O!==N&&n(E,O,N)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)n(t)}diff(n){if(n==null&&(n=[]),!$A(n))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._itHead,l=!1,h,i,E;if(Array.isArray(n)){this.length=n.length;for(let O=0;O<this.length;O++)i=n[O],E=this._trackByFn(O,i),t===null||!Object.is(t.trackById,E)?(t=this._mismatch(t,i,E,O),l=!0):(l&&(t=this._verifyReinsertion(t,i,E,O)),Object.is(t.item,i)||this._addIdentityChange(t,i)),t=t._next}else h=0,Nz(n,O=>{E=this._trackByFn(h,O),t===null||!Object.is(t.trackById,E)?(t=this._mismatch(t,O,E,h),l=!0):(l&&(t=this._verifyReinsertion(t,O,E,h)),Object.is(t.item,O)||this._addIdentityChange(t,O)),t=t._next,h++}),this.length=h;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,l,h){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(l,null),n!==null?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,i,h)):(n=this._linkedRecords===null?null:this._linkedRecords.get(l,h),n!==null?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,i,h)):n=this._addAfter(new o2(t,l),i,h)),n}_verifyReinsertion(n,t,l,h){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(l,null);return i!==null?n=this._reinsertAfter(i,n._prev,h):n.currentIndex!=h&&(n.currentIndex=h,this._addToMoves(n,h)),n}_truncate(n){for(;n!==null;){let t=n._next;this._addToRemovals(this._unlink(n)),n=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,l){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let h=n._prevRemoved,i=n._nextRemoved;return h===null?this._removalsHead=i:h._nextRemoved=i,i===null?this._removalsTail=h:i._prevRemoved=h,this._insertAfter(n,t,l),this._addToMoves(n,l),n}_moveAfter(n,t,l){return this._unlink(n),this._insertAfter(n,t,l),this._addToMoves(n,l),n}_addAfter(n,t,l){return this._insertAfter(n,t,l),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,t,l){let h=t===null?this._itHead:t._next;return n._next=h,n._prev=t,h===null?this._itTail=n:h._prev=n,t===null?this._itHead=n:t._next=n,this._linkedRecords===null&&(this._linkedRecords=new $C),this._linkedRecords.put(n),n.currentIndex=l,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let t=n._prev,l=n._next;return t===null?this._itHead=l:t._next=l,l===null?this._itTail=t:l._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new $C),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},o2=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,t){this.item=n,this.trackById=t}},s2=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let l;for(l=this._head;l!==null;l=l._nextDup)if((t===null||t<=l.currentIndex)&&Object.is(l.trackById,n))return l;return null}remove(n){let t=n._prevDup,l=n._nextDup;return t===null?this._head=l:t._nextDup=l,l===null?this._tail=t:l._prevDup=t,this._head===null}},$C=class{map=new Map;put(n){let t=n.trackById,l=this.map.get(t);l||(l=new s2,this.map.set(t,l)),l.add(n)}get(n,t){let l=n,h=this.map.get(l);return h?h.get(n,t):null}remove(n){let t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function pB(r,n,t){let l=r.previousIndex;if(l===null)return l;let h=0;return t&&l<t.length&&(h=t[l]),l+n+h}var a2=class{constructor(){}supports(n){return n instanceof Map||kC(n)}create(){return new l2}},l2=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let t;for(t=this._mapHead;t!==null;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;t!==null;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;t!==null;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)n(t)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||kC(n)))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(l,h)=>{if(t&&t.key===h)this._maybeAddToChanges(t,l),this._appendAfter=t,t=t._next;else{let i=this._getOrCreateRecordForKey(h,l);t=this._insertBeforeOrAppend(t,i)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let l=t;l!==null;l=l._nextRemoved)l===this._mapHead&&(this._mapHead=null),this._records.delete(l.key),l._nextRemoved=l._next,l.previousValue=l.currentValue,l.currentValue=null,l._prev=null,l._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){let l=n._prev;return t._next=n,t._prev=l,n._prev=t,l&&(l._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){let h=this._records.get(n);this._maybeAddToChanges(h,t);let i=h._prev,E=h._next;return i&&(i._next=E),E&&(E._prev=i),h._next=null,h._prev=null,h}let l=new c2(n);return this._records.set(n,l),l.currentValue=t,this._addToAdditions(l),l}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(l=>t(n[l],l))}},c2=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(n){this.key=n}};function fB(){return new HC([new i2])}var HC=(()=>{class r{factories;static \u0275prov=Ft({token:r,providedIn:"root",factory:fB});constructor(t){this.factories=t}static create(t,l){if(l!=null){let h=l.factories.slice();t=t.concat(h)}return new r(t)}static extend(t){return{provide:r,useFactory:()=>{let l=Ve(r,{optional:!0,skipSelf:!0});return r.create(t,l||fB())}}}find(t){let l=this.factories.find(h=>h.supports(t));if(l!=null)return l;throw new sn(901,!1)}}return r})();function mB(){return new GC([new a2])}var GC=(()=>{class r{static \u0275prov=Ft({token:r,providedIn:"root",factory:mB});factories;constructor(t){this.factories=t}static create(t,l){if(l){let h=l.factories.slice();t=t.concat(h)}return new r(t)}static extend(t){return{provide:r,useFactory:()=>{let l=Ve(r,{optional:!0,skipSelf:!0});return r.create(t,l||mB())}}}find(t){let l=this.factories.find(h=>h.supports(t));if(l)return l;throw new sn(901,!1)}}return r})();function yB(r){let{rootComponent:n,appProviders:t,platformProviders:l,platformRef:h}=r;Rr(8);try{let i=h?.injector??N9(l),E=[JA({}),{provide:gd,useExisting:uB},EN,...t||[]],O=new yy({providers:E,parent:i,debugName:"",runEnvironmentInitializers:!1});return R9({r3Injector:O.injector,platformInjector:i,rootComponent:n})}catch(i){return Promise.reject(i)}finally{Rr(9)}}function As(r){return typeof r=="boolean"?r:r!=null&&r!=="false"}function h2(r,n=NaN){return!isNaN(parseFloat(r))&&!isNaN(Number(r))?Number(r):n}function qC(r,n){let t=lu(r),l=n.elementInjector||Hg();return new Th(t).create(l,n.projectableNodes,n.hostElement,n.environmentInjector,n.directives,n.bindings)}function xB(r){let n=lu(r);if(!n)return null;let t=new Th(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var CB=null;function Pl(){return CB}function p2(r){CB??=r}var zy=class{},By=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(EB),providedIn:"platform"})}return r})(),f2=new Yt(""),EB=(()=>{class r extends By{_location;_history;_doc=Ve(si);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Pl().getBaseHref(this._doc)}onPopState(t){let l=Pl().getGlobalEventTarget(this._doc,"window");return l.addEventListener("popstate",t,!1),()=>l.removeEventListener("popstate",t)}onHashChange(t){let l=Pl().getGlobalEventTarget(this._doc,"window");return l.addEventListener("hashchange",t,!1),()=>l.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,l,h){this._history.pushState(t,l,h)}replaceState(t,l,h){this._history.replaceState(t,l,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>new r,providedIn:"platform"})}return r})();function WC(r,n){return r?n?r.endsWith("/")?n.startsWith("/")?r+n.slice(1):r+n:n.startsWith("/")?r+n:`${r}/${n}`:r:n}function bB(r){let n=r.search(/#|\?|$/);return r[n-1]==="/"?r.slice(0,n-1)+r.slice(n):r}function Sc(r){return r&&r[0]!=="?"?`?${r}`:r}var Tc=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(XC),providedIn:"root"})}return r})(),ZC=new Yt(""),XC=(()=>{class r extends Tc{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,l){super(),this._platformLocation=t,this._baseHref=l??this._platformLocation.getBaseHrefFromDOM()??Ve(si).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return WC(this._baseHref,t)}path(t=!1){let l=this._platformLocation.pathname+Sc(this._platformLocation.search),h=this._platformLocation.hash;return h&&t?`${l}${h}`:l}pushState(t,l,h,i){let E=this.prepareExternalUrl(h+Sc(i));this._platformLocation.pushState(t,l,E)}replaceState(t,l,h,i){let E=this.prepareExternalUrl(h+Sc(i));this._platformLocation.replaceState(t,l,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(l){return new(l||r)(dn(By),dn(ZC,8))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),vu=(()=>{class r{_subject=new li;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let l=this._locationStrategy.getBaseHref();this._basePath=H9(bB(wB(l))),this._locationStrategy.onPopState(h=>{this._subject.next({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,l=""){return this.path()==this.normalize(t+Sc(l))}normalize(t){return r.stripTrailingSlash($9(this._basePath,wB(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,l="",h=null){this._locationStrategy.pushState(h,"",t,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sc(l)),h)}replaceState(t,l="",h=null){this._locationStrategy.replaceState(h,"",t,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sc(l)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(l=>{this._notifyUrlChangeListeners(l.url,l.state)}),()=>{let l=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(l,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",l){this._urlChangeListeners.forEach(h=>h(t,l))}subscribe(t,l,h){return this._subject.subscribe({next:t,error:l??void 0,complete:h??void 0})}static normalizeQueryParams=Sc;static joinWithSlash=WC;static stripTrailingSlash=bB;static \u0275fac=function(l){return new(l||r)(dn(Tc))};static \u0275prov=Ft({token:r,factory:()=>j9(),providedIn:"root"})}return r})();function j9(){return new vu(dn(Tc))}function $9(r,n){if(!r||!n.startsWith(r))return n;let t=n.substring(r.length);return t===""||["/",";","?","#"].includes(t[0])?t:n}function wB(r){return r.replace(/\/index.html$/,"")}function H9(r){if(new RegExp("^(https?:)?//").test(r)){let[,t]=r.split(/\/\/[^\/]+/);return t}return r}var y2=(()=>{class r extends Tc{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(t,l){super(),this._platformLocation=t,l!=null&&(this._baseHref=l)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let l=this._platformLocation.hash??"#";return l.length>0?l.substring(1):l}prepareExternalUrl(t){let l=WC(this._baseHref,t);return l.length>0?"#"+l:l}pushState(t,l,h,i){let E=this.prepareExternalUrl(h+Sc(i))||this._platformLocation.pathname;this._platformLocation.pushState(t,l,E)}replaceState(t,l,h,i){let E=this.prepareExternalUrl(h+Sc(i))||this._platformLocation.pathname;this._platformLocation.replaceState(t,l,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(l){return new(l||r)(dn(By),dn(ZC,8))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})();var Vs=(function(r){return r[r.Format=0]="Format",r[r.Standalone=1]="Standalone",r})(Vs||{}),Ur=(function(r){return r[r.Narrow=0]="Narrow",r[r.Abbreviated=1]="Abbreviated",r[r.Wide=2]="Wide",r[r.Short=3]="Short",r})(Ur||{}),Ta=(function(r){return r[r.Short=0]="Short",r[r.Medium=1]="Medium",r[r.Long=2]="Long",r[r.Full=3]="Full",r})(Ta||{}),Id={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function AB(r){return Qa(r)[Po.LocaleId]}function PB(r,n,t){let l=Qa(r),h=[l[Po.DayPeriodsFormat],l[Po.DayPeriodsStandalone]],i=Ol(h,n);return Ol(i,t)}function OB(r,n,t){let l=Qa(r),h=[l[Po.DaysFormat],l[Po.DaysStandalone]],i=Ol(h,n);return Ol(i,t)}function RB(r,n,t){let l=Qa(r),h=[l[Po.MonthsFormat],l[Po.MonthsStandalone]],i=Ol(h,n);return Ol(i,t)}function kB(r,n){let l=Qa(r)[Po.Eras];return Ol(l,n)}function Vy(r,n){let t=Qa(r);return Ol(t[Po.DateFormat],n)}function Uy(r,n){let t=Qa(r);return Ol(t[Po.TimeFormat],n)}function jy(r,n){let l=Qa(r)[Po.DateTimeFormat];return Ol(l,n)}function $y(r,n){let t=Qa(r),l=t[Po.NumberSymbols][n];if(typeof l>"u"){if(n===Id.CurrencyDecimal)return t[Po.NumberSymbols][Id.Decimal];if(n===Id.CurrencyGroup)return t[Po.NumberSymbols][Id.Group]}return l}function FB(r){if(!r[Po.ExtraData])throw new sn(2303,!1)}function LB(r){let n=Qa(r);return FB(n),(n[Po.ExtraData][2]||[]).map(l=>typeof l=="string"?m2(l):[m2(l[0]),m2(l[1])])}function NB(r,n,t){let l=Qa(r);FB(l);let h=[l[Po.ExtraData][0],l[Po.ExtraData][1]],i=Ol(h,n)||[];return Ol(i,t)||[]}function Ol(r,n){for(let t=n;t>-1;t--)if(typeof r[t]<"u")return r[t];throw new sn(2304,!1)}function m2(r){let[n,t]=r.split(":");return{hours:+n,minutes:+t}}var G9=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,YC={},q9=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function zB(r,n,t,l){let h=t7(r);n=Td(t,n)||n;let E=[],O;for(;n;)if(O=q9.exec(n),O){E=E.concat(O.slice(1));let le=E.pop();if(!le)break;n=le}else{E.push(n);break}let N=h.getTimezoneOffset();l&&(N=VB(l,N),h=e7(h,l));let K="";return E.forEach(le=>{let De=Q9(le);K+=De?De(h,t,N):le==="''"?"'":le.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),K}function tE(r,n,t){let l=new Date(0);return l.setFullYear(r,n,t),l.setHours(0,0,0),l}function Td(r,n){let t=AB(r);if(YC[t]??={},YC[t][n])return YC[t][n];let l="";switch(n){case"shortDate":l=Vy(r,Ta.Short);break;case"mediumDate":l=Vy(r,Ta.Medium);break;case"longDate":l=Vy(r,Ta.Long);break;case"fullDate":l=Vy(r,Ta.Full);break;case"shortTime":l=Uy(r,Ta.Short);break;case"mediumTime":l=Uy(r,Ta.Medium);break;case"longTime":l=Uy(r,Ta.Long);break;case"fullTime":l=Uy(r,Ta.Full);break;case"short":let h=Td(r,"shortTime"),i=Td(r,"shortDate");l=KC(jy(r,Ta.Short),[h,i]);break;case"medium":let E=Td(r,"mediumTime"),O=Td(r,"mediumDate");l=KC(jy(r,Ta.Medium),[E,O]);break;case"long":let N=Td(r,"longTime"),K=Td(r,"longDate");l=KC(jy(r,Ta.Long),[N,K]);break;case"full":let le=Td(r,"fullTime"),De=Td(r,"fullDate");l=KC(jy(r,Ta.Full),[le,De]);break}return l&&(YC[t][n]=l),l}function KC(r,n){return n&&(r=r.replace(/\{([^}]+)}/g,function(t,l){return n!=null&&l in n?n[l]:t})),r}function Ic(r,n,t="-",l,h){let i="";(r<0||h&&r<=0)&&(h?r=-r+1:(r=-r,i=t));let E=String(r);for(;E.length<n;)E="0"+E;return l&&(E=E.slice(E.length-n)),i+E}function W9(r,n){return Ic(r,3).substring(0,n)}function Go(r,n,t=0,l=!1,h=!1){return function(i,E){let O=Z9(r,i);if((t>0||O>-t)&&(O+=t),r===3)O===0&&t===-12&&(O=12);else if(r===6)return W9(O,n);let N=$y(E,Id.MinusSign);return Ic(O,n,N,l,h)}}function Z9(r,n){switch(r){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new sn(2301,!1)}}function Qr(r,n,t=Vs.Format,l=!1){return function(h,i){return X9(h,i,r,n,t,l)}}function X9(r,n,t,l,h,i){switch(t){case 2:return RB(n,h,l)[r.getMonth()];case 1:return OB(n,h,l)[r.getDay()];case 0:let E=r.getHours(),O=r.getMinutes();if(i){let K=LB(n),le=NB(n,h,l),De=K.findIndex(Qe=>{if(Array.isArray(Qe)){let[Fe,gt]=Qe,jt=E>=Fe.hours&&O>=Fe.minutes,Ot=E<gt.hours||E===gt.hours&&O<gt.minutes;if(Fe.hours<gt.hours){if(jt&&Ot)return!0}else if(jt||Ot)return!0}else if(Qe.hours===E&&Qe.minutes===O)return!0;return!1});if(De!==-1)return le[De]}return PB(n,h,l)[E<12?0:1];case 3:return kB(n,l)[r.getFullYear()<=0?0:1];default:let N=t;throw new sn(2302,!1)}}function QC(r){return function(n,t,l){let h=-1*l,i=$y(t,Id.MinusSign),E=h>0?Math.floor(h/60):Math.ceil(h/60);switch(r){case 0:return(h>=0?"+":"")+Ic(E,2,i)+Ic(Math.abs(h%60),2,i);case 1:return"GMT"+(h>=0?"+":"")+Ic(E,1,i);case 2:return"GMT"+(h>=0?"+":"")+Ic(E,2,i)+":"+Ic(Math.abs(h%60),2,i);case 3:return l===0?"Z":(h>=0?"+":"")+Ic(E,2,i)+":"+Ic(Math.abs(h%60),2,i);default:throw new sn(2310,!1)}}}var Y9=0,eE=4;function K9(r){let n=tE(r,Y9,1).getDay();return tE(r,0,1+(n<=eE?eE:eE+7)-n)}function BB(r){let n=r.getDay(),t=n===0?-3:eE-n;return tE(r.getFullYear(),r.getMonth(),r.getDate()+t)}function g2(r,n=!1){return function(t,l){let h;if(n){let i=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,E=t.getDate();h=1+Math.floor((E+i)/7)}else{let i=BB(t),E=K9(i.getFullYear()),O=i.getTime()-E.getTime();h=1+Math.round(O/6048e5)}return Ic(h,r,$y(l,Id.MinusSign))}}function JC(r,n=!1){return function(t,l){let i=BB(t).getFullYear();return Ic(i,r,$y(l,Id.MinusSign),n)}}var _2={};function Q9(r){if(_2[r])return _2[r];let n;switch(r){case"G":case"GG":case"GGG":n=Qr(3,Ur.Abbreviated);break;case"GGGG":n=Qr(3,Ur.Wide);break;case"GGGGG":n=Qr(3,Ur.Narrow);break;case"y":n=Go(0,1,0,!1,!0);break;case"yy":n=Go(0,2,0,!0,!0);break;case"yyy":n=Go(0,3,0,!1,!0);break;case"yyyy":n=Go(0,4,0,!1,!0);break;case"Y":n=JC(1);break;case"YY":n=JC(2,!0);break;case"YYY":n=JC(3);break;case"YYYY":n=JC(4);break;case"M":case"L":n=Go(1,1,1);break;case"MM":case"LL":n=Go(1,2,1);break;case"MMM":n=Qr(2,Ur.Abbreviated);break;case"MMMM":n=Qr(2,Ur.Wide);break;case"MMMMM":n=Qr(2,Ur.Narrow);break;case"LLL":n=Qr(2,Ur.Abbreviated,Vs.Standalone);break;case"LLLL":n=Qr(2,Ur.Wide,Vs.Standalone);break;case"LLLLL":n=Qr(2,Ur.Narrow,Vs.Standalone);break;case"w":n=g2(1);break;case"ww":n=g2(2);break;case"W":n=g2(1,!0);break;case"d":n=Go(2,1);break;case"dd":n=Go(2,2);break;case"c":case"cc":n=Go(7,1);break;case"ccc":n=Qr(1,Ur.Abbreviated,Vs.Standalone);break;case"cccc":n=Qr(1,Ur.Wide,Vs.Standalone);break;case"ccccc":n=Qr(1,Ur.Narrow,Vs.Standalone);break;case"cccccc":n=Qr(1,Ur.Short,Vs.Standalone);break;case"E":case"EE":case"EEE":n=Qr(1,Ur.Abbreviated);break;case"EEEE":n=Qr(1,Ur.Wide);break;case"EEEEE":n=Qr(1,Ur.Narrow);break;case"EEEEEE":n=Qr(1,Ur.Short);break;case"a":case"aa":case"aaa":n=Qr(0,Ur.Abbreviated);break;case"aaaa":n=Qr(0,Ur.Wide);break;case"aaaaa":n=Qr(0,Ur.Narrow);break;case"b":case"bb":case"bbb":n=Qr(0,Ur.Abbreviated,Vs.Standalone,!0);break;case"bbbb":n=Qr(0,Ur.Wide,Vs.Standalone,!0);break;case"bbbbb":n=Qr(0,Ur.Narrow,Vs.Standalone,!0);break;case"B":case"BB":case"BBB":n=Qr(0,Ur.Abbreviated,Vs.Format,!0);break;case"BBBB":n=Qr(0,Ur.Wide,Vs.Format,!0);break;case"BBBBB":n=Qr(0,Ur.Narrow,Vs.Format,!0);break;case"h":n=Go(3,1,-12);break;case"hh":n=Go(3,2,-12);break;case"H":n=Go(3,1);break;case"HH":n=Go(3,2);break;case"m":n=Go(4,1);break;case"mm":n=Go(4,2);break;case"s":n=Go(5,1);break;case"ss":n=Go(5,2);break;case"S":n=Go(6,1);break;case"SS":n=Go(6,2);break;case"SSS":n=Go(6,3);break;case"Z":case"ZZ":case"ZZZ":n=QC(0);break;case"ZZZZZ":n=QC(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=QC(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=QC(2);break;default:return null}return _2[r]=n,n}function VB(r,n){r=r.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+r)/6e4;return isNaN(t)?n:t}function J9(r,n){return r=new Date(r.getTime()),r.setMinutes(r.getMinutes()+n),r}function e7(r,n,t){let h=r.getTimezoneOffset(),i=VB(n,h);return J9(r,-1*(i-h))}function t7(r){if(SB(r))return r;if(typeof r=="number"&&!isNaN(r))return new Date(r);if(typeof r=="string"){if(r=r.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(r)){let[h,i=1,E=1]=r.split("-").map(O=>+O);return tE(h,i-1,E)}let t=parseFloat(r);if(!isNaN(r-t))return new Date(t);let l;if(l=r.match(G9))return n7(l)}let n=new Date(r);if(!SB(n))throw new sn(2311,!1);return n}function n7(r){let n=new Date(0),t=0,l=0,h=r[8]?n.setUTCFullYear:n.setFullYear,i=r[8]?n.setUTCHours:n.setHours;r[9]&&(t=Number(r[9]+r[10]),l=Number(r[9]+r[11])),h.call(n,Number(r[1]),Number(r[2])-1,Number(r[3]));let E=Number(r[4]||0)-t,O=Number(r[5]||0)-l,N=Number(r[6]||0),K=Math.floor(parseFloat("0."+(r[7]||0))*1e3);return i.call(n,E,O,N,K),n}function SB(r){return r instanceof Date&&!isNaN(r.valueOf())}var v2=/\s+/,TB=[],x2=(()=>{class r{_ngEl;_renderer;initialClasses=TB;rawClass;stateMap=new Map;constructor(t,l){this._ngEl=t,this._renderer=l}set klass(t){this.initialClasses=t!=null?t.trim().split(v2):TB}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(v2):t}ngDoCheck(){for(let l of this.initialClasses)this._updateState(l,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let l of t)this._updateState(l,!0);else if(t!=null)for(let l of Object.keys(t))this._updateState(l,!!t[l]);this._applyStateDiff()}_updateState(t,l){let h=this.stateMap.get(t);h!==void 0?(h.enabled!==l&&(h.changed=!0,h.enabled=l),h.touched=!0):this.stateMap.set(t,{enabled:l,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let l=t[0],h=t[1];h.changed?(this._toggleClass(l,h.enabled),h.changed=!1):h.touched||(h.enabled&&this._toggleClass(l,!1),this.stateMap.delete(l)),h.touched=!1}}_toggleClass(t,l){t=t.trim(),t.length>0&&t.split(v2).forEach(h=>{l?this._renderer.addClass(this._ngEl.nativeElement,h):this._renderer.removeClass(this._ngEl.nativeElement,h)})}static \u0275fac=function(l){return new(l||r)(Bt(ir),Bt(sa))};static \u0275dir=fr({type:r,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return r})();var nE=class{$implicit;ngForOf;index;count;constructor(n,t,l,h){this.$implicit=n,this.ngForOf=t,this.index=l,this.count=h}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},u_=(()=>{class r{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,l,h){this._viewContainer=t,this._template=l,this._differs=h}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let l=this._viewContainer;t.forEachOperation((h,i,E)=>{if(h.previousIndex==null)l.createEmbeddedView(this._template,new nE(h.item,this._ngForOf,-1,-1),E===null?void 0:E);else if(E==null)l.remove(i===null?void 0:i);else if(i!==null){let O=l.get(i);l.move(O,E),IB(O,h)}});for(let h=0,i=l.length;h<i;h++){let O=l.get(h).context;O.index=h,O.count=i,O.ngForOf=this._ngForOf}t.forEachIdentityChange(h=>{let i=l.get(h.currentIndex);IB(i,h)})}static ngTemplateContextGuard(t,l){return!0}static \u0275fac=function(l){return new(l||r)(Bt(Ka),Bt(Xa),Bt(HC))};static \u0275dir=fr({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return r})();function IB(r,n){r.context.$implicit=n.item}var Ps=(()=>{class r{_viewContainer;_context=new iE;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,l){this._viewContainer=t,this._thenTemplateRef=l}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){MB(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){MB(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,l){return!0}static \u0275fac=function(l){return new(l||r)(Bt(Ka),Bt(Xa))};static \u0275dir=fr({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return r})(),iE=class{$implicit=null;ngIf=null};function MB(r,n){if(r&&!r.createEmbeddedView)throw new sn(2020,!1)}var Hy=(()=>{class r{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(t,l,h){this._ngEl=t,this._differs=l,this._renderer=h}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){let t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,l){let[h,i]=t.split("."),E=h.indexOf("-")===-1?void 0:wc.DashCase;l!=null?this._renderer.setStyle(this._ngEl.nativeElement,h,i?`${l}${i}`:l,E):this._renderer.removeStyle(this._ngEl.nativeElement,h,E)}_applyChanges(t){t.forEachRemovedItem(l=>this._setStyle(l.key,null)),t.forEachAddedItem(l=>this._setStyle(l.key,l.currentValue)),t.forEachChangedItem(l=>this._setStyle(l.key,l.currentValue))}static \u0275fac=function(l){return new(l||r)(Bt(ir),Bt(GC),Bt(sa))};static \u0275dir=fr({type:r,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return r})();function i7(r,n){return new sn(2100,!1)}var r7="mediumDate",UB=new Yt(""),jB=new Yt(""),b2=(()=>{class r{locale;defaultTimezone;defaultOptions;constructor(t,l,h){this.locale=t,this.defaultTimezone=l,this.defaultOptions=h}transform(t,l,h,i){if(t==null||t===""||t!==t)return null;try{let E=l??this.defaultOptions?.dateFormat??r7,O=h??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return zB(t,E,i||this.locale,O)}catch(E){throw i7(r,E.message)}}static \u0275fac=function(l){return new(l||r)(Bt(Fy,16),Bt(UB,24),Bt(jB,24))};static \u0275pipe=LC({name:"date",type:r,pure:!0})}return r})();function o7(r,n){return{key:r,value:n}}var w2=(()=>{class r{differs;constructor(t){this.differs=t}differ;keyValues=[];compareFn=DB;transform(t,l=DB){if(!t||!(t instanceof Map)&&typeof t!="object")return null;this.differ??=this.differs.find(t).create();let h=this.differ.diff(t),i=l!==this.compareFn;return h&&(this.keyValues=[],h.forEachItem(E=>{this.keyValues.push(o7(E.key,E.currentValue))})),(h||i)&&(l&&this.keyValues.sort(l),this.compareFn=l),this.keyValues}static \u0275fac=function(l){return new(l||r)(Bt(GC,16))};static \u0275pipe=LC({name:"keyvalue",type:r,pure:!1})}return r})();function DB(r,n){let t=r.key,l=n.key;if(t===l)return 0;if(t==null)return 1;if(l==null)return-1;if(typeof t=="string"&&typeof l=="string")return t<l?-1:1;if(typeof t=="number"&&typeof l=="number")return t-l;if(typeof t=="boolean"&&typeof l=="boolean")return t<l?-1:1;let h=String(t),i=String(l);return h==i?0:h<i?-1:1}var Li=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})();function Gy(r,n){n=encodeURIComponent(n);for(let t of r.split(";")){let l=t.indexOf("="),[h,i]=l==-1?[t,""]:[t.slice(0,l),t.slice(l+1)];if(h.trim()===n)return decodeURIComponent(i)}return null}var yf=class{};var E2="browser";function $B(r){return r===E2}var HB=(()=>{class r{static \u0275prov=Ft({token:r,providedIn:"root",factory:()=>new C2(Ve(si),window)})}return r})(),C2=class{document;window;offset=()=>[0,0];constructor(n,t){this.document=n,this.window=t}setOffset(n){Array.isArray(n)?this.offset=()=>n:this.offset=n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n,t){this.window.scrollTo(bi($t({},t),{left:n[0],top:n[1]}))}scrollToAnchor(n,t){let l=s7(this.document,n);l&&(this.scrollToElement(l,t),l.focus())}setHistoryScrollRestoration(n){try{this.window.history.scrollRestoration=n}catch{console.warn(ou(2400,!1))}}scrollToElement(n,t){let l=n.getBoundingClientRect(),h=l.left+this.window.pageXOffset,i=l.top+this.window.pageYOffset,E=this.offset();this.window.scrollTo(bi($t({},t),{left:h-E[0],top:i-E[1]}))}};function s7(r,n){let t=r.getElementById(n)||r.getElementsByName(n)[0];if(t)return t;if(typeof r.createTreeWalker=="function"&&r.body&&typeof r.body.attachShadow=="function"){let l=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT),h=l.currentNode;for(;h;){let i=h.shadowRoot;if(i){let E=i.getElementById(n)||i.querySelector(`[name="${n}"]`);if(E)return E}h=l.nextNode()}}return null}var qy=class{_doc;constructor(n){this._doc=n}manager},rE=(()=>{class r extends qy{constructor(t){super(t)}supports(t){return!0}addEventListener(t,l,h,i){return t.addEventListener(l,h,i),()=>this.removeEventListener(t,l,h,i)}removeEventListener(t,l,h,i){return t.removeEventListener(l,h,i)}static \u0275fac=function(l){return new(l||r)(dn(si))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),sE=new Yt(""),D2=(()=>{class r{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,l){this._zone=l,t.forEach(E=>{E.manager=this});let h=t.filter(E=>!(E instanceof rE));this._plugins=h.slice().reverse();let i=t.find(E=>E instanceof rE);i&&this._plugins.push(i)}addEventListener(t,l,h,i){return this._findPluginFor(l).addEventListener(t,l,h,i)}getZone(){return this._zone}_findPluginFor(t){let l=this._eventNameToPlugin.get(t);if(l)return l;if(l=this._plugins.find(i=>i.supports(t)),!l)throw new sn(5101,!1);return this._eventNameToPlugin.set(t,l),l}static \u0275fac=function(l){return new(l||r)(dn(sE),dn(yi))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),S2="ng-app-id";function GB(r){for(let n of r)n.remove()}function qB(r,n){let t=n.createElement("style");return t.textContent=r,t}function a7(r,n,t,l){let h=r.head?.querySelectorAll(`style[${S2}="${n}"],link[${S2}="${n}"]`);if(h)for(let i of h)i.removeAttribute(S2),i instanceof HTMLLinkElement?l.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&t.set(i.textContent,{usage:0,elements:[i]})}function I2(r,n){let t=n.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",r),t}var A2=(()=>{class r{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,l,h,i={}){this.doc=t,this.appId=l,this.nonce=h,a7(t,l,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,l){for(let h of t)this.addUsage(h,this.inline,qB);l?.forEach(h=>this.addUsage(h,this.external,I2))}removeStyles(t,l){for(let h of t)this.removeUsage(h,this.inline);l?.forEach(h=>this.removeUsage(h,this.external))}addUsage(t,l,h){let i=l.get(t);i?i.usage++:l.set(t,{usage:1,elements:[...this.hosts].map(E=>this.addElement(E,h(t,this.doc)))})}removeUsage(t,l){let h=l.get(t);h&&(h.usage--,h.usage<=0&&(GB(h.elements),l.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])GB(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[l,{elements:h}]of this.inline)h.push(this.addElement(t,qB(l,this.doc)));for(let[l,{elements:h}]of this.external)h.push(this.addElement(t,I2(l,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,l){return this.nonce&&l.setAttribute("nonce",this.nonce),t.appendChild(l)}static \u0275fac=function(l){return new(l||r)(dn(si),dn(r_),dn(o_,8),dn(gf))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),T2={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},P2=/%COMP%/g;var ZB="%COMP%",l7=`_nghost-${ZB}`,c7=`_ngcontent-${ZB}`,u7=!0,d7=new Yt("",{providedIn:"root",factory:()=>u7});function h7(r){return c7.replace(P2,r)}function p7(r){return l7.replace(P2,r)}function XB(r,n){return n.map(t=>t.replace(P2,r))}var O2=(()=>{class r{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,l,h,i,E,O,N=null,K=null){this.eventManager=t,this.sharedStylesHost=l,this.appId=h,this.removeStylesOnCompDestroy=i,this.doc=E,this.ngZone=O,this.nonce=N,this.tracingService=K,this.platformIsServer=!1,this.defaultRenderer=new Wy(t,E,O,this.platformIsServer,this.tracingService)}createRenderer(t,l){if(!t||!l)return this.defaultRenderer;let h=this.getOrCreateRenderer(t,l);return h instanceof oE?h.applyToHost(t):h instanceof Zy&&h.applyStyles(),h}getOrCreateRenderer(t,l){let h=this.rendererByCompId,i=h.get(l.id);if(!i){let E=this.doc,O=this.ngZone,N=this.eventManager,K=this.sharedStylesHost,le=this.removeStylesOnCompDestroy,De=this.platformIsServer,Qe=this.tracingService;switch(l.encapsulation){case yd.Emulated:i=new oE(N,K,l,this.appId,le,E,O,De,Qe);break;case yd.ShadowDom:return new M2(N,K,t,l,E,O,this.nonce,De,Qe);default:i=new Zy(N,K,l,le,E,O,De,Qe);break}h.set(l.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(l){return new(l||r)(dn(D2),dn(A2),dn(r_),dn(d7),dn(si),dn(yi),dn(o_),dn(_f,8))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),Wy=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,t,l,h,i){this.eventManager=n,this.doc=t,this.ngZone=l,this.platformIsServer=h,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,t){return t?this.doc.createElementNS(T2[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(WB(n)?n.content:n).appendChild(t)}insertBefore(n,t,l){n&&(WB(n)?n.content:n).insertBefore(t,l)}removeChild(n,t){t.remove()}selectRootElement(n,t){let l=typeof n=="string"?this.doc.querySelector(n):n;if(!l)throw new sn(-5104,!1);return t||(l.textContent=""),l}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,l,h){if(h){t=h+":"+t;let i=T2[h];i?n.setAttributeNS(i,t,l):n.setAttribute(t,l)}else n.setAttribute(t,l)}removeAttribute(n,t,l){if(l){let h=T2[l];h?n.removeAttributeNS(h,t):n.removeAttribute(`${l}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,l,h){h&(wc.DashCase|wc.Important)?n.style.setProperty(t,l,h&wc.Important?"important":""):n.style[t]=l}removeStyle(n,t,l){l&wc.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,l){n!=null&&(n[t]=l)}setValue(n,t){n.nodeValue=t}listen(n,t,l,h){if(typeof n=="string"&&(n=Pl().getGlobalEventTarget(this.doc,n),!n))throw new sn(5102,!1);let i=this.decoratePreventDefault(l);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,t,i)),this.eventManager.addEventListener(n,t,i,h)}decoratePreventDefault(n){return t=>{if(t==="__ngUnwrap__")return n;n(t)===!1&&t.preventDefault()}}};function WB(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var M2=class extends Wy{sharedStylesHost;hostEl;shadowRoot;constructor(n,t,l,h,i,E,O,N,K){super(n,i,E,N,K),this.sharedStylesHost=t,this.hostEl=l,this.shadowRoot=l.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let le=h.styles;le=XB(h.id,le);for(let Qe of le){let Fe=document.createElement("style");O&&Fe.setAttribute("nonce",O),Fe.textContent=Qe,this.shadowRoot.appendChild(Fe)}let De=h.getExternalStyles?.();if(De)for(let Qe of De){let Fe=I2(Qe,i);O&&Fe.setAttribute("nonce",O),this.shadowRoot.appendChild(Fe)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,l){return super.insertBefore(this.nodeOrShadowRoot(n),t,l)}removeChild(n,t){return super.removeChild(null,t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Zy=class extends Wy{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,t,l,h,i,E,O,N,K){super(n,i,E,O,N),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=h;let le=l.styles;this.styles=K?XB(K,le):le,this.styleUrls=l.getExternalStyles?.(K)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&ff.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},oE=class extends Zy{contentAttr;hostAttr;constructor(n,t,l,h,i,E,O,N,K){let le=h+"-"+l.id;super(n,t,l,i,E,O,N,K,le),this.contentAttr=h7(le),this.hostAttr=p7(le)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){let l=super.createElement(n,t);return super.setAttribute(l,this.contentAttr,""),l}};var aE=class r extends zy{supportsDOMEvents=!0;static makeCurrent(){p2(new r)}onAndCancel(n,t,l,h){return n.addEventListener(t,l,h),()=>{n.removeEventListener(t,l,h)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.remove()}createElement(n,t){return t=t||this.getDefaultDocument(),t.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return t==="window"?window:t==="document"?n:t==="body"?n.body:null}getBaseHref(n){let t=f7();return t==null?null:m7(t)}resetBaseElement(){Xy=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return Gy(document.cookie,n)}},Xy=null;function f7(){return Xy=Xy||document.head.querySelector("base"),Xy?Xy.getAttribute("href"):null}function m7(r){return new URL(r,document.baseURI).pathname}var g7=(()=>{class r{build(){return new XMLHttpRequest}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),YB=["alt","control","meta","shift"],_7={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},v7={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},KB=(()=>{class r extends qy{constructor(t){super(t)}supports(t){return r.parseEventName(t)!=null}addEventListener(t,l,h,i){let E=r.parseEventName(l),O=r.eventCallback(E.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Pl().onAndCancel(t,E.domEventName,O,i))}static parseEventName(t){let l=t.toLowerCase().split("."),h=l.shift();if(l.length===0||!(h==="keydown"||h==="keyup"))return null;let i=r._normalizeKey(l.pop()),E="",O=l.indexOf("code");if(O>-1&&(l.splice(O,1),E="code."),YB.forEach(K=>{let le=l.indexOf(K);le>-1&&(l.splice(le,1),E+=K+".")}),E+=i,l.length!=0||i.length===0)return null;let N={};return N.domEventName=h,N.fullKey=E,N}static matchEventFullKeyCode(t,l){let h=_7[t.key]||t.key,i="";return l.indexOf("code.")>-1&&(h=t.code,i="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),YB.forEach(E=>{if(E!==h){let O=v7[E];O(t)&&(i+=E+".")}}),i+=h,i===l)}static eventCallback(t,l,h){return i=>{r.matchEventFullKeyCode(i,t)&&h.runGuarded(()=>l(i))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(l){return new(l||r)(dn(si))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})();function R2(r,n,t){let l=$t({rootComponent:r,platformRef:t?.platformRef},y7(n));return yB(l)}function y7(r){return{appProviders:[...E7,...r?.providers??[]],platformProviders:C7}}function x7(){aE.makeCurrent()}function b7(){return new zs}function w7(){return _A(document),document}var C7=[{provide:gf,useValue:E2},{provide:CC,useValue:x7,multi:!0},{provide:si,useFactory:w7}];var E7=[{provide:oy,useValue:"root"},{provide:zs,useFactory:b7},{provide:sE,useClass:rE,multi:!0,deps:[si]},{provide:sE,useClass:KB,multi:!0,deps:[si]},O2,A2,D2,{provide:ps,useExisting:O2},{provide:yf,useClass:g7},[]];var h_=class{},Yy=class{},Ph=class r{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(t=>{let l=t.indexOf(":");if(l>0){let h=t.slice(0,l),i=t.slice(l+1).trim();this.addHeaderEntry(h,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,l)=>{this.addHeaderEntry(l,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,l])=>{this.setHeaderEntries(t,l)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof r?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){let t=new r;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof r?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){let t=n.name.toLowerCase();switch(n.op){case"a":case"s":let l=n.value;if(typeof l=="string"&&(l=[l]),l.length===0)return;this.maybeSetNormalizedName(n.name,t);let h=(n.op==="a"?this.headers.get(t):void 0)||[];h.push(...l),this.headers.set(t,h);break;case"d":let i=n.value;if(!i)this.headers.delete(t),this.normalizedNames.delete(t);else{let E=this.headers.get(t);if(!E)return;E=E.filter(O=>i.indexOf(O)===-1),E.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,E)}break}}addHeaderEntry(n,t){let l=n.toLowerCase();this.maybeSetNormalizedName(n,l),this.headers.has(l)?this.headers.get(l).push(t):this.headers.set(l,[t])}setHeaderEntries(n,t){let l=(Array.isArray(t)?t:[t]).map(i=>i.toString()),h=n.toLowerCase();this.headers.set(h,l),this.maybeSetNormalizedName(n,h)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}};var cE=class{encodeKey(n){return QB(n)}encodeValue(n){return QB(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function S7(r,n){let t=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(h=>{let i=h.indexOf("="),[E,O]=i==-1?[n.decodeKey(h),""]:[n.decodeKey(h.slice(0,i)),n.decodeValue(h.slice(i+1))],N=t.get(E)||[];N.push(O),t.set(E,N)}),t}var T7=/%(\d[a-f0-9])/gi,I7={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function QB(r){return encodeURIComponent(r).replace(T7,(n,t)=>I7[t]??n)}function lE(r){return`${r}`}var Md=class r{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new cE,n.fromString){if(n.fromObject)throw new sn(2805,!1);this.map=S7(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{let l=n.fromObject[t],h=Array.isArray(l)?l.map(lE):[lE(l)];this.map.set(t,h)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){let t=[];return Object.keys(n).forEach(l=>{let h=n[l];Array.isArray(h)?h.forEach(i=>{t.push({param:l,value:i,op:"a"})}):t.push({param:l,value:h,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let t=this.encoder.encodeKey(n);return this.map.get(n).map(l=>t+"="+this.encoder.encodeValue(l)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let t=new r({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let t=(n.op==="a"?this.map.get(n.param):void 0)||[];t.push(lE(n.value)),this.map.set(n.param,t);break;case"d":if(n.value!==void 0){let l=this.map.get(n.param)||[],h=l.indexOf(lE(n.value));h!==-1&&l.splice(h,1),l.length>0?this.map.set(n.param,l):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var uE=class{map=new Map;set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function M7(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function JB(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function eV(r){return typeof Blob<"u"&&r instanceof Blob}function tV(r){return typeof FormData<"u"&&r instanceof FormData}function D7(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}var nV="Content-Type",iV="Accept",rV="X-Request-URL",oV="text/plain",sV="application/json",A7=`${sV}, ${oV}, */*`,d_=class r{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(n,t,l,h){this.url=t,this.method=n.toUpperCase();let i;if(M7(this.method)||h?(this.body=l!==void 0?l:null,i=h):i=l,i){if(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,this.keepalive=!!i.keepalive,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),i.priority&&(this.priority=i.priority),i.cache&&(this.cache=i.cache),i.credentials&&(this.credentials=i.credentials),typeof i.timeout=="number"){if(i.timeout<1||!Number.isInteger(i.timeout))throw new sn(2822,"");this.timeout=i.timeout}i.mode&&(this.mode=i.mode),i.redirect&&(this.redirect=i.redirect),i.integrity&&(this.integrity=i.integrity),i.referrer&&(this.referrer=i.referrer),this.transferCache=i.transferCache}if(this.headers??=new Ph,this.context??=new uE,!this.params)this.params=new Md,this.urlWithParams=t;else{let E=this.params.toString();if(E.length===0)this.urlWithParams=t;else{let O=t.indexOf("?"),N=O===-1?"?":O<t.length-1?"&":"";this.urlWithParams=t+N+E}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||JB(this.body)||eV(this.body)||tV(this.body)||D7(this.body)?this.body:this.body instanceof Md?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||tV(this.body)?null:eV(this.body)?this.body.type||null:JB(this.body)?null:typeof this.body=="string"?oV:this.body instanceof Md?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?sV:null}clone(n={}){let t=n.method||this.method,l=n.url||this.url,h=n.responseType||this.responseType,i=n.keepalive??this.keepalive,E=n.priority||this.priority,O=n.cache||this.cache,N=n.mode||this.mode,K=n.redirect||this.redirect,le=n.credentials||this.credentials,De=n.referrer||this.referrer,Qe=n.integrity||this.integrity,Fe=n.transferCache??this.transferCache,gt=n.timeout??this.timeout,jt=n.body!==void 0?n.body:this.body,Ot=n.withCredentials??this.withCredentials,Kt=n.reportProgress??this.reportProgress,Hn=n.headers||this.headers,Er=n.params||this.params,_r=n.context??this.context;return n.setHeaders!==void 0&&(Hn=Object.keys(n.setHeaders).reduce((So,is)=>So.set(is,n.setHeaders[is]),Hn)),n.setParams&&(Er=Object.keys(n.setParams).reduce((So,is)=>So.set(is,n.setParams[is]),Er)),new r(t,l,jt,{params:Er,headers:Hn,context:_r,reportProgress:Kt,responseType:h,withCredentials:Ot,transferCache:Fe,keepalive:i,cache:O,priority:E,timeout:gt,mode:N,redirect:K,credentials:le,referrer:De,integrity:Qe})}},xf=(function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r})(xf||{}),p_=class{headers;status;statusText;url;ok;type;redirected;constructor(n,t=200,l="OK"){this.headers=n.headers||new Ph,this.status=n.status!==void 0?n.status:t,this.statusText=n.statusText||l,this.url=n.url||null,this.redirected=n.redirected,this.ok=this.status>=200&&this.status<300}},dE=class r extends p_{constructor(n={}){super(n)}type=xf.ResponseHeader;clone(n={}){return new r({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Ky=class r extends p_{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=xf.Response;clone(n={}){return new r({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0,redirected:n.redirected??this.redirected})}},Ah=class extends p_{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},P7=200,O7=204;function k2(r,n){return{body:n,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials,credentials:r.credentials,transferCache:r.transferCache,timeout:r.timeout,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,integrity:r.integrity,referrer:r.referrer}}var Eo=(()=>{class r{handler;constructor(t){this.handler=t}request(t,l,h={}){let i;if(t instanceof d_)i=t;else{let N;h.headers instanceof Ph?N=h.headers:N=new Ph(h.headers);let K;h.params&&(h.params instanceof Md?K=h.params:K=new Md({fromObject:h.params})),i=new d_(t,l,h.body!==void 0?h.body:null,{headers:N,context:h.context,params:K,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials,transferCache:h.transferCache,keepalive:h.keepalive,priority:h.priority,cache:h.cache,mode:h.mode,redirect:h.redirect,credentials:h.credentials,referrer:h.referrer,integrity:h.integrity,timeout:h.timeout})}let E=Dn(i).pipe(ru(N=>this.handler.handle(N)));if(t instanceof d_||h.observe==="events")return E;let O=E.pipe(xo(N=>N instanceof Ky));switch(h.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return O.pipe(Qn(N=>{if(N.body!==null&&!(N.body instanceof ArrayBuffer))throw new sn(2806,!1);return N.body}));case"blob":return O.pipe(Qn(N=>{if(N.body!==null&&!(N.body instanceof Blob))throw new sn(2807,!1);return N.body}));case"text":return O.pipe(Qn(N=>{if(N.body!==null&&typeof N.body!="string")throw new sn(2808,!1);return N.body}));case"json":default:return O.pipe(Qn(N=>N.body))}case"response":return O;default:throw new sn(2809,!1)}}delete(t,l={}){return this.request("DELETE",t,l)}get(t,l={}){return this.request("GET",t,l)}head(t,l={}){return this.request("HEAD",t,l)}jsonp(t,l){return this.request("JSONP",t,{params:new Md().append(l,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,l={}){return this.request("OPTIONS",t,l)}patch(t,l,h={}){return this.request("PATCH",t,k2(h,l))}post(t,l,h={}){return this.request("POST",t,k2(h,l))}put(t,l,h={}){return this.request("PUT",t,k2(h,l))}static \u0275fac=function(l){return new(l||r)(dn(h_))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})();var R7=new Yt("");function k7(r,n){return n(r)}function F7(r,n,t){return(l,h)=>hs(t,()=>n(l,i=>r(i,h)))}var L2=new Yt(""),aV=new Yt(""),lV=new Yt("",{providedIn:"root",factory:()=>!0});var hE=(()=>{class r extends h_{backend;injector;chain=null;pendingTasks=Ve(Ww);contributeToStability=Ve(lV);constructor(t,l){super(),this.backend=t,this.injector=l}handle(t){if(this.chain===null){let l=Array.from(new Set([...this.injector.get(L2),...this.injector.get(aV,[])]));this.chain=l.reduceRight((h,i)=>F7(h,i,this.injector),k7)}if(this.contributeToStability){let l=this.pendingTasks.add();return this.chain(t,h=>this.backend.handle(h)).pipe(hd(l))}else return this.chain(t,l=>this.backend.handle(l))}static \u0275fac=function(l){return new(l||r)(dn(Yy),dn(Hr))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})();var L7=/^\)\]\}',?\n/,N7=RegExp(`^${rV}:`,"m");function z7(r){return"responseURL"in r&&r.responseURL?r.responseURL:N7.test(r.getAllResponseHeaders())?r.getResponseHeader(rV):null}var F2=(()=>{class r{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new sn(-2800,!1);let l=this.xhrFactory;return Dn(null).pipe(_o(()=>new Pi(i=>{let E=l.build();if(E.open(t.method,t.urlWithParams),t.withCredentials&&(E.withCredentials=!0),t.headers.forEach((Ot,Kt)=>E.setRequestHeader(Ot,Kt.join(","))),t.headers.has(iV)||E.setRequestHeader(iV,A7),!t.headers.has(nV)){let Ot=t.detectContentTypeHeader();Ot!==null&&E.setRequestHeader(nV,Ot)}if(t.timeout&&(E.timeout=t.timeout),t.responseType){let Ot=t.responseType.toLowerCase();E.responseType=Ot!=="json"?Ot:"text"}let O=t.serializeBody(),N=null,K=()=>{if(N!==null)return N;let Ot=E.statusText||"OK",Kt=new Ph(E.getAllResponseHeaders()),Hn=z7(E)||t.url;return N=new dE({headers:Kt,status:E.status,statusText:Ot,url:Hn}),N},le=()=>{let{headers:Ot,status:Kt,statusText:Hn,url:Er}=K(),_r=null;Kt!==O7&&(_r=typeof E.response>"u"?E.responseText:E.response),Kt===0&&(Kt=_r?P7:0);let So=Kt>=200&&Kt<300;if(t.responseType==="json"&&typeof _r=="string"){let is=_r;_r=_r.replace(L7,"");try{_r=_r!==""?JSON.parse(_r):null}catch(zl){_r=is,So&&(So=!1,_r={error:zl,text:_r})}}So?(i.next(new Ky({body:_r,headers:Ot,status:Kt,statusText:Hn,url:Er||void 0})),i.complete()):i.error(new Ah({error:_r,headers:Ot,status:Kt,statusText:Hn,url:Er||void 0}))},De=Ot=>{let{url:Kt}=K(),Hn=new Ah({error:Ot,status:E.status||0,statusText:E.statusText||"Unknown Error",url:Kt||void 0});i.error(Hn)},Qe=De;t.timeout&&(Qe=Ot=>{let{url:Kt}=K(),Hn=new Ah({error:new DOMException("Request timed out","TimeoutError"),status:E.status||0,statusText:E.statusText||"Request timeout",url:Kt||void 0});i.error(Hn)});let Fe=!1,gt=Ot=>{Fe||(i.next(K()),Fe=!0);let Kt={type:xf.DownloadProgress,loaded:Ot.loaded};Ot.lengthComputable&&(Kt.total=Ot.total),t.responseType==="text"&&E.responseText&&(Kt.partialText=E.responseText),i.next(Kt)},jt=Ot=>{let Kt={type:xf.UploadProgress,loaded:Ot.loaded};Ot.lengthComputable&&(Kt.total=Ot.total),i.next(Kt)};return E.addEventListener("load",le),E.addEventListener("error",De),E.addEventListener("timeout",Qe),E.addEventListener("abort",De),t.reportProgress&&(E.addEventListener("progress",gt),O!==null&&E.upload&&E.upload.addEventListener("progress",jt)),E.send(O),i.next({type:xf.Sent}),()=>{E.removeEventListener("error",De),E.removeEventListener("abort",De),E.removeEventListener("load",le),E.removeEventListener("timeout",Qe),t.reportProgress&&(E.removeEventListener("progress",gt),O!==null&&E.upload&&E.upload.removeEventListener("progress",jt)),E.readyState!==E.DONE&&E.abort()}})))}static \u0275fac=function(l){return new(l||r)(dn(yf))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),cV=new Yt(""),B7="XSRF-TOKEN",V7=new Yt("",{providedIn:"root",factory:()=>B7}),U7="X-XSRF-TOKEN",j7=new Yt("",{providedIn:"root",factory:()=>U7}),Qy=class{},$7=(()=>{class r{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,l){this.doc=t,this.cookieName=l}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=Gy(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(l){return new(l||r)(dn(si),dn(V7))};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),H7=/^(?:https?:)?\/\//i;function G7(r,n){if(!Ve(cV)||r.method==="GET"||r.method==="HEAD"||H7.test(r.url))return n(r);let t=Ve(Qy).getToken(),l=Ve(j7);return t!=null&&!r.headers.has(l)&&(r=r.clone({headers:r.headers.set(l,t)})),n(r)}var N2=(function(r){return r[r.Interceptors=0]="Interceptors",r[r.LegacyInterceptors=1]="LegacyInterceptors",r[r.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",r[r.NoXsrfProtection=3]="NoXsrfProtection",r[r.JsonpSupport=4]="JsonpSupport",r[r.RequestsMadeViaParent=5]="RequestsMadeViaParent",r[r.Fetch=6]="Fetch",r})(N2||{});function q7(r,n){return{\u0275kind:r,\u0275providers:n}}function z2(...r){let n=[Eo,F2,hE,{provide:h_,useExisting:hE},{provide:Yy,useFactory:()=>Ve(R7,{optional:!0})??Ve(F2)},{provide:L2,useValue:G7,multi:!0},{provide:cV,useValue:!0},{provide:Qy,useClass:$7}];for(let t of r)n.push(...t.\u0275providers);return gc(n)}function B2(r){return q7(N2.Interceptors,r.map(n=>({provide:L2,useValue:n,multi:!0})))}var uV=(()=>{class r{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(l){return new(l||r)(dn(si))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var V2=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:function(l){let h=null;return l?h=new(l||r):h=dn(W7),h},providedIn:"root"})}return r})(),W7=(()=>{class r extends V2{_doc;constructor(t){super(),this._doc=t}sanitize(t,l){if(l==null)return null;switch(t){case Ms.NONE:return l;case Ms.HTML:return bd(l,"HTML")?Ml(l):CA(this._doc,String(l)).toString();case Ms.STYLE:return bd(l,"Style")?Ml(l):l;case Ms.SCRIPT:if(bd(l,"Script"))return Ml(l);throw new sn(5200,!1);case Ms.URL:return bd(l,"URL")?Ml(l):Sy(String(l));case Ms.RESOURCE_URL:if(bd(l,"ResourceURL"))return Ml(l);throw new sn(5201,!1);default:throw new sn(5202,!1)}}bypassSecurityTrustHtml(t){return vA(t)}bypassSecurityTrustStyle(t){return yA(t)}bypassSecurityTrustScript(t){return xA(t)}bypassSecurityTrustUrl(t){return bA(t)}bypassSecurityTrustResourceUrl(t){return wA(t)}static \u0275fac=function(l){return new(l||r)(dn(si))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ii="primary",dx=Symbol("RouteTitle"),G2=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){let t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Cf(r){return new G2(r)}function yV(r,n,t){let l=t.path.split("/");if(l.length>r.length||t.pathMatch==="full"&&(n.hasChildren()||l.length<r.length))return null;let h={};for(let i=0;i<l.length;i++){let E=l[i],O=r[i];if(E[0]===":")h[E.substring(1)]=O;else if(E!==O.path)return null}return{consumed:r.slice(0,l.length),posParams:h}}function Z7(r,n){if(r.length!==n.length)return!1;for(let t=0;t<r.length;++t)if(!xu(r[t],n[t]))return!1;return!0}function xu(r,n){let t=r?q2(r):void 0,l=n?q2(n):void 0;if(!t||!l||t.length!=l.length)return!1;let h;for(let i=0;i<t.length;i++)if(h=t[i],!xV(r[h],n[h]))return!1;return!0}function q2(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function xV(r,n){if(Array.isArray(r)&&Array.isArray(n)){if(r.length!==n.length)return!1;let t=[...r].sort(),l=[...n].sort();return t.every((h,i)=>l[i]===h)}else return r===n}function bV(r){return r.length>0?r[r.length-1]:null}function Dd(r){return _w(r)?r:Ih(r)?co(Promise.resolve(r)):Dn(r)}var X7={exact:CV,subset:EV},wV={exact:Y7,subset:K7,ignored:()=>!0};function hV(r,n,t){return X7[t.paths](r.root,n.root,t.matrixParams)&&wV[t.queryParams](r.queryParams,n.queryParams)&&!(t.fragment==="exact"&&r.fragment!==n.fragment)}function Y7(r,n){return xu(r,n)}function CV(r,n,t){if(!bf(r.segments,n.segments)||!mE(r.segments,n.segments,t)||r.numberOfChildren!==n.numberOfChildren)return!1;for(let l in n.children)if(!r.children[l]||!CV(r.children[l],n.children[l],t))return!1;return!0}function K7(r,n){return Object.keys(n).length<=Object.keys(r).length&&Object.keys(n).every(t=>xV(r[t],n[t]))}function EV(r,n,t){return SV(r,n,n.segments,t)}function SV(r,n,t,l){if(r.segments.length>t.length){let h=r.segments.slice(0,t.length);return!(!bf(h,t)||n.hasChildren()||!mE(h,t,l))}else if(r.segments.length===t.length){if(!bf(r.segments,t)||!mE(r.segments,t,l))return!1;for(let h in n.children)if(!r.children[h]||!EV(r.children[h],n.children[h],l))return!1;return!0}else{let h=t.slice(0,r.segments.length),i=t.slice(r.segments.length);return!bf(r.segments,h)||!mE(r.segments,h,l)||!r.children[Ii]?!1:SV(r.children[Ii],n,i,l)}}function mE(r,n,t){return n.every((l,h)=>wV[t](r[h].parameters,l.parameters))}var wu=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Dr([],{}),t={},l=null){this.root=n,this.queryParams=t,this.fragment=l}get queryParamMap(){return this._queryParamMap??=Cf(this.queryParams),this._queryParamMap}toString(){return eZ.serialize(this)}},Dr=class{segments;children;parent=null;constructor(n,t){this.segments=n,this.children=t,Object.values(t).forEach(l=>l.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return gE(this)}},Oh=class{path;parameters;_parameterMap;constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=Cf(this.parameters),this._parameterMap}toString(){return IV(this)}};function Q7(r,n){return bf(r,n)&&r.every((t,l)=>xu(t.parameters,n[l].parameters))}function bf(r,n){return r.length!==n.length?!1:r.every((t,l)=>t.path===n[l].path)}function J7(r,n){let t=[];return Object.entries(r.children).forEach(([l,h])=>{l===Ii&&(t=t.concat(n(h,l)))}),Object.entries(r.children).forEach(([l,h])=>{l!==Ii&&(t=t.concat(n(h,l)))}),t}var Ef=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>new Rh,providedIn:"root"})}return r})(),Rh=class{parse(n){let t=new Z2(n);return new wu(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){let t=`/${Jy(n.root,!0)}`,l=iZ(n.queryParams),h=typeof n.fragment=="string"?`#${tZ(n.fragment)}`:"";return`${t}${l}${h}`}},eZ=new Rh;function gE(r){return r.segments.map(n=>IV(n)).join("/")}function Jy(r,n){if(!r.hasChildren())return gE(r);if(n){let t=r.children[Ii]?Jy(r.children[Ii],!1):"",l=[];return Object.entries(r.children).forEach(([h,i])=>{h!==Ii&&l.push(`${h}:${Jy(i,!1)}`)}),l.length>0?`${t}(${l.join("//")})`:t}else{let t=J7(r,(l,h)=>h===Ii?[Jy(r.children[Ii],!1)]:[`${h}:${Jy(l,!1)}`]);return Object.keys(r.children).length===1&&r.children[Ii]!=null?`${gE(r)}/${t[0]}`:`${gE(r)}/(${t.join("//")})`}}function TV(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function pE(r){return TV(r).replace(/%3B/gi,";")}function tZ(r){return encodeURI(r)}function W2(r){return TV(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function _E(r){return decodeURIComponent(r)}function pV(r){return _E(r.replace(/\+/g,"%20"))}function IV(r){return`${W2(r.path)}${nZ(r.parameters)}`}function nZ(r){return Object.entries(r).map(([n,t])=>`;${W2(n)}=${W2(t)}`).join("")}function iZ(r){let n=Object.entries(r).map(([t,l])=>Array.isArray(l)?l.map(h=>`${pE(t)}=${pE(h)}`).join("&"):`${pE(t)}=${pE(l)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}var rZ=/^[^\/()?;#]+/;function U2(r){let n=r.match(rZ);return n?n[0]:""}var oZ=/^[^\/()?;=#]+/;function sZ(r){let n=r.match(oZ);return n?n[0]:""}var aZ=/^[^=?&#]+/;function lZ(r){let n=r.match(aZ);return n?n[0]:""}var cZ=/^[^&#]+/;function uZ(r){let n=r.match(cZ);return n?n[0]:""}var Z2=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Dr([],{}):new Dr([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let l={};return this.peekStartsWith("(")&&(l=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(l[Ii]=new Dr(n,t)),l}parseSegment(){let n=U2(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new sn(4009,!1);return this.capture(n),new Oh(_E(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let t=sZ(this.remaining);if(!t)return;this.capture(t);let l="";if(this.consumeOptional("=")){let h=U2(this.remaining);h&&(l=h,this.capture(l))}n[_E(t)]=_E(l)}parseQueryParam(n){let t=lZ(this.remaining);if(!t)return;this.capture(t);let l="";if(this.consumeOptional("=")){let E=uZ(this.remaining);E&&(l=E,this.capture(l))}let h=pV(t),i=pV(l);if(n.hasOwnProperty(h)){let E=n[h];Array.isArray(E)||(E=[E],n[h]=E),E.push(i)}else n[h]=i}parseParens(n){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let l=U2(this.remaining),h=this.remaining[l.length];if(h!=="/"&&h!==")"&&h!==";")throw new sn(4010,!1);let i;l.indexOf(":")>-1?(i=l.slice(0,l.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=Ii);let E=this.parseChildren();t[i??Ii]=Object.keys(E).length===1&&E[Ii]?E[Ii]:new Dr([],E),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new sn(4011,!1)}};function MV(r){return r.segments.length>0?new Dr([],{[Ii]:r}):r}function DV(r){let n={};for(let[l,h]of Object.entries(r.children)){let i=DV(h);if(l===Ii&&i.segments.length===0&&i.hasChildren())for(let[E,O]of Object.entries(i.children))n[E]=O;else(i.segments.length>0||i.hasChildren())&&(n[l]=i)}let t=new Dr(r.segments,n);return dZ(t)}function dZ(r){if(r.numberOfChildren===1&&r.children[Ii]){let n=r.children[Ii];return new Dr(r.segments.concat(n.segments),n.children)}return r}function kh(r){return r instanceof wu}function AV(r,n,t=null,l=null){let h=PV(r);return OV(h,n,t,l)}function PV(r){let n;function t(i){let E={};for(let N of i.children){let K=t(N);E[N.outlet]=K}let O=new Dr(i.url,E);return i===r&&(n=O),O}let l=t(r.root),h=MV(l);return n??h}function OV(r,n,t,l){let h=r;for(;h.parent;)h=h.parent;if(n.length===0)return j2(h,h,h,t,l);let i=hZ(n);if(i.toRoot())return j2(h,h,new Dr([],{}),t,l);let E=pZ(i,h,r),O=E.processChildren?tx(E.segmentGroup,E.index,i.commands):kV(E.segmentGroup,E.index,i.commands);return j2(h,E.segmentGroup,O,t,l)}function vE(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function ix(r){return typeof r=="object"&&r!=null&&r.outlets}function j2(r,n,t,l,h){let i={};l&&Object.entries(l).forEach(([N,K])=>{i[N]=Array.isArray(K)?K.map(le=>`${le}`):`${K}`});let E;r===n?E=t:E=RV(r,n,t);let O=MV(DV(E));return new wu(O,i,h)}function RV(r,n,t){let l={};return Object.entries(r.children).forEach(([h,i])=>{i===n?l[h]=t:l[h]=RV(i,n,t)}),new Dr(r.segments,l)}var yE=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,t,l){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=l,n&&l.length>0&&vE(l[0]))throw new sn(4003,!1);let h=l.find(ix);if(h&&h!==bV(l))throw new sn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function hZ(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new yE(!0,0,r);let n=0,t=!1,l=r.reduce((h,i,E)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let O={};return Object.entries(i.outlets).forEach(([N,K])=>{O[N]=typeof K=="string"?K.split("/"):K}),[...h,{outlets:O}]}if(i.segmentPath)return[...h,i.segmentPath]}return typeof i!="string"?[...h,i]:E===0?(i.split("/").forEach((O,N)=>{N==0&&O==="."||(N==0&&O===""?t=!0:O===".."?n++:O!=""&&h.push(O))}),h):[...h,i]},[]);return new yE(t,n,l)}var g_=class{segmentGroup;processChildren;index;constructor(n,t,l){this.segmentGroup=n,this.processChildren=t,this.index=l}};function pZ(r,n,t){if(r.isAbsolute)return new g_(n,!0,0);if(!t)return new g_(n,!1,NaN);if(t.parent===null)return new g_(t,!0,0);let l=vE(r.commands[0])?0:1,h=t.segments.length-1+l;return fZ(t,h,r.numberOfDoubleDots)}function fZ(r,n,t){let l=r,h=n,i=t;for(;i>h;){if(i-=h,l=l.parent,!l)throw new sn(4005,!1);h=l.segments.length}return new g_(l,!1,h-i)}function mZ(r){return ix(r[0])?r[0].outlets:{[Ii]:r}}function kV(r,n,t){if(r??=new Dr([],{}),r.segments.length===0&&r.hasChildren())return tx(r,n,t);let l=gZ(r,n,t),h=t.slice(l.commandIndex);if(l.match&&l.pathIndex<r.segments.length){let i=new Dr(r.segments.slice(0,l.pathIndex),{});return i.children[Ii]=new Dr(r.segments.slice(l.pathIndex),r.children),tx(i,0,h)}else return l.match&&h.length===0?new Dr(r.segments,{}):l.match&&!r.hasChildren()?X2(r,n,t):l.match?tx(r,0,h):X2(r,n,t)}function tx(r,n,t){if(t.length===0)return new Dr(r.segments,{});{let l=mZ(t),h={};if(Object.keys(l).some(i=>i!==Ii)&&r.children[Ii]&&r.numberOfChildren===1&&r.children[Ii].segments.length===0){let i=tx(r.children[Ii],n,t);return new Dr(r.segments,i.children)}return Object.entries(l).forEach(([i,E])=>{typeof E=="string"&&(E=[E]),E!==null&&(h[i]=kV(r.children[i],n,E))}),Object.entries(r.children).forEach(([i,E])=>{l[i]===void 0&&(h[i]=E)}),new Dr(r.segments,h)}}function gZ(r,n,t){let l=0,h=n,i={match:!1,pathIndex:0,commandIndex:0};for(;h<r.segments.length;){if(l>=t.length)return i;let E=r.segments[h],O=t[l];if(ix(O))break;let N=`${O}`,K=l<t.length-1?t[l+1]:null;if(h>0&&N===void 0)break;if(N&&K&&typeof K=="object"&&K.outlets===void 0){if(!mV(N,K,E))return i;l+=2}else{if(!mV(N,{},E))return i;l++}h++}return{match:!0,pathIndex:h,commandIndex:l}}function X2(r,n,t){let l=r.segments.slice(0,n),h=0;for(;h<t.length;){let i=t[h];if(ix(i)){let N=_Z(i.outlets);return new Dr(l,N)}if(h===0&&vE(t[0])){let N=r.segments[n];l.push(new Oh(N.path,fV(t[0]))),h++;continue}let E=ix(i)?i.outlets[Ii]:`${i}`,O=h<t.length-1?t[h+1]:null;E&&O&&vE(O)?(l.push(new Oh(E,fV(O))),h+=2):(l.push(new Oh(E,{})),h++)}return new Dr(l,{})}function _Z(r){let n={};return Object.entries(r).forEach(([t,l])=>{typeof l=="string"&&(l=[l]),l!==null&&(n[t]=X2(new Dr([],{}),0,l))}),n}function fV(r){let n={};return Object.entries(r).forEach(([t,l])=>n[t]=`${l}`),n}function mV(r,n,t){return r==t.path&&xu(n,t.parameters)}var __="imperative",ts=(function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r})(ts||{}),el=class{id;url;constructor(n,t){this.id=n,this.url=t}},Fh=class extends el{type=ts.NavigationStart;navigationTrigger;restoredState;constructor(n,t,l="imperative",h=null){super(n,t),this.navigationTrigger=l,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},kl=class extends el{urlAfterRedirects;type=ts.NavigationEnd;constructor(n,t,l){super(n,t),this.urlAfterRedirects=l}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ua=(function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r[r.Aborted=4]="Aborted",r})(ua||{}),y_=(function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r})(y_||{}),bu=class extends el{reason;code;type=ts.NavigationCancel;constructor(n,t,l,h){super(n,t),this.reason=l,this.code=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Cu=class extends el{reason;code;type=ts.NavigationSkipped;constructor(n,t,l,h){super(n,t),this.reason=l,this.code=h}},x_=class extends el{error;target;type=ts.NavigationError;constructor(n,t,l,h){super(n,t),this.error=l,this.target=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},rx=class extends el{urlAfterRedirects;state;type=ts.RoutesRecognized;constructor(n,t,l,h){super(n,t),this.urlAfterRedirects=l,this.state=h}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xE=class extends el{urlAfterRedirects;state;type=ts.GuardsCheckStart;constructor(n,t,l,h){super(n,t),this.urlAfterRedirects=l,this.state=h}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bE=class extends el{urlAfterRedirects;state;shouldActivate;type=ts.GuardsCheckEnd;constructor(n,t,l,h,i){super(n,t),this.urlAfterRedirects=l,this.state=h,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},wE=class extends el{urlAfterRedirects;state;type=ts.ResolveStart;constructor(n,t,l,h){super(n,t),this.urlAfterRedirects=l,this.state=h}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},CE=class extends el{urlAfterRedirects;state;type=ts.ResolveEnd;constructor(n,t,l,h){super(n,t),this.urlAfterRedirects=l,this.state=h}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},EE=class{route;type=ts.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},SE=class{route;type=ts.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},TE=class{snapshot;type=ts.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},IE=class{snapshot;type=ts.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ME=class{snapshot;type=ts.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},DE=class{snapshot;type=ts.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},b_=class{routerEvent;position;anchor;type=ts.Scroll;constructor(n,t,l){this.routerEvent=n,this.position=t,this.anchor=l}toString(){let n=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${n}')`}},ox=class{},w_=class{url;navigationBehaviorOptions;constructor(n,t){this.url=n,this.navigationBehaviorOptions=t}};function vZ(r){return!(r instanceof ox)&&!(r instanceof w_)}function yZ(r,n){return r.providers&&!r._injector&&(r._injector=a_(r.providers,n,`Route: ${r.path}`)),r._injector??n}function Mc(r){return r.outlet||Ii}function xZ(r,n){let t=r.filter(l=>Mc(l)===n);return t.push(...r.filter(l=>Mc(l)!==n)),t}function S_(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let n=r.parent;n;n=n.parent){let t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var AE=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return S_(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new Sf(this.rootInjector)}},Sf=(()=>{class r{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,l){let h=this.getOrCreateContext(t);h.outlet=l,this.contexts.set(t,h)}onChildOutletDestroyed(t){let l=this.getContext(t);l&&(l.outlet=null,l.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let l=this.getContext(t);return l||(l=new AE(this.rootInjector),this.contexts.set(t,l)),l}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(l){return new(l||r)(dn(Hr))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),PE=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){let t=Y2(n,this._root);return t?t.children.map(l=>l.value):[]}firstChild(n){let t=Y2(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){let t=K2(n,this._root);return t.length<2?[]:t[t.length-2].children.map(h=>h.value).filter(h=>h!==n)}pathFromRoot(n){return K2(n,this._root).map(t=>t.value)}};function Y2(r,n){if(r===n.value)return n;for(let t of n.children){let l=Y2(r,t);if(l)return l}return null}function K2(r,n){if(r===n.value)return[n];for(let t of n.children){let l=K2(r,t);if(l.length)return l.unshift(n),l}return[]}var Ja=class{value;children;constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}};function m_(r){let n={};return r&&r.children.forEach(t=>n[t.value.outlet]=t),n}var sx=class extends PE{snapshot;constructor(n,t){super(n),this.snapshot=t,oP(this,n)}toString(){return this.snapshot.toString()}};function FV(r){let n=bZ(r),t=new Qo([new Oh("",{})]),l=new Qo({}),h=new Qo({}),i=new Qo({}),E=new Qo(""),O=new Ia(t,l,i,E,h,Ii,r,n.root);return O.snapshot=n.root,new sx(new Ja(O,[]),n)}function bZ(r){let n={},t={},l={},i=new wf([],n,l,"",t,Ii,r,null,{});return new ax("",new Ja(i,[]))}var Ia=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,t,l,h,i,E,O,N){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=l,this.fragmentSubject=h,this.dataSubject=i,this.outlet=E,this.component=O,this._futureSnapshot=N,this.title=this.dataSubject?.pipe(Qn(K=>K[dx]))??Dn(void 0),this.url=n,this.params=t,this.queryParams=l,this.fragment=h,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Qn(n=>Cf(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Qn(n=>Cf(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function OE(r,n,t="emptyOnly"){let l,{routeConfig:h}=r;return n!==null&&(t==="always"||h?.path===""||!n.component&&!n.routeConfig?.loadComponent)?l={params:$t($t({},n.params),r.params),data:$t($t({},n.data),r.data),resolve:$t($t($t($t({},r.data),n.data),h?.data),r._resolvedData)}:l={params:$t({},r.params),data:$t({},r.data),resolve:$t($t({},r.data),r._resolvedData??{})},h&&NV(h)&&(l.resolve[dx]=h.title),l}var wf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[dx]}constructor(n,t,l,h,i,E,O,N,K){this.url=n,this.params=t,this.queryParams=l,this.fragment=h,this.data=i,this.outlet=E,this.component=O,this.routeConfig=N,this._resolve=K}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Cf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Cf(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(l=>l.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${t}')`}},ax=class extends PE{url;constructor(n,t){super(t),this.url=n,oP(this,t)}toString(){return LV(this._root)}};function oP(r,n){n.value._routerState=r,n.children.forEach(t=>oP(r,t))}function LV(r){let n=r.children.length>0?` { ${r.children.map(LV).join(", ")} } `:"";return`${r.value}${n}`}function $2(r){if(r.snapshot){let n=r.snapshot,t=r._futureSnapshot;r.snapshot=t,xu(n.queryParams,t.queryParams)||r.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&r.fragmentSubject.next(t.fragment),xu(n.params,t.params)||r.paramsSubject.next(t.params),Z7(n.url,t.url)||r.urlSubject.next(t.url),xu(n.data,t.data)||r.dataSubject.next(t.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function Q2(r,n){let t=xu(r.params,n.params)&&Q7(r.url,n.url),l=!r.parent!=!n.parent;return t&&!l&&(!r.parent||Q2(r.parent,n.parent))}function NV(r){return typeof r.title=="string"||r.title===null}var zV=new Yt(""),hx=(()=>{class r{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Ii;activateEvents=new Zt;deactivateEvents=new Zt;attachEvents=new Zt;detachEvents=new Zt;routerOutletData=ro();parentContexts=Ve(Sf);location=Ve(Ka);changeDetector=Ve(_u);inputBinder=Ve(px,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:l,previousValue:h}=t.name;if(l)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new sn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new sn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new sn(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,l){this.activated=t,this._activatedRoute=l,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,l){if(this.isActivated)throw new sn(4013,!1);this._activatedRoute=t;let h=this.location,E=t.snapshot.component,O=this.parentContexts.getOrCreateContext(this.name).children,N=new J2(t,O,h.injector,this.routerOutletData);this.activated=h.createComponent(E,{index:h.length,injector:N,environmentInjector:l}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Vr]})}return r})(),J2=class{route;childContexts;parent;outletData;constructor(n,t,l,h){this.route=n,this.childContexts=t,this.parent=l,this.outletData=h}get(n,t){return n===Ia?this.route:n===Sf?this.childContexts:n===zV?this.outletData:this.parent.get(n,t)}},px=new Yt(""),sP=(()=>{class r{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:l}=t,h=Kp([l.queryParams,l.params,l.data]).pipe(_o(([i,E,O],N)=>(O=$t($t($t({},i),E),O),N===0?Dn(O):Promise.resolve(O)))).subscribe(i=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==l||l.component===null){this.unsubscribeFromRouteData(t);return}let E=xB(l.component);if(!E){this.unsubscribeFromRouteData(t);return}for(let{templateName:O}of E.inputs)t.activatedComponentRef.setInput(O,i[O])});this.outletDataSubscriptions.set(t,h)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})(),aP=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(l,h){l&1&&Mn(0,"router-outlet")},dependencies:[hx],encapsulation:2})}return r})();function lP(r){let n=r.children&&r.children.map(lP),t=n?bi($t({},r),{children:n}):$t({},r);return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ii&&(t.component=aP),t}function wZ(r,n,t){let l=lx(r,n._root,t?t._root:void 0);return new sx(l,n)}function lx(r,n,t){if(t&&r.shouldReuseRoute(n.value,t.value.snapshot)){let l=t.value;l._futureSnapshot=n.value;let h=CZ(r,n,t);return new Ja(l,h)}else{if(r.shouldAttach(n.value)){let i=r.retrieve(n.value);if(i!==null){let E=i.route;return E.value._futureSnapshot=n.value,E.children=n.children.map(O=>lx(r,O)),E}}let l=EZ(n.value),h=n.children.map(i=>lx(r,i));return new Ja(l,h)}}function CZ(r,n,t){return n.children.map(l=>{for(let h of t.children)if(r.shouldReuseRoute(l.value,h.value.snapshot))return lx(r,l,h);return lx(r,l)})}function EZ(r){return new Ia(new Qo(r.url),new Qo(r.params),new Qo(r.queryParams),new Qo(r.fragment),new Qo(r.data),r.outlet,r.component,r)}var C_=class{redirectTo;navigationBehaviorOptions;constructor(n,t){this.redirectTo=n,this.navigationBehaviorOptions=t}},BV="ngNavigationCancelingError";function RE(r,n){let{redirectTo:t,navigationBehaviorOptions:l}=kh(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,h=VV(!1,ua.Redirect);return h.url=t,h.navigationBehaviorOptions=l,h}function VV(r,n){let t=new Error(`NavigationCancelingError: ${r||""}`);return t[BV]=!0,t.cancellationCode=n,t}function SZ(r){return UV(r)&&kh(r.url)}function UV(r){return!!r&&r[BV]}var TZ=(r,n,t,l)=>Qn(h=>(new eP(n,h.targetRouterState,h.currentRouterState,t,l).activate(r),h)),eP=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,t,l,h,i){this.routeReuseStrategy=n,this.futureState=t,this.currState=l,this.forwardEvent=h,this.inputBindingEnabled=i}activate(n){let t=this.futureState._root,l=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,l,n),$2(this.futureState.root),this.activateChildRoutes(t,l,n)}deactivateChildRoutes(n,t,l){let h=m_(t);n.children.forEach(i=>{let E=i.value.outlet;this.deactivateRoutes(i,h[E],l),delete h[E]}),Object.values(h).forEach(i=>{this.deactivateRouteAndItsChildren(i,l)})}deactivateRoutes(n,t,l){let h=n.value,i=t?t.value:null;if(h===i)if(h.component){let E=l.getContext(h.outlet);E&&this.deactivateChildRoutes(n,t,E.children)}else this.deactivateChildRoutes(n,t,l);else i&&this.deactivateRouteAndItsChildren(t,l)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){let l=t.getContext(n.value.outlet),h=l&&n.value.component?l.children:t,i=m_(n);for(let E of Object.values(i))this.deactivateRouteAndItsChildren(E,h);if(l&&l.outlet){let E=l.outlet.detach(),O=l.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:E,route:n,contexts:O})}}deactivateRouteAndOutlet(n,t){let l=t.getContext(n.value.outlet),h=l&&n.value.component?l.children:t,i=m_(n);for(let E of Object.values(i))this.deactivateRouteAndItsChildren(E,h);l&&(l.outlet&&(l.outlet.deactivate(),l.children.onOutletDeactivated()),l.attachRef=null,l.route=null)}activateChildRoutes(n,t,l){let h=m_(t);n.children.forEach(i=>{this.activateRoutes(i,h[i.value.outlet],l),this.forwardEvent(new DE(i.value.snapshot))}),n.children.length&&this.forwardEvent(new IE(n.value.snapshot))}activateRoutes(n,t,l){let h=n.value,i=t?t.value:null;if($2(h),h===i)if(h.component){let E=l.getOrCreateContext(h.outlet);this.activateChildRoutes(n,t,E.children)}else this.activateChildRoutes(n,t,l);else if(h.component){let E=l.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let O=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),E.children.onOutletReAttached(O.contexts),E.attachRef=O.componentRef,E.route=O.route.value,E.outlet&&E.outlet.attach(O.componentRef,O.route.value),$2(O.route.value),this.activateChildRoutes(n,null,E.children)}else E.attachRef=null,E.route=h,E.outlet&&E.outlet.activateWith(h,E.injector),this.activateChildRoutes(n,null,E.children)}else this.activateChildRoutes(n,null,l)}},kE=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},v_=class{component;route;constructor(n,t){this.component=n,this.route=t}};function IZ(r,n,t){let l=r._root,h=n?n._root:null;return ex(l,h,t,[l.value])}function MZ(r){let n=r.routeConfig?r.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:r,guards:n}}function T_(r,n){let t=Symbol(),l=n.get(r,t);return l===t?typeof r=="function"&&!SM(r)?r:n.get(r):l}function ex(r,n,t,l,h={canDeactivateChecks:[],canActivateChecks:[]}){let i=m_(n);return r.children.forEach(E=>{DZ(E,i[E.value.outlet],t,l.concat([E.value]),h),delete i[E.value.outlet]}),Object.entries(i).forEach(([E,O])=>nx(O,t.getContext(E),h)),h}function DZ(r,n,t,l,h={canDeactivateChecks:[],canActivateChecks:[]}){let i=r.value,E=n?n.value:null,O=t?t.getContext(r.value.outlet):null;if(E&&i.routeConfig===E.routeConfig){let N=AZ(E,i,i.routeConfig.runGuardsAndResolvers);N?h.canActivateChecks.push(new kE(l)):(i.data=E.data,i._resolvedData=E._resolvedData),i.component?ex(r,n,O?O.children:null,l,h):ex(r,n,t,l,h),N&&O&&O.outlet&&O.outlet.isActivated&&h.canDeactivateChecks.push(new v_(O.outlet.component,E))}else E&&nx(n,O,h),h.canActivateChecks.push(new kE(l)),i.component?ex(r,null,O?O.children:null,l,h):ex(r,null,t,l,h);return h}function AZ(r,n,t){if(typeof t=="function")return t(r,n);switch(t){case"pathParamsChange":return!bf(r.url,n.url);case"pathParamsOrQueryParamsChange":return!bf(r.url,n.url)||!xu(r.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Q2(r,n)||!xu(r.queryParams,n.queryParams);case"paramsChange":default:return!Q2(r,n)}}function nx(r,n,t){let l=m_(r),h=r.value;Object.entries(l).forEach(([i,E])=>{h.component?n?nx(E,n.children.getContext(i),t):nx(E,null,t):nx(E,n,t)}),h.component?n&&n.outlet&&n.outlet.isActivated?t.canDeactivateChecks.push(new v_(n.outlet.component,h)):t.canDeactivateChecks.push(new v_(null,h)):t.canDeactivateChecks.push(new v_(null,h))}function fx(r){return typeof r=="function"}function PZ(r){return typeof r=="boolean"}function OZ(r){return r&&fx(r.canLoad)}function RZ(r){return r&&fx(r.canActivate)}function kZ(r){return r&&fx(r.canActivateChild)}function FZ(r){return r&&fx(r.canDeactivate)}function LZ(r){return r&&fx(r.canMatch)}function jV(r){return r instanceof dd||r?.name==="EmptyError"}var fE=Symbol("INITIAL_VALUE");function E_(){return _o(r=>Kp(r.map(n=>n.pipe(Wa(1),Ug(fE)))).pipe(Qn(n=>{for(let t of n)if(t!==!0){if(t===fE)return fE;if(t===!1||NZ(t))return t}return!0}),xo(n=>n!==fE),Wa(1)))}function NZ(r){return kh(r)||r instanceof C_}function zZ(r,n){return Do(t=>{let{targetSnapshot:l,currentSnapshot:h,guards:{canActivateChecks:i,canDeactivateChecks:E}}=t;return E.length===0&&i.length===0?Dn(bi($t({},t),{guardsResult:!0})):BZ(E,l,h,r).pipe(Do(O=>O&&PZ(O)?VZ(l,i,r,n):Dn(O)),Qn(O=>bi($t({},t),{guardsResult:O})))})}function BZ(r,n,t,l){return co(r).pipe(Do(h=>GZ(h.component,h.route,t,n,l)),pd(h=>h!==!0,!0))}function VZ(r,n,t,l){return co(n).pipe(ru(h=>mh(jZ(h.route.parent,l),UZ(h.route,l),HZ(r,h.path,t),$Z(r,h.route,t))),pd(h=>h!==!0,!0))}function UZ(r,n){return r!==null&&n&&n(new ME(r)),Dn(!0)}function jZ(r,n){return r!==null&&n&&n(new TE(r)),Dn(!0)}function $Z(r,n,t){let l=n.routeConfig?n.routeConfig.canActivate:null;if(!l||l.length===0)return Dn(!0);let h=l.map(i=>Y0(()=>{let E=S_(n)??t,O=T_(i,E),N=RZ(O)?O.canActivate(n,r):hs(E,()=>O(n,r));return Dd(N).pipe(pd())}));return Dn(h).pipe(E_())}function HZ(r,n,t){let l=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(E=>MZ(E)).filter(E=>E!==null).map(E=>Y0(()=>{let O=E.guards.map(N=>{let K=S_(E.node)??t,le=T_(N,K),De=kZ(le)?le.canActivateChild(l,r):hs(K,()=>le(l,r));return Dd(De).pipe(pd())});return Dn(O).pipe(E_())}));return Dn(i).pipe(E_())}function GZ(r,n,t,l,h){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return Dn(!0);let E=i.map(O=>{let N=S_(n)??h,K=T_(O,N),le=FZ(K)?K.canDeactivate(r,n,t,l):hs(N,()=>K(r,n,t,l));return Dd(le).pipe(pd())});return Dn(E).pipe(E_())}function qZ(r,n,t,l){let h=n.canLoad;if(h===void 0||h.length===0)return Dn(!0);let i=h.map(E=>{let O=T_(E,r),N=OZ(O)?O.canLoad(n,t):hs(r,()=>O(n,t));return Dd(N)});return Dn(i).pipe(E_(),$V(l))}function $V(r){return rM(bo(n=>{if(typeof n!="boolean")throw RE(r,n)}),Qn(n=>n===!0))}function WZ(r,n,t,l){let h=n.canMatch;if(!h||h.length===0)return Dn(!0);let i=h.map(E=>{let O=T_(E,r),N=LZ(O)?O.canMatch(n,t):hs(r,()=>O(n,t));return Dd(N)});return Dn(i).pipe(E_(),$V(l))}var cx=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},ux=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function f_(r){return fc(new cx(r))}function ZZ(r){return fc(new sn(4e3,!1))}function XZ(r){return fc(VV(!1,ua.GuardRejected))}var tP=class{urlSerializer;urlTree;constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let l=[],h=t.root;for(;;){if(l=l.concat(h.segments),h.numberOfChildren===0)return Dn(l);if(h.numberOfChildren>1||!h.children[Ii])return ZZ(`${n.redirectTo}`);h=h.children[Ii]}}applyRedirectCommands(n,t,l,h,i){return YZ(t,h,i).pipe(Qn(E=>{if(E instanceof wu)throw new ux(E);let O=this.applyRedirectCreateUrlTree(E,this.urlSerializer.parse(E),n,l);if(E[0]==="/")throw new ux(O);return O}))}applyRedirectCreateUrlTree(n,t,l,h){let i=this.createSegmentGroup(n,t.root,l,h);return new wu(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){let l={};return Object.entries(n).forEach(([h,i])=>{if(typeof i=="string"&&i[0]===":"){let O=i.substring(1);l[h]=t[O]}else l[h]=i}),l}createSegmentGroup(n,t,l,h){let i=this.createSegments(n,t.segments,l,h),E={};return Object.entries(t.children).forEach(([O,N])=>{E[O]=this.createSegmentGroup(n,N,l,h)}),new Dr(i,E)}createSegments(n,t,l,h){return t.map(i=>i.path[0]===":"?this.findPosParam(n,i,h):this.findOrReturn(i,l))}findPosParam(n,t,l){let h=l[t.path.substring(1)];if(!h)throw new sn(4001,!1);return h}findOrReturn(n,t){let l=0;for(let h of t){if(h.path===n.path)return t.splice(l),h;l++}return n}};function YZ(r,n,t){if(typeof r=="string")return Dn(r);let l=r,{queryParams:h,fragment:i,routeConfig:E,url:O,outlet:N,params:K,data:le,title:De}=n;return Dd(hs(t,()=>l({params:K,data:le,queryParams:h,fragment:i,routeConfig:E,url:O,outlet:N,title:De})))}var nP={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function KZ(r,n,t,l,h){let i=HV(r,n,t);return i.matched?(l=yZ(n,l),WZ(l,n,t,h).pipe(Qn(E=>E===!0?i:$t({},nP)))):Dn(i)}function HV(r,n,t){if(n.path==="**")return QZ(t);if(n.path==="")return n.pathMatch==="full"&&(r.hasChildren()||t.length>0)?$t({},nP):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let h=(n.matcher||yV)(t,r,n);if(!h)return $t({},nP);let i={};Object.entries(h.posParams??{}).forEach(([O,N])=>{i[O]=N.path});let E=h.consumed.length>0?$t($t({},i),h.consumed[h.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:h.consumed,remainingSegments:t.slice(h.consumed.length),parameters:E,positionalParamSegments:h.posParams??{}}}function QZ(r){return{matched:!0,parameters:r.length>0?bV(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function gV(r,n,t,l){return t.length>0&&tX(r,t,l)?{segmentGroup:new Dr(n,eX(l,new Dr(t,r.children))),slicedSegments:[]}:t.length===0&&nX(r,t,l)?{segmentGroup:new Dr(r.segments,JZ(r,t,l,r.children)),slicedSegments:t}:{segmentGroup:new Dr(r.segments,r.children),slicedSegments:t}}function JZ(r,n,t,l){let h={};for(let i of t)if(LE(r,n,i)&&!l[Mc(i)]){let E=new Dr([],{});h[Mc(i)]=E}return $t($t({},l),h)}function eX(r,n){let t={};t[Ii]=n;for(let l of r)if(l.path===""&&Mc(l)!==Ii){let h=new Dr([],{});t[Mc(l)]=h}return t}function tX(r,n,t){return t.some(l=>LE(r,n,l)&&Mc(l)!==Ii)}function nX(r,n,t){return t.some(l=>LE(r,n,l))}function LE(r,n,t){return(r.hasChildren()||n.length>0)&&t.pathMatch==="full"?!1:t.path===""}function iX(r,n,t){return n.length===0&&!r.children[t]}var iP=class{};function rX(r,n,t,l,h,i,E="emptyOnly"){return new rP(r,n,t,l,h,E,i).recognize()}var oX=31,rP=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,t,l,h,i,E,O){this.injector=n,this.configLoader=t,this.rootComponentType=l,this.config=h,this.urlTree=i,this.paramsInheritanceStrategy=E,this.urlSerializer=O,this.applyRedirects=new tP(this.urlSerializer,this.urlTree)}noMatchError(n){return new sn(4002,`'${n.segmentGroup}'`)}recognize(){let n=gV(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Qn(({children:t,rootSnapshot:l})=>{let h=new Ja(l,t),i=new ax("",h),E=AV(l,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(E),{state:i,tree:E}}))}match(n){let t=new wf([],Object.freeze({}),Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Ii,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Ii,t).pipe(Qn(l=>({children:l,rootSnapshot:t})),qa(l=>{if(l instanceof ux)return this.urlTree=l.urlTree,this.match(l.urlTree.root);throw l instanceof cx?this.noMatchError(l):l}))}processSegmentGroup(n,t,l,h,i){return l.segments.length===0&&l.hasChildren()?this.processChildren(n,t,l,i):this.processSegment(n,t,l,l.segments,h,!0,i).pipe(Qn(E=>E instanceof Ja?[E]:[]))}processChildren(n,t,l,h){let i=[];for(let E of Object.keys(l.children))E==="primary"?i.unshift(E):i.push(E);return co(i).pipe(ru(E=>{let O=l.children[E],N=xZ(t,E);return this.processSegmentGroup(n,N,O,E,h)}),uM((E,O)=>(E.push(...O),E)),gh(null),cM(),Do(E=>{if(E===null)return f_(l);let O=GV(E);return sX(O),Dn(O)}))}processSegment(n,t,l,h,i,E,O){return co(t).pipe(ru(N=>this.processSegmentAgainstRoute(N._injector??n,t,N,l,h,i,E,O).pipe(qa(K=>{if(K instanceof cx)return Dn(null);throw K}))),pd(N=>!!N),qa(N=>{if(jV(N))return iX(l,h,i)?Dn(new iP):f_(l);throw N}))}processSegmentAgainstRoute(n,t,l,h,i,E,O,N){return Mc(l)!==E&&(E===Ii||!LE(h,i,l))?f_(h):l.redirectTo===void 0?this.matchSegmentAgainstRoute(n,h,l,i,E,N):this.allowRedirects&&O?this.expandSegmentAgainstRouteUsingRedirect(n,h,t,l,i,E,N):f_(h)}expandSegmentAgainstRouteUsingRedirect(n,t,l,h,i,E,O){let{matched:N,parameters:K,consumedSegments:le,positionalParamSegments:De,remainingSegments:Qe}=HV(t,h,i);if(!N)return f_(t);typeof h.redirectTo=="string"&&h.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>oX&&(this.allowRedirects=!1));let Fe=new wf(i,K,Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,_V(h),Mc(h),h.component??h._loadedComponent??null,h,vV(h)),gt=OE(Fe,O,this.paramsInheritanceStrategy);return Fe.params=Object.freeze(gt.params),Fe.data=Object.freeze(gt.data),this.applyRedirects.applyRedirectCommands(le,h.redirectTo,De,Fe,n).pipe(_o(Ot=>this.applyRedirects.lineralizeSegments(h,Ot)),Do(Ot=>this.processSegment(n,l,t,Ot.concat(Qe),E,!1,O)))}matchSegmentAgainstRoute(n,t,l,h,i,E){let O=KZ(t,l,h,n,this.urlSerializer);return l.path==="**"&&(t.children={}),O.pipe(_o(N=>N.matched?(n=l._injector??n,this.getChildConfig(n,l,h).pipe(_o(({routes:K})=>{let le=l._loadedInjector??n,{parameters:De,consumedSegments:Qe,remainingSegments:Fe}=N,gt=new wf(Qe,De,Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,_V(l),Mc(l),l.component??l._loadedComponent??null,l,vV(l)),jt=OE(gt,E,this.paramsInheritanceStrategy);gt.params=Object.freeze(jt.params),gt.data=Object.freeze(jt.data);let{segmentGroup:Ot,slicedSegments:Kt}=gV(t,Qe,Fe,K);if(Kt.length===0&&Ot.hasChildren())return this.processChildren(le,K,Ot,gt).pipe(Qn(Er=>new Ja(gt,Er)));if(K.length===0&&Kt.length===0)return Dn(new Ja(gt,[]));let Hn=Mc(l)===i;return this.processSegment(le,K,Ot,Kt,Hn?Ii:i,!0,gt).pipe(Qn(Er=>new Ja(gt,Er instanceof Ja?[Er]:[])))}))):f_(t)))}getChildConfig(n,t,l){return t.children?Dn({routes:t.children,injector:n}):t.loadChildren?t._loadedRoutes!==void 0?Dn({routes:t._loadedRoutes,injector:t._loadedInjector}):qZ(n,t,l,this.urlSerializer).pipe(Do(h=>h?this.configLoader.loadChildren(n,t).pipe(bo(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):XZ(t))):Dn({routes:[],injector:n})}};function sX(r){r.sort((n,t)=>n.value.outlet===Ii?-1:t.value.outlet===Ii?1:n.value.outlet.localeCompare(t.value.outlet))}function aX(r){let n=r.value.routeConfig;return n&&n.path===""}function GV(r){let n=[],t=new Set;for(let l of r){if(!aX(l)){n.push(l);continue}let h=n.find(i=>l.value.routeConfig===i.value.routeConfig);h!==void 0?(h.children.push(...l.children),t.add(h)):n.push(l)}for(let l of t){let h=GV(l.children);n.push(new Ja(l.value,h))}return n.filter(l=>!t.has(l))}function _V(r){return r.data||{}}function vV(r){return r.resolve||{}}function lX(r,n,t,l,h,i){return Do(E=>rX(r,n,t,l,E.extractedUrl,h,i).pipe(Qn(({state:O,tree:N})=>bi($t({},E),{targetSnapshot:O,urlAfterRedirects:N}))))}function cX(r,n){return Do(t=>{let{targetSnapshot:l,guards:{canActivateChecks:h}}=t;if(!h.length)return Dn(t);let i=new Set(h.map(N=>N.route)),E=new Set;for(let N of i)if(!E.has(N))for(let K of qV(N))E.add(K);let O=0;return co(E).pipe(ru(N=>i.has(N)?uX(N,l,r,n):(N.data=OE(N,N.parent,r).resolve,Dn(void 0))),bo(()=>O++),Vg(1),Do(N=>O===E.size?Dn(t):wa))})}function qV(r){let n=r.children.map(t=>qV(t)).flat();return[r,...n]}function uX(r,n,t,l){let h=r.routeConfig,i=r._resolve;return h?.title!==void 0&&!NV(h)&&(i[dx]=h.title),Y0(()=>(r.data=OE(r,r.parent,t).resolve,dX(i,r,n,l).pipe(Qn(E=>(r._resolvedData=E,r.data=$t($t({},r.data),E),null)))))}function dX(r,n,t,l){let h=q2(r);if(h.length===0)return Dn({});let i={};return co(h).pipe(Do(E=>hX(r[E],n,t,l).pipe(pd(),bo(O=>{if(O instanceof C_)throw RE(new Rh,O);i[E]=O}))),Vg(1),Qn(()=>i),qa(E=>jV(E)?wa:fc(E)))}function hX(r,n,t,l){let h=S_(n)??l,i=T_(r,h),E=i.resolve?i.resolve(n,t):hs(h,()=>i(n,t));return Dd(E)}function H2(r){return _o(n=>{let t=r(n);return t?co(t).pipe(Qn(()=>n)):Dn(n)})}var cP=(()=>{class r{buildTitle(t){let l,h=t.root;for(;h!==void 0;)l=this.getResolvedTitleForRoute(h)??l,h=h.children.find(i=>i.outlet===Ii);return l}getResolvedTitleForRoute(t){return t.data[dx]}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(WV),providedIn:"root"})}return r})(),WV=(()=>{class r extends cP{title;constructor(t){super(),this.title=t}updateTitle(t){let l=this.buildTitle(t);l!==void 0&&this.title.setTitle(l)}static \u0275fac=function(l){return new(l||r)(dn(uV))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),Lh=new Yt("",{providedIn:"root",factory:()=>({})}),Tf=new Yt(""),NE=(()=>{class r{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Ve(QA);loadComponent(t,l){if(this.componentLoaders.get(l))return this.componentLoaders.get(l);if(l._loadedComponent)return Dn(l._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(l);let h=Dd(hs(t,()=>l.loadComponent())).pipe(Qn(XV),_o(YV),bo(E=>{this.onLoadEndListener&&this.onLoadEndListener(l),l._loadedComponent=E}),hd(()=>{this.componentLoaders.delete(l)})),i=new Lg(h,()=>new li).pipe(Fg());return this.componentLoaders.set(l,i),i}loadChildren(t,l){if(this.childrenLoaders.get(l))return this.childrenLoaders.get(l);if(l._loadedRoutes)return Dn({routes:l._loadedRoutes,injector:l._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(l);let i=ZV(l,this.compiler,t,this.onLoadEndListener).pipe(hd(()=>{this.childrenLoaders.delete(l)})),E=new Lg(i,()=>new li).pipe(Fg());return this.childrenLoaders.set(l,E),E}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function ZV(r,n,t,l){return Dd(hs(t,()=>r.loadChildren())).pipe(Qn(XV),_o(YV),Do(h=>h instanceof FC||Array.isArray(h)?Dn(h):co(n.compileModuleAsync(h))),Qn(h=>{l&&l(r);let i,E,O=!1;return Array.isArray(h)?(E=h,O=!0):(i=h.create(t).injector,E=i.get(Tf,[],{optional:!0,self:!0}).flat()),{routes:E.map(lP),injector:i}}))}function pX(r){return r&&typeof r=="object"&&"default"in r}function XV(r){return pX(r)?r.default:r}function YV(r){return Dn(r)}var zE=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(fX),providedIn:"root"})}return r})(),fX=(()=>{class r{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,l){return t}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),uP=new Yt(""),dP=new Yt("");function KV(r,n,t){let l=r.get(dP),h=r.get(si);if(!h.startViewTransition||l.skipNextTransition)return l.skipNextTransition=!1,new Promise(K=>setTimeout(K));let i,E=new Promise(K=>{i=K}),O=h.startViewTransition(()=>(i(),mX(r)));O.ready.catch(K=>{});let{onViewTransitionCreated:N}=l;return N&&hs(r,()=>N({transition:O,from:n,to:t})),E}function mX(r){return new Promise(n=>{Dl({read:()=>setTimeout(n)},{injector:r})})}var hP=new Yt(""),BE=(()=>{class r{currentNavigation=oa(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new li;transitionAbortWithErrorSubject=new li;configLoader=Ve(NE);environmentInjector=Ve(Hr);destroyRef=Ve(Il);urlSerializer=Ve(Ef);rootContexts=Ve(Sf);location=Ve(vu);inputBindingEnabled=Ve(px,{optional:!0})!==null;titleStrategy=Ve(cP);options=Ve(Lh,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Ve(zE);createViewTransition=Ve(uP,{optional:!0});navigationErrorHandler=Ve(hP,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Dn(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=h=>this.events.next(new EE(h)),l=h=>this.events.next(new SE(h));this.configLoader.onLoadEndListener=l,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let l=++this.navigationId;ms(()=>{this.transitions?.next(bi($t({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:l}))})}setupNavigations(t){return this.transitions=new Qo(null),this.transitions.pipe(xo(l=>l!==null),_o(l=>{let h=!1;return Dn(l).pipe(_o(i=>{if(this.navigationId>l.id)return this.cancelNavigationTransition(l,"",ua.SupersededByNewNavigation),wa;this.currentTransition=l,this.currentNavigation.set({id:i.id,initialUrl:i.rawUrl,extractedUrl:i.extractedUrl,targetBrowserUrl:typeof i.extras.browserUrl=="string"?this.urlSerializer.parse(i.extras.browserUrl):i.extras.browserUrl,trigger:i.source,extras:i.extras,previousNavigation:this.lastSuccessfulNavigation?bi($t({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>i.abortController.abort()});let E=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),O=i.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!E&&O!=="reload")return this.events.next(new Cu(i.id,this.urlSerializer.serialize(i.rawUrl),"",y_.IgnoredSameUrlNavigation)),i.resolve(!1),wa;if(this.urlHandlingStrategy.shouldProcessUrl(i.rawUrl))return Dn(i).pipe(_o(N=>(this.events.next(new Fh(N.id,this.urlSerializer.serialize(N.extractedUrl),N.source,N.restoredState)),N.id!==this.navigationId?wa:Promise.resolve(N))),lX(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),bo(N=>{l.targetSnapshot=N.targetSnapshot,l.urlAfterRedirects=N.urlAfterRedirects,this.currentNavigation.update(le=>(le.finalUrl=N.urlAfterRedirects,le));let K=new rx(N.id,this.urlSerializer.serialize(N.extractedUrl),this.urlSerializer.serialize(N.urlAfterRedirects),N.targetSnapshot);this.events.next(K)}));if(E&&this.urlHandlingStrategy.shouldProcessUrl(i.currentRawUrl)){let{id:N,extractedUrl:K,source:le,restoredState:De,extras:Qe}=i,Fe=new Fh(N,this.urlSerializer.serialize(K),le,De);this.events.next(Fe);let gt=FV(this.rootComponentType).snapshot;return this.currentTransition=l=bi($t({},i),{targetSnapshot:gt,urlAfterRedirects:K,extras:bi($t({},Qe),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(jt=>(jt.finalUrl=K,jt)),Dn(l)}else return this.events.next(new Cu(i.id,this.urlSerializer.serialize(i.extractedUrl),"",y_.IgnoredByUrlHandlingStrategy)),i.resolve(!1),wa}),bo(i=>{let E=new xE(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot);this.events.next(E)}),Qn(i=>(this.currentTransition=l=bi($t({},i),{guards:IZ(i.targetSnapshot,i.currentSnapshot,this.rootContexts)}),l)),zZ(this.environmentInjector,i=>this.events.next(i)),bo(i=>{if(l.guardsResult=i.guardsResult,i.guardsResult&&typeof i.guardsResult!="boolean")throw RE(this.urlSerializer,i.guardsResult);let E=new bE(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot,!!i.guardsResult);this.events.next(E)}),xo(i=>i.guardsResult?!0:(this.cancelNavigationTransition(i,"",ua.GuardRejected),!1)),H2(i=>{if(i.guards.canActivateChecks.length!==0)return Dn(i).pipe(bo(E=>{let O=new wE(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(O)}),_o(E=>{let O=!1;return Dn(E).pipe(cX(this.paramsInheritanceStrategy,this.environmentInjector),bo({next:()=>O=!0,complete:()=>{O||this.cancelNavigationTransition(E,"",ua.NoDataFromResolver)}}))}),bo(E=>{let O=new CE(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(O)}))}),H2(i=>{let E=O=>{let N=[];if(O.routeConfig?.loadComponent){let K=S_(O)??this.environmentInjector;N.push(this.configLoader.loadComponent(K,O.routeConfig).pipe(bo(le=>{O.component=le}),Qn(()=>{})))}for(let K of O.children)N.push(...E(K));return N};return Kp(E(i.targetSnapshot.root)).pipe(gh(null),Wa(1))}),H2(()=>this.afterPreactivation()),_o(()=>{let{currentSnapshot:i,targetSnapshot:E}=l,O=this.createViewTransition?.(this.environmentInjector,i.root,E.root);return O?co(O).pipe(Qn(()=>l)):Dn(l)}),Qn(i=>{let E=wZ(t.routeReuseStrategy,i.targetSnapshot,i.currentRouterState);return this.currentTransition=l=bi($t({},i),{targetRouterState:E}),this.currentNavigation.update(O=>(O.targetRouterState=E,O)),l}),bo(()=>{this.events.next(new ox)}),TZ(this.rootContexts,t.routeReuseStrategy,i=>this.events.next(i),this.inputBindingEnabled),Wa(1),mc(new Pi(i=>{let E=l.abortController.signal,O=()=>i.next();return E.addEventListener("abort",O),()=>E.removeEventListener("abort",O)}).pipe(xo(()=>!h&&!l.targetRouterState),bo(()=>{this.cancelNavigationTransition(l,l.abortController.signal.reason+"",ua.Aborted)}))),bo({next:i=>{h=!0,this.lastSuccessfulNavigation=ms(this.currentNavigation),this.events.next(new kl(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects))),this.titleStrategy?.updateTitle(i.targetRouterState.snapshot),i.resolve(!0)},complete:()=>{h=!0}}),mc(this.transitionAbortWithErrorSubject.pipe(bo(i=>{throw i}))),hd(()=>{h||this.cancelNavigationTransition(l,"",ua.SupersededByNewNavigation),this.currentTransition?.id===l.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),qa(i=>{if(this.destroyed)return l.resolve(!1),wa;if(h=!0,UV(i))this.events.next(new bu(l.id,this.urlSerializer.serialize(l.extractedUrl),i.message,i.cancellationCode)),SZ(i)?this.events.next(new w_(i.url,i.navigationBehaviorOptions)):l.resolve(!1);else{let E=new x_(l.id,this.urlSerializer.serialize(l.extractedUrl),i,l.targetSnapshot??void 0);try{let O=hs(this.environmentInjector,()=>this.navigationErrorHandler?.(E));if(O instanceof C_){let{message:N,cancellationCode:K}=RE(this.urlSerializer,O);this.events.next(new bu(l.id,this.urlSerializer.serialize(l.extractedUrl),N,K)),this.events.next(new w_(O.redirectTo,O.navigationBehaviorOptions))}else throw this.events.next(E),i}catch(O){this.options.resolveNavigationPromiseOnError?l.resolve(!1):l.reject(O)}}return wa}))}))}cancelNavigationTransition(t,l,h){let i=new bu(t.id,this.urlSerializer.serialize(t.extractedUrl),l,h);this.events.next(i),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),l=ms(this.currentNavigation),h=l?.targetBrowserUrl??l?.extractedUrl;return t.toString()!==h?.toString()&&!l?.extras.skipLocationChange}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function gX(r){return r!==__}var QV=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(_X),providedIn:"root"})}return r})(),FE=class{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}},_X=(()=>{class r extends FE{static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),JV=(()=>{class r{urlSerializer=Ve(Ef);options=Ve(Lh,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=Ve(vu);urlHandlingStrategy=Ve(zE);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new wu;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:l,targetBrowserUrl:h}){let i=t!==void 0?this.urlHandlingStrategy.merge(t,l):l,E=h??i;return E instanceof wu?this.urlSerializer.serialize(E):E}commitTransition({targetRouterState:t,finalUrl:l,initialUrl:h}){l&&t?(this.currentUrlTree=l,this.rawUrlTree=this.urlHandlingStrategy.merge(l,h),this.routerState=t):this.rawUrlTree=h}routerState=FV(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:()=>Ve(vX),providedIn:"root"})}return r})(),vX=(()=>{class r extends JV{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(l=>{l.type==="popstate"&&setTimeout(()=>{t(l.url,l.state,"popstate")})})}handleRouterEvent(t,l){t instanceof Fh?this.updateStateMemento():t instanceof Cu?this.commitTransition(l):t instanceof rx?this.urlUpdateStrategy==="eager"&&(l.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(l),l)):t instanceof ox?(this.commitTransition(l),this.urlUpdateStrategy==="deferred"&&!l.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(l),l)):t instanceof bu&&t.code!==ua.SupersededByNewNavigation&&t.code!==ua.Redirect?this.restoreHistory(l):t instanceof x_?this.restoreHistory(l,!0):t instanceof kl&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:l,id:h}){let{replaceUrl:i,state:E}=l;if(this.location.isCurrentPathEqualTo(t)||i){let O=this.browserPageId,N=$t($t({},E),this.generateNgRouterState(h,O));this.location.replaceState(t,"",N)}else{let O=$t($t({},E),this.generateNgRouterState(h,this.browserPageId+1));this.location.go(t,"",O)}}restoreHistory(t,l=!1){if(this.canceledNavigationResolution==="computed"){let h=this.browserPageId,i=this.currentPageId-h;i!==0?this.location.historyGo(i):this.getCurrentUrlTree()===t.finalUrl&&i===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(l&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,l){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:l}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function VE(r,n){r.events.pipe(xo(t=>t instanceof kl||t instanceof bu||t instanceof x_||t instanceof Cu),Qn(t=>t instanceof kl||t instanceof Cu?0:(t instanceof bu?t.code===ua.Redirect||t.code===ua.SupersededByNewNavigation:!1)?2:1),xo(t=>t!==2),Wa(1)).subscribe(()=>{n()})}var yX={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},xX={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},gs=(()=>{class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Ve(NC);stateManager=Ve(JV);options=Ve(Lh,{optional:!0})||{};pendingTasks=Ve(fu);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Ve(BE);urlSerializer=Ve(Ef);location=Ve(vu);urlHandlingStrategy=Ve(zE);injector=Ve(Hr);_events=new li;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Ve(QV);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Ve(Tf,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Ve(px,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Br;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(l=>{try{let h=this.navigationTransitions.currentTransition,i=ms(this.navigationTransitions.currentNavigation);if(h!==null&&i!==null){if(this.stateManager.handleRouterEvent(l,i),l instanceof bu&&l.code!==ua.Redirect&&l.code!==ua.SupersededByNewNavigation)this.navigated=!0;else if(l instanceof kl)this.navigated=!0;else if(l instanceof w_){let E=l.navigationBehaviorOptions,O=this.urlHandlingStrategy.merge(l.url,h.currentRawUrl),N=$t({browserUrl:h.extras.browserUrl,info:h.extras.info,skipLocationChange:h.extras.skipLocationChange,replaceUrl:h.extras.replaceUrl||this.urlUpdateStrategy==="eager"||gX(h.source)},E);this.scheduleNavigation(O,__,null,N,{resolve:h.resolve,reject:h.reject,promise:h.promise})}}vZ(l)&&this._events.next(l)}catch(h){this.navigationTransitions.transitionAbortWithErrorSubject.next(h)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),__,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,l,h)=>{this.navigateToSyncWithBrowser(t,h,l)})}navigateToSyncWithBrowser(t,l,h){let i={replaceUrl:!0},E=h?.navigationId?h:null;if(h){let N=$t({},h);delete N.navigationId,delete N.\u0275routerPageId,Object.keys(N).length!==0&&(i.state=N)}let O=this.parseUrl(t);this.scheduleNavigation(O,l,E,i).catch(N=>{this.disposed||this.injector.get(ra)(N)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return ms(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(lP),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,l={}){let{relativeTo:h,queryParams:i,fragment:E,queryParamsHandling:O,preserveFragment:N}=l,K=N?this.currentUrlTree.fragment:E,le=null;switch(O??this.options.defaultQueryParamsHandling){case"merge":le=$t($t({},this.currentUrlTree.queryParams),i);break;case"preserve":le=this.currentUrlTree.queryParams;break;default:le=i||null}le!==null&&(le=this.removeEmptyProps(le));let De;try{let Qe=h?h.snapshot:this.routerState.snapshot.root;De=PV(Qe)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),De=this.currentUrlTree.root}return OV(De,t,le,K??null)}navigateByUrl(t,l={skipLocationChange:!1}){let h=kh(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(i,__,null,l)}navigate(t,l={skipLocationChange:!1}){return bX(t),this.navigateByUrl(this.createUrlTree(t,l),l)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.console.warn(ou(4018,!1)),this.urlSerializer.parse("/")}}isActive(t,l){let h;if(l===!0?h=$t({},yX):l===!1?h=$t({},xX):h=l,kh(t))return hV(this.currentUrlTree,t,h);let i=this.parseUrl(t);return hV(this.currentUrlTree,i,h)}removeEmptyProps(t){return Object.entries(t).reduce((l,[h,i])=>(i!=null&&(l[h]=i),l),{})}scheduleNavigation(t,l,h,i,E){if(this.disposed)return Promise.resolve(!1);let O,N,K;E?(O=E.resolve,N=E.reject,K=E.promise):K=new Promise((De,Qe)=>{O=De,N=Qe});let le=this.pendingTasks.add();return VE(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(le))}),this.navigationTransitions.handleNavigationRequest({source:l,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:O,reject:N,promise:K,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),K.catch(De=>Promise.reject(De))}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function bX(r){for(let n=0;n<r.length;n++)if(r[n]==null)throw new sn(4008,!1)}var UE=(()=>{class r{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=oa(null);get href(){return ms(this.reactiveHref)}set href(t){this.reactiveHref.set(t)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new li;applicationErrorHandler=Ve(ra);options=Ve(Lh,{optional:!0});constructor(t,l,h,i,E,O){this.router=t,this.route=l,this.tabIndexAttribute=h,this.renderer=i,this.el=E,this.locationStrategy=O,this.reactiveHref.set(Ve(new c_("href"),{optional:!0}));let N=E.nativeElement.tagName?.toLowerCase();this.isAnchorElement=N==="a"||N==="area"||!!(typeof customElements=="object"&&customElements.get(N)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let t=this.preserveFragment,l=h=>h==="merge"||h==="preserve";t||=l(this.queryParamsHandling),t||=!this.queryParamsHandling&&!l(this.options?.defaultQueryParamsHandling),t&&(this.subscription=this.router.events.subscribe(h=>{h instanceof kl&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(kh(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,l,h,i,E){let O=this.urlTree;if(O===null||this.isAnchorElement&&(t!==0||l||h||i||E||typeof this.target=="string"&&this.target!="_self"))return!0;let N={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(O,N)?.catch(K=>{this.applicationErrorHandler(K)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.reactiveHref.set(t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t))??"":null)}applyAttributeValue(t,l){let h=this.renderer,i=this.el.nativeElement;l!==null?h.setAttribute(i,t,l):h.removeAttribute(i,t)}get urlTree(){return this.routerLinkInput===null?null:kh(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(l){return new(l||r)(Bt(gs),Bt(Ia),Cy("tabindex"),Bt(sa),Bt(ir),Bt(Tc))};static \u0275dir=fr({type:r,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(l,h){l&1&&Re("click",function(E){return h.onClick(E.button,E.ctrlKey,E.shiftKey,E.altKey,E.metaKey)}),l&2&&$o("href",h.reactiveHref(),EA)("target",h.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",As],skipLocationChange:[2,"skipLocationChange","skipLocationChange",As],replaceUrl:[2,"replaceUrl","replaceUrl",As],routerLink:"routerLink"},features:[Vr]})}return r})();var mx=class{};var e4=(()=>{class r{router;injector;preloadingStrategy;loader;subscription;constructor(t,l,h,i){this.router=t,this.injector=l,this.preloadingStrategy=h,this.loader=i}setUpPreloading(){this.subscription=this.router.events.pipe(xo(t=>t instanceof kl),ru(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,l){let h=[];for(let i of l){i.providers&&!i._injector&&(i._injector=a_(i.providers,t,`Route: ${i.path}`));let E=i._injector??t,O=i._loadedInjector??E;(i.loadChildren&&!i._loadedRoutes&&i.canLoad===void 0||i.loadComponent&&!i._loadedComponent)&&h.push(this.preloadConfig(E,i)),(i.children||i._loadedRoutes)&&h.push(this.processRoutes(O,i.children??i._loadedRoutes))}return co(h).pipe(zg())}preloadConfig(t,l){return this.preloadingStrategy.preload(l,()=>{let h;l.loadChildren&&l.canLoad===void 0?h=this.loader.loadChildren(t,l):h=Dn(null);let i=h.pipe(Do(E=>E===null?Dn(void 0):(l._loadedRoutes=E.routes,l._loadedInjector=E.injector,this.processRoutes(E.injector??t,E.routes))));if(l.loadComponent&&!l._loadedComponent){let E=this.loader.loadComponent(t,l);return co([i,E]).pipe(zg())}else return i})}static \u0275fac=function(l){return new(l||r)(dn(gs),dn(Hr),dn(mx),dn(NE))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),t4=new Yt(""),wX=(()=>{class r{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=__;restoredId=0;store={};constructor(t,l,h,i,E={}){this.urlSerializer=t,this.transitions=l,this.viewportScroller=h,this.zone=i,this.options=E,E.scrollPositionRestoration||="disabled",E.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Fh?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof kl?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Cu&&t.code===y_.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{if(!(t instanceof b_))return;let l={behavior:"instant"};t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],l):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position,l):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(t,l){this.zone.runOutsideAngular(()=>Ko(this,null,function*(){yield new Promise(h=>{setTimeout(h),typeof requestAnimationFrame<"u"&&requestAnimationFrame(h)}),this.zone.run(()=>{this.transitions.events.next(new b_(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,l))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(l){jA()};static \u0275prov=Ft({token:r,factory:r.\u0275fac})}return r})();function fP(r,...n){return gc([{provide:Tf,multi:!0,useValue:r},[],{provide:Ia,useFactory:n4,deps:[gs]},{provide:Ay,multi:!0,useFactory:i4},n.map(t=>t.\u0275providers)])}function n4(r){return r.routerState.root}function gx(r,n){return{\u0275kind:r,\u0275providers:n}}function i4(){let r=Ve(cr);return n=>{let t=r.get(Ea);if(n!==t.components[0])return;let l=r.get(gs),h=r.get(r4);r.get(mP)===1&&l.initialNavigation(),r.get(a4,null,{optional:!0})?.setUpPreloading(),r.get(t4,null,{optional:!0})?.init(),l.resetRootComponentType(t.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var r4=new Yt("",{factory:()=>new li}),mP=new Yt("",{providedIn:"root",factory:()=>1});function o4(){let r=[{provide:EC,useValue:!0},{provide:mP,useValue:0},zC(()=>{let n=Ve(cr);return n.get(f2,Promise.resolve()).then(()=>new Promise(l=>{let h=n.get(gs),i=n.get(r4);VE(h,()=>{l(!0)}),n.get(BE).afterPreactivation=()=>(l(!0),i.closed?Dn(void 0):i),h.initialNavigation()}))})];return gx(2,r)}function s4(){let r=[zC(()=>{Ve(gs).setUpLocationChangeListener()}),{provide:mP,useValue:2}];return gx(3,r)}var a4=new Yt("");function l4(r){return gx(0,[{provide:a4,useExisting:e4},{provide:mx,useExisting:r}])}function c4(){return gx(8,[sP,{provide:px,useExisting:sP}])}function u4(r){Ec("NgRouterViewTransitions");let n=[{provide:uP,useValue:KV},{provide:dP,useValue:$t({skipNextTransition:!!r?.skipInitialTransition},r)}];return gx(9,n)}var d4=[vu,{provide:Ef,useClass:Rh},gs,Sf,{provide:Ia,useFactory:n4,deps:[gs]},NE,[]],gP=(()=>{class r{constructor(){}static forRoot(t,l){return{ngModule:r,providers:[d4,[],{provide:Tf,multi:!0,useValue:t},[],l?.errorHandler?{provide:hP,useValue:l.errorHandler}:[],{provide:Lh,useValue:l||{}},l?.useHash?EX():SX(),CX(),l?.preloadingStrategy?l4(l.preloadingStrategy).\u0275providers:[],l?.initialNavigation?TX(l):[],l?.bindToComponentInputs?c4().\u0275providers:[],l?.enableViewTransitions?u4().\u0275providers:[],IX()]}}static forChild(t){return{ngModule:r,providers:[{provide:Tf,multi:!0,useValue:t}]}}static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})();function CX(){return{provide:t4,useFactory:()=>{let r=Ve(HB),n=Ve(yi),t=Ve(Lh),l=Ve(BE),h=Ve(Ef);return t.scrollOffset&&r.setOffset(t.scrollOffset),new wX(h,l,r,n,t)}}}function EX(){return{provide:Tc,useClass:y2}}function SX(){return{provide:Tc,useClass:XC}}function TX(r){return[r.initialNavigation==="disabled"?s4().\u0275providers:[],r.initialNavigation==="enabledBlocking"?o4().\u0275providers:[]]}var pP=new Yt("");function IX(){return[{provide:pP,useFactory:i4},{provide:Ay,multi:!0,useExisting:pP}]}var $E=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=In({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,l){t&1&&Mn(0,"router-outlet")},dependencies:[hx],encapsulation:2})};var tl={mapboxToken:"pk.eyJ1IjoiZm5zYnJsIiwiYSI6ImNtaHhqbGUwbDAxeGcyanNjazVybGJtdHYifQ.YxqJwN9S4EposFmNb7igWA",googleClientId:"177987336410-qse83le4nl3i65oat3g2b32kk5sji7sq.apps.googleusercontent.com",googleRedirectUri:"postmessage"};var U_=eL(yP());var HE;function MX(){if(HE===void 0&&(HE=null,typeof window<"u")){let r=window;r.trustedTypes!==void 0&&(HE=r.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return HE}function _x(r){return MX()?.createHTML(r)||r}function p4(r){return Error(`Unable to find icon with the name "${r}"`)}function DX(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function f4(r){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${r}".`)}function m4(r){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${r}".`)}var Ad=class{url;svgText;options;svgElement;constructor(n,t,l){this.url=n,this.svgText=t,this.options=l}},_4=(()=>{class r{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(t,l,h,i){this._httpClient=t,this._sanitizer=l,this._errorHandler=i,this._document=h}addSvgIcon(t,l,h){return this.addSvgIconInNamespace("",t,l,h)}addSvgIconLiteral(t,l,h){return this.addSvgIconLiteralInNamespace("",t,l,h)}addSvgIconInNamespace(t,l,h,i){return this._addSvgIconConfig(t,l,new Ad(h,null,i))}addSvgIconResolver(t){return this._resolvers.push(t),this}addSvgIconLiteralInNamespace(t,l,h,i){let E=this._sanitizer.sanitize(Ms.HTML,h);if(!E)throw m4(h);let O=_x(E);return this._addSvgIconConfig(t,l,new Ad("",O,i))}addSvgIconSet(t,l){return this.addSvgIconSetInNamespace("",t,l)}addSvgIconSetLiteral(t,l){return this.addSvgIconSetLiteralInNamespace("",t,l)}addSvgIconSetInNamespace(t,l,h){return this._addSvgIconSetConfig(t,new Ad(l,null,h))}addSvgIconSetLiteralInNamespace(t,l,h){let i=this._sanitizer.sanitize(Ms.HTML,l);if(!i)throw m4(l);let E=_x(i);return this._addSvgIconSetConfig(t,new Ad("",E,h))}registerFontClassAlias(t,l=t){return this._fontCssClassesByAlias.set(t,l),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(...t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){let l=this._sanitizer.sanitize(Ms.RESOURCE_URL,t);if(!l)throw f4(t);let h=this._cachedIconsByUrl.get(l);return h?Dn(GE(h)):this._loadSvgIconFromConfig(new Ad(t,null)).pipe(bo(i=>this._cachedIconsByUrl.set(l,i)),Qn(i=>GE(i)))}getNamedSvgIcon(t,l=""){let h=g4(l,t),i=this._svgIconConfigs.get(h);if(i)return this._getSvgFromConfig(i);if(i=this._getIconConfigFromResolvers(l,t),i)return this._svgIconConfigs.set(h,i),this._getSvgFromConfig(i);let E=this._iconSetConfigs.get(l);return E?this._getSvgFromIconSetConfigs(t,E):fc(p4(h))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(t){return t.svgText?Dn(GE(this._svgElementFromConfig(t))):this._loadSvgIconFromConfig(t).pipe(Qn(l=>GE(l)))}_getSvgFromIconSetConfigs(t,l){let h=this._extractIconWithNameFromAnySet(t,l);if(h)return Dn(h);let i=l.filter(E=>!E.svgText).map(E=>this._loadSvgIconSetFromConfig(E).pipe(qa(O=>{let K=`Loading icon set URL: ${this._sanitizer.sanitize(Ms.RESOURCE_URL,E.url)} failed: ${O.message}`;return this._errorHandler.handleError(new Error(K)),Dn(null)})));return K0(i).pipe(Qn(()=>{let E=this._extractIconWithNameFromAnySet(t,l);if(!E)throw p4(t);return E}))}_extractIconWithNameFromAnySet(t,l){for(let h=l.length-1;h>=0;h--){let i=l[h];if(i.svgText&&i.svgText.toString().indexOf(t)>-1){let E=this._svgElementFromConfig(i),O=this._extractSvgIconFromSet(E,t,i.options);if(O)return O}}return null}_loadSvgIconFromConfig(t){return this._fetchIcon(t).pipe(bo(l=>t.svgText=l),Qn(()=>this._svgElementFromConfig(t)))}_loadSvgIconSetFromConfig(t){return t.svgText?Dn(null):this._fetchIcon(t).pipe(bo(l=>t.svgText=l))}_extractSvgIconFromSet(t,l,h){let i=t.querySelector(`[id="${l}"]`);if(!i)return null;let E=i.cloneNode(!0);if(E.removeAttribute("id"),E.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(E,h);if(E.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(E),h);let O=this._svgElementFromString(_x("<svg></svg>"));return O.appendChild(E),this._setSvgAttributes(O,h)}_svgElementFromString(t){let l=this._document.createElement("DIV");l.innerHTML=t;let h=l.querySelector("svg");if(!h)throw Error("<svg> tag not found");return h}_toSvgElement(t){let l=this._svgElementFromString(_x("<svg></svg>")),h=t.attributes;for(let i=0;i<h.length;i++){let{name:E,value:O}=h[i];E!=="id"&&l.setAttribute(E,O)}for(let i=0;i<t.childNodes.length;i++)t.childNodes[i].nodeType===this._document.ELEMENT_NODE&&l.appendChild(t.childNodes[i].cloneNode(!0));return l}_setSvgAttributes(t,l){return t.setAttribute("fit",""),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),l&&l.viewBox&&t.setAttribute("viewBox",l.viewBox),t}_fetchIcon(t){let{url:l,options:h}=t,i=h?.withCredentials??!1;if(!this._httpClient)throw DX();if(l==null)throw Error(`Cannot fetch icon from URL "${l}".`);let E=this._sanitizer.sanitize(Ms.RESOURCE_URL,l);if(!E)throw f4(l);let O=this._inProgressUrlFetches.get(E);if(O)return O;let N=this._httpClient.get(E,{responseType:"text",withCredentials:i}).pipe(Qn(K=>_x(K)),hd(()=>this._inProgressUrlFetches.delete(E)),hM());return this._inProgressUrlFetches.set(E,N),N}_addSvgIconConfig(t,l,h){return this._svgIconConfigs.set(g4(t,l),h),this}_addSvgIconSetConfig(t,l){let h=this._iconSetConfigs.get(t);return h?h.push(l):this._iconSetConfigs.set(t,[l]),this}_svgElementFromConfig(t){if(!t.svgElement){let l=this._svgElementFromString(t.svgText);this._setSvgAttributes(l,t.options),t.svgElement=l}return t.svgElement}_getIconConfigFromResolvers(t,l){for(let h=0;h<this._resolvers.length;h++){let i=this._resolvers[h](l,t);if(i)return AX(i)?new Ad(i.url,null,i.options):new Ad(i,null)}}static \u0275fac=function(l){return new(l||r)(dn(Eo,8),dn(V2),dn(si,8),dn(zs))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function GE(r){return r.cloneNode(!0)}function g4(r,n){return r+":"+n}function AX(r){return!!(r.url&&r.options)}function vx(r){return r.buttons===0||r.detail===0}function yx(r){let n=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var xP;function v4(){if(xP==null){let r=typeof document<"u"?document.head:null;xP=!!(r&&(r.createShadowRoot||r.attachShadow))}return xP}function bP(r){if(v4()){let n=r.getRootNode?r.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}function Ma(r){return r.composedPath?r.composedPath()[0]:r.target}var wP;try{wP=typeof Intl<"u"&&Intl.v8BreakIterator}catch{wP=!1}var qo=(()=>{class r{_platformId=Ve(gf);isBrowser=this._platformId?$B(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||wP)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var xx;function y4(){if(xx==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>xx=!0}))}finally{xx=xx||!1}return xx}function I_(r){return y4()?r:!!r.capture}function Eu(r){return r instanceof ir?r.nativeElement:r}var x4=new Yt("cdk-input-modality-detector-options"),b4={ignoreKeys:[18,17,224,91,16]},w4=650,CP={passive:!0,capture:!0},C4=(()=>{class r{_platform=Ve(qo);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new Qo(null);_options;_lastTouchMs=0;_onKeydown=t=>{this._options?.ignoreKeys?.some(l=>l===t.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Ma(t))};_onMousedown=t=>{Date.now()-this._lastTouchMs<w4||(this._modality.next(vx(t)?"keyboard":"mouse"),this._mostRecentTarget=Ma(t))};_onTouchstart=t=>{if(yx(t)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Ma(t)};constructor(){let t=Ve(yi),l=Ve(si),h=Ve(x4,{optional:!0});if(this._options=$t($t({},b4),h),this.modalityDetected=this._modality.pipe(J0(1)),this.modalityChanged=this.modalityDetected.pipe(Qp()),this._platform.isBrowser){let i=Ve(ps).createRenderer(null,null);this._listenerCleanups=t.runOutsideAngular(()=>[i.listen(l,"keydown",this._onKeydown,CP),i.listen(l,"mousedown",this._onMousedown,CP),i.listen(l,"touchstart",this._onTouchstart,CP)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(t=>t())}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),bx=(function(r){return r[r.IMMEDIATE=0]="IMMEDIATE",r[r.EVENTUAL=1]="EVENTUAL",r})(bx||{}),E4=new Yt("cdk-focus-monitor-default-options"),qE=I_({passive:!0,capture:!0}),EP=(()=>{class r{_ngZone=Ve(yi);_platform=Ve(qo);_inputModalityDetector=Ve(C4);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=Ve(si);_stopInputModalityDetector=new li;constructor(){let t=Ve(E4,{optional:!0});this._detectionMode=t?.detectionMode||bx.IMMEDIATE}_rootNodeFocusAndBlurListener=t=>{let l=Ma(t);for(let h=l;h;h=h.parentElement)t.type==="focus"?this._onFocus(t,h):this._onBlur(t,h)};monitor(t,l=!1){let h=Eu(t);if(!this._platform.isBrowser||h.nodeType!==1)return Dn();let i=bP(h)||this._document,E=this._elementInfo.get(h);if(E)return l&&(E.checkChildren=!0),E.subject;let O={checkChildren:l,subject:new li,rootNode:i};return this._elementInfo.set(h,O),this._registerGlobalListeners(O),O.subject}stopMonitoring(t){let l=Eu(t),h=this._elementInfo.get(l);h&&(h.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(h))}focusVia(t,l,h){let i=Eu(t),E=this._document.activeElement;i===E?this._getClosestElementsInfo(i).forEach(([O,N])=>this._originChanged(O,l,N)):(this._setOrigin(l),typeof i.focus=="function"&&i.focus(h))}ngOnDestroy(){this._elementInfo.forEach((t,l)=>this.stopMonitoring(l))}_getWindow(){return this._document.defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===bx.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,l){t.classList.toggle("cdk-focused",!!l),t.classList.toggle("cdk-touch-focused",l==="touch"),t.classList.toggle("cdk-keyboard-focused",l==="keyboard"),t.classList.toggle("cdk-mouse-focused",l==="mouse"),t.classList.toggle("cdk-program-focused",l==="program")}_setOrigin(t,l=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=t,this._originFromTouchInteraction=t==="touch"&&l,this._detectionMode===bx.IMMEDIATE){clearTimeout(this._originTimeoutId);let h=this._originFromTouchInteraction?w4:1;this._originTimeoutId=setTimeout(()=>this._origin=null,h)}})}_onFocus(t,l){let h=this._elementInfo.get(l),i=Ma(t);!h||!h.checkChildren&&l!==i||this._originChanged(l,this._getFocusOrigin(i),h)}_onBlur(t,l){let h=this._elementInfo.get(l);!h||h.checkChildren&&t.relatedTarget instanceof Node&&l.contains(t.relatedTarget)||(this._setClasses(l),this._emitOrigin(h,null))}_emitOrigin(t,l){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(l))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;let l=t.rootNode,h=this._rootNodeFocusListenerCount.get(l)||0;h||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,qE),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,qE)}),this._rootNodeFocusListenerCount.set(l,h+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(mc(this._stopInputModalityDetector)).subscribe(i=>{this._setOrigin(i,!0)}))}_removeGlobalListeners(t){let l=t.rootNode;if(this._rootNodeFocusListenerCount.has(l)){let h=this._rootNodeFocusListenerCount.get(l);h>1?this._rootNodeFocusListenerCount.set(l,h-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,qE),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,qE),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,l,h){this._setClasses(t,l),this._emitOrigin(h,l),this._lastFocusOrigin=l}_getClosestElementsInfo(t){let l=[];return this._elementInfo.forEach((h,i)=>{(i===t||h.checkChildren&&i.contains(t))&&l.push([i,h])}),l}_isLastInteractionFromInputLabel(t){let{_mostRecentTarget:l,mostRecentModality:h}=this._inputModalityDetector;if(h!=="mouse"||!l||l===t||t.nodeName!=="INPUT"&&t.nodeName!=="TEXTAREA"||t.disabled)return!1;let i=t.labels;if(i){for(let E=0;E<i.length;E++)if(i[E].contains(l))return!0}return!1}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var WE=new WeakMap,Nh=(()=>{class r{_appRef;_injector=Ve(cr);_environmentInjector=Ve(Hr);load(t){let l=this._appRef=this._appRef||this._injector.get(Ea),h=WE.get(l);h||(h={loaders:new Set,refs:[]},WE.set(l,h),l.onDestroy(()=>{WE.get(l)?.refs.forEach(i=>i.destroy()),WE.delete(l)})),h.loaders.has(t)||(h.loaders.add(t),h.refs.push(qC(t,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function M_(r){return Array.isArray(r)?r:[r]}var S4=new Set,If,ZE=(()=>{class r{_platform=Ve(qo);_nonce=Ve(o_,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):OX}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&PX(t,this._nonce),this._matchMedia(t)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function PX(r,n){if(!S4.has(r))try{If||(If=document.createElement("style"),n&&If.setAttribute("nonce",n),If.setAttribute("type","text/css"),document.head.appendChild(If)),If.sheet&&(If.sheet.insertRule(`@media ${r} {body{ }}`,0),S4.add(r))}catch(t){console.error(t)}}function OX(r){return{matches:r==="all"||r==="",media:r,addListener:()=>{},removeListener:()=>{}}}var Mf=(()=>{class r{_mediaMatcher=Ve(ZE);_zone=Ve(yi);_queries=new Map;_destroySubject=new li;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return T4(M_(t)).some(h=>this._registerQuery(h).mql.matches)}observe(t){let h=T4(M_(t)).map(E=>this._registerQuery(E).observable),i=Kp(h);return i=mh(i.pipe(Wa(1)),i.pipe(J0(1),Bg(0))),i.pipe(Qn(E=>{let O={matches:!1,breakpoints:{}};return E.forEach(({matches:N,query:K})=>{O.matches=O.matches||N,O.breakpoints[K]=N}),O}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);let l=this._mediaMatcher.matchMedia(t),i={observable:new Pi(E=>{let O=N=>this._zone.run(()=>E.next(N));return l.addListener(O),()=>{l.removeListener(O)}}).pipe(Ug(l),Qn(({matches:E})=>({query:t,matches:E})),mc(this._destroySubject)),mql:l};return this._queries.set(t,i),i}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function T4(r){return r.map(n=>n.split(",")).reduce((n,t)=>n.concat(t)).map(n=>n.trim())}var D4=new Yt("liveAnnouncerElement",{providedIn:"root",factory:A4});function A4(){return null}var P4=new Yt("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),RX=0,TP=(()=>{class r{_ngZone=Ve(yi);_defaultOptions=Ve(P4,{optional:!0});_liveElement;_document=Ve(si);_previousTimeout;_currentPromise;_currentResolve;constructor(){let t=Ve(D4,{optional:!0});this._liveElement=t||this._createLiveElement()}announce(t,...l){let h=this._defaultOptions,i,E;return l.length===1&&typeof l[0]=="number"?E=l[0]:[i,E]=l,this.clear(),clearTimeout(this._previousTimeout),i||(i=h&&h.politeness?h.politeness:"polite"),E==null&&h&&(E=h.duration),this._liveElement.setAttribute("aria-live",i),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(O=>this._currentResolve=O)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=t,typeof E=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),E)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let t="cdk-live-announcer-element",l=this._document.getElementsByClassName(t),h=this._document.createElement("div");for(let i=0;i<l.length;i++)l[i].remove();return h.classList.add(t),h.classList.add("cdk-visually-hidden"),h.setAttribute("aria-atomic","true"),h.setAttribute("aria-live","polite"),h.id=`cdk-live-announcer-${RX++}`,this._document.body.appendChild(h),h}_exposeAnnouncerToModals(t){let l=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let h=0;h<l.length;h++){let i=l[h],E=i.getAttribute("aria-owns");E?E.indexOf(t)===-1&&i.setAttribute("aria-owns",E+" "+t):i.setAttribute("aria-owns",t)}}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var zh=(function(r){return r[r.NONE=0]="NONE",r[r.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",r[r.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",r})(zh||{}),I4="cdk-high-contrast-black-on-white",M4="cdk-high-contrast-white-on-black",SP="cdk-high-contrast-active",IP=(()=>{class r{_platform=Ve(qo);_hasCheckedHighContrastMode;_document=Ve(si);_breakpointSubscription;constructor(){this._breakpointSubscription=Ve(Mf).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return zh.NONE;let t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);let l=this._document.defaultView||window,h=l&&l.getComputedStyle?l.getComputedStyle(t):null,i=(h&&h.backgroundColor||"").replace(/ /g,"");switch(t.remove(),i){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return zh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return zh.BLACK_ON_WHITE}return zh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let t=this._document.body.classList;t.remove(SP,I4,M4),this._hasCheckedHighContrastMode=!0;let l=this.getHighContrastMode();l===zh.BLACK_ON_WHITE?t.add(SP,I4):l===zh.WHITE_ON_BLACK&&t.add(SP,M4)}}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var MP={},wx=(()=>{class r{_appId=Ve(r_);getId(t){return this._appId!=="ng"&&(t+=this._appId),MP.hasOwnProperty(t)||(MP[t]=0),`${t}${MP[t]++}`}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var kX=new Yt("cdk-dir-doc",{providedIn:"root",factory:FX});function FX(){return Ve(si)}var LX=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function NX(r){let n=r?.toLowerCase()||"";return n==="auto"&&typeof navigator<"u"&&navigator?.language?LX.test(navigator.language)?"rtl":"ltr":n==="rtl"?"rtl":"ltr"}var O4=(()=>{class r{get value(){return this.valueSignal()}valueSignal=oa("ltr");change=new Zt;constructor(){let t=Ve(kX,{optional:!0});if(t){let l=t.body?t.body.dir:null,h=t.documentElement?t.documentElement.dir:null;this.valueSignal.set(NX(l||h||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Bh=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})();var Fl=(()=>{class r{constructor(){Ve(IP)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[Bh,Bh]})}return r})();var zX=["*"],BX=new Yt("MAT_ICON_DEFAULT_OPTIONS"),VX=new Yt("mat-icon-location",{providedIn:"root",factory:UX});function UX(){let r=Ve(si),n=r?r.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}var R4=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],jX=R4.map(r=>`[${r}]`).join(", "),$X=/^url\(['"]?#(.*?)['"]?\)$/,Zi=(()=>{class r{_elementRef=Ve(ir);_iconRegistry=Ve(_4);_location=Ve(VX);_errorHandler=Ve(zs);_defaultColor;get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(t){t!==this._svgIcon&&(t?this._updateSvgIcon(t):this._svgIcon&&this._clearSvgElement(),this._svgIcon=t)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(t){let l=this._cleanupFontValue(t);l!==this._fontSet&&(this._fontSet=l,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(t){let l=this._cleanupFontValue(t);l!==this._fontIcon&&(this._fontIcon=l,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Br.EMPTY;constructor(){let t=Ve(new c_("aria-hidden"),{optional:!0}),l=Ve(BX,{optional:!0});l&&(l.color&&(this.color=this._defaultColor=l.color),l.fontSet&&(this.fontSet=l.fontSet)),t||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(t){if(!t)return["",""];let l=t.split(":");switch(l.length){case 1:return["",l[0]];case 2:return l;default:throw Error(`Invalid icon name: "${t}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let t=this._elementsWithExternalReferences;if(t&&t.size){let l=this._location.getPathname();l!==this._previousPath&&(this._previousPath=l,this._prependPathToReferences(l))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(t){this._clearSvgElement();let l=this._location.getPathname();this._previousPath=l,this._cacheChildrenWithExternalReferences(t),this._prependPathToReferences(l),this._elementRef.nativeElement.appendChild(t)}_clearSvgElement(){let t=this._elementRef.nativeElement,l=t.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();l--;){let h=t.childNodes[l];(h.nodeType!==1||h.nodeName.toLowerCase()==="svg")&&h.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let t=this._elementRef.nativeElement,l=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(h=>h.length>0);this._previousFontSetClass.forEach(h=>t.classList.remove(h)),l.forEach(h=>t.classList.add(h)),this._previousFontSetClass=l,this.fontIcon!==this._previousFontIconClass&&!l.includes("mat-ligature-font")&&(this._previousFontIconClass&&t.classList.remove(this._previousFontIconClass),this.fontIcon&&t.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(t){return typeof t=="string"?t.trim().split(" ")[0]:t}_prependPathToReferences(t){let l=this._elementsWithExternalReferences;l&&l.forEach((h,i)=>{h.forEach(E=>{i.setAttribute(E.name,`url('${t}#${E.value}')`)})})}_cacheChildrenWithExternalReferences(t){let l=t.querySelectorAll(jX),h=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let i=0;i<l.length;i++)R4.forEach(E=>{let O=l[i],N=O.getAttribute(E),K=N?N.match($X):null;if(K){let le=h.get(O);le||(le=[],h.set(O,le)),le.push({name:E,value:K[1]})}})}_updateSvgIcon(t){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),t){let[l,h]=this._splitIconName(t);l&&(this._svgNamespace=l),h&&(this._svgName=h),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(h,l).pipe(Wa(1)).subscribe(i=>this._setSvgElement(i),i=>{let E=`Error retrieving icon ${l}:${h}! ${i.message}`;this._errorHandler.handleError(new Error(E))})}}static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(l,h){l&2&&($o("data-mat-icon-type",h._usingFontIcon()?"font":"svg")("data-mat-icon-name",h._svgName||h.fontIcon)("data-mat-icon-namespace",h._svgNamespace||h.fontSet)("fontIcon",h._usingFontIcon()?h.fontIcon:null),Ry(h.color?"mat-"+h.color:""),fn("mat-icon-inline",h.inline)("mat-icon-no-color",h.color!=="primary"&&h.color!=="accent"&&h.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",As],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],ngContentSelectors:zX,decls:1,vars:0,template:function(l,h){l&1&&(vf(),Ed(0))},styles:[`mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
`],encapsulation:2,changeDetection:0})}return r})(),Xi=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[Fl,Fl]})}return r})();var Df;function k4(){if(Df==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Df=!1,Df;if(document.documentElement?.style&&"scrollBehavior"in document.documentElement.style)Df=!0;else{let r=Element.prototype.scrollTo;r?Df=!/\{\s*\[native code\]\s*\}/.test(r.toString()):Df=!1}}return Df}function DP(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var F4={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var GX=new Yt("MATERIAL_ANIMATIONS");var L4=null;function qX(){return Ve(GX,{optional:!0})?.animationsDisabled||Ve(Ey,{optional:!0})==="NoopAnimations"?"di-disabled":(L4??=Ve(ZE).matchMedia("(prefers-reduced-motion)").matches,L4?"reduced-motion":"enabled")}function Af(){return qX()!=="enabled"}function ko(r){return r==null?"":typeof r=="string"?r:`${r}px`}var Ll=(function(r){return r[r.FADING_IN=0]="FADING_IN",r[r.VISIBLE=1]="VISIBLE",r[r.FADING_OUT=2]="FADING_OUT",r[r.HIDDEN=3]="HIDDEN",r})(Ll||{}),AP=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Ll.HIDDEN;constructor(n,t,l,h=!1){this._renderer=n,this.element=t,this.config=l,this._animationForciblyDisabledThroughCss=h}fadeOut(){this._renderer.fadeOutRipple(this)}},N4=I_({passive:!0,capture:!0}),PP=class{_events=new Map;addHandler(n,t,l,h){let i=this._events.get(t);if(i){let E=i.get(l);E?E.add(h):i.set(l,new Set([h]))}else this._events.set(t,new Map([[l,new Set([h])]])),n.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,N4)})}removeHandler(n,t,l){let h=this._events.get(n);if(!h)return;let i=h.get(t);i&&(i.delete(l),i.size===0&&h.delete(t),h.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,N4)))}_delegateEventHandler=n=>{let t=Ma(n);t&&this._events.get(n.type)?.forEach((l,h)=>{(h===t||h.contains(t))&&l.forEach(i=>i.handleEvent(n))})}},Cx={enterDuration:225,exitDuration:150},ZX=800,z4=I_({passive:!0,capture:!0}),B4=["mousedown","touchstart"],V4=["mouseup","mouseleave","touchend","touchcancel"],XX=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(l,h){},styles:[`.mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}
`],encapsulation:2,changeDetection:0})}return r})(),XE=class r{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new PP;constructor(n,t,l,h,i){this._target=n,this._ngZone=t,this._platform=h,h.isBrowser&&(this._containerElement=Eu(l)),i&&i.get(Nh).load(XX)}fadeInRipple(n,t,l={}){let h=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=$t($t({},Cx),l.animation);l.centered&&(n=h.left+h.width/2,t=h.top+h.height/2);let E=l.radius||YX(n,t,h),O=n-h.left,N=t-h.top,K=i.enterDuration,le=document.createElement("div");le.classList.add("mat-ripple-element"),le.style.left=`${O-E}px`,le.style.top=`${N-E}px`,le.style.height=`${E*2}px`,le.style.width=`${E*2}px`,l.color!=null&&(le.style.backgroundColor=l.color),le.style.transitionDuration=`${K}ms`,this._containerElement.appendChild(le);let De=window.getComputedStyle(le),Qe=De.transitionProperty,Fe=De.transitionDuration,gt=Qe==="none"||Fe==="0s"||Fe==="0s, 0s"||h.width===0&&h.height===0,jt=new AP(this,le,l,gt);le.style.transform="scale3d(1, 1, 1)",jt.state=Ll.FADING_IN,l.persistent||(this._mostRecentTransientRipple=jt);let Ot=null;return!gt&&(K||i.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Kt=()=>{Ot&&(Ot.fallbackTimer=null),clearTimeout(Er),this._finishRippleTransition(jt)},Hn=()=>this._destroyRipple(jt),Er=setTimeout(Hn,K+100);le.addEventListener("transitionend",Kt),le.addEventListener("transitioncancel",Hn),Ot={onTransitionEnd:Kt,onTransitionCancel:Hn,fallbackTimer:Er}}),this._activeRipples.set(jt,Ot),(gt||!K)&&this._finishRippleTransition(jt),jt}fadeOutRipple(n){if(n.state===Ll.FADING_OUT||n.state===Ll.HIDDEN)return;let t=n.element,l=$t($t({},Cx),n.config.animation);t.style.transitionDuration=`${l.exitDuration}ms`,t.style.opacity="0",n.state=Ll.FADING_OUT,(n._animationForciblyDisabledThroughCss||!l.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let t=Eu(n);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,B4.forEach(l=>{r._eventManager.addHandler(this._ngZone,l,t,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{V4.forEach(t=>{this._triggerElement.addEventListener(t,this,z4)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===Ll.FADING_IN?this._startFadeOutTransition(n):n.state===Ll.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let t=n===this._mostRecentTransientRipple,{persistent:l}=n.config;n.state=Ll.VISIBLE,!l&&(!t||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let t=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=Ll.HIDDEN,t!==null&&(n.element.removeEventListener("transitionend",t.onTransitionEnd),n.element.removeEventListener("transitioncancel",t.onTransitionCancel),t.fallbackTimer!==null&&clearTimeout(t.fallbackTimer)),n.element.remove()}_onMousedown(n){let t=vx(n),l=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+ZX;!this._target.rippleDisabled&&!t&&!l&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!yx(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let t=n.changedTouches;if(t)for(let l=0;l<t.length;l++)this.fadeInRipple(t[l].clientX,t[l].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let t=n.state===Ll.VISIBLE||n.config.terminateOnPointerUp&&n.state===Ll.FADING_IN;!n.config.persistent&&t&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(B4.forEach(t=>r._eventManager.removeHandler(t,n,this)),this._pointerUpEventsRegistered&&(V4.forEach(t=>n.removeEventListener(t,this,z4)),this._pointerUpEventsRegistered=!1))}};function YX(r,n,t){let l=Math.max(Math.abs(r-t.left),Math.abs(r-t.right)),h=Math.max(Math.abs(n-t.top),Math.abs(n-t.bottom));return Math.sqrt(l*l+h*h)}var U4=new Yt("mat-ripple-global-options");var KX={capture:!0},QX=["focus","mousedown","mouseenter","touchstart"],OP="mat-ripple-loader-uninitialized",RP="mat-ripple-loader-class-name",j4="mat-ripple-loader-centered",YE="mat-ripple-loader-disabled",$4=(()=>{class r{_document=Ve(si);_animationsDisabled=Af();_globalRippleOptions=Ve(U4,{optional:!0});_platform=Ve(qo);_ngZone=Ve(yi);_injector=Ve(cr);_eventCleanups;_hosts=new Map;constructor(){let t=Ve(ps).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>QX.map(l=>t.listen(this._document,l,this._onInteraction,KX)))}ngOnDestroy(){let t=this._hosts.keys();for(let l of t)this.destroyRipple(l);this._eventCleanups.forEach(l=>l())}configureRipple(t,l){t.setAttribute(OP,this._globalRippleOptions?.namespace??""),(l.className||!t.hasAttribute(RP))&&t.setAttribute(RP,l.className||""),l.centered&&t.setAttribute(j4,""),l.disabled&&t.setAttribute(YE,"")}setDisabled(t,l){let h=this._hosts.get(t);h?(h.target.rippleDisabled=l,!l&&!h.hasSetUpEvents&&(h.hasSetUpEvents=!0,h.renderer.setupTriggerEvents(t))):l?t.setAttribute(YE,""):t.removeAttribute(YE)}_onInteraction=t=>{let l=Ma(t);if(l instanceof HTMLElement){let h=l.closest(`[${OP}="${this._globalRippleOptions?.namespace??""}"]`);h&&this._createRipple(h)}};_createRipple(t){if(!this._document||this._hosts.has(t))return;t.querySelector(".mat-ripple")?.remove();let l=this._document.createElement("span");l.classList.add("mat-ripple",t.getAttribute(RP)),t.append(l);let h=this._globalRippleOptions,i=this._animationsDisabled?0:h?.animation?.enterDuration??Cx.enterDuration,E=this._animationsDisabled?0:h?.animation?.exitDuration??Cx.exitDuration,O={rippleDisabled:this._animationsDisabled||h?.disabled||t.hasAttribute(YE),rippleConfig:{centered:t.hasAttribute(j4),terminateOnPointerUp:h?.terminateOnPointerUp,animation:{enterDuration:i,exitDuration:E}}},N=new XE(O,this._ngZone,l,this._platform,this._injector),K=!O.rippleDisabled;K&&N.setupTriggerEvents(t),this._hosts.set(t,{target:O,renderer:N,hasSetUpEvents:K}),t.removeAttribute(OP)}destroyRipple(t){let l=this._hosts.get(t);l&&(l.renderer._removeTriggerEvents(),this._hosts.delete(t))}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var H4=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["structural-styles"]],decls:0,vars:0,template:function(l,h){},styles:[`.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}
`],encapsulation:2,changeDetection:0})}return r})();var JX=new Yt("MAT_BUTTON_CONFIG");function G4(r){return r==null?void 0:h2(r)}var q4=(()=>{class r{_elementRef=Ve(ir);_ngZone=Ve(yi);_animationsDisabled=Af();_config=Ve(JX,{optional:!0});_focusMonitor=Ve(EP);_cleanupClick;_renderer=Ve(sa);_rippleLoader=Ve($4);_isAnchor;_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=t,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;tabIndex;set _tabindex(t){this.tabIndex=t}constructor(){Ve(Nh).load(H4);let t=this._elementRef.nativeElement;this._isAnchor=t.tagName==="A",this.disabledInteractive=this._config?.disabledInteractive??!1,this.color=this._config?.color??null,this._rippleLoader?.configureRipple(t,{className:"mat-mdc-button-ripple"})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0),this._isAnchor&&this._setupAsAnchor()}ngOnDestroy(){this._cleanupClick?.(),this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(t="program",l){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,l):this._elementRef.nativeElement.focus(l)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this._isAnchor?this.disabled||null:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}_getTabIndex(){return this._isAnchor?this.disabled&&!this.disabledInteractive?-1:this.tabIndex:this.tabIndex}_setupAsAnchor(){this._cleanupClick=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"click",t=>{this.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}))}static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,hostAttrs:[1,"mat-mdc-button-base"],hostVars:13,hostBindings:function(l,h){l&2&&($o("disabled",h._getDisabledAttribute())("aria-disabled",h._getAriaDisabled())("tabindex",h._getTabIndex()),Ry(h.color?"mat-"+h.color:""),fn("mat-mdc-button-disabled",h.disabled)("mat-mdc-button-disabled-interactive",h.disabledInteractive)("mat-unthemed",!h.color)("_mat-animation-noopable",h._animationsDisabled))},inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",As],disabled:[2,"disabled","disabled",As],ariaDisabled:[2,"aria-disabled","ariaDisabled",As],disabledInteractive:[2,"disabledInteractive","disabledInteractive",As],tabIndex:[2,"tabIndex","tabIndex",G4],_tabindex:[2,"tabindex","_tabindex",G4]}})}return r})();var W4=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[Fl,Fl]})}return r})();var eY=["matButton",""],tY=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],nY=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var Z4=new Map([["text",["mat-mdc-button"]],["filled",["mdc-button--unelevated","mat-mdc-unelevated-button"]],["elevated",["mdc-button--raised","mat-mdc-raised-button"]],["outlined",["mdc-button--outlined","mat-mdc-outlined-button"]],["tonal",["mat-tonal-button"]]]),X4=(()=>{class r extends q4{get appearance(){return this._appearance}set appearance(t){this.setAppearance(t||this._config?.defaultAppearance||"text")}_appearance=null;constructor(){super();let t=iY(this._elementRef.nativeElement);t&&this.setAppearance(t)}setAppearance(t){if(t===this._appearance)return;let l=this._elementRef.nativeElement.classList,h=this._appearance?Z4.get(this._appearance):null,i=Z4.get(t);h&&l.remove(...h),l.add(...i),this._appearance=t}static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["button","matButton",""],["a","matButton",""],["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""],["a","mat-button",""],["a","mat-raised-button",""],["a","mat-flat-button",""],["a","mat-stroked-button",""]],hostAttrs:[1,"mdc-button"],inputs:{appearance:[0,"matButton","appearance"]},exportAs:["matButton","matAnchor"],features:[fs],attrs:eY,ngContentSelectors:nY,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,h){l&1&&(vf(tY),Cd(0,"span",0),Ed(1),Mh(2,"span",1),Ed(3,1),Dh(),Ed(4,2),Cd(5,"span",2)(6,"span",3)),l&2&&fn("mdc-button__ripple",!h._isFab)("mdc-fab__ripple",h._isFab)},styles:[`.mat-mdc-button-base{text-decoration:none}.mat-mdc-button-base .mat-icon{min-height:fit-content;flex-shrink:0}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-button-text-horizontal-padding, 12px);height:var(--mat-button-text-container-height, 40px);font-family:var(--mat-button-text-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-text-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-text-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-text-label-text-transform);font-weight:var(--mat-button-text-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mat-button-text-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mat-button-text-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-text-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-button-text-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-button-text-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-text-touch-target-size, 48px);display:var(--mat-button-text-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-filled-container-height, 40px);font-family:var(--mat-button-filled-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-filled-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-filled-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-filled-label-text-transform);font-weight:var(--mat-button-filled-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-filled-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-button-filled-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-filled-touch-target-size, 48px);display:var(--mat-button-filled-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mat-button-filled-label-text-color, var(--mat-sys-on-primary));background-color:var(--mat-button-filled-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mat-button-filled-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-filled-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-filled-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mat-button-protected-container-elevation-shadow, var(--mat-sys-level1));height:var(--mat-button-protected-container-height, 40px);font-family:var(--mat-button-protected-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-protected-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-protected-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-protected-label-text-transform);font-weight:var(--mat-button-protected-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-protected-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-button-protected-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-protected-touch-target-size, 48px);display:var(--mat-button-protected-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-raised-button:not(:disabled){color:var(--mat-button-protected-label-text-color, var(--mat-sys-primary));background-color:var(--mat-button-protected-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mat-button-protected-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mat-button-protected-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mat-button-protected-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mat-button-protected-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-protected-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-protected-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mat-button-protected-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-outlined-container-height, 40px);font-family:var(--mat-button-outlined-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-outlined-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-outlined-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-outlined-label-text-transform);font-weight:var(--mat-button-outlined-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mat-button-outlined-container-shape, var(--mat-sys-corner-full));border-width:var(--mat-button-outlined-outline-width, 1px);padding:0 var(--mat-button-outlined-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-button-outlined-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-outlined-touch-target-size, 48px);display:var(--mat-button-outlined-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-outlined-button:not(:disabled){color:var(--mat-button-outlined-label-text-color, var(--mat-sys-primary));border-color:var(--mat-button-outlined-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-outlined-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mat-button-outlined-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-tonal-container-height, 40px);font-family:var(--mat-button-tonal-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-tonal-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-tonal-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-tonal-label-text-transform);font-weight:var(--mat-button-tonal-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-tonal-horizontal-padding, 24px)}.mat-tonal-button:not(:disabled){color:var(--mat-button-tonal-label-text-color, var(--mat-sys-on-secondary-container));background-color:var(--mat-button-tonal-container-color, var(--mat-sys-secondary-container))}.mat-tonal-button,.mat-tonal-button .mdc-button__ripple{border-radius:var(--mat-button-tonal-container-shape, var(--mat-sys-corner-full))}.mat-tonal-button[disabled],.mat-tonal-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-tonal-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-tonal-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-tonal-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}[dir=rtl] .mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}.mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}[dir=rtl] .mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}.mat-tonal-button .mat-ripple-element{background-color:var(--mat-button-tonal-ripple-color, color-mix(in srgb, var(--mat-sys-on-secondary-container) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-tonal-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-tonal-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-tonal-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-tonal-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-tonal-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-tonal-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-tonal-touch-target-size, 48px);display:var(--mat-button-tonal-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button,.mat-tonal-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon,.mat-tonal-button .mdc-button__label,.mat-tonal-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator,.mat-tonal-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before,.mat-tonal-button:focus>.mat-focus-indicator::before{content:"";border-radius:inherit}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable,.mat-tonal-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon,.mat-tonal-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-tonal-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}
`,`@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-button-base.mat-tonal-button,.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}
`],encapsulation:2,changeDetection:0})}return r})();function iY(r){return r.hasAttribute("mat-raised-button")?"elevated":r.hasAttribute("mat-stroked-button")?"outlined":r.hasAttribute("mat-flat-button")?"filled":r.hasAttribute("mat-button")?"text":null}var Y4=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[Fl,W4,Fl]})}return r})();var Ex=class{_attachedHost;attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;n!=null&&(this._attachedHost=null,n.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(n){this._attachedHost=n}},D_=class extends Ex{component;viewContainerRef;injector;projectableNodes;constructor(n,t,l,h){super(),this.component=n,this.viewContainerRef=t,this.injector=l,this.projectableNodes=h}},A_=class extends Ex{templateRef;viewContainerRef;context;injector;constructor(n,t,l,h){super(),this.templateRef=n,this.viewContainerRef=t,this.context=l,this.injector=h}get origin(){return this.templateRef.elementRef}attach(n,t=this.context){return this.context=t,super.attach(n)}detach(){return this.context=void 0,super.detach()}},kP=class extends Ex{element;constructor(n){super(),this.element=n instanceof ir?n.nativeElement:n}},P_=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(n){if(n instanceof D_)return this._attachedPortal=n,this.attachComponentPortal(n);if(n instanceof A_)return this._attachedPortal=n,this.attachTemplatePortal(n);if(this.attachDomPortal&&n instanceof kP)return this._attachedPortal=n,this.attachDomPortal(n)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},KE=class extends P_{outletElement;_appRef;_defaultInjector;constructor(n,t,l){super(),this.outletElement=n,this._appRef=t,this._defaultInjector=l}attachComponentPortal(n){let t;if(n.viewContainerRef){let l=n.injector||n.viewContainerRef.injector,h=l.get(gu,null,{optional:!0})||void 0;t=n.viewContainerRef.createComponent(n.component,{index:n.viewContainerRef.length,injector:l,ngModuleRef:h,projectableNodes:n.projectableNodes||void 0}),this.setDisposeFn(()=>t.destroy())}else{let l=this._appRef,h=n.injector||this._defaultInjector||cr.NULL,i=h.get(Hr,l.injector);t=qC(n.component,{elementInjector:h,environmentInjector:i,projectableNodes:n.projectableNodes||void 0}),l.attachView(t.hostView),this.setDisposeFn(()=>{l.viewCount>0&&l.detachView(t.hostView),t.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(t)),this._attachedPortal=n,t}attachTemplatePortal(n){let t=n.viewContainerRef,l=t.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return l.rootNodes.forEach(h=>this.outletElement.appendChild(h)),l.detectChanges(),this.setDisposeFn(()=>{let h=t.indexOf(l);h!==-1&&t.remove(h)}),this._attachedPortal=n,l}attachDomPortal=n=>{let t=n.element;t.parentNode;let l=this.outletElement.ownerDocument.createComment("dom-portal");t.parentNode.insertBefore(l,t),this.outletElement.appendChild(t),this._attachedPortal=n,super.setDisposeFn(()=>{l.parentNode&&l.parentNode.replaceChild(t,l)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}};var FP=(()=>{class r extends P_{_moduleRef=Ve(gu,{optional:!0});_document=Ve(si);_viewContainerRef=Ve(Ka);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(t){this.hasAttached()&&!t&&!this._isInitialized||(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t||null)}attached=new Zt;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(t){t.setAttachedHost(this);let l=t.viewContainerRef!=null?t.viewContainerRef:this._viewContainerRef,h=l.createComponent(t.component,{index:l.length,injector:t.injector||l.injector,projectableNodes:t.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return l!==this._viewContainerRef&&this._getRootNode().appendChild(h.hostView.rootNodes[0]),super.setDisposeFn(()=>h.destroy()),this._attachedPortal=t,this._attachedRef=h,this.attached.emit(h),h}attachTemplatePortal(t){t.setAttachedHost(this);let l=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=l,this.attached.emit(l),l}attachDomPortal=t=>{let l=t.element;l.parentNode;let h=this._document.createComment("dom-portal");t.setAttachedHost(this),l.parentNode.insertBefore(h,l),this._getRootNode().appendChild(l),this._attachedPortal=t,super.setDisposeFn(()=>{h.parentNode&&h.parentNode.replaceChild(l,h)})};_getRootNode(){let t=this._viewContainerRef.element.nativeElement;return t.nodeType===t.ELEMENT_NODE?t:t.parentNode}static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[fs]})}return r})();var QE=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})();var rY=20,LP=(()=>{class r{_ngZone=Ve(yi);_platform=Ve(qo);_renderer=Ve(ps).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new li;_scrolledCount=0;scrollContainers=new Map;register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){let l=this.scrollContainers.get(t);l&&(l.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=rY){return this._platform.isBrowser?new Pi(l=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let h=t>0?this._scrolled.pipe(ww(t)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{h.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Dn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((t,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(t,l){let h=this.getAncestorScrollContainers(t);return this.scrolled(l).pipe(xo(i=>!i||h.indexOf(i)>-1))}getAncestorScrollContainers(t){let l=[];return this.scrollContainers.forEach((h,i)=>{this._scrollableContainsElement(i,t)&&l.push(i)}),l}_scrollableContainsElement(t,l){let h=Eu(l),i=t.getElementRef().nativeElement;do if(h==i)return!0;while(h=h.parentElement);return!1}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var oY=20,Sx=(()=>{class r{_platform=Ve(qo);_listeners;_viewportSize;_change=new li;_document=Ve(si);constructor(){let t=Ve(yi),l=Ve(ps).createRenderer(null,null);t.runOutsideAngular(()=>{if(this._platform.isBrowser){let h=i=>this._change.next(i);this._listeners=[l.listen("window","resize",h),l.listen("window","orientationchange",h)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(t=>t()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){let t=this.getViewportScrollPosition(),{width:l,height:h}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+h,right:t.left+l,height:h,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let t=this._document,l=this._getWindow(),h=t.documentElement,i=h.getBoundingClientRect(),E=-i.top||t.body.scrollTop||l.scrollY||h.scrollTop||0,O=-i.left||t.body.scrollLeft||l.scrollX||h.scrollLeft||0;return{top:E,left:O}}change(t=oY){return t>0?this._change.pipe(ww(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var K4=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})(),NP=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[Bh,K4,Bh,K4]})}return r})();var Q4=k4();function oU(r){return new JE(r.get(Sx),r.get(si))}var JE=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(n,t){this._viewportRuler=n,this._document=t}attach(){}enable(){if(this._canBeEnabled()){let n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=ko(-this._previousScrollPosition.left),n.style.top=ko(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let n=this._document.documentElement,t=this._document.body,l=n.style,h=t.style,i=l.scrollBehavior||"",E=h.scrollBehavior||"";this._isEnabled=!1,l.left=this._previousHTMLStyles.left,l.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),Q4&&(l.scrollBehavior=h.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),Q4&&(l.scrollBehavior=i,h.scrollBehavior=E)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let t=this._document.documentElement,l=this._viewportRuler.getViewportSize();return t.scrollHeight>l.height||t.scrollWidth>l.width}};function sU(r,n){return new eS(r.get(LP),r.get(yi),r.get(Sx),n)}var eS=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(n,t,l,h){this._scrollDispatcher=n,this._ngZone=t,this._viewportRuler=l,this._config=h}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(this._scrollSubscription)return;let n=this._scrollDispatcher.scrolled(0).pipe(xo(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{let t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}};var Tx=class{enable(){}disable(){}attach(){}};function zP(r,n){return n.some(t=>{let l=r.bottom<t.top,h=r.top>t.bottom,i=r.right<t.left,E=r.left>t.right;return l||h||i||E})}function J4(r,n){return n.some(t=>{let l=r.top<t.top,h=r.bottom>t.bottom,i=r.left<t.left,E=r.right>t.right;return l||h||i||E})}function sS(r,n){return new tS(r.get(LP),r.get(Sx),r.get(yi),n)}var tS=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(n,t,l,h){this._scrollDispatcher=n,this._viewportRuler=t,this._ngZone=l,this._config=h}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(!this._scrollSubscription){let n=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(n).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:l,height:h}=this._viewportRuler.getViewportSize();zP(t,[{width:l,height:h,bottom:h,right:l,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},aU=(()=>{class r{_injector=Ve(cr);constructor(){}noop=()=>new Tx;close=t=>sU(this._injector,t);block=()=>oU(this._injector);reposition=t=>sS(this._injector,t);static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),O_=class{positionStrategy;scrollStrategy=new Tx;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(n){if(n){let t=Object.keys(n);for(let l of t)n[l]!==void 0&&(this[l]=n[l])}}};var nS=class{connectionPair;scrollableViewProperties;constructor(n,t){this.connectionPair=n,this.scrollableViewProperties=t}};var lU=(()=>{class r{_attachedOverlays=[];_document=Ve(si);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){let l=this._attachedOverlays.indexOf(t);l>-1&&this._attachedOverlays.splice(l,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),cU=(()=>{class r extends lU{_ngZone=Ve(yi);_renderer=Ve(ps).createRenderer(null,null);_cleanupKeydown;add(t){super.add(t),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=t=>{let l=this._attachedOverlays;for(let h=l.length-1;h>-1;h--)if(l[h]._keydownEvents.observers.length>0){this._ngZone.run(()=>l[h]._keydownEvents.next(t));break}};static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),uU=(()=>{class r extends lU{_platform=Ve(qo);_ngZone=Ve(yi);_renderer=Ve(ps).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(t){if(super.add(t),!this._isAttached){let l=this._document.body,h={capture:!0},i=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[i.listen(l,"pointerdown",this._pointerDownListener,h),i.listen(l,"click",this._clickListener,h),i.listen(l,"auxclick",this._clickListener,h),i.listen(l,"contextmenu",this._clickListener,h)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(t=>t()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=t=>{this._pointerDownEventTarget=Ma(t)};_clickListener=t=>{let l=Ma(t),h=t.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:l;this._pointerDownEventTarget=null;let i=this._attachedOverlays.slice();for(let E=i.length-1;E>-1;E--){let O=i[E];if(O._outsidePointerEvents.observers.length<1||!O.hasAttached())continue;if(eU(O.overlayElement,l)||eU(O.overlayElement,h))break;let N=O._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>N.next(t)):N.next(t)}};static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function eU(r,n){let t=typeof ShadowRoot<"u"&&ShadowRoot,l=n;for(;l;){if(l===r)return!0;l=t&&l instanceof ShadowRoot?l.host:l.parentNode}return!1}var dU=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(l,h){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}
`],encapsulation:2,changeDetection:0})}return r})(),hU=(()=>{class r{_platform=Ve(qo);_containerElement;_document=Ve(si);_styleLoader=Ve(Nh);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t="cdk-overlay-container";if(this._platform.isBrowser||DP()){let h=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let i=0;i<h.length;i++)h[i].remove()}let l=this._document.createElement("div");l.classList.add(t),DP()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}_loadStyles(){this._styleLoader.load(dU)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),BP=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(n,t,l,h){this._renderer=t,this._ngZone=l,this.element=n.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=t.listen(this.element,"click",h)}detach(){this._ngZone.runOutsideAngular(()=>{let n=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(n,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),n.style.pointerEvents="none",n.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},iS=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new li;_attachments=new li;_detachments=new li;_positionStrategy;_scrollStrategy;_locationChanges=Br.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_previousHostParent;_keydownEvents=new li;_outsidePointerEvents=new li;_afterNextRenderRef;constructor(n,t,l,h,i,E,O,N,K,le=!1,De,Qe){this._portalOutlet=n,this._host=t,this._pane=l,this._config=h,this._ngZone=i,this._keyboardDispatcher=E,this._document=O,this._location=N,this._outsideClickDispatcher=K,this._animationsDisabled=le,this._injector=De,this._renderer=Qe,h.scrollStrategy&&(this._scrollStrategy=h.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=h.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let t=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=Dl(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof t?.onDestroy=="function"&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let n=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){let n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,n&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config=$t($t({},this._config),n),this._updateElementSize()}setDirection(n){this._config=bi($t({},this._config),{direction:n}),this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){let n=this._config.direction;return n?typeof n=="string"?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let n=this._pane.style;n.width=ko(this._config.width),n.height=ko(this._config.height),n.minWidth=ko(this._config.minWidth),n.minHeight=ko(this._config.minHeight),n.maxWidth=ko(this._config.maxWidth),n.maxHeight=ko(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){let n="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new BP(this._document,this._renderer,this._ngZone,t=>{this._backdropClick.next(t)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(n))}):this._backdropRef.element.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(n,t,l){let h=M_(t||[]).filter(i=>!!i);h.length&&(l?n.classList.add(...h):n.classList.remove(...h))}_detachContentWhenEmpty(){let n=!1;try{this._detachContentAfterRenderRef=Dl(()=>{n=!0,this._detachContent()},{injector:this._injector})}catch(t){if(n)throw t;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let n=this._scrollStrategy;n?.disable(),n?.detach?.()}},tU="cdk-overlay-connected-position-bounding-box",sY=/([A-Za-z%]+)$/;function pU(r,n){return new rS(n,r.get(Sx),r.get(si),r.get(qo),r.get(hU))}var rS=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new li;_resizeSubscription=Br.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(n,t,l,h,i){this._viewportRuler=t,this._document=l,this._platform=h,this._overlayContainer=i,this.setOrigin(n)}attach(n){this._overlayRef&&this._overlayRef,this._validatePositions(),n.hostElement.classList.add(tU),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let n=this._originRect,t=this._overlayRect,l=this._viewportRect,h=this._containerRect,i=[],E;for(let O of this._preferredPositions){let N=this._getOriginPoint(n,h,O),K=this._getOverlayPoint(N,t,O),le=this._getOverlayFit(K,t,l,O);if(le.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(O,N);return}if(this._canFitWithFlexibleDimensions(le,K,l)){i.push({position:O,origin:N,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(N,O)});continue}(!E||E.overlayFit.visibleArea<le.visibleArea)&&(E={overlayFit:le,overlayPoint:K,originPoint:N,position:O,overlayRect:t})}if(i.length){let O=null,N=-1;for(let K of i){let le=K.boundingBoxRect.width*K.boundingBoxRect.height*(K.position.weight||1);le>N&&(N=le,O=K)}this._isPushed=!1,this._applyPosition(O.position,O.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(E.position,E.originPoint);return}this._applyPosition(E.position,E.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Pf(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(tU),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,t)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,n.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,t,l){let h;if(l.originX=="center")h=n.left+n.width/2;else{let E=this._isRtl()?n.right:n.left,O=this._isRtl()?n.left:n.right;h=l.originX=="start"?E:O}t.left<0&&(h-=t.left);let i;return l.originY=="center"?i=n.top+n.height/2:i=l.originY=="top"?n.top:n.bottom,t.top<0&&(i-=t.top),{x:h,y:i}}_getOverlayPoint(n,t,l){let h;l.overlayX=="center"?h=-t.width/2:l.overlayX==="start"?h=this._isRtl()?-t.width:0:h=this._isRtl()?0:-t.width;let i;return l.overlayY=="center"?i=-t.height/2:i=l.overlayY=="top"?0:-t.height,{x:n.x+h,y:n.y+i}}_getOverlayFit(n,t,l,h){let i=iU(t),{x:E,y:O}=n,N=this._getOffset(h,"x"),K=this._getOffset(h,"y");N&&(E+=N),K&&(O+=K);let le=0-E,De=E+i.width-l.width,Qe=0-O,Fe=O+i.height-l.height,gt=this._subtractOverflows(i.width,le,De),jt=this._subtractOverflows(i.height,Qe,Fe),Ot=gt*jt;return{visibleArea:Ot,isCompletelyWithinViewport:i.width*i.height===Ot,fitsInViewportVertically:jt===i.height,fitsInViewportHorizontally:gt==i.width}}_canFitWithFlexibleDimensions(n,t,l){if(this._hasFlexibleDimensions){let h=l.bottom-t.y,i=l.right-t.x,E=nU(this._overlayRef.getConfig().minHeight),O=nU(this._overlayRef.getConfig().minWidth),N=n.fitsInViewportVertically||E!=null&&E<=h,K=n.fitsInViewportHorizontally||O!=null&&O<=i;return N&&K}return!1}_pushOverlayOnScreen(n,t,l){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};let h=iU(t),i=this._viewportRect,E=Math.max(n.x+h.width-i.width,0),O=Math.max(n.y+h.height-i.height,0),N=Math.max(i.top-l.top-n.y,0),K=Math.max(i.left-l.left-n.x,0),le=0,De=0;return h.width<=i.width?le=K||-E:le=n.x<this._viewportMargin?i.left-l.left-n.x:0,h.height<=i.height?De=N||-O:De=n.y<this._viewportMargin?i.top-l.top-n.y:0,this._previousPushAmount={x:le,y:De},{x:n.x+le,y:n.y+De}}_applyPosition(n,t){if(this._setTransformOrigin(n),this._setOverlayElementStyles(t,n),this._setBoundingBoxStyles(t,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){let l=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!aY(this._lastScrollVisibility,l)){let h=new nS(n,l);this._positionChanges.next(h)}this._lastScrollVisibility=l}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;let t=this._boundingBox.querySelectorAll(this._transformOriginSelector),l,h=n.overlayY;n.overlayX==="center"?l="center":this._isRtl()?l=n.overlayX==="start"?"right":"left":l=n.overlayX==="start"?"left":"right";for(let i=0;i<t.length;i++)t[i].style.transformOrigin=`${l} ${h}`}_calculateBoundingBoxRect(n,t){let l=this._viewportRect,h=this._isRtl(),i,E,O;if(t.overlayY==="top")E=n.y,i=l.height-E+this._viewportMargin;else if(t.overlayY==="bottom")O=l.height-n.y+this._viewportMargin*2,i=l.height-O+this._viewportMargin;else{let Fe=Math.min(l.bottom-n.y+l.top,n.y),gt=this._lastBoundingBoxSize.height;i=Fe*2,E=n.y-Fe,i>gt&&!this._isInitialRender&&!this._growAfterOpen&&(E=n.y-gt/2)}let N=t.overlayX==="start"&&!h||t.overlayX==="end"&&h,K=t.overlayX==="end"&&!h||t.overlayX==="start"&&h,le,De,Qe;if(K)Qe=l.width-n.x+this._viewportMargin*2,le=n.x-this._viewportMargin;else if(N)De=n.x,le=l.right-n.x;else{let Fe=Math.min(l.right-n.x+l.left,n.x),gt=this._lastBoundingBoxSize.width;le=Fe*2,De=n.x-Fe,le>gt&&!this._isInitialRender&&!this._growAfterOpen&&(De=n.x-gt/2)}return{top:E,left:De,bottom:O,right:Qe,width:le,height:i}}_setBoundingBoxStyles(n,t){let l=this._calculateBoundingBoxRect(n,t);!this._isInitialRender&&!this._growAfterOpen&&(l.height=Math.min(l.height,this._lastBoundingBoxSize.height),l.width=Math.min(l.width,this._lastBoundingBoxSize.width));let h={};if(this._hasExactPosition())h.top=h.left="0",h.bottom=h.right=h.maxHeight=h.maxWidth="",h.width=h.height="100%";else{let i=this._overlayRef.getConfig().maxHeight,E=this._overlayRef.getConfig().maxWidth;h.height=ko(l.height),h.top=ko(l.top),h.bottom=ko(l.bottom),h.width=ko(l.width),h.left=ko(l.left),h.right=ko(l.right),t.overlayX==="center"?h.alignItems="center":h.alignItems=t.overlayX==="end"?"flex-end":"flex-start",t.overlayY==="center"?h.justifyContent="center":h.justifyContent=t.overlayY==="bottom"?"flex-end":"flex-start",i&&(h.maxHeight=ko(i)),E&&(h.maxWidth=ko(E))}this._lastBoundingBoxSize=l,Pf(this._boundingBox.style,h)}_resetBoundingBoxStyles(){Pf(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Pf(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,t){let l={},h=this._hasExactPosition(),i=this._hasFlexibleDimensions,E=this._overlayRef.getConfig();if(h){let le=this._viewportRuler.getViewportScrollPosition();Pf(l,this._getExactOverlayY(t,n,le)),Pf(l,this._getExactOverlayX(t,n,le))}else l.position="static";let O="",N=this._getOffset(t,"x"),K=this._getOffset(t,"y");N&&(O+=`translateX(${N}px) `),K&&(O+=`translateY(${K}px)`),l.transform=O.trim(),E.maxHeight&&(h?l.maxHeight=ko(E.maxHeight):i&&(l.maxHeight="")),E.maxWidth&&(h?l.maxWidth=ko(E.maxWidth):i&&(l.maxWidth="")),Pf(this._pane.style,l)}_getExactOverlayY(n,t,l){let h={top:"",bottom:""},i=this._getOverlayPoint(t,this._overlayRect,n);if(this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,l)),n.overlayY==="bottom"){let E=this._document.documentElement.clientHeight;h.bottom=`${E-(i.y+this._overlayRect.height)}px`}else h.top=ko(i.y);return h}_getExactOverlayX(n,t,l){let h={left:"",right:""},i=this._getOverlayPoint(t,this._overlayRect,n);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,l));let E;if(this._isRtl()?E=n.overlayX==="end"?"left":"right":E=n.overlayX==="end"?"right":"left",E==="right"){let O=this._document.documentElement.clientWidth;h.right=`${O-(i.x+this._overlayRect.width)}px`}else h.left=ko(i.x);return h}_getScrollVisibility(){let n=this._getOriginRect(),t=this._pane.getBoundingClientRect(),l=this._scrollables.map(h=>h.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:J4(n,l),isOriginOutsideView:zP(n,l),isOverlayClipped:J4(t,l),isOverlayOutsideView:zP(t,l)}}_subtractOverflows(n,...t){return t.reduce((l,h)=>l-Math.max(h,0),n)}_getNarrowedViewportRect(){let n=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,l=this._viewportRuler.getViewportScrollPosition();return{top:l.top+this._viewportMargin,left:l.left+this._viewportMargin,right:l.left+n-this._viewportMargin,bottom:l.top+t-this._viewportMargin,width:n-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,t){return t==="x"?n.offsetX==null?this._offsetX:n.offsetX:n.offsetY==null?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&M_(n).forEach(t=>{t!==""&&this._appliedPanelClasses.indexOf(t)===-1&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){let n=this._origin;if(n instanceof ir)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();let t=n.width||0,l=n.height||0;return{top:n.y,bottom:n.y+l,left:n.x,right:n.x+t,height:l,width:t}}};function Pf(r,n){for(let t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r}function nU(r){if(typeof r!="number"&&r!=null){let[n,t]=r.split(sY);return!t||t==="px"?parseFloat(n):null}return r||null}function iU(r){return{top:Math.floor(r.top),right:Math.floor(r.right),bottom:Math.floor(r.bottom),left:Math.floor(r.left),width:Math.floor(r.width),height:Math.floor(r.height)}}function aY(r,n){return r===n?!0:r.isOriginClipped===n.isOriginClipped&&r.isOriginOutsideView===n.isOriginOutsideView&&r.isOverlayClipped===n.isOverlayClipped&&r.isOverlayOutsideView===n.isOverlayOutsideView}var rU="cdk-global-overlay-wrapper";function aS(r){return new oS}var oS=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(n){let t=n.getConfig();this._overlayRef=n,this._width&&!t.width&&n.updateSize({width:this._width}),this._height&&!t.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(rU),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,l=this._overlayRef.getConfig(),{width:h,height:i,maxWidth:E,maxHeight:O}=l,N=(h==="100%"||h==="100vw")&&(!E||E==="100%"||E==="100vw"),K=(i==="100%"||i==="100vh")&&(!O||O==="100%"||O==="100vh"),le=this._xPosition,De=this._xOffset,Qe=this._overlayRef.getConfig().direction==="rtl",Fe="",gt="",jt="";N?jt="flex-start":le==="center"?(jt="center",Qe?gt=De:Fe=De):Qe?le==="left"||le==="end"?(jt="flex-end",Fe=De):(le==="right"||le==="start")&&(jt="flex-start",gt=De):le==="left"||le==="start"?(jt="flex-start",Fe=De):(le==="right"||le==="end")&&(jt="flex-end",gt=De),n.position=this._cssPosition,n.marginLeft=N?"0":Fe,n.marginTop=K?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=N?"0":gt,t.justifyContent=jt,t.alignItems=K?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,l=t.style;t.classList.remove(rU),l.justifyContent=l.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}},fU=(()=>{class r{_injector=Ve(cr);constructor(){}global(){return aS()}flexibleConnectedTo(t){return pU(this._injector,t)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function lS(r,n){r.get(Nh).load(dU);let t=r.get(hU),l=r.get(si),h=r.get(wx),i=r.get(Ea),E=r.get(O4),O=l.createElement("div"),N=l.createElement("div");N.id=h.getId("cdk-overlay-"),N.classList.add("cdk-overlay-pane"),O.appendChild(N),t.getContainerElement().appendChild(O);let K=new KE(N,i,r),le=new O_(n),De=r.get(sa,null,{optional:!0})||r.get(ps).createRenderer(null,null);return le.direction=le.direction||E.value,new iS(K,O,N,le,r.get(yi),r.get(cU),l,r.get(vu),r.get(uU),n?.disableAnimations??r.get(Ey,null,{optional:!0})==="NoopAnimations",r.get(Hr),De)}var mU=(()=>{class r{scrollStrategies=Ve(aU);_positionBuilder=Ve(fU);_injector=Ve(cr);constructor(){}create(t){return lS(this._injector,t)}position(){return this._positionBuilder}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var lY=new Yt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let r=Ve(cr);return()=>sS(r)}});function cY(r){let n=Ve(cr);return()=>sS(n)}var uY={provide:lY,useFactory:cY},VP=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({providers:[mU,uY],imports:[Bh,QE,NP,NP]})}return r})();function dY(r,n){if(r&1){let t=It();B(0,"div",1)(1,"button",2),Re("click",function(){Pe(t);let h=re();return Oe(h.action())}),Q(2),U()()}if(r&2){let t=re();ne(2),mr(" ",t.data.action," ")}}var hY=["label"];function pY(r,n){}var fY=Math.pow(2,31)-1,Ix=class{_overlayRef;instance;containerInstance;_afterDismissed=new li;_afterOpened=new li;_onAction=new li;_durationTimeoutId;_dismissedByAction=!1;constructor(n,t){this._overlayRef=t,this.containerInstance=n,n._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(n){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(n,fY))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},gU=new Yt("MatSnackBarData"),R_=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},mY=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return r})(),gY=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return r})(),_Y=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return r})(),_U=(()=>{class r{snackBarRef=Ve(Ix);data=Ve(gU);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(l,h){l&1&&(B(0,"div",0),Q(1),U(),ft(2,dY,3,1,"div",1)),l&2&&(ne(),mr(" ",h.data.message,`
`),ne(),mt(h.hasAction?2:-1))},dependencies:[X4,mY,gY,_Y],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return r})(),UP="_mat-snack-bar-enter",jP="_mat-snack-bar-exit",vY=(()=>{class r extends P_{_ngZone=Ve(yi);_elementRef=Ve(ir);_changeDetectorRef=Ve(_u);_platform=Ve(qo);_animationsDisabled=Af();snackBarConfig=Ve(R_);_document=Ve(si);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=Ve(cr);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new li;_onExit=new li;_onEnter=new li;_animationState="void";_live;_label;_role;_liveElementId=Ve(wx).getId("mat-snack-bar-container-live-");constructor(){super();let t=this.snackBarConfig;t.politeness==="assertive"&&!t.announcementMessage?this._live="assertive":t.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(t){this._assertNotAttached();let l=this._portalOutlet.attachComponentPortal(t);return this._afterPortalAttached(),l}attachTemplatePortal(t){this._assertNotAttached();let l=this._portalOutlet.attachTemplatePortal(t);return this._afterPortalAttached(),l}attachDomPortal=t=>{this._assertNotAttached();let l=this._portalOutlet.attachDomPortal(t);return this._afterPortalAttached(),l};onAnimationEnd(t){t===jP?this._completeExit():t===UP&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?Dl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(UP)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(UP)},200)))}exit(){return this._destroyed?Dn(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?Dl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(jP)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(jP),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let t=this._elementRef.nativeElement,l=this.snackBarConfig.panelClass;l&&(Array.isArray(l)?l.forEach(E=>t.classList.add(E)):t.classList.add(l)),this._exposeToModals();let h=this._label.nativeElement,i="mdc-snackbar__label";h.classList.toggle(i,!h.querySelector(`.${i}`))}_exposeToModals(){let t=this._liveElementId,l=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let h=0;h<l.length;h++){let i=l[h],E=i.getAttribute("aria-owns");this._trackedModals.add(i),E?E.indexOf(t)===-1&&i.setAttribute("aria-owns",E+" "+t):i.setAttribute("aria-owns",t)}}_clearFromModals(){this._trackedModals.forEach(t=>{let l=t.getAttribute("aria-owns");if(l){let h=l.replace(this._liveElementId,"").trim();h.length>0?t.setAttribute("aria-owns",h):t.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let t=this._elementRef.nativeElement,l=t.querySelector("[aria-hidden]"),h=t.querySelector("[aria-live]");if(l&&h){let i=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&l.contains(document.activeElement)&&(i=document.activeElement),l.removeAttribute("aria-hidden"),h.appendChild(l),i?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(l){return new(l||r)};static \u0275cmp=In({type:r,selectors:[["mat-snack-bar-container"]],viewQuery:function(l,h){if(l&1&&(Sa(FP,7),Sa(hY,7)),l&2){let i;aa(i=la())&&(h._portalOutlet=i.first),aa(i=la())&&(h._label=i.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(l,h){l&1&&Re("animationend",function(E){return h.onAnimationEnd(E.animationName)})("animationcancel",function(E){return h.onAnimationEnd(E.animationName)}),l&2&&fn("mat-snack-bar-container-enter",h._animationState==="visible")("mat-snack-bar-container-exit",h._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!h._animationsDisabled)},features:[fs],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(l,h){l&1&&(B(0,"div",1)(1,"div",2,0)(3,"div",3),Ui(4,pY,0,0,"ng-template",4),U(),Mn(5,"div"),U()()),l&2&&(ne(5),$o("aria-live",h._live)("role",h._role)("id",h._liveElementId))},dependencies:[FP],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return r})();function yY(){return new R_}var xY=new Yt("mat-snack-bar-default-options",{providedIn:"root",factory:yY}),$P=(()=>{class r{_live=Ve(TP);_injector=Ve(cr);_breakpointObserver=Ve(Mf);_parentSnackBar=Ve(r,{optional:!0,skipSelf:!0});_defaultConfig=Ve(xY);_animationsDisabled=Af();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=_U;snackBarContainerComponent=vY;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let t=this._parentSnackBar;return t?t._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(t){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=t:this._snackBarRefAtThisLevel=t}constructor(){}openFromComponent(t,l){return this._attach(t,l)}openFromTemplate(t,l){return this._attach(t,l)}open(t,l="",h){let i=$t($t({},this._defaultConfig),h);return i.data={message:t,action:l},i.announcementMessage===t&&(i.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,i)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(t,l){let h=l&&l.viewContainerRef&&l.viewContainerRef.injector,i=cr.create({parent:h||this._injector,providers:[{provide:R_,useValue:l}]}),E=new D_(this.snackBarContainerComponent,l.viewContainerRef,i),O=t.attach(E);return O.instance.snackBarConfig=l,O.instance}_attach(t,l){let h=$t($t($t({},new R_),this._defaultConfig),l),i=this._createOverlay(h),E=this._attachSnackBarContainer(i,h),O=new Ix(E,i);if(t instanceof Xa){let N=new A_(t,null,{$implicit:h.data,snackBarRef:O});O.instance=E.attachTemplatePortal(N)}else{let N=this._createInjector(h,O),K=new D_(t,void 0,N),le=E.attachComponentPortal(K);O.instance=le.instance}return this._breakpointObserver.observe(F4.HandsetPortrait).pipe(mc(i.detachments())).subscribe(N=>{i.overlayElement.classList.toggle(this.handsetCssClass,N.matches)}),h.announcementMessage&&E._onAnnounce.subscribe(()=>{this._live.announce(h.announcementMessage,h.politeness)}),this._animateSnackBar(O,h),this._openedSnackBarRef=O,this._openedSnackBarRef}_animateSnackBar(t,l){t.afterDismissed().subscribe(()=>{this._openedSnackBarRef==t&&(this._openedSnackBarRef=null),l.announcementMessage&&this._live.clear()}),l.duration&&l.duration>0&&t.afterOpened().subscribe(()=>t._dismissAfter(l.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{t.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):t.containerInstance.enter()}_createOverlay(t){let l=new O_;l.direction=t.direction;let h=aS(this._injector),i=t.direction==="rtl",E=t.horizontalPosition==="left"||t.horizontalPosition==="start"&&!i||t.horizontalPosition==="end"&&i,O=!E&&t.horizontalPosition!=="center";return E?h.left("0"):O?h.right("0"):h.centerHorizontally(),t.verticalPosition==="top"?h.top("0"):h.bottom("0"),l.positionStrategy=h,l.disableAnimations=this._animationsDisabled,lS(this._injector,l)}_createInjector(t,l){let h=t&&t.viewContainerRef&&t.viewContainerRef.injector;return cr.create({parent:h||this._injector,providers:[{provide:Ix,useValue:l},{provide:gU,useValue:t.data}]})}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var vU=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({providers:[$P],imports:[VP,QE,Y4,Fl,_U,Fl]})}return r})();var IU=(()=>{class r{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,l){this._renderer=t,this._elementRef=l}setProperty(t,l){this._renderer.setProperty(this._elementRef.nativeElement,t,l)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(l){return new(l||r)(Bt(sa),Bt(ir))};static \u0275dir=fr({type:r})}return r})(),MU=(()=>{class r extends IU{static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275dir=fr({type:r,features:[fs]})}return r})(),vS=new Yt("");var wY={provide:vS,useExisting:su(()=>Us),multi:!0};function CY(){let r=Pl()?Pl().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var EY=new Yt(""),Us=(()=>{class r extends IU{_compositionMode;_composing=!1;constructor(t,l,h){super(t,l),this._compositionMode=h,this._compositionMode==null&&(this._compositionMode=!CY())}writeValue(t){let l=t??"";this.setProperty("value",l)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(l){return new(l||r)(Bt(sa),Bt(ir),Bt(EY,8))};static \u0275dir=fr({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(l,h){l&1&&Re("input",function(E){return h._handleInput(E.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(E){return h._compositionEnd(E.target.value)})},standalone:!1,features:[Sd([wY]),fs]})}return r})();function WP(r){return r==null||ZP(r)===0}function ZP(r){return r==null?null:Array.isArray(r)||typeof r=="string"?r.length:r instanceof Set?r.size:null}var DU=new Yt(""),AU=new Yt(""),SY=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Su=class{static min(n){return TY(n)}static max(n){return IY(n)}static required(n){return MY(n)}static requiredTrue(n){return DY(n)}static email(n){return AY(n)}static minLength(n){return PY(n)}static maxLength(n){return OY(n)}static pattern(n){return RY(n)}static nullValidator(n){return PU()}static compose(n){return NU(n)}static composeAsync(n){return BU(n)}};function TY(r){return n=>{if(n.value==null||r==null)return null;let t=parseFloat(n.value);return!isNaN(t)&&t<r?{min:{min:r,actual:n.value}}:null}}function IY(r){return n=>{if(n.value==null||r==null)return null;let t=parseFloat(n.value);return!isNaN(t)&&t>r?{max:{max:r,actual:n.value}}:null}}function MY(r){return WP(r.value)?{required:!0}:null}function DY(r){return r.value===!0?null:{required:!0}}function AY(r){return WP(r.value)||SY.test(r.value)?null:{email:!0}}function PY(r){return n=>{let t=n.value?.length??ZP(n.value);return t===null||t===0?null:t<r?{minlength:{requiredLength:r,actualLength:t}}:null}}function OY(r){return n=>{let t=n.value?.length??ZP(n.value);return t!==null&&t>r?{maxlength:{requiredLength:r,actualLength:t}}:null}}function RY(r){if(!r)return PU;let n,t;return typeof r=="string"?(t="",r.charAt(0)!=="^"&&(t+="^"),t+=r,r.charAt(r.length-1)!=="$"&&(t+="$"),n=new RegExp(t)):(t=r.toString(),n=r),l=>{if(WP(l.value))return null;let h=l.value;return n.test(h)?null:{pattern:{requiredPattern:t,actualValue:h}}}}function PU(r){return null}function OU(r){return r!=null}function RU(r){return Ih(r)?co(r):r}function kU(r){let n={};return r.forEach(t=>{n=t!=null?$t($t({},n),t):n}),Object.keys(n).length===0?null:n}function FU(r,n){return n.map(t=>t(r))}function kY(r){return!r.validate}function LU(r){return r.map(n=>kY(n)?n:t=>n.validate(t))}function NU(r){if(!r)return null;let n=r.filter(OU);return n.length==0?null:function(t){return kU(FU(t,n))}}function zU(r){return r!=null?NU(LU(r)):null}function BU(r){if(!r)return null;let n=r.filter(OU);return n.length==0?null:function(t){let l=FU(t,n).map(RU);return K0(l).pipe(Qn(kU))}}function VU(r){return r!=null?BU(LU(r)):null}function yU(r,n){return r===null?[n]:Array.isArray(r)?[...r,n]:[r,n]}function UU(r){return r._rawValidators}function jU(r){return r._rawAsyncValidators}function HP(r){return r?Array.isArray(r)?r:[r]:[]}function dS(r,n){return Array.isArray(r)?r.includes(n):r===n}function xU(r,n){let t=HP(n);return HP(r).forEach(h=>{dS(t,h)||t.push(h)}),t}function bU(r,n){return HP(n).filter(t=>!dS(r,t))}var hS=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=zU(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=VU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return this.control?this.control.hasError(n,t):!1}getError(n,t){return this.control?this.control.getError(n,t):null}},pS=class extends hS{name;get formDirective(){return null}get path(){return null}},Of=class extends hS{_parent=null;name=null;valueAccessor=null},fS=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},FY={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Vwe=bi($t({},FY),{"[class.ng-submitted]":"isSubmitted"}),Da=(()=>{class r extends fS{constructor(t){super(t)}static \u0275fac=function(l){return new(l||r)(Bt(Of,2))};static \u0275dir=fr({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(l,h){l&2&&fn("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)},standalone:!1,features:[fs]})}return r})(),N_=(()=>{class r extends fS{constructor(t){super(t)}static \u0275fac=function(l){return new(l||r)(Bt(pS,10))};static \u0275dir=fr({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(l,h){l&2&&fn("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)("ng-submitted",h.isSubmitted)},standalone:!1,features:[fs]})}return r})();var Mx="VALID",cS="INVALID",k_="PENDING",Dx="DISABLED",Rf=class{},mS=class extends Rf{value;source;constructor(n,t){super(),this.value=n,this.source=t}},Ax=class extends Rf{pristine;source;constructor(n,t){super(),this.pristine=n,this.source=t}},Px=class extends Rf{touched;source;constructor(n,t){super(),this.touched=n,this.source=t}},F_=class extends Rf{status;source;constructor(n,t){super(),this.status=n,this.source=t}};var Ox=class extends Rf{source;constructor(n){super(),this.source=n}};function XP(r){return(yS(r)?r.validators:r)||null}function LY(r){return Array.isArray(r)?zU(r):r||null}function YP(r,n){return(yS(n)?n.asyncValidators:r)||null}function NY(r){return Array.isArray(r)?VU(r):r||null}function yS(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function $U(r,n,t){let l=r.controls;if(!(n?Object.keys(l):l).length)throw new sn(1e3,"");if(!l[t])throw new sn(1001,"")}function HU(r,n,t){r._forEachChild((l,h)=>{if(t[h]===void 0)throw new sn(1002,"")})}var L_=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,t){this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return ms(this.statusReactive)}set status(n){ms(()=>this.statusReactive.set(n))}_status=Ly(()=>this.statusReactive());statusReactive=oa(void 0);get valid(){return this.status===Mx}get invalid(){return this.status===cS}get pending(){return this.status==k_}get disabled(){return this.status===Dx}get enabled(){return this.status!==Dx}errors;get pristine(){return ms(this.pristineReactive)}set pristine(n){ms(()=>this.pristineReactive.set(n))}_pristine=Ly(()=>this.pristineReactive());pristineReactive=oa(!0);get dirty(){return!this.pristine}get touched(){return ms(this.touchedReactive)}set touched(n){ms(()=>this.touchedReactive.set(n))}_touched=Ly(()=>this.touchedReactive());touchedReactive=oa(!1);get untouched(){return!this.touched}_events=new li;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(xU(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(xU(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(bU(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(bU(n,this._rawAsyncValidators))}hasValidator(n){return dS(this._rawValidators,n)}hasAsyncValidator(n){return dS(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let t=this.touched===!1;this.touched=!0;let l=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(bi($t({},n),{sourceControl:l})),t&&n.emitEvent!==!1&&this._events.next(new Px(!0,l))}markAllAsDirty(n={}){this.markAsDirty({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(n))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(n))}markAsUntouched(n={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let l=n.sourceControl??this;this._forEachChild(h=>{h.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:l})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,l),t&&n.emitEvent!==!1&&this._events.next(new Px(!1,l))}markAsDirty(n={}){let t=this.pristine===!0;this.pristine=!1;let l=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(bi($t({},n),{sourceControl:l})),t&&n.emitEvent!==!1&&this._events.next(new Ax(!1,l))}markAsPristine(n={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let l=n.sourceControl??this;this._forEachChild(h=>{h.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,l),t&&n.emitEvent!==!1&&this._events.next(new Ax(!0,l))}markAsPending(n={}){this.status=k_;let t=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new F_(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(bi($t({},n),{sourceControl:t}))}disable(n={}){let t=this._parentMarkedDirty(n.onlySelf);this.status=Dx,this.errors=null,this._forEachChild(h=>{h.disable(bi($t({},n),{onlySelf:!0}))}),this._updateValue();let l=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new mS(this.value,l)),this._events.next(new F_(this.status,l)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(bi($t({},n),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(h=>h(!0))}enable(n={}){let t=this._parentMarkedDirty(n.onlySelf);this.status=Mx,this._forEachChild(l=>{l.enable(bi($t({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(bi($t({},n),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(l=>l(!1))}_updateAncestors(n,t){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let l=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Mx||this.status===k_)&&this._runAsyncValidator(l,n.emitEvent)}let t=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new mS(this.value,t)),this._events.next(new F_(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(bi($t({},n),{sourceControl:t}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Dx:Mx}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,t){if(this.asyncValidator){this.status=k_,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:n!==!1};let l=RU(this.asyncValidator(this));this._asyncValidationSubscription=l.subscribe(h=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(h,{emitEvent:t,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(n){let t=n;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((l,h)=>l&&l._find(h),this)}getError(n,t){let l=t?this.get(t):this;return l&&l.errors?l.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,t,l){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||l)&&this._events.next(new F_(this.status,t)),this._parent&&this._parent._updateControlsErrors(n,t,l)}_initObservables(){this.valueChanges=new Zt,this.statusChanges=new Zt}_calculateStatus(){return this._allControlsDisabled()?Dx:this.errors?cS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(k_)?k_:this._anyControlsHaveStatus(cS)?cS:Mx}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,t){let l=!this._anyControlsDirty(),h=this.pristine!==l;this.pristine=l,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,t),h&&this._events.next(new Ax(this.pristine,t))}_updateTouched(n={},t){this.touched=this._anyControlsTouched(),this._events.next(new Px(this.touched,t)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,t)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){yS(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let t=this._parent&&this._parent.dirty;return!n&&!!t&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=LY(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=NY(this._rawAsyncValidators)}},gS=class extends L_{constructor(n,t,l){super(XP(t),YP(l,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,l={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,l={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){HU(this,!0,n),Object.keys(n).forEach(l=>{$U(this,!0,l),this.controls[l].setValue(n[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){n!=null&&(Object.keys(n).forEach(l=>{let h=this.controls[l];h&&h.patchValue(n[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((l,h)=>{l.reset(n?n[h]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Ox(this))}getRawValue(){return this._reduceChildren({},(n,t,l)=>(n[l]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,l)=>l._syncPendingControls()?!0:t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{let l=this.controls[t];l&&n(l,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[t,l]of Object.entries(this.controls))if(this.contains(t)&&n(l))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(t,l,h)=>((l.enabled||this.disabled)&&(t[h]=l.value),t))}_reduceChildren(n,t){let l=n;return this._forEachChild((h,i)=>{l=t(l,h,i)}),l}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var GP=class extends gS{};var xS=new Yt("",{providedIn:"root",factory:()=>bS}),bS="always";function zY(r,n){return[...n.path,r]}function GU(r,n,t=bS){VY(r,n),n.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&n.valueAccessor.setDisabledState?.(r.disabled),jY(r,n),HY(r,n),$Y(r,n),BY(r,n)}function wU(r,n,t=!0){let l=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(l),n.valueAccessor.registerOnTouched(l)),UY(r,n),r&&(n._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function _S(r,n){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function BY(r,n){if(n.valueAccessor.setDisabledState){let t=l=>{n.valueAccessor.setDisabledState(l)};r.registerOnDisabledChange(t),n._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function VY(r,n){let t=UU(r);n.validator!==null?r.setValidators(yU(t,n.validator)):typeof t=="function"&&r.setValidators([t]);let l=jU(r);n.asyncValidator!==null?r.setAsyncValidators(yU(l,n.asyncValidator)):typeof l=="function"&&r.setAsyncValidators([l]);let h=()=>r.updateValueAndValidity();_S(n._rawValidators,h),_S(n._rawAsyncValidators,h)}function UY(r,n){let t=!1;if(r!==null){if(n.validator!==null){let h=UU(r);if(Array.isArray(h)&&h.length>0){let i=h.filter(E=>E!==n.validator);i.length!==h.length&&(t=!0,r.setValidators(i))}}if(n.asyncValidator!==null){let h=jU(r);if(Array.isArray(h)&&h.length>0){let i=h.filter(E=>E!==n.asyncValidator);i.length!==h.length&&(t=!0,r.setAsyncValidators(i))}}}let l=()=>{};return _S(n._rawValidators,l),_S(n._rawAsyncValidators,l),t}function jY(r,n){n.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&qU(r,n)})}function $Y(r,n){n.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&qU(r,n),r.updateOn!=="submit"&&r.markAsTouched()})}function qU(r,n){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function HY(r,n){let t=(l,h)=>{n.valueAccessor.writeValue(l),h&&n.viewToModelUpdate(l)};r.registerOnChange(t),n._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function WU(r,n){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(n,t.currentValue)}function GY(r){return Object.getPrototypeOf(r.constructor)===MU}function ZU(r,n){if(!n)return null;Array.isArray(n);let t,l,h;return n.forEach(i=>{i.constructor===Us?t=i:GY(i)?l=i:h=i}),h||l||t||null}function CU(r,n){let t=r.indexOf(n);t>-1&&r.splice(t,1)}function EU(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var uS=class extends L_{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,t,l){super(XP(t),YP(l,t)),this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),yS(t)&&(t.nonNullable||t.initialValueIsDefault)&&(EU(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(l=>l(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new Ox(this))}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){CU(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){CU(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){EU(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var qY={provide:Of,useExisting:su(()=>nl)},SU=Promise.resolve(),nl=(()=>{class r extends Of{_changeDetectorRef;callSetDisabledState;control=new uS;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Zt;constructor(t,l,h,i,E,O){super(),this._changeDetectorRef=E,this.callSetDisabledState=O,this._parent=t,this._setValidators(l),this._setAsyncValidators(h),this.valueAccessor=ZU(this,i)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let l=t.name.previousValue;this.formDirective.removeControl({name:l,path:this._getPath(l)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),WU(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){GU(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){SU.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let l=t.isDisabled.currentValue,h=l!==0&&As(l);SU.then(()=>{h&&!this.control.disabled?this.control.disable():!h&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?zY(t,this._parent):[t]}static \u0275fac=function(l){return new(l||r)(Bt(pS,9),Bt(DU,10),Bt(AU,10),Bt(vS,10),Bt(_u,8),Bt(xS,8))};static \u0275dir=fr({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Sd([qY]),fs,Vr]})}return r})();var z_=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275dir=fr({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return r})();var WY={provide:vS,useExisting:su(()=>Rx),multi:!0},Rx=(()=>{class r extends MU{writeValue(t){this.setProperty("value",parseFloat(t))}registerOnChange(t){this.onChange=l=>{t(l==""?null:parseFloat(l))}}static \u0275fac=(()=>{let t;return function(h){return(t||(t=Cc(r)))(h||r)}})();static \u0275dir=fr({type:r,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(l,h){l&1&&Re("change",function(E){return h.onChange(E.target.value)})("input",function(E){return h.onChange(E.target.value)})("blur",function(){return h.onTouched()})},standalone:!1,features:[Sd([WY]),fs]})}return r})(),XU=new Yt(""),ZY={provide:Of,useExisting:su(()=>KP)},KP=(()=>{class r extends Of{_ngModelWarningConfig;callSetDisabledState;viewModel;form;set isDisabled(t){}model;update=new Zt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(t,l,h,i,E){super(),this._ngModelWarningConfig=i,this.callSetDisabledState=E,this._setValidators(t),this._setAsyncValidators(l),this.valueAccessor=ZU(this,h)}ngOnChanges(t){if(this._isControlChanged(t)){let l=t.form.previousValue;l&&wU(l,this,!1),GU(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}WU(t,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&wU(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_isControlChanged(t){return t.hasOwnProperty("form")}static \u0275fac=function(l){return new(l||r)(Bt(DU,10),Bt(AU,10),Bt(vS,10),Bt(XU,8),Bt(xS,8))};static \u0275dir=fr({type:r,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],standalone:!1,features:[Sd([ZY]),fs,Vr]})}return r})();var YU=(()=>{class r{static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({})}return r})(),qP=class extends L_{constructor(n,t,l){super(XP(t),YP(l,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){Array.isArray(n)?n.forEach(l=>{this.controls.push(l),this._registerControl(l)}):(this.controls.push(n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,l={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:l.emitEvent})}removeAt(n,t={}){let l=this._adjustIndex(n);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,l={}){let h=this._adjustIndex(n);h<0&&(h=0),this.controls[h]&&this.controls[h]._registerOnCollectionChange(()=>{}),this.controls.splice(h,1),t&&(this.controls.splice(h,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){HU(this,!1,n),n.forEach((l,h)=>{$U(this,!1,h),this.at(h).setValue(l,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){n!=null&&(n.forEach((l,h)=>{this.at(h)&&this.at(h).patchValue(l,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((l,h)=>{l.reset(n[h],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Ox(this))}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,l)=>l._syncPendingControls()?!0:t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,l)=>{n(t,l)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function TU(r){return!!r&&(r.asyncValidators!==void 0||r.validators!==void 0||r.updateOn!==void 0)}var B_=(()=>{class r{useNonNullable=!1;get nonNullable(){let t=new r;return t.useNonNullable=!0,t}group(t,l=null){let h=this._reduceControls(t),i={};return TU(l)?i=l:l!==null&&(i.validators=l.validator,i.asyncValidators=l.asyncValidator),new gS(h,i)}record(t,l=null){let h=this._reduceControls(t);return new GP(h,l)}control(t,l,h){let i={};return this.useNonNullable?(TU(l)?i=l:(i.validators=l,i.asyncValidators=h),new uS(t,bi($t({},i),{nonNullable:!0}))):new uS(t,l,h)}array(t,l,h){let i=t.map(E=>this._createControl(E));return new qP(i,l,h)}_reduceControls(t){let l={};return Object.keys(t).forEach(h=>{l[h]=this._createControl(t[h])}),l}_createControl(t){if(t instanceof uS)return t;if(t instanceof L_)return t;if(Array.isArray(t)){let l=t[0],h=t.length>1?t[1]:null,i=t.length>2?t[2]:null;return this.control(l,h,i)}else return this.control(t)}static \u0275fac=function(l){return new(l||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Nl=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:xS,useValue:t.callSetDisabledState??bS}]}}static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[YU]})}return r})(),Vh=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:XU,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:xS,useValue:t.callSetDisabledState??bS}]}}static \u0275fac=function(l){return new(l||r)};static \u0275mod=Cr({type:r});static \u0275inj=gr({imports:[YU]})}return r})();var _s=class r{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/users";getUsers(){return this.http.get(this.apiUrl)}getUserById(n){return this.http.get(`${this.apiUrl}/${n}`)}searchUsers(n){return this.http.get(`${this.apiUrl}/search?q=${n}`)}toggleSavedEvent(n,t){return this.http.post(`${this.apiUrl}/${n}/saved-events/${t}`,{})}followUser(n,t){return this.http.post(`${this.apiUrl}/${n}/follow/${t}`,{})}unfollowUser(n,t){return this.http.delete(`${this.apiUrl}/${n}/follow/${t}`)}isFollowing(n,t){return this.http.get(`${this.apiUrl}/${n}/is-following/${t}?t=${new Date().getTime()}`)}getFollowNotifications(n,t){return this.http.get(`${this.apiUrl}/${n}/follow/${t}/notifications?t=${new Date().getTime()}`)}setFollowNotifications(n,t,l){return this.http.put(`${this.apiUrl}/${n}/follow/${t}/notifications?enabled=${l}`,{})}getFollowers(n){return this.http.get(`${this.apiUrl}/${n}/followers`)}getFollowing(n){return this.http.get(`${this.apiUrl}/${n}/following`)}updateUser(n,t){return this.http.put(`${this.apiUrl}/${n}`,t)}changePassword(n,t,l){return this.http.put(`${this.apiUrl}/${n}/password`,{oldPassword:t,newPassword:l})}userUpdated=new li;userUpdates$=this.userUpdated.asObservable();notifyUserUpdate(){this.userUpdated.next()}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};function XY(r,n){if(r&1&&(B(0,"p",5),Q(1),U()),r&2){let t=re();ne(),xt(t.distance())}}function YY(r,n){if(r&1&&(B(0,"p",6),Q(1),U()),r&2){let t=re();ne(),mr("\u{1F3AB} ",t.maxParticipants()-t.occupiedSpots()," spots left")}}function KY(r,n){if(r&1&&(B(0,"span",13),Q(1),U()),r&2){let t=re(4);ne(),xt(t.savedCount())}}function QY(r,n){if(r&1){let t=It();B(0,"div",12),Re("click",function(h){return Pe(t),re(3).toggleFavorite.emit(),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2),U(),ft(3,KY,2,1,"span",13),U()}if(r&2){let t=re(3);ne(),fn("saved",t.isSaved()),ne(),xt(t.isSaved()?"favorite":"favorite_border"),ne(),mt(t.showSavedCount()&&t.savedCount()!==null&&t.savedCount()!==void 0?3:-1)}}function JY(r,n){if(r&1){let t=It();B(0,"div",10),Re("click",function(h){return Pe(t),re(2).focusLocation.emit(),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2,"place"),U()(),ft(3,QY,4,4,"div",11)}if(r&2){let t=re(2);ne(3),mt(t.isParticipating()?-1:3)}}function eK(r,n){if(r&1){let t=It();B(0,"div",10),Re("click",function(h){return Pe(t),re(2).shareEvent.emit(),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2,"share"),U()()}}function tK(r,n){if(r&1&&(B(0,"div",7),ft(1,JY,4,1),ft(2,eK,3,0,"div",9),U()),r&2){let t=re();ne(),mt(t.showActions()?1:-1),ne(),mt(t.showShare()?2:-1)}}function nK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"person"),U())}function iK(r,n){r&1&&(B(0,"span",17),Q(1,"You are the eventer"),U())}function rK(r,n){if(r&1){let t=It();B(0,"button",19),Re("click",function(h){Pe(t);let i=re(3);return Oe(i.isFollowing?i.unfollowOrganizer(h):i.followOrganizer(h))}),Q(1),U()}if(r&2){let t=re(3);fn("following",t.isFollowing),ne(),mr(" ",t.isFollowing?"Following":"Follow"," ")}}function oK(r,n){if(r&1&&ft(0,iK,2,0,"span",17)(1,rK,2,3,"button",18),r&2){let t,l=re(2);mt(((t=l.currentUserId())==null?null:t.toString())===((t=l.creatorId())==null?null:t.toString())?0:1)}}function sK(r,n){if(r&1){let t=It();B(0,"div",8)(1,"div",14),Re("click",function(h){return Pe(t),re().openOrganizerProfile.emit(),Oe(h.stopPropagation())}),B(2,"div",15),ft(3,nK,2,0,"mat-icon"),U(),B(4,"span",16),Q(5),U()(),ft(6,oK,2,1),U()}if(r&2){let t=re();ne(2),Ds("background-image",t.organizerImage()?"url("+t.organizerImage()+")":""),ne(),mt(t.organizerImage()?-1:3),ne(2),xt(t.organizerName()),ne(),mt(t.currentUserId()&&t.creatorId()?6:-1)}}var jh=class r{constructor(n){this.userService=n}title=ro.required();location=ro.required();dateTime=ro.required();distance=ro();id=ro.required();isSaved=ro(!1);savedCount=ro(null);isParticipating=ro(!1);showDistance=ro(!0);showActions=ro(!0);showShare=ro(!1);showOrganizerInfo=ro(!1);showSavedCount=ro(!0);organizerName=ro();organizerImage=ro();creatorId=ro();occupiedSpots=ro();maxParticipants=ro();currentUserId=ro(null);isFollowing=!1;focusLocation=new Zt;toggleFavorite=new Zt;openOrganizerProfile=new Zt;shareEvent=new Zt;ngOnInit(){this.checkIfFollowing()}checkIfFollowing(){}followOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.followUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!0},error:t=>console.error("Error following",t)})}unfollowOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.unfollowUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!1},error:t=>console.error("Error unfollowing",t)})}static \u0275fac=function(t){return new(t||r)(Bt(_s))};static \u0275cmp=In({type:r,selectors:[["app-event-card"]],inputs:{title:[1,"title"],location:[1,"location"],dateTime:[1,"dateTime"],distance:[1,"distance"],id:[1,"id"],isSaved:[1,"isSaved"],savedCount:[1,"savedCount"],isParticipating:[1,"isParticipating"],showDistance:[1,"showDistance"],showActions:[1,"showActions"],showShare:[1,"showShare"],showOrganizerInfo:[1,"showOrganizerInfo"],showSavedCount:[1,"showSavedCount"],organizerName:[1,"organizerName"],organizerImage:[1,"organizerImage"],creatorId:[1,"creatorId"],occupiedSpots:[1,"occupiedSpots"],maxParticipants:[1,"maxParticipants"],currentUserId:[1,"currentUserId"]},outputs:{focusLocation:"focusLocation",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",shareEvent:"shareEvent"},decls:12,vars:7,consts:[[1,"card-container"],[1,"info-section"],[1,"title"],[1,"location"],[1,"date-time"],[1,"distance"],[1,"spots-info"],[1,"actions-section"],[1,"organizer-info"],[1,"icon-circle"],[1,"icon-circle",3,"click"],[1,"icon-circle","favorite-icon"],[1,"icon-circle","favorite-icon",3,"click"],[1,"favorite-count"],[1,"organizer-details","clickable",3,"click"],[1,"organizer-img"],[1,"organizer-name"],[1,"is-organizer-badge"],[1,"follow-btn",3,"following"],[1,"follow-btn",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1)(2,"h3",2),Q(3),U(),B(4,"p",3),Q(5),U(),B(6,"p",4),Q(7),U(),ft(8,XY,2,1,"p",5),ft(9,YY,2,1,"p",6),U(),ft(10,tK,3,2,"div",7),U(),ft(11,sK,7,5,"div",8)),t&2&&(ne(3),xt(l.title()),ne(2),xt(l.location()),ne(2),xt(l.dateTime()),ne(),mt(l.distance()?8:-1),ne(),mt(l.maxParticipants()&&l.occupiedSpots()!==void 0?9:-1),ne(),mt(l.showActions()||l.showShare()?10:-1),ne(),mt(l.organizerName()&&l.showOrganizerInfo()?11:-1))},dependencies:[Li,Xi,Zi],styles:[".card-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);color:var(--color-white)}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.title[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.location[_ngcontent-%COMP%]{margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.date-time[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#888}.distance[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#aaa}.actions-section[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm)}.icon-circle[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:background-color .2s}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:1px;right:1px;min-width:14px;height:14px;padding:0 4px;border-radius:999px;background:#101010e6;border:1px solid rgba(255,255,255,.2);color:var(--color-accent);font-size:8px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#555}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.9)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-light-gray);transition:color .2s ease}.icon-circle[_ngcontent-%COMP%]   mat-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent)}.organizer-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-top:10px;margin-top:10px;border-top:1px solid rgba(255,255,255,.1)}.organizer-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.organizer-details.clickable[_ngcontent-%COMP%]{cursor:pointer}.organizer-details.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-img[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#333;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;overflow:hidden}.organizer-img[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:#ccc}.organizer-name[_ngcontent-%COMP%]{font-size:12px;color:#aaa;font-weight:500}.follow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #1a73e8;color:#1a73e8;border-radius:12px;padding:2px 10px;font-size:11px;cursor:pointer;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{background:#1a73e81a}.follow-btn.following[_ngcontent-%COMP%]{background:#1a73e8;color:#fff;border-color:#1a73e8}.is-organizer-badge[_ngcontent-%COMP%]{font-size:10px;color:#4caf50;background:#4caf501a;padding:2px 6px;border-radius:4px;border:1px solid rgba(76,175,80,.3)}"]})};var js=class r{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";getEvents(n){let t=this.baseUrl;return n&&n!=="undefined"&&n!=="null"&&!isNaN(Number(n))&&(t+=`?userId=${n}`),this.http.get(t)}getOrganizedEvents(n){return this.http.get(`${this.baseUrl}/organized?userId=${n}`)}getJoinedEvents(n){return this.http.get(`${this.baseUrl}/joined?userId=${n}`)}toggleSavedEvent(n,t){return this.http.post(`http://localhost:8080/api/users/${n}/saved-events/${t}`,{})}getSavedEvents(n){return this.http.get(`http://localhost:8080/api/users/${n}/saved-events`)}getEventById(n,t){let l=`${this.baseUrl}/${n}`;return t&&(l+=`?userId=${t}`),this.http.get(l)}searchEvents(n){return this.http.get(`${this.baseUrl}/search?q=${n}`)}requestParticipation(n,t){return this.http.post(`${this.baseUrl}/${n}/participation-request?userId=${t}`,{})}leaveEvent(n,t){return this.http.post(`${this.baseUrl}/${n}/participants/${t}/leave`,{})}acceptParticipation(n,t){return this.http.post(`${this.baseUrl}/${n}/participants/${t}/accept`,{})}rejectParticipation(n,t){return this.http.post(`${this.baseUrl}/${n}/participants/${t}/reject`,{})}removeParticipant(n,t,l){return this.http.post(`${this.baseUrl}/${n}/participants/${t}/remove?organizerId=${l}`,{})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/${n}`)}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var Iu=class r{constructor(n){this.http=n}apiUrl="https://api.mapbox.com/geocoding/v5/mapbox.places";searchCity(n){let t=`${this.apiUrl}/${encodeURIComponent(n)}.json`,l={access_token:tl.mapboxToken,types:"place,locality",limit:"5",language:"it"};return this.http.get(t,{params:l}).pipe(Qn(h=>h.features&&h.features.length>0?h.features:[]))}reverseGeocode(n,t){let l=`${this.apiUrl}/${t},${n}.json`,h={access_token:tl.mapboxToken,types:"place,locality",limit:"1",language:"it"};return this.http.get(l,{params:h}).pipe(Qn(i=>{let E=i?.features||[],O=E.find(N=>(N.place_type||[]).includes("place"))||E[0];return O?.text||O?.place_name||null}))}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};function aK(r,n){if(r&1){let t=It();B(0,"mat-icon",13),Re("click",function(){Pe(t);let h=re(2);return Oe(h.clearSearch())}),Q(1,"close"),U()}}function lK(r,n){if(r&1){let t=It();B(0,"mat-icon",13),Re("click",function(){Pe(t);let h=re(2);return Oe(h.onSearch())}),Q(1,"search"),U()}}function cK(r,n){if(r&1){let t=It();B(0,"div",8)(1,"input",9),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.searchQuery,h)||(i.searchQuery=h),Oe(h)}),Re("keyup.enter",function(){Pe(t);let h=re();return Oe(h.onSearch())})("ngModelChange",function(h){Pe(t);let i=re();return Oe(i.onSearchChange(h))}),U(),B(2,"div",10),ft(3,aK,2,0,"mat-icon",11)(4,lK,2,0,"mat-icon",11),B(5,"mat-icon",12),Re("click",function(){Pe(t);let h=re();return h.showFilterOptions=!h.showFilterOptions,h.filterMenuOpen=!1,Oe(h.sortMenuOpen=!1)}),Q(6,"tune"),U()()()}if(r&2){let t=re();ne(),Oo("ngModel",t.searchQuery),ne(2),mt(t.isSearching?3:4)}}function uK(r,n){if(r&1){let t=It();B(0,"div",5)(1,"button",14),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("events"))}),Q(2," EVENTS "),U(),B(3,"button",14),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("places"))}),Q(4," PLACES "),U(),B(5,"button",14),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("creators"))}),Q(6," CREATORS "),U()()}if(r&2){let t=re();ne(),fn("active",t.activeTab==="events"),ne(2),fn("active",t.activeTab==="places"),ne(2),fn("active",t.activeTab==="creators")}}function dK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"check"),U())}function hK(r,n){if(r&1){let t=It();B(0,"button",29),Re("click",function(h){let i=Pe(t).$implicit;return re(3).selectFilter(i),Oe(h.stopPropagation())}),B(1,"span"),Q(2),U(),ft(3,dK,2,0,"mat-icon"),U()}if(r&2){let t=n.$implicit,l=re(3);ne(2),xt(l.filterLabels[t]),ne(),mt(l.filterOption===t?3:-1)}}function pK(r,n){if(r&1&&(B(0,"div",20),$i(1,hK,4,2,"button",28,es),U()),r&2){let t=re(2);ne(),Hi(t.filterOrder)}}function fK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"check"),U())}function mK(r,n){if(r&1){let t=It();B(0,"button",29),Re("click",function(h){let i=Pe(t).$implicit;return re(3).selectSort(i),Oe(h.stopPropagation())}),B(1,"span"),Q(2),U(),ft(3,fK,2,0,"mat-icon"),U()}if(r&2){let t=n.$implicit,l=re(3);ne(2),xt(l.sortLabels[t]),ne(),mt(l.sortOption===t?3:-1)}}function gK(r,n){if(r&1&&(B(0,"div",20),$i(1,mK,4,2,"button",28,es),U()),r&2){let t=re(2);ne(),Hi(t.sortOrder)}}function _K(r,n){if(r&1){let t=It();B(0,"div",15)(1,"div",16)(2,"div",17),Re("click",function(){Pe(t);let h=re();return h.filterMenuOpen=!h.filterMenuOpen,Oe(h.sortMenuOpen=!1)}),B(3,"div",18)(4,"mat-icon"),Q(5,"filter_list"),U(),B(6,"span"),Q(7),U(),B(8,"mat-icon",19),Q(9),U()(),ft(10,pK,3,0,"div",20),U(),B(11,"div",17),Re("click",function(){Pe(t);let h=re();return h.sortMenuOpen=!h.sortMenuOpen,Oe(h.filterMenuOpen=!1)}),B(12,"div",18)(13,"mat-icon"),Q(14,"swap_vert"),U(),B(15,"span"),Q(16),U(),B(17,"mat-icon",19),Q(18),U()(),ft(19,gK,3,0,"div",20),U()(),B(20,"div",21)(21,"div",22)(22,"span"),Q(23,"Price"),U(),B(24,"span",23),Q(25),U()(),B(26,"div",24)(27,"div",25),Mn(28,"div",26),B(29,"input",27),Re("input",function(h){Pe(t);let i=re();return Oe(i.onPriceMinChange(h.target.value))}),U(),B(30,"input",27),Re("input",function(h){Pe(t);let i=re();return Oe(i.onPriceMaxChange(h.target.value))}),U()()()(),B(31,"div",21)(32,"div",22)(33,"span"),Q(34,"Distance"),U(),B(35,"span",23),Q(36),U()(),B(37,"div",24)(38,"div",25),Mn(39,"div",26),B(40,"input",27),Re("input",function(h){Pe(t);let i=re();return Oe(i.onDistanceMinChange(h.target.value))}),U(),B(41,"input",27),Re("input",function(h){Pe(t);let i=re();return Oe(i.onDistanceMaxChange(h.target.value))}),U()()()()()}if(r&2){let t=re();ne(7),xt(t.filterLabels[t.filterOption]),ne(2),xt(t.filterMenuOpen?"expand_less":"expand_more"),ne(),mt(t.filterMenuOpen?10:-1),ne(6),xt(t.sortLabels[t.sortOption]),ne(2),xt(t.sortMenuOpen?"expand_less":"expand_more"),ne(),mt(t.sortMenuOpen?19:-1),ne(6),ca("\u20AC",t.priceMin.toFixed(0)," - \u20AC",t.priceMax.toFixed(0)),ne(3),bt("ngStyle",t.getPriceTrackStyle()),ne(),bt("min",0)("max",t.priceMaxLimit)("step",t.priceStep)("ngModel",t.priceMin),ne(),bt("min",0)("max",t.priceMaxLimit)("step",t.priceStep)("ngModel",t.priceMax),ne(6),ca("",t.distanceMin.toFixed(1)," - ",t.distanceMax.toFixed(1)," km"),ne(3),bt("ngStyle",t.getDistanceTrackStyle()),ne(),bt("min",0)("max",t.distanceMaxLimit)("step",t.distanceStep)("ngModel",t.distanceMin),ne(),bt("min",0)("max",t.distanceMaxLimit)("step",t.distanceStep)("ngModel",t.distanceMax)}}function vK(r,n){if(r&1){let t=It();B(0,"app-event-card",35),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))})("openOrganizerProfile",function(){let h=Pe(t).$implicit,i=re(4);return Oe(h.creatorId?i.openUserProfile.emit(h.creatorId.toString()):null)}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function yK(r,n){r&1&&(B(0,"div",34),Q(1,"No events found."),U())}function xK(r,n){if(r&1&&(B(0,"div",31)(1,"div",32),$i(2,vK,1,13,"app-event-card",33,es),U(),ft(4,yK,2,0,"div",34),U()),r&2){let t=re(3);ne(2),Hi(t.getFiltered(t.searchResults)),ne(2),mt(t.searchResults.length===0?4:-1)}}function bK(r,n){if(r&1){let t=It();B(0,"div",37),Re("click",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.selectCity(h))}),B(1,"div",38)(2,"mat-icon"),Q(3,"location_on"),U()(),B(4,"div",39)(5,"span",40),Q(6),U()()()}if(r&2){let t=n.$implicit;ne(6),xt(t.name)}}function wK(r,n){r&1&&(B(0,"div",34),Q(1,"No places found."),U())}function CK(r,n){if(r&1&&(B(0,"div",31)(1,"div",32),$i(2,bK,7,1,"div",36,es),U(),ft(4,wK,2,0,"div",34),U()),r&2){let t=re(3);ne(2),Hi(t.cityResults),ne(2),mt(t.cityResults.length===0?4:-1)}}function EK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"person"),U())}function SK(r,n){if(r&1){let t=It();B(0,"div",42),Re("click",function(h){Pe(t);let i=re().$implicit,E=re(4);return E.followingMap[i.id]?E.unfollowUser(i,h):E.followUser(i,h),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2),U()()}if(r&2){let t=re().$implicit,l=re(4);fn("following",l.followingMap[t.id]),ne(2),xt(l.followingMap[t.id]?"person":"person_add")}}function TK(r,n){if(r&1){let t=It();B(0,"div",37),Re("click",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.openUserProfile.emit(h.id.toString()))}),B(1,"div",38),ft(2,EK,2,0,"mat-icon"),U(),B(3,"div",39)(4,"span",40),Q(5),U()(),ft(6,SK,3,3,"div",41),U()}if(r&2){let t=n.$implicit,l=re(4);ne(),Ds("background-image",t.profileImage?"url("+t.profileImage+")":"")("background-size","cover"),ne(),mt(t.profileImage?-1:2),ne(3),xt(t.name),ne(),mt(l.userId&&l.userId.toString()!==t.id.toString()?6:-1)}}function IK(r,n){r&1&&(B(0,"div",34),Q(1,"No creators found."),U())}function MK(r,n){if(r&1&&(B(0,"div",31)(1,"div",32),$i(2,TK,7,7,"div",36,es),U(),ft(4,IK,2,0,"div",34),U()),r&2){let t=re(3);ne(2),Hi(t.userResults),ne(2),mt(t.userResults.length===0?4:-1)}}function DK(r,n){if(r&1&&(ft(0,xK,5,1,"div",31),ft(1,CK,5,1,"div",31),ft(2,MK,5,1,"div",31)),r&2){let t=re(2);mt(t.activeTab==="events"?0:-1),ne(),mt(t.activeTab==="places"?1:-1),ne(),mt(t.activeTab==="creators"?2:-1)}}function AK(r,n){if(r&1){let t=It();B(0,"app-event-card",35),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))})("openOrganizerProfile",function(){let h=Pe(t).$implicit,i=re(4);return Oe(h.creatorId?i.openUserProfile.emit(h.creatorId.toString()):null)}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function PK(r,n){r&1&&(B(0,"div",34),Q(1,"No events found in your area."),U())}function OK(r,n){if(r&1&&(B(0,"div",31)(1,"h2",43),Q(2,"FOUND EVENTS"),U(),B(3,"div",32),$i(4,AK,1,13,"app-event-card",33,es),ft(6,PK,2,0,"div",34),U()()),r&2){let t=re(3);ne(4),Hi(t.getFiltered(t.foundEvents)),ne(2),mt(t.foundEvents.length===0?6:-1)}}function RK(r,n){if(r&1){let t=It();B(0,"app-event-card",35),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))})("openOrganizerProfile",function(){let h=Pe(t).$implicit,i=re(4);return Oe(h.creatorId?i.openUserProfile.emit(h.creatorId.toString()):null)}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function kK(r,n){r&1&&(B(0,"div",34),Q(1,"No upcoming events you are participating in."),U())}function FK(r,n){if(r&1){let t=It();B(0,"app-event-card",35),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))})("openOrganizerProfile",function(){let h=Pe(t).$implicit,i=re(4);return Oe(h.creatorId?i.openUserProfile.emit(h.creatorId.toString()):null)}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function LK(r,n){r&1&&(B(0,"div",34),Q(1,"You haven't saved any events yet."),U())}function NK(r,n){if(r&1){let t=It();B(0,"app-event-card",45),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))})("openOrganizerProfile",function(){let h=Pe(t).$implicit,i=re(4);return Oe(h.creatorId?i.openUserProfile.emit(h.creatorId.toString()):null)}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function zK(r,n){r&1&&(B(0,"div",34),Q(1,"No new events to discover at the moment."),U())}function BK(r,n){if(r&1&&(B(0,"div",31)(1,"h2",43),Q(2,"FOLLOW UP EVENTS"),U(),B(3,"div",32),$i(4,RK,1,13,"app-event-card",33,es),ft(6,kK,2,0,"div",34),U()(),B(7,"div",31)(8,"h2",43),Q(9,"SAVED EVENTS"),U(),B(10,"div",32),$i(11,FK,1,13,"app-event-card",33,es),ft(13,LK,2,0,"div",34),U()(),B(14,"div",31)(15,"h2",43),Q(16,"DISCOVER EVENTS"),U(),B(17,"div",32),$i(18,NK,1,12,"app-event-card",44,es),ft(20,zK,2,0,"div",34),U()()),r&2){let t=re(3);ne(4),Hi(t.getFiltered(t.followUpEvents)),ne(2),mt(t.followUpEvents.length===0?6:-1),ne(5),Hi(t.getFiltered(t.savedEvents)),ne(2),mt(t.savedEvents.length===0?13:-1),ne(5),Hi(t.getFiltered(t.discoverEvents)),ne(2),mt(t.discoverEvents.length===0?20:-1)}}function VK(r,n){if(r&1&&ft(0,OK,7,1,"div",31)(1,BK,21,3),r&2){let t=re(2);mt(t.userId?1:0)}}function UK(r,n){if(r&1&&(B(0,"div",30),ft(1,DK,3,3)(2,VK,2,1),U()),r&2){let t=re();ne(),mt(t.isSearching?1:2)}}var kx=class r{constructor(n,t,l){this.eventService=n;this.mapboxService=t;this.userService=l}events=[];focusEvent=new Zt;collapsed=!1;userId=null;toggleSidebar=new Zt;toggleFavorite=new Zt;foundLocation=new Zt;openUserProfile=new Zt;shareEvent=new Zt;searchQuery="";searchResults=[];cityResults=[];userResults=[];activeTab="events";isSearching=!1;followingMap={};showFilterOptions=!1;searchInput$=new li;searchSub;ngOnInit(){this.searchSub=this.searchInput$.pipe(Bg(300),Qp()).subscribe(n=>{let t=n?.trim()||"";if(!t){this.clearSearch();return}this.onSearchInternal(t)})}ngOnDestroy(){this.searchSub?.unsubscribe()}followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};get isFiltering(){return this.filterOption!=="all"}isFutureEvent=n=>{if(!n.date)return!0;let t=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${t}`).getTime()>=Date.now()};ngOnChanges(n){(n.events||n.userId)&&this.categorizeEvents()}categorizeEvents(){if(console.log("Sidebar received events:",this.events),this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.foundEvents=[],this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent);return}new Date().setHours(0,0,0,0),this.eventService.getJoinedEvents(this.userId).subscribe({next:t=>{this.followUpEvents=t.filter(this.isFutureEvent),this.followUpEvents.sort((l,h)=>{let i=new Date(`${l.date}T${l.startTime||"00:00"}`),E=new Date(`${h.date}T${h.startTime||"00:00"}`);return i.getTime()-E.getTime()})},error:t=>console.error("Error fetching follow up events",t)}),this.events.filter(this.isFutureEvent).forEach(t=>{let l=!1,h=t.isParticipating||!1;t.isSaved&&!h&&(l=!0),l&&this.savedEvents.push(t),!h&&!l&&this.discoverEvents.push(t)}),console.log("Categorized:",{followUp:this.followUpEvents,saved:this.savedEvents,discover:this.discoverEvents})}updateRangeLimits(){let n=this.events.map(K=>K.costPerPerson??0),t=n.length?Math.max(...n):0,l=Math.max(10,Math.ceil(t)),h=this.events.map(K=>K.distanceKm).filter(K=>typeof K=="number"&&!Number.isNaN(K)),i=h.length?Math.max(...h):0,E=Math.max(5,Math.ceil(i)),O=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=l,(O||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let N=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=E,(N||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(n){let t=[...n];switch(this.filterOption){case"participating":t=t.filter(i=>!!i.isParticipating);break;case"free":t=t.filter(i=>i.costPerPerson==null||i.costPerPerson===0);break;case"available":t=t.filter(i=>i.nPartecipants==null||i.occupiedSpots==null?!0:i.nPartecipants-i.occupiedSpots>0);break;default:break}switch(this.sortOption){case"distance":t.sort((i,E)=>{let O=i.distanceKm??Number.MAX_SAFE_INTEGER,N=E.distanceKm??Number.MAX_SAFE_INTEGER;return O-N});break;case"name":t.sort((i,E)=>(i.title||"").localeCompare(E.title||"","it"));break;case"date":default:t.sort((i,E)=>{let O=new Date(`${i.date}T${i.startTime||"00:00"}`).getTime(),N=new Date(`${E.date}T${E.startTime||"00:00"}`).getTime();return O-N});break}return(this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(t=t.filter(i=>{let E=i.costPerPerson??0;return E>=this.priceMin&&E<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(t=t.filter(i=>{let E=i.distanceKm;return E==null?!1:E>=this.distanceMin&&E<=this.distanceMax})),t}getFiltered(n){return this.applyFilters(n)}cycleFilter(){let n=this.filterOrder.indexOf(this.filterOption);this.filterOption=this.filterOrder[(n+1)%this.filterOrder.length]}cycleSort(){let n=this.sortOrder.indexOf(this.sortOption);this.sortOption=this.sortOrder[(n+1)%this.sortOrder.length]}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1}onPriceMinChange(n){let t=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(t)?this.priceMin:t}onPriceMaxChange(n){let t=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(t)?this.priceMax:t}onDistanceMinChange(n){let t=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(t)?this.distanceMin:t}onDistanceMaxChange(n){let t=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(t)?this.distanceMax:t}getPriceTrackStyle(){let n=this.priceMin/this.priceMaxLimit*100,t=this.priceMax/this.priceMaxLimit*100;return{left:n+"%",width:t-n+"%"}}getDistanceTrackStyle(){let n=this.distanceMin/this.distanceMaxLimit*100,t=this.distanceMax/this.distanceMaxLimit*100;return{left:n+"%",width:t-n+"%"}}formatDateTime(n){let t=n.date?new Date(`${n.date}T00:00:00`):null,l=n.startTime?n.startTime.slice(0,5):"",h=n.endTime?n.endTime.slice(0,5):"",i=t?t.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=l&&h?`${l} - ${h}`:l||h;return[i,E].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}goToEvent(n){this.focusEvent.emit(n)}toggle(){this.toggleSidebar.emit()}onSearchChange(n){this.searchQuery=n,this.searchInput$.next(n)}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.onSearchInternal(this.searchQuery.trim())}onSearchInternal(n){this.isSearching=!0,this.eventService.searchEvents(n).subscribe(t=>{this.searchResults=t.filter(this.isFutureEvent)}),this.mapboxService.searchCity(n).subscribe(t=>{this.cityResults=t.map(l=>({name:l.place_name,center:l.center}))}),this.userService.searchUsers(n).subscribe(t=>{this.userResults=t,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(t=>{console.log(`Checking follow status for ${n.id} (me: ${this.userId}):`,t),this.followingMap[n.id]=t.isFollowing})})}followUser(n,t){t.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,t){t.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}setActiveTab(n){this.activeTab=n}selectCity(n){if(n){let[t,l]=n.center;this.foundLocation.emit({lat:l,lng:t})}}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[],this.activeTab="events"}isMobileOrTablet(){return window.innerWidth<=1024}static \u0275fac=function(t){return new(t||r)(Bt(js),Bt(Iu),Bt(_s))};static \u0275cmp=In({type:r,selectors:[["app-sidebar"]],inputs:{events:"events",collapsed:"collapsed",userId:"userId"},outputs:{focusEvent:"focusEvent",toggleSidebar:"toggleSidebar",toggleFavorite:"toggleFavorite",foundLocation:"foundLocation",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Vr],decls:11,vars:7,consts:[[1,"sidebar-container"],[1,"header"],[1,"logo"],[1,"collapse-toggle",3,"click"],["class","search-container",4,"ngIf"],[1,"tabs-header"],["class","filter-sort",4,"ngIf"],["class","sections-container",4,"ngIf"],[1,"search-container"],["type","text","placeholder","Search city, events or user",1,"search-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-actions"],[1,"search-icon","clickable"],[1,"options-icon","clickable",3,"click"],[1,"search-icon","clickable",3,"click"],[1,"tab-btn",3,"click"],[1,"filter-sort"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs"],[1,"slider-wrapper"],[1,"slider-track",3,"ngStyle"],["type","range",3,"input","min","max","step","ngModel"],[1,"menu-item"],[1,"menu-item",3,"click"],[1,"sections-container"],[1,"events-section"],[1,"events-list"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle","small"],[1,"loc-info"],[1,"loc-name"],[1,"icon-circle","follow-icon",3,"following"],[1,"icon-circle","follow-icon",3,"click"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1)(2,"h1",2),Q(3,"LUMO"),U(),B(4,"button",3),Re("click",function(){return l.toggle()}),B(5,"mat-icon"),Q(6),U()()(),Ui(7,cK,7,2,"div",4),ft(8,uK,7,6,"div",5),Ui(9,_K,42,28,"div",6)(10,UK,3,1,"div",7),U()),t&2&&(fn("collapsed",l.collapsed),ne(6),xt(l.collapsed?"chevron_right":"chevron_left"),ne(),bt("ngIf",!l.collapsed),ne(),mt(!l.collapsed&&l.isSearching?8:-1),ne(),bt("ngIf",!l.collapsed&&l.showFilterOptions),ne(),bt("ngIf",!l.collapsed))},dependencies:[Li,Ps,Hy,Nl,Us,Rx,Da,nl,Xi,Zi,jh],styles:[".sidebar-container[_ngcontent-%COMP%]{width:360px;max-width:90vw;height:calc(100vh - 40px);background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);display:flex;flex-direction:column;gap:16px;padding:24px;border-radius:24px;box-shadow:4px 0 12px #0000004d;border:1px solid var(--color-light-gray);color:var(--color-white);position:absolute;top:20px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:auto;height:72px;overflow:hidden;padding:24px;justify-content:center;border-radius:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:14px;font-weight:700;margin:0 0 16px;text-transform:uppercase;letter-spacing:.5px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{gap:10px;justify-content:space-between;width:100%;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block;font-size:24px}.logo[_ngcontent-%COMP%]{color:var(--color-accent);font-size:24px;font-weight:900;margin:0;padding:0;letter-spacing:1px;text-shadow:none}.search-container[_ngcontent-%COMP%]{position:relative}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px 64px 12px 16px;background-color:var(--color-gray);border:1px solid rgba(255,255,255,.12);border-radius:12px;color:#aaa;font-size:14px;outline:none;box-sizing:border-box}.search-input[_ngcontent-%COMP%]::placeholder{color:#666}.search-actions[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);display:flex;align-items:center;gap:8px;color:#666}.search-icon[_ngcontent-%COMP%], .options-icon[_ngcontent-%COMP%]{font-size:20px;display:flex;align-items:center;justify-content:center}.options-icon[_ngcontent-%COMP%]{font-size:20px}.filter-sort[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin:0;position:relative;z-index:var(--z-dropdown);overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{padding:8px 4px}.slider-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:6px;background:#ffffff1a;border-radius:3px;display:flex;align-items:center}.slider-track[_ngcontent-%COMP%]{position:absolute;height:6px;background:linear-gradient(90deg,#fbbc04,#ffeb3b);border-radius:3px;z-index:1}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;width:100%;background:none;pointer-events:none;-webkit-appearance:none;appearance:none;z-index:2;margin:0}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{height:18px;width:18px;border-radius:50%;background:#fbbc04;cursor:pointer;pointer-events:auto;-webkit-appearance:none;border:2px solid var(--color-dark-gray);box-shadow:0 2px 6px #0006;transition:transform .1s ease}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb:hover{transform:scale(1.1)}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb:active{transform:scale(.95)}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{height:18px;width:18px;border-radius:50%;background:#fbbc04;cursor:pointer;pointer-events:auto;border:2px solid var(--color-dark-gray);box-shadow:0 2px 6px #0006}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;gap:5px;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:10px;transition:background-color .2s ease,border-color .2s ease,transform .1s ease;min-width:110px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:5px 8px;gap:4px}.pill[_ngcontent-%COMP%]:hover{background:var(--color-bit-gray);border-color:var(--color-light-gray)}.pill[_ngcontent-%COMP%]:active{transform:translateY(1px)}.dropdown[_ngcontent-%COMP%]{position:relative}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:180px;z-index:calc(var(--z-dropdown) + 1);padding:4px;pointer-events:auto}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:none;background:transparent;color:var(--color-white);cursor:pointer;border-radius:8px;transition:background-color .15s ease;text-align:left}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff14}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:4px;overflow-x:auto;flex-shrink:0}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-weight:500;font-size:13px;cursor:pointer;border-radius:20px;transition:all .2s;white-space:nowrap}.tab-btn[_ngcontent-%COMP%]:hover{background:#fff3}.tab-btn.active[_ngcontent-%COMP%]{background:#fbbc04;color:var(--color-white);font-weight:600}.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:color .2s}.clickable[_ngcontent-%COMP%]:hover{color:var(--color-white)}.sections-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow-y:auto;min-height:0;gap:16px}.sections-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.events-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.collapse-toggle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;border:none;background:var(--color-gray);color:var(--color-white);display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,transform .1s ease;z-index:calc(var(--z-sidebar) + 10)}.collapse-toggle[_ngcontent-%COMP%]:hover{background:#3a3a3a}.collapse-toggle[_ngcontent-%COMP%]:active{transform:scale(.96)}@media (max-width: 767px){.sidebar-container[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px) and (max-width: 1024px){.sidebar-container[_ngcontent-%COMP%]{padding:24px;top:20px;left:20px;z-index:var(--z-sidebar)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:fit-content;height:72px;padding:24px;border-radius:24px;justify-content:center;align-items:center}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block}}.empty-state[_ngcontent-%COMP%]{font-size:13px;font-weight:300;color:var(--color-gray-light);font-style:italic;opacity:.7;margin-bottom:8px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px;transition:background-color .2s;border:1px solid transparent}.location-item[_ngcontent-%COMP%]:hover{background:#333;border-color:#555;cursor:pointer}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--color-white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.follow-icon[_ngcontent-%COMP%]{background:var(--color-bit-gray);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;margin-left:auto}.follow-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-white)}.follow-icon[_ngcontent-%COMP%]:hover{background:#555}.follow-icon.following[_ngcontent-%COMP%]{background:var(--color-accent)}.follow-icon.following[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-black)}"]})};var KU=(r,n)=>n.id;function jK(r,n){if(r&1){let t=It();B(0,"mat-icon",7),Re("click",function(h){Pe(t);let i=re();return i.showFilterOptions=!i.showFilterOptions,i.filterMenuOpen=!1,i.sortMenuOpen=!1,Oe(h.stopPropagation())}),Q(1,"tune"),U()}}function $K(r,n){if(r&1){let t=It();B(0,"mat-icon",8),Re("click",function(h){return Pe(t),re().toggleExpand(),Oe(h.stopPropagation())}),Q(1,"close"),U()}}function HK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"check"),U())}function GK(r,n){if(r&1){let t=It();B(0,"button",29),Re("click",function(h){let i=Pe(t).$implicit;return re(4).selectFilter(i),Oe(h.stopPropagation())}),B(1,"span"),Q(2),U(),ft(3,HK,2,0,"mat-icon"),U()}if(r&2){let t=n.$implicit,l=re(4);ne(2),xt(l.filterLabels[t]),ne(),mt(l.filterOption===t?3:-1)}}function qK(r,n){if(r&1&&(B(0,"div",20),$i(1,GK,4,2,"button",28,es),U()),r&2){let t=re(3);ne(),Hi(t.filterOrder)}}function WK(r,n){r&1&&(B(0,"mat-icon"),Q(1,"check"),U())}function ZK(r,n){if(r&1){let t=It();B(0,"button",29),Re("click",function(h){let i=Pe(t).$implicit;return re(4).selectSort(i),Oe(h.stopPropagation())}),B(1,"span"),Q(2),U(),ft(3,WK,2,0,"mat-icon"),U()}if(r&2){let t=n.$implicit,l=re(4);ne(2),xt(l.sortLabels[t]),ne(),mt(l.sortOption===t?3:-1)}}function XK(r,n){if(r&1&&(B(0,"div",20),$i(1,ZK,4,2,"button",28,es),U()),r&2){let t=re(3);ne(),Hi(t.sortOrder)}}function YK(r,n){if(r&1){let t=It();B(0,"div",13)(1,"div",16)(2,"div",17),Re("click",function(){Pe(t);let h=re(2);return h.filterMenuOpen=!h.filterMenuOpen,Oe(h.sortMenuOpen=!1)}),B(3,"div",18)(4,"mat-icon"),Q(5,"filter_list"),U(),B(6,"span"),Q(7),U(),B(8,"mat-icon",19),Q(9),U()(),ft(10,qK,3,0,"div",20),U(),B(11,"div",17),Re("click",function(){Pe(t);let h=re(2);return h.sortMenuOpen=!h.sortMenuOpen,Oe(h.filterMenuOpen=!1)}),B(12,"div",18)(13,"mat-icon"),Q(14,"swap_vert"),U(),B(15,"span"),Q(16),U(),B(17,"mat-icon",19),Q(18),U()(),ft(19,XK,3,0,"div",20),U()(),B(20,"div",21)(21,"div",22)(22,"span"),Q(23,"Price"),U(),B(24,"span",23),Q(25),U()(),B(26,"div",24)(27,"div",25),Mn(28,"div",26),B(29,"input",27),Re("input",function(h){Pe(t);let i=re(2);return Oe(i.onPriceMinChange(h.target.value))}),U(),B(30,"input",27),Re("input",function(h){Pe(t);let i=re(2);return Oe(i.onPriceMaxChange(h.target.value))}),U()()()(),B(31,"div",21)(32,"div",22)(33,"span"),Q(34,"Distance"),U(),B(35,"span",23),Q(36),U()(),B(37,"div",24)(38,"div",25),Mn(39,"div",26),B(40,"input",27),Re("input",function(h){Pe(t);let i=re(2);return Oe(i.onDistanceMinChange(h.target.value))}),U(),B(41,"input",27),Re("input",function(h){Pe(t);let i=re(2);return Oe(i.onDistanceMaxChange(h.target.value))}),U()()()()()}if(r&2){let t=re(2);ne(7),xt(t.filterLabels[t.filterOption]),ne(2),xt(t.filterMenuOpen?"expand_less":"expand_more"),ne(),mt(t.filterMenuOpen?10:-1),ne(6),xt(t.sortLabels[t.sortOption]),ne(2),xt(t.sortMenuOpen?"expand_less":"expand_more"),ne(),mt(t.sortMenuOpen?19:-1),ne(6),ca("\u20AC",t.priceMin.toFixed(0)," - \u20AC",t.priceMax.toFixed(0)),ne(3),bt("ngStyle",t.getPriceTrackStyle()),ne(),bt("min",0)("max",t.priceMaxLimit)("step",t.priceStep)("ngModel",t.priceMin),ne(),bt("min",0)("max",t.priceMaxLimit)("step",t.priceStep)("ngModel",t.priceMax),ne(6),ca("",t.distanceMin.toFixed(1)," - ",t.distanceMax.toFixed(1)," km"),ne(3),bt("ngStyle",t.getDistanceTrackStyle()),ne(),bt("min",0)("max",t.distanceMaxLimit)("step",t.distanceStep)("ngModel",t.distanceMin),ne(),bt("min",0)("max",t.distanceMaxLimit)("step",t.distanceStep)("ngModel",t.distanceMax)}}function KK(r,n){if(r&1){let t=It();B(0,"app-event-card",32),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.shareEvent.emit(h))}),U()}if(r&2){let t=n.$implicit,l=re(4);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function QK(r,n){r&1&&(B(0,"div",31),Q(1,"No events found."),U())}function JK(r,n){if(r&1&&(B(0,"div",15),$i(1,KK,1,13,"app-event-card",30,KU),ft(3,QK,2,0,"div",31),U()),r&2){let t=re(3);ne(),Hi(t.getFiltered(t.searchResults)),ne(2),mt(t.searchResults.length===0?3:-1)}}function eQ(r,n){if(r&1){let t=It();B(0,"app-event-card",32),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.shareEvent.emit(h))}),U()}if(r&2){let t=n.$implicit,l=re(5);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function tQ(r,n){r&1&&(B(0,"div",31),Q(1,"No events found in your area."),U())}function nQ(r,n){if(r&1&&(B(0,"div",33)(1,"div",34),Q(2,"FOUND EVENTS"),U(),B(3,"div",15),$i(4,eQ,1,13,"app-event-card",30,es),ft(6,tQ,2,0,"div",31),U()()),r&2){let t=re(4);ne(4),Hi(t.getFiltered(t.foundEvents)),ne(2),mt(t.foundEvents.length===0?6:-1)}}function iQ(r,n){if(r&1){let t=It();B(0,"app-event-card",32),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.shareEvent.emit(h))}),U()}if(r&2){let t=n.$implicit,l=re(5);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function rQ(r,n){r&1&&(B(0,"div",31),Q(1,"No upcoming events you are participating in."),U())}function oQ(r,n){if(r&1){let t=It();B(0,"app-event-card",32),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.shareEvent.emit(h))}),U()}if(r&2){let t=n.$implicit,l=re(5);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("isParticipating",!!t.isParticipating)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function sQ(r,n){r&1&&(B(0,"div",31),Q(1,"You haven't saved any events yet."),U())}function aQ(r,n){if(r&1){let t=It();B(0,"app-event-card",36),Re("focusLocation",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.goToEvent(h))})("toggleFavorite",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.toggleFavorite.emit(h))})("shareEvent",function(){let h=Pe(t).$implicit,i=re(5);return Oe(i.shareEvent.emit(h))}),U()}if(r&2){let t=n.$implicit,l=re(5);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("distance",l.formatDistance(t.distanceKm))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("showSavedCount",!1)("organizerName",t.organizerName)("organizerImage",t.organizerImage)("creatorId",t.creatorId)("currentUserId",l.userId)}}function lQ(r,n){r&1&&(B(0,"div",31),Q(1,"No new events to discover at the moment."),U())}function cQ(r,n){if(r&1&&(B(0,"div",33)(1,"div",34),Q(2,"FOLLOW UP EVENTS"),U(),B(3,"div",15),$i(4,iQ,1,13,"app-event-card",30,es),ft(6,rQ,2,0,"div",31),U()(),B(7,"div",33)(8,"div",34),Q(9,"SAVED EVENTS"),U(),B(10,"div",15),$i(11,oQ,1,13,"app-event-card",30,es),ft(13,sQ,2,0,"div",31),U()(),B(14,"div",33)(15,"div",34),Q(16,"DISCOVER EVENTS"),U(),B(17,"div",15),$i(18,aQ,1,12,"app-event-card",35,es),ft(20,lQ,2,0,"div",31),U()()),r&2){let t=re(4);ne(4),Hi(t.getFiltered(t.followUpEvents)),ne(2),mt(t.followUpEvents.length===0?6:-1),ne(5),Hi(t.getFiltered(t.savedEvents)),ne(2),mt(t.savedEvents.length===0?13:-1),ne(5),Hi(t.getFiltered(t.discoverEvents)),ne(2),mt(t.discoverEvents.length===0?20:-1)}}function uQ(r,n){if(r&1&&ft(0,nQ,7,1,"div",33)(1,cQ,21,3),r&2){let t=re(3);mt(t.userId?1:0)}}function dQ(r,n){if(r&1&&ft(0,JK,4,1,"div",15)(1,uQ,2,1),r&2){let t=re(2);mt(t.isSearching&&t.hasSearchQuery?0:1)}}function hQ(r,n){if(r&1){let t=It();B(0,"div",38),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.selectCity(h))}),B(1,"div",39)(2,"mat-icon"),Q(3,"location_on"),U()(),B(4,"div",40)(5,"span",41),Q(6),U()()()}if(r&2){let t=n.$implicit;ne(6),xt(t.name)}}function pQ(r,n){r&1&&(B(0,"div",31),Q(1,"No places found."),U())}function fQ(r,n){if(r&1&&(B(0,"div",15),$i(1,hQ,7,1,"div",37,es),ft(3,pQ,2,0,"div",31),U()),r&2){let t=re(2);ne(),Hi(t.cityResults),ne(2),mt(t.isSearching&&t.cityResults.length===0?3:-1)}}function mQ(r,n){r&1&&(B(0,"mat-icon"),Q(1,"person"),U())}function gQ(r,n){if(r&1){let t=It();B(0,"div",38),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.openProfile(h))}),B(1,"div",39),Ui(2,mQ,2,0,"mat-icon",42),U(),B(3,"div",40)(4,"span",41),Q(5),U()()()}if(r&2){let t=n.$implicit;ne(),Ds("background-image",t.profileImage?"url("+t.profileImage+")":"")("background-size","cover"),ne(),bt("ngIf",!t.profileImage),ne(3),xt(t.name)}}function _Q(r,n){r&1&&(B(0,"div",31),Q(1,"No creators found."),U())}function vQ(r,n){if(r&1&&(B(0,"div",15),$i(1,gQ,6,6,"div",37,KU),ft(3,_Q,2,0,"div",31),U()),r&2){let t=re(2);ne(),Hi(t.userResults),ne(2),mt(t.isSearching&&t.userResults.length===0?3:-1)}}function yQ(r,n){if(r&1){let t=It();B(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("events"))}),Q(4,"EVENTS"),U(),B(5,"button",12),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("places"))}),Q(6,"PLACES"),U(),B(7,"button",12),Re("click",function(){Pe(t);let h=re();return Oe(h.setActiveTab("creators"))}),Q(8,"CREATORS"),U()(),ft(9,YK,42,28,"div",13),B(10,"div",14),ft(11,dQ,2,1),ft(12,fQ,4,1,"div",15),ft(13,vQ,4,1,"div",15),U()()()}if(r&2){let t=re();ne(3),fn("active",t.activeTab==="events"),ne(2),fn("active",t.activeTab==="places"),ne(2),fn("active",t.activeTab==="creators"),ne(2),mt(t.activeTab==="events"&&t.showFilterOptions?9:-1),ne(2),mt(t.activeTab==="events"?11:-1),ne(),mt(t.activeTab==="places"?12:-1),ne(),mt(t.activeTab==="creators"?13:-1)}}var Fx=class r{constructor(n,t,l){this.eventService=n;this.mapboxService=t;this.userService=l}focusEvent=new Zt;foundLocation=new Zt;toggleFavorite=new Zt;openUserProfile=new Zt;shareEvent=new Zt;userId=null;events=[];searchQuery="";isExpanded=!1;isSearching=!1;activeTab="events";searchResults=[];cityResults=[];userResults=[];followingMap={};followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;showFilterOptions=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};ngOnChanges(){this.categorizeEvents()}toggleExpand(){this.isExpanded=!this.isExpanded,this.isExpanded||this.clearSearch()}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.isSearching=!0,this.eventService.searchEvents(this.searchQuery).subscribe(n=>{this.searchResults=n}),this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(t=>({name:t.place_name,center:t.center}))}),this.userService.searchUsers(this.searchQuery).subscribe(n=>{this.userResults=n,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(t=>{this.followingMap[n.id]=t.isFollowing})})}followUser(n,t){t.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,t){t.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}openProfile(n){this.openUserProfile.emit(n.id.toString()),this.closeSearch()}setActiveTab(n){this.activeTab=n,n!=="events"&&(this.filterMenuOpen=!1,this.sortMenuOpen=!1)}selectCity(n){let[t,l]=n.center;this.foundLocation.emit({lat:l,lng:t}),this.closeSearch()}goToEvent(n){this.focusEvent.emit(n),this.closeSearch()}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[]}closeSearch(){this.isExpanded=!1,this.clearSearch()}get hasSearchQuery(){return this.searchQuery.trim().length>0}formatDateTime(n){let t=n.date?new Date(`${n.date}T00:00:00`):null,l=n.startTime?n.startTime.slice(0,5):"",h=n.endTime?n.endTime.slice(0,5):"",i=t?t.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=l&&h?`${l} - ${h}`:l||h;return[i,E].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}isFutureEvent=n=>{if(!n.date)return!0;let t=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${t}`).getTime()>=Date.now()};categorizeEvents(){if(this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.foundEvents=[],this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent);return}this.eventService.getJoinedEvents(this.userId).subscribe(n=>{this.followUpEvents=n.filter(this.isFutureEvent)}),this.events.filter(this.isFutureEvent).forEach(n=>{let t=n.isSaved||!1,l=n.isParticipating||!1;t&&this.savedEvents.push(n),!l&&!t&&this.discoverEvents.push(n)})}updateRangeLimits(){let n=this.events.map(K=>K.costPerPerson??0),t=n.length?Math.max(...n):0,l=Math.max(10,Math.ceil(t)),h=this.events.map(K=>K.distanceKm).filter(K=>typeof K=="number"&&!Number.isNaN(K)),i=h.length?Math.max(...h):0,E=Math.max(5,Math.ceil(i)),O=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=l,(O||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let N=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=E,(N||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(n){let t=[...n];switch(this.filterOption){case"participating":t=t.filter(i=>!!i.isParticipating);break;case"free":t=t.filter(i=>i.costPerPerson==null||i.costPerPerson===0);break;case"available":t=t.filter(i=>i.nPartecipants==null||i.occupiedSpots==null?!0:i.nPartecipants-i.occupiedSpots>0);break}switch(this.sortOption){case"distance":t.sort((i,E)=>(i.distanceKm??999)-(E.distanceKm??999));break;case"name":t.sort((i,E)=>(i.title||"").localeCompare(E.title||""));break;case"date":default:t.sort((i,E)=>{let O=new Date(`${i.date}T${i.startTime||"00:00"}`).getTime(),N=new Date(`${E.date}T${E.startTime||"00:00"}`).getTime();return O-N});break}return(this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(t=t.filter(i=>{let E=i.costPerPerson??0;return E>=this.priceMin&&E<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(t=t.filter(i=>{let E=i.distanceKm;return E==null?!1:E>=this.distanceMin&&E<=this.distanceMax})),t}getFiltered(n){return this.applyFilters(n)}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1}onPriceMinChange(n){let t=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(t)?this.priceMin:t}onPriceMaxChange(n){let t=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(t)?this.priceMax:t}onDistanceMinChange(n){let t=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(t)?this.distanceMin:t}onDistanceMaxChange(n){let t=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(t)?this.distanceMax:t}getPriceTrackStyle(){let n=this.priceMin/this.priceMaxLimit*100,t=this.priceMax/this.priceMaxLimit*100;return{left:n+"%",width:t-n+"%"}}getDistanceTrackStyle(){let n=this.distanceMin/this.distanceMaxLimit*100,t=this.distanceMax/this.distanceMaxLimit*100;return{left:n+"%",width:t-n+"%"}}static \u0275fac=function(t){return new(t||r)(Bt(js),Bt(Iu),Bt(_s))};static \u0275cmp=In({type:r,selectors:[["app-mobile-search"]],inputs:{userId:"userId",events:"events"},outputs:{focusEvent:"focusEvent",foundLocation:"foundLocation",toggleFavorite:"toggleFavorite",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Vr],decls:8,vars:7,consts:[[1,"mobile-search-wrapper"],[1,"floating-search-bar",3,"click"],[1,"search-icon"],["type","text","placeholder","Search events, cities or people",1,"pill-input",3,"ngModelChange","keyup.enter","focus","ngModel","readonly"],["class","options-icon",3,"click",4,"ngIf"],["class","close-icon",3,"click",4,"ngIf"],["class","search-overlay",4,"ngIf"],[1,"options-icon",3,"click"],[1,"close-icon",3,"click"],[1,"search-overlay"],[1,"search-results-container"],[1,"tabs-header"],[1,"tab-btn",3,"click"],[1,"filter-sort-container"],[1,"results-scroll-area"],[1,"list-view"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs"],[1,"slider-wrapper"],[1,"slider-track",3,"ngStyle"],["type","range",3,"input","min","max","step","ngModel"],[1,"menu-item"],[1,"menu-item",3,"click"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"mobile-section"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle"],[1,"loc-info"],[1,"loc-name"],[4,"ngIf"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1),Re("click",function(){return!l.isExpanded&&l.toggleExpand()}),B(2,"mat-icon",2),Q(3,"search"),U(),B(4,"input",3),Ro("ngModelChange",function(i){return Ho(l.searchQuery,i)||(l.searchQuery=i),i}),Re("keyup.enter",function(){return l.onSearch()})("focus",function(){return!l.isExpanded&&l.toggleExpand()}),U(),Ui(5,jK,2,0,"mat-icon",4)(6,$K,2,0,"mat-icon",5),U(),Ui(7,yQ,14,10,"div",6),U()),t&2&&(fn("expanded",l.isExpanded),ne(4),Oo("ngModel",l.searchQuery),bt("readonly",!l.isExpanded),ne(),bt("ngIf",l.isExpanded&&l.activeTab==="events"),ne(),bt("ngIf",l.isExpanded),ne(),bt("ngIf",l.isExpanded))},dependencies:[Li,Ps,Hy,Nl,Us,Rx,Da,nl,Xi,Zi,jh],styles:[".mobile-search-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:80px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}@media (max-width: 767px){.mobile-search-wrapper[_ngcontent-%COMP%]{bottom:40px}}.mobile-search-wrapper.expanded[_ngcontent-%COMP%]{inset:0;z-index:10000}.floating-search-bar[_ngcontent-%COMP%]{background:var(--color-dark-gray);height:50px;border-radius:25px;display:flex;align-items:center;padding:0 16px;box-shadow:0 4px 12px #0000004d;border:1px solid var(--color-light-gray);gap:12px;cursor:pointer;z-index:10001;position:absolute;bottom:0;width:100%}.expanded[_ngcontent-%COMP%]   .floating-search-bar[_ngcontent-%COMP%]{inset:20px 20px auto;width:calc(100% - 40px);border-radius:12px}.pill-input[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--color-white);font-size:14px;flex:1;outline:none}.search-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.search-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-dark-gray);z-index:9999;display:flex;flex-direction:column;padding-top:90px;animation:_ngcontent-%COMP%_searchSlideUp .3s cubic-bezier(.25,.8,.25,1)}@keyframes _ngcontent-%COMP%_searchSlideUp{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.search-results-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:0 20px 20px;gap:20px;overflow:hidden}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:8px;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-size:12px;font-weight:600;border-radius:20px;white-space:nowrap}.tab-btn.active[_ngcontent-%COMP%]{background:var(--color-accent);color:var(--color-black)}.results-scroll-area[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background:var(--color-bit-gray);display:flex;align-items:center;justify-content:center}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;opacity:.5;font-style:italic}.search-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.options-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.filter-sort-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:0 0 10px;overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{padding:8px 4px}.slider-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:6px;background:#ffffff1a;border-radius:3px;display:flex;align-items:center}.slider-track[_ngcontent-%COMP%]{position:absolute;height:6px;background:linear-gradient(90deg,#fbbc04,#ffeb3b);border-radius:3px;z-index:1}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;width:100%;background:none;pointer-events:none;-webkit-appearance:none;appearance:none;z-index:2;margin:0}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{height:20px;width:20px;border-radius:50%;background:#fbbc04;cursor:pointer;pointer-events:auto;-webkit-appearance:none;border:2px solid var(--color-dark-gray);box-shadow:0 2px 6px #0006}.slider-wrapper[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{height:20px;width:20px;border-radius:50%;background:#fbbc04;cursor:pointer;pointer-events:auto;border:2px solid var(--color-dark-gray);box-shadow:0 2px 6px #0006}.mobile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:11px;min-width:120px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;gap:6px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:160px;z-index:10002;padding:4px}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:none;background:transparent;color:var(--color-white);font-size:13px;border-radius:8px}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.clickable[_ngcontent-%COMP%]{cursor:pointer}"]})};function xQ(r,n){if(r&1&&Mn(0,"img",8),r&2){let t=re(2);bt("src",t.posterPreviewUrl,Gr)}}function bQ(r,n){r&1&&(B(0,"div",9),Q(1,"Anteprima in generazione..."),U())}function wQ(r,n){if(r&1){let t=It();B(0,"div",1),Re("click",function(){Pe(t);let h=re();return Oe(h.close.emit())}),B(1,"div",2),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())}),B(2,"div",3)(3,"div",4)(4,"mat-icon"),Q(5,"share"),U(),B(6,"span"),Q(7,"Share Event"),U()(),B(8,"button",5),Re("click",function(){Pe(t);let h=re();return Oe(h.close.emit())}),B(9,"mat-icon"),Q(10,"close"),U()()(),B(11,"div",6)(12,"div",7),ft(13,xQ,1,1,"img",8)(14,bQ,2,0,"div",9),U(),B(15,"div",10)(16,"button",11),Re("click",function(){Pe(t);let h=re();return Oe(h.downloadPoster())}),B(17,"mat-icon"),Q(18,"download"),U(),B(19,"span"),Q(20),U()(),B(21,"button",12),Re("click",function(){Pe(t);let h=re();return Oe(h.shareLink())}),B(22,"mat-icon"),Q(23,"link"),U(),B(24,"span"),Q(25,"Share link"),U()()()()()()}if(r&2){let t=re();ne(12),Ds("background-image","url("+t.templateUrl+")"),ne(),mt(t.posterPreviewUrl?13:14),ne(3),bt("disabled",t.downloading),ne(4),xt(t.downloading?"Generating...":"Download poster")}}var V_=class r{event=null;close=new Zt;templateUrl="assets/img/LocandinaTemplate.png";downloading=!1;posterPreviewUrl="";posterWidth=1080;posterHeight=1350;infoArea={x:50,y:190,width:590};qrSquare={x:325,y:831,size:430};previewToken=0;ngOnChanges(n){n.event&&this.buildPreview()}getShareLink(n=this.event){if(!n)return"";let t=window.location.protocol,l=window.location.host;return`${t}//${l}/?event=${n.id}`}getQrCodeUrl(n=220,t=this.event){let l=this.getShareLink(t);return l?`https://api.qrserver.com/v1/create-qr-code/?size=${n}x${n}&margin=0&data=${encodeURIComponent(l)}`:""}buildPreview(){return Ko(this,null,function*(){let n=++this.previewToken;if(!this.event){this.posterPreviewUrl="";return}try{let t=yield this.renderPoster(this.event);if(n!==this.previewToken)return;this.posterPreviewUrl=t.toDataURL("image/png")}catch(t){console.error("Failed to generate poster preview",t),n===this.previewToken&&(this.posterPreviewUrl="")}})}downloadPoster(){return Ko(this,null,function*(){let n=this.event;if(!(!n||this.downloading)){this.downloading=!0;try{let t=yield this.renderPoster(n),l=yield new Promise(E=>t.toBlob(E,"image/png"));if(!l)throw new Error("Unable to generate poster");let h=`lumo-event-${n.id}.png`,i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=h,i.click(),setTimeout(()=>URL.revokeObjectURL(i.href),1e3)}catch(t){console.error("Failed to download poster",t),alert("Unable to generate the poster. You can share the link instead.")}finally{this.downloading=!1}}})}shareLink(){return Ko(this,null,function*(){let n=this.getShareLink();if(!(!n||!this.event)){if(navigator.share)try{yield navigator.share({title:this.event.title,text:"Check out this event on Lumo",url:n});return}catch(t){console.warn("Share cancelled or failed",t)}this.copyShareLink()}})}copyShareLink(){let n=this.getShareLink();n&&navigator.clipboard.writeText(n).then(()=>{alert("Link copied to clipboard!")}).catch(t=>{console.error("Failed to copy link: ",t),alert("Unable to copy the link.")})}formatDateTime(n){let t=n.date?new Date(`${n.date}T00:00:00`):null,l=n.startTime?n.startTime.slice(0,5):"",h=n.endTime?n.endTime.slice(0,5):"",i=t?t.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=l&&h?`${l} - ${h}`:l||h;return[i,E].filter(Boolean).join(" | ")}formatCost(n){return n.costPerPerson==null||n.costPerPerson===0?"Free":`\u20AC${n.costPerPerson} per person`}formatLocation(n){return n.city||"Location TBD"}ensureFontsLoaded(){return Ko(this,null,function*(){if("fonts"in document)try{yield document.fonts.ready}catch(n){console.warn("Fonts not ready",n)}})}loadImage(n){return new Promise((t,l)=>{let h=new Image;h.crossOrigin="anonymous",h.onload=()=>t(h),h.onerror=()=>l(new Error("Failed to load image")),h.src=n})}renderPoster(n){return Ko(this,null,function*(){yield this.ensureFontsLoaded();let t=document.createElement("canvas");t.width=this.posterWidth,t.height=this.posterHeight;let l=t.getContext("2d");if(!l)throw new Error("Unable to render poster");let h=yield this.loadImage(this.templateUrl);l.drawImage(h,0,0,this.posterWidth,this.posterHeight),l.textAlign="left",l.textBaseline="top";let i=n.title||"Lumo Event",E=this.infoArea.x,O=this.infoArea.width,N=this.infoArea.y;l.fillStyle="#FFFFFF",l.font='700 56px "Stack Sans Headline", Arial, sans-serif',N=this.drawWrappedText(l,i,E,N,O,64,2),N+=12;let K=this.formatDateTime(n);K&&(l.fillStyle="#FCC324",l.font='600 32px "Stack Sans Headline", Arial, sans-serif',l.fillText(K,E,N),N+=40),l.fillStyle="#FFFFFF",l.font='500 30px "Stack Sans Headline", Arial, sans-serif',l.fillText(this.formatLocation(n),E,N),N+=38,l.fillText(this.formatCost(n),E,N),N+=38,n.organizerName&&(l.fillStyle="#B0B0B0",l.font='500 26px "Stack Sans Headline", Arial, sans-serif',l.fillText(`Eventer: ${n.organizerName}`,E,N),N+=32),n.description&&(l.fillStyle="#B0B0B0",l.font='400 24px "Stack Sans Headline", Arial, sans-serif',N=this.drawWrappedText(l,n.description,E,N+6,O,30,3));let le=20,De=12,Qe=24,Fe=this.qrSquare.size+le*2,gt=this.qrSquare.x-le,jt=this.qrSquare.y-le,Ot=Fe-De*2,Kt=gt+De,Hn=jt+De,Er=yield this.loadImage(this.getQrCodeUrl(Ot,n));return l.save(),this.drawRoundedRect(l,gt,jt,Fe,Fe,Qe),l.clip(),l.fillStyle="#FFFFFF",l.fill(),l.drawImage(Er,Kt,Hn,Ot,Ot),l.restore(),t})}drawRoundedRect(n,t,l,h,i,E){let O=Math.max(0,Math.min(E,h/2,i/2));n.beginPath(),n.moveTo(t+O,l),n.arcTo(t+h,l,t+h,l+i,O),n.arcTo(t+h,l+i,t,l+i,O),n.arcTo(t,l+i,t,l,O),n.arcTo(t,l,t+h,l,O),n.closePath()}drawWrappedText(n,t,l,h,i,E,O){let N=t.split(" "),K="",le=0;for(let De of N){let Qe=K?`${K} ${De}`:De;if(n.measureText(Qe).width>i&&K){if(n.fillText(this.truncateToWidth(n,K,i,le===O-1),l,h),K=De,h+=E,le+=1,le>=O)return h}else K=Qe}if(K&&le<O){let De=le===O-1;n.fillText(this.truncateToWidth(n,K,i,De),l,h),h+=E}return h}truncateToWidth(n,t,l,h){if(!h||n.measureText(t).width<=l)return t;let i=t;for(;i.length>0;){let E=`${i}...`;if(n.measureText(E).width<=l)return E;i=i.slice(0,-1)}return t}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=In({type:r,selectors:[["app-event-share-modal"]],inputs:{event:"event"},outputs:{close:"close"},features:[Vr],decls:1,vars:1,consts:[[1,"event-share-backdrop"],[1,"event-share-backdrop",3,"click"],[1,"event-share-modal",3,"click"],[1,"event-share-header"],[1,"header-title"],[1,"close-btn",3,"click"],[1,"event-share-content"],[1,"poster-preview"],["alt","Event poster",1,"poster-preview-image",3,"src"],[1,"poster-preview-loading"],[1,"share-actions"],[1,"button","action-btn",3,"click","disabled"],[1,"button","action-btn","secondary",3,"click"]],template:function(t,l){t&1&&ft(0,wQ,26,5,"div",0),t&2&&mt(l.event?0:-1)},dependencies:[Li,Xi,Zi],styles:[".event-share-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-backdrop);z-index:var(--z-popup);display:flex;align-items:center;justify-content:center;padding:20px}.event-share-modal[_ngcontent-%COMP%]{width:min(560px,94vw);background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:20px;box-shadow:var(--shadow-lg);padding:14px 14px 18px;display:flex;flex-direction:column;gap:16px}.event-share-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-white);font-weight:600;font-size:16px}.close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--color-white);cursor:pointer;padding:6px;border-radius:50%}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff14}.event-share-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.poster-preview[_ngcontent-%COMP%]{position:relative;width:min(500px,100%);aspect-ratio:4 / 5;border-radius:18px;border:1px solid var(--color-bit-gray);overflow:hidden;background-position:center;background-size:cover;background-color:#0b0b0b}.poster-preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.poster-preview-loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:grid;place-items:center;color:#cfcfcf;font-size:13px;background:#00000059}.share-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;align-items:center;justify-content:center;width:100%}.action-btn[_ngcontent-%COMP%]{gap:8px;width:210px;justify-content:center;font-weight:var(--font-weight-semibold)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:inherit}.action-btn.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white)}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:default}@media (max-width: 767px){.event-share-modal[_ngcontent-%COMP%]{padding:16px}.event-share-content[_ngcontent-%COMP%]{width:100%}.share-actions[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;justify-content:center}.action-btn[_ngcontent-%COMP%]{flex:1 1 140px;justify-content:center;width:auto}}"]})};function CQ(r,n){if(r&1){let t=It();B(0,"app-event-share-modal",5),Re("close",function(){Pe(t);let h=re();return Oe(h.sharingEvent=null)}),U()}if(r&2){let t=re();bt("event",t.sharingEvent)}}var $h=document.createElement("div");$h.style.width="20px";$h.style.height="20px";$h.style.backgroundColor="#4285F4";$h.style.border="3px solid white";$h.style.borderRadius="50%";$h.style.boxShadow="0 0 3px rgba(0,0,0,0.3)";var Lx=class r{constructor(n,t){this.eventService=n;this.snackBar=t}userId=null;eventSelected=new Zt;mapInteract=new Zt;eventsUpdated=new Zt;openUserProfile=new Zt;mapInstance;eventMarkers=new Map;events=[];sharingEvent=null;userCoords=null;sidebarCollapsed=!1;managedPopupType=null;sidebar;mobileSearch;pollSubscription=null;get map(){return this.mapInstance}getEventScreenPosition(n){if(!n.latitude||!n.longitude||!this.mapInstance)return null;let t=this.mapInstance.project([n.longitude,n.latitude]);return{x:t.x,y:t.y}}ngOnChanges(n){n.userId&&!n.userId.isFirstChange()&&(this.resetSearch(),this.loadEvents(),this.startPolling())}resetSearch(){this.sidebar&&this.sidebar.clearSearch(),this.mobileSearch&&this.mobileSearch.clearSearch()}ngAfterViewInit(){this.mapInstance=new U_.Map({accessToken:tl.mapboxToken,container:"map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:18,pitch:60,bearing:-20,antialias:!0}),this.mapInstance.dragPan.enable(),this.mapInstance.touchZoomRotate.enable({around:"center"}),this.mapInstance.touchZoomRotate.disableRotation(),this.mapInstance.touchZoomRotate.enable(),this.mapInstance.on("move",n=>{n.originalEvent&&this.mapInteract.emit()}),this.mapInstance.on("click",n=>{n.originalEvent&&this.mapInteract.emit()}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.setCenter(this.userCoords),new U_.Marker({element:$h}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>{console.warn("Geolocation error:",n)},{enableHighAccuracy:!0}),this.loadEvents(),this.startPolling()}ngOnDestroy(){this.map&&this.mapInstance.remove(),this.eventMarkers.forEach(n=>n.remove()),this.stopPolling()}startPolling(){this.stopPolling(),this.pollSubscription=Q0(1e4).pipe(_o(()=>this.eventService.getEvents(this.userId||void 0))).subscribe({next:n=>{this.handleEventsUpdate(n)},error:n=>console.error("Error polling events",n)})}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}isFutureEvent(n){if(!n.date)return!0;let t=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${t}`).getTime()>=Date.now()}handleEventsUpdate(n){let t=n.filter(i=>this.isFutureEvent(i)),l=JSON.stringify(this.events.map(i=>({id:i.id,status:i.participationStatus,saved:i.isSaved,savedCount:i.savedCount}))),h=JSON.stringify(t.map(i=>({id:i.id,status:i.participationStatus,saved:i.isSaved,savedCount:i.savedCount})));(this.events.length!==t.length||l!==h)&&(this.events=t,this.updateDistancesAndSort(),this.placeEventMarkers(),this.eventsUpdated.emit(this.events))}loadEvents(){this.eventService.getEvents(this.userId||void 0).subscribe({next:n=>{this.events=n.filter(t=>this.isFutureEvent(t)),this.updateDistancesAndSort(),this.placeEventMarkers()},error:n=>{console.error("Error fetching events",n)}})}placeEventMarkers(){this.eventMarkers.forEach(n=>n.remove()),this.eventMarkers.clear(),this.events.forEach(n=>{if(n.latitude==null||n.longitude==null)return;let t=document.createElement("div");t.className="golden-pulse-marker";let l=new U_.Marker({element:t}).setLngLat([n.longitude,n.latitude]).addTo(this.map);t.addEventListener("click",h=>{h.stopPropagation(),this.flyToEvent(n)}),typeof n.id=="number"&&this.eventMarkers.set(n.id,l)})}flyToEvent(n){!this.map||n.longitude==null||n.latitude==null||(this.mapInstance.flyTo({center:[n.longitude,n.latitude],zoom:18,essential:!0,duration:1e3}),this.eventSelected.emit(n))}flyToLocation(n){this.map&&this.mapInstance.flyTo({center:[n.lng,n.lat],zoom:17,essential:!0,duration:1500})}flyToUser(){if(this.map){if(this.userCoords){this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),this.updateDistancesAndSort(),this.placeEventMarkers();return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),new U_.Marker({element:$h}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>console.warn("Geolocation error:",n),{enableHighAccuracy:!0})}}updateDistancesAndSort(){if(!this.userCoords||!this.events.length)return;let[n,t]=this.userCoords;this.events=this.events.map(l=>bi($t({},l),{distanceKm:this.computeDistanceKm(t,n,l.latitude,l.longitude)})).sort((l,h)=>(l.distanceKm??Number.POSITIVE_INFINITY)-(h.distanceKm??Number.POSITIVE_INFINITY))}computeDistanceKm(n,t,l,h){if(l==null||h==null)return;let i=6371,E=this.deg2rad(l-n),O=this.deg2rad(h-t),N=Math.sin(E/2)*Math.sin(E/2)+Math.cos(this.deg2rad(n))*Math.cos(this.deg2rad(l))*Math.sin(O/2)*Math.sin(O/2),K=2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N));return i*K}deg2rad(n){return n*(Math.PI/180)}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}requestLogin=new Zt;onToggleFavorite(n){if(!this.userId){this.snackBar.open("You must sign in to save events.","SIGN IN",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["login-snackbar"]}).onAction().subscribe(()=>{this.requestLogin.emit()});return}n.id&&this.eventService.toggleSavedEvent(this.userId,n.id).subscribe({next:t=>{let l=!!n.isSaved,h=typeof n.savedCount=="number"?n.savedCount:0;n.isSaved=t.isSaved,t.isSaved&&!l?n.savedCount=h+1:!t.isSaved&&l?n.savedCount=Math.max(0,h-1):(n.savedCount===void 0||n.savedCount===null)&&(n.savedCount=h);let i=this.events.find(E=>E.id===n.id);i&&i!==n&&(i.isSaved=n.isSaved,i.savedCount=n.savedCount),this.events=[...this.events]},error:t=>console.error("Error toggling favorite",t)})}openShare(n){this.sharingEvent=n}static \u0275fac=function(t){return new(t||r)(Bt(js),Bt($P))};static \u0275cmp=In({type:r,selectors:[["map-view"]],viewQuery:function(t,l){if(t&1&&(Sa(kx,5),Sa(Fx,5)),t&2){let h;aa(h=la())&&(l.sidebar=h.first),aa(h=la())&&(l.mobileSearch=h.first)}},inputs:{userId:"userId"},outputs:{eventSelected:"eventSelected",mapInteract:"mapInteract",eventsUpdated:"eventsUpdated",openUserProfile:"openUserProfile",requestLogin:"requestLogin"},features:[Vr],decls:7,vars:6,consts:[[3,"focusEvent","toggleSidebar","toggleFavorite","foundLocation","shareEvent","openUserProfile","events","collapsed","userId"],[3,"focusEvent","foundLocation","toggleFavorite","shareEvent","openUserProfile","events","userId"],[3,"event"],["id","map",1,"map-container"],[1,"locate-btn",3,"click"],[3,"close","event"]],template:function(t,l){t&1&&(B(0,"app-sidebar",0),Re("focusEvent",function(i){return l.flyToEvent(i)})("toggleSidebar",function(){return l.toggleSidebar()})("toggleFavorite",function(i){return l.onToggleFavorite(i)})("foundLocation",function(i){return l.flyToLocation(i)})("shareEvent",function(i){return l.openShare(i)})("openUserProfile",function(i){return l.openUserProfile.emit(i)}),U(),B(1,"app-mobile-search",1),Re("focusEvent",function(i){return l.flyToEvent(i)})("foundLocation",function(i){return l.flyToLocation(i)})("toggleFavorite",function(i){return l.onToggleFavorite(i)})("shareEvent",function(i){return l.openShare(i)})("openUserProfile",function(i){return l.openUserProfile.emit(i)}),U(),ft(2,CQ,1,1,"app-event-share-modal",2),Mn(3,"div",3),B(4,"button",4),Re("click",function(){return l.flyToUser()}),B(5,"mat-icon"),Q(6,"my_location"),U()()),t&2&&(bt("events",l.events)("collapsed",l.sidebarCollapsed)("userId",l.userId),ne(),bt("events",l.events)("userId",l.userId),ne(),mt(l.sharingEvent?2:-1))},dependencies:[kx,Fx,V_,Xi,Zi,vU,Li],styles:['.map-container[_ngcontent-%COMP%]{width:100%;height:100vh}.locate-btn[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px;width:48px;height:48px;border-radius:50%;border:none;background:var(--color-dark-gray);box-shadow:0 2px 8px #00000040;display:grid;place-items:center;cursor:pointer;transition:box-shadow .2s ease,transform .1s ease,background-color .2s}.locate-btn[_ngcontent-%COMP%]:hover{background:#333;box-shadow:0 4px 12px #0000004d}.locate-btn[_ngcontent-%COMP%]:active{transform:scale(.96)}.locate-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}app-mobile-search[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){app-mobile-search[_ngcontent-%COMP%]{display:block}.locate-btn[_ngcontent-%COMP%]{bottom:40px}}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content{background:var(--color-dark-gray);color:#f5f5f5;border:1px solid var(--color-gray);box-shadow:0 4px 12px #00000059;border-radius:10px}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content strong{color:#fbbc04}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-tip{border-top-color:var(--color-dark-gray)}[_nghost-%COMP%]     .golden-pulse-marker{width:40px;height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;background:transparent}[_nghost-%COMP%]     .golden-pulse-marker:after{content:"";position:absolute;width:14px;height:14px;background-color:#fcc324;border:2px solid white;border-radius:3px;transform:rotate(45deg);box-shadow:0 0 10px #fcc324cc;z-index:2;animation:_ngcontent-%COMP%_corePulse 3s infinite ease-in-out}[_nghost-%COMP%]     .golden-pulse-marker:before{content:"";position:absolute;width:100%;height:100%;background:radial-gradient(circle,#fcc32466,#fcc32400 70%);border-radius:50%;z-index:1;opacity:.6;animation:_ngcontent-%COMP%_glowPulse 2.5s infinite ease-in-out}@keyframes _ngcontent-%COMP%_corePulse{0%,to{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:.8;transform:rotate(45deg) scale(.9)}}@keyframes _ngcontent-%COMP%_glowPulse{0%,to{opacity:.2;transform:scale(.8)}50%{opacity:.7;transform:scale(1.2)}}']})};var Mu=class r{constructor(n){this.bp=n;this.bp.observe(["(max-width: 979px)","(min-width: 980px) and (max-width: 1399px)","(min-width: 1400px)"]).subscribe(t=>{t.breakpoints["(max-width: 979px)"]?this.screen.set("mobile"):t.breakpoints["(min-width: 980px) and (max-width: 1399px)"]?this.screen.set("tablet"):this.screen.set("desktop")})}screen=oa("desktop");static \u0275fac=function(t){return new(t||r)(dn(Mf))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var Aa=class r{constructor(n){this.responsive=n}path=ro("");iconAlt=ro("icon");static \u0275fac=function(t){return new(t||r)(Bt(Mu))};static \u0275cmp=In({type:r,selectors:[["CircleIcon"]],inputs:{path:[1,"path"],iconAlt:[1,"iconAlt"]},decls:2,vars:8,consts:[[1,"circle-container"],[1,"icon",3,"src","alt"]],template:function(t,l){t&1&&(Mh(0,"div",0),Cd(1,"img",1),Dh()),t&2&&(fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet"),ne(),BC("src",VC(l.path()),Gr)("alt",VC(l.iconAlt())))},styles:[".circle-container[_ngcontent-%COMP%]{padding:3px;height:auto;width:auto;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:flex;justify-content:center;align-items:center;background-color:var(--color-light-gray);cursor:pointer}.icon[_ngcontent-%COMP%]{height:20px;width:20px;color:var(--color-accent, #FCC324)}.circle-container.tablet[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .circle-container.mobile[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:30px;width:30px}"]})};function EQ(r,n){if(r&1&&Mn(0,"textarea",1),r&2){let t=re();bt("formControl",t.control)("placeholder",t.placeholder)}}function SQ(r,n){if(r&1){let t=It();B(0,"button",6),Re("click",function(h){Pe(t);let i=re(2);return Oe(i.togglePasswordVisibility(h))}),B(1,"mat-icon"),Q(2),U()()}if(r&2){let t=re(2);ne(2),xt(t.showPassword?"visibility_off":"visibility")}}function TQ(r,n){if(r&1&&(B(0,"div",3),Mn(1,"input",4),ft(2,SQ,3,1,"button",5),U()),r&2){let t=re();fn("with-toggle",t.showToggle&&t.type==="password"),ne(),bt("formControl",t.control)("type",t.inputType)("placeholder",t.placeholder),$o("min",t.min),ne(),mt(t.showToggle&&t.type==="password"?2:-1)}}var Hh=class r{control=null;type="text";placeholder="";error=!1;customClass="";showToggle=!1;min=null;showPassword=!1;get inputType(){return this.showToggle&&this.type==="password"?this.showPassword?"text":"password":this.type}togglePasswordVisibility(n){n.stopPropagation(),this.showToggle&&this.type==="password"&&(this.showPassword=!this.showPassword)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=In({type:r,selectors:[["FormField"]],inputs:{control:"control",type:"type",placeholder:"placeholder",error:"error",customClass:"customClass",showToggle:"showToggle",min:"min"},decls:3,vars:4,consts:[[1,"input-wrapper",3,"ngClass"],[1,"input-field",3,"formControl","placeholder"],[1,"input-with-toggle",3,"with-toggle"],[1,"input-with-toggle"],[1,"input-field",3,"formControl","type","placeholder"],["type","button",1,"toggle-btn"],["type","button",1,"toggle-btn",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),ft(1,EQ,1,2,"textarea",1)(2,TQ,3,7,"div",2),U()),t&2&&(fn("error",l.error),bt("ngClass",l.customClass),ne(),mt(l.type==="textarea"?1:2))},dependencies:[Vh,Us,Da,KP,Li,x2,Xi,Zi],styles:[".form-field[_ngcontent-%COMP%]{font:var(--font-stack-headline);display:block;min-width:0;min-height:50px;max-width:500px;padding:0 var(--spacing-md);border-radius:var(--radius-lg);background-color:var(--color-gray);border:none;color:var(--color-white);font-size:16px}.form-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray);font-weight:var(--font-weight-light)}.form-field[_ngcontent-%COMP%]:focus{outline:none}input[type=date][_ngcontent-%COMP%]{color:var(--color-light-gray)}.input-wrapper[_ngcontent-%COMP%]{width:100%;position:relative}.input-wrapper.tall-field[_ngcontent-%COMP%]{height:80px}.input-wrapper.tall-field[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{height:100%;resize:none;padding-top:12px}.input-with-toggle[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-with-toggle.with-toggle[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{padding-right:42px}.toggle-btn[_ngcontent-%COMP%]{position:absolute;right:10px;background:transparent;border:none;color:#bbb;cursor:pointer;display:grid;place-items:center;padding:4px}.toggle-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.input-field[_ngcontent-%COMP%]{width:100%;height:50px;padding:0 var(--spacing-md);background-color:var(--color-gray);border:2px solid rgba(255,255,255,.12);border-radius:var(--radius-lg);color:var(--color-white);font-size:16px;font-family:inherit;font-weight:var(--font-weight-light);outline:none;transition:border-color .2s}.input-field[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.input-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.input-wrapper.error[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{border-color:var(--color-error)}input[_ngcontent-%COMP%]:-webkit-autofill, input[_ngcontent-%COMP%]:-webkit-autofill:hover, input[_ngcontent-%COMP%]:-webkit-autofill:focus, input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px var(--color-gray) inset!important;-webkit-text-fill-color:var(--color-white)!important;transition:background-color 5000s ease-in-out 0s;caret-color:var(--color-white)}"]})};function QP(r){let n=r.value?.trim();return/^[A-Za-z---\s]+$/.test(n)?null:{onlyLetters:!0}}function JP(r){let n=r.value;if(!n)return{adult:!0};let t=new Date(n);return new Date().getFullYear()-t.getFullYear()<18?{adult:!0}:null}function j_(r){let n=r.value?.trim();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?null:{emailInvalid:!0}}function $_(r){let n=r.value;return/^(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(n)?null:{weakPassword:!0}}var Du=class r{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/auth";signUp(n){return console.log("Payload inviato:",n),this.http.post(`${this.baseUrl}/signup`,n)}login(n){return this.http.post(`${this.baseUrl}/login`,n)}loginWithGoogle(n){return this.http.post(`${this.baseUrl}/login/google`,n)}loginWithGoogleCode(n){return this.http.post(`${this.baseUrl}/login/google/code`,n)}verifyEmail(n){return this.http.get(`${this.baseUrl}/verify?token=${n}`)}resendEmail(n){return this.http.post(`${this.baseUrl}/resend-token`,n)}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var H_=class r{scriptLoadingPromise=null;loadScript(){return this.scriptLoadingPromise?this.scriptLoadingPromise:(this.scriptLoadingPromise=new Promise((n,t)=>{if(document.getElementById("google-identity")){n();return}let l=document.createElement("script");l.id="google-identity",l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.onload=()=>n(),l.onerror=()=>t(new Error("Unable to load Google Identity Services")),document.head.appendChild(l)}),this.scriptLoadingPromise)}getAuthCode(){return Ko(this,null,function*(){if(yield this.loadScript(),!tl.googleClientId)throw new Error("Configure the Google Client ID.");let n=tl.googleRedirectUri||window.location.origin;return new Promise((t,l)=>{google.accounts.oauth2.initCodeClient({client_id:tl.googleClientId,scope:"openid email profile",ux_mode:"popup",redirect_uri:n,state:"signin",callback:i=>{if(i&&i.code)t(i.code);else if(i&&i.error){let E=new Error(i.error_description||i.error||"Google sign-in cancelled.");E.code=i.error,l(E)}else l(new Error("Google sign-in cancelled."))}}).requestCode()})})}getIdToken(){return Ko(this,null,function*(){if(yield this.loadScript(),!tl.googleClientId)throw new Error("Configure the Google Client ID.");return new Promise((n,t)=>{let l=!1,h=E=>{let O=(E||"").toLowerCase();return O.includes("invalid")?{message:"Configure the Google Client ID.",code:"google_config"}:O.includes("missing")?{message:"Configure the Google Client ID.",code:"google_config"}:O.includes("suppressed")?{message:"Google sign-in cancelled: Google suppressed the prompt (cookie).",code:"google_cancelled"}:O.includes("user_cancel")?{message:"Google sign-in cancelled by the user.",code:"google_cancelled"}:{message:"Google sign-in cancelled.",code:"google_cancelled"}},i=(E,O)=>{if(!l)if(l=!0,O)n(O);else{let N=typeof E=="string"?E:E?.message,K=typeof E=="string"?void 0:E?.code,le=new Error(N||"Google sign-in cancelled.");K&&(le.code=K),t(le)}};google.accounts.id.initialize({client_id:tl.googleClientId,callback:E=>{E&&E.credential?i(void 0,E.credential):i({message:"Google sign-in cancelled.",code:"google_cancelled"})},ux_mode:"popup",use_fedcm_for_prompt:!0,itp_support:!0,cancel_on_tap_outside:!0,auto_select:!1}),google.accounts.id.prompt(E=>{let O=E?.isNotDisplayed?.(),N=E?.isSkippedMoment?.();if(O||N){let K=E?.getNotDisplayedReason?.()||E?.getSkippedReason?.()||"Google sign-in cancelled.";i(h(K))}})})})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};function IQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.generalError)}}function MQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.name)}}function DQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.birthdate)}}function AQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.email)}}function PQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.password)}}function OQ(r,n){r&1&&(B(0,"p"),Q(1,"Start joining events"),U())}var SS=class r{constructor(n,t,l,h){this.fb=n;this.auth=t;this.googleIdentity=l;this.responsive=h;this.form=this.fb.group({name:["",[QP]],birthdate:["",[JP]],email:["",[j_]],password:["",[$_]]})}close=new Zt;switchToSignIn=new Zt;signUpSuccess=new Zt;signInSuccess=new Zt;form;errors={};generalError=null;onSubmit(){this.errors={},this.generalError=null;let n=this.form.controls;if(QP(n.name)&&(this.errors.name="Il nome deve contenere solo lettere."),JP(n.birthdate)&&(this.errors.birthdate="Devi essere maggiore di 18 anni."),j_(n.email)&&(this.errors.email="Email non valida."),$_(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let E={name:this.form.value.name,birthdate:this.form.value.birthdate,email:this.form.value.email,password:this.form.value.password};this.auth.signUp(E).subscribe({next:O=>{if(this.errors={},this.generalError=null,!O?.success){this.generalError=O?.error||"Registrazione non riuscita.";return}this.signUpSuccess.emit({email:this.form.value.email,token:O?.data?.token||""})},error:O=>{if(this.errors={},this.generalError=null,O&&typeof O=="object"&&"error"in O){let N=O.error;if(N&&typeof N=="object"){if(N.data&&typeof N.data=="object"){this.errors=N.data;return}if(N.error&&typeof N.error=="string"){this.generalError=N.error;return}}if(typeof O.error=="string"){this.generalError=O.error;return}}if(typeof O=="string"){this.generalError=O;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",O)}})}hasError(n){return!!this.errors[n]}closePopup(){this.close.emit()}goToSignIn(){this.switchToSignIn.emit()}signUpWithGoogle(){return Ko(this,null,function*(){this.errors={},this.generalError=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:t=>{this.signInSuccess.emit({id:t?.data?.id||"",name:t?.data?.name||"",email:t?.data?.email||""}),this.closePopup()},error:t=>{let l=t?.error;if(l?.data&&typeof l.data=="object"){this.errors=l.data;return}if(typeof l?.error=="string"){this.generalError=l.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}static \u0275fac=function(t){return new(t||r)(Bt(B_),Bt(Du),Bt(H_),Bt(Mu))};static \u0275cmp=In({type:r,selectors:[["SignUpPopup"]],outputs:{close:"close",switchToSignIn:"switchToSignIn",signUpSuccess:"signUpSuccess",signInSuccess:"signInSuccess"},decls:36,vars:27,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close",3,"click","path"],[1,"header","desktop-header"],[1,"error"],[1,"form"],["placeholder","Full name",3,"error","control","type"],["placeholder","Birthday",3,"error","control","type"],["placeholder","Email",3,"error","control","type"],["placeholder","Password",3,"error","control","type","showToggle"],["type","button",1,"button",3,"click"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),Re("click",function(){return l.closePopup()}),U(),B(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Re("click",function(){return l.closePopup()}),Q(5,"arrow_back"),U(),B(6,"h1"),Q(7,"Sign Up"),U()(),B(8,"div",5)(9,"div",6)(10,"CircleIcon",7),Re("click",function(){return l.closePopup()}),U(),B(11,"div",8)(12,"h1"),Q(13,"Join LUMO"),U(),ft(14,IQ,2,1,"p",9)(15,MQ,2,1,"p",9)(16,DQ,2,1,"p",9)(17,AQ,2,1,"p",9)(18,PQ,2,1,"p",9)(19,OQ,2,0,"p"),U(),B(20,"form",10),Mn(21,"FormField",11)(22,"FormField",12)(23,"FormField",13)(24,"FormField",14),B(25,"button",15),Re("click",function(){return l.onSubmit()}),Q(26,"Sign Up"),U()(),B(27,"div",16)(28,"p"),Q(29,"or sign up with"),U(),B(30,"a",17),Re("click",function(){return l.signUpWithGoogle()}),Mn(31,"img",18),U()(),B(32,"p"),Q(33," Already have an account? "),B(34,"span",19),Re("click",function(){return l.goToSignIn()}),Q(35,"Sign In"),U()()()()()()),t&2&&(fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(),fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(9),bt("path","assets/icon/close.svg"),ne(4),mt(l.generalError?14:l.errors.name?15:l.errors.birthdate?16:l.errors.email?17:l.errors.password?18:19),ne(7),bt("error",l.hasError("name"))("control",l.form.get("name"))("type","text"),ne(),bt("error",l.hasError("birthdate"))("control",l.form.get("birthdate"))("type","date"),ne(),bt("error",l.hasError("email"))("control",l.form.get("email"))("type","text"),ne(),bt("error",l.hasError("password"))("control",l.form.get("password"))("type","password")("showToggle",!0))},dependencies:[Aa,Hh,Xi,Zi,Li,Vh,z_,N_],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-backdrop);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:var(--radius-xl);padding:var(--spacing-2xl) 5%;border:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function RQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.generalError)}}function kQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.email)}}function FQ(r,n){if(r&1&&(B(0,"p",9),Q(1),U()),r&2){let t=re();ne(),xt(t.errors.password)}}function LQ(r,n){r&1&&(B(0,"p"),Q(1,"Sign in to LUMO"),U())}var TS=class r{constructor(n,t,l,h,i){this.fb=n;this.auth=t;this.googleIdentity=l;this.router=h;this.responsive=i;this.form=this.fb.group({email:["",[j_]],password:["",[$_]]})}close=new Zt;switchToSignUp=new Zt;signInSuccess=new Zt;form;errors={};generalError=null;closePopup(){this.close.emit()}goToSignUp(){this.switchToSignUp.emit()}onSubmit(){this.errors={},this.generalError=null;let n=this.form.controls;if(j_(n.email)&&(this.errors.email="Email non valida."),$_(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let h={email:this.form.value.email,password:this.form.value.password};this.auth.login(h).subscribe({next:i=>{this.errors={},this.generalError=null,this.signInSuccess.emit({id:i?.data?.id||"",name:i?.data?.name||"",email:i?.data?.email||h.email,profileImage:i?.data?.profileImage}),localStorage.setItem("user",JSON.stringify({id:i?.data?.id||"",name:i?.data?.name||"",email:i?.data?.email||h.email,profileImage:i?.data?.profileImage,isAdmin:i?.data?.isAdmin})),i?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:i=>{if(this.errors={},this.generalError=null,i&&typeof i=="object"&&"error"in i){let E=i.error;if(E&&typeof E=="object"){if(E.data&&typeof E.data=="object"){this.errors=E.data;return}if(E.error&&typeof E.error=="string"){this.generalError=E.error;return}}if(typeof i.error=="string"){this.generalError=i.error;return}}if(typeof i=="string"){this.generalError=i;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",i)}})}signInWithGoogle(){return Ko(this,null,function*(){this.errors={},this.generalError=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:t=>{this.signInSuccess.emit({id:t?.data?.id||"",name:t?.data?.name||"",email:t?.data?.email||"",profileImage:t?.data?.profileImage}),localStorage.setItem("user",JSON.stringify(t.data)),t?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:t=>{let l=t?.error;if(l?.data&&typeof l.data=="object"){this.errors=l.data;return}if(typeof l?.error=="string"){this.generalError=l.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}hasError(n){return!!this.errors[n]}static \u0275fac=function(t){return new(t||r)(Bt(B_),Bt(Du),Bt(H_),Bt(gs),Bt(Mu))};static \u0275cmp=In({type:r,selectors:[["SignInPopup"]],outputs:{close:"close",switchToSignUp:"switchToSignUp",signInSuccess:"signInSuccess"},decls:35,vars:23,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close",3,"click","path"],[1,"header"],[1,"error"],[1,"form"],["placeholder","Email",3,"error","control","type","title"],["placeholder","Password",3,"error","control","type","title","showToggle"],[1,"click-text"],["type","button",1,"button",3,"click"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),Re("click",function(){return l.closePopup()}),U(),B(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Re("click",function(){return l.closePopup()}),Q(5,"arrow_back"),U(),B(6,"h1"),Q(7,"Sign In"),U()(),B(8,"div",5)(9,"div",6)(10,"CircleIcon",7),Re("click",function(){return l.closePopup()}),U(),B(11,"div",8)(12,"h1"),Q(13,"Welcome back!"),U(),ft(14,RQ,2,1,"p",9)(15,kQ,2,1,"p",9)(16,FQ,2,1,"p",9)(17,LQ,2,0,"p"),U(),B(18,"form",10),Mn(19,"FormField",11)(20,"FormField",12),B(21,"p")(22,"span",13),Q(23,"Forgot password?"),U()(),B(24,"button",14),Re("click",function(){return l.onSubmit()}),Q(25,"Sign In"),U()(),B(26,"div",15)(27,"p"),Q(28,"or sign in with"),U(),B(29,"a",16),Re("click",function(){return l.signInWithGoogle()}),Mn(30,"img",17),U()(),B(31,"p"),Q(32," Don\u2019t have an account? "),B(33,"span",18),Re("click",function(){return l.goToSignUp()}),Q(34,"Sign Up"),U()()()()()()),t&2&&(fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(),fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(9),bt("path","assets/icon/close.svg"),ne(4),mt(l.generalError?14:l.errors.email?15:l.errors.password?16:17),ne(5),bt("error",l.hasError("email"))("control",l.form.get("email"))("type","text")("title","Email"),ne(),bt("error",l.hasError("password"))("control",l.form.get("password"))("type","password")("title","Password")("showToggle",!0))},dependencies:[Aa,Hh,Xi,Zi,Li,Vh,z_,N_],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-backdrop);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:var(--radius-xl);padding:var(--spacing-2xl) 5%;border:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{text-align:right;width:100%}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]{gap:var(--spacing-xl)}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function NQ(r,n){r&1&&(B(0,"p",5),Q(1,"You have been successfully registered"),U())}function zQ(r,n){r&1&&(B(0,"p"),Q(1,"Check your email and click the button"),U())}var IS=class r{constructor(n){this.responsive=n}email;token;verified=!1;close=new Zt;resendVerification=new Zt;onClose(){this.close.emit()}resend(){this.resendVerification.emit()}closePopup(){this.close.emit()}static \u0275fac=function(t){return new(t||r)(Bt(Mu))};static \u0275cmp=In({type:r,selectors:[["VerifyEmailPopup"]],inputs:{email:"email",token:"token",verified:"verified"},outputs:{close:"close",resendVerification:"resendVerification"},decls:11,vars:14,consts:[[1,"backdrop"],[1,"popup-container"],[1,"popup-content"],[1,"close",3,"click","path"],[1,"header"],[1,"success"],[1,"button",3,"click"]],template:function(t,l){t&1&&(Mn(0,"div",0),B(1,"div",1)(2,"div",2)(3,"CircleIcon",3),Re("click",function(){return l.closePopup()}),U(),B(4,"div",4)(5,"h1"),Q(6,"Verify your email"),U(),ft(7,NQ,2,0,"p",5)(8,zQ,2,0,"p"),U(),B(9,"a",6),Re("click",function(){return l.resend()}),Q(10,"Resend verification email"),U()()()),t&2&&(fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(),fn("mobile",l.responsive.screen()==="mobile")("tablet",l.responsive.screen()==="tablet")("desktop",l.responsive.screen()==="desktop"),ne(2),bt("path","assets/icon/close.svg"),ne(4),mt(l.verified?7:8))},dependencies:[Aa],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000073;z-index:900}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background-color:var(--color-gray);border-radius:20px;padding:40px;border:2px solid var(--color-dark-gray);display:flex;flex-direction:column;gap:24px}.popup-container.tablet[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:40%;height:auto;background-color:var(--color-gray);border-radius:20px;padding:40px;border:2px solid var(--color-dark-gray);display:flex;flex-direction:column;gap:24px}.backdrop.mobile[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100vw;height:100vh}.popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;background-color:var(--color-gray);display:flex;justify-content:center;align-items:center;flex-direction:column;padding:1.5rem;height:100%;width:100%;border-radius:0;overflow-y:auto;gap:24px}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.error[_ngcontent-%COMP%]{color:var(--color-error)}.success[_ngcontent-%COMP%]{color:#14c972}"]})};var MS=class r{close=new Zt;action=new Zt;onAction(n){this.action.emit(n),this.close.emit()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=In({type:r,selectors:[["UserMenu"]],outputs:{close:"close",action:"action"},decls:20,vars:0,consts:[[1,"menu-backdrop",3,"click"],[1,"menu-container"],[1,"menu-header","mobile-header"],[3,"click"],[1,"menu-item-container"],[1,"menu-item",3,"click"],[1,"icon"],[1,"menu-item","logout",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),Re("click",function(){return l.close.emit()}),U(),B(1,"div",1)(2,"div",2)(3,"mat-icon",3),Re("click",function(){return l.close.emit()}),Q(4,"arrow_back"),U(),B(5,"h1"),Q(6,"Menu"),U()(),B(7,"div",4)(8,"div",5),Re("click",function(){return l.onAction("account")}),B(9,"i",6),Q(10,"\u{1F464}"),U(),Q(11," Account "),U(),B(12,"div",5),Re("click",function(){return l.onAction("my-events")}),B(13,"i",6),Q(14,"\u2795"),U(),Q(15," My events "),U(),B(16,"div",7),Re("click",function(){return l.onAction("logout")}),B(17,"i",6),Q(18,"\u{1F6AA}"),U(),Q(19," Logout "),U()()())},dependencies:[Li,Xi,Zi],styles:["[_nghost-%COMP%]{display:contents}.menu-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent}.menu-container[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 10px);right:0;width:100%;background:var(--color-dark-gray);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:var(--z-dropdown);animation:_ngcontent-%COMP%_menuFadeIn .2s ease-out;transform-origin:top right;overflow:hidden}@keyframes _ngcontent-%COMP%_menuFadeIn{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.menu-item-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-regular);cursor:pointer;width:100%;justify-content:center;transition:all .2s ease;border-bottom:1px solid var(--color-bit-gray)}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;color:var(--color-white)}.menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.menu-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-style:normal;font-size:16px;display:none}.menu-item.logout[_ngcontent-%COMP%]{color:var(--color-error)}.menu-item.logout[_ngcontent-%COMP%]:hover{background:#ff6b6b1a;color:var(--color-error)}.mobile-only[_ngcontent-%COMP%]{display:none!important}@media (max-width: 767px){.menu-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;border-radius:0;z-index:var(--z-popup);padding-top:0;transform-origin:center;background:var(--color-dark-gray);display:flex;flex-direction:column;justify-content:flex-start;align-items:center;background:linear-gradient(160deg,#141414,#0c0c0c);overflow-y:auto}.menu-item[_ngcontent-%COMP%]{width:100%;padding:24px 30px;font-size:28px;border-bottom:1px solid var(--color-bit-gray);justify-content:center}.mobile-only[_ngcontent-%COMP%]{display:flex!important}}"]})};var G_=class r{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/notifications";getNotifications(n){return this.http.get(`${this.apiUrl}?userId=${n}`)}markAsRead(n){return this.http.post(`${this.apiUrl}/${n}/read`,{})}markAllAsRead(n){return this.http.post(`${this.apiUrl}/read-all?userId=${n}`,{})}updateType(n,t){return this.http.post(`${this.apiUrl}/${n}/type?newType=${t}`,{})}deleteNotification(n){return this.http.delete(`${this.apiUrl}/${n}`)}deleteReadNotifications(n){return this.http.delete(`${this.apiUrl}/read?userId=${n}`)}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var BQ=(r,n)=>n.id;function VQ(r,n){r&1&&(B(0,"div",7),Q(1,"No notifications"),U())}function UQ(r,n){if(r&1){let t=It();B(0,"div",16)(1,"div",20),Re("click",function(h){Pe(t);let i=re().$implicit,E=re(2);return Oe(E.acceptRequest(i,h))}),B(2,"mat-icon"),Q(3,"check"),U()(),B(4,"div",21),Re("click",function(h){Pe(t);let i=re().$implicit,E=re(2);return Oe(E.rejectRequest(i,h))}),B(5,"mat-icon"),Q(6,"close"),U()()()}}function jQ(r,n){r&1&&(B(0,"div",17)(1,"mat-icon"),Q(2,"check_circle"),U(),Q(3," Accepted "),U())}function $Q(r,n){r&1&&(B(0,"div",18)(1,"mat-icon"),Q(2,"cancel"),U(),Q(3," Rejected "),U())}function HQ(r,n){if(r&1){let t=It();B(0,"div",22),Re("click",function(h){Pe(t);let i=re().$implicit,E=re(2);return Oe(E.toggleExpand(i.id,h))}),B(1,"mat-icon"),Q(2),U()()}if(r&2){let t=re().$implicit,l=re(2);ne(2),xt(l.expandedId===t.id?"expand_less":"expand_more")}}function GQ(r,n){if(r&1){let t=It();B(0,"div",9),Re("click",function(){let h=Pe(t).$implicit,i=re(2);return Oe(i.onNotificationClick(h))}),B(1,"div",10)(2,"mat-icon"),Q(3),U()(),B(4,"div",11)(5,"div",12)(6,"span",13),Q(7),U(),B(8,"span",14),Q(9),l_(10,"date"),U()(),B(11,"div",15),Q(12),U(),ft(13,UQ,7,0,"div",16),ft(14,jQ,4,0,"div",17),ft(15,$Q,4,0,"div",18),ft(16,HQ,3,1,"div",19),U()()}if(r&2){let t=n.$implicit,l=re(2);fn("unread",!t.isRead),ne(2),Ds("color",l.getIconColor(t.type)),ne(),xt(l.getIcon(t.type)),ne(4),xt(t.title),ne(2),xt(KA(10,14,t.createdAt,"short")),ne(2),fn("expanded",l.expandedId===t.id),ne(),mr(" ",t.message," "),ne(),mt(t.type==="PARTICIPATION_REQUEST"?13:-1),ne(),mt(t.type==="REQUEST_ACCEPTED"?14:-1),ne(),mt(t.type==="REQUEST_REJECTED"?15:-1),ne(),mt(t.message.length>100?16:-1)}}function qQ(r,n){if(r&1&&$i(0,GQ,17,17,"div",8,BQ),r&2){let t=re();Hi(t.notifications)}}var DS=class r{constructor(n,t,l){this.notifService=n;this.eventService=t;this.eRef=l}userId;close=new Zt;openChat=new Zt;notifications=[];expandedId=null;ngOnInit(){this.loadNotifications()}loadNotifications(){this.userId&&this.notifService.getNotifications(this.userId).subscribe(n=>{this.notifications=n.map(t=>this.translateNotification(t))})}translateNotification(n){let t=(n.message||"").match(/["']([^"']+)["']/g)?.map(i=>i.slice(1,-1))||[],l=t.length?t[t.length-1]:"",h=t[0]||"";switch(n.type){case"APPROVED":n.title="Event Approved",l?n.message=`Your event '${l}' has been approved and is now visible!`:n.message="Your event has been approved and is now visible!";break;case"REJECTED":n.title="Event Rejected",l?n.message=`Your event '${l}' has been rejected.`:n.message="Your event has been rejected.";break;case"PARTICIPATION_REQUEST":n.title="Participation Request",t.length>=2?n.message=`User '${h}' wants to join event '${l}'.`:l?n.message=`A user wants to join event '${l}'.`:n.message="A user requested to join your event.";break;case"PARTICIPATION_ACCEPTED":n.title="Request Accepted",n.message="Your request to join the event has been accepted!";break;case"PARTICIPATION_REJECTED":n.title="Request Rejected",n.message="Your request to join the event has been rejected.";break;case"PARTICIPATION_REMOVED":n.title="Removed from Event",l?n.message=`You have been removed from the event '${l}'.`:n.message="You have been removed from the event.";break;case"REQUEST_ACCEPTED":n.title="Request Accepted";break;case"REQUEST_REJECTED":n.title="Request Rejected";break;case"CHAT_MESSAGE":n.title="New chat message";break}return n}toggleExpand(n,t){t.stopPropagation(),this.expandedId=this.expandedId===n?null:n}deleteRead(){this.userId&&this.notifService.deleteReadNotifications(this.userId).subscribe({next:()=>{this.notifications=this.notifications.filter(n=>!n.isRead)},error:n=>console.error("Error deleting read notifications",n)})}acceptRequest(n,t){t.stopPropagation(),console.log("Attempting to accept request:",n),n.relatedEventId&&n.relatedUserId?(console.log("IDs found, calling service..."),this.eventService.acceptParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{console.log("Participation accepted successfully"),this.notifService.updateType(n.id,"REQUEST_ACCEPTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:l=>console.error("Error accepting participation",l)})):console.error("Missing relatedEventId or relatedUserId in notification:",n)}rejectRequest(n,t){t.stopPropagation(),n.relatedEventId&&n.relatedUserId&&this.eventService.rejectParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{this.notifService.updateType(n.id,"REQUEST_REJECTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:l=>console.error("Error rejecting participation",l)})}delete(n,t){n.stopPropagation(),this.notifService.deleteNotification(t.id).subscribe({next:()=>{this.notifications=this.notifications.filter(l=>l.id!==t.id)},error:l=>console.error("Error deleting notification",l)})}onNotificationClick(n){if(n.type==="CHAT_MESSAGE"){if(!n.relatedEventId){console.error("Missing relatedEventId in chat notification:",n);return}this.openChat.emit(n.relatedEventId),this.close.emit()}}getIcon(n){switch(n){case"APPROVED":return"check_circle";case"REJECTED":return"cancel";case"FOLLOWUP":return"event_available";case"PARTICIPATION_REQUEST":return"person_add";case"PARTICIPATION_ACCEPTED":return"how_to_reg";case"PARTICIPATION_REJECTED":return"person_remove";case"PARTICIPATION_REMOVED":return"person_remove";case"REQUEST_ACCEPTED":return"check_circle";case"REQUEST_REJECTED":return"cancel";case"CHAT_MESSAGE":return"chat";case"SUCCESS":return"check_circle";case"ERROR":return"error";case"WARNING":return"warning";default:return"notifications"}}getIconColor(n){switch(n){case"APPROVED":return"var(--color-accent)";case"REJECTED":return"#ff4444";case"FOLLOWUP":return"#4caf50";case"PARTICIPATION_REQUEST":return"#2196f3";case"PARTICIPATION_ACCEPTED":return"#4caf50";case"PARTICIPATION_REJECTED":return"#ff4444";case"PARTICIPATION_REMOVED":return"#ff4444";case"CHAT_MESSAGE":return"var(--color-accent)";default:return"white"}}static \u0275fac=function(t){return new(t||r)(Bt(G_),Bt(js),Bt(ir))};static \u0275cmp=In({type:r,selectors:[["notification-menu"]],inputs:{userId:"userId"},outputs:{close:"close",openChat:"openChat"},decls:14,vars:1,consts:[[1,"notif-container"],[1,"notif-header"],[1,"mobile-only","back-arrow",3,"click"],[1,"title-wrap"],[1,"header-actions"],["title","Delete read notifications",1,"pill-btn",3,"click"],[1,"notif-list"],[1,"empty-state"],[1,"notif-item",3,"unread"],[1,"notif-item",3,"click"],[1,"icon-section"],[1,"content-section"],[1,"notif-top"],[1,"notif-title"],[1,"notif-time"],[1,"notif-msg"],[1,"action-buttons"],[1,"status-msg","success"],[1,"status-msg","error"],[1,"expand-btn"],["title","Accept",1,"btn-approve",3,"click"],["title","Reject",1,"btn-reject",3,"click"],[1,"expand-btn",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1)(2,"mat-icon",2),Re("click",function(){return l.close.emit()}),Q(3,"arrow_back"),U(),B(4,"div",3)(5,"h1"),Q(6,"Notifications"),U()(),B(7,"div",4)(8,"button",5),Re("click",function(){return l.deleteRead()}),B(9,"mat-icon"),Q(10,"delete_sweep"),U()()()(),B(11,"div",6),ft(12,VQ,2,0,"div",7)(13,qQ,2,0),U()()),t&2&&(ne(12),mt(l.notifications.length===0?12:13))},dependencies:[Li,Xi,Zi,b2],styles:[".notif-container[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);border:1px solid rgba(255,255,255,.08);width:340px;border-radius:18px;box-shadow:0 18px 48px #00000073;overflow:hidden;display:flex;flex-direction:column;max-height:460px;color:var(--color-white);font-family:var(--font-stack-headline)}.notif-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;column-gap:12px;height:64px;padding:0 20px;border-bottom:1px solid rgba(255,255,255,.08);background:radial-gradient(circle at 20% 20%,rgba(252,195,36,.1),transparent 38%)}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:var(--font-weight-bold);letter-spacing:.2px;display:flex;padding-bottom:0;align-items:center;height:40px;line-height:1}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex:1;height:40px;color:var(--color-white)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end}.pill-btn[_ngcontent-%COMP%]{width:40px;height:40px;display:grid;place-items:center;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#ffffff0d;color:var(--color-white);cursor:pointer;transition:background .2s,border-color .2s,transform .1s,color .2s}.pill-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fff3;transform:translateY(-1px)}.pill-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.pill-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.notif-list[_ngcontent-%COMP%]{overflow-y:auto;max-height:380px;padding:8px 4px 10px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-dark-gray)}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-bit-gray);border-radius:3px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-light-gray)}.notif-item[_ngcontent-%COMP%]{display:flex;padding:12px 14px;margin:6px 8px;border-radius:14px;border:1px solid rgba(255,255,255,.06);transition:background .2s,border-color .2s,transform .15s;align-items:flex-start;gap:var(--spacing-md);position:relative;background:#ffffff05}.notif-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#ffffff1f;transform:translateY(-1px)}.notif-item.unread[_ngcontent-%COMP%]{background:#fcc32414;border-color:#fcc3243d}.icon-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-top:2px}.content-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-width:0}.notif-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:var(--spacing-xs)}.notif-title[_ngcontent-%COMP%]{font-weight:var(--font-weight-semibold);font-size:14px;color:var(--color-white)}.notif-time[_ngcontent-%COMP%]{font-size:10px;opacity:.6;margin-left:var(--spacing-sm);white-space:nowrap}.notif-msg[_ngcontent-%COMP%]{font-size:13px;opacity:.82;line-height:1.45;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;transition:max-height .3s ease}.notif-msg.expanded[_ngcontent-%COMP%]{-webkit-line-clamp:unset;overflow:visible}.expand-btn[_ngcontent-%COMP%]{cursor:pointer;opacity:.6;transition:opacity .2s;display:flex;align-items:center;justify-content:center}.expand-btn[_ngcontent-%COMP%]:hover{opacity:1}.empty-state[_ngcontent-%COMP%]{padding:28px 18px 34px;text-align:center;opacity:.6;font-style:italic;font-size:13px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);margin-left:auto;align-items:center;padding-left:var(--spacing-sm);margin-top:8px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s,background-color .2s}.btn-approve[_ngcontent-%COMP%]{background-color:#4caf5033;color:#4caf50}.btn-approve[_ngcontent-%COMP%]:hover{background-color:#4caf5066;transform:scale(1.1)}.btn-reject[_ngcontent-%COMP%]{background-color:#f4433633;color:#f44336}.btn-reject[_ngcontent-%COMP%]:hover{background-color:#f4433666;transform:scale(1.1)}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.status-msg[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:12px;font-weight:var(--font-weight-medium);margin-left:auto;padding-left:var(--spacing-sm);white-space:nowrap;margin-top:5px}.status-msg[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.status-msg.success[_ngcontent-%COMP%]{color:#4caf50}.status-msg.error[_ngcontent-%COMP%]{color:#f44336}@media (max-width: 768px){.notif-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;max-height:none;border-radius:0;z-index:100001;background-color:var(--color-dark-gray)}.notif-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:1px solid rgba(255,255,255,.1)}.title-wrap[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.header-actions[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:flex;align-items:center;height:100%;top:0}.notif-list[_ngcontent-%COMP%]{max-height:none;flex:1;padding-bottom:20px}.notif-item[_ngcontent-%COMP%]{padding:var(--spacing-lg)}.notif-title[_ngcontent-%COMP%]{font-size:18px}.notif-msg[_ngcontent-%COMP%]{font-size:16px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:44px;height:44px}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}}"]})};var AS=class r{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";moderationUrl="http://localhost:8080/api/moderation";getMessages(n,t,l=100){let h=new URLSearchParams;return t!=null&&h.set("userId",String(t)),h.set("limit",String(l)),this.http.get(`${this.baseUrl}/${n}/chat/messages?${h.toString()}`)}sendMessage(n,t,l){return this.http.post(`${this.baseUrl}/${n}/chat/messages?userId=${t}`,{content:l})}connect(n,t,l){let h=new EventSource(`${this.baseUrl}/${n}/chat/stream?userId=${t}`),i=E=>O=>{l(E,JSON.parse(O.data))};return h.addEventListener("message",i("message")),h.addEventListener("poll",i("poll")),h.addEventListener("poll-vote",i("poll-vote")),h.addEventListener("poll-close",i("poll-close")),h.addEventListener("mute",i("mute")),h}getMuteStatus(n,t){return this.http.get(`${this.baseUrl}/${n}/chat/mute-status?userId=${t}`)}getMutes(n,t){return this.http.get(`${this.baseUrl}/${n}/chat/mutes?userId=${t}`)}muteUser(n,t,l,h){return this.http.post(`${this.baseUrl}/${n}/chat/mutes?userId=${t}`,{targetUserId:l,reason:h})}unmuteUser(n,t,l){return this.http.delete(`${this.baseUrl}/${n}/chat/mutes/${l}?userId=${t}`)}getPolls(n,t){return this.http.get(`${this.baseUrl}/${n}/chat/polls?userId=${t}`)}createPoll(n,t,l,h,i){return this.http.post(`${this.baseUrl}/${n}/chat/polls/open?userId=${t}`,{question:l,options:h,endsAt:i})}votePoll(n,t,l,h){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${t}/votes?userId=${l}`,{optionIds:h})}closePoll(n,t,l){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${t}/close?userId=${l}`,{})}getBannedWords(){return this.http.get(`${this.moderationUrl}/banned-words`)}checkMessage(n){return this.http.post(`${this.moderationUrl}/check`,{content:n})}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var ZQ=["messagesContainer"];function XQ(r,n){if(r&1){let t=It();B(0,"button",30),Re("click",function(h){Pe(t);let i=re(2);return i.togglePin(i.pinnedItem,i.pinnedType),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2,"close"),U()()}}function YQ(r,n){if(r&1){let t=It();B(0,"div",24),Re("click",function(){Pe(t);let h=re();return Oe(h.scrollToItem(h.pinnedId,h.pinnedType))}),B(1,"mat-icon",25),Q(2,"push_pin"),U(),B(3,"div",26)(4,"span",27),Q(5),U(),B(6,"span",28),Q(7),U()(),Ui(8,XQ,3,0,"button",29),U()}if(r&2){let t=re();ne(5),xt(t.getPinnedSenderName()),ne(2),xt(t.getPinnedDisplayText()),ne(),bt("ngIf",t.isOrganizer)}}function KQ(r,n){if(r&1&&(B(0,"a",35),Q(1,"Open link"),U()),r&2){let t=re().$implicit;bt("href",t.link,Gr)}}function QQ(r,n){if(r&1&&(B(0,"div",31)(1,"div",32),Q(2),U(),B(3,"div",33),Q(4),U(),Ui(5,KQ,2,1,"a",34),U()),r&2){let t=n.$implicit;$o("id",t.anchorId),ne(2),xt(t.label),ne(2),xt(t.content),ne(),bt("ngIf",t.link)}}function JQ(r,n){if(r&1&&Mn(0,"img",49),r&2){let t=re(2).$implicit;bt("src",t.message.senderImage,Gr)}}function eJ(r,n){if(r&1&&(B(0,"div",50),Q(1),U()),r&2){let t=re(2).$implicit;ne(),mr(" ",t.message.senderName.slice(0,1)||"?"," ")}}function tJ(r,n){if(r&1){let t=It();B(0,"div",51),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())}),B(1,"button",52),Re("click",function(h){Pe(t);let i=re(2).$implicit,E=re();return Oe(E.togglePinFromMenu(i.message,"message",h))}),B(2,"mat-icon"),Q(3,"push_pin"),U()()()}if(r&2){let t=re(2).$implicit,l=re();ne(),fn("active",l.isPinned(t.message.id,"message"))("unpin",l.isPinned(t.message.id,"message")),$o("aria-label",l.isPinned(t.message.id,"message")?"Unpin":"Pin message")}}function nJ(r,n){if(r&1){let t=It();B(0,"div",39),Re("click",function(h){Pe(t);let i=re().$implicit,E=re();return Oe(E.openPinMenu(i.message,"message",h))}),B(1,"div",40),Ui(2,JQ,1,1,"img",41)(3,eJ,2,1,"div",42),U(),B(4,"div",43)(5,"div",44)(6,"span",45),Q(7),U(),B(8,"span",46),Q(9),U(),ft(10,tJ,4,5,"div",47),U(),B(11,"div",48),Q(12),U()()()}if(r&2){let t=re().$implicit,l=re();fn("mine",l.currentUserId&&t.message.senderId.toString()===l.currentUserId)("pin-enabled",l.isOrganizer),$o("id",l.getItemAnchorId(t.message.id,"message")),ne(2),bt("ngIf",t.message.senderImage),ne(),bt("ngIf",!t.message.senderImage),ne(4),xt(t.message.senderName),ne(2),xt(l.formatTimestamp(t.message.createdAt)),ne(),mt(l.isOrganizer&&l.activePinId===t.message.id&&l.activePinType==="message"?10:-1),ne(2),xt(t.message.content)}}function iJ(r,n){if(r&1){let t=It();B(0,"div",51),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())}),B(1,"button",52),Re("click",function(h){Pe(t);let i=re(2).$implicit,E=re();return Oe(E.togglePinFromMenu(i.poll,"poll",h))}),B(2,"mat-icon"),Q(3,"push_pin"),U()()()}if(r&2){let t=re(2).$implicit,l=re();ne(),fn("active",l.isPinned(t.poll.id,"poll"))("unpin",l.isPinned(t.poll.id,"poll")),$o("aria-label",l.isPinned(t.poll.id,"poll")?"Unpin":"Pin poll")}}function rJ(r,n){if(r&1){let t=It();B(0,"div",63),Re("click",function(){let h=Pe(t).$implicit,i=re(2).$implicit,E=re();return Oe(E.toggleVote(i.poll,h.id))}),B(1,"div",64)(2,"span"),Q(3),U(),B(4,"span",65),Q(5),U()(),B(6,"div",66),Mn(7,"div",67),U()()}if(r&2){let t=n.$implicit,l=re(2).$implicit,h=re();fn("selected",h.pollSelections[l.poll.id]==null?null:h.pollSelections[l.poll.id].has(t.id))("closed",l.poll.closed),ne(3),xt(t.text),ne(2),xt(h.getPollOptionCount(t)),ne(2),Ds("width",h.getPollBarWidth(l.poll,t))}}function oJ(r,n){if(r&1){let t=It();B(0,"button",68),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re();return Oe(i.closePoll(h.poll))}),Q(1," Chiudi sondaggio "),U()}if(r&2){let t=re(2).$implicit;bt("disabled",t.poll.closed)}}function sJ(r,n){if(r&1){let t=It();B(0,"div",53),Re("click",function(h){Pe(t);let i=re().$implicit,E=re();return Oe(E.openPinMenu(i.poll,"poll",h))}),B(1,"div",54)(2,"div",55)(3,"span",56),Q(4,"Sondaggio"),U(),B(5,"span",46),Q(6),U()(),ft(7,iJ,4,5,"div",47),U(),B(8,"div",57),Q(9),U(),B(10,"div",58),Ui(11,rJ,8,8,"div",59),U(),B(12,"div",60),Ui(13,oJ,2,1,"button",61),U(),B(14,"div",62),Q(15),U()()}if(r&2){let t=re().$implicit,l=re();fn("pin-enabled",l.isOrganizer),$o("id",l.getItemAnchorId(t.poll.id,"poll")),ne(6),xt(l.formatTimestamp(t.poll.createdAt)),ne(),mt(l.isOrganizer&&l.activePinId===t.poll.id&&l.activePinType==="poll"?7:-1),ne(2),xt(t.poll.question),ne(2),bt("ngForOf",t.poll.options),ne(2),bt("ngIf",l.isOrganizer),ne(2),mr("Totale voti: ",l.getPollTotalVotes(t.poll))}}function aJ(r,n){if(r&1&&(B(0,"div",36),ft(1,nJ,13,11,"div",37),ft(2,sJ,16,9,"div",38),U()),r&2){let t=n.$implicit;ne(),mt(t.type==="message"&&t.message?1:-1),ne(),mt(t.type==="poll"&&t.poll?2:-1)}}function lJ(r,n){r&1&&(B(0,"div",69),Q(1," Nessun messaggio ancora. "),U())}function cJ(r,n){r&1&&(B(0,"div",70),Q(1," Sei stato mutato: puoi leggere ma non inviare messaggi. "),U())}function uJ(r,n){if(r&1){let t=It();B(0,"button",71),Re("click",function(){Pe(t);let h=re();return Oe(h.openPollPopup())}),B(1,"mat-icon"),Q(2,"add"),U()()}if(r&2){let t=re();bt("disabled",t.isMuted)}}function dJ(r,n){if(r&1&&(B(0,"div",72),Q(1),U()),r&2){let t=re();ne(),xt(t.messageError)}}function hJ(r,n){if(r&1){let t=It();B(0,"button",87),Re("click",function(){Pe(t);let h=re().index,i=re(2);return Oe(i.removePollOption(h))}),B(1,"mat-icon"),Q(2,"remove_circle_outline"),U()()}}function pJ(r,n){if(r&1){let t=It();B(0,"div",84)(1,"input",85),Ro("ngModelChange",function(h){let i=Pe(t).index,E=re(2);return Ho(E.pollOptions[i],h)||(E.pollOptions[i]=h),Oe(h)}),U(),Ui(2,hJ,3,0,"button",86),U()}if(r&2){let t=n.index,l=re(2);ne(),Oo("ngModel",l.pollOptions[t]),bt("placeholder","Opzione "+(t+1)),ne(),bt("ngIf",l.pollOptions.length>2)}}function fJ(r,n){if(r&1&&(B(0,"div",88),Q(1),U()),r&2){let t=re(2);ne(),xt(t.pollError)}}function mJ(r,n){if(r&1){let t=It();B(0,"div",73),Re("click",function(){Pe(t);let h=re();return Oe(h.closePollPopup())}),B(1,"div",74),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())}),B(2,"div",75)(3,"span"),Q(4,"Crea sondaggio"),U(),B(5,"button",76),Re("click",function(){Pe(t);let h=re();return Oe(h.closePollPopup())}),B(6,"mat-icon"),Q(7,"close"),U()()(),B(8,"div",77)(9,"input",78),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.pollQuestion,h)||(i.pollQuestion=h),Oe(h)}),U(),B(10,"div",79),Ui(11,pJ,3,3,"div",80),U(),B(12,"button",81),Re("click",function(){Pe(t);let h=re();return Oe(h.addPollOption())}),B(13,"mat-icon"),Q(14,"add"),U(),Q(15," Aggiungi opzione "),U(),Ui(16,fJ,2,1,"div",82),B(17,"button",83),Re("click",function(){Pe(t);let h=re();return Oe(h.createPoll())}),Q(18,"Crea sondaggio"),U()()()()}if(r&2){let t=re();ne(9),Oo("ngModel",t.pollQuestion),ne(2),bt("ngForOf",t.pollOptions)("ngForTrackBy",t.trackByIndex),ne(5),bt("ngIf",t.pollError)}}var q_=class r{constructor(n){this.chatService=n}event;currentUserId=null;close=new Zt;messagesContainer;messages=[];polls=[];mutes=[];mutedUserIds=new Set;isMuted=!1;isOrganizer=!1;messageText="";pollQuestion="";pollOptions=["","",""];pollSelections={};pollError="";showPollPopup=!1;pinnedId=null;pinnedType=null;pinnedItem=null;activePinId=null;activePinType=null;bannedPatterns=[];bannedRaw=[];messageError="";timelineItems=[];infoMessages=[];eventSource=null;ngOnInit(){this.initializeChat()}ngOnChanges(n){(n.event||n.currentUserId)&&this.initializeChat()}ngOnDestroy(){this.persistMessages(),this.eventSource?.close()}onClose(){this.close.emit()}openPollPopup(){this.pollQuestion="",this.pollOptions=["","",""],this.pollError="",this.showPollPopup=!0}closePollPopup(){this.showPollPopup=!1,this.pollError=""}addPollOption(){this.pollOptions.push("")}removePollOption(n){this.pollOptions.length>2&&this.pollOptions.splice(n,1)}trackByIndex(n,t){return n}sendMessage(){if(!this.currentUserId||!this.messageText.trim())return;let n=this.messageText.trim();if(this.messageText="",this.isBannedMessage(n)){this.messageError="Messaggio non consentito.";return}this.messageError="",this.chatService.checkMessage(n).subscribe({next:t=>{if(t?.banned){this.messageError="Messaggio non consentito.";return}this.chatService.sendMessage(this.event.id,this.currentUserId,n).subscribe({next:l=>{this.addMessage(l)},error:l=>{let h=l?.error?.data?.content||l?.error?.error;h&&(this.messageError=h),console.error("Error sending message",l)}})},error:t=>{this.messageError="Messaggio non consentito.",console.error("Error checking message",t)}})}createPoll(){if(!this.currentUserId||!this.pollQuestion.trim())return;let n=this.pollOptions.map(l=>l.trim()).filter(Boolean);if(n.length<2){this.pollError="Inserisci almeno due opzioni.";return}let t=new Date(Date.now()+1e3*60*60*24*365*10).toISOString();this.chatService.createPoll(this.event.id,this.currentUserId,this.pollQuestion.trim(),n,t).subscribe({next:l=>{this.upsertPoll(l),this.pollQuestion="",this.pollOptions=["","",""],this.showPollPopup=!1,this.pollError="",this.loadPolls()},error:l=>{console.error("Error creating poll",l),this.pollError="Errore nella creazione del sondaggio."}})}toggleVote(n,t){!this.currentUserId||n.closed||this.chatService.votePoll(this.event.id,n.id,this.currentUserId,[t]).subscribe({next:l=>this.upsertPoll(l),error:l=>console.error("Error voting poll",l)})}closePoll(n){this.currentUserId&&this.chatService.closePoll(this.event.id,n.id,this.currentUserId).subscribe({next:t=>this.upsertPoll(t),error:t=>console.error("Error closing poll",t)})}muteUser(n){this.currentUserId&&this.chatService.muteUser(this.event.id,this.currentUserId,n.id).subscribe({next:t=>{this.mutes=[...this.mutes.filter(l=>l.userId!==t.userId),t],this.mutedUserIds.add(t.userId)},error:t=>console.error("Error muting user",t)})}unmuteUser(n){this.currentUserId&&this.chatService.unmuteUser(this.event.id,this.currentUserId,n.id).subscribe({next:()=>{this.mutes=this.mutes.filter(t=>t.userId!==n.id),this.mutedUserIds.delete(n.id)},error:t=>console.error("Error unmuting user",t)})}isUserMuted(n){return this.mutedUserIds.has(n)}getParticipants(){return this.event.acceptedUsersList||[]}formatTimestamp(n){return n?new Date(n).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):""}formatDateTime(n){return n?new Date(n).toLocaleString("it-IT",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):""}getOptionVoters(n){return!n.voters||n.voters.length===0?"":n.voters.map(t=>t.userName).join(", ")}rebuildTimelineItems(){let n=[];this.messages.forEach(t=>n.push({type:"message",createdAt:t.createdAt,message:t})),this.polls.forEach(t=>n.push({type:"poll",createdAt:t.createdAt,poll:t})),this.timelineItems=n.sort((t,l)=>new Date(t.createdAt).getTime()-new Date(l.createdAt).getTime())}getPollTotalVotes(n){return n.options.reduce((t,l)=>t+(l.voters?.length||0),0)}getPollOptionCount(n){return n.voters?.length||0}getPollBarWidth(n,t){let l=this.getPollTotalVotes(n);if(!l)return"0%";let h=this.getPollOptionCount(t);return`${Math.round(h/l*100)}%`}getPinnedSenderName(){return this.pinnedItem?this.pinnedType==="poll"?"Sondaggio":this.pinnedItem.senderName||"Utente":""}getPinnedDisplayText(){return this.pinnedItem?this.pinnedType==="poll"?this.pinnedItem.question:this.pinnedItem.content:""}isPinned(n,t){return this.pinnedId===n&&this.pinnedType===t}openPinMenu(n,t,l){this.isOrganizer&&(l.stopPropagation(),this.activePinId=n.id,this.activePinType=t)}closePinMenu(){this.activePinId=null,this.activePinType=null}togglePinFromMenu(n,t,l){l.stopPropagation(),this.togglePin(n,t),this.activePinId=null,this.activePinType=null}togglePin(n,t){this.pinnedId===n.id&&this.pinnedType===t?(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null):(this.pinnedId=n.id,this.pinnedType=t,this.pinnedItem=n),this.persistPinnedItem()}scrollToItem(n,t){this.scrollToAnchor(this.getItemAnchorId(n,t))}scrollToAnchor(n){let t=this.messagesContainer?.nativeElement;if(!t)return;let l=t.querySelector(`#${n}`);if(!l)return;let h=t.getBoundingClientRect().top,i=l.getBoundingClientRect().top;t.scrollTo({top:t.scrollTop+i-h-12,behavior:"smooth"})}getItemAnchorId(n,t){return`chat-${t}-${n}`}getMessageAnchorId(n){return this.getItemAnchorId(n,"message")}loadBannedWords(){this.chatService.getBannedWords().subscribe({next:n=>this.buildBannedPatterns(n),error:n=>console.error("Error loading banned words",n)})}loadData(){this.currentUserId&&(this.chatService.getMessages(this.event.id).subscribe({next:n=>{n.length===0&&this.messages.length>0||(this.messages=n,this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())},error:n=>console.error("Error loading messages",n)}),this.loadPolls(),this.chatService.getMuteStatus(this.event.id,this.currentUserId).subscribe({next:n=>this.isMuted=n.muted,error:n=>console.error("Error loading mute status",n)}),this.isOrganizer&&this.chatService.getMutes(this.event.id,this.currentUserId).subscribe({next:n=>{this.mutes=n,this.mutedUserIds=new Set(n.map(t=>t.userId))},error:n=>console.error("Error loading mutes",n)}))}connectStream(){this.currentUserId&&(this.eventSource?.close(),this.eventSource=this.chatService.connect(this.event.id,this.currentUserId,(n,t)=>{if(n==="message"&&this.addMessage(t),(n==="poll"||n==="poll-vote"||n==="poll-close")&&this.upsertPoll(t),n==="mute"){let l=t;l.muted?this.mutedUserIds.add(l.userId):this.mutedUserIds.delete(l.userId),this.currentUserId&&Number(this.currentUserId)===l.userId&&(this.isMuted=l.muted)}}))}loadPolls(){this.currentUserId&&this.chatService.getPolls(this.event.id,this.currentUserId).subscribe({next:n=>{this.polls=n,n.forEach(t=>this.syncPollSelections(t)),this.rebuildTimelineItems(),this.scrollToBottom()},error:n=>console.error("Error loading polls",n)})}toIsoLocal(n){if(!n)return null;if(n.includes("T"))return n;let l=n.trim().match(/^(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})$/);if(!l)return null;let[,h,i,E,O,N]=l;return`${E}-${i}-${h}T${O}:${N}`}upsertPoll(n){let t=this.polls.findIndex(h=>h.id===n.id),l=t<0;if(l)this.polls=[n,...this.polls];else{let h=[...this.polls];h[t]=n,this.polls=h}this.syncPollSelections(n),this.rebuildTimelineItems(),l&&this.scrollToBottom()}syncPollSelections(n){if(!this.currentUserId)return;let t=new Set;n.options.forEach(l=>{l.voters?.some(i=>i.userId===Number(this.currentUserId))&&t.add(l.id)}),this.pollSelections[n.id]=t}addMessage(n){this.messages.some(t=>t.id===n.id)||(this.messages=[...this.messages,n],this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())}initializeChat(){this.event&&(this.messages=this.getCachedMessages(),this.loadPinnedItem(),this.buildInfoMessages(),this.rebuildTimelineItems(),this.activePinId=null,this.activePinType=null,this.loadBannedWords(),this.currentUserId&&(this.isOrganizer=this.event.creatorId?.toString()===this.currentUserId,this.loadData(),this.connectStream()))}getCacheKeys(){if(!this.event?.id)return[];let n=[`chat-cache:${this.event.id}`];return this.currentUserId&&n.push(`chat-cache:${this.event.id}:${this.currentUserId}`),n}getCachedMessages(){let n=this.getCacheKeys();if(n.length===0)return[];let t=new Map;for(let l of n){let h=localStorage.getItem(l);if(h)try{let i=JSON.parse(h);if(!Array.isArray(i))continue;i.forEach(E=>{E&&typeof E.id=="number"&&t.set(E.id,E)})}catch{continue}}return Array.from(t.values()).sort((l,h)=>new Date(l.createdAt).getTime()-new Date(h.createdAt).getTime())}persistMessages(){let n=this.getCacheKeys();if(n.length===0)return;let t=JSON.stringify(this.messages);n.forEach(l=>localStorage.setItem(l,t))}pinnedStorageKey(){return this.event?.id?`chat-pins:${this.event.id}`:null}loadPinnedItem(){let n=this.pinnedStorageKey();if(!n)return;let t=localStorage.getItem(n);if(!t){this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null;return}try{let l=JSON.parse(t);l&&typeof l.id=="number"?(this.pinnedId=l.id,this.pinnedType=l.type,this.refreshPinnedItem()):(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null)}catch{this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null}}persistPinnedItem(){let n=this.pinnedStorageKey();n&&(this.pinnedId!==null&&this.pinnedType!==null?localStorage.setItem(n,JSON.stringify({id:this.pinnedId,type:this.pinnedType})):localStorage.removeItem(n))}refreshPinnedItem(){if(this.pinnedId===null||this.pinnedType===null){this.pinnedItem=null;return}this.pinnedType==="message"?this.pinnedItem=this.messages.find(n=>n.id===this.pinnedId)||null:this.pinnedItem=this.polls.find(n=>n.id===this.pinnedId)||null}buildInfoMessages(){let n=[],t=this.formatEventTime();t&&n.push({key:"time",label:"Time",content:t,anchorId:"chat-info-time"});let l=this.formatEventPlace();l&&n.push({key:"place",label:"Location",content:l,anchorId:"chat-info-place"});let h=this.getMapLink();h&&n.push({key:"link",label:"Map Link",content:h,anchorId:"chat-info-link",link:h}),this.infoMessages=n}formatEventTime(){if(!this.event)return"";let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,t=this.event.startTime?this.event.startTime.slice(0,5):"",l=this.event.endTime?this.event.endTime.slice(0,5):"",h=n?n.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"short"}):"",i=[t,l].filter(Boolean).join(" - ");return[h,i].filter(Boolean).join(" ")}formatEventPlace(){return this.event?this.event.city?this.event.city:Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`${this.event.latitude.toFixed(5)}, ${this.event.longitude.toFixed(5)}`:"":""}getMapLink(){return this.event?Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`:this.event.city?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.event.city)}`:"":""}scrollToBottom(){requestAnimationFrame(()=>{this.doScrollToBottom(),setTimeout(()=>this.doScrollToBottom(),50),setTimeout(()=>this.doScrollToBottom(),150)})}doScrollToBottom(){let n=this.messagesContainer?.nativeElement;n&&(n.scrollTop=n.scrollHeight)}buildBannedPatterns(n){this.bannedPatterns=[],this.bannedRaw=[],Array.isArray(n)&&n.forEach(t=>{let l=this.normalizeContent(t);if(!l){t&&this.bannedRaw.push(t);return}this.bannedPatterns.push(this.buildPhrasePattern(l))})}isBannedMessage(n){if(!n)return!1;for(let l of this.bannedRaw)if(l&&n.includes(l))return!0;let t=this.normalizeContent(n);return t?this.bannedPatterns.some(l=>l.test(t)):!1}normalizeContent(n){if(!n)return"";let t=n.toLowerCase();return this.replaceLeet(t).normalize("NFD").replace(/[\u0300-\u036f]+/g,"").replace(/[^a-z0-9]+/g," ").trim().replace(/\s+/g," ")}replaceLeet(n){let t={"@":"a",0:"o",1:"i","!":"i",3:"e",4:"a",5:"s",$:"s",7:"t",8:"b"};return n.split("").map(l=>t[l]??l).join("")}buildPhrasePattern(n){let h=n.split(/\s+/).filter(Boolean).map(i=>this.buildTokenPattern(i)).join("\\s+");return new RegExp(`(?:^|\\s)${h}(?:\\s|$)`)}buildTokenPattern(n){return n.split("").map(t=>this.escapeRegex(t)).join("\\s*")}escapeRegex(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static \u0275fac=function(t){return new(t||r)(Bt(AS))};static \u0275cmp=In({type:r,selectors:[["event-chat-modal"]],viewQuery:function(t,l){if(t&1&&Sa(ZQ,5),t&2){let h;aa(h=la())&&(l.messagesContainer=h.first)}},inputs:{event:"event",currentUserId:"currentUserId"},outputs:{close:"close"},features:[Vr],decls:32,vars:12,consts:[["messagesContainer",""],[1,"chat-backdrop",3,"click"],[1,"chat-container",3,"click"],[1,"chat-header"],[1,"header-left"],["aria-label","Back",1,"icon-btn","back-btn","mobile-only",3,"click"],[1,"header-text"],[1,"title"],[1,"subtitle"],["aria-label","Close chat",1,"icon-btn","close-btn",3,"click"],[1,"chat-body"],[1,"chat-left"],[1,"pinned-bar"],[1,"messages",3,"click"],["class","info-message",4,"ngFor","ngForOf"],["class","timeline-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","mute-banner",4,"ngIf"],[1,"message-input"],["placeholder","Scrivi un messaggio...",3,"ngModelChange","input","keydown.enter","ngModel","disabled"],["class","add-btn",3,"disabled","click",4,"ngIf"],[1,"send-btn",3,"click","disabled"],["class","message-error",4,"ngIf"],[1,"poll-popup-backdrop"],[1,"pinned-bar",3,"click"],[1,"pin-icon"],[1,"pinned-content"],[1,"pinned-sender"],[1,"pinned-text"],["class","unpin-btn",3,"click",4,"ngIf"],[1,"unpin-btn",3,"click"],[1,"info-message"],[1,"info-label"],[1,"info-content"],["class","info-link","target","_blank","rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",1,"info-link",3,"href"],[1,"timeline-item"],[1,"message",3,"mine","pin-enabled"],[1,"poll-message-card",3,"pin-enabled"],[1,"message",3,"click"],[1,"avatar"],["alt","Avatar",3,"src",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"content"],[1,"meta"],[1,"name"],[1,"time"],[1,"pin-menu"],[1,"text"],["alt","Avatar",3,"src"],[1,"placeholder"],[1,"pin-menu",3,"click"],["type","button",1,"pin-menu-btn",3,"click"],[1,"poll-message-card",3,"click"],[1,"poll-message-header"],[1,"header-main"],[1,"poll-tag"],[1,"poll-message-question"],[1,"poll-bars"],["class","poll-bar-row",3,"selected","closed","click",4,"ngFor","ngForOf"],[1,"poll-actions"],["class","pill ghost",3,"disabled","click",4,"ngIf"],[1,"poll-total"],[1,"poll-bar-row",3,"click"],[1,"poll-bar-label"],[1,"poll-bar-count"],[1,"poll-bar-track"],[1,"poll-bar-fill"],[1,"pill","ghost",3,"click","disabled"],[1,"empty-state"],[1,"mute-banner"],[1,"add-btn",3,"click","disabled"],[1,"message-error"],[1,"poll-popup-backdrop",3,"click"],[1,"poll-popup",3,"click"],[1,"poll-popup-header"],[1,"icon-btn",3,"click"],[1,"poll-create"],["placeholder","Domanda del sondaggio",1,"poll-question-input",3,"ngModelChange","ngModel"],[1,"poll-options-list"],["class","poll-option-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"add-option-pill",3,"click"],["class","poll-error",4,"ngIf"],[1,"pill","create-poll-btn",3,"click"],[1,"poll-option-row"],[3,"ngModelChange","ngModel","placeholder"],["class","remove-option-btn",3,"click",4,"ngIf"],[1,"remove-option-btn",3,"click"],[1,"poll-error"]],template:function(t,l){if(t&1){let h=It();B(0,"div",1),Re("click",function(){return Pe(h),Oe(l.onClose())}),B(1,"div",2),Re("click",function(E){return Pe(h),Oe(E.stopPropagation())}),B(2,"div",3)(3,"div",4)(4,"button",5),Re("click",function(){return Pe(h),Oe(l.onClose())}),B(5,"mat-icon"),Q(6,"arrow_back"),U()(),B(7,"div",6)(8,"span",7),Q(9,"Event Chat"),U(),B(10,"span",8),Q(11),U()()(),B(12,"button",9),Re("click",function(){return Pe(h),Oe(l.onClose())}),B(13,"mat-icon"),Q(14,"close"),U()()(),B(15,"div",10)(16,"div",11),ft(17,YQ,9,3,"div",12),B(18,"div",13,0),Re("click",function(){return Pe(h),Oe(l.closePinMenu())}),Ui(20,QQ,6,4,"div",14)(21,aJ,3,2,"div",15)(22,lJ,2,0,"div",16),U(),Ui(23,cJ,2,0,"div",17),B(24,"div",18)(25,"input",19),Ro("ngModelChange",function(E){return Pe(h),Ho(l.messageText,E)||(l.messageText=E),Oe(E)}),Re("input",function(){return Pe(h),Oe(l.messageError="")})("keydown.enter",function(){return Pe(h),Oe(l.sendMessage())}),U(),Ui(26,uJ,3,1,"button",20),B(27,"button",21),Re("click",function(){return Pe(h),Oe(l.sendMessage())}),B(28,"mat-icon"),Q(29,"send"),U()()(),Ui(30,dJ,2,1,"div",22),U()(),ft(31,mJ,19,4,"div",23),U()()}t&2&&(ne(11),xt(l.event.title),ne(6),mt(l.pinnedItem?17:-1),ne(3),bt("ngForOf",l.infoMessages),ne(),bt("ngForOf",l.timelineItems),ne(),bt("ngIf",l.timelineItems.length===0),ne(),bt("ngIf",l.isMuted),ne(2),Oo("ngModel",l.messageText),bt("disabled",l.isMuted),ne(),bt("ngIf",l.currentUserId),ne(),bt("disabled",l.isMuted||!l.messageText.trim()),ne(3),bt("ngIf",l.messageError),ne(),mt(l.showPollPopup?31:-1))},dependencies:[Li,u_,Ps,Nl,Us,Da,nl,Xi,Zi],styles:['.chat-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#060608b8;display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.chat-container[_ngcontent-%COMP%]{width:min(760px,96vw);max-height:90vh;background:radial-gradient(circle at 15% 20%,rgba(252,195,36,.18),transparent 40%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:20px;box-shadow:0 24px 60px #0000008c;display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(255,255,255,.08);color:#f5f5f5}@media (max-width: 640px){.chat-backdrop[_ngcontent-%COMP%]{padding:0}.chat-container[_ngcontent-%COMP%]{width:100vw;height:100vh;max-height:100vh;border-radius:0}.mobile-only[_ngcontent-%COMP%]{display:inline-flex}.close-btn[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{color:var(--color-accent)}}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid rgba(255,255,255,.08)}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.header-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.title[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#facc15}.subtitle[_ngcontent-%COMP%]{color:#bdbdbd;font-size:14px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;color:#f0f0f0;width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.12);display:grid;place-items:center;transition:background-color .15s ease,border-color .15s ease}.icon-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#fff3}.chat-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:16px;padding:16px;overflow:hidden}.chat-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;min-height:0}.pinned-toggle[_ngcontent-%COMP%]{width:100%;background:#ffffff0a;border:1px solid rgba(255,255,255,.1);color:#f3f3f3;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;cursor:pointer;border-radius:12px}.pinned-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:14px}.pinned-toggle[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:transform .2s ease}.pinned-toggle[_ngcontent-%COMP%]   .chevron.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.pinned-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:#fcc3241f;border:1px solid rgba(252,195,36,.25);border-radius:12px;padding:10px 12px;cursor:pointer;transition:background-color .15s ease}.pinned-bar[_ngcontent-%COMP%]:hover{background:#fcc3242e}.pinned-bar[_ngcontent-%COMP%]   .pin-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:20px;flex-shrink:0}.pinned-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1;min-width:0}.pinned-sender[_ngcontent-%COMP%]{font-size:12px;font-weight:700;color:var(--color-accent)}.pinned-text[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.unpin-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#888;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .15s ease,color .15s ease}.unpin-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.unpin-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.pinned-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:8px;margin-bottom:4px}.pinned-item[_ngcontent-%COMP%]{background:#ffffff0a;border:1px solid rgba(255,255,255,.08);color:#f0f0f0;border-radius:12px;padding:8px 10px;display:flex;flex-direction:column;gap:2px;text-align:left;cursor:pointer}.pinned-item[_ngcontent-%COMP%]:hover{border-color:#fff3;background:#ffffff14}.pin-label[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.2px;text-transform:uppercase;color:var(--color-accent)}.pin-preview[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.messages[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:16px;overflow-y:auto;scroll-behavior:smooth;flex:1;border:1px solid rgba(255,255,255,.06);scrollbar-width:none;-ms-overflow-style:none}.messages[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.timeline-item[_ngcontent-%COMP%]{margin-bottom:14px}.message[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:14px;align-items:flex-start;position:relative}.message.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.message.mine[_ngcontent-%COMP%]{flex-direction:row-reverse}.message.mine[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.message.mine[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{justify-content:flex-end}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{text-align:right}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .avatar[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ffffff1a;font-weight:600;pointer-events:none}.content[_ngcontent-%COMP%]{flex:1;max-width:70%;position:relative}.meta[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:12px;color:#9a9a9a;margin-bottom:4px;align-items:center}.name[_ngcontent-%COMP%]{font-weight:600;color:#f2f2f2}.text[_ngcontent-%COMP%]{background:#ffffff14;border-radius:12px;padding:10px 12px;box-shadow:0 8px 20px #00000040;border:1px solid rgba(255,255,255,.06);display:inline-block;width:auto;max-width:100%}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:#fcc3242e;border-color:#fcc32459;color:#fdf7e0}.pin-menu[_ngcontent-%COMP%]{position:static;z-index:1;display:inline-flex;align-items:center;margin-left:6px}.message.mine[_ngcontent-%COMP%]   .pin-menu[_ngcontent-%COMP%]{margin-right:6px;margin-left:0}.pin-menu-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:34px;height:30px;border-radius:0;border:none;background:transparent;color:#fff;cursor:pointer;position:relative}.pin-menu-btn.active[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32480}.pin-menu-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px}.pin-menu-btn.unpin[_ngcontent-%COMP%]:after{content:"";position:absolute;width:18px;height:3px;background:#000;border-radius:2px;transform:rotate(-35deg)}.pin-menu-btn.unpin[_ngcontent-%COMP%]{color:#fff}.info-message[_ngcontent-%COMP%]{border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;padding:10px 12px;margin-bottom:10px}.info-label[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;letter-spacing:.3px;color:var(--color-accent);margin-bottom:4px;font-weight:700}.info-content[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:pre-wrap}.info-link[_ngcontent-%COMP%]{display:inline-flex;margin-top:6px;font-size:12px;color:var(--color-accent);text-decoration:none}.info-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.poll-message-card[_ngcontent-%COMP%]{border-radius:14px;padding:12px;background:#ffffff0f;border:1px solid rgba(255,255,255,.1);transition:background-color .2s,border-color .2s;position:relative}.poll-message-card.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.poll-message-card.pin-enabled[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fcc32466}.poll-message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;font-size:12px;color:#b8b8b8;margin-bottom:8px}.poll-message-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.poll-tag[_ngcontent-%COMP%]{background:#fcc32433;color:var(--color-accent);padding:2px 8px;border-radius:999px;font-weight:600;font-size:11px}.poll-message-question[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:var(--color-accent);margin-bottom:12px}.poll-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.poll-bar-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:10px;cursor:pointer;transition:background-color .2s ease,border-color .2s ease;border:1px solid transparent;background:#ffffff0a}.poll-bar-row[_ngcontent-%COMP%]:hover:not(.closed){background:#ffffff14;border-color:#ffffff1a}.poll-bar-row.selected[_ngcontent-%COMP%]{background:#fcc3241f;border-color:#fcc3244d}.poll-bar-row.closed[_ngcontent-%COMP%]{cursor:default;opacity:.8}.poll-bar-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#d8d8d8}.poll-bar-track[_ngcontent-%COMP%]{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden}.poll-bar-fill[_ngcontent-%COMP%]{height:100%;background:var(--color-accent);box-shadow:0 4px 10px #fcc3244d}.poll-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:14px}.poll-total[_ngcontent-%COMP%]{margin-top:10px;font-size:11px;color:#b0b0b0}.empty-state[_ngcontent-%COMP%]{color:#b3b3b3;font-size:14px;text-align:center;padding:16px 0}.mute-banner[_ngcontent-%COMP%]{background:#ff606026;color:#ffb3b3;padding:10px 12px;border-radius:12px;font-size:13px;border:1px solid rgba(255,96,96,.3)}.message-input[_ngcontent-%COMP%]{display:flex;gap:8px}.message-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-top:4px}.message-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;background:#ffffff0a;color:#f4f4f4}.send-btn[_ngcontent-%COMP%]{background:var(--color-accent);color:#fff;border:none;border-radius:12px;padding:0 16px;cursor:pointer;display:flex;align-items:center;box-shadow:0 10px 20px #fcc32440}.add-btn[_ngcontent-%COMP%]{background:#ffffff14;color:#f5f5f5;border:1px solid rgba(255,255,255,.12);border-radius:12px;width:42px;display:flex;align-items:center;justify-content:center;cursor:pointer}.add-btn[_ngcontent-%COMP%]:hover{background:#ffffff24}.poll-create[_ngcontent-%COMP%]   .poll-question-input[_ngcontent-%COMP%]{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;margin-bottom:20px;background:#ffffff0a;color:#f4f4f4;font-weight:600}.poll-options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.poll-option-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.poll-option-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;background:#ffffff0a;color:#f4f4f4;font-size:14px}.remove-option-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ef4444;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:4px;opacity:.7;transition:opacity .2s}.remove-option-btn[_ngcontent-%COMP%]:hover{opacity:1}.add-option-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;background:#fcc3241a;color:var(--color-accent);border:1px dashed var(--color-accent);border-radius:12px;padding:8px 16px;cursor:pointer;font-size:13px;font-weight:600;width:100%;justify-content:center;margin-bottom:20px;transition:background-color .2s}.add-option-pill[_ngcontent-%COMP%]:hover{background:#fcc32426}.create-poll-btn[_ngcontent-%COMP%]{width:100%;padding:12px!important;font-weight:700!important;font-size:15px!important;margin-top:10px}.pill[_ngcontent-%COMP%]{border-radius:999px;border:none;background:var(--color-accent);color:#fff;padding:8px 14px;cursor:pointer;font-size:12px;box-shadow:0 8px 18px #fcc3242e}.pill.ghost[_ngcontent-%COMP%]{background:transparent;color:#f5f5f5;border:1px solid rgba(255,255,255,.2);box-shadow:none}.pill.danger[_ngcontent-%COMP%]{background:#d43d3d;color:#fff;box-shadow:none}.poll-popup-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#060608bf;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:60}.poll-popup[_ngcontent-%COMP%]{width:min(460px,92vw);background:linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:16px;border:1px solid rgba(255,255,255,.1);padding:16px;box-shadow:0 20px 40px #00000080}.poll-popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.poll-popup-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;color:var(--color-accent);font-size:18px}.poll-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-bottom:8px}.mobile-only[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]{flex:0 0 auto;width:36px;height:36px;flex-shrink:0;position:relative;z-index:1;display:block}']})};var Nx=(r,n)=>n.id;function gJ(r,n){r&1&&(B(0,"div",13),Q(1,"Loading..."),U())}function _J(r,n){if(r&1){let t=It();B(0,"span",31),Re("click",function(){Pe(t);let h=re().$implicit,i=re(3);return Oe(i.toggleRequests(h.id))}),Q(1),U()}if(r&2){let t=re().$implicit;ne(),mr(" ",t.pendingUsersList==null?null:t.pendingUsersList.length," Requests ")}}function vJ(r,n){if(r&1){let t=It();B(0,"div",43),Mn(1,"img",44),B(2,"span",45),Q(3),U(),B(4,"button",46),Re("click",function(){let h=Pe(t).$implicit,i=re(3).$implicit,E=re(3);return Oe(E.removeParticipant(i,h))}),B(5,"mat-icon"),Q(6,"person_remove"),U()()()}if(r&2){let t=n.$implicit;ne(),bt("src",t.profileImage||"assets/placeholder-user.png",Gr),ne(2),ca("",t.name," ",t.surname)}}function yJ(r,n){if(r&1&&(B(0,"div",37)(1,"h5",41),Q(2,"Accepted People"),U(),B(3,"div",42),$i(4,vJ,7,3,"div",43,Nx),U()()),r&2){let t=re(2).$implicit;ne(4),Hi(t.acceptedUsersList)}}function xJ(r,n){r&1&&(B(0,"p",38),Q(1,"No participants accepted yet."),U())}function bJ(r,n){if(r&1){let t=It();B(0,"div",47)(1,"div",48),Mn(2,"img",49),B(3,"span"),Q(4),U()(),B(5,"div",50)(6,"button",51),Re("click",function(){let h=Pe(t).$implicit,i=re(3).$implicit,E=re(3);return Oe(E.acceptRequest(i,h))}),Q(7,"Accept"),U(),B(8,"button",52),Re("click",function(){let h=Pe(t).$implicit,i=re(3).$implicit,E=re(3);return Oe(E.rejectRequest(i,h))}),Q(9,"Reject"),U()()()}if(r&2){let t=n.$implicit;ne(2),bt("src",t.profileImage||"assets/placeholder-user.png",Gr),ne(2),ca("",t.name," ",t.surname)}}function wJ(r,n){if(r&1&&$i(0,bJ,10,3,"div",47,Nx),r&2){let t=re(2).$implicit;Hi(t.pendingUsersList)}}function CJ(r,n){r&1&&(B(0,"p",40),Q(1,"No pending requests."),U())}function EJ(r,n){if(r&1&&(B(0,"div",30)(1,"div",32)(2,"h4"),Q(3,"Event Overview"),U(),B(4,"div",33)(5,"div",34)(6,"span",35),Q(7,"Accepted Participants"),U(),B(8,"span",36),Q(9),U()(),B(10,"div",34)(11,"span",35),Q(12,"Capacity"),U(),B(13,"span",36),Q(14),U()()(),ft(15,yJ,6,0,"div",37)(16,xJ,2,0,"p",38),U(),B(17,"div",39)(18,"h4"),Q(19),U(),ft(20,wJ,2,0)(21,CJ,2,0,"p",40),U()()),r&2){let t=re().$implicit;ne(9),xt((t.acceptedUsersList==null?null:t.acceptedUsersList.length)||0),ne(5),ca(" ",(t.acceptedUsersList==null?null:t.acceptedUsersList.length)||0," / ",t.nPartecipants," "),ne(),mt(t.acceptedUsersList!=null&&t.acceptedUsersList.length?15:16),ne(4),mr("Pending Requests (",(t.pendingUsersList==null?null:t.pendingUsersList.length)||0,")"),ne(),mt(t.pendingUsersList!=null&&t.pendingUsersList.length?20:21)}}function SJ(r,n){if(r&1){let t=It();B(0,"div",20)(1,"div",21)(2,"div",22)(3,"h3"),Q(4),U(),B(5,"span",23),Q(6),U(),B(7,"span",24),Q(8),U(),Ui(9,_J,2,1,"span",25),U(),B(10,"div",26)(11,"button",27),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.openChat(h))}),B(12,"mat-icon"),Q(13,"chat"),U()(),B(14,"button",28),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.deleteEvent(h))}),B(15,"mat-icon"),Q(16,"delete"),U()(),B(17,"button",29),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.toggleRequests(h.id))}),B(18,"mat-icon"),Q(19,"group"),U()()()(),ft(20,EJ,22,6,"div",30),U()}if(r&2){let t=n.$implicit,l=re(3);fn("expanded",l.expandedEventRequestsId===t.id),ne(4),xt(t.title),ne(2),xt(t.city),ne(2),xt(l.formatDateTime(t)),ne(),bt("ngIf",t.pendingUsersList==null?null:t.pendingUsersList.length),ne(11),mt(l.expandedEventRequestsId===t.id?20:-1)}}function TJ(r,n){r&1&&(B(0,"div",19),Q(1,"No organized events found."),U())}function IJ(r,n){if(r&1&&(B(0,"div",17),$i(1,SJ,21,7,"div",18,Nx,!1,TJ,2,0,"div",19),U()),r&2){let t=re(2);fn("has-expanded-requests",t.expandedEventRequestsId),ne(),Hi(t.organizedEvents)}}function MJ(r,n){if(r&1){let t=It();B(0,"app-event-card",54),Re("shareEvent",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.openShare(h))}),U()}if(r&2){let t=n.$implicit,l=re(3);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("id",t.id)("isSaved",!!t.isSaved)("savedCount",t.savedCount)("isParticipating",!!t.isParticipating)("showDistance",!1)("showActions",!1)}}function DJ(r,n){r&1&&(B(0,"div",19),Q(1,"You haven't joined any events yet."),U())}function AJ(r,n){if(r&1&&(B(0,"div",15),$i(1,MJ,1,9,"app-event-card",53,Nx,!1,DJ,2,0,"div",19),U()),r&2){let t=re(2);ne(),Hi(t.joinedEvents)}}function PJ(r,n){if(r&1){let t=It();B(0,"app-event-card",54),Re("shareEvent",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.openShare(h))}),U()}if(r&2){let t=n.$implicit,l=re(3);bt("title",t.title)("location",t.city)("dateTime",l.formatDateTime(t))("id",t.id)("isSaved",!0)("savedCount",t.savedCount)("isParticipating",!!t.isParticipating)("showDistance",!1)("showActions",!1)}}function OJ(r,n){r&1&&(B(0,"div",19),Q(1,"You haven't saved any events yet."),U())}function RJ(r,n){if(r&1&&(B(0,"div",15),$i(1,PJ,1,9,"app-event-card",53,Nx,!1,OJ,2,0,"div",19),U()),r&2){let t=re(2);ne(),Hi(t.savedEvents)}}function kJ(r,n){if(r&1){let t=It();B(0,"app-event-share-modal",55),Re("close",function(){Pe(t);let h=re(2);return Oe(h.sharingEvent=null)}),U()}if(r&2){let t=re(2);bt("event",t.sharingEvent)}}function FJ(r,n){if(r&1){let t=It();B(0,"div",1),Re("click",function(){Pe(t);let h=re();return Oe(h.close.emit())}),U(),B(1,"div",2)(2,"div",3)(3,"mat-icon",4),Re("click",function(){Pe(t);let h=re();return Oe(h.onBack())}),Q(4,"arrow_back"),U(),B(5,"div",5)(6,"button",6),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("ORGANIZED"))}),Q(7," My Events "),U(),B(8,"button",6),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("JOINED"))}),Q(9," Joined Events "),U(),B(10,"button",6),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("SAVED"))}),Q(11," Saved Events "),U()(),B(12,"div",7)(13,"h2",8),Q(14),U()(),B(15,"button",9),Re("click",function(){Pe(t);let h=re();return Oe(h.close.emit())}),B(16,"mat-icon"),Q(17,"close"),U()()(),B(18,"div",10)(19,"button",11),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("ORGANIZED"))}),B(20,"mat-icon"),Q(21,"event"),U(),B(22,"span"),Q(23,"My Events"),U()(),B(24,"button",11),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("JOINED"))}),B(25,"mat-icon"),Q(26,"group"),U(),B(27,"span"),Q(28,"Joined"),U()(),B(29,"button",11),Re("click",function(){Pe(t);let h=re();return Oe(h.switchTab("SAVED"))}),B(30,"mat-icon"),Q(31,"bookmark"),U(),B(32,"span"),Q(33,"Saved"),U()()(),B(34,"div",12),ft(35,gJ,2,0,"div",13),ft(36,IJ,4,3,"div",14),ft(37,AJ,4,1,"div",15),ft(38,RJ,4,1,"div",15),U()(),ft(39,kJ,1,1,"app-event-share-modal",16)}if(r&2){let t=re();ne(6),fn("active",t.activeTab==="ORGANIZED"),ne(2),fn("active",t.activeTab==="JOINED"),ne(2),fn("active",t.activeTab==="SAVED"),ne(4),xt(t.getViewTitle()),ne(5),fn("active",t.activeTab==="ORGANIZED"),ne(5),fn("active",t.activeTab==="JOINED"),ne(5),fn("active",t.activeTab==="SAVED"),ne(6),mt(t.loading?35:-1),ne(),mt(!t.loading&&t.activeTab==="ORGANIZED"?36:-1),ne(),mt(!t.loading&&t.activeTab==="JOINED"?37:-1),ne(),mt(!t.loading&&t.activeTab==="SAVED"?38:-1),ne(),mt(t.sharingEvent?39:-1)}}function LJ(r,n){if(r&1){let t=It();B(0,"event-chat-modal",56),Re("close",function(){Pe(t);let h=re();return Oe(h.closeChat())}),U()}if(r&2){let t=re();bt("event",t.chatEvent)("currentUserId",t.userId.toString())}}var PS=class r{constructor(n){this.eventService=n}userId;close=new Zt;view="organized";getViewTitle(){return this.expandedEventRequestsId?"Manage Requests":this.activeTab==="ORGANIZED"?"My Events":this.activeTab==="JOINED"?"Joined Events":"Saved Events"}onBack(){this.expandedEventRequestsId?this.expandedEventRequestsId=null:this.close.emit()}activeTab="ORGANIZED";organizedEvents=[];joinedEvents=[];savedEvents=[];loading=!1;sharingEvent=null;expandedEventRequestsId=null;showChatModal=!1;chatEvent=null;ngOnInit(){this.loadData()}loadData(){this.loading=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>this.organizedEvents=n,error:n=>console.error("Error loading organized events",n)}),this.eventService.getJoinedEvents(this.userId).subscribe({next:n=>{this.joinedEvents=n},error:n=>{console.error("Error loading joined events",n)}}),this.eventService.getSavedEvents(this.userId).subscribe({next:n=>{this.savedEvents=n,this.loading=!1},error:n=>{console.error("Error loading saved events",n),this.loading=!1}})}switchTab(n){this.activeTab=n,this.expandedEventRequestsId=null}toggleRequests(n){this.expandedEventRequestsId===n?this.expandedEventRequestsId=null:this.expandedEventRequestsId=n}deleteEvent(n){confirm("Are you sure you want to delete this event?")&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.organizedEvents=this.organizedEvents.filter(l=>l.id!==n.id),this.expandedEventRequestsId===n.id&&(this.expandedEventRequestsId=null)},error:l=>console.error("Error deleting event",l)})}openChat(n){this.chatEvent=n,this.showChatModal=!0}closeChat(){this.showChatModal=!1,this.chatEvent=null}acceptRequest(n,t){this.eventService.acceptParticipation(n.id,t.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(l=>l.id!==t.id)),n.acceptedUsersList||(n.acceptedUsersList=[]),n.acceptedUsersList.push(t),n.acceptedUsersList.sort((l,h)=>(l.name||"").localeCompare(h.name||"")),n.occupiedSpots=(n.occupiedSpots||0)+1},error:l=>console.error("Error accepting",l)})}rejectRequest(n,t){this.eventService.rejectParticipation(n.id,t.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(l=>l.id!==t.id))},error:l=>console.error("Error rejecting",l)})}removeParticipant(n,t){confirm(`Remove ${t.name} ${t.surname} from this event?`)&&this.eventService.removeParticipant(n.id,t.id,this.userId).subscribe({next:()=>{n.acceptedUsersList&&(n.acceptedUsersList=n.acceptedUsersList.filter(h=>h.id!==t.id)),n.occupiedSpots=Math.max(0,(n.occupiedSpots||0)-1)},error:h=>console.error("Error removing participant",h)})}openShare(n){this.sharingEvent=n}formatDateTime(n){let t=n.date?new Date(`${n.date}T00:00:00`):null,l=n.startTime?n.startTime.slice(0,5):"";return`${t?t.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):""} | ${l}`}static \u0275fac=function(t){return new(t||r)(Bt(js))};static \u0275cmp=In({type:r,selectors:[["app-my-events-modal"]],inputs:{userId:"userId"},outputs:{close:"close"},decls:2,vars:2,consts:[[3,"event","currentUserId"],[1,"backdrop",3,"click"],[1,"modal-container"],[1,"modal-header"],[1,"mobile-only","back-arrow",3,"click"],[1,"tabs","tablet-desktop-only"],[1,"tab-btn",3,"click"],[1,"title-wrap","mobile-only"],[1,"yellow-title"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"mobile-tabs","mobile-only"],[1,"mobile-tab-btn",3,"click"],[1,"modal-content"],[1,"loading-state"],[1,"events-list",3,"has-expanded-requests"],[1,"events-grid"],[3,"event"],[1,"events-list"],[1,"organized-event-item",3,"expanded"],[1,"empty-state"],[1,"organized-event-item"],[1,"event-summary"],[1,"event-info"],[1,"event-location"],[1,"event-date"],["class","requests-badge",3,"click",4,"ngIf"],[1,"event-actions"],["title","Open chat",1,"icon-btn","chat",3,"click"],["title","Delete event",1,"icon-btn","danger",3,"click"],["title","Manage Requests",1,"icon-btn",3,"click"],[1,"requests-panel"],[1,"requests-badge",3,"click"],[1,"event-overview-section"],[1,"stats-card"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"participants-list"],[1,"no-data-msg"],[1,"pending-requests-section"],[1,"no-requests"],[1,"section-subtitle"],[1,"participants-grid"],[1,"participant-chip"],[1,"participant-avatar",3,"src"],[1,"participant-name"],["type","button","title","Remove participant",1,"participant-remove-btn",3,"click"],[1,"request-item"],[1,"user-info"],[1,"user-avatar",3,"src"],[1,"request-actions"],[1,"accept-btn",3,"click"],[1,"reject-btn",3,"click"],[3,"title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions"],[3,"shareEvent","title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions"],[3,"close","event"],[3,"close","event","currentUserId"]],template:function(t,l){t&1&&(ft(0,FJ,40,18),ft(1,LJ,1,2,"event-chat-modal",0)),t&2&&(mt(l.showChatModal?-1:0),ne(),mt(l.showChatModal&&l.chatEvent?1:-1))},dependencies:[Li,Ps,Xi,Zi,jh,V_,q_],styles:['.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--color-backdrop);z-index:var(--z-backdrop);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}.modal-container[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:600px;height:80vh;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:24px;z-index:var(--z-popup);display:flex;flex-direction:column;overflow:hidden;box-shadow:0 25px 50px -12px #00000080;border:1px solid rgba(255,255,255,.08)}.modal-header[_ngcontent-%COMP%]{padding:16px 24px;background:transparent;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1)}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}.tabs[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:center;align-items:center;gap:0}.tab-btn[_ngcontent-%COMP%]{flex:1;background:none;border:none;color:#888;font-size:16px;font-weight:600;padding:10px 24px;cursor:pointer;position:relative;text-align:center;border-left:1px solid rgba(255,255,255,.12);transition:color .3s}.tab-btn[_ngcontent-%COMP%]:first-child{border-left:none}.tab-btn.active[_ngcontent-%COMP%]{color:#fbce4e}.tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-17px;left:0;width:100%;height:3px;background:#fbce4e;border-radius:3px 3px 0 0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.organized-event-item[_ngcontent-%COMP%]{background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);border:none;color:var(--color-white)}.event-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.event-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.icon-btn.chat[_ngcontent-%COMP%]{background:#fcc32424;color:var(--color-accent);border:1px solid rgba(252,195,36,.3);width:36px;height:36px;border-radius:8px}.icon-btn.chat[_ngcontent-%COMP%]:hover{background:#fcc3244d;color:#0b0b0b}.event-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.icon-btn.danger[_ngcontent-%COMP%]{background:#ea43351a;color:var(--color-danger);border:1px solid rgba(234,67,53,.2);width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:all .2s}.icon-btn.danger[_ngcontent-%COMP%]:hover{background:var(--color-danger);color:#fff}.icon-btn.danger[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.event-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.event-location[_ngcontent-%COMP%]{display:block;margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.event-date[_ngcontent-%COMP%]{display:block;margin:0;font-size:10px;color:#888}.requests-badge[_ngcontent-%COMP%]{display:inline-block;background:var(--color-accent);color:#000;font-size:10px;font-weight:700;padding:2px 8px;border-radius:12px;cursor:pointer;align-self:flex-start;margin-top:4px}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);border:none;color:var(--color-light-gray);padding:0;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:background-color .2s}.icon-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.icon-btn[_ngcontent-%COMP%]:hover{background-color:#555;color:var(--color-white)}.requests-panel[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1);animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.requests-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#ddd;font-size:14px;text-transform:uppercase;letter-spacing:.5px}.request-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:#fff}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;background:#444}.request-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.accept-btn[_ngcontent-%COMP%], .reject-btn[_ngcontent-%COMP%]{border:none;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer}.accept-btn[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.reject-btn[_ngcontent-%COMP%]{background:#f44336;color:#fff}.no-requests[_ngcontent-%COMP%]{color:#888;font-size:14px;font-style:italic}.event-overview-section[_ngcontent-%COMP%]{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(255,255,255,.1)}.pending-requests-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .event-overview-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#fbce4e;font-size:14px;text-transform:uppercase;letter-spacing:1px;font-weight:700}.stats-card[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;background:#ffffff08;padding:16px;border-radius:12px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.stat-label[_ngcontent-%COMP%]{color:#888;font-size:12px;text-transform:uppercase}.stat-value[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700}.section-subtitle[_ngcontent-%COMP%]{color:#ddd;font-size:14px;margin:0 0 12px;font-weight:600}.participants-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.participant-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#ffffff0d;padding:6px 10px;border-radius:20px;border:1px solid rgba(255,255,255,.05)}.participant-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;object-fit:cover}.participant-name[_ngcontent-%COMP%]{color:#eee;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.participant-remove-btn[_ngcontent-%COMP%]{margin-left:auto;width:22px;height:22px;border-radius:50%;border:1px solid rgba(244,67,54,.3);background:#f4433626;color:#f44336;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.participant-remove-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.participant-remove-btn[_ngcontent-%COMP%]:hover{background:#f44336;color:#fff}.no-data-msg[_ngcontent-%COMP%]{color:#888;font-size:13px;font-style:italic}.events-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#888;margin-top:40px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#333;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#444}@media (max-width: 768px){.backdrop[_ngcontent-%COMP%]{-webkit-backdrop-filter:none;backdrop-filter:none}.modal-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;transform:none;width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none}.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex!important;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.modal-content[_ngcontent-%COMP%]{padding:16px}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item[_ngcontent-%COMP%]:not(.expanded){display:none}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]{background:transparent!important;padding:0!important;border:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .event-summary[_ngcontent-%COMP%]{display:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .requests-panel[_ngcontent-%COMP%]{margin-top:0!important;border-top:none!important;padding-top:0!important}}.mobile-tabs[_ngcontent-%COMP%]{display:none;justify-content:space-around;background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);padding:8px 0}.mobile-tab-btn[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;color:#888;font-size:11px;cursor:pointer;padding:8px 0;transition:color .2s}.mobile-tab-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.mobile-tab-btn.active[_ngcontent-%COMP%]{color:var(--color-accent)}.mobile-tab-btn.active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}@media (max-width: 768px){.mobile-tabs[_ngcontent-%COMP%]{display:flex!important}}']})};function NJ(r,n){if(r&1&&Mn(0,"img",15),r&2){let t=re(2);bt("src",t.user==null?null:t.user.profileImage,Gr)}}function zJ(r,n){if(r&1&&(B(0,"div",16),Q(1),U()),r&2){let t=re(2);ne(),xt(t.getInitials((t.user==null?null:t.user.name)||""))}}function BJ(r,n){if(r&1){let t=It();B(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),ft(5,NJ,1,1,"img",15)(6,zJ,2,1,"div",16),B(7,"button",17),Re("click",function(){Pe(t);let h=re();return Oe(h.onChangePhoto())}),B(8,"mat-icon"),Q(9,"edit"),U()()(),B(10,"h3",18),Q(11),U(),B(12,"p",19)(13,"mat-icon"),Q(14,"mail_outline"),U(),Q(15),U(),B(16,"p",20),Q(17),U(),B(18,"div",21)(19,"div",22),Re("click",function(){Pe(t);let h=re();return Oe(h.showFollowers())}),B(20,"span",23),Q(21),U(),B(22,"span",24),Q(23,"Followers"),U()(),Mn(24,"div",25),B(25,"div",22),Re("click",function(){Pe(t);let h=re();return Oe(h.showFollowing())}),B(26,"span",23),Q(27),U(),B(28,"span",24),Q(29,"Following"),U()()()(),B(30,"div",26)(31,"button",27),Re("click",function(){Pe(t);let h=re();return Oe(h.showEditProfile())}),B(32,"mat-icon"),Q(33,"settings"),U(),Q(34," Edit Profile "),U()()(),Mn(35,"div",28),B(36,"div",29)(37,"div",30)(38,"span",31),Q(39,"Share Profile"),U(),B(40,"div",32),Mn(41,"img",33),U(),B(42,"div",34)(43,"div",35)(44,"button",36),Re("click",function(){Pe(t);let h=re();return Oe(h.copyShareLink())}),B(45,"mat-icon"),Q(46,"content_copy"),U(),Q(47," Copy Link "),U()()()()()()()}if(r&2){let t=re();ne(5),mt(t.user!=null&&t.user.profileImage?5:6),ne(6),xt(t.user==null?null:t.user.name),ne(4),mr(" ",t.getDiscreteEmail(t.user==null?null:t.user.email)," "),ne(2),xt((t.user==null?null:t.user.description)||"Find The Glow"),ne(4),xt((t.user==null?null:t.user.followersCount)||0),ne(6),xt((t.user==null?null:t.user.followingCount)||0),ne(14),bt("src",t.getQrCodeUrl(),Gr)}}function VJ(r,n){if(r&1){let t=It();B(0,"div",37)(1,"div",38)(2,"div",39)(3,"h4"),Q(4,"Personal Information"),U(),B(5,"div",40)(6,"label"),Q(7,"Name"),U(),B(8,"input",41),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.editData.name,h)||(i.editData.name=h),Oe(h)}),U()(),B(9,"div",40)(10,"label"),Q(11,"Email"),U(),Mn(12,"input",42),U(),B(13,"div",40)(14,"label"),Q(15,"Description"),U(),B(16,"textarea",43),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.editData.description,h)||(i.editData.description=h),Oe(h)}),U()(),B(17,"button",44),Re("click",function(){Pe(t);let h=re();return Oe(h.onSaveProfile())}),Q(18,"Update Details"),U()(),Mn(19,"div",28),B(20,"div",45)(21,"h4"),Q(22,"Change Password"),U(),B(23,"div",40)(24,"label"),Q(25,"Current Password"),U(),B(26,"input",46),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.passwordData.old,h)||(i.passwordData.old=h),Oe(h)}),U()(),B(27,"div",40)(28,"label"),Q(29,"New Password"),U(),B(30,"input",47),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.passwordData.new,h)||(i.passwordData.new=h),Oe(h)}),U()(),B(31,"div",40)(32,"label"),Q(33,"Confirm New Password"),U(),B(34,"input",48),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.passwordData.confirm,h)||(i.passwordData.confirm=h),Oe(h)}),U()(),B(35,"button",44),Re("click",function(){Pe(t);let h=re();return Oe(h.onChangePassword())}),Q(36,"Change Password"),U()()()()}if(r&2){let t=re();ne(8),Oo("ngModel",t.editData.name),ne(4),bt("value",t.editData.email),ne(4),Oo("ngModel",t.editData.description),ne(10),Oo("ngModel",t.passwordData.old),ne(4),Oo("ngModel",t.passwordData.new),ne(4),Oo("ngModel",t.passwordData.confirm)}}function UJ(r,n){if(r&1&&Mn(0,"img",61),r&2){let t=re().$implicit;bt("src",t.profileImage,Gr)}}function jJ(r,n){if(r&1&&(B(0,"div",62),Q(1),U()),r&2){let t=re().$implicit,l=re(3);ne(),xt(l.getInitials(t.name))}}function $J(r,n){if(r&1){let t=It();B(0,"button",63),Re("click",function(){Pe(t);let h=re().$implicit,i=re(3);return Oe(i.onUnfollow(h))}),Q(1," Unfollow "),U()}}function HJ(r,n){if(r&1){let t=It();B(0,"button",64),Re("click",function(){Pe(t);let h=re().$implicit,i=re(3);return Oe(i.onFollow(h))}),Q(1," Follow "),U()}}function GJ(r,n){if(r&1){let t=It();B(0,"div",54)(1,"div",55),Re("click",function(){let h=Pe(t).$implicit,i=re(3);return Oe(i.openProfileFromList(h))}),Ui(2,UJ,1,1,"img",56)(3,jJ,2,1,"div",57),B(4,"span",58),Q(5),U()(),Ui(6,$J,2,0,"button",59)(7,HJ,2,0,"button",60),U()}if(r&2){let t=n.$implicit,l=re(3);ne(2),bt("ngIf",t.profileImage),ne(),bt("ngIf",!t.profileImage),ne(2),xt(t.name),ne(),bt("ngIf",l.view==="following"||l.view==="followers"&&l.followingIds.has(t.id.toString())),ne(),bt("ngIf",l.view==="followers"&&!l.followingIds.has(t.id.toString()))}}function qJ(r,n){r&1&&(B(0,"div",65),Q(1," No users found. "),U())}function WJ(r,n){if(r&1&&(B(0,"div",51),Ui(1,GJ,8,5,"div",52)(2,qJ,2,0,"div",53),U()),r&2){let t=re(2);ne(),bt("ngForOf",t.userList),ne(),bt("ngIf",t.userList.length===0)}}function ZJ(r,n){r&1&&(B(0,"div",66),Q(1,"Loading..."),U())}function XJ(r,n){if(r&1&&(B(0,"div",49),Ui(1,WJ,3,2,"div",50)(2,ZJ,2,0,"ng-template",null,0,ky),U()),r&2){let t=Al(3),l=re();ne(),bt("ngIf",!l.loadingList)("ngIfElse",t)}}var OS=class r{constructor(n){this.userService=n}user=null;close=new Zt;changePhoto=new Zt;openProfile=new Zt;view="profile";userList=[];followingIds=new Set;loadingList=!1;editData={name:"",email:"",description:""};passwordData={old:"",new:"",confirm:""};onClose(){this.view!=="profile"?this.view="profile":this.close.emit()}getViewTitle(){switch(this.view){case"edit-profile":return"Edit Profile";case"followers":return"Followers";case"following":return"Following";default:return"Account"}}onChangePhoto(){this.changePhoto.emit()}getInitials(n){return n?n.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):""}getDiscreteEmail(n){if(!n)return"";if(n.length<=25)return n;let t=n.split("@");if(t.length!==2)return n;let[l,h]=t;return`...${l.slice(-3)}@${h}`}showFollowers(){if(!this.user)return;let n=this.user.id;this.view="followers",this.loadingList=!0,this.userService.getFollowers(n).subscribe({next:t=>{this.userList=t,this.userService.getFollowing(n).subscribe({next:l=>{this.followingIds=new Set(l.map(h=>h.id.toString())),this.loadingList=!1},error:l=>{console.error("Error fetching following list",l),this.loadingList=!1}})},error:t=>{console.error(t),this.loadingList=!1}})}showFollowing(){this.user&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.user.id).subscribe({next:n=>{this.userList=n,this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}}))}onFollow(n){this.user&&this.userService.followUser(this.user.id,n.id).subscribe({next:()=>{this.followingIds.add(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||0)+1),this.userService.notifyUserUpdate()},error:t=>console.error(t)})}onUnfollow(n){this.user&&confirm(`Are you sure you want to unfollow ${n.name}?`)&&this.userService.unfollowUser(this.user.id,n.id).subscribe({next:()=>{this.view==="following"?this.userList=this.userList.filter(t=>t.id!==n.id):this.followingIds.delete(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||1)-1),this.userService.notifyUserUpdate()},error:t=>console.error(t)})}openProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}showEditProfile(){this.user&&(this.view="edit-profile",this.editData={name:this.user.name,email:this.user.email,description:this.user.description||""},this.passwordData={old:"",new:"",confirm:""})}onSaveProfile(){this.user&&this.userService.updateUser(this.user.id,this.editData).subscribe({next:n=>{this.user&&(this.user.name=n.name,this.user.email=n.email,this.user.description=n.description),alert("Profile updated successfully"),this.userService.notifyUserUpdate()},error:n=>{console.error(n),alert("Failed to update profile")}})}getShareLink(){if(!this.user)return"";let n=window.location.protocol,t=window.location.host;return`${n}//${t}/?user=${this.user.id}`}getQrCodeUrl(){if(!this.user)return"";let n=this.getShareLink();return`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(n)}`}copyShareLink(){let n=this.getShareLink();navigator.clipboard.writeText(n).then(()=>{alert("Link copied to clipboard!")}).catch(t=>{console.error("Failed to copy: ",t)})}onChangePassword(){if(this.user){if(this.passwordData.new!==this.passwordData.confirm){alert("New passwords do not match");return}if(!this.passwordData.old||!this.passwordData.new){alert("Please fill in default fields");return}this.userService.changePassword(this.user.id,this.passwordData.old,this.passwordData.new).subscribe({next:()=>{alert("Password changed successfully"),this.passwordData={old:"",new:"",confirm:""}},error:n=>{console.error(n),alert("Failed to change password. existing password may be incorrect.")}})}}static \u0275fac=function(t){return new(t||r)(Bt(_s))};static \u0275cmp=In({type:r,selectors:[["app-account-modal"]],inputs:{user:"user"},outputs:{close:"close",changePhoto:"changePhoto",openProfile:"openProfile"},decls:12,vars:7,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"mobile-only","back-arrow",3,"click"],[1,"title-wrap"],[1,"close","tablet-desktop-only",3,"click","path"],["class","account-content",4,"ngIf"],["class","edit-profile-view",4,"ngIf"],["class","user-list-view",4,"ngIf"],[1,"account-content"],[1,"content-row"],[1,"content-col","left-col"],[1,"profile-section"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"edit-photo-btn",3,"click"],[1,"user-name"],[1,"user-email"],[1,"user-description"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"actions-section"],[1,"action-btn",3,"click"],[1,"vertical-divider"],[1,"content-col","right-col"],[1,"share-section-embedded"],[1,"share-header"],[1,"qr-code-wrapper"],["alt","Profile QR Code",3,"src"],[1,"share-details"],[1,"mini-link-group"],[1,"mini-copy-btn",3,"click"],[1,"edit-profile-view"],[1,"edit-content-layout"],[1,"edit-section","left-section"],[1,"form-group"],["placeholder","Name",3,"ngModelChange","ngModel"],["readonly","","disabled","",1,"readonly-input",3,"value"],["placeholder","Description (e.g. Find The Glow)","rows","3",3,"ngModelChange","ngModel"],[1,"button",3,"click"],[1,"edit-section","right-section"],["type","password","placeholder","Current Password",3,"ngModelChange","ngModel"],["type","password","placeholder","New Password",3,"ngModelChange","ngModel"],["type","password","placeholder","Confirm Password",3,"ngModelChange","ngModel"],[1,"user-list-view"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],["class","user-item",4,"ngFor","ngForOf"],["class","empty-list",4,"ngIf"],[1,"user-item"],[1,"user-info",3,"click"],["class","list-avatar",3,"src",4,"ngIf"],["class","list-avatar-placeholder",4,"ngIf"],[1,"list-username"],["class","unfollow-btn",3,"click",4,"ngIf"],["class","follow-btn",3,"click",4,"ngIf"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"unfollow-btn",3,"click"],[1,"follow-btn",3,"click"],[1,"empty-list"],[1,"loading-spinner"]],template:function(t,l){t&1&&(B(0,"div",1),Re("click",function(){return l.onClose()}),B(1,"div",2),Re("click",function(i){return i.stopPropagation()}),B(2,"div",3)(3,"mat-icon",4),Re("click",function(){return l.onClose()}),Q(4,"arrow_back"),U(),B(5,"div",5)(6,"h2"),Q(7),U()(),B(8,"CircleIcon",6),Re("click",function(){return l.onClose()}),U()(),Ui(9,BJ,48,7,"div",7)(10,VJ,37,6,"div",8)(11,XJ,4,2,"div",9),U()()),t&2&&(ne(6),fn("yellow-title",l.view!=="profile"),ne(),xt(l.getViewTitle()),ne(),bt("path","assets/icon/close.svg"),ne(),bt("ngIf",l.view==="profile"),ne(),bt("ngIf",l.view==="edit-profile"),ne(),bt("ngIf",l.view!=="profile"&&l.view!=="edit-profile"))},dependencies:[Li,u_,Ps,Xi,Zi,Nl,Us,Da,nl,Aa],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000b3;display:flex;justify-content:center;align-items:center;z-index:99999;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}.modal-container[_ngcontent-%COMP%]{background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);width:800px;max-width:95vw;height:auto;border-radius:24px;padding:24px;border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 30px #00000080;animation:_ngcontent-%COMP%_slideUp .3s ease-out;display:flex;flex-direction:column;overflow:hidden;box-sizing:border-box}.edit-profile-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden}.edit-content-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;flex:1;overflow-y:auto;padding:5%}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-gray);border-radius:3px}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.close[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:none!important}}.account-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;height:100%}.content-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex:1;gap:24px;align-items:stretch}.content-col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:flex-start}.left-col[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:10px}.right-col[_ngcontent-%COMP%]{align-items:center;justify-content:center}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:auto}.share-section-embedded[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:15px;background:#ffffff08;border-radius:12px;padding:24px;border:1px solid rgba(255,255,255,.05);width:100%;box-sizing:border-box;height:100%;justify-content:center}.vertical-divider[_ngcontent-%COMP%]{width:1px;background:#ffffff1a}.edit-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:15px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:160px;display:block}.section-divider[_ngcontent-%COMP%]{display:none}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:20px;font-weight:600}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .2s}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:var(--color-white)}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.avatar-container[_ngcontent-%COMP%]{position:relative;margin-bottom:8px}.profile-image[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--color-accent)}.profile-placeholder[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:600;color:var(--color-white);border:2px solid var(--color-accent)}.edit-photo-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background:var(--color-accent);color:#000;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 8px #0000004d;transition:transform .2s}.edit-photo-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.edit-photo-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.user-name[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--color-white);font-size:24px;font-weight:700;letter-spacing:-.5px;line-height:1.1}.user-email[_ngcontent-%COMP%]{margin:4px 0 0;color:#ffffff80;font-size:13px;display:flex;align-items:center;justify-content:center;gap:6px;font-weight:400}.user-email[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;opacity:.8}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d!important;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white)!important;font-size:14px;font-family:inherit;resize:none;min-height:80px}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:20px;margin-top:10px;padding:8px 0;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:15px}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:12px;border:1px solid var(--color-gray);background:#ffffff0d;color:var(--color-white);font-size:15px;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:var(--color-light-gray)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:opacity .2s}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.user-list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:10px}.list-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:20px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;padding:0;display:flex;align-items:center}.back-btn[_ngcontent-%COMP%]:hover{color:var(--color-white)}.user-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;overflow-y:auto;flex:1;padding-right:5px;scrollbar-width:none}.user-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:#ffffff0d}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;color:var(--color-white);font-size:14px;font-weight:600}.list-username[_ngcontent-%COMP%]{color:var(--color-white);font-size:16px;font-weight:500}.unfollow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-error, #ff4444);color:var(--color-error, #ff4444);padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;transition:all .2s}.unfollow-btn[_ngcontent-%COMP%]:hover{background:var(--color-error, #ff4444);color:#fff}.empty-list[_ngcontent-%COMP%]{color:var(--color-light-gray);text-align:center;padding:20px}.loading-spinner[_ngcontent-%COMP%]{color:var(--color-accent);text-align:center;padding:20px}.follow-btn[_ngcontent-%COMP%]{background:var(--color-accent);border:1px solid var(--color-accent);color:#000;padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;font-weight:600;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{opacity:.9;transform:scale(1.05)}.edit-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-accent);margin:0 0 5px;font-size:16px;font-weight:600}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--color-light-gray);font-size:12px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px}.form-group[_ngcontent-%COMP%]   input.readonly-input[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;background:#ffffff05}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px;font-family:inherit;resize:none}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none;overflow-y:auto;padding:0 0 80px}.content-row[_ngcontent-%COMP%], .edit-content-layout[_ngcontent-%COMP%]{flex-direction:column;gap:24px;background:linear-gradient(160deg,#141414,#0c0c0c)}.vertical-divider[_ngcontent-%COMP%]{display:none}.content-col[_ngcontent-%COMP%], .left-col[_ngcontent-%COMP%], .right-col[_ngcontent-%COMP%], .edit-section[_ngcontent-%COMP%]{width:100%;flex:none;padding:24px;box-sizing:border-box}.share-section-embedded[_ngcontent-%COMP%]{padding:20px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:140px}.profile-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:0 8px}.edit-section[_ngcontent-%COMP%]{padding:0 8px}.user-list[_ngcontent-%COMP%]{padding:24px}}.share-header[_ngcontent-%COMP%]{color:var(--color-white);font-size:14px;font-weight:500;opacity:.8}.qr-code-wrapper[_ngcontent-%COMP%]{background:#fff;padding:6px;border-radius:10px;flex-shrink:0}.share-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}.mini-link-group[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.mini-copy-btn[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-accent);color:var(--color-accent);border-radius:8px;padding:8px 16px;font-size:14px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s;width:100%;justify-content:center}.mini-copy-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.mini-copy-btn[_ngcontent-%COMP%]:hover{background:var(--color-accent);color:#000}"]})};function YJ(r,n){r&1&&Mn(0,"span",3)}function KJ(r,n){if(r&1){let t=It();B(0,"notification-menu",9),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())})("openChat",function(h){Pe(t);let i=re();return Oe(i.onOpenChatFromNotification(h))})("close",function(){Pe(t);let h=re();return Oe(h.showNotifications=!1)}),U()}if(r&2){let t=re();bt("userId",(t.loggedUser==null?null:t.loggedUser.id)||0)}}function QJ(r,n){if(r&1&&Mn(0,"img",6),r&2){let t=re();bt("src",t.loggedUser==null?null:t.loggedUser.profileImage,Gr)}}function JJ(r,n){if(r&1&&(B(0,"div",7),Q(1),U()),r&2){let t=re();ne(),xt(t.getInitials((t.loggedUser==null?null:t.loggedUser.name)||(t.loggedUser==null?null:t.loggedUser.email)||""))}}function eee(r,n){if(r&1){let t=It();B(0,"UserMenu",10),Re("click",function(h){return Pe(t),Oe(h.stopPropagation())})("close",function(){Pe(t);let h=re();return Oe(h.showUserMenu=!1)})("action",function(h){Pe(t);let i=re();return Oe(i.onMenuAction(h))}),U()}}function tee(r,n){if(r&1){let t=It();B(0,"app-my-events-modal",11),Re("close",function(){Pe(t);let h=re();return Oe(h.showMyEventsModal=!1)}),U()}if(r&2){let t=re();bt("userId",(t.loggedUser==null?null:t.loggedUser.id)||0)}}function nee(r,n){if(r&1){let t=It();B(0,"app-account-modal",12),Re("close",function(){Pe(t);let h=re();return Oe(h.showAccountModal=!1)})("changePhoto",function(){Pe(t);let h=re();return Oe(h.onChangePhotoFromAccount())})("openProfile",function(h){Pe(t);let i=re();return Oe(i.onOpenProfileFromAccount(h))}),U()}if(r&2){let t=re();bt("user",t.loggedUser)}}var RS=class r{constructor(n,t,l){this.notificationService=n;this.elementRef=t;this.userService=l}loggedUser=null;action=new Zt;openProfile=new Zt;openChatFromNotification=new Zt;showUserMenu=!1;showNotifications=!1;showMyEventsModal=!1;showAccountModal=!1;hasUnread=!1;pollSubscription=null;ngOnInit(){this.startPolling()}ngOnDestroy(){this.stopPolling()}ngOnChanges(){this.loggedUser?(this.checkUnreadNotifications(),this.startPolling()):this.stopPolling()}startPolling(){this.pollSubscription||this.loggedUser&&(this.pollSubscription=Q0(5e3).pipe(_o(()=>{let n=[];return this.loggedUser&&!this.showNotifications&&n.push(this.notificationService.getNotifications(this.loggedUser.id)),this.loggedUser&&this.userService.notifyUserUpdate(),n.length>0?this.notificationService.getNotifications(this.loggedUser.id):[]})).subscribe({next:n=>{Array.isArray(n)&&(this.hasUnread=n.some(t=>!t.isRead))},error:n=>console.error("Error polling notifications",n)}))}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}onClickOutside(n){this.elementRef.nativeElement.contains(n.target)||(this.showUserMenu=!1,this.showNotifications=!1)}checkUnreadNotifications(){this.loggedUser&&this.notificationService.getNotifications(this.loggedUser.id).subscribe({next:n=>{this.hasUnread=n.some(t=>!t.isRead)},error:n=>console.error("Error fetching notifications status",n)})}toggleUserMenu(n){n&&n.stopPropagation(),this.showUserMenu=!this.showUserMenu,this.showNotifications=!1}toggleNotifications(n){n.stopPropagation(),this.showNotifications=!this.showNotifications,this.showUserMenu=!1,this.showNotifications&&this.loggedUser?this.notificationService.markAllAsRead(this.loggedUser.id).subscribe({next:()=>{this.hasUnread=!1},error:t=>console.error("Error marking read",t)}):!this.showNotifications&&this.loggedUser&&this.checkUnreadNotifications()}onMenuAction(n){n==="my-events"?this.showMyEventsModal=!0:n==="account"?this.showAccountModal=!0:this.action.emit(n),this.showUserMenu=!1}onOpenProfileFromAccount(n){this.showAccountModal=!1,this.openProfile.emit(n)}onChangePhotoFromAccount(){this.showAccountModal=!1,this.action.emit("change-photo")}onOpenChatFromNotification(n){this.showNotifications=!1,this.openChatFromNotification.emit(n)}onAddEvent(){this.action.emit("add-event")}getInitials(n){return n?n.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):""}static \u0275fac=function(t){return new(t||r)(Bt(G_),Bt(ir),Bt(_s))};static \u0275cmp=In({type:r,selectors:[["app-action-bar"]],hostBindings:function(t,l){t&1&&Re("click",function(i){return l.onClickOutside(i)},TA)},inputs:{loggedUser:"loggedUser"},outputs:{action:"action",openProfile:"openProfile",openChatFromNotification:"openChatFromNotification"},features:[Vr],decls:14,vars:6,consts:[[1,"action-bar"],[1,"add-event-btn","button",3,"click"],[1,"icon-circle","notification-icon",3,"click"],[1,"unread-indicator"],[3,"userId"],[1,"profile-trigger",3,"click"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[3,"user"],[3,"click","openChat","close","userId"],[3,"click","close","action"],[3,"close","userId"],[3,"close","changePhoto","openProfile","user"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"button",1),Re("click",function(){return l.onAddEvent()}),Q(2,"Add Event"),U(),B(3,"div",2),Re("click",function(i){return l.toggleNotifications(i)}),B(4,"mat-icon"),Q(5,"notifications"),U(),ft(6,YJ,1,0,"span",3),ft(7,KJ,1,1,"notification-menu",4),U(),B(8,"div",5),Re("click",function(i){return l.toggleUserMenu(i)}),ft(9,QJ,1,1,"img",6)(10,JJ,2,1,"div",7),ft(11,eee,1,0,"UserMenu"),U()(),ft(12,tee,1,1,"app-my-events-modal",4),ft(13,nee,1,1,"app-account-modal",8)),t&2&&(ne(6),mt(l.hasUnread?6:-1),ne(),mt(l.showNotifications?7:-1),ne(2),mt(l.loggedUser!=null&&l.loggedUser.profileImage?9:10),ne(2),mt(l.showUserMenu?11:-1),ne(),mt(l.showMyEventsModal?12:-1),ne(),mt(l.showAccountModal?13:-1))},dependencies:[Li,Xi,Zi,MS,DS,PS,OS],styles:[".action-bar[_ngcontent-%COMP%]{height:72px;position:absolute;top:20px;right:20px;display:flex;align-items:center;justify-content:space-between;gap:10px;background:var(--color-dark-gray);padding:12px;border-radius:var(--radius-2xl);box-shadow:var(--shadow-lg);z-index:var(--z-action-bar);width:auto;box-sizing:border-box;border:1px solid var(--color-light-gray)}.action-bar[_ngcontent-%COMP%]   .add-event-btn[_ngcontent-%COMP%]{height:44px;cursor:pointer;transition:transform .1s ease,filter .2s}.add-event-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.1);transform:scale(1.02)}.profile-trigger[_ngcontent-%COMP%]{height:44px;width:44px;border-radius:var(--radius-full);overflow:hidden;cursor:pointer;border:1px solid transparent;transition:border-color .2s;background-color:var(--color-dark-gray);display:flex;justify-content:center;align-items:center}.profile-trigger[_ngcontent-%COMP%]:hover{border-color:var(--color-accent)}.profile-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-semibold);font-size:16px}.icon-circle[_ngcontent-%COMP%]{width:44px;height:44px;background:#ffffff1a;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s,transform .2s}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px;color:var(--color-white)}.icon-circle[_ngcontent-%COMP%]:hover{background:#fff3}.notification-icon[_ngcontent-%COMP%]{margin-right:4px;margin-left:4px;position:relative}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;width:10px;height:10px;background-color:var(--color-accent);border-radius:var(--radius-full);border:2px solid var(--color-dark-gray);z-index:10}notification-menu[_ngcontent-%COMP%]{position:absolute;top:70px;right:-70px;z-index:var(--z-dropdown)}@media (max-width: 768px){.action-bar[_ngcontent-%COMP%]{top:20px;bottom:auto;right:20px;padding:8px;height:60px}}"]})};var iee=["canvas"],kS=class r{imageFile;close=new Zt;imageCropped=new Zt;canvasRef;ctx;image=new Image;scale=1;offsetX=0;offsetY=0;isDragging=!1;lastX=0;lastY=0;VIEWPORT_SIZE=300;OUTPUT_SIZE=128;ngAfterViewInit(){let n=this.canvasRef.nativeElement;this.ctx=n.getContext("2d");let t=new FileReader;t.onload=l=>{this.image.src=l.target.result,this.image.onload=()=>{this.resetView(),this.draw()}},t.readAsDataURL(this.imageFile)}resetView(){let n=this.VIEWPORT_SIZE/this.image.width,t=this.VIEWPORT_SIZE/this.image.height;this.scale=Math.max(n,t),this.offsetX=(this.VIEWPORT_SIZE-this.image.width*this.scale)/2,this.offsetY=(this.VIEWPORT_SIZE-this.image.height*this.scale)/2}draw(){this.ctx&&(this.ctx.clearRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.ctx.drawImage(this.image,0,0),this.ctx.restore())}onMouseDown(n){this.isDragging=!0,this.lastX=n.clientX,this.lastY=n.clientY}onMouseMove(n){if(!this.isDragging)return;let t=n.clientX-this.lastX,l=n.clientY-this.lastY;this.offsetX+=t,this.offsetY+=l,this.lastX=n.clientX,this.lastY=n.clientY,this.draw()}onMouseUp(){this.isDragging=!1}onWheel(n){n.preventDefault();let l=this.scale-n.deltaY*.001;l>.1&&(this.scale=l,this.draw())}onZoomChange(n){this.scale=parseFloat(n.target.value),this.draw()}zoomIn(){this.scale=Math.min(this.scale+.1,5),this.draw()}zoomOut(){this.scale=Math.max(this.scale-.1,.1),this.draw()}crop(){let n=document.createElement("canvas");n.width=this.OUTPUT_SIZE,n.height=this.OUTPUT_SIZE;let t=n.getContext("2d"),l=(0-this.offsetX)/this.scale,h=(0-this.offsetY)/this.scale,i=this.VIEWPORT_SIZE/this.scale,E=this.VIEWPORT_SIZE/this.scale;t.drawImage(this.image,l,h,i,E,0,0,this.OUTPUT_SIZE,this.OUTPUT_SIZE),n.toBlob(O=>{O&&this.imageCropped.emit(O)},"image/jpeg",.9)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=In({type:r,selectors:[["CropImagePopup"]],viewQuery:function(t,l){if(t&1&&Sa(iee,5),t&2){let h;aa(h=la())&&(l.canvasRef=h.first)}},inputs:{imageFile:"imageFile"},outputs:{close:"close",imageCropped:"imageCropped"},decls:21,vars:4,consts:[["canvas",""],[1,"crop-backdrop"],[1,"crop-container"],[1,"crop-header"],[3,"click","path"],[1,"canvas-wrapper"],[3,"mousedown","mousemove","mouseup","mouseleave","wheel","width","height"],[1,"overlay-guide"],[1,"controls"],[1,"zoom-icon",2,"cursor","pointer",3,"click"],["type","range","min","0.1","max","5","step","0.1",3,"input","value"],[1,"actions"],[1,"btn-cancel","button",3,"click"],[1,"button",3,"click"]],template:function(t,l){if(t&1){let h=It();B(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3"),Q(4,"Crop Image"),U(),B(5,"CircleIcon",4),Re("click",function(){return Pe(h),Oe(l.close.emit())}),U()(),B(6,"div",5)(7,"canvas",6,0),Re("mousedown",function(E){return Pe(h),Oe(l.onMouseDown(E))})("mousemove",function(E){return Pe(h),Oe(l.onMouseMove(E))})("mouseup",function(){return Pe(h),Oe(l.onMouseUp())})("mouseleave",function(){return Pe(h),Oe(l.onMouseUp())})("wheel",function(E){return Pe(h),Oe(l.onWheel(E))}),U(),Mn(9,"div",7),U(),B(10,"div",8)(11,"span",9),Re("click",function(){return Pe(h),Oe(l.zoomOut())}),Q(12,"\u2212"),U(),B(13,"input",10),Re("input",function(E){return Pe(h),Oe(l.onZoomChange(E))}),U(),B(14,"span",9),Re("click",function(){return Pe(h),Oe(l.zoomIn())}),Q(15,"+"),U()(),B(16,"div",11)(17,"button",12),Re("click",function(){return Pe(h),Oe(l.close.emit())}),Q(18,"Cancel"),U(),B(19,"button",13),Re("click",function(){return Pe(h),Oe(l.crop())}),Q(20,"Save Photo"),U()()()()}t&2&&(ne(5),bt("path","assets/icon/close.svg"),ne(2),bt("width",l.VIEWPORT_SIZE)("height",l.VIEWPORT_SIZE),ne(6),bt("value",l.scale))},dependencies:[Li,Aa],styles:[".crop-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#00000073;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:1000;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.crop-container[_ngcontent-%COMP%]{background:var(--color-dark-gray);border-radius:20px;padding:24px;width:90%;max-width:400px;border:1px solid rgba(210,210,210,.1);display:flex;flex-direction:column;gap:20px;position:relative}.crop-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.crop-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:18px}.close-btn[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:none;border:none;color:var(--color-light-gray);font-size:28px;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;line-height:1;z-index:10}.close-btn[_ngcontent-%COMP%]:hover{color:var(--color-white)}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;width:300px;height:300px;margin:0 auto;border-radius:12px;overflow:hidden;background:var(--color-gray);cursor:move}.overlay-guide[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid var(--color-light-gray);box-sizing:border-box;pointer-events:none;border-radius:12px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-light-gray)}input[type=range][_ngcontent-%COMP%]{flex:1;accent-color:var(--color-accent);height:4px;background:var(--color-light-gray);border-radius:2px;appearance:none}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--color-white);border-radius:50%;cursor:pointer}.actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:10px}.btn-cancel[_ngcontent-%COMP%]{height:auto;border:1px solid var(--color-light-gray);background:var(--color-dark-gray)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}"]})};function ree(r,n){if(r&1&&(B(0,"p",7),Q(1),U()),r&2){let t=re();ne(),xt(t.generalError)}}function oee(r,n){if(r&1&&(B(0,"p",7),Q(1),l_(2,"keyvalue"),U()),r&2){let t=re();ne(),xt(UC(2,1,t.errors)[0].value)}}var FS=class r{constructor(n,t,l){this.fb=n;this.http=t;this.mapboxService=l;this.form=this.fb.group({title:["",Su.required],description:["",Su.required],date:["",Su.required],startTime:["",Su.required],endTime:[""],nPartecipants:["",[Su.required,Su.min(1)]],costPerPerson:["",[Su.min(0)]]},{validators:this.timeRangeValidator})}close=new Zt;eventCreated=new Zt;openLocationSelector=new Zt;form;generalError="";errors={};latitude=null;longitude=null;locationText="Select position on map";selectedCity=null;timeRangeValidator(n){let t=n.get("startTime")?.value,l=n.get("endTime")?.value;if(t&&l){let[h,i]=t.split(":").map(Number),[E,O]=l.split(":").map(Number),N=h*60+i,K=E*60+O;if(K<=N)return{timeOrder:!0};if(K-N<60)return{minDuration:!0}}return null}onClose(){this.close.emit()}submitAttempted=!1;hasError(n){let t=this.form.get(n),l=n==="startTime"||n==="endTime",h=this.form.errors?.timeOrder||this.form.errors?.minDuration;return!!(this.submitAttempted&&(t?.invalid||l&&h))}selectLocationOnMap(){this.openLocationSelector.emit()}setLocation(n,t){this.latitude=n,this.longitude=t,this.selectedCity=null,this.locationText="Location selected",this.mapboxService.reverseGeocode(n,t).subscribe({next:l=>{l&&(this.selectedCity=l,this.locationText=`Location: ${l}`)},error:l=>console.error("Error reverse geocoding city",l)})}onSubmit(){this.submitAttempted=!0,this.errors={},this.generalError="",Object.keys(this.form.controls).forEach(E=>{this.form.get(E)?.markAsTouched()});let n=this.form.controls;if(n.title.invalid&&(this.errors.title="Title is required."),n.description.invalid&&(this.errors.description="Description is required."),n.date.invalid&&(this.errors.date="Date is required."),n.startTime.invalid&&(this.errors.startTime="Start time is required."),n.nPartecipants.invalid&&(n.nPartecipants.errors?.required?this.errors.nPartecipants="Number of participants is required.":n.nPartecipants.errors?.min&&(this.errors.nPartecipants="Number of participants must be at least 1.")),n.costPerPerson.invalid&&(n.costPerPerson.errors?.min?this.errors.costPerPerson="Cost cannot be negative.":this.errors.costPerPerson="Invalid cost."),this.form.errors?.timeOrder?this.errors.time="Start time must be before end time.":this.form.errors?.minDuration&&(this.errors.time="Event must last at least one hour."),this.latitude===null||this.longitude===null?this.errors.location="Select a location on the map.":this.selectedCity||(this.errors.location="Unable to detect city from selected location."),Object.keys(this.errors).length>0)return;let t=this.form.value,l={title:t.title,description:t.description,city:this.selectedCity,date:t.date,startTime:t.startTime,endTime:t.endTime,nPartecipants:parseInt(t.nPartecipants),costPerPerson:t.costPerPerson!==null&&t.costPerPerson!==""?Math.max(0,parseFloat(t.costPerPerson)):null,latitude:this.latitude,longitude:this.longitude},h=localStorage.getItem("user"),i=h?JSON.parse(h).id:null;this.http.post(`http://localhost:8080/api/events?userId=${i}`,l).subscribe({next:E=>{this.eventCreated.emit(E),this.onClose()},error:E=>{console.error("Error creating event:",E),this.generalError="Error creating event"}})}static \u0275fac=function(t){return new(t||r)(Bt(B_),Bt(Eo),Bt(Iu))};static \u0275cmp=In({type:r,selectors:[["create-event-popup"]],outputs:{close:"close",eventCreated:"eventCreated",openLocationSelector:"openLocationSelector"},decls:30,vars:27,consts:[[1,"backdrop",3,"click"],[1,"popup-container","desktop"],[1,"popup-content"],[1,"mobile-header"],[3,"click"],[1,"close","tablet-desktop-only",3,"click","path"],[1,"header","desktop-header"],[1,"error"],[1,"form"],[1,"two-column","single-column"],["placeholder","Title",3,"error","control","type"],["placeholder","Description","customClass","tall-field",3,"error","control","type"],[1,"three-column"],["placeholder","Date",3,"error","control","type"],["placeholder","Start",3,"error","control","type"],["placeholder","End",3,"error","control","type"],[1,"two-column"],["placeholder","Max Participants",3,"error","control","type"],["placeholder","Cost (\u20AC)",3,"error","control","type","min"],["type","button",1,"button","location-btn",3,"click"],["type","button",1,"button",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),Re("click",function(){return l.onClose()}),U(),B(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Re("click",function(){return l.onClose()}),Q(5,"arrow_back"),U(),B(6,"h1"),Q(7,"Create Event"),U()(),B(8,"CircleIcon",5),Re("click",function(){return l.onClose()}),U(),B(9,"div",6)(10,"h1"),Q(11,"Create Event"),U(),ft(12,ree,2,1,"p",7),l_(13,"keyvalue"),Py(14,oee,3,3,"p",7),U(),B(15,"form",8)(16,"div",9),Mn(17,"FormField",10),U(),Mn(18,"FormField",11),B(19,"div",12),Mn(20,"FormField",13)(21,"FormField",14)(22,"FormField",15),U(),B(23,"div",16),Mn(24,"FormField",17)(25,"FormField",18),U(),B(26,"button",19),Re("click",function(){return l.selectLocationOnMap()}),Q(27),U(),B(28,"button",20),Re("click",function(){return l.onSubmit()}),Q(29,"Create Event"),U()()()()),t&2&&(ne(8),bt("path","assets/icon/close.svg"),ne(4),mt(l.generalError?12:UC(13,25,l.errors).length>0?14:-1),ne(5),bt("error",l.hasError("title"))("control",l.form.get("title"))("type","text"),ne(),bt("error",l.hasError("description"))("control",l.form.get("description"))("type","textarea"),ne(2),bt("error",l.hasError("date"))("control",l.form.get("date"))("type","date"),ne(),bt("error",l.hasError("startTime"))("control",l.form.get("startTime"))("type","time"),ne(),bt("error",l.hasError("endTime"))("control",l.form.get("endTime"))("type","time"),ne(2),bt("error",l.hasError("nPartecipants"))("control",l.form.get("nPartecipants"))("type","number"),ne(),bt("error",l.hasError("costPerPerson"))("control",l.form.get("costPerPerson"))("type","number")("min",0),ne(2),mr(" \u{1F4CD} ",l.locationText," "))},dependencies:[Li,Hh,Aa,Vh,z_,N_,Xi,Zi,w2],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-backdrop);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:45%;max-height:95vh;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:var(--radius-xl);border:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;overflow:visible}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;cursor:pointer}.header[_ngcontent-%COMP%]{padding:20px 0 10px;text-align:center;width:100%}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-lg);padding:0 8% 24px;box-sizing:border-box}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.two-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md);width:100%}.single-column[_ngcontent-%COMP%]{grid-template-columns:1fr}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md);width:100%}.tall-field[_ngcontent-%COMP%]{min-height:80px}.tall-field[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.description-row[_ngcontent-%COMP%]{width:100%;min-height:80px}.description-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.time-section[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-sm)}.section-label[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-light-gray);margin:0}.time-inputs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-md);width:100%}.time-inputs[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.time-separator[_ngcontent-%COMP%]{font-size:18px;color:var(--color-light-gray);padding:0 var(--spacing-xs)}.location-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-sm);width:100%}.location-btn[_ngcontent-%COMP%]{background-color:var(--color-gray);width:100%;border:2px solid rgba(255,255,255,.12);box-sizing:border-box}.location-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.error[_ngcontent-%COMP%]{color:var(--color-error);font-size:18px;margin:0}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{width:100vw;height:100vh;max-width:none;max-height:none;border-radius:0;inset:0;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;max-width:none;max-height:none;border-radius:0;border:none;justify-content:flex-start;background:radial-gradient(circle at 50% 16%,rgba(252,195,36,.18),transparent 45%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);overflow-y:auto}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md)}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px;font-size:18px}.button[_ngcontent-%COMP%]{height:60px;font-size:16px}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}.form[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg);padding:0 10%;height:100%}}"]})};function see(r,n){if(r&1&&(B(0,"p",5)(1,"mat-icon",7),Q(2,"place"),U(),B(3,"span"),Q(4),U()()),r&2){let t=re();ne(4),xt(t.event.city)}}function aee(r,n){if(r&1&&(B(0,"p",5),Q(1),U()),r&2){let t=re();ne(),xt(t.getSubtitle())}}function lee(r,n){if(r&1){let t=It();B(0,"button",24),Re("click",function(h){Pe(t);let i=re();return Oe(i.openInMaps(h))}),B(1,"mat-icon"),Q(2,"map"),U()()}}function cee(r,n){if(r&1&&(B(0,"span",26),Q(1),U()),r&2){let t=re(2);ne(),xt(t.event.savedCount)}}function uee(r,n){if(r&1){let t=It();B(0,"button",25),Re("click",function(h){return Pe(t),re().toggleFavorite.emit(),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2),U(),ft(3,cee,2,1,"span",26),U()}if(r&2){let t=re();fn("saved",t.isSaved()),ne(2),xt(t.isSaved()?"favorite":"favorite_border"),ne(),mt(t.event.savedCount!==void 0&&t.event.savedCount!==null?3:-1)}}function dee(r,n){if(r&1&&(B(0,"span",13)(1,"mat-icon"),Q(2,"event_available"),U(),B(3,"span"),Q(4),U()()),r&2){let t=re();ne(4),mr("",t.event.nPartecipants-(t.event.occupiedSpots||0)," spots left")}}function hee(r,n){if(r&1&&(B(0,"p",27),Q(1),U()),r&2){let t=re();ne(),xt(t.event.description)}}function pee(r,n){if(r&1&&Mn(0,"img",19),r&2){let t=re();bt("src",t.organizerImage,Gr)}}function fee(r,n){if(r&1&&(B(0,"div",20),Q(1),U()),r&2){let t=re();ne(),xt(t.getInitials(t.organizerName))}}function mee(r,n){r&1&&(B(0,"span",28),Q(1,"You"),U())}function gee(r,n){if(r&1){let t=It();B(0,"button",31),Re("click",function(h){return Pe(t),re(3).followOrganizer(),Oe(h.stopPropagation())}),B(1,"mat-icon"),Q(2,"person_add"),U()()}}function _ee(r,n){if(r&1){let t=It();B(0,"div",30)(1,"button",32),Re("click",function(h){Pe(t);let i=re(3);return Oe(i.toggleNotifications(h))}),B(2,"mat-icon"),Q(3),U()()()}if(r&2){let t=re(3);ne(),fn("active",t.notificationsEnabled),bt("disabled",t.notificationsLoading),ne(2),xt(t.notificationsEnabled?"notifications":"notifications_off")}}function vee(r,n){if(r&1&&ft(0,gee,3,0,"button",29)(1,_ee,4,4,"div",30),r&2){let t=re(2);mt(!t.isFollowing&&!t.isLoadingFollowStatus?0:t.isFollowing?1:-1)}}function yee(r,n){if(r&1&&ft(0,mee,2,0,"span",28)(1,vee,2,1),r&2){let t=re();mt(t.currentUserId.toString()===((t.creatorId||t.event.creatorId)==null?null:(t.creatorId||t.event.creatorId).toString())?0:1)}}function xee(r,n){if(r&1){let t=It();B(0,"div",33),Q(1,"You cannot join your own event"),U(),B(2,"button",34),Re("click",function(){Pe(t);let h=re();return Oe(h.onDeleteEvent())}),Q(3,"Delete event"),U()}}function bee(r,n){if(r&1){let t=It();B(0,"div",35)(1,"button",38),Q(2,"Joined"),U(),B(3,"button",39),Re("click",function(){Pe(t);let h=re(2);return Oe(h.onOpenChat())}),Q(4,"Chat"),U(),B(5,"button",40),Re("click",function(){Pe(t);let h=re(2);return Oe(h.onLeave())}),Q(6,"Leave"),U()()}}function wee(r,n){r&1&&(B(0,"button",36),Q(1,"Pending"),U())}function Cee(r,n){if(r&1){let t=It();B(0,"button",41),Re("click",function(){Pe(t);let h=re(2);return Oe(h.onParticipate())}),Q(1,"Request to join"),U()}}function Eee(r,n){if(r&1&&ft(0,bee,7,0,"div",35)(1,wee,2,0,"button",36)(2,Cee,2,0,"button",37),r&2){let t=re();mt(t.event.participationStatus==="ACCEPTED"?0:t.event.participationStatus==="PENDING"?1:2)}}var LS=class r{constructor(n,t){this.elementRef=n;this.userService=t}event;organizerName="Eventer";organizerImage;eventPosition;currentUserId=null;creatorId;close=new Zt;participate=new Zt;toggleFavorite=new Zt;openOrganizerProfile=new Zt;leave=new Zt;deleteEvent=new Zt;shareEvent=new Zt;openChat=new Zt;isFollowing=!1;isLoadingFollowStatus=!0;notificationsEnabled=!1;notificationsLoading=!1;ngAfterViewInit(){this.positionCard()}ngOnChanges(n){n.eventPosition&&this.positionCard(),(n.event||n.currentUserId||n.creatorId)&&this.checkIfFollowing()}checkIfFollowing(){let n=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!n||this.currentUserId===n.toString()){this.isFollowing=!1,this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1;return}this.isLoadingFollowStatus=!0,this.userService.isFollowing(this.currentUserId,n.toString()).subscribe({next:t=>{this.isFollowing=t.isFollowing,this.isLoadingFollowStatus=!1,this.isFollowing?this.loadNotificationPreference(n.toString()):this.notificationsEnabled=!1},error:t=>{console.error("Error checking follow status",t),this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1}})}onClick(n){n.stopPropagation()}onResize(){this.positionCard()}positionCard(){if(!this.eventPosition)return;let n=this.elementRef.nativeElement.querySelector(".card-container");if(n){let t=document.querySelector(".sidebar-container"),l=t?.getBoundingClientRect(),h=l&&!t?.classList.contains("collapsed")?l.right:0,i=12,E=h>0?h+i:i,O=i,K=window.innerWidth<=768?100:O,le=n.offsetWidth||0,De=n.offsetHeight||0,Qe=window.innerWidth,Fe=window.innerHeight,gt=-20,jt=this.eventPosition.x,Ot=this.eventPosition.y+gt,Kt=jt-le/2,Hn=jt+le/2;Kt<E?jt+=E-Kt:Hn>Qe-O&&(jt-=Hn-(Qe-O));let Er=Ot-De;Er<K&&(Ot+=K-Er),Ot>Fe-O&&(Ot=Fe-O),n.style.left=`${jt}px`,n.style.top=`${Ot}px`,n.style.transform="translate(-50%, -100%)"}}onClose(){this.close.emit()}onParticipate(){this.isOrganizer()||this.participate.emit(this.event)}onLeave(){this.leave.emit(this.event)}onOpenChat(){this.openChat.emit(this.event)}onDeleteEvent(){this.isOrganizer()&&this.deleteEvent.emit(this.event)}toggleNotifications(n){n.stopPropagation();let t=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!t||!this.isFollowing)return;let l=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,t.toString(),l).subscribe({next:h=>{this.notificationsEnabled=h.enabled,this.notificationsLoading=!1},error:h=>{console.error("Error updating follow notifications",h),this.notificationsLoading=!1}})}isOrganizer(){let n=this.creatorId??this.event?.creatorId;return!!this.currentUserId&&!!n&&this.currentUserId.toString()===n.toString()}getOrganizerId(){let n=this.creatorId??this.event?.creatorId??this.event?.creator?.id;return n!=null?String(n):null}formatHeroDate(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,t=this.event.startTime?this.event.startTime.slice(0,5):null,l=n?n.toLocaleDateString("en-US",{weekday:"short"}):"",h=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"";return[[l,h].filter(Boolean).join(" "),t||""].filter(Boolean).join(", ")}getActualParticipants(){return this.event.occupiedSpots!==void 0&&this.event.occupiedSpots!==null?this.event.occupiedSpots:this.event.nPartecipants||0}getSubtitle(){return this.event.city?this.event.city:this.event.description?this.event.description:"Location TBD"}hasCoordinates(){return!!this.event&&Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)}openInMaps(n){if(n?.stopPropagation(),!this.hasCoordinates())return;let t=`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`;window.open(t,"_blank","noopener")}showDescription(){return!!this.event.description&&this.event.description!==this.getSubtitle()}formatDateTime(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,t=this.event.startTime?this.event.startTime.slice(0,5):null,l=this.event.endTime?this.event.endTime.slice(0,5):null,h=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",i=l?`${t} \u2014 ${l}`:t;return[h,i].filter(Boolean).join(" / ")}formatCost(){return this.event.costPerPerson!==void 0&&this.event.costPerPerson!==null?`${this.event.costPerPerson} per person`:"Free"}getInitials(n){return n?n.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"OR"}isSaved(){return this.event.isSaved}followOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.followUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.userService.notifyUserUpdate()},error:t=>console.error("Error following",t)})}unfollowOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.unfollowUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!1,this.notificationsEnabled=!1,this.userService.notifyUserUpdate()},error:t=>console.error("Error unfollowing",t)})}onOrganizerClick(){let n=this.getOrganizerId();if(!n){console.log("[EventPopupCard] eventer click with missing id",{creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event});return}console.log("[EventPopupCard] open eventer",{organizerId:n,creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event}),this.openOrganizerProfile.emit(n)}loadNotificationPreference(n){this.currentUserId&&(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,n).subscribe({next:t=>{this.notificationsEnabled=!!t.enabled,this.notificationsLoading=!1},error:t=>{console.error("Error fetching follow notifications preference",t),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(t){return new(t||r)(Bt(ir),Bt(_s))};static \u0275cmp=In({type:r,selectors:[["event-popup-card"]],hostBindings:function(t,l){t&1&&Re("click",function(i){return l.onClick(i)})("resize",function(){return l.onResize()},SA)},inputs:{event:"event",organizerName:"organizerName",organizerImage:"organizerImage",eventPosition:"eventPosition",currentUserId:"currentUserId",creatorId:"creatorId"},outputs:{close:"close",participate:"participate",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",leave:"leave",deleteEvent:"deleteEvent",shareEvent:"shareEvent",openChat:"openChat"},features:[Vr],decls:45,vars:13,consts:[[1,"card-container"],[1,"card-content"],[1,"header-row"],[1,"title-block"],[1,"title"],[1,"subtitle"],[1,"accent-date"],[1,"inline-icon"],[1,"action-icons"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"saved"],["aria-label","Share event",1,"action-icon","share-icon",3,"click"],[1,"chip-row"],[1,"chip"],["class","chip",4,"ngIf"],["class","description",4,"ngIf"],[1,"eventer-section"],[1,"eventer-info"],["type","button",1,"eventer-hit",3,"click"],["alt","Eventer",1,"organizer-avatar",3,"src"],[1,"organizer-avatar","placeholder"],[1,"eventer-text"],[1,"eventer-label"],[1,"eventer-name"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon",3,"click"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"click"],[1,"favorite-count"],[1,"description"],[1,"is-organizer-badge"],[1,"icon-circle","follow-btn-popup"],[1,"notify-toggle"],[1,"icon-circle","follow-btn-popup",3,"click"],[1,"icon-circle","bell-btn",3,"click","disabled"],[1,"owner-note"],["type","button",1,"button","cancel-btn",3,"click"],[1,"participation-actions"],["disabled","",1,"button","partecipa-btn","pending"],[1,"button","partecipa-btn"],["disabled","",1,"button","partecipa-btn","accepted"],["type","button",1,"button","chat-btn",3,"click"],["type","button",1,"button","leave-btn",3,"click"],[1,"button","partecipa-btn",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),Q(5),U(),ft(6,see,5,1,"p",5)(7,aee,2,1,"p",5),B(8,"p",6)(9,"mat-icon",7),Q(10,"event"),U(),B(11,"span"),Q(12),U()()(),B(13,"div",8),ft(14,lee,3,0,"button",9),ft(15,uee,4,4,"button",10),B(16,"button",11),Re("click",function(i){return l.shareEvent.emit(l.event),i.stopPropagation()}),B(17,"mat-icon"),Q(18,"share"),U()()()(),B(19,"div",12)(20,"span",13)(21,"mat-icon"),Q(22,"group"),U(),B(23,"span"),Q(24),U()(),Ui(25,dee,5,1,"span",14),B(26,"span",13)(27,"mat-icon"),Q(28,"euro"),U(),B(29,"span"),Q(30),U()()(),Ui(31,hee,2,1,"p",15),B(32,"div",16)(33,"div",17)(34,"button",18),Re("click",function(i){return l.onOrganizerClick(),i.stopPropagation()}),ft(35,pee,1,1,"img",19)(36,fee,2,1,"div",20),B(37,"div",21)(38,"span",22),Q(39,"Eventer"),U(),B(40,"span",23),Q(41),U()()()(),ft(42,yee,2,1),U(),ft(43,xee,4,0)(44,Eee,3,1),U()()),t&2&&(ne(5),xt(l.event.title),ne(),mt(l.event.city?6:7),ne(6),xt(l.formatHeroDate()),ne(2),mt(l.hasCoordinates()?14:-1),ne(),mt(l.event.isParticipating?-1:15),ne(9),mr("",l.getActualParticipants()," participants"),ne(),bt("ngIf",l.event.occupiedSpots!==void 0),ne(5),xt(l.formatCost()),ne(),bt("ngIf",l.showDescription()),ne(4),mt(l.organizerImage?35:36),ne(6),xt(l.organizerName),ne(),mt(l.currentUserId&&(l.creatorId||l.event.creatorId)?42:-1),ne(),mt(l.isOrganizer()?43:44))},dependencies:[Li,Ps,Xi,Zi],styles:[".card-container[_ngcontent-%COMP%]{position:absolute;z-index:900;pointer-events:none}.card-content[_ngcontent-%COMP%]{position:relative;width:380px;max-width:calc(100vw - 32px);background:radial-gradient(circle at 15% 20%,rgba(252,195,36,.18),transparent 34%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:18px;padding:22px;display:flex;flex-direction:column;gap:10px;pointer-events:all;box-shadow:0 12px 30px #0000008c;border:1px solid rgba(255,255,255,.08);color:#f7f7f7;white-space:normal}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:10px}.title-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.title[_ngcontent-%COMP%]{margin:0;font-size:32px;font-weight:var(--font-weight-bold);color:var(--color-white);line-height:1.05;text-transform:uppercase;letter-spacing:.4px;word-break:break-word}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:var(--font-weight-regular);color:#e7e7e7;line-height:1.3;display:inline-flex;align-items:center;gap:6px}.inline-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.accent-date[_ngcontent-%COMP%]{margin:2px 0 6px;font-size:18px;font-weight:var(--font-weight-bold);color:var(--color-accent);text-transform:lowercase;display:inline-flex;align-items:center;gap:6px}.action-icons[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px}.action-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.12);background:#ffffff12;border-radius:14px;width:42px;height:42px;display:grid;place-items:center;color:#d8d8d8;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease,border-color .15s ease,background-color .15s ease}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;min-width:16px;height:16px;padding:0 4px;border-radius:999px;background:#0c0c0ce6;border:1px solid rgba(255,255,255,.22);color:var(--color-accent);font-size:9px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.action-icon[_ngcontent-%COMP%]:hover{transform:translateY(-1px);border-color:#fff3;background:#ffffff1a}.favorite-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32499;box-shadow:0 0 12px #fcc32447}.action-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px}.brand-pill[_ngcontent-%COMP%]{align-self:flex-start;padding:6px 10px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.14);color:var(--color-accent);font-weight:var(--font-weight-bold);font-size:12px;letter-spacing:.8px}.chip-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:8px 0 6px}.chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:#f5f5f5;font-size:11px;line-height:1.2}.chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:var(--color-accent)}.description[_ngcontent-%COMP%]{margin:6px 0 8px;font-size:15px;font-weight:var(--font-weight-light);color:#e6e6e6;line-height:1.6}.eventer-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:6px}.eventer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.eventer-hit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;padding:0;border-radius:0;border:none;background:transparent;color:inherit;cursor:pointer;transition:opacity .15s ease}.eventer-hit[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.15)}.organizer-avatar.placeholder[_ngcontent-%COMP%]{background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.eventer-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.eventer-label[_ngcontent-%COMP%]{font-size:11px;font-weight:var(--font-weight-regular);color:#c7c7c7;letter-spacing:.6px;text-transform:uppercase}.eventer-name[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.is-organizer-badge[_ngcontent-%COMP%]{padding:8px 10px;border-radius:10px;background:#fcc3242e;border:1px solid rgba(252,195,36,.5);color:#f8f1d2;font-weight:var(--font-weight-semibold);font-size:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#ffffff14;border:1px solid rgba(255,255,255,.12);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:transform .15s ease,background-color .15s ease,border-color .15s ease}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#ffffff24;border-color:#fff3}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.94)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#f0f0f0}.follow-btn-popup.following[_ngcontent-%COMP%]{background-color:var(--color-accent);color:#0b0b0b;border-color:var(--color-accent)}.partecipa-btn[_ngcontent-%COMP%]{width:100%;margin-top:16px;background:var(--color-accent);color:var(--color-white);font-weight:var(--font-weight-bold);border:none;border-radius:12px;padding:10px 16px;font-size:15px;letter-spacing:.3px;box-shadow:0 8px 18px #fcc32440;transition:filter .15s ease,transform .1s ease}.partecipa-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.partecipa-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.partecipa-btn.pending[_ngcontent-%COMP%]{background-color:#ffb84d;color:#0e0e0e;opacity:.95}.partecipa-btn.accepted[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;opacity:.95}.partecipa-btn[_ngcontent-%COMP%]:disabled{pointer-events:none}.participation-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:16px}.participation-actions[_ngcontent-%COMP%]   .partecipa-btn[_ngcontent-%COMP%]{width:auto;margin-top:0;flex:1 1 auto}.chat-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:#ffffff14;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.chat-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f;border-color:#ffffff4d}.chat-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.leave-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:transparent;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.leave-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff47}.leave-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.owner-note[_ngcontent-%COMP%]{margin-top:16px;padding:12px 14px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);color:#f0f0f0;font-weight:var(--font-weight-semibold);font-size:14px}.notify-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.bell-btn[_ngcontent-%COMP%]{background:#ffffff14;border:1px solid rgba(255,255,255,.2)}.bell-btn.active[_ngcontent-%COMP%]{background:#fbbc0429;border-color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.notify-label[_ngcontent-%COMP%]{font-size:12px;color:#cfcfcf}.cancel-btn[_ngcontent-%COMP%]{width:100%;margin-top:10px;background:#b61e1e;color:#fff;font-weight:var(--font-weight-semibold);border:none;border-radius:12px;padding:10px 14px;letter-spacing:.2px;box-shadow:0 8px 18px #b61e1e59;transition:filter .15s ease,transform .1s ease}.cancel-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.cancel-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 480px){.card-content[_ngcontent-%COMP%]{width:calc(100vw - 24px);padding:18px}.title[_ngcontent-%COMP%]{font-size:26px}.subtitle[_ngcontent-%COMP%], .accent-date[_ngcontent-%COMP%]{font-size:16px}}"]})};var zS=eL(yP());var See=(r,n)=>n.name;function Tee(r,n){if(r&1){let t=It();B(0,"mat-icon",10),Re("click",function(){Pe(t);let h=re();return h.searchQuery="",Oe(h.cityResults=[])}),Q(1,"close"),U()}}function Iee(r,n){if(r&1){let t=It();B(0,"div",12),Re("click",function(){let h=Pe(t).$implicit,i=re(2);return Oe(i.selectCity(h))}),B(1,"mat-icon"),Q(2,"location_on"),U(),B(3,"span"),Q(4),U()()}if(r&2){let t=n.$implicit;ne(4),xt(t.name)}}function Mee(r,n){if(r&1&&(B(0,"div",7),$i(1,Iee,5,1,"div",11,See),U()),r&2){let t=re();ne(),Hi(t.cityResults)}}var NS=class r{constructor(n){this.mapboxService=n}locationSelected=new Zt;close=new Zt;map;selectedMarker=null;selectedCoords=null;searchQuery="";cityResults=[];ngAfterViewInit(){this.map=new zS.Map({accessToken:tl.mapboxToken,container:"location-map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:12,pitch:0,bearing:0}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{let t=[n.coords.longitude,n.coords.latitude];this.map.flyTo({center:t,zoom:17,duration:1e3})},n=>console.warn("Geolocation error:",n)),this.map.on("click",n=>{this.selectedCoords=[n.lngLat.lng,n.lngLat.lat],this.selectedMarker&&this.selectedMarker.remove();let t=document.createElement("div");t.style.width="30px",t.style.height="30px",t.style.backgroundColor="#FCC324",t.style.borderRadius="50%",t.style.border="3px solid white",t.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",this.selectedMarker=new zS.Marker({element:t}).setLngLat(this.selectedCoords).addTo(this.map)})}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.cityResults=[];return}this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(t=>({name:t.place_name,center:t.center}))})}selectCity(n){this.map.flyTo({center:n.center,zoom:16,essential:!0}),this.searchQuery="",this.cityResults=[]}ngOnDestroy(){this.map&&this.map.remove()}onConfirm(){this.selectedCoords&&this.locationSelected.emit({lat:this.selectedCoords[1],lng:this.selectedCoords[0]})}onClose(){this.close.emit()}static \u0275fac=function(t){return new(t||r)(Bt(Iu))};static \u0275cmp=In({type:r,selectors:[["map-location-selector"]],outputs:{locationSelected:"locationSelected",close:"close"},decls:14,vars:4,consts:[[1,"backdrop",3,"click"],[1,"selector-container"],[1,"instruction-text"],[1,"search-section"],[1,"search-bar"],["type","text","placeholder","Search city or place...",3,"ngModelChange","input","ngModel"],[1,"clear-icon"],[1,"search-results"],["id","location-map",1,"map"],[1,"button","confirm-btn",3,"click","disabled"],[1,"clear-icon",3,"click"],[1,"result-item"],[1,"result-item",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0),Re("click",function(){return l.onClose()}),U(),B(1,"div",1)(2,"div",2),Q(3," \u{1F4CD} Select a location for your event "),U(),B(4,"div",3)(5,"div",4)(6,"mat-icon"),Q(7,"search"),U(),B(8,"input",5),Ro("ngModelChange",function(i){return Ho(l.searchQuery,i)||(l.searchQuery=i),i}),Re("input",function(){return l.onSearch()}),U(),ft(9,Tee,2,0,"mat-icon",6),U(),ft(10,Mee,3,0,"div",7),U(),Mn(11,"div",8),B(12,"button",9),Re("click",function(){return l.onConfirm()}),Q(13," Confirm Location "),U()()),t&2&&(ne(8),Oo("ngModel",l.searchQuery),ne(),mt(l.searchQuery?9:-1),ne(),mt(l.cityResults.length>0?10:-1),ne(2),bt("disabled",!l.selectedCoords))},dependencies:[Li,Nl,Us,Da,nl,Xi,Zi],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-backdrop);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:var(--z-backdrop)}.selector-container[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:var(--z-popup);pointer-events:none;display:flex;flex-direction:column;align-items:center;padding:20px;gap:20px;background-color:transparent}.instruction-text[_ngcontent-%COMP%]{pointer-events:all;background:var(--color-dark-gray);color:var(--color-white);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:var(--font-weight-semibold);border:1px solid var(--color-light-gray);box-shadow:0 4px 12px #0000004d;text-align:center}.map[_ngcontent-%COMP%]{flex:1;width:100%;border-radius:20px;overflow:hidden;pointer-events:all;box-shadow:0 8px 24px #0006}.confirm-btn[_ngcontent-%COMP%]{pointer-events:all;min-width:250px;box-shadow:0 4px 12px #0000004d}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.confirm-btn[_ngcontent-%COMP%]:disabled:hover{filter:grayscale(1);transform:none}.search-section[_ngcontent-%COMP%]{width:100%;max-width:400px;position:relative;pointer-events:all;z-index:2100}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;padding:8px 16px;box-shadow:0 4px 12px #0000004d}.search-bar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);margin-right:8px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;color:#fff;font-size:16px;outline:none}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--color-gray)}.clear-icon[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-gray);margin-left:8px}.clear-icon[_ngcontent-%COMP%]:hover{color:#fff}.search-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;margin-top:8px;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px #00000080;z-index:2200}.result-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;transition:background .2s;color:#fff}.result-item[_ngcontent-%COMP%]:hover{background:#ffffff1a}.result-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);font-size:20px;width:20px;height:20px}"]})};var eO=(r,n)=>n.id;function Dee(r,n){r&1&&(B(0,"div",6),Q(1,"Loading..."),U())}function Aee(r,n){if(r&1&&Mn(0,"img",12),r&2){let t=re(3);bt("src",t.user.profileImage,Gr)}}function Pee(r,n){if(r&1&&(B(0,"div",13),Q(1),U()),r&2){let t=re(3);ne(),xt(t.getInitials(t.user.name))}}function Oee(r,n){if(r&1&&(B(0,"p",23),Q(1),U()),r&2){let t=re(3);ne(),mr(" ",t.user.email," ")}}function Ree(r,n){if(r&1&&(B(0,"p",24),Q(1),U()),r&2){let t=re(3);ne(),xt(t.user.description)}}function kee(r,n){if(r&1){let t=It();B(0,"button",27),Re("click",function(h){Pe(t);let i=re(4);return Oe(i.toggleNotifications(h))}),B(1,"mat-icon"),Q(2),U()()}if(r&2){let t=re(4);fn("active",t.notificationsEnabled),bt("disabled",t.notificationsLoading),ne(2),xt(t.notificationsEnabled?"notifications":"notifications_off")}}function Fee(r,n){if(r&1){let t=It();B(0,"div",17)(1,"button",25),Re("click",function(){Pe(t);let h=re(3);return Oe(h.toggleFollow())}),Q(2),U(),ft(3,kee,3,4,"button",26),U()}if(r&2){let t=re(3);ne(),fn("following",t.isFollowing),ne(),mr(" ",t.isFollowing?"Following":"Follow"," "),ne(),mt(t.isFollowing?3:-1)}}function Lee(r,n){if(r&1){let t=It();B(0,"div",8)(1,"div",11),ft(2,Aee,1,1,"img",12)(3,Pee,2,1,"div",13),U(),B(4,"h3",14),Q(5),U(),Ui(6,Oee,2,1,"p",15)(7,Ree,2,1,"p",16),ft(8,Fee,4,4,"div",17),B(9,"div",18)(10,"div",19),Re("click",function(){Pe(t);let h=re(2);return Oe(h.showFollowers())}),B(11,"span",20),Q(12),U(),B(13,"span",21),Q(14,"Followers"),U()(),Mn(15,"div",22),B(16,"div",19),Re("click",function(){Pe(t);let h=re(2);return Oe(h.showFollowing())}),B(17,"span",20),Q(18),U(),B(19,"span",21),Q(20,"Following"),U()(),Mn(21,"div",22),B(22,"div",19),Re("click",function(){Pe(t);let h=re(2);return Oe(h.showEvents())}),B(23,"span",20),Q(24),U(),B(25,"span",21),Q(26,"Events"),U()()()()}if(r&2){let t=re(2);ne(2),mt(t.user.profileImage?2:3),ne(3),xt(t.user.name),ne(),bt("ngIf",t.user.email&&t.currentUserId&&t.user.id.toString()===t.currentUserId),ne(),bt("ngIf",t.user.description),ne(),mt(t.currentUserId&&t.user.id.toString()!==t.currentUserId?8:-1),ne(4),xt(t.user.followersCount||0),ne(6),xt(t.user.followingCount||0),ne(6),xt(t.user.approvedEventsCount||0)}}function Nee(r,n){if(r&1&&Mn(0,"img",35),r&2){let t=re().$implicit;bt("src",t.profileImage,Gr)}}function zee(r,n){if(r&1&&(B(0,"div",36),Q(1),U()),r&2){let t=re().$implicit,l=re(4);ne(),xt(l.getInitials(t.name))}}function Bee(r,n){if(r&1){let t=It();B(0,"button",40),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re(4);return Oe(i.onListUnfollow(h))}),Q(1,"Unfollow"),U()}}function Vee(r,n){if(r&1){let t=It();B(0,"button",41),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re(4);return Oe(i.onListFollow(h))}),Q(1,"Follow"),U()}}function Uee(r,n){if(r&1&&ft(0,Bee,2,0,"button",38)(1,Vee,2,0,"button",39),r&2){let t=re().$implicit,l=re(4);mt(l.myFollowingIds.has(t.id.toString())?0:1)}}function jee(r,n){if(r&1){let t=It();B(0,"div",32)(1,"div",34),Re("click",function(){let h=Pe(t).$implicit,i=re(4);return Oe(i.onOpenProfileFromList(h))}),ft(2,Nee,1,1,"img",35)(3,zee,2,1,"div",36),B(4,"span",37),Q(5),U()(),ft(6,Uee,2,1),U()}if(r&2){let t=n.$implicit,l=re(4);ne(2),mt(t.profileImage?2:3),ne(3),xt(t.name),ne(),mt(l.currentUserId&&t.id.toString()!==l.currentUserId?6:-1)}}function $ee(r,n){r&1&&(B(0,"div",33),Q(1,"No users found."),U())}function Hee(r,n){if(r&1&&(B(0,"div",31),$i(1,jee,7,3,"div",32,eO),ft(3,$ee,2,0,"div",33),U()),r&2){let t=re(3);ne(),Hi(t.userList),ne(2),mt(t.userList.length===0?3:-1)}}function Gee(r,n){r&1&&(B(0,"div",6),Q(1,"Loading list..."),U())}function qee(r,n){if(r&1){let t=It();B(0,"div",9)(1,"div",28)(2,"button",29),Re("click",function(){Pe(t);let h=re(2);return Oe(h.onClose())}),B(3,"mat-icon"),Q(4,"arrow_back"),U()(),B(5,"h3"),Q(6),U()(),Ui(7,Hee,4,1,"div",30)(8,Gee,2,0,"ng-template",null,0,ky),U()}if(r&2){let t=Al(9),l=re(2);ne(6),xt(l.view==="followers"?"Followers":"Following"),ne(),bt("ngIf",!l.loadingList)("ngIfElse",t)}}function Wee(r,n){r&1&&(B(0,"div",6),Q(1,"Loading events..."),U())}function Zee(r,n){r&1&&(B(0,"div",33),Q(1,"No upcoming events."),U())}function Xee(r,n){if(r&1&&(B(0,"div",43)(1,"div",44)(2,"p",45),Q(3),U(),B(4,"p",46)(5,"mat-icon",47),Q(6,"event"),U(),B(7,"span"),Q(8),U(),B(9,"mat-icon",47),Q(10,"place"),U(),B(11,"span"),Q(12),U()()(),B(13,"div",48)(14,"span",49)(15,"mat-icon"),Q(16,"group"),U(),B(17,"span"),Q(18),U()(),B(19,"span",49)(20,"mat-icon"),Q(21,"euro"),U(),B(22,"span"),Q(23),U()()()()),r&2){let t=n.$implicit,l=re(4);ne(3),xt(t.title),ne(5),xt(l.formatEventDate(t)),ne(4),xt(t.city),ne(6),mr("",l.eventStats(t).participants," participants"),ne(5),xt(l.eventStats(t).cost)}}function Yee(r,n){if(r&1&&$i(0,Xee,24,5,"div",43,eO),r&2){let t=re(3);Hi(t.upcomingEvents)}}function Kee(r,n){r&1&&(B(0,"div",6),Q(1,"Loading events..."),U())}function Qee(r,n){r&1&&(B(0,"div",33),Q(1,"No past events."),U())}function Jee(r,n){if(r&1&&(B(0,"div",50)(1,"div",44)(2,"p",45),Q(3),U(),B(4,"p",46)(5,"mat-icon",47),Q(6,"event"),U(),B(7,"span"),Q(8),U(),B(9,"mat-icon",47),Q(10,"place"),U(),B(11,"span"),Q(12),U()()(),B(13,"div",48)(14,"span",49)(15,"mat-icon"),Q(16,"group"),U(),B(17,"span"),Q(18),U()(),B(19,"span",49)(20,"mat-icon"),Q(21,"euro"),U(),B(22,"span"),Q(23),U()()()()),r&2){let t=n.$implicit,l=re(4);ne(3),xt(t.title),ne(5),xt(l.formatEventDate(t)),ne(4),xt(t.city),ne(6),mr("",l.eventStats(t).participants," participants"),ne(5),xt(l.eventStats(t).cost)}}function ete(r,n){if(r&1&&$i(0,Jee,24,5,"div",50,eO),r&2){let t=re(3);Hi(t.pastEvents)}}function tte(r,n){if(r&1&&(B(0,"div",10)(1,"div",42)(2,"h4"),Q(3,"Upcoming"),U(),ft(4,Wee,2,0,"div",6)(5,Zee,2,0,"div",33)(6,Yee,2,0),U(),B(7,"div",42)(8,"h4"),Q(9,"Past"),U(),ft(10,Kee,2,0,"div",6)(11,Qee,2,0,"div",33)(12,ete,2,0),U()()),r&2){let t=re(2);ne(4),mt(t.loadingEvents?4:t.upcomingEvents.length===0?5:6),ne(6),mt(t.loadingEvents?10:t.pastEvents.length===0?11:12)}}function nte(r,n){if(r&1&&(ft(0,Lee,27,8,"div",8),ft(1,qee,10,3,"div",9),ft(2,tte,13,2,"div",10)),r&2){let t=re();mt(t.view==="profile"?0:-1),ne(),mt(t.view==="followers"||t.view==="following"?1:-1),ne(),mt(t.view==="events"?2:-1)}}function ite(r,n){r&1&&(B(0,"div",7),Q(1,"Unable to load profile."),U())}var BS=class r{constructor(n,t){this.userService=n;this.eventService=t}userId=null;currentUserId=null;close=new Zt;openProfile=new Zt;user=null;isFollowing=!1;loading=!1;notificationsEnabled=!1;notificationsLoading=!1;view="profile";userList=[];loadingList=!1;myFollowingIds=new Set;loadingEvents=!1;upcomingEvents=[];pastEvents=[];ngOnChanges(n){n.userId&&this.userId&&(this.loadUser(),this.checkIfFollowing())}onClose(){this.view!=="profile"?this.view="profile":this.close.emit()}getViewTitle(){switch(this.view){case"followers":return"Followers";case"following":return"Following";case"events":return"Events";default:return"Profile"}}loadUser(){this.userId&&(this.loading=!0,this.userService.getUserById(this.userId).subscribe({next:n=>{this.user=n,this.loading=!1},error:n=>{console.error("Error loading user profile",n),this.loading=!1}}))}checkIfFollowing(){!this.userId||!this.currentUserId||this.userService.isFollowing(this.currentUserId,this.userId).subscribe({next:n=>{this.isFollowing=n.isFollowing,this.isFollowing?this.loadNotificationPreference():this.notificationsEnabled=!1},error:n=>console.error(n)})}toggleFollow(){!this.userId||!this.currentUserId||(this.isFollowing?confirm("Are you sure you want to unfollow this user?")&&this.userService.unfollowUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!1,this.user&&(this.user.followersCount=(this.user.followersCount||1)-1),this.userService.notifyUserUpdate()},error:n=>console.error(n)}):this.userService.followUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.user&&(this.user.followersCount=(this.user.followersCount||0)+1),this.userService.notifyUserUpdate()},error:n=>console.error(n)}))}getInitials(n){return n?n.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):""}showFollowers(){this.userId&&(this.view="followers",this.loadingList=!0,this.userService.getFollowers(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}showFollowing(){this.userId&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}fetchMyFollowing(){if(!this.currentUserId){this.loadingList=!1;return}this.userService.getFollowing(this.currentUserId).subscribe({next:n=>{this.myFollowingIds=new Set(n.map(t=>t.id.toString())),this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}})}onListFollow(n){this.currentUserId&&this.userService.followUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.add(n.id.toString()),this.userService.notifyUserUpdate()},error:t=>console.error(t)})}onOpenProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}onListUnfollow(n){this.currentUserId&&confirm(`Are you sure you want to unfollow ${n.name}?`)&&this.userService.unfollowUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.delete(n.id.toString()),this.userService.notifyUserUpdate()},error:t=>console.error(t)})}showEvents(){this.userId&&(this.view="events",!(this.upcomingEvents.length||this.pastEvents.length||this.loadingEvents)&&(this.loadingEvents=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>{let t=new Date;this.upcomingEvents=[],this.pastEvents=[],n.forEach(l=>{new Date(`${l.date}T${l.endTime||l.startTime||"00:00"}`).getTime()>=t.getTime()?this.upcomingEvents.push(l):this.pastEvents.push(l)}),this.upcomingEvents.sort((l,h)=>new Date(`${l.date}T${l.startTime||"00:00"}`).getTime()-new Date(`${h.date}T${h.startTime||"00:00"}`).getTime()),this.pastEvents.sort((l,h)=>new Date(`${h.date}T${h.startTime||"00:00"}`).getTime()-new Date(`${l.date}T${l.startTime||"00:00"}`).getTime()),this.loadingEvents=!1},error:n=>{console.error("Error loading events by user",n),this.loadingEvents=!1}})))}formatEventDate(n){let t=n.date?new Date(`${n.date}T00:00:00`):null,l=n.startTime?n.startTime.slice(0,5):"",h=n.endTime?n.endTime.slice(0,5):"",i=t?t.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",E=l&&h?`${l} - ${h}`:l||h;return[i,E].filter(Boolean).join(" \u2022 ")}eventStats(n){let t=n.occupiedSpots??0,l=n.nPartecipants??null,h=`${t}${l?`/${l}`:""}`,i;l!=null&&(i=Math.max(l-t,0).toString());let E=n.costPerPerson==null||n.costPerPerson===0?"Free":n.costPerPerson.toString();return{participants:h,freeSpots:i,cost:E}}toggleNotifications(n){if(n?.stopPropagation(),!this.currentUserId||!this.userId||!this.isFollowing)return;let t=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,this.userId,t).subscribe({next:l=>{this.notificationsEnabled=l.enabled,this.notificationsLoading=!1},error:l=>{console.error("Error updating follow notifications",l),this.notificationsLoading=!1}})}loadNotificationPreference(){!this.currentUserId||!this.userId||(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,this.userId).subscribe({next:n=>{this.notificationsEnabled=!!n.enabled,this.notificationsLoading=!1},error:n=>{console.error("Error loading follow notification preference",n),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(t){return new(t||r)(Bt(_s),Bt(js))};static \u0275cmp=In({type:r,selectors:[["app-user-profile-modal"]],inputs:{userId:"userId",currentUserId:"currentUserId"},outputs:{close:"close",openProfile:"openProfile"},features:[Vr],decls:14,vars:6,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"back-btn","mobile-only",3,"click"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"loading-spinner"],[1,"error-state"],[1,"profile-content"],[1,"list-view"],[1,"events-view"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"user-name"],["class","user-email",4,"ngIf"],["class","user-description",4,"ngIf"],[1,"follow-actions"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"user-email"],[1,"user-description"],[1,"button","follow-main-btn",3,"click"],[1,"bell-btn",3,"active","disabled"],[1,"bell-btn",3,"click","disabled"],[1,"list-header"],[1,"back-btn",3,"click"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],[1,"user-item"],[1,"empty-list"],[1,"user-info",3,"click"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"list-username"],[1,"unfollow-btn","small-btn"],[1,"follow-btn","small-btn"],[1,"unfollow-btn","small-btn",3,"click"],[1,"follow-btn","small-btn",3,"click"],[1,"events-section"],[1,"event-card"],[1,"event-card-header"],[1,"event-title"],[1,"event-sub"],[1,"inline-icon"],[1,"event-stats"],[1,"pill","stat-pill"],[1,"event-card","past"]],template:function(t,l){t&1&&(B(0,"div",1),Re("click",function(){return l.onClose()}),B(1,"div",2),Re("click",function(i){return i.stopPropagation()}),B(2,"div",3)(3,"button",4),Re("click",function(){return l.onClose()}),B(4,"mat-icon"),Q(5,"arrow_back"),U()(),B(6,"h2"),Q(7),U(),B(8,"button",5),Re("click",function(){return l.onClose()}),B(9,"mat-icon"),Q(10,"close"),U()()(),ft(11,Dee,2,0,"div",6)(12,nte,3,3)(13,ite,2,0,"div",7),U()()),t&2&&(ne(),fn("events-mode",l.view==="events"),ne(5),fn("yellow-title",l.view!=="profile"),ne(),xt(l.getViewTitle()),ne(4),mt(l.loading?11:l.user?12:13))},dependencies:[Li,Ps,Xi,Zi],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000000b3;display:flex;justify-content:center;align-items:center;z-index:2000}.modal-container[_ngcontent-%COMP%]{background:radial-gradient(circle at 15% 20%,rgba(252,195,36,.12),transparent 34%),linear-gradient(160deg,#1a1a1a,#0f0f0f 60%,#080808);width:90%;max-width:400px;border-radius:16px;padding:24px;color:#fff;box-shadow:0 10px 25px #00000080;max-height:85vh;display:flex;flex-direction:column;overflow:hidden}.modal-container.events-mode[_ngcontent-%COMP%]{background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;padding:24px 32px 80px}.profile-content[_ngcontent-%COMP%]{padding:0 8px}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-top:2px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;line-height:1.2}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{justify-content:space-between;gap:16px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:right;flex:1}}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#888;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.profile-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.avatar-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.profile-image[_ngcontent-%COMP%], .profile-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffb800,#ffdc73);color:#1a1a1a;font-size:36px;font-weight:700;display:flex;align-items:center;justify-content:center}.user-name[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:600}.user-email[_ngcontent-%COMP%]{margin:0;color:#888;font-size:14px}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9;text-align:center}.follow-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;margin:6px 0 12px}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:0;margin-top:16px;background:#ffffff0d;padding:16px 12px;border-radius:12px;width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#ffb800}.stat-label[_ngcontent-%COMP%]{font-size:11px;color:#888;text-transform:uppercase;letter-spacing:.5px}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a;flex-shrink:0}.follow-main-btn[_ngcontent-%COMP%]{width:100%;max-width:220px;margin:0 auto;color:var(--color-black)!important}.follow-main-btn[_ngcontent-%COMP%]:not(.following){background-color:var(--color-accent)}.follow-main-btn.following[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.bell-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#ffffff0f;color:#f1f1f1;display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,border-color .2s ease,transform .1s ease}.bell-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f}.bell-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.bell-btn.active[_ngcontent-%COMP%]{border-color:var(--color-accent);background:#fbbc042e;color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.events-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;padding-right:4px;scrollbar-width:thin;scrollbar-color:var(--color-bit-gray) transparent;max-height:500px}.events-section[_ngcontent-%COMP%]{background:#ffffff0a;padding:12px;border-radius:14px;display:flex;flex-direction:column;gap:10px;border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 16px #0000004d}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.events-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;text-transform:uppercase;letter-spacing:.5px;color:#cfcfcf}.event-card[_ngcontent-%COMP%]{background:#ffffff0f;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 16px #0000004d}.event-card.past[_ngcontent-%COMP%]{opacity:.85}.event-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.event-title[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:800;color:#fdfdfd}.event-sub[_ngcontent-%COMP%]{margin:2px 0 0;font-size:13px;color:#d6d6d6;display:flex;align-items:center;gap:8px}.event-sub[_ngcontent-%COMP%]   .inline-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:18px;width:18px;height:18px;line-height:18px;flex-shrink:0}.event-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;align-items:center}.stat-pill[_ngcontent-%COMP%]{border-color:#ffffff26;background:#ffffff14;color:#f5f5f5;font-size:12px;padding:7px 9px;gap:5px;border-radius:999px;display:inline-flex;align-items:center}.stat-pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;line-height:16px;color:var(--color-accent);flex-shrink:0}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;line-height:0}.user-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:12px;padding-right:4px}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;background:#ffffff0d;border-radius:8px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%], .list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}.list-username[_ngcontent-%COMP%]{font-weight:500;font-size:14px}.small-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600;cursor:pointer;border:none}.small-btn.follow-btn[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a}.small-btn.unfollow-btn[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff}.loading-spinner[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-list[_ngcontent-%COMP%]{text-align:center;color:#888;padding:20px}"]})};function rte(r,n){if(r&1){let t=It();B(0,"div",2)(1,"a",10),Re("click",function(){Pe(t);let h=re();return Oe(h.openSignUp())}),Q(2,"Sign Up"),U(),B(3,"a",10),Re("click",function(){Pe(t);let h=re();return Oe(h.openSignIn())}),Q(4,"Sign In"),U()()}}function ote(r,n){if(r&1){let t=It();B(0,"app-action-bar",11),Re("action",function(h){Pe(t);let i=re();return Oe(i.onMenuAction(h))})("openProfile",function(h){Pe(t);let i=re();return Oe(i.openUserProfile(h))})("openChatFromNotification",function(h){Pe(t);let i=re();return Oe(i.onChatNotification(h))}),U(),B(1,"input",12),Re("change",function(h){Pe(t);let i=re();return Oe(i.onFileSelected(h))}),U()}if(r&2){let t=re();bt("loggedUser",t.loggedUser)}}function ste(r,n){if(r&1){let t=It();B(0,"SignUpPopup",13),Re("switchToSignIn",function(){Pe(t);let h=re();return Oe(h.switchToSignIn())})("close",function(){Pe(t);let h=re();return Oe(h.closeAll())})("signUpSuccess",function(h){Pe(t);let i=re();return Oe(i.openVerifyPopup(h.email,h.token))})("signInSuccess",function(h){Pe(t);let i=re();return Oe(i.onSignInSuccess(h))}),U()}}function ate(r,n){if(r&1){let t=It();B(0,"VerifyEmailPopup",14),Re("close",function(){Pe(t);let h=re();return Oe(h.closeAll())})("resendVerification",function(){Pe(t);let h=re();return Oe(h.resendEmail())}),U()}if(r&2){let t=re();bt("email",t.recentEmail)("token",t.recentToken)("verified",t.emailVerified)}}function lte(r,n){if(r&1){let t=It();B(0,"SignInPopup",15),Re("switchToSignUp",function(){Pe(t);let h=re();return Oe(h.switchToSignUp())})("close",function(){Pe(t);let h=re();return Oe(h.closeAll())})("signInSuccess",function(h){Pe(t);let i=re();return Oe(i.onSignInSuccess(h))}),U()}}function cte(r,n){if(r&1){let t=It();B(0,"app-user-profile-modal",16),Re("close",function(){Pe(t);let h=re();return Oe(h.closeAll())})("openProfile",function(h){Pe(t);let i=re();return Oe(i.openUserProfile(h))}),U()}if(r&2){let t=re();bt("userId",t.selectedUserProfileId)("currentUserId",t.loggedUser?t.loggedUser.id.toString():null)}}function ute(r,n){if(r&1){let t=It();B(0,"CropImagePopup",17),Re("close",function(){Pe(t);let h=re();return Oe(h.showCropPopup=!1)})("imageCropped",function(h){Pe(t);let i=re();return Oe(i.onImageCropped(h))}),U()}if(r&2){let t=re();bt("imageFile",t.selectedImageFile)}}function dte(r,n){if(r&1){let t=It();B(0,"create-event-popup",18,0),Re("close",function(){Pe(t);let h=re();return Oe(h.showCreateEventPopup=!1)})("eventCreated",function(){Pe(t);let h=re();return Oe(h.closeAll())})("openLocationSelector",function(){Pe(t);let h=Al(1),i=re();return i.createEventPopupRef=h,Oe(i.openLocationSelector())}),U()}if(r&2){let t=re();Ds("display",t.showLocationSelector?"none":"block")}}function hte(r,n){if(r&1){let t=It();B(0,"map-location-selector",19),Re("locationSelected",function(h){Pe(t);let i=re();return Oe(i.onLocationSelected(h))})("close",function(){Pe(t);let h=re();return Oe(h.showLocationSelector=!1)}),U()}}function pte(r,n){if(r&1){let t=It();B(0,"event-popup-card",20),Re("close",function(){Pe(t);let h=re();return Oe(h.closeEventPopup())})("participate",function(h){Pe(t);let i=re();return Oe(i.onParticipate(h))})("toggleFavorite",function(){Pe(t);let h=re();return Oe(h.onToggleFavorite())})("openOrganizerProfile",function(h){Pe(t);let i=re();return Oe(i.openUserProfile(h))})("leave",function(h){Pe(t);let i=re();return Oe(i.onLeaveEvent(h))})("deleteEvent",function(h){Pe(t);let i=re();return Oe(i.onDeleteEvent(h))})("shareEvent",function(h){Pe(t);let i=re();return Oe(i.openShare(h))})("openChat",function(h){Pe(t);let i=re();return Oe(i.openChat(h))}),U()}if(r&2){let t=re();bt("event",t.selectedEvent)("eventPosition",t.eventScreenPosition||void 0)("organizerName",t.selectedEvent.organizerName||"")("organizerImage",t.selectedEvent.organizerImage)("currentUserId",t.loggedUser&&t.loggedUser.id?t.loggedUser.id.toString():null)("creatorId",t.selectedEvent.creatorId)}}function fte(r,n){if(r&1){let t=It();B(0,"event-chat-modal",21),Re("close",function(){Pe(t);let h=re();return Oe(h.closeChat())}),U()}if(r&2){let t=re();bt("event",t.chatEvent)("currentUserId",(t.loggedUser==null||t.loggedUser.id==null?null:t.loggedUser.id.toString())||null)}}var VS=class r{constructor(n,t,l,h,i,E){this.route=n;this.router=t;this.authService=l;this.http=h;this.eventService=i;this.userService=E}mapView;showSignUp=!1;showSignIn=!1;showVerifyPopup=!1;showCropPopup=!1;selectedImageFile=null;showCreateEventPopup=!1;showChatModal=!1;showLocationSelector=!1;selectedEvent=null;chatEvent=null;previousSelectedEvent=null;eventScreenPosition=null;showUserProfile=!1;selectedUserProfileId=null;loggedUser=null;recentEmail="";recentToken="";emailVerified=!1;pendingSharedEventId=null;sharedEventRetryCount=0;sharedEventLoading=!1;ngOnInit(){this.refreshLocalUser(),this.checkAdminRedirect(),this.userService.userUpdates$.subscribe(()=>{this.refreshUserFromBackend()}),this.route.queryParams.subscribe(n=>{let t=n.token,l=n.email,h=n.user,i=n.event;if(h&&(this.openUserProfile(h),this.router.navigate([],{relativeTo:this.route,queryParams:{user:null},queryParamsHandling:"merge",replaceUrl:!0})),i){let E=Number(i);Number.isNaN(E)||(this.pendingSharedEventId=E,this.loadSharedEvent()),this.router.navigate([],{relativeTo:this.route,queryParams:{event:null},queryParamsHandling:"merge",replaceUrl:!0})}t&&(this.recentToken=t,this.recentEmail=l||"",this.openVerifyPopup(),this.authService.verifyEmail(t).subscribe({next:E=>{this.emailVerified=!0},error:()=>this.emailVerified=!1}))})}ngAfterViewInit(){this.loadSharedEvent()}checkAdminRedirect(){this.loggedUser&&this.loggedUser.isAdmin&&this.router.navigate(["/admin"])}refreshLocalUser(){let n=localStorage.getItem("user");if(n)try{this.loggedUser=JSON.parse(n)}catch(t){console.error("Error parsing local user",t),localStorage.removeItem("user")}}refreshUserFromBackend(){this.loggedUser&&this.userService.getUserById(this.loggedUser.id).subscribe({next:n=>{if(this.loggedUser={id:n.id||"",name:n.name||n.email||"User",email:n.email||"",description:n.description,profileImage:n.profileImage,followersCount:n.followersCount,followingCount:n.followingCount,isAdmin:n.isAdmin},this.loggedUser?.isAdmin){this.router.navigate(["/admin"]);return}localStorage.setItem("user",JSON.stringify(this.loggedUser)),console.log("User refreshed:",this.loggedUser)},error:n=>console.error("Error refreshing user",n)})}loadSharedEvent(){if(!this.pendingSharedEventId||this.sharedEventLoading)return;let n=this.pendingSharedEventId,t=this.loggedUser?this.loggedUser.id:void 0;this.sharedEventLoading=!0,this.eventService.getEventById(n,t).subscribe({next:l=>{this.sharedEventLoading=!1,this.openSharedEventOnMap(l)},error:l=>{this.sharedEventLoading=!1,this.pendingSharedEventId=null,console.error("Error loading shared event",l)}})}openSharedEventOnMap(n){if(!this.mapView?.map){this.sharedEventRetryCount<12&&(this.sharedEventRetryCount+=1,setTimeout(()=>this.openSharedEventOnMap(n),250));return}this.sharedEventRetryCount=0,this.pendingSharedEventId=null,this.mapView.flyToEvent(n)}openVerifyPopup(n,t){n!==void 0&&(this.recentEmail=n),t!==void 0&&(this.recentToken=t),this.closeAll(),this.showVerifyPopup=!0}resendEmail(){!this.recentToken&&!this.recentEmail||this.authService.resendEmail({oldToken:this.recentToken,email:this.recentEmail}).subscribe({next:n=>{n?.data?.token&&(this.recentToken=n.data.token),this.emailVerified=!1},error:n=>{console.error("Error resending verification email",n)}})}openSignUp(){this.closeAll(),this.showSignUp=!0}openSignIn(){this.closeAll(),this.showSignIn=!0}closeAll(){this.showSignUp=!1,this.showSignIn=!1,this.showVerifyPopup=!1,this.showCropPopup=!1,this.showCreateEventPopup=!1,this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent=null,this.showLocationSelector=!1,this.closeEventPopup(),this.mapView&&(this.mapView.managedPopupType=null),this.showUserProfile=!1,this.selectedUserProfileId=null}openUserProfile(n){console.log("[Home] openUserProfile",n),this.closeAll(),this.selectedUserProfileId=n,this.showUserProfile=!0}openEventPopup(n){this.selectedEvent=n,this.updateCardPosition(),this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.on("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this)),this.mapView.map.on("click",this.onMapClick.bind(this)));let t=this.loggedUser?this.loggedUser.id:void 0;this.eventService.getEventById(n.id,t).subscribe({next:l=>{this.selectedEvent=l,this.updateCardPosition()},error:l=>console.error("Error fetching fresh event data",l)}),setTimeout(()=>{document.addEventListener("click",this.onDocumentClick)},0)}openChat(n){if(!this.loggedUser){this.openSignIn();return}this.selectedEvent&&(this.previousSelectedEvent=this.selectedEvent,this.closeEventPopup()),this.chatEvent=n,this.showChatModal=!0}onChatNotification(n){if(!this.loggedUser){this.openSignIn();return}this.eventService.getEventById(n,this.loggedUser.id).subscribe({next:t=>{this.closeAll(),this.openChat(t)},error:t=>console.error("Error opening chat from notification",t)})}closeChat(){if(this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent){let n=this.previousSelectedEvent;this.previousSelectedEvent=null,this.openEventPopup(n)}}onEventsUpdated(n){if(this.selectedEvent){let t=n.find(l=>l.id===this.selectedEvent.id);t&&(this.selectedEvent=t)}}updateCardPosition(){this.selectedEvent&&this.mapView&&(this.eventScreenPosition=this.mapView.getEventScreenPosition(this.selectedEvent))}onMapClick(n){n.defaultPrevented||this.closeEventPopup()}onDocumentClick=n=>{this.closeEventPopup()};closeEventPopup(){this.selectedEvent=null,this.eventScreenPosition=null,this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this))),document.removeEventListener("click",this.onDocumentClick)}onParticipate(n){if(console.log("onParticipate called for event:",n.id),!this.loggedUser){console.log("User not logged in, opening sign in"),this.openSignIn();return}console.log("Sending request for user:",this.loggedUser.id,"event:",n.id),this.eventService.requestParticipation(n.id,this.loggedUser.id).subscribe({next:()=>{console.log("Request success"),this.selectedEvent&&this.selectedEvent.id===n.id&&(console.log("Updating local state to PENDING"),this.selectedEvent.participationStatus="PENDING")},error:t=>console.error("Error requesting participation",t)})}onLeaveEvent(n){if(!this.loggedUser){this.openSignIn();return}confirm("Are you sure you want to leave the event?")&&this.eventService.leaveEvent(n.id,this.loggedUser.id).subscribe({next:()=>{if(this.selectedEvent&&this.selectedEvent.id===n.id&&(this.selectedEvent.participationStatus="NONE",this.selectedEvent.isParticipating=!1,typeof this.selectedEvent.occupiedSpots=="number"&&this.selectedEvent.occupiedSpots>0&&(this.selectedEvent.occupiedSpots-=1)),this.mapView){let l=this.mapView.events.find(h=>h.id===n.id);l&&(l.participationStatus="NONE",l.isParticipating=!1,typeof l.occupiedSpots=="number"&&l.occupiedSpots>0&&(l.occupiedSpots-=1))}},error:l=>console.error("Error leaving event",l)})}onDeleteEvent(n){if(!this.loggedUser){this.openSignIn();return}if(n.creatorId&&n.creatorId.toString()!==this.loggedUser.id.toString()){console.warn("You are not the eventer of this event");return}confirm("Are you sure you want to delete this event? This action cannot be undone.")&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.mapView&&(this.mapView.events=this.mapView.events.filter(l=>l.id!==n.id),this.mapView.loadEvents?.()),this.closeEventPopup()},error:l=>console.error("Error deleting event",l)})}onToggleFavorite(){this.selectedEvent&&this.mapView&&this.mapView.onToggleFavorite(this.selectedEvent)}openShare(n){this.mapView&&this.mapView.openShare(n)}createEventPopupRef=null;openLocationSelector(){this.showLocationSelector=!0}onLocationSelected(n){this.createEventPopupRef&&this.createEventPopupRef.setLocation(n.lat,n.lng),this.showLocationSelector=!1}switchToSignUp(){this.openSignUp()}switchToSignIn(){this.openSignIn()}onSignInSuccess(n){if(console.log("User received on sign in:",n),this.loggedUser={id:n?.id||"",name:n?.name||n?.email||"User",email:n?.email||"",profileImage:n.profileImage,isAdmin:n.isAdmin},this.loggedUser.isAdmin){this.router.navigate(["/admin"]);return}this.refreshUserFromBackend(),this.closeAll()}logout(){this.loggedUser=null,localStorage.removeItem("user"),this.closeAll()}onMenuAction(n){if(console.log("Menu action:",n),n==="logout")this.logout();else if(n==="change-photo"){let t=document.getElementById("hiddenFileInput");t&&t.click()}else n==="account"?console.log("Navigate to Account"):n==="events"?console.log("Navigate to Events"):n==="add-event"&&(console.log("Create Event clicked"),this.showCreateEventPopup=!0)}onFileSelected(n){let t=n.target.files[0];t&&(this.selectedImageFile=t,this.showCropPopup=!0,n.target.value="")}onImageCropped(n){if(this.loggedUser){let t=new FormData;t.append("file",n,"profile.jpg"),this.http.post(`http://localhost:8080/api/users/${this.loggedUser.id}/image`,t).subscribe({next:l=>{this.loggedUser&&(this.loggedUser.profileImage=l.imageUrl+"?t="+new Date().getTime(),localStorage.setItem("user",JSON.stringify(this.loggedUser)),this.closeAll())},error:l=>console.error("Error uploading image",l)})}}static \u0275fac=function(t){return new(t||r)(Bt(Ia),Bt(gs),Bt(Du),Bt(Eo),Bt(js),Bt(_s))};static \u0275cmp=In({type:r,selectors:[["Home"]],viewQuery:function(t,l){if(t&1&&Sa(Lx,5),t&2){let h;aa(h=la())&&(l.mapView=h.first)}},decls:13,vars:11,consts:[["createEventPopup",""],[1,"home-container"],[1,"top-bar"],[3,"email","token","verified"],[3,"userId","currentUserId"],[3,"eventSelected","mapInteract","requestLogin","eventsUpdated","openUserProfile","userId"],[3,"imageFile"],[3,"display"],[3,"event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"event","currentUserId"],[1,"button",3,"click"],[3,"action","openProfile","openChatFromNotification","loggedUser"],["id","hiddenFileInput","type","file","accept","image/*",2,"display","none",3,"change"],[3,"switchToSignIn","close","signUpSuccess","signInSuccess"],[3,"close","resendVerification","email","token","verified"],[3,"switchToSignUp","close","signInSuccess"],[3,"close","openProfile","userId","currentUserId"],[3,"close","imageCropped","imageFile"],[3,"close","eventCreated","openLocationSelector"],[3,"locationSelected","close"],[3,"close","participate","toggleFavorite","openOrganizerProfile","leave","deleteEvent","shareEvent","openChat","event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"close","event","currentUserId"]],template:function(t,l){t&1&&(B(0,"div",1),ft(1,rte,5,0,"div",2)(2,ote,2,1),ft(3,ste,1,0,"SignUpPopup"),ft(4,ate,1,3,"VerifyEmailPopup",3),ft(5,lte,1,0,"SignInPopup"),ft(6,cte,1,2,"app-user-profile-modal",4),B(7,"map-view",5),Re("eventSelected",function(i){return l.openEventPopup(i)})("mapInteract",function(){return l.closeEventPopup()})("requestLogin",function(){return l.openSignIn()})("eventsUpdated",function(i){return l.onEventsUpdated(i)})("openUserProfile",function(i){return l.openUserProfile(i)}),U(),ft(8,ute,1,1,"CropImagePopup",6),ft(9,dte,2,2,"create-event-popup",7),ft(10,hte,1,0,"map-location-selector"),ft(11,pte,1,6,"event-popup-card",8),ft(12,fte,1,2,"event-chat-modal",9),U()),t&2&&(ne(),mt(l.loggedUser?2:1),ne(2),mt(l.showSignUp?3:-1),ne(),mt(l.showVerifyPopup?4:-1),ne(),mt(l.showSignIn?5:-1),ne(),mt(l.showUserProfile?6:-1),ne(),bt("userId",l.loggedUser?l.loggedUser.id||"":null),ne(),mt(l.showCropPopup&&l.selectedImageFile?8:-1),ne(),mt(l.showCreateEventPopup?9:-1),ne(),mt(l.showLocationSelector?10:-1),ne(),mt(l.selectedEvent?11:-1),ne(),mt(l.showChatModal&&l.chatEvent?12:-1))},dependencies:[Lx,SS,TS,IS,RS,kS,FS,LS,NS,BS,q_],styles:[".top-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;top:20px;right:20px;gap:8px;z-index:1000;background:var(--color-dark-gray);padding:8px;border-radius:16px;box-shadow:0 4px 20px #0000004d;box-sizing:border-box;border:1px solid var(--color-light-gray);align-items:center}@media (max-width: 768px){.top-bar[_ngcontent-%COMP%]{inset:20px auto auto 50%;transform:translate(-50%);width:90%;justify-content:center;background:#1a1a1af2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.top-bar[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{flex:1;font-size:14px;height:44px}}"]})};var mte=()=>["/"];function gte(r,n){if(r&1){let t=It();B(0,"a",5),Re("click",function(){Pe(t);let h=re();return Oe(h.verifyEmail())}),Q(1,"Verify Email"),U()}}function _te(r,n){r&1&&(B(0,"a",4),Q(1,"Back to Home"),U()),r&2&&bt("routerLink",YA(1,mte))}var US=class r{constructor(n,t){this.route=n;this.authService=t}token="";verified=!1;message="Click the button to verify your email.";ngOnInit(){this.route.queryParams.subscribe(n=>{this.token=n.token||""})}verifyEmail(){this.token&&this.authService.verifyEmail(this.token).subscribe({next:n=>{this.verified=!0,this.message="You have been successfully registered! Signing you in...",n.data&&localStorage.setItem("user",JSON.stringify(n.data)),setTimeout(()=>{window.location.href="/"},1500)},error:n=>{this.verified=!1,this.message=n.error?.error||"Token is invalid or expired."}})}static \u0275fac=function(t){return new(t||r)(Bt(Ia),Bt(Du))};static \u0275cmp=In({type:r,selectors:[["VerifyEmailPage"]],decls:9,vars:2,consts:[[1,"container"],[1,"verify-container"],[1,"header"],[1,"button"],[1,"button",3,"routerLink"],[1,"button",3,"click"]],template:function(t,l){t&1&&(B(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),Q(4,"Email Verification"),U(),B(5,"p"),Q(6),U()(),ft(7,gte,2,0,"a",3)(8,_te,2,2,"a",4),U()()),t&2&&(ne(6),xt(l.message),ne(),mt(l.verified?8:7))},dependencies:[gP,UE],styles:[".container[_ngcontent-%COMP%]{background-color:var(--color-dark-gray);width:100%;height:100vh;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .verify-container[_ngcontent-%COMP%]{text-align:center;position:relative;align-items:center;width:30%;height:auto;background-color:var(--color-gray);border-radius:20px;padding:40px;border:2px solid var(--color-dark-gray);display:flex;flex-direction:column;gap:24px}"]})};var jS=class r{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/admin";getUsers(){return this.http.get(`${this.baseUrl}/users`)}getAllEvents(){return this.http.get(`${this.baseUrl}/events`)}approveEvent(n){return this.http.post(`${this.baseUrl}/events/${n}/approve`,{})}rejectEvent(n,t){return this.http.post(`${this.baseUrl}/events/${n}/reject`,{reason:t})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/events/${n}`)}static \u0275fac=function(t){return new(t||r)(dn(Eo))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};var tO=(r,n)=>n.id;function yte(r,n){r&1&&(B(0,"h1"),Q(1,"Dashboard Overview"),U())}function xte(r,n){r&1&&(B(0,"h1"),Q(1,"Event Management"),U())}function bte(r,n){r&1&&(B(0,"h1"),Q(1,"User Management"),U())}function wte(r,n){if(r&1){let t=It();B(0,"button",36),Re("click",function(){Pe(t);let h=re().$implicit,i=re(2);return Oe(i.approveEvent(h))}),B(1,"mat-icon"),Q(2,"check"),U()(),B(3,"button",37),Re("click",function(){Pe(t);let h=re().$implicit,i=re(2);return Oe(i.rejectEvent(h))}),B(4,"mat-icon"),Q(5,"close"),U()()}}function Cte(r,n){if(r&1){let t=It();B(0,"div",34)(1,"input",38,0),Re("keyup.enter",function(){Pe(t);let h=Al(2),i=re().$implicit,E=re(2);return Oe(E.confirmReject(i,h.value))}),U(),B(3,"button",39),Re("click",function(){Pe(t);let h=Al(2),i=re().$implicit,E=re(2);return Oe(E.confirmReject(i,h.value))}),B(4,"mat-icon"),Q(5,"check"),U()(),B(6,"button",40),Re("click",function(){Pe(t);let h=re().$implicit,i=re(2);return Oe(i.cancelReject(h.id))}),B(7,"mat-icon"),Q(8,"close"),U()()()}}function Ete(r,n){if(r&1&&(B(0,"tr",35)(1,"td",41)(2,"div",42)(3,"div",43)(4,"span",44),Q(5,"Description"),U(),B(6,"span",45),Q(7),U()(),B(8,"div",46)(9,"span",44),Q(10,"Date"),U(),B(11,"span",47),Q(12),U()(),B(13,"div",46)(14,"span",44),Q(15,"Time"),U(),B(16,"span",47),Q(17),U()(),B(18,"div",46)(19,"span",44),Q(20,"City"),U(),B(21,"span",47),Q(22),U()(),B(23,"div",46)(24,"span",44),Q(25,"Capacity"),U(),B(26,"span",47),Q(27),U()(),B(28,"div",46)(29,"span",44),Q(30,"Cost"),U(),B(31,"span",47),Q(32),U()(),B(33,"div",46)(34,"span",44),Q(35,"Coordinates"),U(),B(36,"span",47),Q(37),U()(),B(38,"div",46)(39,"span",44),Q(40,"Created"),U(),B(41,"span",47),Q(42),U()(),B(43,"div",46)(44,"span",44),Q(45,"Organizer"),U(),B(46,"span",47),Q(47),U()(),B(48,"div",46)(49,"span",44),Q(50,"Event ID"),U(),B(51,"span",47),Q(52),U()()()()()),r&2){let t=re().$implicit;ne(7),xt(t.description||"No description provided."),ne(5),xt(t.date||"-"),ne(5),ca("",t.startTime||"-"," - ",t.endTime||"-"),ne(5),xt(t.city||"-"),ne(5),xt(t.nPartecipants||"-"),ne(5),xt(t.costPerPerson!=null?t.costPerPerson+" EUR":"Free"),ne(5),xt(t.latitude!=null&&t.longitude!=null?t.latitude+", "+t.longitude:"-"),ne(5),xt(t.createdAt||"-"),ne(5),xt(t.organizerName||t.organizer||"Unknown"),ne(5),mr("#",t.id)}}function Ste(r,n){if(r&1){let t=It();B(0,"tr")(1,"td")(2,"div",28)(3,"strong"),Q(4),U(),B(5,"span",29),Q(6),U()()(),B(7,"td")(8,"div",30),Mn(9,"img",31),B(10,"span"),Q(11),U()()(),B(12,"td"),Q(13),U(),B(14,"td")(15,"div",32)(16,"button",33),Re("click",function(){let h=Pe(t).$implicit,i=re(2);return Oe(i.toggleDetails(h.id))}),B(17,"mat-icon"),Q(18),U()(),ft(19,wte,6,0)(20,Cte,9,0,"div",34),U()()(),ft(21,Ete,53,11,"tr",35)}if(r&2){let t=n.$implicit,l=re(2);ne(4),xt(t.title),ne(2),xt(t.city),ne(3),bt("src",t.organizerImg||"assets/img/default-avatar.png",Gr),ne(2),xt(t.organizer),ne(2),xt(t.date),ne(5),xt(l.expandedEventId===t.id?"expand_less":"info"),ne(),mt(l.eventsCurrentlyRejecting.includes(t.id)?20:19),ne(2),mt(l.expandedEventId===t.id?21:-1)}}function Tte(r,n){r&1&&(B(0,"tr")(1,"td",48),Q(2,"No pending requests."),U()())}function Ite(r,n){if(r&1){let t=It();B(0,"div",9)(1,"div",10),Re("click",function(){Pe(t);let h=re();return Oe(h.setView("users"))}),B(2,"div",11)(3,"mat-icon"),Q(4,"people"),U()(),B(5,"div",12)(6,"span",13),Q(7),U(),B(8,"span",14),Q(9,"Registered Users"),U()()(),B(10,"div",10),Re("click",function(){Pe(t);let h=re();return Oe(h.setView("events"))}),B(11,"div",15)(12,"mat-icon"),Q(13,"event"),U()(),B(14,"div",12)(15,"span",13),Q(16),U(),B(17,"span",14),Q(18,"Total Events"),U()()(),B(19,"div",16)(20,"div",17)(21,"mat-icon"),Q(22,"assignment"),U()(),B(23,"div",12)(24,"span",13),Q(25),U(),B(26,"span",14),Q(27,"Pending Approval"),U()()()(),B(28,"div",18)(29,"div",19)(30,"div",20)(31,"h3"),Q(32,"Recent Requests"),U(),B(33,"button",21),Re("click",function(){Pe(t);let h=re();return Oe(h.setView("events"))}),Q(34,"See all"),U()(),B(35,"div",22)(36,"table")(37,"thead")(38,"tr")(39,"th"),Q(40,"EVENT"),U(),B(41,"th"),Q(42,"EVENTER"),U(),B(43,"th"),Q(44,"DATE"),U(),B(45,"th"),Q(46,"ACTIONS"),U()()(),B(47,"tbody"),$i(48,Ste,22,8,null,null,tO),ft(50,Tte,3,0,"tr"),U()()()(),B(51,"div",23)(52,"h3"),Q(53,"Quick Actions"),U(),B(54,"div",24)(55,"button",25),Re("click",function(){Pe(t);let h=re();return Oe(h.setView("events"))}),B(56,"mat-icon",26),Q(57,"verified_user"),U(),B(58,"span"),Q(59,"Manage Events"),U()(),B(60,"button",27),Re("click",function(){Pe(t);let h=re();return Oe(h.setView("users"))}),B(61,"mat-icon",26),Q(62,"search"),U(),B(63,"span"),Q(64,"Search Users"),U()()()()()}if(r&2){let t=re();ne(7),xt(t.totalUsers),ne(9),xt(t.totalEvents),ne(9),xt(t.pendingEventsCount),ne(23),Hi(t.recentRequests.slice(0,5)),ne(2),mt(t.recentRequests.length===0?50:-1)}}function Mte(r,n){r&1&&(B(0,"span",52),Q(1,"Approved"),U())}function Dte(r,n){r&1&&(B(0,"span",53),Q(1,"Pending"),U())}function Ate(r,n){if(r&1){let t=It();B(0,"button",36),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re(2);return Oe(i.approveEvent(h))}),B(1,"mat-icon"),Q(2,"check"),U()(),B(3,"button",37),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re(2);return Oe(i.rejectEvent(h))}),B(4,"mat-icon"),Q(5,"close"),U()()}}function Pte(r,n){if(r&1){let t=It();B(0,"div",34)(1,"input",38,0),Re("keyup.enter",function(){Pe(t);let h=Al(2),i=re(2).$implicit,E=re(2);return Oe(E.confirmReject(i,h.value))}),U(),B(3,"button",39),Re("click",function(){Pe(t);let h=Al(2),i=re(2).$implicit,E=re(2);return Oe(E.confirmReject(i,h.value))}),B(4,"mat-icon"),Q(5,"check"),U()(),B(6,"button",40),Re("click",function(){Pe(t);let h=re(2).$implicit,i=re(2);return Oe(i.cancelReject(h.id))}),B(7,"mat-icon"),Q(8,"close"),U()()()}}function Ote(r,n){if(r&1&&ft(0,Ate,6,0)(1,Pte,9,0,"div",34),r&2){let t=re().$implicit,l=re(2);mt(l.eventsCurrentlyRejecting.includes(t.id)?1:0)}}function Rte(r,n){if(r&1){let t=It();B(0,"button",55),Re("click",function(){Pe(t);let h=re().$implicit,i=re(2);return Oe(i.deleteEvent(h))}),B(1,"mat-icon"),Q(2,"delete_outline"),U()()}}function kte(r,n){if(r&1&&(B(0,"tr",35)(1,"td",56)(2,"div",42)(3,"div",43)(4,"span",44),Q(5,"Description"),U(),B(6,"span",45),Q(7),U()(),B(8,"div",46)(9,"span",44),Q(10,"Date"),U(),B(11,"span",47),Q(12),U()(),B(13,"div",46)(14,"span",44),Q(15,"Time"),U(),B(16,"span",47),Q(17),U()(),B(18,"div",46)(19,"span",44),Q(20,"City"),U(),B(21,"span",47),Q(22),U()(),B(23,"div",46)(24,"span",44),Q(25,"Capacity"),U(),B(26,"span",47),Q(27),U()(),B(28,"div",46)(29,"span",44),Q(30,"Cost"),U(),B(31,"span",47),Q(32),U()(),B(33,"div",46)(34,"span",44),Q(35,"Coordinates"),U(),B(36,"span",47),Q(37),U()(),B(38,"div",46)(39,"span",44),Q(40,"Created"),U(),B(41,"span",47),Q(42),U()(),B(43,"div",46)(44,"span",44),Q(45,"Organizer"),U(),B(46,"span",47),Q(47),U()(),B(48,"div",46)(49,"span",44),Q(50,"Event ID"),U(),B(51,"span",47),Q(52),U()()()()()),r&2){let t=re().$implicit;ne(7),xt(t.description||"No description provided."),ne(5),xt(t.date||"-"),ne(5),ca("",t.startTime||"-"," - ",t.endTime||"-"),ne(5),xt(t.city||"-"),ne(5),xt(t.nPartecipants||"-"),ne(5),xt(t.costPerPerson!=null?t.costPerPerson+" EUR":"Free"),ne(5),xt(t.latitude!=null&&t.longitude!=null?t.latitude+", "+t.longitude:"-"),ne(5),xt(t.createdAt||"-"),ne(5),xt(t.organizerName||t.organizer||"Unknown"),ne(5),mr("#",t.id)}}function Fte(r,n){if(r&1){let t=It();B(0,"tr")(1,"td"),Q(2),U(),B(3,"td")(4,"div",28)(5,"strong"),Q(6),U(),B(7,"span",29),Q(8),U()()(),B(9,"td")(10,"div",30),Mn(11,"img",31),B(12,"span"),Q(13),U()()(),B(14,"td"),ft(15,Mte,2,0,"span",52)(16,Dte,2,0,"span",53),U(),B(17,"td"),Q(18),U(),B(19,"td")(20,"div",32)(21,"button",33),Re("click",function(){let h=Pe(t).$implicit,i=re(2);return Oe(i.toggleDetails(h.id))}),B(22,"mat-icon"),Q(23),U()(),ft(24,Ote,2,1),Ui(25,Rte,3,0,"button",54),U()()(),ft(26,kte,53,11,"tr",35)}if(r&2){let t=n.$implicit,l=re(2);ne(2),mr("#",t.id),ne(4),xt(t.title),ne(2),xt(t.city),ne(3),bt("src",t.organizerImage||"assets/img/default-avatar.png",Gr),ne(2),xt(t.organizerName||"Unknown"),ne(2),mt(t.isApproved?15:16),ne(3),xt(t.date),ne(5),xt(l.expandedEventId===t.id?"expand_less":"info"),ne(),mt(t.isApproved?-1:24),ne(),bt("ngIf",t.isApproved),ne(),mt(l.expandedEventId===t.id?26:-1)}}function Lte(r,n){if(r&1){let t=It();B(0,"div",8)(1,"div",49)(2,"mat-icon",50),Q(3,"search"),U(),B(4,"input",51),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.searchTermEvents,h)||(i.searchTermEvents=h),Oe(h)}),U()(),B(5,"div",22)(6,"table")(7,"thead")(8,"tr")(9,"th"),Q(10,"ID"),U(),B(11,"th"),Q(12,"EVENT"),U(),B(13,"th"),Q(14,"EVENTER"),U(),B(15,"th"),Q(16,"STATUS"),U(),B(17,"th"),Q(18,"DATE"),U(),B(19,"th"),Q(20,"ACTIONS"),U()()(),B(21,"tbody"),$i(22,Fte,27,11,null,null,tO),U()()()()}if(r&2){let t=re();ne(4),Oo("ngModel",t.searchTermEvents),ne(18),Hi(t.filteredEvents)}}function Nte(r,n){r&1&&(B(0,"span",58),Q(1,"Admin"),U())}function zte(r,n){r&1&&(B(0,"span",59),Q(1,"User"),U())}function Bte(r,n){if(r&1&&(B(0,"tr")(1,"td"),Q(2),U(),B(3,"td")(4,"div",30),Mn(5,"img",31),B(6,"span"),Q(7),U()()(),B(8,"td"),Q(9),U(),B(10,"td"),ft(11,Nte,2,0,"span",58)(12,zte,2,0,"span",59),U()()),r&2){let t=n.$implicit;ne(2),mr("#",t.id),ne(3),bt("src",t.profileImage||"assets/img/default-avatar.png",Gr),ne(2),xt(t.name),ne(2),xt(t.email),ne(2),mt(t.isAdmin?11:12)}}function Vte(r,n){if(r&1){let t=It();B(0,"div",8)(1,"div",49)(2,"mat-icon",50),Q(3,"search"),U(),B(4,"input",57),Ro("ngModelChange",function(h){Pe(t);let i=re();return Ho(i.searchTermUsers,h)||(i.searchTermUsers=h),Oe(h)}),U()(),B(5,"div",22)(6,"table")(7,"thead")(8,"tr")(9,"th"),Q(10,"ID"),U(),B(11,"th"),Q(12,"USER"),U(),B(13,"th"),Q(14,"EMAIL"),U(),B(15,"th"),Q(16,"ROLE"),U()()(),B(17,"tbody"),$i(18,Bte,13,5,"tr",null,tO),U()()()()}if(r&2){let t=re();ne(4),Oo("ngModel",t.searchTermUsers),ne(14),Hi(t.filteredUsers)}}var $S=class r{constructor(n,t){this.router=n;this.adminService=t}users=[];allEvents=[];recentRequests=[];totalUsers=0;totalEvents=0;pendingEventsCount=0;currentView="dashboard";searchTermEvents="";searchTermUsers="";expandedEventId=null;ngOnInit(){this.loadData()}setView(n){this.currentView=n,this.expandedEventId=null}get filteredEvents(){if(!this.searchTermEvents.trim())return this.allEvents;let n=this.searchTermEvents.toLowerCase();return this.allEvents.filter(t=>t.title?.toLowerCase().includes(n)||t.city?.toLowerCase().includes(n)||t.organizerName?.toLowerCase().includes(n))}get filteredUsers(){if(!this.searchTermUsers.trim())return this.users;let n=this.searchTermUsers.toLowerCase();return this.users.filter(t=>t.name?.toLowerCase().includes(n)||t.email?.toLowerCase().includes(n))}loadData(){this.adminService.getUsers().subscribe(n=>{this.users=n,this.calculateStats()}),this.adminService.getAllEvents().subscribe(n=>{this.allEvents=n,this.calculateStats()})}calculateStats(){if(this.totalUsers=this.users.length,this.allEvents){this.totalEvents=this.allEvents.length;let n=this.allEvents.filter(t=>t.isApproved===!1);this.pendingEventsCount=n.length,this.recentRequests=n.map(t=>bi($t({},t),{organizer:t.organizerName||"Unknown",organizerImg:t.organizerImage}))}}toggleDetails(n){this.expandedEventId===n?this.expandedEventId=null:this.expandedEventId=n}approveEvent(n){this.adminService.approveEvent(n.id).subscribe(()=>{this.loadData()})}eventsCurrentlyRejecting=[];rejectEvent(n){this.eventsCurrentlyRejecting.includes(n.id)||this.eventsCurrentlyRejecting.push(n.id)}cancelReject(n){this.eventsCurrentlyRejecting=this.eventsCurrentlyRejecting.filter(t=>t!==n)}confirmReject(n,t){console.log("Confirming reject for event:",n.id,"Reason:",t),this.adminService.rejectEvent(n.id,t).subscribe({next:()=>{console.log("Rejection successful"),this.cancelReject(n.id),this.loadData()},error:l=>{console.error("Rejection failed:",l),alert("Error while rejecting the event.")}})}deleteEvent(n){confirm(`Are you sure you want to permanently delete the event "${n.title}"? This action will remove the event from the map and all user lists. It cannot be undone.`)&&this.adminService.deleteEvent(n.id).subscribe({next:()=>{this.loadData()},error:t=>{console.error("Error deleting event",t),alert("Error deleting the event.")}})}signOut(){localStorage.removeItem("user"),this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||r)(Bt(gs),Bt(jS))};static \u0275cmp=In({type:r,selectors:[["app-admin-dashboard"]],decls:32,vars:10,consts:[["reasonInput",""],[1,"admin-container"],[1,"sidebar"],[1,"logo"],["href","javascript:void(0)",1,"nav-item",3,"click"],[1,"btn-logout",3,"click"],[1,"main-content"],[1,"header"],[1,"full-table-section"],[1,"stats-grid"],[1,"stat-card",3,"click"],[1,"stat-icon","users-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-icon","events-icon"],[1,"stat-card"],[1,"stat-icon","pending-icon"],[1,"dashboard-grid"],[1,"requests-section"],[1,"section-header"],[1,"btn-link",3,"click"],[1,"table-container"],[1,"actions-section"],[1,"quick-actions"],[1,"action-card",3,"click"],[1,"action-icon"],[1,"action-card","outline",3,"click"],[1,"ev-cell-title"],[1,"ev-sub"],[1,"ev-organizer"],[1,"table-avatar",3,"src"],[1,"action-buttons"],["title","View details",1,"btn-icon","info",3,"click"],[1,"inline-reject"],[1,"event-details-row"],["title","Approve",1,"btn-icon","approve",3,"click"],["title","Reject",1,"btn-icon","reject",3,"click"],["type","text","placeholder","Reason...","autoFocus","",1,"input-reason",3,"keyup.enter"],[1,"btn-icon","approve",3,"click"],[1,"btn-icon","reject",3,"click"],["colspan","4"],[1,"event-details"],[1,"detail-item","full"],[1,"detail-label"],[1,"detail-value","description"],[1,"detail-item"],[1,"detail-value"],["colspan","4",1,"no-data"],[1,"search-container"],[1,"search-icon"],["type","text","placeholder","Search events by title, city or eventer...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","approved"],[1,"status-badge","pending"],["class","btn-icon delete","title","Delete Permanently",3,"click",4,"ngIf"],["title","Delete Permanently",1,"btn-icon","delete",3,"click"],["colspan","6"],["type","text","placeholder","Search users by name or email...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","admin"],[1,"status-badge","user"]],template:function(t,l){t&1&&(B(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),Q(4,"LUMO "),B(5,"span"),Q(6,"Admin"),U()()(),B(7,"nav")(8,"a",4),Re("click",function(){return l.setView("dashboard")}),B(9,"mat-icon"),Q(10,"dashboard"),U(),Q(11," Dashboard "),U(),B(12,"a",4),Re("click",function(){return l.setView("events")}),B(13,"mat-icon"),Q(14,"event"),U(),Q(15," Events "),U(),B(16,"a",4),Re("click",function(){return l.setView("users")}),B(17,"mat-icon"),Q(18,"people"),U(),Q(19," Users "),U()(),B(20,"button",5),Re("click",function(){return l.signOut()}),B(21,"mat-icon"),Q(22,"logout"),U(),Q(23," Logout "),U()(),B(24,"div",6)(25,"div",7),ft(26,yte,2,0,"h1")(27,xte,2,0,"h1")(28,bte,2,0,"h1"),U(),ft(29,Ite,65,4),ft(30,Lte,24,1,"div",8),ft(31,Vte,20,1,"div",8),U()()),t&2&&(ne(8),fn("active",l.currentView==="dashboard"),ne(4),fn("active",l.currentView==="events"),ne(4),fn("active",l.currentView==="users"),ne(10),mt(l.currentView==="dashboard"?26:l.currentView==="events"?27:l.currentView==="users"?28:-1),ne(3),mt(l.currentView==="dashboard"?29:-1),ne(),mt(l.currentView==="events"?30:-1),ne(),mt(l.currentView==="users"?31:-1))},dependencies:[Li,Ps,Xi,Zi,Nl,Us,Da,nl],styles:[".admin-container[_ngcontent-%COMP%]{display:flex;height:100vh;background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);color:var(--color-white);font-family:var(--font-stack-headline);overflow:hidden}.sidebar[_ngcontent-%COMP%]{width:250px;background:transparent;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;padding:20px;flex-shrink:0;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.logo[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--color-white);margin:0 0 40px;font-size:20px;font-weight:var(--font-weight-semibold)}.logo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--color-accent)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex-grow:1}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;color:var(--color-light-gray);text-decoration:none;border-radius:var(--radius-sm);transition:all .2s;font-size:14px;font-weight:var(--font-weight-medium)}.nav-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.nav-item.active[_ngcontent-%COMP%], .nav-item[_ngcontent-%COMP%]:hover{background-color:#fcc3241a;color:var(--color-accent)}.nav-item.active[_ngcontent-%COMP%]{border-left:3px solid var(--color-accent)}.btn-logout[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:transparent;border:1px solid var(--color-gray);color:var(--color-light-gray);border-radius:var(--radius-sm);cursor:pointer;margin-top:auto;width:100%;transition:all .2s;font-family:var(--font-stack-headline)}.btn-logout[_ngcontent-%COMP%]:hover{background:var(--color-gray);color:var(--color-white)}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:30px 40px;overflow-y:auto}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;margin:0 0 30px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}.stat-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;display:flex;align-items:center;gap:20px;border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.stat-card[_ngcontent-%COMP%]:hover{border-color:#fcc32480;box-shadow:0 0 15px #fcc3241a;transform:translateY(-2px)}.stat-icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--radius-md);background:#ffffff1a;display:flex;align-items:center;justify-content:center}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}.users-icon[_ngcontent-%COMP%]{background:#ffffff1a}.events-icon[_ngcontent-%COMP%]{background:#fcc3241a}.events-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.pending-icon[_ngcontent-%COMP%]{background:#ffffff1a}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:28px;font-weight:var(--font-weight-bold);color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:13px;color:var(--color-light-gray)}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:20px}.requests-section[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;border:1px solid rgba(255,255,255,.1)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:16px;font-weight:var(--font-weight-semibold)}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;font-size:12px;font-family:var(--font-stack-headline)}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}th[_ngcontent-%COMP%]{text-align:left;color:var(--color-light-gray);font-size:11px;text-transform:uppercase;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.1);font-weight:var(--font-weight-medium)}td[_ngcontent-%COMP%]{padding:16px 0;border-bottom:1px solid rgba(255,255,255,.1);vertical-align:middle}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.ev-cell-title[_ngcontent-%COMP%]{display:flex;flex-direction:column}.ev-cell-title[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-medium)}.ev-sub[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.ev-organizer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.table-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:var(--radius-full);object-fit:cover}.event-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-top:0}.event-details[_ngcontent-%COMP%]{background:#ffffff08;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px 24px}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.detail-item.full[_ngcontent-%COMP%]{grid-column:1 / -1}.detail-label[_ngcontent-%COMP%]{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--color-light-gray)}.detail-value[_ngcontent-%COMP%]{font-size:12px;color:var(--color-white)}.detail-value.description[_ngcontent-%COMP%]{color:#ddd;line-height:1.4;white-space:pre-wrap}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.btn-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.approve[_ngcontent-%COMP%]{background:#10b9811a;color:var(--success)}.approve[_ngcontent-%COMP%]{background:#4caf501a;color:#4caf50}.approve[_ngcontent-%COMP%]:hover{background:#4caf50;color:#fff}.reject[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.reject[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.delete[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.delete[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.info[_ngcontent-%COMP%]{background:#2196f31a;color:#2196f3}.info[_ngcontent-%COMP%]:hover{background:#2196f3;color:#fff}.inline-reject[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center}.input-reason[_ngcontent-%COMP%]{background:var(--color-dark-gray);border:1px solid var(--color-bit-gray);color:var(--color-white);padding:5px 8px;border-radius:4px;width:120px;height:32px;outline:none;font-family:var(--font-stack-headline)}.input-reason[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.actions-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;color:var(--color-white);font-weight:var(--font-weight-semibold)}.quick-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.action-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:24px;padding:20px;display:flex;align-items:center;gap:15px;cursor:pointer;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-medium);transition:transform .2s,border-color .2s;width:100%;text-align:left;font-family:var(--font-stack-headline)}.action-card[_ngcontent-%COMP%]:hover{border-color:var(--color-accent);transform:translateY(-2px)}.action-icon[_ngcontent-%COMP%]{background:transparent;color:var(--color-accent)}.no-data[_ngcontent-%COMP%]{text-align:center;color:var(--color-light-gray);font-style:italic}@media (max-width: 768px){.admin-container[_ngcontent-%COMP%]{flex-direction:column}.sidebar[_ngcontent-%COMP%]{width:100%;flex-direction:row;padding:12px 16px;border-right:none;border-bottom:1px solid var(--color-gray);position:fixed;top:0;left:0;z-index:100;background:var(--color-dark-gray)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{flex-direction:row;gap:8px;flex-grow:0}.nav-item[_ngcontent-%COMP%]{padding:10px 12px;font-size:12px;gap:6px}.nav-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .logo[_ngcontent-%COMP%]{display:none}.btn-logout[_ngcontent-%COMP%]{margin-top:0;margin-left:auto;width:auto;padding:10px 12px}.btn-logout[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.main-content[_ngcontent-%COMP%]{margin-left:0;padding:80px 16px 24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.stat-card[_ngcontent-%COMP%]{padding:16px}.stat-value[_ngcontent-%COMP%]{font-size:22px}table[_ngcontent-%COMP%]{font-size:12px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px 8px}.action-buttons[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-icon[_ngcontent-%COMP%]{width:28px;height:28px}.input-reason[_ngcontent-%COMP%]{width:80px}.event-details[_ngcontent-%COMP%]{grid-template-columns:1fr}.search-input[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 1024px){.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;margin-bottom:24px}.search-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:14px;color:var(--color-light-gray);font-size:20px;width:20px;height:20px;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:12px 16px 12px 44px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background-color:#ffffff0d;color:var(--color-white);font-family:var(--font-stack-headline);font-size:14px;outline:none;transition:border-color .2s,box-shadow .2s}.search-input[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.search-input[_ngcontent-%COMP%]:focus{border-color:var(--color-accent);box-shadow:0 0 0 2px #fcc32433}@media (max-width: 768px){.search-input[_ngcontent-%COMP%]{max-width:100%}}"]})};var e5=(r,n)=>{let t=Ve(gs),l=localStorage.getItem("user");if(l){let h=JSON.parse(l);if(h.isAdmin==="true"||h.isAdmin===!0)return!0}return t.navigate(["/"]),!1};var t5=[{path:"",component:VS},{path:"admin",component:$S,canActivate:[e5]},{path:"verify-email",component:US}];var n5=(r,n)=>n(r).pipe(qa(t=>(console.error("HTTP ERROR intercepted",t),t instanceof Ah?fc(()=>t):fc(()=>t||"Unknown error"))));var i5={providers:[z2(B2([n5])),fP(t5),hD(),e2({eventCoalescing:!0})]};R2($E,i5).catch(r=>console.error(r));
