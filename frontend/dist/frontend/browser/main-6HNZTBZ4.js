var cG=Object.create;var $M=Object.defineProperty,uG=Object.defineProperties,dG=Object.getOwnPropertyDescriptor,hG=Object.getOwnPropertyDescriptors,pG=Object.getOwnPropertyNames,Dw=Object.getOwnPropertySymbols,fG=Object.getPrototypeOf,HM=Object.prototype.hasOwnProperty,DN=Object.prototype.propertyIsEnumerable;var MN=(i,n,e)=>n in i?$M(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e,Ht=(i,n)=>{for(var e in n||={})HM.call(n,e)&&MN(i,e,n[e]);if(Dw)for(var e of Dw(n))DN.call(n,e)&&MN(i,e,n[e]);return i},Ci=(i,n)=>uG(i,hG(n));var Aw=(i,n)=>{var e={};for(var a in i)HM.call(i,a)&&n.indexOf(a)<0&&(e[a]=i[a]);if(i!=null&&Dw)for(var a of Dw(i))n.indexOf(a)<0&&DN.call(i,a)&&(e[a]=i[a]);return e};var Nr=(i,n)=>()=>(n||i((n={exports:{}}).exports,n),n.exports);var mG=(i,n,e,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let d of pG(n))!HM.call(i,d)&&d!==e&&$M(i,d,{get:()=>n[d],enumerable:!(a=dG(n,d))||a.enumerable});return i};var Pw=(i,n,e)=>(e=i!=null?cG(fG(i)):{},mG(n||!i||!i.__esModule?$M(e,"default",{value:i,enumerable:!0}):e,i));var Sr=(i,n,e)=>new Promise((a,d)=>{var r=k=>{try{P(e.next(k))}catch(X){d(X)}},C=k=>{try{P(e.throw(k))}catch(X){d(X)}},P=k=>k.done?a(k.value):Promise.resolve(k.value).then(r,C);P((e=e.apply(i,n)).next())});var bO=Nr((yO,xO)=>{"use strict";(function(i,n){typeof yO=="object"&&typeof xO<"u"?xO.exports=n():typeof define=="function"&&define.amd?define(n):(i=typeof globalThis<"u"?globalThis:i||self,i.mapboxgl=n())})(yO,function(){"use strict";var i,n,e;function a(r,C){if(!i)i=C;else if(!n)n=C;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",k={};i(k),e=C(k),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(e.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}a(["exports"],function(r){var C=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function k(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s*m-h*u;return g?(l[0]=m*(g=1/g),l[1]=-u*g,l[2]=-h*g,l[3]=s*g,l):null}function X(){var l=new P(9);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function oe(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],E=t[7],T=t[8];return l[0]=g*T-v*E,l[1]=h*E-u*T,l[2]=u*v-h*g,l[3]=v*b-m*T,l[4]=s*T-h*b,l[5]=h*m-s*v,l[6]=m*E-g*b,l[7]=u*b-s*E,l[8]=s*g-u*m,l}function Me(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],E=t[6],T=t[7],I=t[8],D=s[0],O=s[1],R=s[2],B=s[3],H=s[4],$=s[5],Y=s[6],J=s[7],ie=s[8];return l[0]=D*u+O*g+R*E,l[1]=D*h+O*v+R*T,l[2]=D*m+O*b+R*I,l[3]=B*u+H*g+$*E,l[4]=B*h+H*v+$*T,l[5]=B*m+H*b+$*I,l[6]=Y*u+J*g+ie*E,l[7]=Y*h+J*v+ie*T,l[8]=Y*m+J*b+ie*I,l}function $e(){var l=new P(16);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function ke(l){var t=new P(16);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=l[3],t[4]=l[4],t[5]=l[5],t[6]=l[6],t[7]=l[7],t[8]=l[8],t[9]=l[9],t[10]=l[10],t[11]=l[11],t[12]=l[12],t[13]=l[13],t[14]=l[14],t[15]=l[15],t}function ht(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Nt(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],E=t[7],T=t[8],I=t[9],D=t[10],O=t[11],R=t[12],B=t[13],H=t[14],$=t[15],Y=s*v-u*g,J=s*b-h*g,ie=s*E-m*g,he=u*b-h*v,le=u*E-m*v,me=h*E-m*b,ye=T*B-I*R,we=T*H-D*R,je=T*$-O*R,Ae=I*H-D*B,We=I*$-O*B,Ke=D*$-O*H,Qe=Y*Ke-J*We+ie*Ae+he*je-le*we+me*ye;return Qe?(l[0]=(v*Ke-b*We+E*Ae)*(Qe=1/Qe),l[1]=(h*We-u*Ke-m*Ae)*Qe,l[2]=(B*me-H*le+$*he)*Qe,l[3]=(D*le-I*me-O*he)*Qe,l[4]=(b*je-g*Ke-E*we)*Qe,l[5]=(s*Ke-h*je+m*we)*Qe,l[6]=(H*ie-R*me-$*J)*Qe,l[7]=(T*me-D*ie+O*J)*Qe,l[8]=(g*We-v*je+E*ye)*Qe,l[9]=(u*je-s*We-m*ye)*Qe,l[10]=(R*le-B*ie+$*Y)*Qe,l[11]=(I*ie-T*le-O*Y)*Qe,l[12]=(v*we-g*Ae-b*ye)*Qe,l[13]=(s*Ae-u*we+h*ye)*Qe,l[14]=(B*J-R*he-H*Y)*Qe,l[15]=(T*he-I*J+D*Y)*Qe,l):null}function Mt(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],E=t[6],T=t[7],I=t[8],D=t[9],O=t[10],R=t[11],B=t[12],H=t[13],$=t[14],Y=t[15],J=s[0],ie=s[1],he=s[2],le=s[3];return l[0]=J*u+ie*v+he*I+le*B,l[1]=J*h+ie*b+he*D+le*H,l[2]=J*m+ie*E+he*O+le*$,l[3]=J*g+ie*T+he*R+le*Y,l[4]=(J=s[4])*u+(ie=s[5])*v+(he=s[6])*I+(le=s[7])*B,l[5]=J*h+ie*b+he*D+le*H,l[6]=J*m+ie*E+he*O+le*$,l[7]=J*g+ie*T+he*R+le*Y,l[8]=(J=s[8])*u+(ie=s[9])*v+(he=s[10])*I+(le=s[11])*B,l[9]=J*h+ie*b+he*D+le*H,l[10]=J*m+ie*E+he*O+le*$,l[11]=J*g+ie*T+he*R+le*Y,l[12]=(J=s[12])*u+(ie=s[13])*v+(he=s[14])*I+(le=s[15])*B,l[13]=J*h+ie*b+he*D+le*H,l[14]=J*m+ie*E+he*O+le*$,l[15]=J*g+ie*T+he*R+le*Y,l}function Xt(l,t,s){var u,h,m,g,v,b,E,T,I,D,O,R,B=s[0],H=s[1],$=s[2];return t===l?(l[12]=t[0]*B+t[4]*H+t[8]*$+t[12],l[13]=t[1]*B+t[5]*H+t[9]*$+t[13],l[14]=t[2]*B+t[6]*H+t[10]*$+t[14],l[15]=t[3]*B+t[7]*H+t[11]*$+t[15]):(h=t[1],m=t[2],g=t[3],v=t[4],b=t[5],E=t[6],T=t[7],I=t[8],D=t[9],O=t[10],R=t[11],l[0]=u=t[0],l[1]=h,l[2]=m,l[3]=g,l[4]=v,l[5]=b,l[6]=E,l[7]=T,l[8]=I,l[9]=D,l[10]=O,l[11]=R,l[12]=u*B+v*H+I*$+t[12],l[13]=h*B+b*H+D*$+t[13],l[14]=m*B+E*H+O*$+t[14],l[15]=g*B+T*H+R*$+t[15]),l}function Vn(l,t,s){var u=s[0],h=s[1],m=s[2];return l[0]=t[0]*u,l[1]=t[1]*u,l[2]=t[2]*u,l[3]=t[3]*u,l[4]=t[4]*h,l[5]=t[5]*h,l[6]=t[6]*h,l[7]=t[7]*h,l[8]=t[8]*m,l[9]=t[9]*m,l[10]=t[10]*m,l[11]=t[11]*m,l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15],l}function sr(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[4],g=t[5],v=t[6],b=t[7],E=t[8],T=t[9],I=t[10],D=t[11];return t!==l&&(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[4]=m*h+E*u,l[5]=g*h+T*u,l[6]=v*h+I*u,l[7]=b*h+D*u,l[8]=E*h-m*u,l[9]=T*h-g*u,l[10]=I*h-v*u,l[11]=D*h-b*u,l}function Hi(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[0],g=t[1],v=t[2],b=t[3],E=t[8],T=t[9],I=t[10],D=t[11];return t!==l&&(l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=m*h-E*u,l[1]=g*h-T*u,l[2]=v*h-I*u,l[3]=b*h-D*u,l[8]=m*u+E*h,l[9]=g*u+T*h,l[10]=v*u+I*h,l[11]=b*u+D*h,l}function Ni(l,t,s){var u=Math.sin(s),h=Math.cos(s),m=t[0],g=t[1],v=t[2],b=t[3],E=t[4],T=t[5],I=t[6],D=t[7];return t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=m*h+E*u,l[1]=g*h+T*u,l[2]=v*h+I*u,l[3]=b*h+D*u,l[4]=E*h-m*u,l[5]=T*h-g*u,l[6]=I*h-v*u,l[7]=D*h-b*u,l}function Or(l,t){return l[0]=t[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=t[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=t[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function qo(l,t,s){var u,h,m,g=s[0],v=s[1],b=s[2],E=Math.sqrt(g*g+v*v+b*b);return E<C?null:(g*=E=1/E,v*=E,b*=E,u=Math.sin(t),h=Math.cos(t),l[0]=g*g*(m=1-h)+h,l[1]=v*g*m+b*u,l[2]=b*g*m-v*u,l[3]=0,l[4]=g*v*m-b*u,l[5]=v*v*m+h,l[6]=b*v*m+g*u,l[7]=0,l[8]=g*b*m+v*u,l[9]=v*b*m-g*u,l[10]=b*b*m+h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function Ks(l,t){var s=t[0],u=t[1],h=t[2],m=t[4],g=t[5],v=t[6],b=t[8],E=t[9],T=t[10];return l[0]=Math.sqrt(s*s+u*u+h*h),l[1]=Math.sqrt(m*m+g*g+v*v),l[2]=Math.sqrt(b*b+E*E+T*T),l}function Vu(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s+s,v=u+u,b=h+h,E=s*g,T=u*g,I=u*v,D=h*g,O=h*v,R=h*b,B=m*g,H=m*v,$=m*b;return l[0]=1-I-R,l[1]=T+$,l[2]=D-H,l[3]=0,l[4]=T-$,l[5]=1-E-R,l[6]=O+B,l[7]=0,l[8]=D+H,l[9]=O-B,l[10]=1-E-I,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var Uu=Mt;function ci(){var l=new P(3);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function ju(l){var t=new P(3);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t}function xo(l){var t=l[0],s=l[1],u=l[2];return Math.sqrt(t*t+s*s+u*u)}function xr(l,t,s){var u=new P(3);return u[0]=l,u[1]=t,u[2]=s,u}function Ji(l,t,s,u){return l[0]=t,l[1]=s,l[2]=u,l}function Wr(l,t,s){return l[0]=t[0]+s[0],l[1]=t[1]+s[1],l[2]=t[2]+s[2],l}function dl(l,t,s){return l[0]=t[0]-s[0],l[1]=t[1]-s[1],l[2]=t[2]-s[2],l}function Va(l,t,s){return l[0]=t[0]*s[0],l[1]=t[1]*s[1],l[2]=t[2]*s[2],l}function hl(l,t,s){return l[0]=Math.min(t[0],s[0]),l[1]=Math.min(t[1],s[1]),l[2]=Math.min(t[2],s[2]),l}function Ua(l,t,s){return l[0]=Math.max(t[0],s[0]),l[1]=Math.max(t[1],s[1]),l[2]=Math.max(t[2],s[2]),l}function fr(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l[2]=t[2]*s,l}function Qs(l,t,s,u){return l[0]=t[0]+s[0]*u,l[1]=t[1]+s[1]*u,l[2]=t[2]+s[2]*u,l}function om(l,t){var s=t[0]-l[0],u=t[1]-l[1],h=t[2]-l[2];return Math.sqrt(s*s+u*u+h*h)}function lp(l,t){var s=t[0]-l[0],u=t[1]-l[1],h=t[2]-l[2];return s*s+u*u+h*h}function sm(l){var t=l[0],s=l[1],u=l[2];return t*t+s*s+u*u}function Bc(l,t){return l[0]=-t[0],l[1]=-t[1],l[2]=-t[2],l}function Yi(l,t){var s=t[0],u=t[1],h=t[2],m=s*s+u*u+h*h;return m>0&&(m=1/Math.sqrt(m)),l[0]=t[0]*m,l[1]=t[1]*m,l[2]=t[2]*m,l}function Ir(l,t){return l[0]*t[0]+l[1]*t[1]+l[2]*t[2]}function Wo(l,t,s){var u=t[0],h=t[1],m=t[2],g=s[0],v=s[1],b=s[2];return l[0]=h*b-m*v,l[1]=m*g-u*b,l[2]=u*v-h*g,l}function $u(l,t,s,u){var h=t[0],m=t[1],g=t[2];return l[0]=h+u*(s[0]-h),l[1]=m+u*(s[1]-m),l[2]=g+u*(s[2]-g),l}function Fr(l,t,s){var u=t[0],h=t[1],m=t[2],g=s[3]*u+s[7]*h+s[11]*m+s[15];return l[0]=(s[0]*u+s[4]*h+s[8]*m+s[12])/(g=g||1),l[1]=(s[1]*u+s[5]*h+s[9]*m+s[13])/g,l[2]=(s[2]*u+s[6]*h+s[10]*m+s[14])/g,l}function Vc(l,t,s){var u=t[0],h=t[1],m=t[2];return l[0]=u*s[0]+h*s[3]+m*s[6],l[1]=u*s[1]+h*s[4]+m*s[7],l[2]=u*s[2]+h*s[5]+m*s[8],l}function Uc(l,t,s){var u=s[0],h=s[1],m=s[2],g=s[3],v=t[0],b=t[1],E=t[2],T=h*E-m*b,I=m*v-u*E,D=u*b-h*v;return l[0]=v+g*(T+=T)+h*(D+=D)-m*(I+=I),l[1]=b+g*I+m*T-u*D,l[2]=E+g*D+u*I-h*T,l}function zs(l){return l[0]=0,l[1]=0,l[2]=0,l}function rs(l,t){return l[0]===t[0]&&l[1]===t[1]&&l[2]===t[2]}var Vr=dl,T0=Va,Gd=xo;function Hu(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function jc(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l[2]=t[2]*s,l[3]=t[3]*s,l}function $c(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=s*s+u*u+h*h+m*m;return g>0&&(g=1/Math.sqrt(g)),l[0]=s*g,l[1]=u*g,l[2]=h*g,l[3]=m*g,l}function Zo(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3];return l[0]=s[0]*u+s[4]*h+s[8]*m+s[12]*g,l[1]=s[1]*u+s[5]*h+s[9]*m+s[13]*g,l[2]=s[2]*u+s[6]*h+s[10]*m+s[14]*g,l[3]=s[3]*u+s[7]*h+s[11]*m+s[15]*g,l}function Zl(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function qd(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function ja(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+g*v,l[1]=h*b+m*v,l[2]=m*b-h*v,l[3]=g*b-u*v,l}function Yl(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b-m*v,l[1]=h*b+g*v,l[2]=m*b+u*v,l[3]=g*b-h*v,l}ci(),Hu();var ds,Gu,qu,Wu=$c,Wd=(ds=ci(),Gu=xr(1,0,0),qu=xr(0,1,0),function(l,t,s){var u=Ir(t,s);return u<-.999999?(Wo(ds,Gu,t),Gd(ds)<1e-6&&Wo(ds,qu,t),Yi(ds,ds),(function(h,m,g){g*=.5;var v=Math.sin(g);h[0]=v*m[0],h[1]=v*m[1],h[2]=v*m[2],h[3]=Math.cos(g)})(l,ds,Math.PI),l):u>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(Wo(ds,t,s),l[0]=ds[0],l[1]=ds[1],l[2]=ds[2],l[3]=1+u,Wu(l,l))});function bo(){var l=new P(2);return P!=Float32Array&&(l[0]=0,l[1]=0),l}function Ss(l,t){var s=new P(2);return s[0]=l,s[1]=t,s}function cp(l,t,s){return l[0]=t,l[1]=s,l}function Hc(l,t,s){return l[0]=t[0]+s[0],l[1]=t[1]+s[1],l}function pl(l,t,s){return l[0]=t[0]-s[0],l[1]=t[1]-s[1],l}function Xl(l,t,s){return l[0]=t[0]*s,l[1]=t[1]*s,l}function $a(l){var t=l[0],s=l[1];return Math.sqrt(t*t+s*s)}function up(l,t){var s=t[0],u=t[1],h=s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),l[0]=t[0]*h,l[1]=t[1]*h,l}function Zu(l,t){return l[0]*t[0]+l[1]*t[1]}Zl(),Zl(),X();var ar,Mo,am=pl;function Yu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}bo();var Ha=(function(){if(Mo)return ar;function l(t,s,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=u,this.p2y=h}return Mo=1,ar=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,h=0;h<8;h++){var m=this.sampleCurveX(u)-t;if(Math.abs(m)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=m/g}var v=0,b=1;for(u=t,h=0;h<20&&(m=this.sampleCurveX(u),!(Math.abs(m-t)<s));h++)t>m?v=u:b=u,u=.5*(b-v)+v;return u},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},ar})(),lm=Yu(Ha);function st(l,t){this.x=l,this.y=t}function Kl(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!Kl(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(let s in l)if(!Kl(l[s],t[s]))return!1;return!0}return l===t}st.prototype={clone(){return new st(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,t){return this.clone()._rotateAround(l,t)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){let t=l.x-this.x,s=l.y-this.y;return t*t+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,t){return Math.atan2(this.x*t-this.y*l,this.x*l+this.y*t)},_matMult(l){let t=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=t,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){let l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){let t=Math.cos(l),s=Math.sin(l),u=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=u,this},_rotateAround(l,t){let s=Math.cos(l),u=Math.sin(l),h=t.y+u*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-u*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(l){if(l instanceof st)return l;if(Array.isArray(l))return new st(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new st(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};let I0=Math.PI/180,Xu=180/Math.PI;function Zn(l){return l*I0}function os(l){return l*Xu}let M0=[[0,0],[1,0],[1,1],[0,1]];function Ku(l){if(l<=0)return 0;if(l>=1)return 1;let t=l*l,s=t*l;return 4*(l<.5?s:3*(l-t)+s-.75)}function dp(l,t,s,u){let h=new lm(l,t,s,u);return function(m){return h.solve(m)}}let Re=dp(.25,.1,.25,1);function G(l,t,s){return Math.min(s,Math.max(t,l))}function Q(l,t,s){return(s=G((s-l)/(t-l),0,1))*s*(3-2*s)}function se(l,t,s){let u=s-t,h=((l-t)%u+u)%u+t;return h===t?s:h}function xe(l,t,s){if(!l.length)return s(null,[]);let u=l.length,h=new Array(l.length),m=null;l.forEach((g,v)=>{t(g,(b,E)=>{b&&(m=b),h[v]=E,--u==0&&s(m,h)})})}let ve=1;function Ie(){return ve++}function ze(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function Pe(l,t){l.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function Ne(l,t,s){let u={};for(let h in l)u[h]=t.call(this,l[h],h,l);return u}function ut(l,t,s){let u={};for(let h in l)t.call(this,l[h],h,l)&&(u[h]=l[h]);return u}function Xe(l){return Array.isArray(l)?l.map(Xe):typeof l=="object"&&l?Ne(l,Xe):l}function Ft(l,t){for(let s=0;s<l.length;s++)if(t.indexOf(l[s])>=0)return!0;return!1}let Qt={};function Pt(l){Qt[l]||(typeof console<"u"&&console.warn(l),Qt[l]=!0)}function bn(l,t,s){return(s.y-l.y)*(t.x-l.x)>(t.y-l.y)*(s.x-l.x)}function yn(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}function gn([l,t,s]){let u=Zn(t+90),h=Zn(s);return{x:l*Math.cos(u)*Math.sin(h),y:l*Math.sin(u)*Math.sin(h),z:l*Math.cos(h),azimuthal:t,polar:s}}function Un(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function mr(l){let t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,h,m)=>{let g=h||m;return t[u]=!g||g.toLowerCase(),""}),t["max-age"]){let s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Ur=null;function br(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function Zr(l,t,s,u){for(;t<s;){let h=t+s>>1;l[h]<u?t=h+1:s=h}return t}function lr(l,t,s,u){for(;t<s;){let h=t+s>>1;l[h]<=u?t=h+1:s=h}return t}function Gn(l){return l>0?1/(1.001-l):1+l}function cr(l){return l>0?1-1/(1.001-l):-l}function Oi(l,t,s){return(l-t.min)*(s.max-s.min)/(t.max-t.min)+s.min}let kn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!kn.API_URL)return null;try{let l=new URL(kn.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function wr(l){return kn.API_URL_REGEX.test(l)}function Fo(l){return kn.API_SPRITE_REGEX.test(l)}let Yo,Ts,Qu,wo,Js,ss;function fl(){return Yo==null&&(Yo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Yo}let ho={now:()=>wo!==void 0?wo:performance.now(),setNow(l){wo=l},restoreNow(){wo=void 0},frame(l){let t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){let{width:s,height:u}=l;Js||(Js=document.createElement("canvas"));let h=Js.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Js.width||u>Js.height)&&(Js.width=s,Js.height=u),h.clearRect(-t,-t,s+2*t,u+2*t),h.drawImage(l,0,0,s,u),h.getImageData(-t,-t,s+2*t,u+2*t)},resolveURL:l=>(Ts||(Ts=document.createElement("a")),Ts.href=l,Ts.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Qu==null&&(Qu=window.matchMedia("(prefers-reduced-motion: reduce)")),Qu.matches)},hasCanvasFingerprintNoise(){if(ss!==void 0)return ss;if(!fl())return ss=!1,!1;let l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0}),s=0;for(let h=0;h<l.width;++h)t.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,t.fillRect(h,0,1,1);let u=t.getImageData(0,0,l.width,l.height);s=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&s++!==u.data[h])return ss=!0,!0;return ss=!1,!1}};function Ju(l,t){let s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(t).toString()}`;let u=new URLSearchParams(l.slice(s));for(let h in t)u.set(h,t[h]);return`${l.slice(0,s)}?${u.toString()}`}function Zd(l,t={persistentParams:[]}){let s=l.indexOf("?");if(s<0)return l;let u=new URLSearchParams,h=new URLSearchParams(l.slice(s));for(let g of t.persistentParams){let v=h.get(g);v&&u.set(g,v)}let m=u.toString();return`${l.slice(0,s)}${m.length>0?`?${m}`:""}`}let cm="mapbox-tiles",um=500,dm=50,hp=["language","worldview","jobid"],ml,Is;function Ga(){try{return caches}catch{}}function qa(){let l=Ga();l&&ml==null&&(ml=l.open(cm))}let ya=1/0,gl={supported:!1,testSupport:function(l){!hm&&ed&&(td?Pb(l):Gc=l)}},Gc,ed,hm=!1,td=!1,pm=typeof self<"u"?self:{};function Pb(l){let t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,ed),l.isContextLost())return;gl.supported=!0}catch{}l.deleteTexture(t),hm=!0}pm.document&&(ed=pm.document.createElement("img"),ed.onload=function(){Gc&&Pb(Gc),Gc=null,td=!0},ed.onerror=function(){hm=!0,Gc=null},ed.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let pp={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(pp);class Bs extends Error{constructor(t,s,u){s===401&&wr(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let fm=Un()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,nd=function(l,t){if(!(/^file:/.test(s=l.url)||/^file:/.test(fm())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,h){let m=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:fm(),referrerPolicy:u.referrerPolicy,signal:m.signal}),v=!1,b=!1,E=(T=g.url).indexOf("sku=")>0&&wr(T);var T;u.type==="json"&&g.headers.set("Accept","application/json");let I=(O,R,B)=>{if(b)return;if(O&&O.message!=="SecurityError"&&Pt(O.toString()),R&&B)return D(R);let H=Date.now();fetch(g).then($=>{if($.ok){let Y=E?$.clone():null;return D($,Y,H)}return h(new Bs($.statusText,$.status,u.url))}).catch($=>{$.name!=="AbortError"&&h(new Error(`${$.message} ${u.url}`))})},D=(O,R,B)=>{(u.type==="arrayBuffer"?O.arrayBuffer():u.type==="json"?O.json():O.text()).then(H=>{b||(R&&B&&(function($,Y,J){if(qa(),ml==null)return;let ie=mr(Y.headers.get("Cache-Control")||"");if(ie["no-store"])return;let he={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((ye,we)=>he.headers.set(we,ye)),ie["max-age"]&&he.headers.set("Expires",new Date(J+1e3*ie["max-age"]).toUTCString());let le=he.headers.get("Expires");if(!le||new Date(le).getTime()-J<42e4)return;let me=Zd($.url,{persistentParams:hp});if(Y.status===206){let ye=$.headers.get("Range");if(!ye)return;he.status=200,me=Ju(me,{range:ye})}(function(ye,we){if(Is===void 0)try{new Response(new ReadableStream),Is=!0}catch{Is=!1}Is?we(ye.body):ye.blob().then(we).catch(je=>Pt(je.message))})(Y,ye=>{let we=new Response((je=Y.status)!==200&&je!==404&&[101,103,204,205,304].includes(je)?null:ye,he);var je;qa(),ml?.then(Ae=>Ae.put(me,we)).catch(Ae=>Pt(Ae.message))})})(g,R,B),v=!0,h(null,H,O.headers))}).catch(H=>{b||h(new Error(H.message))})};return E?(function(O,R){if(qa(),ml==null)return R(null);ml.then(B=>{let H=Zd(O.url,{persistentParams:hp}),$=O.headers.get("Range");$&&(H=Ju(H,{range:$})),B.match(H).then(Y=>{let J=(function(ie){if(!ie)return!1;let he=new Date(ie.headers.get("Expires")||0),le=mr(ie.headers.get("Cache-Control")||"");return Number(he)>Date.now()&&!le["no-cache"]})(Y);B.delete(H).catch(R),J&&B.put(H,Y.clone()).catch(R),R(null,Y,J)}).catch(R)}).catch(R)})(g,I):I(null,null),{cancel:()=>{b=!0,v||m.abort()}}})(l,t);if(Un(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var s;return(function(u,h){let m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(b){return h(b)}let v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{let E=b.split(": "),T=E.shift(),I=E.join(": ");v.append(T,I)}),h(null,g,v)}else h(new Bs(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}})(l,t)},Ql=function(l,t){return nd(Object.assign(l,{type:"arrayBuffer"}),t)};function HT(l){let t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}let Ob="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",fp,qn;fp=[],qn=0;let mm=function(l,t){if(gl.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),qn>=kn.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return fp.push(m),m}qn++;let s=!1,u=()=>{if(!s)for(s=!0,qn--;fp.length&&qn<kn.MAX_PARALLEL_IMAGE_REQUESTS;){let m=fp.shift(),{requestParameters:g,callback:v,cancelled:b}=m;b||(m.cancel=mm(g,v).cancel)}},h=Ql(l,(m,g,v)=>{u(),m?t(m):g&&(self.createImageBitmap?(function(b,E){let T=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(T).then(I=>{E(null,I)}).catch(I=>{E(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(g,(b,E)=>t(b,E,v)):(function(b,E){let T=new Image;T.onload=()=>{E(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Ob})},T.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let I=new Blob([new Uint8Array(b)],{type:"image/png"});T.src=b.byteLength?URL.createObjectURL(I):Ob})(g,(b,E)=>t(b,E,v)))});return{cancel:()=>{h.cancel(),u()}}};var D0,Rb,kb,qc={exports:{}},mp={exports:{}},gp={exports:{}},A0=(function(){if(kb)return qc.exports;kb=1;var l=(D0||(D0=1,mp.exports=function(s,u){var h,m,g,v,b,E,T,I;for(m=s.length-(h=3&s.length),g=u,b=3432918353,E=461845907,I=0;I<m;)T=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,h){case 3:T^=(255&s.charCodeAt(I+2))<<16;case 2:T^=(255&s.charCodeAt(I+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&s.charCodeAt(I)))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),mp.exports),t=(Rb||(Rb=1,gp.exports=function(s,u){for(var h,m=s.length,g=u^m,v=0;m>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),gp.exports);return qc.exports=l,qc.exports.murmur3=l,qc.exports.murmur2=t,qc.exports})(),gm=Yu(A0);class _l{constructor(t,...s){Object.assign(this,s[0]||{}),this.type=t}}class _p extends _l{constructor(t,s={}){super("error",Object.assign({error:t},s))}}function P0(l,t,s){s[l]&&s[l].indexOf(t)!==-1||(s[l]=s[l]||[],s[l].push(t))}function Wc(l,t,s){if(s&&s[l]){let u=s[l].indexOf(t);u!==-1&&s[l].splice(u,1)}}class id{on(t,s){return this._listeners=this._listeners||{},P0(t,s,this._listeners),this}off(t,s){return Wc(t,s,this._listeners),Wc(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},P0(t,s,this._oneTimeListeners),this):new Promise(u=>{this.once(t,u)})}fire(t,s){let u=typeof t=="string"?new _l(t,s):t,h=u.type;if(this.listens(h)){u.target=this;let m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(let b of m)b.call(this,u);let g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(let b of g)Wc(h,b,this._oneTimeListeners),b.call(this,u);let v=this._eventedParent;if(v){let b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,b),v.fire(u)}}else u instanceof _p&&console.error(u.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}class as{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new as(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){let[s,u]=t.split("");return new as({name:s,iconsetId:u})}static isEqual(t,s){return t.name===s.name&&t.iconsetId===s.iconsetId}toString(){return as.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var _m,vp={},xa=(function(){if(_m)return vp;_m=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(m){return(m=Math.round(m))<0?0:m>255?255:m}function s(m){return t(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function h(m,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(g-m)*v*6:2*v<1?g:3*v<2?m+(g-m)*(2/3-v)*6:m}try{vp.parseCSSColor=function(m){var g,v=m.replace(/ /g,"").toLowerCase();if(v in l)return l[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var b=v.indexOf("("),E=v.indexOf(")");if(b!==-1&&E+1===v.length){var T=v.substr(0,b),I=v.substr(b+1,E-(b+1)).split(","),D=1;switch(T){case"rgba":if(I.length!==4)return null;D=u(I.pop());case"rgb":return I.length!==3?null:[s(I[0]),s(I[1]),s(I[2]),D];case"hsla":if(I.length!==4)return null;D=u(I.pop());case"hsl":if(I.length!==3)return null;var O=(parseFloat(I[0])%360+360)%360/360,R=u(I[1]),B=u(I[2]),H=B<=.5?B*(R+1):B+R-B*R,$=2*B-H;return[t(255*h($,H,O+1/3)),t(255*h($,H,O)),t(255*h($,H,O-1/3)),D];default:return null}}return null}}catch{}return vp})();class ui{constructor(t,s,u,h=1){this.r=t,this.g=s,this.b=u,this.a=h}static parse(t){if(!t)return;if(t instanceof ui)return t;if(typeof t!="string")return;let s=xa.parseCSSColor(t);return s?new ui(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){let[t,s,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*s)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(t){let{r:s,g:u,b:h,a:m}=this;return new Lb(t,s,u,h,m)}toPremultipliedRenderColor(t){let{r:s,g:u,b:h,a:m}=this;return new Nb(t,s*m,u*m,h*m,m)}clone(){return new ui(this.r,this.g,this.b,this.a)}}class Fb{constructor(t,s,u,h,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,t){let v=t.image.height,b=v*v;this.premultiplied?(s=m===0?0:s/m*(v-1),u=m===0?0:u/m*(v-1),h=m===0?0:h/m*(v-1)):(s*=v-1,u*=v-1,h*=v-1);let E=Math.floor(s),T=Math.floor(u),I=Math.floor(h),D=Math.ceil(s),O=Math.ceil(u),R=Math.ceil(h),B=s-E,H=u-T,$=h-I,Y=t.image.data,J=4*(E+T*b+I*v),ie=4*(E+T*b+R*v),he=4*(E+O*b+I*v),le=4*(E+O*b+R*v),me=4*(D+T*b+I*v),ye=4*(D+T*b+R*v),we=4*(D+O*b+I*v),je=4*(D+O*b+R*v);if(J<0||je>=Y.length)throw new Error("out of range");this.r=on(on(on(Y[J],Y[ie],$),on(Y[he],Y[le],$),H),on(on(Y[me],Y[ye],$),on(Y[we],Y[je],$),H),B)/255*(this.premultiplied?m:1),this.g=on(on(on(Y[J+1],Y[ie+1],$),on(Y[he+1],Y[le+1],$),H),on(on(Y[me+1],Y[ye+1],$),on(Y[we+1],Y[je+1],$),H),B)/255*(this.premultiplied?m:1),this.b=on(on(on(Y[J+2],Y[ie+2],$),on(Y[he+2],Y[le+2],$),H),on(on(Y[me+2],Y[ye+2],$),on(Y[we+2],Y[je+2],$),H),B)/255*(this.premultiplied?m:1),this.a=m}else this.r=s,this.g=u,this.b=h,this.a=m}toArray(){let{r:t,g:s,b:u,a:h}=this;return[255*t,255*s,255*u,h]}toHslaArray(){let{r:t,g:s,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];let R=1/h;t*=R,s*=R,u*=R}let m=Math.min(Math.max(t,0),1),g=Math.min(Math.max(s,0),1),v=Math.min(Math.max(u,0),1),b=Math.min(m,g,v),E=Math.max(m,g,v),T=E-b,I=.5*(b+E);if(T===0)return[0,0,100*I,h];let D=I>.5?T/(2-E-b):T/(E+b),O;switch(E){case m:O=60*((g-v)/T+(g<v?6:0));break;case g:O=60*((v-m)/T+2);break;default:O=60*((m-g)/T+4)}return[O,100*D,100*I,h]}toArray01(){let{r:t,g:s,b:u,a:h}=this;return[t,s,u,h]}toArray01Scaled(t){let{r:s,g:u,b:h}=this;return[s*t,u*t,h*t]}toArray01Linear(){let{r:t,g:s,b:u,a:h}=this;return[Math.pow(t,2.2),Math.pow(s,2.2),Math.pow(u,2.2),h]}}class Lb extends Fb{constructor(t,s,u,h,m){super(t,s,u,h,m,!1)}}class Nb extends Fb{constructor(t,s,u,h,m){super(t,s,u,h,m,!0)}}function on(l,t,s){return l*(1-s)+t*s}function O0(l,t,s){return l.map((u,h)=>on(u,t[h],s))}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1),ui.blue=new ui(0,0,1,1);var yp=Object.freeze({__proto__:null,array:O0,color:function(l,t,s){return new ui(on(l.r,t.r,s),on(l.g,t.g,s),on(l.b,t.b,s),on(l.a,t.a,s))},number:on});class ba extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Yd{constructor(t,s=[]){this.parent=t,this.bindings={};for(let[u,h]of s)this.bindings[u]=h}concat(t){return new Yd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Wa={kind:"null"},Zt={kind:"number"},Bn={kind:"string"},mi={kind:"boolean"},Ms={kind:"color"},vl={kind:"object"},ai={kind:"value"},vm={kind:"collator"},xp={kind:"formatted"},bp={kind:"resolvedImage"};function Xo(l,t){return{kind:"array",itemType:l,N:t}}function jr(l){if(l.kind==="array"){let t=jr(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}let GT=[Wa,Zt,Bn,mi,Ms,xp,vl,Xo(ai),bp];function Zc(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Zc(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(let s of GT)if(!Zc(s,t))return null}}return`Expected ${jr(l)} but found ${jr(t)} instead.`}function R0(l,t){return t.some(s=>s.kind===l.kind)}function wp(l,t){return t.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}function ym(l,t){return l.kind==="array"&&t.kind==="array"?l.N===t.N&&ym(l.itemType,t.itemType):l.kind===t.kind}class k0{constructor(t,s,u){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class xm{constructor(t,s,u,h,m){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=u,this.fontStack=h,this.textColor=m}}class hs{constructor(t){this.sections=t}static fromString(t){return new hs([new xm(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof hs?t:hs.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let s of this.sections){if(s.image){let h=s.image.getPrimary().id.toString();t.push(["image",h]);continue}t.push(s.text);let u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(u)}return t}}class Jl{constructor(t,s={}){this.id=as.from(t),this.params=s.params,this.sx=s.sx||1,this.sy=s.sy||1}toString(){return JSON.stringify(this)}static parse(t){let s,u,h,m;try{({id:s,params:u,sx:h,sy:m}=JSON.parse(t)||{})}catch{return null}return s?new Jl(s,{params:u,sx:h,sy:m}):null}scaleSelf(t,s=t){return this.sx*=t,this.sy*=s,this}}class ps{constructor(t,s,u,h,m=!1){this.primaryId=as.from(t),this.primaryOptions=s,u&&(this.secondaryId=as.from(u)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Jl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Jl(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?ps.build({name:t}):t}static build(t,s,u,h){return!t||typeof t=="object"&&!("name"in t)?null:new ps(t,u,s,h)}}function rd(l,t,s,u){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,t,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,t,s,u]:[l,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xd(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof ui||l instanceof k0||l instanceof hs||l instanceof ps)return!0;if(Array.isArray(l)){for(let t of l)if(!Xd(t))return!1;return!0}if(typeof l=="object"){for(let t in l)if(!Xd(l[t]))return!1;return!0}return!1}function po(l){if(l===null)return Wa;if(typeof l=="string")return Bn;if(typeof l=="boolean")return mi;if(typeof l=="number")return Zt;if(l instanceof ui)return Ms;if(l instanceof k0)return vm;if(l instanceof hs)return xp;if(l instanceof ps)return bp;if(Array.isArray(l)){let t=l.length,s;for(let u of l){let h=po(u);if(s){if(s===h)continue;s=ai;break}s=h}return Xo(s||ai,t)}return vl}function wa(l){let t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof hs||l instanceof ps||l instanceof ui?l.toString():JSON.stringify(l)}class ec{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Xd(t[1]))return s.error("invalid value");let u=t[1],h=po(u),m=s.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new ec(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ui?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof hs?this.value.serialize():this.value}}class oo{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let F0={string:Bn,number:Zt,boolean:mi,object:vl};class Za{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u,h=1,m=t[0];if(m==="array"){let v,b;if(t.length>2){let E=t[1];if(typeof E!="string"||!(E in F0)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=F0[E],h++}else v=ai;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}u=Xo(v,b)}else u=F0[m];let g=[];for(;h<t.length;h++){let v=s.parse(t[h],h,ai);if(!v)return null;g.push(v)}return new Za(u,g)}evaluate(t){for(let s=0;s<this.args.length;s++){let u=this.args[s].evaluate(t);if(!Zc(this.type,po(u)))return u;if(s===this.args.length-1)throw new oo(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${jr(po(u))} but was expected to be of type ${jr(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,s=[t.kind];if(t.kind==="array"){let u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);let h=t.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(u=>u.serialize()))}}class yl{constructor(t){this.type=xp,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u=t[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");let h=[],m=!1;for(let g=1;g<=t.length-1;++g){let v=t[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let b=null;if(v["font-scale"]&&(b=s.parseObjectValue(v["font-scale"],g,"font-scale",Zt),!b))return null;let E=null;if(v["text-font"]&&(E=s.parseObjectValue(v["text-font"],g,"text-font",Xo(Bn)),!E))return null;let T=null;if(v["text-color"]&&(T=s.parseObjectValue(v["text-color"],g,"text-color",Ms),!T))return null;let I=h[h.length-1];I.scale=b,I.font=E,I.textColor=T}else{let b=s.parse(t[g],g,ai);if(!b)return null;let E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new yl(h)}evaluate(t){return new hs(this.sections.map(s=>{let u=s.content.evaluate(t);return ym(po(u),bp)?new xm("",u,null,null,null):new xm(wa(u),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(let s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let s of this.sections){t.push(s.content.serialize());let u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),t.push(u)}return t}}class xn{constructor(t,s,u,h){this._imageWarnHistory={},this.type=bp,this.namePrimary=t,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(t,s){if(t.length<2)return s.error("Expected two or more arguments.");let u=1,h=[];function m(){if(u<t.length){let v=s.parse(t[u],u++,Bn);return v?(h.push({image:v,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<t.length){let b=t[u];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;let E=b.params,T=b.iconset,I=s.concat(u);if(!E&&!T)return u++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return I.error('Image options "params" should be an object'),!1;let D={},O=I.concat(void 0,"params");for(let R in E){if(!R)return O.error("Image parameter name should be non-empty"),!1;let B=O.concat(void 0,R).parse(E[R],void 0,Ms,void 0,{typeAnnotation:"coerce"});if(!B)return!1;D[R]=B}h[h.length-1].options.params=D}if(T){if(typeof T!="object"||T.constructor!==Object)return I.error('Image options "iconset" should be an object'),!1;if(!T.id)return I.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=T}return u++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!g())return;return new xn(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(t,s){let u={};if(s){for(let h in s)if(s[h])try{u[h]=s[h].evaluate(t)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(t){let s={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,h=ps.build(s,u,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(h&&t.availableImages){let m=h.getPrimary().id;if(h.available=t.availableImages.some(g=>as.isEqual(g,m)),h.available){let g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=t.availableImages.some(v=>as.isEqual(v,g)))}}return h}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(let s in this.paramsPrimary)this.paramsPrimary[s]&&t(this.paramsPrimary[s]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(let s in this.paramsSecondary)this.paramsSecondary[s]&&t(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(t,s){let u={};if(s&&(u.iconset={id:s}),t){u.params={};for(let h in t)t[h]&&(u.params[h]=t[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){let t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&t.push(s)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&t.push(s)}return t}}function Gt(l){return cn(l)?"string":Kd(l)?"number":wm(l)?"boolean":Array.isArray(l)?"array":l===null?"null":bm(l)?"object":typeof l}function bm(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function cn(l){return typeof l=="string"||l instanceof String}function Kd(l){return typeof l=="number"||l instanceof Number}function wm(l){return typeof l=="boolean"||l instanceof Boolean}let ln={"to-boolean":mi,"to-color":Ms,"to-number":Zt,"to-string":Bn};class xl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u=t[0],h=[],m=Wa;if(u==="to-array"){if(!Array.isArray(t[1]))return null;let g=t[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);m=Xo(s.expectedType.itemType,g)}else{if(!(g>0&&Xd(t[1][0])))return null;m=Xo(po(t[1][0]),g)}for(let v=0;v<g;v++){let b=t[1][v],E;if(Array.isArray(b))E=s.parse(b,void 0,m.itemType);else{let T=Gt(b);if(T!==m.itemType.kind)return s.error(`Expected ${m.itemType.kind} but found ${T}.`);E=s.registry.literal.parse(["literal",b===void 0?null:b],s)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return s.error("Expected one argument.");m=ln[u];for(let g=1;g<t.length;g++){let v=s.parse(t[g],g,ai);if(!v)return null;h.push(v)}}return new xl(m,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,u;for(let h of this.args){if(s=h.evaluate(t),u=null,s instanceof ui)return s;if(typeof s=="string"){let m=t.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:rd(s[0],s[1],s[2],s[3]),!u))return new ui(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new oo(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(let u of this.args){if(s=u.evaluate(t),s===null)return 0;let h=Number(s);if(!isNaN(h))return h}throw new oo(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?hs.fromString(wa(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ps.build(wa(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(s=>s.evaluate(t)):wa(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new yl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xn(this.args[0]).serialize();let t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}let L0=["Unknown","Point","LineString","Polygon"];class Cm{constructor(t,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?L0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-t[0])+this.featureDistanceData.bearing[1]*(h*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=ui.parse(t)),s}getConfig(t){return this.options?this.options.get(t):null}}class fs{constructor(t,s,u,h,m){this.name=t,this.type=s,this._evaluate=u,this.args=h,this._overloadIndex=m}evaluate(t){if(!this._evaluate){let s=fs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){let u=t[0],h=fs.definitions[u];if(!h)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[],b=null,E=-1;for(let[T,I]of g){if(Array.isArray(T)&&T.length!==t.length-1)continue;v.push(T),E++,b=new Fm(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);let D=[],O=!1;for(let R=1;R<t.length;R++){let B=t[R],H=Array.isArray(T)?T[R-1]:T.type,$=b.parse(B,1+D.length,H);if(!$){O=!0;break}D.push($)}if(!O)if(Array.isArray(T)&&T.length!==D.length)b.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){let B=Array.isArray(T)?T[R]:T.type,H=D[R];b.concat(R+1).checkSubtype(B,H.type)}if(b.errors.length===0)return new fs(u,m,I,D,E)}}if(v.length===1)s.errors.push(...b.errors);else{let T=(v.length?v:g.map(([D])=>D)).map(Em).join(" | "),I=[];for(let D=1;D<t.length;D++){let O=s.parse(t[D],1+I.length);if(!O)return null;I.push(jr(O.type))}s.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){fs.definitions=s;for(let u in s)t[u]=fs}}function Em(l){return Array.isArray(l)?`(${l.map(jr).join(", ")})`:`(${jr(l.type)}...)`}class Co{constructor(t,s,u){this.type=vm,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");let u=t[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");let h=u["case-sensitive"]===void 0?s.parse(!1,1,mi):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",mi);if(!h)return null;let m=u["diacritic-sensitive"]===void 0?s.parse(!1,1,mi):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",mi);if(!m)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",Bn),!g)?null:new Co(h,m,g)}evaluate(t){return new k0(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Sm(l,t,s=0,u=l.length-1,h=N0){for(;u>s;){if(u-s>600){let b=u-s+1,E=t-s+1,T=Math.log(b),I=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*I*(b-I)/b)*(E-b/2<0?-1:1);Sm(l,t,Math.max(s,Math.floor(t-E*I/b+D)),Math.min(u,Math.floor(t+(b-E)*I/b+D)),h)}let m=l[t],g=s,v=u;for(Ya(l,s,t),h(l[u],m)>0&&Ya(l,s,u);g<v;){for(Ya(l,g,v),g++,v--;h(l[g],m)<0;)g++;for(;h(l[v],m)>0;)v--}h(l[s],m)===0?Ya(l,s,v):(v++,Ya(l,v,u)),v<=t&&(s=v+1),t<=v&&(u=v-1)}}function Ya(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}function N0(l,t){return l<t?-1:l>t?1:0}function Yc(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}function Ca(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function Cp(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function qT(l,t,s){let u=l[0]-t[0],h=l[1]-t[1],m=l[0]-s[0],g=l[1]-s[1];return u*g-m*h==0&&u*m<=0&&h*g<=0}function Qd(l,t,s=!1){let u=!1;for(let v=0,b=t.length;v<b;v++){let E=t[v];for(let T=0,I=E.length,D=I-1;T<I;D=T++){let O=E[D],R=E[T];if(qT(l,O,R))return s;(m=O)[1]>(h=l)[1]!=(g=R)[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(u=!u)}}var h,m,g;return u}function Ep(l,t,s,u){let h=u[0]-s[0],m=u[1]-s[1],g=(l[0]-s[0])*m-h*(l[1]-s[1]),v=(t[0]-s[0])*m-h*(t[1]-s[1]);return g>0&&v<0||g<0&&v>0}function Sp(l,t,s,u){return(h=[u[0]-s[0],u[1]-s[1]])[0]*(m=[t[0]-l[0],t[1]-l[1]])[1]-h[1]*m[0]!=0&&!(!Ep(l,t,s,u)||!Ep(s,u,l,t));var h,m}function tc(l){let t=new st(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new st(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u of l[0])t.x>u.x&&(t.x=u.x),t.y>u.y&&(t.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:t,max:s}}let Xc=8192;function WT(l,t){let s=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*Xc),Math.round(u*h*Xc)]}function z0(l,t){for(let s=0;s<t.length;s++)if(Qd(l,t[s]))return!0;return!1}function ZT(l,t,s){for(let u of s)for(let h=0,m=u.length,g=m-1;h<m;g=h++)if(Sp(l,t,u[g],u[h]))return!0;return!1}function zb(l,t){for(let s=0;s<l.length;++s)if(!Qd(l[s],t))return!1;for(let s=0;s<l.length-1;++s)if(ZT(l[s],l[s+1],t))return!1;return!0}function Bb(l,t){for(let s=0;s<t.length;s++)if(zb(l,t[s]))return!0;return!1}function B0(l,t,s){let u=[];for(let h=0;h<l.length;h++){let m=[];for(let g=0;g<l[h].length;g++){let v=WT(l[h][g],s);Ca(t,v),m.push(v)}u.push(m)}return u}function Kc(l,t,s){let u=[];for(let h=0;h<l.length;h++){let m=B0(l[h],t,s);u.push(m)}return u}function Vb(l,t,s,u){if(l[0]<s[0]||l[0]>s[2]){let h=.5*u,m=l[0]-s[0]>h?-u:s[0]-l[0]>h?u:0;m===0&&(m=l[0]-s[2]>h?-u:s[2]-l[0]>h?u:0),l[0]+=m}Ca(t,l)}function Ub(l,t,s,u){let h=Math.pow(2,u.z)*Xc,m=[u.x*Xc,u.y*Xc],g=[];if(!l)return g;for(let v of l)for(let b of v){let E=[b.x+m[0],b.y+m[1]];Vb(E,t,s,h),g.push(E)}return g}function Tm(l,t,s,u){let h=Math.pow(2,u.z)*Xc,m=[u.x*Xc,u.y*Xc],g=[];if(!l)return g;for(let b of l){let E=[];for(let T of b){let I=[T.x+m[0],T.y+m[1]];Ca(t,I),E.push(I)}g.push(E)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of g)for(let E of b)Vb(E,t,s,h)}var v;return g}class Qc{constructor(t,s){this.type=mi,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xd(t[1])){let u=t[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){let m=u.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Qc(u,u.features[h].geometry)}else if(u.type==="Feature"){let h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Qc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Qc(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(s,u){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=B0(u.coordinates,m,g),b=Ub(s.geometry(),h,m,g);if(!Cp(h,m))return!1;for(let E of b)if(!Qd(E,v))return!1}if(u.type==="MultiPolygon"){let v=Kc(u.coordinates,m,g),b=Ub(s.geometry(),h,m,g);if(!Cp(h,m))return!1;for(let E of b)if(!z0(E,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(s,u){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=B0(u.coordinates,m,g),b=Tm(s.geometry(),h,m,g);if(!Cp(h,m))return!1;for(let E of b)if(!zb(E,v))return!1}if(u.type==="MultiPolygon"){let v=Kc(u.coordinates,m,g),b=Tm(s.geometry(),h,m,g);if(!Cp(h,m))return!1;for(let E of b)if(!Bb(E,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Tp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ea=1/298.257223563,jb=Ea*(2-Ea),Jd=Math.PI/180;class eh{static fromTile(t,s,u){let h=Math.PI*(1-2*(t+.5)/Math.pow(2,s)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Jd;return new eh(m,u)}static get units(){return Tp}constructor(t,s){if(t===void 0)throw new Error("No latitude given.");if(s&&!Tp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Tp).join(", ")}`);let u=6378.137*Jd*(s?Tp[s]:1),h=Math.cos(t*Jd),m=1/(1-jb*(1-h*h)),g=Math.sqrt(m);this.kx=u*g*h,this.ky=u*g*m*(1-jb)}distance(t,s){let u=ea(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(t,s){let u=ea(s[0]-t[0])*this.kx;return Math.atan2(u,(s[1]-t[1])*this.ky)/Jd}destination(t,s,u){let h=u*Jd;return this.offset(t,Math.sin(h)*s,Math.cos(h)*s)}offset(t,s,u){return[t[0]+s/this.kx,t[1]+u/this.ky]}lineDistance(t){let s=0;for(let u=0;u<t.length-1;u++)s+=this.distance(t[u],t[u+1]);return s}area(t){let s=0;for(let u=0;u<t.length;u++){let h=t[u];for(let m=0,g=h.length,v=g-1;m<g;v=m++)s+=ea(h[m][0]-h[v][0])*(h[m][1]+h[v][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(t,s){let u=0;if(s<=0)return t[0];for(let h=0;h<t.length-1;h++){let m=t[h],g=t[h+1],v=this.distance(m,g);if(u+=v,u>s)return Im(m,g,(s-(u-v))/v)}return t[t.length-1]}pointToSegmentDistance(t,s,u){let[h,m]=s,g=ea(u[0]-h)*this.kx,v=(u[1]-m)*this.ky;if(g!==0||v!==0){let b=(ea(t[0]-h)*this.kx*g+(t[1]-m)*this.ky*v)/(g*g+v*v);b>1?(h=u[0],m=u[1]):b>0&&(h+=g/this.kx*b,m+=v/this.ky*b)}return g=ea(t[0]-h)*this.kx,v=(t[1]-m)*this.ky,Math.sqrt(g*g+v*v)}pointOnLine(t,s){let u=1/0,h=t[0][0],m=t[0][1],g=0,v=0;for(let b=0;b<t.length-1;b++){let E=t[b][0],T=t[b][1],I=ea(t[b+1][0]-E)*this.kx,D=(t[b+1][1]-T)*this.ky,O=0;I===0&&D===0||(O=(ea(s[0]-E)*this.kx*I+(s[1]-T)*this.ky*D)/(I*I+D*D),O>1?(E=t[b+1][0],T=t[b+1][1]):O>0&&(E+=I/this.kx*O,T+=D/this.ky*O)),I=ea(s[0]-E)*this.kx,D=(s[1]-T)*this.ky;let R=I*I+D*D;R<u&&(u=R,h=E,m=T,g=b,v=O)}return{point:[h,m],index:g,t:Math.max(0,Math.min(1,v))}}lineSlice(t,s,u){let h=this.pointOnLine(u,t),m=this.pointOnLine(u,s);if(h.index>m.index||h.index===m.index&&h.t>m.t){let E=h;h=m,m=E}let g=[h.point],v=h.index+1,b=m.index;!V0(u[v],g[0])&&v<=b&&g.push(u[v]);for(let E=v+1;E<=b;E++)g.push(u[E]);return V0(u[b],m.point)||g.push(m.point),g}lineSliceAlong(t,s,u){let h=0,m=[];for(let g=0;g<u.length-1;g++){let v=u[g],b=u[g+1],E=this.distance(v,b);if(h+=E,h>t&&m.length===0&&m.push(Im(v,b,(t-(h-E))/E)),h>=s)return m.push(Im(v,b,(s-(h-E))/E)),m;h>t&&m.push(b)}return m}bufferPoint(t,s){let u=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-u,t[0]+h,t[1]+u]}bufferBBox(t,s){let u=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-u,t[2]+h,t[3]+u]}insideBBox(t,s){return ea(t[0]-s[0])>=0&&ea(t[0]-s[2])<=0&&t[1]>=s[1]&&t[1]<=s[3]}}function V0(l,t){return l[0]===t[0]&&l[1]===t[1]}function Im(l,t,s){let u=ea(t[0]-l[0]);return[l[0]+u*s,l[1]+(t[1]-l[1])*s]}function ea(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Mm{constructor(t=[],s=(u,h)=>u<h?-1:u>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:s,compare:u}=this,h=s[t];for(;t>0;){let m=t-1>>1,g=s[m];if(u(h,g)>=0)break;s[t]=g,t=m}s[t]=h}_down(t){let{data:s,compare:u}=this,h=this.length>>1,m=s[t];for(;t<h;){let g=1+(t<<1),v=g+1;if(v<this.length&&u(s[v],s[g])<0&&(g=v),u(s[g],m)>=0)break;s[t]=s[g],t=g}s[t]=m}}var yt=8192;function U0(l,t){return t.dist-l.dist}let Dm=100,Am=50;function j0(l){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==l[s])return!1;return!0}function Ip(l){return l[1]-l[0]+1}function bl(l,t){let s=l[1]>=l[0]&&l[1]<t;return s||console.warn("Distance Expression: Index is out of range"),s}function $0(l,t){if(l[0]>l[1])return[null,null];let s=Ip(l);if(t){if(s===2)return[l,null];let u=Math.floor(s/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(s===1)return[l,null];let u=Math.floor(s/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function od(l,t){let s=[1/0,1/0,-1/0,-1/0];if(!bl(t,l.length))return s;for(let u=t[0];u<=t[1];++u)Ca(s,l[u]);return s}function sd(l){let t=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let u=0;u<l[s].length;++u)Ca(t,l[s][u]);return t}function Jc(l,t,s){if(j0(l)||j0(t))return NaN;let u=0,h=0;return l[2]<t[0]&&(u=t[0]-l[2]),l[0]>t[2]&&(u=l[0]-t[2]),l[1]>t[3]&&(h=l[1]-t[3]),l[3]<t[1]&&(h=t[1]-l[3]),s.distance([0,0],[u,h])}function Pm(l){return 360*l-180}function $b(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Om(l,t){let s=Math.pow(2,t.z),u=(l.y/yt+t.y)/s;return[Pm((l.x/yt+t.x)/s),$b(u)]}function YT(l,t){let s=[];for(let u=0;u<l.length;++u)s.push(Om(l[u],t));return s}function Hb(l,t,s){let u=s.pointOnLine(t,l).point;return s.distance(l,u)}function H0(l,t,s,u,h){let m=s.slice(u[0],u[1]+1),g=1/0;for(let v=t[0];v<=t[1];++v)if((g=Math.min(g,Hb(l[v],m,h)))===0)return 0;return g}function eu(l,t,s,u,h){let m=Math.min(h.pointToSegmentDistance(l,s,u),h.pointToSegmentDistance(t,s,u)),g=Math.min(h.pointToSegmentDistance(s,l,t),h.pointToSegmentDistance(u,l,t));return Math.min(m,g)}function jn(l,t,s,u,h){if(!bl(t,l.length)||!bl(u,s.length))return NaN;let m=1/0;for(let g=t[0];g<t[1];++g)for(let v=u[0];v<u[1];++v){if(Sp(l[g],l[g+1],s[v],s[v+1]))return 0;m=Math.min(m,eu(l[g],l[g+1],s[v],s[v+1],h))}return m}function XT(l,t,s,u,h){if(!bl(t,l.length)||!bl(u,s.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let v=u[0];v<=u[1];++v)if((m=Math.min(m,h.distance(l[g],s[v])))===0)return m;return m}function KT(l,t,s){if(Qd(l,t,!0))return 0;let u=1/0;for(let h of t){let m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(u=Math.min(u,s.pointToSegmentDistance(l,h[m-1],h[0])))===0||(u=Math.min(u,Hb(l,h,s)))===0)return u}return u}function QT(l,t,s,u){if(!bl(t,l.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Qd(l[m],s,!0))return 0;let h=1/0;for(let m=t[0];m<t[1];++m)for(let g of s)for(let v=0,b=g.length,E=b-1;v<b;E=v++){if(Sp(l[m],l[m+1],g[E],g[v]))return 0;h=Math.min(h,eu(l[m],l[m+1],g[E],g[v],u))}return h}function G0(l,t){for(let s of l)for(let u=0;u<=s.length-1;++u)if(Qd(s[u],t,!0))return!0;return!1}function JT(l,t,s,u=1/0){let h=sd(l),m=sd(t);if(u!==1/0&&Jc(h,m,s)>=u)return u;if(Cp(h,m)){if(G0(l,t))return 0}else if(G0(t,l))return 0;let g=u;for(let v of l)for(let b=0,E=v.length,T=E-1;b<E;T=b++)for(let I of t)for(let D=0,O=I.length,R=O-1;D<O;R=D++){if(Sp(v[T],v[b],I[R],I[D]))return 0;g=Math.min(g,eu(v[T],v[b],I[R],I[D],s))}return g}function er(l,t,s,u,h,m,g){if(m===null||g===null)return;let v=Jc(od(u,m),od(h,g),s);v<t&&l.push({dist:v,range1:m,range2:g})}function eI(l,t,s,u,h=1/0){let m=Math.min(u.distance(l[0],s[0][0]),h);if(m===0)return m;let g=new Mm([{dist:0,range1:[0,l.length-1],range2:[0,0]}],U0),v=t?Am:Dm,b=sd(s);for(;g.length;){let E=g.pop();if(E.dist>=m)continue;let T=E.range1;if(Ip(T)<=v){if(!bl(T,l.length))return NaN;if(t){let I=QT(l,T,s,u);if((m=Math.min(m,I))===0)return m}else for(let I=T[0];I<=T[1];++I){let D=KT(l[I],s,u);if((m=Math.min(m,D))===0)return m}}else{let I=$0(T,t);if(I[0]!==null){let D=Jc(od(l,I[0]),b,u);D<m&&g.push({dist:D,range1:I[0],range2:[0,0]})}if(I[1]!==null){let D=Jc(od(l,I[1]),b,u);D<m&&g.push({dist:D,range1:I[1],range2:[0,0]})}}}return m}function Gb(l,t,s,u,h,m=1/0){let g=Math.min(m,h.distance(l[0],s[0]));if(g===0)return g;let v=new Mm([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],U0),b=t?Am:Dm,E=u?Am:Dm;for(;v.length;){let T=v.pop();if(T.dist>=g)continue;let I=T.range1,D=T.range2;if(Ip(I)<=b&&Ip(D)<=E){if(!bl(I,l.length)||!bl(D,s.length))return NaN;if(t&&u?g=Math.min(g,jn(l,I,s,D,h)):t||u?t&&!u?g=Math.min(g,H0(s,D,l,I,h)):!t&&u&&(g=Math.min(g,H0(l,I,s,D,h))):g=Math.min(g,XT(l,I,s,D,h)),g===0)return g}else{let O=$0(I,t),R=$0(D,u);er(v,g,h,l,s,O[0],R[0]),er(v,g,h,l,s,O[0],R[1]),er(v,g,h,l,s,O[1],R[0]),er(v,g,h,l,s,O[1],R[1])}}return g}function q0(l,t,s,u,h=1/0){let m=h,g=od(l,[0,l.length-1]);for(let v of s)if(!(m!==1/0&&Jc(g,od(v,[0,v.length-1]),u)>=m)&&(m=Math.min(m,Gb(l,t,v,!0,u,m)),m===0))return m;return m}function Rm(l,t,s,u,h=1/0){let m=h,g=od(l,[0,l.length-1]);for(let v of s){if(m!==1/0&&Jc(g,sd(v),u)>=m)continue;let b=eI(l,t,v,u,m);if(isNaN(b))return b;if((m=Math.min(m,b))===0)return m}return m}function W0(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class ad{constructor(t,s){this.type=Zt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Xd(t[1])){let u=t[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(W0(u.features[h].geometry.type))return new ad(u,u.features[h].geometry)}else if(u.type==="Feature"){if(W0(u.geometry.type))return new ad(u,u.geometry)}else if(W0(u.type))return new ad(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let s=t.geometry(),u=t.canonicalID();if(s!=null&&u!=null){if(t.geometryType()==="Point")return(function(h,m,g){let v=[];for(let E of h)for(let T of E)v.push(Om(T,m));let b=new eh(v[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Gb(v,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?q0(v,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?Rm(v,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null})(s,u,this.geometries);if(t.geometryType()==="LineString")return(function(h,m,g){let v=[];for(let E of h){let T=[];for(let I of E)T.push(Om(I,m));v.push(T)}let b=new eh(v[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return q0(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let E=1/0;for(let T=0;T<g.coordinates.length;T++){let I=q0(g.coordinates[T],!0,v,b,E);if(isNaN(I))return I;if((E=Math.min(E,I))===0)return E}return E}if(g.type==="Polygon"||g.type==="MultiPolygon"){let E=1/0;for(let T=0;T<v.length;T++){let I=Rm(v[T],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E);if(isNaN(I))return I;if((E=Math.min(E,I))===0)return E}return E}return null})(s,u,this.geometries);if(t.geometryType()==="Polygon")return(function(h,m,g){let v=[];for(let E of(function(T,I){let D=T.length;if(D<=1)return[T];let O=[],R,B;for(let H=0;H<D;H++){let $=Yc(T[H]);$!==0&&(T[H].area=Math.abs($),B===void 0&&(B=$<0),B===$<0?(R&&O.push(R),R=[T[H]]):R.push(T[H]))}return R&&O.push(R),O})(h)){let T=[];for(let I=0;I<E.length;++I)T.push(YT(E[I],m));v.push(T)}let b=new eh(v[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Rm(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let E=1/0;for(let T=0;T<g.coordinates.length;T++){let I=Rm(g.coordinates[T],!0,v,b,E);if(isNaN(I))return I;if((E=Math.min(E,I))===0)return E}return E}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(E,T,I){let D=1/0;for(let O of E)for(let R of T){let B=JT(O,R,I,D);if(isNaN(B))return B;if((D=Math.min(D,B))===0)return D}return D})(g.type==="Polygon"?[g.coordinates]:g.coordinates,v,b):null})(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function th(l){if(l instanceof fs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Qc||l instanceof ad)return!1;if(l instanceof ih)return l.featureConstant;let t=!0;return l.eachChild(s=>{t&&!th(s)&&(t=!1)}),t}function Mp(l){if(l instanceof fs&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(s=>{t&&!Mp(s)&&(t=!1)}),t}function nh(l,t){if(l instanceof fs&&t.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(u=>{s&&!nh(u,t)&&(s=!1)}),s}function qb(l,t,s){return[l,t,s].filter(Boolean).join("")}function Z0(l,t){switch(l){case"string":return wa(t);case"number":return+t;case"boolean":return!!t;case"color":return ui.parse(t);case"formatted":return hs.fromString(wa(t));case"resolvedImage":return ps.build(wa(t))}return t}function Wb(l,t,s,u){return u!==void 0&&(l=u*Math.round(l/u)),t!==void 0&&l<t&&(l=t),s!==void 0&&l>s&&(l=s),l}class ih{constructor(t,s,u,h=!1){this.type=t,this.key=s,this.scope=u,this.featureConstant=h}static parse(t,s){let u=s.expectedType;if(u==null&&(u=ai),t.length<2||t.length>3)return s.error("Invalid number of arguments for 'config' expression.");let h=s.parse(t[1],1);if(!(h instanceof ec))return s.error("Key name of 'config' expression must be a string literal.");let m,g=!0,v=wa(h.value);if(t.length>=3){let b=s.parse(t[2],2);if(!(b instanceof ec))return s.error("Scope of 'config' expression must be a string literal.");m=wa(b.value)}if(s.options){let b=qb(v,m,s._scope),E=s.options.get(b);E&&(g=th(E.value||E.default))}return new ih(u,v,m,g)}evaluate(t){let s=qb(this.key,this.scope,t.scope),u=t.getConfig(s);if(!u)return null;let{type:h,value:m,values:g,minValue:v,maxValue:b,stepValue:E}=u,T=u.default.evaluate(t),I=T;if(m){let D=t.scope;t.scope=(D||"").split("").slice(1).join(""),I=m.evaluate(t),t.scope=D}return h&&(I=Z0(h,I)),I===void 0||v===void 0&&b===void 0&&E===void 0||(typeof I=="number"?I=Wb(I,v,b,E):Array.isArray(I)&&(I=I.map(D=>typeof D=="number"?Wb(D,v,b,E):D))),m!==void 0&&I!==void 0&&g&&!g.includes(I)&&(I=T,h&&(I=Z0(h,I))),(h&&h!==this.type||I!==void 0&&!ym(po(I),this.type))&&(I=Z0(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class km{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");let u=t[1];return s.scope.has(u)?new km(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fm{constructor(t,s=[],u,h=new Yd,m=[],g,v,b){this.registry=t,this.path=s,this.key=s.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=h,this.errors=m,this.expectedType=u,this._scope=g,this.options=v,this.iconImageUseTheme=b}parse(t,s,u,h,m={}){return s||u?this.concat(s,null,u,h)._parse(t,m):this._parse(t,m)}parseObjectValue(t,s,u,h,m,g={}){return this.concat(s,u,h,m)._parse(t,g)}_parse(t,s){function u(h,m,g){return g==="assert"?new Za(m,[h]):g==="coerce"?new xl(m,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let m=h.parse(t,this);if(!m)return null;if(this.expectedType){let g=this.expectedType,v=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else m=u(m,g,s.typeAnnotation||"coerce");else m=u(m,g,s.typeAnnotation||"assert")}if(!(m instanceof ec)&&m.type.kind!=="resolvedImage"&&Y0(m)){let g=new Cm(this._scope,this.options,this.iconImageUseTheme);try{m=new ec(m.type,m.evaluate(g))}catch(v){return this.error(v.message),null}}return m}return xl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,u,h){let m=typeof t=="number"?this.path.concat(t):this.path;m=typeof s=="string"?m.concat(s):m;let g=h?this.scope.concat(h):this.scope;return new Fm(this.registry,m,u||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...s){let u=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new ba(u,t))}checkSubtype(t,s){let u=Zc(t,s);return u&&this.error(u),u}}function Y0(l){if(l instanceof km)return Y0(l.boundExpression);if(l instanceof fs&&l.name==="error"||l instanceof Co||l instanceof Qc||l instanceof ad||l instanceof ih)return!1;let t=l instanceof xl||l instanceof Za,s=!0;return l.eachChild(u=>{s=t?s&&Y0(u):s&&u instanceof ec}),!!s&&th(l)&&nh(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Lm(l,t){let s=l.length-1,u,h,m=0,g=s,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),u=l[v],h=l[v+1],u<=t){if(v===s||t<h)return v;m=v+1}else{if(!(u>t))throw new oo("Input is not a number.");g=v-1}return 0}class Dp{constructor(t,s,u){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(let[h,m]of u)this.labels.push(h),this.outputs.push(m)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");let u=s.parse(t[1],1,Zt);if(!u)return null;let h=[],m=null;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(let g=1;g<t.length;g+=2){let v=g===1?-1/0:t[g],b=t[g+1],E=g,T=g+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);let I=s.parse(b,T,m);if(!I)return null;m=m||I.type,h.push([v,I])}return new Dp(m,u,h)}evaluate(t){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);let h=this.input.evaluate(t);if(h<=s[0])return u[0].evaluate(t);let m=s.length;return h>=s[m-1]?u[m-1].evaluate(t):u[Lm(s,h)].evaluate(t)}eachChild(t){t(this.input);for(let s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}let Zb=.95047,Yb=1.08883,Xb=4/29,rh=6/29,Kb=3*rh*rh,tI=rh*rh*rh,nI=Math.PI/180,iI=180/Math.PI;function X0(l){return l>tI?Math.pow(l,1/3):l/Kb+Xb}function K0(l){return l>rh?l*l*l:Kb*(l-Xb)}function Q0(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function J0(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Qb(l){let t=J0(l.r),s=J0(l.g),u=J0(l.b),h=X0((.4124564*t+.3575761*s+.1804375*u)/Zb),m=X0((.2126729*t+.7151522*s+.072175*u)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-X0((.0193339*t+.119192*s+.9503041*u)/Yb)),alpha:l.a}}function Nm(l){let t=(l.l+16)/116,s=isNaN(l.a)?t:t+l.a/500,u=isNaN(l.b)?t:t-l.b/200;return t=1*K0(t),s=Zb*K0(s),u=Yb*K0(u),new ui(Q0(3.2404542*s-1.5371385*t-.4985314*u),Q0(-.969266*s+1.8760108*t+.041556*u),Q0(.0556434*s-.2040259*t+1.0572252*u),l.alpha)}function zm(l,t,s){let u=t-l;return l+s*(u>180||u<-180?u-360*Math.round(u/360):u)}let oh={forward:Qb,reverse:Nm,interpolate:function(l,t,s){return{l:on(l.l,t.l,s),a:on(l.a,t.a,s),b:on(l.b,t.b,s),alpha:on(l.alpha,t.alpha,s)}}},Ap={forward:function(l){let{l:t,a:s,b:u}=Qb(l),h=Math.atan2(u,s)*iI;return{h:h<0?h+360:h,c:Math.sqrt(s*s+u*u),l:t,alpha:l.a}},reverse:function(l){let t=l.h*nI,s=l.c;return Nm({l:l.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:l.alpha})},interpolate:function(l,t,s){return{h:zm(l.h,t.h,s),c:on(l.c,t.c,s),l:on(l.l,t.l,s),alpha:on(l.alpha,t.alpha,s)}}};var Jb=Object.freeze({__proto__:null,hcl:Ap,lab:oh});class ta{constructor(t,s,u,h,m){this.type=t,this.operator=s,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(let[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,s,u,h){let m=0;if(t.name==="exponential")m=Bm(s,t.base,u,h);else if(t.name==="linear")m=Bm(s,1,u,h);else if(t.name==="cubic-bezier"){let g=t.controlPoints;m=new lm(g[0],g[1],g[2],g[3]).solve(Bm(s,1,u,h))}return m}static parse(t,s){let[u,h,m,...g]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let E=h[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let E=h.slice(1);if(E.length!==4||E.some(T=>typeof T!="number"||T<0||T>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,Zt),!m)return null;let v=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=Ms:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let E=0;E<g.length;E+=2){let T=g[E],I=g[E+1],D=E+3,O=E+4;if(typeof T!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=T)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let R=s.parse(I,O,b);if(!R)return null;b=b||R.type,v.push([T,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new ta(b,u,h,m,v):s.error(`Type ${jr(b)} is not interpolatable.`)}evaluate(t){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);let h=this.input.evaluate(t);if(h<=s[0])return u[0].evaluate(t);let m=s.length;if(h>=s[m-1])return u[m-1].evaluate(t);let g=Lm(s,h),v=ta.interpolationFactor(this.interpolation,h,s[g],s[g+1]),b=u[g].evaluate(t),E=u[g+1].evaluate(t);return this.operator==="interpolate"?yp[this.type.kind.toLowerCase()](b,E,v):this.operator==="interpolate-hcl"?Ap.reverse(Ap.interpolate(Ap.forward(b),Ap.forward(E),v)):oh.reverse(oh.interpolate(oh.forward(b),oh.forward(E),v))}eachChild(t){t(this.input);for(let s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let s=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Bm(l,t,s,u){let h=u-s,m=l-s;return h===0?0:t===1?m/h:(Math.pow(t,m)-1)/(Math.pow(t,h)-1)}class Pp{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let u=null,h=s.expectedType;h&&h.kind!=="value"&&(u=h);let m=[];for(let v of t.slice(1)){let b=s.parse(v,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,m.push(b)}let g=h&&m.some(v=>Zc(h,v.type));return new Pp(g?ai:u,m)}evaluate(t){let s,u=null,h=0;for(let m of this.args){if(h++,u=m.evaluate(t),u&&u instanceof ps&&!u.available&&(s||(s=u),u=null,h===this.args.length))return s;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class nc{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let u=[];for(let m=1;m<t.length-1;m+=2){let g=t[m];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);let v=s.parse(t[m+1],m+1);if(!v)return null;u.push([g,v])}let h=s.parse(t[t.length-1],t.length-1,s.expectedType,u);return h?new nc(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[s,u]of this.bindings)t.push(s,u.serialize());return t.push(this.result.serialize()),t}}class Vm{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Zt),h=s.parse(t[2],2,Xo(s.expectedType||ai));return u&&h?new Vm(h.type.itemType,u,h):null}evaluate(t){let s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new oo("Array index out of bounds: negative index");if(s>=u.length)throw new oo("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new oo("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Um{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Zt),h=s.parse(t[2],2,Xo(s.expectedType||ai));return u&&h?new Um(h.type.itemType,u,h):null}evaluate(t){let s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new oo(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new oo(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];let h=Math.floor(s),m=Math.ceil(s),g=u[h],v=u[m];if(typeof g!="number"||typeof v!="number")throw new oo(`Cannot interpolate between non-number values at index ${s}.`);let b=s-h;return g*(1-b)+v*b}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ev{constructor(t,s){this.type=mi,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,ai);return u&&h?R0(u.type,[mi,Bn,Zt,Wa,ai])?new ev(u,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(u.type)} instead`):null}evaluate(t){let s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!wp(s,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${jr(po(s))} instead.`);if(!wp(u,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${jr(po(u))} instead.`);return u.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class sh{constructor(t,s,u){this.type=Zt,this.needle=t,this.haystack=s,this.fromIndex=u}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,ai);if(!u||!h)return null;if(!R0(u.type,[mi,Bn,Zt,Wa,ai]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(u.type)} instead`);if(t.length===4){let m=s.parse(t[3],3,Zt);return m?new sh(u,h,m):null}return new sh(u,h)}evaluate(t){let s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!wp(s,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${jr(po(s))} instead.`);if(!wp(u,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${jr(po(u))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(t);return u.indexOf(s,h)}return u.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Op{constructor(t,s,u,h,m,g){this.inputType=t,this.type=s,this.input=u,this.cases=h,this.outputs=m,this.otherwise=g}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let u,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);let m={},g=[];for(let E=2;E<t.length-1;E+=2){let T=t[E],I=t[E+1];Array.isArray(T)||(T=[T]);let D=s.concat(E);if(T.length===0)return D.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,po(R)))return null}else u=po(R);if(m[String(R)]!==void 0)return D.error("Branch labels must be unique.");m[String(R)]=g.length}let O=s.parse(I,E,h);if(!O)return null;h=h||O.type,g.push(O)}let v=s.parse(t[1],1,ai);if(!v)return null;let b=s.parse(t[t.length-1],t.length-1,h);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(u,v.type)?null:new Op(u,h,v,m,g,b):null}evaluate(t){let s=this.input.evaluate(t);return(ym(po(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],h={};for(let g of s){let v=h[this.cases[g]];v===void 0?(h[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[v][1].push(g)}let m=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,v]of u)t.push(v.length===1?m(v[0]):v.map(m)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Rp{constructor(t,s,u){this.type=t,this.branches=s,this.otherwise=u}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);let h=[];for(let g=1;g<t.length-1;g+=2){let v=s.parse(t[g],g,mi);if(!v)return null;let b=s.parse(t[g+1],g+1,u);if(!b)return null;h.push([v,b]),u=u||b.type}let m=s.parse(t[t.length-1],t.length-1,u);return m?new Rp(u,h,m):null}evaluate(t){for(let[s,u]of this.branches)if(s.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[s,u]of this.branches)t(s),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class jm{constructor(t,s,u,h){this.type=t,this.input=s,this.beginIndex=u,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,ai),h=s.parse(t[2],2,Zt);if(!u||!h)return null;if(!R0(u.type,[Xo(ai),Bn,ai]))return s.error(`Expected first argument to be of type array or string, but found ${jr(u.type)} instead`);if(t.length===4){let m=s.parse(t[3],3,Zt);return m?new jm(u.type,u,h,m):null}return new jm(u.type,u,h)}evaluate(t){let s=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!wp(s,["string","array"]))throw new oo(`Expected first argument to be of type array or string, but found ${jr(po(s))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(t);return s.slice(u,h)}return s.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class tv{constructor(t,s){this.type=Xo(Bn),this.str=t,this.delimiter=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=s.parse(t[1],1,Bn),h=s.parse(t[2],2,Bn);return u&&h?new tv(u,h):void 0}evaluate(t){let s=this.str.evaluate(t),u=this.delimiter.evaluate(t);return s.split(u)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function nv(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function iv(l,t,s,u){return u.compare(t,s)===0}function ah(l,t,s){let u=l!=="=="&&l!=="!=";return class N5{constructor(m,g,v){this.type=mi,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");let v=m[0],b=g.parse(m[1],1,ai);if(!b)return null;if(!nv(v,b.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${jr(b.type)}'.`);let E=g.parse(m[2],2,ai);if(!E)return null;if(!nv(v,E.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${jr(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${jr(b.type)}' and '${jr(E.type)}'.`);u&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new Za(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new Za(b.type,[E])));let T=null;if(m.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(T=g.parse(m[3],3,vm),!T)return null}return new N5(b,E,T)}evaluate(m){let g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){let b=po(g),E=po(v);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new oo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=po(g),E=po(v);if(b.kind!=="string"||E.kind!=="string")return t(m,g,v)}return this.collator?s(m,g,v,this.collator.evaluate(m)):t(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[l];return this.eachChild(g=>{m.push(g.serialize())}),m}}}let rI=ah("==",function(l,t,s){return t===s},iv),oI=ah("!=",function(l,t,s){return t!==s},function(l,t,s,u){return!iv(0,t,s,u)}),e1=ah("<",function(l,t,s){return t<s},function(l,t,s,u){return u.compare(t,s)<0}),t1=ah(">",function(l,t,s){return t>s},function(l,t,s,u){return u.compare(t,s)>0}),$m=ah("<=",function(l,t,s){return t<=s},function(l,t,s,u){return u.compare(t,s)<=0}),sI=ah(">=",function(l,t,s){return t>=s},function(l,t,s,u){return u.compare(t,s)>=0});class Hm{constructor(t,s,u,h,m,g){this.type=Bn,this.number=t,this.locale=s,this.currency=u,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");let u=s.parse(t[1],1,Zt);if(!u)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=s.parseObjectValue(h.locale,2,"locale",Bn),!m))return null;let g=null;if(h.currency&&(g=s.parseObjectValue(h.currency,2,"currency",Bn),!g))return null;let v=null;if(h.unit&&(v=s.parseObjectValue(h.unit,2,"unit",Bn),!v))return null;let b=null;if(h["min-fraction-digits"]&&(b=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Zt),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Zt),!E)?null:new Hm(u,m,g,v,b,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class rv{constructor(t){this.type=Zt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);let u=s.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${jr(u.type)} instead.`):new rv(u):null}evaluate(t){let s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new oo(`Expected value to be of type string or array, but found ${jr(po(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}function n1(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let lh={"==":rI,"!=":oI,">":t1,"<":e1,">=":sI,"<=":$m,array:Za,at:Vm,"at-interpolated":Um,boolean:Za,case:Rp,coalesce:Pp,collator:Co,format:yl,image:xn,in:ev,"index-of":sh,interpolate:ta,"interpolate-hcl":ta,"interpolate-lab":ta,length:rv,let:nc,literal:ec,match:Op,number:Za,"number-format":Hm,object:Za,slice:jm,step:Dp,string:Za,"to-boolean":xl,"to-color":xl,"to-number":xl,"to-string":xl,var:km,within:Qc,distance:ad,config:ih,split:tv};function ov(l,[t,s,u,h]){t=t.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);let m=h?h.evaluate(l):1,g=rd(t,s,u,m);if(g)throw new oo(g);return new ui(t/255,s/255,u/255,m)}function sv(l,[t,s,u,h]){t=t.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);let m=h?h.evaluate(l):1,g=(function(E,T,I,D){return typeof E=="number"&&E>=0&&E<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[E,T,I,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[E,T,I,D]:[E,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[E,T,I,D]:[E,T,I]).join(", ")}]: 'h' must be between 0 and 360.`})(t,s,u,m);if(g)throw new oo(g);let v=`hsla(${t}, ${s}%, ${u}%, ${m})`,b=ui.parse(v);if(!b)throw new oo(`Failed to parse HSLA color: ${v}`);return b}function i1(l,t){return l in t}function av(l,t){let s=t[l];return s===void 0?null:s}function tu(l){return{type:l}}function ld(l){if(l instanceof ih)return new Set([l.key]);let t=new Set;return l.eachChild(s=>{t=new Set([...t,...ld(s)])}),t}function Gm(l){if(l instanceof fs&&l.name==="is-active-floor")return!0;let t=!1;return l.eachChild(s=>{!t&&Gm(s)&&(t=!0)}),t}function r1(l){return{result:"success",value:l}}function nu(l){return{result:"error",value:l}}function lv(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function kp(l){return l["property-type"]==="data-driven"}function o1(l){return lv(l.expression,"measure-light")}function s1(l){return lv(l.expression,"zoom")}function qm(l){return!!l.expression&&l.expression.interpolated}function Wm(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function a1(l){return l}function l1(l,t){let s=t.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",h=u||!(u||l.property!==void 0),m=l.type||(qm(t)?"exponential":"interval");if(s&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(E=>[E[0],ui.parse(E[1])])),l.default=ui.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Jb[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let g,v,b;if(m==="exponential")g=c1;else if(m==="interval")g=lI;else if(m==="categorical"){g=aI,v=Object.create(null);for(let E of l.stops)v[E[0]]=E[1];b=typeof l.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=u1}if(u){let E={},T=[];for(let O=0;O<l.stops.length;O++){let R=l.stops[O],B=R[0].zoom;E[B]===void 0&&(E[B]={zoom:B,type:l.type,property:l.property,default:l.default,stops:[]},T.push(B)),E[B].stops.push([R[0].value,R[1]])}let I=[];for(let O of T)I.push([E[O].zoom,l1(E[O],t)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:ta.interpolationFactor.bind(void 0,D),zoomStops:I.map(O=>O[0]),evaluate:({zoom:O},R)=>c1({stops:I,base:l.base},t,O).evaluate(O,R)}}if(h){let E=m==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ta.interpolationFactor.bind(void 0,E),zoomStops:l.stops.map(T=>T[0]),evaluate:({zoom:T})=>g(l,t,T,v,b)}}return{kind:"source",evaluate(E,T){let I=T&&T.properties?T.properties[l.property]:void 0;return I===void 0?wl(l.default,t.default):g(l,t,I,v,b)}}}function wl(l,t,s){return l!==void 0?l:t!==void 0?t:s!==void 0?s:void 0}function aI(l,t,s,u,h){return wl(typeof s===h?u[s]:void 0,l.default,t.default)}function lI(l,t,s){if(!Kd(s))return wl(l.default,t.default);let u=l.stops.length;if(u===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[u-1][0])return l.stops[u-1][1];let h=Lm(l.stops.map(m=>m[0]),s);return l.stops[h][1]}function c1(l,t,s){let u=l.base!==void 0?l.base:1;if(!Kd(s))return wl(l.default,t.default);let h=l.stops.length;if(h===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[h-1][0])return l.stops[h-1][1];let m=Lm(l.stops.map(T=>T[0]),s),g=(function(T,I,D,O){let R=O-D,B=T-D;return R===0?0:I===1?B/R:(Math.pow(I,B)-1)/(Math.pow(I,R)-1)})(s,u,l.stops[m][0],l.stops[m+1][0]),v=l.stops[m][1],b=l.stops[m+1][1],E=yp[t.type]||a1;if(l.colorSpace&&l.colorSpace!=="rgb"){let T=Jb[l.colorSpace];E=(I,D)=>T.reverse(T.interpolate(T.forward(I),T.forward(D),g))}return typeof v.evaluate=="function"?{evaluate(...T){let I=v.evaluate.apply(void 0,T),D=b.evaluate.apply(void 0,T);if(I!==void 0&&D!==void 0)return E(I,D,g)}}:E(v,b,g)}function u1(l,t,s){return t.type==="color"?s=ui.parse(s):t.type==="formatted"?s=hs.fromString(s.toString()):t.type==="resolvedImage"?s=ps.build(s.toString()):Gt(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),wl(s,l.default,t.default)}fs.register(lh,{error:[{kind:"error"},[Bn],(l,[t])=>{throw new oo(t.evaluate(l))}],typeof:[Bn,[ai],(l,[t])=>jr(po(t.evaluate(l)))],"to-rgba":[Xo(Zt,4),[Ms],(l,[t])=>t.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xo(Zt,4),[Ms],(l,[t])=>t.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ms,[Zt,Zt,Zt],ov],rgba:[Ms,[Zt,Zt,Zt,Zt],ov],hsl:[Ms,[Zt,Zt,Zt],sv],hsla:[Ms,[Zt,Zt,Zt,Zt],sv],has:{type:mi,overloads:[[[Bn],(l,[t])=>i1(t.evaluate(l),l.properties())],[[Bn,vl],(l,[t,s])=>i1(t.evaluate(l),s.evaluate(l))]]},get:{type:ai,overloads:[[[Bn],(l,[t])=>av(t.evaluate(l),l.properties())],[[Bn,vl],(l,[t,s])=>av(t.evaluate(l),s.evaluate(l))]]},"feature-state":[ai,[Bn],(l,[t])=>av(t.evaluate(l),l.featureState||{})],properties:[vl,[],l=>l.properties()],"geometry-type":[Bn,[],l=>l.geometryType()],worldview:[Bn,[],l=>l.globals.worldview||""],"is-active-floor":[mi,tu(Bn),(l,t)=>{if(!(l.globals.activeFloors&&l.globals.activeFloors.size>0))return!1;let s=l.globals.activeFloors;return t.some(u=>{let h=u.evaluate(l);return s.has(h)})}],id:[ai,[],l=>l.id()],zoom:[Zt,[],l=>l.globals.zoom],pitch:[Zt,[],l=>l.globals.pitch||0],"distance-from-center":[Zt,[],l=>l.distanceFromCenter()],"measure-light":[Zt,[Bn],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[Zt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Zt,[],l=>l.globals.lineProgress||0],"raster-value":[Zt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Zt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Zt,[],l=>l.globals.skyRadialProgress||0],accumulated:[ai,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Zt,tu(Zt),(l,t)=>{let s=0;for(let u of t)s+=u.evaluate(l);return s}],"*":[Zt,tu(Zt),(l,t)=>{let s=1;for(let u of t)s*=u.evaluate(l);return s}],"-":{type:Zt,overloads:[[[Zt,Zt],(l,[t,s])=>t.evaluate(l)-s.evaluate(l)],[[Zt],(l,[t])=>-t.evaluate(l)]]},"/":[Zt,[Zt,Zt],(l,[t,s])=>t.evaluate(l)/s.evaluate(l)],"%":[Zt,[Zt,Zt],(l,[t,s])=>t.evaluate(l)%s.evaluate(l)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(l,[t,s])=>Math.pow(t.evaluate(l),s.evaluate(l))],sqrt:[Zt,[Zt],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[Zt,[Zt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[Zt,[Zt],(l,[t])=>Math.log(t.evaluate(l))],log2:[Zt,[Zt],(l,[t])=>Math.log2(t.evaluate(l))],sin:[Zt,[Zt],(l,[t])=>Math.sin(t.evaluate(l))],cos:[Zt,[Zt],(l,[t])=>Math.cos(t.evaluate(l))],tan:[Zt,[Zt],(l,[t])=>Math.tan(t.evaluate(l))],asin:[Zt,[Zt],(l,[t])=>Math.asin(t.evaluate(l))],acos:[Zt,[Zt],(l,[t])=>Math.acos(t.evaluate(l))],atan:[Zt,[Zt],(l,[t])=>Math.atan(t.evaluate(l))],min:[Zt,tu(Zt),(l,t)=>Math.min(...t.map(s=>s.evaluate(l)))],max:[Zt,tu(Zt),(l,t)=>Math.max(...t.map(s=>s.evaluate(l)))],abs:[Zt,[Zt],(l,[t])=>Math.abs(t.evaluate(l))],round:[Zt,[Zt],(l,[t])=>{let s=t.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[Zt,[Zt],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[Zt,[Zt],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[mi,[Bn,ai],(l,[t,s])=>l.properties()[t.value]===s.value],"filter-id-==":[mi,[ai],(l,[t])=>l.id()===t.value],"filter-type-==":[mi,[Bn],(l,[t])=>l.geometryType()===t.value],"filter-<":[mi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u<h}],"filter-id-<":[mi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s<u}],"filter->":[mi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u>h}],"filter-id->":[mi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s>u}],"filter-<=":[mi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[mi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s<=u}],"filter->=":[mi,[Bn,ai],(l,[t,s])=>{let u=l.properties()[t.value],h=s.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[mi,[ai],(l,[t])=>{let s=l.id(),u=t.value;return typeof s==typeof u&&s>=u}],"filter-has":[mi,[ai],(l,[t])=>t.value in l.properties()],"filter-has-id":[mi,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[mi,[Xo(Bn)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[mi,[Xo(ai)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[mi,[Bn,Xo(ai)],(l,[t,s])=>s.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[mi,[Bn,Xo(ai)],(l,[t,s])=>(function(u,h,m,g){for(;m<=g;){let v=m+g>>1;if(h[v]===u)return!0;h[v]>u?g=v-1:m=v+1}return!1})(l.properties()[t.value],s.value,0,s.value.length-1)],all:{type:mi,overloads:[[[mi,mi],(l,[t,s])=>t.evaluate(l)&&s.evaluate(l)],[tu(mi),(l,t)=>{for(let s of t)if(!s.evaluate(l))return!1;return!0}]]},any:{type:mi,overloads:[[[mi,mi],(l,[t,s])=>t.evaluate(l)||s.evaluate(l)],[tu(mi),(l,t)=>{for(let s of t)if(s.evaluate(l))return!0;return!1}]]},"!":[mi,[mi],(l,[t])=>!t.evaluate(l)],"is-supported-script":[mi,[Bn],(l,[t])=>{let s=l.globals&&l.globals.isSupportedScript;return!s||s(t.evaluate(l))}],upcase:[Bn,[Bn],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[Bn,[Bn],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[Bn,tu(ai),(l,t)=>t.map(s=>wa(s.evaluate(l))).join("")],"resolved-locale":[Bn,[vm],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[Zt,[Zt,Zt,ai],(l,t)=>{let[s,u,h]=t.map(g=>g.evaluate(l));if(s>u||s===u)return s;let m;if(typeof h=="string")m=(function(g){let v=0;if(g.length===0)return v;for(let b=0;b<g.length;b++)v=(v<<5)-v+g.charCodeAt(b),v|=0;return v})(h);else{if(typeof h!="number")throw new oo(`Invalid seed input: ${h}`);m=h}return s+n1(m)()*(u-s)}]});class Zm{constructor(t,s,u,h,m){this.expression=t,this._warningHistory={},this._scope=u,this._options=h,this._iconImageUseTheme=m,this._evaluator=new Cm(u,h,m),this._defaultValue=s?(function(g){return g.type==="color"&&(Wm(g.default)||Array.isArray(g.default))?new ui(0,0,0,0):g.type==="color"?ui.parse(g.default)||null:g.default===void 0?null:g.default})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=ld(t),this.isIndoorDependent=Gm(t)}evaluateWithoutErrorHandling(t,s,u,h,m,g,v,b){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,u,h,m,g,v,b,E){this._evaluator||(this._evaluator=new Cm(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=E||null;try{let T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new oo(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){let I=T;return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Fp(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in lh}function iu(l,t,s,u,h){let m=new Fm(lh,[],t?(function(v){let b={color:Ms,string:Bn,number:Zt,enum:Bn,boolean:mi,formatted:xp,resolvedImage:bp};return v.type==="array"?Xo(b[v.value]||ai,v.length):b[v.type]})(t):void 0,void 0,void 0,s,u,h),g=m.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?r1(new Zm(g,t,s,u,h)):nu(m.errors)}class ch{constructor(t,s,u,h){this.kind=t,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=t!=="constant"&&!Mp(s.expression),this.configDependencies=ld(s.expression),this.isIndoorDependent=Gm(s.expression)}evaluateWithoutErrorHandling(t,s,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,h,m,g)}evaluate(t,s,u,h,m,g,v){return this._styleExpression.evaluate(t,s,u,h,m,g,void 0,void 0,v)}}class cd{constructor(t,s,u,h,m,g){this.kind=t,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Mp(s.expression),this.isIndoorDependent=Gm(s.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=ld(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,h,m,g)}evaluate(t,s,u,h,m,g){return this._styleExpression.evaluate(t,s,u,h,m,g)}interpolationFactor(t,s,u){return this.interpolationType?ta.interpolationFactor(this.interpolationType,t,s,u):0}}function cv(l,t,s,u,h){if((l=iu(l,t,s,u,h)).result==="error")return l;let m=l.value.expression,g=th(m);if(!g&&!kp(t))return nu([new ba("","data expressions not supported")]);let v=nh(m,["zoom","pitch","distance-from-center"]);if(!v&&!s1(t))return nu([new ba("","zoom expressions not supported")]);let b=nh(m,["measure-light"]);if(!b&&!o1(t))return nu([new ba("","measure-light expression not supported")]);let E=nh(m,["line-progress"]);if(!E&&!(function(D){return lv(D.expression,"line-progress")})(t))return nu([new ba("","line-progress expression not supported")]);let T=t.expression&&t.expression.relaxZoomRestriction,I=Lp(m);return I||v||T?I instanceof ba?nu([I]):I instanceof ta&&!qm(t)?nu([new ba("",'"interpolate" expressions cannot be used with this property')]):r1(I?new cd(g&&E?"camera":"composite",l.value,I.labels,I instanceof ta?I.interpolation:void 0,b,E):new ch(g&&E?"constant":"source",l.value,b,E)):nu([new ba("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ym{constructor(t,s){this._parameters=t,this._specification=s,Object.assign(this,l1(this._parameters,this._specification))}static deserialize(t){return new Ym(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Lp(l){let t=null;if(l instanceof nc)t=Lp(l.result);else if(l instanceof Pp){for(let s of l.args)if(t=Lp(s),t)break}else(l instanceof Dp||l instanceof ta)&&l.input instanceof fs&&l.input.name==="zoom"&&(t=l);return t instanceof ba||l.eachChild(s=>{let u=Lp(s);u instanceof ba?t=u:t&&u&&t!==u&&(t=new ba("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var uv,d1,h1=(function(){if(d1)return uv;d1=1,uv=t;var l=3;function t(s,u,h){var m=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(h=g[2]);for(var v=0;v<this.d*this.d;v++){var b=g[l+v],E=g[l+v+1];m.push(b===E?null:g.subarray(b,E))}var T=g[l+m.length+1];this.keys=g.subarray(g[l+m.length],T),this.bboxes=g.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var I=0;I<this.d*this.d;I++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=h,this.scale=u/s,this.uid=0;var D=h/u*s;this.min=-D,this.max=s+D}return t.prototype.insert=function(s,u,h,m,g){this._forEachCell(u,h,m,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(s,u,h,m,g,v){this.cells[g].push(v)},t.prototype.query=function(s,u,h,m,g){var v=this.min,b=this.max;if(s<=v&&u<=v&&b<=h&&b<=m&&!g)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,u,h,m,this._queryCell,E,{},g),E},t.prototype._queryCell=function(s,u,h,m,g,v,b,E){var T=this.cells[g];if(T!==null)for(var I=this.keys,D=this.bboxes,O=0;O<T.length;O++){var R=T[O];if(b[R]===void 0){var B=4*R;(E?E(D[B+0],D[B+1],D[B+2],D[B+3]):s<=D[B+2]&&u<=D[B+3]&&h>=D[B+0]&&m>=D[B+1])?(b[R]=!0,v.push(I[R])):b[R]=!1}}},t.prototype._forEachCell=function(s,u,h,m,g,v,b,E){for(var T=this._convertToCellCoord(s),I=this._convertToCellCoord(u),D=this._convertToCellCoord(h),O=this._convertToCellCoord(m),R=T;R<=D;R++)for(var B=I;B<=O;B++){var H=this.d*B+R;if((!E||E(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,s,u,h,m,H,v,b,E))return}},t.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},t.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=l+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var g=new Int32Array(u+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=u,b=0;b<s.length;b++){var E=s[b];g[l+b]=v,g.set(E,v),v+=E.length}return g[l+s.length]=v,g.set(this.keys,v),g[l+s.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer},uv})(),uh=Yu(h1);let ud={};function Lt(l,t,s={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),ud[t]={klass:l,omit:s.omit||[]}}Lt(Object,"Object"),uh.serialize=function(l,t){let s=l.toArrayBuffer();return t&&t.add(s),{buffer:s}},uh.deserialize=function(l){return new uh(l.buffer)},Object.defineProperty(uh,"name",{value:"Grid"}),Lt(uh,"Grid"),delete st.prototype.constructor,Lt(ui,"Color"),Lt(Error,"Error"),Lt(hs,"Formatted"),Lt(xm,"FormattedSection"),Lt(Bs,"AJAXError"),Lt(ps,"ResolvedImage"),Lt(Ym,"StylePropertyFunction"),Lt(Zm,"StyleExpression",{omit:["_evaluator"]}),Lt(as,"ImageId"),Lt(Jl,"ImageVariant"),Lt(cd,"ZoomDependentExpression"),Lt(ch,"ZoomConstantExpression"),Lt(fs,"CompoundExpression",{omit:["_evaluate"]});for(let l in lh)ud[lh[l]._classRegistryKey]||Lt(lh[l],`Expression${l}`);function Np(l){return l&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ic(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Np(l)||l instanceof ImageBitmap)return t&&t.add(l),l;if(ArrayBuffer.isView(l))return t&&t.add(l.buffer),l;if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){let s=[];for(let u of l)s.push(ic(u,t));return s}if(l instanceof Map){let s={$name:"Map",entries:[]};for(let[u,h]of l.entries())s.entries.push(ic(u),ic(h,t));return s}if(l instanceof Set){let s={$name:"Set"},u=0;for(let h of l.values())s[++u]=ic(h);return s}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){let s=l.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);let h=s.serialize?s.serialize(l,t):{};if(!s.serialize){for(let m in l)l.hasOwnProperty(m)&&(ud[u].omit.indexOf(m)>=0||(h[m]=ic(l[m],t)));l instanceof Error&&(h.message=l.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof l)}function ru(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Np(l)||l instanceof ImageBitmap||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(ru);if(typeof l=="object"){let t=l.$name||"Object";if(t==="Map"){let h=l.entries||[],m=new Map;for(let g=0;g<h.length;g+=2)m.set(ru(h[g]),ru(h[g+1]));return m}if(t==="Set"){let h=new Set;for(let m of Object.keys(l))m!=="$name"&&h.add(ru(l[m]));return h}if(t==="BigInt")return BigInt(l.value);let{klass:s}=ud[t];if(!s)throw new Error(`Can't deserialize unregistered class "${t}".`);if(s.deserialize)return s.deserialize(l);let u=Object.create(s.prototype);for(let h of Object.keys(l))h!=="$name"&&(u[h]=ru(l[h]));return u}throw new Error("can't deserialize object of type "+typeof l)}let en={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function zp(l){for(let t of l)if(Xm(t.charCodeAt(0)))return!0;return!1}function dv(l){for(let t of l)if(!p1(t.charCodeAt(0)))return!1;return!0}function p1(l){return!(en.Arabic(l)||en["Arabic Supplement"](l)||en["Arabic Extended-A"](l)||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l))}function Xm(l){return!(l!==746&&l!==747&&(l<4352||!(en["Bopomofo Extended"](l)||en.Bopomofo(l)||en["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||en["CJK Compatibility Ideographs"](l)||en["CJK Compatibility"](l)||en["CJK Radicals Supplement"](l)||en["CJK Strokes"](l)||!(!en["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||en["CJK Unified Ideographs Extension A"](l)||en["CJK Unified Ideographs"](l)||en["Enclosed CJK Letters and Months"](l)||en["Hangul Compatibility Jamo"](l)||en["Hangul Jamo Extended-A"](l)||en["Hangul Jamo Extended-B"](l)||en["Hangul Jamo"](l)||en["Hangul Syllables"](l)||en.Hiragana(l)||en["Ideographic Description Characters"](l)||en.Kanbun(l)||en["Kangxi Radicals"](l)||en["Katakana Phonetic Extensions"](l)||en.Katakana(l)&&l!==12540||!(!en["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!en["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||en["Unified Canadian Aboriginal Syllabics"](l)||en["Unified Canadian Aboriginal Syllabics Extended"](l)||en["Vertical Forms"](l)||en["Yijing Hexagram Symbols"](l)||en["Yi Syllables"](l)||en["Yi Radicals"](l))))}function Km(l){return!(Xm(l)||(function(t){return!!(en["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||en["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||en["Letterlike Symbols"](t)||en["Number Forms"](t)||en["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||en["Control Pictures"](t)&&t!==9251||en["Optical Character Recognition"](t)||en["Enclosed Alphanumerics"](t)||en["Geometric Shapes"](t)||en["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||en["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||en["CJK Symbols and Punctuation"](t)||en.Katakana(t)||en["Private Use Area"](t)||en["CJK Compatibility Forms"](t)||en["Small Form Variants"](t)||en["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(l))}function Qm(l){return en.Arabic(l)||en["Arabic Supplement"](l)||en["Arabic Extended-A"](l)||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l)}function hv(l){return l>=1424&&l<=2303||en["Arabic Presentation Forms-A"](l)||en["Arabic Presentation Forms-B"](l)}function rc(l,t){return!(!t&&hv(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||en.Khmer(l))}function cI(l){for(let t of l)if(hv(t.charCodeAt(0)))return!0;return!1}let Vs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"},pv=null,ms=Vs.unavailable,oc=null,Bp=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(ms=Vs.error),pv&&pv(l)};function Jm(){eg.fire(new _l("pluginStateChange",{pluginStatus:ms,pluginURL:oc}))}let eg=new id,Vp=function(){return ms},f1=function(){if(ms!==Vs.deferred||!oc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ms=Vs.loading,Jm(),oc&&Ql({url:oc},l=>{l?Bp(l):(ms=Vs.loaded,Jm())})},sc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ms===Vs.loaded||sc.applyArabicShaping!=null,isLoading:()=>ms===Vs.loading,setState(l){ms=l.pluginStatus,oc=l.pluginURL},isParsing:()=>ms===Vs.parsing,isParsed:()=>ms===Vs.parsed,getPluginURL:()=>oc};class Ui{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(s,u){for(let h of s)if(!rc(h.charCodeAt(0),u))return!1;return!0})(t,sc.isLoaded())}}class tg{constructor(t,s,u,h,m){this.property=t,this.value=s,this.expression=(function(g,v,b,E,T){if(Wm(g))return new Ym(g,v);if(Fp(g)||Array.isArray(g)&&g.length>0){let I=cv(g,v,b,E,T);if(I.result==="error")throw new Error(I.value.map(D=>`${D.key}: ${D.message}`).join(", "));return I.value}{let I=g;return typeof g=="string"&&v.type==="color"&&(I=ui.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>I}}})(s===void 0?t.specification.default:s,t.specification,u,h,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,u,h){return this.property.possiblyEvaluate(this,t,s,u,h)}}class fv{constructor(t,s,u,h){this.property=t,this.value=new tg(t,void 0,s,u,h)}transitioned(t,s){return new g1(this.property,this.value,s,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new g1(this.property,this.value,null,{},0)}}class m1{constructor(t,s,u,h){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Xe(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new fv(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new tg(this._values[t].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].value.isIndoorDependent())}setTransitionOrValue(t,s){s&&(this._options=s);let u=this._properties.properties;if(t)for(let h in t){let m=t[h];if(h.endsWith("-transition")){let g=h.slice(0,-11);u[g]&&this.setTransition(g,m)}else u.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(t){return Xe(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new fv(this._values[t].property)),this._values[t].transition=Xe(s)||void 0}serialize(){let t={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(t[s]=u);let h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){let u=new _1(this._properties);for(let h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(t,s._values[h]);return u}untransitioned(){let t=new _1(this._properties);for(let s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}isIndoorDependent(){return this._isIndoorDependent}}class g1{constructor(t,s,u,h,m){let g=h.delay||0,v=h.duration||0;m=m||0,this.property=t,this.value=s,this.begin=m+g,this.end=this.begin+v,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(t,s,u){let h=t.now||0,m=this.value.possiblyEvaluate(t,s,u),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(t,s,u);{let v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,s,u),m,Ku(v))}}return m}}class _1{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,u){let h=new hd(this._properties);for(let m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,s,u);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class v1{constructor(t,s,u,h){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Xe(this._values[t].value)}setValue(t,s){this._values[t]=new tg(this._values[t].property,s===null?void 0:Xe(s),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].isIndoorDependent())}serialize(){let t={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(t[s]=u)}return t}possiblyEvaluate(t,s,u,h){let m=new hd(this._properties);for(let g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(t,s,u,h);return m}isIndoorDependent(){return this._isIndoorDependent}}class dd{constructor(t,s,u,h){this.property=t,this.value=s,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,u,h){return this.property.evaluate(this.value,this.parameters,t,s,u,h,this.iconImageUseTheme)}}class hd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,u){let h=yp[this.specification.type];return h?h(t,s,u):t}}class Ct{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,u,h,m){return t.expression.kind==="constant"||t.expression.kind==="camera"?new dd(this,{kind:"constant",value:t.expression.evaluate(s,null,{},u,h,void 0,m)},s):new dd(this,t.expression,s,m)}interpolate(t,s,u){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new dd(this,{kind:"constant",value:void 0},t.parameters);let h=yp[this.specification.type];return h?new dd(this,{kind:"constant",value:h(t.value.value,s.value.value,u)},t.parameters):t}evaluate(t,s,u,h,m,g,v){return t.kind==="constant"?t.value:t.evaluate(s,u,h,m,g,void 0,v)}}class pd{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,h){return!!t.expression.evaluate(s,null,{},u,h)}interpolate(){return!1}}class gr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let s=new Ui(0,{});for(let u in t){let h=t[u];h.specification.overridable&&this.overridableProperties.push(u);let m=this.defaultPropertyValues[u]=new tg(h,void 0),g=this.defaultTransitionablePropertyValues[u]=new fv(h);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(s)}}}Lt(Ct,"DataDrivenProperty"),Lt(gt,"DataConstantProperty"),Lt(pd,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function y1(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function ng(l){if(Array.isArray(l))return l.map(ng);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let t={};for(let s in l)t[s]=ng(l[s]);return t}return y1(l)}function Cl(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let t of l.slice(1))if(!Cl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function ig(l,t="",s=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cl(l)||(l=rg(l));let h=l,m=!0;try{m=(function(T){if(!dh(T))return T;let I=ng(T);return x1(I),I=fd(I),I})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,v=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){v=Oe[`filter_${u}`];let T=iu(m,v,t,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));g=(I,D,O)=>T.value.evaluate(I,D,{},O)}let b=null,E=null;if(m!==h){let T=iu(h,v,t,s);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,D,O,R,B)=>T.value.evaluate(I,D,{},O,void 0,void 0,R,B),E=!th(T.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:b1(m),needFeature:!!E}}function fd(l){if(!Array.isArray(l))return l;let t=(function(s){if(uI.has(s[0])){for(let u=1;u<s.length;u++)if(dh(s[u]))return!0}return s})(l);return t===!0?t:t.map(s=>fd(s))}function x1(l){let t=!1,s=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)t=t||dh(l[u]),s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="match"){t=t||dh(l[1]);for(let u=2;u<l.length-1;u+=2)s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="step"){t=t||dh(l[1]);for(let u=1;u<l.length-1;u+=2)s.push(l[u+1])}t&&(l.length=0,l.push("any",...s));for(let u=1;u<l.length;u++)x1(l[u])}function dh(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<l.length;s++)if(dh(l[s]))return!0;return!1}let uI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dI(l,t){return l<t?-1:l>t?1:0}function b1(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(b1(l[t]))return!0;return!1}function rg(l){if(!l)return!0;let t=l[0];return l.length<=1?t!=="any":t==="=="?og(l[1],l[2],"=="):t==="!="?Up(og(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?og(l[1],l[2],t):t==="any"?(s=l.slice(1),["any"].concat(s.map(rg))):t==="all"?["all"].concat(l.slice(1).map(rg)):t==="none"?["all"].concat(l.slice(1).map(rg).map(Up)):t==="in"?sg(l[1],l.slice(2)):t==="!in"?Up(sg(l[1],l.slice(2))):t==="has"?ag(l[1]):t!=="!has"||Up(ag(l[1]));var s}function og(l,t,s){switch(l){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,l,t]}}function sg(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",l,["literal",t.sort(dI)]]:["filter-in-small",l,["literal",t]]}}function ag(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Up(l){return["!",l]}let md="";function Xa(l,t){return t?`${l}${md}${t}`:l}let w1,C1=()=>w1||(w1=new gr({"icon-size":new Ct(Oe.layout_symbol["icon-size"]),"icon-image":new Ct(Oe.layout_symbol["icon-image"]),"icon-rotate":new Ct(Oe.layout_symbol["icon-rotate"]),"icon-offset":new Ct(Oe.layout_symbol["icon-offset"]),"text-size":new Ct(Oe.layout_symbol["text-size"]),"text-rotate":new Ct(Oe.layout_symbol["text-rotate"]),"text-offset":new Ct(Oe.layout_symbol["text-offset"])}));class E1{constructor(t,s,u,h,m,g){let v=iu(t,Oe.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=s,u){this.properties=new hd(C1()),this.unevaluatedLayout=new v1(C1(),h,m,g);for(let b in u)this.unevaluatedLayout.setValue(b,u[b])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(t){return this.unevaluatedLayout._values[t]}recalculate(t,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(t,void 0,s,u))}serialize(){let t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.unevaluatedLayout&&(t.properties=this.unevaluatedLayout.serialize()),t}hasIconProperties(){let t=this.hasProperty("icon-image"),s=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),h=this.hasProperty("icon-rotate");return t||s||u||h}hasTextProperties(){let t=this.hasProperty("text-size"),s=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return t||s||u}hasProperty(t){return this.getUnevaluatedProperty(t).value!==void 0}}let S1="-transition",El=new Set(["fill","line","background","hillshade","raster"]);class gs extends id{constructor(t,s,u,h,m,g){if(super(),this.id=t.id,this.fqid=Xa(this.id,u),this.type=t.type,this.scope=u,this.lut=h,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;let v=iu(this.filter,Oe[`filter_${t.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(t.slot&&(this.slot=t.slot),t.appearances&&this.setAppearances(t.appearances),s.layout&&(this._unevaluatedLayout=new v1(s.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new m1(s.paint,this.scope,m);for(let v in t.paint)this.setPaintProperty(v,t.paint[v]);for(let v in t.layout)this.setLayoutProperty(v,t.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hd(s.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&El.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s){if(this.type==="custom"&&t==="visibility")return void(this.visibility=s);let u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),t==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(t){this.appearances=[],t.forEach(s=>{this.appearances.push(new E1(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(S1)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}isPaintProperty(t){return!!this._transitionablePaint._properties.properties[t]}setPaintProperty(t,s){let u=this._transitionablePaint,h=u._properties.properties;if(t.endsWith(S1)){let I=t.slice(0,-11);return h[I]&&u.setTransition(I,s||void 0),!1}if(!h[t])return!1;let m=u._values[t],g=m.value.isDataDriven(),v=m.value;u.setValue(t,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(t);let b=u._values[t].value,E=b.isDataDriven(),T=t.endsWith("pattern")||t==="line-dasharray";return E||g||T||this._handleOverridablePaintPropertyUpdate(t,v,b)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,s,u){return null}_handleOverridablePaintPropertyUpdate(t,s,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){let t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map(s=>s.serialize())),ut(t,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(let t in this.paint._values){let s=this.paint.get(t);if(s instanceof dd&&kp(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(let t of this.appearances)if(!Mp(t.condition.expression))return!0;return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=ig(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(t,s,u){return{}}queryRadius(t){}queryIntersectsFeature(t,s,u,h,m,g,v,b,E){}}let T1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jp{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}let hI=new ArrayBuffer(0);class Xi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(t,s){return t._trim(),s&&t.arrayBuffer&&s.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,t.arrayBuffer?s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement:(s.capacity=0,s.arrayBuffer=hI),s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this._reallocCount++,this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}reserveForAdditional(t){this.reserve(this.length+t)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pn(l,t=1){let s=0,u=0;return{members:l.map(h=>{let m=T1[h.type].BYTES_PER_ELEMENT,g=s=I1(s,Math.max(t,m)),v=h.components||1;return u=Math.max(u,m),s+=m*v,{name:h.name,type:h.type,components:v,offset:g}}),size:I1(s,Math.max(u,t)),alignment:t}}function I1(l,t){return Math.ceil(l/t)*t}class ou extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.int16[h+0]=s,this.int16[h+1]=u,t}}ou.prototype.bytesPerElement=4,Lt(ou,"StructArrayLayout2i4");class hh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=h,t}}hh.prototype.bytesPerElement=6,Lt(hh,"StructArrayLayout3i6");class ph extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,this.int16[g+3]=m,t}}ph.prototype.bytesPerElement=8,Lt(ph,"StructArrayLayout4i8");class ac extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}ac.prototype.bytesPerElement=4,Lt(ac,"StructArrayLayout1f4");class mv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=4*t,g=2*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.float32[g+1]=h,t}}mv.prototype.bytesPerElement=8,Lt(mv,"StructArrayLayout2i1f8");class gv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=4*t;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=h,t}}gv.prototype.bytesPerElement=8,Lt(gv,"StructArrayLayout3i8");class _v extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=5*t;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=g,t}}_v.prototype.bytesPerElement=10,Lt(_v,"StructArrayLayout5i10");class lg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let E=6*t,T=12*t,I=3*t;return this.int16[E+0]=s,this.int16[E+1]=u,this.uint8[T+4]=h,this.uint8[T+5]=m,this.uint8[T+6]=g,this.uint8[T+7]=v,this.float32[I+2]=b,t}}lg.prototype.bytesPerElement=12,Lt(lg,"StructArrayLayout2i4ub1f12");class na extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.float32[m+0]=s,this.float32[m+1]=u,this.float32[m+2]=h,t}}na.prototype.bytesPerElement=12,Lt(na,"StructArrayLayout3f12");class Ds extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=6*t,b=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=m,this.float32[b+2]=g,t}}Ds.prototype.bytesPerElement=12,Lt(Ds,"StructArrayLayout4ui1f12");class gd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=h,this.uint16[g+3]=m,t}}gd.prototype.bytesPerElement=8,Lt(gd,"StructArrayLayout4ui8");class cg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=6*t;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=v,t}}cg.prototype.bytesPerElement=12,Lt(cg,"StructArrayLayout6i12");class vv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I,D){let O=this.length;return this.resize(O+1),this.emplace(O,t,s,u,h,m,g,v,b,E,T,I,D)}emplace(t,s,u,h,m,g,v,b,E,T,I,D,O){let R=12*t;return this.int16[R+0]=s,this.int16[R+1]=u,this.int16[R+2]=h,this.int16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=v,this.uint16[R+6]=b,this.uint16[R+7]=E,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=D,this.int16[R+11]=O,t}}vv.prototype.bytesPerElement=24,Lt(vv,"StructArrayLayout4i4ui4i24");class yv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=10*t,E=5*t;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=h,this.float32[E+2]=m,this.float32[E+3]=g,this.float32[E+4]=v,t}}yv.prototype.bytesPerElement=20,Lt(yv,"StructArrayLayout3i3f20");class su extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=4*t;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=h,this.float32[g+3]=m,t}}su.prototype.bytesPerElement=16,Lt(su,"StructArrayLayout4f16");class ug extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}ug.prototype.bytesPerElement=4,Lt(ug,"StructArrayLayout1ul4");class ia extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=u,t}}ia.prototype.bytesPerElement=4,Lt(ia,"StructArrayLayout2ui4");class dg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I,D,O){let R=this.length;return this.resize(R+1),this.emplace(R,t,s,u,h,m,g,v,b,E,T,I,D,O)}emplace(t,s,u,h,m,g,v,b,E,T,I,D,O,R){let B=20*t,H=10*t;return this.int16[B+0]=s,this.int16[B+1]=u,this.int16[B+2]=h,this.int16[B+3]=m,this.int16[B+4]=g,this.float32[H+3]=v,this.float32[H+4]=b,this.float32[H+5]=E,this.float32[H+6]=T,this.int16[B+14]=I,this.uint32[H+8]=D,this.uint16[B+18]=O,this.uint16[B+19]=R,t}}dg.prototype.bytesPerElement=40,Lt(dg,"StructArrayLayout5i4f1i1ul2ui40");class hg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let E=8*t;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=m,this.int16[E+5]=g,this.int16[E+6]=v,this.int16[E+7]=b,t}}hg.prototype.bytesPerElement=16,Lt(hg,"StructArrayLayout3i2i2i16");class pg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=4*t,b=8*t;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[b+6]=m,this.int16[b+7]=g,t}}pg.prototype.bytesPerElement=16,Lt(pg,"StructArrayLayout2f1f2i16");class xv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=20*t,E=5*t;return this.uint8[b+0]=s,this.uint8[b+1]=u,this.float32[E+1]=h,this.float32[E+2]=m,this.float32[E+3]=g,this.float32[E+4]=v,t}}xv.prototype.bytesPerElement=20,Lt(xv,"StructArrayLayout2ub4f20");class Kr extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,s,u)}emplace(t,s,u,h){let m=3*t;return this.uint16[m+0]=s,this.uint16[m+1]=u,this.uint16[m+2]=h,t}}Kr.prototype.bytesPerElement=6,Lt(Kr,"StructArrayLayout3ui6");class fh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he){let le=this.length;return this.resize(le+1),this.emplace(le,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he)}emplace(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he,le){let me=30*t,ye=15*t,we=60*t;return this.int16[me+0]=s,this.int16[me+1]=u,this.int16[me+2]=h,this.float32[ye+2]=m,this.float32[ye+3]=g,this.uint16[me+8]=v,this.uint16[me+9]=b,this.uint32[ye+5]=E,this.uint32[ye+6]=T,this.uint32[ye+7]=I,this.uint16[me+16]=D,this.uint16[me+17]=O,this.uint16[me+18]=R,this.float32[ye+10]=B,this.float32[ye+11]=H,this.uint8[we+48]=$,this.uint8[we+49]=Y,this.uint8[we+50]=J,this.uint32[ye+13]=ie,this.int16[me+28]=he,this.uint8[we+58]=le,t}}fh.prototype.bytesPerElement=60,Lt(fh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class bv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he,le,me,ye,we,je,Ae,We,Ke,Qe,at,ct,nt){let it=this.length;return this.resize(it+1),this.emplace(it,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he,le,me,ye,we,je,Ae,We,Ke,Qe,at,ct,nt)}emplace(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he,le,me,ye,we,je,Ae,We,Ke,Qe,at,ct,nt,it){let qe=20*t,He=40*t,rt=80*t;return this.float32[qe+0]=s,this.float32[qe+1]=u,this.int16[He+4]=h,this.int16[He+5]=m,this.int16[He+6]=g,this.int16[He+7]=v,this.int16[He+8]=b,this.int16[He+9]=E,this.int16[He+10]=T,this.int16[He+11]=I,this.int16[He+12]=D,this.uint16[He+13]=O,this.uint16[He+14]=R,this.uint16[He+15]=B,this.uint16[He+16]=H,this.uint16[He+17]=$,this.uint16[He+18]=Y,this.uint16[He+19]=J,this.uint16[He+20]=ie,this.uint16[He+21]=he,this.uint16[He+22]=le,this.uint16[He+23]=me,this.uint16[He+24]=ye,this.uint16[He+25]=we,this.uint16[He+26]=je,this.uint16[He+27]=Ae,this.uint32[qe+14]=We,this.float32[qe+15]=Ke,this.float32[qe+16]=Qe,this.float32[qe+17]=at,this.float32[qe+18]=ct,this.uint8[rt+76]=nt,this.uint16[He+39]=it,t}}bv.prototype.bytesPerElement=80,Lt(bv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class wv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,h,m,g)}emplace(t,s,u,h,m,g,v){let b=6*t;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=g,this.float32[b+5]=v,t}}wv.prototype.bytesPerElement=24,Lt(wv,"StructArrayLayout6f24");class _d extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m){let g=this.length;return this.resize(g+1),this.emplace(g,t,s,u,h,m)}emplace(t,s,u,h,m,g){let v=5*t;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=m,this.float32[v+4]=g,t}}_d.prototype.bytesPerElement=20,Lt(_d,"StructArrayLayout5f20");class Cv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let E=7*t;return this.float32[E+0]=s,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=m,this.float32[E+4]=g,this.float32[E+5]=v,this.float32[E+6]=b,t}}Cv.prototype.bytesPerElement=28,Lt(Cv,"StructArrayLayout7f28");class Ev extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I){let D=this.length;return this.resize(D+1),this.emplace(D,t,s,u,h,m,g,v,b,E,T,I)}emplace(t,s,u,h,m,g,v,b,E,T,I,D){let O=11*t;return this.float32[O+0]=s,this.float32[O+1]=u,this.float32[O+2]=h,this.float32[O+3]=m,this.float32[O+4]=g,this.float32[O+5]=v,this.float32[O+6]=b,this.float32[O+7]=E,this.float32[O+8]=T,this.float32[O+9]=I,this.float32[O+10]=D,t}}Ev.prototype.bytesPerElement=44,Lt(Ev,"StructArrayLayout11f44");class mh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E){let T=this.length;return this.resize(T+1),this.emplace(T,t,s,u,h,m,g,v,b,E)}emplace(t,s,u,h,m,g,v,b,E,T){let I=9*t;return this.float32[I+0]=s,this.float32[I+1]=u,this.float32[I+2]=h,this.float32[I+3]=m,this.float32[I+4]=g,this.float32[I+5]=v,this.float32[I+6]=b,this.float32[I+7]=E,this.float32[I+8]=T,t}}mh.prototype.bytesPerElement=36,Lt(mh,"StructArrayLayout9f36");class Sl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){let u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){let h=2*t;return this.float32[h+0]=s,this.float32[h+1]=u,t}}Sl.prototype.bytesPerElement=8,Lt(Sl,"StructArrayLayout2f8");class As extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,t,s,u,h)}emplace(t,s,u,h,m){let g=6*t;return this.uint32[3*t+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=h,this.uint16[g+4]=m,t}}As.prototype.bytesPerElement=12,Lt(As,"StructArrayLayout1ul3ui12");class au extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}au.prototype.bytesPerElement=2,Lt(au,"StructArrayLayout1ui2");class Sv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H){let $=this.length;return this.resize($+1),this.emplace($,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H)}emplace(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$){let Y=16*t;return this.float32[Y+0]=s,this.float32[Y+1]=u,this.float32[Y+2]=h,this.float32[Y+3]=m,this.float32[Y+4]=g,this.float32[Y+5]=v,this.float32[Y+6]=b,this.float32[Y+7]=E,this.float32[Y+8]=T,this.float32[Y+9]=I,this.float32[Y+10]=D,this.float32[Y+11]=O,this.float32[Y+12]=R,this.float32[Y+13]=B,this.float32[Y+14]=H,this.float32[Y+15]=$,t}}Sv.prototype.bytesPerElement=64,Lt(Sv,"StructArrayLayout16f64");class fg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,h,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,h,m,g,v)}emplace(t,s,u,h,m,g,v,b){let E=10*t,T=5*t;return this.uint16[E+0]=s,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=m,this.float32[T+2]=g,this.float32[T+3]=v,this.float32[T+4]=b,t}}fg.prototype.bytesPerElement=20,Lt(fg,"StructArrayLayout4ui3f20");class Tv extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.int16[1*t+0]=s,t}}Tv.prototype.bytesPerElement=2,Lt(Tv,"StructArrayLayout1i2");class mg extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint8[1*t+0]=s,t}}mg.prototype.bytesPerElement=1,Lt(mg,"StructArrayLayout1ub1");class gg extends jp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gg.prototype.size=40;class M1 extends dg{get(t){return new gg(this,t)}}Lt(M1,"CollisionBoxArray");class _g extends jp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}_g.prototype.size=60;class D1 extends fh{get(t){return new _g(this,t)}}Lt(D1,"PlacedSymbolArray");class A1 extends jp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}A1.prototype.size=80;class Iv extends bv{get(t){return new A1(this,t)}}Lt(Iv,"SymbolInstanceArray");class vg extends ac{getoffsetX(t){return this.float32[1*t+0]}}Lt(vg,"GlyphOffsetArray");class P1 extends ou{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Lt(P1,"SymbolLineVertexArray");class Mv extends jp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mv.prototype.size=12;class Dv extends As{get(t){return new Mv(this,t)}}Lt(Dv,"FeatureIndexArray");class O1 extends ia{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Lt(O1,"FillExtrusionCentroidArray");class yg extends jp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}yg.prototype.size=6;class $p extends hh{get(t){return new yg(this,t)}}Lt($p,"FillExtrusionWallArray");let R1=Pn([{name:"a_pos",components:2,type:"Int16"}],4),pI=Pn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),k1=Pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class nr{constructor(t=[]){this.segments=t}_prepareSegment(t,s,u,h){let m=this.segments[this.segments.length-1];return t>nr.MAX_VERTEX_ARRAY_LENGTH&&Pt(`Max vertices per segment is ${nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>nr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(t,s,u,h){return this._prepareSegment(t,s.length,u.length,h)}get(){return this.segments}destroy(){for(let t of this.segments)for(let s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,u,h){return new nr([{vertexOffset:t,primitiveOffset:s,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function xg(l,t){return 256*(l=G(Math.floor(l),0,255))+G(Math.floor(t),0,255)}nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt(nr,"SegmentVector");let fI=Pn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mI=Pn([{name:"a_pattern_b",components:4,type:"Uint16"}]),gI=Pn([{name:"a_dash",components:4,type:"Uint16"}]);class Hp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,s,u,h){this.ids.push(Av(t)),this.positions.push(s,u,h)}eachPosition(t,s){let u=Av(t),h=0,m=this.ids.length-1;for(;h<m;){let g=h+m>>1;this.ids[g]>=u?m=g:h=g+1}for(;this.ids[h]===u;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,s){let u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Pv(u,h,0,u.length-1),s&&(s.add(u.buffer),s.add(h.buffer)),{ids:u,positions:h}}static deserialize(t){let s=new Hp,u;s.ids=t.ids,s.positions=t.positions;for(let h of s.ids)h!==u&&s.uniqueIds.push(h),u=h;return s.indexed=!0,s}}function Av(l){let t=+l;return Number.isSafeInteger(t)?t:gm(String(l))}function Pv(l,t,s,u){for(;s<u;){let h=l[s+u>>1],m=s-1,g=u+1;for(;;){do m++;while(l[m]<h);do g--;while(l[g]>h);if(m>=g)break;bg(l,m,g),bg(t,3*m,3*g),bg(t,3*m+1,3*g+1),bg(t,3*m+2,3*g+2)}g-s<u-g?(Pv(l,t,s,g),s=g+1):(Pv(l,t,g+1,u),u=g)}}function bg(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}Lt(Hp,"FeaturePositionMap");class lc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}set(t,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wg extends lc{constructor(t){super(t),this.current=0}set(t,s,u){this.fetchUniformLocation(t,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Qr extends lc{constructor(t){super(t),this.current=0}set(t,s,u){this.fetchUniformLocation(t,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Tl extends lc{constructor(t){super(t),this.current=[0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Gp extends lc{constructor(t){super(t),this.current=[0,0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Cg extends lc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,u){this.fetchUniformLocation(t,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class qp extends lc{constructor(t){super(t),this.current=ui.transparent.toPremultipliedRenderColor(null)}set(t,s,u){this.fetchUniformLocation(t,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let _I=new Float32Array(16);class Wp extends lc{constructor(t){super(t),this.current=_I}set(t,s,u){if(this.fetchUniformLocation(t,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}let Eg=new Float32Array(9),vI=new Float32Array(4);class Sg extends lc{constructor(t){super(t),this.current=vI}set(t,s,u){if(this.fetchUniformLocation(t,s)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Ov(l){return[xg(255*l.r,255*l.g),xg(255*l.b,255*l.a)]}function Zp(l,t,s,u,h,m,g,v){return!!l&&(l.kind==="composite"||l.kind==="source"?l.evaluate(new Ui(0,{brightness:m,worldview:v}),t,s,h,u,g)==="none":l.value==="none")}class Yp{constructor(t,s,u,h){this.value=t,this.uniformNames=s.map(m=>`u_${m}`),this.type=u,this.context=h}setUniform(t,s,u,h,m){let g=h.constantOr(this.value);s.set(t,m,g instanceof ui?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(t,s){return this.type==="color"?new qp(t):new Qr(t)}}class gh{constructor(t,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,s){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(t,s,u,h,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&s.set(t,m,g)}getBinding(t,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new Cg(t):new Qr(t)}}class cc{constructor(t,s,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,u,h,m,g,v,b){let E=this.paintVertexArray.length,T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ui(0,{brightness:g,worldview:b}),s,{},m,h,v):this.expression.kind==="constant"&&this.expression.value,I=Zp(this.lutExpression,s,{},h,m,g,v,b);this.paintVertexArray.resize(t),this._setPaintValue(E,t,T,I?null:this.context.lut)}updatePaintArray(t,s,u,h,m,g,v,b){let E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},u,h,void 0,m):this.expression.kind==="constant"&&this.expression.value,T=Zp(this.lutExpression,u,h,m,void 0,v,void 0,b);this._setPaintValue(t,s,E,T?null:this.context.lut)}_setPaintValue(t,s,u,h){if(this.type==="color"){let m=Ov(u.toPremultipliedRenderColor(h));for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uc{constructor(t,s,u,h,m,g){this.expression=t,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,s,u,h,m,g,v,b){let E=this.expression.evaluate(new Ui(this.context.zoom,{brightness:g,worldview:b}),s,{},m,h,v),T=this.expression.evaluate(new Ui(this.context.zoom+1,{brightness:g,worldview:b}),s,{},m,h,v),I=Zp(this.lutExpression,s,{},h,m,g,v,b),D=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(D,t,E,T,I?null:this.context.lut)}updatePaintArray(t,s,u,h,m,g,v,b){let E=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},u,h,void 0,m),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},u,h,void 0,m),I=Zp(this.lutExpression,u,h,m,void 0,v,void 0,b);this._setPaintValue(t,s,E,T,I?null:this.context.lut)}_setPaintValue(t,s,u,h,m){if(this.type==="color"){let g=Ov(u.toPremultipliedRenderColor(m)),v=Ov(u.toPremultipliedRenderColor(m));for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,g[0],g[1],v[0],v[1])}else{for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,u,h,m){let g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=G(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(t,m,v)}getBinding(t,s){return new Qr(t)}}class dc{constructor(t,s,u,h,m){this.expression=t,this.layerId=m,this.paintVertexAttributes=(u==="array"?gI:fI).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new gd}populatePaintArray(t,s,u,h){let m=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(m,t,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(t,s,u,h,m,g,v){this._setPaintValues(t,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(t,s,u,h){if(!h||!u)return;let m=h[u[0]],g=h[u[1]];if(m){if(m){let{tl:v,br:b,pixelRatio:E}=m;for(let T=t;T<s;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1],E)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:v,br:b}=g;for(let E=t;E<s;E++)this.paintTransitionVertexArray.emplace(E,v[0],v[1],b[0],b[1])}}}upload(t){let s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,mI.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class lu{constructor(t,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;let h=[];for(let m in t.paint._values){let g=t.paint.get(m);if(m.endsWith("-use-theme")||!u(m)||!(g instanceof dd&&kp(g.property.specification)))continue;let v=xI(m,t.type),b=g.value,E=g.property.specification.type,T=!!g.property.useIntegerZoom,I=m==="line-dasharray"||m.endsWith("pattern"),D=t.paint.get(`${m}-use-theme`),O=m==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(b.kind!=="constant"||O)if(b.kind==="source"||O||I){let R=Rv(m,E,"source");this.binders[m]=I?new dc(b,v,E,R,t.id):new cc(b,v,E,R),h.push(`/a_${m}`)}else{let R=Rv(m,E,"composite");this.binders[m]=new uc(b,v,E,T,s,R),h.push(`/z_${m}`)}else this.binders[m]=I?new gh(b.value,v):new Yp(b.value,v,E,s),h.push(`/u_${m}`);D&&(this.binders[m].lutExpression=D.value)}this.cacheKey=h.sort().join("")}getMaxValue(t){let s=this.binders[t];return s instanceof cc||s instanceof uc?s.maxValue:0}populatePaintArrays(t,s,u,h,m,g,v,b){for(let E in this.binders){let T=this.binders[E];T.context=this.context,(T instanceof cc||T instanceof uc||T instanceof dc)&&T.populatePaintArray(t,s,u,h,m,g,v,b)}}setConstantPatternPositions(t,s){for(let u in this.binders){let h=this.binders[u];h instanceof gh&&h.setConstantPatternPositions(t,s)}}getPatternTransitionVertexBuffer(t){let s=this.binders[t];return s instanceof dc?s.paintTransitionVertexBuffer:null}updatePaintArrays(t,s,u,h,m,g,v,b,E,T){let I=!1,D=Object.keys(t),O=D.length!==0&&!b,R=O?D:s.uniqueIds;this.context.lut=m.lut;for(let B in this.binders){let H=this.binders[B];if(H.context=this.context,(H instanceof cc||H instanceof uc||H instanceof dc)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){let $=m.paint.get(B);H.expression=$.value;for(let Y of R){let J=t[Y.toString()];s.eachPosition(Y,(ie,he,le)=>{let me=h.feature(ie);H.updatePaintArray(he,le,me,J,g,v,E,T)})}if(!O)for(let Y of u.uniqueIds){let J=t[Y.toString()];u.eachPosition(Y,(ie,he,le)=>{let me=h.feature(ie);H.updatePaintArray(he,le,me,J,g,v,E,T)})}I=!0}}return I}defines(){let t=[];for(let s in this.binders){let u=this.binders[s];(u instanceof Yp||u instanceof gh)&&t.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let s=[];for(let u in this.binders){let h=this.binders[u];if(h instanceof Yp||h instanceof gh||h instanceof uc)for(let m of h.uniformNames)s.push({name:m,property:u,binding:h.getBinding(t,m)})}return s}setUniforms(t,s,u,h,m){for(let{name:g,property:v,binding:b}of u)this.binders[v].setUniform(t,b,m,h.get(v),g)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let s=this.binders[t];(s instanceof cc||s instanceof uc||s instanceof dc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof dc&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(t){for(let s in this.binders){let u=this.binders[s];(u instanceof cc||u instanceof uc||u instanceof dc)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let s=this.binders[t];(s instanceof cc||s instanceof uc||s instanceof dc)&&s.destroy()}}}class Ka{constructor(t,s,u=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new lu(h,s,u);this.needsUpload=!1,this._featureMap=new Hp,this._featureMapWithoutIds=new Hp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,s,u,h,m,g,v,b,E){for(let T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(t,s,h,m,g,v,b,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,u,h,m,g,v,b){for(let E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,s,E,h,m,g,v||0,b)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let yI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function xI(l,t){return yI[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}let bI={"line-pattern":{source:Ds,composite:Ds},"fill-pattern":{source:Ds,composite:Ds},"fill-extrusion-pattern":{source:Ds,composite:Ds},"line-dasharray":{source:gd,composite:gd}},wI={color:{source:Sl,composite:su},number:{source:ac,composite:Sl}};function Rv(l,t,s){let u=bI[l];return u&&u[s]||wI[t][s]}Lt(Yp,"ConstantBinder"),Lt(gh,"PatternConstantBinder"),Lt(cc,"SourceExpressionBinder"),Lt(dc,"PatternCompositeBinder"),Lt(uc,"CompositeExpressionBinder"),Lt(lu,"ProgramConfiguration",{omit:["_buffers"]}),Lt(Ka,"ProgramConfigurationSet");let Ko=yt/Math.PI/2,Sa=5,Tg=6,CI=16383,_h=64,kv=[_h,32,16],Ta=-Ko,Ia=Ko;function vd(l,t,s,u=Ko){return s=Zn(s),[l*Math.sin(s)*u,-t*u,l*Math.cos(s)*u]}function vh(l,t,s){return vd(Math.cos(Zn(l)),Math.sin(Zn(l)),t,s)}let p=63710088e-1,o=2*Math.PI*p;class c{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let s=Math.PI/180,u=this.lat*s,h=t.lat*s,m=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return p*Math.acos(Math.min(m,1))}toBounds(t=0){let s=360*t/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new f({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(t){return vh(this.lat,this.lng,Ko+t*Ko/p)}static convert(t){if(t instanceof c)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new c(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new c(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class f{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}setSouthWest(t){return this._sw=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}extend(t){let s=this._sw,u=this._ne,h,m;if(t instanceof c)h=t,m=t;else{if(!(t instanceof f))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(f.convert(t)):this.extend(c.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(c.convert(t)):this;if(h=t._sw,m=t._ne,!h||!m)return this}return s||u?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new c(h.lng,h.lat),this._ne=new c(m.lng,m.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:s,lat:u}=c.convert(t),h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(t){if(t)return t instanceof f?t:new f(t)}}let _=0,y=25.5;function x(l){return o*Math.cos(l*Math.PI/180)}function w(l){return(180+l)/360}function S(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function M(l,t){return l/x(t)}function A(l){return 360*l-180}function L(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function F(l,t){return l*x(L(t))}let N=85.051129;function j(l){return Math.cos(Zn(G(l,-N,N)))}function U(l,t){let s=G(t,_,y),u=Math.pow(2,s);return j(l)*o/(512*u)}function Z(l){return 1/Math.cos(l*Math.PI/180)}function q(l,t=0){let s=Math.exp(Math.PI*(1-(l.y+t/yt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/yt/(1<<l.z)}class ee{constructor(t,s,u=0){this.x=+t,this.y=+s,this.z=+u}static fromLngLat(t,s=0){let u=c.convert(t);return new ee(w(u.lng),S(u.lat),M(s,u.lat))}toLngLat(){return new c(A(this.x),L(this.y))}toAltitude(){return F(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*Z(L(this.y))}}function re(l,t,s,u,h,m,g,v,b){let E=(t+u)/2,T=(s+h)/2,I=new st(E,T);v(I),(function(D,O,R,B,H,$){let Y=R-H,J=B-$;return Math.abs((B-O)*Y-(R-D)*J)/Math.hypot(Y,J)})(I.x,I.y,m.x,m.y,g.x,g.y)>=b?(re(l,t,s,E,T,m,I,v,b),re(l,E,T,u,h,I,g,v,b)):l.push(g)}function ne(l,t,s){let u=l[0],h=u.x,m=u.y;t(u);let g=[u];for(let v=1;v<l.length;v++){let b=l[v],{x:E,y:T}=b;t(b),re(g,h,m,E,T,u,b,t,s),h=E,m=T,u=b}return g}function ge(l,t,s,u){if(u(t,s)){let h=t.add(s)._mult(.5);ge(l,t,h,u),ge(l,h,s,u)}else l.push(s)}function de(l,t){let s=l[0],u=[s];for(let h=1;h<l.length;h++){let m=l[h];ge(u,s,m,t),s=m}return u}let fe=Math.pow(2,14)-1,ue=-fe-1;function ae(l,t){let s=Math.round(l.x*t),u=Math.round(l.y*t);return l.x=G(s,ue,fe),l.y=G(u,ue,fe),(s<l.x||s>l.x+1||u<l.y||u>l.y+1)&&Pt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function _e(l,t,s){let u=l.loadGeometry(),h=l.extent,m=yt/h;if(t&&s&&s.projection.isReprojectedInTileSpace){let g=1<<t.z,{scale:v,x:b,y:E,projection:T}=s,I=D=>{let O=A((t.x+D.x/h)/g),R=L((t.y+D.y/h)/g),B=T.project(O,R);D.x=(B.x*v-b)*h,D.y=(B.y*v-E)*h};for(let D=0;D<u.length;D++)if(l.type!==1)u[D]=ne(u[D],I,1);else{let O=[];for(let R of u[D])R.x<0||R.x>=h||R.y<0||R.y>=h||(I(R),O.push(R));u[D]=O}}for(let g of u)for(let v of g)ae(v,m);return u}function De(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?_e(l):[]}}class Ce{constructor(t,s,u,h,m){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(Be,this,s)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let s=t.readVarint()+t.pos,u=[],h,m=1,g=0,v=0,b=0;for(;t.pos<s;){if(g<=0){let E=t.readVarint();m=7&E,g=E>>3}if(g--,m===1||m===2)v+=t.readSVarint(),b+=t.readSVarint(),m===1&&(h&&u.push(h),h=[]),h&&h.push(new st(v,b));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){let t=this._pbf;t.pos=this._geometry;let s=t.readVarint()+t.pos,u=1,h=0,m=0,g=0,v=1/0,b=-1/0,E=1/0,T=-1/0;for(;t.pos<s;){if(h<=0){let I=t.readVarint();u=7&I,h=I>>3}if(h--,u===1||u===2)m+=t.readSVarint(),g+=t.readSVarint(),m<v&&(v=m),m>b&&(b=m),g<E&&(E=g),g>T&&(T=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[v,E,b,T]}toGeoJSON(t,s,u){let h=this.extent*Math.pow(2,u),m=this.extent*t,g=this.extent*s,v=this.loadGeometry();function b(D){return[360*(D.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+g)/h)*Math.PI))-90]}function E(D){return D.map(b)}let T;if(this.type===1){let D=[];for(let R of v)D.push(R[0]);let O=E(D);T=D.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){let D=v.map(E);T=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{let D=(function(R){let B=R.length;if(B<=1)return[R];let H=[],$,Y;for(let J=0;J<B;J++){let ie=Ue(R[J]);ie!==0&&(Y===void 0&&(Y=ie<0),Y===ie<0?($&&H.push($),$=[R[J]]):$&&$.push(R[J]))}return $&&H.push($),H})(v),O=[];for(let R of D)O.push(R.map(E));T=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}let I={type:"Feature",geometry:T,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Be(l,t,s){l===1?t.id=s.readVarint():l===2?(function(u,h){let m=u.readVarint()+u.pos;for(;u.pos<m;){let g=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[g]=v}})(s,t):l===3?t.type=s.readVarint():l===4&&(t._geometry=s.pos)}function Ue(l){let t=0;for(let s,u,h=0,m=l.length,g=m-1;h<m;g=h++)s=l[h],u=l[g],t+=(u.x-s.x)*(s.y+u.y);return t}Ce.types=["Unknown","Point","LineString","Polygon"];class Ye{constructor(t,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(dt,this,s),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let s=this._pbf.readVarint()+this._pbf.pos;return new Ce(this._pbf,s,this.extent,this._keys,this._values)}}function dt(l,t,s){l===15?t.version=s.readVarint():l===1?t.name=s.readString():l===5?t.extent=s.readVarint():l===2?t._features.push(s.pos):l===3?t._keys.push(s.readString()):l===4&&t._values.push((function(u){let h=null,m=u.readVarint()+u.pos;for(;u.pos<m;){let g=u.readVarint()>>3;h=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(s))}class Fe{constructor(t,s){this.layers=t.readFields(be,{},s)}}function be(l,t,s){if(l===3){let u=new Ye(s,s.readVarint()+s.pos);u.length&&(t[u.name]=u)}}let Ge="3d_elevation_id",Le="level";class tt{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,s){return this._valid&&t(s(this._geometry)),this}require(t,s,u){return this.get(t,!0,s,u)}optional(t,s,u){return this.get(t,!1,s,u)}success(){return this._valid}get(t,s,u,h){let m=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?u(h?h(m):m):s&&(this._valid=!1),this}}class bt{constructor(t,s){this.featureFunc=t,this.vertexFunc=s}parseFeature(t,s,u){return this.featureFunc(t,s,u)}parseVertex(t,s,u){return this.vertexFunc(t,s,u)}}let At=new bt((l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},pt.decodeRelativeHeight).geometry(u=>{s.bounds=u},tc).success(),(l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},pt.decodeRelativeHeight).geometry(u=>{s.position=u},pt.getPoint).success()),_t=new bt((l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},pt.decodeMetricHeight).geometry(u=>{s.bounds=u},tc).success(),(l,t,s)=>l.reset(t).require(Ge,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},pt.decodeMetricHeight).geometry(u=>{s.position=u},pt.getPoint).success());class pt{static getPoint(t){return Ss(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?_t:void 0:At}static parse(t){let s=[],u=[],h=t.length,m=new tt;for(let g=0;g<h;g++){let v=t.feature(g),b=v.properties.version,E=pt.getVersionSchema(b);if(E===void 0){Pt(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}let T=v.properties.type;if(!T)continue;let I=Ce.types[v.type];if(I==="Point"&&T==="curve_point"){let D={};E.parseVertex(m,v,D)&&s.push(D)}else if(I==="Polygon"&&T==="curve_meta"){let D={};E.parseFeature(m,v,D)&&u.push(D)}}return{vertices:s,features:u}}}class jt{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,u){let h=Zu(s,this.dir);if(Math.abs(h)<1e-6)return!1;let m=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,!0}}class zt{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,u){let h=Ir(s,this.dir);if(Math.abs(h)<1e-6)return!1;let m=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(t,s,u){if((function(O,R){var B=O[0],H=O[1],$=O[2],Y=R[0],J=R[1],ie=R[2];return Math.abs(B-Y)<=C*Math.max(1,Math.abs(B),Math.abs(Y))&&Math.abs(H-J)<=C*Math.max(1,Math.abs(H),Math.abs(J))&&Math.abs($-ie)<=C*Math.max(1,Math.abs($),Math.abs(ie))})(this.pos,t)||s===0)return u[0]=u[1]=u[2]=0,!1;let[h,m,g]=this.dir,v=this.pos[0]-t[0],b=this.pos[1]-t[1],E=this.pos[2]-t[2],T=h*h+m*m+g*g,I=2*(v*h+b*m+E*g),D=I*I-4*T*(v*v+b*b+E*E-s*s);if(D<0){let O=Math.max(-I/2,0),R=v+h*O,B=b+m*O,H=E+g*O,$=Math.hypot(R,B,H);return u[0]=R*s/$,u[1]=B*s/$,u[2]=H*s/$,!1}{let O=(-I-Math.sqrt(D))/(2*T);if(O<0){let R=Math.hypot(v,b,E);return u[0]=v*s/R,u[1]=b*s/R,u[2]=E*s/R,!1}return u[0]=v+h*O,u[1]=b+m*O,u[2]=E+g*O,!0}}}class Tt{constructor(t,s,u,h,m){this.TL=t,this.TR=s,this.BR=u,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(t,s,u){let h=[-1,1,1],m=[1,1,1],g=[1,-1,1],v=[-1,-1,1],b=Fr(h,h,t),E=Fr(m,m,t),T=Fr(g,g,t),I=Fr(v,v,t);return new Tt(b,E,T,I,s/u)}}function Ot(l,t,s){let u=1/0,h=-1/0,m=[];for(let g of l){Vr(m,g,t);let v=Ir(m,s);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function Jt(l,t){let s=!0;for(let u=0;u<l.planes.length;u++){let h=l.planes[u],m=0;for(let g=0;g<t.length;g++)m+=+(Ir(h,t[g])+h[3]>=0);if(m===0)return 0;m!==t.length&&(s=!1)}return s?2:1}function fn(l,t){for(let s of l.projections){let u=Ot(t,l.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Fn(l,t){let s=0,u=[0,0,0,0];for(let g=0;g<l.length;g++)u[0]=l[g][0],u[1]=l[g][1],u[2]=l[g][2],u[3]=1,(h=u)[0]*(m=t)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&s++;var h,m;return s}class Jn{constructor(t,s){this.points=t||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=$t.fromPoints(this.points),this.projections=[],this.frustumEdges=[Vr([],this.points[2],this.points[3]),Vr([],this.points[0],this.points[3]),Vr([],this.points[4],this.points[0]),Vr([],this.points[5],this.points[1]),Vr([],this.points[6],this.points[2]),Vr([],this.points[7],this.points[3])];for(let u of this.frustumEdges){let h=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Ot(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:Ot(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(t,s,u,h){let m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{let T=Zo([],E,t),I=1/T[3]/s*m;return(D=T)[0]=(O=T)[0]*(R=[I,I,h?1/T[3]:I,I])[0],D[1]=O[1]*R[1],D[2]=O[2]*R[2],D[3]=O[3]*R[3],D;var D,O,R}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{let T=Yi([],Wo([],Vr([],g[E[0]],g[E[1]]),Vr([],g[E[2]],g[E[1]]))),I=-Ir(T,g[E[1]]);return T.concat(I)}),b=[];for(let E=0;E<g.length;E++)b.push([g[E][0],g[E][1],g[E][2]]);return new Jn(b,v)}intersectsPrecise(t,s,u){for(let h=0;h<s.length;h++)if(!Fn(t,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Fn(t,this.planes[h]))return 0;for(let h of u)for(let m of this.frustumEdges){let g=Wo([],h,m),v=xo(g);if(v===0)continue;fr(g,g,1/v);let b=Ot(this.points,this.points[0],g),E=Ot(t,this.points[0],g);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}containsPoint(t){for(let s of this.planes){let u=s[3];if(Ir([s[0],s[1],s[2]],t)+u<0)return!1}return!0}}class $t{static fromPoints(t){let s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let h of t)hl(s,s,h),Ua(u,u,h);return new $t(s,u)}static fromTileIdAndHeight(t,s,u){let h=1<<t.canonical.z,m=t.canonical.x,g=t.canonical.y;return new $t([m/h,g/h,s],[(m+1)/h,(g+1)/h,u])}static applyTransform(t,s){let u=t.getCorners();for(let h=0;h<u.length;++h)Fr(u[h],u[h],s);return $t.fromPoints(u)}static applyTransformFast(t,s){let u=[s[12],s[13],s[14]],h=[...u];for(let m=0;m<3;m++)for(let g=0;g<3;g++){let v=s[4*g+m],b=v*t.min[g],E=v*t.max[g];u[m]+=Math.min(b,E),h[m]+=Math.max(b,E)}return new $t(u,h)}static projectAabbCorners(t,s){let u=t.getCorners();for(let h=0;h<u.length;++h)Fr(u[h],u[h],s);return u}constructor(t,s){this.min=t,this.max=s,this.center=fr([],Wr([],this.min,this.max),.5)}quadrant(t){let s=[t%2==0,t<2],u=ju(this.min),h=ju(this.max);for(let m=0;m<s.length;m++)u[m]=s[m]?this.min[m]:this.center[m],h[m]=s[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new $t(u,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Jt(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Jt(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,s){return s||this.intersects(t)?fn(t,this.getCorners()):0}intersectsPreciseFlat(t,s){return s||this.intersectsFlat(t)?fn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let s=0;s<3;++s)if(this.min[s]>t.max[s]||t.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t.min[s]),this.max[s]=Math.max(this.max[s],t.max[s])}encapsulatePoint(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t[s]),this.max[s]=Math.max(this.max[s],t[s])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Lt($t,"Aabb");class Yn{constructor(t,s){this.feature=t,this.metersToTile=s,this.index=0}get(){let t=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],h=-s[0],m=(t.extent+1)*this.metersToTile;return[new st(Math.trunc(t.position[0]+u*m),Math.trunc(t.position[1]+h*m)),new st(Math.trunc(t.position[0]-u*m),Math.trunc(t.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class pn{constructor(t,s,u,h,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[bo(),bo(),bo(),bo(),bo(),bo(),bo()],this.id=t,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(E=this.vertices[v.b].position)[0]&&b[1]===E[1]);var b,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let v of this.vertices)this.vertexProps.push({dir:Ss(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(let v of this.edges){let b=this.vertices[v.a].position,E=this.vertices[v.b].position,T=pl(bo(),E,b),I=$a(T),D=Xl(bo(),T,1/I);this.edgeProps.push({vec:T,dir:D,len:I});let O=this.vertexProps[v.a].dir,R=this.vertexProps[v.b].dir;Hc(O,O,D),Hc(R,R,D)}for(let v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||up(v.dir,v.dir);this.tessellate(g)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;let s=this.getClosestEdge(t);if(s==null)return 0;let[u,h]=s;return on(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(t,s){let u=this.getClosestEdge(t);if(!u)return xr(0,0,1);let h=u[0],m=this.edges[h],g=this.edgeProps[h].vec,v=xr(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*s),b=xr(v[1],-v[0],0);Wo(b,b,v);let E=xo(b);return E>0?fr(b,b,1/E):Ji(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,h=0,[m,g,v,b,E,T,I]=this._tmpVec2;cp(I,t.x,t.y);let D=new jt(I,null);for(let O=0;O<this.edges.length;O++){let R=this.edges[O],B=this.edgeProps[O].dir;D.dir=B;let H=this.vertices[R.a].position,$=this.vertices[R.b].position,Y=D.intersectsPlane(H,this.vertexProps[R.a].dir,m),J=D.intersectsPlane($,this.vertexProps[R.b].dir,g);if(!Y||!J)continue;pl(v,g,m),pl(b,I,m);let ie=Zu(v,v),he=ie>0?Zu(b,v)/ie:0,le=G(he,0,1),me=Math.abs((he-le)*this.edgeProps[O].len);pl(E,I,H),cp(T,B[1],-B[0]);let ye=me+Math.abs(Zu(E,T));ye<u&&(s=O,u=ye,h=le)}return[s,h]}tessellate(t){let s=ci(),u=ci(),h=ci(),m=ci();for(let g=this.edges.length-1;g>=0;--g){let v=this.edges[g].a,b=this.edges[g].b,{position:E,height:T,extent:I}=this.vertices[v],{position:D,height:O,extent:R}=this.vertices[b],B=this.vertexProps[v].dir,H=this.vertexProps[b].dir;if(Ji(s,E[0]/t,E[1]/t,T),Ji(u,D[0]/t,D[1]/t,O),Ji(h,B[1],-B[0],0),fr(h,h,I),Ji(m,H[1],-H[0],0),fr(m,m,R),this.distSqLines(xr(s[0]+.5*h[0],s[1]+.5*h[1],s[2]+.5*h[2]),xr(u[0]-.5*m[0],u[1]-.5*m[1],u[2]-.5*m[2]),xr(s[0]-.5*h[0],s[1]-.5*h[1],s[2]-.5*h[2]),xr(u[0]+.5*m[0],u[1]+.5*m[1],u[2]+.5*m[2]))<=.0025000000000000005)continue;let $=this.vertices.length,Y=Hc(bo(),E,D);this.vertices.push({position:Xl(Y,Y,.5),height:.5*(T+O),extent:.5*(I+R)});let J=Hc(bo(),B,H);this.vertexProps.push({dir:up(J,J)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:v,b:$}),this.edges.push({a:$,b});let ie=pl(bo(),this.vertices[$].position,E),he=$a(ie),le={vec:ie,dir:Xl(bo(),ie,1/he),len:he};this.edgeProps.push(le),this.edgeProps.push(le)}}distSqLines(t,s,u,h){let m=dl(ci(),s,t),g=dl(ci(),h,u),v=dl(ci(),t,u),b=Ir(m,m),E=Ir(m,g),T=Ir(m,v),I=Ir(g,g),D=Ir(g,v),O=b*I-E*E;if(O===0)return lp($u(m,u,h,Ir(v,g)/Ir(g,g)),t);let R=(b*D-E*T)/O;return lp($u(m,t,s,(E*D-T*I)/O),$u(g,u,h,R))}}class ii{static parseFrom(t,s){let u=pt.parse(t);if(!u)return[];let{vertices:h,features:m}=u,g=1/q(s);m.sort((T,I)=>T.id-I.id),h.sort((T,I)=>T.id-I.id||T.idx-I.idx),h=h.filter((T,I,D)=>I===D.findIndex(O=>O.id===T.id&&O.idx===T.idx));let v=new Array,b=0,E=h.length;for(let T of m){if(T.constantHeight){v.push(new pn(T.id,T.bounds,T.constantHeight));continue}for(;b!==E&&h[b].id<T.id;)b++;if(b===E||h[b].id!==T.id)continue;let I=new Array,D=new Array,O=b;for(;b!==E&&h[b].id===T.id;){let R=h[b];if(I.push({position:R.position,height:R.height,extent:R.extent}),b!==O&&h[b-1].idx===R.idx-1){let B=b-O;D.push({a:B-1,b:B})}b++}v.push(new pn(T.id,T.bounds,void 0,I,D,g))}return v}static getElevationFeature(t,s){if(!s)return;let u=+t.properties[Ge];return Number.isNaN(u)?void 0:s.find(h=>h.id===u)}}class gi{constructor(t,s){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(s)||(this.zScale=Math.pow(2,s.z-t.z),this.xOffset=(t.x*this.zScale-s.x)*yt,this.yOffset=(t.y*this.zScale-s.y)*yt)}constantElevation(t,s){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,s)}pointElevation(t,s,u){let h=this.constantElevation(s,u);return h??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(t),u))}computeBiasedHeight(t,s){return s<=0?t:t+s*Q(0,s,t>=0?t:Math.abs(.5*t))}}Lt(pn,"ElevationFeature");class di{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ou,this.indexArray=new Kr,this.segments=new nr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ac),this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){let m=this.layers[0],g=[],v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(let{feature:E,id:T,index:I,sourceLayerIndex:D}of t){let O=this.layers[0]._featureFilter.needGeometry,R=De(E,O);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;let B=v?v.evaluate(R,{},u):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:D,index:I,geometry:O?R.geometry:_e(E,u,h),patterns:{},sortKey:B};g.push(H)}v&&g.sort((E,T)=>E.sortKey-T.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new cg,b=h.projection);for(let E of g){let{geometry:T,index:I,sourceLayerIndex:D}=E,O=t[I].feature;this.addFeature(E,T,I,s.availableImages,u,b,s.brightness,s.elevationFeatures),s.featureIndex.insert(O,T,I,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,R1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,k1.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,pI.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,s,u,h,m,g,v,b){let E;this.elevationMode!=="none"&&(E=ii.getElevationFeature(t,b));for(let T of s)for(let I of T){let D=I.x,O=I.y;if(D<0||D>=yt||O<0||O>=yt)continue;if(g){let H=g.projectTilePoint(D,O,m),$=g.upVector(m,D,O);this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$)}let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),B=R.vertexLength;if(this.addCircleVertex(D,O,-1,-1),this.addCircleVertex(D,O,1,-1),this.addCircleVertex(D,O,1,1),this.addCircleVertex(D,O,-1,1),this.elevationMode!=="none"){let H=E?E.pointElevation(new st(D,O)):0;this.hasElevation=this.hasElevation||H!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h,m,v,void 0,this.worldview)}addCircleVertex(t,s,u,h){this.layoutVertexArray.emplaceBack(2*t+(u+1)/2,2*s+(h+1)/2)}addGlobeExtVertex(t,s){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Wn(l,t){for(let s=0;s<l.length;s++)if(Ti(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Ti(l,t[s]))return!0;return!!Ki(l,t)}function wn(l,t,s){return!!Ti(l,t)||!!Gi(t,l,s)}function ti(l,t){if(l.length===1)return ir(t,l[0]);for(let s=0;s<t.length;s++){let u=t[s];for(let h=0;h<u.length;h++)if(Ti(l,u[h]))return!0}for(let s=0;s<l.length;s++)if(ir(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Ki(l,t[s]))return!0;return!1}function ur(l,t,s){if(l.length>1){if(Ki(l,t))return!0;for(let u=0;u<t.length;u++)if(Gi(t[u],l,s))return!0}for(let u=0;u<l.length;u++)if(Gi(l[u],t,s))return!0;return!1}function Ki(l,t){if(l.length===0||t.length===0)return!1;for(let s=0;s<l.length-1;s++){let u=l[s],h=l[s+1];for(let m=0;m<t.length-1;m++)if(ri(u,h,t[m],t[m+1]))return!0}return!1}function ri(l,t,s,u){return bn(l,s,u)!==bn(t,s,u)&&bn(l,t,s)!==bn(l,t,u)}function $n(l,t,s){return(l.x-s.x)*(t.y-s.y)-(l.y-s.y)*(t.x-s.x)}function Cn(l,t,s,u){let h=$n(l,t,u),m=$n(l,t,s);if(Math.sign(h)===Math.sign(m))return;let g=$n(s,u,l),v=g+m-h;return Math.sign(g)!==Math.sign(v)?[g/(g-v),m/(m-h)]:void 0}function Gi(l,t,s){let u=s*s;if(t.length===1)return l.distSqr(t[0])<u;for(let h=1;h<t.length;h++)if(Cr(l,t[h-1],t[h])<u)return!0;return!1}function Cr(l,t,s){let u=t.distSqr(s);if(u===0)return l.distSqr(t);let h=((l.x-t.x)*(s.x-t.x)+(l.y-t.y)*(s.y-t.y))/u;return l.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function ir(l,t){let s,u,h,m=!1;for(let g=0;g<l.length;g++){s=l[g];for(let v=0,b=s.length-1;v<s.length;b=v++)u=s[v],h=s[b],u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(m=!m)}return m}function Ti(l,t){let s=!1;for(let u=0,h=l.length-1;u<l.length;h=u++){let m=l[u],g=l[h];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(s=!s)}return s}function _s(l,t,s,u,h){for(let g of l)if(t<=g.x&&s<=g.y&&u>=g.x&&h>=g.y)return!0;let m=[new st(t,s),new st(t,h),new st(u,h),new st(u,s)];if(l.length>2){for(let g of m)if(Ti(l,g))return!0}for(let g=0;g<l.length-1;g++)if(Lo(l[g],l[g+1],m))return!0;return!1}function Lo(l,t,s){let u=s[0],h=s[2];if(l.x<u.x&&t.x<u.x||l.x>h.x&&t.x>h.x||l.y<u.y&&t.y<u.y||l.y>h.y&&t.y>h.y)return!1;let m=bn(l,t,s[0]);return m!==bn(l,t,s[1])||m!==bn(l,t,s[2])||m!==bn(l,t,s[3])}function Jr(l,t,s,u,h,m){let g=t.y-l.y,v=l.x-t.x;if(m=m||0){let b=g*g+v*v;if(b===0)return!0;let E=Math.sqrt(b);g/=E,v/=E}return!((s.x-l.x)*g+(s.y-l.y)*v-m<0||(u.x-l.x)*g+(u.y-l.y)*v-m<0||(h.x-l.x)*g+(h.y-l.y)*v-m<0)}function Qo(l,t,s,u,h,m,g){return!(Jr(l,t,u,h,m,g)||Jr(t,s,u,h,m,g)||Jr(s,l,u,h,m,g)||Jr(u,h,l,t,s,g)||Jr(h,m,l,t,s,g)||Jr(m,u,l,t,s,g))}function Jo(l,t,s){let u=t.paint.get(l).value;return u.kind==="constant"?u.value:s.programConfigurations.get(t.id).getMaxValue(l)}function Do(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function ra(l,t,s,u,h){if(!t[0]&&!t[1])return l;let m=st.convert(t)._mult(h);s==="viewport"&&m._rotate(-u);let g=[];for(let v=0;v<l.length;v++)g.push(l[v].sub(m));return g}function Ma(l,t,s,u){let h=st.convert(l)._mult(u);return t==="viewport"&&h._rotate(-s),h}let Ps,_r;function Mr(l,t,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[l*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}Lt(di,"CircleBucket",{omit:["layers"]});class Ii{constructor(t,s,u){this.z=t,this.x=s,this.y=u,this.key=rr(0,t,t,s,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){let s=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>s&&t.y===this.y>>s}url(t,s){let u=(function(m,g,v){var b=Mr(256*m,256*(g=Math.pow(2,v)-g-1),v),E=Mr(256*(m+1),256*(g+1),v);return b[0]+","+b[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),h=(function(m,g,v){let b,E="";for(let T=m;T>0;T--)b=1<<T-1,E+=(g&b?1:0)+(v&b?2:0);return E})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lr{constructor(t,s){this.wrap=t,this.canonical=s,this.key=rr(t,s.z,s.z,s.x,s.y)}}class dr{constructor(t,s,u,h,m){this.overscaledZ=t,this.wrap=s,this.canonical=new Ii(u,+h,+m),this.key=s===0&&t===u?this.canonical.key:rr(s,t,u,h,m)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let s=this.canonical.z-t;return t>this.canonical.z?new dr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dr(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return rr(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-t;return rr(this.wrap*+s,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let s=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new dr(s,this.wrap,s,u,h),new dr(s,this.wrap,s,u+1,h),new dr(s,this.wrap,s,u,h+1),new dr(s,this.wrap,s,u+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new dr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rr(l,t,s,u,h){let m=1<<Math.min(s,22),g=m*(h%m)+u%m;return l&&s<22&&(g+=m*m*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*g+s)+(t-s)}let Da=[l=>{let t=l.canonical.x-1,s=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,s--),new dr(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,s=l.wrap;return t===1<<l.canonical.z&&(t=0,s++),new dr(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>new dr(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new dr(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Lt(Ii,"CanonicalTileID"),Lt(dr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Xp=Pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Qa}=Xp,Kp=Pn([{name:"a_pos_3",components:3,type:"Int16"}]);var yh=Pn([{name:"a_pos",type:"Int16",components:2}]);function Il(l){return l*Ko/p}let hc=[new $t([Ta,Ta,Ta],[Ia,Ia,Ia]),new $t([Ta,Ta,Ta],[0,0,Ia]),new $t([0,Ta,Ta],[Ia,0,Ia]),new $t([Ta,0,Ta],[0,Ia,Ia]),new $t([0,0,Ta],[Ia,Ia,Ia])];function xh(l,t,s,u=!0){let h=fr([],l._camera.position,l.worldSize),m=[t,s,1,1];Zo(m,m,l.pixelMatrixInverse),jc(m,m,1/m[3]);let g=Yi([],Vr([],m,h)),v=l.globeMatrix,b=[v[12],v[13],v[14]],E=Vr([],b,h),T=xo(E),I=Yi([],E),D=l.worldSize/(2*Math.PI),O=Ir(I,g),R=Math.asin(D/T);if(R<Math.acos(O)){if(!u)return null;let je=[],Ae=[];fr(je,g,T/O),Yi(Ae,Vr(Ae,je,E)),Yi(g,Wr(g,E,fr(g,Ae,Math.tan(R)*T)))}let B=[];new zt(h,g).closestPointOnSphere(b,D,B);let H=Yi([],br(v,0)),$=Yi([],br(v,1)),Y=Yi([],br(v,2)),J=Ir(H,B),ie=Ir($,B),he=Ir(Y,B),le=os(Math.asin(-ie/D)),me=os(Math.atan2(J,he));me=l.center.lng+(function(je,Ae){let We=(Ae-je+180)%360-180;return We<-180?We+360:We})(l.center.lng,me);let ye=w(me),we=G(S(le),0,1);return new ee(ye,we)}class cu{constructor(t,s,u){this.a=Vr([],t,u),this.b=Vr([],s,u),this.center=u;let h=Yi([],this.a),m=Yi([],this.b);this.angle=Math.acos(Ir(h,m))}}function pc(l,t){if(l.angle===0)return null;let s;return s=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:(function(u,h,m,g){let v=Math.sin(m);return u*(Math.sin((1-g)*m)/v)+h*(Math.sin(g*m)/v)})(l.a[t],l.b[t],l.angle,G(s,0,1))+l.center[t]}function Ja(l){if(l.z<=1)return hc[l.z+2*l.y+l.x];let t=EI(F1(l));return $t.fromPoints(t)}function fc(l,t,s){return fr(l,l,1-s),Qs(l,l,t,s)}function OR(l,t,s){for(let u of l)Fr(u,u,t),fr(u,u,s)}function RR(l,t,s,u){let h=t/l.worldSize,m=l.globeMatrix;if(s.z<=1){let we=Ja(s).getCorners();return OR(we,m,h),$t.fromPoints(we)}let g=F1(s,u),v=EI(g,Ko+Il(l._tileCoverLift));OR(v,m,h);let b=Number.MAX_VALUE,E=[-b,-b,-b],T=[b,b,b];if(g.contains(l.center)){for(let Ae of v)hl(T,T,Ae),Ua(E,E,Ae);E[2]=0;let we=l.point,je=[we.x*h,we.y*h,0];return hl(T,T,je),Ua(E,E,je),new $t(T,E)}if(l._tileCoverLift>0){for(let we of v)hl(T,T,we),Ua(E,E,we);return new $t(T,E)}let I=[m[12]*h,m[13]*h,m[14]*h],D=g.getCenter(),O=G(l.center.lat,-N,N),R=G(D.lat,-N,N),B=w(l.center.lng),H=S(O),$=B-w(D.lng),Y=H-S(R);$>.5?$-=1:$<-.5&&($+=1);let J=0;Math.abs($)>Math.abs(Y)?J=$>=0?1:3:(J=Y>=0?0:2,Qs(I,I,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(Zn(Y>=0?g.getSouth():g.getNorth()))*Ko));let ie=v[J],he=v[(J+1)%4],le=new cu(ie,he,I),me=[pc(le,0)||ie[0],pc(le,1)||ie[1],pc(le,2)||ie[2]],ye=bh(l.zoom);if(ye>0){let we=(function({x:Ae,y:We,z:Ke},Qe,at,ct,nt){let it=1/(1<<Ke),qe=Ae*it,He=qe+it,rt=We*it,xt=rt+it,ft=0,qt=(qe+He)/2-ct;return qt>.5?ft=-1:qt<-.5&&(ft=1),qe=((qe+ft)*Qe-(ct*=Qe))*at+ct,He=((He+ft)*Qe-ct)*at+ct,rt=(rt*Qe-(nt*=Qe))*at+nt,xt=(xt*Qe-nt)*at+nt,[[qe,xt,0],[He,xt,0],[He,rt,0],[qe,rt,0]]})(s,t,l._pixelsPerMercatorPixel,B,H);for(let Ae=0;Ae<v.length;Ae++)fc(v[Ae],we[Ae],ye);let je=Wr([],we[J],we[(J+1)%4]);fr(je,je,.5),fc(me,je,ye)}for(let we of v)hl(T,T,we),Ua(E,E,we);return T[2]=Math.min(ie[2],he[2]),hl(T,T,me),Ua(E,E,me),new $t(T,E)}function F1({x:l,y:t,z:s},u=!1){let h=1/(1<<s),m=new c(A(l*h),t===(1<<s)-1&&u?-90:L((t+1)*h)),g=new c(A((l+1)*h),t===0&&u?90:L(t*h));return new f(m,g)}function EI(l,t=Ko){let s=Zn(l.getNorth()),u=Zn(l.getSouth()),h=Math.cos(s),m=Math.cos(u),g=Math.sin(s),v=Math.sin(u),b=l.getWest(),E=l.getEast();return[vd(m,v,b,t),vd(m,v,E,t),vd(h,g,E,t),vd(h,g,b,t)]}function Fv(l,t,s,u){let h=1<<s.z,m=(l/yt+s.x)/h;return vh(L((t/yt+s.y)/h),A(m),u)}function L1({min:l,max:t}){return CI/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}let kR=new Float64Array(16);function N1(l){let t=L1(l),s=Or(kR,[t,t,t]);return Xt(s,s,Bc([],l.min))}function SI(l){let t=(u=l.min,(s=kR)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;let h=1/L1(l);return Vn(t,t,[h,h,h])}function TI(l){let t=yt/(2*Math.PI);return l/(2*Math.PI)/t}function FR(l,t){return yt/(512*Math.pow(2,l))*L1(Ja(t))}function LR(l,t,s,u,h){let m=TI(s),g=[l,t,-s/(2*Math.PI)],v=ht(new Float64Array(16));return Xt(v,v,g),Vn(v,v,[m,m,m]),sr(v,v,Zn(-h)),Hi(v,v,Zn(-u)),v}function bh(l){return Q(Sa,Tg,l)}function NR(l,t){let s=vh(t.lat,t.lng),u=(function(R){let B=vh(R._center.lat,R._center.lng),H=Wo([],xr(0,1,0),B),$=qo([],-R.angle,B);H=Fr(H,H,$),qo($,-R._pitch,H);let Y=Yi([],B);return fr(Y,Y,Il(R.cameraToCenterDistance/R.pixelsPerMeter)),Fr(Y,Y,$),Wr([],B,Y)})(l);return g=(h=dl([],u,s))[0],v=h[1],b=h[2],E=(m=s)[0],T=m[1],I=m[2],O=(D=Math.sqrt((g*g+v*v+b*b)*(E*E+T*T+I*I)))&&Ir(h,m)/D,Math.acos(Math.min(Math.max(O,-1),1));var h,m,g,v,b,E,T,I,D,O}function II(l,t){return NR(l,t)>Math.PI/2*1.01}let zR=Zn(85),S6=Math.cos(zR),T6=Math.sin(zR),I6=$e(),BR=l=>{let t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function VR(l,t,s,u,h,m,g,v,b){if(m&&l.queryGeometry.isAboveHorizon)return!1;m&&(b*=l.pixelToTileUnitsFactor);let E=l.tileID.canonical,T=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(let I of t)for(let D of I){let O=D.add(v),R=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,B=s.projection.projectTilePoint(O.x,O.y,E);if(R>0){let J=s.projection.upVector(E,O.x,O.y);B.x+=J[0]*T*R,B.y+=J[1]*T*R,B.z+=J[2]*T*R}let H=m?O:M6(B.x,B.y,B.z,u),$=m?l.tilespaceRays.map(J=>A6(J,R)):l.queryGeometry.screenGeometry,Y=Zo([],[B.x,B.y,B.z,1],u);if(!g&&m?b*=Y[3]/s.cameraToCenterDistance:g&&!m&&(b*=s.cameraToCenterDistance/Y[3]),m){let J=L((D.y/yt+E.y)/(1<<E.z));b/=s.projection.pixelsPerMeter(J,1)/M(1,J)}if(wn($,H,b))return!0}return!1}function M6(l,t,s,u){let h=Zo([],[l,t,s,1],u);return new st(h[0]/h[3],h[1]/h[3])}let UR=xr(0,0,0),D6=xr(0,0,1);function A6(l,t){let s=ci();return UR[2]=t,l.intersectsPlane(UR,D6,s),new st(s[0],s[1])}class jR extends di{}let $R,HR,GR,qR;function WR(l,{width:t,height:s},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*s*u);return l.width=t,l.height=s,l.data=h,l}function ZR(l,t,s){let{width:u,height:h}=t;u===l.width&&h===l.height||(MI(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,h)},s,null),l.width=u,l.height=h,l.data=t.data)}function MI(l,t,s,u,h,m,g,v){if(h.width===0||h.height===0)return t;if(h.width>l.width||h.height>l.height||s.x>l.width-h.width||s.y>l.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||u.x>t.width-h.width||u.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let b=l.data,E=t.data,T=m===4&&v;for(let I=0;I<h.height;I++){let D=((s.y+I)*l.width+s.x)*m,O=((u.y+I)*t.width+u.x)*m;if(T)for(let R=0;R<h.width;R++){let B=D+R*m+3,H=O+R*m;E[H+0]=255,E[H+1]=255,E[H+2]=255,E[H+3]=b[B]}else if(g)for(let R=0;R<h.width;R++){let B=D+R*m,H=O+R*m,$=new ui(b[B+0]/255,b[B+1]/255,b[B+2]/255,b[B+3]).toNonPremultipliedRenderColor(g).toArray();E[H+0]=$[0],E[H+1]=$[1],E[H+2]=$[2],E[H+3]=$[3]}else for(let R=0;R<h.width*m;R++)E[O+R]=b[D+R]}return t}Lt(jR,"HeatmapBucket",{omit:["layers"]});class wh{constructor(t,s){WR(this,t,1,s)}resize(t){ZR(this,new wh(t),1)}clone(){return new wh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,h,m){MI(t,s,u,h,m,1,null)}}class es{constructor(t,s){WR(this,t,4,s)}resize(t){ZR(this,new es(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,h,m,g,v){MI(t,s,u,h,m,4,g,v)}}class YR{constructor(t,s){this.width=t.width,this.height=t.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Lv(l){let t={},s=l.resolution||256,u=l.clips?l.clips.length:1,h=l.image||new es({width:s,height:u}),m=(g,v,b)=>{t[l.evaluationKey]=b;let E=l.expression.evaluate(t),T=E?E.toNonPremultipliedRenderColor(null):null;T&&(h.data[g+v+0]=Math.floor(255*T.r),h.data[g+v+1]=Math.floor(255*T.g),h.data[g+v+2]=Math.floor(255*T.b),h.data[g+v+3]=Math.floor(255*T.a))};if(l.clips)for(let g=0,v=0;g<u;++g,v+=4*s)for(let b=0,E=0;b<s;b++,E+=4){let T=b/(s-1),{start:I,end:D}=l.clips[g];m(v,E,I*(1-T)+D*T)}else for(let g=0,v=0;g<s;g++,v+=4)m(0,v,g/(s-1));return h}Lt(wh,"AlphaImage"),Lt(es,"RGBAImage");let P6=Pn([{name:"a_pos",components:2,type:"Int16"}],4),O6=Pn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),R6=Pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),k6=Pn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ig(l,t,s=2){let u=t&&t.length,h=u?t[0]*s:l.length,m=XR(l,0,h,s,!0),g=[];if(!m||m.next===m.prev)return g;let v,b,E;if(u&&(m=(function(T,I,D,O){let R=[];for(let B=0,H=I.length;B<H;B++){let $=XR(T,I[B]*O,B<H-1?I[B+1]*O:T.length,O,!1);$===$.next&&($.steiner=!0),R.push(j6($))}R.sort(B6);for(let B=0;B<R.length;B++)D=V6(R[B],D);return D})(l,t,m,s)),l.length>80*s){v=l[0],b=l[1];let T=v,I=b;for(let D=s;D<h;D+=s){let O=l[D],R=l[D+1];O<v&&(v=O),R<b&&(b=R),O>T&&(T=O),R>I&&(I=R)}E=Math.max(T-v,I-b),E=E!==0?32767/E:0}return Nv(m,g,s,v,b,E,0),g}function XR(l,t,s,u,h){let m;if(h===(function(g,v,b,E){let T=0;for(let I=v,D=b-E;I<b;I+=E)T+=(g[D]-g[I])*(g[I+1]+g[D+1]),D=I;return T})(l,t,s,u)>0)for(let g=t;g<s;g+=u)m=ek(g/u|0,l[g],l[g+1],m);else for(let g=s-u;g>=t;g-=u)m=ek(g/u|0,l[g],l[g+1],m);return m&&Mg(m,m.next)&&(Vv(m),m=m.next),m}function Qp(l,t){if(!l)return l;t||(t=l);let s,u=l;do if(s=!1,u.steiner||!Mg(u,u.next)&&Eo(u.prev,u,u.next)!==0)u=u.next;else{if(Vv(u),u=t=u.prev,u===u.next)break;s=!0}while(s||u!==t);return t}function Nv(l,t,s,u,h,m,g){if(!l)return;!g&&m&&(function(b,E,T,I){let D=b;do D.z===0&&(D.z=DI(D.x,D.y,E,T,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==b);D.prevZ.nextZ=null,D.prevZ=null,(function(O){let R,B=1;do{let H,$=O;O=null;let Y=null;for(R=0;$;){R++;let J=$,ie=0;for(let le=0;le<B&&(ie++,J=J.nextZ,J);le++);let he=B;for(;ie>0||he>0&&J;)ie!==0&&(he===0||!J||$.z<=J.z)?(H=$,$=$.nextZ,ie--):(H=J,J=J.nextZ,he--),Y?Y.nextZ=H:O=H,H.prevZ=Y,Y=H;$=J}Y.nextZ=null,B*=2}while(R>1)})(D)})(l,u,h,m);let v=l;for(;l.prev!==l.next;){let b=l.prev,E=l.next;if(m?L6(l,u,h,m):F6(l))t.push(b.i,l.i,E.i),Vv(l),l=E.next,v=E.next;else if((l=E)===v){g?g===1?Nv(l=N6(Qp(l),t),t,s,u,h,m,2):g===2&&z6(l,t,s,u,h,m):Nv(Qp(l),t,s,u,h,m,1);break}}}function F6(l){let t=l.prev,s=l,u=l.next;if(Eo(t,s,u)>=0)return!1;let h=t.x,m=s.x,g=u.x,v=t.y,b=s.y,E=u.y,T=Math.min(h,m,g),I=Math.min(v,b,E),D=Math.max(h,m,g),O=Math.max(v,b,E),R=u.next;for(;R!==t;){if(R.x>=T&&R.x<=D&&R.y>=I&&R.y<=O&&zv(h,v,m,b,g,E,R.x,R.y)&&Eo(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function L6(l,t,s,u){let h=l.prev,m=l,g=l.next;if(Eo(h,m,g)>=0)return!1;let v=h.x,b=m.x,E=g.x,T=h.y,I=m.y,D=g.y,O=Math.min(v,b,E),R=Math.min(T,I,D),B=Math.max(v,b,E),H=Math.max(T,I,D),$=DI(O,R,t,s,u),Y=DI(B,H,t,s,u),J=l.prevZ,ie=l.nextZ;for(;J&&J.z>=$&&ie&&ie.z<=Y;){if(J.x>=O&&J.x<=B&&J.y>=R&&J.y<=H&&J!==h&&J!==g&&zv(v,T,b,I,E,D,J.x,J.y)&&Eo(J.prev,J,J.next)>=0||(J=J.prevZ,ie.x>=O&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==h&&ie!==g&&zv(v,T,b,I,E,D,ie.x,ie.y)&&Eo(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;J&&J.z>=$;){if(J.x>=O&&J.x<=B&&J.y>=R&&J.y<=H&&J!==h&&J!==g&&zv(v,T,b,I,E,D,J.x,J.y)&&Eo(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ie&&ie.z<=Y;){if(ie.x>=O&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==h&&ie!==g&&zv(v,T,b,I,E,D,ie.x,ie.y)&&Eo(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function N6(l,t){let s=l;do{let u=s.prev,h=s.next.next;!Mg(u,h)&&QR(u,s,s.next,h)&&Bv(u,h)&&Bv(h,u)&&(t.push(u.i,s.i,h.i),Vv(s),Vv(s.next),s=l=h),s=s.next}while(s!==l);return Qp(s)}function z6(l,t,s,u,h,m){let g=l;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&$6(g,v)){let b=JR(g,v);return g=Qp(g,g.next),b=Qp(b,b.next),Nv(g,t,s,u,h,m,0),void Nv(b,t,s,u,h,m,0)}v=v.next}g=g.next}while(g!==l)}function B6(l,t){let s=l.x-t.x;return s===0&&(s=l.y-t.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(t.next.y-t.y)/(t.next.x-t.x)),s}function V6(l,t){let s=(function(h,m){let g=m,v=h.x,b=h.y,E,T=-1/0;if(Mg(h,g))return g;do{if(Mg(h,g.next))return g.next;if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){let B=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(B<=v&&B>T&&(T=B,E=g.x<g.next.x?g:g.next,B===v))return E}g=g.next}while(g!==m);if(!E)return null;let I=E,D=E.x,O=E.y,R=1/0;g=E;do{if(v>=g.x&&g.x>=D&&v!==g.x&&KR(b<O?v:T,b,D,O,b<O?T:v,b,g.x,g.y)){let B=Math.abs(b-g.y)/(v-g.x);Bv(g,h)&&(B<R||B===R&&(g.x>E.x||g.x===E.x&&U6(E,g)))&&(E=g,R=B)}g=g.next}while(g!==I);return E})(l,t);if(!s)return t;let u=JR(s,l);return Qp(u,u.next),Qp(s,s.next)}function U6(l,t){return Eo(l.prev,l,t.prev)<0&&Eo(t.next,l,l.next)<0}function DI(l,t,s,u,h){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*h|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function j6(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function KR(l,t,s,u,h,m,g,v){return(h-g)*(t-v)>=(l-g)*(m-v)&&(l-g)*(u-v)>=(s-g)*(t-v)&&(s-g)*(m-v)>=(h-g)*(u-v)}function zv(l,t,s,u,h,m,g,v){return!(l===g&&t===v)&&KR(l,t,s,u,h,m,g,v)}function $6(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!(function(s,u){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==u.i&&h.next.i!==u.i&&QR(h,h.next,s,u))return!0;h=h.next}while(h!==s);return!1})(l,t)&&(Bv(l,t)&&Bv(t,l)&&(function(s,u){let h=s,m=!1,g=(s.x+u.x)/2,v=(s.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==s);return m})(l,t)&&(Eo(l.prev,l,t.prev)||Eo(l,t.prev,t))||Mg(l,t)&&Eo(l.prev,l,l.next)>0&&Eo(t.prev,t,t.next)>0)}function Eo(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function Mg(l,t){return l.x===t.x&&l.y===t.y}function QR(l,t,s,u){let h=B1(Eo(l,t,s)),m=B1(Eo(l,t,u)),g=B1(Eo(s,u,l)),v=B1(Eo(s,u,t));return h!==m&&g!==v||!(h!==0||!z1(l,s,t))||!(m!==0||!z1(l,u,t))||!(g!==0||!z1(s,l,u))||!(v!==0||!z1(s,t,u))}function z1(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function B1(l){return l>0?1:l<0?-1:0}function Bv(l,t){return Eo(l.prev,l,l.next)<0?Eo(l,t,l.next)>=0&&Eo(l,l.prev,t)>=0:Eo(l,t,l.prev)<0||Eo(l,l.next,t)<0}function JR(l,t){let s=AI(l.i,l.x,l.y),u=AI(t.i,t.x,t.y),h=l.next,m=t.prev;return l.next=t,t.prev=l,s.next=h,h.prev=s,u.next=s,s.prev=u,m.next=u,u.prev=m,u}function ek(l,t,s,u){let h=AI(l,t,s);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Vv(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function AI(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Uv(l,t){let s=l.length;if(s<=1)return[l];let u=[],h,m;for(let g=0;g<s;g++){let v=yn(l[g]);v!==0&&(l[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(h&&u.push(h),h=[l[g]]):h.push(l[g]))}if(h&&u.push(h),t>1)for(let g=0;g<u.length;g++)u[g].length<=t||(Sm(u[g],t,1,u[g].length-1,H6),u[g]=u[g].slice(0,t));return u}function H6(l,t){return t.area-l.area}function tk(l,t,s=1){if(!l)return null;let u=typeof l=="string"?ps.from(l).getPrimary():l.getPrimary(),h=typeof l=="string"?null:l.getSecondary();for(let m of[u,h]){if(!m)continue;let g=m.id.toString();t.has(g)||t.set(g,[]),m.scaleSelf(s),t.get(g).push(m)}return{primary:u.toString(),secondary:h?h.toString():null}}function PI(l,t,s,u){let h=u.patternDependencies,m=!1;for(let g of t){let v=g.paint.get(`${l}-pattern`);v.isConstant()||(m=!0),tk(v.constantOr(null),h,s)&&(m=!0)}return m}function OI(l,t,s,u,h,m){let g=m.patternDependencies;for(let v of t){let b=v.paint.get(`${l}-pattern`).value;if(b.kind!=="constant"){let E=b.evaluate({zoom:u},s,{},m.availableImages);E=E&&E.name?E.name:E;let T=tk(E,g,h);if(!T)continue;let{primary:I,secondary:D}=T;I&&(s.patterns[v.id]=[I,D].filter(Boolean))}}return s}class nk{constructor(){this.polygons=new Map}add(t,...s){let u=this.polygons.get(t);u?u.push(...s):this.polygons.set(t,s)}merge(t){for(let[s,u]of t.polygons)this.add(s,...u)}}class yd{constructor(){this.portals=[]}static isOnBorder(t,s){return t<=0&&s<=0||t>=yt&&s>=yt}static evaluate(t){if(t.length===0)return new yd;let s=[];for(let b of t)s.push(...b.portals);if(s.length===0)return new yd;for(let b of s){let E=b.va,T=b.vb;(yd.isOnBorder(E.x,T.x)||yd.isOnBorder(E.y,T.y))&&(b.type="border")}let u=s.filter(b=>b.type!=="unevaluated"),h=s.filter(b=>b.type==="unevaluated");if(h.length===0)return new yd;h.sort((b,E)=>b.hash===E.hash?b.isTunnel===E.isTunnel?0:b.isTunnel?-1:1:b.hash<E.hash?1:-1),s=u.concat(h);let m=u.length,g=m,v=m;do if(g++,g===s.length||s[m].hash!==s[g].hash){if(g-m==2){v<m&&(s[v]=s[m],s[m]=null);let b=s[v],E=s[g-1];b.type=b.isTunnel!==E.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:E.connection.a},v++}m=g}while(m!==s.length);return s.splice(v),s.sort((b,E)=>b.hash<E.hash?1:-1),{portals:s}}}Lt(yd,"ElevationPortalGraph"),Lt(nk,"ElevationPolygons");class G6{constructor(t,s,u){this.outPositions=t,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(t,s,u){let h=t[2];u!=null&&(h*=u);let m=`${t[0]},${t[1]},${t[2]},${s[0]},${s[1]},${s[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;let v=this.outPositions.length;this.vertexLookup.set(m,v);let b=Math.trunc(16384*s[0]),E=Math.trunc(16384*s[1]),T=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(t[0],t[1],h),this.outNormals.emplaceBack(b,E,T),v}addTriangle(t,s,u){this.outIndices.emplaceBack(t,s,u)}addTriangles(t,s,u){if(t.length===0)return;let h=u.length===1,m=ci(),g=ci();for(let v=0;v<t.length;v+=3){let b=s[t[v+0]],E=s[t[v+1]],T=s[t[v+2]],I=h?u[0]:u[t[v+1]],D=h?u[0]:u[t[v+2]];Ji(m,b.x,b.y,h?u[0]:u[t[v+0]]);let O=this.addVertex(m,g);Ji(m,E.x,E.y,I);let R=this.addVertex(m,g);Ji(m,T.x,T.y,D);let B=this.addVertex(m,g);this.outIndices.emplaceBack(O,R,B)}}addQuad(t,s,u,h,m,g){let v=this.addVertex(t,m,g),b=this.addVertex(s,m,g),E=this.addVertex(u,m,g),T=this.addVertex(h,m,g);this.addTriangle(v,b,E),this.addTriangle(E,T,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class oa{constructor(t,s,u,h){this.unevaluatedPortals=new yd,this.portalPolygons=new nk,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new mv,this.vertexNormals=new gv,this.indexArray=new Kr,this.tileToMeters=q(t),this.bridgeProgramConfigurations=new Ka(s,{zoom:u,lut:h},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ka(s,{zoom:u,lut:h},m=>m!=="fill-bridge-guard-rail-color")}addVertices(t,s){let u=this.unevalVertices.length;for(let h=0;h<t.length;h++)this.unevalVertices.push(t[h]),this.unevalHeights.push(s[h]);return u}addTriangles(t,s,u){let h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(let m of t)h.push(m+s)}addRenderableRing(t,s,u,h,m,g){let v=[new st(m.min.x,m.min.y),new st(m.max.x,m.min.y),new st(m.max.x,m.max.y),new st(m.min.x,m.max.y)];for(let b=0;b<u-1;b++){let E=s+b,T=E+1,I=this.unevalVertices[E],D=this.unevalVertices[T];if(!(I.x>=m.min.x&&I.x<=m.max.x&&I.y>=m.min.y&&I.y<=m.max.y||D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||Lo(I,D,v))||this.isOnBorder(I.x,D.x)||this.isOnBorder(I.y,D.y))continue;let O=oa.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[T]),R,B=this.vertexHashLookup.get(oa.computePosHash(I));B!=null?R=B.next:(B=this.vertexHashLookup.get(oa.computePosHash(D)),R=B!=null?B.prev:O),this.unevalEdges.push({polygonIdx:t,a:E,b:T,hash:O,portalHash:R,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(t,s,u,h,m){if(s.length===0)return;this.portalPolygons.add(t,{geometry:s,zLevel:m});let g=s[0];this.vertexHashLookup.clear();let v=oa.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let b=0;b<g.length-1;b++){let E=g[b+0],T=g[b+1],I=Ss(T.x-E.x,T.y-E.y),D=$a(I);if(D===0)continue;let O="unevaluated",R=h.pointElevation(E),B=h.pointElevation(T);Math.abs(R)<.01&&Math.abs(B)<.01?O="entrance":(this.isOnBorder(E.x,T.x)||this.isOnBorder(E.y,T.y))&&(O="border");let H=oa.computeEdgeHash(E,T);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:E,vb:T,vab:I,length:D,hash:H,isTunnel:u,type:O});let $=oa.computePosHash(E);this.vertexHashLookup.set($,{prev:v,next:H}),v=H}}construct(t){if(this.unevalVertices.length===0)return;let s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},h=new G6(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);let m=s(),g=s(),v=s(),b=(D,O)=>{D.sort((B,H)=>B.type===O&&H.type!==O?-1:B.type!==O&&H.type===O?1:0);let R=D.findIndex(B=>B.type!==O);return R>=0?R:D.length},E=0;this.unevalEdges.length>0&&(E=b(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),u(v);let T=s(),I=s();if(this.unevalEdges.length>0){let D=this.unevalEdges.splice(E),O=b(D,"tunnel")+E;this.unevalEdges.push(...D),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:O})}u(T),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(I),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(m),this.maskSegments=nr.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.depthSegments=nr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=nr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=nr.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.shadowCasterSegments=nr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(t,s,u,h,m,g,v,b){this.bridgeProgramConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b),this.tunnelProgramConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,R6.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,k6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,s,u,h,m){let g=(v,b)=>{for(let E=0;E<b.length-1;E++){let T=b[E].featureIndex,I=b[E+1].vertexStart,D=t.feature(T);v.populatePaintArrays(I,D,T,{},u,s,h,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,s,u,h,m){let g=new Map;for(let v=h;v<m;v++){let b=u[v],E=b.a,T=b.b,I=oa.computePosHash(t[E]),D=oa.computePosHash(t[T]),O=g.get(I);O||(O={},g.set(I,O));let R=g.get(D);R||(R={},g.set(D,R)),s[E]<=0&&s[T]<=0||(O.to=T,R.from=E)}return g}isTerminalVertex(t,s){let u=oa.computePosHash(this.unevalVertices[t]),h=s.get(u);return!h||!h.from||!h.to}constructBridgeStructures(t,s,u,h,m,g){t.clearVertexLookup();let v=this.computeVertexConnections(s,u,h,m.min,m.max),b=1/g,E=.5*b,T=(at,ct)=>Ji(at,s[ct].x,s[ct].y,u[ct]*b),I=ci(),D=ci(),O=ci(),R=ci(),B=ci(),H=(at,ct)=>{let nt=v.get(oa.computePosHash(s[ct])),it=nt.from,qe=nt.to;if(!it||!qe)return;T(I,it),T(D,ct),T(O,qe),zs(R),rs(I,D)||(Vr(B,D,I),Yi(R,B)),rs(O,D)||(Vr(B,O,D),Wr(R,R,Yi(B,B)));let He=Gd(R);return He>0?fr(at,R,1/He):void 0},$=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,(at,ct)=>at.featureInfo.featureIndex-ct.featureInfo.featureIndex);let Y=ci(),J=ci(),ie=ci(),he=ci(),le=ci(),me=ci(),ye=ci(),we=ci(),je=ci(),Ae=[ci(),ci(),ci(),ci()],We=[ci(),ci(),ci(),ci()],Ke=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],Qe=(at,ct)=>at>ct;for(let at=m.min;at<m.max;at++){let ct=h[at];if(!ct.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ke,s,u,ct,Qe))continue;let[nt,it]=Ke;if(Ji(Y,nt.coord.x,nt.coord.y,b*nt.height),Ji(J,it.coord.x,it.coord.y,b*it.height),rs(Y,J))continue;Vr(ie,J,Y),Yi(ie,ie);let qe=H(we,ct.a)||ie,He=H(je,ct.b)||ie;Ji(he,qe[1],-qe[0],0),Yi(he,he),Ji(le,He[1],-He[0],0),Yi(le,le),Wo(we,he,qe),Yi(me,we),Wo(we,le,He),Yi(ye,we),Wr(Ae[0],Y,fr(we,Vr(we,he,me),E)),Wr(Ae[1],Y,fr(we,Wr(we,he,me),E)),Wr(Ae[2],Y,fr(we,me,E)),Ae[3]=Y,Wr(We[0],J,fr(we,Vr(we,le,ye),E)),Wr(We[1],J,fr(we,Wr(we,le,ye),E)),Wr(We[2],J,fr(we,ye,E)),We[3]=J,$=this.addFeatureSection(ct.featureInfo.featureIndex,$,this.bridgeFeatureSections,t);let rt=t.addVertex(Ae[0],he,g),xt=t.addVertex(Ae[1],he,g),ft=t.addVertex(We[0],le,g),qt=t.addVertex(We[1],le,g);t.addTriangle(rt,xt,ft),t.addTriangle(xt,qt,ft);let It=t.addVertex(Ae[1],me,g),Rt=t.addVertex(Ae[2],me,g),Bt=t.addVertex(We[1],ye,g),In=t.addVertex(We[2],ye,g);t.addTriangle(It,Rt,Bt),t.addTriangle(Rt,In,Bt),Bc(he,he),Bc(le,le);let mt=t.addVertex(Ae[2],he,g),Ut=t.addVertex(Ae[3],he,g),dn=t.addVertex(We[2],le,g),Ln=t.addVertex(We[3],le,g);t.addTriangle(mt,Ut,dn),t.addTriangle(Ut,Ln,dn);let zn=this.isTerminalVertex(ct.a,v),_n=this.isTerminalVertex(ct.b,v);nt.height<.01&&zn&&t.addQuad(Ae[3],Ae[2],Ae[1],Ae[0],Bc(qe,qe),g),it.height<.01&&_n&&t.addQuad(We[0],We[1],We[2],We[3],He,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,s,u,h,m,g){t.clearVertexLookup();let v=Number.POSITIVE_INFINITY,b=($,Y)=>$.featureInfo.featureIndex-Y.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,b),this.sortSubarray(h,g.min,g.max,b);let E=$=>Yi($,$),T=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],I=($,Y)=>$<Y,D=ci(),O=ci(),R=ci(),B=ci(),H=ci();for(let $=m.min;$<m.max;$++){if(!this.prepareEdgePoints(T,s,u,h[$],I))continue;let[Y,J]=T,ie=E(Ji(H,-(J.coord.y-Y.coord.y),J.coord.x-Y.coord.x,0));v=this.addFeatureSection(h[$].featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Ji(D,Y.coord.x,Y.coord.y,Y.height),Ji(O,J.coord.x,J.coord.y,J.height),Ji(R,J.coord.x,J.coord.y,h[$].isTunnel?-.1:0),Ji(B,Y.coord.x,Y.coord.y,h[$].isTunnel?-.1:0),ie)}for(let $=g.min;$<g.max;$++){let Y=h[$];Y.isTunnel&&([Y.a,Y.b]=[Y.b,Y.a]);let J=s[Y.a],ie=s[Y.b],he=E(Ji(H,-(ie.y-J.y),ie.x-J.x,0));v=this.addFeatureSection(Y.featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Ji(D,ie.x,ie.y,0),Ji(O,J.x,J.y,0),Ji(R,J.x,J.y,u[Y.a]+4),Ji(B,ie.x,ie.y,u[Y.b]+4),he),t.addQuad(Ji(D,J.x,J.y,0),Ji(O,ie.x,ie.y,0),Ji(R,ie.x,ie.y,u[Y.b]+4),Ji(B,J.x,J.y,u[Y.a]+4),he)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,s,u,h){t.coord.x=s,t.coord.y=u,t.height=h}prepareEdgePoints(t,s,u,h,m){let g=s[h.a].x,v=s[h.a].y,b=s[h.b].x,E=s[h.b].y,T=u[h.a],I=u[h.b],D=m(T,0),O=m(I,0);if(D&&O)return this.setElevatedPoint(t[0],g,v,T),this.setElevatedPoint(t[1],b,E,I),!0;if(!D&&!O)return!1;if(D){if(!O){let R=I/(I-T);b=on(b,g,R),E=on(E,v,R),I=on(I,T,R)}}else{let R=T/(T-I);g=on(g,b,R),v=on(v,E,R),T=on(T,I,R)}return this.setElevatedPoint(t[0],g,v,T),this.setElevatedPoint(t[1],b,E,I),!0}prepareEdges(t,s){if(s.length===0)return;s.sort((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1);let u=0,h=0,m=0,g=s[u].polygonIdx;do h++,(h===s.length||s[u].hash!==s[h].hash)&&((h-u==1||s[h-1].polygonIdx!==g)&&(m<u&&(s[m]=s[u],s[u]=null),s[m].type="none",m++),u=h,u!==s.length&&(g=s[u].polygonIdx));while(u!==s.length);if(s.splice(m),s.length!==0&&t.length!==0){s.sort((E,T)=>E.portalHash<T.portalHash?1:-1);let v=0,b=0;for(;v!==s.length&&b!==t.length;){let E=s[v],T=t[b];E.portalHash>T.hash?v++:T.hash>E.portalHash?b++:(E.type=T.type,v++)}}}isOnBorder(t,s){return t<=0&&s<=0||t>=yt&&s>=yt}addFeatureSection(t,s,u,h){return t!==s&&(s=t,u.push({featureIndex:t,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),s}sortSubarray(t,s,u,h){let m=t.slice(s,u);m.sort(h),t.splice(s,m.length,...m)}static computeEdgeHash(t,s){return(t.y===s.y&&t.x>s.x||t.y>s.y)&&([t,s]=[s,t]),BigInt(oa.computePosHash(t))<<32n|BigInt(oa.computePosHash(s))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var ik,rk={exports:{}},ok=(ik||(ik=1,(function(l){function t(ce,pe){return ce>pe?1:ce<pe?-1:0}var s=function(ce,pe){ce===void 0&&(ce=t),pe===void 0&&(pe=!1),this._compare=ce,this._root=null,this._size=0,this._noDuplicates=!!pe},u={size:{configurable:!0}};function h(ce,pe,Ze,lt,Et){var St=Et-lt;if(St>0){var Wt=lt+Math.floor(St/2),Yt={key:pe[Wt],data:Ze[Wt],parent:ce};return Yt.left=h(Yt,pe,Ze,lt,Wt),Yt.right=h(Yt,pe,Ze,Wt+1,Et),Yt}return null}function m(ce,pe,Ze,lt,Et){if(!(Ze>=lt)){for(var St=ce[Ze+lt>>1],Wt=Ze-1,Yt=lt+1;;){do Wt++;while(Et(ce[Wt],St)<0);do Yt--;while(Et(ce[Yt],St)>0);if(Wt>=Yt)break;var mn=ce[Wt];ce[Wt]=ce[Yt],ce[Yt]=mn,mn=pe[Wt],pe[Wt]=pe[Yt],pe[Yt]=mn}m(ce,pe,Ze,Yt,Et),m(ce,pe,Yt+1,lt,Et)}}s.prototype.rotateLeft=function(ce){var pe=ce.right;pe&&(ce.right=pe.left,pe.left&&(pe.left.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.left=ce),ce.parent=pe},s.prototype.rotateRight=function(ce){var pe=ce.left;pe&&(ce.left=pe.right,pe.right&&(pe.right.parent=ce),pe.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.right=ce),ce.parent=pe},s.prototype._splay=function(ce){for(;ce.parent;){var pe=ce.parent;pe.parent?pe.left===ce&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===ce&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===ce&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===ce?this.rotateRight(pe):this.rotateLeft(pe)}},s.prototype.splay=function(ce){for(var pe,Ze,lt,Et,St;ce.parent;)(Ze=(pe=ce.parent).parent)&&Ze.parent?((lt=Ze.parent).left===Ze?lt.left=ce:lt.right=ce,ce.parent=lt):(ce.parent=null,this._root=ce),Et=ce.left,St=ce.right,ce===pe.left?(Ze&&(Ze.left===pe?(pe.right?(Ze.left=pe.right,Ze.left.parent=Ze):Ze.left=null,pe.right=Ze,Ze.parent=pe):(Et?(Ze.right=Et,Et.parent=Ze):Ze.right=null,ce.left=Ze,Ze.parent=ce)),St?(pe.left=St,St.parent=pe):pe.left=null,ce.right=pe,pe.parent=ce):(Ze&&(Ze.right===pe?(pe.left?(Ze.right=pe.left,Ze.right.parent=Ze):Ze.right=null,pe.left=Ze,Ze.parent=pe):(St?(Ze.left=St,St.parent=Ze):Ze.left=null,ce.right=Ze,Ze.parent=ce)),Et?(pe.right=Et,Et.parent=pe):pe.right=null,ce.left=pe,pe.parent=ce)},s.prototype.replace=function(ce,pe){ce.parent?ce===ce.parent.left?ce.parent.left=pe:ce.parent.right=pe:this._root=pe,pe&&(pe.parent=ce.parent)},s.prototype.minNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.left;)ce=ce.left;return ce},s.prototype.maxNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.right;)ce=ce.right;return ce},s.prototype.insert=function(ce,pe){var Ze=this._root,lt=null,Et=this._compare;if(this._noDuplicates)for(;Ze;){if(lt=Ze,Et(Ze.key,ce)===0)return;Ze=Et(Ze.key,ce)<0?Ze.right:Ze.left}else for(;Ze;)lt=Ze,Ze=Et(Ze.key,ce)<0?Ze.right:Ze.left;return Ze={key:ce,data:pe,left:null,right:null,parent:lt},lt?Et(lt.key,Ze.key)<0?lt.right=Ze:lt.left=Ze:this._root=Ze,this.splay(Ze),this._size++,Ze},s.prototype.find=function(ce){for(var pe=this._root,Ze=this._compare;pe;){var lt=Ze(pe.key,ce);if(lt<0)pe=pe.right;else{if(!(lt>0))return pe;pe=pe.left}}return null},s.prototype.contains=function(ce){for(var pe=this._root,Ze=this._compare;pe;){var lt=Ze(ce,pe.key);if(lt===0)return!0;pe=lt<0?pe.left:pe.right}return!1},s.prototype.remove=function(ce){var pe=this.find(ce);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var Ze=this.minNode(pe.right);Ze.parent!==pe&&(this.replace(Ze,Ze.right),Ze.right=pe.right,Ze.right.parent=Ze),this.replace(pe,Ze),Ze.left=pe.left,Ze.left.parent=Ze}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},s.prototype.removeNode=function(ce){if(!ce)return!1;if(this.splay(ce),ce.left)if(ce.right){var pe=this.minNode(ce.right);pe.parent!==ce&&(this.replace(pe,pe.right),pe.right=ce.right,pe.right.parent=pe),this.replace(ce,pe),pe.left=ce.left,pe.left.parent=pe}else this.replace(ce,ce.left);else this.replace(ce,ce.right);return this._size--,!0},s.prototype.erase=function(ce){var pe=this.find(ce);if(pe){this.splay(pe);var Ze=pe.left,lt=pe.right,Et=null;Ze&&(Ze.parent=null,Et=this.maxNode(Ze),this.splay(Et),this._root=Et),lt&&(Ze?Et.right=lt:this._root=lt,lt.parent=Et),this._size--}},s.prototype.pop=function(){var ce=this._root,pe=null;if(ce){for(;ce.left;)ce=ce.left;pe={key:ce.key,data:ce.data},this.remove(ce.key)}return pe},s.prototype.next=function(ce){var pe=ce;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=ce.parent;pe&&pe.right===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.prev=function(ce){var pe=ce;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=ce.parent;pe&&pe.left===ce;)ce=pe,pe=pe.parent;return pe},s.prototype.forEach=function(ce){for(var pe=this._root,Ze=[],lt=!1,Et=0;!lt;)pe?(Ze.push(pe),pe=pe.left):Ze.length>0?(ce(pe=Ze.pop(),Et++),pe=pe.right):lt=!0;return this},s.prototype.range=function(ce,pe,Ze,lt){for(var Et=[],St=this._compare,Wt=this._root;Et.length!==0||Wt;)if(Wt)Et.push(Wt),Wt=Wt.left;else{if(St((Wt=Et.pop()).key,pe)>0)break;if(St(Wt.key,ce)>=0&&Ze.call(lt,Wt))return this;Wt=Wt.right}return this},s.prototype.keys=function(){for(var ce=this._root,pe=[],Ze=[],lt=!1;!lt;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),Ze.push(ce.key),ce=ce.right):lt=!0;return Ze},s.prototype.values=function(){for(var ce=this._root,pe=[],Ze=[],lt=!1;!lt;)ce?(pe.push(ce),ce=ce.left):pe.length>0?(ce=pe.pop(),Ze.push(ce.data),ce=ce.right):lt=!0;return Ze},s.prototype.at=function(ce){for(var pe=this._root,Ze=[],lt=!1,Et=0;!lt;)if(pe)Ze.push(pe),pe=pe.left;else if(Ze.length>0){if(pe=Ze.pop(),Et===ce)return pe;Et++,pe=pe.right}else lt=!0;return null},s.prototype.load=function(ce,pe,Ze){if(ce===void 0&&(ce=[]),pe===void 0&&(pe=[]),Ze===void 0&&(Ze=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var lt=ce.length;return Ze&&m(ce,pe,0,lt-1,this._compare),this._root=h(null,ce,pe,0,lt),this._size=lt,this},s.prototype.min=function(){var ce=this.minNode(this._root);return ce?ce.key:null},s.prototype.max=function(){var ce=this.maxNode(this._root);return ce?ce.key:null},s.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},s.createTree=function(ce,pe,Ze,lt,Et){return new s(Ze,Et).load(ce,pe,lt)},Object.defineProperties(s.prototype,u);var g=0,v=1,b=2,E=3,T=0,I=1,D=2,O=3;function R(ce,pe,Ze){pe===null?(ce.inOut=!1,ce.otherInOut=!0):(ce.isSubject===pe.isSubject?(ce.inOut=!pe.inOut,ce.otherInOut=pe.otherInOut):(ce.inOut=!pe.otherInOut,ce.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(ce.prevInResult=!B(pe,Ze)||pe.isVertical()?pe.prevInResult:pe));var lt=B(ce,Ze);ce.resultTransition=lt?(function(Et,St){var Wt,Yt=!Et.inOut,mn=!Et.otherInOut;switch(St){case T:Wt=Yt&&mn;break;case I:Wt=Yt||mn;break;case O:Wt=Yt^mn;break;case D:Wt=Et.isSubject?Yt&&!mn:mn&&!Yt}return Wt?1:-1})(ce,Ze):0}function B(ce,pe){switch(ce.type){case g:switch(pe){case T:return!ce.otherInOut;case I:return ce.otherInOut;case D:return ce.isSubject&&ce.otherInOut||!ce.isSubject&&!ce.otherInOut;case O:return!0}break;case b:return pe===T||pe===I;case E:return pe===D;case v:return!1}return!1}var H=function(ce,pe,Ze,lt,Et){this.left=pe,this.point=ce,this.otherEvent=Ze,this.isSubject=lt,this.type=Et||g,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},$={inResult:{configurable:!0}};function Y(ce,pe){return ce[0]===pe[0]&&ce[1]===pe[1]}H.prototype.isBelow=function(ce){var pe=this.point,Ze=this.otherEvent.point;return this.left?(pe[0]-ce[0])*(Ze[1]-ce[1])-(Ze[0]-ce[0])*(pe[1]-ce[1])>0:(Ze[0]-ce[0])*(pe[1]-ce[1])-(pe[0]-ce[0])*(Ze[1]-ce[1])>0},H.prototype.isAbove=function(ce){return!this.isBelow(ce)},H.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},$.inResult.get=function(){return this.resultTransition!==0},H.prototype.clone=function(){var ce=new H(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ce.contourId=this.contourId,ce.resultTransition=this.resultTransition,ce.prevInResult=this.prevInResult,ce.isExteriorRing=this.isExteriorRing,ce.inOut=this.inOut,ce.otherInOut=this.otherInOut,ce},Object.defineProperties(H.prototype,$);var J=11102230246251565e-32,ie=134217729,he=(3+8*J)*J;function le(ce,pe,Ze,lt,Et){var St,Wt,Yt,mn,En=pe[0],Tn=lt[0],On=0,rn=0;Tn>En==Tn>-En?(St=En,En=pe[++On]):(St=Tn,Tn=lt[++rn]);var un=0;if(On<ce&&rn<Ze)for(Tn>En==Tn>-En?(Yt=St-((Wt=En+St)-En),En=pe[++On]):(Yt=St-((Wt=Tn+St)-Tn),Tn=lt[++rn]),St=Wt,Yt!==0&&(Et[un++]=Yt);On<ce&&rn<Ze;)Tn>En==Tn>-En?(Yt=St-((Wt=St+En)-(mn=Wt-St))+(En-mn),En=pe[++On]):(Yt=St-((Wt=St+Tn)-(mn=Wt-St))+(Tn-mn),Tn=lt[++rn]),St=Wt,Yt!==0&&(Et[un++]=Yt);for(;On<ce;)Yt=St-((Wt=St+En)-(mn=Wt-St))+(En-mn),En=pe[++On],St=Wt,Yt!==0&&(Et[un++]=Yt);for(;rn<Ze;)Yt=St-((Wt=St+Tn)-(mn=Wt-St))+(Tn-mn),Tn=lt[++rn],St=Wt,Yt!==0&&(Et[un++]=Yt);return St===0&&un!==0||(Et[un++]=St),un}function me(ce){return new Float64Array(ce)}var ye=33306690738754716e-32,we=22204460492503146e-32,je=11093356479670487e-47,Ae=me(4),We=me(8),Ke=me(12),Qe=me(16),at=me(4);function ct(ce,pe,Ze){var lt=(function(Et,St,Wt,Yt,mn,En){var Tn=(St-En)*(Wt-mn),On=(Et-mn)*(Yt-En),rn=Tn-On;if(Tn===0||On===0||Tn>0!=On>0)return rn;var un=Math.abs(Tn+On);return Math.abs(rn)>=ye*un?rn:-(function(Hn,Xn,Kn,hi,Mi,vi,ei){var oi,Sn,Nn,tr,tn,Rn,wi,Ri,ji,Dr,zi,nn,or,pi,Qi,eo,mo,$r,Hr=Hn-Mi,ao=Kn-Mi,Os=Xn-vi,Bi=hi-vi;Ae[0]=(Qi=(Ri=Hr-(wi=(Rn=ie*Hr)-(Rn-Hr)))*(Dr=Bi-(ji=(Rn=ie*Bi)-(Rn-Bi)))-((pi=Hr*Bi)-wi*ji-Ri*ji-wi*Dr))-((zi=Qi-(mo=(Ri=Os-(wi=(Rn=ie*Os)-(Rn-Os)))*(Dr=ao-(ji=(Rn=ie*ao)-(Rn-ao)))-((eo=Os*ao)-wi*ji-Ri*ji-wi*Dr)))+(tn=Qi-zi))+(tn-mo),Ae[1]=(or=pi-((nn=pi+zi)-(tn=nn-pi))+(zi-tn))-((zi=or-eo)+(tn=or-zi))+(tn-eo),Ae[2]=nn-(($r=nn+zi)-(tn=$r-nn))+(zi-tn),Ae[3]=$r;var Er=(function(hu,No){for(var vs=No[0],aa=1;aa<4;aa++)vs+=No[aa];return vs})(0,Ae),Ar=we*ei;if(Er>=Ar||-Er>=Ar||(oi=Hn-(Hr+(tn=Hn-Hr))+(tn-Mi),Nn=Kn-(ao+(tn=Kn-ao))+(tn-Mi),Sn=Xn-(Os+(tn=Xn-Os))+(tn-vi),tr=hi-(Bi+(tn=hi-Bi))+(tn-vi),oi===0&&Sn===0&&Nn===0&&tr===0)||(Ar=je*ei+he*Math.abs(Er),(Er+=Hr*tr+Bi*oi-(Os*Nn+ao*Sn))>=Ar||-Er>=Ar))return Er;at[0]=(Qi=(Ri=oi-(wi=(Rn=ie*oi)-(Rn-oi)))*(Dr=Bi-(ji=(Rn=ie*Bi)-(Rn-Bi)))-((pi=oi*Bi)-wi*ji-Ri*ji-wi*Dr))-((zi=Qi-(mo=(Ri=Sn-(wi=(Rn=ie*Sn)-(Rn-Sn)))*(Dr=ao-(ji=(Rn=ie*ao)-(Rn-ao)))-((eo=Sn*ao)-wi*ji-Ri*ji-wi*Dr)))+(tn=Qi-zi))+(tn-mo),at[1]=(or=pi-((nn=pi+zi)-(tn=nn-pi))+(zi-tn))-((zi=or-eo)+(tn=or-zi))+(tn-eo),at[2]=nn-(($r=nn+zi)-(tn=$r-nn))+(zi-tn),at[3]=$r;var Us=le(4,Ae,4,at,We);at[0]=(Qi=(Ri=Hr-(wi=(Rn=ie*Hr)-(Rn-Hr)))*(Dr=tr-(ji=(Rn=ie*tr)-(Rn-tr)))-((pi=Hr*tr)-wi*ji-Ri*ji-wi*Dr))-((zi=Qi-(mo=(Ri=Os-(wi=(Rn=ie*Os)-(Rn-Os)))*(Dr=Nn-(ji=(Rn=ie*Nn)-(Rn-Nn)))-((eo=Os*Nn)-wi*ji-Ri*ji-wi*Dr)))+(tn=Qi-zi))+(tn-mo),at[1]=(or=pi-((nn=pi+zi)-(tn=nn-pi))+(zi-tn))-((zi=or-eo)+(tn=or-zi))+(tn-eo),at[2]=nn-(($r=nn+zi)-(tn=$r-nn))+(zi-tn),at[3]=$r;var to=le(Us,We,4,at,Ke);at[0]=(Qi=(Ri=oi-(wi=(Rn=ie*oi)-(Rn-oi)))*(Dr=tr-(ji=(Rn=ie*tr)-(Rn-tr)))-((pi=oi*tr)-wi*ji-Ri*ji-wi*Dr))-((zi=Qi-(mo=(Ri=Sn-(wi=(Rn=ie*Sn)-(Rn-Sn)))*(Dr=Nn-(ji=(Rn=ie*Nn)-(Rn-Nn)))-((eo=Sn*Nn)-wi*ji-Ri*ji-wi*Dr)))+(tn=Qi-zi))+(tn-mo),at[1]=(or=pi-((nn=pi+zi)-(tn=nn-pi))+(zi-tn))-((zi=or-eo)+(tn=or-zi))+(tn-eo),at[2]=nn-(($r=nn+zi)-(tn=$r-nn))+(zi-tn),at[3]=$r;var Dl=le(to,Ke,4,at,Qe);return Qe[Dl-1]})(Et,St,Wt,Yt,mn,En,un)})(ce[0],ce[1],pe[0],pe[1],Ze[0],Ze[1]);return lt>0?-1:lt<0?1:0}function nt(ce,pe){var Ze=ce.point,lt=pe.point;return Ze[0]>lt[0]?1:Ze[0]<lt[0]?-1:Ze[1]!==lt[1]?Ze[1]>lt[1]?1:-1:(function(Et,St,Wt,Yt){return Et.left!==St.left?Et.left?1:-1:ct(Wt,Et.otherEvent.point,St.otherEvent.point)!==0?Et.isBelow(St.otherEvent.point)?-1:1:!Et.isSubject&&St.isSubject?1:-1})(ce,pe,Ze)}function it(ce,pe,Ze){var lt=new H(pe,!1,ce,ce.isSubject),Et=new H(pe,!0,ce.otherEvent,ce.isSubject);return Y(ce.point,ce.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ce),lt.contourId=Et.contourId=ce.contourId,nt(Et,ce.otherEvent)>0&&(ce.otherEvent.left=!0,Et.left=!1),ce.otherEvent.otherEvent=Et,ce.otherEvent=lt,Ze.push(Et),Ze.push(lt),Ze}function qe(ce,pe){return ce[0]*pe[1]-ce[1]*pe[0]}function He(ce,pe){return ce[0]*pe[0]+ce[1]*pe[1]}function rt(ce,pe,Ze){var lt=(function(mn,En,Tn,On,rn){var un=[En[0]-mn[0],En[1]-mn[1]],Hn=[On[0]-Tn[0],On[1]-Tn[1]];function Xn(Rn,wi,Ri){return[Rn[0]+wi*Ri[0],Rn[1]+wi*Ri[1]]}var Kn=[Tn[0]-mn[0],Tn[1]-mn[1]],hi=qe(un,Hn),Mi=hi*hi,vi=He(un,un);if(Mi>0){var ei=qe(Kn,Hn)/hi;if(ei<0||ei>1)return null;var oi=qe(Kn,un)/hi;return oi<0||oi>1?null:ei===0||ei===1?[Xn(mn,ei,un)]:oi===0||oi===1?[Xn(Tn,oi,Hn)]:[Xn(mn,ei,un)]}if((Mi=(hi=qe(Kn,un))*hi)>0)return null;var Sn=He(un,Kn)/vi,Nn=Sn+He(un,Hn)/vi,tr=Math.min(Sn,Nn),tn=Math.max(Sn,Nn);return tr<=1&&tn>=0?tr===1?[Xn(mn,tr>0?tr:0,un)]:tn===0?[Xn(mn,tn<1?tn:1,un)]:[Xn(mn,tr>0?tr:0,un),Xn(mn,tn<1?tn:1,un)]:null})(ce.point,ce.otherEvent.point,pe.point,pe.otherEvent.point),Et=lt?lt.length:0;if(Et===0||Et===1&&(Y(ce.point,pe.point)||Y(ce.otherEvent.point,pe.otherEvent.point))||Et===2&&ce.isSubject===pe.isSubject)return 0;if(Et===1)return Y(ce.point,lt[0])||Y(ce.otherEvent.point,lt[0])||it(ce,lt[0],Ze),Y(pe.point,lt[0])||Y(pe.otherEvent.point,lt[0])||it(pe,lt[0],Ze),1;var St=[],Wt=!1,Yt=!1;return Y(ce.point,pe.point)?Wt=!0:nt(ce,pe)===1?St.push(pe,ce):St.push(ce,pe),Y(ce.otherEvent.point,pe.otherEvent.point)?Yt=!0:nt(ce.otherEvent,pe.otherEvent)===1?St.push(pe.otherEvent,ce.otherEvent):St.push(ce.otherEvent,pe.otherEvent),Wt&&Yt||Wt?(pe.type=v,ce.type=pe.inOut===ce.inOut?b:E,Wt&&!Yt&&it(St[1].otherEvent,St[0].point,Ze),2):Yt?(it(St[0],St[1].point,Ze),3):St[0]!==St[3].otherEvent?(it(St[0],St[1].point,Ze),it(St[1],St[2].point,Ze),3):(it(St[0],St[1].point,Ze),it(St[3].otherEvent,St[2].point,Ze),3)}function xt(ce,pe){if(ce===pe)return 0;if(ct(ce.point,ce.otherEvent.point,pe.point)!==0||ct(ce.point,ce.otherEvent.point,pe.otherEvent.point)!==0)return Y(ce.point,pe.point)?ce.isBelow(pe.otherEvent.point)?-1:1:ce.point[0]===pe.point[0]?ce.point[1]<pe.point[1]?-1:1:nt(ce,pe)===1?pe.isAbove(ce.point)?-1:1:ce.isBelow(pe.point)?-1:1;if(ce.isSubject!==pe.isSubject)return ce.isSubject?-1:1;var Ze=ce.point,lt=pe.point;return Ze[0]===lt[0]&&Ze[1]===lt[1]?(Ze=ce.otherEvent.point)[0]===(lt=pe.otherEvent.point)[0]&&Ze[1]===lt[1]?0:ce.contourId>pe.contourId?1:-1:nt(ce,pe)===1?1:-1}var ft=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function qt(ce,pe,Ze,lt){var Et,St=ce+1,Wt=pe[ce].point,Yt=pe.length;for(St<Yt&&(Et=pe[St].point);St<Yt&&Et[0]===Wt[0]&&Et[1]===Wt[1];){if(!Ze[St])return St;++St<Yt&&(Et=pe[St].point)}for(St=ce-1;Ze[St]&&St>lt;)St--;return St}ft.prototype.isExterior=function(){return this.holeOf==null};var It=Bt,Rt=Bt;function Bt(ce,pe){if(!(this instanceof Bt))return new Bt(ce,pe);if(this.data=ce||[],this.length=this.data.length,this.compare=pe||In,this.length>0)for(var Ze=(this.length>>1)-1;Ze>=0;Ze--)this._down(Ze)}function In(ce,pe){return ce<pe?-1:ce>pe?1:0}Bt.prototype={push:function(ce){this.data.push(ce),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ce=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ce}},peek:function(){return this.data[0]},_up:function(ce){for(var pe=this.data,Ze=this.compare,lt=pe[ce];ce>0;){var Et=ce-1>>1,St=pe[Et];if(Ze(lt,St)>=0)break;pe[ce]=St,ce=Et}pe[ce]=lt},_down:function(ce){for(var pe=this.data,Ze=this.compare,lt=this.length>>1,Et=pe[ce];ce<lt;){var St=1+(ce<<1),Wt=St+1,Yt=pe[St];if(Wt<this.length&&Ze(pe[Wt],Yt)<0&&(St=Wt,Yt=pe[Wt]),Ze(Yt,Et)>=0)break;pe[ce]=Yt,ce=St}pe[ce]=Et}},It.default=Rt;var mt=Math.max,Ut=Math.min,dn=0;function Ln(ce,pe,Ze,lt,Et,St){var Wt,Yt,mn,En,Tn,On;for(Wt=0,Yt=ce.length-1;Wt<Yt;Wt++)if(En=ce[Wt+1],Tn=new H(mn=ce[Wt],!1,void 0,pe),On=new H(En,!1,Tn,pe),Tn.otherEvent=On,mn[0]!==En[0]||mn[1]!==En[1]){Tn.contourId=On.contourId=Ze,St||(Tn.isExteriorRing=!1,On.isExteriorRing=!1),nt(Tn,On)>0?On.left=!0:Tn.left=!0;var rn=mn[0],un=mn[1];Et[0]=Ut(Et[0],rn),Et[1]=Ut(Et[1],un),Et[2]=mt(Et[2],rn),Et[3]=mt(Et[3],un),lt.push(Tn),lt.push(On)}}var zn=[];function _n(ce,pe,Ze){typeof ce[0][0][0]=="number"&&(ce=[ce]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var lt=(function(un,Hn,Xn){var Kn=null;return un.length*Hn.length==0&&(Xn===T?Kn=zn:Xn===D?Kn=un:Xn!==I&&Xn!==O||(Kn=un.length===0?Hn:un)),Kn})(ce,pe,Ze);if(lt)return lt===zn?null:lt;var Et=[1/0,1/0,-1/0,-1/0],St=[1/0,1/0,-1/0,-1/0],Wt=(function(un,Hn,Xn,Kn,hi){var Mi,vi,ei,oi,Sn,Nn,tr=new It(null,nt);for(ei=0,oi=un.length;ei<oi;ei++)for(Sn=0,Nn=(Mi=un[ei]).length;Sn<Nn;Sn++)(vi=Sn===0)&&dn++,Ln(Mi[Sn],!0,dn,tr,Xn,vi);for(ei=0,oi=Hn.length;ei<oi;ei++)for(Sn=0,Nn=(Mi=Hn[ei]).length;Sn<Nn;Sn++)vi=Sn===0,hi===D&&(vi=!1),vi&&dn++,Ln(Mi[Sn],!1,dn,tr,Kn,vi);return tr})(ce,pe,Et,St,Ze);if(lt=(function(un,Hn,Xn,Kn,hi){var Mi=null;return(Xn[0]>Kn[2]||Kn[0]>Xn[2]||Xn[1]>Kn[3]||Kn[1]>Xn[3])&&(hi===T?Mi=zn:hi===D?Mi=un:hi!==I&&hi!==O||(Mi=un.concat(Hn))),Mi})(ce,pe,Et,St,Ze))return lt===zn?null:lt;for(var Yt=(function(un){var Hn,Xn,Kn=(function(ei){var oi,Sn,Nn,tr,tn=[];for(Sn=0,Nn=ei.length;Sn<Nn;Sn++)((oi=ei[Sn]).left&&oi.inResult||!oi.left&&oi.otherEvent.inResult)&&tn.push(oi);for(var Rn=!1;!Rn;)for(Rn=!0,Sn=0,Nn=tn.length;Sn<Nn;Sn++)Sn+1<Nn&&nt(tn[Sn],tn[Sn+1])===1&&(tr=tn[Sn],tn[Sn]=tn[Sn+1],tn[Sn+1]=tr,Rn=!1);for(Sn=0,Nn=tn.length;Sn<Nn;Sn++)(oi=tn[Sn]).otherPos=Sn;for(Sn=0,Nn=tn.length;Sn<Nn;Sn++)(oi=tn[Sn]).left||(tr=oi.otherPos,oi.otherPos=oi.otherEvent.otherPos,oi.otherEvent.otherPos=tr);return tn})(un),hi={},Mi=[],vi=function(){if(!hi[Hn]){var ei=Mi.length,oi=(function(tn,Rn,wi){var Ri=new ft;if(tn.prevInResult!=null){var ji=tn.prevInResult,Dr=ji.outputContourId;if(ji.resultTransition>0){var zi=Rn[Dr];if(zi.holeOf!=null){var nn=zi.holeOf;Rn[nn].holeIds.push(wi),Ri.holeOf=nn,Ri.depth=Rn[Dr].depth}else Rn[Dr].holeIds.push(wi),Ri.holeOf=Dr,Ri.depth=Rn[Dr].depth+1}else Ri.holeOf=null,Ri.depth=Rn[Dr].depth}else Ri.holeOf=null,Ri.depth=0;return Ri})(Kn[Hn],Mi,ei),Sn=function(tn){hi[tn]=!0,tn<Kn.length&&Kn[tn]&&(Kn[tn].outputContourId=ei)},Nn=Hn,tr=Hn;for(oi.points.push(Kn[Hn].point);Sn(Nn),Sn(Nn=Kn[Nn].otherPos),oi.points.push(Kn[Nn].point),!((Nn=qt(Nn,Kn,hi,tr))==tr||Nn>=Kn.length)&&Kn[Nn];);Mi.push(oi)}};for(Hn=0,Xn=Kn.length;Hn<Xn;Hn++)vi();return Mi})((function(un,Hn,Xn,Kn,hi,Mi){for(var vi,ei,oi,Sn=new s(xt),Nn=[],tr=Math.min(Kn[2],hi[2]);un.length!==0;){var tn=un.pop();if(Nn.push(tn),Mi===T&&tn.point[0]>tr||Mi===D&&tn.point[0]>Kn[2])break;if(tn.left){ei=vi=Sn.insert(tn),vi=vi!==(oi=Sn.minNode())?Sn.prev(vi):null,ei=Sn.next(ei);var Rn=vi?vi.key:null;if(R(tn,Rn,Mi),ei&&rt(tn,ei.key,un)===2&&(R(tn,Rn,Mi),R(ei.key,tn,Mi)),vi&&rt(vi.key,tn,un)===2){var wi=vi;R(Rn,(wi=wi!==oi?Sn.prev(wi):null)?wi.key:null,Mi),R(tn,Rn,Mi)}}else ei=vi=Sn.find(tn=tn.otherEvent),vi&&ei&&(vi=vi!==oi?Sn.prev(vi):null,ei=Sn.next(ei),Sn.remove(tn),ei&&vi&&rt(vi.key,ei.key,un))}return Nn})(Wt,0,0,Et,St,Ze)),mn=[],En=0;En<Yt.length;En++){var Tn=Yt[En];if(Tn.isExterior()){for(var On=[Tn.points],rn=0;rn<Tn.holeIds.length;rn++)On.push(Yt[Tn.holeIds[rn]].points);mn.push(On)}}return mn}var _i={UNION:I,DIFFERENCE:D,INTERSECTION:T,XOR:O};l.diff=function(ce,pe){return _n(ce,pe,D)},l.intersection=function(ce,pe){return _n(ce,pe,T)},l.operations=_i,l.union=function(ce,pe){return _n(ce,pe,I)},l.xor=function(ce,pe){return _n(ce,pe,O)},Object.defineProperty(l,"__esModule",{value:!0})})(rk.exports)),rk.exports);function V1(l,t,s,u){let h=[],m=u===0?(g,v,b,E,T,I)=>{g.push(new st(I,b+(I-v)/(E-v)*(T-b)))}:(g,v,b,E,T,I)=>{g.push(new st(v+(I-b)/(T-b)*(E-v),I))};for(let g of l){let v=[];for(let b of g){if(b.length<=2)continue;let E=[];for(let D=0;D<b.length-1;D++){let O=b[D].x,R=b[D].y,B=b[D+1].x,H=b[D+1].y,$=u===0?O:R,Y=u===0?B:H;$<t?Y>t&&m(E,O,R,B,H,t):$>s?Y<s&&m(E,O,R,B,H,s):E.push(b[D]),Y<t&&$>=t&&m(E,O,R,B,H,t),Y>s&&$<=s&&m(E,O,R,B,H,s)}let T=b[b.length-1],I=u===0?T.x:T.y;I>=t&&I<=s&&E.push(T),E.length&&(T=E[E.length-1],E[0].x===T.x&&E[0].y===T.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function q6(l,t){let s=RI(l),u=RI([t]),h=ok.intersection(s,u);return h==null?[]:sk(h)}function W6(l,t){let u=RI(l,65536),h=[];for(;t.valid();t.next()){let[m,g]=t.get(),v=m.x*65536,b=m.y*65536,E=g.x*65536,T=g.y*65536,I=E-v,D=T-b,O=Math.hypot(I,D);if(O===0)continue;let R=Math.trunc(D/O*3),B=-Math.trunc(I/O*3);h.push([[[v,b],[E,T],[E+R,T+B],[v+R,b+B],[v,b]]])}return h.length>0&&(u=ok.diff(u,h)),sk(u,1/65536)}function RI(l,t=1){return[l.map(s=>s.map(u=>[u.x*t,u.y*t]))]}function sk(l,t=1){return l.map(s=>s.map((u,h)=>{let m=u.map(g=>new st(g[0]*t,g[1]*t).round());return h>0&&m.reverse(),m}))}class kI{constructor(t,s){this.layoutVertexArray=new ou,this.indexArray=new Kr,this.lineIndexArray=new ia,this.triangleSegments=new nr,this.lineSegments=new nr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new ac)}update(t,s,u,h,m,g,v,b){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,P6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,O6.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,s,u,h,m,g,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,u,h,m,g,void 0,v)}}class FI{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new kI(t,!1),this.elevationBufferData=new kI(t,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.hasPattern=PI("fill",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:v,id:b,index:E,sourceLayerIndex:T}of t){let I=this.layers[0]._featureFilter.needGeometry,D=De(v,I);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;let O=m?m.evaluate(D,{},u,s.availableImages):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:T,index:E,geometry:I?D.geometry:_e(v,u,h),patterns:{},sortKey:O};g.push(R)}m&&g.sort((v,b)=>v.sortKey-b.sortKey);for(let v of g){let{geometry:b,index:E,sourceLayerIndex:T}=v;if(this.hasPattern){let I=OI("fill",this.layers,v,this.zoom,this.pixelRatio,s);this.patternFeatures.push(I)}else this.addFeature(v,b,E,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(t[E].feature,b,E,T,this.index)}}update(t,s,u,h,m,g,v){this.bufferData.update(t,s,u,h,m,g,v,this.worldview),this.elevationBufferData.update(t,s,u,h,m,g,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,s,u,h,m,g,v,this.worldview)}addFeatures(t,s,u,h,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,g,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,s,u,h,m,g=[],v,b){let E=Uv(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,E,h,u,b):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(t,u,m,g,h,v,this.worldview),this.elevationBufferData.populatePaintArrays(t,u,m,g,h,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,s,u,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(s,u,h,m,this.worldview))}addElevatedRoadFeature(t,s,u,h,m){let g=new Array,v=ii.getElevationFeature(t,m);if(!v)return void this.addGeometry(s,this.bufferData);{let E=this.clipPolygonsToTile(s,1);E.length>0&&g.push({polygons:E,elevationFeature:v,elevationTileID:u})}let b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},u),featureIndex:h};for(let E of g)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new oa(E.elevationTileID,this.layers,this.zoom,this.lut));let I=E.elevationFeature.isTunnel(),D=0;t.properties.hasOwnProperty(Le)&&(D=+t.properties[Le]);for(let O of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,O,I,E.elevationFeature,D)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));let T=new gi(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,T,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,b)}}addElevatedGeometry(t,s,u,h,m,g){let v={elevation:u,elevationSampler:s,bias:h,index:m,featureInfo:g},[b,E]=this.addGeometry(t,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(t,s,u){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(h=g,m=g));let v=(b,E,T)=>{if(u!=null)if(E.push(b),g!=null)s.elevatedLayoutVertexArray.emplaceBack(g),T.push(g);else{let I=u.elevationSampler.pointElevation(b,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(I),T.push(I),h=Math.min(h,I),m=Math.max(m,I)}};for(let b of t){let E=0;for(let J of b)E+=J.length;let T=s.triangleSegments.prepareSegment(E,s.layoutVertexArray,s.indexArray),I=T.vertexLength,D=[],O=[],R=[],B=[],H=[],$=s.layoutVertexArray.length;for(let J of b){if(J.length===0)continue;J!==b[0]&&O.push(D.length/2);let ie=s.lineSegments.prepareSegment(J.length,s.layoutVertexArray,s.lineIndexArray),he=ie.vertexLength;u&&H.push(s.layoutVertexArray.length-$),v(J[0],R,B),s.layoutVertexArray.emplaceBack(J[0].x,J[0].y),s.lineIndexArray.emplaceBack(he+J.length-1,he),D.push(J[0].x),D.push(J[0].y);for(let le=1;le<J.length;le++)v(J[le],R,B),s.layoutVertexArray.emplaceBack(J[le].x,J[le].y),s.lineIndexArray.emplaceBack(he+le-1,he+le),D.push(J[le].x),D.push(J[le].y);ie.vertexLength+=J.length,ie.primitiveLength+=J.length}let Y=Ig(D,O);for(let J=0;J<Y.length;J+=3)s.indexArray.emplaceBack(I+Y[J],I+Y[J+1],I+Y[J+2]);if(Y.length>0&&u&&this.elevationMode==="hd-road-base"){let J=u.elevation.isTunnel(),ie=u.elevation.safeArea,he=this.elevatedStructures.addVertices(R,B);this.elevatedStructures.addTriangles(Y,he,J);let le=H.length;if(le>0){for(let me=0;me<le-1;me++)this.elevatedStructures.addRenderableRing(u.index,H[me]+he,H[me+1]-H[me],J,ie,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,H[le-1]+he,R.length-H[le-1],J,ie,u.featureInfo)}}T.vertexLength+=E,T.primitiveLength+=Y.length/3}return[h,m]}prepareElevatedPolygons(t,s,u){let h=1/q(u),m=[];for(let g of t){let v=W6(g,new Yn(s,h));m.push(...v)}return m}clipPolygonsToTile(t,s){let u=-s,h=-s,m=yt+s,g=yt+s,v=0,b=[],E=[];for(;v<t.length;v++){let D=t[v],O=tc(D);(O.min.x>=u&&O.max.x<=m&&O.min.y>=h&&O.max.y<=g?b:E).push(D)}if(b.length===t.length)return t;let T=[new st(u,h),new st(m,h),new st(m,g),new st(u,g),new st(u,h)],I=b;for(let D of E)I.push(...q6(D,T));return I}}let ak,lk,ck,uk;Lt(FI,"FillBucket",{omit:["layers","patternFeatures"]}),Lt(kI,"FillBufferData"),Lt(oa,"ElevatedStructures");class U1{constructor(t,s,u,h){if(this.triangleCount=s.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;let[m,g]=[t[0].clone(),t[0].clone()];for(let I=1;I<t.length;++I){let D=t[I];m.x=Math.min(m.x,D.x),m.y=Math.min(m.y,D.y),g.x=Math.max(g.x,D.x),g.y=Math.max(g.y,D.y)}if(h){let I=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/h);u=Math.max(u,I)}if(u===0)return;this.min=m,this.max=g;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let b=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;let E=[];for(let I=0;I<this.triangleCount;I++){let D=t[s[3*I+0]].sub(this.min),O=t[s[3*I+1]].sub(this.min),R=t[s[3*I+2]].sub(this.min),B=uu(Math.floor(Math.min(D.x,O.x,R.x)),this.xScale,this.cellsX),H=uu(Math.floor(Math.max(D.x,O.x,R.x)),this.xScale,this.cellsX),$=uu(Math.floor(Math.min(D.y,O.y,R.y)),this.yScale,this.cellsY),Y=uu(Math.floor(Math.max(D.y,O.y,R.y)),this.yScale,this.cellsY),J=new st(0,0),ie=new st(0,0),he=new st(0,0),le=new st(0,0);for(let me=$;me<=Y;++me){J.y=ie.y=me*b,he.y=le.y=(me+1)*b;for(let ye=B;ye<=H;++ye)J.x=he.x=ye*b,ie.x=le.x=(ye+1)*b,(Qo(D,O,R,J,ie,le)||Qo(D,O,R,J,le,he))&&E.push({cellIdx:me*this.cellsX+ye,triIdx:I})}}if(E.length===0)return;E.sort((I,D)=>I.cellIdx-D.cellIdx||I.triIdx-D.triIdx);let T=0;for(;T<E.length;){let I=E[T].cellIdx,D={start:this.payload.length,len:0};for(;T<E.length&&E[T].cellIdx===I;)++D.len,this.payload.push(E[T++].triIdx);this.cells[I]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,s){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;let u=uu(t.x-this.min.x,this.xScale,this.cellsX),h=uu(t.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+u];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){let v=this.payload[m.start+g],b=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,s.push(v),s.length===this.triangleCount))return}}}query(t,s,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>s.x||t.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();let h=uu(t.x-this.min.x,this.xScale,this.cellsX),m=uu(s.x-this.min.x,this.xScale,this.cellsX),g=uu(t.y-this.min.y,this.yScale,this.cellsY),v=uu(s.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=v;b++)for(let E=h;E<=m;E++){let T=this.cells[b*this.cellsX+E];if(T)for(let I=0;I<T.len;I++){let D=this.payload[T.start+I],O=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[O]&R)&&(this.lookup[O]|=R,u.push(D),u.length===this.triangleCount))return}}}}function uu(l,t,s){return Math.max(0,Math.min(s-1,Math.floor(l*t)))}Lt(U1,"TriangleGridIndex");class dk{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){for(let u of this.footprints)s.push({footprint:u,id:t})}updateAppearances(t,s,u,h){}populate(t,s,u,h){let m=[];for(let{feature:g,id:v,index:b,sourceLayerIndex:E}of t){let T=this.layers[0]._featureFilter.needGeometry,I=De(g,T);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:v,properties:g.properties,type:g.type,sourceLayerIndex:E,index:b,geometry:T?I.geometry:_e(g,u,h),patterns:{}};m.push(D)}for(let g of m){let{geometry:v,index:b,sourceLayerIndex:E}=g;this.addFeature(g,v,b,u,{},s.availableImages,s.brightness),s.featureIndex.insert(t[b].feature,v,b,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,s,u,h,m,g,v){}destroy(){}addFeature(t,s,u,h,m,g=[],v){for(let b of Uv(s,2)){let E=[],T=[],I=[],D=new st(1/0,1/0),O=new st(-1/0,-1/0);for(let H of b)if(H.length!==0){H!==b[0]&&I.push(T.length/2);for(let $=0;$<H.length;$++)T.push(H[$].x),T.push(H[$].y),E.push(H[$]),D.x=Math.min(D.x,H[$].x),D.y=Math.min(D.y,H[$].y),O.x=Math.max(O.x,H[$].x),O.y=Math.max(O.y,H[$].y)}let R=Ig(T,I),B=new U1(E,R,8,256);this.footprints.push({vertices:E,indices:R,grid:B,min:D,max:O})}}}Lt(dk,"ClipBucket",{omit:["layers"]});let Z6=Pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Y6=Pn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),X6=Pn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),K6=Pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Q6=Pn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),J6=Pn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),e8=Pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:t8}=Z6,jv=Number.MAX_SAFE_INTEGER,hk=jv-1;function pk(l,t,s,u){return l.order<t||l.order===jv||!(l.clipMask&s)||(function(h,m){return m.length!==0&&m.find(g=>g===h)===void 0})(u,l.clipScope)}function j1(l,t){return l.x-t.x||l.y-t.y}function fk(l,t){return j1(l.min,t.min)===0&&j1(l.max,t.max)===0}function LI(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function $1(l,t){if(l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==t[s].sourceId||!fk(l[s],t[s])||l[s].order!==t[s].order||l[s].clipMask!==t[s].clipMask||!Kl(l[s].clipScope,t[s].clipScope))return!1;return!0}function mk(l,t,s){let u=1/yt,h=1/(1<<s.canonical.z),m=(t.x*u+s.canonical.x)*h+s.wrap,g=(t.y*u+s.canonical.y)*h;return{min:new st((l.x*u+s.canonical.x)*h+s.wrap,(l.y*u+s.canonical.y)*h),max:new st(m,g)}}function n8(l,t,s){let u=1<<s.canonical.z,h=((t.x-s.wrap)*u-s.canonical.x)*yt,m=(t.y*u-s.canonical.y)*yt;return{min:new st(((l.x-s.wrap)*u-s.canonical.x)*yt,(l.y*u-s.canonical.y)*yt),max:new st(h,m)}}function NI(l,t,s,u,h,m,g){let v=l.indices,b=l.vertices,E=[];for(let T=u;T<u+h;T+=3){let I=t[s[T+0]+m],D=t[s[T+1]+m],O=t[s[T+2]+m],R=Math.min(I.x,D.x,O.x),B=Math.max(I.x,D.x,O.x),H=Math.min(I.y,D.y,O.y),$=Math.max(I.y,D.y,O.y);E.length=0,l.grid.query(new st(R,H),new st(B,$),E);for(let Y=0;Y<E.length;Y++){let J=E[Y];if(Qo(b[v[3*J+0]],b[v[3*J+1]],b[v[3*J+2]],I,D,O,g))return!0}}return!1}function gk(l,t,s,u){if(!l||!s)return!1;let h=l.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(s.vertices.length<l.vertices.length)return gk(s,u,l,t);let m=t.canonical,g=u.canonical,v=Math.pow(2,g.z-m.z);h=l.vertices.map(b=>new st((b.x+m.x*yt)*v-g.x*yt,(b.y+m.y*yt)*v-g.y*yt))}return NI(s,h,l.indices,0,l.indices.length,0,0)}function _k(l,t,s,u){let h=Math.pow(2,u.z-s.z);return new st((l+s.x*yt)*h-u.x*yt,(t+s.y*yt)*h-u.y*yt)}function vk(l,t){let s=[];t.grid.queryPoint(l,s);let u=t.indices,h=t.vertices;for(let m=0;m<s.length;m++){let g=s[m];if(Ti([h[u[3*g+0]],h[u[3*g+1]],h[u[3*g+2]]],l))return!0}return!1}let zI=[new st(0,0),new st(yt,0),new st(yt,yt),new st(0,yt)];function yk(l,t){let s=[],u=[];if(!t||l.length<2)return[l];if(l.length===2)return Lo(l[0],l[1],zI)?[l]:[];for(let h=0;h<l.length+2;h++){let m=l[h%l.length],g=l[(h+1)%l.length],v=Lo(h===0?l[l.length-1]:l[(h-1)%l.length],m,zI),b=Lo(m,g,zI),E=v||b;E&&u.push(m),E&&b||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}let BI=Ce.types,i8=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],r8=["fill-extrusion-flood-light-ground-radius"],o8=Math.pow(2,13),s8=Math.pow(2,15)-1,xk=new st(0,1),xd=2147483648,bk=7,wk=450;function $v(l,t,s,u,h,m,g,v){l.emplaceBack((t<<1)+g,(s<<1)+m,(Math.floor(u*o8)<<1)+h,Math.round(v))}function Hv(l,t,s){l.emplaceBack(t.x*yt,t.y*yt,s?1:0)}function H1(l,t,s,u,h,m){l.emplaceBack(t.x,t.y,(s.x<<1)+u,(s.y<<1)+h,m)}function Gv(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Ck{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Ek{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class Sk{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,s){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=s.x,t.min.y=t.max.y=s.y)}appendEdge(t,s,u){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<t.min.x?(t.min.x=s.x,h=!0):s.x>t.max.x&&(t.max.x=s.x,h=!0),s.y<t.min.y?(t.min.y=s.y,h=!0):s.y>t.max.y&&(t.max.y=s.y,h=!0),((s.x===0||s.x===yt)&&s.x===u.x)!=((s.y===0||s.y===yt)&&s.y===u.y)&&this.processBorderOverlap(s,u),h&&this.checkBorderIntersection(s,u)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,on(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>yt!=t.x>yt&&this.addBorderIntersection(1,on(s.y,t.y,(yt-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,on(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>yt!=t.y>yt&&this.addBorderIntersection(3,on(s.x,t.x,(yt-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[t];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;let u=t.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,t.y)}else{let u=t.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0):0}}function Tk(l,t){let s=l.add(t)._unit(),u=G(l.x*s.x+l.y*s.y,-1,1);var h,m,g;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*s8*((m=l).x*(g=t).y-m.y*g.x<0?-1:1)}let a8=[l=>l.x<0,l=>l.x>yt,l=>l.y<0,l=>l.y>yt];function l8(l,t,s,u){let h=[4];if(u===0)return h;s._mult(u);let m=l.sub(s),g=t.sub(s),v=[l,t,m,g];for(let b=0;b<4;b++)for(let E of v)if(a8[b](E)){h.push(b);break}return h}class VI{constructor(t){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new _v,this.indexArray=new Kr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut},s=>r8.includes(s)),this._segments=new nr,this.hiddenByLandmarkVertexArray=new mg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new nr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,s,u,h=!1){let m=t.length;if(m>2){let g=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let E=t[0],T=t[1];b=Tk(E.sub(t[m-1])._perp()._unit(),T.sub(E)._perp()._unit())}for(let E=0;E<m;E++){let T=E===m-1?0:E+1,I=t[E],D=t[T],O=t[T===m-1?0:T+1],R=D.sub(I)._perp()._unit(),B=Tk(R,O.sub(D)._perp()._unit()),H=b,$=B;if(UI(I,D,s)||h&&Dk(I,s)&&Dk(D,s)){b=B;continue}let Y=v.vertexLength;H1(this.vertexArray,I,D,1,1,H),H1(this.vertexArray,I,D,1,0,H),H1(this.vertexArray,I,D,0,1,$),H1(this.vertexArray,I,D,0,0,$),v.vertexLength+=4;let J=l8(I,D,R,u);for(let ie of J)this._segmentToGroundQuads[g].push({id:Y,region:ie}),this._segmentToRegionTriCounts[g][ie]+=2,v.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),s=t.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((h,m)=>h.region-m.region);for(let u=0;u<s;u++){let h=this._segmentToGroundQuads[u],m=t[u],g=this._segmentToRegionTriCounts[u];g.reduce((b,E)=>b+E,0);let v=0;for(let b=0;b<=4;b++){let E=g[b];if(E!==0){let T=this.regionSegments[b];T||(T=this.regionSegments[b]=new nr);let I={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:E};T.get().push(I)}v+=E}for(let b=0;b<h.length;b++){let E=h[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,s,u,h,m,g,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,s,u,h,m,g,void 0,v)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Y6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=t.createVertexBuffer(this.groundRadiusArray,X6.members)))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,s,u,h,m,g,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(t,s,u,h,m,g,v,b)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&xd))}updateHiddenByLandmarkRange(t,s,u){if(!this.hasData())return;let h=s+t;if(s!==0){for(let m=t;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,J6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let s=this.regionSegments[t];s&&s.destroy()}}}}class G1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Kr,this.footprintVertices=new ou,this.footprintSegments=[],this.layoutVertexArray=new ph,this.centroidVertexArray=new O1,this.wallVertexArray=new $p,this.indexArray=new Kr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut},s=>i8.includes(s)),this.segments=new nr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new VI(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.features=[],this.hasPattern=PI("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=q(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:m,id:g,index:v,sourceLayerIndex:b}of t){let E=this.layers[0]._featureFilter.needGeometry,T=De(m,E);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),T,u))continue;let I={id:g,sourceLayerIndex:b,index:v,geometry:E?T.geometry:_e(m,u,h),properties:m.properties,type:m.type,patterns:{}},D=this.layoutVertexArray.length,O=BI[I.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:OI("fill-extrusion",this.layers,I,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(let R of I.geometry)for(let B of yk(R,O))this.addFeature(m.id,I,[B],v,u,{},s.availableImages,h,s.brightness);else this.addFeature(m.id,I,I.geometry,v,u,{},s.availableImages,h,s.brightness);s.featureIndex.insert(m,I.geometry,v,b,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,s,u,h,m,g){for(let{featureId:v,feature:b}of this.features){let E=BI[b.type]==="Polygon",{geometry:T}=b;if(this.wallMode)for(let I of T)for(let D of yk(I,E))this.addFeature(v,b,[D],b.index,s,u,h,m,g);else this.addFeature(v,b,T,b.index,s,u,h,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview),this.groundEffect.update(t,s,m,u,h,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,t8),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,Q6.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,e8.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,K6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,u,h,m,g,v,b,E){let T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,I=[new st(0,0),new st(yt,yt)],D=b.projection,O=D.name==="globe",R=this.wallMode||BI[s.type]==="Polygon",B=new Sk;B.centroidDataIndex=this.centroidData.length;let H=new Ek;H.buildingId=t,s.properties&&s.properties.hasOwnProperty("building_id")&&(H.buildingId=s.properties.building_id);let $=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},m)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},m),J;if(H.height=Y,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cg),this.wallMode){if(O)return void Pt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;J=(function(Ae){let We=Ae[0].x===Ae[Ae.length-1].x&&Ae[0].y===Ae[Ae.length-1].y;(function(Rt){let Bt=0,In=Rt.length;for(let mt=0;mt<In;mt++)Bt+=(Rt[(mt+1)%In].x-Rt[mt].x)*(Rt[(mt+1)%In].y+Rt[mt].y);return Bt>=0})(Ae)||(Ae=Ae.reverse());let Qe={geometry:[],joinNormals:[],indices:[]},at=[],ct=[],nt=[],it=Ae.length;for(;it>=2&&Ae[it-1].equals(Ae[it-2]);)it--;if(it<(We?3:2))return Qe;let qe,He,rt,xt,ft,qt=0;for(;qt<it-1&&Ae[qt].equals(Ae[qt+1]);)qt++;We&&(qe=Ae[it-2],ft=Ae[qt].sub(qe)._unit()._perp());for(let Rt=qt;Rt<it;Rt++){if(rt=Rt===it-1?We?Ae[qt+1]:void 0:Ae[Rt+1],rt&&Ae[Rt].equals(rt))continue;ft&&(xt=ft),qe&&(He=qe),qe=Ae[Rt],ft=rt?rt.sub(qe)._unit()._perp():xt,xt=xt||ft;let Bt=xt.add(ft);Bt.x===0&&Bt.y===0||Bt._unit();let In=Bt.x*ft.x+Bt.y*ft.y,mt=In!==0?1/In:1/0,Ut=xt.x*ft.y-xt.y*ft.x>0,dn="miter",Ln=2;dn==="miter"&&mt>Ln&&(dn="bevel"),dn==="bevel"&&(mt>100&&(dn="flipbevel"),mt<Ln&&(dn="miter"));let zn=(_n,_i,ce,pe)=>{let Ze=new st(_n.x,_n.y),lt=new st(_n.x,_n.y);Ze.x+=_i.x*pe,Ze.y+=_i.y*pe,lt.x-=_i.x*Math.max(ce,1),lt.y-=_i.y*Math.max(ce,1),nt.push(_i),at.push(Ze),ct.push(lt)};if(dn==="miter")Bt._mult(mt),zn(qe,Bt,0,0);else if(dn==="flipbevel")Bt=ft.mult(-1),zn(qe,Bt,0,0),zn(qe,Bt.mult(-1),0,0);else{let _n=-Math.sqrt(mt*mt-1),_i=Ut?_n:0,ce=Ut?0:_n;He&&zn(qe,xt,_i,ce),rt&&zn(qe,ft,_i,ce)}}Qe.geometry=[...at,...ct.reverse(),at[0]],Qe.joinNormals=[...nt,...nt.reverse(),nt[nt.length-1]];let It=Qe.geometry.length-1;for(let Rt=0;Rt<It/2;Rt++)if(Rt+1<It/2){let Bt=Rt,In=Rt+1,mt=It-1-Rt,Ut=It-2-Rt;Bt=Bt===0?It-1:Bt-1,In=In===0?It-1:In-1,mt=mt===0?It-1:mt-1,Ut=Ut===0?It-1:Ut-1,Qe.indices.push(mt),Qe.indices.push(In),Qe.indices.push(Bt),Qe.indices.push(mt),Qe.indices.push(Ut),Qe.indices.push(In)}return Qe})(u[0]),u=[J.geometry]}let ie=(Ae,We)=>Ae<(We.length-1)/2||Ae===We.length-1,he=this.wallMode?[u]:Uv(u,500);for(let Ae=he.length-1;Ae>=0;Ae--){let We=he[Ae];(We.length===0||(le=We[0]).every(Ke=>Ke.x<=0)||le.every(Ke=>Ke.x>=yt)||le.every(Ke=>Ke.y<=0)||le.every(Ke=>Ke.y>=yt))&&he.splice(Ae,1)}var le;let me;if(O)me=Rk(he,I,m);else{me=[];for(let Ae of he)me.push({polygon:Ae,bounds:I})}let ye=R?this.edgeRadius:0,we=ye>0&&this.zoom<17,je=(Ae,We)=>{if(Ae.length===0)return!1;let Ke=Ae[Ae.length-1];return We.x===Ke.x&&We.y===Ke.y};for(let{polygon:Ae,bounds:We}of me){let Ke=0,Qe=0;for(let it of Ae)R&&!it[0].equals(it[it.length-1])&&it.push(it[0]),Qe+=R?it.length-1:it.length;let at=this.segments.prepareSegment((R?5:4)*Qe,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);let ct={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},nt=new Ck;if(nt.vertexOffset=this.footprintVertices.length,nt.indexOffset=3*this.footprintIndices.length,nt.ringIndices=[],R){let it=[],qe=[];Ke=at.vertexLength;for(let rt=0;rt<Ae.length;rt++){let xt=Ae[rt];xt.length&&rt!==0&&qe.push(it.length/2);let ft=[],qt,It;qt=xt[1].sub(xt[0])._perp()._unit(),nt.ringIndices.push(xt.length-1);for(let Rt=1;Rt<xt.length;Rt++){let Bt=xt[Rt],In=xt[Rt===xt.length-1?1:Rt+1],mt=Bt.clone();if(ye){It=In.sub(Bt)._perp()._unit();let Ut=qt.add(It)._unit(),dn=ye*Math.min(4,1/(qt.x*Ut.x+qt.y*Ut.y));mt.x+=dn*Ut.x,mt.y+=dn*Ut.y,mt.x=Math.round(mt.x),mt.y=Math.round(mt.y),qt=It}if(!$||ye!==0&&!we||je(ft,mt)||ft.push(mt),$v(this.layoutVertexArray,mt.x,mt.y,0,0,1,1,0),this.wallMode){let Ut=ie(Rt,xt);Hv(this.wallVertexArray,J.joinNormals[Rt],!Ut)}at.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),it.push(Bt.x,Bt.y),O&&Gv(this.layoutVertexExtArray,D.projectTilePoint(mt.x,mt.y,m),D.upVector(m,mt.x,mt.y))}$&&(ye===0||we)&&(ft.length!==0&&je(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,We,T))}let He=this.wallMode?J.indices:Ig(it,qe);for(let rt=0;rt<He.length;rt+=3)this.footprintIndices.emplaceBack(nt.vertexOffset+He[rt+0],nt.vertexOffset+He[rt+1],nt.vertexOffset+He[rt+2]),this.indexArray.emplaceBack(Ke+He[rt],Ke+He[rt+2],Ke+He[rt+1]),at.primitiveLength++;nt.indexCount+=He.length,nt.vertexCount+=this.footprintVertices.length-nt.vertexOffset}for(let it=0;it<Ae.length;it++){let qe=Ae[it];B.startRing(H,qe[0]);let He=qe.length>4&&Ak(qe[qe.length-2],qe[0],qe[1]),rt=ye?c8(qe[qe.length-2],qe[0],qe[1],ye):0,xt=[],ft,qt,It;qt=qe[1].sub(qe[0])._perp()._unit();let Rt=!0;for(let Bt=1,In=0;Bt<qe.length;Bt++){let mt=qe[Bt-1],Ut=qe[Bt],dn=qe[Bt===qe.length-1?1:Bt+1];if(B.appendEdge(H,Ut,mt),UI(Ut,mt,We)){ye&&(qt=dn.sub(Ut)._perp()._unit(),Rt=!Rt);continue}let Ln=Ut.sub(mt)._perp(),zn=Ln.x/(Math.abs(Ln.x)+Math.abs(Ln.y)),_n=Ln.y>0?1:0,_i=mt.dist(Ut);if(In+_i>32768&&(In=0),ye){It=dn.sub(Ut)._perp()._unit();let lt=Mk(mt,Ut,dn,Ik(qt,It),ye);isNaN(lt)&&(lt=0);let Et=Ut.sub(mt)._unit();mt=mt.add(Et.mult(rt))._round(),Ut=Ut.add(Et.mult(-lt))._round(),rt=lt,qt=It,$&&this.zoom>=17&&(je(xt,mt)||xt.push(mt),je(xt,Ut)||xt.push(Ut))}let ce=at.vertexLength,pe=qe.length>4&&Ak(mt,Ut,dn),Ze=Pk(In,He,Rt);if($v(this.layoutVertexArray,mt.x,mt.y,zn,_n,0,0,Ze),$v(this.layoutVertexArray,mt.x,mt.y,zn,_n,0,1,Ze),this.wallMode){let lt=ie(Bt-1,qe),Et=J.joinNormals[Bt-1];Hv(this.wallVertexArray,Et,lt),Hv(this.wallVertexArray,Et,lt)}if(In+=_i,Ze=Pk(In,pe,!Rt),He=pe,$v(this.layoutVertexArray,Ut.x,Ut.y,zn,_n,0,0,Ze),$v(this.layoutVertexArray,Ut.x,Ut.y,zn,_n,0,1,Ze),this.wallMode){let lt=ie(Bt,qe),Et=J.joinNormals[Bt];Hv(this.wallVertexArray,Et,lt),Hv(this.wallVertexArray,Et,lt)}if(at.vertexLength+=4,this.indexArray.emplaceBack(ce+0,ce+1,ce+2),this.indexArray.emplaceBack(ce+1,ce+3,ce+2),at.primitiveLength+=2,ye){let lt=Ke+(Bt===1?qe.length-2:Bt-2),Et=Bt===1?Ke:lt+1;if(this.indexArray.emplaceBack(ce+1,lt,ce+3),this.indexArray.emplaceBack(lt,Et,ce+3),at.primitiveLength+=2,ft===void 0&&(ft=ce),!UI(dn,qe[Bt],We)){let St=Bt===qe.length-1?ft:at.vertexLength;this.indexArray.emplaceBack(ce+2,ce+3,St),this.indexArray.emplaceBack(ce+3,St+1,St),this.indexArray.emplaceBack(ce+3,Et,St+1),at.primitiveLength+=3}Rt=!Rt}if(O){let lt=this.layoutVertexExtArray,Et=D.projectTilePoint(mt.x,mt.y,m),St=D.projectTilePoint(Ut.x,Ut.y,m),Wt=D.upVector(m,mt.x,mt.y),Yt=D.upVector(m,Ut.x,Ut.y);Gv(lt,Et,Wt),Gv(lt,Et,Wt),Gv(lt,St,Yt),Gv(lt,St,Yt)}}R&&(Ke+=qe.length-1),$&&ye&&this.zoom>=17&&(xt.length!==0&&je(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,We,T,ye>0))}this.footprintSegments.push(nt),ct.triangleCount=this.indexArray.length-ct.triangleArrayOffset,this.polygonSegments.push(ct),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=B.borders?xk:this.encodeCentroid(B,H),this.centroidData.push(H),B.borders){this.featuresOnBorder.push(B);let Ae=this.featuresOnBorder.length-1;for(let We=0;We<B.borders.length;We++)B.borders[We][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[We].push(Ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,g,v,m,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,h,g,v,m,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((s,u)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}splitToSubtiles(){let t=[];for(let v=0;v<this.centroidData.length;v++){let b=this.centroidData[v],E=+(b.min.y+b.max.y>yt),T=2*E+(+(b.min.x+b.max.x>yt)^E);for(let I=0;I<b.polygonSegLen;I++){let D=b.polygonSegIdx+I;t.push({centroidIdx:v,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let s=new Kr;t.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let u=0,h=0,m=0;for(let v of t){if(v.triangleSegmentIdx!==u)break;m++}let g=t.length;for(;h!==t.length;){u=t[h].triangleSegmentIdx;let v=0,b=h,E=h;for(let T=b;T<m&&t[T].subtile===v;T++)E++;for(;b!==m;){let T=t[b];v=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=b;R<E;R++){let B=t[R],H=this.polygonSegments[B.polygonSegmentIdx],$=this.centroidData[B.centroidIdx].min,Y=this.centroidData[B.centroidIdx].max,J=this.indexArray.uint16;for(let ie=H.triangleArrayOffset;ie<H.triangleArrayOffset+H.triangleCount;ie++)s.emplaceBack(J[3*ie],J[3*ie+1],J[3*ie+2]);O.primitiveLength+=H.triangleCount,I.x=Math.min(I.x,$.x),I.y=Math.min(I.y,$.y),D.x=Math.max(D.x,Y.x),D.y=Math.max(D.y,Y.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:I,max:D}),b=E;for(let R=b;R<m&&t[R].subtile===t[b].subtile;R++)E++}h=m;for(let T=h;T<g&&t[T].triangleSegmentIdx===t[h].triangleSegmentIdx;T++)m++}s._trim(),this.indexArray=s}getVisibleSegments(t,s,u){let h=new nr;if(this.wallMode){for(let B of this.triangleSubSegments)h.segments.push(B.segment);return h}let m=0,g=0,v=1<<t.canonical.z;if(s){let B=s.getMinMaxForTile(t);B&&(m=B.min,g=B.max)}g+=this.maxHeight;let b=t.toUnwrapped(),E,T=[b.canonical.x/v+b.wrap,b.canonical.y/v],I=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],D=(B,H,$)=>[B[0]*(1-$[0])+H[0]*$[0],B[1]*(1-$[1])+H[1]*$[1]],O=[],R=[];for(let B of this.triangleSubSegments){O[0]=B.min.x/yt,O[1]=B.min.y/yt,R[0]=B.max.x/yt,R[1]=B.max.y/yt;let H=D(T,I,O),$=D(T,I,R);if(new $t([H[0],H[1],m],[$[0],$[1],g]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}let Y=B.segment;E&&E.vertexOffset!==Y.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=Y.vertexLength,E.primitiveLength+=Y.primitiveLength):E={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(t,s){let u=t.centroid(),h=s.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new st(G(u.x,1,yt-1)<<3|m,G(u.y,1,yt-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new st(0,0);let s=t.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){let h=s[0][0]!==u?0:1;return new st(6|(s[0][0]!==u?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{let h=s[2][0]!==u?2:3;return new st((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(t){let s=this.centroidData[t.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let s=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,h=t.flags&xd?xk:t.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||m!==h.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let h=s.getReplacementRegionsForTile(t.toUnwrapped());if($1(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let g of this.centroidData)g.flags&=2147483647;let m=[];for(let g of this.activeReplacements){if(g.order<u)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));if(g.footprint.buildingIds)for(let b of this.centroidData)b.flags&xd||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y||g.footprint.buildingIds.has(b.buildingId)&&(b.flags|=xd);else for(let b of this.centroidData)if(!(b.flags&xd||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y))for(let E=0;E<b.footprintSegLen;E++){let T=this.footprintSegments[b.footprintSegIdx+E];if(m.length=0,u8(this.footprintVertices,T.vertexOffset,T.vertexCount,g.footprintTileId.canonical,t.canonical,m),NI(g.footprint,m,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-v)){b.flags|=xd;break}}}for(let g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,s,u){let h=!1;for(let m=0;m<u.footprintSegLen;m++){let g=this.footprintSegments[u.footprintSegIdx+m],v=0;for(let b of g.ringIndices){for(let E=v,T=b+v-1;E<b+v;T=E++){let I=this.footprintVertices.int16[2*(E+g.vertexOffset)+0],D=this.footprintVertices.int16[2*(E+g.vertexOffset)+1],O=this.footprintVertices.int16[2*(T+g.vertexOffset)+1];D>s!=O>s&&t<(this.footprintVertices.int16[2*(T+g.vertexOffset)+0]-I)*(s-D)/(O-D)+I&&(h=!h)}v=b}}return h}getHeightAtTileCoord(t,s){let u=Number.NEGATIVE_INFINITY,h=!0,m=4*(t+yt)*yt+(s+yt);if(this.partLookup.hasOwnProperty(m)){let g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&xd)}:void 0}for(let g of this.centroidData)t>g.max.x||g.min.x>t||s>g.max.y||g.min.y>s||g.height<=u||this.footprintContainsPoint(t,s,g)&&(u=g.height,this.partLookup[m]=g,h=!!(g.flags&xd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[m]=void 0}}function Ik(l,t){let s=l.add(t)._unit();return l.x*s.x+l.y*s.y}function c8(l,t,s,u){let h=t.sub(l)._perp()._unit(),m=s.sub(t)._perp()._unit();return Mk(l,t,s,Ik(h,m),u)}function Mk(l,t,s,u,h){let m=Math.sqrt(1-u*u);return Math.min(l.dist(t)/3,t.dist(s)/3,h*m/u)}function UI(l,t,s){return l.x<s[0].x&&t.x<s[0].x||l.x>s[1].x&&t.x>s[1].x||l.y<s[0].y&&t.y<s[0].y||l.y>s[1].y&&t.y>s[1].y}function Dk(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function Ak(l,t,s){if(l.x<0||l.x>=yt||t.x<0||t.x>=yt||s.x<0||s.x>=yt)return!1;let u=s.sub(t),h=u.perp(),m=l.sub(t);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function Pk(l,t,s){let u=t?2|l:-3&l;return s?1|u:-2&u}function Ok(){let l=Math.PI/32,t=Math.tan(l),s=p;return s*Math.sqrt(1+2*t*t)-s}function Rk(l,t,s){let u=1<<s.z,h=A(s.x/u),m=A((s.x+1)/u),g=L(s.y/u),v=L((s.y+1)/u);return(function(b,E,T,I,D=0,O){let R=[];if(!b.length||!T||!I)return R;let B=(le,me)=>{for(let ye of le)R.push({polygon:ye,bounds:me})},H=Math.ceil(Math.log2(T)),$=Math.ceil(Math.log2(I)),Y=H-$,J=[];for(let le=0;le<Math.abs(Y);le++)J.push(Y>0?0:1);for(let le=0;le<Math.min(H,$);le++)J.push(0),J.push(1);let ie=b;if(ie=V1(ie,E[0].y-D,E[1].y+D,1),ie=V1(ie,E[0].x-D,E[1].x+D,0),!ie.length)return R;let he=[];for(J.length?he.push({polygons:ie,bounds:E,depth:0}):B(ie,E);he.length;){let le=he.pop(),me=le.depth,ye=J[me],we=le.bounds[0],je=le.bounds[1],Ae=ye===0?we.x:we.y,We=ye===0?je.x:je.y,Ke=O?O(ye,Ae,We):.5*(Ae+We),Qe=V1(le.polygons,Ae-D,Ke+D,ye),at=V1(le.polygons,Ke-D,We+D,ye);if(Qe.length){let ct=[we,new st(ye===0?Ke:je.x,ye===1?Ke:je.y)];J.length>me+1?he.push({polygons:Qe,bounds:ct,depth:me+1}):B(Qe,ct)}if(at.length){let ct=[new st(ye===0?Ke:we.x,ye===1?Ke:we.y),je];J.length>me+1?he.push({polygons:at,bounds:ct,depth:me+1}):B(at,ct)}}return R})(l,t,Math.ceil((m-h)/11.25),Math.ceil((g-v)/11.25),1,(b,E,T)=>{if(b===0)return .5*(E+T);{let I=L((s.y+E/yt)/u);return(S(.5*(L((s.y+T/yt)/u)+I))*u-s.y)*yt}})}function u8(l,t,s,u,h,m){let g=Math.pow(2,u.z-h.z);for(let v=0;v<s;v++){let b=l.int16[2*(v+t)+0],E=l.int16[2*(v+t)+1];b=(b+h.x*yt)*g-u.x*yt,E=(E+h.y*yt)*g-u.y*yt,m.push(new st(b,E))}}let kk,Fk;Lt(G1,"FillExtrusionBucket",{omit:["layers","features"]}),Lt(Ek,"PartData"),Lt(Ck,"FootprintSegment"),Lt(Sk,"BorderCentroidData"),Lt(VI,"GroundEffect");class Jp extends st{constructor(t,s,u){super(t,s),this.z=u}}class Lk extends Jp{constructor(t,s,u,h){super(t,s,u),this.w=h}}function Nk(l,t,s,u){let h=s==="x"?"y":"x",m=(u-l[s])/(t[s]-l[s]);l[h]=Math.round(l[h]+(t[h]-l[h])*m),l[s]=u,l.hasOwnProperty("z")&&(l.z=on(l.z,t.z,m)),l.hasOwnProperty("w")&&(l.w=on(l.w,t.w,m))}function zk(l,t,s,u){let h=s,m=u;for(let g of["x","y"]){let v=l,b=t;v[g]>=b[g]&&(v=t,b=l),v[g]<h&&b[g]>h&&Nk(v,b,g,h),v[g]<m&&b[g]>m&&Nk(b,v,g,m)}}function q1(l,t,s,u,h,m){let g=[];for(let v=0;v<l.length;v++){let b=l[v],E,T=g.length,I=0;for(let D=0;D<b.length-1;D++){let O=b[D],R=b[D+1],B=0,H=I,$,Y;m&&(B=Math.hypot(R.x-O.x,R.y-O.y),I+=B,$=O,Y=R),O.x<t&&R.x<t||(O.x<t?O=new st(t,O.y+(t-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x<t&&(R=new st(t,O.y+(t-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y<s&&R.y<s||(O.y<s?O=new st(O.x+(s-O.y)/(R.y-O.y)*(R.x-O.x),s)._round():R.y<s&&(R=new st(O.x+(s-O.y)/(R.y-O.y)*(R.x-O.x),s)._round()),O.x>=u&&R.x>=u||(O.x>=u?O=new st(u,O.y+(u-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x>=u&&(R=new st(u,O.y+(u-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y>=h&&R.y>=h||(O.y>=h?O=new st(O.x+(h-O.y)/(R.y-O.y)*(R.x-O.x),h)._round():R.y>=h&&(R=new st(O.x+(h-O.y)/(R.y-O.y)*(R.x-O.x),h)._round()),E&&O.equals(E[E.length-1])||(E=[O],g.push(E),m&&m.push({progress:{min:H+Bk($,Y,O)*B,max:1},parentIndex:v,prevPoint:$,nextPoint:Y})),E.push(R),m&&(m[m.length-1].progress.max=H+Bk($,Y,R)*B,m[m.length-1].nextPoint=Y)))))}if(m&&I>0)for(let D=T;D<g.length;D++)m[D].progress.min/=I,m[D].progress.max/=I}return g}function d8(l,t,s,u,h){if(l.length<2)return void u.push(l);let m=[];for(;t.valid();){let[E,T]=t.get();for(let I=0;I<l.length-1;I++){let D=l[I],O=l[I+1],R=Cn(D,O,E,T);if(R){let[B]=R,H=new st(on(D.x,O.x,B),on(D.y,O.y,B));m.push({t:I+B,distance:0,point:H})}}t.next()}if(m.length===0)return void u.push(l);m.sort((E,T)=>E.t-T.t);let g=0,v=0,b=[];for(u.push(b);g!==l.length;){if(v===m.length){for(;g!==l.length;)b.length!==0&&b[b.length-1].equals(l[g])||b.push(l[g]),g++;break}m[v].t<=g?(b.length!==0&&b[b.length-1].equals(m[v].point)||b.push(m[v].point),Math.trunc(m[v].t),v++):(b.length!==0&&b[b.length-1].equals(l[g])||b.push(l[g]),g++)}}function Bk(l,t,s){return l.x!==t.x?(s.x-l.x)/(t.x-l.x):l.y!==t.y?(s.y-l.y)/(t.y-l.y):0}function qv(l,t){return l.x*t.x+l.y*t.y}function Vk(l,t){if(l.length===1){let s=0,u=t[s++],h;for(;!h||u.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){let m=t[s],g=l[0],v=h.sub(u),b=m.sub(u),E=g.sub(u),T=qv(v,v),I=qv(v,b),D=qv(b,b),O=qv(E,v),R=qv(E,b),B=T*D-I*I,H=(D*O-I*R)/B,$=(T*R-I*O)/B,Y=u.z*(1-H-$)+h.z*H+m.z*$;if(isFinite(Y))return Y}return 1/0}{let s=1/0;for(let u of t)s=Math.min(s,u.z);return s}}function Uk(l,t,s){let u=1/0;ti(s,t)&&(u=Vk(s,t[0]));for(let h=0;h<t.length;h++){let m=t[h],g=l[h];for(let v=0;v<m.length-1;v++){let b=m[v],E=[b,m[v+1],g[v+1],g[v],b];Wn(s,E)&&(u=Math.min(u,Vk(s,E)))}}return u!==1/0&&u}function jk(l,t,s,u,h,m,g,v,b,E,T){return l.projection.name==="globe"?(function(I,D,O,R,B,H,$,Y,J,ie,he){let le=[],me=[],ye=I.projection.upVectorScale(he,I.center.lat,I.worldSize).metersToTile,we=[0,0,0,1],je=[0,0,0,1],Ae=(Ke,Qe,at,ct)=>{Ke[0]=Qe,Ke[1]=at,Ke[2]=ct,Ke[3]=1},We=Ok();O>0&&(O+=We),R+=We;for(let Ke of D){let Qe=[],at=[];for(let ct of Ke){let nt=ct.x+B.x,it=ct.y+B.y,qe=I.projection.projectTilePoint(nt,it,he),He=I.projection.upVector(he,ct.x,ct.y),rt=O,xt=R;if($){let ft=$k(nt,it,O,R,$,Y,J,ie);rt+=ft.base,xt+=ft.top}O!==0?Ae(we,qe.x+He[0]*ye*rt,qe.y+He[1]*ye*rt,qe.z+He[2]*ye*rt):Ae(we,qe.x,qe.y,qe.z),Ae(je,qe.x+He[0]*ye*xt,qe.y+He[1]*ye*xt,qe.z+He[2]*ye*xt),Fr(we,we,H),Fr(je,je,H),Qe.push(new Jp(we[0],we[1],we[2])),at.push(new Jp(je[0],je[1],je[2]))}le.push(Qe),me.push(at)}return[le,me]})(l,t,s,u,h,m,g,v,b,E,T):g?(function(I,D,O,R,B,H,$,Y,J){let ie=[],he=[],le=[0,0,0,1];for(let me of I){let ye=[],we=[];for(let je of me){let Ae=je.x+R.x,We=je.y+R.y,Ke=$k(Ae,We,D,O,H,$,Y,J);le[0]=Ae,le[1]=We,le[2]=Ke.base,le[3]=1,Zo(le,le,B),le[3]=Math.max(le[3],1e-5);let Qe=new Jp(le[0]/le[3],le[1]/le[3],le[2]/le[3]);le[0]=Ae,le[1]=We,le[2]=Ke.top,le[3]=1,Zo(le,le,B),le[3]=Math.max(le[3],1e-5);let at=new Jp(le[0]/le[3],le[1]/le[3],le[2]/le[3]);ye.push(Qe),we.push(at)}ie.push(ye),he.push(we)}return[ie,he]})(t,s,u,h,m,g,v,b,E):(function(I,D,O,R,B){let H=[],$=[],Y=B[8]*D,J=B[9]*D,ie=B[10]*D,he=B[11]*D,le=B[8]*O,me=B[9]*O,ye=B[10]*O,we=B[11]*O;for(let je of I){let Ae=[],We=[];for(let Ke of je){let Qe=Ke.x+R.x,at=Ke.y+R.y,ct=B[0]*Qe+B[4]*at+B[12],nt=B[1]*Qe+B[5]*at+B[13],it=B[2]*Qe+B[6]*at+B[14],qe=B[3]*Qe+B[7]*at+B[15],He=ct+Y,rt=nt+J,xt=it+ie,ft=Math.max(qe+he,1e-5),qt=ct+le,It=nt+me,Rt=it+ye,Bt=Math.max(qe+we,1e-5);Ae.push(new Jp(He/ft,rt/ft,xt/ft)),We.push(new Jp(qt/Bt,It/Bt,Rt/Bt))}H.push(Ae),$.push(We)}return[H,$]})(t,s,u,h,m)}function $k(l,t,s,u,h,m,g,v){let b=g*h.getElevationAt(l,t,!0,!0),E=m[0]!==0,T=E?m[1]===0?g*(m[0]/bk-wk):g*(function(I,D,O){let R=Math.floor(D[0]/8),B=Math.floor(D[1]/8),H=10*(D[0]-8*R),$=10*(D[1]-8*B),Y=I.getElevationAt(R,B,!0,!0),J=I.getMeterToDEM(O),ie=Math.floor(.5*(H*J-1)),he=Math.floor(.5*($*J-1)),le=I.tileCoordToPixel(R,B),me=2*ie+1,ye=2*he+1,we=(function(at,ct,nt,it,qe){return[at.getElevationAtPixel(ct,nt,!0),at.getElevationAtPixel(ct+qe,nt,!0),at.getElevationAtPixel(ct,nt+qe,!0),at.getElevationAtPixel(ct+it,nt+qe,!0)]})(I,le.x-ie,le.y-he,me,ye),je=Math.abs(we[0]-we[1]),Ae=Math.abs(we[2]-we[3]),We=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Ke=Math.min(.25,.5*J*(je+Ae)/me),Qe=Math.min(.25,.5*J*We/ye);return Y+Math.max(Ke*H,Qe*$)})(h,m,v):b;return{base:b+(s===0?-1:s),top:E?Math.max(T+u,b+s+2):b+u}}class h8{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class p8{constructor(){this.tasks={},this.taskQueue=[],Pe(["process"],this),this.invoker=new h8(this.process),this.nextId=0}add(t,s){let u=this.nextId++,h=(function({type:m,isSymbolTile:g,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-v:m==="maybePrepare"&&g?400-v:500:200-v:100-v})(s);if(h===0){try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:s,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){let m=this.tasks[this.taskQueue[h]];m.priority<s&&(s=m.priority,t=h)}if(t===null)return null;let u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class Hk{constructor(t,s,u){this.target=t,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Pe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new p8}send(t,s,u,h,m=!1,g){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[v]=u);let b=new Set;return this.target.postMessage({id:v,type:t,hasCallback:!!u,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:ic(s,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){let s=t.data;if(!s)return;let u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){let h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(s.mustQueue||Un(self)){let h=this.callbacks[u],m=this.scheduler.add(()=>this.processTask(u,s),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,s)}processTask(t,s){if(delete this.cancelCallbacks[t],s.type==="<response>"){let u=this.callbacks[t];delete this.callbacks[t],u&&(s.error?u(ru(s.error)):u(null,ru(s.data)))}else{let u=new Set,h=s.hasCallback?(g,v)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?ic(g):null,data:ic(v,u)},u)}:()=>{},m=ru(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,m,h);else if(this.parent.getWorkerSource){let g=s.type.split("."),{source:v,scope:b}=m;this.parent.getWorkerSource(s.sourceMapId,g[0],v,b)[g[1]](m,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Wv={workerUrl:"",workerClass:null,workerParams:void 0};let jI="mapboxgl_preloaded_worker_pool",W1=(()=>{class l{constructor(s){this.active={},this.name=s}acquire(s,u=l.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;){let m=(h=`${this.name||""}WorkerPool: ${s}-${this.workers.length}`,Wv.workerClass!=null?new Wv.workerClass:new self.Worker(Wv.workerUrl,Object.assign({name:h},Wv.workerParams)));this.workers.push(m)}var h;return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jI]}numActive(){return Object.keys(this.active).length}}return l.workerCount=2,l})();class Dg{constructor(t,s,u="Worker",h=W1.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Ie();let m=this.workerPool.acquire(this.id,h);for(let g=0;g<m.length;g++){let v=new Dg.Actor(m[g],s,this.id);v.name=`${u} ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,u){xe(this.actors,(h,m)=>{h.send(t,s,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Zv,$I;function Z1(){return Zv||(Zv=new W1),Zv}Dg.Actor=Hk;let HI=4096;class f8{constructor(t){this.module=t,this.memoryStack=this.module.malloc(HI),this.memoryStackNextFree=this.memoryStack}createIntArray(t){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>HI?-1:(new Int32Array(this.module.heap32.buffer,s,t.length).set(t),s)}createFloatArray(t){let s=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>HI?-1:(new Float32Array(this.module.heapF32.buffer,s,t.length).set(t),s)}readStringBuffer(t){let s="";for(;this.module.heapU8[t]!==0;)s+=String.fromCharCode(this.module.heapU8[t]),++t;return s}setStyle(t){let s=t.normalScale;this.module.setStyle(s[0],s[1],s[2],t.tileToMeters)}setAOOptions(t,s){this.module.setAOOptions(t?1:0,s)}setMetricOptions(t,s){this.module.setMetricOptions(t?1:0,s)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,s){this.module.setFacadeOptions(t,s?1:0)}setFauxFacadeOptions(t,s,u){this.module.setFauxFacadeOptions(t?1:0,s?1:0,u)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,s){this.memoryStackNextFree=this.memoryStack;for(let v of t){let b=this.createIntArray(v.ringIndices),E=this.createFloatArray(v.coordinates);if(b===-1||E===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,E,b,v.ringIndices.length-1)}for(let v of s){let b;b=v.entrances?JSON.parse(v.entrances):[];let E=this.createFloatArray(b),T=this.createFloatArray(v.coordinates);if(E===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,E,b.length,T,v.coordinates.length)}if(!this.module.generateMesh()){let v=this.module.getLastError();return this.readStringBuffer(v)}let u=this.module.getMeshCount(),h=new Array(u);for(let v=0;v<u;v++){let b=this.module.getPositionsPtr(v),E=this.module.getPositionsLength(v),T=new Float32Array(this.module.heapF32.buffer,b,E),I=this.module.getNormalsPtr(v),D=this.module.getNormalsLength(v),O=new Float32Array(this.module.heapF32.buffer,I,D),R=this.module.getAOPtr(v),B=this.module.getAOLength(v),H=new Float32Array(this.module.heapF32.buffer,R,B),$=this.module.getUVPtr(v),Y=this.module.getUVLength(v),J=new Float32Array(this.module.heapF32.buffer,$,Y),ie=this.module.getFauxFacadePtr(v),he=this.module.getFauxFacadeLength(v),le=new Uint8Array(this.module.heapU8.buffer,ie,he),me=this.module.getIndicesPtr(v),ye=this.module.getIndicesLength(v),we=new Int16Array(this.module.heap16.buffer,me,ye),je=this.module.getBuildingPart(v);h[v]={positions:T,normals:O,ao:H,uv:J,isFauxFacade:le,indices:we,buildingPart:je}}let m=this.module.getRingCount(),g=[];for(let v=0;v<m;v++){let b=this.module.getRingPtr(v),E=this.module.getRingLength(v),T=new Float32Array(this.module.heapF32.buffer,b,E);g.push(T)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let Yv,GI,mc,Ag,qI,Pg=null,Og=null,Gk=null,Y1=null;function qk(){return Un(self)&&self.worker.dracoUrl?self.worker.dracoUrl:GI||kn.DRACO_URL}function Wk(){if(Un(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ag)return Ag;let l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ag=WebAssembly.validate(l)?kn.MESHOPT_SIMD_URL:kn.MESHOPT_URL,Ag}function m8(){return Y1}let X1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},g8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Xv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Zk(l,t,s){let u=s.json.bufferViews.length,h=s.buffers.length;t.bufferView=u,s.json.bufferViews[u]={buffer:h,byteLength:l.byteLength},s.buffers[h]=l}let WI="KHR_draco_mesh_compression";function _8(l,t){let s=l.extensions&&l.extensions[WI];if(!s)return;let u=new mc.Decoder,h=Qk(t,s.bufferView),m=new mc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");let g=t.json.accessors[l.indices],v=X1[g.componentType],b=g.count*v.BYTES_PER_ELEMENT,E=mc._malloc(b);v===Uint16Array?u.GetTrianglesUInt16Array(m,b,E):u.GetTrianglesUInt32Array(m,b,E),Zk(mc.memory.buffer.slice(E,E+b),g,t),mc._free(E);for(let T of Object.keys(s.attributes)){let I=u.GetAttributeByUniqueId(m,s.attributes[T]),D=t.json.accessors[l.attributes[T]],O=g8[D.componentType],R=D.count*Xv[D.type]*X1[D.componentType].BYTES_PER_ELEMENT,B=mc._malloc(R);u.GetAttributeDataArrayForAllPoints(m,I,mc[O],R,B),Zk(mc.memory.buffer.slice(B,B+R),D,t),mc._free(B)}u.destroy(),m.destroy(),delete l.extensions[WI]}let K1="EXT_meshopt_compression";function v8(l,t){if(!l.extensions||!l.extensions[K1])return;let s=l.extensions[K1],u=new Uint8Array(t.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);qI.decodeGltfBuffer(h,s.count,s.byteStride,u,s.mode,s.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=h.buffer,delete l.extensions[K1]}let Yk=1179937895,Xk=new TextDecoder("utf8");function Kk(l,t){return new URL(l,t).href}function y8(l,t,s,u){return fetch(Kk(l.uri,u)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[s]=h})}function Qk(l,t){let s=l.json.bufferViews[t];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function x8(l,t,s,u){if(l.uri){let h=Kk(l.uri,u);return fetch(h).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{t.images[s]=m})}if(l.bufferView!==void 0){let h=Qk(t,l.bufferView),m=new Blob([h],{type:l.mimeType});return createImageBitmap(m).then(g=>{t.images[s]=g})}}function Jk(l,t=0,s){let u={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===Yk){let T=new Uint32Array(l,t),I=2,D=(T[I++]>>2)-3,O=T[I++]>>2;if(I++,u.json=JSON.parse(Xk.decode(T.subarray(I,I+O))),I+=O,I<D){let R=T[I++];I++;let B=t+(I<<2);u.buffers[0]=l.slice(B,B+R)}}else u.json=JSON.parse(Xk.decode(new Uint8Array(l,t)));let{buffers:h,images:m,meshes:g,extensionsUsed:v,bufferViews:b}=u.json,E=Promise.resolve();if(h){let T=[];for(let I=0;I<h.length;I++){let D=h[I];D.uri?T.push(y8(D,u,I,s)):u.buffers[I]||(u.buffers[I]=null)}E=Promise.all(T)}return E.then(()=>{let T=[],I=v&&v.includes(WI),D=v&&v.includes(K1);if(I&&T.push((function(){if(!mc)return Yv??(Yv=(function(O){let R,B=null;function H(){R=new Uint8Array(B.buffer)}function $(){throw new Error("Unexpected Draco error.")}let Y={a:{a:$,d:function(J,ie,he){return R.copyWithin(J,ie,ie+he)},c:function(J){let ie=R.length,he=Math.max(J>>>0,Math.ceil(1.2*ie)),le=Math.ceil((he-ie)/65536);try{return B.grow(le),H(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,Y):O.then(J=>J.arrayBuffer()).then(J=>WebAssembly.instantiate(J,Y))).then(J=>{let{Rb:ie,Qb:he,P:le,T:me,X:ye,Ja:we,La:je,Qa:Ae,Va:We,Wa:Ke,eb:Qe,jb:at,f:ct,e:nt,yb:it,zb:qe,Ab:He,Bb:rt,Db:xt,Gb:ft}=J.instance.exports;B=nt;let qt=(()=>{let It=0,Rt=0,Bt=0,In=0;return mt=>{Bt&&(ie(In),ie(It),Rt+=Bt,Bt=It=0),It||(Rt+=128,It=he(Rt));let Ut=mt.length+7&-8,dn=It;Ut>=Rt&&(Bt=Ut,dn=In=he(Ut));for(let Ln=0;Ln<mt.length;Ln++)R[dn+Ln]=mt[Ln];return dn}})();return H(),ct(),{memory:nt,_free:ie,_malloc:he,Mesh:class{constructor(){this.ptr=le()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){at(this.ptr)}DecodeArrayToMesh(It,Rt,Bt){let In=qt(It),mt=je(this.ptr,In,Rt,Bt.ptr);return!!ye(mt)}GetAttributeByUniqueId(It,Rt){return{ptr:Ae(this.ptr,It.ptr,Rt)}}GetTrianglesUInt16Array(It,Rt,Bt){We(this.ptr,It.ptr,Rt,Bt)}GetTrianglesUInt32Array(It,Rt,Bt){Ke(this.ptr,It.ptr,Rt,Bt)}GetAttributeDataArrayForAllPoints(It,Rt,Bt,In,mt){Qe(this.ptr,It.ptr,Rt.ptr,Bt,In,mt)}},DT_INT8:it(),DT_UINT8:qe(),DT_INT16:He(),DT_UINT16:rt(),DT_UINT32:xt(),DT_FLOAT32:ft()}})})(fetch(qk())),Yv.then(O=>{mc=O,Yv=void 0}))})()),D&&T.push((function(){if(qI)return;let O=(function(R){let B,H=WebAssembly.instantiateStreaming(R,{}).then(J=>{B=J.instance,B.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(J,ie,he,le,me,ye){(function(we,je,Ae,We,Ke,Qe,at){let ct=we.exports.sbrk,nt=We+3&-4,it=ct(nt*Ke),qe=ct(Qe.length),He=new Uint8Array(we.exports.memory.buffer);He.set(Qe,qe);let rt=je(it,We,Ke,qe,Qe.length);if(rt===0&&at&&at(it,nt,Ke),Ae.set(He.subarray(it,it+We*Ke)),ct(it-ct(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(B,B.exports[Y[me]],J,ie,he,le,B.exports[$[ye]])}}})(fetch(Wk()));return O.ready.then(()=>{qI=O})})()),m)for(let O=0;O<m.length;O++)T.push(x8(m[O],u,O,s));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&g)for(let{primitives:O}of g)for(let R of O)_8(R,u);if(D&&g&&b)for(let O of b)v8(O,u);return u})})}function eF(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>Jk(t,0,l))}function ZI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function YI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class XI{constructor(t,s,u,h){this.context=t,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=t.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(t,s){let u=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,h=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:m}=this,{gl:g}=m,{x:v,y:b}=s&&s.position?s.position:{x:0,y:0},E=v+u,T=b+h;!this.size||this.size[0]===E&&this.size[1]===T||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));let I=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&E>0&&T>0){let D=this.useMipmap?Math.floor(Math.log2(Math.max(E,T)))+1:1;g.texStorage2D(g.TEXTURE_2D,D,this.format,E,T),this.size=[E,T]}this.size&&(I?g.texSubImage2D(g.TEXTURE_2D,0,v,b,ZI(this.format),YI(this.format),t):"data"in t&&t.data&&g.texSubImage2D(g.TEXTURE_2D,0,v,b,u,h,ZI(this.format),YI(this.format),t.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,s,u=!1){let{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(t,s,u,h,m){let{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),this.magFilter=s),t!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?t===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Kv{constructor(t,s){this.context=t,this.texture=s}bind(t,s){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}let b8=Pn([{name:"a_pos_3f",components:3,type:"Float32"}]),w8=Pn([{name:"a_color_3f",components:3,type:"Float32"}]),C8=Pn([{name:"a_color_4f",components:4,type:"Float32"}]),E8=Pn([{name:"a_uv_2f",components:2,type:"Float32"}]),S8=Pn([{name:"a_normal_3f",components:3,type:"Float32"}]),T8=Pn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),I8=Pn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function tF(l,t){let s=Q1(l.projection,l.zoom,l.width,l.height),u=(function(m,g,v,b,E){let T=new c(v.lng-180*Ch,v.lat),I=new c(v.lng+180*Ch,v.lat),D=m.project(T.lng,T.lat),O=m.project(I.lng,I.lat),R=-Math.atan2(O.y-D.y,O.x-D.x),B=ee.fromLngLat(v);B.y=G(B.y,-1+Ch,1-Ch);let H=B.toLngLat(),$=m.project(H.lng,H.lat),Y=ee.fromLngLat(H);Y.x+=Ch;let J=Y.toLngLat(),ie=m.project(J.lng,J.lat),he=iF(ie.x-$.x,ie.y-$.y,R),le=ee.fromLngLat(H);le.y+=Ch;let me=le.toLngLat(),ye=m.project(me.lng,me.lat),we=iF(ye.x-$.x,ye.y-$.y,R),je=Math.abs(he.x)/Math.abs(we.y),Ae=ht([]);Ni(Ae,Ae,-R*(1-(E?0:b)));let We=ht([]);return Vn(We,We,[1,1-(1-je)*b,1]),We[4]=-we.x/we.y*b,Ni(We,We,R),Mt(We,Ae,We),We})(l.projection,0,l.center,s,t),h=nF(l);return Vn(u,u,[h,h,1]),u}function nF(l){let t=l.projection,s=Q1(l.projection,l.zoom,l.width,l.height),u=KI(t,l.center),h=KI(t,c.convert(t.center));return Math.pow(2,u*s+(1-s)*h)}function Q1(l,t,s,u,h=1/0){let m=l.range;if(!m)return 0;let g=Math.min(h,Math.max(s,u)),v=Math.log2(g/1024);return Q(m[0]+v,m[1]+v,t)}let Ch=1/4e4;function KI(l,t){let s=G(t.lat,-N,N),u=new c(t.lng-180*Ch,s),h=new c(t.lng+180*Ch,s),m=l.project(u.lng,s),g=l.project(h.lng,s),v=ee.fromLngLat(u),b=ee.fromLngLat(h),E=g.x-m.x,T=g.y-m.y,I=b.x-v.x,D=b.y-v.y,O=Math.sqrt((I*I+D*D)/(E*E+T*T));return Math.log2(O)}function iF(l,t,s){let u=Math.cos(s),h=Math.sin(s);return{x:l*u-t*h,y:l*h+t*u}}function rF(l,t,s){ht(l),Ni(l,l,Zn(t[2])),sr(l,l,Zn(t[0])),Hi(l,l,Zn(t[1])),Vn(l,l,s),Mt(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function J1(l,t,s,u,h,m,g,v){let b=[s[0]-t[0],s[1]-t[1],0],E=[u[0]-t[0],u[1]-t[1],0];if(xo(b)<1e-12||xo(E)<1e-12)return qd(l);let T=Wo([],b,E);Yi(T,T),dl(E,u,t),b[2]=(m-h)*v,E[2]=(g-h)*v;let I=b;return Wo(I,b,E),Yi(I,I),Wd(l,T,I)}function ew(l,t,s=!1){let u=bh(t.zoom),h=(function(m,g,v){let b=g.worldSize,E=[m[12],m[13],m[14]],T=L(E[1]/b),I=A(E[0]/b),D=ht([]),O=M(1,T)*b,R=M(1,0)*b*U(T,g.zoom),B=1/TI(b),H=R*B;if(v){let ie=Q1(g.projection,g.zoom,g.width,g.height,1024);H=B*g.projection.pixelSpaceConversion(g.center.lat,b,ie)}let $=vh(T,I);Wr($,$,fr([],Yi([],$),O*H*E[2]));let Y=(function(ie){let he=[ie[0],ie[1],ie[2]],le=[0,1,0],me=Wo([],le,he);return Wo(le,he,me),sm(le)===0&&(le=[0,1,0],Wo(me,he,le)),Yi(me,me),Yi(le,le),Yi(he,he),[me[0],me[1],me[2],0,le[0],le[1],le[2],0,he[0],he[1],he[2],0,ie[0],ie[1],ie[2],1]})($);Vn(D,D,[H,H,H*O]),Xt(D,D,[-E[0],-E[1],-E[2]]);let J=Mt([],g.globeMatrix,Y);return Mt(J,J,D),Mt(J,J,m),J})(l,t,s);if(u>0){let m=(function(g,v){let b=v.worldSize,E=M(1,0)*b*U(v.center.lat,v.zoom)/TI(b),T=M(1,v.center.lat)*b,I=ht([]);Hi(I,I,Zn(v.center.lng)),sr(I,I,Zn(v.center.lat)),Xt(I,I,[0,0,Ko]),Vn(I,I,[E,E,E*T]);let D=v.point;return Xt(I,I,[-D.x,-D.y,0]),Mt(I,I,g),Mt(I,v.globeMatrix,I)})(l,t);return(function(g,v,b){let E=(R,B,H)=>{let $=xo(R),Y=xo(B),J=fc(R,B,H);return fr(J,J,1/xo(J)*on($,Y,H))},T=E([g[0],g[1],g[2]],[v[0],v[1],v[2]],b),I=E([g[4],g[5],g[6]],[v[4],v[5],v[6]],b),D=E([g[8],g[9],g[10]],[v[8],v[9],v[10]],b),O=fc([g[12],g[13],g[14]],[v[12],v[13],v[14]],b);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],0,O[0],O[1],O[2],1]})(h,m,u)}return h}function QI(l,t,s,u){let h=$t.projectAabbCorners(u,s),m=Number.MAX_VALUE;for(let v=0;v<h.length;++v){let b=h[v];b[0]=(.5*b[0]+.5)*t.width,b[1]=(.5-.5*b[1])*t.height,b[2]<m&&(m=b[2])}let g=(function(v){let b=[],E=0;for(let O=1;O<v.length;O++)(v[O][0]<v[E][0]||v[O][0]===v[E][0]&&v[O][1]<v[E][1])&&(E=O);let T,I=E,D=new Uint8Array(v.length);do{if(D[I])break;b.push(new st(v[I][0],v[I][1])),D[I]=1,T=(I+1)%v.length;for(let O=0;O<v.length;O++){if(v[O][0]===v[T][0]&&v[O][1]===v[T][1]||v[O][0]===v[I][0]&&v[O][1]===v[I][1])continue;let R=[v[O][0]-v[I][0],v[O][1]-v[I][1]],B=[v[T][0]-v[I][0],v[T][1]-v[I][1]],H=R[0]*B[1]-R[1]*B[0];(H>0||H===0&&R[0]*B[0]+R[1]*B[1]>=0&&R[0]*R[0]+R[1]*R[1]>B[0]*B[0]+B[1]*B[1])&&(T=O)}I=T}while(I!==E);return b.length>0&&b.push(b[0]),b})(h);if(Wn(l,g))return m}let ef=64,Rg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function tw(l,t,s,u,h,m,g,v,b,E=!1){let T=s.zoom,I=s.project(u),D=U(u.lat,T),O=1/D;ht(l),Xt(l,l,[I.x+g[0]*O,I.y+g[1]*O,g[2]]);let R=1,B=1,H=s.worldSize;if(E){if(s.projection.name==="mercator"){let ie=0;s.elevation&&(ie=s.elevation.getAtPointOrZero(new ee(I.x/H,I.y/H),0));let he=Zo([],[I.x,I.y,ie,1],s.projMatrix)[3]/s.cameraToCenterDistance;R=he,B=he*U(s.center.lat,T)}else if(s.projection.name==="globe"){let ie=ew(l,s),he=[0,0,0,1];Zo(he,he,Mt([],s.projMatrix,ie));let le=he[3]/s.cameraToCenterDistance,me=bh(T),ye=s.projection.pixelsPerMeter(u.lat,H)*U(u.lat,T),we=s.projection.pixelsPerMeter(s.center.lat,H)*U(s.center.lat,T);R=le/on(ye,j(s.center.lat),me),B=le*D/ye,R*=we,B*=we}}else R=O;Vn(l,l,[R,R,B]);let $=[...l],Y=t.orientation,J=[];if(rF(J,[Y[0]+(h?h[0]:0),Y[1]+(h?h[1]:0),Y[2]+(h?h[2]:0)],m),Mt(l,$,J),v&&s.elevation){let ie=0,he=[];if(b&&s.elevation){ie=(function(me,ye,we,je,Ae){let We=ye.elevation;if(!We)return 0;let Ke=$t.projectAabbCorners(we,je),Qe=M(1,Ae.lat)*ye.worldSize,at=(function(Rt,Bt){let In=[0,0,1],mt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ut of mt){let dn=Rt[Ut.corners[0]],Ln=Rt[Ut.corners[1]],zn=Rt[Ut.corners[2]],_n=[Ln[0]-dn[0],Ln[1]-dn[1],Bt*(Ln[2]-dn[2])],_i=Wo(_n,_n,[zn[0]-dn[0],zn[1]-dn[1],Bt*(zn[2]-dn[2])]);Yi(_i,_i),Ut.dotProductWithUp=Ir(_i,In)}return mt.sort((Ut,dn)=>Ut.dotProductWithUp-dn.dotProductWithUp),mt[0].corners})(Ke,Qe),ct=Ke[at[0]],nt=Ke[at[1]],it=Ke[at[2]],qe=Ke[at[3]],He=We.getAtPointOrZero(new ee(ct[0]/ye.worldSize,ct[1]/ye.worldSize),0),rt=We.getAtPointOrZero(new ee(nt[0]/ye.worldSize,nt[1]/ye.worldSize),0),xt=We.getAtPointOrZero(new ee(it[0]/ye.worldSize,it[1]/ye.worldSize),0),ft=We.getAtPointOrZero(new ee(qe[0]/ye.worldSize,qe[1]/ye.worldSize),0),qt=(He+ft)/2,It=(rt+xt)/2;return qt>It?rt<xt?J1(me,nt,qe,ct,rt,ft,He,Qe):J1(me,it,ct,qe,xt,He,ft,Qe):He<ft?J1(me,ct,nt,it,He,rt,xt,Qe):J1(me,qe,it,nt,ft,xt,rt,Qe),Math.max(qt,It)})(he,s,t.aabb,l,u);let le=Mt([],Vu([],he),J);Mt(l,$,le)}else ie=s.elevation.getAtPointOrZero(new ee(I.x/H,I.y/H),0);ie!==0&&(l[14]+=ie)}}class oF{constructor(t,s,u,h,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=t,this.uri=s,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=h??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new $t([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,s){Mt(t.globalMatrix,s,t.localMatrix);let u=this.nodeOverrides.get(t.name);if(u!==void 0){let g=[];m=u.orientation,ht(h=g),Hi(h,h,Zn(m[1])),Ni(h,h,Zn(m[2])),sr(h,h,Zn(m[0])),Mt(t.globalMatrix,t.globalMatrix,g)}var h,m;if(t.meshes)for(let g of t.meshes){let v=$t.applyTransformFast(g.aabb,t.globalMatrix);this.aabb.encapsulate(v)}if(t.children)for(let g of t.children)this._applyTransformations(g,t.globalMatrix)}computeBoundsAndApplyParent(){let t=ht([]);this.aabb=new $t([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.nodes)this._applyTransformations(s,t)}computeModelMatrix(t,s,u,h,m,g,v=!1){tw(this.matrix,this,t.transform,this.position,s,u,h,m,g,v)}upload(t){if(!this.uploaded){for(let s of this.nodes)JI(s,t);for(let s of this.nodes)nw(s);this.uploaded=!0}}destroy(){for(let t of this.nodes)eM(t)}}function Qv(l,t,s=!1){l.uploaded||(l.gfxTexture=new XI(t,l.image,s?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function M8(l,t,s){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,b8.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,S8.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,E8.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?w8:C8).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,I8.members,!0)),l.segments=nr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);let u=l.material;u.pbrMetallicRoughness.baseColorTexture&&Qv(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&Qv(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&Qv(u.normalTexture,t),u.occlusionTexture&&Qv(u.occlusionTexture,t,s),u.emissionTexture&&Qv(u.emissionTexture,t)}function JI(l,t,s){if(l.meshes)for(let u of l.meshes)M8(u,t,s);if(l.children)for(let u of l.children)JI(u,t,s)}function nw(l){if(l.meshes)for(let t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(let t of l.children)nw(t)}function eM(l){if(l.meshes)for(let s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((t=s.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(let s of l.children)eM(s)}function tf(l,t){let s=l.json.bufferViews[t.bufferView],u=X1[t.componentType];return new u(l.buffers[s.buffer],(t.byteOffset||0)+(s.byteOffset||0),t.count*(s.byteStride&&s.byteStride!==Xv[t.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:Xv[t.type]))}function tM(l,t,s,u){let h=X1[t.componentType],m=(function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),g=l.json.bufferViews[t.bufferView],v=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:Xv[t.type],b=s.float32,E=b.length/s.capacity;for(let T=0,I=0;T<t.count*v;T+=v,I+=E)for(let D=0;D<E;D++)b[I+D]=u[T+D]*m;s._trim()}function D8(l,t,s){let u=l.indices,h=l.attributes,m={};m.indexArray=new Kr;let g=t.json.accessors[u],v=g.count/3;m.indexArray.reserve(v);let b=tf(t,g);for(let D=0;D<v;D++)m.indexArray.emplaceBack(b[3*D],b[3*D+1],b[3*D+2]);m.indexArray._trim(),m.vertexArray=new na;let E=t.json.accessors[h.POSITION];m.vertexArray.reserve(E.count);let T=tf(t,E);for(let D=0;D<E.count;D++)m.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(m.vertexArray._trim(),m.aabb=new $t(E.min,E.max),m.centroid=(function(D,O){let R=[0,0,0],B=D.length;if(B>0){for(let H=0;H<B;H++){let $=3*D[H];R[0]+=O[$],R[1]+=O[$+1],R[2]+=O[$+2]}R[0]/=B,R[1]/=B,R[2]/=B}return R})(b,T),h.COLOR_0!==void 0){let D=t.json.accessors[h.COLOR_0],O=Xv[D.type],R=tf(t,D);m.colorArray=O===3?new na:new su,m.colorArray.resize(D.count),tM(t,D,m.colorArray,R)}if(h.NORMAL!==void 0){m.normalArray=new na;let D=t.json.accessors[h.NORMAL];m.normalArray.resize(D.count);let O=tf(t,D);tM(t,D,m.normalArray,O)}if(h.TEXCOORD_0!==void 0&&s.length>0){m.texcoordArray=new Sl;let D=t.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(D.count);let O=tf(t,D);tM(t,D,m.texcoordArray,O)}if(h._FEATURE_ID_RGBA4444!==void 0){let D=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=tf(t,D))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(tf(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));let I=l.material;return m.material=(function(D,O){let{emissiveFactor:R=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:H=.5,normalTexture:$,occlusionTexture:Y,emissiveTexture:J,doubleSided:ie,name:he}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:me=1,roughnessFactor:ye=1,baseColorTexture:we,metallicRoughnessTexture:je}=D.pbrMetallicRoughness||{},Ae=Y?O[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&Ae){let We=Y.extensions.KHR_texture_transform;Ae.offsetScale=[We.offset[0],We.offset[1],We.scale[0],We.scale[1]]}return{name:he,pbrMetallicRoughness:{baseColorFactor:new ui(...le),metallicFactor:me,roughnessFactor:ye,baseColorTexture:we?O[we.index]:void 0,metallicRoughnessTexture:je?O[je.index]:void 0},doubleSided:ie,emissiveFactor:new ui(...R),alphaMode:B,alphaCutoff:H,normalTexture:$?O[$.index]:void 0,occlusionTexture:Ae,emissionTexture:J?O[J.index]:void 0,defined:D.defined===void 0}})(I!==void 0?t.json.materials[I]:{defined:!1},s),m}function sF(l,t,s){let{matrix:u,rotation:h,translation:m,scale:g,mesh:v,extras:b,children:E,name:T}=l,I={};if(I.name=T,I.localMatrix=u||(function(D,O,R,B){var H=O[0],$=O[1],Y=O[2],J=O[3],ie=H+H,he=$+$,le=Y+Y,me=H*ie,ye=H*he,we=H*le,je=$*he,Ae=$*le,We=Y*le,Ke=J*ie,Qe=J*he,at=J*le,ct=B[0],nt=B[1],it=B[2];return D[0]=(1-(je+We))*ct,D[1]=(ye+at)*ct,D[2]=(we-Qe)*ct,D[3]=0,D[4]=(ye-at)*nt,D[5]=(1-(me+We))*nt,D[6]=(Ae+Ke)*nt,D[7]=0,D[8]=(we+Qe)*it,D[9]=(Ae-Ke)*it,D[10]=(1-(me+je))*it,D[11]=0,D[12]=R[0],D[13]=R[1],D[14]=R[2],D[15]=1,D})([],h||[0,0,0,1],m||[0,0,0],g||[1,1,1]),I.globalMatrix=ke(I.localMatrix),v!==void 0){I.meshes=s[v];let D=I.anchor=[0,0];for(let O of I.meshes){let{min:R,max:B}=O.aabb;D[0]+=R[0]+B[0],D[1]+=R[1]+B[1]}D[0]=Math.floor(D[0]/I.meshes.length/2),D[1]=Math.floor(D[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=(function(D){if(!D.length)return[];let O=(function(Y){let J=atob(Y),ie=new Uint8Array(J.length);for(let he=0;he<J.length;he++)ie[he]=J.codePointAt(he);return ie})(D),R=[],B=O.length/24,H=new Uint16Array(O.buffer),$=new Float32Array(O.buffer);for(let Y=0;Y<B;Y++){let J=H[2*Y*6]/30,ie=H[2*Y*6+1]/30,he=H[2*Y*6+10]/100,le=$[6*Y+1],me=$[6*Y+2],ye=$[6*Y+3],we=$[6*Y+4],je=ye-le,Ae=we-me,We=Math.hypot(je,Ae);R.push({pos:[le+.5*je,me+.5*Ae,ie],normal:[Ae/We,-je/We,0],width:We,height:J,depth:he,points:[le,me,ye,we]})}return R})(b.lights)),b.MAPBOX_geometry_bloom&&(I.isGeometryBloom=b.MAPBOX_geometry_bloom)),E){let D=[];for(let O of E)D.push(sF(t.json.nodes[O],t,s));I.children=D}return I}function A8(l){if(l.vertices.length===0||l.indices.length===0)return null;let t=new U1(l.vertices,l.indices,8,256),[s,u]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:s,max:u}}function P8(l){if(!l.extras||!l.extras.ground)return null;let t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let s=t[0];if(!s||!Array.isArray(s)||s.length===0)return null;let u=[];for(let g of s){if(!Array.isArray(g)||g.length!==2)continue;let v=g[0],b=g[1];typeof v=="number"&&typeof b=="number"&&u.push(new st(v,b))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let g=0;g<u.length;g++){let v=u[g],b=u[(g+1)%u.length],E=u[(g+2)%u.length];h+=(v.x-b.x)*(E.y-b.y)-(E.x-b.x)*(v.y-b.y)}h>0&&u.reverse();let m=Ig(u.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:u,indices:m}}function O8(l,t){let s=[],u=[],h=0,m=[];for(let g of l){h=s.length;let v=g.vertexArray.float32,b=g.indexArray.uint16;for(let E=0;E<g.vertexArray.length;E++)m[0]=v[3*E+0],m[1]=v[3*E+1],m[2]=v[3*E+2],Fr(m,m,t),s.push(new st(m[0],m[1]));for(let E=0;E<3*g.indexArray.length;E++)u.push(b[E]+h)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){let v=s[u[g+0]],b=s[u[g+1]],E=s[u[g+2]];(v.x-b.x)*(E.y-b.y)-(E.x-b.x)*(v.y-b.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function nM(l){let t=(function(b,E){let T=[],I=WebGL2RenderingContext;if(b.json.textures)for(let D of b.json.textures){let O={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};D.sampler!==void 0&&Object.assign(O,b.json.samplers[D.sampler]),T.push({image:E[D.source],sampler:O,uploaded:!1})}return T})(l,l.images),s=(function(b,E){let T=[];for(let I of b.json.meshes){let D=[];for(let O of I.primitives)D.push(D8(O,b,E));T.push(D)}return T})(l,t),{scenes:u,scene:h,nodes:m}=l.json,g=u?u[h||0].nodes:[...m.keys()],v=[];for(let b of g)v.push(sF(m[b],l,s));return(function(b,E,T){let I={},D=new Set;for(let O=0;O<b.length;O++){let R=T[E[O]];if(!R.extras)continue;let B=R.extras["mapbox:footprint:version"],H=R.extras["mapbox:footprint:id"];(B||H)&&D.add(O),B==="1.0.0"&&H&&(I[H]=O)}for(let O=0;O<b.length;O++){if(D.has(O))continue;let R=b[O],B=T[E[O]];if(!B.extras)continue;let H=null;R.id in I&&(H=O8(b[I[R.id]].meshes,R.localMatrix)),H||(H=P8(B)),H&&(R.footprint=A8(H))}if(D.size>0){let O=Array.from(D.values()).sort((R,B)=>R-B);for(let R=O.length-1;R>=0;R--)b.splice(O[R],1)}})(v,g,l.json.nodes),v}function R8(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);let t=l.vertexArray.float32,s=l.aabb.min[0]-1,u=l.aabb.min[1]-1,h=ef/(l.aabb.max[0]-s+2),m=ef/(l.aabb.max[1]-u+2);for(let g=0;g<t.length;g+=3){let v=t[g+2],b=(t[g+0]-s)*h|0,E=(t[g+1]-u)*m|0;v>l.heightmap[E*ef+b]&&(l.heightmap[E*ef+b]=v)}}function aF(l,t,s,u,h){s.reserve(s.length+4*l.length),u.reserve(u.length+10*l.length),h.reserve(h.length+10*l.length);let m=u.length;for(let g of l){let v=Math.min(10,Math.max(4,1.3*g.height))*t,b=[-g.normal[1],g.normal[0],0],E=Math.min(.29,.1*g.width/g.depth),T=g.width-2*g.depth*t*(E+.01),I=Qs([],g.pos,b,T/2),D=Qs([],g.pos,b,-T/2),O=[I[0],I[1],I[2]+g.height],R=[D[0],D[1],D[2]+g.height],B=Qs([],g.normal,b,E);fr(B,B,v);let H=Qs([],g.normal,b,-E);fr(H,H,v),Wr(B,I,B),Wr(H,D,H),I[2]+=.1,D[2]+=.1,u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(O[0],O[1],O[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(H[0],H[1],H[2]);let $=T/v/2;h.emplaceBack(-$-E,-1,$,.8),h.emplaceBack($+E,-1,$,.8),h.emplaceBack(-$,0,$,1.3),h.emplaceBack($,0,$,1.3),h.emplaceBack($+E,-.8,$,.7),h.emplaceBack($+E,-.8,$,.7),h.emplaceBack(0,0,$,1.3),h.emplaceBack(0,0,$,1.3),h.emplaceBack($+E,-1.2,$,.8),h.emplaceBack($+E,-1.2,$,.8),s.emplaceBack(6+m,4+m,8+m),s.emplaceBack(7+m,9+m,5+m),s.emplaceBack(0+m,1+m,2+m),s.emplaceBack(1+m,3+m,2+m),m+=10}}function k8(l,t){let s={};s.indexArray=new Kr,s.vertexArray=new na,s.colorArray=new su,aF(l,t,s.indexArray,s.vertexArray,s.colorArray);let u={defined:!0};u.emissiveFactor=ui.black;let h={};return h.baseColorFactor=ui.white,u.pbrMetallicRoughness=h,s.material=u,s.aabb=new $t([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}let lF=Pn([{name:"a_pos_3f",components:3,type:"Float32"}]),F8=Pn([{name:"a_normal_3",components:3,type:"Int16"}]),L8=Pn([{name:"a_centroid_3",components:3,type:"Int16"}]),cF=Pn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),N8=Pn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),z8=Pn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),B8=Pn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),V8=Pn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),U8=Pn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),uF=Ce.types,iw=32767;function j8(l,t){let s=yt+t;for(let u of l)for(let h of u)if(h.x<-t||h.x>s||h.y<-t||h.y>s)return!1;return!0}function $8(l){switch(l){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${l}`)}}class iM{constructor(){this.layoutVertexArray=new na,this.layoutAttenuationArray=new su,this.layoutColorArray=new ia,this.indexArray=new Kr,this.indexArrayForConflation=new Kr,this.segmentsBucket=new nr}}class rM{constructor(t){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new nr,this.entranceBloom=new iM;let s=66560;this.layoutVertexArray=new na,this.layoutVertexArray.reserve(s),this.layoutNormalArray=new hh,this.layoutNormalArray.reserve(s),this.layoutCentroidArray=new hh,this.layoutCentroidArray.reserve(s),this.layoutColorArray=new ia,this.layoutColorArray.reserve(s),this.layoutFloodLightDataArray=new au,this.layoutFloodLightDataArray.reserve(s),this.layoutAOArray=new mg,this.layoutAOArray.reserve(s),this.indexArray=new Kr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Kr,this.segmentsBucket=new nr,this.entranceBloom=new iM,t&&(this.layoutFacadePaintArray=new ia,this.layoutFacadeDataArray=new gd,this.layoutFacadeVerticalRangeArray=new ia)}reserve(t,s,u){this.layoutVertexArray.reserveForAdditional(t),this.layoutCentroidArray.reserveForAdditional(t),this.layoutFloodLightDataArray.reserveForAdditional(t),this.layoutNormalArray.reserveForAdditional(t),this.layoutAOArray.reserveForAdditional(t),this.layoutColorArray.reserveForAdditional(t),this.indexArray.reserveForAdditional(s),u&&(this.layoutFacadePaintArray.reserveForAdditional(t),this.layoutFacadeDataArray.reserveForAdditional(t),this.layoutFacadeVerticalRangeArray.reserveForAdditional(t))}}class dF{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Sl,this.footprintsIndices=new au,this.footprintsMin=new st(1/0,1/0),this.footprintsMax=new st(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new rM(!1),this.buildingWithFacade=new rM(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection,this.groundEffect=new VI(t),this.groundEffect.groundRadiusArray=new ac,this.hasAppearances=null}updateFootprints(t,s){let u=new U1([],[],1),h={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};s.push({footprint:h,id:t})}updateAppearances(t,s,u,h){}prepare(){return(function(){if(Y1!=null||Gk!=null)return null;if(Og!=null)return Og;let t=fetch(kn.BUILDING_GEN_URL);return Og=(function(s){let u,h,m,g,v;function b(){u=new Uint8Array(v.buffer),h=new Int16Array(v.buffer),m=new Int32Array(v.buffer),g=new Float32Array(v.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}let T=()=>{},I={a:{a:E,f:function(D){let O=u.length,R=Math.max(D>>>0,Math.ceil(1.2*O)),B=Math.ceil((R-O)/65536);try{return v.grow(B),b(),!0}catch{return!1}},g:E,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,I):s.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,I))).then(D=>{let O=D.instance.exports;return(0,O.g)(),v=O.f,b(),new f8({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getAOPtr:O.y,getAOLength:O.z,getUVPtr:O.A,getUVLength:O.B,getFauxFacadePtr:O.C,getFauxFacadeLength:O.D,getIndicesPtr:O.E,getIndicesLength:O.F,getBuildingPart:O.G,getRingCount:O.H,getRingPtr:O.I,getRingLength:O.J,malloc:O.K,free:O.L,heapU8:u,heap16:h,heap32:m,heapF32:g})})})(t).then(s=>(Og=null,Y1=s,Y1)).catch(s=>{Pt("Could not load building-gen"),Og=null,Gk=s}),Og})()}populate(t,s,u,h){let m=m8();if(!m)return;let g=q(u);this.tileToMeter=g,this.brightness=s.brightness,m.setStyle({normalScale:[1,-1,g],tileToMeters:g}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);let v=new Map,b=new Map,E=0;for(let{feature:$}of t){if(uF[$.type]!=="LineString"){v.set($.id,$.properties.source_id);continue}let Y=this.layers[0]._featureFilter.needGeometry;if(Y&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),$,u))continue;let J=De($,Y);if(!Y&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),J,u))continue;let ie=Y?J.geometry:_e($,u,h),he=[];for(let we of ie)for(let je of we)he.push(je.x),he.push(je.y);let le={coordinates:he,crossPerc:$.properties.cross_perc,distanceToRoad:$.properties.distance_to_road,entrances:$.properties.entrances,sourceId:0},me=$.properties.source_id,ye=b.get(me);ye||(ye=[],b.set(me,ye)),ye.push(le),++E}this.maxHeight=0;let T=new Array,I=new Set,D=$=>{$!=null&&I.add($)},O=($,Y)=>{$!=null&&T.push({buildingId:$,footprintIndex:Y})},R=64*(t.length-E),B=R/2;this.buildingWithFacade.reserve(R,B,!0),this.buildingWithoutFacade.reserve(2*R,2*B,!1),this.footprintsIndices.reserve(16*(t.length-E)),this.footprintsVertices.reserve(8*(t.length-E));for(let{feature:$,id:Y,index:J,sourceLayerIndex:ie}of t){if(uF[$.type]==="LineString")continue;let he=this.layers[0]._featureFilter.needGeometry;if(he&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),$,u))continue;let le=null;if($.properties&&$.properties.hasOwnProperty("building_id")&&(le=$.properties.building_id,I.has(le)))continue;let me=De($,he);if(!he&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),me,u))continue;let ye=he?me.geometry:_e($,u,h),we=Uv(ye,500),je=!1;for(let nn of we)if(nn.length!==1){je=!0;break}if(je){D(le);continue}if(!j8(ye,163)){D(le);continue}let Ae=this.layers[0],We=$8(Ae.layout.get("building-roof-shape").evaluate($,{},u)),Ke=Ae.layout.get("building-base").evaluate($,{},u),Qe=Ae.layout.get("building-height").evaluate($,{},u),at=Ae.layout.get("building-flood-light-ground-radius").evaluate($,{},u),ct=Ae.paint.get("building-ambient-occlusion-intensity"),nt=at/this.tileToMeter;$.properties["building-part"]="roof";let it=Ae.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),qe=Ae.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="wall";let He=Ae.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),rt=Ae.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="window";let xt=Ae.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),ft=Ae.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="door";let qt=Ae.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),It=Ae.paint.get("building-emissive-strength").evaluate($,{},this.canonical),Rt=Ae.layout.get("building-flood-light-wall-radius").evaluate($,{},u);Rt=G(Rt,0,2048);let Bt=Rt/2048*iw,In=v.get(Y),mt=b.get(In)||[],Ut=mt.length!==0&&Ae.layout.get("building-facade").evaluate($,{},u);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(Ut,!1,1);let dn=0,Ln=0,zn=0,_n=0,_i=0,ce=0,pe=0,Ze=0,lt=0,Et=0,St=0;if(Ut){let nn=Math.round(Ae.layout.get("building-facade-floors").evaluate($,{},u));if(Ke===0){nn=Math.max(1,nn-(mt.length>0?1:0));let pi=4;if(Qe>100){let Qi=[10,13,15];pi=Qi[$.id?$.id%Qi.length:0]}else Qe<=10&&(pi=3);m.setFacadeOptions(pi,!0),_i=(Qe<15?1.3:1.61803)*pi/g}else _i=Ke/g;ce=Qe/g,_i=Math.min(_i,ce),zn=Ae.layout.get("building-facade-unit-width").evaluate($,{},u)/g,_n=(ce-_i)/nn,m.setFauxFacadeOptions(!0,!0,zn);let or=Ae.layout.get("building-facade-window").evaluate($,{},u);dn=or[0],Ln=or[1],pe=Math.floor(65535*Math.min(1,_i/yt)),Ze=Math.floor(65535*Math.min(1,ce/yt)),lt=Math.floor(255*dn)<<8|Math.floor(255*Ln),Et=Math.floor(65535*Math.min(1,zn/yt)),St=Math.floor(65535*Math.min(1,_n/yt))}let Wt=Array(we.length),Yt={x:1/0,y:1/0},mn={x:-1/0,y:-1/0},En={x:0,y:0},Tn=0;for(let nn=0;nn<we.length;nn++){let or=we[nn];if(or.length>0){let pi=[],Qi=Array(or.length+1);Qi[0]=0;for(let eo=0;eo<or.length;eo++){let mo=or[eo];for(let $r=0;$r<mo.length;$r++){let Hr=mo[mo.length-$r-1];Yt.x=Math.min(Yt.x,Hr.x),Yt.y=Math.min(Yt.y,Hr.y),mn.x=Math.max(mn.x,Hr.x),mn.y=Math.max(mn.y,Hr.y),En.x+=Hr.x,En.y+=Hr.y,Tn++,pi.push(Hr.x),pi.push(Hr.y)}Qi[eo+1]=pi.length}Wt[nn]={id:$.id?$.id:0,height:Qe,minHeight:Ke,sourceId:0,roofType:We,coordinates:pi,ringIndices:Qi}}}En.x/=Tn||1,En.y/=Tn||1;let On=m.generateMesh(Wt,mt);if(typeof On=="string"){Pt(`Unable to generate building ${$.id}: ${On}`),D(le);continue}if(On.meshes.length===0||On.modifiedPolygonRings.length===0){D(le);continue}let rn=Ut?this.buildingWithFacade:this.buildingWithoutFacade,un=0;for(let nn of On.meshes)un+=nn.positions.length/3;let Hn=rn.segmentsBucket.prepareSegment(un,rn.layoutVertexArray,rn.indexArray),Xn=[],Kn=null,hi=0,Mi=-1,vi=rn.layoutVertexArray.length,ei=vi+un;rn.layoutVertexArray.resize(ei),rn.layoutCentroidArray.resize(ei),rn.layoutNormalArray.resize(ei),rn.layoutAOArray.resize(ei),rn.layoutColorArray.resize(ei),rn.layoutFloodLightDataArray.resize(ei),Ut&&(rn.layoutFacadePaintArray.resize(ei),rn.layoutFacadeDataArray.resize(ei),rn.layoutFacadeVerticalRangeArray.resize(ei));let oi=rn.indexArray.length,Sn=0,Nn=vi;for(let nn of On.meshes){let or,pi;if(nn.buildingPart===1)or=it,pi=qe;else if(nn.buildingPart===0)or=He,pi=rt;else if(nn.buildingPart===2)or=xt,pi=ft;else{if(nn.buildingPart!==3)continue;or=qt,pi=It}if(pi=G(pi,0,1),nn.buildingPart===3){let Bi=new Array;for(let to=0;to<nn.positions.length;to+=12){let Dl=nn.positions[to+0],hu=nn.positions[to+1],No=nn.positions[to+3],vs=nn.positions[to+4],aa=nn.positions[to+2],Ih=nn.positions[to+8]-aa,qg=1,xc=No-Dl,bc=vs-hu,wy=Math.hypot(xc,bc);Bi.push({pos:[Dl+.5*xc,hu+.5*bc,aa],normal:[bc/wy,-xc/wy,0],width:wy,height:Ih,depth:qg,points:[Dl,hu,No,vs]})}let Er=rn.entranceBloom.segmentsBucket.prepareSegment(10*Bi.length,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.indexArray),Ar=rn.entranceBloom.layoutVertexArray.length;hi=rn.entranceBloom.indexArray.length,aF(Bi,.5/this.tileToMeter,rn.entranceBloom.indexArray,rn.entranceBloom.layoutVertexArray,rn.entranceBloom.layoutAttenuationArray);let Us=rn.entranceBloom.layoutVertexArray.length-Ar;Mi=rn.entranceBloom.indexArray.length-hi;for(let to=0;to<Us;to++)rn.entranceBloom.layoutColorArray.emplaceBack(255*qt.r<<8|255*qt.g,255*qt.b<<8|51*It);Er.vertexLength+=Us,Er.primitiveLength+=Mi,Kn={part:nn.buildingPart,vertexOffset:Ar,vertexLength:Us}}rn.layoutVertexArray.float32.set(nn.positions,3*Nn);let Qi=nn.positions.length/3;for(let Bi=0;Bi<Qi;++Bi){let Er=3*Bi;Sn=Math.max(Sn,nn.positions[Er+2]);let Ar=nn.normals[Er+1]*iw,Us=nn.normals[Er+2]*iw,to=3*(Nn+Bi);rn.layoutNormalArray.int16[to]=nn.normals[Er]*iw,rn.layoutNormalArray.int16[to+1]=Ar,rn.layoutNormalArray.int16[to+2]=Us;let Dl=nn.ao[Bi];rn.layoutAOArray.uint8[Nn+Bi]=255*Dl;let hu=1+(Dl-1)*ct,No=255*or.b*hu<<8|255*pi;rn.layoutColorArray.uint16[2*(Nn+Bi)]=255*or.r*hu<<8|255*or.g*hu,rn.layoutColorArray.uint16[2*(Nn+Bi)+1]=No}let eo=Math.floor(En.x),mo=Math.floor(En.y),$r=Math.floor(Qe);for(let Bi=0;Bi<Qi;++Bi){let Er=3*(Nn+Bi);rn.layoutCentroidArray.int16[Er]=eo,rn.layoutCentroidArray.int16[Er+1]=mo,rn.layoutCentroidArray.int16[Er+2]=$r}if(rn.layoutFloodLightDataArray.uint16.fill(nn.buildingPart===0?Bt:0,Nn,Nn+Qi),Ut){let Bi=255*xt.r<<8|255*xt.g,Er=255*xt.b<<8|255*ft;for(let Ar=0;Ar<Qi;++Ar){let Us=2*(Nn+Ar);rn.layoutFacadePaintArray.uint16[Us]=Bi,rn.layoutFacadePaintArray.uint16[Us+1]=Er}for(let Ar=0;Ar<Qi;++Ar)if(nn.isFauxFacade[Ar]){let Us=Math.min(65535,Math.floor(nn.uv[2*Ar]*On.outerRingLength));rn.layoutFacadeDataArray.emplace(Nn+Ar,1|Us,lt,Et,St),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Ar,pe,Ze)}else rn.layoutFacadeDataArray.emplace(Nn+Ar,0,0,0,0),rn.layoutFacadeVerticalRangeArray.emplace(Nn+Ar,0,0)}let Hr=Hn.vertexLength,ao=nn.indices.length/3,Os=rn.indexArray.length;rn.indexArray.resize(Os+ao);for(let Bi=0;Bi<ao;++Bi){let Er=3*Bi,Ar=3*Os+Er;rn.indexArray.uint16[Ar]=Hr+nn.indices[Er],rn.indexArray.uint16[Ar+1]=Hr+nn.indices[Er+1],rn.indexArray.uint16[Ar+2]=Hr+nn.indices[Er+2]}nn.buildingPart!==1&&nn.buildingPart!==0&&nn.buildingPart!==2&&nn.buildingPart!==3||Xn.push({part:nn.buildingPart,vertexOffset:Nn,vertexLength:nn.positions.length/3}),Nn+=Qi,Hn.vertexLength+=Qi,Hn.primitiveLength+=nn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Sn);let tr=rn.indexArray.length-oi,tn=this.footprintsIndices.length,Rn=this.footprintsVertices.length,wi=[],Ri=new st(1/0,1/0),ji=new st(-1/0,-1/0),Dr=this.groundEffect.vertexArray.length;for(let nn of On.modifiedPolygonRings){let or=[],pi=new st(1/0,1/0),Qi=new st(-1/0,-1/0);for(let eo=0;eo<nn.length;eo+=2){let mo=nn.length-eo-2;pi.x=Math.min(pi.x,nn[mo]),pi.y=Math.min(pi.y,nn[mo+1]),Qi.x=Math.max(Qi.x,nn[mo]),Qi.y=Math.max(Qi.y,nn[mo+1]);let $r=new st(nn[mo],nn[mo+1]);or.push($r),wi.push($r.x,$r.y),this.footprintsVertices.emplaceBack($r.x,$r.y)}Ri.x=Math.min(Ri.x,pi.x),Ri.y=Math.min(Ri.y,pi.y),ji.x=Math.max(ji.x,Qi.x),ji.y=Math.max(ji.y,Qi.y),this.groundEffect.addData(or,[pi,Qi],nt)}let zi=this.groundEffect.vertexArray.length-Dr;this.groundEffect.groundRadiusArray.reserveForAdditional(zi);for(let nn=0;nn<zi;nn++)this.groundEffect.groundRadiusArray.emplaceBack(at);(Yt.x<0||mn.x>yt||Yt.y<0||mn.y>yt)&&this.featuresOnBorder.push({featureId:$.id,footprintIndex:this.footprints.length});{let nn=Ig(wi,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+nn.length),this.footprintsIndices.uint16.set(nn,tn),this.buildingIds.add(le??$.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Ri.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Ri.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ji.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ji.y);let or={footprintVertexOffset:Rn,footprintVertexLength:this.footprintsVertices.length-Rn,footprintIndexOffset:tn,footprintIndexLength:this.footprintsIndices.length-tn,min:Ri,max:ji,hiddenFlags:0,indicesOffset:oi,indicesLength:tr,bloomIndicesOffset:hi,bloomIndicesLength:Mi,groundEffectVertexOffset:Dr,groundEffectVertexLength:zi,hasFauxFacade:Ut,height:Sn,promoteId:Y,feature:me,parts:Xn,buildingBloom:Kn},pi=this.footprints.length;$.id!==void 0&&this.featureFootprintLookup.set($.id,pi),O(le,pi),this.footprints.push(or)}this.programConfigurations.populatePaintArrays(rn.layoutVertexArray.length,$,J,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData($,J,{},s.availableImages,u,s.brightness),s.featureIndex.insert($,ye,J,ie,this.index,vi)}T.forEach(({buildingId:$,footprintIndex:Y})=>{I.has($)&&(this.footprints[Y].hiddenFlags|=4)});let H=new Set;this.buildingIds.forEach(($,Y,J)=>{I.has($)||H.add($)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(t,s,u,h,m,g,v){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v),this.groundEffect.update(t,s,m,u,h,g,v),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){let s=u=>{u.layoutVertexBuffer=t.createVertexBuffer(u.layoutVertexArray,lF.members),u.layoutNormalBuffer=t.createVertexBuffer(u.layoutNormalArray,F8.members),u.layoutCentroidBuffer=t.createVertexBuffer(u.layoutCentroidArray,L8.members),u.layoutFloodLightDataBuffer=t.createVertexBuffer(u.layoutFloodLightDataArray,U8.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=t.createVertexBuffer(u.layoutFacadeDataArray,z8.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(u.layoutFacadeVerticalRangeArray,B8.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(u.entranceBloom.layoutVertexArray,lF.members),u.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,V8.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){let t=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,s,u=!0){let h=!1,m=u?s:0,g=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let v of t){let b=this.footprints[v],E=b.hiddenFlags&g|m;b.hiddenFlags!==E&&(b.hiddenFlags=E,h=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;let s=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(let h of this.footprints){let m=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let b=h.indicesOffset;b<g;b++)m.indexArrayForConflation.uint16[3*b+0]=0,m.indexArrayForConflation.uint16[3*b+1]=0,m.indexArrayForConflation.uint16[3*b+2]=0;let v=h.bloomIndicesOffset+h.bloomIndicesLength;for(let b=h.bloomIndicesOffset;b<v;b++)m.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}let u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=t.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=t.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){let s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=t.createVertexBuffer(u.layoutColorArray,cF.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=t.createVertexBuffer(u.layoutFacadePaintArray,N8.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=t.createVertexBuffer(u.entranceBloom.layoutColorArray,cF.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,s){let u=t.paint.get("building-ambient-occlusion-intensity");for(let h of this.footprints){if(4&h.hiddenFlags)continue;let m=s[h.promoteId],g=h.feature;g.properties["building-part"]="roof";let v=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),b=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";let E=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),T=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";let I=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),D=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";let O=t.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),R=t.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),B=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(let $ of h.parts){let Y,J=v;$.part===1?(J=v,Y=b):$.part===0?(J=E,Y=T):$.part===2?(J=I,Y=D):$.part===3&&(J=O,Y=R),Y=G(Y,0,1);for(let ie=0;ie<$.vertexLength;ie++){let he=$.vertexOffset+ie,le=1+(B.layoutAOArray.uint8[he]/255-1)*u;B.layoutColorArray.emplace(he,J.r*le*255<<8|J.g*le*255,J.b*le*255<<8|255*Y),h.hasFauxFacade&&B.layoutFacadePaintArray.emplace(he,255*I.r<<8|255*I.g,255*I.b<<8|255*D)}}let H=h.buildingBloom;if(H)for(let $=0;$<H.vertexLength;$++)B.entranceBloom.layoutColorArray.emplace(H.vertexOffset+$,255*O.r<<8|255*O.g,255*O.b<<8|51*R)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let h=s.getReplacementRegionsForTile(t.toUnwrapped());if($1(this.activeReplacements,h))return;this.activeReplacements=h;for(let g of this.footprints)g.hiddenFlags&=-2;let m=[];for(let g of this.activeReplacements){if(g.order<=hk)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));for(let b of this.footprints)b.min.x>g.max.x||b.max.x<g.min.x||b.min.y>g.max.y||b.max.y<g.min.y||(m.length=0,G8(this.footprintsVertices,b.footprintVertexOffset,b.footprintVertexLength,g.footprintTileId.canonical,t.canonical,m),NI(g.footprint,m,this.footprintsIndices.uint16,b.footprintIndexOffset,b.footprintIndexLength,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(t){if(t.id!==void 0){let s=this.featureFootprintLookup.get(t.id);return this.footprints[s]}return null}getHeightAtTileCoord(t,s){let u=Number.NEGATIVE_INFINITY,h=!0,m=4*(t+yt)*yt+(s+yt);if(this.footprintLookup.hasOwnProperty(m)){let v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}let g=new st(t,s);for(let v of this.footprints)t>v.max.x||v.min.x>t||s>v.max.y||v.min.y>s||v.height<=u||H8(g,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(u=v.height,this.footprintLookup[m]=v,h=v.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[m]=void 0}}function H8(l,t,s){for(let u=0;u<s.length;u+=3){let h=s[u],m=s[u+1],g=s[u+2],v=t[2*h+0],b=t[2*h+1],E=t[2*m+0],T=t[2*m+1],I=t[2*g+0],D=t[2*g+1],O=(v-I)*(l.y-D)-(b-D)*(l.x-I),R=(E-v)*(l.y-b)-(T-b)*(l.x-v);if(O<0!=R<0&&O!==0&&R!==0)continue;let B=(I-E)*(l.y-T)-(D-T)*(l.x-E);if(B===0||B<0==O+R<=0)return!0}return!1}function G8(l,t,s,u,h,m){let g=Math.pow(2,u.z-h.z);for(let v=0;v<s;v++){let b=l.float32[2*(v+t)+0],E=l.float32[2*(v+t)+1];b=(b+h.x*yt)*g-u.x*yt,E=(E+h.y*yt)*g-u.y*yt,m.push(new st(b,E))}}let hF,pF;Lt(dF,"BuildingBucket",{omit:["layers"]}),Lt(rM,"BuildingGeometry"),Lt(iM,"BuildingBloomGeometry");let q8=Pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),W8=Pn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Z8}=q8,Y8=Pn([{name:"a_packed",components:3,type:"Float32"}]),{members:X8}=Y8,K8=Pn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Q8}=K8;class fF{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new wh({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){let u=this.getKey(t,s);return this.positions[u]}trim(){let t=this.width,s=this.height=ze(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,u){let h=[],m=t.length%2==1?-t[t.length-1]*u:0,g=t[0]*u,v=!0;h.push({left:m,right:g,isDash:v,zeroLength:t[0]===0});let b=t[0];for(let E=1;E<t.length;E++){v=!v;let T=t[E];m=b*u,b+=T,g=b*u,h.push({left:m,right:g,isDash:v,zeroLength:T===0})}return h}addRoundDash(t,s,u){let h=s/2;for(let m=-u;m<=u;m++){let g=this.width*(this.nextRow+u+m),v=0,b=t[v];for(let E=0;E<this.width;E++){E/b.right>1&&(b=t[++v]);let T=Math.abs(E-b.left),I=Math.abs(E-b.right),D=Math.min(T,I),O,R=m/u*(h+1);if(b.isDash){let B=h-Math.abs(R);O=Math.sqrt(D*D+B*B)}else O=h-Math.sqrt(D*D+R*R);this.image.data[g+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,s){for(let b=t.length-1;b>=0;--b){let E=t[b],T=t[b+1];E.zeroLength?t.splice(b,1):T&&T.isDash===E.isDash&&(T.left=E.left,t.splice(b,1))}let u=t[0],h=t[t.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);let m=this.width*this.nextRow,g=0,v=t[g];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++g]);let E=Math.abs(b-v.left),T=Math.abs(b-v.right),I=Math.min(E,T);this.image.data[m+b]=Math.max(0,Math.min(255,(v.isDash?I:-I)+s+128))}}addDash(t,s){let u=this.getKey(t,s);if(this.positions[u])return this.positions[u];let h=s==="round",m=h?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Pt("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let T=0;T<t.length;T++)t[T]<0&&(Pt("Negative value is found in line dasharray, replacing values with 0"),t[T]=0),v+=t[T];if(v!==0){let T=this.width/v,I=this.getDashRanges(t,this.width,T);h?this.addRoundDash(I,T,m):this.addRegularDash(I,s==="square"?.5*T:0)}let b=this.nextRow+m;this.nextRow+=g;let E={tl:[b,m],br:[v,0]};return this.positions[u]=E,E}}Lt(fF,"LineAtlas");let J8=Ce.types,e$=Math.cos(Math.PI/180*37.5),t$=Math.cos(Math.PI/180*5);class oM{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new lg,this.layoutVertexArray2=new na,this.patternVertexArray=new na,this.indexArray=new Kr,this.programConfigurations=new Ka(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new nr,this.maxLineLength=0,this.zOffsetVertexArray=new na,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:yt/64,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.hasPattern=PI("line",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=q(u);let g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{let D=this.layers[0].layout.get("line-z-offset"),O=D.isConstant()&&!D.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&O?"none":"offset",this.elevationType==="offset"&&g==="none"&&Pt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;let b=[];for(let{feature:D,id:O,index:R,sourceLayerIndex:B}of t){let H=this.layers[0]._featureFilter.needGeometry,$=De(D,H);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),$,u))continue;let Y=m?m.evaluate($,{},u):void 0,J={id:O,properties:D.properties,type:D.type,sourceLayerIndex:B,index:R,geometry:H?$.geometry:_e(D,u,h),patterns:{},sortKey:Y};b.push(J)}m&&b.sort((D,O)=>D.sortKey-O.sortKey);let{lineAtlas:E,featureIndex:T}=s,I=this.addConstantDashes(E);for(let D of b){let{geometry:O,index:R,sourceLayerIndex:B}=D;if(I&&this.addFeatureDashes(D,E),this.hasPattern){let H=OI("line",this.layers,D,this.zoom,this.pixelRatio,s);this.patternFeatures.push(H)}else this.addFeature(D,O,R,u,E.positions,s.availableImages,s.brightness,s.elevationFeatures);T.insert(t[R].feature,O,R,B,this.index)}}addConstantDashes(t){let s=!1;for(let u of this.layers){let h=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")s=!0;else{let g=m.value,v=h.value;if(!v)continue;t.addDash(v,g)}}return s}addFeatureDashes(t,s){let u=this.zoom;for(let h of this.layers){let m=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let v,b;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:u},t);b=g.kind==="constant"?g.value:g.evaluate({zoom:u},t),s.addDash(v,b),t.patterns[h.id]=[s.getKey(v,b)]}}update(t,s,u,h,m,g,v,b){this.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,b)}addFeatures(t,s,u,h,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,g,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,X8)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,Q8)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,W8.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z8),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,s){let u,h;if(s&&s>0?(u=`mapbox_clip_start_${s}`,h=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",h="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(u)&&t.properties.hasOwnProperty(h))return{start:+t.properties[u],end:+t.properties[h]}}addFeature(t,s,u,h,m,g,v,b){let E=this.layers[0].layout,T=E.get("line-join").evaluate(t,{}),I=E.get("line-cap").evaluate(t,{}),D=E.get("line-miter-limit"),O=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;let R=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;let B=this.layers[0].paint.get("line-width").value;if(B.kind!=="constant"&&B.isLineProgressConstant===!1&&(this.variableWidthValue=B),this.elevationType==="road"){let H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,s,h,b,T,I,D,O)){let[$,Y]=this.clipRuntimeLinesToTile(s,1);for(let J=0;J<$.length;J++){let ie=$[J],he=Y[J],le={progress:{min:he.progress.min,max:he.progress.max},nextDir:this.computeSegNextDir(he,ie),prevDir:this.computeSegPrevDir(he,ie)};this.addLine(ie,t,h,T,I,D,O,le,R&&he.parentIndex>0?he.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<s.length;H++)this.addLine(s[H],t,h,T,I,D,O,void 0,R&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,m,g,h,v,void 0,this.worldview)}computeSegNextDir(t,s){return t.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(t,s){return s[1].sub(t.prevPoint).unit()}clipLinesToTile(t,s){return q1(t,-s,-s,yt+s,yt+s)}clipRuntimeLinesToTile(t,s){let u=[];return[q1(t,-s,-s,yt+s,yt+s,u),u]}addElevatedRoadFeature(t,s,u,h,m,g,v,b){let E=[],T=ii.getElevationFeature(t,h);if(T){let I=this.clipLinesToTile(s,1),D=this.prepareElevatedLines(I,T,u);for(let O of D)E.push({geometry:O,elevation:T,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(let I of E){let D=this.layoutVertexArray.length;this.addLine(I.geometry,t,u,m,g,v,b);let O=new gi(u,I.elevationTileID);if(I.elevation)for(let R=D;R<this.layoutVertexArray.length;R++){let B=new st(this.layoutVertexArray.int16[6*R]>>1,this.layoutVertexArray.int16[6*R+1]>>1),H=O.pointElevation(B,I.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(t,s,u){if(s.constantHeight!=null)return t;let h=[],m=1/q(u);for(let g of t)d8(g,new Yn(s,m),0,h);return h}fillNonElevatedRoadSegment(t){for(let s=t;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,s,u,h,m,g,v,b,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(s,E):this.lineClips;let T=h==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let I=b&&b.progress.min>0,D=b&&b.progress.max<1;if(this.lineClips){let we={min:this.lineClips.start,max:this.lineClips.end},je=1;if(b){let Ke=this.lineClips.end-this.lineClips.start;we=(function(Qe,at,ct){return{min:Oi(Qe.min,at,ct),max:Oi(Qe.max,at,ct)}})(b.progress,{min:0,max:1},we),Ke>0&&(je=(we.max-we.min)/Ke)}let Ae=+s.properties.mapbox_clip_feature_len,We=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Ae)||Number.isNaN(We)){for(let Qe=0;Qe<t.length-1;Qe++)this.totalDistance+=t[Qe].dist(t[Qe+1]);let Ke=this.totalDistance/(we.max-we.min);this.totalFeatureLength=Number.isFinite(Ke)?Ke:0,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ae,this.distance=We*je,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let O=J8[s.type]==="Polygon",R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let B=0;for(;B<R-1&&t[B].equals(t[B+1]);)B++;if(R<(O?3:2))return;h==="bevel"&&(g=1.05);let H=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray),$,Y,J,ie,he,le,me,ye;b&&b.prevDir&&(le=b.prevDir.perp()),b&&b.nextDir&&(me=b.nextDir.perp()),this.e1=this.e2=-1,O&&($=t[R-2],he=t[B].sub($)._unit()._perp());for(let we=B;we<R;we++){if(J=we===R-1?O?t[B+1]:void 0:t[we+1],J&&t[we].equals(J))continue;he&&(ie=he),$&&(Y=$),$=t[we],ye=this.evaluateLineProgressFeatures(Y?Y.dist($):0),he=J?J.sub($)._unit()._perp():ie,ie=ie||he;let je=Y&&J,Ae=je?h:O||T?"butt":m,We=ie.x*he.x+ie.y*he.y;if(T){let He=function(rt){if(rt.patternJoinNone){let xt=rt.segmentPoints.length/2,ft=rt.lineSoFar-rt.segmentStart;for(let qt=0;qt<xt;++qt){let It=rt.segmentPoints[2*qt+1],Rt=Math.round(rt.segmentPoints[2*qt])+.5+.25*It;rt.patternVertexArray.emplaceBack(Rt,ft,rt.segmentStart),rt.patternVertexArray.emplaceBack(Rt,ft,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(je&&We<t$){this.updateDistance(Y,$),this.addCurrentVertex($,ie,1,1,H,ye),He(this),this.addCurrentVertex($,he,-1,-1,H,ye);continue}if(Y){if(!J){this.updateDistance(Y,$),this.addCurrentVertex($,ie,1,1,H,ye),He(this);continue}Ae="miter"}}let Ke=ie.add(he);Ke.x===0&&Ke.y===0||Ke._unit();let Qe=Ke.x*he.x+Ke.y*he.y,at=Qe!==0?1/Qe:1/0,ct=2*Math.sqrt(2-2*Qe),nt=Qe<e$&&Y&&J,it=ie.x*he.y-ie.y*he.x>0,qe=this.overscaling<=16?15*yt/(512*this.overscaling):0;if(je&&Ae==="round"){if(at<v)Ae="miter";else if(at<=2){let He=sM($,-10,yt+10);Ae=this.elevationType==="offset"&&(He||this.hasCrossSlope)?"miter":"fakeround"}}if(Ae==="miter"&&at>g&&(Ae="bevel"),Ae==="bevel"&&(at>2&&(Ae="flipbevel"),at<g&&(Ae="miter")),Y&&!(Ae==="miter"&&nt)&&this.updateDistance(Y,$),Ae==="miter")if(nt){let He=$.dist(Y);if(He>2*qe){let xt=$.sub($.sub(Y)._mult(qe/He)._round());this.updateDistance(Y,xt),this.addCurrentVertex(xt,ie,0,0,H,ye),Y=xt}this.updateDistance(Y,$),Ke._mult(at),this.addCurrentVertex($,Ke,0,0,H,ye);let rt=$.dist(J);if(rt>2*qe){let xt=$.add(J.sub($)._mult(qe/rt)._round());this.updateDistance($,xt),this.addCurrentVertex(xt,he,0,0,H,ye),$=xt}}else Ke._mult(at),this.addCurrentVertex($,Ke,0,0,H,ye);else if(Ae==="flipbevel"){if(at>100)Ke=he.mult(-1);else{let He=at*ie.add(he).mag()/ie.sub(he).mag();Ke._perp()._mult(He*(it?-1:1))}this.addCurrentVertex($,Ke,0,0,H,ye),this.addCurrentVertex($,Ke.mult(-1),0,0,H,ye)}else if(Ae==="bevel"||Ae==="fakeround"){ye!=null&&Y&&this.addCurrentVertex($,me||ie,-1,-1,H,ye);let He=$.dist(Y)<=2*qe&&Ae!=="bevel",rt=Ke.mult(it?1:-1);rt._mult(at);let xt=he.mult(it?-1:1),ft=ie.mult(it?-1:1),qt=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex($,rt.x,rt.y,!1,!it,0,H,qt),He||this.addHalfVertex($,rt.x+2*ft.x,rt.y+2*ft.y,!1,it,0,H,qt)),Ae==="fakeround"){let It=Math.round(180*ct/Math.PI/20);this.addHalfVertex($,ft.x,ft.y,!1,it,0,H,qt);for(let Rt=0;Rt<It;Rt++){let Bt=Rt/It;if(Bt!==.5){let mt=Bt-.5;Bt+=Bt*mt*(Bt-1)*((1.0904+We*(We*(3.55645-1.43519*We)-3.2452))*mt*mt+(.848013+We*(.215638*We-1.06021)))}let In=xt.sub(ft)._mult(Bt)._add(ft)._unit();this.addHalfVertex($,In.x,In.y,!1,it,0,H,qt)}this.addHalfVertex($,xt.x,xt.y,!1,it,0,H,qt)}He||ye!=null||this.addHalfVertex($,rt.x+2*xt.x,rt.y+2*xt.y,!1,it,0,H,qt),ye!=null&&J&&this.addCurrentVertex($,le||he,1,1,H,ye)}else if(Ae==="butt")this.addCurrentVertex($,Ke,0,0,H,ye);else if(Ae==="square"){if(!Y){let He=I?0:-1;this.addCurrentVertex($,Ke,He,He,H,ye)}if(this.addCurrentVertex($,Ke,0,0,H,ye),Y){let He=D?0:1;this.addCurrentVertex($,Ke,He,He,H,ye)}}else if(Ae==="round"){if(Y){let He=!je&&me?me:ie;this.addCurrentVertex($,He,0,0,H,ye),!je&&D||this.addCurrentVertex($,He,1,1,H,ye,!0)}if(J){let He=!je&&le?le:he;!je&&I||this.addCurrentVertex($,He,-1,-1,H,ye,!0),this.addCurrentVertex($,He,0,0,H,ye)}}}}addVerticesTo(t,s,u,h,m,g,v,b,E,T){let I=(s.w-t.w)/this.tessellationStep|0,D=0,O=this.scaledDistance;if(I>1){this.lineSoFar=t.w;let B=(s.x-t.x)/I,H=(s.y-t.y)/I,$=(s.z-t.z)/I,Y=(s.w-t.w)/I;for(let J=1;J<I;++J){t.x+=B,t.y+=H,t.z+=$,this.lineSoFar+=Y,D+=Y;let ie=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(t,u,h,T,!1,v,E,ie),this.addHalfVertex(t,m,g,T,!0,-b,E,ie)}}this.lineSoFar=s.w,this.scaledDistance=O;let R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,h,T,!1,v,E,R),this.addHalfVertex(s,m,g,T,!0,-b,E,R)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Pt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(t,s,u,h,m,g,v=!1){let b=s.x+s.y*u,E=s.y-s.x*u,T=s.y*h-s.x,I=-s.y-s.x*h;if(g!=null){let D=this.elevationType==="offset",O=-10,R=yt+10,B=g.zOffset,H=new Lk(t.x,t.y,B,this.lineSoFar),$=!!D&&sM(t,O,R),Y=this.lineSoFar,J=this.distance;if(this.currentVertex)if($){let ie=this.currentVertexIsOutside,he=this.currentVertex,le=new Lk(t.x,t.y,B,this.lineSoFar);if(zk(he,le,O,R),!sM(le,O,R)){if(ie){this.e1=this.e2=-1,this.distance-=he.dist(H),this.lineSoFar=he.w;let me=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,b,E,v,!1,u,m,me),this.addHalfVertex(he,T,I,v,!0,-h,m,me),this.prevDistance=this.distance}this.distance=this.prevDistance+he.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(he,le,b,E,T,I,u,h,m,v),this.distance=J,this.scaledDistance=this.distance/this.totalDistance}}else{let ie=this.currentVertex;if(this.currentVertexIsOutside){zk(ie,H,O,R),this.e1=this.e2=-1,this.distance-=ie.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;let he=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,b,E,v,!1,u,m,he),this.addHalfVertex(ie,T,I,v,!0,-h,m,he),this.prevDistance=this.distance,this.distance=J,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,H,b,E,T,I,u,h,m,v)}else $||(this.addHalfVertex(t,b,E,v,!1,u,m,g),this.addHalfVertex(t,T,I,v,!0,-h,m,g));this.currentVertex=H,this.currentVertexIsOutside=$,this.lineSoFar=Y}else this.addHalfVertex(t,b,E,v,!1,u,m,g),this.addHalfVertex(t,T,I,v,!0,-h,m,g)}addHalfVertex({x:t,y:s},u,h,m,g,v,b,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let I=on(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,I)}let T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),g?this.e2=T:this.e1=T,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,s){this.prevDistance=this.distance,this.distance+=t.dist(s),this.updateScaledDistance()}}function sM(l,t,s){return l.x<t||l.x>s||l.y<t||l.y>s}let mF,gF;function _F(l,t,s){return t*(yt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Lt(oM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let vF=(l,t,s)=>(1-s)*l+s*t;function yF(l,t){return 1/_F(l,1,t.tileZoom)}function xF(l,t,s,u){return l.translatePosMatrix(u||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}let bF=l=>{let t=[];wF(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");let u=l.layout.get("line-join").constantOr("miter")==="none",h=!!l.paint.get("line-pattern").constantOr(1);return u&&h&&t.push("LINE_JOIN_NONE"),t};function wF(l){let t=l.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let aM,CF=()=>aM||(aM={layout:mF||(mF=new gr({"line-cap":new Ct(Oe.layout_line["line-cap"]),"line-join":new Ct(Oe.layout_line["line-join"]),"line-miter-limit":new gt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new gt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Ct(Oe.layout_line["line-sort-key"]),"line-z-offset":new Ct(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new gt(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new gt(Oe.layout_line["line-cross-slope"]),visibility:new gt(Oe.layout_line.visibility),"line-width-unit":new gt(Oe.layout_line["line-width-unit"])})),paint:gF||(gF=new gr({"line-opacity":new Ct(Oe.paint_line["line-opacity"]),"line-color":new Ct(Oe.paint_line["line-color"]),"line-translate":new gt(Oe.paint_line["line-translate"]),"line-translate-anchor":new gt(Oe.paint_line["line-translate-anchor"]),"line-width":new Ct(Oe.paint_line["line-width"]),"line-gap-width":new Ct(Oe.paint_line["line-gap-width"]),"line-offset":new Ct(Oe.paint_line["line-offset"]),"line-blur":new Ct(Oe.paint_line["line-blur"]),"line-dasharray":new Ct(Oe.paint_line["line-dasharray"]),"line-pattern":new Ct(Oe.paint_line["line-pattern"]),"line-pattern-cross-fade":new gt(Oe.paint_line["line-pattern-cross-fade"]),"line-gradient":new pd(Oe.paint_line["line-gradient"]),"line-trim-offset":new gt(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new gt(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new gt(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new Ct(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Ct(Oe.paint_line["line-border-width"]),"line-border-color":new Ct(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new gt(Oe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},aM);class n$ extends Ct{possiblyEvaluate(t,s){return s=new Ui(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(t,s)}evaluate(t,s,u,h){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,u,h)}}let Jv;function EF(l,t){return t>0?t+2*l:l}let i$=Pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r$=Pn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),o$=Pn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let s$=Pn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),a$=Pn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),l$=Pn([{name:"a_texb",components:2,type:"Uint16"}]),c$=Pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),u$=Pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let SF=Pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),d$=Pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pn([{name:"triangle",components:3,type:"Uint16"}]),Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Pn([{type:"Float32",name:"offsetX"}]),Pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;function h$(l,t,s){return l.sections.forEach(u=>{u.text=(function(h,m,g){let v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),sc.applyArabicShaping&&(h=sc.applyArabicShaping(h)),h})(u.text,t,s)}),l}let ey={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function p$(l){return l==="\uFE36"||l==="\uFE48"||l==="\uFE38"||l==="\uFE44"||l==="\uFE42"||l==="\uFE3E"||l==="\uFE3C"||l==="\uFE3A"||l==="\uFE18"||l==="\uFE40"||l==="\uFE10"||l==="\uFE13"||l==="\uFE14"||l==="\uFF40"||l==="\uFFE3"||l==="\uFE11"||l==="\uFE12"}function f$(l){return l==="\uFE35"||l==="\uFE47"||l==="\uFE37"||l==="\uFE43"||l==="\uFE41"||l==="\uFE3D"||l==="\uFE3B"||l==="\uFE39"||l==="\uFE17"||l==="\uFE3F"}let lM=4294967296,TF=1/lM,IF=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),rw=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,t,s=this.length){for(;this.pos<s;){let u=this.readVarint(),h=u>>3,m=this.pos;this.type=7&u,l(h,t,this),this.pos===m&&this.skip(u)}return t}readMessage(l,t){return this.readFields(l,t,this.readVarint()+this.pos)}readFixed32(){let l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){let l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){let l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*lM;return this.pos+=8,l}readSFixed64(){let l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*lM;return this.pos+=8,l}readFloat(){let l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){let l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){let t=this.buf,s,u;return u=t[this.pos++],s=127&u,u<128?s:(u=t[this.pos++],s|=(127&u)<<7,u<128?s:(u=t[this.pos++],s|=(127&u)<<14,u<128?s:(u=t[this.pos++],s|=(127&u)<<21,u<128?s:(u=t[this.pos],s|=(15&u)<<28,(function(h,m,g){let v=g.buf,b,E;if(E=v[g.pos++],b=(112&E)>>4,E<128||(E=v[g.pos++],b|=(127&E)<<3,E<128)||(E=v[g.pos++],b|=(127&E)<<10,E<128)||(E=v[g.pos++],b|=(127&E)<<17,E<128)||(E=v[g.pos++],b|=(127&E)<<24,E<128)||(E=v[g.pos++],b|=(1&E)<<31,E<128))return kg(h,b,m);throw new Error("Expected varint not more than 10 bytes")})(s,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){let l=this.readVarint()+this.pos,t=this.pos;return this.pos=l,l-t>=12&&IF?IF.decode(this.buf.subarray(t,l)):(function(s,u,h){let m="",g=u;for(;g<h;){let v=s[g],b,E,T,I=null,D=v>239?4:v>223?3:v>191?2:1;if(g+D>h)break;D===1?v<128&&(I=v):D===2?(b=s[g+1],(192&b)==128&&(I=(31&v)<<6|63&b,I<=127&&(I=null))):D===3?(b=s[g+1],E=s[g+2],(192&b)==128&&(192&E)==128&&(I=(15&v)<<12|(63&b)<<6|63&E,(I<=2047||I>=55296&&I<=57343)&&(I=null))):D===4&&(b=s[g+1],E=s[g+2],T=s[g+3],(192&b)==128&&(192&E)==128&&(192&T)==128&&(I=(15&v)<<18|(63&b)<<12|(63&E)<<6|63&T,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,D=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),g+=D}return m})(this.buf,t,l)}readBytes(){let l=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,l);return this.pos=l,t}readPackedVarint(l=[],t){let s=this.readPackedEnd();for(;this.pos<s;)l.push(this.readVarint(t));return l}readPackedSVarint(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFloat());return l}readPackedDouble(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){let t=this.readPackedEnd();for(;this.pos<t;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){let t=7&l;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(l,t){this.writeVarint(l<<3|t)}realloc(l){let t=this.length||16;for(;t<this.pos+l;)t*=2;if(t!==this.length){let s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*TF),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*TF),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?(function(t,s){let u,h;if(t>=0?(u=t%4294967296|0,h=t/4294967296|0):(u=~(-t%4294967296),h=~(-t/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(u,0,s),(function(m,g){let v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(h,s)})(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;let t=this.pos;this.pos=(function(u,h,m){for(let g,v,b=0;b<h.length;b++){if(g=h.charCodeAt(b),g>55295&&g<57344){if(!v){g>56319||b+1===h.length?(u[m++]=239,u[m++]=191,u[m++]=189):v=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(u[m++]=239,u[m++]=191,u[m++]=189,v=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m})(this.buf,l,this.pos);let s=this.pos-t;s>=128&&MF(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){let t=l.length;this.writeVarint(t),this.realloc(t);for(let s=0;s<t;s++)this.buf[this.pos++]=l[s]}writeRawMessage(l,t){this.pos++;let s=this.pos;l(t,this);let u=this.pos-s;u>=128&&MF(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(l,t,s){this.writeTag(l,2),this.writeRawMessage(t,s)}writePackedVarint(l,t){t.length&&this.writeMessage(l,m$,t)}writePackedSVarint(l,t){t.length&&this.writeMessage(l,g$,t)}writePackedBoolean(l,t){t.length&&this.writeMessage(l,y$,t)}writePackedFloat(l,t){t.length&&this.writeMessage(l,_$,t)}writePackedDouble(l,t){t.length&&this.writeMessage(l,v$,t)}writePackedFixed32(l,t){t.length&&this.writeMessage(l,x$,t)}writePackedSFixed32(l,t){t.length&&this.writeMessage(l,b$,t)}writePackedFixed64(l,t){t.length&&this.writeMessage(l,w$,t)}writePackedSFixed64(l,t){t.length&&this.writeMessage(l,C$,t)}writeBytesField(l,t){this.writeTag(l,2),this.writeBytes(t)}writeFixed32Field(l,t){this.writeTag(l,5),this.writeFixed32(t)}writeSFixed32Field(l,t){this.writeTag(l,5),this.writeSFixed32(t)}writeFixed64Field(l,t){this.writeTag(l,1),this.writeFixed64(t)}writeSFixed64Field(l,t){this.writeTag(l,1),this.writeSFixed64(t)}writeVarintField(l,t){this.writeTag(l,0),this.writeVarint(t)}writeSVarintField(l,t){this.writeTag(l,0),this.writeSVarint(t)}writeStringField(l,t){this.writeTag(l,2),this.writeString(t)}writeFloatField(l,t){this.writeTag(l,5),this.writeFloat(t)}writeDoubleField(l,t){this.writeTag(l,1),this.writeDouble(t)}writeBooleanField(l,t){this.writeVarintField(l,+t)}};function kg(l,t,s){return s?4294967296*t+(l>>>0):4294967296*(t>>>0)+(l>>>0)}function MF(l,t,s){let u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(u);for(let h=s.pos-1;h>=l;h--)s.buf[h+u]=s.buf[h]}function m$(l,t){for(let s=0;s<l.length;s++)t.writeVarint(l[s])}function g$(l,t){for(let s=0;s<l.length;s++)t.writeSVarint(l[s])}function _$(l,t){for(let s=0;s<l.length;s++)t.writeFloat(l[s])}function v$(l,t){for(let s=0;s<l.length;s++)t.writeDouble(l[s])}function y$(l,t){for(let s=0;s<l.length;s++)t.writeBoolean(l[s])}function x$(l,t){for(let s=0;s<l.length;s++)t.writeFixed32(l[s])}function b$(l,t){for(let s=0;s<l.length;s++)t.writeSFixed32(l[s])}function w$(l,t){for(let s=0;s<l.length;s++)t.writeFixed64(l[s])}function C$(l,t){for(let s=0;s<l.length;s++)t.writeSFixed64(l[s])}let cM=3;function E$(l,t,s){t.glyphs=[],l===1&&s.readMessage(S$,t)}function S$(l,t,s){if(l===3){let{id:u,bitmap:h,width:m,height:g,left:v,top:b,advance:E}=s.readMessage(T$,{});t.glyphs.push({id:u,bitmap:new wh({width:m+2*cM,height:g+2*cM},h),metrics:{width:m,height:g,left:v,top:b,advance:E}})}else l===4?t.ascender=s.readSVarint():l===5&&(t.descender=s.readSVarint())}function T$(l,t,s){l===1?t.id=s.readVarint():l===2?t.bitmap=s.readBytes():l===3?t.width=s.readVarint():l===4?t.height=s.readVarint():l===5?t.left=s.readSVarint():l===6?t.top=s.readSVarint():l===7&&(t.advance=s.readVarint())}let DF=cM,sa={horizontal:1,vertical:2,horizontalOnly:3};class ty{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,s){let u=new ty;return u.scale=t||1,u.fontStack=s,u}static forImage(t){let s=new ty;return s.image=t,s}}class Fg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s,u){let h=new Fg;for(let m=0;m<t.sections.length;m++){let g=t.sections[m];g.image?h.addImageSection(g,u):h.addTextSection(g,s)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(s,u){let h="";for(let m=0;m<s.length;m++){let g=s.charCodeAt(m+1)||null,v=s.charCodeAt(m-1)||null;h+=!u&&(g&&Km(g)&&!ey[s[m+1]]||v&&Km(v)&&!ey[s[m-1]])||!ey[s[m]]?s[m]:ey[s[m]]}return h})(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&ow[this.text.charCodeAt(u)];u++)t++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&ow[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){let u=new Fg;return u.text=this.text.substring(t,s),u.sectionIndex=this.sectionIndex.slice(t,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(ty.forText(t.scale,t.fontStack||s));let u=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(u)}addImageSection(t,s){let u=t.image?t.image.getPrimary():null;if(!u)return void Pt("Can't add FormattedSection with an empty image.");u.scaleSelf(s);let h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(ty.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Pt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function uM(l,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B=1){let H=Fg.fromFeature(l,h,B);I===sa.vertical&&H.verticalizePunctuation(D);let $=[],Y=(function(me,ye,we,je,Ae,We){if(!me)return[];let Ke=[],Qe=(function(it,qe,He,rt,xt,ft){let qt=0;for(let It=0;It<it.length();It++){let Rt=it.getSection(It);qt+=AF(it.getCodePoint(It),Rt,rt,xt,qe,ft)}return qt/Math.max(1,Math.ceil(qt/He))})(me,ye,we,je,Ae,We),at=me.text.indexOf("\u200B")>=0,ct=0;for(let it=0;it<me.length();it++){let qe=me.getSection(it),He=me.getCodePoint(it);if(ow[He]||(ct+=AF(He,qe,je,Ae,ye,We)),it<me.length()-1){let rt=!((nt=He)<11904||!(en["Bopomofo Extended"](nt)||en.Bopomofo(nt)||en["CJK Compatibility Forms"](nt)||en["CJK Compatibility Ideographs"](nt)||en["CJK Compatibility"](nt)||en["CJK Radicals Supplement"](nt)||en["CJK Strokes"](nt)||en["CJK Symbols and Punctuation"](nt)||en["CJK Unified Ideographs Extension A"](nt)||en["CJK Unified Ideographs"](nt)||en["Enclosed CJK Letters and Months"](nt)||en["Halfwidth and Fullwidth Forms"](nt)||en.Hiragana(nt)||en["Ideographic Description Characters"](nt)||en["Kangxi Radicals"](nt)||en["Katakana Phonetic Extensions"](nt)||en.Katakana(nt)||en["Vertical Forms"](nt)||en["Yi Radicals"](nt)||en["Yi Syllables"](nt)));(I$[He]||rt||qe.image)&&Ke.push(OF(it+1,ct,Qe,Ke,M$(He,me.getCodePoint(it+1),rt&&at),!1))}}var nt;return RF(OF(me.length(),ct,Qe,Ke,0,!0))})(H,E,m,t,u,O),{processBidirectionalText:J,processStyledBidirectionalText:ie}=sc;if(J&&H.sections.length===1){let me=J(H.toString(),Y);for(let ye of me){let we=new Fg;we.text=ye,we.sections=H.sections;for(let je=0;je<ye.length;je++)we.sectionIndex.push(0);$.push(we)}}else if(ie){let me=ie(H.text,H.sectionIndex,Y);for(let ye of me){let we=new Fg;we.text=ye[0],we.sectionIndex=ye[1],we.sections=H.sections,$.push(we)}}else $=(function(me,ye){let we=[],je=me.text,Ae=0;for(let We of ye)we.push(me.substring(Ae,We)),Ae=We;return Ae<je.length&&we.push(me.substring(Ae,je.length)),we})(H,Y);let he=[],le={positionedLines:he,text:H.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(me,ye,we,je,Ae,We,Ke,Qe,at,ct,nt,it){let qe=0,He=0,rt=0,xt=Qe==="right"?1:Qe==="left"?0:.5,ft=!1;for(let mt of Ae){let Ut=mt.getSections();for(let dn of Ut){if(dn.image)continue;let Ln=ye[dn.fontStack];if(Ln&&(ft=Ln.ascender!==void 0&&Ln.descender!==void 0,!ft))break}if(!ft)break}let qt=0;for(let mt of Ae){mt.trim();let Ut=mt.getMaxScale(),dn=(Ut-1)*fo,Ln={positionedGlyphs:[],lineOffset:0};me.positionedLines[qt]=Ln;let zn=Ln.positionedGlyphs,_n=0;if(!mt.length()){He+=We,++qt;continue}let _i=0,ce=0;for(let Ze=0;Ze<mt.length();Ze++){let lt=mt.getSection(Ze),Et=mt.getSectionIndex(Ze),St=mt.getCodePoint(Ze),Wt=lt.scale,Yt=null,mn=null,En=null,Tn=fo,On=0,rn=at;rn===sa.vertical&&((It=St)===12312||It===12313||It===12316||It===12540||It===12448)&&(rn=sa.horizontal);let un=!(rn===sa.horizontal||!nt&&!Xm(St)||nt&&(ow[St]||Qm(St)));if(lt.image){let Hn=je.get(lt.image.toString());if(!Hn)continue;En=lt.image,me.iconsInText=me.iconsInText||!0,mn=Hn.paddedRect;let Xn=Hn.displaySize;Wt=Wt*fo/it,Yt={width:Xn[0],height:Xn[1],left:0,top:-DF,advance:un?Xn[1]:Xn[0],localGlyph:!1},On=ft?-Yt.height*Wt:Ut*fo-17-Xn[1]*Wt,Tn=Yt.advance;let Kn=(un?Xn[0]:Xn[1])*Wt-fo*Ut;Kn>0&&Kn>_n&&(_n=Kn)}else{let Hn=we[lt.fontStack];if(!Hn)continue;Hn[St]&&(mn=Hn[St]);let Xn=ye[lt.fontStack];if(!Xn)continue;let Kn=Xn.glyphs[St];if(!Kn)continue;if(Yt=Kn.metrics,Tn=St!==8203?fo:0,ft){let hi=Xn.ascender!==void 0?Math.abs(Xn.ascender):0,Mi=Xn.descender!==void 0?Math.abs(Xn.descender):0,vi=(hi+Mi)*Wt;_i<vi&&(_i=vi,ce=(hi-Mi)/2*Wt),On=-hi*Wt}else On=(Ut-Wt)*fo-17}un?(me.verticalizable=!0,zn.push({glyph:St,image:En,x:qe,y:He+On,vertical:un,scale:Wt,localGlyph:Yt.localGlyph,fontStack:lt.fontStack,sectionIndex:Et,metrics:Yt,rect:mn}),qe+=Tn*Wt+ct):(zn.push({glyph:St,image:En,x:qe,y:He+On,vertical:un,scale:Wt,localGlyph:Yt.localGlyph,fontStack:lt.fontStack,sectionIndex:Et,metrics:Yt,rect:mn}),qe+=Yt.advance*Wt+ct)}zn.length!==0&&(rt=Math.max(qe-ct,rt),ft?kF(zn,xt,_n,ce,We*Ut/2):kF(zn,xt,_n,0,We/2)),qe=0;let pe=We*Ut+_n;Ln.lineOffset=Math.max(_n,dn),He+=pe,++qt}var It;let Rt=He,{horizontalAlign:Bt,verticalAlign:In}=dM(Ke);(function(mt,Ut,dn,Ln,zn,_n){let _i=(Ut-dn)*zn,ce=-_n*Ln;for(let pe of mt)for(let Ze of pe.positionedGlyphs)Ze.x+=_i,Ze.y+=ce})(me.positionedLines,xt,Bt,In,rt,Rt),me.top+=-In*Rt,me.bottom=me.top+Rt,me.left+=-Bt*rt,me.right=me.left+rt,me.hasBaseline=ft})(le,t,s,u,$,g,v,b,I,E,D,R),!(function(me){for(let ye of me)if(ye.positionedGlyphs.length!==0)return!1;return!0})(he))return le}let ow={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I$={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function AF(l,t,s,u,h,m){if(t.image){let g=u.get(t.image.toString());return g?g.displaySize[0]*t.scale*fo/m+h:0}{let g=s[t.fontStack],v=g&&g.glyphs[l];return v?v.metrics.advance*t.scale+h:0}}function PF(l,t,s,u){let h=Math.pow(l-t,2);return u?l<t?h/2:2*h:h+Math.abs(s)*s}function M$(l,t,s){let u=0;return l===10&&(u-=1e4),s&&(u+=150),l!==40&&l!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function OF(l,t,s,u,h,m){let g=null,v=PF(t,s,h,m);for(let b of u){let E=PF(t-b.x,s,h,m)+b.badness;E<=v&&(g=b,v=E)}return{index:l,x:t,priorBreak:g,badness:v}}function RF(l){return l?RF(l.priorBreak).concat(l.index):[]}function dM(l){let t=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function kF(l,t,s,u,h){if(!(t||s||u||h))return;let m=l.length-1,g=l[m],v=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=m;b++)l[b].x-=v,l[b].y+=s+u+h}function hM(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function sw(l,t,s,u){let{horizontalAlign:h,verticalAlign:m}=dM(u),g=s[0]-l.displaySize[0]*h,v=s[1]-l.displaySize[1]*m;return{imagePrimary:l,imageSecondary:t,top:v,bottom:v+l.displaySize[1],left:g,right:g+l.displaySize[0]}}function pM(l,t,s,u,h,m){let g=l.imagePrimary,v;if(g.content){let H=g.content,$=g.pixelRatio||1;v=[H[0]/$,H[1]/$,g.displaySize[0]-H[2]/$,g.displaySize[1]-H[3]/$]}let b=t.left*m,E=t.right*m,T,I,D,O;s==="width"||s==="both"?(O=h[0]+b-u[3],I=h[0]+E+u[1]):(O=h[0]+(b+E-g.displaySize[0])/2,I=O+g.displaySize[0]);let R=t.top*m,B=t.bottom*m;return s==="height"||s==="both"?(T=h[1]+R-u[0],D=h[1]+B+u[2]):(T=h[1]+(R+B-g.displaySize[1])/2,D=T+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:T,right:I,bottom:D,left:O,collisionPadding:v}}function FF(l){return!l.imagePrimary.stretchX}function LF(l){return!l.imagePrimary.stretchY}function NF(l){return{width:l.right-l.left,height:l.bottom-l.top}}let gc=128;function Lg(l,t,s){let{expression:u}=t;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ui(l+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{let{zoomStops:h,interpolationType:m}=u,g=0;for(;g<h.length&&h[g]<=l;)g++;g=Math.max(0,g-1);let v=g;for(;v<h.length&&h[v]<l+1;)v++;v=Math.min(h.length-1,v);let b=h[g],E=h[v];return u.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:E,minSize:u.evaluate(new Ui(b,{worldview:s})),maxSize:u.evaluate(new Ui(E,{worldview:s})),interpolationType:m}}}function fM(l,{uSize:t,uSizeT:s},{lowerSize:u,upperSize:h}){return l.kind==="source"?u/gc:l.kind==="composite"?on(u/gc,h/gc,s):t}function Ng(l,t,s=1){let u=0,h=0;if(l.kind==="constant")h=l.layoutSize*s;else if(l.kind!=="source"){let{interpolationType:m,minZoom:g,maxZoom:v}=l,b=m?G(ta.interpolationFactor(m,t,g,v),0,1):0;l.kind==="camera"?h=on(l.minSize,l.maxSize,b)*s:u=b*s}return{uSizeT:u,uSize:h}}class bd extends st{constructor(t,s,u,h,m){super(t,s),this.angle=h,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new bd(this.x,this.y,this.z,this.angle,this.segment)}}function zF(l,t,s,u,h){if(t.segment===void 0)return!0;let m=t,g=t.segment+1,v=0;for(;v>-s/2;){if(g--,g<0)return!1;v-=l[g].dist(m),m=l[g]}v+=l[g].dist(l[g+1]),g++;let b=[],E=0;for(;v<s/2;){let T=l[g],I=l[g+1];if(!I)return!1;let D=l[g-1].angleTo(T)-T.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:D}),E+=D;v-b[0].distance>u;)E-=b.shift().angleDelta;if(E>h)return!1;g++,v+=T.dist(I)}return!0}function BF(l){let t=0;for(let s=0;s<l.length-1;s++)t+=l[s].dist(l[s+1]);return t}function VF(l,t,s){return l?.6*t*s:0}function UF(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function D$(l,t,s,u,h,m){let g=VF(s,h,m),v=UF(s,u)*m,b=0,E=BF(l)/2;for(let T=0;T<l.length-1;T++){let I=l[T],D=l[T+1],O=I.dist(D);if(b+O>E){let R=(E-b)/O,B=on(I.x,D.x,R),H=on(I.y,D.y,R),$=new bd(B,H,0,D.angleTo(I),T);return!g||zF(l,$,v,g,t)?$:void 0}b+=O}}function A$(l,t,s,u,h,m,g,v,b){let E=VF(u,m,g),T=UF(u,h),I=T*g,D=l[0].x===0||l[0].x===b||l[0].y===0||l[0].y===b;return t-I<t/4&&(t=I+t/4),jF(l,D?t/2*v%t:(T/2+2*m)*g*v%t,t,E,s,I,D,!1,b)}function jF(l,t,s,u,h,m,g,v,b){let E=m/2,T=BF(l),I=0,D=t-s,O=[];for(let R=0;R<l.length-1;R++){let B=l[R],H=l[R+1],$=B.dist(H),Y=H.angleTo(B);for(;D+s<I+$;){D+=s;let J=(D-I)/$,ie=on(B.x,H.x,J),he=on(B.y,H.y,J);if(ie>=0&&ie<b&&he>=0&&he<b&&D-E>=0&&D+E<=T){let le=new bd(ie,he,0,Y,R);u&&!zF(l,le,m,u,h)||O.push(le)}}I+=$}return v||O.length||g||(O=jF(l,I/2,s,u,h,m,g,!0,b)),O}function $F(l){let t=0,s=0;for(let g of l)t+=g.w*g.h,s=Math.max(s,g.w);l.sort((g,v)=>v.h-g.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}],h=0,m=0;for(let g of l)for(let v=u.length-1;v>=0;v--){let b=u[v];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){let E=u.pop();E&&v<u.length&&(u[v]=E)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(u.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:m,fill:t/(h*m)||0}}Lt(bd,"Anchor");let nf=1;class ny{static getImagePositionScale(t,s,u){if(s&&t){let{sx:h,sy:m}=t;return{x:h,y:m}}return{x:u,y:u}}constructor(t,s,u,h){this.paddedRect=t;let{pixelRatio:m,version:g,stretchX:v,stretchY:b,content:E,sdf:T,usvg:I}=s;this.pixelRatio=m,this.stretchX=v,this.stretchY=b,this.content=E,this.version=g,this.padding=u,this.sdf=T,this.usvg=I,this.scale=ny.getImagePositionScale(h,I,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function mM(l,t,s){let u=Jl.parse(l),h=(function(m,g,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*g,h:(m.data?m.data.height:m.height*v[1])+2*g}})(t,s,[u.sx,u.sy]);return{bin:h,imagePosition:new ny(h,t,s,u),imageVariant:u}}class HF{constructor(t,s,u){let h=new Map,m=new Map;this.haveRenderCallbacks=[];let g=[];this.addImages(t,h,nf,g),this.addImages(s,m,2,g);let{w:v,h:b}=$F(g),E=new es({width:v||1,height:b||1});for(let[T,I]of t.entries()){let D=h.get(T).paddedRect;es.copy(I.data,E,{x:0,y:0},{x:D.x+nf,y:D.y+nf},I.data,null,I.sdf)}for(let[T,I]of s.entries()){let D=m.get(T),O=D.paddedRect,R=D.padding,B=O.x+R,H=O.y+R,$=I.data.width,Y=I.data.height;R=R>1?R-1:R,es.copy(I.data,E,{x:0,y:0},{x:B,y:H},I.data,u),es.copy(I.data,E,{x:0,y:Y-R},{x:B,y:H-R},{width:$,height:R},u),es.copy(I.data,E,{x:0,y:0},{x:B,y:H+Y},{width:$,height:R},u),es.copy(I.data,E,{x:$-R,y:0},{x:B-R,y:H},{width:R,height:Y},u),es.copy(I.data,E,{x:0,y:0},{x:B+$,y:H},{width:R,height:Y},u),es.copy(I.data,E,{x:$-R,y:Y-R},{x:B-R,y:H-R},{width:R,height:R},u),es.copy(I.data,E,{x:0,y:Y-R},{x:B+$,y:H-R},{width:R,height:R},u),es.copy(I.data,E,{x:0,y:0},{x:B+$,y:H+Y},{width:R,height:R},u),es.copy(I.data,E,{x:$-R,y:0},{x:B-R,y:H+Y},{width:R,height:R},u)}this.lut=u,this.image=E,this.iconPositions=h,this.patternPositions=m}addImages(t,s,u,h){for(let[m,g]of t.entries()){let{bin:v,imagePosition:b,imageVariant:E}=mM(m,g,u);s.set(m,b),h.push(v),g.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(t,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(let h of t.getUpdatedImages(u)){for(let m of this.iconPositions.keys()){let g=Jl.parse(m);if(as.isEqual(g.id,h)){let v=t.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(m),v,s,null)}}for(let m of this.patternPositions.keys()){let g=Jl.parse(m);if(as.isEqual(g.id,h)){let v=t.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(m),v,s,this.lut)}}}}patchUpdatedImage(t,s,u,h=null){if(!t||!s||t.version===s.version)return;t.version=s.version;let[m,g]=t.tl,v=t.sdf;if(this.lut||v){let b={width:s.data.width,height:s.data.height},E=new es(b);es.copy(s.data,E,{x:0,y:0},{x:0,y:0},b,h,v),u.update(E,{position:{x:m,y:g}})}else u.update(s.data,{position:{x:m,y:g}})}}Lt(ny,"ImagePosition"),Lt(HF,"ImageAtlas");let iy=1e20;function GF(l,t,s,u,h,m,g,v,b){for(let E=t;E<t+u;E++)qF(l,s*m+E,m,h,g,v,b);for(let E=s;E<s+h;E++)qF(l,E*m+t,1,u,g,v,b)}function qF(l,t,s,u,h,m,g){m[0]=0,g[0]=-iy,g[1]=iy,h[0]=l[t];for(let v=1,b=0,E=0;v<u;v++){h[v]=l[t+v*s];let T=v*v;do{let I=m[b];E=(h[v]-h[I]+T-I*I)/(v-I)/2}while(E<=g[b]&&--b>-1);b++,m[b]=v,g[b]=E,g[b+1]=iy}for(let v=0,b=0;v<u;v++){for(;g[b+1]<v;)b++;let E=m[b],T=v-E;l[t+v*s]=h[E]+T*T}}let _c=2,gM={none:0,ideographs:1,all:2};class zg{constructor(t,s,u){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){let u=[],h=this.url||kn.GLYPHS_URL;for(let m in t)for(let g of t[m])u.push({stack:m,id:g});xe(u,({stack:m,id:g},v)=>{let b=this.entries[m];b||(b=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[g];if(E!==void 0)return void v(null,{stack:m,id:g,glyph:E});if(E=this._tinySDF(b,m,g),E)return b.glyphs[g]=E,void v(null,{stack:m,id:g,glyph:E});let T=Math.floor(g/256);if(256*T>65535)return Pt("glyphs > 65535 not supported"),void v(null,{stack:m,id:g,glyph:E});if(b.ranges[T])return void v(null,{stack:m,id:g,glyph:E});let I=b.requests[T];I||(I=b.requests[T]=[],zg.loadGlyphRange(m,T,h,this.requestManager,(D,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(let R in O.glyphs)this._doesCharSupportLocalGlyph(+R)||(b.glyphs[+R]=O.glyphs[+R]);b.ranges[T]=!0}for(let R of I)R(D,O);delete b.requests[T]})),I.push((D,O)=>{D?v(D):O&&v(null,{stack:m,id:g,glyph:O.glyphs[g]||null})})},(m,g)=>{if(m)s(m);else if(g){let v={};for(let{stack:b,id:E,glyph:T}of g)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;s(null,v)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==gM.none&&(this.localGlyphMode===gM.all?!!this.localFontFamily:!!this.localFontFamily&&(en["CJK Unified Ideographs"](t)||en["Hangul Syllables"](t)||en.Hiragana(t)||en.Katakana(t)||en["CJK Symbols and Punctuation"](t)||en["CJK Unified Ideographs Extension A"](t)||en["CJK Unified Ideographs Extension B"](t)||en.Osage(t)))}_tinySDF(t,s,u){let h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let m=t.tinySDF;if(!m){let B="400";/bold/i.test(s)?B="900":/medium/i.test(s)?B="500":/light/i.test(s)&&(B="200"),m=t.tinySDF=new zg.TinySDF({fontFamily:h,fontWeight:B,fontSize:24*_c,buffer:3*_c,radius:8*_c}),m.fontWeight=B}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];let g=String.fromCodePoint(u),{data:v,width:b,height:E,glyphWidth:T,glyphHeight:I,glyphLeft:D,glyphTop:O,glyphAdvance:R}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new wh({width:b,height:E},v),metrics:{width:T/_c,height:I/_c,left:D/_c,top:O/_c-27,advance:R/_c,localGlyph:!0}}}}zg.loadGlyphRange=function(l,t,s,u,h){let m=256*t,g=m+255,v=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${m}-${g}`),pp.Glyphs);Ql(v,(b,E)=>{if(b)h(b);else if(E){let T={},I=(function(D){return new rw(D).readFields(E$,{})})(E);for(let D of I.glyphs)T[D.id]=D;h(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},zg.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:v=null}={}){this.buffer=t,this.cutoff=u,this.radius=s,this.lang=v;let b=this.size=l+4*t,E=this._createCanvas(b),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${m} ${l}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(l){let t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){let{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(l),g=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),b=Math.min(this.size-this.buffer,g+Math.ceil(u)),E=v+2*this.buffer,T=b+2*this.buffer,I=Math.max(E*T,0),D=new Uint8ClampedArray(I),O={data:D,width:E,height:T,glyphWidth:v,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(v===0||b===0)return O;let{ctx:R,buffer:B,gridInner:H,gridOuter:$}=this;this.lang&&(R.lang=this.lang),R.clearRect(B,B,v,b),R.fillText(l,B,B+g);let Y=R.getImageData(B,B,v,b);$.fill(iy,0,I),H.fill(0,0,I);for(let J=0;J<b;J++)for(let ie=0;ie<v;ie++){let he=Y.data[4*(J*v+ie)+3]/255;if(he===0)continue;let le=(J+B)*E+ie+B;if(he===1)$[le]=0,H[le]=iy;else{let me=.5-he;$[le]=me>0?me*me:0,H[le]=me<0?me*me:0}}GF($,0,0,E,T,E,this.f,this.v,this.z),GF(H,B,B,v,b,E,this.f,this.v,this.z);for(let J=0;J<I;J++){let ie=Math.sqrt($[J])-Math.sqrt(H[J]);D[J]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};let du=nf;function WF(l,t){return l+t[1]-t[0]}function _M(l,t,s,u,h=1){let m=[],g=l.imagePrimary,v=g.pixelRatio,b=g.paddedRect.w-2*du,E=g.paddedRect.h-2*du,T=(l.right-l.left)*h,I=(l.bottom-l.top)*h,D=g.stretchX||[[0,b]],O=g.stretchY||[[0,E]],R=D.reduce(WF,0),B=O.reduce(WF,0),H=b-R,$=E-B,Y=0,J=R,ie=0,he=B,le=0,me=H,ye=0,we=$;if(g.content&&u){let Ae=g.content;Y=aw(D,0,Ae[0]),ie=aw(O,0,Ae[1]),J=aw(D,Ae[0],Ae[2]),he=aw(O,Ae[1],Ae[3]),le=Ae[0]-Y,ye=Ae[1]-ie,me=Ae[2]-Ae[0]-J,we=Ae[3]-Ae[1]-he}let je=(Ae,We,Ke,Qe)=>{let at=lw(Ae.stretch-Y,J,T,l.left*h),ct=cw(Ae.fixed-le,me,Ae.stretch,R),nt=lw(We.stretch-ie,he,I,l.top*h),it=cw(We.fixed-ye,we,We.stretch,B),qe=lw(Ke.stretch-Y,J,T,l.left*h),He=cw(Ke.fixed-le,me,Ke.stretch,R),rt=lw(Qe.stretch-ie,he,I,l.top*h),xt=cw(Qe.fixed-ye,we,Qe.stretch,B),ft=new st(at,nt),qt=new st(qe,nt),It=new st(qe,rt),Rt=new st(at,rt),Bt=new st(ct/v,it/v),In=new st(He/v,xt/v),mt=t*Math.PI/180;if(mt){let _i=Math.sin(mt),ce=Math.cos(mt),pe=[ce,-_i,_i,ce];ft._matMult(pe),qt._matMult(pe),Rt._matMult(pe),It._matMult(pe)}let Ut=Ae.stretch+Ae.fixed,dn=Ke.stretch+Ke.fixed,Ln=We.stretch+We.fixed,zn=Qe.stretch+Qe.fixed,_n=l.imageSecondary;return{tl:ft,tr:qt,bl:Rt,br:It,texPrimary:{x:g.paddedRect.x+du+Ut,y:g.paddedRect.y+du+Ln,w:dn-Ut,h:zn-Ln},texSecondary:_n?{x:_n.paddedRect.x+du+Ut,y:_n.paddedRect.y+du+Ln,w:dn-Ut,h:zn-Ln}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bt,pixelOffsetBR:In,minFontScaleX:me/v/T,minFontScaleY:we/v/I,isSDF:s}};if(u&&(g.stretchX||g.stretchY)){let Ae=ZF(D,H,R),We=ZF(O,$,B);for(let Ke=0;Ke<Ae.length-1;Ke++){let Qe=Ae[Ke],at=Ae[Ke+1];for(let ct=0;ct<We.length-1;ct++)m.push(je(Qe,We[ct],at,We[ct+1]))}}else m.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return m}function P$(l,t){let s=l.stretchY||[[0,l.paddedRect.h-2*du]];return t&&(l.stretchX||l.stretchY)?YF(l.stretchX||[[0,l.paddedRect.w-2*du]])*YF(s):1}function aw(l,t,s){let u=0;for(let h of l)u+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return u}function ZF(l,t,s){let u=[{fixed:-du,stretch:0}];for(let[h,m]of l){let g=u[u.length-1];u.push({fixed:h-g.stretch,stretch:g.stretch}),u.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return u.push({fixed:t+du,stretch:s}),u}function YF(l){return 2*l.length+1}function lw(l,t,s,u){return l/t*s+u}function cw(l,t,s,u){return l-t*s/u}function O$(l,t,s,u){let h=t+l.positionedLines[u].lineOffset;return u===0?s+h/2:s+(h+(t+l.positionedLines[u-1].lineOffset))/2}function R$(l,t=1,s=!1){let u=1/0,h=1/0,m=-1/0,g=-1/0,v=l[0];for(let O=0;O<v.length;O++){let R=v[O];(!O||R.x<u)&&(u=R.x),(!O||R.y<h)&&(h=R.y),(!O||R.x>m)&&(m=R.x),(!O||R.y>g)&&(g=R.y)}let b=Math.min(m-u,g-h),E=b/2,T=new Mm([],k$);if(b===0)return new st(u,h);for(let O=u;O<m;O+=b)for(let R=h;R<g;R+=b)T.push(new Bg(O+E,R+E,E,l));let I=(function(O){let R=0,B=0,H=0,$=O[0];for(let Y=0,J=$.length,ie=J-1;Y<J;ie=Y++){let he=$[Y],le=$[ie],me=he.x*le.y-le.x*he.y;B+=(he.x+le.x)*me,H+=(he.y+le.y)*me,R+=3*me}return new Bg(B/R,H/R,0,O)})(l),D=T.length;for(;T.length;){let O=T.pop();(O.d>I.d||!I.d)&&(I=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-I.d<=t||(E=O.h/2,T.push(new Bg(O.p.x-E,O.p.y-E,E,l)),T.push(new Bg(O.p.x+E,O.p.y-E,E,l)),T.push(new Bg(O.p.x-E,O.p.y+E,E,l)),T.push(new Bg(O.p.x+E,O.p.y+E,E,l)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function k$(l,t){return t.max-l.max}class Bg{constructor(t,s,u,h){this.p=new st(t,s),this.h=u,this.d=(function(m,g){let v=!1,b=1/0;for(let E=0;E<g.length;E++){let T=g[E];for(let I=0,D=T.length,O=D-1;I<D;O=I++){let R=T[I],B=T[O];R.y>m.y!=B.y>m.y&&m.x<(B.x-R.x)*(m.y-R.y)/(B.y-R.y)+R.x&&(v=!v),b=Math.min(b,Cr(m,R,B))}}return(v?1:-1)*Math.sqrt(b)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}let F$=Object.keys,vM=Number.POSITIVE_INFINITY,L$=Math.sqrt(2);function Eh(l,t,s,u,h){let m=hM(l)&&l.collisionPadding?l.collisionPadding:[0,0,0,0],g={top:l.top-m[1],bottom:l.bottom+m[3],left:l.left-m[0],right:l.right+m[2],scaled:!1};return u!==void 0&&(function(v,b){v.top*=b,v.bottom*=b,v.left*=b,v.right*=b,v.scaled=!0})(g,u),s&&(function(v,b){if(!b)return;let E=Zn(b),T=new st(v.left,v.top),I=new st(v.right,v.top),D=new st(v.left,v.bottom),O=new st(v.right,v.bottom),R=new st(0,0);T._rotateAround(E,R),I._rotateAround(E,R),D._rotateAround(E,R),O._rotateAround(E,R),v.left=Math.min(T.x,I.x,D.x,O.x),v.right=Math.max(T.x,I.x,D.x,O.x),v.top=Math.min(T.y,I.y,D.y,O.y),v.bottom=Math.max(T.y,I.y,D.y,O.y)})(g,s),h&&(g.left+=h[0],g.right+=h[0],g.top+=h[1],g.bottom+=h[1]),t?{top:Math.min(t.top,g.top),bottom:Math.max(t.bottom,g.bottom),left:Math.min(t.left,g.left),right:Math.max(t.right,g.right),scaled:t.scaled||g.scaled}:g}function XF(l,[t,s]){let u=0,h=0;if(s===vM){t<0&&(t=0);let m=t/L$;switch(l){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(l){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),s=Math.abs(s),l){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(l){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,h]}function N$(l,t,s,u,h,m,g,v,b,E,T,I,D,O){let R=l.layers[0],B=R.appearances;if(B.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};let H={iconBBox:null,iconVerticalBBox:null},$={textBBox:null,textVerticalBBox:null},{baseIconRotate:Y,baseTextRotate:J,iconScaleFactor:ie}=(function(le,me,ye){let we=le.get("icon-rotate").evaluate(me,{},ye),je=le.get("text-rotate").evaluate(me,{},ye),[Ae,We]=le.get("icon-size-scale-range");return{baseIconRotate:we,baseTextRotate:je,iconScaleFactor:G(1,Ae,We)}})(u,h,m);t&&(H.iconBBox=Eh(t,H.iconBBox,Y,g),s)&&(H.iconVerticalBBox=Eh(s,H.iconVerticalBBox,Y+90,g));let he=dw(I.horizontal);he&&($.textBBox=Eh(he,$.textBBox,J,1,O)),I.vertical&&($.textVerticalBBox=Eh(I.vertical,$.textVerticalBBox,J+90,1,O));for(let le of B)le.hasIconProperties()&&z$(H,l,R,le,h,m,v,Y,g,b,t,E,ie,T),le.hasTextProperties()&&B$($,R,le,h,m,O,J,D,he,I.vertical);return{iconBBox:H.iconBBox,iconVerticalBBox:H.iconVerticalBBox,textBBox:$.textBBox,textVerticalBBox:$.textVerticalBBox}}function z$(l,t,s,u,h,m,g,v,b,E,T,I,D,O){let{appearanceIconOffset:R,appearanceIconRotate:B,appearanceIconSize:H}=(function(ie,he,le,me,ye,we,je,Ae){let We=ie.hasProperty("icon-offset")?he.getAppearanceValueAndResolveTokens(ie,"icon-offset",le,me,[]):null,Ke=We&&Array.isArray(We)?We:ye,Qe=ie.hasProperty("icon-rotate")?he.getAppearanceValueAndResolveTokens(ie,"icon-rotate",le,me,[]):null,at=typeof Qe=="number"?Qe:we,ct=ie.hasProperty("icon-size")?he.getAppearanceValueAndResolveTokens(ie,"icon-size",le,me,[]):null;return{appearanceIconOffset:Ke,appearanceIconRotate:at,appearanceIconSize:typeof ct=="number"?ct*Ae.iconScaleFactor:je}})(u,s,h,m,g,v,b,E),$=null,Y=null,J=null;u.hasProperty("icon-image")?J=(function(ie,he,le,me,ye,we,je){let Ae=null,We=he.getAppearanceValueAndResolveTokens(le,"icon-image",me,ye,[]);if(We){let Ke=ie.getResolvedImageFromTokens(We),Qe=le.getUnevaluatedProperty("icon-size"),at=ry(Ke,Lg(ie.zoom,Qe,ie.worldview),Qe,ye,ie.zoom,me,ie.pixelRatio,je,ie.worldview);Ae=we.get(at.iconPrimary.toString())}return Ae})(t,s,u,h,m,I,D):T&&(J=T.imagePrimary),J&&($=sw(J,null,R,O),t.allowVerticalPlacement&&(Y=sw(J,null,R,O))),$&&(l.iconBBox=Eh($,l.iconBBox,B,H)),Y&&(l.iconVerticalBBox=Eh(Y,l.iconVerticalBBox,B+90,H))}function B$(l,t,s,u,h,m,g,v,b,E){let{appearanceTextOffset:T,appearanceTextRotate:I,appearanceTextSize:D}=(function(R,B,H,$,Y,J,ie){let he=R.hasProperty("text-offset")?B.getAppearanceValueAndResolveTokens(R,"text-offset",H,$,[]):null,le=he&&Array.isArray(he)?[he[0]*fo,he[1]*fo]:Y,me=R.hasProperty("text-rotate")?B.getAppearanceValueAndResolveTokens(R,"text-rotate",H,$,[]):null,ye=typeof me=="number"?me:J,we=R.hasProperty("text-size")?B.getAppearanceValueAndResolveTokens(R,"text-size",H,$,[]):null;return{appearanceTextOffset:le,appearanceTextRotate:ye,appearanceTextSize:typeof we=="number"?we:ie}})(s,t,u,h,m,g,v),O=D/v;b&&(l.textBBox=Eh(b,l.textBBox,I,O,T)),E&&(l.textVerticalBBox=Eh(E,l.textVerticalBBox,I+90,O,T))}function uw(l,t,s,u,h,m,g,v,b){if(!t||!t.usvg)return;let E=NF(u),T=NF(h),I=m!=="both"&&m!=="width"||!FF(u)?1:T.width/E.width,D=m!=="both"&&m!=="height"||!LF(u)?1:T.height/E.height;s.scaleSelf(I,D);let O=s.toString();g.set(O,s),v.set(O,t);let{imagePosition:R}=mM(O,t,nf);b.set(O,R)}function KF(l,t,s,u,h,m,g,v,b){if(!l)return;let E=(function(T,I,D,O,R,B){if(T.kind==="camera")return T.maxSize;if(T.kind==="composite"){let H=I.possiblyEvaluate(new Ui(T.maxZoom,{worldview:B}),D).evaluate(R,{},D),$=I.possiblyEvaluate(new Ui(T.minZoom,{worldview:B}),D).evaluate(R,{},D);return Math.max(H,$)}return I.possiblyEvaluate(new Ui(O,{worldview:B})).evaluate(R,{},D)})(t,s,u,h,m,b);return l.scaleSelf(E*v*g)}function ry(l,t,s,u,h,m,g,v,b){return{iconPrimary:KF(l.getPrimary(),t,s,u,h,m,g,v,b),iconSecondary:KF(l.getSecondary(),t,s,u,h,m,g,v,b)}}function V$(l,t,s){if(!t)return;let u=s.get(l.toString()),h=s.get(t.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||Pt(`Mismatch in icon variant sizes: ${l.toString()} and ${t.toString()}`),u.usvg!==h.usvg&&Pt(`Mismatch in icon variant image types: ${l.id} and ${t.id}`))}function QF(l,t,s,u){if(!l)return;let h=t.get(s.toString());if(l.imagePrimary=h,u){let m=t.get(u.toString());l.imageSecondary=m}}function U$(l,t){for(let s in l.horizontal)JF(l.horizontal[s],t);JF(l.vertical,t)}function JF(l,t){if(l){for(let s of l.positionedLines)for(let u of s.positionedGlyphs)if(u.image!==null){let h=u.image.toString();u.rect=t.get(h).paddedRect}}}function yM(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function j$(l,t,s,u,h,m,g,v,b){let E=dw(m.horizontal)||m.vertical,T=s.get("icon-text-fit-padding").evaluate(u,{},h),I,D=t;return t&&b!=="none"&&(l.allowVerticalPlacement&&m.vertical&&(I=pM(t,m.vertical,b,T,v,g)),E&&(D=pM(t,E,b,T,v,g))),{defaultShapedIcon:D,verticallyShapedIcon:I}}function $$(l,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y,J,ie,he,le,me){let ye=g.textMaxSize.evaluate(t,{},D);ye===void 0?ye=v*g.textScaleFactor:ye*=g.textScaleFactor;let we=l.layers[0].layout,je=fo,Ae=v*g.textScaleFactor/je,We=dw(s.horizontal)||s.vertical;if(H!=="none"&&l.appearanceFeatureData&&t.index<l.appearanceFeatureData.length){let It=l.appearanceFeatureData[t.index];It&&(It.textShaping=We,It.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(t,{},D),It.fontScale=Ae)}let Ke=O.name==="globe",Qe=l.tilePixelRatio*ye/je,at=(rt=l.overscaling,l.zoom>18&&rt>2&&(rt>>=1),Math.max(yt/(512*rt),1)*we.get("symbol-spacing")),ct=we.get("text-padding")*l.tilePixelRatio,nt=we.get("icon-padding")*l.tilePixelRatio,it=Zn(we.get("text-max-angle")),qe=we.get("icon-rotation-alignment")==="map"&&J!=="point",He=at/2;var rt;l.hasAnyIconTextFit===!1&&H!=="none"&&(l.hasAnyIconTextFit=!0);let xt=t.properties?+t.properties[Ge]:null,ft=xt&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(xt):65535,qt=(It,Rt,Bt)=>{if(Rt.x<0||Rt.x>=yt||Rt.y<0||Rt.y>=yt)return;let In=null;if(Ke){let{x:mt,y:Ut,z:dn}=O.projectTilePoint(Rt.x,Rt.y,Bt);In={anchor:new bd(mt,Ut,dn,0,void 0),up:O.upVector(Bt,Rt.x,Rt.y)}}(function(mt,Ut,dn,Ln,zn,_n,_i,ce,pe,Ze,lt,Et,St,Wt,Yt,mn,En,Tn,On,rn,un,Hn,Xn,Kn,hi,Mi,vi,ei,oi,Sn,Nn,tr,tn){let Rn=mt.addToLineVertexArray(Ut,Ln),wi,Ri,ji,Dr,zi,nn,or,pi=0,Qi=0,eo=0,mo=0,$r=-1,Hr=-1,ao={},Os=gm(""),Bi=dn?dn.anchor:Ut,Er=ei!=="none",Ar=0,Us=0;if(pe._unevaluatedLayout.getValue("text-radial-offset")===void 0){let No=pe.layout.get("text-offset").evaluate(un,{},hi);Ar=No[0]*fo,Us=No[1]*fo}else Ar=pe.layout.get("text-radial-offset").evaluate(un,{},hi)*fo,Us=vM;if(mt.allowVerticalPlacement&&zn.vertical){let No=zn.vertical;if(Yt)nn=xM(No),ce&&(or=xM(ce));else{let vs=pe.layout.get("text-rotate").evaluate(un,{},hi)+90;ji=hw(Ze,Bi,Ut,lt,Et,St,No,Wt,vs,mn,tr),ce&&(Dr=hw(Ze,Bi,Ut,lt,Et,St,ce,Tn,vs,null,Nn))}}if(_n){let No=mt.iconSizeData,vs=pe.layout.get("icon-rotate").evaluate(un,{},hi),aa=_M(_n,vs,Xn,Er,Hn.iconScaleFactor),Ih=ce?_M(ce,vs,Xn,Er,Hn.iconScaleFactor):void 0;Ri=hw(Ze,Bi,Ut,lt,Et,St,_n,Tn,vs,null,Sn);let qg=(function(bc,wy,vN,tG,yN,xN,nG,iG){let bN=bc.layers[0],wN=bN.appearances,Wg=wy.length;if(vN&&(Wg=Math.max(Wg,vN.length)),wN.length===0)return Wg;let[rG,oG]=tG.get("icon-size-scale-range"),sG=G(1,rG,oG);for(let CN of wN){let EN=CN.getUnevaluatedProperties();if(EN._values["icon-image"].value!==void 0){let SN=bN.getAppearanceValueAndResolveTokens(CN,"icon-image",yN,xN,[]);if(SN){let TN=bc.getResolvedImageFromTokens(SN);if(TN){let IN=EN._values["icon-size"],aG=ry(TN,Lg(bc.zoom,IN,bc.worldview),IN,xN,bc.zoom,yN,bc.pixelRatio,sG,bc.worldview),lG=nG.get(aG.iconPrimary.toString());Wg=Math.max(Wg,P$(lG,iG))}}}}return Wg})(mt,aa,Ih,pe.layout,un,hi,mt.iconAtlasPositions,Er);pi=4*qg;let xc=null;No.kind==="source"?(xc=[gc*pe.layout.get("icon-size").evaluate(un,{},hi)*Hn.iconScaleFactor],xc[0]>wd&&Pt(`${mt.layerIds[0]}: Value for "icon-size" is >= ${oy}. Reduce your "icon-size".`)):No.kind==="composite"&&(xc=[gc*Hn.compositeIconSizes[0].evaluate(un,{},hi)*Hn.iconScaleFactor,gc*Hn.compositeIconSizes[1].evaluate(un,{},hi)*Hn.iconScaleFactor],(xc[0]>wd||xc[1]>wd)&&Pt(`${mt.layerIds[0]}: Value for "icon-size" is >= ${oy}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,aa,xc,rn,On,un,void 0,dn,Ut,Rn.lineStartIndex,Rn.lineLength,-1,Kn,hi,Mi,vi,mt.symbolInstances.length,qg),$r=mt.icon.placedSymbolArray.length-1,Ih&&(Qi=4*qg,mt.addSymbols(mt.icon,Ih,xc,rn,On,un,sa.vertical,dn,Ut,Rn.lineStartIndex,Rn.lineLength,-1,Kn,hi,Mi,vi,mt.symbolInstances.length,qg),Hr=mt.icon.placedSymbolArray.length-1)}for(let No in zn.horizontal){let vs=No,aa=zn.horizontal[vs];wi||(Os=gm(aa.text),Yt?zi=xM(aa):wi=hw(Ze,Bi,Ut,lt,Et,St,aa,Wt,pe.layout.get("text-rotate").evaluate(un,{},hi),mn,tr));let Ih=aa.positionedLines.length===1;if(eo+=eL(mt,dn,Ut,aa,_i,pe,Yt,un,mn,Rn,zn.vertical?sa.horizontal:sa.horizontalOnly,Ih?F$(zn.horizontal):[vs],ao,$r,Hn,Kn,hi,mt.symbolInstances.length,Mi),Ih)break}zn.vertical&&(mo+=eL(mt,dn,Ut,zn.vertical,_i,pe,Yt,un,mn,Rn,sa.vertical,["vertical"],ao,Hr,Hn,Kn,hi,mt.symbolInstances.length,Mi));let to=-1,Dl=(No,vs)=>No?Math.max(No,vs):vs;to=Dl(zi,to),to=Dl(nn,to),to=Dl(or,to);let hu=to>-1?1:0;mt.glyphOffsetArray.length>=65535&&Pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),un.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,un.sortKey),mt.symbolInstances.emplaceBack(Ut.x,Ut.y,Bi.x,Bi.y,Bi.z,ao.right>=0?ao.right:-1,ao.center>=0?ao.center:-1,ao.left>=0?ao.left:-1,ao.vertical>=0?ao.vertical:-1,$r,Hr,Os,wi!==void 0?wi:mt.collisionBoxArray.length,wi!==void 0?wi+1:mt.collisionBoxArray.length,ji!==void 0?ji:mt.collisionBoxArray.length,ji!==void 0?ji+1:mt.collisionBoxArray.length,Ri!==void 0?Ri:mt.collisionBoxArray.length,Ri!==void 0?Ri+1:mt.collisionBoxArray.length,Dr||mt.collisionBoxArray.length,Dr?Dr+1:mt.collisionBoxArray.length,lt,eo,mo,pi,Qi,hu,0,Ar,Us,to,0,Er?1:0,oi)})(l,Rt,In,It,s,u,m,h,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,ct,Y,E,0,nt,qe,$,t,g,T,I,D,R,B,H,ft,ie,he,le)};if(J==="line")for(let It of q1(t.geometry,0,0,yt,yt)){let Rt=A$(It,at,it,s.vertical||We,u,je,Qe,l.overscaling,yt);for(let Bt of Rt)We&&H$(l,We.text,He,Bt)||qt(It,Bt,D)}else if(J==="line-center"){for(let It of t.geometry)if(It.length>1){let Rt=D$(It,it,s.vertical||We,u,je,Qe);Rt&&qt(It,Rt,D)}}else if(t.type==="Polygon")for(let It of Uv(t.geometry,0)){let Rt=R$(It,16);qt(It[0],new bd(Rt.x,Rt.y,0,0,void 0),D)}else if(t.type==="LineString")for(let It of t.geometry)qt(It,new bd(It[0].x,It[0].y,0,0,void 0),D);else if(t.type==="Point")for(let It of t.geometry)for(let Rt of It)qt([Rt],new bd(Rt.x,Rt.y,0,0,void 0),D)}let oy=255,wd=oy*gc;function eL(l,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y){let J=(function(le,me,ye,we,je,Ae,We,Ke){let Qe=[];if(me.positionedLines.length===0)return Qe;let at=we.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,ct=(function(rt){let xt=rt[0],ft=rt[1],qt=xt*ft;return qt>0?[xt,-ft]:qt<0?[-xt,ft]:xt===0?[ft,xt]:[ft,-xt]})(ye),nt=Math.abs(me.top-me.bottom);for(let rt of me.positionedLines)nt-=rt.lineOffset;let it=me.positionedLines.length,qe=nt/it,He=me.top-ye[1];for(let rt=0;rt<it;++rt){let xt=me.positionedLines[rt];He=O$(me,qe,He,rt);for(let ft of xt.positionedGlyphs){if(!ft.rect)continue;let qt=ft.rect||{},It=DF+1,Rt=!0,Bt=1,In=0;if(ft.image){let En=We.get(ft.image.toString());if(!En)continue;if(En.sdf){Pt("SDF images are not supported in formatted text and will be ignored.");continue}Rt=!1,Bt=En.pixelRatio,It=nf/Bt}let mt=(je||Ke)&&ft.vertical,Ut=ft.metrics.advance*ft.scale/2,dn=ft.metrics,Ln=ft.rect;if(Ln===null)continue;Ke&&me.verticalizable&&(In=ft.image?Ut-ft.metrics.width*ft.scale/2:0);let zn=je?[ft.x+Ut,ft.y]:[0,0],_n=[0,0],_i=[0,0],ce=!1;je||(mt?(_i=[ft.x+Ut+ct[0],ft.y+ct[1]-In],ce=!0):_n=[ft.x+Ut+ye[0],ft.y+ye[1]-In]);let pe=Ln.w*ft.scale/(Bt*(ft.localGlyph?_c:1)),Ze=Ln.h*ft.scale/(Bt*(ft.localGlyph?_c:1)),lt,Et,St,Wt;if(mt){let En=ft.y-He,Tn=new st(-Ut,Ut-En),On=-Math.PI/2,rn=new st(..._i);lt=new st(-Ut+_n[0],_n[1]),lt._rotateAround(On,Tn)._add(rn),lt.x+=-En+Ut,lt.y-=(dn.left-It)*ft.scale;let un=ft.image?dn.advance*ft.scale:fo*ft.scale,Hn=String.fromCodePoint(ft.glyph);p$(Hn)?lt.x+=(1-It)*ft.scale:f$(Hn)?lt.x+=un-dn.height*ft.scale+(-It-1)*ft.scale:lt.x+=ft.image||dn.width+2*It===Ln.w&&dn.height+2*It===Ln.h?(un-Ze)/2:(un-(dn.height+2*It)*ft.scale)/2,Et=new st(lt.x,lt.y-pe),St=new st(lt.x+Ze,lt.y),Wt=new st(lt.x+Ze,lt.y-pe)}else{let En=(dn.left-It)*ft.scale-Ut+_n[0],Tn=(-dn.top-It)*ft.scale+_n[1],On=En+pe,rn=Tn+Ze;lt=new st(En,Tn),Et=new st(On,Tn),St=new st(En,rn),Wt=new st(On,rn)}if(at){let En;En=je?new st(0,0):ce?new st(ct[0],ct[1]):new st(ye[0],ye[1]),lt._rotateAround(at,En),Et._rotateAround(at,En),St._rotateAround(at,En),Wt._rotateAround(at,En)}let Yt=new st(0,0),mn=new st(0,0);Qe.push({tl:lt,tr:Et,bl:St,br:Wt,texPrimary:qt,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:zn,sectionIndex:ft.sectionIndex,isSDF:Rt,pixelOffsetTL:Yt,pixelOffsetBR:mn,minFontScaleX:0,minFontScaleY:0})}}return Qe})(0,u,b,m,g,v,h,l.allowVerticalPlacement),ie=l.textSizeData,he=null;ie.kind==="source"?(he=[gc*m.layout.get("text-size").evaluate(v,{},H)*R.textScaleFactor],he[0]>wd&&Pt(`${l.layerIds[0]}: Value for "text-size" is >= ${oy}. Reduce your "text-size".`)):ie.kind==="composite"&&(he=[gc*R.compositeTextSizes[0].evaluate(v,{},H)*R.textScaleFactor,gc*R.compositeTextSizes[1].evaluate(v,{},H)*R.textScaleFactor],(he[0]>wd||he[1]>wd)&&Pt(`${l.layerIds[0]}: Value for "text-size" is >= ${oy}. Reduce your "text-size".`)),l.addSymbols(l.text,J,he,b,g,v,T,t,s,E.lineStartIndex,E.lineLength,O,B,H,Y,!1,$,J.length);for(let le of I)D[le]=l.text.placedSymbolArray.length-1;return 4*J.length}function dw(l){for(let t in l)return l[t];return null}function hw(l,t,s,u,h,m,g,v,b,E,T){let I,D,O,R;if(I=T?T.top:g.top,D=T?T.bottom:g.bottom,O=T?T.left:g.left,R=T?T.right:g.right,hM(g)&&g.collisionPadding){let B=g.collisionPadding;O-=B[0],I-=B[1],R+=B[2],D+=B[3]}if(b){let B=new st(O,I),H=new st(R,I),$=new st(O,D),Y=new st(R,D),J=Zn(b),ie=new st(0,0);E&&(ie=new st(E[0],E[1])),B._rotateAround(J,ie),H._rotateAround(J,ie),$._rotateAround(J,ie),Y._rotateAround(J,ie),O=Math.min(B.x,H.x,$.x,Y.x),R=Math.max(B.x,H.x,$.x,Y.x),I=Math.min(B.y,H.y,$.y,Y.y),D=Math.max(B.y,H.y,$.y,Y.y)}return l.emplaceBack(t.x,t.y,t.z,s.x,s.y,O,I,R,D,v,u,h,m),l.length-1}function xM(l){hM(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);let t=l.bottom-l.top;return t>0?Math.max(10,t):null}function H$(l,t,s,u){let h=l.compareText;if(t in h){let m=h[t];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<s)return!0}else h[t]=[];return h[t].push(u),!1}function tL(l,t){let s=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,h=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),m=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01)),g=Math.sin(l._pitch)*m+h,v=h*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let b=Math.max(l.zoom-17,0);l.isOrthographic&&(b/=10),g*=1+b}return Math.min(1.01*g,v)}function sy(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};let s=Math.pow(2,-l.z),u=l.x*s,h=(l.x+1)*s,m=l.y*s,g=(l.y+1)*s,v=A(u),b=A(h),E=L(m),T=L(g),I=t.project(v,E),D=t.project(b,E),O=t.project(b,T),R=t.project(v,T),B=Math.min(I.x,D.x,O.x,R.x),H=Math.min(I.y,D.y,O.y,R.y),$=Math.max(I.x,D.x,O.x,R.x),Y=Math.max(I.y,D.y,O.y,R.y),J=s/16;function ie(le,me,ye,we,je,Ae){let We=(ye+je)/2,Ke=(we+Ae)/2,Qe=t.project(A(We),L(Ke)),at=Math.max(0,B-Qe.x,H-Qe.y,Qe.x-$,Qe.y-Y);B=Math.min(B,Qe.x),$=Math.max($,Qe.x),H=Math.min(H,Qe.y),Y=Math.max(Y,Qe.y),at>J&&(ie(le,Qe,ye,we,We,Ke),ie(Qe,me,We,Ke,je,Ae))}ie(I,D,u,m,h,m),ie(D,O,h,m,h,g),ie(O,R,h,g,u,g),ie(R,I,u,g,u,m),B-=J,H-=J,$+=J,Y+=J;let he=1/Math.max($-B,Y-H);return{scale:he,x:B*he,y:H*he,x2:$*he,y2:Y*he,projection:t}}function nL(l,{x:t,y:s},u=0){return new st(((t-u)*l.scale-l.x)*yt,(s*l.scale-l.y)*yt)}let G$=ht(new Float32Array(16));class Sh{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new c(0,0)}projectTilePoint(t,s,u){return{x:t,y:s,z:0}}locationPoint(t,s,u,h=!0){return t._coordinatePoint(t.locationCoordinate(s,u),h)}pixelsPerMeter(t,s){return M(1,t)*s}pixelSpaceConversion(t,s,u){return 1}farthestPixelDistance(t){return tL(t,t.pixelsPerMeter)}pointCoordinate(t,s,u,h){let m=t.horizonLineFromTop(!1),g=new st(s,Math.max(m,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,s,u){let h=new st(s,u);if(t.elevation)return t.elevation.pointCoordinate(h);{let m=this.pointCoordinate(t,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(t,s){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,s.x,s.y);let u=t.horizonLineFromTop();return s.y<u}createInversionMatrix(t,s){return G$}createTileMatrix(t,s,u){let h,m,g,v=u.canonical,b=ht(new Float64Array(16));if(this.isReprojectedInTileSpace){let E=sy(v,this);h=1,m=E.x+u.wrap*E.scale,g=E.y,Vn(b,b,[h/E.scale,h/E.scale,t.pixelsPerMeter/s])}else h=s/t.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*u.wrap)*h,g=v.y*h;return Xt(b,b,[m,g,0]),Vn(b,b,[h/yt,h/yt,1]),b}upVector(t,s,u){return[0,0,1]}upVectorScale(t,s,u){return{metersToTile:1}}}class q$ extends Sh{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[s,u]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Zn(s));this.n=(h+Math.sin(Zn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,s){let{n:u,c:h,r0:m}=this,g=Zn(t-this.center[0]),v=Zn(s),b=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:b*Math.sin(g*u),y:b*Math.cos(g*u)-m,z:0}}unproject(t,s){let{n:u,c:h,r0:m}=this,g=m+s,v=Math.atan2(t,Math.abs(g))*Math.sign(g);g*u<0&&(v-=Math.PI*Math.sign(t)*Math.sign(g));let b=Zn(this.center[0])*u;v=se(v,-Math.PI-b,Math.PI-b);let E=G(os(v/u)+this.center[0],-180,180),T=Math.asin(G((h-(t*t+g*g)*u*u)/(2*u),-1,1)),I=G(os(T),-N,N);return new c(E,I)}}let ay=1.340264,ly=-.081106,cy=893e-6,uy=.003796,pw=Math.sqrt(3)/2;class W$ extends Sh{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;let u=Math.asin(pw*Math.sin(s)),h=u*u,m=h*h*h;return{x:.5*(t*Math.cos(u)/(pw*(ay+3*ly*h+m*(7*cy+9*uy*h)))/Math.PI+.5),y:1-.5*(u*(ay+ly*h+m*(cy+uy*h))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=u*u,m=h*h*h;for(let T,I,D,O=0;O<12&&(I=u*(ay+ly*h+m*(cy+uy*h))-s,D=ay+3*ly*h+m*(7*cy+9*uy*h),T=I/D,u=G(u-T,-Math.PI/3,Math.PI/3),h=u*u,m=h*h*h,!(Math.abs(T)<1e-12));++O);let g=pw*t*(ay+3*ly*h+m*(7*cy+9*uy*h))/Math.cos(u),v=Math.asin(Math.sin(u)/pw),b=G(180*g/Math.PI,-180,180),E=G(180*v/Math.PI,-N,N);return new c(b,E)}}class Z$ extends Sh{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){let u=360*(t-.5),h=G(360*(.5-s),-N,N);return new c(u,h)}}let Vg=Math.PI/2;function fw(l){return Math.tan((Vg+l)/2)}class Y$ extends Sh{constructor(t){super(t),this.center=t.center||[0,30];let[s,u]=this.parallels=t.parallels||[30,30],h=Zn(s),m=Zn(u);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);let g=Math.cos(h),v=fw(h);this.n=h===m?Math.sin(h):Math.log(g/Math.cos(m))/Math.log(fw(m)/v),this.f=g*Math.pow(fw(h),this.n)/this.n}project(t,s){s=Zn(s),this.southernCenter&&(s=-s),t=Zn(t-this.center[0]);let u=1e-6,{n:h,f:m}=this;m>0?s<-Vg+u&&(s=-Vg+u):s>Vg-u&&(s=Vg-u);let g=m/Math.pow(fw(s),h),v=g*Math.sin(h*t),b=m-g*Math.cos(h*t);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;let{n:u,f:h}=this,m=h-s,g=Math.sign(m),v=Math.sign(u)*Math.sqrt(t*t+m*m),b=Math.atan2(t,Math.abs(m))*g;m*u<0&&(b-=Math.PI*Math.sign(t)*g);let E=G(os(b/u)+this.center[0],-180,180),T=G(os(2*Math.atan(Math.pow(h/v,1/u))-Vg),-N,N);return new c(E,this.southernCenter?-T:T)}}class iL extends Sh{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:w(t),y:S(s),z:0}}unproject(t,s){let u=A(t),h=L(s);return new c(u,h)}}let rL=Zn(N);class X$ extends Sh{project(t,s){let u=(s=Zn(s))*s,h=u*u;return{x:.5*((t=Zn(t))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=25,m=0,g=u*u;do{g=u*u;let E=g*g;m=(u*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-s)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),u=G(u-m,-rL,rL)}while(Math.abs(m)>1e-6&&--h>0);g=u*u;let v=G(os(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=os(u);return new c(v,b)}}let oL=Zn(N);class K$ extends Sh{project(t,s){s=Zn(s),t=Zn(t);let u=Math.cos(s),h=2/Math.PI,m=Math.acos(u*Math.cos(t/2)),g=Math.sin(m)/m,v=.5*(t*h+2*u*Math.sin(t/2)/g)||0,b=.5*(s+Math.sin(s)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,s){let u=t=(2*t-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,m=25,g=1e-6,v=0,b=0;do{let E=Math.cos(h),T=Math.sin(h),I=2*T*E,D=T*T,O=E*E,R=Math.cos(u/2),B=Math.sin(u/2),H=2*R*B,$=B*B,Y=1-O*R*R,J=Y?1/Y:0,ie=Y?Math.acos(E*R)*Math.sqrt(1/Y):0,he=.5*(2*ie*E*B+2*u/Math.PI)-t,le=.5*(ie*T+h)-s,me=.5*J*(O*$+ie*E*R*D)+1/Math.PI,ye=J*(H*I/4-ie*T*B),we=.125*J*(I*B-ie*T*O*H),je=.5*J*(D*R+ie*$*E)+.5,Ae=ye*we-je*me;v=(le*ye-he*je)/Ae,b=(he*we-le*me)/Ae,u=G(u-v,-Math.PI,Math.PI),h=G(h-b,-oL,oL)}while((Math.abs(v)>g||Math.abs(b)>g)&&--m>0);return new c(os(u),os(h))}}class sL extends Sh{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){let{scale:u,cosPhi:h}=this;return{x:Zn(t)*h*u+.5,y:-Math.sin(Zn(s))/h*u+.5,z:0}}unproject(t,s){let{scale:u,cosPhi:h}=this,m=-(s-.5)/u,g=G(os((t-.5)/u)/h,-180,180),v=Math.asin(G(m*h,-1,1)),b=G(os(v),-N,N);return new c(g,b)}}class Q$ extends iL{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,s,u){let h=Fv(t,s,u);return Fr(h,h,N1(Ja(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,s,u){let h=vh(s.lat,s.lng),m=Yi([],h),g=u?t._centerAltitude+u:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude;Qs(h,h,m,M(1,0)*yt*g);let v=ht(new Float64Array(16));return Mt(v,t.pixelMatrix,t.globeMatrix),Fr(h,h,v),new st(h[0],h[1])}pixelsPerMeter(t,s){return M(1,0)*s}pixelSpaceConversion(t,s,u){let h=M(1,t)*s,m=on(M(1,45)*s,h,u);return this.pixelsPerMeter(t,s)/m}createTileMatrix(t,s,u){let h=SI(Ja(u.canonical));return Mt(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,s){let{center:u}=t,h=N1(Ja(s));return Hi(h,h,Zn(u.lng)),sr(h,h,Zn(u.lat)),Vn(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,s,u,h){return xh(t,s,u,!0)||new ee(0,0)}pointCoordinate3D(t,s,u){let h=this.pointCoordinate(t,s,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,s){return!xh(t,s.x,s.y,!1)}farthestPixelDistance(t){let s=(function(h,m){let g=h.cameraToCenterDistance,v=h._centerAltitude*m,b=h._camera,E=h._camera.forward(),T=Wr([],fr([],E,-g),[0,0,v]),I=h.worldSize/(2*Math.PI),D=[0,0,-I],O=h.width/h.height,R=Math.tan(h.fovAboveCenter),B=fr([],b.up(),R),H=fr([],b.right(),R*O),$=Yi([],Wr([],Wr([],E,B),H)),Y=[],J;if(new zt(T,$).closestPointOnSphere(D,I,Y)){let ie=Wr([],Y,D),he=Vr([],ie,T);J=Math.cos(h.fovAboveCenter)*xo(he)}else{let ie=Vr([],T,D),he=Vr([],D,T);Yi(he,he);let le=xo(ie)-I;J=Math.sqrt(le*(le+2*I));let me=Math.acos(J/(I+le))-Math.acos(Ir(E,he));J*=Math.cos(me)}return 1.01*J})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=bh(t.zoom);if(u>0){let h=tL(t,M(1,t.center.lat)*t.worldSize),m=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return on(s,h+m*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(t,s,u){return Fv(s,u,t,1)}upVectorScale(t){return{metersToTile:Il(L1(Ja(t)))}}}function aL(l){let t=l.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new iL(l);case"equirectangular":return new Z$(l);case"naturalEarth":return new X$(l);case"equalEarth":return new W$(l);case"winkelTripel":return new K$(l);case"albers":return s?new sL(l):new q$(l);case"lambertConformalConic":return s?new sL(l):new Y$(l);case"globe":return new Q$(l)}throw new Error(`Invalid projection name: ${l.name}`)}let J$=Ce.types,eH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dy(l,t,s,u,h,m,g,v,b,E,T,I,D){let O=v?Math.min(wd,Math.round(v[0])):0,R=v?Math.min(wd,Math.round(v[1])):0;l.emplaceBack(t,s,Math.round(32*u),Math.round(32*h),m,g,(O<<1)+(b?1:0),0+(R<<1),16*E,16*T,256*I,256*D)}function hy(l,t,s){l.emplaceBack(t,s)}function py(l,t,s,u,h,m,g){l.emplaceBack(t,s,u,h,m,g)}let mw=(l,t,s,u)=>{for(let h=0;h<t;h++)l.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function Ug(l,t,s,u,h){l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h),l.emplaceBack(t,s,u,h)}function tH(l){for(let t of l.sections)if(cI(t.text))return!0;return!1}class bM{constructor(t){this.layoutVertexArray=new vv,this.indexArray=new Kr,this.programConfigurations=t,this.segments=new nr,this.dynamicLayoutVertexArray=new su,this.opacityVertexArray=new ug,this.placedSymbolArray=new D1,this.iconTransitioningVertexArray=new ia,this.globeExtVertexArray=new yv,this.zOffsetVertexArray=new ac,this.orientationVertexArray=new wv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(t,s){let u=[],h=this.layoutVertexArray.uint16;for(let m=0;m<s;++m){let g=12*(t+m);u.push(...h.slice(g,g+12))}return u}updateIconVertexData(t,s,u,h,m,g,v,b,E,T,I,D,O){let R=this.layoutVertexArray.uint16,B=12*t;R[B]=s,R[B+1]=u,R[B+2]=h,R[B+3]=m,R[B+4]=g,R[B+5]=v,R[B+6]=b,R[B+7]=E,R[B+8]=T,R[B+9]=I,R[B+10]=D,R[B+11]=O}upload(t,s,u,h,m,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,i$.members,!!g),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,o$.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,eH,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,l$.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,r$.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,s$.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,a$.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Lt(bM,"SymbolBuffers");class wM{constructor(t,s,u){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new u,this.segments=new nr,this.collisionVertexArray=new xv,this.collisionVertexArrayExt=new su}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,c$.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,u$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Lt(wM,"CollisionBuffers");class gw{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ht([]),this.placementViewportMatrix=ht([]);let s=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.localizable=t.localizable,this.textSizeData=Lg(this.zoom,s["text-size"],this.worldview),this.iconSizeData=Lg(this.zoom,s["icon-size"],this.worldview);let u=this.layers[0].layout,h=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.lut=t.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>sa[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(t){let s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(t)!=null)}createArrays(){this.text=new bM(new Ka(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new bM(new Ka(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new vg,this.lineVertexArray=new P1,this.symbolInstances=new Iv}calculateGlyphDependencies(t,s,u,h,m){for(let g of t){let v=g.codePointAt(0);if(v===void 0)break;if(s[v]=!0,h&&m&&v<=65535){let b=ey[g];b&&(s[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(t,s,u,h,m,g){let v=1,b=t.getUnevaluatedProperties()._values["icon-size"],E=Lg(this.zoom,b,this.worldview),T=Ng(E,s);if(E.kind!=="constant"&&E.kind!=="camera"||(v=T.uSize),E.kind==="composite"){let{minZoom:I,maxZoom:D}=E,O=b.possiblyEvaluate(new Ui(I,{worldview:this.worldview}),h),R=b.possiblyEvaluate(new Ui(D,{worldview:this.worldview}),h),B=O.evaluate(u,{},h,m);v=B+(R.evaluate(u,{},h,m)-B)*T.uSizeT}return E.kind==="source"&&(v=b.possiblyEvaluate(new Ui(this.zoom,{worldview:this.worldview}),h).evaluate(u,{},h,m)),v*g}updateFootprints(t,s){}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!$1(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(t){return typeof t=="string"?ps.build(t):t}populate(t,s,u,h){let m=this.layers[0],g=m.layout,v=this.projection.name==="globe",b=g.get("text-font"),E=g.get("text-field"),T=g.get("icon-image"),[I,D]=g.get("icon-size-scale-range"),O=G(s.scaleFactor||1,I,D),R=(E.value.kind!=="constant"||E.value.value instanceof hs&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),$=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!R&&!B&&!H)return;let Y=s.iconDependencies,J=s.glyphDependencies,ie=s.availableImages,he=new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),le=me=>{let ye=me.id.toString();Y.has(ye)?Y.get(ye).push(me):Y.set(ye,[me])};for(let me of t){let{feature:ye,id:we,index:je,sourceLayerIndex:Ae}=me,We=m._featureFilter.needGeometry,Ke=De(ye,We);if(!m._featureFilter.filter(he,Ke,u))continue;if(We||(Ke.geometry=_e(ye,u,h)),v&&ye.type!==1&&u.z<=5){let rt=Ke.geometry,xt=.98078528056,ft=(qt,It)=>Ir(Fv(qt.x,qt.y,u,1),Fv(It.x,It.y,u,1))<xt;for(let qt=0;qt<rt.length;qt++)rt[qt]=de(rt[qt],ft)}let Qe,at;if(R){let rt=m.getValueAndResolveTokens("text-field",Ke,u,ie),xt=hs.factory(rt);tH(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||Vp()==="unavailable"||this.hasRTLText&&sc.isParsed())&&(Qe=h$(xt,m,Ke))}if(B){let rt=m.getValueAndResolveTokens("icon-image",Ke,u,ie);at=this.getResolvedImageFromTokens(rt)}let ct=this.layers[0],nt=!1;if(!at&&H){let rt=ct.getAppearances();for(let xt of rt)if(xt.getProperty("icon-image")){let ft=ct.getAppearanceValueAndResolveTokens(xt,"icon-image",Ke,u,ie);if(ft){at=this.getResolvedImageFromTokens(ft),nt=!0;break}}}if(!Qe&&!at)continue;let it=this.sortFeaturesByKey?$.evaluate(Ke,{},u):void 0,qe={id:we,text:Qe,icon:at,index:je,sourceLayerIndex:Ae,geometry:Ke.geometry,properties:ye.properties,type:J$[ye.type],sortKey:it};if(this.features.push(qe),this.featureToAppearanceIndex[je]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:we,properties:ye.properties,usesAppearanceIconAsPlaceholder:nt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),at){let rt=ct._unevaluatedLayout._values,{iconPrimary:xt,iconSecondary:ft}=ry(at,this.iconSizeData,rt["icon-size"],u,this.zoom,qe,this.pixelRatio,O,this.worldview);le(xt),ft&&(this.hasAnySecondaryIcon=!0,le(ft))}let He=ct.getAppearances();if(He.length!==0&&He.forEach(rt=>{if(!rt.getProperty("icon-image"))return;let xt=this.getCombinedIconPrimary(rt,ct,Ke,u,ie,qe,O);xt&&le(xt)}),Qe){let rt=b.evaluate(Ke,{},u).join(","),xt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sa.vertical)>=0;for(let ft of Qe.sections)if(ft.image){let qt=ft.image.getPrimary().scaleSelf(this.pixelRatio),It=qt.id.toString(),Rt=Y.get(It)||[];Rt.push(qt),Y.set(It,Rt)}else{let qt=zp(Qe.toString()),It=ft.fontStack||rt,Rt=J[It]=J[It]||{};this.calculateGlyphDependencies(ft.text,Rt,xt,this.allowVerticalPlacement,qt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(me){let ye={},we={},je=[],Ae=0;function We(ct){je.push(me[ct]),Ae++}function Ke(ct,nt,it){let qe=we[ct];return delete we[ct],we[nt]=qe,je[qe].geometry[0].pop(),je[qe].geometry[0]=je[qe].geometry[0].concat(it[0]),qe}function Qe(ct,nt,it){let qe=ye[nt];return delete ye[nt],ye[ct]=qe,je[qe].geometry[0].shift(),je[qe].geometry[0]=it[0].concat(je[qe].geometry[0]),qe}function at(ct,nt,it){let qe=it?nt[0][nt[0].length-1]:nt[0][0];return`${ct}:${qe.x}:${qe.y}`}for(let ct=0;ct<me.length;ct++){let nt=me[ct],it=nt.geometry,qe=nt.text?nt.text.toString():null;if(!qe){We(ct);continue}let He=at(qe,it),rt=at(qe,it,!0);if(He in we&&rt in ye&&we[He]!==ye[rt]){let xt=Qe(He,rt,it),ft=Ke(He,rt,je[xt].geometry);delete ye[He],delete we[rt],we[at(qe,je[ft].geometry,!0)]=ft,je[xt].geometry=null}else He in we?Ke(He,rt,it):rt in ye?Qe(He,rt,it):(We(ct),ye[He]=Ae-1,we[rt]=Ae-1)}return je.filter(ct=>ct.geometry)})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(let me of s.elevationFeatures)this.elevationFeatureIdToIndex.set(me.id,this.elevationFeatures.length),this.elevationFeatures.push(me)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((me,ye)=>me.sortKey-ye.sortKey)}getCombinedIconPrimary(t,s,u,h,m,g,v){let b,E,T=t.getUnevaluatedProperties();if(T._values["icon-image"].value!==void 0){let I=s.getAppearanceValueAndResolveTokens(t,"icon-image",u,h,m);b=this.getResolvedImageFromTokens(I)}else{let I=s.getValueAndResolveTokens("icon-image",u,h,m);b=this.getResolvedImageFromTokens(I)}if(b){let I=T._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];E=ry(b,Lg(this.zoom,I,this.worldview),I,h,this.zoom,g,this.pixelRatio,v,this.worldview).iconPrimary}return E}updateAppearanceBasedIconTextures(t,s,u,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;let m=this.layers[0],g=!1,v=0,b=m.layout,[E,T]=b.get("icon-size-scale-range"),I=G(1,E,T);for(let D=0;D<this.symbolInstances.length;D++){let O=this.symbolInstances.get(D),R=this.featureToAppearanceIndex[O.featureIndex],B=R!==void 0?this.appearanceFeatureData[R]:void 0;if(B&&O.placedIconSymbolIndex>=0){let H=B.id,$=s&&H!==void 0?s[String(H)]:void 0,Y={type:"Point",id:B.id,properties:B.properties,geometry:[]},J=this.layers[0].appearances&&this.layers[0].appearances.find(ie=>ie.isActive({globals:h,feature:Y,canonical:t,featureState:$}));if(B.activeAppearance===J){v+=O.numIconVertices;continue}if(J){B.activeAppearance=J;let ie=this.getCombinedIconPrimary(J,m,Y,t,u,{sortKey:void 0,text:void 0,icon:null,index:O.featureIndex,sourceLayerIndex:O.featureIndex,geometry:[],properties:B.properties,type:"Point",id:B.id},I);if(!ie)continue;let he=ie.toString(),le=this.iconAtlasPositions&&this.iconAtlasPositions.get(he);if(le){let me=m.getAppearanceValueAndResolveTokens(J,"icon-offset",Y,t,u),ye=me&&Array.isArray(me)?me:[0,0],we=sw(le,void 0,ye,m.layout.get("icon-anchor").evaluate(Y,{},t)),je=m.getAppearanceValueAndResolveTokens(J,"icon-rotate",Y,t,u),Ae=typeof je=="number"?je:0,We=le.sdf,Ke=m.layout.get("icon-text-fit").constantOr("none");Ke!=="none"&&B.textShaping&&B.iconTextFitPadding&&B.fontScale&&(we=pM(we,B.textShaping,Ke,B.iconTextFitPadding,ye,B.fontScale));let Qe=this.calculateEffectiveAppearanceIconSize(J,h.zoom,Y,t,u,I),at=0,ct=1+(Math.min(wd,Math.round(Qe*gc))<<1),nt=_M(we,Ae,We,Ke!=="none",I);B.isUsingAppearanceVertexData||(B.isUsingAppearanceVertexData=!0,B.layoutBasedVertexData=this.icon.getIconVertexData(v,O.numIconVertices));for(let qe=0;qe<nt.length;++qe){let He=nt[qe],rt=B.layoutBasedVertexData[0]||O.tileAnchorX,xt=B.layoutBasedVertexData[1]||O.tileAnchorY,ft=16*He.pixelOffsetTL.x,qt=16*He.pixelOffsetTL.y,It=16*He.pixelOffsetBR.x,Rt=16*He.pixelOffsetBR.y,Bt=16*He.minFontScaleX,In=16*He.minFontScaleY;this.icon.updateIconVertexData(v,rt,xt,Math.round(32*He.tl.x),Math.round(32*He.tl.y),He.texPrimary.x,He.texPrimary.y,at,ct,ft,qt,Bt,In),this.icon.updateIconVertexData(v+1,rt,xt,Math.round(32*He.tr.x),Math.round(32*He.tr.y),He.texPrimary.x+He.texPrimary.w,He.texPrimary.y,at,ct,It,qt,Bt,In),this.icon.updateIconVertexData(v+2,rt,xt,Math.round(32*He.bl.x),Math.round(32*He.bl.y),He.texPrimary.x,He.texPrimary.y+He.texPrimary.h,at,ct,ft,Rt,Bt,In),this.icon.updateIconVertexData(v+3,rt,xt,Math.round(32*He.br.x),Math.round(32*He.br.y),He.texPrimary.x+He.texPrimary.w,He.texPrimary.y+He.texPrimary.h,at,ct,It,Rt,Bt,In),v+=4}let it=O.numIconVertices-4*nt.length;for(let qe=0;qe<it;++qe)this.icon.updateIconVertexData(v+qe,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else v+=O.numIconVertices}else if(B.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),v+=O.numIconVertices,B.activeAppearance=null;else if(B.isUsingAppearanceVertexData){let he=B.layoutBasedVertexData.length/12;for(let le=0;le<he;++le){let me=le*12;this.icon.updateIconVertexData(v+le,B.layoutBasedVertexData[me+0],B.layoutBasedVertexData[me+1],B.layoutBasedVertexData[me+2],B.layoutBasedVertexData[me+3],B.layoutBasedVertexData[me+4],B.layoutBasedVertexData[me+5],B.layoutBasedVertexData[me+6],B.layoutBasedVertexData[me+7],B.layoutBasedVertexData[me+8],B.layoutBasedVertexData[me+9],B.layoutBasedVertexData[me+10],B.layoutBasedVertexData[me+11])}v+=he,B.isUsingAppearanceVertexData=!1,B.activeAppearance=null,g=!0}else v+=O.numIconVertices,B.activeAppearance=null}}return g}update(t,s,u,h,m,g,v){this.text.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,s,m,u,h,g,v,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1,u=q(t),h=1/u,m=!1,g=!1;for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v),E=xr(1,0,0),T=xr(0,1,0),{numHorizontalGlyphVertices:I,numVerticalGlyphVertices:D,numIconVertices:O,numVerticalIconVertices:R}=b,B=I>0||D>0,H=O>0,$=this.elevationFeatures[b.elevationFeatureIndex];if($){let Y=new st(b.tileAnchorX,b.tileAnchorY),J=.075+$.pointElevation(Y);b.zOffset!==J&&(s=!0,b.zOffset=J),J!==0&&(this.hasAnyZOffset=!0);let ie=$.computeSlopeNormal(Y,h),he=Wd(Zl(),xr(0,0,1),ie);Uc(E,E,he),Uc(T,T,he),E[2]*=u,T[2]*=u,E[0]===1&&E[1]===0&&E[2]===0&&T[0]===0&&T[1]===1&&T[2]===0||(m=m||B,g=g||H)}if(B&&(mw(this.text.orientationVertexArray,I,E,T),mw(this.text.orientationVertexArray,D,E,T)),H){let{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:J}=b;Y>=0&&mw(this.icon.orientationVertexArray,O,E,T),J>=0&&mw(this.icon.orientationVertexArray,R,E,T)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let t=(m,g,v)=>{u+=g,u>m.length&&m.resize(u);for(let b=-g;b<0;b++)m.emplace(b+u,v)},s=(m,g,v)=>{h+=g,h>m.length&&m.resize(h);for(let b=-g;b<0;b++)m.emplace(b+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){let g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:E}=g,T=g.zOffset,I=E>0;if((v>0||b>0)&&(t(this.text.zOffsetVertexArray,v,T),t(this.text.zOffsetVertexArray,b,T)),I){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:O}=g;D>=0&&s(this.icon.zOffsetVertexArray,E,T),O>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t,s,u,h,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(t,s,u,h){return!!(t&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(t,s,u,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=aL(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){let u=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:h,y:m}of s)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,s,u,h,m,g,v,b,E,T,I,D,O,R,B,H,$,Y){let J=t.indexArray,ie=t.layoutVertexArray,he=t.globeExtVertexArray,le=t.segments.prepareSegment(4*Y,ie,J,this.canOverlap?g.sortKey:void 0),me=this.glyphOffsetArray.length,ye=le.vertexLength,we=this.allowVerticalPlacement&&v===sa.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let Ke=0;Ke<s.length;Ke++){let{tl:Qe,tr:at,bl:ct,br:nt,texPrimary:it,texSecondary:qe,pixelOffsetTL:He,pixelOffsetBR:rt,minFontScaleX:xt,minFontScaleY:ft,glyphOffset:qt,isSDF:It,sectionIndex:Rt}=s[Ke],Bt=le.vertexLength,In=qt[1];if(dy(ie,E.x,E.y,Qe.x,In+Qe.y,it.x,it.y,u,It,He.x,He.y,xt,ft),dy(ie,E.x,E.y,at.x,In+at.y,it.x+it.w,it.y,u,It,rt.x,He.y,xt,ft),dy(ie,E.x,E.y,ct.x,In+ct.y,it.x,it.y+it.h,u,It,He.x,rt.y,xt,ft),dy(ie,E.x,E.y,nt.x,In+nt.y,it.x+it.w,it.y+it.h,u,It,rt.x,rt.y,xt,ft),b){let{x:mt,y:Ut,z:dn}=b.anchor,[Ln,zn,_n]=b.up;py(he,mt,Ut,dn,Ln,zn,_n),py(he,mt,Ut,dn,Ln,zn,_n),py(he,mt,Ut,dn,Ln,zn,_n),py(he,mt,Ut,dn,Ln,zn,_n),Ug(t.dynamicLayoutVertexArray,mt,Ut,dn,we)}else Ug(t.dynamicLayoutVertexArray,E.x,E.y,E.z,we);if(H){let mt=qe||it;hy(t.iconTransitioningVertexArray,mt.x,mt.y),hy(t.iconTransitioningVertexArray,mt.x+mt.w,mt.y),hy(t.iconTransitioningVertexArray,mt.x,mt.y+mt.h),hy(t.iconTransitioningVertexArray,mt.x+mt.w,mt.y+mt.h)}J.emplaceBack(Bt,Bt+1,Bt+2),J.emplaceBack(Bt+1,Bt+2,Bt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qt[0]),Ke!==s.length-1&&Rt===s[Ke+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,g,g.index,{},O,R,B,je&&je[Rt],this.worldview)}let Ae=Y-s.length;Ae!==0&&this._addNullVertices(Ae,ie,u,b,he,t,H,le,J);let We=b?b.anchor:E;t.placedSymbolArray.emplaceBack(We.x,We.y,We.z,E.x,E.y,me,this.glyphOffsetArray.length-me,ye,T,I,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,0,0,D,0),t.symbolInstanceIndices.push($)}_addNullVertices(t,s,u,h,m,g,v,b,E){for(let T=0;T<t;T++){for(let D=0;D<4;D++)dy(s,0,0,0,0,0,0,u,!1,0,0,0,0),h&&py(m,0,0,0,0,0,0),Ug(g.dynamicLayoutVertexArray,0,0,0,0),v&&hy(g.iconTransitioningVertexArray,0,0);let I=b.vertexLength;E.emplaceBack(I,I+1,I+2),E.emplaceBack(I+1,I+2,I+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(t,s,u,h,m,g,v){t.emplaceBack(s,u,h,m,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,s,u,h,m,g,v){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=b.vertexLength,T=v.tileAnchorX,I=v.tileAnchorY;for(let O=0;O<4;O++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,t.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new st(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new st(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new st(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,T,I,new st(t.x1,t.y2)),b.vertexLength+=4;let D=u.indexArray;D.emplaceBack(E,E+1),D.emplaceBack(E+1,E+2),D.emplaceBack(E+2,E+3),D.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,u,h,m,g){for(let v=h;v<m;v++){let b=u.get(v),E=this.getSymbolInstanceTextSize(t,g,s,v);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,s,u,h,m,g){for(let v=h;v<m;v++){let b=u.get(v),E=this.getSymbolInstanceIconSize(t,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wM(hg,SF.members,ia),this.iconCollisionBox=new wM(hg,SF.members,ia);let h=Ng(this.iconSizeData,t),m=Ng(this.textSizeData,t,u);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,t,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,t,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,t,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,t,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(t,s,u,h){let m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),g=fM(this.textSizeData,t,m)/fo;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,s,u){let h=this.icon.placedSymbolArray.get(u),m=fM(this.iconSizeData,t,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(t,s,u,h){t.emplaceBack(s,-u,-u,h),t.emplaceBack(s,u,-u,h),t.emplaceBack(s,u,u,h),t.emplaceBack(s,-u,u,h)}_updateTextDebugCollisionBoxes(t,s,u,h,m,g,v){for(let b=h;b<m;b++){let E=u.get(b),T=this.getSymbolInstanceTextSize(t,g,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,E.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,s,u,h,m,g,v){for(let b=h;b<m;b++){let E=u.get(b),T=this.getSymbolInstanceIconSize(t,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,E.padding,g.zOffset)}}updateCollisionDebugBuffers(t,s,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let m=Ng(this.iconSizeData,t,h),g=Ng(this.textSizeData,t,u);for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(g,t,s,b.textBoxStartIndex,b.textBoxEndIndex,b,u),this._updateTextDebugCollisionBoxes(g,t,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(m,t,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b,h),this._updateIconDebugCollisionBoxes(m,t,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,u,h,m,g,v,b,E){let T={};if(s<u){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie,featureIndex:he}=t.get(s);T.textBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie},T.textFeatureIndex=he}if(h<m){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie,featureIndex:he}=t.get(h);T.verticalTextBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie},T.verticalTextFeatureIndex=he}if(g<v){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie,featureIndex:he}=t.get(g);T.iconBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie},T.iconFeatureIndex=he}if(b<E){let{x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie,featureIndex:he}=t.get(b);T.verticalIconBox={x1:I,y1:D,x2:O,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:ie},T.verticalIconFeatureIndex=he}return T}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){let u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,s){let u=t.placedSymbolArray.get(s),h=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let s=Math.sin(t),u=Math.cos(t),h=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);let b=this.symbolInstances.get(v);h.push(0|Math.round(s*b.tileAnchorX+u*b.tileAnchorY)),m.push(b.featureIndex)}return g.sort((v,b)=>h[v]-h[b]||m[b]-m[v]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,s){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let s of this.symbolInstanceIndexes){let u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(t){let s=this.symbolInstances.get(this.text.symbolInstanceIndices[t]).elevationFeatureIndex,u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function lL(l,t){return t.replace(/{([^{}]+)}/g,(s,u)=>u in l?String(l[u]):"")}let cL,uL,CM;Lt(gw,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),gw.addDynamicAttributes=Ug;class dL{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wa,this.defaultValue=t}evaluate(t){if(t.formattedSection){let s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt(dL,"FormatSectionOverride",{omit:["defaultValue"]});let EM=()=>CM||(CM={layout:cL||(cL=new gr({"symbol-placement":new gt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ct(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new gt(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new gt(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new gt(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ct(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new gt(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ct(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ct(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ct(Oe.layout_symbol["icon-image"]),"icon-image-use-theme":new gt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Ct(Oe.layout_symbol["icon-rotate"]),"icon-padding":new gt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ct(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Ct(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ct(Oe.layout_symbol["text-field"]),"text-font":new Ct(Oe.layout_symbol["text-font"]),"text-size":new Ct(Oe.layout_symbol["text-size"]),"text-size-scale-range":new gt(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new Ct(Oe.layout_symbol["text-max-width"]),"text-line-height":new Ct(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ct(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ct(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Ct(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Ct(Oe.layout_symbol["text-anchor"]),"text-max-angle":new gt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ct(Oe.layout_symbol["text-rotate"]),"text-padding":new gt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new gt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Ct(Oe.layout_symbol["text-transform"]),"text-offset":new Ct(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Oe.layout_symbol["text-optional"]),visibility:new gt(Oe.layout_symbol.visibility)})),paint:uL||(uL=new gr({"icon-opacity":new Ct(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ct(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ct(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ct(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Ct(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Ct(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ct(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ct(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new gt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ct(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ct(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Ct(Oe.paint_symbol["text-color"],{runtimeType:Ms,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ct(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ct(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ct(Oe.paint_symbol["text-halo-blur"]),"text-translate":new gt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new gt(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new gt(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new gt(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new gt(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ct(Oe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},CM);class _w extends gs{constructor(t,s,u,h){super(t,EM(),s,u,h,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ht([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,s){super.recalculate(t,s),this.appearances&&this.appearances.forEach(h=>{h.recalculate(t,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let h=[];for(let m of u)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,s,u,h){return this._saturation===t&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(m,g,v,b){m=cr(m),g=Gn(g);let E=$e(),T=m/3,I=1-2*T,D=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],O=.5-.5*g,R=b-v;return Mt(E,[R,0,0,0,0,R,0,0,0,0,R,0,v,v,v,1],[g,0,0,0,0,g,0,0,0,0,g,0,O,O,O,1]),Mt(E,E,D),E})(t,s,u,h),this._saturation=t,this._contrast=s,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,s,u,h){let m=this.layout.get(t).evaluate(s,{},u,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Fp(g.value)||!m?m:lL(s.properties,m)}getAppearanceValueAndResolveTokens(t,s,u,h,m){let g=t.getProperty(s);if(!g)return;let v=g.evaluate(u,{},h,m),b=t.getUnevaluatedProperties()._values[s];return b.isDataDriven()||Fp(b.value)||!v||typeof v!="string"?v:lL(u.properties,v)}createBucket(t){return new gw(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of EM().paint.overridableProperties){if(!_w.hasPaintOverride(this.layout,t))continue;let s=this.paint.get(t),u=new dL(s),h=new Zm(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme")),m=null;m=s.value.kind==="constant"||s.value.kind==="source"?new ch("source",h):new cd("composite",h,s.value.zoomStops,s.value.interpolationType),this.paint._values[t]=new dd(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&_w.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){let u=t.get("text-field"),h=EM().paint.properties[s],m=!1,g=v=>{for(let b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof hs)g(u.value.value.sections);else if(u.value.kind==="source"){let v=E=>{m||(E instanceof ec&&po(E.value)===xp?g(E.value.sections):E instanceof yl?g(E.sections):E.eachChild(v))},b=u.value;b._styleExpression&&v(b._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,s,u){return{config:new lu(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let hL,pL,fL,mL;var SM=Pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vw(l,t,s,u,h,m,g,v){let b=[l,t,1,s,u,1,h,m,1],E=[g,v,1],T=oe([],b),[I,D,O]=Vc(E,E,T);return Me(b,b,[I,0,0,0,D,0,0,0,O])}function gL(l,t,s,u,h,m,g,v){let b=(function(E,T,I,D,O,R,B,H){let $=vw(0,0,1,0,1,1,0,1),Y=vw(E,T,I,D,O,R,B,H);return Me(Y,Y,oe([],$))})(l,t,s,u,h,m,g,v);return[b[2]/b[8]/yt,b[5]/b[8]/yt]}function yw(l){return[l[0],Math.min(Math.max(l[1],-N),N)]}class _L extends id{constructor(t,s,u,h){super(),this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(t,s){if(this._loaded=s||!1,this.fire(new _l("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=mm(this.map._requestManager.transformRequest(this.url,pp.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new _p(u)):h&&(this.image=h instanceof HTMLImageElement?ho.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Kv(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Kv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=t[0][1],u=t[0][1];for(let m of t)m[1]>u&&(u=m[1]),m[1]<s&&(s=m[1]);let h=(u+s)/2;if(h>N?this.onNorthPole=!0:h<-N&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=t.map(ee.fromLngLat);this.tileID=(function(g){let v=1/0,b=1/0,E=-1/0,T=-1/0;for(let B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),E=Math.max(E,B.x),T=Math.max(T,B.y);let I=Math.max(E-v,T-b),D=Math.max(0,Math.floor(-Math.log2(I))),O=Math.pow(2,D),R=Math.floor((v+E)/2*O);return R>1&&(R-=1),new Ii(D,R,Math.floor((b+T)/2*O))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _l("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Kv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(let $ in this.tiles){let Y=this.tiles[$];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let s=sy(new Ii(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function($){let Y=$[1].x-$[0].x,J=$[1].y-$[0].y,ie=$[2].x-$[1].x,he=$[2].y-$[1].y,le=$[3].x-$[2].x,me=$[3].y-$[2].y,ye=$[0].x-$[3].x,we=$[0].y-$[3].y,je=Y*he-ie*J,Ae=ie*me-le*he,We=le*we-ye*me,Ke=ye*J-Y*we;return je>0&&Ae>0&&We>0&&Ke>0||je<0&&Ae<0&&We<0&&Ke<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let h=sy(this.tileID,this.map.transform.projection),[m,g,v,b]=this.coordinates.map($=>{let Y=h.projection.project($[0],$[1]);return nL(h,Y)._round()});this.perspectiveTransform=gL(m.x,m.y,g.x,g.y,v.x,v.y,b.x,b.y);let E=this._boundsArray=new ph;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(g.x,g.y,yt,0),E.emplaceBack(b.x,b.y,0,yt),E.emplaceBack(v.x,v.y,yt,yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(E,SM.members),this.boundsSegments=nr.simpleSegment(0,0,4,2);let T=[],I=[yw((D=this.coordinates)[0]),yw(D[1]),yw(D[2]),yw(D[3])];var D;let[O,R,B,H]=(function($){let Y=$[0][0],J=Y,ie=$[0][1],he=ie;for(let le=1;le<$.length;le++)$[le][0]<Y?Y=$[le][0]:$[le][0]>J&&(J=$[le][0]),$[le][1]<ie?ie=$[le][1]:$[le][1]>he&&(he=$[le][1]);return[Y,ie,J-Y,he-ie]})(I);{let $=new ph,[Y,J,ie,he]=(function(nt){let it=nt[0].x,qe=it,He=nt[0].y,rt=He;for(let xt=1;xt<nt.length;xt++)nt[xt].x<it?it=nt[xt].x:nt[xt].x>qe&&(qe=nt[xt].x),nt[xt].y<He?He=nt[xt].y:nt[xt].y>rt&&(rt=nt[xt].y);return[it,He,qe-it,rt-He]})(u),le=nt=>[(nt.x-Y)/ie,(nt.y-J)/he],[me,ye,we,je]=u.map(le),Ae=(function(nt,it,qe,He,rt,xt,ft,qt){let It=vw(0,0,1,0,1,1,0,1);return Me(It,It,oe([],vw(nt,it,qe,He,rt,xt,ft,qt)))})(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=gL(me[0],me[1],ye[0],ye[1],we[0],we[1],je[0],je[1]);let We=(nt,it)=>{T.push(nt.lng);let qe=Math.round((nt.lng-O)/B*yt),He=Math.round((nt.lat-R)/H*yt),rt=le(it),xt=Vc([],[rt[0],rt[1],1],Ae),ft=Math.round(xt[0]/xt[2]*yt),qt=Math.round(xt[1]/xt[2]*yt);$.emplaceBack(qe,He,ft,qt)},Ke=u[3].x-u[0].x,Qe=u[3].y-u[0].y,at=u[2].x-u[1].x,ct=u[2].y-u[1].y;for(let nt=0;nt<65;nt++){let it=nt/64,qe=[u[0].x+it*Ke,u[0].y+it*Qe],He=[u[1].x+it*at,u[1].y+it*ct],rt=He[0]-qe[0],xt=He[1]-qe[1];for(let ft=0;ft<65;ft++){let qt=ft/64,It={x:qe[0]+rt*qt,y:qe[1]+xt*qt};We(s.projection.unproject(It.x,It.y),It)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer($,SM.members)}{this.maxLongitudeTriangleSize=0;let $=[],Y=new Kr,J=(ie,he,le)=>{Y.emplaceBack(ie,he,le);let me=T[ie],ye=T[he],we=T[le],je=Math.min(Math.min(me,ye),we),Ae=Math.max(Math.max(me,ye),we)-je;Ae>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ae),$.push(je+Ae/2)};for(let ie=0;ie<64;ie++)for(let he=0;he<64;he++){let le=65*ie+he,me=le+1,ye=le+65,we=ye+1;J(le,ye,me),J(me,ye,we)}[$,Y]=(function(ie,he){let le=Array.from({length:ie.length},(we,je)=>je);le.sort((we,je)=>ie[we]-ie[je]);let me=[],ye=new Kr;for(let we=0;we<le.length;we++){let je=le[we];me.push(ie[je]);let Ae=3*je,We=Ae+1;ye.emplaceBack(he.uint16[Ae],he.uint16[We],he.uint16[We+1])}return[me,ye]})($,Y),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(Y)}this.elevatedGlobeSegments=nr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/yt,0,H/yt,0,0,R,O,0])}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Kv||(this.texture?this.texture.update(this.image):(this.texture=new XI(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(s)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){let s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;let u=this.elevatedGlobeTrianglesCenterLongitudes,h=(m=t+180)+360*Math.round((u[0]-m)/360);var m;let g=new nr,v=(I,D)=>{g.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=b){let I=lr(u,0,u.length,h+b);return I===u.length||v(I,Zr(u,I+1,u.length,h+360-b)-I),g}h<u[0]&&(h+=360);let E=Zr(u,0,u.length,h-b);if(E===u.length)return v(0,u.length),g;v(0,E-0);let T=lr(u,E+1,u.length,h+b);return T!==u.length&&v(T,u.length-T),g}}let nH=(Math.pow(256,2)-1)/16907520;class vL extends gs{constructor(t,s,u,h){super(t,{layout:fL||(fL=new gr({visibility:new gt(Oe.layout_raster.visibility)})),paint:mL||(mL=new gr({"raster-opacity":new gt(Oe.paint_raster["raster-opacity"]),"raster-color":new pd(Oe.paint_raster["raster-color"]),"raster-color-mix":new gt(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new gt(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new gt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new gt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new gt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new gt(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new gt(Oe.paint_raster["raster-array-band"]),"raster-elevation":new gt(Oe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof _L&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;let s=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Lv({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let yL,xL,bL,wL,CL;class EL extends gs{constructor(t,s,u,h){super(t,{layout:yL||(yL=new gr({visibility:new gt(Oe["layout_raster-particle"].visibility)})),paint:xL||(xL=new gr({"raster-particle-array-band":new gt(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new gt(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pd(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new gt(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new gt(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new gt(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new gt(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new gt(Oe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp(),this.lastInvalidatedAt=ho.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Lv({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ho.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class iH extends gs{constructor(t,s){super(t,{},s,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function TM(l,t,s){let u=[0,0,1],h=qd([]);return Yl(h,h,s?-Zn(l)+Math.PI:Zn(l)),ja(h,h,-Zn(t)),Uc(u,u,h),Yi(u,u)}let SL={None:0,Model:1,Symbol:2,FillExtrusion:4};class xw{constructor(t,s,u,h){this.message=(t?`${t}: `:"")+u,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function IM(l,t){let s=l.indexOf("://")===-1;try{return new URL(l,s&&t?"http://example.com":void 0),!0}catch{return!1}}class TL{constructor(t,s){this.feature=t,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class IL{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Sv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(t){let s=16*t,u=this.instancedDataArray.float32,h=Math.floor(u[s+2]),m=1.05*(u[s+2]-h);return h/=100,[u[s]%1*1.05,u[s+1]%1*1.05,m,h]}tileCoordinatesForInstance(t){let s=16*t,u=this.instancedDataArray.float32,h=u[s+0];return h=h>yt?h-yt:h,new st(Math.trunc(h),Math.trunc(u[s+1]))}translationForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(t){let s=16*t,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class MM{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaledZ=this.canonical.z+Math.log2(t.overscaling),this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(t,s){}updateAppearances(t,s,u,h){}populate(t,s,u,h){this.tileToMeter=q(u);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:v,index:b,sourceLayerIndex:E}of t){let T=v??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),I=De(g,m);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let D={id:T,sourceLayerIndex:E,index:b,geometry:m?I.geometry:_e(g,u,h),properties:g.properties,type:g.type,patterns:{}},O=this.addFeature(D,D.geometry,I);O&&s.featureIndex.insert(g,D.geometry,b,E,this.index,this.instancesPerModel[O].instancedDataArray.length,yt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){let t=this.layers[0].modelManager,s=this.layers[0].scope,u=0;for(let h of this.modelUris){let m=t.getModel(h,s);if(!m)continue;let g=this.instancesPerModel[h];if(g){let v=.5*om(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,b=Math.min(yt,Math.max(v/this.tileToMeter,yt/32));u=Math.max(b,u)}}return u}update(t,s,u,h){for(let m in this.instancesPerModel){let g=this.instancesPerModel[m];for(let v in t)g.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(g.features[g.idToFeaturesIndex[v]],t[v],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];for(let h of u.features){let m=this.layers[0],g=h.feature,v=this.canonical,b=m.paint.get("model-rotation").evaluate(g,{},v),E=m.paint.get("model-scale").evaluate(g,{},v),T=m.paint.get("model-translation").evaluate(g,{},v);rs(h.rotation,b)&&rs(h.scale,E)&&rs(h.translation,T)||(this.evaluate(h,h.featureStates,u,!0),t=!0)}}return t}updateReplacement(t,s,u,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let m=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);if($1(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(let v in this.instancesPerModel){let b=this.instancesPerModel[v],E=b.instancedDataArray;for(let T of b.features){let I=T.instancedDataOffset,D=T.instancedDataCount;for(let O=0;O<D;O++){let R=16*(O+I),B=E.float32[R+0],H=B>yt;B=H?B-yt:B;let $=Math.floor(B),Y=Math.floor(E.float32[R+1]),J=!1;for(let ie of this.activeReplacements)if(!pk(ie,u,SL.Model,h)&&!(ie.min.x>$||$>ie.max.x||ie.min.y>Y||Y>ie.max.y)&&(J=vk(_k($,Y,t.canonical,ie.footprintTileId.canonical),ie.footprint),J))break;E.float32[R]=J?B+yt:B,g=g||J!==H}}}return g}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,T8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(t){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}let s=this.layers[0].modelManager;if(t&&s&&this.modelUris&&this.modelsRequested)for(let u of this.modelUris)s.removeModel(u,"",!0)}addFeature(t,s,u){let h=this.layers[0],m=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return Pt(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(IM(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new IL);let g=this.instancesPerModel[m],v=g.instancedDataArray,b=new TL(u,v.length);for(let E of s)for(let T of E){if(T.x<0||T.x>=yt||T.y<0||T.y>=yt)continue;if(this.lookupDim!==0){let D=(this.lookupDim-1)/yt,O=this.lookupDim*(T.y*D|0)+T.x*D|0;if(this.lookup){if(this.lookup[O]!==0)continue;this.lookup[O]=1}}this.instanceCount++;let I=v.length;v.resize(I+1),g.instancesEvaluatedElevation.push(0),v.float32[16*I]=T.x,v.float32[16*I+1]=T.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(t,s,u,h){let m=this.layers[0],g=t.feature,v=this.canonical,b=t.rotation=m.paint.get("model-rotation").evaluate(g,s,v),E=t.scale=m.paint.get("model-scale").evaluate(g,s,v),T=t.translation=m.paint.get("model-translation").evaluate(g,s,v),I=Object.assign({},m.paint.get("model-color").evaluate(g,s,v));I.a=m.paint.get("model-color-mix-intensity").evaluate(g,s,v);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]);let O=T[0]*T[0]+T[1]*T[1],R=O>0?Math.sqrt(O):0;u.maxScale=Math.max(Math.max(u.maxScale,E[0]),Math.max(E[1],E[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,R),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),rF(D,b,E);let B=Math.round(100*I.a)+I.b/1.05;for(let H=0;H<t.instancedDataCount;++H){let $=t.instancedDataOffset+H,Y=16*$,J=u.instancedDataArray.float32,ie=0;h&&(ie=J[Y+6]-u.instancesEvaluatedElevation[$]);let he=0|J[Y+1];J[Y]=(0|J[Y])+I.r/1.05,J[Y+1]=he+I.g/1.05,J[Y+2]=B,J[Y+3]=1/(v.z>10?this.tileToMeter:q(v,he)),J[Y+4]=T[0],J[Y+5]=T[1],J[Y+6]=T[2]+ie,J[Y+7]=D[0],J[Y+8]=D[1],J[Y+9]=D[2],J[Y+10]=D[4],J[Y+11]=D[5],J[Y+12]=D[6],J[Y+13]=D[8],J[Y+14]=D[9],J[Y+15]=D[10],u.instancesEvaluatedElevation[$]=T[2]}}}let ML,DL;Lt(MM,"ModelBucket",{omit:["layers"]}),Lt(IL,"PerModelAttributes"),Lt(TL,"ModelFeature");class jg{constructor(t,s,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(t,s,u){let h=u||t.findDEMTileFor(s);if(!h||!h.dem)return;let m=h.dem,g=h.tileID,v=1<<s.canonical.z-g.canonical.z;return new jg(h,m.dim/yt/v,[(s.canonical.x/v-g.canonical.x)*m.dim,(s.canonical.y/v-g.canonical.y)*m.dim])}tileCoordToPixel(t,s){let u=s*this._scale+this._offset[1];return new st(Math.floor(t*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(t,s,u,h){let m=t*this._scale+this._offset[0],g=s*this._scale+this._offset[1],v=Math.floor(m),b=Math.floor(g),E=this._dem;return h=!!h,u?on(on(E.get(v,b,h),E.get(v,b+1,h),g-b),on(E.get(v+1,b,h),E.get(v+1,b+1,h),g-b),m-v):E.get(v,b,h)}getElevationAtPixel(t,s,u){return this._dem.get(t,s,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*M(1,t)*this._dem.stride}}let DM=new Float32Array(262144),rf=new Uint8Array(262144);function AL(l){let t=0;if(l.meshes)for(let s of l.meshes)t=Math.max(t,s.aabb.max[2]);if(l.children)for(let s of l.children)t=Math.max(t,AL(s));return t}function PL(l,t,s){if(l.meshes)for(let u of l.meshes){if(u.aabb.min[0]===1/0)continue;let h=$t.applyTransform(u.aabb,l.globalMatrix);s.insert(t,h.min[0],h.min[1],h.max[0],h.max[1])}if(l.children)for(let u of l.children)PL(u,t,s)}let OL=["","wall","door","roof","window","lamp","logo"];class RL{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:AL(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new $t([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0,s=new $t([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let u of this.node.meshes)this.node.lightMeshIndex!==t&&(u.transformedAabb=$t.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),t++;this.aabb=s}return this.aabb}}class bw{constructor(t,s,u,h,m,g,v,b){this.id=u,this.layers=t,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=Rg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Rg.HasMapboxMeshFeatures),m&&(this.modelTraits|=Rg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(let E of s)this.nodesInfo.push(new RL(E)),PL(E,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(t,s){for(let u of this.getNodesInfo()){let h=u.node;h.footprint&&s.push({footprint:h.footprint,id:t})}}updateAppearances(t,s,u,h){}update(t){let s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;let u=s?this.stateDependentLayers:this.layers;if(!Kl(t,this.states))for(let h of u)this.evaluate(h,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let s=this.getNodesInfo();for(let u of s){let h=u.node;this.uploaded?this.updatePbrBuffer(h):JI(h,t,!0)}for(let u of s)nw(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let s=!1;if(!t.meshes)return s;for(let u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(t,s,u){let h=t.transform.projectionOptions,m=t.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||fy(u.paint.get("model-color").value,g)||fy(u.paint.get("model-color-mix-intensity").value,g)||fy(u.paint.get("model-roughness").value,g)||fy(u.paint.get("model-emissive-strength").value,g)||fy(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=m;let v=this.getNodesInfo();for(let b of v)b.state=null;return!0}return!1}evaluateTransform(t,s){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let u=this.getNodesInfo(),h=this.id.canonical;for(let m of u){let g=m.feature;m.evaluatedTranslation=s.paint.get("model-translation").evaluate(g,{},h),m.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},h)}}evaluate(t,s){let u=this.getNodesInfo();for(let h of u){if(!h.node.meshes)continue;let m=h.feature,g=s&&s[m.id];if(Kl(g,h.state))continue;h.state=structuredClone(g);let v=h.node.meshes&&h.node.meshes[0].featureData,b=h.evaluatedColor[2],E=h.evaluatedRMEA[2],T=this.id.canonical;if(h.hasTranslucentParts=!1,v){for(let I=0;I<OL.length;I++){let D=OL[I];D.length&&(m.properties.part=D);let O=t.paint.get("model-color").evaluate(m,g,T).toPremultipliedRenderColor(null),R=t.paint.get("model-color-mix-intensity").evaluate(m,g,T);h.evaluatedColor[I]=[O.r,O.g,O.b,R],h.evaluatedRMEA[I][0]=t.paint.get("model-roughness").evaluate(m,g,T),h.evaluatedRMEA[I][2]=t.paint.get("model-emissive-strength").evaluate(m,g,T),h.evaluatedRMEA[I][3]=O.a,h.emissionHeightBasedParams[I]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,T),!h.hasTranslucentParts&&O.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,oH(h,b!==h.evaluatedColor[2]||E!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(m,g,T);h.evaluatedTranslation=t.paint.get("model-translation").evaluate(m,g,T),h.evaluatedScale=t.paint.get("model-scale").evaluate(m,g,T),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,s,u,h){let m=t.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let g=jg.create(t,u,m);if(!g)return;this.modelTraits&Rg.HasMapboxMeshFeatures&&this.updateDEM(t,g,u,h);for(let v of this.getNodesInfo()){let b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let E=b.footprint.vertices,T=g.getElevationAt(E[0].x,E[0].y,!0,!0);for(let I=1;I<E.length;I++)T=Math.min(T,g.getElevationAt(E[I].x,E[I].y,!0,!0));b.elevation=T}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=s}}updateDEM(t,s,u,h){let m=s._dem._modifiedForSources[h];if(m===void 0&&(s._dem._modifiedForSources[h]=[],m=s._dem._modifiedForSources[h]),m.includes(u.canonical))return;let g=s._dem.dim;m.push(u.canonical);let v=!1;for(let b of this.getNodesInfo()){let E=b.node;if(!E.footprint||!E.footprint.grid)continue;let T=E.footprint.grid,I=s.tileCoordToPixel(T.min.x,T.min.y),D=s.tileCoordToPixel(T.max.x,T.max.y),O=Math.min(Math.min(g-D.y,I.x),Math.min(I.y,g-D.x));if(O<0)continue;let R=G(O,2,5),B=Math.max(0,I.x-R),H=Math.max(0,I.y-R),$=Math.min(D.x+R,g-1),Y=Math.min(D.y+R,g-1);for(let le=H;le<=Y;++le)for(let me=B;me<=$;++me)rf[le*g+me]=255;let J=0,ie=0;for(let le=0;le<T.cellsY;++le)for(let me=0;me<T.cellsX;++me){if(!T.cells[le*T.cellsX+me])continue;let ye=s.tileCoordToPixel(T.min.x+me/T.xScale,T.min.y+le/T.yScale),we=s.tileCoordToPixel(T.min.x+(me+1)/T.xScale,T.min.y+(le+1)/T.yScale);for(let je=ye.y;je<=Math.min(we.y+1,g-1);++je)for(let Ae=ye.x;Ae<=Math.min(we.x+1,g-1);++Ae)rf[je*g+Ae]===255&&(rf[je*g+Ae]=0,J+=s.getElevationAtPixel(Ae,je),ie++)}let he=J/ie;B=Math.max(1,I.x-R),H=Math.max(1,I.y-R),$=Math.min(D.x+R,g-2),Y=Math.min(D.y+R,g-2),v=!0;for(let le=H;le<=Y;++le)for(let me=B;me<=$;++me)rf[le*g+me]===0&&(DM[le*g+me]=s._dem.set(me,le,he));for(let le=1;le<R;++le){B=Math.max(1,I.x-le),H=Math.max(1,I.y-le),$=Math.min(D.x+le,g-2),Y=Math.min(D.y+le,g-2);for(let me=H;me<=Y;++me)for(let ye=B;ye<=$;++ye){let we=me*g+ye;if(rf[we]===255){let je=0,Ae=0,We=-1,Ke=-1;for(let Qe=-1;Qe<=1;++Qe)for(let at=-1;at<=1;++at){let ct=(me+Qe)*g+ye+at;if(rf[ct]>=le)continue;let nt=DM[ct],it=Math.abs(nt);it>Ae&&(je=nt,Ae=it,We=at,Ke=Qe)}if(Ae>.1){let Qe=1-(le+.5*Math.abs(We*Ke))/R,at=s._dem.get(ye,me)+je*Qe,ct=s._dem.get(ye+We,me+Ke),nt=s._dem.get(ye-We,me-Ke,!0);(at-ct)*(at-nt)>0&&(at=(ct+nt)/2),DM[we]=s._dem.set(ye,me,at),rf[we]=le}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ho.now())}setFilter(t){this.filter=t?ig(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new Ui(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical)):this.nodesInfo}destroy(){let t=this.getNodesInfo();for(let s of t)nw(s.node),eM(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(t.toUnwrapped());for(let h of this.getNodesInfo()){let m=h.node.footprint;h.hiddenByReplacement=!!m&&!u.find(g=>g.footprint===m)}}getHeightAtTileCoord(t,s){let u=[],h=[0,0,0],m=ht([]);for(let g of this.getNodesInfo()){let v=g.node.meshes[0],b=v.transformedAabb;if(t<b.min[0]||s<b.min[1]||t>b.max[0]||s>b.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};Nt(m,g.node.globalMatrix),h[0]=t,h[1]=s,Fr(h,h,m);let E=(h[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*ef|0,T=Math.min(63,(h[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*ef|0)*ef+Math.min(63,E),I=v.heightmap[T];if(!(I<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:I,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new st(t,s),new st(t,s),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function fy(l,t){return l instanceof ch&&!l.isLightConstant&&t}function rH(l,t,s,u,h,m,g,v){let b=(61440&t|(61440&t)>>4)>>8,E=(3840&t|(3840&t)>>4)>>4,T=240&t|(240&t)>>4;s[3]>0&&(b=on(b,255*s[0],s[3]),E=on(E,255*s[1],s[3]),T=on(T,255*s[2],s[3]));let I=b<<8|E,D=T<<8|Math.floor(255*u[3]),O=(function(le){let me=G(le,0,2);return Math.min(Math.round(.5*me*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],R=G(h[0],0,1),B=G(h[1],0,1),H=G(h[2],0,1),$=G(h[3],0,1),Y,J,ie,he;if(R!==B&&g!==m&&B!==R){let le=g-m;J=1/(le*(B-R)),ie=-(m+le*R)/(le*(B-R));let me=G(h[4],-1,1);he=Math.pow(10,me),Y=255*H<<8|255*$}else Y=65535,J=0,ie=1,he=1;if(l.emplaceBack(I,D,O,Y,J,ie,he),v){let le=v.length;v.clear();for(let me=0;me<le;me++)v.emplaceBack(I,D,O,Y,J,ie,he)}}function oH(l,t,s){let u=l.node,h=0,m=s&Rg.HasMeshoptCompression;for(let g of u.meshes){if(u.lights&&u.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new fg,g.featureArray.reserve(g.featureData.length);let v=t;for(let b of g.featureData){let E=m?65535&b:b>>16&65535,T=m?b>>16&65535:65535&b,I=(15&T)<8?15&T:0,D=l.evaluatedRMEA[I],O=l.evaluatedColor[I],R=l.emissionHeightBasedParams[I],B;if(v&&I===2&&u.lights&&(B=new fg,B.resize(10*u.lights.length)),rH(g.featureArray,E,O,D,R,g.aabb.min[2],g.aabb.max[2],B),B&&v){v=!1;let H=u.meshes[u.lightMeshIndex];H.featureArray=B,H.featureArray._trim()}}g.featureArray._trim(),h++}}Lt(bw,"Tiled3dModelBucket",{omit:["layers"]}),Lt(RL,"Tiled3dModelFeature");let sH=["id","tile","layer","source","sourceLayer","state"];class of{constructor(t,s,u,h,m){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=u,this._y=h,this.properties=t?t.properties:{},this.id=m}clone(){let t=new of(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let s of sH)this[s]!==void 0&&(t[s]=this[s]);return t}}class sf extends id{constructor(t,s,u,h){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){let t=[];for(let s in this._options.models){let u=this._options.models[s],h=this._modelsInfo.get(s);if(h){let m=h.model;m.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),m.orientation=u.orientation!=null?u.orientation:[0,0,0],h.modelSpec=u,sf.applyModelSpecification(m,u),m.computeBoundsAndApplyParent(),this.models.push(m)}else{let m=eF(this.map._requestManager.transformRequest(u.uri,pp.Model).url).then(g=>{if(!g)return;let v=nM(g),b=new oF(s,u.uri,u.position,u.orientation,v);sf.applyModelSpecification(b,u),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(s,{modelSpec:u,model:b})}).catch(g=>{this.fire(new _p(new Error(`Could not load model ${s} from ${u.uri}: ${g.message}`)))});t.push(m)}}Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new _p(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(t,s){s.nodeOverrides&&sf.convertNodeOverrides(t,s.nodeOverrides),s.materialOverrides&&sf.convertMaterialOverrides(t,s.materialOverrides),s.nodeOverrideNames&&(t.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(t.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(t.featureProperties=s.featureProperties)}static convertNodeOverrides(t,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){t.nodeOverrideNames=[];for(let u of s)t.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{let m={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){let g=h.orientation;g&&(m.orientation=g)}t.nodeOverrides.set(u,m)})}static convertMaterialOverrides(t,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){t.materialOverrideNames=[];for(let u of s)t.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{let m={color:new ui(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=h["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);let v=h["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);let b=h["model-emissive-strength"];b!==void 0&&(m.emissionStrength=b);let E=h["model-opacity"];E!==void 0&&(m.opacity=E),t.materialOverrides.set(u,m)})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,s){}serialize(){return this._options}setProperty(t,s){return!1}reload(){let t=Xa(this.id,this.scope);this.map.style.clearSource(t),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(t){this.models=[];let s=new Map;for(let u in t){let h=t[u];if(this._modelsInfo.has(u)){let m=this._modelsInfo.get(u);m&&m.modelSpec.uri===h.uri&&s.set(u,m)}}this._modelsInfo=s,this._options.models=t,this._loaded=!1,this.load()}}function AM(l,t,s,u){let h=1<<l.z;t.lat=L((u/yt+l.y)/h),t.lng=A((s/yt+l.x)/h)}function aH(l,t,s,u){let h=l.getNodesInfo()[t];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE,g=h.node,v=s.tile,b=u.calculatePosMatrix(v.tileID.toUnwrapped(),u.worldSize),E=h.evaluatedScale,T=0;u.elevation&&g.elevation&&(T=g.elevation*u.elevation.exaggeration()),Xt(b,b,[(g.anchor?g.anchor[0]:0)*(E[0]-1),(g.anchor?g.anchor[1]:0)*(E[1]-1),T]),Vn(b,b,E);let I=s.queryGeometry,D=I.isPointQuery()?I.screenBounds:I.screenGeometry,O=function(B){let H=Mt([],b,B.globalMatrix);Mt(H,u.expandedFarZProjMatrix,H);for(let $=0;$<B.meshes.length;++$){let Y=B.meshes[$];if($===B.lightMeshIndex)continue;let J=QI(D,u,H,Y.aabb);J!=null&&(m=Math.min(J,m))}if(B.children)for(let $ of B.children)O($)};if(O(g),m===Number.MAX_VALUE)return;let R=new c(0,0);return AM(v.tileID.canonical,R,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:R,feature:h.feature}}let lH={circle:class extends gs{constructor(l,t,s,u){super(l,{layout:Ps||(Ps=new gr({"circle-sort-key":new Ct(Oe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new gt(Oe.layout_circle["circle-elevation-reference"]),visibility:new gt(Oe.layout_circle.visibility)})),paint:_r||(_r=new gr({"circle-radius":new Ct(Oe.paint_circle["circle-radius"]),"circle-color":new Ct(Oe.paint_circle["circle-color"]),"circle-blur":new Ct(Oe.paint_circle["circle-blur"]),"circle-opacity":new Ct(Oe.paint_circle["circle-opacity"]),"circle-translate":new gt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ct(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ct(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ct(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new gt(Oe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}createBucket(l){return new di(l)}queryRadius(l){let t=l;return Jo("circle-radius",this,t)+Jo("circle-stroke-width",this,t)+Do(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,s,u,h,m,g,v){let b=Ma(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return VR(l,u,m,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,s){let u=BR(this);return{config:new lu(this,{zoom:t,lut:s}),defines:u,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends gs{createBucket(l){return new jR(l)}constructor(l,t,s,u){super(l,{layout:$R||($R=new gr({visibility:new gt(Oe.layout_heatmap.visibility)})),paint:HR||(HR=new gr({"heatmap-radius":new Ct(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ct(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pd(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Oe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Jo("heatmap-radius",this,l)}queryIntersectsFeature(l,t,s,u,h,m,g,v){let b=this.paint.get("heatmap-radius").evaluate(t,s);return VR(l,u,m,g,v,!0,!0,new st(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,s){return l==="heatmap"?{config:new lu(this,{zoom:t,lut:s}),overrideFog:!1}:{}}},hillshade:class extends gs{constructor(l,t,s,u){super(l,{layout:GR||(GR=new gr({visibility:new gt(Oe.layout_hillshade.visibility)})),paint:qR||(qR=new gr({"hillshade-illumination-direction":new gt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new gt(Oe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}},fill:class extends gs{constructor(l,t,s,u){super(l,{layout:ak||(ak=new gr({"fill-sort-key":new Ct(Oe.layout_fill["fill-sort-key"]),visibility:new gt(Oe.layout_fill.visibility),"fill-elevation-reference":new gt(Oe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ct(Oe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:lk||(lk=new gr({"fill-antialias":new gt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Ct(Oe.paint_fill["fill-opacity"]),"fill-color":new Ct(Oe.paint_fill["fill-color"]),"fill-outline-color":new Ct(Oe.paint_fill["fill-outline-color"]),"fill-translate":new gt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ct(Oe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new gt(Oe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new gt(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ct(Oe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ct(Oe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ct(Oe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}getProgramIds(){let l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,t,s){return{config:new lu(this,{zoom:t,lut:s}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);let s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new FI(l)}queryRadius(){return Do(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,s,u,h,m){return!l.queryGeometry.isAboveHorizon&&ti(ra(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;let t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?t&&!l:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends gs{constructor(l,t,s,u){super(l,{layout:kk||(kk=new gr({visibility:new gt(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new gt(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Fk||(Fk=new gr({"fill-extrusion-opacity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ct(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new gt(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new G1(l)}queryRadius(){return Do(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,s,u,h,m,g,v,b){let E=Ma(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(t,s),I=this.paint.get("fill-extrusion-base").evaluate(t,s),D=[0,0],O=v&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,B=l.tile.getBucket(this);if(O&&B instanceof G1){let ie=B.centroidVertexArray,he=b+1;he<ie.length&&(D[0]=ie.geta_centroid_pos0(he),D[1]=ie.geta_centroid_pos1(he))}if(D[0]===0&&D[1]===1)return!1;m.projection.name==="globe"&&(u=Rk([u],[new st(0,0),new st(yt,yt)],l.tileID.canonical).map(ie=>ie.polygon).flat());let H=O?v:null,[$,Y]=jk(m,u,I,T,E,g,H,D,R,m.center.lat,l.tileID.canonical),J=l.queryGeometry;return Uk($,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},building:class extends gs{constructor(l,t,s,u){super(l,{layout:hF||(hF=new gr({visibility:new gt(Oe.layout_building.visibility),"building-facade":new Ct(Oe.layout_building["building-facade"]),"building-facade-floors":new Ct(Oe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Ct(Oe.layout_building["building-facade-unit-width"]),"building-facade-window":new Ct(Oe.layout_building["building-facade-window"]),"building-roof-shape":new Ct(Oe.layout_building["building-roof-shape"]),"building-height":new Ct(Oe.layout_building["building-height"]),"building-base":new Ct(Oe.layout_building["building-base"]),"building-flood-light-wall-radius":new Ct(Oe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Ct(Oe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Ct(Oe.layout_building["building-flip-roof-orientation"])})),paint:pF||(pF=new gr({"building-opacity":new gt(Oe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new gt(Oe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new gt(Oe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new gt(Oe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new gt(Oe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new gt(Oe.paint_building["building-vertical-scale"]),"building-cast-shadows":new gt(Oe.paint_building["building-cast-shadows"]),"building-color":new Ct(Oe.paint_building["building-color"]),"building-emissive-strength":new Ct(Oe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new gt(Oe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new gt(Oe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new gt(Oe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new gt(Oe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new gt(Oe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new dF(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}queryRadius(l){return 0}queryIntersectsFeature(l,t,s,u,h,m,g,v,b){let E=this.layout.get("building-height").evaluate(t,s),T=this.layout.get("building-base").evaluate(t,s),I=l.tile.getBucket(this).getFootprint(t);if(I){if(I.hiddenFlags!==0)return!1;E=I.height}let[D,O]=jk(m,u,T,E,new st(0,0),g,null,[0,0],1,m.center.lat,l.tileID.canonical),R=l.queryGeometry;return Uk(D,O,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends gs{constructor(l,t,s,u){let h=CF();super(l,h,t,s,u),h.layout&&(this.layout=new hd(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Dp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if(Jv)return Jv;let s=CF();return Jv=new n$(s.paint.properties["line-width"].specification),Jv.useIntegerZoom=!0,Jv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new oM(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,s){let u=bF(this);return{config:new lu(this,{zoom:t,lut:s}),defines:u,overrideFog:!1}}queryRadius(l){let t=l,s=EF(Jo("line-width",this,t),Jo("line-gap-width",this,t)),u=Jo("line-offset",this,t);return s/2+Math.abs(u)+Do(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,s,u,h,m){if(l.queryGeometry.isAboveHorizon)return!1;let g=ra(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,l.pixelToTileUnitsFactor),v=l.pixelToTileUnitsFactor/2*EF(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),b=this.paint.get("line-offset").evaluate(t,s);return b&&(u=(function(E,T){let I=[],D=new st(0,0);for(let O=0;O<E.length;O++){let R=E[O],B=[];for(let H=0;H<R.length;H++){let $=R[H],Y=R[H+1],J=H===0?D:$.sub(R[H-1])._unit()._perp(),ie=H===R.length-1?D:Y.sub($)._unit()._perp(),he=J._add(ie)._unit();he._mult(1/(he.x*ie.x+he.y*ie.y)),B.push(he._mult(T)._add($))}I.push(B)}return I})(u,b*l.pixelToTileUnitsFactor)),(function(E,T,I){for(let D=0;D<T.length;D++){let O=T[D];if(E.length>=3){for(let R=0;R<O.length;R++)if(Ti(E,O[R]))return!0}if(ur(E,O,I))return!0}return!1})(g,u,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:_w,background:class extends gs{constructor(l,t,s,u){super(l,{layout:hL||(hL=new gr({visibility:new gt(Oe.layout_background.visibility)})),paint:pL||(pL=new gr({"background-pitch-alignment":new gt(Oe.paint_background["background-pitch-alignment"]),"background-color":new gt(Oe.paint_background["background-color"]),"background-pattern":new gt(Oe.paint_background["background-pattern"]),"background-opacity":new gt(Oe.paint_background["background-opacity"]),"background-emissive-strength":new gt(Oe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:vL,"raster-particle":EL,sky:class extends gs{constructor(l,t,s,u){super(l,{layout:bL||(bL=new gr({visibility:new gt(Oe.layout_sky.visibility)})),paint:wL||(wL=new gr({"sky-type":new gt(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new gt(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new gt(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new gt(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new gt(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new pd(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new gt(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new gt(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new gt(Oe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),h=!u,m=l.style.light,g=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&Pt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?TM(g.azimuthal,90-g.polar,t):TM(u[0],90-u[1],t)}let s=this.paint.get("sky-gradient-center");return TM(s[0],90-s[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends gs{constructor(l,t,s,u){super(l,{paint:CL||(CL=new gr({}))},t,null)}},model:class extends gs{constructor(l,t,s,u){super(l,{layout:ML||(ML=new gr({visibility:new gt(Oe.layout_model.visibility),"model-id":new Ct(Oe.layout_model["model-id"])})),paint:DL||(DL=new gr({"model-opacity":new Ct(Oe.paint_model["model-opacity"]),"model-rotation":new Ct(Oe.paint_model["model-rotation"]),"model-scale":new Ct(Oe.paint_model["model-scale"]),"model-translation":new Ct(Oe.paint_model["model-translation"]),"model-color":new Ct(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Ct(Oe.paint_model["model-color-mix-intensity"]),"model-type":new gt(Oe.paint_model["model-type"]),"model-cast-shadows":new gt(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new gt(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new gt(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ct(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Ct(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ct(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new gt(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new gt(Oe.paint_model["model-front-cutoff"]),"model-elevation-reference":new gt(Oe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Ct({type:"string",default:"default","property-type":"data-driven"})}))},t,s,u),this.layer=l,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new MM(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof bw?yt-1:0}queryRenderedFeatures(l,t,s){let u=t.getSource();if(!(u&&u instanceof sf))return{};let h=u,m={};m[this.id]=[];let g=m[this.id],v=0;for(let b of h.models){let E=t.getFeatureState(this.sourceLayer,b.id),T={type:"Unknown",id:b.id,properties:b.featureProperties},I=this.paint.get("model-rotation").evaluate(T,E),D=this.paint.get("model-scale").evaluate(T,E),O=this.paint.get("model-translation").evaluate(T,E),R=this.paint.get("model-elevation-reference"),B=[];tw(B,b,s,b.position,I,D,O,R==="ground",R==="ground",!1),s.projection.name==="globe"&&(B=ew(B,s));let H=Mt([],s.projMatrix,B),$=QI(l.isPointQuery()?l.screenBounds:l.screenGeometry,s,H,b.aabb);if($!=null){let Y=new of(void 0,0,0,0,b.id);Y.layer=this.layer,Y.properties=structuredClone(b.featureProperties),Y.properties.layer=this.id,Y.properties.uri=b.uri,Y.properties.orientation=b.orientation,Y.sourceLayer=this.sourceLayer,Y.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},Y.state=E,Y.source=this.source,g.push({featureIndex:v,feature:Y,intersectionZ:$})}++v}return m}queryIntersectsFeature(l,t,s,u,h,m){if(!this.modelManager)return!1;let g=this.modelManager,v=l.tile.getBucket(this);if(!(v&&v instanceof MM))return!1;for(let b in v.instancesPerModel){let E=v.instancesPerModel[b],T=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(T)){let I=E.features[E.idToFeaturesIndex[T]],D=g.getModel(b,this.scope);if(!D)return!1;let O=[],R=new c(0,0),B=v.canonical,H=Number.MAX_VALUE;for(let $=0;$<I.instancedDataCount;++$){let Y=16*(I.instancedDataOffset+$),J=E.instancedDataArray.float32,ie=[J[Y+4],J[Y+5],J[Y+6]];AM(B,R,Math.floor(J[Y]),Math.floor(J[Y+1])),tw(O,D,m,R,I.rotation,I.scale,ie,!1,!1,!1),m.projection.name==="globe"&&(O=ew(O,m));let he=Mt([],m.projMatrix,O),le=l.queryGeometry,me=QI(le.isPointQuery()?le.screenBounds:le.screenGeometry,m,he,D.aabb);me!=null&&(H=Math.min(me,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(l,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){let t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof cd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends gs{constructor(l,t,s,u){super(l,{layout:ck||(ck=new gr({"clip-layer-types":new gt(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new gt(Oe.layout_clip["clip-layer-scope"])})),paint:uk||(uk=new gr({}))},t,s,u)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new dk(l)}is3D(l){return!0}}},PM=new ui(0,0,0),OM={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},RM={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},ww={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},cH={PAINT_ORDER_FILL_AND_STROKE:1},my={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},kL={MASK_TYPE_LUMINANCE:1};function uH(l,t,s){l===1&&t.icons.push((function(u,h){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;let{metadata:g}=m;if(g.content_area){let{content_area:v}=g;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(g.text_placeholder){let{text_placeholder:v}=g;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return g.stretch_x&&g.stretch_x.length&&FL(g,"x"),g.stretch_y&&g.stretch_y.length&&FL(g,"y"),m})(u.readFields(dH,{name:void 0},h))})(s,s.readVarint()+s.pos))}function FL(l,t){let s=[],u=l[`stretch_${t}`],h=null;for(let m=0;m<u.length;m++)h===null?h=s.length===0?u[0]:s[s.length-1][1]+u[m]:(s.push([h,h+u[m]]),h=null);l[`stretch_${t}_areas`]=s}function dH(l,t,s){l===1?t.name=s.readString():l===2?t.metadata=(function(u,h){return u.readFields(hH,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(s,s.readVarint()+s.pos):l===3&&(t.usvg_tree=(function(u,h){return u.readFields(mH,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(s,s.readVarint()+s.pos),t.data="usvg_tree")}function hH(l,t,s){l===1?t.stretch_x=s.readPackedVarint():l===2?t.stretch_y=s.readPackedVarint():l===3?t.content_area=LL(s,s.readVarint()+s.pos):l===4?t.variables.push((function(u,h){return u.readFields(fH,{name:void 0},h)})(s,s.readVarint()+s.pos)):l===5&&(t.text_placeholder=LL(s,s.readVarint()+s.pos))}function LL(l,t){return l.readFields(pH,{},t)}function pH(l,t,s){l===1?t.left=s.readVarint():l===2?t.width=s.readVarint():l===3?t.top=s.readVarint():l===4&&(t.height=s.readVarint())}function fH(l,t,s){l===1?t.name=s.readString():l===2&&(t.rgb_color=Sw(s.readVarint()),t.value="rgb_color")}function mH(l,t,s){l===1?t.width=t.height=s.readVarint():l===2?t.height=s.readVarint():l===3?t.children.push(Cw(s,s.readVarint()+s.pos)):l===4?t.linear_gradients.push((function(u,h){return u.readFields(wH,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(s,s.readVarint()+s.pos)):l===5?t.radial_gradients.push((function(u,h){return u.readFields(EH,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(s,s.readVarint()+s.pos)):l===7?t.clip_paths.push((function(u,h){return u.readFields(SH,{children:[]},h)})(s,s.readVarint()+s.pos)):l===8&&t.masks.push((function(u,h){let m=u.readFields(TH,{left:0,width:20,mask_type:kL.MASK_TYPE_LUMINANCE,children:[]},h);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(s,s.readVarint()+s.pos))}function Cw(l,t){return l.readFields(gH,{},t)}function gH(l,t,s){l===1?(t.group=(function(u,h){return u.readFields(_H,{opacity:255,children:[]},h)})(s,s.readVarint()+s.pos),t.node="group"):l===2&&(t.path=(function(u,h){return u.readFields(yH,{paint_order:1,commands:[],step:1,diffs:[],rule:OM.PATH_RULE_NON_ZERO},h)})(s,s.readVarint()+s.pos),t.node="path")}function _H(l,t,s){l===1?t.transform=Ew(s,s.readVarint()+s.pos):l===2?t.opacity=s.readVarint():l===5?t.clip_path_idx=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(Cw(s,s.readVarint()+s.pos))}function Ew(l,t){return l.readFields(vH,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function vH(l,t,s){l===1?t.sx=s.readFloat():l===2?t.ky=s.readFloat():l===3?t.kx=s.readFloat():l===4?t.sy=s.readFloat():l===5?t.tx=s.readFloat():l===6&&(t.ty=s.readFloat())}function yH(l,t,s){l===1?t.fill=(function(u,h){return u.readFields(xH,{rgb_color:PM,paint:"rgb_color",opacity:255},h)})(s,s.readVarint()+s.pos):l===2?t.stroke=(function(u,h){return u.readFields(bH,{rgb_color:PM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(s,s.readVarint()+s.pos):l===3?t.paint_order=s.readVarint():l===5?s.readPackedVarint(t.commands):l===6?t.step=s.readFloat():l===7?s.readPackedSVarint(t.diffs):l===8&&(t.rule=s.readVarint())}function xH(l,t,s){l===1?(t.rgb_color=Sw(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5&&(t.opacity=s.readVarint())}function Sw(l){return new ui((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function bH(l,t,s){l===1?(t.rgb_color=Sw(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5?s.readPackedFloat(t.dasharray):l===6?t.dashoffset=s.readFloat():l===7?t.miterlimit=s.readFloat():l===8?t.opacity=s.readVarint():l===9?t.width=s.readFloat():l===10?t.linecap=s.readVarint():l===11&&(t.linejoin=s.readVarint())}function wH(l,t,s){l===1?t.transform=Ew(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(NL(s,s.readVarint()+s.pos)):l===4?t.x1=s.readFloat():l===5?t.y1=s.readFloat():l===6?t.x2=s.readFloat():l===7&&(t.y2=s.readFloat())}function NL(l,t){return l.readFields(CH,{offset:0,opacity:255,rgb_color:PM},t)}function CH(l,t,s){l===1?t.offset=s.readFloat():l===2?t.opacity=s.readVarint():l===3&&(t.rgb_color=Sw(s.readVarint()))}function EH(l,t,s){l===1?t.transform=Ew(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(NL(s,s.readVarint()+s.pos)):l===4?t.cx=s.readFloat():l===5?t.cy=s.readFloat():l===6?t.r=s.readFloat():l===7?t.fx=s.readFloat():l===8?t.fy=s.readFloat():l===9&&(t.fr=s.readFloat())}function SH(l,t,s){l===1?t.transform=Ew(s,s.readVarint()+s.pos):l===2?t.clip_path_idx=s.readVarint():l===3&&t.children.push(Cw(s,s.readVarint()+s.pos))}function TH(l,t,s){l===1?t.left=t.top=s.readFloat():l===2?t.width=t.height=s.readFloat():l===3?t.top=s.readFloat():l===4?t.height=s.readFloat():l===5?t.mask_type=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(Cw(s,s.readVarint()+s.pos))}class IH{static calculate(t={},s=[]){let u=new Map,h=new Map;if(Object.keys(t).length===0)return u;s.forEach(m=>{h.set(m.name,m.rgb_color||new ui(0,0,0))});for(let[m,g]of Object.entries(t))h.has(m)?u.set(h.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return u}}function $g(l,t=255,s){let u=t/255,h=l.toString(),m=s.has(h)?s.get(h).clone():l.clone();return m.a*=u,m.toString()}function gy(l,t){if(!fl()){let s=document.createElement("canvas");return s.width=l,s.height=t,s}return new OffscreenCanvas(l,t)}let kM,_y=null;function FM(l,t,s,u,h){for(let m of u.children)zL(l,t,s,m,h)}function zL(l,t,s,u,h){u.group?(l.save(),(function(m,g,v,b,E){let T=b.mask_idx!=null?v.masks[b.mask_idx]:null,I=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(g=Hg(b.transform).preMultiplySelf(g)),!(function(R,B,H){return R.opacity!==255||B||H})(b,I!=null,T!=null))return void FM(m,g,v,b,E);let D=gy(m.canvas.width,m.canvas.height),O=D.getContext("2d");FM(O,g,v,b,E),I&&GL(O,g,v,I),T&&qL(O,g,v,T,E),m.globalAlpha=b.opacity/255,m.drawImage(D,0,0)})(l,t,s,u.group,h),l.restore()):u.path&&(l.save(),(function(m,g,v,b,E){m.setTransform(g),b.paint_order===cH.PAINT_ORDER_FILL_AND_STROKE?(BL(m,v,b,E),UL(m,v,b,E)):(UL(m,v,b,E),BL(m,v,b,E))})(l,t,s,u.path,h),l.restore())}function BL(l,t,s,u){let h=s.fill;if(!h)return;let m=h.opacity/255;switch(l.save(),l.beginPath(),WL(s,l),h.paint){case"rgb_color":l.fillStyle=$g(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{let g=t.linear_gradients[h.linear_gradient_idx];g.transform&&l.setTransform(Hg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=jL(l,g,m,u);break}case"radial_gradient_idx":{let g=t.radial_gradients[h.radial_gradient_idx];g.transform&&l.setTransform(Hg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=$L(l,g,m,u)}}l.fill(VL(s)),l.restore()}function VL(l){return l.rule===OM.PATH_RULE_NON_ZERO?"nonzero":l.rule===OM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function UL(l,t,s,u){let h=s.stroke;if(!h)return;let m=ZL(s);l.lineWidth=h.width,l.miterLimit=h.miterlimit,l.setLineDash(h.dasharray),l.lineDashOffset=h.dashoffset;let g=h.opacity/255;switch(h.paint){case"rgb_color":l.strokeStyle=$g(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":l.strokeStyle=jL(l,t.linear_gradients[h.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":l.strokeStyle=$L(l,t.radial_gradients[h.radial_gradient_idx],g,u,!0)}switch(h.linejoin){case ww.LINE_JOIN_MITER_CLIP:case ww.LINE_JOIN_MITER:l.lineJoin="miter";break;case ww.LINE_JOIN_ROUND:l.lineJoin="round";break;case ww.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(h.linecap){case RM.LINE_CAP_BUTT:l.lineCap="butt";break;case RM.LINE_CAP_ROUND:l.lineCap="round";break;case RM.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(m)}function jL(l,t,s,u,h=!1){if(t.stops.length===1){let D=t.stops[0];return $g(D.rgb_color,D.opacity*s,u)}let{x1:m,y1:g,x2:v,y2:b}=t,E=new DOMPoint(m,g),T=new DOMPoint(v,b);if(h){let D=Hg(t.transform);E=D.transformPoint(E),T=D.transformPoint(T)}let I=l.createLinearGradient(E.x,E.y,T.x,T.y);for(let D of t.stops)I.addColorStop(D.offset,$g(D.rgb_color,D.opacity*s,u));return I}function $L(l,t,s,u,h=!1){if(t.stops.length===1){let $=t.stops[0];return $g($.rgb_color,$.opacity*s,u)}let m=Hg(t.transform),{fx:g,fy:v,fr:b,cx:E,cy:T,r:I}=t,D=new DOMPoint(g,v),O=new DOMPoint(E,T),R=b,B=I;if(h){D=m.transformPoint(D),O=m.transformPoint(O);let $=(m.a+m.d)/2;R=b*$,B=t.r*$}let H=l.createRadialGradient(D.x,D.y,R,O.x,O.y,B);for(let $ of t.stops)H.addColorStop($.offset,$g($.rgb_color,$.opacity*s,u));return H}function HL(l,t,s,u){let h=u.transform?Hg(u.transform).preMultiplySelf(t):t,m=gy(l.canvas.width,l.canvas.height),g=m.getContext("2d");for(let b of u.children)if(b.group)HL(g,h,s,b.group);else if(b.path){let E=b.path,T=new Path2D;T.addPath(ZL(E),h),g.fill(T,VL(E))}let v=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;v&&GL(g,h,s,v),l.globalCompositeOperation="source-over",l.drawImage(m,0,0)}function GL(l,t,s,u){let h=gy(l.canvas.width,l.canvas.height);HL(h.getContext("2d"),t,s,u),l.globalCompositeOperation="destination-in",l.drawImage(h,0,0)}function qL(l,t,s,u,h){if(u.children.length===0)return;let m=u.mask_idx!=null?s.masks[u.mask_idx]:null;m&&qL(l,t,s,m,h);let g=l.canvas.width,v=l.canvas.height,b=gy(g,v),E=b.getContext("2d"),T=u.width,I=u.height,D=u.left,O=u.top,R=new Path2D,B=new Path2D;B.rect(D,O,T,I),R.addPath(B,t),E.clip(R);for(let Y of u.children)zL(E,t,s,Y,h);let H=E.getImageData(0,0,g,v),$=H.data;if(u.mask_type===kL.MASK_TYPE_LUMINANCE)for(let Y=0;Y<$.length;Y+=4)$[Y+3]=$[Y+3]/255*(.2126*$[Y]+.7152*$[Y+1]+.0722*$[Y+2]);E.putImageData(H,0,0),l.globalCompositeOperation="destination-in",l.drawImage(b,0,0)}function Hg(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function WL(l,t){let s=l.step,u=l.diffs[0]*s,h=l.diffs[1]*s;t.moveTo(u,h);for(let m=0,g=2;m<l.commands.length;m++)switch(l.commands[m]){case my.PATH_COMMAND_MOVE:u+=l.diffs[g++]*s,h+=l.diffs[g++]*s,t.moveTo(u,h);break;case my.PATH_COMMAND_LINE:u+=l.diffs[g++]*s,h+=l.diffs[g++]*s,t.lineTo(u,h);break;case my.PATH_COMMAND_QUAD:{let v=u+l.diffs[g++]*s,b=h+l.diffs[g++]*s;u=v+l.diffs[g++]*s,h=b+l.diffs[g++]*s,t.quadraticCurveTo(v,b,u,h);break}case my.PATH_COMMAND_CUBIC:{let v=u+l.diffs[g++]*s,b=h+l.diffs[g++]*s,E=v+l.diffs[g++]*s,T=b+l.diffs[g++]*s;u=E+l.diffs[g++]*s,h=T+l.diffs[g++]*s,t.bezierCurveTo(v,b,E,T,u,h);break}case my.PATH_COMMAND_CLOSE:t.closePath()}return t}function ZL(l){return WL(l,new Path2D)}class Tw{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;let s=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,s),s}put(t,s){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,s)}delete(t){this.cache.delete(t)}}Lt(Tw,"LRUCache");class LM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new es(t,t.data)}getFromCache(t,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Tw(150)),this.cacheMap.get(u).get(Xa(t.toString(),s))}setInCache(t,s,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Tw(150));let m=this.cacheDependenciesMap.get(h),g=Xa(t.id.toString(),u);m.get(g)||m.set(g,new Set);let v=this.cacheMap.get(h),b=t.toString();m.get(g).add(b),v.put(Xa(t.toString(),u),s)}removeImagesFromCacheByIds(t,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;let h=this.cacheMap.get(u),m=this.cacheDependenciesMap.get(u);for(let g of t){let v=Xa(g.toString(),s);if(m.has(v)){for(let b of m.get(v))h.delete(b);m.delete(v)}}}rasterize(t,s,u,h){let m=this.getFromCache(t,u,h);if(m)return m.clone();let g=(function(b,E){let T=IH.calculate(E.params,b.metadata?b.metadata.variables:[]),I=b.usvg_tree,D=I.width,O=I.height,R=Math.max(1,Math.round(D*E.sx)),B=Math.max(1,Math.round(O*E.sy)),H=new DOMMatrix([R/D,0,0,B/O,0,0]);return _y===null&&(_y=gy(10,10),kM=_y.getContext("2d",{willReadFrequently:!0})),_y.width=R,_y.height=B,FM(kM,H,I,I,T),kM.getImageData(0,0,R,B)})(s.icon,t),v=LM._getImage(g);return this.setInCache(t,v,u,h),v.clone()}}class YL{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){let u=this.toIdx(t,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function XL(l,t,s,u){let h=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<l[g]||s[g]>t[g])return null}else{let v=1/u[g],b=(l[g]-s[g])*v,E=(t[g]-s[g])*v;if(b>E){let T=b;b=E,E=T}if(b>h&&(h=b),E<m&&(m=E),h>m)return null}return h}function KL(l,t,s,u,h,m,g,v,b,E,T){let I=u-l,D=h-t,O=m-s,R=g-l,B=v-t,H=b-s,$=T[1]*H-T[2]*B,Y=T[2]*R-T[0]*H,J=T[0]*B-T[1]*R,ie=I*$+D*Y+O*J;if(Math.abs(ie)<1e-15)return null;let he=1/ie,le=E[0]-l,me=E[1]-t,ye=E[2]-s,we=(le*$+me*Y+ye*J)*he;if(we<0||we>1)return null;let je=me*O-ye*D,Ae=ye*I-le*O,We=le*D-me*I,Ke=(T[0]*je+T[1]*Ae+T[2]*We)*he;return Ke<0||we+Ke>1?null:(R*je+B*Ae+H*We)*he}function QL(l,t,s){return(l-t)/(s-t)}function JL(l,t,s,u,h,m,g,v,b){let E=1<<s,T=m-u,I=g-h,D=(l+1)/E*T+u,O=(t+0)/E*I+h,R=(t+1)/E*I+h;v[0]=(l+0)/E*T+u,v[1]=O,b[0]=D,b[1]=R}class eN{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let s=(function(m){let g=Math.ceil(Math.log2(m.dim/8)),v=[],b=Math.ceil(Math.pow(2,g)),E=1/b,T=(O,R,B,H,$)=>{let Y=H?1:0,J=(O+1)*B-Y,ie=R*B,he=(R+1)*B-Y;$[0]=O*B,$[1]=ie,$[2]=J,$[3]=he},I=new YL(b),D=[];for(let O=0;O<b*b;O++){T(O%b,Math.floor(O/b),E,!1,D);let R=Th(D[0],D[1],m),B=Th(D[2],D[1],m),H=Th(D[2],D[3],m),$=Th(D[0],D[3],m);I.minimums.push(Math.min(R,B,H,$)),I.maximums.push(Math.max(R,B,H,$)),I.leaves.push(1)}for(v.push(I),b/=2;b>=1;b/=2){let O=v[v.length-1];I=new YL(b);for(let R=0;R<b*b;R++){T(R%b,Math.floor(R/b),2,!0,D);let B=O.getElevation(D[0],D[1]),H=O.getElevation(D[2],D[1]),$=O.getElevation(D[2],D[3]),Y=O.getElevation(D[0],D[3]),J=O.isLeaf(D[0],D[1]),ie=O.isLeaf(D[2],D[1]),he=O.isLeaf(D[2],D[3]),le=O.isLeaf(D[0],D[3]),me=Math.min(B.min,H.min,$.min,Y.min),ye=Math.max(B.max,H.max,$.max,Y.max),we=J&&ie&&he&&le;I.maximums.push(ye),I.minimums.push(me),I.leaves.push(ye-me<=5&&we?1:0)}v.push(I)}return v})(this.dem),u=s.length-1,h=s[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(t,s,u,h,m,g,v=1){return XL([t,s,-100],[u,h,this.maximums[0]*v],m,g)}raycast(t,s,u,h,m,g,v=1){if(!this.nodeCount)return null;let b=this.raycastRoot(t,s,u,h,m,g,v);if(b==null)return null;let E=[],T=[],I=[],D=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){let{idx:R,t:B,nodex:H,nodey:$,depth:Y}=O.pop();if(this.leaves[R]){JL(H,$,Y,t,s,u,h,I,D);let ie=1<<Y,he=(H+0)/ie,le=(H+1)/ie,me=($+0)/ie,ye=($+1)/ie,we=Th(he,me,this.dem)*v,je=Th(le,me,this.dem)*v,Ae=Th(le,ye,this.dem)*v,We=Th(he,ye,this.dem)*v,Ke=KL(I[0],I[1],we,D[0],I[1],je,D[0],D[1],Ae,m,g),Qe=KL(D[0],D[1],Ae,I[0],D[1],We,I[0],I[1],we,m,g),at=Math.min(Ke!==null?Ke:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(at!==Number.MAX_VALUE)return at;{let ct=Qs([],m,g,B);if(tN(we,je,We,Ae,QL(ct[0],I[0],D[0]),QL(ct[1],I[1],D[1]))>=ct[2])return B}continue}let J=0;for(let ie=0;ie<this._siblingOffset.length;ie++){JL((H<<1)+this._siblingOffset[ie][0],($<<1)+this._siblingOffset[ie][1],Y+1,t,s,u,h,I,D),I[2]=-100,D[2]=this.maximums[this.childOffsets[R]+ie]*v;let he=XL(I,D,m,g);if(he!=null){let le=he;E[ie]=le;let me=!1;for(let ye=0;ye<J&&!me;ye++)le>=E[T[ye]]&&(T.splice(ye,0,ie),me=!0);me||(T[J]=ie),J++}}for(let ie=0;ie<J;ie++){let he=T[ie];O.push({idx:this.childOffsets[R]+he,t:E[he],nodex:(H<<1)+this._siblingOffset[he][0],nodey:($<<1)+this._siblingOffset[he][1],depth:Y+1})}}return null}_addNode(t,s,u){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,u,h,m){if(t[h].isLeaf(s,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let g=h-1,v=t[g],b=0,E=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*s+this._siblingOffset[T][0],D=2*u+this._siblingOffset[T][1],O=v.getElevation(I,D),R=v.isLeaf(I,D),B=this._addNode(O.min,O.max,R);R&&(b|=1<<T),E||(E=B)}for(let T=0;T<this._siblingOffset.length;T++)b&1<<T||this._construct(t,2*s+this._siblingOffset[T][0],2*u+this._siblingOffset[T][1],g,E+T)}}function tN(l,t,s,u,h,m){return on(on(l,s,m),on(t,u,m),h)}function Th(l,t,s){let u=s.dim,h=G(l*u-.5,0,u-1),m=G(t*u-.5,0,u-1),g=Math.floor(h),v=Math.floor(m),b=Math.min(g+1,u-1),E=Math.min(v+1,u-1);return tN(s.get(g,v),s.get(b,v),s.get(g,E),s.get(b,E),h-g,m-v)}let MH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function DH(l,t,s){return(256*l*256+256*t+s)/10-1e4}function AH(l,t,s){return 256*l+t+s/256-32768}class Iw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,u,h=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Pt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;let m=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<m;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(m,b)]=g[this._idx(m-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,m)]=g[this._idx(b,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}let v=u==="terrarium"?AH:DH;for(let b=0;b<g.length;++b){let E=4*b;this.floatView[b]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=ho.now()}_buildQuadTree(){this._tree=new eN(this)}get(t,s,u=!1){u&&(t=G(t,-1,this.dim),s=G(s,-1,this.dim));let h=this._idx(t,s);return this.floatView[h]}set(t,s,u){let h=this._idx(t,s),m=this.floatView[h];return this.floatView[h]=u,u-m}static getUnpackVector(t){return MH[t]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}static pack(t,s){let u=[0,0,0,0],h=Iw.getUnpackVector(s),m=Math.floor((t+h[3])/h[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new YR({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,m=s*this.dim+this.dim,g=u*this.dim,v=u*this.dim+this.dim;switch(s){case-1:h=m-1;break;case 1:m=h+1}switch(u){case-1:g=v-1;break;case 1:v=g+1}let b=-s*this.dim,E=-u*this.dim;for(let T=g;T<v;T++)for(let I=h;I<m;I++){let D=4*this._idx(I,T),O=4*this._idx(I+b,T+E);this.pixels[D+0]=t.pixels[O+0],this.pixels[D+1]=t.pixels[O+1],this.pixels[D+2]=t.pixels[O+2],this.pixels[D+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function PH(l,t,s){l===1?t.headerLength=s.readFixed32():l===2?t.x=s.readVarint():l===3?t.y=s.readVarint():l===4?t.z=s.readVarint():l===5&&t.layers.push((function(u,h){return u.readFields(LH,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(s,s.readVarint()+s.pos))}function OH(l,t,s){l===1?(t.delta_filter=(function(u,h){return u.readFields(RH,{blockSize:0},h)})(s,s.readVarint()+s.pos),t.filter="delta_filter"):l===2?(s.readVarint(),t.filter="zigzag_filter"):l===3?(s.readVarint(),t.filter="bitshuffle_filter"):l===4&&(s.readVarint(),t.filter="byteshuffle_filter")}function RH(l,t,s){l===1&&(t.blockSize=s.readVarint())}function kH(l,t,s){l===1?(s.readVarint(),t.codec="gzip_data"):l===2?(s.readVarint(),t.codec="jpeg_image"):l===3?(s.readVarint(),t.codec="webp_image"):l===4&&(s.readVarint(),t.codec="png_image")}function FH(l,t,s){let u=0,h=0;l===1?t.firstByte=s.readFixed64():l===2?t.lastByte=s.readFixed64():l===3?t.filters.push((function(m,g){return m.readFields(OH,{},g)})(s,s.readVarint()+s.pos)):l===4?t.codec=(function(m,g){return m.readFields(kH,{},g)})(s,s.readVarint()+s.pos):l===5?h=s.readFloat():l===6?u=s.readFloat():l===7?t.bands.push(s.readString()):l===8?t.offset=s.readDouble():l===9&&(t.scale=s.readDouble()),t.offset===0&&(t.offset=h),t.scale===0&&(t.scale=u)}function LH(l,t,s){l===1?t.version=s.readVarint():l===2?t.name=s.readString():l===3?t.units=s.readString():l===4?t.tileSize=s.readVarint():l===5?t.buffer=s.readVarint():l===6?t.pixelFormat=s.readVarint():l===7&&t.dataIndex.push((function(u,h){return u.readFields(FH,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(s,s.readVarint()+s.pos))}function NH(l,t,s){if(l===2)(function(u,h,m){u.readFields(zH,m,h)})(s,s.readVarint()+s.pos,t);else if(l===3)throw new Error("Not implemented")}function zH(l,t,s){if(l===1){let u=0,h=s.readVarint()+s.pos;for(;s.pos<h;)t[u++]=s.readVarint()}}function BH(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let s=t[3];for(let u=2;u>=1;u--){let h=u===1?1:0,m=u===2?1:0;for(let g=0;g<t[0];g++){let v=t[1]*g;for(let b=h;b<t[1];b++){let E=t[2]*(b+v);for(let T=m;T<t[2];T++){let I=t[3]*(T+E);for(let D=0;D<t[3];D++){let O=I+D;l[O]+=l[O-s]}}}}s*=t[u]}return l}function VH(l){for(let t=0,s=l.length;t<s;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function UH(l,t){switch(t){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){let u=l[s],h=l[s+1];l[s]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,l[s+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){let u=l[s],h=l[s+1],m=l[s+2],g=l[s+3];l[s+0]=(192&u)>>6|(192&h)>>4|(192&m)>>2|192&g,l[s+1]=(48&u)>>4|(48&h)>>2|48&m|(48&g)<<2,l[s+2]=(12&u)>>2|12&h|(12&m)<<2|(12&g)<<4,l[s+3]=3&u|(3&h)<<2|(3&m)<<4|(3&g)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}Lt(Iw,"DEMData"),Lt(eN,"DemMinMaxQuadTree",{omit:["dem"]});var el=Uint8Array,vy=Uint16Array,jH=Int32Array,nN=new el([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),iN=new el([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$H=new el([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rN=function(l,t){for(var s=new vy(31),u=0;u<31;++u)s[u]=t+=1<<l[u-1];var h=new jH(s[30]);for(u=1;u<30;++u)for(var m=s[u];m<s[u+1];++m)h[m]=m-s[u]<<5|u;return{b:s,r:h}},oN=rN(nN,2),sN=oN.b,HH=oN.r;sN[28]=258,HH[258]=28;for(var GH=rN(iN,0).b,aN=new vy(32768),so=0;so<32768;++so){var Gg=(43690&so)>>1|(21845&so)<<1;aN[so]=((65280&(Gg=(61680&(Gg=(52428&Gg)>>2|(13107&Gg)<<2))>>4|(3855&Gg)<<4))>>8|(255&Gg)<<8)>>1}var yy=function(l,t,s){for(var u=l.length,h=0,m=new vy(t);h<u;++h)l[h]&&++m[l[h]-1];var g,v=new vy(t);for(h=1;h<t;++h)v[h]=v[h-1]+m[h-1]<<1;g=new vy(1<<t);var b=15-t;for(h=0;h<u;++h)if(l[h])for(var E=h<<4|l[h],T=t-l[h],I=v[l[h]-1]++<<T,D=I|(1<<T)-1;I<=D;++I)g[aN[I]>>b]=E;return g},xy=new el(288);for(so=0;so<144;++so)xy[so]=8;for(so=144;so<256;++so)xy[so]=9;for(so=256;so<280;++so)xy[so]=7;for(so=280;so<288;++so)xy[so]=8;var lN=new el(32);for(so=0;so<32;++so)lN[so]=5;var qH=yy(xy,9),WH=yy(lN,5),NM=function(l){for(var t=l[0],s=1;s<l.length;++s)l[s]>t&&(t=l[s]);return t},vc=function(l,t,s){var u=t/8|0;return(l[u]|l[u+1]<<8)>>(7&t)&s},zM=function(l,t){var s=t/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&t)},ZH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yc=function(l,t,s){var u=new Error(t||ZH[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,yc),!s)throw u;return u},YH=new el(0),XH=typeof TextDecoder<"u"&&new TextDecoder;try{XH.decode(YH,{stream:!0})}catch{}let KH={gzip_data:"gzip"};class Ml extends Error{constructor(t){super(t),this.name="MRTError"}}let QH={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},cN={uint32:1,uint16:2,uint8:4},JH={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},BM;class Mw{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){let s=this.layers[t];if(!s)throw new Ml(`Layer '${t}' not found`);return s}getHeaderLength(t){let s=new Uint8Array(t),u=new DataView(t);if(s[0]!==13)throw new Ml("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){let s=new Uint8Array(t),u=this.getHeaderLength(t);if(s.length<u)throw new Ml(`Expected header with length >= ${u} but got buffer of length ${s.length}`);let h=new BM(s.subarray(0,u)).readFields(PH,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ml(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(let m of h.layers)this.layers[m.name]=new uN(m,{cacheSize:this._cacheSize});return this}createDecodingTask(t){let s=[],u=this.getLayer(t.layerName);for(let h of t.blockIndices){let m=u.dataIndex[h],g=m.firstByte-t.firstByte,v=m.lastByte-t.firstByte;if(u._blocksInProgress.has(h))continue;let b={layerName:u.name,firstByte:g,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map(E=>E.filter)};u._blocksInProgress.add(h),s.push(b)}return new dN(s,()=>{s.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,m)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),h)throw h;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class uN{constructor({version:t,name:s,units:u,tileSize:h,pixelFormat:m,buffer:g,dataIndex:v},b){if(this.version=t,this.version!==1)throw new Ml(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=s,this.units=u,this.tileSize=h,this.buffer=g,this.pixelFormat=QH[m],this.dataIndex=v,this.bandShape=[h+2*g,h+2*g,cN[this.pixelFormat]],this._decodedBlocks=new Tw(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return cN[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){let s=t.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,t.data)}getBlockForBand(t){let s=0;switch(typeof t){case"string":for(let[u,h]of this.dataIndex.entries()){for(let[m,g]of h.bands.entries())if(g===t)return{bandIndex:s+m,blockIndex:u,blockBandIndex:m};s+=h.bands.length}break;case"number":for(let[u,h]of this.dataIndex.entries()){if(t>=s&&t<s+h.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-s};s+=h.bands.length}break;default:throw new Ml(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let s=1/0,u=-1/0,h=[],m=new Set;for(let g of t){let{blockIndex:v}=this.getBlockForBand(g);if(v<0)throw new Ml(`Invalid band: ${JSON.stringify(g)}`);let b=this.dataIndex[v];h.includes(v)||h.push(v),m.add(v),s=Math.min(s,b.firstByte),u=Math.max(u,b.lastByte)}if(m.size>this.cacheSize)throw new Ml(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:h}}hasBand(t){let{blockIndex:s}=this.getBlockForBand(t);return s>=0}hasDataForBand(t){let{blockIndex:s}=this.getBlockForBand(t);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(t){let{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(t);if(s<0)throw new Ml(`Band not found: ${JSON.stringify(t)}`);let h=this._decodedBlocks.get(s.toString());if(!h)throw new Ml(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[s],g=this.bandShape.reduce((E,T)=>E*T,1),v=u*g,b=h.subarray(v,v+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}Mw.setPbf=function(l){BM=l};class dN{constructor(t,s,u){this.tasks=t,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,s){this._finalized||(this._onComplete(t,s),this._finalized=!0)}}Mw.performDecoding=function(l,t){let s=new Uint8Array(l);return Promise.all(t.tasks.map(u=>{let{layerName:h,firstByte:m,lastByte:g,pixelFormat:v,blockShape:b,blockIndex:E,filters:T,codec:I}=u,D=s.subarray(m,g+1),O=new Uint32Array(b[0]*b[1]*b[2]),R;if(I!=="gzip_data")throw new Ml(`Unhandled codec: ${I}`);return R=(function(B,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((ie=(function(me){me[0]==31&&me[1]==139&&me[2]==8||yc(6,"invalid gzip data");var ye=me[3],we=10;4&ye&&(we+=2+(me[10]|me[11]<<8));for(var je=(ye>>3&1)+(ye>>4&1);je>0;je-=!me[we++]);return we+(2&ye)})(J=B))+8>J.length&&yc(6,"invalid gzip data"),(function(me,ye,we,je){var Ae=me.length;if(!Ae||ye.f&&!ye.l)return we||new el(0);var We=!we,Ke=We||ye.i!=2,Qe=ye.i;We&&(we=new el(3*Ae));var at,ct,nt=function(vi){var ei=we.length;if(vi>ei){var oi=new el(Math.max(2*ei,vi));oi.set(we),we=oi}},it=ye.f||0,qe=ye.p||0,He=ye.b||0,rt=ye.l,xt=ye.d,ft=ye.m,qt=ye.n,It=8*Ae;do{if(!rt){it=vc(me,qe,1);var Rt=vc(me,qe+1,3);if(qe+=3,!Rt){var Bt=me[(Ze=4+((qe+7)/8|0))-4]|me[Ze-3]<<8,In=Ze+Bt;if(In>Ae){Qe&&yc(0);break}Ke&&nt(He+Bt),we.set(me.subarray(Ze,In),He),ye.b=He+=Bt,ye.p=qe=8*In,ye.f=it;continue}if(Rt==1)rt=qH,xt=WH,ft=9,qt=5;else if(Rt==2){var mt=vc(me,qe,31)+257,Ut=vc(me,qe+10,15)+4,dn=mt+vc(me,qe+5,31)+1;qe+=14;for(var Ln=new el(dn),zn=new el(19),_n=0;_n<Ut;++_n)zn[$H[_n]]=vc(me,qe+3*_n,7);qe+=3*Ut;var _i=NM(zn),ce=(1<<_i)-1,pe=yy(zn,_i);for(_n=0;_n<dn;){var Ze,lt=pe[vc(me,qe,ce)];if(qe+=15&lt,(Ze=lt>>4)<16)Ln[_n++]=Ze;else{var Et=0,St=0;for(Ze==16?(St=3+vc(me,qe,3),qe+=2,Et=Ln[_n-1]):Ze==17?(St=3+vc(me,qe,7),qe+=3):Ze==18&&(St=11+vc(me,qe,127),qe+=7);St--;)Ln[_n++]=Et}}var Wt=Ln.subarray(0,mt),Yt=Ln.subarray(mt);ft=NM(Wt),qt=NM(Yt),rt=yy(Wt,ft),xt=yy(Yt,qt)}else yc(1);if(qe>It){Qe&&yc(0);break}}Ke&&nt(He+131072);for(var mn=(1<<ft)-1,En=(1<<qt)-1,Tn=qe;;Tn=qe){var On=(Et=rt[zM(me,qe)&mn])>>4;if((qe+=15&Et)>It){Qe&&yc(0);break}if(Et||yc(2),On<256)we[He++]=On;else{if(On==256){Tn=qe,rt=null;break}var rn=On-254;On>264&&(rn=vc(me,qe,(1<<(Xn=nN[_n=On-257]))-1)+sN[_n],qe+=Xn);var un=xt[zM(me,qe)&En],Hn=un>>4;if(un||yc(3),qe+=15&un,Yt=GH[Hn],Hn>3){var Xn=iN[Hn];Yt+=zM(me,qe)&(1<<Xn)-1,qe+=Xn}if(qe>It){Qe&&yc(0);break}Ke&&nt(He+131072);var Kn=He+rn;if(He<Yt){var hi=0-Yt,Mi=Math.min(Yt,Kn);for(hi+He<0&&yc(3);He<Mi;++He)we[He]=(void 0)[hi+He]}for(;He<Kn;++He)we[He]=we[He-Yt]}}ye.l=rt,ye.p=Tn,ye.b=He,ye.f=it,rt&&(it=1,ye.m=ft,ye.d=xt,ye.n=qt)}while(!it);return He!=we.length&&We?(at=we,((ct=He)==null||ct>at.length)&&(ct=at.length),new el(at.subarray(0,ct))):we.subarray(0,He)})(J.subarray(ie,-8),{i:2},new el((($=J)[(Y=$.length)-4]|$[Y-3]<<8|$[Y-2]<<16|$[Y-1]<<24)>>>0))));var $,Y,J,ie;let he=KH[H];if(!he)throw new Error(`Unhandled codec: ${H}`);let le=new globalThis.DecompressionStream(he);return new Response(new Blob([B]).stream().pipeThrough(le)).arrayBuffer().then(me=>new Uint8Array(me))})(D,I).then(B=>((function(H,$){H.readFields(NH,$)})(new BM(B),O),new JH[v](O.buffer))),R.then(B=>{for(let H=T.length-1;H>=0;H--)switch(T[H]){case"delta_filter":BH(B,b);break;case"zigzag_filter":VH(B);break;case"bitshuffle_filter":UH(B,v);break;default:throw new Ml(`Unhandled filter "${T[H]}"`)}return{layerName:h,blockIndex:E,data:B}}).catch(B=>{throw B})}))},Lt(dN,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Lt(Mw,"MapboxRasterTile"),Lt(uN,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class hN{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){let u=t[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class pN{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new uh(yt,16,0),this.featureIndexArray=new Dv,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,s,u,h,m,g=0,v=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,m,g);let E=this.grid;for(let T=0;T<s.length;T++){let I=s[T],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<I.length;O++){let R=I[O];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}v!==0&&(D[0]-=v,D[1]-=v,D[2]+=v,D[3]+=v),D[0]<yt&&D[1]<yt&&D[2]>=0&&D[3]>=0&&E.insert(b,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fe(new rw(this.rawTileData)).layers,this.sourceLayerCoder=new hN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s){let{tilespaceGeometry:u,transform:h,tileTransform:m,pixelPosMatrix:g,availableImages:v,worldview:b}=s;this.loadVTLayers(),this.serializedLayersCache.clear();let E=s.queryRadius?s.queryRadius:0,T=u.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(B,H,$,Y)=>_s(u.bufferedTilespaceGeometry,B-E,H-E,$+E,Y+E));I.sort(eG);let D=null;h.elevation&&I.length>0&&(D=jg.create(h.elevation,this.tileID));let O={},R;for(let B=0;B<I.length;B++){let H=I[B];if(H===R)continue;R=H;let $=this.featureIndexArray.get(H),Y=null;this.is3DTile?this.loadMatchingModelFeature(O,$,t,u,h,b):this.loadMatchingFeature(O,$,t,v,b,(J,ie,he,le=0)=>(Y||(Y=_e(J,this.tileID.canonical,m)),ie.queryIntersectsFeature(u,J,he,Y,this.z,h,g,D,le)))}return O}loadMatchingFeature(t,s,u,h,m,g){let{featureIndex:v,bucketIndex:b,sourceLayerIndex:E,layoutVertexArrayOffset:T}=s,I=this.bucketLayerIDs[b],D=u.layers,O=Object.keys(D);if(O.length&&!Ft(O,I))return;let R=u.sourceCache,B=this.sourceLayerCoder.decode(E),H=this.vtLayers[B].feature(v),$=this.getId(H,B);for(let Y=0;Y<I.length;Y++){let J=I[Y];if(!D[J])continue;let{styleLayer:ie,targets:he}=D[J],le={};$!==void 0&&(le=R.getFeatureState(ie.sourceLayer,$));let me=!g||g(H,ie,le,T);if(!me)continue;let ye=new of(H,this.z,this.x,this.y,$);ye.tile=this.tileID.canonical,ye.state=le;let we=this.serializedLayersCache.get(J);we||(we=ie.serialize(),we.id=J,this.serializedLayersCache.set(J,we)),ye.source=we.source,ye.sourceLayer=we["source-layer"],ye.layer=Object.assign({},we),ye.layer.paint=fN(we.paint,ie.paint,H,le,h),ye.layer.layout=fN(we.layout,ie.layout,H,le,h);let je=!1;for(let Ae of he){this.updateFeatureProperties(ye,Ae);let{filter:We}=Ae;if(We){if(H.properties=ye.properties,We.needGeometry){let Ke=De(H,!0);if(!We.filter(new Ui(this.tileID.overscaledZ,{worldview:m}),Ke,this.tileID.canonical))continue}else if(!We.filter(new Ui(this.tileID.overscaledZ,{worldview:m}),H))continue}je=!0,Ae.targetId&&this.addFeatureVariant(ye,Ae)}je&&this.appendToResult(t,J,v,ye,me)}}loadMatchingModelFeature(t,s,u,h,m,g){let{featureIndex:v,bucketIndex:b}=s,E=this.bucketLayerIDs[b],T=u.layers,I=Object.keys(T);if(!I.length||Ft(I,E))for(let D=0;D<E.length;D++){let O=E[D],{styleLayer:R,targets:B}=T[O];if(R.type!=="model")continue;let H=h.tile,$=H.getBucket(R);if(!($&&$ instanceof bw))continue;let Y=aH($,v,h,m);if(!Y)continue;let{z:J,x:ie,y:he}=H.tileID.canonical,{feature:le,intersectionZ:me,position:ye}=Y,we={};le.id!==void 0&&(we=u.sourceCache.getFeatureState(R.sourceLayer,le.id));let je=new of({},J,ie,he,le.id);je.tile=this.tileID.canonical,je.state=we,je.properties=le.properties,je.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Ae=this.serializedLayersCache.get(O);Ae||(Ae=R.serialize(),Ae.id=O,this.serializedLayersCache.set(O,Ae)),je.source=Ae.source,je.sourceLayer=Ae["source-layer"],je.layer=Object.assign({},Ae);let We=!1;for(let Ke of B){this.updateFeatureProperties(je,Ke);let{filter:Qe}=Ke;if(Qe){if(le.properties=je.properties,Qe.needGeometry){if(!Qe.filter(new Ui(this.tileID.overscaledZ,{worldview:g}),le,this.tileID.canonical))continue}else if(!Qe.filter(new Ui(this.tileID.overscaledZ,{worldview:g}),le))continue}We=!0,Ke.targetId&&this.addFeatureVariant(je,Ke)}We&&this.appendToResult(t,O,v,je,me)}}updateFeatureProperties(t,s,u){if(s.properties){let h={};for(let m in s.properties){let g=s.properties[m].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,u);g!=null&&(h[m]=g)}t.properties=h}}addFeatureVariant(t,s,u){let h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=t.properties),t.variants=t.variants||{},t.variants[s.targetId]=t.variants[s.targetId]||[],t.variants[s.targetId].push(h)}appendToResult(t,s,u,h,m){let g=t[s];g===void 0&&(g=t[s]=[]),g.push({featureIndex:u,feature:h,intersectionZ:m})}lookupSymbolFeatures(t,s,u,h,m,g){let v={};this.loadVTLayers();for(let b of t)this.loadMatchingFeature(v,{bucketIndex:s,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},h,m,g);return v}loadFeature(t){let{featureIndex:s,sourceLayerIndex:u}=t;this.loadVTLayers();let h=this.sourceLayerCoder.decode(u),m=this.vtFeatures[h];if(m[s])return m[s];let g=this.vtLayers[h].feature(s);return m[s]=g,g}hasLayer(t){for(let s of this.bucketLayerIDs)for(let u of s)if(t===u)return!0;return!1}getId(t,s){let u=t.id;if(this.promoteId){let h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){let m=iu(h);if(m.result!=="success"){let g=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Pt(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}u=this.promoteIdExpression.evaluate({zoom:0},t)}else u=t.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function fN(l,t,s,u,h){return Ne(l,(m,g)=>{let v=t instanceof hd?t.get(g):null;return v&&v.evaluate?v.evaluate(s,u,void 0,h):v})}function eG(l,t){return t-l}Lt(pN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let mN=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VM{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,u]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let m=mN[15&u];if(!m)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new VM(v,g,m,t)}constructor(t,s=64,u=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let m=mN.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=s,u}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return UM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:g,nodeSize:v}=this,b=[0,m.length-1,0],E=[];for(;b.length;){let T=b.pop()||0,I=b.pop()||0,D=b.pop()||0;if(I-D<=v){for(let H=D;H<=I;H++){let $=g[2*H],Y=g[2*H+1];$>=t&&$<=u&&Y>=s&&Y<=h&&E.push(m[H])}continue}let O=D+I>>1,R=g[2*O],B=g[2*O+1];R>=t&&R<=u&&B>=s&&B<=h&&E.push(m[O]),(T===0?t<=R:s<=B)&&(b.push(D),b.push(O-1),b.push(1-T)),(T===0?u>=R:h>=B)&&(b.push(O+1),b.push(I),b.push(1-T))}return E}within(t,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:m,nodeSize:g}=this,v=[0,h.length-1,0],b=[],E=u*u;for(;v.length;){let T=v.pop()||0,I=v.pop()||0,D=v.pop()||0;if(I-D<=g){for(let H=D;H<=I;H++)_N(m[2*H],m[2*H+1],t,s)<=E&&b.push(h[H]);continue}let O=D+I>>1,R=m[2*O],B=m[2*O+1];_N(R,B,t,s)<=E&&b.push(h[O]),(T===0?t-u<=R:s-u<=B)&&(v.push(D),v.push(O-1),v.push(1-T)),(T===0?t+u>=R:s+u>=B)&&(v.push(O+1),v.push(I),v.push(1-T))}return b}}function UM(l,t,s,u,h,m){if(h-u<=s)return;let g=u+h>>1;gN(l,t,g,u,h,m),UM(l,t,s,u,g-1,1-m),UM(l,t,s,g+1,h,1-m)}function gN(l,t,s,u,h,m){for(;h>u;){if(h-u>600){let E=h-u+1,T=s-u+1,I=Math.log(E),D=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*D*(E-D)/E)*(T-E/2<0?-1:1);gN(l,t,s,Math.max(u,Math.floor(s-T*D/E+O)),Math.min(h,Math.floor(s+(E-T)*D/E+O)),m)}let g=t[2*s+m],v=u,b=h;for(by(l,t,u,s),t[2*h+m]>g&&by(l,t,u,h);v<b;){for(by(l,t,v,b),v++,b--;t[2*v+m]<g;)v++;for(;t[2*b+m]>g;)b--}t[2*u+m]===g?by(l,t,u,b):(b++,by(l,t,b,h)),b<=s&&(u=b+1),s<=b&&(h=b-1)}}function by(l,t,s,u){jM(l,s,u),jM(t,2*s,2*u),jM(t,2*s+1,2*u+1)}function jM(l,t,s){let u=l[t];l[t]=l[s],l[s]=u}function _N(l,t,s,u){let h=l-s,m=t-u;return h*h+m*m}r.$=wm,r.A=Jl,r.B=Xa,r.C=2,r.D=Dg,r.E=id,r.F=ny,r.G=$F,r.H=bm,r.I=as,r.J=y1,r.K=Gt,r.L=Kd,r.M=qm,r.N=kp,r.O=s1,r.P=st,r.Q=Fp,r.R=pp,r.S=ng,r.T=XI,r.U=iu,r.V=xw,r.W=cv,r.X=nh,r.Y=th,r.Z=Mp,r._=fs,r.a=function(l){return kn.API_CDN_URL_REGEX.test(l)},r.a$=L,r.a0=cn,r.a1=xa,r.a2=Cl,r.a3=class extends xw{},r.a4=Wm,r.a5=o1,r.a6=Oe,r.a7=function(l){let t=l.value;return t?cn(t)?IM(t,!0)?[]:[new xw(l.key,t,`invalid url "${t}"`)]:[new xw(l.key,t,`string expected, "${Gt(t)}" found`)]:[]},r.a8=m1,r.a9=gr,r.aA=G,r.aB=Mt,r.aC=Zo,r.aD=Ko,r.aE=Ti,r.aF=w,r.aG=ne,r.aH=function(l,t){let s={};for(let u=0;u<t.length;u++){let h=t[u];h in l&&(s[h]=l[h])}return s},r.aI=f,r.aJ=S,r.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,s,u){let h=this.entries[l]=this.entries[l]||{callbacks:[]};if(h.result){let[m,g]=h.result;return this.scheduler?this.scheduler.add(()=>{u(m,g)},t):u(m,g),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=s((m,g)=>{h.result=[m,g];for(let v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,g)},t):v(m,g);setTimeout(()=>delete this.entries[l],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==u),h.callbacks.length||(h.cancel(),delete this.entries[l]))}}},r.aL=function(l,t,s){let u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},h=>{let m=Ql(l.request,(g,v,b)=>{g?h(g):v&&h(null,{rawData:v,vectorTile:s?void 0:new Fe(new rw(v)),responseHeaders:new Map(b.entries())})});return()=>{m.cancel(),h()}},t)},r.aM=function(l){return l?{cacheControl:l.get("Cache-Control"),expires:l.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=Bs,r.aO=function(l){ya++,ya>dm&&(l.getActor().send("enforceCacheSizeLimit",um),ya=0)},r.aP=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},r.aQ=dr,r.aR=vL,r.aS=EL,r.aT=c,r.aU=_L,r.aV=function(l,t){let s=document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let u=0;u<l.length;u++){let h=document.createElement("source");HT(l[u])||(s.crossOrigin="Anonymous"),h.src=l[u],s.appendChild(h)}return{cancel:()=>{}}},r.aW=Kv,r.aX=sf,r.aY=Pe,r.aZ=sy,r.a_=A,r.aa=gt,r.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return gn(l.expression.evaluate(t))}interpolate(l,t,s){return{x:on(l.x,t.x,s),y:on(l.y,t.y,s),z:on(l.z,t.z,s),azimuthal:on(l.azimuthal,t.azimuthal,s),polar:on(l.polar,t.polar,s)}}},r.ac=Ui,r.ad=cd,r.ae=ee,r.af=Fr,r.ag=xo,r.ah=Q,r.ai=hd,r.aj=bh,r.ak=on,r.al=yt,r.am=O0,r.an=Zn,r.ao=ui,r.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return(function([s,u]){let h=gn([1,s,u]);return{x:h.x,y:h.y,z:h.z}})(l.expression.evaluate(t))}interpolate(l,t,s){return{x:on(l.x,t.x,s),y:on(l.y,t.y,s),z:on(l.z,t.z,s)}}},r.aq=function(l,t,s=0,u=!0){let h=new st(s,s),m=l.sub(h),g=t.add(h),v=[m,new st(g.x,m.y),g,new st(m.x,g.y)];return u&&v.push(m.clone()),v},r.ar=function(l,t){let s=[];for(let u=0;u<l.length;u++){let h=se(u-1,-1,l.length-1),m=se(u+1,-1,l.length-1),g=l[u],v=l[m],b=l[h].sub(g).unit(),E=v.sub(g).unit(),T=E.angleWithSep(b.x,b.y),I=b.add(E).unit().mult(-1*t/Math.sin(T/2));s.push(g.add(I))}return s},r.as=nL,r.at=_s,r.au=function(l,t,s=0){return xr(((t.x-s)*l.scale-l.x)*yt,(t.y*l.scale-l.y)*yt,F(t.z,t.y))},r.av=Vr,r.aw=Yi,r.ax=zt,r.ay=_F,r.az=function(l){let t=1/0,s=1/0,u=-1/0,h=-1/0;for(let m of l)t=Math.min(t,m.x),s=Math.min(s,m.y),u=Math.max(u,m.x),h=Math.max(h,m.y);return{min:new st(t,s),max:new st(u,h)}},r.b=function(l){return kn.API_FONTS_REGEX.test(l)},r.b$=_k,r.b0=Kr,r.b1=ph,r.b2=Ie,r.b3=M1,r.b4=gw,r.b5=function(){sc.isLoading()||sc.isLoaded()||Vp()!=="deferred"||f1()},r.b6=ig,r.b7=De,r.b8=of,r.b9=mr,r.bA=ht,r.bB=Ni,r.bC=$e,r.bD=function(l,t){let{x:s,y:u}=l.point,h=LR(s,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Mt(h,h,SI(Ja(t)))},r.bE=k,r.bF=zs,r.bG=om,r.bH=Qs,r.bI=Wo,r.bJ=Ir,r.bK=Ng,r.bL=sa,r.bM=fM,r.bN=function(l,t,s,u,h){let m=5*t+2;l.float32[m+0]=s,l.float32[m+1]=u,l.float32[m+2]=h},r.bO=Ug,r.bP=Ss,r.bQ=Xl,r.bR=Hc,r.bS=am,r.bT=se,r.bU=function(l,t,s,u){var h=new P(4);return h[0]=l,h[1]=t,h[2]=s,h[3]=u,h},r.bV=class{isDataAvailableAtPoint(l){let t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;let s=t.getSource().maxzoom,u=1<<s,h=Math.floor(l.x),m=Math.floor((l.x-h)*u),g=Math.floor(l.y*u),v=this.findDEMTileFor(new dr(s,h,s,m,g));return!(!v||!v.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,s=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);let u=this._source();if(!u||l.y<0||l.y>1)return t;let h=u.getSource().maxzoom,m=1<<h,g=Math.floor(l.x),v=l.x-g,b=new dr(h,g,h,Math.floor(v*m),Math.floor(l.y*m)),E=this.findDEMTileFor(b);if(!E||!E.dem)return t;let T=E.dem,I=1<<E.tileID.canonical.z,D=(v*I-E.tileID.canonical.x)*T.dim,O=(l.y*I-E.tileID.canonical.y)*T.dim,R=Math.floor(D),B=Math.floor(O);return(s?this.exaggeration():1)*on(on(T.get(R,B),T.get(R,B+1),O-B),on(T.get(R+1,B),T.get(R+1,B+1),O-B),D-R)}static getAtTileOffset(l,t,s,u){let h=1<<l.canonical.z;return u?u.pointElevation(t):s?s.getAtPointOrZero(new ee(l.wrap+(l.canonical.x+t.x/yt)/h,(l.canonical.y+t.y/yt)/h)):0}static getAtTileOffsetFunc(l,t,s,u){return(h,m,g)=>{let v=this.getAtTileOffset(l,h,m,g),b=u.upVector(l.canonical,h.x,h.y);return fr(b,b,v*u.upVectorScale(l.canonical,t,s).metersToTile),b}}getForTilePoints(l,t,s,u){if(this.isUsingMockSource())return!1;let h=jg.create(this,l,u);return!!h&&(t.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;let t=this.findDEMTileFor(l);if(!t||!t.dem)return null;let s=t.dem.tree,u=t.tileID,h=1<<l.canonical.z-u.canonical.z,m=l.canonical.x/h-u.canonical.x,g=l.canonical.y/h-u.canonical.y,v=0;for(let b=0;b<l.canonical.z-u.canonical.z&&!s.leaves[v];b++){m*=2,g*=2;let E=2*Math.floor(g)+Math.floor(m);v=s.childOffsets[v]+E,m%=1,g%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(let h of l){let m=this.getMinMaxForTile(h.tileID);m&&(s=Math.min(s,m.min),u=Math.max(u,m.max),t=!0)}return t?{min:s,max:u}:null}},r.bW=q1,r.bX=Wn,r.bY=fo,r.bZ=pk,r.b_=SL,r.ba=oM,r.bb=FI,r.bc=_e,r.bd=ou,r.be=au,r.bf=yh,r.bg=nr,r.bh=Ig,r.bi=SM,r.bj=function(l,t){let s=bh(t.zoom);if(s===0)return Ja(l);let u=F1(l),h=EI(u),m=w(u.getWest())*t.worldSize,g=w(u.getEast())*t.worldSize,v=S(u.getNorth())*t.worldSize,b=S(u.getSouth())*t.worldSize,E=[m,v,0],T=[g,v,0],I=[m,b,0],D=[g,b,0],O=Nt([],t.globeMatrix);return Fr(E,E,O),Fr(T,T,O),Fr(I,I,O),Fr(D,D,O),h[0]=fc(h[0],I,s),h[1]=fc(h[1],D,s),h[2]=fc(h[2],T,s),h[3]=fc(h[3],E,s),$t.fromPoints(h)},r.bk=N1,r.bl=Nt,r.bm=Fv,r.bn=fc,r.bo=hh,r.bp=Kp,r.bq=Or,r.br=Xt,r.bs=Mw,r.bt=rw,r.bu=Ql,r.bv=function(l,t){let s=[];for(let u in l)u in t||s.push(u);return s},r.bw=xe,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=Kl,r.bz=ke,r.c=Fo,r.c$=function(l,t,s){let u=0;for(let h=0;h<2;++h)l[h]>0&&(u+=(l[h]-0)*(l[h]-0)),t[h]<0&&(u+=(0-t[h])*(0-t[h]));return u},r.c0=vk,r.c1=dM,r.c2=XF,r.c3=yM,r.c4=VM,r.c5=fr,r.c6=Gd,r.c7=qd,r.c8=function(l,t,s){s*=.5;var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+h*v,l[1]=h*b-u*v,l[2]=m*b+g*v,l[3]=g*b-m*v,l},r.c9=ja,r.cA=ci,r.cB=Jn,r.cC=nF,r.cD=Ii,r.cE=RR,r.cF=function(l,t,s,u,h,m,g,v,b){if(b.name==="globe")return RR(l,t,new Ii(s,u,h),!1);let E=sy({z:s,x:u,y:h},b);return new $t([(m+E.x/E.scale)*t,t*(E.y/E.scale),g],[(m+E.x2/E.scale)*t,t*(E.y2/E.scale),v])},r.cG=function(l,t,s){return l[0]=Math.min(t[0],s[0]),l[1]=Math.min(t[1],s[1]),l[2]=Math.min(t[2],s[2]),l[3]=Math.min(t[3],s[3]),l},r.cH=function(l,t,s){return l[0]=Math.max(t[0],s[0]),l[1]=Math.max(t[1],s[1]),l[2]=Math.max(t[2],s[2]),l[3]=Math.max(t[3],s[3]),l},r.cI=function(l){let t=Math.round((l+45+360)%360/90)%4;return M0[t]},r.cJ=N,r.cK=jc,r.cL=Tg,r.cM=function(l){let t=ht(new Float64Array(16));Mt(t,l.pixelMatrix,l.globeMatrix);let s=[0,Ta,0],u=[0,Ia,0];return Fr(s,s,t),Fr(u,u,t),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!II(l,new c(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!II(l,new c(l.center.lat,-90))]},r.cN=function(l,t){let{scale:s}=l.tileTransform,u=s*yt/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return(function(h,m,g){var v=m[1],b=m[2],E=m[3],T=g[0],I=g[1];return h[0]=m[0]*T,h[1]=v*T,h[2]=b*I,h[3]=E*I,h})(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},r.cO=Q1,r.cP=Uu,r.cQ=tF,r.cR=function(l){let t=tF(l,!0);return k([],[t[0],t[1],t[4],t[5]])},r.cS=Vn,r.cT=Tt,r.cU=sr,r.cV=function(l){let{x:t,y:s}=l.point,{lng:u,lat:h}=l._center;return LR(t,s,l.worldSize,u,h)},r.cW=Va,r.cX=os,r.cY=rr,r.cZ=Lo,r.c_=Sa,r.ca=br,r.cb=function(l,t){return l[0]=-t[0],l[1]=-t[1],l[2]=-t[2],l[3]=t[3],l},r.cc=Vu,r.cd=function(l,t,s,u,h){var m=1/Math.tan(t/2);if(l[0]=m/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=m,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,h!=null&&h!==1/0){var g=1/(u-h);l[10]=(h+u)*g,l[14]=2*h*u*g}else l[10]=-1,l[14]=-2*u;return l},r.ce=function(l,t,s,u,h,m,g){var v=1/(t-s),b=1/(u-h),E=1/(m-g);return l[0]=-2*v,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*b,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(t+s)*v,l[13]=(h+u)*b,l[14]=(g+m)*E,l[15]=1,l},r.cf=M,r.cg=function(l,t,s){l[4*t+0]=s[0],l[4*t+1]=s[1],l[4*t+2]=s[2],l[4*t+3]=s[3]},r.ch=wg,r.ci=Gp,r.cj=Qr,r.ck=Tl,r.cl=Wp,r.cm=aL,r.cn=function(){var l=new P(4);return P!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},r.co=function(l,t,s){var u=t[0],h=t[1],m=t[2],g=t[3],v=Math.sin(s),b=Math.cos(s);return l[0]=u*b+m*v,l[1]=h*b+g*v,l[2]=u*-v+m*b,l[3]=h*-v+g*b,l},r.cp=function(l,t){return l[0]===t[0]&&l[1]===t[1]&&l[2]===t[2]&&l[3]===t[3]},r.cq=rs,r.cr=function(l){var t=l[0],s=l[1],u=l[2],h=l[3];return Math.sqrt(t*t+s*s+u*u+h*h)},r.cs=Wu,r.ct=Uc,r.cu=Lr,r.cv=3,r.cw=2,r.cx=7,r.cy=6,r.cz=$u,r.d=function(l){return kn.API_TILEJSON_REGEX.test(l)},r.d$=class{constructor(l,t,s,u){this.context=l,this.format=u,this.size=s,this.texture=l.gl.createTexture();let[h,m,g]=this.size,{gl:v}=l;v.bindTexture(v.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,h,m,g,0,ZI(this.format),YI(this.format),t.data)}bind(l,t){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){let{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},r.d0=function(l){return l*l*l*l*l},r.d1=x,r.d2=45,r.d3=Cg,r.d4=function(l,t,s){let u=Math.sqrt(l*l+t*t+s*s),h=u>0?Math.acos(s/u)*Xu:0,m=l!==0||t!==0?Math.atan2(-t,-l)*Xu+90:0;return m<0&&(m+=360),[u,m,h]},r.d5=xr,r.d6=gn,r.d7=q,r.d8=Wr,r.d9=$t,r.dA=function(l){return l({pluginStatus:ms,pluginURL:oc}),eg.on("pluginStateChange",l),l},r.dB=qp,r.dC=class extends lc{constructor(l){super(l),this.current=Eg}set(l,t,s){if(this.fetchUniformLocation(l,t)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},r.dD=Ku,r.dE=function(l,t,s){let u=bh(s.zoom),h=l.style.map._antialias,m=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!h&&!m},r.dF=function(l){let t=l.pixelsPerMeter,s=t/M(1,l.center.lat),u=ht(new Float64Array(16));return Xt(u,u,[l.point.x,l.point.y,0]),Vn(u,u,[s,s,t]),Float32Array.from(u)},r.dG=F1,r.dH=function(l){let t=N-5;l=G(l,-t,t)/t*90;let s=Math.pow(Math.abs(Math.sin(Zn(l))),3);return Math.round(s*(kv.length-1))},r.dI=function(l,t,s,u){let h=t.getNorth(),m=t.getSouth(),g=t.getWest(),v=t.getEast(),b=1<<l.z,E=v-g,T=h-m,I=E/_h,D=-T/kv[s],O=[0,I,0,D,0,0,h,g,0];if(l.z>0){let R=180/u;Me(O,O,[R/E+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/D,1])}return O[2]=b,O[5]=l.x,O[8]=l.y,O},r.dJ=Ja,r.dK=function(l,t,s){let u=ht(new Float64Array(16)),h=(t/(1<<l)-.5)*Math.PI*2;return Hi(u,s.globeMatrix,h),Float32Array.from(u)},r.dL=YR,r.dM=Il,r.dN=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},r.dO=X,r.dP=function(l,t){var s=Math.sin(t),u=Math.cos(t);return l[0]=u,l[1]=s,l[2]=0,l[3]=-s,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},r.dQ=Vc,r.dR=FR,r.dS=Gn,r.dT=cr,r.dU=256,r.dV=function(l,t){let s=[0,0,0];return Fr(s,s,N1(Ja(t.canonical))),Fr(s,s,l),s},r.dW=l=>({u_matrix:new Wp(l),u_texsize:new Tl(l),u_pixels_to_tile_units:new Sg(l),u_device_pixel_ratio:new Qr(l),u_width_scale:new Qr(l),u_floor_width_scale:new Qr(l),u_image:new wg(l),u_units_to_pixels:new Tl(l),u_tile_units_to_pixels:new Qr(l),u_alpha_discard_threshold:new Qr(l),u_trim_offset:new Tl(l),u_trim_fade_range:new Tl(l),u_trim_color:new Cg(l),u_zbias_factor:new Qr(l),u_tile_to_meter:new Qr(l),u_ground_shadow_factor:new Gp(l),u_pattern_transition:new Qr(l)}),r.dX=l=>({u_matrix:new Wp(l),u_pixels_to_tile_units:new Sg(l),u_device_pixel_ratio:new Qr(l),u_width_scale:new Qr(l),u_floor_width_scale:new Qr(l),u_units_to_pixels:new Tl(l),u_dash_image:new wg(l),u_gradient_image:new wg(l),u_image_height:new Qr(l),u_texsize:new Tl(l),u_tile_units_to_pixels:new Qr(l),u_alpha_discard_threshold:new Qr(l),u_trim_offset:new Tl(l),u_trim_fade_range:new Tl(l),u_trim_color:new Cg(l),u_zbias_factor:new Qr(l),u_tile_to_meter:new Qr(l),u_ground_shadow_factor:new Gp(l)}),r.dY=l=>({u_camera_to_center_distance:new Qr(l),u_extrude_scale:new Sg(l),u_device_pixel_ratio:new Qr(l),u_matrix:new Wp(l),u_inv_rot_matrix:new Wp(l),u_merc_center:new Tl(l),u_tile_id:new Gp(l),u_zoom_transition:new Qr(l),u_up_dir:new Gp(l),u_emissive_strength:new Qr(l)}),r.dZ=pg,r.d_=d$,r.da=dl,r.db=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},r.dc=eF,r.dd=nM,r.de=oF,r.df=IM,r.dg=function(l,t){return l.readFields(uH,{icons:[]},t)},r.dh=Z1,r.di=zg,r.dj=gM,r.dk=fm,r.dl=Bp,r.dm=Zd,r.dn=gm,r.dp=Xe,r.dq=function(l){let t=l.indexOf(md);return t>=0?l.slice(0,t):l},r.dr=function(l){return l.indexOf(md)>=0},r.ds=function(l){let t=l.lastIndexOf(md);return t>=0?l.slice(t+1):""},r.dt=function(l){let t=[],s=l.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},r.du=function(l,t,s,u){return l.type==="custom"?new iH(l,t):new lH[l.type](l,t,s,u)},r.dv=ut,r.dw=function(l){let t=l.indexOf(md);return t>=0?l.slice(t+1):""},r.dx=class extends of{constructor(l,t){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){let l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},r.dy=eg,r.dz=nd,r.e=kn,r.e$=Ji,r.e0=BR,r.e1=(l,t,s,u,h,m)=>{let g=l.transform,v=g.projection.name==="globe",b;if(m.paint.get("circle-pitch-alignment")==="map")if(v){let T=FR(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([T,0,0,T])}else b=g.calculatePixelsToTileUnitsMatrix(s);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let E={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(g.projection),u_matrix:l.translatePosMatrix(t.projMatrix,s,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ho.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:I6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],E.u_zoom_transition=bh(g.zoom);let T=h[0]*yt,I=h[1]*yt;E.u_up_dir=g.projection.upVector(new Ii(0,0,0),T,I)}return E},r.e2=bF,r.e3=ps,r.e4=(l,t,s,u,h,m,g,v,b,E)=>{let T=l.transform,I=T.pitch<15?vF(.07,.7,G((14-T.zoom)/5,0,1)):.07,D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:xF(l,t,s,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:yF(t,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:I,u_tile_to_meter:q(t.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:E}},r.e5=(l,t,s,u,h,m,g,v,b,E)=>{let T=l.transform,I=T.calculatePixelsToTileUnitsMatrix(t),D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",O=T.pitch<15?vF(.07,.7,G((14-T.zoom)/5,0,1)):.07;return{u_matrix:xF(l,t,s,u),u_pixels_to_tile_units:I,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:wF(s)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:yF(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:O,u_tile_to_meter:q(t.tileID.canonical,0),u_ground_shadow_factor:E}},r.e6=ze,r.e7=Lv,r.e8=F,r.e9=Da,r.eA=function(l,t){var s=2*Math.acos(t[3]),u=Math.sin(s/2);return u>C?(l[0]=t[0]/u,l[1]=t[1]/u,l[2]=t[2]/u):(l[0]=1,l[1]=0,l[2]=0),s},r.eB=AM,r.eC=tw,r.eD=ew,r.eE=[1,1,1],r.eF=jg,r.eG=Hu,r.eH=function(l,t,s,u){var h=t[0],m=t[1],g=t[2],v=t[3];return l[0]=h+u*(s[0]-h),l[1]=m+u*(s[1]-m),l[2]=g+u*(s[2]-g),l[3]=v+u*(s[3]-v),l},r.eI=Rg,r.eJ=ia,r.eK=Sl,r.eL=function(l,t,s,u,h,m,g,v,b,E,T,I,D,O,R,B){var H=new P(16);return H[0]=l,H[1]=t,H[2]=s,H[3]=u,H[4]=h,H[5]=m,H[6]=g,H[7]=v,H[8]=b,H[9]=E,H[10]=T,H[11]=I,H[12]=D,H[13]=O,H[14]=R,H[15]=B,H},r.eM=p,r.eN=mh,r.eO=Ev,r.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){let s=mk(new st(0,0),new st(yt,yt),l),u=[];if(t&&!LI(s,this._globalClipBounds))return u;for(let h of this._activeRegions){if(h.hiddenByOverlap||!LI(s,h))continue;let m=n8(h.min,h.max,l);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{let s=[];for(let u of t.cache.getVisibleCoordinates()){let h=t.cache.getTile(u).buckets[t.layer];h&&h.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){let t=l.getFootprints();if(t.length===0)return;let s=l.getOrder(),u=l.getClipMask(),h=l.getClipScope();for(let m of t){if(!m.footprint)continue;let g=mk(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:s,clipMask:u,clipScope:h})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,s)=>t.priority-s.priority||j1(t.min,s.min)||j1(t.max,s.max)||t.order-s.order||t.clipMask-s.clipMask||(function(u,h){let m=(g,v)=>g+v;return u.length-h.length||u.reduce(m,"").localeCompare(h.reduce(m,""))})(t.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){let s=this._activeRegions[t],u=this._prevRegions[t];l=s.priority!==u.priority||!fk(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Kl(s.clipScope,u.clipScope),this._activeRegions[t].hiddenByOverlap=u.hiddenByOverlap,++t}}if(l){++this._updateTime;for(let s of this._activeRegions)s.order!==jv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));let t=s=>{let u=this._activeRegions;if(s>=u.length)return s;let h=u[s].priority;for(;s<u.length&&u[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,u=t(s);for(;s!==u;){let h=s,m=s;for(;h!==u;){let g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let v=0;v<m;v++){let b=this._activeRegions[v];if(!b.hiddenByOverlap&&g.order===jv&&LI(g,b)&&(g.hiddenByOverlap=gk(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++h}s=u,u=t(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},r.eQ=jv,r.eR=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let l of this._poleSegments)l.destroy();for(let l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){let s=new ou,u=new Kr,h=[],m=l+1+2,g=t[0]+1,v=t[0]+1+(1+t.length),b=(E,T,I)=>{let D=E===m-1?E-2:E===0?E:E-1;return D+=I?24575:0,[D,T]};for(let E=0;E<m;++E)s.emplaceBack(...b(E,0,!0));for(let E=0;E<g;++E)for(let T=0;T<m;++T)s.emplaceBack(...b(T,E,(T===0||T===m-1)&&!0));for(let E=0;E<t.length;++E){let T=t[E];for(let I=0;I<m;++I)s.emplaceBack(...b(I,T,!0))}for(let E=0;E<t.length;++E){let T=u.length,I=t[E]+1+2,D=new Kr;for(let B=0;B<I-1;B++){let H=B===I-2,$=H?m*(v-t.length+E-B):m;for(let Y=0;Y<m-1;Y++){let J=B*m+Y;B===0||H||Y===0||Y===m-2?(D.emplaceBack(J+1,J,J+$),D.emplaceBack(J+$,J+$+1,J+1)):(u.emplaceBack(J+1,J,J+$),u.emplaceBack(J+$,J+$+1,J+1))}}let O=nr.simpleSegment(0,T,s.length,u.length-T);for(let B=0;B<D.uint16.length;B+=3)u.emplaceBack(D.uint16[B],D.uint16[B+1],D.uint16[B+2]);let R=nr.simpleSegment(0,T,s.length,u.length-T);h.push({withoutSkirts:O,withSkirts:R})}return{vertices:s,indices:u,segments:h}}_createGrid(l){let t=this._fillGridMeshWithLods(_h,kv);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,yh.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){let t=new Kr;for(let g=0;g<=_h;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);let s=new _d,u=new _d,h=new _d,m=new _d;this._poleSegments=[];for(let g=0,v=0;g<Sa;g++){let b=360/(1<<g);s.emplaceBack(0,-Ko,0,.5,0),u.emplaceBack(0,-Ko,0,.5,1),h.emplaceBack(0,-Ko,0,.5,.5),m.emplaceBack(0,-Ko,0,.5,.5);for(let E=0;E<=_h;E++){let T=E/_h,I=0,D=on(0,b,T),[O,R,B]=vd(S6,T6,D,Ko);s.emplaceBack(O,R,B,T,I),u.emplaceBack(O,R,B,T,1-I);let H=Zn(D);T=.5+.5*Math.sin(H),I=.5+.5*Math.cos(H),h.emplaceBack(O,R,B,T,I),m.emplaceBack(O,R,B,T,1-I)}this._poleSegments.push(nr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,Qa,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,Qa,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(h,Qa,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(m,Qa,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},r.eS=hk,r.eT=dp,r.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eV=Re,r.eW=Z,r.eX=function(l,t,s){return l[0]=t[0]/s[0],l[1]=t[1]/s[1],l[2]=t[2]/s[2],l},r.eY=T0,r.eZ=vh,r.e_=sm,r.ea=G1,r.eb=Ok,r.ec=xd,r.ed=wk,r.ee=bk,r.ef=U,r.eg=function(l,t){if(l===t){var s=t[1],u=t[2],h=t[3],m=t[6],g=t[7],v=t[11];l[1]=t[4],l[2]=t[8],l[3]=t[12],l[4]=s,l[6]=t[9],l[7]=t[13],l[8]=u,l[9]=m,l[11]=t[14],l[12]=h,l[13]=g,l[14]=v}else l[0]=t[0],l[1]=t[4],l[2]=t[8],l[3]=t[12],l[4]=t[1],l[5]=t[5],l[6]=t[9],l[7]=t[13],l[8]=t[2],l[9]=t[6],l[10]=t[10],l[11]=t[14],l[12]=t[3],l[13]=t[7],l[14]=t[11],l[15]=t[15];return l},r.eh=nH,r.ei=Pn,r.ej=Tv,r.ek=256,r.el=SI,r.em=na,r.en=Hi,r.eo=function(l,t){return l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[4],l[4]=t[5],l[5]=t[6],l[6]=t[8],l[7]=t[9],l[8]=t[10],l},r.ep=_d,r.eq=n1,r.er=Cv,r.es=function(l,t,s,u,h){return G((l-t)/(s-t)*(h-u)+u,u,h)},r.et=Yl,r.eu=function(l,t){var s=t[0],u=t[1],h=t[2],m=t[3],g=t[4],v=t[5],b=t[6],E=t[7],T=t[8],I=T*g-v*E,D=-T*m+v*b,O=E*m-g*b,R=s*I+u*D+h*O;return R?(l[0]=I*(R=1/R),l[1]=(-T*u+h*E)*R,l[2]=(v*u-h*g)*R,l[3]=D*R,l[4]=(T*s-h*b)*R,l[5]=(-v*s+h*m)*R,l[6]=O*R,l[7]=(-E*s+u*b)*R,l[8]=(g*s-u*m)*R,l):null},r.ev=2,r.ew=Bc,r.ex=Zl,r.ey=Ks,r.ez=function(l,t){var s=new P(3);Ks(s,t);var u=1/s[0],h=1/s[1],m=1/s[2],g=t[0]*u,v=t[1]*h,b=t[2]*m,E=t[4]*u,T=t[5]*h,I=t[6]*m,D=t[8]*u,O=t[9]*h,R=t[10]*m,B=g+T+R,H=0;return B>0?(H=2*Math.sqrt(B+1),l[3]=.25*H,l[0]=(I-O)/H,l[1]=(D-b)/H,l[2]=(v-E)/H):g>T&&g>R?(H=2*Math.sqrt(1+g-T-R),l[3]=(I-O)/H,l[0]=.25*H,l[1]=(v+E)/H,l[2]=(D+b)/H):T>R?(H=2*Math.sqrt(1+T-g-R),l[3]=(D-b)/H,l[0]=(v+E)/H,l[1]=.25*H,l[2]=(I+O)/H):(H=2*Math.sqrt(1+R-g-T),l[3]=(v-E)/H,l[0]=(D+b)/H,l[1]=(I+O)/H,l[2]=.25*H),l},r.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(+("0x"+s))))},r.f0=function([l,t,s]){let u=Math.hypot(l,t,s),h=Math.atan2(l,s),m=.5*Math.PI-Math.acos(-t/u);return new c(os(h),os(m))},r.f1=$c,r.f2=KI,r.f3=function(l){let t=l.navigator?l.navigator.userAgent:null;return!!(function(s){if(Ur==null){let u=s.navigator?s.navigator.userAgent:null;Ur=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Ur})(l)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f4=function(l,t){um=l,dm=t},r.f5=II,r.f6=NR,r.f7=function(l){let t=[0,0,0],s=ht(new Float64Array(16));return Mt(s,l.pixelMatrix,l.globeMatrix),Fr(t,t,s),new st(t[0],t[1])},r.f8=function(){let l=Zv;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(jI),Zv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f9=function(){Z1().acquire(jI)},r.fA=Iw,r.fB=Ce,r.fC=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==Yk){let s=new Uint32Array(l,0,7),[,,u,h,m,g]=s;t=s.byteLength+h+m+g+m,(u!==l.byteLength||t>=l.byteLength)&&Pt("Invalid b3dm header information.")}return Jk(l,t)},r.fD=function(l,t){let s=nM(l);for(let u of s){for(let h of u.meshes)R8(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(k8(u.lights,t)))}return s},r.fE=bw,r.fF=Un,r.fG=Hk,r.fH=sc,r.fI=Vs,r.fJ=function(l){qa(),ml?.then(t=>{t.keys().then(s=>{for(let u=0;u<s.length-l;u++)t.delete(s[u]).catch(h=>Pt(h.message))}).catch(s=>Pt(s.message))}).catch(t=>Pt(t.message))},r.fa=Vp,r.fb=function(l,t,s=!1){if(ms===Vs.deferred||ms===Vs.loading||ms===Vs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");oc=ho.resolveURL(l),ms=Vs.deferred,pv=t,Jm(),s||f1()},r.fc=function(l){Ag=ho.resolveURL(l),Pg||(Pg=new Dg(Z1(),new id)),Pg.broadcast("setMeshoptUrl",Ag)},r.fd=Wk,r.fe=function(l){GI=ho.resolveURL(l),Pg||(Pg=new Dg(Z1(),new id)),Pg.broadcast("setDracoUrl",GI)},r.ff=qk,r.fg=Wv,r.fh=function(l){let t=Ga();if(!t)return;let s=t.delete(cm);l&&s.then(()=>l()).catch(l)},r.fi=W1,r.fj=Lt,r.fk=wh,r.fl=_c,r.fm=hN,r.fn=pN,r.fo=fF,r.fp=Ge,r.fq="hd_road_elevation",r.fr=ii,r.fs=Ne,r.ft=yd,r.fu=mM,r.fv=nf,r.fw=function(l,t,s,u,h,m,g,v=1,b,E,T){l.createArrays(),l.tilePixelRatio=yt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;let I=l.layers[0].layout,D=l.layers[0]._unevaluatedLayout._values,O={};O.scaleFactor=v,O.textSizeScaleRange=I.get("text-size-scale-range"),O.iconSizeScaleRange=I.get("icon-size-scale-range");let[R,B]=O.textSizeScaleRange,[H,$]=O.iconSizeScaleRange;O.textScaleFactor=G(O.scaleFactor,R,B),O.iconScaleFactor=G(O.scaleFactor,H,$);let Y=D["text-size"],J=D["icon-size"];if(l.textSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=l.textSizeData;O.compositeTextSizes=[Y.possiblyEvaluate(new Ui(we,{worldview:T}),m),Y.possiblyEvaluate(new Ui(je,{worldview:T}),m)]}if(l.iconSizeData.kind==="composite"){let{minZoom:we,maxZoom:je}=l.iconSizeData;O.compositeIconSizes=[J.possiblyEvaluate(new Ui(we,{worldview:T}),m),J.possiblyEvaluate(new Ui(je,{worldview:T}),m)]}O.layoutTextSize=Y.possiblyEvaluate(new Ui(g+1,{worldview:T}),m),O.layoutIconSize=J.possiblyEvaluate(new Ui(g+1,{worldview:T}),m),O.textMaxSize=Y.possiblyEvaluate(new Ui(18,{worldview:T}),m);let ie=I.get("symbol-placement"),he=I.get("text-rotation-alignment")==="map"&&ie!=="point",le=I.get("text-size"),me=!1,ye=[];for(let we of l.features){let je=I.get("text-font").evaluate(we,{},m).join(","),Ae=le.evaluate(we,{},m)*O.textScaleFactor,We=O.layoutTextSize.evaluate(we,{},m)*O.textScaleFactor,Ke=O.layoutIconSize.evaluate(we,{},m)*O.iconScaleFactor,Qe={horizontal:{},vertical:void 0},at=we.text,ct,nt=[0,0];if(at){let _n=at.toString(),_i=I.get("text-letter-spacing").evaluate(we,{},m)*fo,ce=I.get("text-line-height").evaluate(we,{},m)*fo,pe=dv(_n)?_i:0,Ze=I.get("text-anchor").evaluate(we,{},m),lt=I.get("text-variable-anchor");if(!lt){let mn=I.get("text-radial-offset").evaluate(we,{},m);if(mn)nt=XF(Ze,[mn*fo,vM]);else{let En=I.get("text-offset").evaluate(we,{},m);nt=[En[0]*fo,En[1]*fo]}}let Et=he?"center":I.get("text-justify").evaluate(we,{},m),St=ie==="point",Wt=St?I.get("text-max-width").evaluate(we,{},m)*fo:1/0,Yt=mn=>{l.allowVerticalPlacement&&zp(_n)&&(Qe.vertical=uM(at,t,s,h,je,Wt,ce,Ze,mn,pe,nt,sa.vertical,!0,We,Ae,b))};if(!he&&lt){let mn=Et==="auto"?lt.map(Tn=>yM(Tn)):[Et],En=!1;for(let Tn=0;Tn<mn.length;Tn++){let On=mn[Tn];if(!Qe.horizontal[On])if(En)Qe.horizontal[On]=Qe.horizontal[0];else{let rn=uM(at,t,s,h,je,Wt,ce,"center",On,pe,nt,sa.horizontal,!1,We,Ae,b);rn&&(Qe.horizontal[On]=rn,En=rn.positionedLines.length===1)}}Yt("left")}else{if(Et==="auto"&&(Et=yM(Ze)),St||I.get("text-writing-mode").indexOf("horizontal")>=0||!zp(_n)){let mn=uM(at,t,s,h,je,Wt,ce,Ze,Et,pe,nt,sa.horizontal,!1,We,Ae,b);mn&&(Qe.horizontal[Et]=mn)}Yt(St?"left":Et)}}let it,qe,He,rt,xt,ft,qt=!1,It=I.get("icon-text-fit").evaluate(we,{},m);if(we.icon&&we.icon.hasPrimary()){let _n=ry(we.icon,l.iconSizeData,D["icon-size"],m,l.zoom,we,b,O.iconScaleFactor,T);it=_n.iconPrimary,He=_n.iconSecondary;let _i=it.toString();if(qe=u.get(_i),qe&&(xt=I.get("icon-offset").evaluate(we,{},m),ft=I.get("icon-anchor").evaluate(we,{},m),ct=sw(h.get(_i),He?h.get(He.toString()):void 0,xt,ft),qt=qe.sdf,l.sdfIcons===void 0?l.sdfIcons=qe.sdf:l.sdfIcons!==qe.sdf&&Pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==l.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),He){let ce=He.toString();rt=u.get(ce)}}me=me||!(!we.icon||!we.icon.hasSecondary());let Rt=dw(Qe.horizontal)||Qe.vertical;l.iconsInText||(l.iconsInText=!!Rt&&Rt.iconsInText);let Bt=We*O.textScaleFactor/fo,{defaultShapedIcon:In,verticallyShapedIcon:mt}=j$(l,ct,I,we,m,Qe,Bt,xt,It);It!=="none"&&ct&&(FF(ct)||LF(ct))&&(uw(0,qe,it,ct,In,It,E,u,h),uw(0,rt,He,ct,In,It,E,u,h),mt&&(uw(0,qe,it,ct,mt,It,E,u,h),uw(0,rt,He,ct,mt,It,E,u,h))),ct=In;let{iconBBox:Ut,iconVerticalBBox:dn,textBBox:Ln,textVerticalBBox:zn}=N$(l,ct,mt,I,we,m,Ke,xt,O,h,ft,Qe,We,nt);ye.push({feature:we,shapedTextOrientations:Qe,shapedText:Rt,shapedIcon:ct,iconPrimary:it,iconSecondary:He,iconOffset:xt,iconAnchor:ft,verticallyShapedIcon:mt,layoutTextSize:We,layoutIconSize:Ke,textOffset:nt,isSDFIcon:qt,iconTextFit:It,iconCollisionBounds:Ut,iconVerticalCollisionBounds:dn,textCollisionBounds:Ln,textVerticalCollisionBounds:zn})}return{featureData:ye,sizes:O,hasAnySecondaryIcon:me,textAlongLine:he,symbolPlacement:ie}},r.fx=HF,r.fy=function(l,t,s,u,h,m,g,v,b,E){l.iconAtlasPositions=E.iconPositions;let{featureData:T,hasAnySecondaryIcon:I,sizes:D,textAlongLine:O,symbolPlacement:R}=t;for(let B of T){let{shapedIcon:H,verticallyShapedIcon:$,feature:Y,shapedTextOrientations:J,shapedText:ie,layoutTextSize:he,textOffset:le,isSDFIcon:me,iconPrimary:ye,iconSecondary:we,iconTextFit:je,iconOffset:Ae,iconCollisionBounds:We,iconVerticalCollisionBounds:Ke,textCollisionBounds:Qe}=B;QF(H,E.iconPositions,ye,we),QF($,E.iconPositions,ye,we),U$(J,E.iconPositions),V$(ye,we,E.iconPositions),(ie||H)&&$$(l,Y,J,H,$,b,D,he,0,le,me,u,h,g,v,I,je,Ae,O,R,We,Ke,Qe)}s&&l.generateCollisionDebugBuffers(m,l.collisionBoxArray,D.textScaleFactor)},r.fz=Fe,r.g=function(l,t){return nd(Object.assign(l,{method:"GET"}),t)},r.h=function(l){return l.indexOf("mapbox:")===0},r.i=function(l){return kn.API_STYLE_REGEX.test(l)&&!Fo(l)},r.j=wr,r.k=gl,r.l=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(l,t){return nd(Object.assign(l,{type:"json"}),t)},r.n=mm,r.o=ho,r.p=function(l,t){return nd(Object.assign(l,{method:"POST"}),t)},r.q=es,r.r=fl,r.s=function(l){try{let t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return $I||($I=new W1("ImageRasterizer")),$I},r.u=function(){return(function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)})()},r.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},r.w=Pt,r.x=LM,r.y=_p,r.z=_l}),a(["./shared"],function(r){function C(Re){let G=Re?Re.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function P(Re){if(typeof Re=="number"||typeof Re=="boolean"||typeof Re=="string"||Re==null)return JSON.stringify(Re);if(Array.isArray(Re)){let Q="[";for(let se of Re)Q+=`${P(se)},`;return`${Q}]`}let G="{";for(let Q of Object.keys(Re).sort())G+=`${Q}:${P(Re[Q])},`;return`${G}}`}function k(Re){let G="";for(let Q of r.bx)G+=`/${P(Re[Q])}`;return G}class X{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,Q){this._layerConfigs={},this._layers={},this.update(G,[],Q)}update(G,Q,se){this._options=se;for(let ve of G)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=r.du(ve,this.scope,null,this._options)).compileFilter(se),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(let ve of Q)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};let xe=(function(ve,Ie){let ze={};for(let Ne=0;Ne<ve.length;Ne++){let ut=ve[Ne],Xe=Ie&&Ie[ut.id];Xe||(ut.type==="symbol"?Xe=ut.id:(Xe=k(ut),ut.type==="line"&&ut.paint&&(function Qt(Pt){return typeof Pt=="string"&&Pt==="line-progress"||(Array.isArray(Pt)?Pt.some(Qt):!(!Pt||typeof Pt!="object")&&Object.values(Pt).some(Qt))})(ut.paint["line-width"])&&(Xe+=`/${P(ut.paint["line-width"])}`))),Ie&&(Ie[ut.id]=Xe);let Ft=ze[Xe];Ft||(Ft=ze[Xe]=[]),Ft.push(ut)}let Pe=[];for(let Ne in ze)Pe.push(ze[Ne]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(let ve of xe){let Ie=ve.map(Ft=>this._layers[Ft.id]),ze=Ie[0];if(ze.visibility==="none")continue;let Pe=ze.source||"",Ne=this.familiesBySource[Pe];Ne||(Ne=this.familiesBySource[Pe]={});let ut=ze.sourceLayer||"_geojsonTileLayer",Xe=Ne[ut];Xe||(Xe=Ne[ut]=[]),Xe.push(Ie)}}}let oe=1*r.fl;class Me{constructor(G){let Q={},se=[];for(let ze in G){let Pe=G[ze],Ne=Q[ze]={};for(let ut in Pe.glyphs){let Xe=Pe.glyphs[+ut];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let Ft=Xe.metrics.localGlyph?oe:1,Qt={x:0,y:0,w:Xe.bitmap.width+2*Ft,h:Xe.bitmap.height+2*Ft};se.push(Qt),Ne[ut]=Qt}}let{w:xe,h:ve}=r.G(se),Ie=new r.fk({width:xe||1,height:ve||1});for(let ze in G){let Pe=G[ze];for(let Ne in Pe.glyphs){let ut=Pe.glyphs[+Ne];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let Xe=Q[ze][Ne],Ft=ut.metrics.localGlyph?oe:1;r.fk.copy(ut.bitmap,Ie,{x:0,y:0},{x:Xe.x+Ft,y:Xe.y+Ft},ut.bitmap)}}this.image=Ie,this.positions=Q}}function $e(Re,G,Q){Re[G]?Q&&(Re[G].center=Q):Re[G]={floorIds:new Set,center:Q||[0,0],floors:{}}}function ke(Re,G,Q,se){for(let xe of G)$e(Re,xe),Re[xe].floors[Q]=se,Re[xe].floorIds.add(Q)}function ht(Re){return{id:Re.properties.id.toString(),center:Re.properties.center.toString().split(";").map(Number)}}function Nt(Re){return{id:Re.properties.id.toString(),isDefault:!!Re.properties.is_default&&Re.properties.is_default,connections:Re.properties.connected_floor_ids?new Set(Re.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Re.properties.conflicted_floor_ids?new Set(Re.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Re.properties.building_ids?new Set(Re.properties.building_ids.toString().split(";")):new Set,name:Re.properties.name.toString(),zIndex:Re.properties.z_index}}function Mt(Re,G){return G.every(Q=>Re.properties&&Re.properties[Q]!=null)}function Xt(Re){return Mt(Re,["type","id","name"])&&Re.properties.type==="building"}function Vn(Re){return Mt(Re,["type","id","name","z_index"])&&Re.properties.type==="floor"}r.fj(Me,"GlyphAtlas");class sr{constructor(G){this.tileID=new r.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=r.aZ(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor,this.worldview=G.worldview,this.indoor=G.indoor}parse(G,Q,se,xe,ve,Ie){this.status="parsing",this.data=G,this.collisionBoxArray=new r.b3;let ze=new r.fm(Object.keys(G.layers).sort()),Pe=new r.fn(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];let Ne={},ut=new r.fo(256,256),Xe={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ut,availableImages:se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){let bn=this.indoor.indoorState.activeFloorsVisible,yn=(function(gn,Un,mr){let Ur=(function(lr,Gn){if(!lr)return r.w("No source layers defined in indoor specification"),Gn;if(lr.size===0)return Gn;let cr=lr.difference(Gn);for(let Oi of cr)r.w(`Missing source layer required in indoor specification: ${Oi}`);return Gn.intersection(Gn)})(Un.sourceLayers,new Set(Object.keys(gn.layers))),br=Un.indoorState,Zr=(function(lr,Gn,cr,Oi){let kn=new Set,wr=new Set,Fo=new Set,Yo=new Map,Ts={},Qu=wo=>{let Js=Yo.get(wo)||new Set;for(let ss of kn)if((Yo.get(ss)||new Set).has(wo)||Js.has(ss))return!0;return!1};for(let wo of Gn){let Js=lr.layers[wo];if(Js)for(let ss=0;ss<Js.length;ss++){let fl=Js.feature(ss);if(Xt(fl)){let{id:ho,center:Ju}=ht(fl);$e(Ts,ho,Ju),kn.add(ho)}else if(Vn(fl)){let{id:ho,isDefault:Ju,connections:Zd,conflicts:cm,buildings:um,name:dm,zIndex:hp}=Nt(fl);ke(Ts,um,ho,{name:dm,zIndex:hp}),Yo.set(ho,cm),(ho===Oi||Zd.has(Oi))&&kn.add(ho),wr.add(ho),Ju&&Fo.add(ho)}}else r.w(`indoor source layer not found: ${wo}`)}if(cr)for(let wo of cr)wr.has(wo)&&(Qu(wo)||kn.add(wo));for(let wo of Fo)kn.has(wo)||Qu(wo)||kn.add(wo);return{buildings:Ts,activeFloors:kn}})(gn,Ur,br.lastActiveFloors,br.selectedFloorId);return mr.send("setIndoorData",Zr),Zr})(G,this.indoor,ve);Xe.activeFloors=bn?yn.activeFloors:void 0}let Ft=[],Qt=Q.familiesBySource[this.source];for(let bn in Qt){let yn=G.layers[bn];if(!yn)continue;let gn=!1,Un=!1,mr=!1;for(let Gn of Qt[bn])Gn[0].type==="symbol"?gn=!0:Un=!0,Gn[0].is3D()&&Gn[0].type!=="model"&&(mr=!0);if(this.extraShadowCaster&&!mr||this.isSymbolTile===!0&&!gn||this.isSymbolTile===!1&&!Un)continue;yn.version===1&&r.w(`Vector tile source "${this.source}" layer "${bn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Ur=ze.encode(bn),br=[],Zr=this.localizableLayerIds&&this.localizableLayerIds.has(bn),lr=!1;for(let Gn=0,cr=0;Gn<yn.length;Gn++){let Oi=yn.feature(Gn),kn=Pe.getId(Oi,bn),wr=Oi.properties?Oi.properties.worldview:null;if(Zr&&this.worldview&&typeof wr=="string")if(wr==="all")Oi.properties.$localized=!0;else{if(!wr.split(",").includes(this.worldview))continue;Oi.properties.$localized=!0,Oi.properties.worldview=this.worldview}!lr&&Oi.properties&&Oi.properties.hasOwnProperty(r.fp)&&(lr=!0),br.push({feature:Oi,id:kn,index:cr,sourceLayerIndex:Ur}),cr++}lr&&!Xe.elevationFeatures&&G.layers.hasOwnProperty(r.fq)&&(Xe.elevationFeatures=r.fr.parseFrom(G.layers[r.fq],this.canonical));for(let Gn of Qt[bn]){let cr=Gn[0];if(this.extraShadowCaster&&(!cr.is3D()||cr.type==="model")||this.isSymbolTile!==void 0&&cr.type==="symbol"!==this.isSymbolTile||cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility==="none")continue;Hi(Gn,this.zoom,Xe.brightness,se,this.worldview);let Oi=Ne[cr.id]=cr.createBucket({index:Pe.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview,localizable:Zr});Pe.bucketLayerIDs.push(Gn.map(wr=>r.B(wr.id,wr.scope)));let kn=Oi.prepare?Oi.prepare():null;kn!=null?(kn=kn.then(()=>Oi.populate(br,Xe,this.tileID.canonical,this.tileTransform)),Ft.push(kn)):Oi.populate(br,Xe,this.tileID.canonical,this.tileTransform)}}let Pt=()=>{let bn,yn,gn,Un,mr,Ur;ut.trim();let br={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Zr=()=>{if(bn)return this.status="done",Ie(bn);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Ne).filter(Gn=>!Gn.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(yn&&gn&&Un){let Gn=new Me(yn),cr=new Map;for(let[wr,Fo]of gn.entries()){let{imagePosition:Yo}=r.fu(wr,Fo,r.fv);cr.set(wr,Yo)}let Oi={};for(let wr in Ne){let Fo=Ne[wr];Fo instanceof r.b4&&(Hi(Fo.layers,this.zoom,Xe.brightness,se,this.worldview),Oi[wr]=r.fw(Fo,yn,Gn.positions,gn,cr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,mr,this.worldview))}let kn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,gn,mr,()=>{kn.iconsPending=!1,lr(Oi,Gn,kn)}),this.rasterizeIfNeeded(ve,Un,Ur,()=>{kn.patternsPending=!1,lr(Oi,Gn,kn)})}},lr=(Gn,cr,Oi,kn)=>{if(Oi.iconsPending||Oi.patternsPending)return;let wr=new r.fx(gn,Un,this.lut);for(let Fo in Ne){let Yo=Ne[Fo];if(Fo in Gn)r.fy(Yo,Gn[Fo],this.showCollisionBoxes,se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gn,wr);else if(Yo.hasPattern&&(Yo instanceof r.ba||Yo instanceof r.bb||Yo instanceof r.ea)){Hi(Yo.layers,this.zoom,Xe.brightness,se,this.worldview);let Ts=Object.fromEntries(wr.patternPositions);Yo.addFeatures(Xe,this.tileID.canonical,Ts,se,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Ne).filter(Fo=>!Fo.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cr.image,lineAtlas:ut,imageAtlas:wr,brightness:Xe.brightness})};if(!this.extraShadowCaster){let Gn=r.fs(Xe.glyphDependencies,kn=>Object.keys(kn).map(Number));Object.keys(Gn).length?ve.send("getGlyphs",{uid:this.uid,stacks:Gn},(kn,wr)=>{bn||(bn=kn,yn=wr,Zr())},void 0,!1,br):yn={};let cr=Array.from(Xe.iconDependencies.keys()).map(kn=>r.I.parse(kn));cr.length?ve.send("getImages",{images:cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(kn,wr)=>{bn||(bn=kn,gn=new Map,mr=this.updateImageMapAndGetImageTaskQueue(gn,wr,Xe.iconDependencies),Zr())},void 0,!1,br):(gn=new Map,mr=new Map);let Oi=Array.from(Xe.patternDependencies.keys()).map(kn=>r.I.parse(kn));Oi.length?ve.send("getImages",{images:Oi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(kn,wr)=>{bn||(bn=kn,Un=new Map,Ur=this.updateImageMapAndGetImageTaskQueue(Un,wr,Xe.patternDependencies),Zr())},void 0,!1,br):(Un=new Map,Ur=new Map)}if(Xe.elevationFeatures&&Xe.elevationFeatures.length>0){let Gn=[];for(let Oi of Object.values(Ne))if(Oi instanceof r.bb){let kn=Oi.getUnevaluatedPortalGraph();kn&&Gn.push(kn)}let cr=r.ft.evaluate(Gn);for(let Oi of Object.values(Ne))if(Oi instanceof r.bb){let kn=G.layers[ze.decode(Oi.sourceLayerIndex)];Oi.setEvaluatedPortalGraph(cr,kn,this.tileID.canonical,Xe.availableImages,Xe.brightness)}}Zr()};Ft.length>0?Promise.allSettled(Ft).then(Pt).catch(Ie):Pt()}updateParameters(G){this.scaleFactor=G.scaleFactor,this.showCollisionBoxes=G.showCollisionBoxes,this.projection=G.projection,this.brightness=G.brightness,this.tileTransform=r.aZ(G.tileID.canonical,G.projection),this.extraShadowCaster=G.extraShadowCaster,this.lut=G.lut,this.worldview=G.worldview,this.indoor=G.indoor}rasterizeIfNeeded(G,Q,se,xe){Array.from(Q.values()).some(ve=>ve.usvg)?this.rasterize(G,Q,se,xe):xe()}updateImageMapAndGetImageTaskQueue(G,Q,se){let xe=new Map;for(let ve of Q.keys()){let Ie=se.get(ve)||[];for(let ze of Ie){let Pe=ze.toString(),Ne=Q.get(ze.id.toString());Ne.usvg?xe.has(Pe)||(xe.set(Pe,ze),G.set(Pe,Object.assign({},Ne))):G.set(Pe,Ne)}}return xe}rasterize(G,Q,se,xe){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:se},(ve,Ie)=>{if(!ve)for(let[ze,Pe]of Ie.entries()){let Ne=Object.assign(Q.get(ze),{data:Pe});Q.set(ze,Ne)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Hi(Re,G,Q,se,xe){let ve=new r.ac(G,{brightness:Q,worldview:xe});for(let Ie of Re)Ie.recalculate(ve,se)}class Ni extends r.E{constructor(G,Q,se,xe,ve,Ie,ze){super(),this.actor=G,this.layerIndex=Q,this.availableImages=se,this.availableModels=xe,this.loadVectorData=Ie||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(G.scheduler),this.isSpriteLoaded=ve,this.scheduler=G.scheduler,this.brightness=ze}loadTile(G,Q){let se=G.uid,xe=G&&G.request,ve=xe&&xe.collectResourceTiming,Ie=this.loading[se]=new sr(G);Ie.abort=this.loadVectorData(G,(ze,Pe)=>{let Ne=!this.loading[se];if(delete this.loading[se],Ie.cancelRasterize(),Ne||ze||!Pe)return Ie.status="done",Ne||(this.loaded[se]=Ie),Q(ze);let ut=Pe.rawData,Xe={},Ft=r.aM(Pe.responseHeaders);Ft&&Ft.expires&&(Xe.expires=Ft.expires),Ft&&Ft.cacheControl&&(Xe.cacheControl=Ft.cacheControl),Ie.vectorTile=Pe.vectorTile||new r.fz(new r.bt(ut));let Qt=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Pt,bn)=>{if(Pt||!bn)return Q(Pt);let yn={};if(ve){let gn=C(xe);gn.length>0&&(yn.resourceTiming=JSON.parse(JSON.stringify(gn)))}Q(null,Object.assign({rawTileData:ut.slice(0),responseHeaders:Pe.responseHeaders},bn,Xe,yn))})};this.isSpriteLoaded?Qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Qt()}),this.loaded=this.loaded||{},this.loaded[se]=Ie})}reloadTile(G,Q){let se=this.loaded,xe=G.uid;if(se&&se[xe]){let ve=se[xe];ve.updateParameters(G);let Ie=(ze,Pe)=>{let Ne=ve.reloadCallback;Ne&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ne)),Q(ze,Pe)};ve.status==="parsing"?ve.reloadCallback=Ie:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else Q(null,void 0)}abortTile(G,Q){let se=G.uid,xe=this.loading[se];xe&&(xe.abort&&xe.abort(),delete this.loading[se]),Q()}removeTile(G,Q){let se=this.loaded,xe=G.uid;se&&se[xe]&&delete se[xe],Q()}}class Or{loadTile(G,Q){let{uid:se,encoding:xe,rawImageData:ve,padding:Ie}=G,ze=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Ie):ve;Q(null,new r.fA(se,ze,xe,Ie<1))}reloadTile(G,Q){Q(null,null)}abortTile(G,Q){Q()}removeTile(G,Q){Q()}getImageData(G,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let se=this.offscreenCanvasContext.getImageData(-Q,-Q,G.width+2*Q,G.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}r.bs.setPbf(r.bt);class qo{constructor(G){this._mrt=new r.bs(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,Q){let se=this._mrt;this.status="parsing",this._entireBuffer=G;try{se.parseHeader(G),this._isHeaderLoaded=!0;let xe=[];for(let ve in se.layers){let Ie=se.getLayer(ve),ze=Ie.getDataRange(Ie.getBandList()),Pe=se.createDecodingTask(ze),Ne=G.slice(ze.firstByte,ze.lastByte+1),ut=r.bs.performDecoding(Ne,Pe).then(Xe=>Pe.complete(null,Xe)).catch(Xe=>Pe.complete(Xe,null));xe.push(ut)}Promise.allSettled(xe).then(()=>Q(null,se)).catch(ve=>Q(ve))}catch(xe){Q(xe)}}}class Ks{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,Q){let se=G.uid,xe=G.request,ve=this.loading[se]=new qo(G),{cancel:Ie}=r.bu(xe,(ze,Pe,Ne)=>{let ut=!this.loading[se];if(delete this.loading[se],ut||ze||!Pe)return ve.status="done",ut||(this.loaded[se]=ve),Q(ze);ve.parse(Pe,(Xe,Ft)=>{if(Xe||!Ft)return Q(Xe);Q(null,Ft,Ne)}),this.loaded[se]=ve});ve.abort=Ie}reloadTile(G,Q){Q(null,void 0)}abortTile(G,Q){let se=G.uid,xe=this.loading[se];xe&&(xe.abort&&xe.abort(),delete this.loading[se]),Q()}removeTile(G,Q){let se=G.uid;this.loaded[se]&&delete this.loaded[se],Q()}decodeRasterArray(G,Q){r.bs.performDecoding(G.buffer,G.task).then(se=>Q(null,se)).catch(se=>Q(se))}}let Vu=r.fB.prototype.toGeoJSON;class Uu{constructor(G){this._feature=G,this.extent=r.al,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){let G=[];for(let Q of this._feature.geometry)G.push([new r.P(Q[0],Q[1])]);return G}{let G=[];for(let Q of this._feature.geometry){let se=[];for(let xe of Q)se.push(new r.P(xe[0],xe[1]));G.push(se)}return G}}toGeoJSON(G,Q,se){return Vu.call(this,G,Q,se)}}class ci{constructor(G,Q){this.name=G,this.extent=r.al,this.length=Q.length,this._jsonFeatures=Q}feature(G){return new Uu(this._jsonFeatures[G])}}class ju{constructor(G){this.layers={},this.extent=r.al;for(let Q of Object.keys(G))this.layers[Q]=new ci(Q,G[Q])}}let xo=64/4096,xr=128;class Ji{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],Q){for(let se of G){let xe=se.id;if(xe==null)continue;let ve=this.features.get(xe);ve&&this.updateCache(ve,Q),se.geometry?(ve=dl(se),this.updateCache(ve,Q),this.features.set(xe,ve)):this.features.delete(xe),this.updateCache(ve,Q)}}updateCache(G,Q){for(let{canonical:se,uid:xe}of Object.values(Q)){let{z:ve,x:Ie,y:ze}=se;Wr(G,Math.pow(2,ve),Ie,ze)&&delete Q[xe]}}getTile(G,Q,se){let xe=Math.pow(2,G),ve=[];for(let Ie of this.features.values())Wr(Ie,xe,Q,se)&&ve.push(fr(Ie,xe,Q,se));return{features:ve}}getFeatures(){return[...this.features.values()]}}function Wr({minX:Re,minY:G,maxX:Q,maxY:se},xe,ve,Ie){return Re<(ve+1+xo)/xe&&G<(Ie+1+xo)/xe&&Q>(ve-xo)/xe&&se>(Ie-xo)/xe}function dl(Re){let{id:G,geometry:Q,properties:se}=Re;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:xe,coordinates:ve}=Q,Ie={id:G,type:1,geometry:[],tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ze=Ie.geometry;if(xe==="Point")Va(ve,ze,Ie);else if(xe==="MultiPoint")for(let Pe of ve)Va(Pe,ze,Ie);else if(xe==="LineString")Ie.type=2,hl(ve,ze,Ie);else if(xe==="MultiLineString")Ie.type=2,Ua(ve,ze,Ie);else if(xe==="Polygon")Ie.type=3,Ua(ve,ze,Ie,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(let Pe of ve)Ua(Pe,ze,Ie,!0)}return Ie}function Va([Re,G],Q,se){let xe=r.aF(Re),ve=r.aJ(G);ve=ve<0?0:ve>1?1:ve,Q.push(xe,ve),se.minX=Math.min(se.minX,xe),se.minY=Math.min(se.minY,ve),se.maxX=Math.max(se.maxX,xe),se.maxY=Math.max(se.maxY,ve)}function hl(Re,G,Q,se=!1,xe=!1){let ve=[];for(let Ie of Re)Va(Ie,ve,Q);G.push(ve),se&&(function(Ie,ze){let Pe=0;for(let Ne=0,ut=Ie.length,Xe=ut-2;Ne<ut;Xe=Ne,Ne+=2)Pe+=(Ie[Ne]-Ie[Xe])*(Ie[Ne+1]+Ie[Xe+1]);if(Pe>0===ze)for(let Ne=0,ut=Ie.length;Ne<ut/2;Ne+=2){let Xe=Ie[Ne],Ft=Ie[Ne+1];Ie[Ne]=Ie[ut-2-Ne],Ie[Ne+1]=Ie[ut-1-Ne],Ie[ut-2-Ne]=Xe,Ie[ut-1-Ne]=Ft}})(ve,xe)}function Ua(Re,G,Q,se=!1){for(let xe=0;xe<Re.length;xe++)hl(Re[xe],G,Q,se,xe===0)}function fr(Re,G,Q,se){let{id:xe,type:ve,geometry:Ie,tags:ze}=Re,Pe=[];if(ve===1)(function(Ne,ut,Xe,Ft,Qt){for(let Pt=0;Pt<Ne.length;Pt+=2){let bn=Math.round(r.al*(Ne[Pt+0]*ut-Xe)),yn=Math.round(r.al*(Ne[Pt+1]*ut-Ft));Qt.push([bn,yn])}})(Ie,G,Q,se,Pe);else if(ve===2)for(let Ne of Ie)Qs(Ne,G,Q,se,Pe);else if(ve===3)for(let Ne of Ie)om(Ne,G,Q,se,Pe);return{id:xe,type:ve,geometry:Pe,tags:ze}}function Qs(Re,G,Q,se,xe){let ve=-xr,Ie=r.al+xr,ze;for(let Pe=0;Pe<Re.length-2;Pe+=2){let Ne=Math.round(r.al*(Re[Pe+0]*G-Q)),ut=Math.round(r.al*(Re[Pe+1]*G-se)),Xe=Math.round(r.al*(Re[Pe+2]*G-Q)),Ft=Math.round(r.al*(Re[Pe+3]*G-se)),Qt=Xe-Ne,Pt=Ft-ut;Ne<ve&&Xe<ve||(Ne<ve?(ut+=Math.round(Pt*((ve-Ne)/Qt)),Ne=ve):Xe<ve&&(Ft=ut+Math.round(Pt*((ve-Ne)/Qt)),Xe=ve),ut<ve&&Ft<ve||(ut<ve?(Ne+=Math.round(Qt*((ve-ut)/Pt)),ut=ve):Ft<ve&&(Xe=Ne+Math.round(Qt*((ve-ut)/Pt)),Ft=ve),Ne>=Ie&&Xe>=Ie||(Ne>=Ie?(ut+=Math.round(Pt*((Ie-Ne)/Qt)),Ne=Ie):Xe>=Ie&&(Ft=ut+Math.round(Pt*((Ie-Ne)/Qt)),Xe=Ie),ut>=Ie&&Ft>=Ie||(ut>=Ie?(Ne+=Math.round(Qt*((Ie-ut)/Pt)),ut=Ie):Ft>=Ie&&(Xe=Ne+Math.round(Qt*((Ie-ut)/Pt)),Ft=Ie),ze&&Ne===ze[ze.length-1][0]&&ut===ze[ze.length-1][1]||(ze=[[Ne,ut]],xe.push(ze)),ze.push([Xe,Ft])))))}}function om(Re,G,Q,se,xe){let ve=(Q-xo)/G,Ie=(se-xo)/G,ze=(Q+1+xo)/G,Pe=(se+1+xo)/G;function Ne(Ft,Qt){let Pt=0;return Ft<ve?Pt|=1:Ft>ze&&(Pt|=2),Qt<Ie?Pt|=4:Qt>Pe&&(Pt|=8),Pt}let ut=[];for(let Ft=1;Ft<=8;Ft*=2){let Qt=Re[Re.length-2],Pt=Re[Re.length-1],bn=!(Ne(Qt,Pt)&Ft);for(let yn=0;yn<Re.length;yn+=2){let gn=Re[yn],Un=Re[yn+1],mr=!(Ne(gn,Un)&Ft);mr!==bn&&(8&Ft?ut.push(Qt+(gn-Qt)*(Pe-Pt)/(Un-Pt),Pe):4&Ft?ut.push(Qt+(gn-Qt)*(Ie-Pt)/(Un-Pt),Ie):2&Ft?ut.push(ze,Pt+(Un-Pt)*(ze-Qt)/(gn-Qt)):1&Ft&&ut.push(ve,Pt+(Un-Pt)*(ve-Qt)/(gn-Qt))),mr&&ut.push(gn,Un),Qt=gn,Pt=Un,bn=mr}if(!(Re=ut).length||Ft===8)break;ut=[]}let Xe=[];for(let Ft=0;Ft<ut.length;Ft+=2)Xe.push([Math.round(r.al*(ut[Ft]*G-Q)),Math.round(r.al*(ut[Ft+1]*G-se))]);xe.push(Xe)}function lp({name:Re,features:G},Q){Q.writeStringField(1,Re),Q.writeVarintField(5,r.al);let se=new Map,xe=new Map,ve={keys:se,values:xe,feature:null};for(let Ie of G)ve.feature=Ie,Q.writeMessage(2,sm,ve);for(let Ie of se.keys())Q.writeStringField(3,Ie);for(let Ie of xe.keys())Q.writeMessage(4,$u,Ie)}function sm(Re,G){let Q=Re.feature;Q.id!==void 0&&Number.isSafeInteger(+Q.id)&&G.writeVarintField(1,+Q.id),Q.tags&&G.writeMessage(2,Bc,Re),G.writeVarintField(3,Q.type),G.writeMessage(4,Wo,Q)}function Bc({keys:Re,values:G,feature:Q},se){for(let xe of Object.keys(Q.tags)){let ve=Q.tags[xe];if(ve===null)continue;let Ie=Re.get(xe);Ie===void 0&&(Ie=Re.size,Re.set(xe,Ie)),se.writeVarint(Ie);let ze=typeof ve;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(ve=JSON.stringify(ve));let Pe=G.get(ve);Pe===void 0&&(Pe=G.size,G.set(ve,Pe)),se.writeVarint(Pe)}}function Yi(Re,G){return(G<<3)+(7&Re)}function Ir(Re){return Re<<1^Re>>31}function Wo(Re,G){let{geometry:Q,type:se}=Re,xe=0,ve=0;if(se===1){G.writeVarint(Yi(1,Q.length));for(let Ie of Q){let ze=Ie[0]-xe,Pe=Ie[1]-ve;G.writeVarint(Ir(ze)),G.writeVarint(Ir(Pe)),xe+=ze,ve+=Pe}}else for(let Ie of Q){G.writeVarint(Yi(1,1));let ze=Ie.length-(se===3?1:0);for(let Pe=0;Pe<ze;Pe++){Pe===1&&G.writeVarint(Yi(2,ze-1));let Ne=Ie[Pe][0]-xe,ut=Ie[Pe][1]-ve;G.writeVarint(Ir(Ne)),G.writeVarint(Ir(ut)),xe+=Ne,ve+=ut}se===3&&G.writeVarint(Yi(7,1))}}function $u(Re,G){let Q=typeof Re;Q==="string"?G.writeStringField(1,Re):Q==="boolean"?G.writeBooleanField(7,Re):Q==="number"&&(Re%1!=0?G.writeDoubleField(3,Re):Re<0?G.writeSVarintField(6,Re):G.writeVarintField(5,Re))}let Fr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},Vc=Math.fround||(Uc=new Float32Array(1),Re=>(Uc[0]=+Re,Uc[0]));var Uc;let zs=3,rs=5,Vr=6;class T0{constructor(G){this.options=Object.assign(Object.create(Fr),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:Q,minZoom:se,maxZoom:xe}=this.options;Q&&console.time("total time");let ve=`prepare ${G.length} points`;Q&&console.time(ve),this.points=G;let Ie=[];for(let Pe=0;Pe<G.length;Pe++){let Ne=G[Pe];if(!Ne.geometry)continue;let[ut,Xe]=Ne.geometry.coordinates,Ft=Vc(jc(ut)),Qt=Vc($c(Xe));Ie.push(Ft,Qt,1/0,Pe,-1,1),this.options.reduce&&Ie.push(0)}let ze=this.trees[xe+1]=this._createTree(Ie);Q&&console.timeEnd(ve);for(let Pe=xe;Pe>=se;Pe--){let Ne=+Date.now();ze=this.trees[Pe]=this._createTree(this._cluster(ze,Pe)),Q&&console.log("z%d: %d clusters in %dms",Pe,ze.numItems,+Date.now()-Ne)}return Q&&console.timeEnd("total time"),this}getClusters(G,Q){let se=((G[0]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,G[1])),ve=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)se=-180,ve=180;else if(se>ve){let Xe=this.getClusters([se,xe,180,Ie],Q),Ft=this.getClusters([-180,xe,ve,Ie],Q);return Xe.concat(Ft)}let ze=this.trees[this._limitZoom(Q)],Pe=ze.range(jc(se),$c(Ie),jc(ve),$c(xe)),Ne=ze.data,ut=[];for(let Xe of Pe){let Ft=this.stride*Xe;ut.push(Ne[Ft+rs]>1?Gd(Ne,Ft,this.clusterProps):this.points[Ne[Ft+zs]])}return ut}getChildren(G){let Q=this._getOriginId(G),se=this._getOriginZoom(G),xe="No cluster with the specified id.",ve=this.trees[se];if(!ve)throw new Error(xe);let Ie=ve.data;if(Q*this.stride>=Ie.length)throw new Error(xe);let ze=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Pe=ve.within(Ie[Q*this.stride],Ie[Q*this.stride+1],ze),Ne=[];for(let ut of Pe){let Xe=ut*this.stride;Ie[Xe+4]===G&&Ne.push(Ie[Xe+rs]>1?Gd(Ie,Xe,this.clusterProps):this.points[Ie[Xe+zs]])}if(Ne.length===0)throw new Error(xe);return Ne}getLeaves(G,Q,se){let xe=[];return this._appendLeaves(xe,G,Q=Q||10,se=se||0,0),xe}getTile(G,Q,se){let xe=this.trees[this._limitZoom(G)],ve=Math.pow(2,G),{extent:Ie,radius:ze}=this.options,Pe=ze/Ie,Ne=(se-Pe)/ve,ut=(se+1+Pe)/ve,Xe={features:[]};return this._addTileFeatures(xe.range((Q-Pe)/ve,Ne,(Q+1+Pe)/ve,ut),xe.data,Q,se,ve,Xe),Q===0&&this._addTileFeatures(xe.range(1-Pe/ve,Ne,1,ut),xe.data,ve,se,ve,Xe),Q===ve-1&&this._addTileFeatures(xe.range(0,Ne,Pe/ve,ut),xe.data,-1,se,ve,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(G){let Q=this._getOriginZoom(G)-1;for(;Q<=this.options.maxZoom;){let se=this.getChildren(G);if(Q++,se.length!==1)break;G=se[0].properties.cluster_id}return Q}_appendLeaves(G,Q,se,xe,ve){let Ie=this.getChildren(Q);for(let ze of Ie){let Pe=ze.properties;if(Pe&&Pe.cluster?ve+Pe.point_count<=xe?ve+=Pe.point_count:ve=this._appendLeaves(G,Pe.cluster_id,se,xe,ve):ve<xe?ve++:G.push(ze),G.length===se)break}return ve}_createTree(G){let Q=new r.c4(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<G.length;se+=this.stride)Q.add(G[se],G[se+1]);return Q.finish(),Q.data=G,Q}_addTileFeatures(G,Q,se,xe,ve,Ie){for(let ze of G){let Pe=ze*this.stride,Ne=Q[Pe+rs]>1,ut,Xe,Ft;if(Ne)ut=Hu(Q,Pe,this.clusterProps),Xe=Q[Pe],Ft=Q[Pe+1];else{let bn=this.points[Q[Pe+zs]];ut=bn.properties;let[yn,gn]=bn.geometry.coordinates;Xe=jc(yn),Ft=$c(gn)}let Qt={type:1,geometry:[[Math.round(this.options.extent*(Xe*ve-se)),Math.round(this.options.extent*(Ft*ve-xe))]],tags:ut},Pt;Pt=Ne||this.options.generateId?Q[Pe+zs]:this.points[Q[Pe+zs]].id,Pt!==void 0&&(Qt.id=Pt),Ie.features.push(Qt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,Q){let{radius:se,extent:xe,reduce:ve,minPoints:Ie}=this.options,ze=se/(xe*Math.pow(2,Q)),Pe=G.data,Ne=[],ut=this.stride;for(let Xe=0;Xe<Pe.length;Xe+=ut){if(Pe[Xe+2]<=Q)continue;Pe[Xe+2]=Q;let Ft=Pe[Xe],Qt=Pe[Xe+1],Pt=G.within(Pe[Xe],Pe[Xe+1],ze),bn=Pe[Xe+rs],yn=bn;for(let gn of Pt){let Un=gn*ut;Pe[Un+2]>Q&&(yn+=Pe[Un+rs])}if(yn>bn&&yn>=Ie){let gn,Un=Ft*bn,mr=Qt*bn,Ur=-1,br=(Xe/ut<<5)+(Q+1)+this.points.length;for(let Zr of Pt){let lr=Zr*ut;if(Pe[lr+2]<=Q)continue;Pe[lr+2]=Q;let Gn=Pe[lr+rs];Un+=Pe[lr]*Gn,mr+=Pe[lr+1]*Gn,Pe[lr+4]=br,ve&&(gn||(gn=this._map(Pe,Xe,!0),Ur=this.clusterProps.length,this.clusterProps.push(gn)),ve(gn,this._map(Pe,lr)))}Pe[Xe+4]=br,Ne.push(Un/yn,mr/yn,1/0,br,-1,yn),ve&&Ne.push(Ur)}else{for(let gn=0;gn<ut;gn++)Ne.push(Pe[Xe+gn]);if(yn>1)for(let gn of Pt){let Un=gn*ut;if(!(Pe[Un+2]<=Q)){Pe[Un+2]=Q;for(let mr=0;mr<ut;mr++)Ne.push(Pe[Un+mr])}}}}return Ne}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,Q,se){if(G[Q+rs]>1){let Ie=this.clusterProps[G[Q+Vr]];return se?Object.assign({},Ie):Ie}let xe=this.points[G[Q+zs]].properties,ve=this.options.map(xe);return se&&ve===xe?Object.assign({},ve):ve}}function Gd(Re,G,Q){return{type:"Feature",id:Re[G+zs],properties:Hu(Re,G,Q),geometry:{type:"Point",coordinates:[(se=Re[G],360*(se-.5)),Zo(Re[G+1])]}};var se}function Hu(Re,G,Q){let se=Re[G+rs],xe=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,ve=Re[G+Vr],Ie=ve===-1?{}:Object.assign({},Q[ve]);return Object.assign(Ie,{cluster:!0,cluster_id:Re[G+zs],point_count:se,point_count_abbreviated:xe})}function jc(Re){return Re/360+.5}function $c(Re){let G=Math.sin(Re*Math.PI/180),Q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Q<0?0:Q>1?1:Q}function Zo(Re){let G=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Zl(Re,G,Q,se){let xe=se,ve=G+(Q-G>>1),Ie,ze=Q-G,Pe=Re[G],Ne=Re[G+1],ut=Re[Q],Xe=Re[Q+1];for(let Ft=G+3;Ft<Q;Ft+=3){let Qt=qd(Re[Ft],Re[Ft+1],Pe,Ne,ut,Xe);if(Qt>xe)Ie=Ft,xe=Qt;else if(Qt===xe){let Pt=Math.abs(Ft-ve);Pt<ze&&(Ie=Ft,ze=Pt)}}xe>se&&(Ie-G>3&&Zl(Re,G,Ie,se),Re[Ie+2]=xe,Q-Ie>3&&Zl(Re,Ie,Q,se))}function qd(Re,G,Q,se,xe,ve){let Ie=xe-Q,ze=ve-se;if(Ie!==0||ze!==0){let Pe=((Re-Q)*Ie+(G-se)*ze)/(Ie*Ie+ze*ze);Pe>1?(Q=xe,se=ve):Pe>0&&(Q+=Ie*Pe,se+=ze*Pe)}return Ie=Re-Q,ze=G-se,Ie*Ie+ze*ze}function ja(Re,G,Q,se){let xe={id:Re??null,type:G,geometry:Q,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")Yl(xe,Q);else if(G==="Polygon")Yl(xe,Q[0]);else if(G==="MultiLineString")for(let ve of Q)Yl(xe,ve);else if(G==="MultiPolygon")for(let ve of Q)Yl(xe,ve[0]);return xe}function Yl(Re,G){for(let Q=0;Q<G.length;Q+=3)Re.minX=Math.min(Re.minX,G[Q]),Re.minY=Math.min(Re.minY,G[Q+1]),Re.maxX=Math.max(Re.maxX,G[Q]),Re.maxY=Math.max(Re.maxY,G[Q+1])}function ds(Re,G,Q,se){if(!G.geometry)return;let xe=G.geometry.coordinates;if(xe&&xe.length===0)return;let ve=G.geometry.type,Ie=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),ze=[],Pe=G.id;if(Q.promoteId?Pe=G.properties[Q.promoteId]:Q.generateId&&(Pe=se||0),ve==="Point")Gu(xe,ze);else if(ve==="MultiPoint")for(let Ne of xe)Gu(Ne,ze);else if(ve==="LineString")qu(xe,ze,Ie,!1);else if(ve==="MultiLineString"){if(Q.lineMetrics){for(let Ne of xe)ze=[],qu(Ne,ze,Ie,!1),Re.push(ja(Pe,"LineString",ze,G.properties));return}Wu(xe,ze,Ie,!1)}else if(ve==="Polygon")Wu(xe,ze,Ie,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(let Ne of G.geometry.geometries)ds(Re,{id:Pe,geometry:Ne,properties:G.properties},Q,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ne of xe){let ut=[];Wu(Ne,ut,Ie,!0),ze.push(ut)}}Re.push(ja(Pe,ve,ze,G.properties))}function Gu(Re,G){G.push(Wd(Re[0]),bo(Re[1]),0)}function qu(Re,G,Q,se){let xe,ve,Ie=0;for(let Pe=0;Pe<Re.length;Pe++){let Ne=Wd(Re[Pe][0]),ut=bo(Re[Pe][1]);G.push(Ne,ut,0),Pe>0&&(Ie+=se?(xe*ut-Ne*ve)/2:Math.sqrt(Math.pow(Ne-xe,2)+Math.pow(ut-ve,2))),xe=Ne,ve=ut}let ze=G.length-3;G[2]=1,Zl(G,0,ze,Q),G[ze+2]=1,G.size=Math.abs(Ie),G.start=0,G.end=G.size}function Wu(Re,G,Q,se){for(let xe=0;xe<Re.length;xe++){let ve=[];qu(Re[xe],ve,Q,se),G.push(ve)}}function Wd(Re){return Re/360+.5}function bo(Re){let G=Math.sin(Re*Math.PI/180),Q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Q<0?0:Q>1?1:Q}function Ss(Re,G,Q,se,xe,ve,Ie,ze){if(se/=G,ve>=(Q/=G)&&Ie<se)return Re;if(Ie<Q||ve>=se)return null;let Pe=[];for(let Ne of Re){let ut=Ne.geometry,Xe=Ne.type,Ft=xe===0?Ne.minX:Ne.minY,Qt=xe===0?Ne.maxX:Ne.maxY;if(Ft>=Q&&Qt<se){Pe.push(Ne);continue}if(Qt<Q||Ft>=se)continue;let Pt=[];if(Xe==="Point"||Xe==="MultiPoint")cp(ut,Pt,Q,se,xe);else if(Xe==="LineString")Hc(ut,Pt,Q,se,xe,!1,ze.lineMetrics);else if(Xe==="MultiLineString")Xl(ut,Pt,Q,se,xe,!1);else if(Xe==="Polygon")Xl(ut,Pt,Q,se,xe,!0);else if(Xe==="MultiPolygon")for(let bn of ut){let yn=[];Xl(bn,yn,Q,se,xe,!0),yn.length&&Pt.push(yn)}if(Pt.length){if(ze.lineMetrics&&Xe==="LineString"){for(let bn of Pt)Pe.push(ja(Ne.id,Xe,bn,Ne.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Pt.length===1?(Xe="LineString",Pt=Pt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Pt.length===3?"Point":"MultiPoint"),Pe.push(ja(Ne.id,Xe,Pt,Ne.tags))}}return Pe.length?Pe:null}function cp(Re,G,Q,se,xe){for(let ve=0;ve<Re.length;ve+=3){let Ie=Re[ve+xe];Ie>=Q&&Ie<=se&&$a(G,Re[ve],Re[ve+1],Re[ve+2])}}function Hc(Re,G,Q,se,xe,ve,Ie){let ze=pl(Re),Pe=xe===0?up:Zu,Ne,ut,Xe=Re.start;for(let yn=0;yn<Re.length-3;yn+=3){let gn=Re[yn],Un=Re[yn+1],mr=Re[yn+2],Ur=Re[yn+3],br=Re[yn+4],Zr=xe===0?gn:Un,lr=xe===0?Ur:br,Gn=!1;Ie&&(Ne=Math.sqrt(Math.pow(gn-Ur,2)+Math.pow(Un-br,2))),Zr<Q?lr>Q&&(ut=Pe(ze,gn,Un,Ur,br,Q),Ie&&(ze.start=Xe+Ne*ut)):Zr>se?lr<se&&(ut=Pe(ze,gn,Un,Ur,br,se),Ie&&(ze.start=Xe+Ne*ut)):$a(ze,gn,Un,mr),lr<Q&&Zr>=Q&&(ut=Pe(ze,gn,Un,Ur,br,Q),Gn=!0),lr>se&&Zr<=se&&(ut=Pe(ze,gn,Un,Ur,br,se),Gn=!0),!ve&&Gn&&(Ie&&(ze.end=Xe+Ne*ut),G.push(ze),ze=pl(Re)),Ie&&(Xe+=Ne)}let Ft=Re.length-3,Qt=Re[Ft],Pt=Re[Ft+1],bn=xe===0?Qt:Pt;bn>=Q&&bn<=se&&$a(ze,Qt,Pt,Re[Ft+2]),Ft=ze.length-3,ve&&Ft>=3&&(ze[Ft]!==ze[0]||ze[Ft+1]!==ze[1])&&$a(ze,ze[0],ze[1],ze[2]),ze.length&&G.push(ze)}function pl(Re){let G=[];return G.size=Re.size,G.start=Re.start,G.end=Re.end,G}function Xl(Re,G,Q,se,xe,ve){for(let Ie of Re)Hc(Ie,G,Q,se,xe,ve,!1)}function $a(Re,G,Q,se){Re.push(G,Q,se)}function up(Re,G,Q,se,xe,ve){let Ie=(ve-G)/(se-G);return $a(Re,ve,Q+(xe-Q)*Ie,1),Ie}function Zu(Re,G,Q,se,xe,ve){let Ie=(ve-Q)/(xe-Q);return $a(Re,G+(se-G)*Ie,ve,1),Ie}function ar(Re,G){let Q=[];for(let se=0;se<Re.length;se++){let xe=Re[se],ve=xe.type,Ie;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ie=Mo(xe.geometry,G);else if(ve==="MultiLineString"||ve==="Polygon"){Ie=[];for(let ze of xe.geometry)Ie.push(Mo(ze,G))}else if(ve==="MultiPolygon"){Ie=[];for(let ze of xe.geometry){let Pe=[];for(let Ne of ze)Pe.push(Mo(Ne,G));Ie.push(Pe)}}Q.push(ja(xe.id,ve,Ie,xe.tags))}return Q}function Mo(Re,G){let Q=[];Q.size=Re.size,Re.start!==void 0&&(Q.start=Re.start,Q.end=Re.end);for(let se=0;se<Re.length;se+=3)Q.push(Re[se]+G,Re[se+1],Re[se+2]);return Q}function am(Re,G){if(Re.transformed)return Re;let Q=1<<Re.z,se=Re.x,xe=Re.y;for(let ve of Re.features){let Ie=ve.geometry,ze=ve.type;if(ve.geometry=[],ze===1)for(let Pe=0;Pe<Ie.length;Pe+=2)ve.geometry.push(Yu(Ie[Pe],Ie[Pe+1],G,Q,se,xe));else for(let Pe=0;Pe<Ie.length;Pe++){let Ne=[];for(let ut=0;ut<Ie[Pe].length;ut+=2)Ne.push(Yu(Ie[Pe][ut],Ie[Pe][ut+1],G,Q,se,xe));ve.geometry.push(Ne)}}return Re.transformed=!0,Re}function Yu(Re,G,Q,se,xe,ve){return[Math.round(Q*(Re*se-xe)),Math.round(Q*(G*se-ve))]}function Ha(Re,G,Q,se,xe){let ve=G===xe.maxZoom?0:xe.tolerance/((1<<G)*xe.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:Q,y:se,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ze of Re)lm(Ie,ze,ve,xe);return Ie}function lm(Re,G,Q,se){let xe=G.geometry,ve=G.type,Ie=[];if(Re.minX=Math.min(Re.minX,G.minX),Re.minY=Math.min(Re.minY,G.minY),Re.maxX=Math.max(Re.maxX,G.maxX),Re.maxY=Math.max(Re.maxY,G.maxY),ve==="Point"||ve==="MultiPoint")for(let ze=0;ze<xe.length;ze+=3)Ie.push(xe[ze],xe[ze+1]),Re.numPoints++,Re.numSimplified++;else if(ve==="LineString")st(Ie,xe,Re,Q,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let ze=0;ze<xe.length;ze++)st(Ie,xe[ze],Re,Q,ve==="Polygon",ze===0);else if(ve==="MultiPolygon")for(let ze=0;ze<xe.length;ze++){let Pe=xe[ze];for(let Ne=0;Ne<Pe.length;Ne++)st(Ie,Pe[Ne],Re,Q,!0,Ne===0)}if(Ie.length){let ze=G.tags||null;if(ve==="LineString"&&se.lineMetrics){ze={};for(let Ne in G.tags)ze[Ne]=G.tags[Ne];ze.mapbox_clip_start=xe.start/xe.size,ze.mapbox_clip_end=xe.end/xe.size}let Pe={geometry:Ie,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:ze};G.id!==null&&(Pe.id=G.id),Re.features.push(Pe)}}function st(Re,G,Q,se,xe,ve){let Ie=se*se;if(se>0&&G.size<(xe?Ie:se))return void(Q.numPoints+=G.length/3);let ze=[];for(let Pe=0;Pe<G.length;Pe+=3)(se===0||G[Pe+2]>Ie)&&(Q.numSimplified++,ze.push(G[Pe],G[Pe+1])),Q.numPoints++;xe&&(function(Pe,Ne){let ut=0;for(let Xe=0,Ft=Pe.length,Qt=Ft-2;Xe<Ft;Qt=Xe,Xe+=2)ut+=(Pe[Xe]-Pe[Qt])*(Pe[Xe+1]+Pe[Qt+1]);if(ut>0===Ne)for(let Xe=0,Ft=Pe.length;Xe<Ft/2;Xe+=2){let Qt=Pe[Xe],Pt=Pe[Xe+1];Pe[Xe]=Pe[Ft-2-Xe],Pe[Xe+1]=Pe[Ft-1-Xe],Pe[Ft-2-Xe]=Qt,Pe[Ft-1-Xe]=Pt}})(ze,ve),Re.push(ze)}let Kl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class I0{constructor(G,Q){let se=(Q=this.options=(function(ve,Ie){for(let ze in Ie)ve[ze]=Ie[ze];return ve})(Object.create(Kl),Q)).debug;if(se&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(ve,Ie){let ze=[];if(ve.type==="FeatureCollection")for(let Pe=0;Pe<ve.features.length;Pe++)ds(ze,ve.features[Pe],Ie,Pe);else ds(ze,ve.type==="Feature"?ve:{geometry:ve},Ie);return ze})(G,Q);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(ve,Ie){let ze=Ie.buffer/Ie.extent,Pe=ve,Ne=Ss(ve,1,-1-ze,ze,0,-1,2,Ie),ut=Ss(ve,1,1-ze,2+ze,0,-1,2,Ie);return(Ne||ut)&&(Pe=Ss(ve,1,-ze,1+ze,0,-1,2,Ie)||[],Ne&&(Pe=ar(Ne,1).concat(Pe)),ut&&(Pe=Pe.concat(ar(ut,-1)))),Pe})(xe,Q),xe.length&&this.splitTile(xe,0,0,0),se&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,Q,se,xe,ve,Ie,ze){let Pe=[G,Q,se,xe],Ne=this.options,ut=Ne.debug;for(;Pe.length;){xe=Pe.pop(),se=Pe.pop(),Q=Pe.pop(),G=Pe.pop();let Xe=1<<Q,Ft=Xu(Q,se,xe),Qt=this.tiles[Ft];if(!Qt&&(ut>1&&console.time("creation"),Qt=this.tiles[Ft]=Ha(G,Q,se,xe,Ne),this.tileCoords.push({z:Q,x:se,y:xe}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,se,xe,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));let Gn=`z${Q}`;this.stats[Gn]=(this.stats[Gn]||0)+1,this.total++}if(Qt.source=G,ve==null){if(Q===Ne.indexMaxZoom||Qt.numPoints<=Ne.indexMaxPoints)continue}else{if(Q===Ne.maxZoom||Q===ve)continue;if(ve!=null){let Gn=ve-Q;if(se!==Ie>>Gn||xe!==ze>>Gn)continue}}if(Qt.source=null,G.length===0)continue;ut>1&&console.time("clipping");let Pt=.5*Ne.buffer/Ne.extent,bn=.5-Pt,yn=.5+Pt,gn=1+Pt,Un=null,mr=null,Ur=null,br=null,Zr=Ss(G,Xe,se-Pt,se+yn,0,Qt.minX,Qt.maxX,Ne),lr=Ss(G,Xe,se+bn,se+gn,0,Qt.minX,Qt.maxX,Ne);G=null,Zr&&(Un=Ss(Zr,Xe,xe-Pt,xe+yn,1,Qt.minY,Qt.maxY,Ne),mr=Ss(Zr,Xe,xe+bn,xe+gn,1,Qt.minY,Qt.maxY,Ne),Zr=null),lr&&(Ur=Ss(lr,Xe,xe-Pt,xe+yn,1,Qt.minY,Qt.maxY,Ne),br=Ss(lr,Xe,xe+bn,xe+gn,1,Qt.minY,Qt.maxY,Ne),lr=null),ut>1&&console.timeEnd("clipping"),Pe.push(Un||[],Q+1,2*se,2*xe),Pe.push(mr||[],Q+1,2*se,2*xe+1),Pe.push(Ur||[],Q+1,2*se+1,2*xe),Pe.push(br||[],Q+1,2*se+1,2*xe+1)}}getTile(G,Q,se){G=+G,Q=+Q,se=+se;let xe=this.options,{extent:ve,debug:Ie}=xe;if(G<0||G>24)return null;let ze=1<<G,Pe=Xu(G,Q=Q+ze&ze-1,se);if(this.tiles[Pe])return am(this.tiles[Pe],ve);Ie>1&&console.log("drilling down to z%d-%d-%d",G,Q,se);let Ne,ut=G,Xe=Q,Ft=se;for(;!Ne&&ut>0;)ut--,Xe>>=1,Ft>>=1,Ne=this.tiles[Xu(ut,Xe,Ft)];return Ne&&Ne.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",ut,Xe,Ft),console.time("drilling down")),this.splitTile(Ne.source,ut,Xe,Ft,G,Q,se),Ie>1&&console.timeEnd("drilling down"),this.tiles[Pe]?am(this.tiles[Pe],ve):null):null}}function Xu(Re,G,Q){return 32*((1<<Re)*Q+G)+Re}function Zn(Re,G){let Q=Re.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);let se=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!se)return void G(null,null);let xe=Ne=>Ne.tags&&"3d_elevation_id"in Ne.tags&&"source"in Ne.tags&&Ne.tags.source==="elevation",ve=se.features.filter(Ne=>xe(Ne)),Ie={_geojsonTileLayer:se.features};ve.length>0&&(Ie={_geojsonTileLayer:se.features.filter(Ne=>!xe(Ne)),hd_road_elevation:ve});let ze=new ju(Ie),Pe=(function(Ne){let ut=new r.bt;for(let Xe of Object.keys(Ne))ut.writeMessage(3,lp,{name:Xe,features:Ne[Xe]});return ut.finish()})(Ie).buffer;G(null,{vectorTile:ze,rawData:Pe})}class os extends Ni{constructor(G,Q,se,xe,ve,Ie,ze){super(G,Q,se,xe,ve,Zn,ze),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new Ji}loadData(G,Q){let se=G&&G.request,xe=se&&se.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(G,(ve,Ie)=>{if(ve||!Ie)return Q(ve);if(typeof Ie!="object")return Q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Pe=r.U(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Ne=>`${Ne.key}: ${Ne.message}`).join(", "));Ie.features=Ie.features.filter(Ne=>Pe.value.evaluate({zoom:0},Ne))}G.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),G.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new T0((function({superclusterOptions:Pe,clusterProperties:Ne}){if(!Ne||!Pe)return Pe;let ut={},Xe={},Ft={accumulated:null,zoom:0},Qt={properties:null},Pt=Object.keys(Ne);for(let bn of Pt){let[yn,gn]=Ne[bn],Un=r.U(gn),mr=r.U(typeof yn=="string"?[yn,["accumulated"],["get",bn]]:yn);ut[bn]=Un.value,Xe[bn]=mr.value}return Pe.map=bn=>{Qt.properties=bn;let yn={};for(let gn of Pt)yn[gn]=ut[gn].evaluate(Ft,Qt);return yn},Pe.reduce=(bn,yn)=>{Qt.properties=yn;for(let gn of Pt)Ft.accumulated=bn[gn],bn[gn]=Xe[gn].evaluate(Ft,Qt)},Pe})(G)).load(Ie.features):G.dynamic?this._dynamicIndex:(function(Pe,Ne){return new I0(Pe,Ne)})(Ie,G.geojsonVtOptions)}catch(Pe){return Q(Pe)}let ze={};if(xe){let Pe=C(se);Pe&&(ze.resourceTiming={},ze.resourceTiming[G.source]=JSON.parse(JSON.stringify(Pe)))}Q(null,ze)}})}reloadTile(G,Q){let se=this.loaded;return se&&se[G.uid]?G.partial?Q(null,void 0):super.reloadTile(G,Q):this.loadTile(G,Q)}loadGeoJSON(G,Q){if(G.request)r.m(G.request,Q);else{if(typeof G.data!="string")return Q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Q(null,JSON.parse(G.data))}catch{return Q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(G,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(se){Q(se)}}getClusterChildren(G,Q){try{Q(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(se){Q(se)}}getClusterLeaves(G,Q){try{Q(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(se){Q(se)}}}class M0{constructor(G,Q,se){this.tileID=new r.aQ(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=Q,this.worldview=se}parse(G,Q,se,xe){this.status="parsing";let ve=new r.aQ(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),Ie=[],ze=Q.familiesBySource[se.source],Pe=new r.fn(ve,se.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,r.fC(G).then(Ne=>{if(!Ne)return xe(new Error("Could not parse tile"));let ut=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ne.json.asset.extras&&Ne.json.asset.extras.MAPBOX_mesh_features,Xe=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("EXT_meshopt_compression"),Ft=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(let Qt in ze)for(let Pt of ze[Qt]){let bn=Pt[0];Pe.bucketLayerIDs.push(Pt.map(Un=>r.B(Un.id,Un.scope))),bn.recalculate(Ft,[]);let yn=r.fD(Ne,1/r.d7(se.tileID.canonical)),gn=new r.fE(Pt,yn,ve,ut,Xe,this.brightness,Pe,this.worldview);ut||(gn.needsUpload=!0),Ie.push(gn),gn.evaluate(bn)}this.status="done",xe(null,{buckets:Ie,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ne=>xe(new Error(Ne.message)))}}class Ku{constructor(G,Q,se,xe,ve,Ie,ze,Pe){this.actor=G,this.layerIndex=Q,this.availableImages=se,this.availableModels=xe,this.brightness=ze,this.loading={},this.loaded={},this.worldview=Pe}loadTile(G,Q){let se=G.uid,xe=this.loading[se]=new M0(G,this.brightness,this.worldview);r.bu(G.request,(ve,Ie)=>{let ze=!this.loading[se];return delete this.loading[se],ze||ve?(xe.status="done",ze||(this.loaded[se]=xe),Q(ve)):Ie&&Ie.byteLength!==0?void xe.parse(Ie,this.layerIndex,G,(Pe,Ne)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[se]=xe,Pe||!Ne?Q(Pe):Q(null,Ne)}):(xe.status="done",this.loaded[se]=xe,Q())})}reloadTile(G,Q){let se=this.loaded,xe=G.uid;if(se&&se[xe]){let ve=se[xe];ve.projection=G.projection,ve.brightness=G.brightness;let Ie=(ze,Pe)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(G,Q)),Q(ze,Pe)};ve.status==="parsing"?ve.reloadCallback=Ie:ve.status==="done"&&this.loadTile(G,Q)}}abortTile(G,Q){let se=G.uid;this.loading[se]&&delete this.loading[se],Q()}removeTile(G,Q){let se=this.loaded,xe=G.uid;se&&se[xe]&&delete se[xe],Q()}}class dp{constructor(G){this.self=G,this.actor=new r.fG(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cm({name:"mercator"}),this.workerSourceTypes={vector:Ni,geojson:os,"raster-dem":Or,"raster-array":Ks,"batched-model":Ku},this.workerSources={},this.self.registerWorkerSource=(Q,se)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=se},this.self.registerRTLTextPlugin=Q=>{if(r.fH.isParsed())throw new Error("RTL text plugin already registered.");r.fH.setState({pluginStatus:r.fI.parsed,pluginURL:r.fH.getPluginURL()}),r.fH.applyArabicShaping=Q.applyArabicShaping,r.fH.processBidirectionalText=Q.processBidirectionalText,r.fH.processStyledBidirectionalText=Q.processStyledBidirectionalText;for(let se of this.rtlPluginParsingListeners)se(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(G,Q,se){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],se()}checkIfReady(G,Q,se){se()}setReferrer(G,Q){this.referrer=Q}spriteLoaded(G,Q){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});let{scope:se,isLoaded:xe}=Q;if(this.isSpriteLoaded[G][se]=xe,this.workerSources[G]&&this.workerSources[G][se])for(let ve in this.workerSources[G][se]){let Ie=this.workerSources[G][se][ve];for(let ze in Ie){let Pe=Ie[ze];Pe instanceof Ni&&(Pe.isSpriteLoaded=xe,Pe.fire(new r.z("isSpriteLoaded")))}}}setImages(G,Q,se){this.availableImages[G]||(this.availableImages[G]={});let{scope:xe,images:ve}=Q;if(this.availableImages[G][xe]=ve,this.workerSources[G]&&this.workerSources[G][xe]){for(let Ie in this.workerSources[G][xe]){let ze=this.workerSources[G][xe][Ie];for(let Pe in ze)ze[Pe].availableImages=ve}se()}else se()}setModels(G,{scope:Q,models:se},xe){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][Q]=se,this.workerSources[G]&&this.workerSources[G][Q]){for(let ve in this.workerSources[G][Q]){let Ie=this.workerSources[G][Q][ve];for(let ze in Ie)Ie[ze].availableModels=se}xe()}else xe()}setProjection(G,Q){this.projections[G]=r.cm(Q)}setBrightness(G,Q,se){this.brightness=Q,se()}setWorldview(G,Q,se){this.worldview=Q,se()}setLayers(G,Q,se){this.getLayerIndex(G,Q.scope).replace(Q.layers,Q.options),se()}updateLayers(G,Q,se){this.getLayerIndex(G,Q.scope).update(Q.layers,Q.removedIds,Q.options),se()}loadTile(G,Q,se){Q.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,Q.type,Q.source,Q.scope).loadTile(Q,se)}decodeRasterArray(G,Q,se){this.getWorkerSource(G,Q.type,Q.source,Q.scope).decodeRasterArray(Q,se)}reloadTile(G,Q,se){Q.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,Q.type,Q.source,Q.scope).reloadTile(Q,se)}abortTile(G,Q,se){this.getWorkerSource(G,Q.type,Q.source,Q.scope).abortTile(Q,se)}removeTile(G,Q,se){this.getWorkerSource(G,Q.type,Q.source,Q.scope).removeTile(Q,se)}removeSource(G,Q,se){if(!(this.workerSources[G]&&this.workerSources[G][Q.scope]&&this.workerSources[G][Q.scope][Q.type]&&this.workerSources[G][Q.scope][Q.type][Q.source]))return;let xe=this.workerSources[G][Q.scope][Q.type][Q.source];delete this.workerSources[G][Q.scope][Q.type][Q.source],xe.removeSource!==void 0?xe.removeSource(Q,se):se()}loadWorkerSource(G,Q,se){try{this.self.importScripts(Q.url),se()}catch(xe){se(xe)}}syncRTLPluginState(G,Q,se){if(r.fH.isParsed())se(null,!0);else if(r.fH.isParsing())this.rtlPluginParsingListeners.push(se);else try{r.fH.setState(Q);let xe=r.fH.getPluginURL();!r.fH.isLoaded()||r.fH.isParsed()||r.fH.isParsing()||xe==null||(r.fH.setState({pluginStatus:r.fI.parsing,pluginURL:r.fH.getPluginURL()}),this.self.importScripts(xe),r.fH.isParsed()?se(null,!0):this.rtlPluginParsingListeners.push(se))}catch(xe){se(xe)}}setDracoUrl(G,Q){this.dracoUrl=Q}getAvailableImages(G,Q){this.availableImages[G]||(this.availableImages[G]={});let se=this.availableImages[G][Q];return se||(se=[]),se}getAvailableModels(G,Q){this.availableModels[G]||(this.availableModels[G]={});let se=this.availableModels[G][Q];return se||(se={}),se}getLayerIndex(G,Q){this.layerIndexes[G]||(this.layerIndexes[G]={});let se=this.layerIndexes[G][Q];return se||(se=this.layerIndexes[G][Q]=new X,se.scope=Q),se}getWorkerSource(G,Q,se,xe){let ve=this.workerSources;return ve[G]||(ve[G]={}),ve[G][xe]||(ve[G][xe]={}),ve[G][xe][Q]||(ve[G][xe][Q]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),ve[G][xe][Q][se]||(ve[G][xe][Q][se]=new this.workerSourceTypes[Q]({send:(Ie,ze,Pe,Ne,ut,Xe)=>this.actor.send(Ie,ze,Pe,G,ut,Xe),scheduler:this.actor.scheduler},this.getLayerIndex(G,xe),this.getAvailableImages(G,xe),this.getAvailableModels(G,xe),this.isSpriteLoaded[G][xe],void 0,this.brightness,this.worldview)),ve[G][xe][Q][se]}rasterizeImagesWorker(G,Q,se){let xe=new Map;for(let[ve,{image:Ie,imageVariant:ze}]of Q.tasks.entries()){let Pe=this.imageRasterizer.rasterize(ze,Ie,Q.scope,G);xe.set(ve,Pe)}se(void 0,xe)}removeRasterizedImages(G,Q,se){this.imageRasterizer.removeImagesFromCacheByIds(Q.imageIds,Q.scope,G),se()}enforceCacheSizeLimit(G,Q){r.fJ(Q)}getWorkerPerformanceMetrics(G,Q,se){se(void 0,void 0)}}return r.fF(self)&&(self.worker=new dp(self)),dp}),a(["./shared"],function(r){var C="3.17.0";let P={create:"create",load:"load",fullLoad:"fullLoad"},k={mark(p){performance.mark(p)},measure(p,o,c){performance.measure(p,o,c)}};function X(p){let o=p.name.split("?")[0];return r.a(o)&&o.includes("mapbox-gl.js")?"javascript":r.a(o)&&o.includes("mapbox-gl.css")?"css":r.b(o)?"fontRange":r.c(o)?"sprite":r.i(o)?"style":r.d(o)?"tilejson":"other"}var oe,Me={},$e=(function(){if(oe)return Me;function p(f){return!o(f)}function o(f){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(S),y})()?(function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===y.width})()?(c[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(c[_]=(function(y){var x,w=(function(S){var M=document.createElement("canvas"),A=Object.create(p.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=S,M.getContext("webgl2",A)})(y);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)})(_)),c[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}oe=1,Me.supported=p,Me.notSupportedReason=o;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Me})();function ke(p,o,c){let f=document.createElement(p);return o!=null&&(f.className=o),c&&c.appendChild(f),f}function ht(p,o,c){let f=document.createElementNS("http://www.w3.org/2000/svg",p);for(let _ of Object.keys(o))f.setAttributeNS(null,_,String(o[_]));return c&&c.appendChild(f),f}let Nt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Mt=Nt&&Nt.userSelect!==void 0?"userSelect":"WebkitUserSelect",Xt;function Vn(){Nt&&Mt&&(Xt=Nt[Mt],Nt[Mt]="none")}function sr(){Nt&&Mt&&(Nt[Mt]=Xt)}function Hi(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",Hi,!0)}function Ni(){window.addEventListener("click",Hi,!0),window.setTimeout(()=>{window.removeEventListener("click",Hi,!0)},0)}function Or(p,o){let c=p.getBoundingClientRect();return Vu(p,c,o)}function qo(p,o){let c=p.getBoundingClientRect(),f=[];for(let _=0;_<o.length;_++)f.push(Vu(p,c,o[_]));return f}function Ks(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Vu(p,o,c){let f=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new r.P((c.clientX-o.left)*f,(c.clientY-o.top)*f)}let Uu="01",ci="NO_ACCESS_TOKEN";class ju{constructor(o,c,f){this._transformRequestFn=o,this._customAccessToken=c,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){let o=(function(){let c="";for(let f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Uu,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeStyleURL(o,c){if(!r.h(o))return o;let f=xr(o);return f.params.push(`sdk=js-${C}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeGlyphsURL(o,c){if(!r.h(o))return o;let f=xr(o);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeModelURL(o,c){if(!r.h(o))return o;let f=xr(o);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeSourceURL(o,c,f,_){if(!r.h(o))return o;let y=xr(o);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),f&&y.params.push(`language=${f}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||c)}normalizeIconsetURL(o,c){let f=xr(o);return r.h(o)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||c)):Ji(f)}normalizeSpriteURL(o,c,f,_){let y=xr(o);return r.h(o)?(y.path=`/styles/v1${y.path}/sprite${c}${f}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${c}${f}`,Ji(y))}normalizeTileURL(o,c,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!r.h(o))return o;let _=xr(o);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||f&&_.authority!=="raster"&&f===512?"@2x":""}${r.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${r.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${r.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${r.e.TILE_URL_VERSION}${_.path}`);let y=this._customAccessToken||(function(x){for(let w of x){let S=w.match(/^access_token=(.*)$/);if(S)return S[1]}return null})(_.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(o,c){let f=xr(o);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return o;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let y=f.params;return c&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(o,c){let f=!!c&&r.h(c),_=[];for(let y of o.tiles||[])r.j(y)?_.push(this.canonicalizeTileURL(y,f)):_.push(y);return _}_makeAPIURL(o,c){let f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=xr(r.e.API_URL);if(o.protocol=_.protocol,o.authority=_.authority,o.protocol==="http"){let y=o.params.indexOf("secure");y>=0&&o.params.splice(y,1)}if(_.path!=="/"&&(o.path=`${_.path}${o.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Ji(o);if(c=c||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return o.params=o.params.filter(y=>y.indexOf("access_token")===-1),o.params.push(`access_token=${c||""}`),Ji(o)}}let xo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xr(p){let o=p.match(xo);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ji(p){let o=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${o}`}let Wr="mapbox.eventData";function dl(p){if(!p)return null;let o=p.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(r.l(o[1]))}catch{return null}}class Va{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){let c=dl(r.e.ACCESS_TOKEN),f="";return f=c&&c.u?r.f(c.u):r.e.ACCESS_TOKEN||"",o?`${Wr}.${o}:${f}`:`${Wr}:${f}`}fetchEventData(){let o=r.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(o)try{let y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));let x=localStorage.getItem(f);x&&(this.anonId=x);let w=localStorage.getItem(_);w&&(this.anonIdTimestamp=Number(w));let S=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<S)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){let o=r.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),y=this.anonId,x=this.anonIdTimestamp;if(o&&y)try{localStorage.setItem(f,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),x&&localStorage.setItem(_,x.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,f,_){if(!r.e.EVENTS_URL)return;let y=xr(r.e.EVENTS_URL);y.params.push(`access_token=${_||r.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(o).toISOString()},w=c?Object.assign(x,c):x,S={url:Ji(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=r.p(S,M=>{this.pendingRequest=null,f(M),this.saveEventData(),this.processRequests(_)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}class hl extends Va{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!r.e.EVENTS_URL||!o&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();let c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:c,payload:f}=this.queue.shift();this.postEvent(c,f,()=>{},o)}}let Ua=new class extends Va{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,o){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>r.h(c)||r.j(c))&&this.queueRequest(Date.now(),o)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let o=dl(r.e.ACCESS_TOKEN),c=o?o.u:r.e.ACCESS_TOKEN,f=c!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),f=!0);let _=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(_),w=(_-this.eventData.lastSuccess)/864e5;f=f||w>=1||w<-1||y.getDate()!==x.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Uu,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=c)},p):this.processRequests()}},fr=Ua.postTurnstileEvent.bind(Ua),Qs=new class extends Va{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,o,c,f){this.skuToken=o,this.errorCb=f,r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(ci)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Uu,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p))}remove(){this.errorCb=null}},om=Qs.postMapLoadEvent.bind(Qs),lp=new class extends Va{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let o=this.mapInstanceIdMap.get(p);return o||(o=r.u(),this.mapInstanceIdMap.set(p,o)),o}getEventId(p){let o=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,o+1),o}postStyleLoadEvent(p,o){let{map:c,style:f,importedStyles:_}=o;if(!r.e.EVENTS_URL||!p&&!r.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(c),x={mapInstanceId:y,eventId:this.getEventId(y),style:f};_.length&&(x.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:x},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,payload:c}=this.queue.shift();this.postEvent(o,c,()=>{},p)}},sm=lp.postStyleLoadEvent.bind(lp),Bc=new hl({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Yi=Bc.postMetricsEvent.bind(Bc),Ir=new hl({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Wo=Ir.postMetricsEvent.bind(Ir),$u=new class extends Va{constructor(){super("gljs.performance")}postPerformanceEvent(p,o){r.e.EVENTS_URL&&(p||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,performanceData:c}=this.queue.shift(),f=(function(_){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),w=(function(N){let j={};if(N){for(let U in N)if(U!=="other")for(let Z of N[U]){let q=`${U}ResolveRangeMin`,ee=`${U}ResolveRangeMax`,re=`${U}RequestCount`,ne=`${U}RequestCachedCount`;j[q]=Math.min(j[q]||1/0,Z.startTime),j[ee]=Math.max(j[ee]||-1/0,Z.responseEnd);let ge=de=>{j[de]===void 0&&(j[de]=0),++j[de]};Z.transferSize!==void 0&&Z.transferSize===0&&ge(ne),ge(re)}}return j})((function(N,j){let U={};if(N)for(let Z of N){let q=j(Z);U[q]===void 0&&(U[q]=[]),U[q].push(Z)}return U})(y,X)),S=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=M?M.effectiveType:void 0,L={counters:[],metadata:[],attributes:[]},F=(N,j,U)=>{U!=null&&N.push({name:j,value:U.toString()})};for(let N in w)F(L.counters,N,w[N]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(F(L.counters,"interactionRangeMin",_.interactionRange[0]),F(L.counters,"interactionRangeMax",_.interactionRange[1])),x)for(let N of Object.values(P)){let j=x.find(U=>U.name===N);j&&F(L.counters,N,j.startTime)}return F(L.counters,"visibilityHidden",_.visibilityHidden),F(L.attributes,"style",(function(N){if(N)for(let j of N){let U=j.name.split("?")[0];if(r.i(U)){let Z=U.split("/").slice(-2);if(Z.length===2)return`mapbox://styles/${Z[0]}/${Z[1]}`}}})(y)),F(L.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),F(L.attributes,"fogEnabled",_.fogEnabled?"true":"false"),F(L.attributes,"projection",_.projection),F(L.attributes,"zoom",_.zoom),F(L.metadata,"devicePixelRatio",S),F(L.metadata,"connectionEffectiveType",A),F(L.metadata,"navigatorUserAgent",navigator.userAgent),F(L.metadata,"screenWidth",window.screen.width),F(L.metadata,"screenHeight",window.screen.height),F(L.metadata,"windowWidth",window.innerWidth),F(L.metadata,"windowHeight",window.innerHeight),F(L.metadata,"mapWidth",_.width/S),F(L.metadata,"mapHeight",_.height/S),F(L.metadata,"webglRenderer",_.renderer),F(L.metadata,"webglVendor",_.vendor),F(L.metadata,"sdkVersion",C),F(L.metadata,"sdkIdentifier","mapbox-gl-js"),L})(c);for(let _ of f.metadata);for(let _ of f.counters);for(let _ of f.attributes);this.postEvent(o,f,()=>{},p)}},Fr=$u.postPerformanceEvent.bind($u),Vc=new class extends Va{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,o,c,f){if(!r.e.API_URL||!r.e.SESSION_PATH)return;let _=xr(r.e.API_URL+r.e.SESSION_PATH);_.params.push(`sku=${o||""}`),_.params.push(`access_token=${f||r.e.ACCESS_TOKEN||""}`);let y={url:Ji(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(y,x=>{this.pendingRequest=null,c(x),this.saveEventData(),this.processRequests(f)})}getSessionAPI(p,o,c,f){this.skuToken=o,this.errorCb=f,r.e.SESSION_PATH&&r.e.API_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(ci)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},p)}remove(){this.errorCb=null}},Uc=Vc.getSessionAPI.bind(Vc),zs=new Set;function rs(p,o){o?zs.add(p):zs.delete(p)}class Vr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,c){this._updatedSourceCaches[o]=c,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let c=o.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(o.id),this.setDirty()}removeLayer(o){let c=o.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][o.id]=o,this._updatedLayers[c].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let c in this._updatedLayers)o[c]=o[c]||{},o[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)o[c]=o[c]||{},o[c].removedIds=Object.keys(this._removedLayers[c]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(r.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function T0(p){let{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class Gd extends r.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new r.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);let c=this.atlasTexture.get(o);c&&(c.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(o.id,o)}removeImageProvider(o,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(o)}getPendingImageProviders(){let o=[];for(let c of this.imageProviders.values())for(let f of c.values())f.hasPendingRequests()&&o.push(f);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(let o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,c){if(this.loaded.get(c)!==o&&(this.loaded.set(c,o),o)){for(let{ids:f,callback:_}of this.requestors)this._notify(f,c,_);this.requestors=[]}}hasImage(o,c){return!!this.getImage(o,c)}getImage(o,c){return this.images.get(c).get(o.toString())}addImage(o,c,f){this._validate(o,f)&&this.images.get(c).set(o.toString(),f)}_validate(o,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "content" value`))),f=!1),f}_validateStretch(o,c){if(!o)return!0;let f=0;for(let _ of o){if(_[0]<f||_[1]<_[0]||c<_[1])return!1;f=_[1]}return!0}_validateContent(o,c){return o?o.length!==4||!c.usvg&&(o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,c,f){let _=this.images.get(c).get(o.toString());f.version=_.version+1,this.images.get(c).set(o.toString(),f),this.updatedImages.get(c).add(o),this.removeFromImageRasterizerCache(o,c)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,c){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([o],c))}removeImage(o,c){let f=this.images.get(c),_=f.get(o.toString());f.delete(o.toString()),this.patterns.get(c).delete(o.toString()),this.removeFromImageRasterizerCache(o,c),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(c=>r.I.from(c))}getImages(o,c,f){let _=[],y=[],x=this.imageProviders.get(c);for(let A of o){if(!A.iconsetId){_.push(A);continue}let L=x.get(A.iconsetId);L&&(this.getImage(A,c)?y.push(A):L.addPendingRequest(A))}if(_.length===0)return void this._notify(y,c,f);let w=!0,S=!!this.loaded.get(c),M=this.images.get(c);if(!S)for(let A of _)M.has(A.toString())||(w=!1);S||w?this._notify(_,c,f):this.requestors.push({ids:_,scope:c,callback:f})}rasterizeImages(o,c){let f=new Map,{tasks:_,scope:y}=o;for(let[x,w]of _.entries()){let S=this.getImage(w.id,y);S&&f.set(x,{image:S,imageVariant:w})}this._rasterizeImages(y,f,c)}_rasterizeImages(o,c,f){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:o},f);else{let _=new Map;for(let[y,{image:x,imageVariant:w}]of c.entries())_.set(y,this.imageRasterizer.rasterize(w,x,o,0));f(void 0,_)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,c,f){let _=this.images.get(c),y=new Map;for(let x of o){if(!_.get(x.toString())){if(x.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:x.name}))}let w=_.get(x.toString());if(!w){r.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let S={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(S,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),y.set(r.I.toString(x),S)}f(null,y)}getPixelSize(o){let{width:c,height:f}=this.atlasImage.get(o);return{width:c,height:f}}getPattern(o,c,f){let _=o.toString(),y=this.patterns.get(c),x=y.get(_),w=this.getImage(o,c);if(!w)return null;if(x){if(x.position.version===w.version)return x.position;x.position.version=w.version}else{if(w.usvg&&!w.data){let S=this.getPatternInFlightId(_,c);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);let M=new r.A(o).scaleSelf(r.o.devicePixelRatio),A=new Map([[M.toString(),{image:w,imageVariant:M}]]);return this._rasterizeImages(c,A,(L,F)=>this.storePatternImage(M,c,w,f,F)),null}this.storePattern(o,c,w)}return this._updatePatternAtlas(c,f),y.get(_).position}getPatternInFlightId(o,c){return r.B(o,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,c,f,_,y){let x=o.toString(),w=y?y.get(x):void 0;w&&(f.data=w,this.storePattern(o.id,c,f),this._updatePatternAtlas(c,_),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),c)))}storePattern(o,c,f){let _={w:f.data.width+2*r.C,h:f.data.height+2*r.C,x:0,y:0},y=new r.F(_,f,r.C);this.patterns.get(c).set(o.toString(),{bin:_,position:y})}destroyAtlasTextures(){for(let o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,c){let f=o.gl,_=this.atlasTexture.get(c);_?this.dirty&&(_.update(this.atlasImage.get(c)),this.dirty=!1):(_=new r.T(o,this.atlasImage.get(c),f.RGBA8),this.atlasTexture.set(c,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(o,c){let f=this.patterns.get(o),_=Array.from(f.values()).map(({bin:M})=>M),{w:y,h:x}=r.G(_),w=this.atlasImage.get(o);w.resize({width:y||1,height:x||1});let S=this.images.get(o);for(let[M,{bin:A,position:L}]of f.entries()){let F=L.padding,N=A.x+F,j=A.y+F,U=S.get(M).data,Z=U.width,q=U.height;F=F>1?F-1:F,r.q.copy(U,w,{x:0,y:0},{x:N,y:j},{width:Z,height:q},c),r.q.copy(U,w,{x:0,y:q-F},{x:N,y:j-F},{width:Z,height:F},c),r.q.copy(U,w,{x:0,y:0},{x:N,y:j+q},{width:Z,height:F},c),r.q.copy(U,w,{x:Z-F,y:0},{x:N-F,y:j},{width:F,height:q},c),r.q.copy(U,w,{x:0,y:0},{x:N+Z,y:j},{width:F,height:q},c),r.q.copy(U,w,{x:Z-F,y:q-F},{x:N-F,y:j-F},{width:F,height:F},c),r.q.copy(U,w,{x:0,y:q-F},{x:N+Z,y:j-F},{width:F,height:F},c),r.q.copy(U,w,{x:0,y:0},{x:N+Z,y:j+q},{width:F,height:F},c),r.q.copy(U,w,{x:Z-F,y:0},{x:N-F,y:j+q},{width:F,height:F},c)}this.dirty=!0}beginFrame(){for(let o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,c){let f=this.images.get(c);for(let _ of o){if(this.callbackDispatchedThisFrame.get(c).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(_.toString());let y=f.get(_.toString());T0(y)&&this.updateImage(_,c,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Hu(p){let o=p.value,c=p.valueSpec,f=p.style,_=p.styleSpec,y=p.key,x=p.arrayElementValidator||ar;if(!Array.isArray(o))return[new r.V(y,o,`array expected, ${r.K(o)} found`)];if(c.length&&o.length!==c.length)return[new r.V(y,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new r.V(y,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let w={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};_.$version<7&&(w.function=c.function),r.H(c.value)&&(w=c.value);let S=[];for(let M=0;M<o.length;M++)S=S.concat(x({array:o,arrayIndex:M,value:o[M],valueSpec:w,style:f,styleSpec:_,key:`${y}[${M}]`},!0));return S}function jc(p){let o=p.key,c=p.value,f=p.valueSpec;if(!r.L(c))return[new r.V(o,c,`number expected, ${r.K(c)} found`)];if(c!=c)return[new r.V(o,c,"number expected, NaN found")];if("minimum"in f){let _=f.minimum;if(Array.isArray(f.minimum)&&(_=f.minimum[p.arrayIndex]),c<_)return[new r.V(o,c,`${c} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(Array.isArray(f.maximum)&&(_=f.maximum[p.arrayIndex]),c>_)return[new r.V(o,c,`${c} is greater than the maximum value ${_}`)]}return[]}function $c(p){let o=p.key,c=p.value;if(!r.H(c))return[new r.V(o,c,`object expected, ${r.K(c)} found`)];let f=p.valueSpec,_=r.J(c.type),y,x,w,S={},M=_!=="categorical"&&c.property===void 0,A=!M,L=(function(U){let Z=U.stops;return Array.isArray(Z)&&Array.isArray(Z[0])&&r.H(Z[0][0])})(c),F=Mo({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(U){if(_==="identity")return[new r.V(U.key,U.value,'identity function may not have a "stops" property')];let Z=[],q=U.value;return Z=Z.concat(Hu({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:N})),Array.isArray(q)&&q.length===0&&Z.push(new r.V(U.key,q,"array must have at least one stop")),Z},default:function(U){return ar({key:U.key,value:U.value,valueSpec:f,style:U.style,styleSpec:U.styleSpec})}}});return _==="identity"&&M&&F.push(new r.V(p.key,p.value,'missing required property "property"')),_==="identity"||c.stops||F.push(new r.V(p.key,p.value,'missing required property "stops"')),_==="exponential"&&f.expression&&!r.M(f)&&F.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(A&&!r.N(f)?F.push(new r.V(p.key,p.value,"property functions not supported")):M&&!r.O(f)&&F.push(new r.V(p.key,p.value,"zoom functions not supported"))),_!=="categorical"&&!L||c.property!==void 0||F.push(new r.V(p.key,p.value,'"property" property is required')),F;function N(U){let Z=[],q=U.value,ee=U.key;if(!Array.isArray(q))return[new r.V(ee,q,`array expected, ${r.K(q)} found`)];if(q.length!==2)return[new r.V(ee,q,`array length 2 expected, length ${q.length} found`)];if(L){if(!r.H(q[0]))return[new r.V(ee,q,`object expected, ${r.K(q[0])} found`)];let re=q[0];if(re.zoom===void 0)return[new r.V(ee,q,"object stop key must have zoom")];if(re.value===void 0)return[new r.V(ee,q,"object stop key must have value")];let ne=r.J(re.zoom);if(typeof ne!="number")return[new r.V(ee,re.zoom,"stop zoom values must be numbers")];if(w&&w>ne)return[new r.V(ee,re.zoom,"stop zoom values must appear in ascending order")];ne!==w&&(w=ne,x=void 0,S={}),Z=Z.concat(Mo({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:jc,value:j}}))}else Z=Z.concat(j({key:`${ee}[0]`,value:q[0],style:U.style,styleSpec:U.styleSpec},q));return r.Q(r.S(q[1]))?Z.concat([new r.V(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):Z.concat(ar({key:`${ee}[1]`,value:q[1],valueSpec:f,style:U.style,styleSpec:U.styleSpec}))}function j(U,Z){let q=r.K(U.value),ee=r.J(U.value),re=U.value!==null?U.value:Z;if(y){if(q!==y)return[new r.V(U.key,re,`${q} stop domain type must match previous stop domain type ${y}`)]}else y=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new r.V(U.key,re,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&_!=="categorical"){let ne=`number expected, ${q} found`;return r.N(f)&&_===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(U.key,re,ne)]}return _!=="categorical"||q!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?_!=="categorical"&&q==="number"&&typeof ee=="number"&&typeof x=="number"&&x!==void 0&&ee<x?[new r.V(U.key,re,"stop domain values must appear in ascending order")]:(x=ee,_==="categorical"&&ee in S?[new r.V(U.key,re,"stop domain values must be unique")]:(S[ee]=!0,[])):[new r.V(U.key,re,`integer expected, found ${String(ee)}`)]}}function Zo(p){let o=(p.expressionContext==="property"?r.W:r.U)(r.S(p.value),p.valueSpec);if(o.result==="error")return o.value.map(f=>new r.V(`${p.key}${f.key}`,p.value,f.message));let c=o.value.expression||o.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.Z(c))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Zl(c,p);if(p.expressionContext==="appearance")return qd(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.X(c,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.Y(c))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zl(p,o){let c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.delete(_);if(c.size===0)return[];let f=[];return p instanceof r._&&c.has(p.name)?[new r.V(o.key,o.value,`["${p.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(p.eachChild(_=>{f.push(...Zl(_,o))}),f)}function qd(p,o){let c=new Set;if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)c.add(_);if(c.size===0)return[];let f=[];return p instanceof r._&&!c.has(p.name)?[new r.V(o.key,o.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(_=>{f.push(...qd(_,o))}),f)}function ja(p){let o=p.key,c=p.value,f=p.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(r.J(c))===-1&&_.push(new r.V(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(r.J(c))===-1&&_.push(new r.V(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Yl(p){return r.a2(r.S(p.value))?Zo(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):ds(p)}function ds(p){let o=p.value,c=p.key;if(!Array.isArray(o))return[new r.V(c,o,`array expected, ${r.K(o)} found`)];if(o.length<1)return[new r.V(c,o,"filter array must have at least 1 element")];let f=p.styleSpec,_=ja({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator}),y=()=>{o.length>=2&&(r.a0(o[1])||_.push(new r.V(`${c}[1]`,o[1],`string expected, ${r.K(o[1])} found`)));for(let x=2;x<o.length;x++)r.J(o[1])==="$type"?_=_.concat(ja({key:`${c}[${x}]`,value:o[x],valueSpec:f.geometry_type})):r.a0(o[x])||r.L(o[x])||r.$(o[x])||_.push(new r.V(`${c}[${x}]`,o[x],`string, number, or boolean expected, ${r.K(o[x])} found.`))};switch(r.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&r.J(o[1])==="$type"&&_.push(new r.V(c,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&_.push(new r.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"==":case"!=":o.length!==3&&_.push(new r.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),y();break;case"in":case"!in":y();break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)_=_.concat(ds({key:`${c}[${x}]`,value:o[x],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":o.length!==2?_.push(new r.V(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):r.a0(o[1])||_.push(new r.V(`${c}[1]`,o[1],`string expected, ${r.K(o[1])} found`))}return _}function Gu(p,o){let c=p.key,f=p.style,_=p.layer,y=p.styleSpec,x=p.value,w=p.objectKey,S=y[`${o}_${p.layerType}`];if(!S)return[];let M=w.match(/^(.*)-use-theme$/);if(M&&S[M[1]])return r.Q(r.S(x))?[].concat(ar({key:c,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w})):ar({key:c,value:x,valueSpec:{type:"string"},style:f,styleSpec:y});let A=w.match(/^(.*)-transition$/);if(o==="paint"&&A&&S[A[1]]&&S[A[1]].transition)return ar({key:c,value:x,valueSpec:y.transition,style:f,styleSpec:y});let L=p.valueSpec||S[w];if(!L)return[new r.a3(c,x,`unknown property "${w}"`)];let F;if(r.a0(x)&&r.N(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(x))){let j=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(c,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let N=[];if(p.layerType==="symbol")w!=="text-field"||!f||f.glyphs||f.imports||N.push(new r.V(c,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&r.a4(r.S(x))&&r.J(x.type)==="identity"&&N.push(new r.V(c,x,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&o==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.N(L)&&(r.a5(L)||r.O(L))){let j=r.W(r.S(x),L).value,U="expression"in j&&j.expression||"_styleExpression"in j&&j._styleExpression&&j._styleExpression.expression;U&&!r.X(U,["measure-light"])&&(w==="model-emissive-strength"&&r.Y(U)&&r.Z(U)||N.push(new r.V(c,x,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(ar({key:p.key,value:x,valueSpec:L,style:f,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:w}))}function qu(p){return Gu(p,"paint")}function Wu(p){return Gu(p,"layout")}function Wd(p){let o=[],c=p.value,f=p.key,_=p.style,y=p.styleSpec;if(!r.H(c))return[new r.V(f,c,"object expected")];c.type||c.ref||o.push(new r.V(f,c,'either "type" or "ref" is required'));let x=r.J(c.type),w=r.J(c.ref);if(c.id){let S=r.J(c.id);for(let M=0;M<p.arrayIndex;M++){let A=_.layers[M];r.J(A.id)===S&&o.push(new r.V(f,c.id,`duplicate layer id "${S}", previously used at line ${A.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&o.push(new r.V(f,c[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{r.J(M.id)===w&&(S=M)}),S?S.ref?o.push(new r.V(f,c.ref,"ref cannot reference another ref layer")):x=r.J(S.type):typeof w=="string"&&o.push(new r.V(f,c.ref,`ref layer "${w}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(c.source)if(r.a0(c.source)){let S=_.sources&&_.sources[c.source],M=S&&r.J(S.type);S?M==="vector"&&x==="raster"?o.push(new r.V(f,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&x!=="raster"?o.push(new r.V(f,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&x!=="hillshade"?o.push(new r.V(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&M==="geojson"&&!S.lineMetrics?o.push(new r.V(f,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&M!=="raster-array"&&o.push(new r.V(f,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):o.push(new r.V(f,c.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new r.V(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new r.V(f,c.source,`source "${c.source}" not found`))}else o.push(new r.V(`${f}.source`,c.source,'"source" must be a string'));else o.push(new r.V(f,c,'missing required property "source"'));return o=o.concat(Mo({key:f,value:c,valueSpec:y.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${f}.type`,value:c.type,valueSpec:y.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:S=>Yl(Object.assign({layerType:x},S)),layout:S=>Mo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Wu(Object.assign({layerType:x},M))}}),paint:S=>Mo({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>qu(Object.assign({layerType:x,layer:c},M))}}),appearances(S){let M=Hu({key:S.key,value:S.value,valueSpec:S.valueSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:F=>(function(N){let{key:j,layer:U,layerType:Z}=N,q=r.J(N.value),ee=r.J(q.name),re=r.J(q.condition),ne=Mo({key:j,value:q,valueSpec:N.styleSpec.appearance,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{condition:ge=>(function(de){let fe=[];return fe.push(...Zo({key:de.key,value:de.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),fe})(Object.assign({layer:U,layerType:Z},ge)),properties:ge=>(function(de){let fe=[],{styleSpec:ue,layer:ae,layerType:_e}=de,De=ue[`paint_${_e}`],Ce=ue[`layout_${_e}`],Be=de.object[de.objectKey];for(let Ue in Be){let Ye=Ue in De?"paint":Ue in Ce?"layout":void 0;if(!Ye){fe.push(new r.V(de.key,Ue,`unknown property "${Ue}" for layer type "${_e}"`));continue}let dt=Object.assign({},de,{key:`${de.key}.${Ue}`,object:Be,objectKey:Ue,layer:ae,layerType:_e,value:Be[Ue],valueSpec:Ye==="paint"?De[Ue]:Ce[Ue]});fe.push(...Gu(dt,Ye))}return fe})(Object.assign({layer:U,layerType:Z},ge))}});return ee!=="hidden"&&re===void 0&&ne.push(new r.V(N.key,"name",'Appearance with name different than "hidden" must have a condition')),ne})(Object.assign({layerType:x,layer:c},F))}),A=Array.isArray(S.value)?S.value:[],L=new Set;return A.forEach((F,N)=>{let j=r.J(F.name);if(j)if(L.has(j)){let U=r.J(c.id);M.push(new r.V(S.key,j,`Duplicated appearance name "${j}" for layer "${U}"`))}else L.add(j)}),M}}})),o}function bo({key:p,value:o}){return r.a0(o)?[]:[new r.V(p,o,`string expected, ${r.K(o)} found`)]}let Ss={promoteId:function p({key:o,value:c}){if(r.a0(c))return bo({key:o,value:c});if(Array.isArray(c)){let _=[],y=r.S(c),x=r.U(y);return x.result==="error"&&x.value.forEach(w=>{_.push(new r.V(`${o}${w.key}`,null,`${w.message}`))}),r.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new r.V(`${o}`,null,"promoteId expression should be only feature dependent")),_}if(!r.H(c))return[new r.V(o,c,`string, expression or object expected, "${r.K(c)}" found`)];let f=[];for(let _ in c)f.push(...p({key:`${o}.${_}`,value:c[_]}));return f}};function cp(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!r.H(o))return[new r.V(c,o,`object expected, ${r.K(o)} found`)];if(!("type"in o))return[new r.V(c,o,'"type" is required')];let y=r.J(o.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in o||"tiles"in o||x.push(new r.a3(c,o,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Mo({key:c,value:o,valueSpec:f[`source_${y.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:Ss})),x;case"geojson":if(x=Mo({key:c,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Ss}),"cluster"in o&&"clusterProperties"in o){if(!r.H(o.clusterProperties))return[new r.V(`${c}.clusterProperties`,o,`object expected, ${r.K(o)} found`)];for(let w in o.clusterProperties){let S=o.clusterProperties[w];if(!Array.isArray(S))return[new r.V(`${c}.clusterProperties.${w}`,S,"array expected")];let[M,A]=S,L=typeof M=="string"?[M,["accumulated"],["get",w]]:M;x.push(...Zo({key:`${c}.${w}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Zo({key:`${c}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}}return x;case"video":return Mo({key:c,value:o,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Mo({key:c,value:o,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new r.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ja({key:`${c}.type`,value:o.type,valueSpec:{values:Hc(f)}})}}function Hc(p){return p.source.reduce((o,c)=>{let f=p[c];return f.type.type==="enum"&&(o=o.concat(Object.keys(f.type.values||{}))),o},[])}function pl(p){let o=p.value,c=p.styleSpec,f=c.light,_=p.style;if(o===void 0)return[];if(!r.H(o))return[new r.V("light",o,`object expected, ${r.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&f[S[1]]?ar({key:x,value:o[x],valueSpec:{type:"string"},style:_,styleSpec:c}):w&&f[w[1]]&&f[w[1]].transition?ar({key:x,value:o[x],valueSpec:c.transition,style:_,styleSpec:c}):f[x]?ar({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}):[new r.V(x,o[x],`unknown property "${x}"`)])}return y}function Xl(p){let o=p.value;if(!o)return[];let c=p.key;if(!r.H(o))return[new r.V(c,o,`object expected, ${r.K(o)} found`)];let f=[],_=p.styleSpec,y=_["light-3d"],x=p.style,w=p.style.lights;for(let A of["type","id"])if(!(A in o))return f=f.concat([new r.V(c,o,`missing property "${A}"`)]),f;if(!r.a0(o.type))return f=f.concat([new r.V(`${c}.type`,o.type,"string expected")]),f;if(w)for(let A=0;A<p.arrayIndex;A++){let L=r.J(o.type),F=w[A];r.J(F.type)===L&&f.push(new r.V(c,o.id,`duplicate light type "${o.type}", previously defined at line ${F.id.__line__}`))}let S=`properties_light_${o.type}`;if(!(S in _))return f=f.concat([new r.V(`${c}.type`,o,`Invalid light type ${o.type}`)]),f;let M=_[S];for(let A in o)if(A==="properties"){let L=o[A];if(!r.H(L))return f=f.concat([new r.V("properties",L,`object expected, ${r.K(L)} found`)]),f;for(let F in L){let N=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);f=f.concat(j&&M[j[1]]?ar({key:A,value:L[F],valueSpec:{type:"string"},style:x,styleSpec:_}):N&&M[N[1]]&&M[N[1]].transition?ar({key:A,value:o[A],valueSpec:_.transition,style:x,styleSpec:_}):M[F]?ar({key:F,value:L[F],valueSpec:M[F],style:x,styleSpec:_}):[new r.a3(p.key,L[F],`unknown property "${F}"`)])}}else f=f.concat(y[A]?ar({key:A,value:o[A],valueSpec:y[A],style:x,styleSpec:_}):[new r.a3(A,o[A],`unknown property "${A}"`)]);return f}function $a(p){let o=p.value,c=p.key,f=p.style,_=p.styleSpec,y=_.terrain;if(o==null)return[];if(!r.H(o))return[new r.V("terrain",o,`object expected, ${r.K(o)} found`)];let x=[];for(let w in o){let S=w.match(/^(.*)-transition$/),M=w.match(/^(.*)-use-theme$/);x=x.concat(M&&y[M[1]]?ar({key:w,value:o[w],valueSpec:{type:"string"},style:f,styleSpec:_}):S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:o[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:o[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,o[w],`unknown property "${w}"`)])}if(o.source)if(r.a0(o.source)){let w=f.sources&&f.sources[o.source],S=w&&r.J(w.type);w?S!=="raster-dem"&&x.push(new r.V(`${c}.source`,o.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):x.push(new r.V(`${c}.source`,o.source,`source "${o.source}" not found`))}else x.push(new r.V(`${c}.source`,o.source,"source must be a string"));else x.push(new r.V(c,o,'terrain is missing required property "source"'));return x}function up(p){let o=p.value,c=p.style,f=p.styleSpec,_=f.fog;if(o===void 0)return[];if(!r.H(o))return[new r.V("fog",o,`object expected, ${r.K(o)} found`)];let y=[];for(let x in o){let w=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);y=y.concat(S&&_[S[1]]?ar({key:x,value:o[x],valueSpec:{type:"string"},style:c,styleSpec:f}):w&&_[w[1]]&&_[w[1]].transition?ar({key:x,value:o[x],valueSpec:f.transition,style:c,styleSpec:f}):_[x]?ar({key:x,value:o[x],valueSpec:_[x],style:c,styleSpec:f}):[new r.a3(x,o[x],`unknown property "${x}"`)])}return y}let Zu={"*":()=>[],array:Hu,boolean:function(p){let o=p.value,c=p.key;return r.$(o)?[]:[new r.V(c,o,`boolean expected, ${r.K(o)} found`)]},number:jc,color:function({key:p,value:o}){return r.a0(o)?r.a1.parseCSSColor(o)===null?[new r.V(p,o,`color expected, "${o}" found`)]:[]:[new r.V(p,o,`color expected, ${r.K(o)} found`)]},enum:ja,filter:Yl,function:$c,layer:Wd,object:Mo,source:cp,model:r.a7,light:pl,"light-3d":Xl,terrain:$a,fog:up,string:bo,formatted:function(p){return bo(p).length===0?[]:Zo(p)},resolvedImage:function(p){return bo(p).length===0?[]:Zo(p)},projection:function(p){let o=p.value,c=p.styleSpec,f=c.projection,_=p.style;if(r.H(o)){let y=[];for(let x in o)y=y.concat(ar({key:x,value:o[x],valueSpec:f[x],style:_,styleSpec:c}));return y}return r.a0(o)?[]:[new r.V("projection",o,`object or string expected, ${r.K(o)} found`)]},import:function(p){let o=p.key,{value:c,styleSpec:f}=p;if(!r.H(c))return[new r.V(o,c,"import must be an object")];let w=c,{data:_}=w,y=Aw(w,["data"]);Object.defineProperty(y,"__line__",{value:c.__line__,enumerable:!1});let x=Mo(Object.assign({},p,{value:y,valueSpec:f.import}));return r.J(y.id)===""&&x.push(new r.V(`${p.key}.id`,y,"import id can't be an empty string")),_&&(x=x.concat(Yu(_,f,{key:`${p.key}.data`}))),x},iconset:function(p){let o=p.value,c=p.key,f=p.styleSpec,_=p.style;if(!r.H(o))return[new r.V(c,o,"object expected")];if(!o.type)return[new r.V(c,o,'"type" is required')];let y=r.J(o.type),x=[];if(x=x.concat(Mo({key:c,value:o,valueSpec:f[`iconset_${y}`],style:_,styleSpec:f})),(function(w,S){return!(w!=="source"||!S.source)})(y,o)){let w=_.sources&&_.sources[o.source],S=w&&r.J(w.type);w?S!=="raster-array"&&x.push(new r.V(c,o.source,`iconset cannot be used with a source of type ${String(S)}, it only be used with a "raster-array" source type`)):x.push(new r.V(c,o.source,`source "${o.source}" not found`))}return x}};function ar(p,o=!1){let c=p.value,f=p.valueSpec,_=p.styleSpec;if(f.expression){if(r.a4(r.J(c)))return $c(p);if(r.Q(r.S(c)))return Zo(p)}if(f.type&&Zu[f.type]){let y=Zu[f.type](p);return o===!0&&y.length>0&&Array.isArray(p.value)?Zo(p):y}return Mo(Object.assign({},p,{valueSpec:f.type?_[f.type]:f}))}function Mo(p){let o=p.key,c=p.value,f=p.valueSpec||{},_=p.objectElementValidators||{},y=p.style,x=p.styleSpec;if(!r.H(c))return[new r.V(o,c,`object expected, ${r.K(c)} found`)];let w=[];for(let S in c){let M=S.split(".")[0],A;_[M]?A=_[M]:f[M]?A=ar:_["*"]?A=_["*"]:f["*"]&&(A=ar),A?w=w.concat(A({key:(o&&`${o}.`)+S,value:c[S],valueSpec:f[M]||f["*"],style:y,styleSpec:x,object:c,objectKey:S},c)):w.push(new r.a3(o,c[S],`unknown property "${S}"`))}for(let S in f){if(_[S])continue;let M=f[S];M.required&&M.default===void 0&&c[S]===void 0&&w.push(new r.V(o,c,`missing required property "${S}"`))}return w}function am({key:p,value:o}){let c=bo({key:p,value:o});if(c.length)return c;let f=o;return f.indexOf("{fontstack}")===-1&&c.push(new r.V(p,o,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&c.push(new r.V(p,o,'"glyphs" url must include a "{range}" token')),c}function Yu(p,o=r.a6,c={}){return Mo({key:c.key||"",value:p,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:p,objectElementValidators:{glyphs:am}})}function Ha(p,o=r.a6){return Q(Yu(p,o))}let lm=p=>Q(cp(p)),st=p=>Q(pl(p)),Kl=p=>Q(Xl(p)),I0=p=>Q($a(p)),Xu=p=>Q(up(p)),Zn=p=>Q((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.snow;if(c===void 0)return[];if(!r.H(c))return[new r.V("snow",c,`object expected, ${r.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),os=p=>Q((function(o){let c=o.value,f=o.style,_=o.styleSpec,y=_.rain;if(c===void 0)return[];if(!r.H(c))return[new r.V("rain",c,`object expected, ${r.K(c)} found`)];let x=[];for(let w in c){let S=w.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?ar({key:w,value:c[w],valueSpec:_.transition,style:f,styleSpec:_}):y[w]?ar({key:w,value:c[w],valueSpec:y[w],style:f,styleSpec:_}):[new r.a3(w,c[w],`unknown property "${w}"`)])}return x})(p)),M0=p=>Q(Wd(p)),Ku=p=>Q(Yl(p)),dp=p=>Q(qu(p)),Re=p=>Q(Wu(p)),G=p=>Q(r.a7(p));function Q(p){return p.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function se(p,o){let c=!1;if(o&&o.length)for(let f of o)f instanceof r.a3?r.w(f.message):(p.fire(new r.y(new Error(f.message))),c=!0);return c}let xe=r.a6.light,ve;class Ie extends r.E{constructor(o,c="flat"){super(),this._transitionable=new r.a8(ve||(ve=new r.a9({anchor:new r.aa(xe.anchor),position:new r.ab(xe.position),color:new r.aa(xe.color),intensity:new r.aa(xe.intensity)}))),this.setLight(o,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c,f={}){this._validate(st,o,f)||(this._transitionable.setTransitionOrValue(o),this.id=c)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&se(this,o.call(Ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let ze=r.a6.terrain,Pe=class extends r.E{constructor(p,o,c,f,_){super(),this.scope=c,this._transitionable=new r.a8(new r.a9({source:new r.aa(ze.source),exaggeration:new r.aa(ze.exaggeration)}),c,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=_}get(){return this._transitionable.serialize()}set(p,o){this._transitionable.setTransitionOrValue(p,o)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let p=this._transitionable._values.exaggeration;if(!p)return null;let o=p.value.expression;if(!o)return null;let c=-1,f=-1,_=1;for(let y of o.zoomStops)_=o.evaluate(new r.ac(y,{worldview:this.worldview})),_>.01?(c=y,f=-1):f=y;return _<.01&&c>0&&f>c?[c,f]:null}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.ad}},Ne=45,ut=65,Xe=.05;function Ft(p,o,c,f){let _=r.ah(Ne,ut,c),[y,x]=Qt(p,f),w=1-Math.min(1,Math.exp((o-y)/(x-y)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*_*p.alpha}function Qt(p,o){let c=.5/Math.tan(.5*o);return[p.range[0]+c,p.range[1]+c]}function Pt(p,o,c,f,_){let y=r.af([],[o,c,f],_.mercatorFogMatrix);return Ft(p,r.ag(y),_.pitch,_._fov)}function bn(p,o,c,f,_,y,x){let w=[[c,f,0],[_,f,0],[_,y,0],[c,y,0]],S=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let A of w){let L=r.af([],A,o),F=r.ag(L);S=Math.min(S,F),M=Math.max(M,F)}return[Ft(p,S,x.pitch,x._fov),Ft(p,M,x.pitch,x._fov)]}let yn=r.a6.fog;class gn extends r.E{constructor(o,c,f,_){super();let y=new r.a9({range:new r.aa(yn.range),color:new r.aa(yn.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(yn["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(yn["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(yn["horizon-blend"]),"star-intensity":new r.aa(yn["star-intensity"]),"vertical-range":new r.aa(yn["vertical-range"])});this._transitionable=new r.a8(y,f,new Map(_)),this.set(o,_),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new r.ai(y),this.scope=f}get state(){let o=this._transform,c=o.projection.name==="globe",f=r.aj(o.zoom),_=this.properties.get("range"),y=[.5,3];return{range:c?[r.ak(y[0],_[0],f),r.ak(y[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c,f={}){if(this._validate(Xu,o,f))return;let _=Object.assign({},o);for(let y of Object.keys(yn))_[y]===void 0&&(_[y]=yn[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Ne,ut,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?(function(f,_,y){let x=r.ae.fromLngLat(_),w=y.elevation?y.elevation.getAtPointOrZero(x):0;return Pt(f,x.x,x.y,w,y)})(this.state,o,c):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(o.toUnwrapped());return bn(this.state,c,0,0,r.al,r.al,this._transform)}getOpacityForBounds(o,c,f,_,y){return this._transform.projection.supportsFog?bn(this.state,o,c,f,_,y,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Qt(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let f of c){let _=o.points[f],y;if(_[2]>=0)y=_;else{let x=o.points[f-4];y=r.am(x,_,x[2]/(x[2]-_[2]))}if(Pt(this.state,y[0],y[1],0,this._transform)>=Xe)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&se(this,o.call(Ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Un,mr,Ur,br,Zr=class extends r.E{constructor(p,o,c,f){super();let _=Un||(Un=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=r.an(c[0]),_=-Math.max(r.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(Zn,p,c))return;let f=Object.assign({},p),_=r.a6.snow;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&se(this,p.call(Ha,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},lr=class extends r.E{constructor(p,o,c,f){super();let _=mr||(mr=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(_,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=c}get state(){let p=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),f=r.an(c[0]),_=-Math.max(r.an(c[1]),.01),y=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*p),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(p,o,c={}){if(this._validate(os,p,c))return;let f=Object.assign({},p),_=r.a6.rain;for(let y of Object.keys(_))f[y]===void 0&&(f[y]=_[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,o,c){return(!c||c.validate!==!1)&&se(this,p.call(Ha,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Gn extends r.E{constructor(o,c,f,_){super(),this.scope=f,this._options=o,this.properties=new r.ai(c),this._transitionable=new r.a8(c,f,new Map(_)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,c){this._options=o,this._transitionable.setTransitionOrValue(o.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class cr{constructor(o,c,f){this.screenBounds=o,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(o,c){let f,_;if(o instanceof r.P||typeof o[0]=="number"){let y=r.P.convert(o);f=[y],_=c.isPointAboveHorizon(y)}else{let y=r.P.convert(o[0]),x=r.P.convert(o[1]),w=y.add(x)._div(2);f=[y,x],_=r.aq(y,x).every(S=>c.isPointAboveHorizon(S))&&c.isPointAboveHorizon(w)}return new cr(f,_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),r.ar(_,o)}bufferedCameraGeometryGlobe(o){let c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(c,f,o),y=this.cameraPoint.clone();switch(3*((y.y>c.y)+(y.y>f.y))+((y.x>c.x)+(y.x>f.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(o,c,f,_=0){let y=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,x=f?this._bufferedCameraMercator(y,c):this._bufferedScreenMercator(y,c),w=o.tileID.wrap+(x.unwrapped?_:0),S=x.polygon.map(Z=>r.as(o.tileTransform,Z,w));if(!r.at(S,0,0,r.al,r.al))return;w=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let M=this.screenGeometryMercator.polygon.map(Z=>r.au(o.tileTransform,Z,w)),A=M.map(Z=>new r.P(Z[0],Z[1])),L=c.getFreeCameraOptions().position||new r.ae(0,0,0),F=r.au(o.tileTransform,L,w),N=M.map(Z=>{let q=r.av(Z,Z,F);return r.aw(q,q),new r.ax(F,q)}),j=r.ay(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:N,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(U=r.az(S),U.min.x=r.aA(U.min.x,0,r.al),U.min.y=r.aA(U.min.y,0,r.al),U.max.x=r.aA(U.max.x,0,r.al),U.max.y=r.aA(U.max.y,0,r.al),U),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(o,c){let f=wr(o);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(o,c){let f=wr(o);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(o,c){let f=(function(y,x){let w=r.aB([],x.pixelMatrix,x.globeMatrix),S=[0,-r.aD,0,1],M=[0,r.aD,0,1],A=[0,0,0,1];r.aC(S,S,w),r.aC(M,M,w),r.aC(A,A,w);let L=new r.P(S[0]/S[3],S[1]/S[3]),F=new r.P(M[0]/M[3],M[1]/M[3]),N=r.aE(y,L)&&S[3]<A[3],j=r.aE(y,F)&&M[3]<A[3];if(!N&&!j)return null;let U=(function(fe,ue,ae){for(let _e=1;_e<fe.length;_e++){let De=kn(ue.pointCoordinate3D(fe[_e-1]).x),Ce=kn(ue.pointCoordinate3D(fe[_e]).x);if(ae<0){if(De<Ce)return{idx:_e,t:-De/(Ce-1-De)}}else if(Ce<De)return{idx:_e,t:(1-De)/(Ce+1-De)}}return null})(y,x,N?-1:1);if(!U)return null;let{idx:Z,t:q}=U,ee=Z>1?Oi(y.slice(0,Z),x):[],re=Z<y.length?Oi(y.slice(Z),x):[];ee=ee.map(fe=>new r.P(kn(fe.x),fe.y)),re=re.map(fe=>new r.P(kn(fe.x),fe.y));let ne=[...ee];ne.length===0&&ne.push(re[re.length-1]);let ge=r.ak(ne[ne.length-1].y,(re.length===0?ee[0]:re[0]).y,q),de;return de=N?[new r.P(0,ge),new r.P(0,0),new r.P(1,0),new r.P(1,ge)]:[new r.P(1,ge),new r.P(1,1),new r.P(0,1),new r.P(0,ge)],ne.push(...de),re.length===0?ne.push(ee[0]):ne.push(...re),{polygon:ne.map(fe=>new r.ae(fe.x,fe.y)),unwrapped:!1}})(o,c);if(f)return f;let _=(function(y,x){let w=!1,S=-1/0,M=0;for(let L=0;L<y.length-1;L++)y[L].x>S&&(S=y[L].x,M=L);for(let L=0;L<y.length-1;L++){let F=(M+L)%(y.length-1),N=y[F],j=y[F+1];Math.abs(N.x-j.x)>.5&&(N.x<j.x?(N.x+=1,F===0&&(y[y.length-1].x+=1)):(j.x+=1,F+1===y.length-1&&(y[0].x+=1)),w=!0)}let A=r.aF(x.center.lng);return w&&A<Math.abs(A-1)&&y.forEach(L=>{L.x-=1}),{polygon:y,unwrapped:w}})(Oi(o,c).map(y=>new r.P(kn(y.x),y.y)),c);return{polygon:_.polygon.map(y=>new r.ae(y.x,y.y)),unwrapped:_.unwrapped}}}function Oi(p,o){return r.aG(p,c=>{let f=o.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function kn(p){return p<0?1+p%1:p%1}function wr(p){return 100*p|0}function Fo(p,o,c,f,_){let y=function(w,S){if(w)return _(w);if(S){if(p.url&&S.tiles&&p.tiles&&delete p.tiles,S.variants){if(!Array.isArray(S.variants))return _(new Error("variants must be an array"));for(let A of S.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return _(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){S=Object.assign(S,A);break}}}let M=r.aH(Object.assign({},S,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=o.canonicalizeTileset(M,p.url),_(null,M)}},x=(function(w,S,M){if(!w)return null;if(!S&&!M)return w;M=M||w.worldview_default;let A=Object.values(w.language||{});if(A.length===0)return null;let L=Object.values(w.worldview||{});if(L.length===0)return null;let F=A.every(j=>j===S),N=L.every(j=>j===M);return F&&N?w:S in(w.language_options||{})||M in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null})(p.data,c,f);return x?r.o.frame(()=>y(null,x)):p.url?r.m(o.transformRequest(o.normalizeSourceURL(p.url,null,c,f),r.R.Source),y):r.o.frame(()=>{let M=p,{data:w}=M,S=Aw(M,["data"]);y(null,S)})}function Yo(p,o){let c=Math.pow(2,o.z),f=Math.floor(r.aF(p.getWest())*c),_=Math.floor(r.aJ(p.getNorth())*c),y=Math.ceil(r.aF(p.getEast())*c),x=Math.ceil(r.aJ(p.getSouth())*c);return o.x>=f&&o.x<y&&o.y>=_&&o.y<x}class Ts{constructor(o,c,f){this.bounds=o?r.aI.convert(this.validateBounds(o)):null,this.minzoom=c||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(let c of o)this.extraBounds.push(r.aI.convert(this.validateBounds(c)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Yo(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(let c of this.extraBounds)if(Yo(c,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;let c=new Ts(o.bounds,o.minzoom,o.maxzoom);return c.addExtraBounds(o.extra_bounds),c}}class Qu extends r.E{constructor(o,c,f,_){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.aK}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Fo(this._options,this.map._requestManager,c,f,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.y(_));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Ts.fromTileJSON(y),fr(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,c){let f=o.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),y=this.map._requestManager.transformRequest(_,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w=x?{image:x.image.clone()}:null,S={request:y,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(f)&&(S.localizableLayerIds=this.localizableLayerIds),S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",S,M.bind(this));else if(o.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",S,M.bind(this),void 0,!0);else{let A=r.aL.call({deduped:this._deduped},S,(L,F)=>{if(L||!F)M.call(this,L);else{let N=r.aM(F.responseHeaders);S.data={rawData:F.rawData.slice(0),expires:N.expires,cacheControl:N.cacheControl},o.actor&&o.actor.send("loadTile",S,M.bind(this),void 0,!0)}},!0);o.request={cancel:A}}function M(A,L){return delete o.request,o.aborted?c(null):A&&A instanceof r.aN&&A.status!==404?c(A):(L&&L.resourceTiming&&(o.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&o.setExpiryData(L),o.loadVectorData(L,this.map.painter),r.aO(this.dispatcher),c(null,L),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wo extends r.E{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,r.aH(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let c=this.map.getWorldview();this._tileJSONRequest=Fo(this._options,this.map._requestManager,null,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new r.y(f)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Ts.fromTileJSON(_),fr(_.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(f)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){let f=r.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);o.request=r.n(this.map._requestManager.transformRequest(_,r.R.Tile),(y,x,w)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(y)return o.state="errored",c(y);if(!x)return c(null);let S=r.aM(w);this.map._refreshExpiredTiles&&o.setExpiryData(S),o.setTexture(x,this.map.painter),o.state="loaded",r.aO(this.dispatcher),c(null)})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c&&c()}unloadTile(o,c){o.texture&&o.texture instanceof r.T?(o.destroy(!1),o.texture&&o.texture instanceof r.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Js([p,o],c,f,{scaled:_=!0}={}){let{tileSize:y,buffer:x}=f,{x:w,y:S,z:M}=c;if(!isFinite(w)||!isFinite(S)||!isFinite(M))throw new Error("Invalid MRT header");let A=2**M,L=A*r.aF(p),F=A*r.aJ(o);return(function([N,j],U,{scaled:Z=!0}={}){if(!U)throw new Error("bandView is undefined");let{data:q,tileSize:ee,buffer:re,offset:ne,scale:ge,dimension:de}=U;if(N<-re||N>ee+re||j<-re||j>ee+re)throw new Error(`Point (${N}, ${j}) out of bounds for tileSize=${ee}, buffer=${re}`);let fe=(j+re)*(ee+2*re)+(N+re);if(new Uint32Array(q.buffer)[fe]===4294967295)return null;let ue=[];ue=Z?[]:new U.data.constructor(de);for(let ae=0;ae<de;ae++)ue[ae]=Math.round(1e12*(q[de*fe+ae]*ge+ne))/1e12;return ue})([Math.min(Math.max(-x,Math.floor((L-w)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((F-S)*y)),y-1+x)],f,{scaled:_})}class ss extends wo{constructor(o,c,f,_){super(o,c,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(o){let c=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);c&&c.enabled&&f&&c._clearRenderCacheForTile(f.id,o.tileID),this.map.triggerRepaint()}loadTile(o,c){let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile),y={request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=_,o.actor||(o.actor=this.dispatcher.getActor());let x=(w,S,M)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(w)return w.name==="AbortError"?void 0:(o.state="errored",c(w));if(this.map._refreshExpiredTiles&&S){let A=r.aM(M);o.setExpiryData(A)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!S)return c(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=S}c(null)};o.request=this.partial?o.fetchHeader(void 0,x.bind(this)):o.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){let f=o.texturePerLayer;if(o.flushAllQueues(),f.size){o.destroy(!1);for(let _ of f.values())this.map.painter.saveTileTexture(_)}else o.destroy()}prepareTile(o,c,f,_){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(c,f,_,(y,x)=>{if(y)return o.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(o);x&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(f,x,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let c=this.rasterLayers.find(({id:y})=>y===o),f=c&&c.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(o,c,f){if(!o)return;let _=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;c instanceof r.aR?y=c.paint.get("raster-array-band"):c instanceof r.aS&&(y=c.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(_);if(x==null)return;if(!o.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(o,_,c.id,x);if(o.updateNeeded(c.id,x)&&!f)return;let w=o.textureDescriptorPerLayer.get(c.id);return Object.assign({},w,{texture:o.texturePerLayer.get(c.id)})}getImages(o,c){let f=new Map;for(let _ of o)for(let y of c){let[x,w]=y.split("/"),S=_.getLayer(x);if(!S||!S.hasBand(w)||!S.hasDataForBand(w))continue;let{bytes:M,tileSize:A,buffer:L}=S.getBandView(w),F=A+2*L,N={data:new r.q({width:F,height:F},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(y,N)}return f}queryRasterArrayValueByBandId(o,c,f){let _=c._mrt;return new Promise(y=>{let x={},w=new Set;for(let[S,M]of Object.entries(_.layers)){if(f.layerName&&S!==f.layerName)continue;let A={};x[S]=A;for(let{bands:L}of M.dataIndex)for(let F of L)f.bands&&!f.bands.includes(F)||(w.add(r.B(S,F)),c.fetchBand(S,null,F,N=>{r.o.frame(()=>{A[F]=N?null:Js([o.lng,o.lat],_,M.getBandView(F)),w.delete(r.B(S,F)),w.size===0&&y(x)})},!1))}w.size===0&&y(x)})}_loadTileForQuery(o,c){if(this._loadTileLoaded[o.uid])return void c(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(c);this._loadTilePending[o.uid]=[c];let f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile);o.actor.send("loadTile",{request:_,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,w)=>{if(y)return this._loadTilePending[o.uid].forEach(S=>S(y,null)),void delete this._loadTilePending[o.uid];if(!x)return this._loadTilePending[o.uid].forEach(S=>S(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&x){let S=r.aM(w);o.setExpiryData(S)}o._mrt=x,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(S=>S(null,x)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,c,f){return new Promise((_,y)=>{this._loadTileForQuery(c,(x,w)=>{x?y(x):_(w?this.queryRasterArrayValueByBandId(o,c,f):null)})})}queryRasterArrayValue(o,c){let f=r.aT.convert(o),_=this.findLoadedParent(f);return _&&_._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(f,_,c):this.queryRasterArrayValueByAllBands(f,_,c):Promise.resolve(null)}findLoadedParent(o){let c=r.ae.fromLngLat(o,this.map.transform.tileSize),f=this.maxzoom+1,_=1<<f,y=Math.floor(c.x),x=Math.floor((c.x-y)*_),w=Math.floor(c.y*_),S=this.map.style.getSourceCache(this.id),M=new r.aQ(f,y,f,x,w);return S.findLoadedParent(M,this.minzoom)}}let fl={vector:Qu,raster:wo,"raster-dem":class extends wo{constructor(p,o,c,f){super(p,o,c,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(p.state="errored",o(_)),y&&(p.dem=y,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=r.n(this.map._requestManager.transformRequest(c,r.R.Tile),(function(_,y,x){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(_)p.state="errored",o(_);else if(y){let w=r.aM(x);this.map._refreshExpiredTiles&&p.setExpiryData(w);let S=ImageBitmap&&y instanceof ImageBitmap&&r.r(),M=1-(y.width-r.aP(y.width))/2;M<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let A=S?y:r.o.getImageData(y,M),L={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:M};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",L,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let o=p.canonical,c=Math.pow(2,o.z),f=(o.x-1+c)%c,_=o.x===0?p.wrap-1:p.wrap,y=(o.x+1+c)%c,x=o.x+1===c?p.wrap+1:p.wrap,w={};return w[new r.aQ(p.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y).key]={backfilled:!1},o.y>0&&(w[new r.aQ(p.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y-1).key]={backfilled:!1}),o.y+1<c&&(w[new r.aQ(p.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},w[new r.aQ(p.overscaledZ,x,o.z,y,o.y+1).key]={backfilled:!1}),w}},"raster-array":ss,geojson:class extends r.E{constructor(p,o,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let _=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:r.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let o=new Map;for(let c of this._data.features)o.set(c.id,c);for(let c of p.features)o.set(c.id,c);this._data.features=[...o.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterLeaves(p,o,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:o,offset:c},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;let o=Object.assign({append:p},this.workerOptions);o.scope=this.scope;let c=this._data;typeof c=="string"?(o.request=this.map._requestManager.transformRequest(r.o.resolveURL(c),r.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new r.y(f));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let p=r.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,o){let c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,x,(w,S)=>y&&!S?(p.state="loaded",o(null)):(delete p.request,p.destroy(!1),p.aborted?o(null):w?o(w):(p.loadVectorData(S,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,o){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aU{constructor(p,o,c,f){super(p,o,c,f),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.R.Source).url);r.aV(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new r.y(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aU,model:r.aX,"batched-model":class extends r.E{constructor(p,o,c,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();let p=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Fo(this._options,this.map._requestManager,o,c,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.y(f))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new Ts(_.bounds,this.minzoom,this.maxzoom)),fr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=o;else{if(p.buckets){let y=Object.values(p.buckets);for(let x of y)x.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,_.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(y,x){return p.aborted?o(null):y&&y.status!==404?o(y):(this.map._refreshExpiredTiles&&x&&p.setExpiryData(x),p.loadModelData(x,this.map.painter),p.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aU{constructor(p,o,c,f){super(p,o,c,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new r.y(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,o,c,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ts(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:o,y:c,z:f}=p.canonical;return this._implementation.hasTile({x:o,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){let{x:c,y:f,z:_}=p.tileID.canonical,y=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:_},{signal:y.signal})).then((function(x){return delete p.request,p.aborted?(p.state="unloaded",o(null)):x===void 0?(p.state="errored",o(null)):x===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null)):(function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement})(x)?(this.loadTileData(p,x),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(p.state="errored",o(x))}),p.request.cancel=()=>y.abort()}loadTileData(p,o){p.setTexture(o,this.map.painter)}unloadTile(p,o){if(p.texture&&p.texture instanceof r.T?(p.destroy(!1),p.texture&&p.texture instanceof r.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:c,y:f,z:_}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:_})}o&&o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=r.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},ho=function(p,o,c,f){let _=new fl[o.type](p,o,c,f);if(_.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${_.id}`);return r.aY(["load","abort","unload","serialize","prepare"],_),_};function Ju(p,o,c=""){return`${c}:${o.id||""}:${o.layer.id}:${(function(f){if("layerId"in f)return`layer:${f.layerId}`;{let{featuresetId:_,importId:y}=f;return`featureset:${_}${y?`:import:${y}`:""}`}})(p.target)}`}function Zd(p,o,c,f=""){if(p.uniqueFeatureID){let _=Ju(p,o,f);if(c.has(_))return!0;c.add(_)}return!1}function cm(p,o,c,f,_=!1){let y=o.sourceCache.transform,x=o.sourceCache.tilesIn(p,o.has3DLayers,_);x.sort(hp);let w=[];for(let S of x){let M=S.tile.queryRenderedFeatures(o,S,c,f,y,_);Object.keys(M).length&&w.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:M})}for(let S in o.layers){let M=o.layers[S];if(M.styleLayer){let A=M.styleLayer.queryRenderedFeatures(p,o.sourceCache,f);Object.keys(A).length&&w.push({wrappedTileID:0,queryResults:A})}}return w.length===0?{}:(function(S){let M={},A={};for(let L of S){let F=L.queryResults,N=L.wrappedTileID,j=A[N]=A[N]||{};for(let U in F){let Z=F[U],q=j[U]=j[U]||{},ee=M[U]=M[U]||[];for(let re of Z)q[re.featureIndex]||(q[re.featureIndex]=!0,ee.push(re))}}return M})(w)}function um(p,o,c,f,_,y){let x={},w=f.queryRenderedSymbols(p),S=[];for(let M of Object.keys(w).map(Number))S.push(_[M]);S.sort(hp);for(let M of S){let A=M.featureIndex.lookupSymbolFeatures(w[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,o,c,y);for(let L in A){let F=x[L]=x[L]||[],N=A[L];N.sort((j,U)=>{let Z=M.featureSortOrder;if(Z){let q=Z.indexOf(j.featureIndex);return Z.indexOf(U.featureIndex)-q}return U.featureIndex-j.featureIndex});for(let j of N)F.push(j)}}return x}function dm(p,o){let c=p.getRenderableIds().map(y=>p.getTileByID(y)),f=[],_={};for(let y=0;y<c.length;y++){let x=c[y],w=x.tileID.canonical.key;_[w]||(_[w]=!0,x.querySourceFeatures(f,o))}return f}function hp(p,o){let c=p.tileID,f=o.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function ml(p,o){let c={};if(!o)return c;for(let f of p){let _=f.layerIds.map(y=>o.getLayer(y)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(y=>_.filter(x=>x.id===y)[0]));for(let y of _)c[y.fqid]=f}}return c}let Is=32,Ga=33,qa=new Uint16Array(8184);for(let p=0;p<2046;p++){let o=p+2,c=0,f=0,_=0,y=0,x=0,w=0;for(1&o?_=y=x=Is:c=f=w=Is;(o>>=1)>1;){let M=c+_>>1,A=f+y>>1;1&o?(_=c,y=f,c=x,f=w):(c=_,f=y,_=x,y=w),x=M,w=A}let S=4*p;qa[S+0]=c,qa[S+1]=f,qa[S+2]=_,qa[S+3]=y}let ya=new Uint16Array(2178),gl=new Uint8Array(1089),Gc=new Uint16Array(1089);function ed(p){return p===0?-.03125:p===32?.03125:0}let hm={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class td{constructor(o,c,f,_,y,x){this.tileID=o,this.uid=r.b2(),this.uses=0,this.tileSize=c,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(o){let c=o+this.timeAdded;c<r.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=ml(o.buckets,c.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof r.b4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof r.b4&&y.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(let _ in this.buckets){let y=this.buckets[_],x=c.style.getOwnLayer(_);if(!x)continue;let w=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,w)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,c,f){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,ml(o.buckets,c.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,c){for(let y in this.buckets){let x=this.buckets[y];if(x.uploadPending()){let w={},S=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){S=c.style.listImages();let A=x.layers[0],L=A.sourceLayer||"_geojsonTileLayer",F=c.style.getLayerSourceCache(A);F&&(w=F._state.getState(L,void 0))}M={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}x.upload(o,this.tileID.canonical,w,S,M)}}let f=o.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new r.T(o,_.image,f.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(o,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(o,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(o,c,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,f),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let o=0;for(let c in this.buckets){let f=this.buckets[c];f.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,f.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,c,f,_,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let w=this.evaluateQueryRenderedFeaturePadding(),S=(function(M,A){let L=r.bq([],[.5*M.width,.5*-M.height,1]);return r.br(L,L,[1,-1,0]),r.aB(L,L,M.calculateProjMatrix(A.toUnwrapped())),Float32Array.from(L)})(y,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:c,pixelPosMatrix:S,transform:_,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:w})}querySourceFeatures(o,c){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let _=f.loadVTLayers(),y=c?c.sourceLayer:"",x=_._geojsonTileLayer||_[y];if(!x)return;let w=r.b6(c&&c.filter),{z:S,x:M,y:A}=this.tileID.canonical,L={z:S,x:M,y:A};for(let F=0;F<x.length;F++){let N=x.feature(F);if(w.needGeometry){let Z=r.b7(N,!0);if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Z,this.tileID.canonical))continue}else if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),N))continue;let j=f.getId(N,y),U=new r.b8(N,S,M,A,j);U.tile=L,o.push(U)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){let c=this.expirationTime;if(o.cacheControl){let f=r.b9(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let f=Date.now(),_=!1;if(this.expirationTime>f)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{let y=this.expirationTime-c;y?this.expirationTime=f+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(let c in this.buckets)if(o.style.hasLayer(c)&&this.buckets[c].layers.some(f=>f.appearances&&f.appearances.length>0))return!0;return!1}updateBuckets(o,c){if(!this.latestFeatureIndex||!o.style)return;let f=o.style.listImages(),_=o.style.getBrightness();for(let y in this.buckets){if(!o.style.hasLayer(y))continue;let x=this.buckets[y],w=x.layers[0],S=w.sourceLayer||"_geojsonTileLayer",M=o.style.getLayerSourceCache(w),A={};M&&(A=M._state.getState(S,void 0));let L=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},F=Object.keys(A).length>0&&!c;x.hasAppearances=x.layers.some(U=>U.appearances&&U.appearances.length>0);let N=F?x.stateDependentLayers:x.layers;if(F&&x.stateDependentLayers.length!==0||c){let U=this.latestFeatureIndex.loadVTLayers();x.update(A,U[S],f,L,N,c,_)}if(F&&x.stateDependentLayers.length!==0||c||x.hasAppearances){let U={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};x.updateAppearances(this.tileID.canonical,A,f,U)}(x instanceof r.ba||x instanceof r.bb)&&o._terrain&&o._terrain.enabled&&M&&x.uploadPending()&&o._terrain._clearRenderCacheForTile(M.id,this.tileID);let j=o&&o.style&&o.style.getOwnLayer(y);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=r.o.now()+o}setTexture(o,c){let f=c.context,_=f.gl;this.texture=this.texture||c.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o):(this.texture=new r.T(f,o,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(o,c){let f={};for(let _ of c)f[_]=!0;this.dependencies[o]=f}hasDependency(o,c){for(let f of o){let _=this.dependencies[f];if(_){for(let y of c)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;let f=r.bc(hm,this.tileID.canonical,this.tileTransform)[0],_=new r.bd,y=new r.be;for(let x=0;x<f.length;x++){let{x:w,y:S}=f[x];_.emplaceBack(w,S),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(_,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;let f=r.bc(hm,this.tileID.canonical,this.tileTransform)[0],_,y;if(this.isRaster){let x=(function(w,S){let M=r.aZ(w,S),A=Math.pow(2,w.z);for(let Z=0;Z<Ga;Z++)for(let q=0;q<Ga;q++){let ee=r.a_((w.x+(q+ed(q))/Is)/A),re=r.a$((w.y+(Z+ed(Z))/Is)/A),ne=S.project(ee,re),ge=Z*Ga+q;ya[2*ge+0]=Math.round((ne.x*M.scale-M.x)*r.al),ya[2*ge+1]=Math.round((ne.y*M.scale-M.y)*r.al)}gl.fill(0),Gc.fill(0);for(let Z=2045;Z>=0;Z--){let q=4*Z,ee=qa[q+0],re=qa[q+1],ne=qa[q+2],ge=qa[q+3],de=ee+ne>>1,fe=re+ge>>1,ue=de+fe-re,ae=fe+ee-de,_e=re*Ga+ee,De=ge*Ga+ne,Ce=fe*Ga+de,Be=Math.hypot((ya[2*_e+0]+ya[2*De+0])/2-ya[2*Ce+0],(ya[2*_e+1]+ya[2*De+1])/2-ya[2*Ce+1])>=16;gl[Ce]=gl[Ce]||(Be?1:0),Z<1022&&(gl[Ce]=gl[Ce]||gl[(re+ae>>1)*Ga+(ee+ue>>1)]||gl[(ge+ae>>1)*Ga+(ne+ue>>1)])}let L=new r.b1,F=new r.b0,N=0;function j(Z,q){let ee=q*Ga+Z;return Gc[ee]===0&&(L.emplaceBack(ya[2*ee+0],ya[2*ee+1],Z*r.al/Is,q*r.al/Is),Gc[ee]=++N),Gc[ee]-1}function U(Z,q,ee,re,ne,ge){let de=Z+ee>>1,fe=q+re>>1;if(Math.abs(Z-ne)+Math.abs(q-ge)>1&&gl[fe*Ga+de])U(ne,ge,Z,q,de,fe),U(ee,re,ne,ge,de,fe);else{let ue=j(Z,q),ae=j(ee,re),_e=j(ne,ge);F.emplaceBack(ue,ae,_e)}}return U(0,0,Is,Is,Is,0),U(Is,Is,0,0,0,Is),{vertices:L,indices:F}})(this.tileID.canonical,c);_=x.vertices,y=x.indices}else{_=new r.b1,y=new r.b0;for(let{x:w,y:S}of f)_.emplaceBack(w,S,0,0);let x=r.bh(_.int16.subarray(0,4*_.length),void 0,4);for(let w=0;w<x.length;w+=3)y.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(_,r.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=r.bg.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(o,c){let f=c.projection;if(!f||f.name!=="globe"||c.freezeTileCoverage)return;let _=this.tileID.canonical,y=r.bj(_,c),x=r.bk(y),w=r.aj(c.zoom),S;w>0&&(S=r.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,_,c,x,S,w),this._makeGlobeTileDebugTextBuffer(o,_,c,x,S,w)}_globePoint(o,c,f,_,y,x,w){let S=r.bm(o,c,f);if(x){let M=1<<f.z,A=r.aF(_.center.lng),L=r.aJ(_.center.lat),F=(f.x+.5)/M-A,N=0;F>.5?N=-1:F<-.5&&(N=1);let j=(o/r.al+f.x)/M+N,U=(c/r.al+f.y)/M;j=(j-A)*_._pixelsPerMercatorPixel+A,U=(U-L)*_._pixelsPerMercatorPixel+L;let Z=[j*_.worldSize,U*_.worldSize,0];r.af(Z,Z,x),S=r.bn(S,Z,w)}return r.af(S,S,y)}_makeGlobeTileDebugBorderBuffer(o,c,f,_,y,x){let w=new r.bd,S=new r.be,M=new r.bo,A=(F,N,j,U,Z)=>{let q=(j-F)/(Z-1),ee=(U-N)/(Z-1),re=w.length;for(let ne=0;ne<Z;ne++){let ge=F+ne*q,de=N+ne*ee;w.emplaceBack(ge,de);let fe=this._globePoint(ge,de,c,f,_,y,x);M.emplaceBack(fe[0],fe[1],fe[2]),S.emplaceBack(re+ne)}},L=r.al;A(0,0,L,0,16),A(L,0,L,L,16),A(L,L,0,L,16),A(0,L,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(S),this._tileDebugBuffer=o.createVertexBuffer(w,r.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(M,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,w.length,S.length)}_makeGlobeTileDebugTextBuffer(o,c,f,_,y,x){let w=r.al/4,S=new r.bd,M=new r.b0,A=new r.bo,L=25;M.reserve(32),S.reserve(L),A.reserve(L);let F=(N,j)=>L*N+j;for(let N=0;N<L;N++){let j=N*w;for(let U=0;U<L;U++){let Z=U*w;S.emplaceBack(Z,j);let q=this._globePoint(Z,j,c,f,_,y,x);A.emplaceBack(q[0],q[1],q[2])}}for(let N=0;N<4;N++)for(let j=0;j<4;j++){let U=F(N,j),Z=F(N,j+1),q=F(N+1,j),ee=F(N+1,j+1);M.emplaceBack(U,Z,q),M.emplaceBack(q,Z,ee)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(M),this._tileDebugTextBuffer=o.createVertexBuffer(S,r.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(A,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,L,32)}destroy(o=!0){for(let c in this.buckets)this.buckets[c].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof r.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class pm extends td{constructor(o,c,f,_,y){super(o,c,f,_,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,c,f){let _=f.context,y=_.gl,x=this.texturePerLayer.get(o)||f.getTileTexture(c.width);x&&x instanceof r.T?x.update(c,{premultiply:!1}):x=new r.T(_,c,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,x)}flushQueues(o){let c=this._workQueuePerLayer.get(o)||[],f=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(let o of this._workQueuePerLayer.keys()){let c=this._workQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}for(let o of this._fetchQueuePerLayer.keys()){let c=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}}fetchHeader(o=16384,c){let f=this._mrt=new r.bs(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=r.bu(_,(y,x,w)=>{if(y)c(y);else try{let S=f.getHeaderLength(x);if(S>o)return void(this.request=this.fetchHeader(S,c));f.parseHeader(x),this._isHeaderLoaded=!0;let M=0;for(let A of Object.values(f.layers))M=Math.max(M,A.dataIndex[A.dataIndex.length-1].lastByte);x.byteLength>=M&&(this.entireBuffer=x),c(null,this.entireBuffer||x,w)}catch(S){c(S)}}),this.request}fetchBandForRender(o,c,f,_){this.fetchBand(o,c,f,y=>{if(y)return void _(y);this.updateTextureDescriptor(o,c,f);let x=this.textureDescriptorPerLayer.get(c);_(null,x?x.img:null)})}fetchBand(o,c,f,_,y=!0){let x=this._mrt;if(!this._isHeaderLoaded||!x)return void _(new Error("Tile header is not ready"));let w=this.actor;if(!w)return void _(new Error("Can't fetch tile band without an actor"));let S,M=r.B(String(f),r.B(this.tileID.key,o)),A=this._taskQueue.get(M);A?A.add(_):(A=new Set,A.add(_),this._taskQueue.set(M,A));let L=(U,Z)=>{S.complete(U,Z),U?_(U):(A.forEach(q=>q(null,Z)),this._taskQueue.delete(M))},F=(U,Z)=>{if(U)return _(U);let q=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Z,task:S},L,void 0,!0);if(c!==null){let ee=this._workQueuePerLayer.get(c)||[];ee.push(()=>{q&&q.cancel(),S.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,ee)}},N;try{N=x.getLayer(o)}catch(U){if(this.state==="reloading")return;throw U}if(!N)return void _(new Error(`Unknown sourceLayer "${o}"`));if(N.hasDataForBand(f))return A.forEach(U=>U(null,null)),void this._taskQueue.delete(M);let j=N.getDataRange([f]);if(S=x.createDecodingTask(j),!S||S.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)F(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{let U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),Z=r.bu(U,F);if(c!==null){let q=this._fetchQueuePerLayer.get(c)||[];q.push(()=>{Z.cancel(),S.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,q)}}}updateNeeded(o,c){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,c,f){if(!this._mrt)return;let _=this._mrt.getLayer(o);if(!_||!_.hasBand(f)||!_.hasDataForBand(f))return;let{bytes:y,tileSize:x,buffer:w,offset:S,scale:M}=_.getBandView(f),A=x+2*w,L=new r.q({width:A,height:A},y),F=this.texturePerLayer.get(c);F&&F instanceof r.T&&F.update(L,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:o,band:f,img:L,buffer:w,offset:S,tileSize:x,format:_.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(let c of this.texturePerLayer.values())c&&c instanceof r.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Pb{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(let o in this.data)for(let c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,f){let _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let y={value:c,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(o,y)},f)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){let c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;let f=o.wrapped().key,_=c===void 0?0:this.data[f].indexOf(c),y=this.data[f][_];return this.data[f].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){let c=[];for(let f in this.data)for(let _ of this.data[f])o(_.value)||c.push(_);for(let f of c)this.remove(f.value.tileID,f)}}class pp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,f){let _=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},Object.assign(this.stateChanges[o][_],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(let y in this.state[o])y!==_&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(let y in this.state[o][_])f[y]||(this.deletedStates[o][_][y]=null)}else for(let y in f)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][y]===null&&delete this.deletedStates[o][_][y]}removeFeatureState(o,c,f){if(this.deletedStates[o]===null)return;let _=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&c!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][f]=null);else if(c!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(f in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][f]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,c){let f=this.state[o]||{},_=this.stateChanges[o]||{},y=this.deletedStates[o];if(y===null)return{};if(c!==void 0){let w=String(c),S=Object.assign({},f[w],_[w]);if(y){let M=y[c];if(M===null)return{};for(let A in M)delete S[A]}return S}let x=Object.assign({},f,_);if(y)for(let w in y)delete x[w];return x}initializeTileState(o,c){o.refreshFeatureState(c)}coalesceChanges(o,c){let f={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let y={};for(let x in this.stateChanges[_])this.state[_][x]||(this.state[_][x]={}),Object.assign(this.state[_][x],this.stateChanges[_][x]),y[x]=this.state[_][x];f[_]=y}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let y={};if(this.deletedStates[_]===null)for(let x in this.state[_])y[x]={},this.state[_][x]={};else for(let x in this.deletedStates[_]){if(this.deletedStates[_][x]===null)this.state[_][x]={};else if(this.state[_][x])for(let w of Object.keys(this.deletedStates[_][x]))delete this.state[_][x][w];y[x]=this.state[_][x]}f[_]=f[_]||{},Object.assign(f[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let _ in o)o[_].refreshFeatureState(c)}}class Bs extends r.E{constructor(o,c,f){super(),this.id=o,this._onlySymbols=f,c.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Pb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let c in this._tiles){let f=this._tiles[c];f.upload(o,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(fm).map(o=>o.key)}getRenderableIds(o,c){let f=[];for(let _ in this._tiles)this._isIdRenderable(+_,o,c)&&f.push(this._tiles[_]);return o?f.sort((_,y)=>{let x=_.tileID,w=y.tileID,S=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new r.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||M.y-S.y||M.x-S.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(fm).map(_=>_.key)}hasRenderableParent(o){let c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c,f){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())&&(f||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){let f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,o,c)))}_tileLoaded(o,c,f,_,y){if(_){if(o.state="errored",_.status!==404)this._source.fire(new r.y(_,{tile:o}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=r.o.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let x=new Map;y&&y.responseHeaders&&(x=y.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(o){let c=this.getRenderableIds();for(let _=0;_<c.length;_++){let y=c[_];if(o.neighboringTiles&&o.neighboringTiles[y]){let x=this.getTileByID(y);f(o,x),f(x,o)}}function f(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-_.tileID.canonical.x,w=y.tileID.canonical.y-_.tileID.canonical.y,S=Math.pow(2,_.tileID.canonical.z),M=y.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+S)===1?x+=S:Math.abs(x-S)===1&&(x-=S)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,x,w),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,f,_){for(let y in this._tiles){let x=this._tiles[y];if(_[y]||!x.hasData()||x.tileID.overscaledZ<=c||x.tileID.overscaledZ>f)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>c+1;){let M=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[M.key],x&&x.hasData()&&(w=M)}let S=w;for(;S.overscaledZ>c;)if(S=S.scaledTo(S.overscaledZ-1),o[S.key]){_[w.key]=w;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){let f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=o.overscaledZ-1;f>=c;f--){let _=o.scaledTo(f),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(o){let c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;let f=Math.ceil(o.width/c)+1,_=Math.ceil(o.height/c)+1,y=Math.floor(f*_*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(o){let c=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,c){let f={};for(let _ in this._tiles){let y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+c),f[y.tileID.key]=y}this._tiles=f;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(o,c,f,_,y){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(o,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let x=this._source.type==="batched-model",w,S=this._source.maxzoom,M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){let F=M.attenuationRange()[0],N=Math.floor(F)-Math.log2(M.getDemUpscale());S>N&&(S=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new r.aQ(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){let F=o.clone();F.tileCoverLift=this.tileCoverLift,w=F.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&o.projection.name==="globe"&&(w.push(new r.aQ(1,0,1,0,0)),w.push(new r.aQ(1,0,1,1,0)),w.push(new r.aQ(1,0,1,0,1)),w.push(new r.aQ(1,0,1,1,1)))}else if(w=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){let F=this._source.hasTile.bind(this._source);w=w.filter(N=>F(N))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!nd(this._source.type)){let F=o.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),N=Math.min(F,this._source.maxzoom);if(x){let j=o.extendTileCover(w,N);for(let U of j)w.push(U)}else if(y){let j=o.extendTileCoverToNearPlane(w,this.transform.getFrustum(N),N);for(let U of j)w.push(U)}else if(this.castsShadows&&_){let j=o.extendTileCover(w,N,_,16);for(let U of j)this._shadowCasterTiles[U.key]=!0,w.push(U)}}let A=this._updateRetainedTiles(w);if(nd(this._source.type)&&w.length!==0){let F={},N={},j=Object.keys(A);for(let Z of j){let q=A[Z],ee=this._tiles[Z];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=r.o.now())continue;let re=this.findLoadedParent(q,Math.max(q.overscaledZ-Bs.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),F[re.tileID.key]=re.tileID),N[Z]=q}let U=w[w.length-1].overscaledZ;for(let Z in this._tiles){let q=this._tiles[Z];if(A[Z]||!q.hasData())continue;let ee=q.tileID;for(;ee.overscaledZ>U;){ee=ee.scaledTo(ee.overscaledZ-1);let re=this._tiles[ee.key];if(re&&re.hasData()&&N[ee.key]){A[Z]=q.tileID;break}}}for(let Z in F)A[Z]||(this._coveredTiles[Z]=!0,A[Z]=F[Z])}for(let F in A)this._tiles[F].clearFadeHold();let L=r.bv(this._tiles,A);for(let F of L){let N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let c={};if(o.length===0)return c;let f={},_=o.reduce((M,A)=>Math.min(M,A.overscaledZ),1/0),y=o[0].overscaledZ,x=Math.max(y-Bs.maxOverzooming,this._source.minzoom),w=Math.max(y+Bs.maxUnderzooming,this._source.minzoom),S={};for(let M of o){let A=this._addTile(M);c[M.key]=M,A.hasData()||_<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,_,w,c);for(let M of o){let A=this._tiles[M.key];if(A.hasData())continue;if(M.canonical.z>=this._source.maxzoom){let F=M.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){c[F.key]=F;continue}}else{let F=M.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let L=A.wasRequested();for(let F=M.overscaledZ-1;F>=x;--F){let N=M.scaledTo(F);if(f[N.key]||(f[N.key]=!0,A=this.getTile(N),!A&&L&&(A=this._addTile(N)),A&&(c[N.key]=N,L=A.wasRequested(),A.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let c=[],f,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}c.push(_.key);let y=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;_=y}for(let y of c)this._loadedParentTiles[y]=f}}_addTile(o){let c=this._tiles[o.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));let f=!!c;if(!f){let _=this.map?this.map.painter:null,y=this._source.tileSize*o.overscaleFactor();c=this._source.type==="raster-array"?new pm(o,y,this.transform.tileZoom,_,this._isRaster):new td(o,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c.uses++,this._tiles[o.key]=c,f||this._source.fire(new r.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let f=c.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){let c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,f){let _=[],y=this.transform;if(!y)return _;let x=y.projection.name==="globe",w=r.aF(y.center.lng);for(let S in this._tiles){let M=this._tiles[S];if(f&&M.clearQueryDebugViz(),M.holdingForFade())continue;let A;if(x){let L=M.tileID.canonical;if(L.z===0){let F=[Math.abs(r.aA(w,...Ql(L,-1))-w),Math.abs(r.aA(w,...Ql(L,1))-w)];A=[0,2*F.indexOf(Math.min(...F))-1]}else{let F=[Math.abs(r.aA(w,...Ql(L,-1))-w),Math.abs(r.aA(w,...Ql(L,0))-w),Math.abs(r.aA(w,...Ql(L,1))-w)];A=[F.indexOf(Math.min(...F))-1]}}else A=[0];for(let L of A){let F=o.containsTile(M,y,c,L);F&&_.push(F)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,c){let f=this.getRenderableIds(o,c).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(let y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(o){let c=o.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(let x of c){let w=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*w+x.wrap-f[0])*_[0]+((x.canonical.y+.5)*w-f[1])*_[1]-f[2]*_[2]}return c.sort((x,w)=>y[x.key]-y[w.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(nd(this._source.type))for(let o in this._tiles){let c=this._tiles[o];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(o,c,f){this._state.updateState(o=o||"_geojsonTileLayer",c,f)}removeFeatureState(o,c,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,f)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,f){let _=this._tiles[o];_&&_.setDependencies(c,f)}reloadTilesForDependencies(o,c){for(let f in this._tiles)this._tiles[f].hasDependency(o,c)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,c))}_preloadTiles(o,c){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,c))};return void this._source.on("data",S)}let f=new Map,_=Array.isArray(o)?o:[o],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let S of _){let M=S.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of M)f.set(A.key,A);this.usedForTerrain&&S.updateElevation(!1)}let w=Array.from(f.values());r.bw(w,(S,M)=>{let A=new td(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(A,L=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),M(L,A)})},c)}}function fm(p,o){let c=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return p.overscaledZ-o.overscaledZ||f-c||o.canonical.y-p.canonical.y||o.canonical.x-p.canonical.x}function nd(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function Ql(p,o){let c=1<<p.z;return[p.x/c+o,(p.x+1)/c+o]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class HT{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,c=!1;for(let f in this.style._mergedLayers){let _=this.style._mergedLayers[f];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:o,visibilityChanged:c});else if(_.type==="model"){let y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:o,visibilityChanged:c})}}}onNewFrame(o){this.layersGotHidden=!1;for(let c of this.layers){let f=c.layer,_=!1;f.type==="fill-extrusion"?_=!f.isHidden(o)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?_=!f.isHidden(o)&&f.paint.get("building-opacity")>0:f.type==="model"&&(_=!f.isHidden(o)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&c.visible,c.visible=_}}updateZOffset(o,c){this.currentBuildingBuckets=[];for(let _ of this.layers){let y=_.layer,x=this.style.getLayerSourceCache(y),w=1;y.type==="fill-extrusion"?w=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(w=_.visible?y.paint.get("building-vertical-scale"):0);let S=x?x.getTile(c):null;if(!S&&x)for(let M in x._tiles){let A=x._tiles[M];if(c.canonical.isChildOf(A.tileID.canonical)){S=A;break}}this.currentBuildingBuckets.push({bucket:S?S.getBucket(y):null,tileID:S?S.tileID:c,verticalScale:w})}o.hasAnyZOffset=!1;let f=!1;for(let _=0;_<o.symbolInstances.length;_++){let y=o.symbolInstances.get(_),x=y.zOffset,w=this._getHeightAtTileOffset(c,y.tileAnchorX,y.tileAnchorY);y.zOffset=w!==Number.NEGATIVE_INFINITY?w:x,f||x===y.zOffset||(f=!0),o.hasAnyZOffset||y.zOffset===0||(o.hasAnyZOffset=!0)}f&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,c,f,_){let y=c,x=f;if(o.canonical.z!==_.canonical.z){let w=_.canonical,S=1/(1<<o.canonical.z-w.z);y=(c+o.canonical.x*r.al)*S-w.x*r.al|0,x=(f+o.canonical.y*r.al)*S-w.y*r.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(o,c,f){let _,y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;let{bucket:S,tileID:M,verticalScale:A}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(o,c,f,M),N=S.getHeightAtTileCoord(L,F);N&&N.height!==void 0&&(N.hidden?_=N.height:y=Math.max(N.height*A,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let w=this.layers[x];if(w.layer.type!=="model"||!w.visible)continue;let{bucket:S,tileID:M}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:A,tileY:L}=this._mapCoordToOverlappingTile(o,c,f,M),F=S.getHeightAtTileCoord(A,L);if(F&&!F.hidden)return F.height===void 0&&_!==void 0?Math.min(F.maxHeight,_)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ob(p,o){let c={};for(let f in p)f!=="ref"&&(c[f]=p[f]);return r.bx.forEach(f=>{f in o&&(c[f]=o[f])}),c}function fp(p){p=p.slice();let o=Object.create(null);for(let c=0;c<p.length;c++)o[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Ob(p[c],o[p[c].ref]));return p}let qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function mm(p,o,c){c.push({command:qn.addSource,args:[p,o[p]]})}function D0(p,o,c){o.push({command:qn.removeSource,args:[p]}),c[p]=!0}function Rb(p,o,c,f){D0(p,c,f),mm(p,o,c)}function kb(p,o,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!r.by(p[c][f],o[c][f]))return!1;for(f in o[c])if(o[c].hasOwnProperty(f)&&f!=="data"&&!r.by(p[c][f],o[c][f]))return!1;return!0}function qc(p,o,c,f,_,y){let x;for(x in o=o||{},p=p||{})p.hasOwnProperty(x)&&(r.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}));for(x in o)o.hasOwnProperty(x)&&!p.hasOwnProperty(x)&&(r.by(p[x],o[x])||c.push({command:y,args:[f,x,o[x],_]}))}function mp(p){return p.id}function gp(p,o){return p[o.id]=o,p}function A0(p,o,c){let f=o.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.aB(new Float32Array(16),p.projMatrix,f)}function gm(p,o,c){if(o.projection.name===c.projection.name)return p.projMatrix;let f=c.clone();return f.setProjection(o.projection),A0(f,o.getProjection(),p)}function _l(p,o,c){return o.name===c.projection.name?p.projMatrix:A0(c,o,p)}class _p{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.aA(o,0,1);let c=1,f=this._distances[c],_=o*this.paddedLength+this.padding;for(;f<_&&c<this._distances.length;)f=this._distances[++c];let y=c-1,x=this._distances[y],w=f-x,S=w>0?(_-x)/w:0;return this.points[y].mult(1-S).add(this.points[c].mult(S))}}class P0{constructor(o,c,f){let _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(c/f);for(let x=0;x<this.xCellCount*this.yCellCount;x++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,f,_,y){this._forEachCell(c,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(o,c,f,_){this._forEachCell(c-_,f-_,c+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(f),this.circles.push(_)}_insertBoxCell(o,c,f,_,y,x){this.boxCells[y].push(x)}_insertCircleCell(o,c,f,_,y,x){this.circleCells[y].push(x)}_query(o,c,f,_,y,x){if(f<0||o>this.width||_<0||c>this.height)return!y&&[];let w=[];if(o<=0&&c<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let S=0;S<this.boxKeys.length;S++)w.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let M=this.circles[3*S],A=this.circles[3*S+1],L=this.circles[3*S+2];w.push({key:this.circleKeys[S],x1:M-L,y1:A-L,x2:M+L,y2:A+L})}return x?w.filter(x):w}return this._forEachCell(o,c,f,_,this._queryCell,w,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?w.length>0:w}_queryCircle(o,c,f,_,y){let x=o-f,w=o+f,S=c-f,M=c+f;if(w<0||x>this.width||M<0||S>this.height)return!_&&[];let A=[];return this._forEachCell(x,S,w,M,this._queryCellCircle,A,{hitTest:_,circle:{x:o,y:c,radius:f},seenUids:{box:{},circle:{}}},y),_?A.length>0:A}query(o,c,f,_,y){return this._query(o,c,f,_,!1,y)}hitTest(o,c,f,_,y){return this._query(o,c,f,_,!0,y)}hitTestCircle(o,c,f,_){return this._queryCircle(o,c,f,!0,_)}_queryCell(o,c,f,_,y,x,w,S){let M=w.seenUids,A=this.boxCells[y];if(A!==null){let F=this.bboxes;for(let N of A)if(!M.box[N]){M.box[N]=!0;let j=4*N;if(o<=F[j+2]&&c<=F[j+3]&&f>=F[j+0]&&_>=F[j+1]&&(!S||S(this.boxKeys[N]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[N],x1:F[j],y1:F[j+1],x2:F[j+2],y2:F[j+3]})}}}let L=this.circleCells[y];if(L!==null){let F=this.circles;for(let N of L)if(!M.circle[N]){M.circle[N]=!0;let j=3*N;if(this._circleAndRectCollide(F[j],F[j+1],F[j+2],o,c,f,_)&&(!S||S(this.circleKeys[N]))){if(w.hitTest)return x.push(!0),!0;{let U=F[j],Z=F[j+1],q=F[j+2];x.push({key:this.circleKeys[N],x1:U-q,y1:Z-q,x2:U+q,y2:Z+q})}}}}}_queryCellCircle(o,c,f,_,y,x,w,S){let M=w.circle,A=w.seenUids,L=this.boxCells[y];if(L!==null){let N=this.bboxes;for(let j of L)if(!A.box[j]){A.box[j]=!0;let U=4*j;if(this._circleAndRectCollide(M.x,M.y,M.radius,N[U+0],N[U+1],N[U+2],N[U+3])&&(!S||S(this.boxKeys[j])))return x.push(!0),!0}}let F=this.circleCells[y];if(F!==null){let N=this.circles;for(let j of F)if(!A.circle[j]){A.circle[j]=!0;let U=3*j;if(this._circlesCollide(N[U],N[U+1],N[U+2],M.x,M.y,M.radius)&&(!S||S(this.circleKeys[j])))return x.push(!0),!0}}}_forEachCell(o,c,f,_,y,x,w,S){let M=this._convertToXCellCoord(o),A=this._convertToYCellCoord(c),L=this._convertToXCellCoord(f),F=this._convertToYCellCoord(_);for(let N=M;N<=L;N++)for(let j=A;j<=F;j++)if(y.call(this,o,c,f,_,this.xCellCount*j+N,x,w,S))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,f,_,y,x){let w=_-o,S=y-c,M=f+x;return M*M>w*w+S*S}_circleAndRectCollide(o,c,f,_,y,x,w){let S=(x-_)/2,M=Math.abs(o-(_+S));if(M>S+f)return!1;let A=(w-y)/2,L=Math.abs(c-(y+A));if(L>A+f)return!1;if(M<=S||L<=A)return!0;let F=M-S,N=L-A;return F*F+N*N<=f*f}}let Wc={unknown:0,flipRequired:1,flipNotRequired:2},id=Math.tan(85*Math.PI/180);function as(p,o,c,f,_,y,x){let w=r.bC();if(c)if(y.name==="globe"){let S=r.bD(_,o);r.aB(w,w,S)}else{let S=r.bE([],x);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3],f||r.bB(w,w,_.angle)}else r.aB(w,_.labelPlaneMatrix,p);return w}function _m(p,o,c,f,_,y,x){let w=as(p,o,c,f,_,y,x);return y.name==="globe"&&c||(w[2]=w[6]=w[10]=w[14]=0),w}function vp(p,o,c,f,_,y,x){if(c){if(y.name==="globe"){let w=as(p,o,c,f,_,y,x);return r.bl(w,w),r.aB(w,p,w),w}{let w=r.bz(p),S=r.bA([]);return S[0]=x[0],S[1]=x[1],S[4]=x[2],S[5]=x[3],r.aB(w,w,S),f||r.bB(w,w,-_.angle),w}}return _.glCoordMatrix}function xa(p,o,c,f){let _=[p,o,c,1];c?r.aC(_,_,f):Zt(_,_,f);let y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function ui(p,o){return Math.min(.5+p/o*.5,1.5)}function Fb(p,o){let c=p[0]/p[3],f=p[1]/p[3];return c>=-o[0]&&c<=o[0]&&f>=-o[1]&&f<=o[1]}function Lb(p,o,c,f,_,y,x,w,S,M,A=1){let L=c.transform,F=f?p.textSizeData:p.iconSizeData,N=r.bK(F,c.transform.zoom,A),j=L.projection.name==="globe",U=[256/c.width*2+1,256/c.height*2+1],Z=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Z.clear();let q=null;j&&(q=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let ee=p.lineVertexArray,re=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,ne=c.transform.width/c.transform.height,ge,de=!1;for(let fe=0;fe<re.length;fe++){let ue=re.get(fe),{numGlyphs:ae,writingMode:_e}=ue;if(_e!==r.bL.vertical||de||ge===r.bL.horizontal||(de=!0),ge=_e,(ue.hidden||_e===r.bL.vertical)&&!de){Wa(ae,Z);continue}de=!1;let De=new r.P(ue.tileAnchorX,ue.tileAnchorY),Ce=p.elevationType==="road",Be=!!L.elevation||Ce,{x:Ue,y:Ye,z:dt}=L.projection.projectTilePoint(De.x,De.y,M.canonical),Fe=null;if(Be){let Ot=Ce?p.getElevationFeatureForText(fe):null;Fe={getElevation:S,elevation:L.elevation,elevationFeature:Ot};let[Jt,fn,Fn]=S(De,L.elevation,Ot);Ue+=Jt,Ye+=fn,dt+=Fn}let be=[Ue,Ye,dt,1];if(r.aC(be,be,o),!Fb(be,U)){Wa(ae,Z);continue}let Ge=be[3],Le=ui(c.transform.getCameraToCenterDistance(L.projection),Ge),tt=r.bM(F,N,ue),bt=x?tt/Le:tt*Le,At=xa(Ue,Ye,dt,_);if(At[3]<=0){Wa(ae,Z);continue}let _t={},pt=r.an(p.layers[0].layout.get("text-max-angle")),jt=Math.cos(pt),zt=x?null:Fe,Tt=O0(ue,bt,!1,w,o,_,y,p.glyphOffsetArray,ee,Z,q,At,De,_t,ne,zt,L.projection,M,x,jt);de=Tt.useVertical,zt&&Tt.needsFlipping&&(_t={}),(Tt.notEnoughRoom||de||Tt.needsFlipping&&O0(ue,bt,!0,w,o,_,y,p.glyphOffsetArray,ee,Z,q,At,De,_t,ne,zt,L.projection,M,x,jt).notEnoughRoom)&&Wa(ae,Z)}f?(p.text.dynamicLayoutVertexBuffer.updateData(Z),q&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(Z),q&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(q))}function Nb(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z){let{lineStartIndex:q,glyphStartIndex:ee,segment:re}=w,ne=ee+w.numGlyphs,ge=q+w.lineLength,de=o.getoffsetX(ee),fe=o.getoffsetX(ne-1),ue=Yd(p*de,c,f,_,y,x,re,q,ge,S,M,A,L,F,!0,N,j,U,Z);if(!ue)return null;let ae=Yd(p*fe,c,f,_,y,x,re,q,ge,S,M,A,L,F,!0,N,j,U,Z);return ae?{first:ue,last:ae}:null}function on(p,o,c,f){return p===r.bL.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:p===r.bL.vertical?f>0?{needsFlipping:!0}:null:o!==Wc.unknown&&(function(_,y){return _===0||Math.abs(y/_)>id})(c,f)?o===Wc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function O0(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee,re){let ne=o/24,ge=p.lineOffsetX*ne,de=p.lineOffsetY*ne,{lineStartIndex:fe,glyphStartIndex:ue,numGlyphs:ae,segment:_e,writingMode:De,flipState:Ce}=p,Be=fe+p.lineLength,Ue=Ye=>{if(A){let[Ge,Le,tt]=Ye.up,bt=M.length;r.bN(A,bt+0,Ge,Le,tt),r.bN(A,bt+1,Ge,Le,tt),r.bN(A,bt+2,Ge,Le,tt),r.bN(A,bt+3,Ge,Le,tt)}let[dt,Fe,be]=Ye.point;r.bO(M,dt,Fe,be,Ye.angle)};if(ae>1){let Ye=Nb(ne,w,ge,de,c,L,F,p,S,y,N,U,!1,Z,q,ee,re);if(!Ye)return{notEnoughRoom:!0};if(f&&!c){let[dt,Fe,be]=Ye.first.point,[Ge,Le,tt]=Ye.last.point;[dt,Fe]=xa(dt,Fe,be,x),[Ge,Le]=xa(Ge,Le,tt,x);let bt=on(De,Ce,(Ge-dt)*j,Le-Fe);if(p.flipState=bt&&bt.needsFlipping?Wc.flipRequired:Wc.flipNotRequired,bt)return bt}Ue(Ye.first);for(let dt=ue+1;dt<ue+ae-1;dt++){let Fe=Yd(ne*w.getoffsetX(dt),ge,de,c,L,F,_e,fe,Be,S,y,N,U,!1,!1,Z,q,ee,re);if(!Fe)return M.length-=4*(dt-ue),{notEnoughRoom:!0};Ue(Fe)}Ue(Ye.last)}else{if(f&&!c){let dt=xa(F.x,F.y,0,_),Fe=fe+_e+1,be=new r.P(S.getx(Fe),S.gety(Fe)),Ge=xa(be.x,be.y,0,_),Le=Ge[3]>0?Ge:ba(F,be,dt,1,_,void 0,Z,q.canonical),tt=on(De,Ce,(Le[0]-dt[0])*j,Le[1]-dt[1]);if(p.flipState=tt&&tt.needsFlipping?Wc.flipRequired:Wc.flipNotRequired,tt)return tt}let Ye=Yd(ne*w.getoffsetX(ue),ge,de,c,L,F,_e,fe,Be,S,y,N,U,!1,!1,Z,q,ee,re);if(!Ye)return{notEnoughRoom:!0};Ue(Ye)}return{}}function yp(p,o,c,f,_){let{x:y,y:x,z:w}=f.projectTilePoint(p.x,p.y,o);if(!_)return xa(y,x,w,c);let[S,M,A]=_.getElevation(p,_.elevation,_.elevationFeature);return xa(y+S,x+M,w+A,c)}function ba(p,o,c,f,_,y,x,w){let S=yp(p.sub(o)._unit()._add(p),w,_,x,y);return r.av(S,c,S),r.aw(S,S),r.bH(S,c,S,f)}function Yd(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee){let re=f?p-o:p+o,ne=re>0?1:-1,ge=0;f&&(ne*=-1,ge=Math.PI),ne<0&&(ge+=Math.PI);let de=w+x+(ne>0?0:1)|0,fe=_,ue=_,ae=0,_e=0,De=Math.abs(re),Ce=[],Be=[],Ue=y,Ye=Ue,dt=r.bF([]),Fe=()=>ba(Ye,Ue,ue,De-ae+1,A,F,U,Z.canonical);for(;ae+_e<=De;){if(de+=ne,de<w||de>=S)return null;if(ue=fe,Ye=Ue,Ce.push(ue),N&&Be.push(Ye),Ue=new r.P(M.getx(de),M.gety(de)),fe=L[de],!fe){let zt=yp(Ue,Z.canonical,A,U,F);fe=zt[3]>0?L[de]=zt:Fe()}ae+=_e;let pt=r.av([],fe,ue),jt=r.bG(ue,fe);if(c&&jt>0&&_e>0&&r.bJ(dt,pt)/(_e*jt)<ee)return null;_e=jt,dt=pt}j&&F&&(L[de]&&(fe=Fe(),_e=r.bG(ue,fe),dt=r.av([],fe,ue)),L[de]=fe);let be=(De-ae)/_e,Ge=Ue.sub(Ye)._mult(be)._add(Ye),Le=r.bH([],ue,dt,be),tt=[0,0,1],bt=dt[0],At=dt[1];if(q&&(tt=U.upVector(Z.canonical,Ge.x,Ge.y),tt[0]!==0||tt[1]!==0||tt[2]!==1)){let pt=[tt[2],0,-tt[0]],jt=r.bI([],tt,pt);r.aw(pt,pt),r.aw(jt,jt),bt=r.bJ(dt,pt),At=r.bJ(dt,jt)}if(c){let pt=r.bI([],tt,dt);r.aw(pt,pt),r.bH(Le,Le,pt,c*ne)}let _t=ge+Math.atan2(At,bt);return Ce.push(Le),N&&Be.push(Ge),{point:Le,angle:_t,path:Ce,tilePath:Be,up:tt}}function Wa(p,o){let c=o.length,f=c+4*p;o.resize(f),o.float32.fill(-1/0,4*c,4*f)}function Zt(p,o,c){let f=o[0],_=o[1];return p[0]=c[0]*f+c[4]*_+c[12],p[1]=c[1]*f+c[5]*_+c[13],p[3]=c[3]*f+c[7]*_+c[15],p}let Bn=100;class mi{constructor(o,c,f=new P0(o.width+200,o.height+200,25),_=new P0(o.width+200,o.height+200,25)){this.transform=o,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Bn,this.screenBottomBoundary=o.height+Bn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,f,_,y,x,w,S,M,A,L){let F=f.projectedAnchorX,N=f.projectedAnchorY,j=f.projectedAnchorZ,U=f.tileAnchorX,Z=f.tileAnchorY,q=f.elevation,ee=f.tileID,re=o.getProjection();if(q&&ee){let[Be,Ue,Ye]=re.upVector(ee.canonical,f.tileAnchorX,f.tileAnchorY),dt=re.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Be*q*dt,N+=Ue*q*dt,j+=Ye*q*dt}let ne=o.projection.name==="globe",ge=o.projection.name==="globe"?r.aj(this.transform.zoom):0;if(ee&&ne&&ge<1&&!x){let Be=1<<ee.canonical.z,Ue=r.bP(U,Z);r.bQ(Ue,Ue,1/r.al),r.bR(Ue,Ue,r.bP(ee.canonical.x,ee.canonical.y)),r.bQ(Ue,Ue,1/Be),r.bS(Ue,Ue,r.bP(_[0],_[1])),Ue[0]=r.bT(Ue[0],-.5,.5),r.bQ(Ue,Ue,r.al);let Ye=r.bU(Ue[0],Ue[1],r.al/(2*Math.PI),1);r.aC(Ye,Ye,y),F=r.ak(F,Ye[0],ge),N=r.ak(N,Ye[1],ge),j=r.ak(j,Ye[2],ge)}let de=this.projectAndGetPerspectiveRatio(A,F,N,j,f.tileID,re.name==="globe"||!!q||this.transform.pitch>0,re),fe=M*de.perspectiveRatio,ue=(f.x1*c+w.x-f.padding)*fe+de.point.x,ae=(f.y1*c+w.y-f.padding)*fe+de.point.y,_e=(f.x2*c+w.x+f.padding)*fe+de.point.x,De=(f.y2*c+w.y+f.padding)*fe+de.point.y,Ce=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(ue,ae,_e,De)||!S&&this.grid.hitTest(ue,ae,_e,De,L)||Ce?{box:[],offscreen:!1,occluded:de.occluded}:{box:[ue,ae,_e,De],offscreen:this.isOffscreen(ue,ae,_e,De),occluded:!1}}placeCollisionCircles(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z){let q=[],ee=this.transform.elevation,re=o.getProjection(),ne=o.elevationType==="road",ge=!!ee||ne,de=r.bV.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,re),fe=new r.P(f.tileAnchorX,f.tileAnchorY),ue=new r.P(f.tileAnchorX,f.tileAnchorY),{x:ae,y:_e,z:De}=re.projectTilePoint(ue.x,ue.y,Z.canonical),Ce=null;if(ge){let jt=ne?o.getElevationFeatureForText(_):null;Ce={getElevation:de,elevation:ee,elevationFeature:jt};let[zt,Tt,Ot]=de(fe,ee,jt);ae+=zt,_e+=Tt,De+=Ot}let Be=re.name==="globe",Ue=this.projectAndGetPerspectiveRatio(S,ae,_e,De,Z,Be||!!ee||this.transform.pitch>0,re),{perspectiveRatio:Ye}=Ue,dt=(F?w/Ye:w*Ye)/r.bY,Fe=xa(ae,_e,De,M),be=f.lineOffsetX*dt,Ge=f.lineOffsetY*dt,Le=r.an(o.layers[0].layout.get("text-max-angle")),tt=Math.cos(Le),bt=Ue.signedDistanceFromCamera>0?Nb(dt,x,be,Ge,ne&&f.flipState===1,Fe,ue,f,y,M,{},ge&&!F?Ce:null,F&&ge,re,Z,F,tt):null,At=!1,_t=!1,pt=!0;if(bt&&!Ue.occluded){let jt=.5*j*Ye+U,zt=new r.P(-100,-100),Tt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Ot=new _p,{first:Jt,last:fn}=bt,Fn=Jt.path.length,Jn=[];for(let pn=Fn-1;pn>=1;pn--)Jn.push(Jt.path[pn]);for(let pn=1;pn<fn.path.length;pn++)Jn.push(fn.path[pn]);let $t=2.5*jt;A&&(Jn=Jn.map(([pn,ii,gi],di)=>(ge&&!Be&&(gi=de(di<Fn-1?Jt.tilePath[Fn-1-di]:fn.tilePath[di-Fn+2],ee,Ce.elevationFeature)[2]),xa(pn,ii,gi,A))),Jn.some(pn=>pn[3]<=0)&&(Jn=[]));let Yn=[];if(Jn.length>0){let pn=1/0,ii=-1/0,gi=1/0,di=-1/0;for(let Wn of Jn)pn=Math.min(pn,Wn[0]),gi=Math.min(gi,Wn[1]),ii=Math.max(ii,Wn[0]),di=Math.max(di,Wn[1]);ii>=zt.x&&pn<=Tt.x&&di>=zt.y&&gi<=Tt.y&&(Yn=[Jn.map(Wn=>new r.P(Wn[0],Wn[1]))],(pn<zt.x||ii>Tt.x||gi<zt.y||di>Tt.y)&&(Yn=r.bW(Yn,zt.x,zt.y,Tt.x,Tt.y)))}for(let pn of Yn){Ot.reset(pn,.25*jt);let ii=0;ii=Ot.length<=.5*jt?1:Math.ceil(Ot.paddedLength/$t)+1;for(let gi=0;gi<ii;gi++){let di=gi/Math.max(ii-1,1),Wn=Ot.lerp(di),wn=Wn.x+Bn,ti=Wn.y+Bn;q.push(wn,ti,jt,0);let ur=wn-jt,Ki=ti-jt,ri=wn+jt,$n=ti+jt;if(pt=pt&&this.isOffscreen(ur,Ki,ri,$n),_t=_t||this.isInsideGrid(ur,Ki,ri,$n),!c&&this.grid.hitTestCircle(wn,ti,jt,N)&&(At=!0,!L))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!L&&At||!_t?[]:q,offscreen:pt,collisionDetected:At,occluded:Ue.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],f=1/0,_=1/0,y=-1/0,x=-1/0;for(let A of o){let L=new r.P(A.x+Bn,A.y+Bn);f=Math.min(f,L.x),_=Math.min(_,L.y),y=Math.max(y,L.x),x=Math.max(x,L.y),c.push(L)}let w=this.grid.query(f,_,y,x).concat(this.ignoredGrid.query(f,_,y,x)),S={},M={};for(let A of w){let L=A.key;if(S[L.bucketInstanceId]===void 0&&(S[L.bucketInstanceId]={}),S[L.bucketInstanceId][L.featureIndex])continue;let F=[new r.P(A.x1,A.y1),new r.P(A.x2,A.y1),new r.P(A.x2,A.y2),new r.P(A.x1,A.y2)];r.bX(c,F)&&(S[L.bucketInstanceId][L.featureIndex]=!0,M[L.bucketInstanceId]===void 0&&(M[L.bucketInstanceId]=[]),M[L.bucketInstanceId].push(L.featureIndex))}return M}insertCollisionBox(o,c,f,_,y){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,f,_,y){let x=c?this.ignoredGrid:this.grid,w={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let S=0;S<o.length;S+=4)x.insertCircle(w,o[S],o[S+1],o[S+2])}projectAndGetPerspectiveRatio(o,c,f,_,y,x,w){let S=[c,f,_,1],M=!1;_||this.transform.pitch>0?(r.aC(S,S,o),this.fogState&&y&&w.name!=="globe"&&(M=(function(F,N,j,U,Z,q){let ee=q.calculateFogTileMatrix(Z),re=[N,j,U];return r.af(re,re,ee),Ft(F,r.ag(re),q.pitch,q._fov)})(this.fogState,c,f,_,y.toUnwrapped(),this.transform)>.9)):Zt(S,S,o);let A=S[3];return{point:new r.P((S[0]/A+1)/2*this.transform.width+Bn,(-S[1]/A+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/A*.5,1.5),signedDistanceFromCamera:A,occluded:x&&S[2]>A||M}}isOffscreen(o,c,f,_){return f<Bn||o>=this.screenRightBoundary||_<Bn||c>this.screenBottomBoundary}isInsideGrid(o,c,f,_){return f>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let o=r.bA([]);return r.br(o,o,[-100,-100,0]),o}}class Ms{constructor(o,c,f,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class vl{constructor(o,c,f,_,y,x=!1){this.text=new Ms(o?o.text:null,c,f,y),this.icon=new Ms(o?o.icon:null,c,_,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ai{constructor(o,c,f,_=!1){this.text=o,this.icon=c,this.skipFade=f,this.clipped=_}}class vm{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class xp{constructor(o,c,f,_,y){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class bp{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[o]}}function Xo(p,o,c,f,_){let{horizontalAlign:y,verticalAlign:x}=r.c1(p),w=-(y-.5)*o,S=-(x-.5)*c,M=r.c2(p,f);return new r.P(w+M[0]*_,S+M[1]*_)}function jr(p,o,c,f,_){let y=new r.P(p,o);return c&&y._rotate(f?_:-_),y}class GT{constructor(o,c,f,_,y,x){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new mi(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new bp(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,c,f,_,y=1){let x=f.getBucket(c),w=f.latestFeatureIndex;if(!x||!w||c.fqid!==x.layerIds[0])return;let S=x.layers[0].layout,M=x.layers[0].paint,A=f.collisionBoxArray,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),F=f.tileSize/r.al,N=f.tileID.toUnwrapped();this.transform.setProjection(x.projection);let j=(U=f.tileID,Z=x.getProjection(),q=this.transform,Z.name===this.projection?q.calculateProjMatrix(U.toUnwrapped()):A0(q,Z,U));var U,Z,q;let ee=S.get("text-pitch-alignment")==="map",re=S.get("text-rotation-alignment")==="map";c.compileFilter(c.options);let ne=c.dynamicFilter(),ge=c.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(f),fe=_m(j,f.tileID.canonical,ee,re,this.transform,x.getProjection(),de),ue=null,ae=x.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(ee){let be=vp(j,f.tileID.canonical,ee,re,this.transform,x.getProjection(),de);ue=r.aB([],this.transform.labelPlaneMatrix,be)}let _e=null;ne&&f.latestFeatureIndex&&(_e={unwrappedTileID:N,dynamicFilter:ne,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new xp(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,f.tileID);let[De,Ce]=x.layers[0].layout.get("text-size-scale-range"),Be=r.aA(y,De,Ce),[Ue,Ye]=S.get("icon-size-scale-range"),dt=r.aA(y,Ue,Ye),Fe={bucket:x,layout:S,paint:M,posMatrix:j,invMatrix:ae,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:fe,labelToScreenMatrix:ue,clippingData:_e,scale:L,textPixelRatio:F,holdingForFade:f.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:r.bK(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:r.bK(x.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(let be of x.sortKeyRanges){let{sortKey:Ge,symbolInstanceStart:Le,symbolInstanceEnd:tt}=be;o.push({sortKey:Ge,symbolInstanceStart:Le,symbolInstanceEnd:tt,parameters:Fe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee,re,ne,ge){let{textOffset0:de,textOffset1:fe,crossTileID:ue}=U,ae=[de,fe],_e=Xo(o,x,w,ae,S),De=this.collisionIndex.placeCollisionBox(q,S,c,f,_,y,jr(_e.x,_e.y,M,A,this.transform.angle),j,L,F,N.predicate);if(re){let Ce=q.getSymbolInstanceIconSize(ge,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ce,re,f,_,y,jr(_e.x,_e.y,M,A,this.transform.angle),j,L,F,N.predicate).box.length===0)return}if(De.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Ce=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ae,width:x,height:w,anchor:o,textScale:S,prevAnchor:Ce},this.markUsedJustification(q,o,U,ee),q.allowVerticalPlacement&&(this.markUsedOrientation(q,ee,U),this.placedOrientations[ue]=ee),{shift:_e,placedGlyphBoxes:De}}}placeLayerBucketPart(o,c,f,_,y=1){let{bucket:x,layout:w,paint:S,posMatrix:M,textLabelPlaneMatrix:A,labelToScreenMatrix:L,clippingData:F,textPixelRatio:N,mercatorCenter:j,invMatrix:U,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:re,collisionGroup:ne,latestFeatureIndex:ge}=o.parameters,de=w.get("text-optional"),fe=w.get("icon-optional"),ue=w.get("text-allow-overlap"),ae=w.get("icon-allow-overlap"),_e=w.get("text-rotation-alignment")==="map",De=w.get("icon-rotation-alignment")==="map",Ce=w.get("text-pitch-alignment")==="map",Be=S.get("symbol-z-offset"),Ue=w.get("symbol-elevation-reference")==="sea",Ye=w.get("symbol-placement"),[dt,Fe]=w.get("text-size-scale-range"),[be,Ge]=w.get("icon-size-scale-range"),Le=r.aA(y,dt,Fe),tt=r.aA(y,be,Ge),bt=w.get("text-variable-anchor"),At=_e&&Ye!=="point",_t=De&&Ye!=="point",pt=bt&&x.hasTextData(),jt=x.hasIconTextFit()&&pt&&x.hasIconData();this.transform.setProjection(x.projection);let zt=pt||At,Tt=_t||jt,Ot=ue&&(ae||!x.hasIconData()||fe),Jt=ae&&(ue||!x.hasTextData()||de),fn=!Be.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),f&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,q,Le,tt);let Fn=($t,Yn,pn)=>{let{crossTileID:ii,numVerticalGlyphVertices:gi}=$t,di=null;if(F&&F.dynamicFilterNeedsFeature||fn){let _r=this.retainedQueryData[x.bucketInstanceId];di=ge.loadFeature({featureIndex:$t.featureIndex,bucketIndex:_r.bucketIndex,sourceLayerIndex:_r.sourceLayerIndex,layoutVertexArrayOffset:0});let Mr=di.properties?di.properties.worldview:null;if(x.localizable&&x.worldview&&typeof Mr=="string")if(Mr==="all")di.properties.$localized=!0;else{if(!Mr.split(",").includes(x.worldview))return;di.properties.$localized=!0,di.properties.worldview=x.worldview}}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},di,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P($t.tileAnchorX,$t.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[ii]=new ai(!1,!1,!1,!0),void c.add(ii);let Wn=Be.evaluate(di,{});if(c.has(ii))return;if(Z)return void(this.placements[ii]=new ai(!1,!1,!1));let wn=!1,ti=!1,ur=!0,Ki=!1,ri=!1,$n=null,Cn={box:null,offscreen:null,occluded:null},Gi={box:null},Cr=null,ir=null,Ti=null,_s=0,Lo=0,Jr=0;pn.textFeatureIndex?_s=pn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(_s=$t.featureIndex),pn.verticalTextFeatureIndex&&(Lo=pn.verticalTextFeatureIndex);let Qo=x.elevationFeatures?x.elevationFeatures[$t.elevationFeatureIndex]:void 0,Jo=_r=>{_r.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Mr=this.transform.elevation;_r.elevation=Ue?Wn:Wn+r.bV.getAtTileOffset(_r.tileID,new r.P(_r.tileAnchorX,_r.tileAnchorY),Mr,Qo),_r.elevation+=$t.zOffset},Do=pn.textBox;if(Do){Jo(Do);let _r=Ii=>{let Lr=r.bL.horizontal;if(x.allowVerticalPlacement&&!Ii&&this.prevPlacement){let dr=this.prevPlacement.placedOrientations[ii];dr&&(this.placedOrientations[ii]=dr,Lr=dr,this.markUsedOrientation(x,Lr,$t))}return Lr},Mr=(Ii,Lr)=>{if(x.allowVerticalPlacement&&gi>0&&pn.verticalTextBox){for(let dr of x.writingModes)if(dr===r.bL.vertical?(Cn=Lr(),Gi=Cn):Cn=Ii(),Cn&&Cn.box&&Cn.box.length)break}else Cn=Ii()};if(bt){let Ii=bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ii]){let rr=this.prevPlacement.variableOffsets[ii];Ii.indexOf(rr.anchor)>0&&(Ii=Ii.filter(Da=>Da!==rr.anchor),Ii.unshift(rr.anchor))}let Lr=(rr,Da,Xp)=>{let Qa=x.getSymbolInstanceTextSize(ee,$t,this.transform.zoom,Yn),Kp=(rr.x2-rr.x1)*Qa+2*rr.padding,yh=(rr.y2-rr.y1)*Qa+2*rr.padding,Il=$t.hasIconTextFit&&!ae?Da:null;Il&&Jo(Il);let hc={box:[],offscreen:!1,occluded:!1},xh=ue?2*Ii.length:Ii.length;for(let cu=0;cu<xh;++cu){let pc=this.attemptAnchorPlacement(Ii[cu%Ii.length],rr,j,U,zt,Kp,yh,Qa,_e,Ce,N,M,ne,cu>=Ii.length,$t,Yn,x,Xp,Il,ee,re);if(pc&&(hc=pc.placedGlyphBoxes,hc&&hc.box&&hc.box.length)){wn=!0,$n=pc.shift;break}}return hc};Mr(()=>Lr(Do,pn.iconBox,r.bL.horizontal),()=>{let rr=pn.verticalTextBox;return rr&&Jo(rr),x.allowVerticalPlacement&&!(Cn&&Cn.box&&Cn.box.length)&&gi>0&&rr?Lr(rr,pn.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}}),Cn&&(wn=Cn.box,ur=Cn.offscreen,Ki=Cn.occluded);let dr=_r(!(!Cn||!Cn.box));if(!wn&&this.prevPlacement){let rr=this.prevPlacement.variableOffsets[ii];rr&&(this.variableOffsets[ii]=rr,this.markUsedJustification(x,rr.anchor,$t,dr))}}else{let Ii=(Lr,dr)=>{let rr=x.getSymbolInstanceTextSize(ee,$t,this.transform.zoom,Yn),Da=this.collisionIndex.placeCollisionBox(x,rr,Lr,j,U,zt,new r.P(0,0),ue,N,M,ne.predicate);return Da&&Da.box&&Da.box.length&&(this.markUsedOrientation(x,dr,$t),this.placedOrientations[ii]=dr),Da};Mr(()=>Ii(Do,r.bL.horizontal),()=>{let Lr=pn.verticalTextBox;return x.allowVerticalPlacement&&gi>0&&Lr?(Jo(Lr),Ii(Lr,r.bL.vertical)):{box:null,offscreen:null,occluded:null}}),_r(!!(Cn&&Cn.box&&Cn.box.length))}}if(Cr=Cn,wn=Cr&&Cr.box&&Cr.box.length>0,ur=Cr&&Cr.offscreen,Ki=Cr&&Cr.occluded,$t.useRuntimeCollisionCircles){let _r=$t.centerJustifiedTextSymbolIndex>=0?$t.centerJustifiedTextSymbolIndex:$t.verticalPlacedTextSymbolIndex,Mr=x.text.placedSymbolArray.get(_r),Ii=r.bM(x.textSizeData,ee,Mr),Lr=w.get("text-padding");ir=this.collisionIndex.placeCollisionCircles(x,ue,Mr,_r,x.lineVertexArray,x.glyphOffsetArray,Ii,M,A,L,f,Ce,ne.predicate,$t.collisionCircleDiameter*Ii/r.bY,Lr,this.retainedQueryData[x.bucketInstanceId].tileID),wn=ue||ir.circles.length>0&&!ir.collisionDetected,ur=ur&&ir.offscreen,Ki=ir.occluded}if(pn.iconFeatureIndex&&(Jr=pn.iconFeatureIndex),pn.iconBox){let _r=Mr=>{Jo(Mr);let Ii=$t.hasIconTextFit&&$n?jr($n.x,$n.y,_e,Ce,this.transform.angle):new r.P(0,0),Lr=x.getSymbolInstanceIconSize(re,this.transform.zoom,$t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Lr,Mr,j,U,Tt,Ii,ae,N,M,ne.predicate)};Gi&&Gi.box&&Gi.box.length&&pn.verticalIconBox?(Ti=_r(pn.verticalIconBox),ti=Ti.box.length>0):(Ti=_r(pn.iconBox),ti=Ti.box.length>0),ur=ur&&Ti.offscreen,ri=Ti.occluded}let ra=de||$t.numHorizontalGlyphVertices===0&&gi===0,Ma=fe||$t.numIconVertices===0;if(ra||Ma?Ma?ra||(ti=ti&&wn):wn=ti&&wn:ti=wn=ti&&wn,wn&&Cr&&Cr.box&&this.collisionIndex.insertCollisionBox(Cr.box,w.get("text-ignore-placement"),x.bucketInstanceId,Gi&&Gi.box&&Lo?Lo:_s,ne.ID),ti&&Ti&&this.collisionIndex.insertCollisionBox(Ti.box,w.get("icon-ignore-placement"),x.bucketInstanceId,Jr,ne.ID),ir&&(wn&&this.collisionIndex.insertCollisionCircles(ir.circles,w.get("text-ignore-placement"),x.bucketInstanceId,_s,ne.ID),f)){let _r=x.bucketInstanceId,Mr=this.collisionCircleArrays[_r];Mr===void 0&&(Mr=this.collisionCircleArrays[_r]=new vm);for(let Ii=0;Ii<ir.circles.length;Ii+=4)Mr.circles.push(ir.circles[Ii+0]),Mr.circles.push(ir.circles[Ii+1]),Mr.circles.push(ir.circles[Ii+2]),Mr.circles.push(ir.collisionDetected?1:0)}let Ps=x.projection.name!=="globe";Ot=Ot&&(Ps||!Ki),Jt=Jt&&(Ps||!ri),this.placements[ii]=new ai(wn||Ot,ti||Jt,ur||x.justReloaded),c.add(ii)},Jn=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,Jn),x.elevationType==="road"&&x.updateRoadElevation(Jn.canonical),x.updateZOffset(),x.sortFeaturesByY){let $t=x.getSortedSymbolIndexes(this.transform.angle);for(let Yn=$t.length-1;Yn>=0;--Yn){let pn=$t[Yn];Fn(x.symbolInstances.get(pn),pn,x.collisionArrays[pn])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let $t=x.getSortedIndexesByZOffset();for(let Yn=0;Yn<$t.length;++Yn){let pn=$t[Yn];Fn(x.symbolInstances.get(pn),pn,x.collisionArrays[pn])}}else for(let $t=o.symbolInstanceStart;$t<o.symbolInstanceEnd;$t++)Fn(x.symbolInstances.get($t),$t,x.collisionArrays[$t]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){let $t=this.collisionCircleArrays[x.bucketInstanceId];r.bl($t.invProjMatrix,M),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,f,_){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:S,crossTileID:M}=f,A=r.c3(c),L=_===r.bL.vertical?S:A==="left"?y:A==="center"?x:A==="right"?w:-1;y>=0&&(o.text.placedSymbolArray.get(y).crossTileID=L>=0&&y!==L?0:M),x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=L>=0&&x!==L?0:M),w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=L>=0&&w!==L?0:M),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=L>=0&&S!==L?0:M)}markUsedOrientation(o,c,f){let _=c===r.bL.horizontal||c===r.bL.horizontalOnly?c:0,y=c===r.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M}=f,A=o.text.placedSymbolArray;x>=0&&(A.get(x).placedOrientation=_),w>=0&&(A.get(w).placedOrientation=_),S>=0&&(A.get(S).placedOrientation=_),M>=0&&(A.get(M).placedOrientation=y)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let _=c?c.symbolFadeChange(o):1,y=c?c.opacities:{},x=c?c.variableOffsets:{},w=c?c.placedOrientations:{};for(let S in this.placements){let M=this.placements[S],A=y[S];A?(this.opacities[S]=new vl(A,_,M.text,M.icon,null,M.clipped),f=f||M.text!==A.text.placed||M.icon!==A.icon.placed):(this.opacities[S]=new vl(null,_,M.text,M.icon,M.skipFade,M.clipped),f=f||M.text||M.icon)}for(let S in y){let M=y[S];if(!this.opacities[S]){let A=new vl(M,_,!1,!1);A.isHidden()||(this.opacities[S]=A,f=f||M.text.placed||M.icon.placed)}}for(let S in x)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=x[S]);for(let S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c,f,_){_&&(this.lastReplacementSourceUpdateTime=_.updateTime);let y=new Set;for(let x of c){let w=x.getBucket(o);w&&x.latestFeatureIndex&&o.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,y,x,x.collisionBoxArray,f,_,x.tileID,o.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,x.tileID),w.elevationType==="road"&&w.updateRoadElevation(x.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(o,c,f,_,y,x,w,S){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let M=o.layers[0].layout,A=o.layers[0].paint,L=!!o.layers[0].dynamicFilter(),F=new vl(null,0,!1,!1,!0),N=M.get("text-allow-overlap"),j=M.get("icon-allow-overlap"),U=M.get("text-variable-anchor"),Z=M.get("text-rotation-alignment")==="map",q=M.get("text-pitch-alignment")==="map",ee=A.get("symbol-z-offset"),re=M.get("symbol-elevation-reference")==="sea",ne=!ee.isConstant(),ge=new vl(null,0,N&&(j||!o.hasIconData()||M.get("icon-optional")),j&&(N||!o.hasTextData()||M.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);let de=(ue,ae,_e)=>{for(let De=0;De<ae/4;De++)ue.opacityVertexArray.emplaceBack(_e)},fe=0;x&&o.updateReplacement(w,x);for(let ue=0;ue<o.symbolInstances.length;ue++){let ae=o.symbolInstances.get(ue),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:De,crossTileID:Ce,numIconVertices:Be,tileAnchorX:Ue,tileAnchorY:Ye}=ae,dt=null,Fe=this.retainedQueryData[o.bucketInstanceId];ne&&ae&&Fe&&(dt=f.latestFeatureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));let be=ee.evaluate(dt,{}),Ge=c.has(Ce),Le=this.opacities[Ce];Ge?Le=F:Le||(Le=ge,this.opacities[Ce]=Le),c.add(Ce);let tt=_e>0||De>0,bt=Be>0,At=this.placedOrientations[Ce],_t=At===r.bL.vertical,pt=At===r.bL.horizontal||At===r.bL.horizontalOnly;!tt&&!bt||Le.isHidden()||fe++;let jt=!1;if((tt||bt)&&x)for(let zt of o.activeReplacements){if(r.bZ(zt,y,r.b_.Symbol,S)||zt.min.x>Ue||Ue>zt.max.x||zt.min.y>Ye||Ye>zt.max.y)continue;let Tt=r.b$(Ue,Ye,w.canonical,zt.footprintTileId.canonical);if(jt=r.c0(Tt,zt.footprint),jt)break}if(tt){let zt=jt?rd:ps(Le.text);de(o.text,_e,_t?rd:zt),de(o.text,De,pt?rd:zt);let Tt=Le.text.isHidden(),{leftJustifiedTextSymbolIndex:Ot,centerJustifiedTextSymbolIndex:Jt,rightJustifiedTextSymbolIndex:fn,verticalPlacedTextSymbolIndex:Fn}=ae,Jn=o.text.placedSymbolArray,$t=Tt||_t?1:0;Ot>=0&&(Jn.get(Ot).hidden=$t),Jt>=0&&(Jn.get(Jt).hidden=$t),fn>=0&&(Jn.get(fn).hidden=$t),Fn>=0&&(Jn.get(Fn).hidden=Tt||pt?1:0);let Yn=this.variableOffsets[Ce];Yn&&this.markUsedJustification(o,Yn.anchor,ae,At);let pn=this.placedOrientations[Ce];pn&&(this.markUsedJustification(o,"left",ae,pn),this.markUsedOrientation(o,pn,ae))}if(bt){let zt=jt?rd:ps(Le.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:Ot}=ae,Jt=o.icon.placedSymbolArray,fn=Le.icon.isHidden()?1:0;Tt>=0&&(de(o.icon,Be,_t?rd:zt),Jt.get(Tt).hidden=fn),Ot>=0&&(de(o.icon,ae.numVerticalIconVertices,pt?rd:zt),Jt.get(Ot).hidden=fn)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let zt=o.collisionArrays[ue];if(zt){let Tt=new r.P(0,0),Ot=!0;if(zt.textBox||zt.verticalTextBox){if(U){let fn=this.variableOffsets[Ce];fn?(Tt=Xo(fn.anchor,fn.width,fn.height,fn.textOffset,fn.textScale),Z&&Tt._rotate(q?this.transform.angle:-this.transform.angle)):Ot=!1}L&&(Ot=!Le.clipped),zt.textBox&&Zc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!Ot||_t,be,re,Tt.x,Tt.y),zt.verticalTextBox&&Zc(o.textCollisionBox.collisionVertexArray,Le.text.placed,!Ot||pt,be,re,Tt.x,Tt.y)}let Jt=Ot&&!!(!pt&&zt.verticalIconBox);zt.iconBox&&Zc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,Jt,be,re,ae.hasIconTextFit?Tt.x:0,ae.hasIconTextFit?Tt.y:0),zt.verticalIconBox&&Zc(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,!Jt,be,re,ae.hasIconTextFit?Tt.x:0,ae.hasIconTextFit?Tt.y:0)}}}if(o.fullyClipped=fe===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ue.invProjMatrix,o.placementViewportMatrix=ue.viewportMatrix,o.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){let f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>o}isStale(){return this.stale}setStale(){this.stale=!0}}function Zc(p,o,c,f,_,y,x){p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0),p.emplaceBack(o?1:0,c?1:0,y||0,x||0,f,_?1:0)}let R0=Math.pow(2,25),wp=Math.pow(2,24),ym=Math.pow(2,17),k0=Math.pow(2,16),xm=Math.pow(2,9),hs=Math.pow(2,8),Jl=Math.pow(2,1);function ps(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let o=p.placed?1:0,c=Math.floor(127*p.opacity);return c*R0+o*wp+c*ym+o*k0+c*xm+o*hs+c*Jl+o}let rd=0;class Xd{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,f,_,y,x){let w=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(w,_,o[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<w.length;){let S=w[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class po{constructor(o,c,f,_,y,x,w,S,M){this.placement=new GT(o,y,x,w,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,f,_,y){let x=r.o.now(),w=()=>{let S=r.o.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){let S=c[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&S.visibility!=="none"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){let A=S,L=A.layout.get("symbol-z-elevate"),F=A.layout.get("symbol-sort-key").constantOr(1)!==void 0,N=A.layout.get("symbol-z-order"),j=N==="viewport-y"||N==="auto"&&!(N!=="viewport-y"&&F),U=A.layout.get("text-allow-overlap")||A.layout.get("icon-allow-overlap")||A.layout.get("text-ignore-placement")||A.layout.get("icon-ignore-placement"),Z=j&&U,q=this._inProgressLayer=this._inProgressLayer||new Xd(A),ee=r.B(S.source,S.scope);if(q.continuePlacement(L||Z?_[ee]:f[ee],this.placement,this._showCollisionBoxes,S,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let wa=512/r.al/2;class ec{constructor(o,c,f){this.tileID=o,this.bucketInstanceId=f,this.index=new r.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=o.canonical.x*r.al,y=o.canonical.y*r.al;for(let x=0;x<c.length;x++){let{key:w,crossTileID:S,tileAnchorX:M,tileAnchorY:A}=c.get(x),L=Math.floor((_+M)*wa),F=Math.floor((y+A)*wa);this.index.add(L,F),this.keys.push(w),this.crossTileIDs.push(S)}this.index.finish()}findMatches(o,c,f){let _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),y=wa/Math.pow(2,c.canonical.z-this.tileID.canonical.z),x=c.canonical.x*r.al,w=c.canonical.y*r.al;for(let S=0;S<o.length;S++){let M=o.get(S);if(M.crossTileID)continue;let{key:A,tileAnchorX:L,tileAnchorY:F}=M,N=Math.floor((x+L)*y),j=Math.floor((w+F)*y),U=this.index.range(N-_,j-_,N+_,j+_).sort((Z,q)=>Z-q);for(let Z of U){let q=this.crossTileIDs[Z];if(this.keys[Z]===A&&!f.has(q)){f.add(q),M.crossTileID=q;break}}}}}class oo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class F0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let c=Math.round((o-this.lng)/360);if(c!==0)for(let f in this.indexes){let _=this.indexes[f],y={};for(let x in _){let w=_[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),y[w.tileID.key]=w}this.indexes[f]=y}this.lng=o}addBucket(o,c,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let y=0;y<c.symbolInstances.length;y++)c.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let _=this.usedCrossTileIDs[o.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>o.overscaledZ)for(let w in x){let S=x[w];S.tileID.isChildOf(o)&&S.findMatches(c.symbolInstances,o,_)}else{let w=x[o.scaledTo(Number(y)).key];w&&w.findMatches(c.symbolInstances,o,_)}}for(let y=0;y<c.symbolInstances.length;y++){let x=c.symbolInstances.get(y);x.crossTileID||(x.crossTileID=f.generate(),_.add(x.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ec(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(let f of c.crossTileIDs)this.usedCrossTileIDs[o].delete(f)}removeStaleBuckets(o){let c=!1;for(let f in this.indexes){let _=this.indexes[f];for(let y in _)o[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],c=!0)}return c}}class Za{constructor(){this.layerIndexes={},this.crossTileIDs=new oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,f,_){let y=this.layerIndexes[o.fqid];y===void 0&&(y=this.layerIndexes[o.fqid]=new F0);let x=!1,w={};_.name!=="globe"&&y.handleWrapJump(f);for(let S of c){let M=S.getBucket(o);M&&o.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,M,this.crossTileIDs)&&(x=!0),w[M.bucketInstanceId]=!0)}return y.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(o){let c={};o.forEach(f=>{c[f]=!0});for(let f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}let yl=771;class xn{constructor(o,c,f,_){this.blendFunction=o,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=_}}xn.Replace=[1,0,1,0],xn.disabled=new xn(xn.Replace,r.ao.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,r.ao.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,yl,1,yl],r.ao.transparent,[!0,!0,!0,!0]),xn.alphaBlendedNonPremultiplied=new xn([770,yl,770,yl],r.ao.transparent,[!0,!0,!0,!0]),xn.multiply=new xn([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),xn.additive=new xn([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class Gt{constructor(o,c,f){this.func=o,this.mask=c,this.range=f}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);let bm=7680;class cn{constructor(o,c,f,_,y,x){this.test=o,this.ref=c,this.mask=f,this.fail=_,this.depthFail=y,this.pass=x}}cn.disabled=new cn({func:519,mask:0},0,0,bm,bm,bm);let Kd=1029,wm=2305;class ln{constructor(o,c,f){this.enable=o,this.mode=c,this.frontFace=f}}function xl(p,o){let c=r.ca(p,3);r.cc(p,o),r.cg(p,3,c)}function L0(p,o){let c=r.c7([]);return r.c8(c,c,-o),r.c9(c,c,-p),c}function Cm(p,o){let c=[p[0],p[1],0],f=[o[0],o[1],0];if(r.ag(c)>=1e-15){let x=r.aw([],c);r.c5(f,x,r.bJ(f,x)),o[0]=f[0],o[1]=f[1]}let _=r.bI([],o,p);if(r.c6(_)<1e-15)return null;let y=Math.atan2(-_[1],_[0]);return L0(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),y)}ln.disabled=new ln(!1,Kd,wm),ln.backCCW=new ln(!0,Kd,wm),ln.backCW=new ln(!0,Kd,2304),ln.frontCW=new ln(!0,1028,2304),ln.frontCCW=new ln(!0,1028,wm);class fs{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){let c=o instanceof r.ae?o:new r.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=r.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c,f){if(this.orientation=null,!this.position)return;let _=this.position,y=f||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(o)):0),x=r.ae.fromLngLat(o,y),w=[x.x-_.x,x.y-_.y,x.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Cm(w,c)}setPitchBearing(o,c){this.orientation=L0(r.an(o),r.an(-c))}}class Em{constructor(o,c){this._transform=r.bA([]),this.orientation=c,this.position=o}get mercatorPosition(){let o=this.position;return new r.ae(o[0],o[1],o[2])}get position(){let o=r.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&r.cg(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.c7([]),o&&xl(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=L0(o,c),xl(this._transform,this._orientation)}forward(){let o=r.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=r.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=r.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){let f=new Float64Array(16);return r.bl(f,this.getWorldToCamera(o,c)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,c,f){let _=this.position;r.c5(_,_,-o);let y=new Float64Array(16);return r.bq(y,[f,f,f]),r.br(y,y,_),y[10]*=c,y}getWorldToCamera(o,c){let f=new Float64Array(16),_=new Float64Array(4),y=this.position;return r.cb(_,this._orientation),r.c5(y,y,-o),r.cc(f,_),r.br(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(o,c,f,_){let y=new Float64Array(16);return r.cd(y,o,c,f,_),y}getCameraToClipOrthographic(o,c,f,_,y,x){let w=new Float64Array(16);return r.ce(w,o,c,f,_,y,x),w}getDistanceToElevation(o,c=!1){let f=o===0?0:r.cf(o,c?r.a$(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Em([...this.position],[...this.orientation])}}let Co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Sm{constructor(o=0,c=0,f=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=f,this.right=_}interpolate(o,c,f){return c.top!=null&&o.top!=null&&(this.top=r.ak(o.top,c.top,f)),c.bottom!=null&&o.bottom!=null&&(this.bottom=r.ak(o.bottom,c.bottom,f)),c.left!=null&&o.left!=null&&(this.left=r.ak(o.left,c.left,f)),c.right!=null&&o.right!=null&&(this.right=r.ak(o.right,c.right,f)),this}getCenter(o,c){let f=r.aA((this.left+o-this.right)/2,0,o),_=r.aA((this.top+c-this.bottom)/2,0,c);return new r.P(f,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Sm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Ya=15;class N0{constructor(o,c,f,_,y,x,w){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new r.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Sm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Em,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let o=new N0(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ya}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,c=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(o||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=r.cm(this.projectionOptions);let f=this.getProjection(),_=!r.by(c,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cm({name:"mercator"});let c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let c=-o*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=r.cn(),r.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let c=r.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;let o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),_=0,y=0;for(let x=0;x<c.length;x++){let w=new r.P(c[x][0]*this.width,f+c[x][1]*(this.height-f)),S=o.pointCoordinate(w);if(!S)continue;let M=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);_+=S[3]*M,y+=M}return y===0?NaN:_/y}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){let c=this.elevation,f=o.elevation,_=c!=null!=(f!=null)||c&&f&&c.exaggeration()!==f.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!_}computeZoomRelativeTo(o){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),f;f=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];let _=r.ag(r.av([],this._camera.position,f));return r.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!r.cp(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){let f=[o.position.x,o.position.y,o.position.z];r.cq(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,c=new fs;return c.position=new r.ae(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!r.cr(o))return!1;r.cs(o,o);let c=r.ct([],[0,0,-1],o),f=r.ct([],[0,-1,0],o);if(f[2]<0)return!1;let _=Cm(c,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){let c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=r.aA(o[2],_/f,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,f){this._unmodified=!1,this._edgeInsets.interpolate(o,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){let c=[new r.cu(0,o)];if(this.renderWorldCopies){let f=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),w=Math.floor(Math.min(f.x,_.x,y.x,x.x)),S=Math.floor(Math.max(f.x,_.x,y.x,x.x)),M=1;for(let A=w-M;A<=S+M;A++)A!==0&&c.push(new r.cu(A,o))}return c}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,c,f,_){let y=[],x=f!=null,w=!x;if(w&&this.zoom<c||x&&f[0]===0&&f[1]===0)return y;let S=new Set,M=(L,F,N,j,U)=>{let Z=r.cY(F,L,N,j,U);S.has(Z)||(y.push(new r.aQ(L,F,N,j,U)),S.add(Z))};for(let L=0;L<o.length;L++){let F=o[L];if(w&&F.canonical.z!==c||x&&_!==void 0&&_>F.canonical.z)continue;let N=F.canonical,j=F.overscaledZ,U=F.wrap,Z=1<<N.z,q=N.x+1<Z,ee=N.x>0,re=N.y+1<Z,ne=N.y>0,ge=F.wrap-(ee?0:1),de=F.wrap+(q?0:1),fe=ee?N.x-1:Z-1,ue=q?N.x+1:0;if(x)f[0]<0?(M(j,de,N.z,ue,N.y),f[1]<0&&re&&(M(j,U,N.z,N.x,N.y+1),M(j,de,N.z,ue,N.y+1)),f[1]>0&&ne&&(M(j,U,N.z,N.x,N.y-1),M(j,de,N.z,ue,N.y-1))):f[0]>0?(M(j,ge,N.z,fe,N.y),f[1]<0&&re&&(M(j,U,N.z,N.x,N.y+1),M(j,ge,N.z,fe,N.y+1)),f[1]>0&&ne&&(M(j,U,N.z,N.x,N.y-1),M(j,ge,N.z,fe,N.y-1))):f[1]<0&&re?M(j,U,N.z,N.x,N.y+1):ne&&M(j,U,N.z,N.x,N.y-1);else{let ae=F.visibleQuadrants;1&ae&&(M(j,ge,N.z,fe,N.y),ne&&(M(j,U,N.z,N.x,N.y-1),M(j,ge,N.z,fe,N.y-1))),2&ae&&(M(j,de,N.z,ue,N.y),ne&&(M(j,U,N.z,N.x,N.y-1),M(j,de,N.z,ue,N.y-1))),4&ae&&(M(j,ge,N.z,fe,N.y),re&&(M(j,U,N.z,N.x,N.y+1),M(j,ge,N.z,fe,N.y+1))),8&ae&&(M(j,de,N.z,ue,N.y),re&&(M(j,U,N.z,N.x,N.y+1),M(j,de,N.z,ue,N.y+1)))}}let A=[];for(let L of y)y.some(F=>L.isChildOf(F))||A.push(L);if(y=A.filter(L=>!o.some(F=>!!(L.overscaledZ<c&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),w){let L=1<<c,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[L*F.x,L*F.y],j=4,U=j*j;y=y.filter(Z=>{let q=Z.canonical.x+.5-N[0],ee=Z.canonical.y+.5-N[1];return q*q+ee*ee<U})}return y}extendTileCoverToNearPlane(o,c,f){let _=[],y=new Set;for(let ee of o)y.add(ee.key);let x=(ee,re,ne,ge,de)=>{let fe=r.cY(re,ee,ne,ge,de);y.has(fe)||(_.push(new r.aQ(ee,re,ne,ge,de)),y.add(fe))},w=o.reduce((ee,re)=>Math.max(ee,re.overscaledZ),f),S=1<<f,M=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],A=new r.P(0,0),L=new r.P(0,0),F=(ee,re)=>{let ne=Math.floor(ee[0]),ge=Math.floor(ee[1]),de=(ee[0]-ne)*r.al,fe=(ee[1]-ge)*r.al,ue=Math.floor(re[0]),ae=Math.floor(re[1]),_e=(re[0]-ue)*r.al,De=(re[1]-ae)*r.al;for(let Ce=-1;Ce<=1;Ce++){let Be=ne+Ce;if(!(Be<0||Be>=S)){A.x=de-Ce*r.al,L.x=_e-(Be-ue)*r.al;for(let Ue=-1;Ue<=1;Ue++){let Ye=ge+Ue;A.y=fe-Ue*r.al,L.y=De-(Ye-ae)*r.al,r.cZ(A,L,M)&&x(w,0,f,Be,Ye)}}}},N=c.points,j=N[r.cv],U=N[r.cw],Z=this._projectToGround(j,N[r.cx]),q=this._projectToGround(U,N[r.cy]);return F(j,Z),F(U,q),_}_projectToGround(o,c){return r.cz(r.cA(),o,c,o[2]/(o[2]-c[2]))}coveringTiles(o){let c=this.coveringZoomLevel(o),f=c,_=this.elevation&&this.elevation.exaggeration(),y=_&&!o.isTerrainDEM,x=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);let w=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,A=[M*w.x,M*w.y,0],L=this.projection.name==="globe",F=!L,N=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,F),j=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=M*r.cf(1,this.center.lat),Z=this._camera.position[2]/r.cf(1,this.center.lat),q=[M*j.x,M*j.y,Z*(F?1:U)],ee=L||_,re=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ne=this.isLODDisabled(!0)?c:0,ge;if(this._elevation&&o.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let be=this._elevation.getMinMaxForVisibleTiles();ge=be?be.max:this._centerAltitude}else ge=this._centerAltitude;let de=o.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?r.cC(this):1,ue=be=>{let Le=new r.ae(be.x+25e-6,be.y,be.z),tt=new r.ae(be.x,be.y+25e-6,be.z),bt=be.toLngLat(),At=Le.toLngLat(),_t=tt.toLngLat(),pt=this.locationCoordinate(bt),jt=this.locationCoordinate(At),zt=this.locationCoordinate(_t),Tt=Math.hypot(jt.x-pt.x,jt.y-pt.y),Ot=Math.hypot(zt.x-pt.x,zt.y-pt.y);return Math.sqrt(Tt*Ot)*fe/25e-6},ae=be=>{let Ge=ge,Le=de;return{aabb:r.cF(this,M,0,0,0,be,Le,Ge,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:Ge,wrap:be,fullyVisible:!1}},_e=[],De=[],Ce=c,Be=o.reparseOverscaled?f:c,Ue=(Z-this._centerAltitude)*U,Ye=be=>{if(!this._elevation||!be.tileID||!x)return;let Ge=this._elevation.getMinMaxForTile(be.tileID),Le=be.aabb;Ge?(Le.min[2]=Ge.min,Le.max[2]=Ge.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(be.shouldSplit=Fe(be),be.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},dt=(be,Ge)=>{if(.707*Ge<be)return 1;let Le=Ge/be;return Le/(1.4144271570014144+(Math.pow(1.1,Le-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=be=>{if(be.zoom<ne)return!0;if(be.zoom===Ce)return!1;if(be.shouldSplit!=null)return be.shouldSplit;let Ge=be.aabb.distanceX(q),Le=be.aabb.distanceY(q),tt=Ue,bt=1;if(L){tt=be.aabb.distanceZ(q);let Ot=Math.pow(2,be.zoom),Jt=r.a$((be.y+1)/Ot),fn=r.a$(be.y/Ot),Fn=Math.min(Math.max(S,Jt),fn),Jn=r.d1(Fn)/r.d1(S);if(bt=Fn===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jn/this._mercatorScaleRatio),this.zoom<=r.c_&&be.zoom===Ce-1&&Jn>=.9)return!0}else if(y&&(tt=be.aabb.distanceZ(q)*U),this.projection.isReprojectedInTileSpace&&f<=5){let Ot=Math.pow(2,be.zoom),Jt=ue(new r.ae((be.x+.5)/Ot,(be.y+.5)/Ot));bt=Jt>.85?1:Jt}if(!x&&!L){let Ot=Math.sqrt(Ge*Ge+Le*Le+tt*tt),Jt=(1<<Ce-be.zoom)*re*bt;return Jt*=dt(Math.max(tt,Ue),Ot),Ot<Jt}let At=Number.MAX_VALUE,_t=0,pt=be.aabb.getCorners(),jt=[];for(let Ot of pt){r.av(jt,Ot,q),L||(y?jt[2]*=U:jt[2]=Ue);let Jt=r.bJ(jt,this._camera.forward());Jt<At&&(At=Jt,_t=Math.abs(jt[2]))}let zt=(1<<Ce-be.zoom)*re*bt;if(zt*=dt(Math.max(_t,Ue),At),At<zt)return!0;let Tt=be.aabb.closestPoint(A);return Tt[0]===A[0]&&Tt[1]===A[1]};if(this.renderWorldCopies)for(let be=1;be<=3;be++)_e.push(ae(-be)),_e.push(ae(be));for(_e.push(ae(0));_e.length>0;){let be=_e.pop(),Ge=be.x,Le=be.y,tt=be.fullyVisible,bt=()=>this.projection.name==="globe"&&(be.y===0||be.y===(1<<be.zoom)-1);if(!tt){let At=ee?be.aabb.intersects(N):be.aabb.intersectsFlat(N);if(At===0&&bt()){let _t=new r.cD(be.zoom,Ge,Le);At=r.cE(this,M,_t,!0).intersects(N)}if(At===0)continue;tt=At===2}if(be.zoom!==Ce&&Fe(be))for(let At=0;At<4;At++){let _t=(Ge<<1)+At%2,pt=(Le<<1)+(At>>1),jt={aabb:x?be.aabb.quadrant(At):r.cF(this,M,be.zoom+1,_t,pt,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:_t,y:pt,wrap:be.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};y&&!L&&(jt.tileID=new r.aQ(be.zoom+1===Ce?Be:be.zoom+1,be.wrap,be.zoom+1,_t,pt),Ye(jt)),_e.push(jt)}else{let At=be.zoom===Ce?Be:be.zoom;if(o.minzoom&&o.minzoom>At)continue;let _t=0;if(!tt){let Tt=ee?be.aabb.intersectsPrecise(N):be.aabb.intersectsPreciseFlat(N);if(Tt===0&&bt()){let Ot=new r.cD(be.zoom,Ge,Le);Tt=r.cE(this,M,Ot,!0).intersectsPrecise(N)}if(Tt===0)continue;if(o.calculateQuadrantVisibility)if(N.containsPoint(be.aabb.center))_t=15;else for(let Ot=0;Ot<4;Ot++)be.aabb.quadrant(Ot).intersects(N)!==0&&(_t|=1<<Ot)}let pt=A[0]-(.5+Ge+(be.wrap<<be.zoom))*(1<<c-be.zoom),jt=A[1]-.5-Le,zt=be.tileID?be.tileID:new r.aQ(At,be.wrap,be.zoom,Ge,Le);o.calculateQuadrantVisibility&&(zt.visibleQuadrants=_t),De.push({tileID:zt,distanceSq:pt*pt+jt*jt})}}if(this.fogCullDistSq){let be=this.fogCullDistSq,Ge=this.horizonLineFromTop();De=De.filter(Le=>{let tt=[0,0,0,1],bt=[r.al,r.al,0,1],At=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());r.aC(tt,tt,At),r.aC(bt,bt,At);let _t=r.cG([],tt,bt),pt=r.cH([],tt,bt),jt=r.c$(_t,pt);if(jt===0)return!0;let zt=!1,Tt=this._elevation;if(Tt&&jt>be&&Ge!==0){let Ot=this.calculateProjMatrix(Le.tileID.toUnwrapped()),Jt;o.isTerrainDEM||(Jt=Tt.getMinMaxForTile(Le.tileID)),Jt||(Jt={min:de,max:ge});let fn=r.cI(this.rotation),Fn=[fn[0]*r.al,fn[1]*r.al,Jt.max];r.af(Fn,Fn,Ot),zt=(1-Fn[1])*this.height*.5<Ge}return jt<be||zt})}return De.sort((be,Ge)=>be.distanceSq-Ge.distanceSq).map(be=>be.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){let c=r.aA(o.lat,-r.cJ,r.cJ),f=this.projection.project(o.lng,c);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let f,_,y=this.centerPoint;if(this.projection.name==="globe"){let w=this.worldSize;f=(c.x-y.x)/w,_=(c.y-y.y)/w}else{let w=this.pointCoordinate(c),S=this.pointCoordinate(y);f=w.x-S.x,_=w.y-S.y}let x=this.locationCoordinate(o);this.setLocation(new r.ae(x.x-f,x.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,c){return this.projection.locationPoint(this,o,c)}locationPoint3D(o,c){return this.projection.locationPoint(this,o,c,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,c){return this.coordinateLocation(this.pointCoordinate3D(o,c))}locationCoordinate(o,c){let f=c?r.cf(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new r.ae(_.x,_.y,f)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){let f=c??this._centerAltitude,_=[o.x,o.y,0,1],y=[o.x,o.y,1,1];r.aC(_,_,this.pixelMatrixInverse),r.aC(y,y,this.pixelMatrixInverse);let x=y[3];r.cK(_,_,1/_[3]),r.cK(y,y,1/x);let w=_[2],S=y[2];return{p0:_,p1:y,t:w===S?0:(f-w)/(S-w)}}screenPointToMercatorRay(o){let c=[o.x,o.y,0,1],f=[o.x,o.y,1,1];return r.aC(c,c,this.pixelMatrixInverse),r.aC(f,f,this.pixelMatrixInverse),r.cK(c,c,1/c[3]),r.cK(f,f,1/f[3]),c[2]=r.cf(c[2],this._center.lat)*this.worldSize,f[2]=r.cf(f[2],this._center.lat)*this.worldSize,r.cK(c,c,1/this.worldSize),r.cK(f,f,1/this.worldSize),new r.ax([c[0],c[1],c[2]],r.aw([],r.av([],f,c)))}rayIntersectionCoordinate(o){let{p0:c,p1:f,t:_}=o,y=r.cf(c[2],this._center.lat),x=r.cf(f[2],this._center.lat);return new r.ae(r.ak(c[0],f[0],_)/this.worldSize,r.ak(c[1],f[1],_)/this.worldSize,r.ak(y,x,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o,c){if(!this.elevation)return this.pointCoordinate(o,c);let f=this.projection.pointCoordinate3D(this,o.x,o.y);if(f)return new r.ae(f[0],f[1],f[2]);let _=0,y=this.horizonLineFromTop();if(o.y>y)return this.pointCoordinate(o,c);let x=.02*y,w=o.clone();for(let S=0;S<10&&y-_>x;S++){w.y=r.ak(_,y,.66);let M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(y=w.y,f=M):_=w.y}return f?new r.ae(f[0],f[1],f[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.cL)return!this.isPointAboveHorizon(o);let c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){let f=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,f+o.toAltitude(),1];return r.aC(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(c,o)),x=this.pointLocation3D(new r.P(_,o)),w=this.pointLocation3D(new r.P(_,f)),S=this.pointLocation3D(new r.P(c,f)),M=Math.min(y.lng,x.lng,w.lng,S.lng),A=Math.max(y.lng,x.lng,w.lng,S.lng),L=Math.min(y.lat,x.lat,w.lat,S.lat),F=Math.max(y.lat,x.lat,w.lat,S.lat),N=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=(Z,q,ee,re,ne)=>{let ge=(Z+ee)/2,de=(q+re)/2,fe=new r.P(ge,de),{lng:ue,lat:ae}=this.pointLocation3D(fe),_e=Math.max(0,M-ue,L-ae,ue-A,ae-F);M=Math.min(M,ue),A=Math.max(A,ue),L=Math.min(L,ae),F=Math.max(F,ae),(ne<j||_e>N)&&(U(Z,q,ge,de,ne+1),U(ge,de,ee,re,ne+1))};if(U(c,o,_,o,1),U(_,o,_,f,1),U(_,f,c,f,1),U(c,f,c,o,1),this.projection.name==="globe"){let[Z,q]=r.cM(this);Z?(F=90,A=180,M=-180):q&&(L=-90,A=180,M=-180)}return new r.aI(new r.aT(M,L),new r.aT(A,F))}_getBoundsRectangular(o,c){let{top:f,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=new r.P(_,f),S=new r.P(x,f),M=new r.P(x,y),A=new r.P(_,y),L=this.pointCoordinate(w,o),F=this.pointCoordinate(S,o),N=this.pointCoordinate(M,c),j=this.pointCoordinate(A,c),U=(Z,q)=>(q.y-Z.y)/(q.x-Z.x);return L.y>1&&F.y>=0?L=new r.ae((1-j.y)/U(j,L)+j.x,1):L.y<0&&F.y<=1&&(L=new r.ae(-j.y/U(j,L)+j.x,0)),F.y>1&&L.y>=0?F=new r.ae((1-N.y)/U(N,F)+N.x,1):F.y<0&&L.y<=1&&(F=new r.ae(-N.y/U(N,F)+N.x,0)),new r.aI().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=o.visibleDemTiles.reduce((f,_)=>{if(_.dem){let y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.cJ,this.maxLat=r.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){let c=o.key,f=this._distanceTileDataCache;if(f[c])return f[c];let _=o.canonical,y=1/this.height,x=this.cameraWorldSize,w=x/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*o.wrap)*w,M=_.y*w,A=this.point;A.x*=x/this.worldSize,A.y*=x/this.worldSize;let L=this.angle,F=Math.sin(-L),N=-Math.cos(-L);return f[c]={bearing:[F,N],center:[(A.x-S)*y,(A.y-M)*y],scale:w/r.al*y},f[c]}calculateFogTileMatrix(o){let c=o.key,f=this._fogTileMatrixCache;if(f[c])return f[c];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.aB(_,this.worldToFogMatrix,_),f[c]=new Float32Array(_),f[c]}calculateProjMatrix(o,c=!1,f=!1){let _=o.key,y;if(y=f?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];let x=this.calculatePosMatrix(o,this.worldSize),w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,r.aB(x,w,x),y[_]=new Float32Array(x),y[_]}calculatePixelsToTileUnitsMatrix(o){let c=o.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];let _=r.cN(o,this);return f[c]=_,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,c=r.bq([],[o,o,o]);return r.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let c=r.cf(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=this._camera.forward(),y=r.cf(1,this._center.lat);f[2]/=y,_[2]/=y,r.aw(_,_);let x=o.raycast(f,_,o.exaggeration());if(x){let w=r.bH([],f,_,x),S=new r.ae(w[0],w[1],r.cf(w[2],r.a$(w[1]))),M=(S.z+r.ag([S.x-f[0],S.y-f[1],S.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let c=this._elevation,f=r.cf(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),y=c.getAtPointOrZero(new r.ae(..._)),x=this.pixelsPerMeter/this.worldSize*y,w=this._minimumHeightOverTerrain(),S=_[2]-x;if(S<=w)if(S<0||o){let M=this.locationCoordinate(this._center,this._centerAltitude),A=[_[0],_[1],M.z-_[2]],L=r.ag(A);A[2]-=(w-S)/this._pixelsPerMercatorPixel;let F=r.ag(A);if(F===0)return;r.c5(A,A,L/F*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let F=this.center;return F.lat=r.aA(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(F.lng=r.aA(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let c=this._unmodified,{x:f,y:_}=this.point,y=0,x=f,w=_,S=this.width/2,M=this.height/2,A=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-M<A&&(w=A+M),_+M>L&&(w=L-M),L-A<this.height&&(y=Math.max(y,this.height/(L-A)),w=(L+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,j=this.worldSize/2-(F+N)/2;x=(f+j+this.worldSize)%this.worldSize-j,x-S<F&&(x=F+S),x+S>N&&(x=N-S),N-F<this.width&&(y=Math.max(y,this.width/(N-F)),x=(N+F)/2)}x===f&&w===_||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(x,w))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,c=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.cf(1,this.center.lat)/r.cf(1,r.d2));let _=r.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?f:1,x=this._camera.getWorldToCamera(this.worldSize,y),w,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-o.x/this.width,S[9]=2*o.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),_e=ae*this.aspect,De=-_e,Ce=-ae;_e-=o.x,De-=o.x,ae+=o.y,Ce+=o.y,w=this._camera.getCameraToClipOrthographic(De,_e,Ce,ae,this._nearZ,this._farZ),((Be,Ue,Ye,dt)=>{for(let Fe=0;Fe<16;Fe++)Be[Fe]=r.ak(Ue[Fe],Ye[Fe],dt)})(w,w,S,r.d0(this.pitch>=Ya?1:this.pitch/Ya))}else w=S;let M=r.cP([],S,x),A=r.cP([],w,x);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),_e=r.bA([]);r.br(_e,_e,[ae.x*this.worldSize,ae.y*this.worldSize,0]),r.aB(_e,_e,r.cQ(this)),r.br(_e,_e,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),r.aB(A,A,_e),r.aB(M,M,_e),this.inverseAdjustmentMatrix=r.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cS([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),c){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-o.x/this.width,ae[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.cP([],ae,x)}else this.expandedFarZProjMatrix=this.projMatrix;let L=r.bl([],w);this.frustumCorners=r.cT.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let F=new Float32Array(16);r.bA(F),r.cS(F,F,[1,-1,1]),r.cU(F,F,this._pitch),r.bB(F,F,this.angle);let N=r.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(N);let j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-o.x/this.width,N[9]=2*(o.y+j)/this.height,this.skyboxMatrix=r.aB(F,N,F);let U=this.point,Z=U.x,q=U.y,ee=this.width%2/2,re=this.height%2/2,ne=Math.cos(this.angle),ge=Math.sin(this.angle),de=Z-Math.round(Z)+ne*ee+ge*re,fe=q-Math.round(q)+ne*re+ge*ee,ue=new Float64Array(A);if(r.br(ue,ue,[de>.5?de-1:de,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ue,A=r.bC(),r.cS(A,A,[this.width/2,-this.height/2,1]),r.br(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=r.bC(),r.cS(A,A,[1,-1,1]),r.br(A,A,[-1,-1,0]),r.cS(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},A=r.bl(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cV(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(ae,ae,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[o,o,c];r.c5(y,y,_),r.c5(f,f,-1),r.cW(f,f,y);let x=r.bC();r.br(x,x,f),r.cS(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){let c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,o/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=o[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((c-f)/_,1)),this._camera.position=r.bH([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=r.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),w=Math.max((o[2]-y)/Math.cos(f),x),S=this._zoomFromMercatorZ(w);r.bH(o,o,c,w),this._pitch=r.aA(f,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(_,-Math.PI,Math.PI),this._setZoom(r.aA(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,f=r.cL,_=0,y=1/0;for(;f-c>1e-6&&f>c;){let x=c+.5*(f-c),w=this.tileSize*Math.pow(2,x),S=this.getCameraToCenterDistance(this.projection,x,w),M=this.scaleZoom(S/(Math.max(0,o)*this.tileSize)),A=Math.abs(x-M);A<y&&(y=A,_=x),x<M?c=x:f=x}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){let f=Math.min(o.x,c.x),_=Math.max(o.x,c.x),y=Math.min(o.y,c.y),x=Math.max(o.y,c.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let w=[new r.P(f,y),new r.P(_,x),new r.P(f,x),new r.P(_,y)],S=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let A of w){let L=this.pointRayIntersection(A);if(L.t<0)return!0;let F=this.rayIntersectionCoordinate(L);if(F.x<S||F.y<0||F.x>M||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,c){let f=r.ag(r.av([],this._camera.position,o)),_=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let o=(function([c,f,_],y){let x=[c,f,_,1];r.aC(x,x,y);let w=x[3]=Math.max(x[3],1e-6);return x[0]/=w,x[1]/=w,x[2]/=w,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,c=this.zoom,f=this.worldSize){let _=r.cO(o,c,this.width,this.height,1024),y=o.pixelSpaceConversion(this.center.lat,f,_),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=r.ak(1,x,r.d0(this.pitch>=Ya?1:this.pitch/Ya))),x}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(o,o,this.globeMatrix),o}getFrustum(o){return r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Yc=(p,o)=>{if(o>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),o<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=p.transform,f=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),_=c.isLODDisabled(!1)?r.ah(60,45,c.pitch):r.ah(30,15,c.pitch),y=c._farZ-c._nearZ,x=o*c.height,w=((1-(S=_))*c.cameraToCenterDistance+S*(c._farZ+x))*f;var S;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(w-c._nearZ)/y,(w-x-c._nearZ)/y]}}},Ca=2048;class Cp{constructor(o,c){this.aabb=o,this.lastCascade=c}}class qT{add(o,c){let f=this.receivers[o.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],c.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],c.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],c.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],c.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],c.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],c.max[2])):this.receivers[o.key]=new Cp(c,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,c,f){let _=r.d9.fromPoints(o.points),y=0;for(let x in this.receivers){let w=this.receivers[x];if(!w||!_.intersectsAabb(w.aabb))continue;w.aabb.min=_.closestPoint(w.aabb.min),w.aabb.max=_.closestPoint(w.aabb.max);let S=w.aabb.getCorners();for(let M=0;M<f.length;M++){let A=!0;for(let L of S){let F=[L[0]*c,L[1]*c,L[2]];if(r.af(F,F,f[M].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){A=!1;break}}if(w.lastCascade=M,y=Math.max(y,M),A)break}}return y+1}}class Qd{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new qT,this._depthMode=new Gt(o.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,c){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let _=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((j,U)=>{let Z=f.style._mergedLayers[U];return j+(Z.hasShadowPass()&&!Z.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=f.context,x=Ca,w=Ca;if(this._cascades.length===0||Ca!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<2;++j){let U=f._shadowMapDebug,Z=y.gl,q=y.createFramebuffer(x,w,U?1:0,"texture"),ee=new r.T(y,{width:x,height:w,data:null},Z.DEPTH_COMPONENT16);if(q.depthAttachment.set(ee.texture),U){let re=new r.T(y,{width:x,height:w,data:null},Z.RGBA8);q.colorAttachment0.set(re.texture)}this._cascades.push({framebuffer:q,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cB,scale:0})}}this.shadowDirection=Sp(c);let S=0;if(o.elevation){let j=o.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{let q=Z.dem.tree;U[0]=Math.min(U[0],q.minimums[0]),U[1]=Math.max(U[1],q.maximums[0])}),U[0]!==1e4&&(S=(U[1]-U[0])*j.exaggeration())}let M=1.5*o.cameraToCenterDistance,A=3*M,L=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){let U=this._cascades[j],Z=o.height/50,q=1;j===0?q=M:(Z=M,q=A);let[ee,re]=Xc(o,this.shadowDirection,Z,q,Ca,S);U.scale=o.scale,U.matrix=ee,U.boundingSphereRadius=re,r.bl(L,U.matrix),U.frustum=r.cB.fromInvProjectionMatrix(L,1,0,!0),U.far=q}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Ca,this._uniformValues.u_shadowmap_0=Co.ShadowMap0,this._uniformValues.u_shadowmap_1=Co.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let N=f.transform.elevation;for(let j of this._groundShadowTiles){let U={min:0,max:0};if(N){let Z=N.getMinMaxForTile(j);Z&&(U=Z)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,c){if(!this.enabled)return;let f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Ca,Ca]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:r.ao.white,depth:1});for(let x of o.order){let w=o._mergedLayers[x];if(!w.hasShadowPass()||w.isHidden(f.transform.zoom))continue;let S=o.getLayerSourceCache(w),M=S?c[S.id]:void 0;(w.type==="model"||M&&M.length)&&f.renderLayer(f,S,w,M)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,c=o.style,f=o.context,_=f.gl,y=c.directionalLight,x=c.ambientLight;if(!y||!x)return;let w=[],S=Yc(o,o.longestCutoffRange);S.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");let M=tc(c,y,x),A=new Gt(_.LEQUAL,Gt.ReadOnly,o.depthRangeFor3D),L=new cn({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(let F of this._groundShadowTiles){let N=F.toUnwrapped(),j=o.isTileAffectedByFog(F),U=o.getOrCreateProgram("groundShadow",{defines:w,overrideFog:j});this.setupShadows(N,U),o.uploadCommonUniforms(f,U,N,null,S);let Z={u_matrix:o.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};U.draw(o,_.TRIANGLES,A,L,xn.multiply,ln.disabled,Z,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?xn.unblended:xn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let c=this.painter.transform,f=c.calculatePosMatrix(o,c.worldSize);return r.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(o){let c=r.bz(o);return r.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,o),c}setupShadows(o,c,f){if(!this.enabled)return;let _=this.painter.transform,y=this.painter.context,x=y.gl,w=this._uniformValues,S=new Float64Array(16),M=_.calculatePosMatrix(o,_.worldSize);for(let A=0;A<this._cascades.length;A++)r.aB(S,this._cascades[A].matrix,M),w[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),y.activeTexture.set(x.TEXTURE0+Co.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){let A=r.d7(o.canonical),L=2/_.tileSize*r.al/Ca,F=L*this._cascades[0].boundingSphereRadius,N=L*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(f==="vector-tile"?1:3)*(function(U,Z,q,ee,re){let ne=r.aA((U-22)/-22,0,1);return .125*(1-ne)+4*ne})(_.zoom);w.u_shadow_normal_offset=[A,F*j,N*j],w.u_shadow_bias=[1e-4,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,w)}setupShadowsFromMatrix(o,c,f=!1){if(!this.enabled)return;let _=this.painter.context,y=_.gl,x=this._uniformValues,w=new Float64Array(16);for(let S=0;S<2;S++)r.aB(w,this._cascades[S].matrix,o),x[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),_.activeTexture.set(y.TEXTURE0+Co.ShadowMap0+S),this._cascades[S].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);this.useNormalOffset=f,f?(x.u_shadow_normal_offset=[1,3,3],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(_,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,c,f,_){if(_[2]>=0)return{};let y=(function(S,M,A){let L=A/(1<<S.canonical.z);return new r.d9([S.canonical.x*L+S.wrap*A,S.canonical.y*L+S.wrap*A,0],[(S.canonical.x+1)*L+S.wrap*A,(S.canonical.y+1)*L+S.wrap*A,M])})(o,c,f).getCorners(),x=c/-_[2];_[0]<0?(r.d8(y[0],y[0],[_[0]*x,0,0]),r.d8(y[3],y[3],[_[0]*x,0,0])):_[0]>0&&(r.d8(y[1],y[1],[_[0]*x,0,0]),r.d8(y[2],y[2],[_[0]*x,0,0])),_[1]<0?(r.d8(y[0],y[0],[0,_[1]*x,0]),r.d8(y[1],y[1],[0,_[1]*x,0])):_[1]>0&&(r.d8(y[2],y[2],[0,_[1]*x,0]),r.d8(y[3],y[3],[0,_[1]*x,0]));let w={};return w.vertices=y,w.planes=[Ep(y[1],y[0],y[4]),Ep(y[2],y[1],y[5]),Ep(y[3],y[2],y[6]),Ep(y[0],y[3],y[7])],w}addShadowReceiver(o,c,f){this._receivers.add(o,r.d9.fromTileIdAndHeight(o,c,f))}getMaxCascadeForTile(o){let c=this._receivers.get(o);return c&&c.lastCascade?c.lastCascade:0}}function Ep(p,o,c){let f=r.av([],c,o),_=r.av([],p,o),y=r.bI([],f,_),x=r.ag(y);return x===0?[0,0,1,0]:(r.c5(y,y,1/x),[y[0],y[1],y[2],-r.bJ(y,o)])}function Sp(p){let o=p.properties.get("direction"),c=r.d4(o.x,o.y,o.z);c[2]=r.aA(c[2],0,75);let f=r.d6([c[0],c[1],c[2]]);return r.d5(f.x,f.y,f.z)}function tc(p,o,c){let f=o.properties.get("color-use-theme")==="none",_=o.properties.get("color"),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=[x.x,x.y,x.z],S=c.properties.get("color-use-theme")==="none",M=c.properties.get("color"),A=c.properties.get("intensity"),L=Math.max(r.bJ([0,0,1],w),0),F=[0,0,0];r.c5(F,M.toPremultipliedRenderColor(S?null:p.getLut(o.scope)).toArray01Linear().slice(0,3),A);let N=[0,0,0];return r.c5(N,_.toPremultipliedRenderColor(f?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),L*y),r.db([F[0]>0?F[0]/(F[0]+N[0]):0,F[1]>0?F[1]/(F[1]+N[1]):0,F[2]>0?F[2]/(F[2]+N[2]):0])}function Xc(p,o,c,f,_,y){let x=p.zoom,w=p.scale,S=p.worldSize,M=1/S,A=p.aspect,L=Math.sqrt(1+A*A)*Math.tan(.5*p.fovX),F=L*L,N=f-c,j=f+c,U,Z;F>N/j?(U=f,Z=f*L):(U=.5*j*(1+F),Z=.5*Math.sqrt(N*N+2*(f*f+c*c)*F+j*j*F*F));let q=p.projection.pixelsPerMeter(p.center.lat,S),ee=p._camera.getCameraToWorldMercator(),re=[0,0,-U*M];r.af(re,re,ee);let ne=Z*M,ge=p._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let tt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?q:1),bt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,f);bt[8]=2*-p.centerOffset.x/p.width,bt[9]=2*p.centerOffset.y/p.height;let At=new Float64Array(16);r.cP(At,bt,tt);let _t=new Float64Array(16);r.bl(_t,At);let pt=r.cB.fromInvProjectionMatrix(_t,S,x,!0);for(let jt of pt.points){let zt=((de=jt)[0]/=w,de[1]/=w,de[2]=r.cf(de[2],p._center.lat),de);ne=Math.max(ne,r.c6(r.da([],re,zt)))}}var de;ne*=_/(_-1);let fe=Math.acos(o[2]),ue=Math.atan2(-o[0],-o[1]),ae=new Em;ae.position=re,ae.setPitchBearing(fe,ue);let _e=ae.getWorldToCamera(S,q),De=ne*S,Ce=Math.min(p._mercatorZfromZoom(17)*S*-2,-2*De),Be=ae.getCameraToClipOrthographic(-De,De,-De,De,Ce,(De+y*q)/o[2]),Ue=new Float64Array(16);r.aB(Ue,Be,_e);let Ye=r.d5(Math.floor(1e6*re[0])/1e6*S,Math.floor(1e6*re[1])/1e6*S,0),dt=.5*_,Fe=[0,0,0];r.af(Fe,Ye,Ue),r.c5(Fe,Fe,dt);let be=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ge=[0,0,0];r.av(Ge,Fe,be),r.c5(Ge,Ge,-1/dt);let Le=new Float64Array(16);return r.bA(Le),r.br(Le,Le,Ge),r.aB(Ue,Le,Ue),[Ue,De]}class WT extends r.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,c){return r.dc(this.requestManager.transformRequest(c,r.R.Model).url).then(f=>{if(!f)return;let _=r.dd(f),y=new r.de(o,c,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${o} from ${c}: ${f.message}`)))})}load(o,c,f={forceReload:!1}){this.models[c]||(this.models[c]={});let _=Object.keys(o),y=[],x=[];for(let w of _){let S=o[w];this.hasURLBeenRequested(S)&&!f.forceReload||(this.modelByURL[S]={modelId:w,scope:c},y.push(this.loadModel(w,S)),x.push(w)),this.models[c][w]||(this.models[c][w]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+x.length,Promise.allSettled(y).then(w=>{for(let S=0;S<w.length;S++){let{status:M}=w[S];if(M==="rejected")continue;let{value:A}=w[S];this.models[c][x[S]]||(this.models[c][x[S]]={model:null,numReferences:1}),this.models[c][x[S]].model=A}this.numModelsLoading[c]-=x.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(w=>{this.fire(new r.y(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,c,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(o,c):this.getModelByURL(this.modelUris[c][o]))}getModel(o,c){return this.models[c]||(this.models[c]={}),this.models[c][o]?this.models[c][o].model:void 0}getModelByURL(o){if(!o)return null;let c=this.modelByURL[o];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(o,c){return this.models[c]&&this.models[c][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,c,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});let _=this.requestManager.normalizeModelURL(c);if((this.hasModel(o,f,{exactIdMatch:!0})||this.hasModelBeenAdded(o,f))&&this.modelUris[f][o]===_)this.models[f][o].numReferences++;else if(this.hasURLBeenRequested(_)){let{scope:y,modelId:x}=this.modelByURL[_];this.models[y][x].numReferences++}else this.modelUris[f][o]=_,this.load({[o]:this.modelUris[f][o]},f)}addModelURLs(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f=this.modelUris[c];for(let _ in o)f[_]=this.requestManager.normalizeModelURL(o[_])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f={};for(let _ of o)this.hasModel(_,c,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[c][_].numReferences++:this.modelUris[c][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[c][_]:!this.hasURLBeenRequested(_)&&r.df(_,!1)&&(this.modelUris[c][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[c][_]);this.load(f,c)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,c,f=!1,_=!1){if(this.models[c]&&this.models[c][o]&&(this.models[c][o].numReferences--,this.models[c][o].numReferences===0||_)){let y=this.modelUris[c][o];f||delete this.modelUris[c][o],delete this.modelByURL[y];let x=this.models[c][o].model;if(!x)return;delete this.models[c][o],x.destroy()}}destroy(){for(let o of Object.keys(this.models))for(let c of Object.keys(this.models[o])){let f=this.models[o][c].model;delete this.models[o][c],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,c){this.models[c]||(this.models[c]={});for(let f in this.models[c])this.models[c][f].model&&this.models[c][f].model.upload(o.context)}}let z0=r.a6.colorTheme,ZT=new r.a9({data:new r.aa(z0.data)});function zb(p){if(!p.metadata||!p.metadata.content_area)return;let o=r.o.devicePixelRatio,{left:c,top:f,width:_,height:y}=p.metadata.content_area,x=c*o,w=f*o;return[x,w,x+_*o,w+y*o]}function Bb(p){if(p)return p.map(([o,c])=>[o*r.o.devicePixelRatio,c*r.o.devicePixelRatio])}class B0{constructor(o,c,f){this.id=o,this.scope=c,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let o=new Map;if(!this.sourceCache.loaded())return o;let c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return o;let f=this.sourceCache.getSource();if(!(f instanceof ss))return o;let _=c.map(x=>this.sourceCache.getTile(x)),y=f.getImages(_,Array.from(this.pendingRequests));for(let[x,w]of y)o.set(r.I.from({name:x,iconsetId:this.id}),w),this.pendingRequests.delete(x);for(let x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),o}}let Kc=(p,o)=>se(p,o&&o.filter(c=>c.identifier!=="source.canvas")),Vb=r.aH(qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ub=r.aH(qn,["setCenter","setZoom","setBearing","setPitch"]),Tm=new Set(["background","sky","slot","custom"]),Qc={version:8,layers:[],sources:{}},Tp={duration:300,delay:0};class Ea extends r.E{constructor(o,c={}){super(),this.map=o,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Tp),this._buildingIndex=new HT(this),this.crossTileSymbolIndex=new Za,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Vr,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new r.D(r.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Gd(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new r.di(o._requestManager,c.localFontFamily?r.dj.all:c.localIdeographFontFamily?r.dj.ideographs:r.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new WT(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",r.dk());let f=this;this._rtlTextPluginCallback=Ea.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,x)=>{if(r.dl(y),x&&x.every(w=>w))for(let w in f._sourceCaches){let S=f._sourceCaches[w],M=S.getSource().type;M!=="vector"&&M!=="geojson"||S.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let w=this._layers[x];w.source===y.id&&this._validateLayer(w)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(r.h(o))return o;let c=r.dm(o);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${r.dn(JSON.stringify(o))}`}_diffStyle(o,c,f){this.globalId=this._getGlobalId(o);let _=(y,x)=>{try{x(null,this.setState(y,f))}catch(w){x(w,!1)}};if(typeof o=="string"){let y=this.map._requestManager.normalizeStyleURL(o),x=this.map._requestManager.transformRequest(y,r.R.Style);r.m(x,(w,S)=>{w?this.fire(new r.y(w)):S&&_(S,c)})}else typeof o=="object"&&_(o,c)}loadURL(o,c={}){this.fire(new r.z("dataloading",{dataType:"style"}));let f=typeof c.validate=="boolean"?c.validate:!r.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,c.accessToken),this.resolvedImports.add(o);let _=this.importsCache.get(o);if(_)return this._load(_,f);let y=this.map._requestManager.transformRequest(o,r.R.Style);this._request=r.m(y,(x,w)=>{if(this._request=null,x)this.fire(new r.y(x));else if(w)return this.importsCache.set(o,w),this._load(w,f)})}loadJSON(o,c={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=r.o.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Qc,!1)}_loadImports(o,c,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let y of o){let x=this._createFragmentStyle(y),w=new Promise(A=>{x.once("style.import.load",A),x.once("error",A)}).then(()=>this.mergeAll());if(_.push(w),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let S=y.data||this.importsCache.get(y.url);S?(x.loadJSON(S,{validate:c}),this._isInternalStyle(S)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:c}):x.loadEmpty();let M={style:x,id:y.id,config:y.config};if(f){let A=this.fragments.findIndex(({id:L})=>L===f);this.fragments=this.fragments.slice(0,A).concat(M).concat(this.fragments.slice(A))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(o=this,c=new Set){for(let f of o.fragments)f.style.globalId&&c.add(f.style.globalId),this.getImportGlobalIds(f.style,c);return[...c.values()]}_createFragmentStyle(o){let c=this.scope?r.B(o.id,this.scope):o.id,f,_=this._initialConfig&&this._initialConfig[c];(o.config||_)&&(f=Object.assign({},o.config,_));let y=new Ea(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,c){if(this._isInternalStyle(o)){let y=Object.assign({},Qc,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(y,c)}if(this.updateConfig(this._config,o.schema),c&&Kc(this,Ha(o)))return;this._loaded=!0,this.stylesheet=r.dp(o);let f=()=>{for(let S in o.sources)this.addSource(S,o.sources[S],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(let S in o.iconsets)this.addIconset(S,o.iconsets[S]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);let y=fp(this.stylesheet.layers);if(this._order=y.map(S=>S.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let S=this.stylesheet.lights[0];this.light=new Ie(S.properties,S.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ie(this.stylesheet.light)),this._layers={};for(let S of y){let M=r.du(S,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;let A=this.getOwnLayerSourceCache(M),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&M.canCastShadows()&&L&&(A.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));let w=this.isRootStyle();o.imports?this._loadImports(o.imports,c).then(()=>{this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load"))}).catch(S=>{this.fire(new r.y(new Error("Failed to load imports",S))),this.fire(new r.z(w?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){let y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{f()}).catch(x=>{r.w(`Couldn't load color theme from the stylesheet: ${x}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,c,f,_,y,x,w,S,M,A,L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(o=F.light),F.stylesheet.lights)for(let N of F.stylesheet.lights)N.type==="ambient"&&F.ambientLight!=null&&(c=F.ambientLight),N.type==="directional"&&F.directionalLight!=null&&(f=F.directionalLight);_=this._prioritizeTerrain(_,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(y=F.fog),F.stylesheet.snow&&F.snow!=null&&(x=F.snow),F.stylesheet.rain&&F.rain!=null&&(w=F.rain),F.stylesheet.camera!=null&&(A=F.stylesheet.camera),F.stylesheet.projection!=null&&(S=F.stylesheet.projection),F.stylesheet.transition!=null&&(M=F.stylesheet.transition),L[F.scope]=F._styleColorTheme}}),this.light=o,this.ambientLight=c,this.directionalLight=f,this.fog=y,this.snow=x,this.rain=w,this._styleColorThemeForScope=L,_===null?delete this.terrain:this.terrain=_,this.camera=A||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=Object.assign({},Tp,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){let c=f=>{for(let _ of f.fragments)c(_.style);o(f)};c(this)}_prioritizeTerrain(o,c,f){let _=o&&o.drapeRenderMode===0;return f===null?c&&c.drapeRenderMode===0?c:_?o:null:c!=null&&(!o||_||c&&c.drapeRenderMode===1)?c:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(o=c.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},c={},f={};this.forEachFragmentStyle(_=>{for(let y in _._sourceCaches){let x=r.B(y,_.scope);o[x]=_._sourceCaches[y]}for(let y in _._otherSourceCaches){let x=r.B(y,_.scope);c[x]=_._otherSourceCaches[y]}for(let y in _._symbolSourceCaches){let x=r.B(y,_.scope);f[x]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(let c of Object.values(o.stylesheet.indoor)){let f=c,_=r.B(f.sourceId,o.scope);this._mergedIndoor[_]=new Set(f.sourceLayers||[])}})}mergeLayers(){let o={},c=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(let w of x._order){let S=x._layers[w];if(S.type==="slot"){let M=r.dq(w);if(o[M])continue;o[M]=[]}S.slot&&o[S.slot]?o[S.slot].push(S):c.push(S)}}),this._mergedOrder=[];let _=-1,y=(x=[])=>{for(let w of x)if(w.type==="slot"){let S=r.dq(w.id);o[S]&&y(o[S]),this._mergedSlots.push(S)}else{let S=r.B(w.id,w.scope);this._mergedOrder.push(S),f[S]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(c),this._has3DLayers){let x={};for(let w=0;w<this._mergedOrder.length;++w){let S=this._mergedOrder[w];x[S]=w===_?1:w<_?f[S].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((w,S)=>x[w]-x[S])}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?(function(c,f,_,y){let x=Object.assign({},f);for(let S of Object.keys(z0))x[S]===void 0&&(x[S]=z0[S].default);let w=new r.a8(ZT,c,new Map(_));return w.setTransitionOrValue(x,_),w.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{let y="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let x=o;x.startsWith(y)||(x=y+x);let w=r.I.from("mapbox-reserved-lut"),S=new Image;S.src=x,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},S.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void f();this._styleColorTheme.lutLoading=!1;let{width:M,height:A,data:L}=r.o.getImageData(S);if(A>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==A*A)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new r.q({width:M,height:A},L),pixelRatio:1,sdf:!1,usvg:!1,version:0});let F=this.imageManager.getImage(w,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:o},f()):_(new Error("Missing LUT image."))}})}getLut(o){let c=this._styleColorThemeForScope[o];return c?c.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=(function(c,f,_){let y,x,w,S=r.o.devicePixelRatio>1?"@2x":"",M=r.m(f.transformRequest(f.normalizeSpriteURL(c,S,".json"),r.R.SpriteJSON),(F,N)=>{M=null,w||(w=F,y=N,L())}),A=r.n(f.transformRequest(f.normalizeSpriteURL(c,S,".png"),r.R.SpriteImage),(F,N)=>{A=null,w||(w=F,x=N,L())});function L(){if(w)_(w);else if(y&&x){let F=r.o.getImageData(x),N={};for(let j in y){let{width:U,height:Z,x:q,y:ee,sdf:re,pixelRatio:ne,stretchX:ge,stretchY:de,content:fe}=y[j],ue=new r.q({width:U,height:Z});r.q.copy(F,ue,{x:q,y:ee},{x:0,y:0},{width:U,height:Z},null),N[j]={data:ue,pixelRatio:ne!==void 0?ne:1,sdf:re!==void 0&&re,stretchX:ge,stretchY:de,content:fe,usvg:!1,version:0}}_(null,N)}}return{cancel(){M&&(M.cancel(),M=null),A&&(A.cancel(),A=null)}}})(o,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new r.y(c));else if(f){let _=new Map;for(let y in f)_.set(r.I.from(y),f[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(o,c){if(c.type==="sprite")return void this._loadSprite(c.url);let f=this.getOwnSourceCache(c.source);if(!f)return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));let _=f.getSource();if(_.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;let y=new B0(o,this.scope,f);this.imageManager.addImageProvider(y,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!r.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);let c=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(y,x)=>{if(this._spriteRequest=null,y)c?this._loadSprite(o):this.fire(new r.y(y));else if(x){let w=new Map;for(let S in x)w.set(r.I.from(S),x[S]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(o),r.R.Iconset),(y,x)=>{if(y)return void _(y);let w={},S=r.dg(new r.bt(x));for(let M of S.icons){let A={version:1,pixelRatio:r.o.devicePixelRatio,content:zb(M),stretchX:M.metadata?Bb(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?Bb(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};w[M.name]=A}_(null,w)}))}_validateLayer(o){let c=this.getOwnSource(o.source);if(!c)return;let f=o.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.y(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,c)=>{let f=this.fragments[c];return f&&f.style&&(o.data=f.style.serialize()),o})}_serializeSources(){let o={};for(let c in this._sourceCaches){let f=this._sourceCaches[c].getSource();o[f.id]||(o[f.id]=f.serialize())}return o}_serializeLayers(o){let c=[];for(let f of o){let _=this._layers[f];_&&_.type!=="custom"&&c.push(_.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];if(c._transitionablePaint&&c._transitionablePaint._values){let f=c._transitionablePaint._values["line-emissive-strength"];if(f&&f.value&&f.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let c=this.getOwnLayer(o);if(c)return c;this.fire(new r.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let c=this.getOwnSource(o);if(c)return c;this.fire(new r.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,c){let f=this.map.painter;if(f)for(let _=o.minzoom||0;_<(o.maxzoom||25.5);_++){let y=o.getProgramIds();if(y)for(let x of y){let w=o.getDefaultProgramParams(x,c.zoom,this._styleColorTheme.lut);w&&(f.style=this,this.fog&&(f._fogVisible=!0,w.overrideFog=!0,f.getOrCreateProgram(x,w)),f._fogVisible=!1,w.overrideFog=!1,f.getOrCreateProgram(x,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,f.getOrCreateProgram(x,w)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let c=this.calculateLightsBrightness();o.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));let f=this._changes.isDirty(),_=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let S in w){let{updatedIds:M,removedIds:A}=w[S];(M||A)&&(this._updateWorkerLayers(S,M,A),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}let y={};for(let w in this._mergedSourceCaches){let S=this._mergedSourceCaches[w];y[w]=S.used,S.used=!1,S.tileCoverLift=0}for(let w of this._mergedOrder){let S=this._mergedLayers[w];if(S.visibility!=="none"&&S.recalculate(o,this._availableImages),!S.isHidden(o.zoom)){let M=this.getLayerSourceCache(S);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,o)}):this.precompilePrograms(S,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();let x=this.imageManager.getPendingImageProviders();for(let w of x)w.sourceCache.used=!0;for(let w in y){let S=this._mergedSourceCaches[w];y[w]!==S.used&&S.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){let o=this.imageManager.getPendingImageProviders();for(let c of o){let f=c.resolvePendingRequests(),_=this.getFragmentStyle(c.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){let o={};for(let c in this._mergedSourceCaches){let f=this._mergedSourceCaches[c].getSource().scope;o[f]=o[f]||this._changes.getUpdatedImages(f),o[f].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o[f])}for(let c in o)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(o,c,f){let _=this.getFragmentStyle(o);_&&this.dispatcher.broadcast("updateLayers",{layers:c?_._serializeLayers(c):[],scope:o,removedIds:f||[],options:_.options})}setState(o,c){if(this._checkLoaded(),Kc(this,Ha(o)))return!1;(o=r.dp(o)).layers=fp(o.layers);let f=(function(x,w){if(!x)return[{command:qn.setStyle,args:[w]}];let S=[];try{if(!r.by(x.version,w.version))return[{command:qn.setStyle,args:[w]}];if(r.by(x.center,w.center)||S.push({command:qn.setCenter,args:[w.center]}),r.by(x.zoom,w.zoom)||S.push({command:qn.setZoom,args:[w.zoom]}),r.by(x.bearing,w.bearing)||S.push({command:qn.setBearing,args:[w.bearing]}),r.by(x.pitch,w.pitch)||S.push({command:qn.setPitch,args:[w.pitch]}),r.by(x.sprite,w.sprite)||S.push({command:qn.setSprite,args:[w.sprite]}),r.by(x.glyphs,w.glyphs)||S.push({command:qn.setGlyphs,args:[w.glyphs]}),r.by(x.imports,w.imports)||(function(N=[],j=[],U){j=j||[];let Z=(N=N||[]).map(mp),q=j.map(mp),ee=N.reduce(gp,{}),re=j.reduce(gp,{}),ne=Z.slice(),ge,de,fe,ue;for(ge=0,de=0;ge<Z.length;ge++)fe=Z[ge],re.hasOwnProperty(fe)?de++:(U.push({command:qn.removeImport,args:[fe]}),ne.splice(ne.indexOf(fe,de),1));for(ge=0,de=0;ge<q.length;ge++)fe=q[q.length-1-ge],ne[ne.length-1-ge]!==fe&&(ee.hasOwnProperty(fe)?(U.push({command:qn.removeImport,args:[fe]}),ne.splice(ne.lastIndexOf(fe,ne.length-de),1)):de++,ue=ne[ne.length-ge],U.push({command:qn.addImport,args:[re[fe],ue]}),ne.splice(ne.length-ge,0,fe));for(let ae of j){let _e=ee[ae.id];_e&&(delete _e.data,r.by(_e,ae)||U.push({command:qn.updateImport,args:[ae.id,ae]}))}})(x.imports,w.imports,S),r.by(x.transition,w.transition)||S.push({command:qn.setTransition,args:[w.transition]}),r.by(x.light,w.light)||S.push({command:qn.setLight,args:[w.light]}),r.by(x.fog,w.fog)||S.push({command:qn.setFog,args:[w.fog]}),r.by(x.snow,w.snow)||S.push({command:qn.setSnow,args:[w.snow]}),r.by(x.rain,w.rain)||S.push({command:qn.setRain,args:[w.rain]}),r.by(x.projection,w.projection)||S.push({command:qn.setProjection,args:[w.projection]}),r.by(x.lights,w.lights)||S.push({command:qn.setLights,args:[w.lights]}),r.by(x.camera,w.camera)||S.push({command:qn.setCamera,args:[w.camera]}),r.by(x.iconsets,w.iconsets)||(function(N,j,U){let Z;for(Z in j=j||{},N=N||{})N.hasOwnProperty(Z)&&(j.hasOwnProperty(Z)||U.push({command:qn.removeIconset,args:[Z]}));for(Z in j){if(!j.hasOwnProperty(Z))continue;let q=j[Z];N.hasOwnProperty(Z)?r.by(N[Z],q)||(U.push({command:qn.removeIconset,args:[Z]}),U.push({command:qn.addIconset,args:[Z,q]})):U.push({command:qn.addIconset,args:[Z,q]})}})(x.iconsets,w.iconsets,S),!r.by(x["color-theme"],w["color-theme"]))return[{command:qn.setStyle,args:[w]}];let M={},A=[];(function(N,j,U,Z){let q;for(q in j=j||{},N=N||{})N.hasOwnProperty(q)&&(j.hasOwnProperty(q)||D0(q,U,Z));for(q in j){if(!j.hasOwnProperty(q))continue;let ee=j[q];N.hasOwnProperty(q)?r.by(N[q],ee)||(N[q].type==="geojson"&&ee.type==="geojson"&&kb(N,j,q)?U.push({command:qn.setGeoJSONSourceData,args:[q,ee.data]}):Rb(q,j,U,Z)):mm(q,j,U)}})(x.sources,w.sources,A,M);let L=[];x.layers&&x.layers.forEach(N=>{N.source&&M[N.source]?S.push({command:qn.removeLayer,args:[N.id]}):L.push(N)});let F=x.terrain;F&&M[F.source]&&(S.push({command:qn.setTerrain,args:[void 0]}),F=void 0),S=S.concat(A),r.by(F,w.terrain)||S.push({command:qn.setTerrain,args:[w.terrain]}),(function(N,j,U){j=j||[];let Z=(N=N||[]).map(mp),q=j.map(mp),ee=N.reduce(gp,{}),re=j.reduce(gp,{}),ne=Z.slice(),ge=Object.create(null),de,fe,ue,ae,_e,De,Ce;for(de=0,fe=0;de<Z.length;de++)ue=Z[de],re.hasOwnProperty(ue)?fe++:(U.push({command:qn.removeLayer,args:[ue]}),ne.splice(ne.indexOf(ue,fe),1));for(de=0,fe=0;de<q.length;de++)ue=q[q.length-1-de],ne[ne.length-1-de]!==ue&&(ee.hasOwnProperty(ue)?(U.push({command:qn.removeLayer,args:[ue]}),ne.splice(ne.lastIndexOf(ue,ne.length-fe),1)):fe++,De=ne[ne.length-de],U.push({command:qn.addLayer,args:[re[ue],De]}),ne.splice(ne.length-de,0,ue),ge[ue]=!0);for(de=0;de<q.length;de++)if(ue=q[de],ae=ee[ue],_e=re[ue],!ge[ue]&&!r.by(ae,_e))if(r.by(ae.source,_e.source)&&r.by(ae["source-layer"],_e["source-layer"])&&r.by(ae.type,_e.type)){for(Ce in qc(ae.layout,_e.layout,U,ue,null,qn.setLayoutProperty),qc(ae.paint,_e.paint,U,ue,null,qn.setPaintProperty),r.by(ae.slot,_e.slot)||U.push({command:qn.setSlot,args:[ue,_e.slot]}),r.by(ae.filter,_e.filter)||U.push({command:qn.setFilter,args:[ue,_e.filter]}),r.by(ae.minzoom,_e.minzoom)&&r.by(ae.maxzoom,_e.maxzoom)||U.push({command:qn.setLayerZoomRange,args:[ue,_e.minzoom,_e.maxzoom]}),ae)ae.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?qc(ae[Ce],_e[Ce],U,ue,Ce.slice(6),qn.setPaintProperty):r.by(ae[Ce],_e[Ce])||U.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}));for(Ce in _e)_e.hasOwnProperty(Ce)&&!ae.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?qc(ae[Ce],_e[Ce],U,ue,Ce.slice(6),qn.setPaintProperty):r.by(ae[Ce],_e[Ce])||U.push({command:qn.setLayerProperty,args:[ue,Ce,_e[Ce]]}))}else U.push({command:qn.removeLayer,args:[ue]}),De=ne[ne.lastIndexOf(ue)+1],U.push({command:qn.addLayer,args:[_e,De]})})(L,w.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:qn.setStyle,args:[w]}]}return S})(this.serialize(),o).filter(x=>!(x.command in Ub));if(f.length===0)return!1;let _=f.filter(x=>!(x.command in Vb));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);let y=[];return f.forEach(x=>{y.push(this[x.command](...x.args))}),c&&Promise.all(y).then(c).catch(c),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(let[c,f]of o.entries()){if(this.getImage(c))return this.fire(new r.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,f),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(o,c){return this.getImage(o)?this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,c),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(o,c,f=!1){this.imageManager.updateImage(o,this.scope,c),f&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(o,c,f={}){return this._checkLoaded(),this._validate(G,`models.${o}`,c,null,f)||(this.modelManager.addModel(o,c,this.getActualScope()),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,c,f={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(lm,`sources.${o}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let _=ho(o,c,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let y=x=>{let w=(x?"symbol:":"other:")+_.id,S=r.B(w,this.scope),M=this._sourceCaches[w]=new Bs(S,_,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};y(!1),c.type!=="vector"&&c.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let c=this.getOwnSource(o);if(!c)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let _=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===o);if(_)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while iconset "${_[0]}" is using it.`)))}let f=this.getOwnSourceCaches(o);for(let _ of f){let y=r.dq(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getOwnSource(o).setData(c),this._changes.setDirty()}getOwnSource(o){let c=this.getOwnSourceCache(o);return c&&c.getSource()}getOwnSources(){let o=[];for(let c in this._otherSourceCaches){let f=this.getOwnSourceCache(c);f&&o.push(f.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let c in o){let f=o[c]._tiles;for(let _ in f){let y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let y of o){if(this._validate(Kl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(y),x.updateTransitions(c)}else this.ambientLight=new Gn(y,Ur||(Ur=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(y),x.updateTransitions(c)}else this.directionalLight=new Gn(y,br||(br=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=Object.assign(c,{worldview:this.map.getWorldview()}),_=new r.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,c=this.ambientLight;if(!o||!c)return;let f=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),_=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=o.properties.get("intensity"),x=o.properties.get("direction"),w=1-r.d4(x.x,x.y,x.z)[2]/90,S=f(_)*y*w,M=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),A=c.properties.get("intensity"),L=f(M)*A;return Number(((S+L)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(r.dr(o)){let c=r.ds(o),f=this.fragments.find(({id:y})=>y===c);if(!f)return;let _=r.dq(o);return f.style.getFragmentStyle(_)}{let c=this.fragments.find(({id:f})=>f===o);return c?c.style:void 0}}setFeaturesetSelectors(o){if(!o)return;let c={},f=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(let _ in o){let y=this._featuresetSelectors[_]=[];for(let x of o[_].selectors){if(x.featureNamespace){let S=this.getOwnLayer(x.layer);if(!S){r.w(`Layer is undefined for selector: ${x.layer}`);continue}let M=f(S.source,S.sourceLayer);if(M in c&&c[M]!==x.featureNamespace){r.w(`"featureNamespace ${x.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}c[M]=x.featureNamespace}let w;if(x.properties)for(let S in x.properties){let M=r.U(x.properties[S]);M.result==="success"&&(w=w||{},w[S]=M.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:w,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(o){let c=this.getFragmentStyle(o);if(!c||!c.stylesheet.featuresets)return[];let f=[];for(let _ in c.stylesheet.featuresets)f.push({featuresetId:_,importId:c.scope?c.scope:void 0});return f}getFeaturesetLayers(o,c){let f=this.getFragmentStyle(c),_=f.stylesheet.featuresets;if(!_||!_[o])return this.fire(new r.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of _[o].selectors){let w=f.getOwnLayer(x.layer);w&&y.push(w)}return y}getConfigProperty(o,c){let f=this.getFragmentStyle(o);if(!f)return null;let _=r.B(c,f.scope),y=f.options.get(_),x=y?y.value||y.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,c){let f=r.B(o,c);return this._mergedIndoor[f]}setIndoorData(o,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,c,f){let _=this.getFragmentStyle(o);if(!_)return;let y=_.stylesheet.schema;if(!y||!y[c])return;let x=r.U(f);if(x.result!=="success")return void Kc(this,x.value);let w=x.value.expression,S=r.B(c,_.scope),M=_.options.get(S);if(!M)return;let A,{minValue:L,maxValue:F,stepValue:N,type:j,values:U}=y[c],Z=r.U(y[c].default);Z.result==="success"&&(A=Z.value.expression),A?(this.options.set(S,Object.assign({},M,{value:w,default:A,minValue:L,maxValue:F,stepValue:N,type:j,values:U})),this.updateConfigDependencies(c)):this.fire(new r.y(new Error(`No schema defined for the config option "${c}" in the "${o}" fragment.`)))}getConfig(o){let c=this.getFragmentStyle(o);if(!c)return null;let f=c.stylesheet.schema;if(!f)return null;let _={};for(let y in f){let x=r.B(y,c.scope),w=c.options.get(x),S=w?w.value||w.default:null;_[y]=S?S.serialize():null}return _}setConfig(o,c){let f=this.getFragmentStyle(o);f&&(f.updateConfig(c,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let c=this.getFragmentStyle(o);return c?c.stylesheet.schema:null}setSchema(o,c){let f=this.getFragmentStyle(o);f&&(f.stylesheet.schema=c,f.updateConfig(f._config,c),this.updateConfigDependencies())}updateConfig(o,c){if(this._config=o,o||c)if(c)for(let f in c){let _,y,x=r.U(c[f].default);if(x.result==="success"&&(_=x.value.expression),o&&o[f]!==void 0){let F=r.U(o[f]);F.result==="success"&&(y=F.value.expression)}let{minValue:w,maxValue:S,stepValue:M,type:A,values:L}=c[f];if(_){let F=r.B(f,this.scope);this.options.set(F,{default:_,value:y,minValue:w,maxValue:S,stepValue:M,type:A,values:L})}else this.fire(new r.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,c=()=>!0){for(let f of o){let _=this.getLayer(f);_&&c(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,c=>!o||c.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{let f=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(f){let _=c._evaluateColorThemeData(f);(!c._styleColorTheme.lut&&_!==""||c._styleColorTheme.lut&&_!==c._styleColorTheme.lut.data)&&c.setColorTheme(f)}}),this._changes.setDirty()}addLayer(o,c,f={}){this._checkLoaded();let _=o.id;if(this._layers[_])return void this.fire(new r.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(o.type==="custom"){if(Kc(this,r.dt(o)))return;y=r.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=r.dp(o),o=Object.assign(o,{source:_})),this._validate(M0,`layers.${_}`,o,{arrayIndex:-1},f))return;y=r.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}let x=r.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let w=this._order.length;if(c){let L=this._order.indexOf(c);if(L===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));y.slot===this._layers[c].slot?w=L:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;let S=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&M&&(S.castsShadows=!0);let A=this._changes.getRemovedLayer(y);if(A&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let L=r.B(y.source,y.scope);A.type!==y.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(o,c){this._checkLoaded();let f=this._checkLayer(o);if(!f||o===c)return;let _=this._order.indexOf(o);this._order.splice(_,1);let y=this._order.length;if(c){let x=this._order.indexOf(c);if(x===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));f.slot===this._layers[c].slot?y=x:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let c=this._checkLayer(o);if(!c)return;c.setEventedParent(null);let f=this._order.indexOf(o);this._order.splice(f,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let _=this.getOwnLayerSourceCache(c);if(_&&_.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===c.source&&this._layers[x].canCastShadows()){y=!0;break}_.castsShadows=y}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,f){this._checkLoaded();let _=this._checkLayer(o);_&&(_.minzoom===c&&_.maxzoom===f||(c!=null&&(_.minzoom=c),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,c){this._checkLoaded();let f=this._checkLayer(o);f&&f.slot!==c&&(f.slot=c,this._updateLayer(f))}setFilter(o,c,f={}){this._checkLoaded();let _=this._checkLayer(o);if(_&&!r.by(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Ku,`layers.${_.id}.filter`,c,{layerType:_.type},f)||(_.filter=r.dp(c),this._updateLayer(_)))}getFilter(o){let c=this._checkLayer(o);if(c)return r.dp(c.filter)}setLayoutProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(y&&!r.by(y.getLayoutProperty(c),f)){if(f!=null&&(!_||_.validate!==!1)&&Kc(y,Re.call(Ha,{key:`layers.${o}.layout.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(c,f),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);y&&(c==="appearances"?(y.setAppearances(f),this._changes.setDirty()):y.isPaintProperty(c)?this.setPaintProperty(o,c,f,_):this.setLayoutProperty(o,c,f,_))}getLayoutProperty(o,c){let f=this._checkLayer(o);if(f)return f.getLayoutProperty(c)}setPaintProperty(o,c,f,_={}){this._checkLoaded();let y=this._checkLayer(o);if(!y||r.by(y.getPaintProperty(c),f)||f!=null&&(!_||_.validate!==!1)&&Kc(y,dp.call(Ha,{key:`layers.${o}.paint.${c}`,layerType:y.type,objectKey:c,value:f,styleSpec:r.a6})))return;let x=y.setPaintProperty(c,f);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(o,c){let f=this._checkLayer(o);if(f)return f.getPaintProperty(c)}setFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),L=A.getFeaturesetLayers(S);for(let{source:F,sourceLayer:N}of L)A.setFeatureState({id:o.id,source:F,sourceLayer:N},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.setFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=o.sourceLayer,y=this._checkSource(f);if(!y)return;let x=y.type;if(x==="geojson"&&_)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!_)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.setFeatureState(_,o.id,c)}removeFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:S,importId:M}=o.target,A=this.getFragmentStyle(M),L=A.getFeaturesetLayers(S);for(let{source:F,sourceLayer:N}of L)A.removeFeatureState({id:o.id,source:F,sourceLayer:N},c)}else if("layerId"in o.target){let{layerId:S}=o.target,M=this.getLayer(S);this.removeFeatureState({id:o.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let f=o.source,_=this._checkSource(f);if(!_)return;let y=_.type,x=y==="vector"?o.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));let w=this.getOwnSourceCaches(f);for(let S of w)S.removeFeatureState(x,o.id,c)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let y;if("featuresetId"in o.target){let{featuresetId:x,importId:w}=o.target,S=this.getFragmentStyle(w),M=S.getFeaturesetLayers(x);for(let{source:A,sourceLayer:L}of M){let F=S.getFeatureState({id:o.id,source:A,sourceLayer:L});if(F&&!y)y=F;else if(!r.by(y,F))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){let{layerId:x}=o.target,w=this.getLayer(x);y=this.getFeatureState({id:o.id,source:w.source,sourceLayer:w.sourceLayer})}return y}let c=o.source,f=o.sourceLayer,_=this._checkSource(c);if(_){if(_.type!=="vector"||f)return o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,o.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),c=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(o){for(let c of Object.values(this._mergedLayers))o(c)&&this._updateLayer(c)}_updateLayer(o){this._changes.updateLayer(o);let c=this.getLayerSourceCache(o),f=r.B(o.source,o.scope),_=this._changes.getUpdatedSourceCaches();o.source&&!_[f]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),c.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let c=w=>this._mergedLayers[w].is3D(!!this.terrain),f=this.order,_={},y=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S)){_[S]=w;for(let M of o){let A=M[S];if(A)for(let L of A)y.push(L)}}}y.sort((w,S)=>S.intersectionZ-w.intersectionZ);let x=[];for(let w=f.length-1;w>=0;w--){let S=f[w];if(c(S))for(let M=y.length-1;M>=0;M--){let A=y[M].feature;if(A.layer&&_[A.layer.id]<w)break;x.push(A),y.pop()}else for(let M of o){let A=M[S];if(A)for(let L of A)x.push(L.feature)}}return x}queryRasterValue(o,c,f){let _=this.getOwnSource(o);return _?_.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(c,f):(this.fire(new r.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ku,"queryRenderedFeatures.filter",c.filter,null,c),_=r.b6(c.filter));let y={},x=A=>{if(Tm.has(A.type))return;let L=this.getOwnLayerSourceCache(A),F=y[L.id]=y[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};A.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[A.fqid]=F.layers[A.fqid]||{styleLayer:A,targets:[]},F.layers[A.fqid].targets.push({filter:_})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(let A of c.layers){let L=this._layers[A];if(!L)return this.fire(new r.y(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];x(L)}}else for(let A in this._layers)x(this._layers[A]);let w=this._queryRenderedFeatures(o,y,f),S=this._flattenAndSortRenderedFeatures(w),M=[];for(let A of S)r.dw(A.layer.id)===this.scope&&M.push(A);return M}queryRenderedFeatureset(o,c,f){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ku,"queryRenderedFeatures.filter",c.filter,null,c),_=r.b6(c.filter));let y="mock",x=[];if(c&&c.target)x.push(Object.assign({},c,{targetId:y,filter:_}));else{let A=this.getFeaturesetDescriptors();for(let L of A)x.push({targetId:y,filter:_,target:L});for(let{style:L}of this.fragments){let F=L.getFeaturesetDescriptors();for(let N of F)x.push({targetId:y,filter:_,target:N})}}let w=this.queryRenderedTargets(o,x,f),S=[],M=new Set;for(let A of w)for(let L of A.variants[y])Zd(L,A,M)||S.push(new r.dx(A,L));return S}queryRenderedTargets(o,c,f){let _={},y=(w,S,M,A)=>{let L=_[S.id]=_[S.id]||{sourceCache:S,layers:{},has3DLayers:!1};if(L.layers[w.fqid]=L.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(L.has3DLayers=!0),!A)return M.uniqueFeatureID=!1,void L.layers[w.fqid].targets.push(M);L.layers[w.fqid].targets.push(Object.assign({},M,{namespace:A.namespace,properties:A.properties,uniqueFeatureID:A.uniqueFeatureID}))};for(let w of c)if("featuresetId"in w.target){let{featuresetId:S,importId:M}=w.target,A=this.getFragmentStyle(M);if(!A||!A._featuresetSelectors)continue;let L=A._featuresetSelectors[S];if(!L){this.fire(new r.y(new Error(`The featureset '${S}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let F of L){let N=A.getOwnLayer(F.layerId);N&&!Tm.has(N.type)&&y(N,A.getOwnLayerSourceCache(N),w,F)}}else if("layerId"in w.target){let{layerId:S}=w.target,M=this.getLayer(S);if(!M||Tm.has(M.type))continue;y(M,this.getLayerSourceCache(M),w)}let x=this._queryRenderedFeatures(o,_,f);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(o,c,f){let _=[],y=!!this.map._showQueryGeometry,x=cr.createFromScreenPoints(o,f);for(let w in c){let S=cm(x,c[w],this._availableImages,f,y);Object.keys(S).length&&_.push(S)}if(this.placement)for(let w in c){if(!c[w].sourceCache._onlySymbols)continue;let S=um(x.screenGeometry,c[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(S).length&&_.push(S)}return _}querySourceFeatures(o,c){let f=c&&c.filter;f&&this._validate(Ku,"querySourceFeatures.filter",f,null,c);let _=[],y=this.getOwnSourceCaches(o);for(let x of y)_=_.concat(dm(x,c));return _}addSourceType(o,c,f){return Ea.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(Ea.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,c,f={}){this._checkLoaded();let _=this.light.getLight(),y=!1;for(let w in o)if(!r.by(o[w],_[w])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(o,c,f),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,c=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=o,_=!("source"in o)||o.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in f&&typeof f.source=="object"){let w="terrain-dem-src";this.addSource(w,f.source),f=r.dp(f),f=Object.assign(f,{source:w})}let y=Object.assign({},f),x={};if(this.terrain&&_){y.source=this.terrain.get().source;let w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(x.style=w.serialize())}if(this._validate(I0,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c),this.fire(new r.z("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let w of Object.keys(r.a6.terrain))!f.hasOwnProperty(w)&&r.a6.terrain[w].default&&(f[w]=r.a6.terrain[w].default);for(let w in o)if(!r.by(o[w],x[w])){y.set(o,this.options),this.stylesheet.terrain=o;let S=this._getTransitionParameters({duration:0});y.updateTransitions(S),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let c=this.fog=new gn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createSnow(o){let c=this.snow=new Zr(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createRain(o){let c=this.rain=new lr(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.fog=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let c=this.snow;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.snow=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let c=this.rain;if(!r.by(c.get(),o)){c.set(o,this.options),this.stylesheet.rain=c.get();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){let o=()=>{for(let _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(let _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void o();let f=this._evaluateColorThemeData(c);this._loadColorTheme(f).then(()=>{this.fire(new r.z("colorthemeset")),o()}).catch(_=>{r.w(`Couldn't set color theme: ${_}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,c){let f=this.getFragmentStyle(o);f&&(f._styleColorTheme.colorThemeOverride=c,f._reloadColorTheme())}_getTransitionParameters(o){return{now:r.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],c=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?o.push(f):c.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){let f=this.terrain=new Pe(o,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,f,_,y={}){if(y&&y.validate===!1)return!1;let x=Object.assign({},this.serialize());return Kc(this,o.call(Ha,Object.assign({key:c,style:x,value:f,styleSpec:r.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){let c=this.getSourceCaches(o);for(let f of c)f.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(let o in this._mergedLayers){let c=this._mergedLayers[o];c._clear&&c._clear()}}reloadSource(o){let c=this.getSourceCaches(o);for(let f of c)f.resume(),f.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let c;this.directionalLight&&(c=Sp(this.directionalLight));let f=new Set,_=new Set;for(let y in this._mergedLayers){let x=this._mergedLayers[y];x.type==="building"&&f.add(x.source),x.hasElevation()&&!_.has(x.source)&&_.add(x.source)}for(let y in this._mergedSourceCaches){let x=this._mergedSourceCaches[y],w=_.has(x._source.id);f.has(x._source.id)&&(x._source.reparseOverscaled=!1),x.update(o,void 0,void 0,c,w)}}_generateCollisionBoxes(){for(let o in this._sourceCaches){let c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,f,_,y,x,w=!1){let S=!1,M=!1,A={},L={};for(let U of this._mergedOrder){let Z=this._mergedLayers[U];if(Z.type!=="symbol")continue;let q=r.B(Z.source,Z.scope),ee=A[q];if(!ee){let ne=this.getLayerSourceCache(Z);if(!ne)continue;let ge=ne.getRenderableIds(!0).map(de=>ne.getTileByID(de));L[q]=ge.slice(),ee=A[q]=ge.sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}let re=this.crossTileSymbolIndex.addLayer(Z,ee,c.center.lng,c.projection);S=S||re}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new r.z("neworder"));let F=!!(this.placement&&!c.equals(this.placement.transform)),N=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!x||this.placement.lastReplacementSourceUpdateTime!==x.updateTime)),j=(F||N||S||this.placement&&this.placement.isStale())&&_===0;if((w||!this.pauseablePlacement||j||_!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),c.zoom))&&(this.pauseablePlacement=new po(c,this._mergedOrder,w||_===0,f,_,y,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,A,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S){this._buildingIndex.onNewFrame(c.zoom);for(let U=0;U<this._mergedOrder.length;U++){let Z=this._mergedLayers[this._mergedOrder[U]];if(Z.type!=="symbol"||Z.visibility==="none")continue;let q=this.isLayerClipped(Z);this.placement.updateLayerOpacities(Z,A[r.B(Z.source,Z.scope)],U,q?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,c){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===o.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!c)return f.push(o),this._loadImports([o],!0);let _=f.findIndex(({id:y})=>y===c);return _===-1&&this.fire(new r.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(o).concat(f.slice(_)),this._loadImports([o],!0,c)}updateImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);return _===-1?this:typeof c=="string"?(this.setImportUrl(o,c),this):(c.url&&c.url!==f[_].url&&this.setImportUrl(o,c.url),r.by(c.config,f[_].config)||this.setImportConfig(o,c.config,c.data.schema),r.by(c.data,f[_].data)||this.setImportData(o,c.data),this)}moveImport(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;let y=this.getImportIndex(c);if(y===-1)return this;let x=f[_],w=this.fragments[_];return f=f.filter(({id:S})=>S!==o),this.fragments=this.fragments.filter(({id:S})=>S!==o),this.stylesheet.imports=f.slice(0,y).concat(x).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(w).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(o,c){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;f[_].url=c;let y=this.fragments[_];return y.style=this._createFragmentStyle(f[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(c),this}setImportData(o,c){this._checkLoaded();let f=this.getImportIndex(o),_=this.stylesheet.imports||[];return f===-1?this:c?(this.fragments[f].style.setState(c),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(o,_[f].url))}setImportConfig(o,c,f){this._checkLoaded();let _=this.getImportIndex(o),y=this.stylesheet.imports||[];if(_===-1)return this;c?y[_].config=c:delete y[_].config;let x=this.fragments[_];f&&x.style.stylesheet&&(x.style.stylesheet.schema=f);let w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.updateConfig(c,w),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(o);f!==-1&&(c.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(o){let c=(this.stylesheet.imports||[]).findIndex(f=>f.id===o);return c===-1&&this.fire(new r.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),c}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let c in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[c];f&&o.push(f.getSource())}return o}getSource(o,c){let f=this.getSourceCache(o,c);return f&&f.getSource()}getLayerSource(o){let c=this.getLayerSourceCache(o);return c&&c.getSource()}getSourceCache(o,c){let f=r.B(o,c);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(o){let c=r.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let c=[];return this._mergedOtherSourceCaches[o]&&c.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&c.push(this._mergedSymbolSourceCaches[o]),c}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let c in o){let f=o[c];f==="reload"?this.reloadSource(c):f==="clear"&&this.clearSource(c)}}updateLayers(o){let c=this._changes.getUpdatedPaintProperties();for(let f of c){let _=this.getLayer(f);_&&_.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,c,f){this.imageManager.getImages(c.images,c.scope,f),this._updateTilesForChangedImages();let _=x=>{if(x){let w=c.images.map(S=>r.I.toString(S));x.setDependencies(c.tileID.key,c.type,w)}},y=r.B(c.source,c.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y]),c.images.some(x=>x.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(o,c,f){this.imageManager.rasterizeImages(c,f)}getGlyphs(o,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(o,c,f){return r.dz(c,f)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){let c=this.getOwnSourceCaches(o);return c.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${o}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,c){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;let f=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),_=o.type==="building";if(o.is3D(!!this.terrain)){if(f||_||c&&c.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ea.getSourceType=function(p){return fl[p]},Ea.setSourceType=function(p,o){fl[p]=o},Ea.registerForPluginStateChange=r.dA;class jb extends r.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(let[c,f]of Object.entries(o.buildings))if(this._buildings[c])for(let _ of f.floorIds)this._buildings[c].floors[_]||(this._buildings[c].floors[_]=f.floors[_]);else this._buildings[c]=f;for(let c of o.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(o,c){let f=this._style.getIndoorSourceLayers(o,c);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(o,c,f){let _=(function(y,x,w,S){let M=null,A=Number.MAX_SAFE_INTEGER;if(S<16)return null;for(let[L,F]of Object.entries(y)){let N=F.center;if(N){let j=x.distanceTo(r.aT.convert(N));j<A&&w.contains(N)&&(A=j,M=L)}}return M})(this._buildings,c,f,o);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){let o=this._buildings,c=this._closestBuildingId,f=c&&o?o[c]:void 0;if(!f)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(let x of f.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){_=x;break}let y=Array.from(f.floorIds).map(x=>({id:x,name:f.floors[x].name,zIndex:f.floors[x].zIndex})).sort((x,w)=>w.zIndex-x.zIndex);this.fire(new r.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){let o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Jd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,eh=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,V0=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Im="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ea=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Mm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,yt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,U0=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Dm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Am=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,j0=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Ip=/#include\s+"([^"]+)"/g,bl=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,$0=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,od=new Set(["ifdef","ifndef","elif","if","defined"]),sd=new Set;eu(Jd,sd),eu(V0,sd),eu(eh,sd);let Jc={"_prelude_fog.vertex.glsl":Mm,"_prelude_terrain.vertex.glsl":ea,"_prelude_shadow.vertex.glsl":Am,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":yt,"_prelude_shadow.fragment.glsl":j0,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":U0,"_prelude_raster_particle.glsl":Dm},Pm={};jn("",ea),jn(yt,Mm),jn(j0,Am),jn(U0,""),jn(Dm,"");let $b=jn(eh,V0),Om=Jd,YT=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Om,$b.fragmentSource].join(`
`),Hb=["precision highp float;",Om,$b.vertexSource].join(`
`);var H0={background:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:jn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:jn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:jn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:jn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:jn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:jn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:jn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:jn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:jn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:jn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Im),skyboxGradient:jn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Im),skyboxCapture:jn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:jn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:jn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:jn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:jn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:jn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:jn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function eu(p,o){let c=p.split(`
`);for(let f of c){if(f=f.trimStart(),f[0]!=="#"||!f.includes("if")||f.startsWith("#endif"))continue;let _=f.match($0);if(_)for(let y of _)od.has(y)||o.add(y)}}function jn(p,o){let c=new Set,f=[],_=[];p=p.replace(Ip,(x,w)=>(_.push(w),"")),o=o.replace(Ip,(x,w)=>(f.push(w),""));let y=new Set(sd);eu(p,y),eu(o,y);for(let x of[...f,..._])Pm[x]||(Pm[x]=new Set,eu(Jc[x],Pm[x])),y=new Set([...y,...Pm[x]]);return{fragmentSource:p=p.replace(bl,(x,w,S,M,A)=>(c.add(A),w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?`
#ifdef HAS_UNIFORM_u_${A}
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(bl,(x,w,S,M,A)=>{let L=`MATERIAL_ATTRIBUTE_OFFSET_${A}`,F=M==="float"?"vec2":M,N=`GET_ATTRIBUTE_${F}(a_${A}, materialInfo, ${L})`,j=A.match(/color/)?"color":F;return w==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${A}
in ${S} ${M} a_${A};
#endif
`:c.has(A)?w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${L})
        in ${S} ${F} a_${A};
    #endif
out ${S} ${M} ${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${A})
    #ifdef ${L}
        ${A} = unpack_mix_${j}(${N}, u_${A}_t);
    #else
        ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:w==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    in ${S} ${M} a_${A};
    out ${S} ${M} ${A};
#endif
`:w==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${A} = a_${A};
#endif
`:void 0:w==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
    #if !defined(${L})
        in ${S} ${F} a_${A};
    #endif
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${A}0;
in vec4 a_${A}1;
in vec4 a_${A}2;
in vec4 a_${A}3;
#else
uniform ${S} ${M} u_${A};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${S} ${F} a_${A};
#else
uniform ${S} ${M} u_${A};
#endif
`:w==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${A}
    ${S} ${M} ${A} = a_${A};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${L}
        ${S} ${M} ${A} = ${N};
    #else
        ${S} ${M} ${A} = a_${A};
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    #ifdef ${L}
        ${S} ${M} ${A} = unpack_mix_${j}(${N}, u_${A}_t);
    #else
        ${S} ${M} ${A} = unpack_mix_${j}(a_${A}, u_${A}_t);
    #endif
#else
    ${S} ${M} ${A} = u_${A};
#endif
`}),usedDefines:y,vertexIncludes:f,fragmentIncludes:_}}class XT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,f,_,y,x,w,S){this.context=o;let M=this.boundPaintVertexBuffers.length!==_.length;for(let L=0;!M&&L<_.length;L++)this.boundPaintVertexBuffers[L]!==_[L]&&(M=!0);let A=this.boundDynamicVertexBuffers.length!==w.length;for(let L=0;!A&&L<w.length;L++)this.boundDynamicVertexBuffers[L]!==w[L]&&(A=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||M||A||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(c,f,_,y,x,w,S);else{o.bindVertexArrayOES.set(this.vao);for(let L of w)L&&(L.bind(),S&&L.instanceCount&&L.setVertexAttribDivisor(o.gl,c,S));y&&y.dynamicDraw&&y.bind()}}freshBind(o,c,f,_,y,x,w){let S=this.context,M=S.gl;this.vao&&this.destroy(),this.vao=S.gl.createVertexArray(),S.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,c.enableAttributes(M,o),c.bind(),c.setVertexAttribPointers(M,o,y);for(let A of f)A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y);for(let A of x)A&&(A.enableAttributes(M,o),A.bind(),A.setVertexAttribPointers(M,o,y),w&&A.instanceCount&&A.setVertexAttribDivisor(M,o,w));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function KT(p,o){let c=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new r.ae(0,f/c).toLngLat().lat,new r.ae(0,(f+1)/c).toLngLat().lat]}function QT(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=c.hillshadeFBO;if(!M)return;p.prepareDrawTile();let A=p.isTileAffectedByFog(o),L=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1");let F=p.getOrCreateProgram("hillshade",{overrideFog:A,defines:L});w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment0.get());let N=((q,ee,re,ne)=>{let ge=re.paint.get("hillshade-shadow-color"),de=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=re.paint.get("hillshade-highlight-color"),ue=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ae=re.paint.get("hillshade-accent-color"),_e=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",De=re.paint.get("hillshade-emissive-strength"),Ce=r.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Ce-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let Ue=q.style.directionalLight.properties.get("direction"),Ye=r.d4(Ue.x,Ue.y,Ue.z);Ce=r.an(Ye[1])}let Be=!q.options.moving;return{u_matrix:ne||q.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),Be),u_image:0,u_latrange:KT(0,ee.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Ce],u_shadow:ge.toPremultipliedRenderColor(de?null:re.lut),u_highlight:fe.toPremultipliedRenderColor(ue?null:re.lut),u_emissive_strength:De,u_accent:ae.toPremultipliedRenderColor(_e?null:re.lut)}})(p,c,f,p.terrain?o.projMatrix:null);p.uploadCommonUniforms(w,F,o.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:U,tileBoundsSegments:Z}=p.getTileBoundsBuffers(c);F.draw(p,S.TRIANGLES,_,y,x,ln.disabled,N,f.id,j,U,Z)}function G0(p,o,c){if(!o.needsDEMTextureUpload)return;let f=p.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(c.stride);let y=c.getPixels();o.demTexture?o.demTexture.update(y,{premultiply:!1}):o.demTexture=new r.T(f,y,_.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function JT(p,o,c){let f=p.context,_=f.gl;if(!o.dem)return;let y=o.dem;if(f.activeTexture.set(_.TEXTURE1),G0(p,o,y),!o.demTexture)return;o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let x=y.dim;f.activeTexture.set(_.TEXTURE0);let w=o.hillshadeFBO;if(!w){let F=new r.T(f,{width:x,height:x,data:null},_.RGBA8);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),w=o.hillshadeFBO=f.createFramebuffer(x,x,1,"renderbuffer"),w.colorAttachment0.set(F.texture)}f.bindFramebuffer.set(w.framebuffer),f.viewport.set([0,0,x,x]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:M,tileBoundsSegments:A}=p.getMercatorTileBoundsBuffers(),L=[];p.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(p,_.TRIANGLES,Gt.disabled,cn.disabled,xn.unblended,ln.disabled,((F,N)=>{let j=N.stride,U=r.bC();return r.ce(U,0,r.al,-r.al,0,0,1),r.br(U,U,[0,-r.al,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:F.overscaledZ}})(o.tileID,y),c.id,S,M,A),o.needsHillshadePrepare=!1}class er{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class eI extends er{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gb extends er{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class q0 extends er{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Rm extends er{getDefault(){return[!0,!0,!0,!0]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class W0 extends er{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ad extends er{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class th extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Mp extends er{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class nh extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class qb extends er{getDefault(){return[0,1]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Z0 extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Wb extends er{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ih extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class km extends er{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Fm extends er{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Y0 extends er{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Lm extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Dp extends er{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Zb extends er{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Yb=class extends er{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Xb extends er{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class rh extends er{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Kb extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class tI extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class nI extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class iI extends er{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class X0 extends er{getDefault(){return null}set(o){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class K0 extends er{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Q0 extends er{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class J0 extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Qb extends er{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Nm extends er{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class zm extends Nm{constructor(o,c,f=0){super(o,c),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+f}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class oh extends Nm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ap extends Nm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Jb extends oh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let ta=(p,o,c,f)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:c,u_emissive_texture_available:f}),Bm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_image1:1,u_frustum_tl:x,u_frustum_tr:w,u_frustum_br:S,u_frustum_bl:M,u_globe_pos:A,u_globe_radius:L,u_viewport:F,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:j,u_emissive_texture_available:U});function Pp(p,o){return p!=null&&o!=null&&!(!p.hasData()||!o.hasData())&&p.demTexture!=null&&o.demTexture!=null&&p.tileID.key!==o.tileID.key}let nc=new class{constructor(){this.operations={}}newMorphing(p,o,c,f,_){if(p in this.operations){let y=this.operations[p];y.to.tileID.key!==c.tileID.key&&(y.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(let o in this.operations){let c=this.operations[o];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Vm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Um(p,o,c){if(o===0)return 0;let f=o<1&&c===514?.25/o:1;return 6*Math.pow(1.5,22-p)*Math.max(o,1)*f}function ev(p,o){let c=1<<p.z;return!o&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}function sh(p,o){if(!p.style||!p.style.enable3dLights())return;let c=p.context,f=c.gl;c.activeTexture.set(f.TEXTURE1),o?o.bind(f.LINEAR,f.CLAMP_TO_EDGE):p.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}let Op=p=>({u_matrix:p});function Rp(p,o,c,f,_){if(_>0){let y=r.o.now(),x=(y-p.timeAdded)/_,w=o?(y-o.timeAdded)/_:-1,S=c.getSource(),M=f.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),A=!o||Math.abs(o.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),L=A&&p.refreshedUponExpiration?1:r.aA(A?x:1-w,0,1);return o?{opacity:1,mix:1-L,isFading:x<1}:{opacity:L,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class jm extends Bs{constructor(o){let c=ho("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class tv extends Bs{constructor(o){let c=ho("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,f){if(o.freezeTileCoverage)return;this.transform=o;let _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let w=new td(x,this._source.tileSize*x.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[x.key]=w}return y},{});for(let y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(o){let c=this.proxyCachedFBO[o];if(c!==void 0){let f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class nv extends r.aQ{constructor(o,c,f){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class iv extends r.bV{constructor(o,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,_,y]=(function(S){let M=new r.bd,A=new r.b0,L=131;M.reserve(17161),A.reserve(33800);let F=r.al/128,N=r.al+F/2,j=N+F;for(let Z=-F;Z<j;Z+=F)for(let q=-F;q<j;q+=F){let ee=q<0||q>N||Z<0||Z>N?24575:0,re=r.aA(Math.round(q),0,r.al),ne=r.aA(Math.round(Z),0,r.al);M.emplaceBack(re+ee,ne)}let U=(Z,q)=>{let ee=q*L+Z;A.emplaceBack(ee+1,ee,ee+L),A.emplaceBack(ee+L,ee+L+1,ee+1)};for(let Z=1;Z<129;Z++)for(let q=1;q<129;q++)U(q,Z);return[0,129].forEach(Z=>{for(let q=0;q<130;q++)U(q,Z),U(Z,q)}),[M,A,32768]})(),x=o.context;this.gridBuffer=x.createVertexBuffer(f,r.bf.members),this.gridIndexBuffer=x.createIndexBuffer(_),this.gridSegments=r.bg.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tv(c.map),this.orthoMatrix=r.bC(),r.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);let w=x.gl;this._overlapStencilMode=new cn({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jm(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,f){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let _=o.terrain.properties,y=o.terrain.drapeRenderMode===0,x=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();let w=o.terrain&&o.terrain.scope,S=_.get("source"),M=y?this._mockSourceCache:o.getSourceCache(S,w);if(!M)return void r.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=M,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(c):_.get("exaggeration"),!c.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let A=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let L=this.getScaledDemTileSize();this.sourceCache.update(c,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);let c=this._previousCameraAltitude,f=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=f;let _=c!=null?f-c:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let y=o.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let w=y-this._previousZoom,S=this._previousUpdateTimestamp,M=y;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(y-M)>.5&&(w=.5*(y-M+w)),w*_<0&&(M+=w)),this._evaluationZoom=M;let A=x.getExaggeration(M),L=A===x.getExaggeration(Math.max(0,M-.1));if(L&&Math.abs(A-this._exaggeration)<.01)return A;let F=Math.min(.1,.00375*(this._updateTimestamp-S));return(L||A<.1||Math.abs(w)<1e-4)&&(F=Math.min(.2,4*F)),r.ak(this._exaggeration,A,F)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=c.getIds().map(S=>{let M=c.getTileByID(S).tileID;return M.projMatrix=f.calculateProjMatrix(M.toUnwrapped()),M});(function(S,M){let A=M.transform.pointCoordinate(M.transform.getCameraPoint()),L=new r.P(A.x,A.y);S.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;let j=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),Z=L.mult(1<<F.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(j)-Z.distSqr(U)})})(_,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},_.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let S in x){let M=x[S];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,o[S],y),M.usedForTerrain))continue;let A=o[S];M.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[c.id]=_.map(S=>new nv(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let w={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let M=this.terrainTileForTile[S.key];if(!M)continue;let A=M.tileID.key;A in w||(this._visibleDemTiles.push(M),w[A]=A)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;let f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){let o=this.painter.context,c=o.gl;for(let f in this.terrainTileForTile){let _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),G0(this.painter,_,y))}}_prepareDemTileUniforms(o,c,f,_){if(!c||c.demTexture==null)return!1;let y=o.tileID.canonical,x=Math.pow(2,c.tileID.canonical.z-y.z),w=_||"";return f[`u_dem_tl${w}`]=[y.x*x%1,y.y*x%1],f[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,c=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;let y=_.dem.tree.minimums[0];return y>0&&o++,f+y},0);return o?c/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);let f=this._getLoadedAreaMinimum(),_=new r.dL({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new r.T(o,_,c.R32F,{premultiply:!1}),y}setupElevationDraw(o,c,f){let _=this.painter.context,y=_.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let w=null,S=null,M=1;if(f&&f.morphing&&this._useVertexMorphing){let N=f.morphing.srcDemTile,j=f.morphing.dstDemTile;M=f.morphing.phase,N&&j&&(this._prepareDemTileUniforms(o,N,x,"_prev")&&(S=N),this._prepareDemTileUniforms(o,j,x)&&(w=j))}let A=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,L=null;var F;if(this.enabled?S&&w?(L=w.demTexture,_.activeTexture.set(y.TEXTURE4),S.demTexture.bind(A(S),y.CLAMP_TO_EDGE),x.u_dem_lerp=M):(w=this.terrainTileForTile[o.tileID.key],L=this._prepareDemTileUniforms(o,w,x)?w.demTexture:this.emptyDEMTexture):L=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),L&&(x.u_dem_size=(F=L).size[0]===1?1:F.size[0]-2,L.bind(A(w),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,c,x),f&&f.useMeterToDem&&w){let N=(1<<w.tileID.canonical.z)*r.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=N}if(f&&f.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(_,x),this.painter.transform.projection.name==="globe"){let N=this.globeUniformValues(this.painter.transform,o.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,N)}}globeUniformValues(o,c,f){let _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,r.al,0),u_tile_br_up:_.upVector(c,r.al,r.al),u_tile_bl_up:_.upVector(c,0,r.al),u_tile_up_scale:f?r.dM(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let c=this.painter,f=this.painter.context;o.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,y,x,w,S){if(_.transform.projection.name==="globe")(function(M,A,L,F,N){let j=M.context,U=j.gl,Z,q,ee=M.transform,re=r.dE(M,j,ee),ne=(Be,Ue)=>{if(q===Ue)return;let Ye=[Vm[Ue],"PROJECTION_GLOBE_VIEW"];re&&Ye.push("CUSTOM_ANTIALIASING");let dt=M.isTileAffectedByFog(Be);Z=M.getOrCreateProgram("globeRaster",{defines:Ye,overrideFog:dt}),q=Ue},ge=M.colorModeForRenderPass(),de=new Gt(U.LEQUAL,Gt.ReadWrite,M.depthRangeFor3D);nc.update(N);let fe=r.dF(ee),ue=[r.aF(ee.center.lng),r.aJ(ee.center.lat)],ae=M.globeSharedBuffers,_e=[ee.width*r.o.devicePixelRatio,ee.height*r.o.devicePixelRatio],De=Float32Array.from(ee.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};{let Be=M.transform,Ue=Um(Be.zoom,A.exaggeration(),A.sourceCache._source.tileSize);q=-1;let Ye=U.TRIANGLES;for(let dt of F){let Fe=L.getTile(dt),be=cn.disabled,Ge=A.prevTerrainTileForTile[dt.key],Le=A.terrainTileForTile[dt.key];Pp(Ge,Le)&&nc.newMorphing(dt.key,Ge,Le,N,250),sh(M,Fe.emissiveTexture),j.activeTexture.set(U.TEXTURE0),Fe.texture&&Fe.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let tt=nc.getMorphValuesForProxy(dt.key),bt=tt?1:0;tt&&Object.assign(Ce,{morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:r.dD(tt.phase)}});let At=r.dG(dt.canonical),_t=r.dH(At.getCenter().lat),pt=r.dI(dt.canonical,At,_t,Be.worldSize/Be._pixelsPerMercatorPixel),jt=r.bk(r.dJ(dt.canonical)),zt=M.emissiveMode==="mrt-fallback"?1:0,Tt=Bm(Be.expandedFarZProjMatrix,De,fe,jt,r.aj(Be.zoom),ue,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,_e,Ue,Be._farZ,zt,pt);if(ne(dt,bt),Z&&(A.setupElevationDraw(Fe,Z,Ce),M.uploadCommonUniforms(j,Z,dt.toUnwrapped()),ae)){let[Ot,Jt,fn]=ae.getGridBuffers(_t,Ue!==0);Z.draw(M,Ye,de,be,ge,ln.backCCW,Tt,"globe_raster",Ot,Jt,fn)}}}if(ae&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let Be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Be.push("CUSTOM_ANTIALIASING"),Z=M.getOrCreateProgram("globeRaster",{defines:Be});for(let Ue of F){let{x:Ye,y:dt,z:Fe}=Ue.canonical,be=dt===0,Ge=dt===(1<<Fe)-1,[Le,tt,bt,At]=ae.getPoleBuffers(Fe,!1);if(At&&(be||Ge)){let _t=L.getTile(Ue);sh(M,_t.emissiveTexture),j.activeTexture.set(U.TEXTURE0),_t.texture&&_t.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let pt=r.dK(Fe,Ye,ee),jt=r.bk(r.dJ(Ue.canonical)),zt=M.emissiveMode==="mrt-fallback"?1:0,Tt=(Ot,Jt)=>Ot.draw(M,U.TRIANGLES,de,cn.disabled,ge,ln.disabled,Bm(ee.expandedFarZProjMatrix,pt,pt,jt,0,ue,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,_e,0,ee._farZ,zt),"globe_pole_raster",Jt,bt,At);A.setupElevationDraw(_t,Z,Ce),M.uploadCommonUniforms(j,Z,Ue.toUnwrapped()),be&&M.renderDefaultNorthPole&&Tt(Z,Le),Ge&&M.renderDefaultSouthPole&&(pt=r.cS(r.bC(),pt,[1,-1,1]),Tt(Z,tt))}}}})(_,y,x,w,S);else{let M=_.context,A=M.gl,L,F,N=_.shadowRenderer,j=Yc(_,_.longestCutoffRange),U=ge=>{if(F===ge)return;let de=[];de.push(Vm[ge]),j.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),N&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&de.push("NORMAL_OFFSET")),L=_.getOrCreateProgram("terrainRaster",{defines:de}),F=ge},Z=_.colorModeForRenderPass(),q=new Gt(A.LEQUAL,Gt.ReadWrite,_.depthRangeFor3D);nc.update(S);let ee=_.transform,re=Um(ee.zoom,y.exaggeration(),y.sourceCache._source.tileSize),ne=[0,0,0];if(N){let ge=_.style.directionalLight,de=_.style.ambientLight;ge&&de&&(ne=tc(_.style,ge,de))}{F=-1;let ge=A.TRIANGLES,[de,fe]=[y.gridIndexBuffer,y.gridSegments];for(let ue of w){let ae=x.getTile(ue),_e=cn.disabled,De=y.prevTerrainTileForTile[ue.key],Ce=y.terrainTileForTile[ue.key];Pp(De,Ce)&&nc.newMorphing(ue.key,De,Ce,S,250),sh(_,ae.emissiveTexture),M.activeTexture.set(A.TEXTURE0),ae.texture&&ae.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let Be=nc.getMorphValuesForProxy(ue.key),Ue=Be?1:0,Ye;Be&&(Ye={morphing:{srcDemTile:Be.from,dstDemTile:Be.to,phase:r.dD(Be.phase)}});let dt=_.emissiveMode==="mrt-fallback"?1:0,Fe=ta(ue.projMatrix,ev(ue.canonical,ee.renderWorldCopies)?re/10:re,ne,dt);if(U(Ue),!L)continue;y.setupElevationDraw(ae,L,Ye);let be=ue.toUnwrapped();N&&N.setupShadows(be,L),_.uploadCommonUniforms(M,L,be,null,j),L.draw(_,ge,q,_e,Z,ln.backCCW,Fe,"terrain_raster",y.gridBuffer,de,fe)}}}})(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let c=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],x=this._drapedRenderBatches.shift(),w=c.style.order,S=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let M=0;for(let A of y){let L=_.getTileByID(A.proxyTileKey),F=_.proxyCachedFBO[A.key]?_.proxyCachedFBO[A.key][o]:void 0,N=F!==void 0?_.renderCache[F]:this.pool[M++],j=F!==void 0;if(L.texture=N.tex,L.emissiveTexture=N.emissiveTex,j&&!N.dirty){S.push(L.tileID);continue}f.bindFramebuffer.set(N.fb.framebuffer);let U=f.gl,Z;U.drawBuffers(c.emissiveMode==="mrt-fallback"?[U.COLOR_ATTACHMENT0,U.COLOR_ATTACHMENT1]:[U.COLOR_ATTACHMENT0]),this.renderedToTile=!1,N.dirty&&(f.clear({color:r.ao.transparent,stencil:0}),N.dirty=!1);for(let q=x.start;q<=x.end;++q){let ee=c.style._mergedLayers[w[q]];if(ee.isHidden(c.transform.zoom))continue;let re=c.style.getLayerSourceCache(ee),ne=re?this.proxyToSource[A.key][re.id]:[A];if(!ne)continue;let ge=ne;f.viewport.set([0,0,N.fb.width,N.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(N,ne,ee,re),Z=re?re.id:null),c.renderLayer(c,re,ee,ge)}if(U.drawBuffers([U.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let ee=c.style._mergedLayers[w[q]];if(ee.isHidden(c.transform.zoom))continue;let re=c.style.getLayerSourceCache(ee),ne=re?this.proxyToSource[A.key][re.id]:[A];if(!ne)continue;let ge=ne;f.viewport.set([0,0,N.fb.width,N.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(N,ne,ee,re),Z=re?re.id:null),c.renderLayer(c,re,ee,ge)}this.renderedToTile?(N.dirty=!0,S.push(L.tileID)):j||--M,M===5&&(M=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),x.end+1}postRender(){}isLayerOrderingCorrect(o){let c=o.order.length,f=-1,_=c;for(let y=0;y<c;++y)this._style.isLayerDraped(o._mergedLayers[o.order[y]])?f=Math.max(f,y):_=Math.min(_,y);return _>f}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,f){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,w=1<<x.overscaledZ,{x:S,y:M}=x.canonical,A=S/w,L=(S+1)/w,F=M/w,N=(M+1)/w;return{minx:A,miny:F,maxx:L,maxy:N,t:y.dem.tree.raycastRoot(A,F,L,N,o,c,f),tile:y}});_.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of _){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,o,c,f);if(x!=null)return x}return null}_createFBO(){let o=this.painter.context,c=o.gl,f=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);let _=new r.T(o,{width:f[0],height:f[1],data:null},c.RGBA8);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);let y=o.createFramebuffer(f[0],f[1],1,null),x;return y.colorAttachment0.set(_.texture),this._emissiveTexture&&(x=new r.T(o,{width:f[0],height:f[1],data:null},c.R8),x.bind(c.LINEAR,c.CLAMP_TO_EDGE),y.createColorAttachment(o,1),y.colorAttachment1.set(x.texture)),y.depthAttachment=new Jb(o,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:y,tex:_,emissiveTex:x,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(let c of this.pool)this._updateFBO(c,o);for(let c of this.proxySourceCache.renderCache)this._updateFBO(c,o);this._emissiveTexture=o}}_updateFBO(o,c){let f=o.fb,_=this.painter.context,y=_.gl,x=this.drapeBufferSize;if(c){let w=new r.T(_,{width:x[0],height:x[1],data:null},y.R8);w.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.emissiveTex=w,f.createColorAttachment(_,1),f.colorAttachment1.set(w.texture)}else o.emissiveTex=void 0,f.removeColorAttachment(_,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let c=this._style._mergedLayers[o],f=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let f of this._style.getSources())if(f instanceof Qu){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="line")continue;let x=_.widthExpression(),w=_.emissiveStrengthExpression();if(x instanceof r.ad||w instanceof r.ad){c[y.id]=!0;for(let S of this.proxyCoords){let M=this.proxyToSource[S.key][y.id];if(M)for(let A of M)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof wo){o=!0;break}if(!o)return;let c={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let x=_.paint.get("raster-fade-duration");for(let w of this.proxyCoords){let S=this.proxyToSource[w.key][y.id];if(S)for(let M of S){let A=Rp(y.getTile(M),y.findLoadedParent(M,0),y,this.painter.transform,x);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(y.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let o=this._style.order,c=o.length;if(c===0)return;let f=[];this._pendingGroundEffectLayers=[];let _,y=0,x=this._style._mergedLayers[o[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<c;)x=this._style._mergedLayers[o[y]];for(;y<c;++y){let w=this._style._mergedLayers[o[y]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?_===void 0&&(_=y):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(f.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:y-1}),f.length!==0){let w=f[f.length-1];this._pendingGroundEffectLayers.every(S=>S>w.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(o){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let x=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let w=0;w<x.length;++w){let S=Object.values(x[w]);c.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,_=this._tilesDirty;for(let x=f.length-1;x>=0;x--){let w=f[x];if(c.getTileByID(w.key),c.proxyCachedFBO[w.key]!==void 0){let S=o[w.key],M=this.proxyToSource[w.key],A=0;for(let L in M){let F=M[L],N=S[L];if(!N||N.length!==F.length||F.some((j,U)=>j!==N[U]||_[L]&&_[L].hasOwnProperty(j.key))){A=-1;break}++A}for(let L in c.proxyCachedFBO[w.key])c.renderCache[c.proxyCachedFBO[w.key][L]].dirty=A<0||A!==Object.values(S).length}}let y=[...this._drapedRenderBatches];y.sort((x,w)=>w.end-w.start-(x.end-x.start));for(let x of y)for(let w of f){if(c.proxyCachedFBO[w.key])continue;let S=c.renderCachePool.pop();S===void 0&&c.renderCache.length<50&&(S=c.renderCache.length,c.renderCache.push(this._createFBO())),S!==void 0&&(c.proxyCachedFBO[w.key]={},c.proxyCachedFBO[w.key][x.start]=S,c.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let w;if(f.isTileClipped())w=c.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):cn.disabled}_renderTileClippingMasks(o,c){let f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(xn.disabled),_.setDepthMode(Gt.disabled);let x=f.getOrCreateProgram("clippingMask");for(let w of o){let S=f._tileClippingMaskIDs[w.key]=--c;x.draw(f,y.TRIANGLES,Gt.disabled,new cn({func:y.ALWAYS,mask:0},S,255,y.KEEP,y.KEEP,y.REPLACE),xn.disabled,ln.disabled,Op(w.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(o){let c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;let f=[o.x,o.y,1,1];r.aC(f,f,c.pixelMatrixInverse),r.cK(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;let _=c._camera.position,y=r.cf(1,c.center.lat),x=[_[0],_[1],_[2]/y,0],w=r.da([],f.slice(0,3),x);r.aw(w,w);let S=this.raycast(x,w,this._exaggeration);return S!==null&&S?(r.bH(x,x,w,S),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(o,c,f){if(o.getSource()instanceof r.aU)return this._setupProxiedCoordsForImageSource(o,c,f);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords;for(let S=0;S<y.length;S++){let M=y[S],A=this._findTileCoveringTileID(M,o);if(A){let L=this._createProxiedId(M,A,f[M.key]&&f[M.key][o.id]);_.push(L),this.proxyToSource[M.key][o.id]=[L]}}let x=!1,w=new Set;for(let S=0;S<c.length;S++){let M=o.getTile(c[S]);if(!M||!M.hasData())continue;let A=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==M.tileID.canonical.z){let L=this.proxyToSource[A.tileID.key][o.id],F=this._createProxiedId(A.tileID,M,f[A.tileID.key]&&f[A.tileID.key][o.id]);L?L.splice(L.length-1,0,F):this.proxyToSource[A.tileID.key][o.id]=[F];let N=this.proxyToSource[A.tileID.key][o.id];w.has(N)||w.add(N),_.push(F),x=!0}}if(this._sourceTilesOverlap[o.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let S of w)S.sort((M,A)=>A.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(o,c,f){if(!o.getSource().loaded())return;let _=this.proxiedCoords[o.id]=[],y=this.proxyCoords,x=o.getSource(),w=x.tileID;if(!w)return;let S=new r.P(w.x,w.y)._div(1<<w.z),M=x.coordinates.map(r.ae.fromLngLat).reduce((L,F)=>(L.min.x=Math.min(L.min.x,F.x-S.x),L.min.y=Math.min(L.min.y,F.y-S.y),L.max.x=Math.max(L.max.x,F.x-S.x),L.max.y=Math.max(L.max.y,F.y-S.y),L),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(L,F)=>{let N=L.wrap+L.canonical.x/(1<<L.canonical.z),j=L.canonical.y/(1<<L.canonical.z),U=r.al/(1<<L.canonical.z),Z=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z);return N+U<Z+M.min.x||N>Z+M.max.x||j+U<q+M.min.y||j>q+M.max.y};for(let L=0;L<y.length;L++){let F=y[L];for(let N=0;N<c.length;N++){let j=o.getTile(c[N]);if(!j||!j.hasData()||A(F,j.tileID))continue;let U=this._createProxiedId(F,j,f[F.key]&&f[F.key][o.id]),Z=this.proxyToSource[F.key][o.id];Z?Z.push(U):this.proxyToSource[F.key][o.id]=[U],_.push(U)}}}_createProxiedId(o,c,f){let _=this.orthoMatrix;if(f){let y=f.find(x=>x.key===c.tileID.key);if(y)return y}if(c.tileID.key!==o.key){let y=o.canonical.z-c.tileID.canonical.z,x,w,S;_=r.bC();let M=c.tileID.wrap-o.wrap<<o.overscaledZ;y>0?(x=r.al>>y,w=x*((c.tileID.canonical.x<<y)-o.canonical.x+M),S=x*((c.tileID.canonical.y<<y)-o.canonical.y)):(x=r.al<<-y,w=r.al*(c.tileID.canonical.x-(o.canonical.x+M<<-y)),S=r.al*(c.tileID.canonical.y-(o.canonical.y<<-y))),r.ce(_,0,x,0,x,0,1),r.br(_,_,[w,S,0])}return new nv(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let f=c.getTile(o);if(f&&f.hasData())return f;let _=this._findCoveringTileCache[c.id],y=_[o.key];if(f=y?c.getTileByID(y):null,f&&f.hasData()||y===null)return f;let x=f?f.tileID:o,w=x.overscaledZ,S=c.getSource().minzoom,M=[];if(!y){let L=c.getSource().maxzoom;if(o.canonical.z>=L){let F=o.canonical.z-L;c.getSource().reparseOverscaled?(w=Math.max(o.canonical.z+2,c.transform.tileZoom),x=new r.aQ(w,o.wrap,L,o.canonical.x>>F,o.canonical.y>>F)):F!==0&&(w=L,x=new r.aQ(w,o.wrap,L,o.canonical.x>>F,o.canonical.y>>F))}x.key!==o.key&&(M.push(x.key),f=c.getTile(x))}let A=L=>{M.forEach(F=>{_[F]=L}),M.length=0};for(w-=1;w>=S&&(!f||!f.hasData());w--){f&&A(f.tileID.key);let L=x.calculateScaledKey(w);if(f=c.getTileByID(L),f&&f.hasData())break;let F=_[L];if(F===null)break;F===void 0?M.push(L):f=c.getTileByID(F)}return A(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let f=this._tilesDirty[o];f||(f=this._tilesDirty[o]={}),f[c.key]=!0}}function ah(p,o,c){let f=(function(w,S,M){let A=r.bJ(S,w),L=r.bJ(M,[.2126,.7152,.0722]),F=(j,U,Z)=>(1-Z)*j+Z*U,N=F(1-.3*Math.min(L,1),1,Math.min(A+1,1));return F(.92,1,Math.asin(r.aA(S[2],-1,1))/Math.PI+.5)*N})(p,[0,0,1],o),_=[0,0,0];r.c5(_,c.slice(0,3),f);let y=[0,0,0];r.c5(y,o.slice(0,3),p[2]);let x=[0,0,0];return r.d8(x,_,y),r.db(x)}let rI=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],oI=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class e1{static cacheKey(o,c,f,_){let y=[c];_&&y.push(_.cacheKey);for(let x of f)o.usedDefines.has(x)&&y.push(x);return y.join("/")}constructor(o,c,f,_,y,x){let w=o.gl;this.program=w.createProgram(),this.configuration=_,this.name=c,this.fixedDefines=[...x];let S=`#version 300 es
${(_?_.defines():[]).concat(x.map(U=>`#define ${U}`)).join(`
`)}`,M=[S,YT];for(let U of f.fragmentIncludes)M.push(Jc[U]);M.push(f.fragmentSource);let A=M.join(`
`),L=[S,Hb];for(let U of f.vertexIncludes)L.push(Jc[U]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&f.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&L.push("uniform int u_instanceID;"),L.push(f.vertexSource);let F=L.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));let N=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(N,A),w.compileShader(N),w.attachShader(this.program,N);let j=w.createShader(w.VERTEX_SHADER);w.isContextLost()?this.failedToCreate=!0:(w.shaderSource(j,F),w.compileShader(j),w.attachShader(this.program,j),this.attributes={},w.linkProgram(this.program),w.deleteShader(j),w.deleteShader(N),this.fixedUniforms=y(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=_?_.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(U=>({u_instanceID:new r.ch(U)}))(o)),(x.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(U=>({u_dem:new r.ch(U),u_dem_prev:new r.ch(U),u_dem_tl:new r.ck(U),u_dem_scale:new r.cj(U),u_dem_tl_prev:new r.ck(U),u_dem_scale_prev:new r.cj(U),u_dem_size:new r.cj(U),u_dem_lerp:new r.cj(U),u_exaggeration:new r.cj(U),u_depth:new r.ch(U),u_depth_size_inv:new r.ck(U),u_depth_range_unpack:new r.ck(U),u_occluder_half_size:new r.cj(U),u_occlusion_depth_offset:new r.cj(U),u_meter_to_dem:new r.cj(U),u_label_plane_matrix_inv:new r.cl(U)}))(o)),x.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new r.ci(U),u_tile_tr_up:new r.ci(U),u_tile_br_up:new r.ci(U),u_tile_bl_up:new r.ci(U),u_tile_up_scale:new r.cj(U)}))(o)),x.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new r.cl(U),u_fog_range:new r.ck(U),u_fog_color:new r.d3(U),u_fog_horizon_blend:new r.cj(U),u_fog_vertical_limit:new r.ck(U),u_fog_temporal_offset:new r.cj(U),u_frustum_tl:new r.ci(U),u_frustum_tr:new r.ci(U),u_frustum_br:new r.ci(U),u_frustum_bl:new r.ci(U),u_globe_pos:new r.ci(U),u_globe_radius:new r.cj(U),u_globe_transition:new r.cj(U),u_is_globe:new r.ch(U),u_viewport:new r.ck(U)}))(o)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new r.d3(U)}))(o)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new r.ci(U),u_lighting_directional_dir:new r.ci(U),u_lighting_directional_color:new r.ci(U),u_ground_radiance:new r.ci(U)}))(o)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new r.cl(U),u_light_matrix_1:new r.cl(U),u_fade_range:new r.ck(U),u_shadow_normal_offset:new r.ci(U),u_shadow_intensity:new r.cj(U),u_shadow_texel_size:new r.cj(U),u_shadow_map_resolution:new r.cj(U),u_shadow_direction:new r.ci(U),u_shadow_bias:new r.ci(U),u_shadowmap_0:new r.ch(U),u_shadowmap_1:new r.ch(U)}))(o)))}getAttributeLocation(o,c){let f=this.attributes[c];return f===void 0&&(f=this.attributes[c]=o.getAttribLocation(this.program,c)),f}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setCutoffUniformValues(o,c){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setLightsUniformValues(o,c){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}}setShadowUniformValues(o,c){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;o.program.set(this.program);for(let _ in c)f[_].set(this.program,_,c[_])}_drawDebugWireframe(o,c,f,_,y,x,w,S,M,A){let L=o.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;let F=o.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||o._terrain&&o._terrain.renderingToTexture||!rI.includes(this.name))||!(!L.layers3D||!oI.includes(this.name))))return;let N=F.gl,j=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,y,F);if(!j)return;let U=[...this.fixedDefines,"DEBUG_WIREFRAME"],Z=o.getOrCreateProgram(this.name,{config:this.configuration,defines:U});F.program.set(Z.program);let q=(ne,ge,de)=>{if(ge[ne]&&de[ne])for(let fe in ge[ne])de[ne][fe]&&de[ne][fe].set(de.program,fe,ge[ne][fe].current)};M&&M.setUniforms(Z.program,F,Z.binderUniforms,w,{zoom:S}),q("fixedUniforms",this,Z),q("terrainUniforms",this,Z),q("globeUniforms",this,Z),q("fogUniforms",this,Z),q("lightsUniforms",this,Z),q("shadowUniforms",this,Z),j.bind(),F.setColorMode(new xn([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],r.ao.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Gt(c.func===N.LESS?N.LEQUAL:c.func,Gt.ReadOnly,c.range)),F.setStencilMode(cn.disabled);let ee=3*x.primitiveLength*2,re=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let ne=A||1;for(let ge=0;ge<ne;++ge)Z.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,re)}else A&&A>1?N.drawElementsInstanced(N.LINES,ee,N.UNSIGNED_SHORT,re,A):N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,re);y.bind(),F.program.set(this.program),F.setDepthMode(c),F.setStencilMode(f),F.setColorMode(_)}checkUniforms(o,c,f){if(this.fixedDefines.includes(c)){for(let _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${_} not set but required by ${c} being defined`)}}draw(o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z){let q=o.context,ee=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(f),q.setStencilMode(_),q.setColorMode(y),q.setCullFace(x);for(let[ue,ae]of this.fixedUniformsEntries)ae.set(this.program,ue,w[ue]);j&&j.setUniforms(this.program,q,this.binderUniforms,F,{zoom:N});let re={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[c];this.checkUniforms(S,"RENDER_SHADOWS",this.shadowUniforms);let ne=U||[],ge=j?j.getPaintVertexBuffers():[],de=c===ee.TRIANGLES&&A,fe=Z&&Z>0?1:void 0;for(let ue of L.get()){let ae=ue.vaos||(ue.vaos={});if((ae[S]||(ae[S]=new XT)).bind(q,this,M,ge,A,ue.vertexOffset,ne,fe),this.forceManualRenderingForInstanceIDShaders){let _e=Z||1;for(let De=0;De<_e;++De)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",De),A?ee.drawElements(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2):ee.drawArrays(c,ue.vertexOffset,ue.vertexLength)}else Z&&Z>1?ee.drawElementsInstanced(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2,Z):A?ee.drawElements(c,ue.primitiveLength*re,ee.UNSIGNED_SHORT,ue.primitiveOffset*re*2):ee.drawArrays(c,ue.vertexOffset,ue.vertexLength);de&&this._drawDebugWireframe(o,f,_,y,A,ue,F,N,j,Z)}}}function t1(p,o,c=0){let f=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,p.transform.tileZoom)/f,y=_*(o.tileID.canonical.x+o.tileID.wrap*f),x=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(o,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:c}}let $m={terrain:0,flat:1},sI=r.bC(),Hm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q)=>{let ee=o.style.light,re=ee.properties.get("position"),ne=[re.x,re.y,re.z],ge=r.dO();ee.properties.get("anchor")==="viewport"&&(r.dP(ge,-o.transform.angle),r.dQ(ne,ne,ge));let de=ee.properties.get("color").toPremultipliedRenderColor(null),fe=o.transform,ue={u_matrix:p,u_lightpos:ne,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sI,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:$m[M],u_base_type:$m[A],u_ao:_,u_edge_radius:y,u_width_scale:x,u_flood_light_color:j,u_vertical_scale:U,u_flood_light_intensity:Z,u_ground_shadow_factor:q};return fe.projection.name==="globe"&&(ue.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],ue.u_zoom_transition=L,ue.u_inv_rot_matrix=N,ue.u_merc_center=F,ue.u_up_dir=fe.projection.upVector(new r.cD(0,0,0),F[0]*r.al,F[1]*r.al),ue.u_height_lift=S),ue},rv=(p,o,c,f,_,y)=>({u_matrix:p,u_edge_radius:o,u_width_scale:c,u_vertical_scale:f,u_height_type:$m[_],u_base_type:$m[y]}),n1=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q)=>{let ee=Hm(p,o,c,f,_,y,x,w,M,A,L,F,N,j,U,Z,1,[0,0,0]),re={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return Object.assign(ee,t1(o,S,q),re)},lh=(p,o,c,f,_,y,x,w,S,M,A)=>({u_matrix:o,u_opacity:c,u_ao_pass:f?1:0,u_meter_to_tile:_,u_ao:y,u_flood_light_intensity:x,u_flood_light_color:w,u_attenuation:S,u_edge_radius:M,u_fb:0,u_fb_size:A,u_dynamic_offset:1}),ov=(p,o,c)=>({u_matrix:p,u_emissive_strength:o,u_ground_shadow_factor:c}),sv=(p,o,c,f,_,y=0)=>Object.assign(ov(p,o,_),t1(c,f,y)),i1=(p,o,c,f)=>({u_matrix:p,u_world:c,u_emissive_strength:o,u_ground_shadow_factor:f}),av=(p,o,c,f,_,y,x=0)=>Object.assign(sv(p,o,c,f,y,x),{u_world:_}),tu=(p,o)=>({u_matrix:p,u_ground_shadow_factor:o}),ld=(p,o,c,f,_)=>({u_matrix:p,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:c,u_height_scale:f,u_reset_depth:_}),Gm=(p,o,c,f,_,y,x,w,S)=>({u_matrix:p,u_normal_matrix:o,u_opacity:c,u_faux_facade_ao_intensity:f,u_camera_pos:_,u_tile_to_meter:y,u_facade_emissive_chance:x,u_flood_light_color:w,u_flood_light_intensity:S}),r1=p=>({u_matrix:p}),nu=p=>({u_matrix:p}),lv=(p,o,c,f,_,y,x,w)=>{let S=r.al/y.tileSize;return{u_matrix:p,u_inv_rot_matrix:o,u_camera_to_center_distance:c.getCameraToCenterDistance(w),u_extrude_scale:[c.pixelsToGLUnits[0]/S,c.pixelsToGLUnits[1]/S],u_zoom_transition:f,u_tile_id:x,u_merc_center:_}},kp=(p,o,c=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:c}),o1=r.bC(),s1=(p,o,c,f,_,y,x)=>{let w=p.transform,S=w.projection.name==="globe",M=S?r.dR(w.zoom,o.canonical)*w._pixelsPerMercatorPixel:r.ay(c,1,y),A={u_matrix:o.projMatrix,u_extrude_scale:M,u_intensity:x,u_inv_rot_matrix:o1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){A.u_inv_rot_matrix=f,A.u_merc_center=_,A.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],A.u_zoom_transition=r.aj(w.zoom);let L=_[0]*r.al,F=_[1]*r.al;A.u_up_dir=w.projection.upVector(new r.cD(0,0,0),L,F)}return A};function qm(p,[o,c,f,_],[y,x]){if(y===x)return[0,0,0,0];let w=255*(p-1)/(p*(x-y));return[o*w,c*w,f*w,_*w]}function Wm(p,o,[c,f]){return c===f?0:.5/p+(o-c)*(p-1)/(p*(f-c))}let a1=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee,re,ne)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:r.dT(L.paint.get("raster-saturation")),u_contrast_factor:r.dS(L.paint.get("raster-contrast")),u_spin_weights:l1(L.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S,u_colorization_mix:qm(r.dU,U,q),u_colorization_offset:Wm(r.dU,Z,q),u_color_ramp:j,u_texture_offset:[re/(ee+2*re),ee/(ee+2*re)],u_texture_res:[ee+2*re,ee+2*re],u_emissive_strength:ne});function l1(p){p*=Math.PI/180;let o=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}let wl=.05,aI=(p,o,c,f,_,y,x,w,S,M,A,L)=>({u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:S}),lI=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_tile_offset:c,u_velocity:f,u_color_ramp:y,u_velocity_res:_,u_max_speed:x,u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[wl,wl]}),c1=(p,o,c,f,_,y,x,w,S,M)=>({u_particle_texture:p,u_particle_texture_side_len:o,u_velocity:c,u_velocity_res:f,u_max_speed:_,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[wl,wl]}),u1=r.bC(),Zm=(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee,re,ne,ge,de,fe)=>{let ue=_.transform,ae={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(ee),u_rotate_symbol:+c,u_aspect_ratio:ue.width/ue.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+M,u_elevation_from_sea:S?1:0,u_pitch_with_map:+f,u_texsize:A,u_texsize_icon:L,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:u1,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:u1,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:de||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(ee)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:fe||1,u_ground_shadow_factor:re,u_inv_matrix:r.bl(r.bC(),x),u_normal_scale:ne,u_lutTexture:Co.LUT};return ee.name==="globe"&&(ae.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],ae.u_zoom_transition=j,ae.u_inv_rot_matrix=Z,ae.u_merc_center=U,ae.u_camera_forward=ue._camera.forward(),ae.u_ecef_origin=r.dV(ue.globeMatrix,N.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(ue.globeMatrix),ae.u_up_vector=q),ae},Fp=(p,o,c,f)=>({u_matrix:p,u_emissive_strength:o,u_opacity:c,u_color:f}),iu=(p,o,c,f,_,y,x,w,S)=>Object.assign((function(M,A,L,F,N,j){let{width:U,height:Z}=F.imageManager.getPixelSize(A),q=Math.pow(2,j.tileID.overscaledZ),ee=j.tileSize*Math.pow(2,F.transform.tileZoom)/q,re=ee*(j.tileID.canonical.x+j.tileID.wrap*q),ne=ee*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[U,Z],u_pattern_size:L.displaySize,u_pattern_units_to_pixels:N?[F.transform.width,-1*F.transform.height]:[1/r.ay(j,1,F.transform.tileZoom),1/r.ay(j,1,F.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}})(0,y,x,f,w,S),{u_matrix:p,u_emissive_strength:o,u_opacity:c}),ch=new Float32Array(r.bA([])),cd=(p,o,c,f,_,y,x,w,S,M,A,L,F,N=[0,0,0],j,U,Z)=>{let q=_.style.light,ee=q.properties.get("position"),re=[-ee.x,-ee.y,ee.z],ne=r.dO();q.properties.get("anchor")==="viewport"&&(r.dP(ne,-_.transform.angle),r.dQ(re,re,ne));let ge=A.alphaMode==="MASK",de=q.properties.get("color").toNonPremultipliedRenderColor(null),fe=F.paint.get("model-ambient-occlusion-intensity"),ue=F.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return ue.a=F.paint.get("model-color-mix-intensity").constantOr(0),Z&&(ue.r=Z[0],ue.g=Z[1],ue.b=Z[2],ue.a=Z[3]),U&&(ue.r=U.color.r,ue.g=U.color.g,ue.b=U.color.b,ue.a=U.colorMix,L=U.emissionStrength,y*=U.opacity),{u_matrix:p,u_lighting_matrix:o,u_normal_matrix:c,u_node_matrix:f||ch,u_lightpos:re,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:N,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:A.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:S,u_roughnessFactor:M,u_baseColorTexture:Co.BaseColor,u_metallicRoughnessTexture:Co.MetallicRoughness,u_normalTexture:Co.Normal,u_occlusionTexture:Co.Occlusion,u_emissionTexture:Co.Emission,u_lutTexture:Co.LUT,u_color_mix:ue.toArray01(),u_aoIntensity:fe,u_emissive_strength:L,u_occlusionTextureTransform:j||[0,0,0,0]}},cv=(p,o=ch,c=ch)=>({u_matrix:p,u_instance:o,u_node_matrix:c}),Ym={fillExtrusion:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_opacity:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_flood_light_color:new r.ci(p),u_vertical_scale:new r.cj(p),u_flood_light_intensity:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new r.cl(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_vertical_scale:new r.cj(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_height_factor:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_opacity:new r.cj(p),u_pattern_transition:new r.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.cl(p),u_opacity:new r.cj(p),u_ao_pass:new r.cj(p),u_meter_to_tile:new r.cj(p),u_ao:new r.ck(p),u_flood_light_intensity:new r.cj(p),u_flood_light_color:new r.ci(p),u_attenuation:new r.cj(p),u_edge_radius:new r.cj(p),u_fb:new r.ch(p),u_fb_size:new r.cj(p),u_dynamic_offset:new r.cj(p)}),fill:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),fillOutline:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_ground_shadow_factor:new r.ci(p)}),fillOutlinePattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),building:p=>({u_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_opacity:new r.cj(p),u_faux_facade_ao_intensity:new r.cj(p),u_camera_pos:new r.ci(p),u_tile_to_meter:new r.cj(p),u_facade_emissive_chance:new r.cj(p),u_flood_light_color:new r.ci(p),u_flood_light_intensity:new r.cj(p)}),buildingBloom:p=>({u_matrix:new r.cl(p)}),buildingDepth:p=>({u_matrix:new r.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new r.cl(p),u_depth_bias:new r.cj(p)}),elevatedStructures:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new r.cl(p),u_camera_pos:new r.ci(p),u_depth_bias:new r.cj(p),u_height_scale:new r.cj(p),u_reset_depth:new r.cj(p)}),circle:r.dY,collisionBox:p=>({u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_extrude_scale:new r.ck(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p)}),collisionCircle:p=>({u_matrix:new r.cl(p),u_inv_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_viewport_size:new r.ck(p)}),debug:p=>({u_color:new r.dB(p),u_matrix:new r.cl(p),u_overlay:new r.ch(p),u_overlay_scale:new r.cj(p)}),clippingMask:p=>({u_matrix:new r.cl(p)}),heatmap:p=>({u_extrude_scale:new r.cj(p),u_intensity:new r.cj(p),u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_up_dir:new r.ci(p)}),heatmapTexture:p=>({u_image:new r.ch(p),u_color_ramp:new r.ch(p),u_opacity:new r.cj(p)}),hillshade:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_latrange:new r.ck(p),u_light:new r.ck(p),u_shadow:new r.dB(p),u_highlight:new r.dB(p),u_emissive_strength:new r.cj(p),u_accent:new r.dB(p)}),hillshadePrepare:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_dimension:new r.ck(p),u_zoom:new r.cj(p)}),line:r.dX,linePattern:r.dW,raster:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_brightness_low:new r.cj(p),u_brightness_high:new r.cj(p),u_saturation_factor:new r.cj(p),u_contrast_factor:new r.cj(p),u_spin_weights:new r.ci(p),u_perspective_transform:new r.ck(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p),u_colorization_mix:new r.d3(p),u_colorization_offset:new r.cj(p),u_color_ramp:new r.ch(p),u_texture_offset:new r.ck(p),u_texture_res:new r.ck(p),u_emissive_strength:new r.cj(p)}),rasterParticle:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p)}),rasterParticleTexture:p=>({u_texture:new r.ch(p),u_opacity:new r.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_tile_offset:new r.ck(p),u_velocity:new r.ch(p),u_color_ramp:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_velocity:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_speed_factor:new r.cj(p),u_reset_rate:new r.cj(p),u_rand_seed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new r.ch(p),u_is_size_feature_constant:new r.ch(p),u_size_t:new r.cj(p),u_size:new r.cj(p),u_camera_to_center_distance:new r.cj(p),u_rotate_symbol:new r.ch(p),u_aspect_ratio:new r.cj(p),u_fade_change:new r.cj(p),u_matrix:new r.cl(p),u_label_plane_matrix:new r.cl(p),u_coord_matrix:new r.cl(p),u_is_text:new r.ch(p),u_elevation_from_sea:new r.ch(p),u_pitch_with_map:new r.ch(p),u_texsize:new r.ck(p),u_texsize_icon:new r.ck(p),u_texture:new r.ch(p),u_texture_icon:new r.ch(p),u_gamma_scale:new r.cj(p),u_device_pixel_ratio:new r.cj(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_camera_forward:new r.ci(p),u_tile_matrix:new r.cl(p),u_up_vector:new r.ci(p),u_ecef_origin:new r.ci(p),u_is_halo:new r.ch(p),u_icon_transition:new r.cj(p),u_color_adj_mat:new r.cl(p),u_scale_factor:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_inv_matrix:new r.cl(p),u_normal_scale:new r.cj(p),u_lutTexture:new r.ch(p)}),background:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_color:new r.dB(p)}),backgroundPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_image:new r.ch(p),u_pattern_tl:new r.ck(p),u_pattern_br:new r.ck(p),u_texsize:new r.ck(p),u_pattern_size:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_pattern_units_to_pixels:new r.ck(p)}),terrainRaster:p=>({u_matrix:new r.cl(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_skirt_height:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_emissive_texture_available:new r.cj(p)}),skybox:p=>({u_matrix:new r.cl(p),u_sun_direction:new r.ci(p),u_cubemap:new r.ch(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxGradient:p=>({u_matrix:new r.cl(p),u_color_ramp:new r.ch(p),u_center_direction:new r.ci(p),u_radius:new r.cj(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new r.dC(p),u_sun_direction:new r.ci(p),u_sun_intensity:new r.cj(p),u_color_tint_r:new r.d3(p),u_color_tint_m:new r.d3(p),u_luminance:new r.cj(p)}),globeRaster:p=>({u_proj_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_grid_matrix:new r.dC(p),u_skirt_height:new r.cj(p),u_far_z_cutoff:new r.cj(p),u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_globe_pos:new r.ci(p),u_globe_radius:new r.cj(p),u_viewport:new r.ck(p),u_emissive_texture_available:new r.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_horizon:new r.cj(p),u_transition:new r.cj(p),u_fadeout_range:new r.cj(p),u_atmosphere_fog_color:new r.d3(p),u_high_color:new r.d3(p),u_space_color:new r.d3(p),u_temporal_offset:new r.cj(p),u_horizon_angle:new r.cj(p)}),model:p=>({u_matrix:new r.cl(p),u_lighting_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_node_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_camera_pos:new r.ci(p),u_opacity:new r.cj(p),u_baseColorFactor:new r.d3(p),u_emissiveFactor:new r.d3(p),u_metallicFactor:new r.cj(p),u_roughnessFactor:new r.cj(p),u_baseTextureIsAlpha:new r.ch(p),u_alphaMask:new r.ch(p),u_alphaCutoff:new r.cj(p),u_baseColorTexture:new r.ch(p),u_metallicRoughnessTexture:new r.ch(p),u_normalTexture:new r.ch(p),u_occlusionTexture:new r.ch(p),u_emissionTexture:new r.ch(p),u_lutTexture:new r.ch(p),u_color_mix:new r.d3(p),u_aoIntensity:new r.cj(p),u_emissive_strength:new r.cj(p),u_occlusionTextureTransform:new r.d3(p)}),modelDepth:p=>({u_matrix:new r.cl(p),u_instance:new r.cl(p),u_node_matrix:new r.cl(p)}),groundShadow:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),stars:p=>({u_matrix:new r.cl(p),u_up:new r.ci(p),u_right:new r.ci(p),u_intensity_multiplier:new r.cj(p)}),snowParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_horizontalOscillationRadius:new r.cj(p),u_horizontalOscillationRate:new r.cj(p),u_boxSize:new r.cj(p),u_billboardSize:new r.cj(p),u_simpleShapeParameters:new r.ck(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_particleColor:new r.d3(p),u_direction:new r.ci(p)}),rainParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_texScreen:new r.ch(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_boxSize:new r.cj(p),u_rainDropletSize:new r.ck(p),u_distortionStrength:new r.cj(p),u_rainDirection:new r.ci(p),u_color:new r.d3(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_shapeDirectionalPower:new r.cj(p),u_shapeNormalPower:new r.cj(p),u_mode:new r.cj(p)}),vignette:p=>({u_vignetteShape:new r.ci(p),u_vignetteColor:new r.d3(p)}),occlusion:p=>({u_matrix:new r.cl(p),u_anchorPos:new r.ci(p),u_screenSizePx:new r.ck(p),u_occluderSizePx:new r.ck(p),u_color:new r.d3(p)})},Lp=(()=>{class p{constructor(c,f,_,y){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++,this.context=c;let x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return p.uniqueIdxCounter=0,p})(),uv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class d1{constructor(o,c,f,_,y,x){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.instanceCount=x,this.context=o;let w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let f=0;f<this.attributes.length;f++){let _=c.getAttributeLocation(o,this.attributes[f].name);_!==-1&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=this.attributes[_],x=c.getAttributeLocation(o,y.name);x!==-1&&o.vertexAttribPointer(x,y.components,o[uv[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(o,c,f){for(let _=0;_<this.attributes.length;_++){let y=c.getAttributeLocation(o,this.attributes[_].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class h1{constructor(o,c,f,_,y){this.context=o,this.width=c,this.height=f;let x=this.framebuffer=o.gl.createFramebuffer();_>0&&(this.colorAttachment0=new zm(o,x,0)),_>1&&(this.colorAttachment1=new zm(o,x,1)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new oh(o,x):new Ap(o,x))}createColorAttachment(o,c){c===0?this.colorAttachment0=new zm(o,this.framebuffer,0):c===1&&(this.colorAttachment1=new zm(o,this.framebuffer,1))}removeColorAttachment(o,c){let f=this.context.gl,_;c===0?(_=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(_=this.colorAttachment1.get(),this.colorAttachment1=void 0),_&&f.deleteTexture(_)}destroy(){let o=this.context.gl;if(this.colorAttachment0){let c=this.colorAttachment0.get();c&&o.deleteTexture(c)}if(this.colorAttachment1){let c=this.colorAttachment1.get();c&&o.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&o.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&o.deleteTexture(c)}o.deleteFramebuffer(this.framebuffer)}}class uh{constructor(o,c){this.gl=o,this.clearColor=new eI(this),this.clearDepth=new Gb(this),this.clearStencil=new q0(this),this.colorMask=new Rm(this),this.depthMask=new W0(this),this.stencilMask=new ad(this),this.stencilFunc=new th(this),this.stencilOp=new Mp(this),this.stencilTest=new nh(this),this.depthRange=new qb(this),this.depthTest=new Z0(this),this.depthFunc=new Wb(this),this.blend=new ih(this),this.blendFunc=new km(this),this.blendColor=new Fm(this),this.blendEquation=new Y0(this),this.cullFace=new Lm(this),this.cullFaceSide=new Dp(this),this.frontFace=new Zb(this),this.program=new Yb(this),this.activeTexture=new Xb(this),this.viewport=new rh(this),this.bindFramebuffer=new Kb(this),this.bindRenderbuffer=new tI(this),this.bindTexture=new nI(this),this.bindVertexBuffer=new iI(this),this.bindElementBuffer=new X0(this),this.bindVertexArrayOES=new K0(this),this.pixelStoreUnpack=new Q0(this),this.pixelStoreUnpackPremultiplyAlpha=new J0(this),this.pixelStoreUnpackFlipY=new Qb(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c,f){return new Lp(this,o,c,f)}createVertexBuffer(o,c,f,_,y){return new d1(this,o,c,f,_,y)}createRenderbuffer(o,c,f){let _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,o,c,f),this.bindRenderbuffer.set(null),y}createFramebuffer(o,c,f,_){return new h1(this,o,c,f,_)}clear({color:o,depth:c,stencil:f,colorMask:_}){let y=this.gl,x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){r.by(o.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ud;function Lt(p,o,c,f,_,y,x){let w=p.context,S=w.gl,M=p.transform,A=[r.aF(M.center.lng),r.aJ(M.center.lat)],L=c.layout.get("symbol-placement"),F=c.layout.get("text-variable-anchor"),N=c.layout.get("icon-rotation-alignment")==="map",j=c.layout.get("text-rotation-alignment")==="map",U=L!=="point",Z=[],q=0,ee=0;for(let ae=0;ae<f.length;ae++){let _e=f[ae],De=o.getTile(_e),Ce=De.getBucket(c);if(!Ce)continue;let Be=Ce.getProjection().createInversionMatrix(M,_e.canonical),Ue=[],Ye=gm(_e,Ce,M),dt=!x&&N&&U,Fe=x&&j&&U,be=F&&Ce.hasTextData(),Ge=Ce.hasIconTextFit()&&be&&Ce.hasIconData(),Le=dt||Fe||x&&be||Ge,tt=Ce.projection.name==="globe",bt=tt?r.aj(M.zoom):0;tt&&(Ue.push("PROJECTION_GLOBE_VIEW"),Le&&Ue.push("PROJECTED_POS_ON_VIEWPORT"));let At=p.getOrCreateProgram("collisionBox",{defines:Ue}),_t=Ye;_[0]===0&&_[1]===0||(_t=p.translatePosMatrix(Ye,De,_,y));let pt=x?Ce.textCollisionBox:Ce.iconCollisionBox,jt=Ce.collisionCircleArray;if(jt.length>0){let Tt=r.bC(),Ot=_t;r.cP(Tt,Ce.placementInvProjMatrix,M.glCoordMatrix),r.cP(Tt,Tt,Ce.placementViewportMatrix),Z.push({circleArray:jt,circleOffset:ee,transform:Ot,invTransform:Tt,projection:Ce.getProjection()}),q+=jt.length/4,ee=q}if(!pt)continue;p.terrain&&p.terrain.setupElevationDraw(De,At);let zt=tt?[_e.canonical.x,_e.canonical.y,1<<_e.canonical.z]:[0,0,0];At.draw(p,S.LINES,Gt.disabled,cn.disabled,p.colorModeForRenderPass(),ln.disabled,lv(_t,Be,M,bt,A,De,zt,Ce.getProjection()),c.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,M.zoom,null,[pt.collisionVertexBuffer,pt.collisionVertexBufferExt])}if(!x||!Z.length)return;let re=p.getOrCreateProgram("collisionCircle"),ne=new r.dZ;ne.resize(4*q),ne._trim();let ge=0;for(let ae of Z)for(let _e=0;_e<ae.circleArray.length/4;_e++){let De=4*_e,Ce=ae.circleArray[De+0],Be=ae.circleArray[De+1],Ue=ae.circleArray[De+2],Ye=ae.circleArray[De+3];ne.emplace(ge++,Ce,Be,Ue,Ye,0),ne.emplace(ge++,Ce,Be,Ue,Ye,1),ne.emplace(ge++,Ce,Be,Ue,Ye,2),ne.emplace(ge++,Ce,Be,Ue,Ye,3)}(!ud||ud.length<2*q)&&(ud=(function(ae){let _e=2*ae,De=new r.b0;De.resize(_e),De._trim();for(let Ce=0;Ce<_e;Ce++){let Be=6*Ce;De.uint16[Be+0]=4*Ce+0,De.uint16[Be+1]=4*Ce+1,De.uint16[Be+2]=4*Ce+2,De.uint16[Be+3]=4*Ce+2,De.uint16[Be+4]=4*Ce+3,De.uint16[Be+5]=4*Ce+0}return De})(q));let de=w.createIndexBuffer(ud,!0),fe=w.createVertexBuffer(ne,r.d_.members,!0);for(let ae of Z){let _e={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(ue=M).getCameraToCenterDistance(ae.projection),u_viewport_size:[ue.width,ue.height]};re.draw(p,S.TRIANGLES,Gt.disabled,cn.disabled,p.colorModeForRenderPass(),ln.disabled,_e,c.id,fe,de,r.bg.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,M.zoom)}var ue;fe.destroy(),de.destroy()}let Np=r.bC();function ic(p){let o=p._camera.getWorldToCamera(p.worldSize,1),c=r.aB([],o,p.globeMatrix);r.bl(c,c);let f=[0,0,0],_=[0,1,0,0];return r.aC(_,_,c),f[0]=_[0],f[1]=_[1],f[2]=_[2],r.aw(f,f),f}function ru({width:p,height:o,anchor:c,textOffset:f,textScale:_},y){let{horizontalAlign:x,verticalAlign:w}=r.c1(c),S=-(x-.5)*p,M=-(w-.5)*o,A=r.c2(c,f);return new r.P((S/_+A[0])*y,(M/_+A[1])*y)}function en(p,o,c,f,_,y,x,w,S,M){let A=p.text.placedSymbolArray,L=p.text.dynamicLayoutVertexArray,F=p.icon.dynamicLayoutVertexArray,N={},j=p.getProjection(),U=_l(x,j,_),Z=_.elevation,q=j.upVectorScale(x.canonical,_.center.lat,_.worldSize).metersToTile;L.clear();for(let ee=0;ee<A.length;ee++){let re=A.get(ee),{tileAnchorX:ne,tileAnchorY:ge,numGlyphs:de}=re,fe=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:f[re.crossTileID];if(fe){let ue=0,ae=0,_e=0,De=p.elevationType==="road";if(Z||De){let Le=De?p.getElevationFeatureForText(ee):null,tt=r.bV.getAtTileOffset(x,new r.P(ne,ge),Z,Le),[bt,At,_t]=j.upVector(x.canonical,ne,ge);ue=tt*bt*q,ae=tt*At*q,_e=tt*_t*q}let[Ce,Be,Ue,Ye]=xa(re.projectedAnchorX+ue,re.projectedAnchorY+ae,re.projectedAnchorZ+_e,c?U:y),dt=ui(_.getCameraToCenterDistance(j),Ye),Fe=r.bM(p.textSizeData,S,re)*dt/r.bY;c&&(Fe*=p.tilePixelRatio/w);let be=ru(fe,Fe);c?({x:Ce,y:Be,z:Ue}=j.projectTilePoint(ne+be.x,ge+be.y,x.canonical),[Ce,Be,Ue]=xa(Ce+ue,Be+ae,Ue+_e,y)):(o&&be._rotate(-_.angle),Ce+=be.x,Be+=be.y,Ue=0);let Ge=p.allowVerticalPlacement&&re.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let Le=0;Le<de;Le++)r.bO(L,Ce,Be,Ue,Ge);M&&re.associatedIconIndex>=0&&(N[re.associatedIconIndex]={x:Ce,y:Be,z:Ue,angle:Ge})}else Wa(de,L)}if(M){F.clear();let ee=p.icon.placedSymbolArray;for(let re=0;re<ee.length;re++){let ne=ee.get(re),{numGlyphs:ge}=ne,de=N[re];if(ne.hidden||!de)Wa(ge,F);else{let{x:fe,y:ue,z:ae,angle:_e}=de;for(let De=0;De<ge;De++)r.bO(F,fe,ue,ae,_e)}}p.icon.dynamicLayoutVertexBuffer.updateData(F)}p.text.dynamicLayoutVertexBuffer.updateData(L)}function zp(p,o,c,f,_,y,x={}){let w=c.paint.get("icon-translate"),S=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),A=c.paint.get("text-translate-anchor"),L=c.layout.get("icon-rotation-alignment"),F=c.layout.get("text-rotation-alignment"),N=c.layout.get("icon-pitch-alignment"),j=c.layout.get("text-pitch-alignment"),U=c.layout.get("icon-keep-upright"),Z=c.layout.get("text-keep-upright"),q=c.paint.get("icon-color-saturation"),ee=c.paint.get("icon-color-contrast"),re=c.paint.get("icon-color-brightness-min"),ne=c.paint.get("icon-color-brightness-max"),ge=c.layout.get("symbol-elevation-reference")==="sea",de=c.layout.get("icon-image-use-theme")==="none",fe=p.context,ue=fe.gl,ae=p.transform,_e=L==="map",De=F==="map",Ce=N==="map",Be=j==="map",Ue=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ye=!1,dt=p.depthModeForSublayer(0,Gt.ReadOnly),Fe=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),be=[r.aF(ae.center.lng),r.aJ(ae.center.lat)],Ge=c.layout.get("text-variable-anchor"),Le=ae.projection.name==="globe",tt=[],bt=[0,-1,0];for(let At of f){let _t=o.getTile(At),pt=_t.getBucket(c);if(!pt||pt.projection.name==="mercator"&&Le||pt.fullyClipped)continue;let jt=pt.projection.name==="globe",zt=jt?r.aj(ae.zoom):0,Tt=_l(At,pt.getProjection(),ae),Ot=ae.calculatePixelsToTileUnitsMatrix(_t),Jt=Ge&&pt.hasTextData(),fn=pt.hasIconTextFit()&&Jt&&pt.hasIconData(),Fn=pt.getProjection().createInversionMatrix(ae,At.canonical),Jn=(1<<_t.tileID.canonical.z)*r.al/p.transform.worldSize,$t=ri=>{let $n=[0,0,0];if(ri){let Cn=p.style.directionalLight,Gi=p.style.ambientLight;Cn&&Gi&&($n=tc(p.style,Cn,Gi))}return $n},Yn=ri=>{ae.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},pn=ri=>{c.lut&&!de&&(c.lut.texture||(c.lut.texture=new r.d$(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],fe.gl.RGBA8)),fe.activeTexture.set(fe.gl.TEXTURE0+Co.LUT),c.lut.texture&&c.lut.texture.bind(fe.gl.LINEAR,fe.gl.CLAMP_TO_EDGE),ri.push("APPLY_LUT_ON_GPU"))},ii=()=>{let ri=_e&&c.layout.get("symbol-placement")!=="point",$n=[];Yn($n),pn($n);let Cn=ri||fn,Gi=pt.elevationType==="road",Cr=p.shadowRenderer,ir=Gi&&Ce&&!!Cr&&Cr.enabled,Ti=$t(ir),_s=Gi&&Ce&&!p.terrain?Fe:dt,Lo=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ce&&$n.push("PITCH_WITH_MAP_TERRAIN"),jt&&($n.push("PROJECTION_GLOBE_VIEW"),Cn&&$n.push("PROJECTED_POS_ON_VIEWPORT")),Lo>0&&pt.hasAnySecondaryIcon&&$n.push("ICON_TRANSITION"),!pt.icon.zOffsetVertexBuffer||Gi&&p.terrain||$n.push("Z_OFFSET"),q===0&&ee===0&&re===0&&ne===1||$n.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&$n.push("RENDER_SDF"),ir&&$n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gi&&Ce&&!p.terrain&&pt.icon.orientationVertexBuffer&&$n.push("ELEVATED_ROADS");let Jr=pt.icon.programConfigurations.get(c.id),Qo=p.getOrCreateProgram("symbol",{config:Jr,defines:$n}),Jo=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],Do=pt.iconSizeData,ra=r.bK(Do,ae.zoom),Ma=Ce||!ae.isOrthographic,Ps=as(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Ot),_r=vp(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Ot),Mr=p.translatePosMatrix(_r,_t,w,M,!0),Ii=p.translatePosMatrix(Tt,_t,w,M),Lr=Cn?Np:Ps,dr=_e&&!Ce&&!ri,rr=bt;!Le&&!ae.mercatorFromTransition||_e||(rr=ic(ae));let Da=jt?rr:bt,Xp=c.getColorAdjustmentMatrix(q,ee,re,ne),Qa=Zm(Do.kind,ra,dr,Ce,p,Ii,Lr,Mr,ge,!1,Jo,[0,0],0,At,zt,be,Fn,Da,pt.getProjection(),Ti,Jn,Xp,Lo,null),Kp=_t.imageAtlasTexture?_t.imageAtlasTexture:null,yh=c.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,Il=pt.sdfIcons||p.options.rotating||p.options.zooming||yh||Ma?ue.LINEAR:ue.NEAREST,hc=pt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,xh=p.terrain&&Ce&&ri?r.bl(r.bC(),Ps):Np;if(ri&&pt.icon){let cu=r.bV.getAtTileOffsetFunc(At,ae.center.lat,ae.worldSize,pt.getProjection()),pc=_m(Tt,_t.tileID.canonical,Ce,_e,ae,pt.getProjection(),Ot),Ja=c.layout.get("icon-size-scale-range"),fc=r.aA(p.scaleFactor,Ja[0],Ja[1]);Lb(pt,Tt,p,!1,pc,_r,Ce,U,cu,At,fc)}return{program:Qo,buffers:pt.icon,uniformValues:Qa,atlasTexture:Kp,atlasTextureIcon:null,atlasInterpolation:Il,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:hc,depthMode:_s,tile:_t,renderWithShadows:ir,labelPlaneMatrixInv:xh}},gi=()=>{let ri=De&&c.layout.get("symbol-placement")!=="point",$n=[],Cn=ri||Ge||fn,Gi=pt.elevationType==="road",Cr=p.shadowRenderer,ir=Gi&&Be&&!!Cr&&Cr.enabled,Ti=$t(ir),_s=Gi&&Be&&!p.terrain?Fe:dt;p.terrainRenderModeElevated()&&Be&&$n.push("PITCH_WITH_MAP_TERRAIN"),jt&&($n.push("PROJECTION_GLOBE_VIEW"),Cn&&$n.push("PROJECTED_POS_ON_VIEWPORT")),!pt.text.zOffsetVertexBuffer||Gi&&p.terrain||$n.push("Z_OFFSET"),pt.iconsInText&&$n.push("RENDER_TEXT_AND_SYMBOL"),$n.push("RENDER_SDF"),ir&&$n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gi&&Be&&!p.terrain&&pt.text.orientationVertexBuffer&&$n.push("ELEVATED_ROADS"),Yn($n);let Lo=pt.text.programConfigurations.get(c.id),Jr=p.getOrCreateProgram("symbol",{config:Lo,defines:$n}),Qo,Jo=[0,0],Do=null,ra=pt.textSizeData;pt.iconsInText&&(Jo=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],Do=_t.imageAtlasTexture?_t.imageAtlasTexture:null,Qo=Be||!ae.isOrthographic||p.options.rotating||p.options.zooming||ra.kind==="composite"||ra.kind==="camera"?ue.LINEAR:ue.NEAREST);let Ma=_t.glyphAtlasTexture?_t.glyphAtlasTexture.size:[0,0],Ps=c.layout.get("text-size-scale-range"),_r=r.aA(p.scaleFactor,Ps[0],Ps[1]),Mr=r.bK(ra,ae.zoom,_r),Ii=as(Tt,_t.tileID.canonical,Be,De,ae,pt.getProjection(),Ot),Lr=vp(Tt,_t.tileID.canonical,Be,De,ae,pt.getProjection(),Ot),dr=p.translatePosMatrix(Lr,_t,S,A,!0),rr=p.translatePosMatrix(Tt,_t,S,A),Da=Cn?Np:Ii,Xp=De&&!Be&&!ri,Qa=bt;!Le&&!ae.mercatorFromTransition||De||(Qa=ic(ae));let Kp=Zm(ra.kind,Mr,Xp,Be,p,rr,Da,dr,ge,!0,Ma,Jo,0,At,zt,be,Fn,jt?Qa:bt,pt.getProjection(),Ti,Jn,null,null,_r),yh=_t.glyphAtlasTexture?_t.glyphAtlasTexture:null,Il=ue.LINEAR,hc=c.paint.get("text-halo-width").constantOr(1)!==0,xh=p.terrain&&Be&&ri?r.bl(r.bC(),Ii):Np;if(ri&&pt.text){let cu=r.bV.getAtTileOffsetFunc(At,ae.center.lat,ae.worldSize,pt.getProjection()),pc=_m(Tt,_t.tileID.canonical,Be,De,ae,pt.getProjection(),Ot);Lb(pt,Tt,p,!0,pc,Lr,Be,Z,cu,At,_r)}return{program:Jr,buffers:pt.text,uniformValues:Kp,atlasTexture:yh,atlasTextureIcon:Do,atlasInterpolation:Il,atlasInterpolationIcon:Qo,isSDF:!0,hasHalo:hc,depthMode:_s,tile:_t,renderWithShadows:ir,labelPlaneMatrixInv:xh}},di=pt.icon.segments.get().length,Wn=pt.text.segments.get().length,wn=di&&!x.onlyText?ii():null,ti=Wn&&!x.onlyIcons?gi():null,ur=c.paint.get("icon-opacity").constantOr(1),Ki=c.paint.get("text-opacity").constantOr(1);if(Ue&&pt.canOverlap){Ye=!0;let ri=ur&&!x.onlyText?pt.icon.segments.get():[],$n=Ki&&!x.onlyIcons?pt.text.segments.get():[];for(let Cn of ri)tt.push({segments:new r.bg([Cn]),sortKey:Cn.sortKey,state:wn});for(let Cn of $n)tt.push({segments:new r.bg([Cn]),sortKey:Cn.sortKey,state:ti})}else x.onlyText||tt.push({segments:ur?pt.icon.segments:new r.bg([]),sortKey:0,state:wn}),x.onlyIcons||tt.push({segments:Ki?pt.text.segments:new r.bg([]),sortKey:0,state:ti})}Ye&&tt.sort((At,_t)=>At.sortKey-_t.sortKey);for(let At of tt){let _t=At.state;if(_t)if(p.terrain?p.terrain.setupElevationDraw(_t.tile,_t.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:_t.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,_t.program),fe.activeTexture.set(ue.TEXTURE0),_t.atlasTexture&&_t.atlasTexture.bind(_t.atlasInterpolation,ue.CLAMP_TO_EDGE,!0),_t.atlasTextureIcon&&(fe.activeTexture.set(ue.TEXTURE1),_t.atlasTextureIcon&&_t.atlasTextureIcon.bind(_t.atlasInterpolationIcon,ue.CLAMP_TO_EDGE,!0)),_t.renderWithShadows&&p.shadowRenderer.setupShadows(_t.tile.tileID.toUnwrapped(),_t.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,_t.program),_t.hasHalo){let pt=_t.uniformValues;pt.u_is_halo=1,dv(_t.buffers,At.segments,c,p,_t.program,_t.depthMode,_,y,pt,2),pt.u_is_halo=0}else{if(_t.isSDF){let pt=_t.uniformValues;_t.hasHalo&&(pt.u_is_halo=1,dv(_t.buffers,At.segments,c,p,_t.program,_t.depthMode,_,y,pt,1)),pt.u_is_halo=0}dv(_t.buffers,At.segments,c,p,_t.program,_t.depthMode,_,y,_t.uniformValues,1)}}}function dv(p,o,c,f,_,y,x,w,S,M){let A=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,y,x,w,ln.disabled,S,c.id,p.layoutVertexBuffer,p.indexBuffer,o,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),A,M)}function p1(p,o){let c=1<<p.canonical.z,f=(o.x*c-p.canonical.x-p.wrap*c)*r.al,_=(o.y*c-p.canonical.y)*r.al,y=r.e8(o.z,o.y);return r.d5(f,_,y)}function Xm(p,o,c,f,_){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let y=p.context.gl,x=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),w=new Gt(p.context.gl.GREATER,Gt.ReadWrite,p.depthRangeFor3D),S=(function(N){let j=.01;return N.isOrthographic&&(j=r.ak(1e-4,j,r.d0(N.pitch>=Ya?1:N.pitch/Ya))),2*j})(p.transform),M=p.transform.getFreeCameraOptions().position,A="elevatedStructuresDepthReconstruct",L=p.getOrCreateProgram(A,{defines:["DEPTH_RECONSTRUCTION"]}),F=p.getOrCreateProgram(A);for(let N of f){let j=o.getTile(N),U=j.getBucket(c);if(!U)continue;let Z=U.elevatedStructures;if(!Z)continue;let q=U.elevationBufferData.heightRange,ee=p1(N.toUnwrapped(),M),re=p.translatePosMatrix(N.projMatrix,j,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),ne,ge,de,fe;if(_==="initialize"){if(!q||q.min>=1||Z.depthSegments.segments[0].primitiveLength===0)continue;ne=ld(re,ee,S,1,0),ge=x,de=Z.depthSegments,fe=L}else if(_==="reset"){if(!q||q.min>=0||Z.maskSegments.segments[0].primitiveLength===0)continue;ne=ld(re,ee,0,0,1),ge=w,de=Z.maskSegments,fe=L}else if(_==="geometry"){if(Z.depthSegments.segments[0].primitiveLength===0)continue;ne=ld(re,ee,S,1,0),ge=x,de=Z.depthSegments,fe=F}fe.draw(p,y.TRIANGLES,ge,cn.disabled,xn.disabled,ln.disabled,ne,c.id,Z.vertexBuffer,Z.indexBuffer,de,c.paint,p.transform.zoom)}}function Km(p,o,c,f){let{painter:_,sourceCache:y,layer:x,coords:w,colorMode:S,elevationType:M,terrainEnabled:A,pass:L}=p,F=_.context.gl,N=x.paint.get("fill-pattern"),j=x.paint.get("fill-pattern-cross-fade"),U=N.constantOr(null),Z=M;M!=="road"||o&&!A||(Z="none");let q=Z==="road",ee=p.painter.shadowRenderer,re=q&&!!ee&&ee.enabled,ne=new Gt(_.context.gl.LEQUAL,Gt.ReadOnly,_.depthRangeFor3D),ge=[0,0,0];if(re){let ae=_.style.directionalLight,_e=_.style.ambientLight;ae&&_e&&(ge=tc(_.style,ae,_e))}let de=N&&N.constantOr(1),fe=_.terrain&&_.terrain.renderingToTexture,ue=(ae,_e)=>{let De,Ce,Be,Ue,Ye;_e?(De=de&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=F.LINES):(De=de?"fillPattern":"fill",Be=F.TRIANGLES);for(let dt of w){let Fe=y.getTile(dt);if(de&&!Fe.patternsLoaded())continue;let be=Fe.getBucket(x);if(!be)continue;let Ge=o?be.elevationBufferData:be.bufferData;if(Ge.isEmpty())continue;_.prepareDrawTile();let Le=Ge.programConfigurations.get(x.id),tt=_.isTileAffectedByFog(dt),bt=[],At=[];q&&(bt.push("ELEVATED_ROADS"),At.push(Ge.elevatedLayoutVertexBuffer)),re&&bt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fe&&c&&bt.push("USE_MRT1"),de&&(_.context.activeTexture.set(F.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Le.updatePaintBuffers());let _t=!1;if(U&&Fe.imageAtlas){let Ot=Fe.imageAtlas,Jt=r.e3.from(U),fn=Jt.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Fn=Jt.getSecondary(),Jn=Ot.patternPositions.get(fn),$t=Fn?Ot.patternPositions.get(Fn.scaleSelf(r.o.devicePixelRatio).toString()):null;_t=!!Jn&&!!$t,Jn&&Le.setConstantPatternPositions(Jn,$t)}j>0&&(_t||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&bt.push("FILL_PATTERN_TRANSITION");let pt=_.getOrCreateProgram(De,{config:Le,overrideFog:tt,defines:bt}),jt=_.translatePosMatrix(dt.projMatrix,Fe,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));re&&ee.setupShadows(Fe.tileID.toUnwrapped(),pt,"vector-tile");let zt=x.paint.get("fill-emissive-strength");if(_e){Ue=Ge.lineIndexBuffer,Ye=Ge.lineSegments;let Ot=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ce=De==="fillOutlinePattern"&&de?av(jt,zt,_,Fe,Ot,ge,j):i1(jt,zt,Ot,ge)}else Ue=Ge.indexBuffer,Ye=Ge.triangleSegments,Ce=de?sv(jt,zt,_,Fe,ge,j):ov(jt,zt,ge);_.uploadCommonUniforms(_.context,pt,dt.toUnwrapped());let Tt=ae;(M==="road"&&!A||M==="offset")&&(Tt=ne),pt.draw(_,Be,Tt,f||_.stencilModeForClipping(dt),S,ln.disabled,Ce,x.id,Ge.layoutVertexBuffer,Ue,Ye,x.paint,_.transform.zoom,Le,At)}};_.renderPass===L&&ue(_.depthModeForSublayer(1,_.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),Z==="none"&&_.renderPass==="translucent"&&x.paint.get("fill-antialias")&&ue(_.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function Qm(p,o,c,f,_,y,x,w){c.resetLayerRenderingStats(p);let S=p.context,M=S.gl,A=p.transform,L=c.paint.get("fill-extrusion-pattern"),F=c.paint.get("fill-extrusion-pattern-cross-fade"),N=L.constantOr(null),j=L.constantOr(1),U=c.paint.get("fill-extrusion-opacity"),Z=p.style.enable3dLights(),q=c.paint.get(Z&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],re=c.layout.get("fill-extrusion-edge-radius"),ne=re>0&&!c.paint.get("fill-extrusion-rounded-roof"),ge=ne?0:re,de=A.projection.name==="globe"?r.eb():0,fe=A.projection.name==="globe",ue=fe?r.aj(A.zoom):0,ae=[r.aF(A.center.lng),r.aJ(A.center.lat)],_e=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(_e?null:c.lut).toArray01().slice(0,3),Ce=c.paint.get("fill-extrusion-flood-light-intensity"),Be=c.paint.get("fill-extrusion-vertical-scale"),Ue=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=c.paint.get("fill-extrusion-height-alignment"),dt=c.paint.get("fill-extrusion-base-alignment"),Fe=Yc(p,c.paint.get("fill-extrusion-cutoff-fade-range")),be=[],Ge;fe&&be.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&be.push("FAUX_AO"),ne&&be.push("ZERO_ROOF_RADIUS"),w&&be.push("HAS_CENTROID"),Ce>0&&be.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),Ue&&be.push("RENDER_WALL_MODE");let Le=p.renderPass==="shadow",tt=p.shadowRenderer,bt=Le&&!!tt,At=Le?ln.disabled:ln.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let _t=[0,0,0];if(tt){let zt=p.style.directionalLight,Tt=p.style.ambientLight;zt&&Tt&&(_t=tc(p.style,zt,Tt)),Le||(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),tt.useNormalOffset&&be.push("NORMAL_OFFSET")),Ge=be.concat(["SHADOWS_SINGLE_CASCADE"])}let pt=bt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",jt=c.getLayerRenderingStats();for(let zt of f){let Tt=o.getTile(zt),Ot=Tt.getBucket(c);if(!Ot||Ot.projection.name!==A.projection.name)continue;let Jt=!1;tt&&(Jt=tt.getMaxCascadeForTile(zt.toUnwrapped())===0);let fn=p.isTileAffectedByFog(zt),Fn=Ot.programConfigurations.get(c.id),Jn=!1;if(N&&Tt.imageAtlas){let Wn=Tt.imageAtlas,wn=r.e3.from(N),ti=wn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),ur=wn.getSecondary(),Ki=Wn.patternPositions.get(ti),ri=ur?Wn.patternPositions.get(ur.scaleSelf(r.o.devicePixelRatio).toString()):null;Jn=!!Ki&&!!ri,Ki&&Fn.setConstantPatternPositions(Ki,ri)}F>0&&(Jn||Fn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&be.push("FILL_EXTRUSION_PATTERN_TRANSITION");let $t=p.getOrCreateProgram(pt,{config:Fn,defines:Jt?Ge:be,overrideFog:fn});if(p.terrain&&p.terrain.setupElevationDraw(Tt,$t,{useMeterToDem:!0}),!Ot.centroidVertexBuffer){let Wn=$t.getAttributeLocation(M,"a_centroid_pos");Wn!==-1&&M.vertexAttrib2f(Wn,0,0)}!Le&&tt&&tt.setupShadows(Tt.tileID.toUnwrapped(),$t,"vector-tile"),j&&(p.context.activeTexture.set(M.TEXTURE0),Tt.imageAtlasTexture&&Tt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Fn.updatePaintBuffers());let Yn=c.paint.get("fill-extrusion-vertical-gradient"),pn=1/Ot.tileToMeter,ii;if(Le&&tt){if(oc(Tt.tileID,Ot.maxHeight,p))continue;let Wn=tt.calculateShadowPassMatrixFromTile(Tt.tileID.toUnwrapped());ii=rv(Wn,ge,pn,Be,Ye,dt)}else{let Wn=p.translatePosMatrix(zt.expandedProjMatrix,Tt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),wn=A.projection.createInversionMatrix(A,zt.canonical);ii=j?n1(Wn,p,Yn,U,ee,ge,pn,zt,Tt,de,Ye,dt,ue,ae,wn,De,Be,F):Hm(Wn,p,Yn,U,ee,ge,pn,zt,de,Ye,dt,ue,ae,wn,De,Be,Ce,_t)}p.uploadCommonUniforms(S,$t,zt.toUnwrapped(),null,Fe);let gi=Ot.segments;if(A.projection.name==="mercator"&&!Le&&(gi=Ot.getVisibleSegments(Tt.tileID,p.terrain,p.transform.getFrustum(0)),!gi.get().length))continue;if(jt)if(Le)for(let Wn of gi.get())jt.numRenderedVerticesInShadowPass+=Wn.primitiveLength;else for(let Wn of gi.get())jt.numRenderedVerticesInTransparentPass+=Wn.primitiveLength;let di=[];(p.terrain||w)&&di.push(Ot.centroidVertexBuffer),fe&&di.push(Ot.layoutVertexExtBuffer),Ue&&di.push(Ot.wallVertexBuffer),$t.draw(p,S.gl.TRIANGLES,_,y,x,At,ii,c.id,Ot.layoutVertexBuffer,Ot.indexBuffer,gi,c.paint,p.transform.zoom,Fn,di)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class hv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function rc(p,o,c,f,_,y,x,w,S,M,A,L,F,N,j,U,Z,q,ee,re){let ne=o.context,ge=ne.gl,de=o.transform,fe=o.transform.zoom,ue=[],ae=p.translate,_e=p.translateAnchor,De=p.edgeRadius,Ce=Yc(o,p.cutoffFadeRange);A==="clear"?(ue.push("CLEAR_SUBPASS"),re&&(ue.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(ge.TEXTURE0),re.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):A==="sdf"?ue.push("SDF_SUBPASS"):A==="emissive"&&(ue.push("USE_MRT1"),ne.activeTexture.set(ge.TEXTURE0),re.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)),q&&ue.push("HAS_CENTROID"),Ce.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");let Be=(Ue,Ye,dt,Fe,be)=>{let Ge=ue;Ye.groundRadiusBuffer!=null&&(Ge=ue.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));let Le=Ye.programConfigurations.get(f.id),tt=o.isTileAffectedByFog(Ue),bt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Le,defines:Ge,overrideFog:tt}),At=lh(o,Fe,L,M,be,[F,N*be],j,U,Z,fe>=17?0:De*be,re?re.size[0]:0),_t=[];q&&_t.push(Ye.hiddenByLandmarkVertexBuffer),Ye.groundRadiusBuffer!=null&&_t.push(Ye.groundRadiusBuffer),o.uploadCommonUniforms(ne,bt,Ue.toUnwrapped(),null,Ce),bt.draw(o,ne.gl.TRIANGLES,y,x,w,S,At,f.id,Ye.vertexBuffer,Ye.indexBuffer,dt,f.paint,fe,Le,_t)};for(let Ue of _){let Ye=c.getTile(Ue),dt=Ye.getBucket(f);if(!dt||dt.projection.name!==de.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;let Fe=dt.groundEffect,be=1/dt.tileToMeter;{let Ge=o.translatePosMatrix(Ue.projMatrix,Ye,ae,_e),Le=Fe.getDefaultSegment();Be(Ue,Fe,Le,Ge,be)}if(ee)for(let Ge=0;Ge<4;Ge++){let Le=r.e9[Ge](Ue),tt=c.getTile(Le);if(!tt)continue;let bt=tt.getBucket(f);if(!bt||bt.projection.name!==de.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;let At=bt.groundEffect,_t,pt;Ge===0?(_t=[-r.al,0,0],pt=1):Ge===1?(_t=[r.al,0,0],pt=0):Ge===2?(_t=[0,-r.al,0],pt=3):(_t=[0,r.al,0],pt=2);let jt=At.regionSegments[pt];if(!jt)continue;let zt=new Float32Array(16);r.br(zt,Ue.projMatrix,_t),Be(Ue,At,jt,o.translatePosMatrix(zt,Ye,ae,_e),be)}}}function cI(p,o,c,f,_,y,x){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let w=y?y.findDEMTileFor(c):null;if(!(w&&w.dem||x))return;y&&w&&w.dem&&f.selfDEMTileTimestamp!==w.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=w.dem._timestamp);let S=q=>new r.P(Math.ceil((q+r.ed)*r.ee),0),M=q=>{let ee=o.getSource().minzoom,re=ge=>{let de=o.getTileByID(ge);if(de&&de.hasData())return de.getBucket(_)},ne=[0,-1,1];for(let ge of ne){if(q.overscaledZ+ge<ee)continue;let de=re(q.calculateScaledKey(q.overscaledZ+ge));if(de)return de}},A=[0,0,0],L=(q,ee)=>(A[0]=Math.min(q.min.y,ee.min.y),A[1]=Math.max(q.max.y,ee.max.y),A[2]=r.al-ee.min.x>q.max.x?ee.min.x-r.al:q.max.x,A),F=(q,ee)=>(A[0]=Math.min(q.min.x,ee.min.x),A[1]=Math.max(q.max.x,ee.max.x),A[2]=r.al-ee.min.y>q.max.y?ee.min.y-r.al:q.max.y,A),N=[(q,ee)=>L(q,ee),(q,ee)=>L(ee,q),(q,ee)=>F(q,ee),(q,ee)=>F(ee,q)],j=(q,ee,re,ne,ge,de,fe)=>{if(!y)return 0;let ue=[[de?re:q,de?q:re,0],[de?re:ee,de?ee:re,0]],ae=fe<0?r.al+fe:fe,_e=[de?ae:(q+ee)/2,de?(q+ee)/2:ae,0];return re===0&&fe<0||re!==0&&fe>0?y.getForTilePoints(ge,[_e],!0,ne):ue.push(_e),y.getForTilePoints(c,ue,!0,w),Math.max(ue[0][2],ue[1][2],_e[2])/y.exaggeration()};for(let q=0;q<4;q++){let ee=f.borderFeatureIndices[q];if(ee.length===0)continue;let re=r.e9[q](c),ne=M(re);if(!(ne&&ne instanceof r.ea))continue;let ge=y?y.findDEMTileFor(re):null;if(!(ge&&ge.dem||x)||(y&&ge&&ge.dem&&f.borderDEMTileTimestamp[q]!==ge.dem._timestamp&&(f.borderDoneWithNeighborZ[q]=-1,f.borderDEMTileTimestamp[q]=ge.dem._timestamp),f.borderDoneWithNeighborZ[q]===ne.canonical.z))continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();let de=(q<2?1:5)-q,fe=ne.borderDoneWithNeighborZ[de]!==f.canonical.z,ue=ne.borderFeatureIndices[de],ae=0;if(f.canonical.z!==ne.canonical.z){for(let _e of ee)f.showCentroid(f.featuresOnBorder[_e]);if(fe)for(let _e of ue)ne.showCentroid(ne.featuresOnBorder[_e]);f.borderDoneWithNeighborZ[q]=ne.canonical.z,ne.borderDoneWithNeighborZ[de]=f.canonical.z}for(let _e of ee){let De=f.featuresOnBorder[_e],Ce=f.centroidData[De.centroidDataIndex],Be=De.borders[q],Ue;for(;ae<ue.length;){Ue=ne.featuresOnBorder[ue[ae]];let Ye=Ue.borders[de];if(Ye[1]>Be[0]+3||Ye[0]>Be[0]-3)break;ne.showCentroid(Ue),ae++}if(Ue&&ae<ue.length){let Ye=ae,dt=0;for(;!(Ue.borders[de][0]>Be[1]-3)&&(dt++,++ae!==ue.length);)Ue=ne.featuresOnBorder[ue[ae]];Ue=ne.featuresOnBorder[ue[Ye]];let Fe=!1;if(dt>=1){let Le=Ue.borders[de];Math.abs(Be[0]-Le[0])<3&&Math.abs(Be[1]-Le[1])<3&&(dt=1,Fe=!0,ae=Ye+1)}else if(dt===0){f.showCentroid(De);continue}let be=ne.centroidData[Ue.centroidDataIndex];x&&Fe&&(((U=Ce).flags|(Z=be).flags)&r.ec?(U.flags|=r.ec,Z.flags|=r.ec):(U.flags&=~r.ec,Z.flags&=~r.ec));let Ge=De.intersectsCount()>1||Ue.intersectsCount()>1;if(dt>1)ae=Ye,Ce.centroidXY=be.centroidXY=new r.P(0,0);else if(ge&&ge.dem&&!Ge){let Le=N[q](Ce,be),tt=q%2?r.al-1:0,bt=j(Le[0],Math.min(r.al-1,Le[1]),tt,ge,re,q<2,Le[2]);Ce.centroidXY=be.centroidXY=S(bt)}else Ge?Ce.centroidXY=be.centroidXY=new r.P(0,0):(Ce.centroidXY=f.encodeBorderCentroid(De),be.centroidXY=ne.encodeBorderCentroid(Ue));f.writeCentroidToBuffer(Ce),ne.writeCentroidToBuffer(be)}else f.showCentroid(De)}f.borderDoneWithNeighborZ[q]=ne.canonical.z,ne.borderDoneWithNeighborZ[de]=f.canonical.z}var U,Z;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}let Vs=[1,0,0],pv=[0,1,0],ms=[0,0,1];function oc(p,o,c){let f=c.transform,_=c.shadowRenderer;if(!_)return!0;let y=p.toUnwrapped(),x=f.tileSize*_._cascades[c.currentShadowCascade].scale,w=o;if(f.elevation){let U=f.elevation.getMinMaxForTile(p);U&&(w+=U.max)}let S=[..._.shadowDirection];S[2]=-S[2];let M=_.computeSimplifiedTileShadowVolume(y,w,x,S);if(!M)return!1;let A=[Vs,pv,ms,S,[S[0],0,S[2]],[0,S[1],S[2]]],L=f.projection.name==="globe",F=f.scaleZoom(x),N=r.cB.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!L),j=_.getCurrentCascadeFrustum();return N.intersectsPrecise(M.vertices,M.planes,A)===0||j.intersectsPrecise(M.vertices,M.planes,A)===0}function Bp(p){let{painter:o,source:c,layer:f,coords:_}=p,y=p.defines,x=o.context,w=o.renderPass==="shadow",S=o.renderPass==="light-beam",M=o.shadowRenderer,A=r.ef(o.transform.center.lat,o.transform.zoom),L=Yc(o,f.paint.get("building-cutoff-fade-range"));L.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(let F of _){let N=c.getTile(F),j=N.getBucket(f);if(!j)continue;M&&M.getMaxCascadeForTile(F.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));let U=j.programConfigurations.get(f.id),Z,q,ee,re=o.translatePosMatrix(F.expandedProjMatrix,N,[0,0],"map");if(re=r.cS(r.bC(),re,[1,1,p.verticalScale]),w&&M){if(oc(N.tileID,j.maxHeight*A,o))continue;let ge=M.calculateShadowPassMatrixFromTile(N.tileID.toUnwrapped());ge=r.cS(r.bC(),ge,[1,1,p.verticalScale]),ee=nu(ge),Z=q=o.getOrCreateProgram("buildingDepth",{config:U,defines:y,overrideFog:!1})}else if(S)Z=q=o.getOrCreateProgram("buildingBloom",{config:U,defines:y,overrideFog:!1}),ee=r1(re);else{let ge=o.transform.calculatePosMatrix(F.toUnwrapped(),o.transform.worldSize);r.cS(ge,ge,[1,1,p.verticalScale]);let de=r.bC();r.cS(de,ge,[1,-1,1/A]),r.bl(de,de),r.eg(de,de);let fe=o.transform.getFreeCameraOptions().position,ue=1<<F.canonical.z;if(ee=Gm(re,de,p.opacity,p.facadeAOIntensity,[((fe.x-F.wrap)*ue-F.canonical.x)*r.al,(fe.y*ue-F.canonical.y)*r.al,fe.z*ue*r.al],j.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),q=o.getOrCreateProgram("building",{config:U,defines:y,overrideFog:!1}),p.depthOnly===!0)Z=q;else{let ae=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);Z=o.getOrCreateProgram("building",{config:U,defines:ae,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(ge,q,!0),Z!==q&&M.setupShadowsFromMatrix(ge,Z,!0))}let ne=(ge,de)=>{if(S){let fe=ge.entranceBloom;de.draw(o,x.gl.TRIANGLES,p.depthMode,cn.disabled,p.blendMode,ln.disabled,ee,f.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segmentsBucket,f.paint,o.transform.zoom,U,[fe.layoutAttenuationBuffer,fe.layoutColorBuffer])}else{let fe=ge.segmentsBucket,ue=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(ue=ue.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),de.draw(o,x.gl.TRIANGLES,p.depthMode,cn.disabled,p.blendMode,w?ln.disabled:ln.backCW,ee,f.id,ge.layoutVertexBuffer,ge.indexBuffer,fe,f.paint,o.transform.zoom,U,ue)}};o.uploadCommonUniforms(x,q,F.toUnwrapped(),null,L),j.buildingWithoutFacade&&ne(j.buildingWithoutFacade,q),j.buildingWithFacade&&(Z!==q&&o.uploadCommonUniforms(x,Z,F.toUnwrapped(),null,L),ne(j.buildingWithFacade,Z))}}function Jm(p,o,c,f,_,y,x,w,S,M,A,L,F){let N=p.context.gl,j=p.depthModeForSublayer(1,Gt.ReadOnly,N.LEQUAL,!0),U=.1*(1-(Z=A))+3*Z;var Z;let q=p._showOverdrawInspector,ee=L,re=new hv;q||rc(re,p,o,c,f,j,new cn({func:N.ALWAYS,mask:255},255,255,N.KEEP,N.KEEP,N.REPLACE),new xn([N.ONE,N.ONE,N.ONE,N.ONE],r.ao.transparent,[!1,!1,!1,!0],N.MIN),ln.disabled,_,"sdf",y,x,w,S,M,U,ee,!1);{let ne=q?cn.disabled:new cn({func:N.EQUAL,mask:255},255,255,N.KEEP,N.DECR,N.DECR),ge=q?p.colorModeForRenderPass():new xn([N.ONE_MINUS_DST_ALPHA,N.DST_ALPHA,N.ONE,N.ONE],r.ao.transparent,[!0,!0,!0,!0]);rc(re,p,o,c,f,j,ne,ge,ln.disabled,_,"color",y,x,w,S,M,U,ee,!1)}}function eg(p){return[p[0]*r.eh,p[1]*r.eh,p[2]*r.eh,0]}function Vp(p,o,c,f,_,y,x,w,S){let M=f.getSource(),A=c.globeSharedBuffers;if(!A)return;let L,F,N;if(o&&(L=f.getTile(o)),M instanceof r.aU?(F=M.texture,N=r.dK(0,0,c.transform)):L&&o&&(F=L.texture,N=r.dK(o.canonical.z,o.canonical.x,c.transform)),!F||!N)return;p||(N=r.cS(r.bC(),N,[1,-1,1]));let j=c.context,U=j.gl,Z=_.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,q=c.colorModeForDrapableLayerRenderPass(y),ee=x.defines;ee.push("GLOBE_POLES");let re=new Gt(U.LEQUAL,Gt.ReadWrite,c.depthRangeFor3D),ne=Float32Array.from(c.transform.expandedFarZProjMatrix),ge=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),F.bind(Z,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),F.bind(Z,U.CLAMP_TO_EDGE),"useMipmap"in F&&j.extTextureFilterAnisotropic&&c.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);let[de,fe,ue,ae]=o?A.getPoleBuffers(o.canonical.z,!1):A.getPoleBuffers(0,!0),_e=_.paint.get("raster-elevation"),De;p?(De=de,c.renderDefaultNorthPole=_e!==0):(De=fe,c.renderDefaultSouthPole=_e!==0);let Ce=eg(x.mix),Be=((Ye,dt,Fe,be,Ge,Le,tt,bt,At,_t,pt,jt,zt)=>a1(Ye,dt,Fe,new Float32Array(16),new Float32Array(9),[0,0],be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Le,[0,0],bt,2,_t,pt,jt,1,0,zt))(ne,ge,N,r.aj(c.transform.zoom),0,_,0,_e,0,Ce,x.offset,x.range,y),Ue=c.getOrCreateProgram("raster",{defines:ee});c.uploadCommonUniforms(j,Ue,null),Ue.draw(c,U.TRIANGLES,re,S,q,w,Be,_.id,De,ue,ae)}function f1(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}function sc(p,o,c,f){if(p)return o instanceof ss&&p instanceof pm?o.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:eg(f.mix),offset:f.offset,buffer:0,tileSize:1}}var Ui=r.ei([{name:"a_index",type:"Int16",components:1}]);class tg{constructor(o,c,f,_){let y={width:f[0],height:f[1],data:null},x=o.gl;this.targetColorTexture=new r.T(o,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(o,y,x.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(c,_),this.lastInvalidatedAt=0}updateParticleTexture(o,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,_=c.width*c.height;this.particleTexture0=new r.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1});let y=new r.ej;y.reserve(_);for(let x=0;x<_;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Ui.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fv(p,o,c){if(!p)return null;let f=o.getTextureDescriptor(p,c,!0);if(!f)return null;let{texture:_,mix:y,offset:x,tileSize:w,buffer:S,format:M}=f;if(!_||!M)return null;let A=!1;return M==="uint32"&&(A=!0,y[3]=0,y=qm(r.ek,y,[0,c.paint.get("raster-particle-max-speed")]),x=Wm(r.ek,x,[0,c.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[S/(w+2*S),w/(w+2*S)],tileSize:w,scalarData:A,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function m1(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-o,_=.2*p.height,y=o+_;return[o,c,(y-_-o)/f,(y-o)/f]}let g1=new r.ao(1,0,0,1),_1=new r.ao(0,1,0,1),v1=new r.ao(0,0,1,1),dd=new r.ao(1,0,1,1),hd=new r.ao(0,1,1,1);function gt(p,o,c,f,_,y){for(let x=0;x<c.length;x++)if(_){let M=new r.ao(f.r*.8,f.g*.8,f.b*.8,1);Ct(p,o,c[x],f,-1,-1,y),Ct(p,o,c[x],f,-1,1,y),Ct(p,o,c[x],f,1,1,y),Ct(p,o,c[x],f,1,-1,y),Ct(p,o,c[x],M,0,0,y)}else Ct(p,o,c[x],f,0,0,y)}function Ct(p,o,c,f,_,y,x){let w=p.context,S=p.transform,M=w.gl,A=S.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],F=r.bz(c.projMatrix);if(A&&r.aj(S.zoom)>0){let Ce=r.bj(c.canonical,S),Be=r.el(Ce);F=r.aB(new Float32Array(16),S.globeMatrix,Be),r.aB(F,S.projMatrix,F)}let N=r.bC();N[12]+=2*_/(r.o.devicePixelRatio*S.width),N[13]+=2*y/(r.o.devicePixelRatio*S.height),r.aB(F,N,F);let j=p.getOrCreateProgram("debug",{defines:L}),U=o.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(U,j);let Z=Gt.disabled,q=cn.disabled,ee=p.colorModeForRenderPass(),re="$debug";w.activeTexture.set(M.TEXTURE0),p.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),A?U._makeGlobeTileDebugBuffers(p.context,S):U._makeDebugTileBoundsBuffers(p.context,S.projection);let ne=U._tileDebugBuffer||p.debugBuffer,ge=U._tileDebugIndexBuffer||p.debugIndexBuffer,de=U._tileDebugSegments||p.debugSegments;if(j.draw(p,M.LINE_STRIP,Z,q,ee,ln.disabled,kp(F,f.toPremultipliedRenderColor(null)),re,ne,ge,de,null,null,null,[U._globeTileDebugBorderBuffer]),x){let Ce=U.latestRawTileData,Be=Math.floor((Ce&&Ce.byteLength||0)/1024),Ue=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ue+=` => ${c.overscaledZ}`),Ue+=` ${U.state}`,Ue+=` ${Be}kb`,(function(Ye,dt){Ye.initDebugOverlayCanvas();let Fe=Ye.debugOverlayCanvas,be=Ye.context.gl,Ge=Ye.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Fe.width,Fe.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(dt,5,5),Ge.strokeText(dt,5,5),Ye.debugOverlayTexture.update(Fe),Ye.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)})(p,Ue)}let fe=o.getTile(c).tileSize,ue=512/Math.min(fe,512)*(c.overscaledZ/S.zoom)*.5,ae=U._tileDebugTextBuffer||p.debugBuffer,_e=U._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,De=U._tileDebugTextSegments||p.debugSegments;j.draw(p,M.TRIANGLES,Z,q,xn.alphaBlended,ln.disabled,kp(F,r.ao.transparent.toPremultipliedRenderColor(null),ue),re,ae,_e,De,null,null,null,[U._globeTileDebugTextBuffer])}function pd(p,o,c,f){Oe(p,0,o+c/2,p.transform.width,c,f)}function gr(p,o,c,f){Oe(p,o-c/2,0,c,p.transform.height,f)}function Oe(p,o,c,f,_,y){let x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(o*r.o.devicePixelRatio,c*r.o.devicePixelRatio,f*r.o.devicePixelRatio,_*r.o.devicePixelRatio),x.clear({color:y}),w.disable(w.SCISSOR_TEST)}let y1=r.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ng}=y1;function Cl(p,o,c,f){p.emplaceBack(o,c,f)}class ig{constructor(o){this.vertexArray=new r.em,this.indices=new r.b0,Cl(this.vertexArray,-1,-1,1),Cl(this.vertexArray,1,-1,1),Cl(this.vertexArray,-1,1,1),Cl(this.vertexArray,1,1,1),Cl(this.vertexArray,-1,-1,-1),Cl(this.vertexArray,1,-1,-1),Cl(this.vertexArray,-1,1,-1),Cl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,ng),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function fd(p,o,c,f,_,y){let x=p.context.gl,w=o.paint.get("sky-atmosphere-color"),S=o.paint.get("sky-atmosphere-halo-color"),M=o.paint.get("sky-atmosphere-sun-intensity"),A=((L,F,N,j,U)=>({u_matrix_3f:L,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(r.eo(r.dO(),f),_,M,w.toPremultipliedRenderColor(null),S.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,o.skyboxTexture,0),c.draw(p,x.TRIANGLES,Gt.disabled,cn.disabled,xn.unblended,ln.frontCW,A,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let x1=r.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dh{constructor(o){let c=new r.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let f=new r.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,x1.members),this.indexBuffer=o.createIndexBuffer(f),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let uI=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class dI{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class b1{constructor(o){this.colorModeAlphaBlendedWriteRGB=new xn([1,yl,1,yl],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new xn([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new dI,this.updateNeeded=!0}update(o){let c=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dh(c);let f=this.params.sizeRange,_=this.params.intensityRange,y=(function(A){let L=r.eq(30),F=[];for(let N=0;N<A;++N){let j=2*Math.PI*L(),U=Math.acos(1-2*L())-.5*Math.PI;F.push(r.d5(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return F})(this.params.starsCount),x=r.eq(300),w=new r.er,S=new r.b0,M=0;for(let A=0;A<y.length;++A){let L=r.c5([],y[A],200),F=Math.max(0,1+.01*f*(1*x()-.5)),N=Math.max(0,1+.01*_*(1*x()-.5));w.emplaceBack(L[0],L[1],L[2],-1,-1,F,N),w.emplaceBack(L[0],L[1],L[2],1,-1,F,N),w.emplaceBack(L[0],L[1],L[2],1,1,F,N),w.emplaceBack(L[0],L[1],L[2],-1,1,F,N),S.emplaceBack(M+0,M+1,M+2),S.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(w,uI.members),this.starsIdx=c.createIndexBuffer(S),this.starsSegments=r.bg.simpleSegment(0,0,w.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,c){let f=o.context,_=f.gl,y=o.transform,x=new Gt(_.LEQUAL,Gt.ReadOnly,[0,1]),w=r.aj(y.zoom),S=o.style.getLut(c.scope),M=c.properties.get("color-use-theme")==="none",A=c.properties.get("color").toNonPremultipliedRenderColor(M?null:S),L=c.properties.get("high-color-use-theme")==="none",F=c.properties.get("high-color").toNonPremultipliedRenderColor(L?null:S),N=c.properties.get("space-color-use-theme")==="none",j=c.properties.get("space-color").toNonPremultipliedRenderColor(N?null:S),U=5e-4,Z=r.es(c.properties.get("horizon-blend"),0,1,U,.25),q=r.dE(o,f,y)&&Z===U?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ee=o.frameCounter/1e3%1,re=r.ag(y.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(re,2)-Math.pow(q,2)),ge=Math.acos(ne/re),de=fe=>{let ue=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&ue.push("ALPHA_PASS");let ae=o.getOrCreateProgram("globeAtmosphere",{defines:ue}),_e=((Ce,Be,Ue,Ye,dt,Fe,be,Ge,Le,tt,bt,At)=>({u_frustum_tl:Ce,u_frustum_tr:Be,u_frustum_br:Ue,u_frustum_bl:Ye,u_horizon:dt,u_transition:Fe,u_fadeout_range:be,u_atmosphere_fog_color:Ge.toArray01(),u_high_color:Le.toArray01(),u_space_color:tt.toArray01(),u_temporal_offset:bt,u_horizon_angle:At}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,w,Z,A,F,j,ee,ge);o.uploadCommonUniforms(f,ae);let De=this.atmosphereBuffer;De&&ae.draw(o,_.TRIANGLES,x,cn.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ln.backCW,_e,fe?"atmosphere_glow_alpha":"atmosphere_glow",De.vertexBuffer,De.indexBuffer,De.segments)};de(!1),de(!0)}drawStars(o,c){let f=r.aA(c.properties.get("star-intensity"),0,1);if(f===0)return;let _=o.context,y=_.gl,x=o.transform,w=o.getOrCreateProgram("stars"),S=r.c7([]);r.c9(S,S,-x._pitch),r.c8(S,S,-x.angle),r.c9(S,S,r.an(x._center.lat)),r.et(S,S,-r.an(x._center.lng));let M=r.cc(new Float32Array(16),S),A=r.aB([],x.starsProjMatrix,M),L=r.eo([],M),F=r.eu([],L),N=[0,1,0];r.dQ(N,N,F),r.c5(N,N,this.params.sizeMultiplier);let j=[1,0,0];r.dQ(j,j,F),r.c5(j,j,this.params.sizeMultiplier);let U=(Z=N,q=j,ee=f,{u_matrix:Float32Array.from(A),u_up:Z,u_right:q,u_intensity_multiplier:ee});var Z,q,ee;o.uploadCommonUniforms(_,w),this.starsVx&&this.starsIdx&&w.draw(o,y.TRIANGLES,Gt.disabled,cn.disabled,this.colorModeAlphaBlendedWriteRGB,ln.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class rg{constructor(){this.visibleTiles=[]}updateBorders(o,c){let f=[],_=[],y=o._getRenderableCoordinates(!1,!0);for(let S of y){let M=o.getTile(S);if(!M.hasData())continue;let A=M.getBucket(c);A&&(A.isEmpty()||(f.push(S.key),_.push({bucket:A,tileID:S.canonical})))}let x=f.length!==this.visibleTiles.length;if(!x){f.sort();for(let S=0;S<f.length;S++)if(f[S]!==this.visibleTiles[S]){x=!0;break}}if(!x)return;let w=new Set;this.visibleTiles=f,_.sort((S,M)=>S.tileID.z-M.tileID.z||S.tileID.x-M.tileID.x||S.tileID.y-M.tileID.y);for(let S of _){let M=new Array,A=new Array,L=S.bucket;for(let F of L.featuresOnBorder)w.has(F.featureId)?A.push(F.footprintIndex):(w.add(F.featureId),M.push(F.footprintIndex));L.updateFootprintHiddenFlags(M,r.ev,!1),L.updateFootprintHiddenFlags(A,r.ev,!0)}}}function og(p,o){let c=[...p],f=o.cameraWorldSizeForFog/o.worldSize,_=r.bA([]);return r.cS(_,_,[f,f,1]),r.aB(c,_,c),r.aB(c,o.worldToFogMatrix,c),c}function sg(p,o,c,f,_){let y=c.material,x=f.context,{baseColorTexture:w,metallicRoughnessTexture:S}=y.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:A,emissionTexture:L}=y;function F(j,U,Z){if(j&&(p.push(U),x.activeTexture.set(x.gl.TEXTURE0+Z),j.gfxTexture)){let{minFilter:q,magFilter:ee,wrapS:re,wrapT:ne}=j.sampler;j.gfxTexture.bindExtraParam(q,ee,re,ne)}}F(w,"HAS_TEXTURE_u_baseColorTexture",Co.BaseColor),F(S,"HAS_TEXTURE_u_metallicRoughnessTexture",Co.MetallicRoughness),F(M,"HAS_TEXTURE_u_normalTexture",Co.Normal),F(A,"HAS_TEXTURE_u_occlusionTexture",Co.Occlusion),F(L,"HAS_TEXTURE_u_emissionTexture",Co.Emission),_&&(_.texture||(_.texture=new r.d$(f.context,_.image,[_.image.height,_.image.height,_.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Co.LUT),_.texture&&_.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(c.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||p.push("DIFFUSE_SHADED");let N=f.shadowRenderer;N&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&p.push("NORMAL_OFFSET"))}function ag(p,o,c,f,_,y){let x=p.modelOpacity,w=o.context,S=new Gt(o.context.gl.LEQUAL,p.isLightMesh?Gt.ReadOnly:Gt.ReadWrite,o.depthRangeFor3D),M=o.transform,A=p.mesh,L=A.material,F=L.pbrMetallicRoughness,N=o.style.fog,j;j=o.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.aB([],f.zScaleMatrix,p.nodeModelMatrix),r.aB(j,f.negCameraPosMatrix,j);let U=r.bl([],j);r.eg(U,U);let Z=c.paint.get("model-color-use-theme").constantOr("default")==="none",q=c.paint.get("model-emissive-strength").constantOr(0),ee=cd(new Float32Array(p.worldViewProjection),new Float32Array(j),new Float32Array(U),null,o,x,F.baseColorFactor,L.emissiveFactor,F.metallicFactor,F.roughnessFactor,L,q,c,void 0,void 0,p.materialOverride,p.modelColor),re={defines:[]},ne=[],ge=o.shadowRenderer;ge&&(ge.useNormalOffset=!1),sg(re.defines,ne,A,o,Z?null:c.lut);let de=null;if(N){let ae=og(p.nodeModelMatrix,o.transform);if(de=new Float32Array(ae),M.projection.name!=="globe"){let _e=A.aabb.min,De=A.aabb.max,[Ce,Be]=N.getOpacityForBounds(ae,_e[0],_e[1],De[0],De[1]);re.overrideFog=Ce>=Xe||Be>=Xe}}let fe=Yc(o,c.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ue=o.getOrCreateProgram("model",re);o.uploadCommonUniforms(w,ue,null,de,fe),o.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(p.nodeModelMatrix,ue),ue.draw(o,w.gl.TRIANGLES,S,_,y,A.material.doubleSided?ln.disabled:ln.backCCW,ee,c.id,A.vertexBuffer,A.indexBuffer,A.segments,c.paint,o.transform.zoom,void 0,ne)}function Up(p,o){return p.style._importedAsBasemap?"basemap":o.scope}function md(p,o,c,f,_,y,x,w,S,M){let A=p.transform,L=!!o.isGeometryBloom&&o.isGeometryBloom;if(L&&p.renderPass==="shadow")return;let F=A.projection.name==="globe"?r.eD(c,A):[...c];r.aB(F,F,o.globalMatrix);let N=r.aB([],f,F);if(o.meshes)for(let j of o.meshes){let U=w.get(j.material.name);if(U&&U.opacity<=0)continue;if(j.material.alphaMode!=="BLEND"){x.push({mesh:j,depth:0,modelIndex:_,worldViewProjection:N,nodeModelMatrix:F,isLightMesh:L,materialOverride:U,modelOpacity:S,modelColor:M});continue}let Z=r.af([],j.centroid,N);!A.isOrthographic&&Z[2]<=0||y.push({mesh:j,depth:Z[2],modelIndex:_,worldViewProjection:N,nodeModelMatrix:F,isLightMesh:L,materialOverride:U,modelOpacity:S,modelColor:M})}if(o.children)for(let j of o.children)md(p,j,c,f,_,y,x,w,S,M)}function Xa(p,o,c,f){let _=c.shadowRenderer;if(!_)return;let y=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode(),w=_.calculateShadowPassMatrixFromMatrix(o),S=cv(w);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,y,cn.disabled,x,ln.disabled,S,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,c.transform.zoom,void 0,void 0)}function w1(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={orientation:p.paint.get("model-rotation").evaluate(S,c)};y.set(x,M)}}function C1(p,o,c,f,_,y){for(let x of _){let w=Object.assign({},f);w.part=x;let S={type:"Unknown",id:o,properties:w},M={color:p.paint.get("model-color").evaluate(S,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(S,c),opacity:p.paint.get("model-opacity").evaluate(S,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(S,c)};y.set(x,M)}}function E1(p,o,c,f,_){let y=!1;for(let w of f)w.modelOpacity!==1&&(ag(w,p,o,_[w.modelIndex],cn.disabled,xn.disabled),y=!0);for(let w of f)ag(w,p,o,_[w.modelIndex],w.modelOpacity!==1?p.stencilModeFor3D():cn.disabled,p.colorModeForRenderPass());y&&p.resetStencilClippingMasks();let x=xn.additive;for(let w of c)ag(w,p,o,_[w.modelIndex],cn.disabled,w.isLightMesh?x:p.colorModeForRenderPass())}function S1(p,o,c){let f=o.updateZoomBasedPaintProperties(),_=(function(y,x,w){let S,M,A,L=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&L>0){let F=y.terrain,N=F.findDEMTileFor(w);N&&N.dem?S=r.eF.create(F,w,N):L=0}if(L===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),L===x.validForExaggeration&&(L===0||S&&S._demTile&&S._demTile.tileID===x.validForDEMTile.id&&S._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let F in x.instancesPerModel){let N=x.instancesPerModel[F];for(let j=0;j<N.instancedDataArray.length;++j){let U=(S?L*S.getElevationAt(0|N.instancedDataArray.float32[16*j],0|N.instancedDataArray.float32[16*j+1],!0,!0):0)+N.instancesEvaluatedElevation[j];N.instancedDataArray.float32[16*j+6]=U,M=M?Math.min(x.terrainElevationMin,U):U,A=A?Math.max(x.terrainElevationMax,U):U}}return x.terrainElevationMin=M||0,x.terrainElevationMax=A||0,x.validForExaggeration=L,x.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,o,c);(f||_)&&(o.uploaded=!1,o.upload(p.context))}let El={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d9([0,0,0],[r.al,r.al,0])};function gs(p,o){let c=1<<p.canonical.z,f=o.getFreeCameraOptions().position,_=o.elevation,y=p.canonical.x/c,x=(p.canonical.x+1)/c,w=p.canonical.y/c,S=(p.canonical.y+1)/c,M=o._centerAltitude;if(_){let N=_.getMinMaxForTile(p);N&&N.max>M&&(M=N.max)}let A=r.aA(f.x,y,x)-f.x,L=r.aA(f.y,w,S)-f.y,F=r.cf(M,o.center.lat)-f.z;return o._zoomFromMercatorZ(Math.sqrt(A*A+L*L+F*F))}function T1(p,o,c,f,_,y,x){let w=p.context,S=p.renderPass==="shadow",M=p.shadowRenderer,A=S&&M?M.getShadowPassDepthMode():new Gt(w.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),L=p.isTileAffectedByFog(y),F=p.transform.projection.name==="globe";if(c.meshes)for(let N of c.meshes){let j=F?[]:["MODEL_POSITION_ON_GPU"],U=[],Z,q,ee,re=!F&&f.instancedDataArray.length>20;re&&j.push("INSTANCED_ARRAYS");let ne=Yc(p,o.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),S&&M)Z=p.getOrCreateProgram("modelDepth",{defines:j}),q=cv(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(c.globalMatrix)),ee=M.getShadowPassColorMode();else{sg(j,U,N,p,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),Z=p.getOrCreateProgram("model",{defines:j,overrideFog:L});let de=N.material,fe=de.pbrMetallicRoughness,ue=o.paint.get("model-opacity").constantOr(1),ae=o.paint.get("model-emissive-strength").constantOr(0);q=cd(y.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,ue,fe.baseColorFactor,de.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,de,ae,o,_),M&&(x.shadowUniformsInitialized?Z.setShadowUniformValues(w,M.getShadowUniformValues()):(M.setupShadows(y.toUnwrapped(),Z,"model-tile"),x.shadowUniformsInitialized=!0)),ee=ne.shouldRenderCutoff||ue<1||de.alphaMode!=="OPAQUE"?xn.alphaBlended:xn.unblended}p.uploadCommonUniforms(w,Z,y.toUnwrapped(),null,ne);let ge=N.material.doubleSided?ln.disabled:ln.backCCW;if(re)U.push(f.instancedDataBuffer),Z.draw(p,w.gl.TRIANGLES,A,cn.disabled,ee,ge,q,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,p.transform.zoom,void 0,U,f.instancedDataArray.length);else{let de=S?"u_instance":"u_normal_matrix";for(let fe=0;fe<f.instancedDataArray.length;++fe)q[de]=new Float32Array(f.instancedDataArray.arrayBuffer,64*fe,16),Z.draw(p,w.gl.TRIANGLES,A,cn.disabled,ee,ge,q,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,p.transform.zoom,void 0,U)}}if(c.children)for(let N of c.children)T1(p,o,N,f,_,y,x)}let jp=[1,-1,1];function hI(p,o,c,f){if(!c.modelManager)return!0;let _=c.modelManager;if(!c.shadowRenderer)return!0;let y=c.shadowRenderer,x=o.aabb,w=!0,S=p.maxHeight;if(S===0){let A=0;for(let L in p.instancesPerModel){let F=_.getModel(L,f);F?A=Math.max(A,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):w=!1}S=p.maxScale*A*1.41+p.maxVerticalOffset,w&&(p.maxHeight=S)}x.max[2]=S,x.min[2]+=p.terrainElevationMin,x.max[2]+=p.terrainElevationMax,r.af(x.min,x.min,o.tileMatrix),r.af(x.max,x.max,o.tileMatrix);let M=x.intersects(y.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=M===2),M===0}function Xi(p,o){let c=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],_=p.uniformValues.u_cutoff_params[2],y=p.uniformValues.u_cutoff_params[3];return f===c||y===_?1:r.aA(((o-c)/(f-c)-_)/(y-_),0,1)}function Pn(p,o,c,f){if(o.pitch<20)return 1;let _=o.getWorldToCameraMatrix();r.aB(_,_,p);let y=r.bU(c.min[0],c.min[1],c.min[2],1),x=r.aC(r.eG(),y,_),w=x,S=x;y[1]=c.max[1],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[0]=c.max[0],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S,y[1]=c.min[1],x=r.aC(r.eG(),y,_),w=x[1]<w[1]?x:w,S=x[1]>S[1]?x:S;let M=r.aA(f[0],0,1),A=100*o.pixelsPerMeter*r.aA(f[1],0,1),L=r.aA(f[2],0,1),F=r.eH(r.eG(),w,S,M),N=Math.tan(.5*o.fovX),j=-F[2]*N;if(A===0)return F[1]<-Math.abs(j)?L:1;let U=(-Math.abs(j)-F[1])/A,Z=(ee,re,ne)=>(1-ne)*ee+ne*re,q=r.aA(Z(1,L,U),L,1);return Z(1,q,r.aA((o.pitch-20)/20,0,1))}class I1{}class ou{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,c,f){{let L=this._storage.get(c.id);if(L)return L.lastUsedFrameIdx=o,L.buf}let _=f.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),x=new ArrayBuffer(y),w=new Int16Array(x);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let S=new r.eJ;for(let L=0;L<y/2;L+=3){let F=w[L],N=w[L+1],j=w[L+2];S.emplaceBack(F,N),S.emplaceBack(N,j),S.emplaceBack(j,F)}let M=f.bindVertexArrayOES.current,A=new I1;return A.buf=new Lp(f,S),A.lastUsedFrameIdx=o,this._storage.set(c.id,A),f.bindVertexArrayOES.set(M),A.buf}update(o){for(let[c,f]of this._storage)o-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(c))}destroy(){for(let[o,c]of this._storage)c.buf.destroy(),this._storage.delete(o)}}class hh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}let ph=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ac{constructor(o){this.revealStart=11,this.revealRange=2}}let mv=r.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class gv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,c){let f=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new r.eK,w=new r.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(x,mv.members),this.vignetteIdx=o.context.createIndexBuffer(w)}let _=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,f);let x={u_vignetteShape:(y={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};f.draw(o,o.context.gl.TRIANGLES,Gt.disabled,cn.disabled,xn.alphaBlended,ln.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class _v{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,c){let f=o.getFreeCameraOptions().position,_=f.toAltitude(),y=f.toLngLat(),x=r.an(y.lng),w=r.an(y.lat),S=o.pixelsPerMeter/c,M=x*r.eM,A=r.eM*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let L=-this._offsetYPrev+A,F=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*S,this._accumulatedOffsetY+=L*S,this._accumulatedElevation+=F*S,this._offsetXPrev=M,this._offsetYPrev=A,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function lg(p,o){return[-(p[0]-Math.floor(p[0]/o)*o),-(p[1]-Math.floor(p[1]/o)*o),-(p[2]-Math.floor(p[2]/o)*o)]}function na(p){let o=r.eq(1323123451230),c=[];for(let f=0;f<p;++f){let _=2*o()-1,y=2*o()-1,x=2*o()-1;c.push(r.d5(_,y,x))}return c}function Ds(p,o,c,f,_){let y=r.aA((_-c)/(f-c),0,1);return(1-y)*p+y*o}class gd{constructor(o){this._movement=new _v,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new gv,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,c){let f=o.transform;this._movement.update(f,this._ppmScaleFactor);let _=f.starsProjMatrix,y=r.c7([]);r.c9(y,y,r.an(90)-f._pitch),r.c8(y,y,-f.angle);let x=r.cc(new Float32Array(16),y),w=r.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),S=r.eg([],w),M=r.aB([],S,x),A=Date.now()/1e3;return this._accumulatedTimeFromStart+=(A-this._prevTime)*c,this._prevTime=A,{projectionMatrix:_,modelviewMatrix:M}}}class cg extends gd{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ac("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=na(this.particlesCount),_=new r.eN,y=new r.b0,x=0,w=r.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=[2*w()-1,w(),w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,-1,...A),_.emplaceBack(M[0],M[1],M[2],1,1,...A),_.emplaceBack(M[0],M[1],M[2],-1,1,...A),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,ph.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;let c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=o.transform.zoom;if(c.revealStart>f)return;let _=Ds(0,1,c.revealStart,c.revealStart+c.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;let y=structuredClone(this._params),x=[-y.direction.x,y.direction.y,-100];r.aw(x,x);let w=structuredClone(this._vignetteParams);w.strength*=_,y.overrideStyleParameters||(y.intensity=o.style.rain.state.density,y.timeFactor=o.style.rain.state.intensity,y.color=structuredClone(o.style.rain.state.color),x=structuredClone(o.style.rain.state.direction),y.screenThinning.intensity=o.style.rain.state.centerThinning,y.dropletSizeX=o.style.rain.state.dropletSize[0],y.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],y.distortionStrength=100*o.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(o.style.rain.state.vignetteColor));let S=this.updateOnRender(o,y.timeFactor),M=o.context,A=M.gl,L=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new r.T(M,{width:o.width,height:o.height,data:null},A.RGBA8)),y.distortionStrength>0&&(M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,o.width,o.height));let F=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(M,F),M.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let N=[y.color.r,y.color.g,y.color.b,y.color.a],j=(U,Z)=>{let q=lg(this._movement.getPosition(),U),ee=y.dropletSizeX,re=y.dropletSizeX*y.dropletSizeYScale,ne=o.width/2,ge=o.height/2,de=Ds(0,y.screenThinning.start,0,1,y.screenThinning.intensity),fe=Ds(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),ue=Ds(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),ae=(_e={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:U,rainDropletSize:[ee,re],distortionStrength:y.distortionStrength,rainDirection:x,color:N,screenSize:[L.width,L.height],thinningCenterPos:[ne,ge],thinningShape:[de,fe,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:Z?0:1},{u_modelview:Float32Array.from(_e.modelview),u_projection:Float32Array.from(_e.projection),u_time:_e.time,u_cam_pos:_e.camPos,u_texScreen:0,u_velocityConeAperture:_e.velocityConeAperture,u_velocity:_e.velocity,u_boxSize:_e.boxSize,u_rainDropletSize:_e.rainDropletSize,u_distortionStrength:_e.distortionStrength,u_rainDirection:_e.rainDirection,u_color:_e.color,u_screenSize:_e.screenSize,u_thinningCenterPos:_e.thinningCenterPos,u_thinningShape:_e.thinningShape,u_thinningAffectedRatio:_e.thinningAffectedRatio,u_thinningParticleOffset:_e.thinningParticleOffset,u_shapeDirectionalPower:_e.shapeDirectionalPower,u_shapeNormalPower:_e.shapeNormalPower,u_mode:_e.mode});var _e;let De=Math.round(y.intensity*this.particlesCount),Ce=r.bg.simpleSegment(0,0,4*De,2*De);F.draw(o,A.TRIANGLES,Gt.disabled,cn.disabled,xn.alphaBlended,ln.disabled,ae,"rain_particles",this.particlesVx,this.particlesIdx,Ce)};y.distortionStrength>0&&j(y.boxSize,!0),j(y.boxSize,!1),this._vignette.draw(o,w)}}let vv=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class yv extends gd{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ac("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){let c=o.context;if(!this.particlesVx){let f=na(this.particlesCount),_=new r.eO,y=new r.b0,x=0,w=r.eq(1323123451230);for(let S=0;S<f.length;++S){let M=f[S],A=w(),L=w(),F=w(),N=[S/f.length,A,L,F],j=[w(),w()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...N,...j),_.emplaceBack(M[0],M[1],M[2],1,-1,...N,...j),_.emplaceBack(M[0],M[1],M[2],1,1,...N,...j),_.emplaceBack(M[0],M[1],M[2],-1,1,...N,...j),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,vv.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;let c=structuredClone(this._params),f=[-c.direction.x,c.direction.y,-100];r.aw(f,f);let _=structuredClone(this._vignetteParams),y=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=o.transform.zoom;if(y.revealStart>x)return;let w=Ds(0,1,y.revealStart,y.revealStart+y.revealRange,x);_.strength*=w,c.overrideStyleParameters||(c.intensity=o.style.snow.state.density,c.timeFactor=o.style.snow.state.intensity,c.color=structuredClone(o.style.snow.state.color),f=structuredClone(o.style.snow.state.direction),c.screenThinning.intensity=o.style.snow.state.centerThinning,c.billboardSize=2.79*o.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(o.style.snow.state.vignetteColor));let S=this.updateOnRender(o,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let M=o.context,A=M.gl,L=o.transform,F=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(M,F),((N,j,U)=>{let Z=lg(this._movement.getPosition(),N),q=L.width/2,ee=L.height/2,re=Ds(0,U.screenThinning.start,0,1,U.screenThinning.intensity),ne=Ds(.001,U.screenThinning.range,0,1,U.screenThinning.intensity),ge=Ds(0,U.screenThinning.particleOffset,0,1,U.screenThinning.intensity),de=(fe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:U.velocityConeAperture,velocity:U.velocity,horizontalOscillationRadius:U.horizontalOscillationRadius,horizontalOscillationRate:U.horizontalOscillationRate,boxSize:N,billboardSize:1*U.billboardSize,simpleShapeParameters:[U.shapeFadeStart,U.shapeFadePower],screenSize:[L.width,L.height],thinningCenterPos:[q,ee],thinningShape:[re,ne,Math.pow(10,U.screenThinning.fadePower)],thinningAffectedRatio:U.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[U.color.r,U.color.g,U.color.b,U.color.a],direction:f},{u_modelview:Float32Array.from(fe.modelview),u_projection:Float32Array.from(fe.projection),u_time:fe.time,u_cam_pos:fe.camPos,u_velocityConeAperture:fe.velocityConeAperture,u_velocity:fe.velocity,u_horizontalOscillationRadius:fe.horizontalOscillationRadius,u_horizontalOscillationRate:fe.horizontalOscillationRate,u_boxSize:fe.boxSize,u_billboardSize:fe.billboardSize,u_simpleShapeParameters:fe.simpleShapeParameters,u_screenSize:fe.screenSize,u_thinningCenterPos:fe.thinningCenterPos,u_thinningShape:fe.thinningShape,u_thinningAffectedRatio:fe.thinningAffectedRatio,u_thinningParticleOffset:fe.thinningParticleOffset,u_particleColor:fe.color,u_direction:fe.direction});var fe;let ue=Math.round(U.intensity*this.particlesCount),ae=r.bg.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&F.draw(o,A.TRIANGLES,Gt.disabled,cn.disabled,xn.alphaBlended,ln.disabled,de,"snow_particles",this.particlesVx,this.particlesIdx,ae)})(c.boxSize,0,c),this._vignette.draw(o,_)}}let su={symbol:function(p,o,c,f,_){if(p.renderPass!=="translucent")return;let y=cn.disabled,x=p.colorModeForRenderPass(),w=c.layout.get("text-variable-anchor"),S=c.layout.get("text-size-scale-range"),M=r.aA(p.scaleFactor,S[0],S[1]);w&&(function(F,N,j,U,Z,q,ee,re){let ne=N.transform,ge=Z==="map",de=q==="map";for(let fe of F){let ue=U.getTile(fe),ae=ue.getBucket(j);if(!ae||!ae.text||!ae.text.segments.get().length)continue;let _e=r.bK(ae.textSizeData,ne.zoom,re),De=_l(fe,ae.getProjection(),ne),Ce=ne.calculatePixelsToTileUnitsMatrix(ue),Be=as(De,ue.tileID.canonical,de,ge,ne,ae.getProjection(),Ce),Ue=ae.hasIconTextFit()&&ae.hasIconData();_e&&en(ae,ge,de,ee,ne,Be,fe,Math.pow(2,ne.zoom-ue.tileID.overscaledZ),_e,Ue)}})(f,p,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_,M);let A=c.paint.get("icon-opacity").constantOr(1)!==0,L=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||L)?zp(p,o,c,f,y,x):(A&&zp(p,o,c,f,y,x,{onlyIcons:!0}),L&&zp(p,o,c,f,y,x,{onlyText:!0})),o.map.showCollisionBoxes&&(Lt(p,o,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Lt(p,o,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("circle-opacity"),y=c.paint.get("circle-stroke-width"),x=c.paint.get("circle-stroke-opacity"),w=c.layout.get("circle-sort-key").constantOr(1)!==void 0,S=c.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let M=p.context,A=M.gl,L=p.transform,F=!(!p.terrain||!p.terrain.enabled),N=c.layout.get("circle-elevation-reference"),j=p.depthModeForSublayer(0,Gt.ReadOnly),U=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),Z=N==="none"||F?j:U,q=cn.disabled,ee=p.colorModeForDrapableLayerRenderPass(S),re=L.projection.name==="globe",ne=[r.aF(L.center.lng),r.aJ(L.center.lat)],ge=[];for(let fe=0;fe<f.length;fe++){let ue=f[fe],ae=o.getTile(ue),_e=ae.getBucket(c);if(!_e||_e.projection.name!==L.projection.name)continue;let De=_e.programConfigurations.get(c.id),Ce=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,Ue=_e.indexBuffer,Ye=r.e0(c),dt=[Be],Fe=p.isTileAffectedByFog(ue);re&&Ye.push("PROJECTION_GLOBE_VIEW"),Ye.push("DEPTH_D24"),p.terrain&&L.depthOcclusionForSymbolsAndCircles&&Ye.push("DEPTH_OCCLUSION"),_e.hasElevation&&!p.terrain&&(Ye.push("ELEVATED_ROADS"),dt.push(_e.elevatedLayoutVertexBuffer));let be=p.getOrCreateProgram("circle",{config:De,defines:Ye,overrideFog:Fe}),Ge=L.projection.createInversionMatrix(L,ue.canonical),Le={programConfiguration:De,program:be,layoutVertexBuffer:Ce,dynamicBuffers:dt,indexBuffer:Ue,uniformValues:r.e1(p,ue,ae,Ge,ne,c),tile:ae};if(w){let tt=_e.segments.get();for(let bt of tt)ge.push({segments:new r.bg([bt]),sortKey:bt.sortKey,state:Le})}else ge.push({segments:_e.segments,sortKey:0,state:Le})}w&&ge.sort((fe,ue)=>fe.sortKey-ue.sortKey);let de={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(let fe of ge){let{programConfiguration:ue,program:ae,layoutVertexBuffer:_e,dynamicBuffers:De,indexBuffer:Ce,uniformValues:Be,tile:Ue}=fe.state,Ye=fe.segments;p.terrain&&p.terrain.setupElevationDraw(Ue,ae,de),p.uploadCommonUniforms(M,ae,Ue.tileID.toUnwrapped()),ae.draw(p,A.TRIANGLES,Z,q,ee,ln.disabled,Be,c.id,_e,Ce,Ye,c.paint,L.zoom,ue,De)}},heatmap:function(p,o,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let _=p.context,y=_.gl,x=cn.disabled,w=new xn([y.ONE,y.ONE,y.ONE,y.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(N,j,U,Z){let q=N.gl,ee=j.width*Z,re=j.height*Z;N.activeTexture.set(q.TEXTURE1),N.viewport.set([0,0,ee,re]);let ne=U.heatmapFbo;if(!ne||ne&&(ne.width!==ee||ne.height!==re)){ne&&ne.destroy();let ge=q.createTexture();q.bindTexture(q.TEXTURE_2D,ge),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ne=U.heatmapFbo=N.createFramebuffer(ee,re,1,null),(function(de,fe,ue,ae,_e,De){let Ce=de.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,_e,De,0,Ce.RGBA,de.extRenderToTextureHalfFloat?Ce.HALF_FLOAT:Ce.UNSIGNED_BYTE,null),ae.colorAttachment0.set(ue)})(N,0,ge,ne,ee,re)}else q.bindTexture(q.TEXTURE_2D,ne.colorAttachment0.get()),N.bindFramebuffer.set(ne.framebuffer)})(_,p,c,p.transform.projection.name==="globe"?.5:.25),_.clear({color:r.ao.transparent});let S=p.transform,M=S.projection.name==="globe",A=M?["PROJECTION_GLOBE_VIEW"]:[],L=M?ln.frontCCW:ln.disabled,F=[r.aF(S.center.lng),r.aJ(S.center.lat)];for(let N=0;N<f.length;N++){let j=f[N];if(o.hasRenderableParent(j))continue;let U=o.getTile(j),Z=U.getBucket(c);if(!Z||Z.projection.name!==S.projection.name)continue;let q=p.isTileAffectedByFog(j),ee=Z.programConfigurations.get(c.id),re=p.getOrCreateProgram("heatmap",{config:ee,defines:A,overrideFog:q}),{zoom:ne}=p.transform;p.terrain&&p.terrain.setupElevationDraw(U,re),p.uploadCommonUniforms(_,re,j.toUnwrapped());let ge=S.projection.createInversionMatrix(S,j.canonical);re.draw(p,y.TRIANGLES,Gt.disabled,x,w,L,s1(p,j,U,ge,F,ne,c.paint.get("heatmap-intensity")),c.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,c.paint,p.transform.zoom,ee,M?[Z.globeExtVertexBuffer]:null)}_.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(_,y){let x=_.context,w=x.gl,S=y.heatmapFbo;if(!S)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,S.colorAttachment0.get()),x.activeTexture.set(w.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new r.T(x,y.colorRamp,w.RGBA8)),M.bind(w.LINEAR,w.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,w.TRIANGLES,Gt.disabled,cn.disabled,_.colorModeForRenderPass(),ln.disabled,((A,L,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)})(p,c))},line:function(p,o,c,f){if(p.renderPass!=="translucent")return;let _=c.paint.get("line-opacity"),y=c.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;let x=c.paint.get("line-emissive-strength").isConstant(),w=c.paint.get("line-emissive-strength").constantOr(0),S=c.paint.get("line-occlusion-opacity"),M=c.layout.get("line-elevation-reference"),A=c.layout.get("line-width-unit")==="meters",L=M==="sea",F=!(!p.terrain||!p.terrain.enabled),N=p.context,j=N.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;let U=c.layout.get("line-cross-slope"),Z=U!==void 0,q=U<1,ee=p.colorModeForDrapableLayerRenderPass(x?w:null),re=p.terrain&&p.terrain.renderingToTexture,ne=re?1:r.o.devicePixelRatio,ge=c.paint.get("line-dasharray"),de=ge.constantOr(1),fe=c.layout.get("line-cap"),ue=ge.constantOr(null),ae=fe.constantOr(null),_e=c.paint.get("line-pattern"),De=_e.constantOr(1),Ce=c.paint.get("line-pattern-cross-fade"),Be=_e.constantOr(null),Ue=c.paint.get("line-opacity").constantOr(1),Ye=!De&&Ue!==1||p.depthOcclusion&&S>0&&S<1,dt=c.paint.get("line-gradient"),Fe=De?"linePattern":"line",be=r.e2(c),Ge;if(re&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Ye=!1),S!==0&&p.depthOcclusion){let At=c.paint._values["line-opacity"];At&&At.value&&At.value.kind==="constant"?Ge=At.value:r.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&be.push("VARIABLE_LINE_WIDTH"),re&&(p.emissiveMode!=="dual-source-blending"||x?p.emissiveMode==="mrt-fallback"&&be.push("USE_MRT1"):be.push("DUAL_SOURCE_BLENDING"));let Le=(At,_t,pt,jt,zt,Tt)=>{for(let Ot of At){let Jt=o.getTile(Ot);if(De&&!Jt.patternsLoaded())continue;let fn=Jt.getBucket(c);if(!fn||fn.elevationType!=="none"&&!zt||fn.elevationType==="none"&&zt)continue;p.prepareDrawTile();let Fn=[..._t],Jn=p.shadowRenderer,$t=fn.elevationType==="road"&&!!Jn&&Jn.enabled,Yn=[0,0,0];if($t){let Cn=p.style.directionalLight,Gi=p.style.ambientLight;Cn&&Gi&&(Yn=tc(p.style,Cn,Gi)),Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let pn=fn.programConfigurations.get(c.id),ii=!1;if(Be&&Jt.imageAtlas){let Cn=r.e3.from(Be),Gi=Cn.getPrimary().scaleSelf(ne).toString(),Cr=Jt.imageAtlas.patternPositions.get(Gi),ir=Cn.getSecondary(),Ti=ir?Jt.imageAtlas.patternPositions.get(ir.scaleSelf(ne).toString()):null;ii=!!Cr&&!!Ti,Cr&&pn.setConstantPatternPositions(Cr,Ti)}Ce>0&&(ii||pn.getPatternTransitionVertexBuffer("line-pattern"))&&Fn.push("LINE_PATTERN_TRANSITION");let gi=p.isTileAffectedByFog(Ot),di=p.getOrCreateProgram(Fe,{config:pn,defines:Fn,overrideFog:gi});if(!De&&ue&&ae&&Jt.lineAtlas){let Cn=Jt.lineAtlas.getDash(ue,ae);Cn&&pn.setConstantPatternPositions(Cn)}$t&&Jn.setupShadows(Jt.tileID.toUnwrapped(),di,"vector-tile");let[Wn,wn]=c.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&Wn!==wn&&(Wn===0&&(Wn-=1),wn===1&&(wn+=1));let ti=re?Ot.projMatrix:null,ur=A?1/fn.tileToMeter/r.ay(Jt,1,p.transform.zoom):1,Ki=A?1/fn.tileToMeter/r.ay(Jt,1,Math.floor(p.transform.zoom)):1,ri=De?r.e4(p,Jt,c,ti,ne,ur,Ki,[Wn,wn],Yn,Ce):r.e5(p,Jt,c,ti,fn.lineClipsArray.length,ne,ur,Ki,[Wn,wn],Yn);if(dt){let Cn=fn.gradients[c.id],Gi=Cn.texture;if(c.gradientVersion!==Cn.version){let Cr=256;if(c.stepInterpolant){let ir=o.getSource().maxzoom,Ti=Ot.canonical.z===ir?Math.ceil(1<<p.transform.maxZoom-Ot.canonical.z):1;Cr=r.aA(r.e6(fn.maxLineLength/r.al*1024*Ti),256,N.maxTextureSize)}Cn.gradient=r.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Cr,image:Cn.gradient||void 0,clips:fn.lineClipsArray}),Cn.texture?Cn.texture.update(Cn.gradient):Cn.texture=new r.T(N,Cn.gradient,j.RGBA8),Cn.version=c.gradientVersion,Gi=Cn.texture}N.activeTexture.set(j.TEXTURE1),Gi.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}de&&(N.activeTexture.set(j.TEXTURE0),Jt.lineAtlasTexture&&Jt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),pn.updatePaintBuffers()),De&&(N.activeTexture.set(j.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),pn.updatePaintBuffers()),zt&&!L&&p.terrain.setupElevationDraw(Jt,di),p.uploadCommonUniforms(N,di,Ot.toUnwrapped());let $n=Cn=>{Ge!=null&&(Ge.value=Ue*S),di.draw(p,j.TRIANGLES,pt,Cn,ee,ln.disabled,ri,c.id,fn.layoutVertexBuffer,fn.indexBuffer,fn.segments,c.paint,p.transform.zoom,pn,[fn.layoutVertexBuffer2,fn.patternVertexBuffer,fn.zOffsetVertexBuffer]),Ge!=null&&(Ge.value=Ue)};if(Ye&&!zt){let Cn=p.stencilModeForClipping(Ot).ref;Cn===0&&re&&N.clear({stencil:0});let Gi={func:j.EQUAL,mask:255};ri.u_alpha_discard_threshold=.8,$n(new cn(Gi,Cn,255,j.KEEP,j.KEEP,j.INVERT)),ri.u_alpha_discard_threshold=0,$n(new cn(Gi,Cn,255,j.KEEP,j.KEEP,j.KEEP))}else ri.u_alpha_discard_threshold=Ye&&zt&&Tt?.8:0,$n(zt?jt:p.stencilModeForClipping(Ot))}},tt=p.depthModeForSublayer(0,Gt.ReadOnly),bt=new Gt(p.depthOcclusion?j.GREATER:j.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){let At=!re&&p.terrain;S!==0&&At?r.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):At?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Le(f,be,tt,cn.disabled,!1,!0)}if(c.hasElevatedBuckets){M==="hd-road-markup"?F||(tt=bt,be.push("ELEVATED_ROADS")):(be.push("ELEVATED"),tt=bt,Z&&be.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&be.push("ELEVATION_REFERENCE_SEA"));let At=Ye?p.stencilModeFor3D():cn.disabled;p.forceTerrainMode=!0,Le(f,be,tt,At,!0,!0),Ye&&Le(f,be,tt,At,!0,!1),p.forceTerrainMode=!1}Ye&&(p.resetStencilClippingMasks(),re&&N.clear({stencil:0})),S===0||p.depthOcclusion||re||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,o,c,f){let _=c.paint.get("fill-color"),y=c.paint.get("fill-opacity");if(y.constantOr(1)===0)return;let x=c.paint.get("fill-emissive-strength"),w=p.colorModeForDrapableLayerRenderPass(x),S=c.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(r.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent",A="none";c.layout.get("fill-elevation-reference")!=="none"?A="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(A="offset");let L=!(!p.terrain||!p.terrain.enabled),F={painter:p,sourceCache:o,layer:c,coords:f,colorMode:w,elevationType:A,terrainEnabled:L,pass:M};if(p.renderPass==="shadow")return void(p.shadowRenderer&&A==="road"&&!L&&(function(j){let{painter:U,sourceCache:Z,layer:q,coords:ee}=j,re=U.context.gl,ne=j.painter.shadowRenderer;for(let ge of ee){let de=Z.getTile(ge),fe=de.getBucket(q);if(!fe)continue;let ue=fe.elevatedStructures;if(!ue||!ue.shadowCasterSegments||ue.shadowCasterSegments.segments[0].primitiveLength===0)continue;U.prepareDrawTile();let ae=fe.bufferData.programConfigurations.get(q.id),_e=U.isTileAffectedByFog(ge),De=U.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:_e}),Ce=ne.calculateShadowPassMatrixFromTile(de.tileID.toUnwrapped());U.uploadCommonUniforms(U.context,De,ge.toUnwrapped());let Be={u_matrix:Ce,u_depth_bias:0};De.draw(U,re.TRIANGLES,ne.getShadowPassDepthMode(),cn.disabled,ne.getShadowPassColorMode(),ln.disabled,Be,q.id,ue.vertexBuffer,ue.indexBuffer,ue.shadowCasterSegments,q.paint,U.transform.zoom,ae)}})(F));let N=p.emissiveMode==="mrt-fallback";if(A!=="offset"){if(Km(F,!1,N),A==="road"){let j=!L&&p.renderPass==="translucent";j&&Xm(p,o,c,f,"geometry"),Km(F,!0,N,cn.disabled),j&&(function(U){let{painter:Z,sourceCache:q,layer:ee,coords:re,colorMode:ne}=U,ge=Z.context.gl,de=U.painter.shadowRenderer,fe=!!de&&de.enabled,ue=new Gt(Z.context.gl.LEQUAL,Gt.ReadOnly,Z.depthRangeFor3D),ae=[0,0,0];if(fe){let De=Z.style.directionalLight,Ce=Z.style.ambientLight;De&&Ce&&(ae=tc(Z.style,De,Ce))}let _e=De=>{for(let Ce of re){let Be=q.getTile(Ce),Ue=Be.getBucket(ee);if(!Ue)continue;let Ye=Ue.elevatedStructures;if(!Ye)continue;let dt,Fe;if(De?(dt=Ye.renderableBridgeSegments,Fe=Ye.bridgeProgramConfigurations.get(ee.id)):(dt=Ye.renderableTunnelSegments,Fe=Ye.tunnelProgramConfigurations.get(ee.id)),!dt||dt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),Z.prepareDrawTile();let be=Z.isTileAffectedByFog(Ce),Ge=[];fe&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let Le=Z.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:be,defines:Ge}),tt=Z.translatePosMatrix(Ce.projMatrix,Be,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"));fe&&de.setupShadows(Be.tileID.toUnwrapped(),Le,"vector-tile");let bt=tu(tt,ae);Z.uploadCommonUniforms(Z.context,Le,Ce.toUnwrapped()),Le.draw(Z,ge.TRIANGLES,ue,cn.disabled,ne,ln.backCCW,bt,ee.id,Ye.vertexBuffer,Ye.indexBuffer,dt,ee.paint,Z.transform.zoom,Fe,[Ye.vertexBufferNormal])}};_e(!0),_e(!1)})(F)}}else Km(F,!1,N,p.stencilModeFor3D())},"fill-extrusion":function(p,o,c,f){let _=c.paint.get("fill-extrusion-opacity"),y=p.context,x=y.gl,w=p.terrain,S=w&&w.renderingToTexture;if(_===0)return;let M=p.emissiveMode==="mrt-fallback",A=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),L=p.style.order.indexOf(c.fqid);if(A&&(function(F,N,j,U,Z){for(let q of U){let ee=N.getTile(q).getBucket(j);ee&&(ee.updateReplacement(q,F.replacementSource,Z),ee.uploadCentroid(F.context))}})(p,o,c,f,L),w||A)for(let F of f){let N=o.getTile(F).getBucket(c);N&&cI(p.context,o,F,N,c,w,A)}if(p.renderPass==="shadow"&&p.shadowRenderer){let F=p.shadowRenderer;if(w&&_<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;let N=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();Qm(p,o,c,f,N,cn.disabled,j,A)}else if(p.renderPass==="translucent"){let F=!c.paint.get("fill-extrusion-pattern").constantOr(1),N=c.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!S&&N.a!==0){let j=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D);_===1&&F?Qm(p,o,c,f,j,cn.disabled,xn.unblended,A):(Qm(p,o,c,f,j,cn.disabled,xn.disabled,A),Qm(p,o,c,f,j,p.stencilModeFor3D(),p.colorModeForRenderPass(),A),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&F&&(!w&&p.transform.projection.name!=="globe"||S)){let j=c.paint.get("fill-extrusion-opacity"),U=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=c.paint.get("fill-extrusion-flood-light-intensity"),ee=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ee?null:c.lut).toArray01().slice(0,3),ne=U>0&&Z>0,ge=q>0,de=(ae,_e,De)=>(1-De)*ae+De*_e,fe=new hv;fe.translate=c.paint.get("fill-extrusion-translate"),fe.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),fe.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),fe.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");let ue=ae=>{let _e=p.depthModeForSublayer(1,Gt.ReadOnly,x.LEQUAL,!0),De=c.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=de(.1,3,De),Be=p._showOverdrawInspector;if(!Be){let Ue=new cn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ye=new xn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);rc(fe,p,o,c,f,_e,Ue,Ye,ln.disabled,ae,"sdf",j,U,Z,q,re,Ce,A,!1)}{let Ue=Be?cn.disabled:new cn({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ye=Be?p.colorModeForRenderPass():new xn([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.ao.transparent,[!0,!0,!0,!0]);rc(fe,p,o,c,f,_e,Ue,Ye,ln.disabled,ae,"color",j,U,Z,q,re,Ce,A,!1)}};if(S){let ae=()=>{let De=w.drapeBufferSize[0],Ce=w.drapeBufferSize[1],Be=w.framebufferCopyTexture;return Be&&(!Be||Be.size[0]===De&&Be.size[1]===Ce)||(Be&&Be.destroy(),Be=w.framebufferCopyTexture=new r.T(y,new r.q({width:De,height:Ce}),x.RGBA8)),Be.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,De,Ce),Be},_e=(De,Ce,Be)=>{let Ue=p.depthModeForSublayer(1,Gt.ReadOnly,x.LEQUAL,!1),Ye=c.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=de(.1,3,Ye);{let Fe=new xn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0]);rc(fe,p,o,c,f,Ue,cn.disabled,Fe,ln.disabled,De,"clear",j,U,Z,q,re,dt,A,Ce)}{let Fe=new cn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),be=new xn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);rc(fe,p,o,c,f,Ue,Fe,be,ln.disabled,De,"sdf",j,U,Z,q,re,dt,A,Ce)}M&&!De&&(Be=ae());{let Fe=De?x.ZERO:x.ONE_MINUS_DST_ALPHA,be=new cn({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ge=new xn([Fe,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.ao.transparent,[!0,!0,!0,!0]);rc(fe,p,o,c,f,Ue,be,Ge,ln.disabled,De,"color",j,U,Z,q,re,dt,A,Ce)}if(!M||De){let Fe=new xn([x.ONE,x.ONE,x.ONE,De?x.ZERO:x.ONE],r.ao.transparent,[!1,!1,!1,!0],De?x.FUNC_ADD:x.MAX);rc(fe,p,o,c,f,Ue,cn.disabled,Fe,ln.disabled,De,"clear",j,U,Z,q,re,dt,A,Ce,Be)}else{x.drawBuffers([x.NONE,x.COLOR_ATTACHMENT1]);let Fe=new cn({func:x.EQUAL,mask:255},254,255,x.KEEP,x.DECR,x.DECR),be=new xn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!0,!1,!1,!1],x.MAX);rc(fe,p,o,c,f,Ue,Fe,be,ln.disabled,De,"emissive",j,U,Z,q,re,dt,A,Ce,Be),x.drawBuffers([x.COLOR_ATTACHMENT0])}};if(ne||ge){let De;p.prepareDrawTile(),M&&!ne||(De=ae()),ne&&_e(!0,!1,De),ge&&_e(!1,!0,De)}}else ne&&ue(!0),ge&&ue(!1),(ne||ge)&&p.resetStencilClippingMasks()}}},building:function(p,o,c,f){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);let _=c.paint.get("building-ambient-occlusion-ground-intensity"),y=c.paint.get("building-ambient-occlusion-ground-radius"),x=c.paint.get("building-ambient-occlusion-ground-attenuation"),w=c.paint.get("building-opacity");if(w<=0)return;let S=_>0&&y>0,M=!0,A=c.paint.get("building-vertical-scale");if(A<=0)return;p.shadowRenderer||(M=!1);let L=p.conflationActive&&p.style.isLayerClipped(c,o.getSource()),F=p.style.order.indexOf(c.fqid);if((function(N,j,U,Z,q,ee){for(let re of ee){let ne=j.getTile(re).getBucket(U);ne&&(q&&ne.updateReplacement(re,N.replacementSource,Z),ne.uploadUpdatedIndexBuffer(N.context))}})(p,o,c,F,L,f),(function(N,j,U,Z){for(let q of Z){let ee=j.getTile(q).getBucket(U);ee&&ee.needsEvaluation()&&ee.uploadUpdatedColorBuffer(N.context)}})(p,o,c,f),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){let N=p.shadowRenderer,j=[],U=N.getShadowPassDepthMode();Bp({painter:p,source:o,layer:c,coords:f,defines:j,blendMode:N.getShadowPassColorMode(),depthMode:U,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(N=N.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(N=N.concat("NORMAL_OFFSET"));let j=c.paint.get("building-facade-emissive-chance"),U=c.paint.get("building-ambient-occlusion-intensity"),Z=c.paint.get("building-flood-light-intensity"),q=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ee=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(q?null:c.lut).toArray01().slice(0,3),re=c.paint.get("building-flood-light-ground-attenuation"),ne=Z>0,ge=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D);w<1&&Bp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:xn.disabled,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:Z,floodLightColor:ee,depthOnly:!0});let de=p.colorModeForRenderPass();Bp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:de,depthMode:ge,opacity:w,verticalScale:A,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:Z,floodLightColor:ee}),S&&Jm(p,o,c,f,!0,w,_,y,Z,ee,x,L),ne&&Jm(p,o,c,f,!1,w,_,y,Z,ee,re,L)}else if(p.renderPass==="light-beam"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],j=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);Bp({painter:p,source:o,layer:c,coords:f,defines:N,blendMode:xn.alphaBlended,depthMode:j,opacity:w,verticalScale:A,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,o,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let _=p.context,y=p.terrain&&p.terrain.renderingToTexture,[x,w]=p.renderPass!=="translucent"||y?[{},f]:p.stencilConfigForOverlap(f);for(let S of w){let M=o.getTile(S);if(M.needsHillshadePrepare&&p.renderPass==="offscreen")JT(p,M,c);else if(p.renderPass==="translucent"){let A=p.depthModeForSublayer(0,Gt.ReadOnly),L=c.paint.get("hillshade-emissive-strength"),F=p.colorModeForDrapableLayerRenderPass(L),N=y&&p.terrain?p.terrain.stencilModeForRTTOverlap(S):x[S.overscaledZ];QT(p,S,M,c,A,N,F)}}_.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,c,f,_,y){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let x=p.transform.projection.name==="globe",w=c.paint.get("raster-elevation")!==0,S=w&&x;if(p.renderElevatedRasterBackface&&!S)return;let M=p.context,A=M.gl,L=o.getSource(),F=(function(de,fe,ue,ae,_e){let De=fe.paint.get("raster-color"),Ce=de.type==="raster-array",Be=[],Ue=fe.paint.get("raster-resampling"),Ye=fe.paint.get("raster-color-mix"),dt=fe.paint.get("raster-color-range"),Fe=[Ye[0],Ye[1],Ye[2],0],be=Ye[3],Ge=Ue==="nearest"?ae.NEAREST:ae.LINEAR;if(Ce&&(Be.push("RASTER_ARRAY"),De||Be.push("RASTER_COLOR"),Ue==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),Ge=ae.NEAREST,!dt&&de.rasterLayers)){let Le=de.rasterLayers.find(({id:tt})=>tt===fe.sourceLayer);Le&&Le.fields&&Le.fields.range&&(dt=Le.fields.range)}if(dt=dt||[0,1],De){Be.push("RASTER_COLOR"),ue.activeTexture.set(ae.TEXTURE2),fe.updateColorRamp(dt);let Le=fe.colorRampTexture;Le||(Le=fe.colorRampTexture=new r.T(ue,fe.colorRamp,ae.RGBA8)),Le.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return _e&&Be.push("USE_MRT1"),{mix:Fe,range:dt,offset:be,defines:Be,resampling:Ge}})(L,c,M,A,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(L instanceof r.aU&&!f.length&&!x)return;let N=c.paint.get("raster-emissive-strength"),j=p.colorModeForDrapableLayerRenderPass(N),U=p.terrain&&p.terrain.renderingToTexture,Z=!p.options.moving,q=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(L instanceof r.aU&&!f.length&&(L.onNorthPole||L.onSouthPole)){let de=w?p.stencilModeFor3D():cn.disabled;return void Vp(!!L.onNorthPole,null,p,o,c,N,F,ln.disabled,de)}if(!f.length)return;let[ee,re]=L instanceof r.aU||U?[{},f]:p.stencilConfigForOverlap(f),ne=re[re.length-1].overscaledZ;S&&F.defines.push("PROJECTION_GLOBE_VIEW"),w&&F.defines.push("RENDER_CUTOFF");let ge=(de,fe,ue)=>{for(let ae of de){let _e=ae.toUnwrapped(),De=o.getTile(ae);if(U&&(!De||!De.hasData()))continue;M.activeTexture.set(A.TEXTURE0);let Ce=sc(De,L,c,F);if(!Ce||!Ce.texture)continue;let{texture:Be,mix:Ue,offset:Ye,tileSize:dt,buffer:Fe}=Ce,be,Ge;U?(be=Gt.disabled,Ge=ae.projMatrix):w?(be=new Gt(A.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),Ge=x?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(_e,Z)):(be=p.depthModeForSublayer(ae.overscaledZ-ne,c.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,A.LESS),Ge=p.transform.calculateProjMatrix(_e,Z));let Le=p.terrain&&U?p.terrain.stencilModeForRTTOverlap(ae):ee[ae.overscaledZ],tt=y?0:c.paint.get("raster-fade-duration");De.registerFadeDuration(tt);let bt=o.findLoadedParent(ae,0),At=Rp(De,bt,o,p.transform,tt),_t,pt;!At.isFading&&De.refreshedUponExpiration&&(De.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),M.activeTexture.set(A.TEXTURE0),Be.bind(q,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),bt?(bt.texture&&bt.texture.bind(q,A.CLAMP_TO_EDGE),_t=Math.pow(2,bt.tileID.overscaledZ-De.tileID.overscaledZ),pt=[De.tileID.canonical.x*_t%1,De.tileID.canonical.y*_t%1]):Be.bind(q,A.CLAMP_TO_EDGE),"useMipmap"in Be&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let jt=p.transform,zt,Tt=w?f1(jt):[0,0,0,0],Ot,Jt,fn,Fn,Jn,$t=0;if(S&&L instanceof r.aU&&L.coordinates.length>3)Ot=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0)))),Jt=Float32Array.from(jt.globeMatrix),fn=Float32Array.from(r.dF(jt)),Fn=[r.aF(jt.center.lng),r.aJ(jt.center.lat)],zt=L.elevatedGlobePerspectiveTransform,Jn=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let gi=r.dG(ae.canonical);$t=r.dH(gi.getCenter().lat),Ot=Float32Array.from(r.bk(r.dJ(ae.canonical))),Jt=Float32Array.from(jt.globeMatrix),fn=Float32Array.from(r.dF(jt)),Fn=[r.aF(jt.center.lng),r.aJ(jt.center.lat)],zt=[0,0],Jn=Float32Array.from(r.dI(ae.canonical,gi,$t,jt.worldSize/jt._pixelsPerMercatorPixel))}else zt=L instanceof r.aU?L.perspectiveTransform:[0,0],Ot=new Float32Array(16),Jt=new Float32Array(9),fn=new Float32Array(16),Fn=[0,0],Jn=new Float32Array(9);let Yn=a1(Ge,Ot,Jt,fn,Jn,pt||[0,0],r.aj(p.transform.zoom),Fn,Tt,_t||1,At,c,zt,w?c.paint.get("raster-elevation"):0,2,Ue,Ye,F.range,dt,Fe,N),pn=p.isTileAffectedByFog(ae),ii=p.getOrCreateProgram("raster",{defines:F.defines,overrideFog:pn});if(p.uploadCommonUniforms(M,ii,_e),L instanceof r.aU){let gi=L.elevatedGlobeVertexBuffer,di=L.elevatedGlobeIndexBuffer;if(U||!x)L.boundsBuffer&&L.boundsSegments&&ii.draw(p,A.TRIANGLES,be,cn.disabled,j,ln.disabled,Yn,c.id,L.boundsBuffer,p.quadTriangleIndexBuffer,L.boundsSegments);else if(gi&&di){let Wn=jt.zoom<=r.c_?L.elevatedGlobeSegments:L.getSegmentsForLongitude(jt.center.lng);Wn&&ii.draw(p,A.TRIANGLES,be,cn.disabled,j,fe,Yn,c.id,gi,di,Wn)}}else if(S){be=new Gt(A.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);let gi=p.globeSharedBuffers;if(gi){let[di,Wn,wn]=gi.getGridBuffers($t,!1);ii.draw(p,A.TRIANGLES,be,ue||Le,p.colorModeForRenderPass(),fe,Yn,c.id,di,Wn,wn)}}else{let{tileBoundsBuffer:gi,tileBoundsIndexBuffer:di,tileBoundsSegments:Wn}=p.getTileBoundsBuffers(De);ii.draw(p,A.TRIANGLES,be,Le,j,ln.disabled,Yn,c.id,gi,di,Wn)}}if(!(L instanceof r.aU)&&S)for(let ae of de){let _e=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&Vp(!0,ae,p,o,c,N,F,fe,ue||cn.disabled),_e&&Vp(!1,ae,p,o,c,N,F,fe===ln.frontCW?ln.backCW:ln.frontCW,ue||cn.disabled)}};S?ge(re,p.renderElevatedRasterBackface?ln.backCW:ln.frontCW,p.stencilModeFor3D()):ge(re,ln.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,o,c,f,_,y){p.renderPass==="offscreen"&&(function(x,w,S,M){if(!M.length)return;let A=x.context,L=A.gl,F=w.getSource();if(!(F instanceof ss))return;let N=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count"))),j=S.particlePositionRGBAImage;if(!j||j.width!==N){let re=(function(ne){let ge=ne*ne,de=new Uint8Array(4*ge),fe=function(ae){return ae|=0,ae=Math.imul(2747636419^ae,2654435769),ae=Math.imul(ae^ae>>>16,2654435769),((ae=Math.imul(ae^ae>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let ae=0;ae<ge;ae++){let _e=ue*(fe(2*ae+0)+wl),De=ue*(fe(2*ae+1)+wl),Ce=255*_e%1,Be=255*De%1,Ue=Ce,Ye=De-Be/255,dt=Be;de[4*ae+0]=255*(_e-Ce/255),de[4*ae+1]=255*Ue,de[4*ae+2]=255*Ye,de[4*ae+3]=255*dt}return de})(N);j=S.particlePositionRGBAImage=new r.q({width:N,height:N},re)}let U=S.particleFramebuffer;U?U.width!==N&&(U.destroy(),U=S.particleFramebuffer=A.createFramebuffer(N,N,1,null)):U=S.particleFramebuffer=A.createFramebuffer(N,N,1,null);let Z=[];for(let re of M){let ne=w.getTile(re);if(!(ne instanceof pm))continue;let ge=fv(ne,F,S);if(!ge)continue;let de=[ne.tileSize,ne.tileSize],fe=S.tileFramebuffer;fe||(fe=S.tileFramebuffer=A.createFramebuffer(de[0],de[1],1,null));let ue=ne.rasterParticleState;ue||(ue=ne.rasterParticleState=new tg(A,re,de,j));let ae=ue.update(S.lastInvalidatedAt);ue.particleTextureDimension!==N&&ue.updateParticleTexture(re,j);let _e=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=_e;let De=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=De,Z.push([re,ge,ue,ae])}if(Z.length===0)return;let q=r.o.now(),ee=S.previousDrawTimestamp?.001*(q-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=q,S.hasColorMap()){A.activeTexture.set(L.TEXTURE0+2);let re=S.colorRampTexture;re||(re=S.colorRampTexture=new r.T(A,S.colorRamp,L.RGBA8)),re.bind(L.LINEAR,L.CLAMP_TO_EDGE)}A.bindFramebuffer.set(S.tileFramebuffer.framebuffer),(function(re,ne,ge){let de=re.context,fe=de.gl,ue=ne.tileFramebuffer;de.activeTexture.set(fe.TEXTURE0);let ae={u_texture:0,u_opacity:1.05*(De=ne.paint.get("raster-particle-fade-opacity-factor"))/(De+.05)},_e=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var De;for(let Ce of ge){let[,,Be,Ue]=Ce;ue.colorAttachment0.set(Be.targetColorTexture.texture),de.viewport.set([0,0,ue.width,ue.height]),de.clear({color:r.ao.transparent}),Ue&&(Be.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),_e.draw(re,fe.TRIANGLES,Gt.disabled,cn.disabled,xn.alphaBlended,ln.disabled,ae,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}})(x,S,Z),(function(re,ne,ge,de){let fe=re.context,ue=fe.gl,ae=ge.tileFramebuffer,_e=re.transform.projection.name==="globe",De=ge.paint.get("raster-particle-max-speed");for(let Ce of de){let[Be,Ue,Ye]=Ce;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ae.colorAttachment0.set(Ye.targetColorTexture.texture);let dt=re.getOrCreateProgram("rasterParticleDraw",{defines:Ue.defines,overrideFog:!1});fe.activeTexture.set(ue.TEXTURE0+1);let Fe=Ue.scalarData?[]:[0,1,2,3].map(Le=>r.e9[Le](Be));Fe.push(Be);let be=Be.canonical.x,Ge=Be.canonical.y;for(let Le of Fe){let tt=ne.getTile(_e?Le.wrapped():Le);if(!tt)continue;let bt=tt.rasterParticleState;if(!bt)continue;let At=Le.canonical.x+(1<<Le.canonical.z)*(Le.wrap-Be.wrap),_t=Le.canonical.y;bt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let pt=lI(1,bt.particleTexture0.size[0],[At-be,_t-Ge],0,Ue.texture.size,2,De,Ue.textureOffset,Ue.scale,Ue.offset);dt.draw(re,ue.POINTS,Gt.disabled,cn.disabled,xn.alphaBlended,ln.disabled,pt,ge.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}})(x,w,S,Z),A.bindFramebuffer.set(S.particleFramebuffer.framebuffer),(function(re,ne,ge,de){let fe=re.context,ue=fe.gl,ae=ne.paint.get("raster-particle-max-speed"),_e=de*ne.paint.get("raster-particle-speed-factor")*.15,De=(function(Be){return Math.pow(Be,6)})(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),Ce=ne.particleFramebuffer;fe.viewport.set([0,0,Ce.width,Ce.height]);for(let Be of ge){let[,Ue,Ye]=Be;fe.activeTexture.set(ue.TEXTURE0+0),Ue.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),fe.activeTexture.set(ue.TEXTURE0+1);let dt=Ye.particleTexture0;dt.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);let Fe=c1(1,dt.size[0],0,Ue.texture.size,ae,_e,De,Ue.textureOffset,Ue.scale,Ue.offset);Ce.colorAttachment0.set(Ye.particleTexture1.texture),fe.clear({color:r.ao.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Ue.defines}).draw(re,ue.TRIANGLES,Gt.disabled,cn.disabled,xn.unblended,ln.disabled,Fe,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}})(x,S,Z,ee)})(p,o,c,f),p.renderPass==="translucent"&&((function(x,w,S,M,A){let L=x.context,F=L.gl,N=w.getSource().tileSize,j=5*(1-r.ah(r.cL,r.cL+1,x.transform.zoom))*N+S.paint.get("raster-particle-elevation"),U=!x.options.moving,Z=x.transform.projection.name==="globe";if(!M.length)return;let[q,ee]=x.stencilConfigForOverlap(M),re=[];Z&&re.push("PROJECTION_GLOBE_VIEW");let ne=x.stencilModeFor3D();for(let ge of ee){let de=ge.toUnwrapped(),fe=w.getTile(ge);if(!fe.rasterParticleState)continue;let ue=fe.rasterParticleState,ae=100;fe.registerFadeDuration(ae);let _e=w.findLoadedParent(ge,0),De=Rp(fe,_e,w,x.transform,ae),Ce,Be;x.terrain&&x.terrain.prepareDrawTile(),L.activeTexture.set(F.TEXTURE0),ue.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),_e&&_e.rasterParticleState?(_e.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ce=Math.pow(2,_e.tileID.overscaledZ-fe.tileID.overscaledZ),Be=[fe.tileID.canonical.x*Ce%1,fe.tileID.canonical.y*Ce%1]):ue.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let Ue=Z?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(de,U),Ye=x.transform,dt=m1(Ye),Fe=r.dG(ge.canonical),be=r.dH(Fe.getCenter().lat),Ge,Le,tt,bt,At;Z?(Ge=Float32Array.from(r.bk(r.dJ(ge.canonical))),Le=Float32Array.from(Ye.globeMatrix),tt=Float32Array.from(r.dF(Ye)),bt=[r.aF(Ye.center.lng),r.aJ(Ye.center.lat)],At=Float32Array.from(r.dI(ge.canonical,Fe,be,Ye.worldSize/Ye._pixelsPerMercatorPixel))):(Ge=new Float32Array(16),Le=new Float32Array(9),tt=new Float32Array(16),bt=[0,0],At=new Float32Array(9));let _t=aI(Ue,Ge,Le,tt,At,Be||[0,0],r.aj(x.transform.zoom),bt,dt,Ce||1,De,j),pt=x.isTileAffectedByFog(ge),jt=x.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:pt});if(x.uploadCommonUniforms(L,jt,de),Z){let zt=new Gt(F.LEQUAL,Gt.ReadOnly,x.depthRangeFor3D),Tt=0,Ot=x.globeSharedBuffers;if(Ot){let[Jt,fn,Fn]=Ot.getGridBuffers(be,Tt!==0);jt.draw(x,F.TRIANGLES,zt,ne,xn.alphaBlended,x.renderElevatedRasterBackface?ln.frontCCW:ln.backCCW,_t,S.id,Jt,fn,Fn)}}else{let zt=x.depthModeForSublayer(0,Gt.ReadOnly),Tt=q[ge.overscaledZ],{tileBoundsBuffer:Ot,tileBoundsIndexBuffer:Jt,tileBoundsSegments:fn}=x.getTileBoundsBuffers(fe);jt.draw(x,F.TRIANGLES,zt,Tt,xn.alphaBlended,ln.disabled,_t,S.id,Ot,Jt,fn)}}x.resetStencilClippingMasks()})(p,o,c,f),p.style.map.triggerRepaint())},background:function(p,o,c,f){let _=c.paint.get("background-color"),y=c.paint.get("background-color-use-theme").constantOr("default")==="none",x=c.paint.get("background-opacity"),w=c.paint.get("background-emissive-strength"),S=c.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let M=p.context,A=M.gl,L=p.transform,F=L.tileSize,N=c.paint.get("background-pattern"),j;if(N!==void 0&&(N===null||(j=p.imageManager.getPattern(r.I.from(N.toString()),c.scope,p.style.getLut(c.scope)),!j)))return;let U=!N&&_.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;let Z=cn.disabled,q=p.depthModeForSublayer(0,U==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ee=p.colorModeForDrapableLayerRenderPass(w),re=N?"backgroundPattern":"background",ne,ge=f;ge||(ne=p.getBackgroundTiles(),ge=Object.values(ne).map(fe=>fe.tileID)),N&&(M.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context,c.scope));let de=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&de.push("USE_MRT1"),S){let fe=p.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0,defines:de}),ue=new Float32Array(r.bA([])),ae=new r.aQ(0,0,0,0,0),_e=N?iu(ue,w,x,p,0,c.scope,j,S,{tileID:ae,tileSize:F}):Fp(ue,w,x,_.toPremultipliedRenderColor(y?null:c.lut));fe.draw(p,A.TRIANGLES,q,Z,ee,ln.disabled,_e,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(let fe of ge){let ue=p.isTileAffectedByFog(fe),ae=p.getOrCreateProgram(re,{overrideFog:ue,defines:de}),_e=fe.toUnwrapped(),De=f?fe.projMatrix:p.transform.calculateProjMatrix(_e);p.prepareDrawTile();let Ce=o?o.getTile(fe):ne?ne[fe.key]:new td(fe,F,L.zoom,p),Be=N?iu(De,w,x,p,0,c.scope,j,S,{tileID:fe,tileSize:F}):Fp(De,w,x,_.toPremultipliedRenderColor(y?null:c.lut));p.uploadCommonUniforms(M,ae,_e);let{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Ye,tileBoundsSegments:dt}=p.getTileBoundsBuffers(Ce);ae.draw(p,A.TRIANGLES,q,Z,ee,ln.disabled,Be,c.id,Ue,Ye,dt)}},sky:function(p,o,c){let f=p._atmosphere?r.aj(p.transform.zoom):1,_=c.paint.get("sky-opacity")*f;if(_===0)return;let y=p.context,x=c.paint.get("sky-type"),w=new Gt(y.gl.LEQUAL,Gt.ReadOnly,[0,1]),S=p.frameCounter/1e3%1;x==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&((function(M,A,L,F){let N=M.context,j=N.gl,U=A.skyboxFbo;if(!U){U=A.skyboxFbo=N.createFramebuffer(32,32,1,null),A.skyboxGeometry=new ig(N),A.skyboxTexture=N.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,A.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let re=0;re<6;++re)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);let Z=A.getCenter(M,!0),q=M.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);r.bA(ee),r.en(ee,ee,.5*-Math.PI),fd(M,A,q,ee,Z,0),r.bA(ee),r.en(ee,ee,.5*Math.PI),fd(M,A,q,ee,Z,1),r.bA(ee),r.cU(ee,ee,.5*-Math.PI),fd(M,A,q,ee,Z,2),r.bA(ee),r.cU(ee,ee,.5*Math.PI),fd(M,A,q,ee,Z,3),r.bA(ee),fd(M,A,q,ee,Z,4),r.bA(ee),r.en(ee,ee,Math.PI),fd(M,A,q,ee,Z,5),N.viewport.set([0,0,M.width,M.height])})(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&(function(M,A,L,F,N){let j=M.context,U=j.gl,Z=M.transform,q=M.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,A.skyboxTexture);let ee=((re,ne,ge,de,fe)=>({u_matrix:re,u_sun_direction:ne,u_cubemap:0,u_opacity:de,u_temporal_offset:fe}))(Z.skyboxMatrix,A.getCenter(M,!1),0,F,N);M.uploadCommonUniforms(j,q),q.draw(M,U.TRIANGLES,L,cn.disabled,M.colorModeForRenderPass(),ln.backCW,ee,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S):x==="gradient"&&p.renderPass==="sky"&&(function(M,A,L,F,N){let j=M.context,U=j.gl,Z=M.transform,q=M.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new ig(j)),j.activeTexture.set(U.TEXTURE0);let ee=A.colorRampTexture;ee||(ee=A.colorRampTexture=new r.T(j,A.colorRamp,U.RGBA8)),ee.bind(U.LINEAR,U.CLAMP_TO_EDGE);let re=((ne,ge,de,fe,ue)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ge,u_radius:r.an(de),u_opacity:fe,u_temporal_offset:ue}))(Z.skyboxMatrix,A.getCenter(M,!1),A.paint.get("sky-gradient-radius"),F,N);M.uploadCommonUniforms(j,q),q.draw(M,U.TRIANGLES,L,cn.disabled,M.colorModeForRenderPass(),ln.backCW,re,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)})(p,c,w,_,S)},custom:function(p,o,c,f){let _=p.context,y=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(o)){if(p.renderPass==="offscreen"){let x=y.prerender;if(x){if(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;x.call(y,_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else x.call(y,_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let w=y.renderToTile;if(w){let S=f[0].canonical,M={x:S.x+f[0].wrap*(y.wrapTileId?0:1<<S.z),y:S.y,z:S.z};_.setDepthMode(Gt.disabled),_.setStencilMode(cn.disabled),_.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),w.call(y,_.gl,M),_.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(cn.disabled);let x=y.renderingMode==="3d"?new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Gt.ReadOnly);if(_.setDepthMode(x),p.transform.projection.name==="globe"){let w=p.transform.pointMerc;y.render(_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[w.x,w.y],p.transform.pixelsPerMeterRatio)}else y.render(_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,o,c,f){if(p.renderPass==="opaque")return;let _=c.paint.get("model-opacity").constantOr(1),y=c.paint.get("model-elevation-reference"),x=y==="ground",w=y==="ground";if(_===0)return;let S=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!S||p.terrain&&_<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;let M=p.shadowRenderer,A=c.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,A||(M.enabled=!1));let L=()=>{M&&(M.useNormalOffset=!0,A||(M.enabled=!0))},F=o.getSource();if(p.renderPass==="light-beam"&&F.type!=="batched-model")return;if(F.type==="vector"||F.type==="geojson")return(function(ne,ge,de,fe,ue){let ae=ne.transform,_e=ae.projection.name==="globe",De=ae.getFreeCameraOptions().position;if(!ne.modelManager)return;let Ce=ne.modelManager;de.modelManager=Ce;let Be=ne.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Ue=de._unevaluatedLayout._values["model-id"],Ye=Object.assign({},de.layout.get("model-id").parameters),dt=ne.style.order.indexOf(de.fqid),Fe=de.paint.get("model-opacity").constantOr(1);for(let be of fe){let Ge=ge.getTile(be).getBucket(de);if(!Ge||Ge.projection.name!==ae.projection.name)continue;let Le=Ge.getModelUris();if(Le&&!Ge.modelsRequested&&(Ce.addModelsFromBucket(Le,ue),Ge.modelsRequested=!0),_e)Ye.zoom=be.overscaledZ;else{let Tt=gs(be,ae);Ye.zoom=Tt}let tt=Ue.possiblyEvaluate(Ye);if(S1(ne,Ge,be),El.shadowUniformsInitialized=!1,El.useSingleShadowCascade=!!Be&&Be.getMaxCascadeForTile(be.toUnwrapped())===0,ne.renderPass==="shadow"&&Be){if(ne.currentShadowCascade===1&&Ge.isInsideFirstShadowMapFrustum)continue;let Tt=ae.calculatePosMatrix(be.toUnwrapped(),ae.worldSize);if(El.tileMatrix.set(Tt),El.shadowTileMatrix=Float32Array.from(Be.calculateShadowPassMatrixFromMatrix(Tt)),El.aabb.min=[0,0,0],El.aabb.max[0]=El.aabb.max[1]=r.al,El.aabb.max[2]=0,hI(Ge,El,ne,de.scope))continue}let bt=1<<be.canonical.z,At=[((De.x-be.wrap)*bt-be.canonical.x)*r.al,(De.y*bt-be.canonical.y)*r.al,De.z*bt*r.al];ne.conflationActive&&Object.keys(Ge.instancesPerModel).length>0&&ne.style.isLayerClipped(de,ge.getSource())&&Ge.updateReplacement(be,ne.replacementSource,dt,de.scope)&&(Ge.uploaded=!1,Ge.upload(ne.context));let _t=0,pt=new Array,jt=new Array,zt=new Array;for(let Tt in Ge.instancesPerModel){let Ot=Ge.instancesPerModel[Tt];Ot.features.length>0&&!_e&&(Tt=tt.evaluate(Ot.features[0].feature,{}));let Jt=Ce.getModel(Tt,ue);if(Jt||Ce.hasURLBeenRequested(Tt)||Ge.modelUris.includes(Tt)||(Ge.modelUris.push(Tt),Ge.modelsRequested=!1),Jt&&Jt.uploaded)if(_e){let fn=r.c5([],[De.x,De.y,De.z],ne.transform.worldSize);r.ew(fn,fn);for(let Fn=0;Fn<Ot.instancedDataArray.length;++Fn){let Jn=[0,0,0],$t=[1,1,1],Yn=r.ex(),pn=Ot.tileCoordinatesForInstance(Fn),ii=Ot.transformForInstance(Fn);r.ey($t,ii),r.ez(Yn,ii),r.eA(Jn,Yn);let gi=Ot.translationForInstance(Fn),di=new r.aT(0,0);r.eB(Ge.canonical,di,pn.x,pn.y);let Wn=r.bC();r.eC(Wn,Jt,ne.transform,di,Jn,$t,gi,!0,!1,!1);let wn=Ot.colorForInstance(Fn),ti=r.bA([]),ur=r.ef(di.lat,ne.transform.zoom),Ki=r.bq([],[1,1,1/ur]);r.br(ti,ti,fn),zt.push({zScaleMatrix:Ki,negCameraPosMatrix:ti});for(let ri of Jt.nodes)md(ne,ri,Wn,ne.transform.expandedFarZProjMatrix,_t,pt,jt,Jt.materialOverrides,Fe,wn);++_t}}else for(let fn of Jt.nodes)T1(ne,de,fn,Ot,At,be,El)}if(_e)if(ne.renderPass==="shadow"){for(let Tt of jt)Xa(Tt.mesh,Tt.nodeModelMatrix,ne,de);for(let Tt of pt)Xa(Tt.mesh,Tt.nodeModelMatrix,ne,de)}else E1(ne,de,pt,jt,zt)}})(p,o,c,f,Up(p,c)),void L();if(!F.loaded())return;if(F.type==="batched-model")return(function(ne,ge,de,fe){de.resetLayerRenderingStats(ne);let ue=ne.context,ae=ne.transform,_e=ne.style.fog,De=ne.shadowRenderer;if(ae.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ae.projection.name} projection is not yet implemented`);let Ce=ne.transform.getFreeCameraOptions().position,Be=r.c5([],[Ce.x,Ce.y,Ce.z],ne.transform.worldSize),Ue=r.ew([],Be),Ye=r.bA([]),dt=r.ef(ae.center.lat,ae.zoom),Fe=r.bq([],[1,1,1/dt]);r.br(Ye,Ye,Ue);let be=de.paint.get("model-opacity").constantOr(1),Ge=new Gt(ue.gl.LEQUAL,Gt.ReadWrite,ne.depthRangeFor3D),Le=new Gt(ue.gl.LEQUAL,Gt.ReadOnly,ne.depthRangeFor3D),tt=new r.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),bt=ne.renderPass==="shadow",At=bt&&De?De.getCurrentCascadeFrustum():ae.getFrustum(ae.scaleZoom(ae.worldSize)),_t=de.paint.get("model-front-cutoff"),pt=_t[2]<1,jt=Yc(ne,de.paint.get("model-cutoff-fade-range")),zt=de.getLayerRenderingStats();(function(Tt,Ot,Jt,fn){let Fn=Tt.terrain?Tt.terrain.exaggeration():0,Jn=Tt.transform.zoom;for(let $t of fn){let Yn=Ot.getTile($t).getBucket(Jt);Yn&&(Yn.setFilter(Jt.filter),Tt.conflationActive&&Yn.updateReplacement($t,Tt.replacementSource),Yn.evaluateTransform(Tt,Jt),Tt.terrain&&Fn>0&&Yn.elevationUpdate(Tt.terrain,Fn,$t,Jt.source),Yn.needsReEvaluation(Tt,Jn,Jt)&&Yn.evaluate(Jt))}})(ne,ge,de,fe),(function(){let Tt,Ot,Jt;pt?(Tt=fe.length-1,Ot=-1,Jt=-1):(Tt=0,Ot=fe.length,Jt=1);let fn=new Float64Array(16),Fn=r.cA(),Jn=new r.P(0,0);for(let $t=Tt;$t!==Ot;$t+=Jt){let Yn=fe[$t],pn=ge.getTile(Yn).getBucket(de);if(!pn||!pn.uploaded)continue;let ii=!1;De&&(ii=De.getMaxCascadeForTile(Yn.toUnwrapped())===0);let gi=ae.calculatePosMatrix(Yn.toUnwrapped(),ae.worldSize),di=pn.modelTraits;!bt&&pt&&(r.bl(fn,gi),r.af(Fn,Be,fn),Jn.x=Fn[0],Jn.y=Fn[1]);let Wn=[];pn.setFilter(de.filter);for(let wn of pn.getNodesInfo()){if(wn.hiddenByReplacement||!wn.node.meshes)continue;let ti=wn.node,ur=0;ne.terrain&&ti.elevation&&(ur=ti.elevation*ne.terrain.exaggeration());let Ki=(()=>{let Qo=wn.aabb;return tt.min=[...Qo.min],tt.max=[...Qo.max],tt.min[2]+=ur,tt.max[2]+=ur,r.af(tt.min,tt.min,gi),r.af(tt.max,tt.max,gi),tt})(),ri=wn.evaluatedScale;if(ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&Ki.intersects(At)===0)continue;if(!bt&&pt){let Qo=.16666666666666666;wn.cameraCollisionOpacity=Be[0]>Ki.min[0]&&Be[0]<Ki.max[0]&&Be[1]>Ki.min[1]&&Be[1]<Ki.max[1]&&Be[2]*dt<Ki.max[2]&&ti.footprint&&r.c0(Jn,ti.footprint)?Math.max(wn.cameraCollisionOpacity-Qo,0):Math.min(1,wn.cameraCollisionOpacity+Qo)}let $n=[...gi],Cn=1/r.d7(Yn.canonical),Gi=ti.anchor?ti.anchor[0]:0,Cr=ti.anchor?ti.anchor[1]:0;r.br($n,$n,[Gi*(ri[0]-1)+wn.evaluatedTranslation[0]*Cn,Cr*(ri[1]-1)+wn.evaluatedTranslation[1]*Cn,ur+wn.evaluatedTranslation[2]]),r.cq(ri,r.eE)||r.cS($n,$n,ri);let ir=r.aB([],$n,ti.globalMatrix),Ti=r.aB([],ae.expandedFarZProjMatrix,ir),_s=r.aB([],ae.expandedFarZProjMatrix,$n),Lo=r.aC([],[Gi,Cr,ur,1],Ti)[2];ti.hidden=!1;let Jr=be;bt||(pt&&(Jr*=wn.cameraCollisionOpacity,Jr*=Pn($n,ae,wn.aabb,_t)),Jr*=Xi(jt,Lo)),Jr!==0?Wn.push({nodeInfo:wn,depth:Lo,opacity:Jr,wvpForNode:Ti,wvpForTile:_s,nodeModelMatrix:ir,tileModelMatrix:$n}):ti.hidden=!0}bt||Wn.sort((wn,ti)=>!pt||wn.opacity===1&&ti.opacity===1?wn.depth<ti.depth?-1:1:wn.opacity===1?-1:ti.opacity===1?1:wn.depth>ti.depth?-1:1);for(let wn of Wn){let ti=wn.nodeInfo,ur=ti.node,Ki=r.aB([],Fe,wn.tileModelMatrix);r.aB(Ki,Ye,Ki);let ri=r.bl([],Ki);r.eg(ri,ri),r.cS(ri,ri,jp),Ki=r.aB(Ki,Ki,ur.globalMatrix);let $n=ne.renderPass==="light-beam",Cn=de.paint.get("model-color-use-theme").constantOr("default")==="none",Gi=di&r.eI.HasMapboxMeshFeatures,Cr=Gi?0:ti.evaluatedRMEA[0][2];for(let ir=0;ir<ur.meshes.length;++ir){let Ti=ur.meshes[ir],_s=ir===ur.lightMeshIndex,Lo=wn.wvpForNode;if(_s){if(!$n&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}Lo=wn.wvpForTile}else if($n)continue;let Jr={defines:[]},Qo=[];if(!bt&&De&&(De.useNormalOffset=!!Ti.normalBuffer),sg(Jr.defines,Qo,Ti,ne,Cn?null:de.lut),Gi||Jr.defines.push("DIFFUSE_SHADED"),ii&&Jr.defines.push("SHADOWS_SINGLE_CASCADE"),zt&&(bt?zt.numRenderedVerticesInShadowPass+=Ti.vertexArray.length:zt.numRenderedVerticesInTransparentPass+=Ti.vertexArray.length),bt){Xa(Ti,wn.nodeModelMatrix,ne,de);continue}let Jo=null;if(_e){let Mr=og(wn.nodeModelMatrix,ne.transform);if(Jo=new Float32Array(Mr),ae.projection.name!=="globe"){let Ii=Ti.aabb.min,Lr=Ti.aabb.max,[dr,rr]=_e.getOpacityForBounds(Mr,Ii[0],Ii[1],Lr[0],Lr[1]);Jr.overrideFog=dr>=Xe||rr>=Xe}}let Do=Ti.material,ra;Do.occlusionTexture&&Do.occlusionTexture.offsetScale&&(ra=Do.occlusionTexture.offsetScale,Jr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Ma=ne.getOrCreateProgram("model",Jr);!bt&&De&&De.setupShadowsFromMatrix(wn.tileModelMatrix,Ma,De.useNormalOffset),ne.uploadCommonUniforms(ue,Ma,null,Jo);let Ps=Do.pbrMetallicRoughness;Ps.metallicFactor=.9,Ps.roughnessFactor=.5;let _r=cd(new Float32Array(Lo),new Float32Array(Ki),new Float32Array(ri),new Float32Array(ur.globalMatrix),ne,wn.opacity,Ps.baseColorFactor,Do.emissiveFactor,Ps.metallicFactor,Ps.roughnessFactor,Do,Cr,de,[0,0,0],ra);!_s&&(ti.hasTranslucentParts||wn.opacity<1)&&Ma.draw(ne,ue.gl.TRIANGLES,Ge,cn.disabled,xn.disabled,ln.backCCW,_r,de.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,de.paint,ne.transform.zoom,void 0,Qo),Ma.draw(ne,ue.gl.TRIANGLES,_s?Le:Ge,cn.disabled,_s||wn.opacity<1||ti.hasTranslucentParts?xn.alphaBlended:xn.unblended,ln.backCCW,_r,de.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,de.paint,ne.transform.zoom,void 0,Qo)}}}})()})(p,o,c,f),void L();if(F.type!=="model")return;let N=F.getModels(),j=[],U=p.transform.getFreeCameraOptions().position,Z=r.c5([],[U.x,U.y,U.z],p.transform.worldSize);r.ew(Z,Z);let q=[],ee=[],re=0;for(let ne of N){let ge=o.getFeatureState("",ne.id),de={type:"Unknown",id:ne.id,properties:ne.featureProperties},fe=c.paint.get("model-rotation").evaluate(de,ge),ue=c.paint.get("model-scale").evaluate(de,ge),ae=c.paint.get("model-translation").evaluate(de,ge),_e=c.paint.get("model-opacity").evaluate(de,ge);w1(c,ne.id,ge,ne.featureProperties,ne.nodeOverrideNames,ne.nodeOverrides),C1(c,ne.id,ge,ne.featureProperties,ne.materialOverrideNames,ne.materialOverrides),ne.nodeOverrides.size>0&&ne.computeBoundsAndApplyParent(),ne.computeModelMatrix(p,fe,ue,ae,w,x,!1);let De=r.bA([]),Ce=r.ef(ne.position.lat,p.transform.zoom),Be=r.bq([],[1,1,1/Ce]);r.br(De,De,Z),j.push({zScaleMatrix:Be,negCameraPosMatrix:De});for(let Ue of ne.nodes)md(p,Ue,ne.matrix,p.transform.expandedFarZProjMatrix,re,q,ee,ne.materialOverrides,_e);re++}if(q.sort((ne,ge)=>ge.depth-ne.depth),p.renderPass!=="shadow")E1(p,c,q,ee,j),L();else{for(let ne of ee)Xa(ne.mesh,ne.nodeModelMatrix,p,c);for(let ne of q)Xa(ne.mesh,ne.nodeModelMatrix,p,c);L()}}},ug={line:function(p,o,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){let f=o.getVisibleCoordinates();for(let _ of f){let y=o.getTile(_).getBucket(p);if(y&&(y.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,o,c){let f=o.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Up(c,p)));if(f.type==="batched-model"||f.type!=="model")return;let _=f.getModels();for(let y of _)y.upload(c.context)},raster:function(p,o,c){let f=o.getSource();if(!(f instanceof ss&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)},"raster-particle":function(p,o,c){let f=o.getSource();if(!(f instanceof ss&&f.loaded()))return;let _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let y=p.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(y==null)return;let x=o.getIds().map(w=>o.getTileByID(w));for(let w of x)w.updateNeeded(p.id,y)&&f.prepareTile(w,_,p.id,y)}},ia={fill:Xm},dg={fill:function(p,o,c,f){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let _=p.context.gl,y=new Gt(_.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),x=new cn({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),w=p.transform.getFreeCameraOptions().position,S=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(let M of f){let A=o.getTile(M),L=A.getBucket(c);if(!L)continue;let F=L.elevatedStructures;if(!F||F.depthSegments.segments[0].primitiveLength===0)continue;let N=p1(M.toUnwrapped(),w),j=p.translatePosMatrix(M.projMatrix,A,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),U=ld(j,N,0,1,0);S.draw(p,_.TRIANGLES,y,x,xn.disabled,ln.disabled,U,c.id,F.vertexBuffer,F.indexBuffer,F.depthSegments,c.paint,p.transform.zoom)}}};class hg{constructor(o,c,f,_,y){this.context=new uh(o,c),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;for(let S of x);this.occlusionParams=new hh,this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Qd(this),this._wireframeDebugCache=new ou,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let w=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,w,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=y,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,c){let f=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new iv(this,o));let _=this._terrain;this.transform.elevation=f?_:null,_.update(o,this.transform,c),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(o){let c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,_]=c.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);let y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new iv(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,c){if(this.width=o*r.o.devicePixelRatio,this.height=c*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let o=this.context,c=new r.bd;c.emplaceBack(0,0),c.emplaceBack(r.al,0),c.emplaceBack(0,r.al),c.emplaceBack(r.al,r.al),this.tileExtentBuffer=o.createVertexBuffer(c,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);let f=new r.bd;f.emplaceBack(0,0),f.emplaceBack(r.al,0),f.emplaceBack(0,r.al),f.emplaceBack(r.al,r.al),this.debugBuffer=o.createVertexBuffer(f,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);let _=new r.bd;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);let y=new r.b1;y.emplaceBack(0,0,0,0),y.emplaceBack(r.al,0,r.al,0),y.emplaceBack(0,r.al,0,r.al),y.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=o.createVertexBuffer(y,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);let x=new r.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(x);let w=new r.be;for(let M of[0,1,3,2,0])w.emplaceBack(M);this.debugIndexBuffer=o.createIndexBuffer(w),this.emptyTexture=new r.T(o,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=r.bC();let S=this.context.gl;this.stencilClearMode=new cn({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Gt.disabled,this.stencilClearMode,xn.disabled,ln.disabled,Op(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,f){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(let S of f)if(this._tileClippingMaskIDs[S.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=c.id;let _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(xn.disabled),_.setDepthMode(Gt.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let w of f){let S=c.getTile(w),M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:L,tileBoundsSegments:F}=this.getTileBoundsBuffers(S);x.draw(this,y.TRIANGLES,Gt.disabled,new cn({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),xn.disabled,ln.disabled,Op(w.projMatrix),"$clipping",A,L,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,c=this.context.gl;return new cn({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let c=this.context.gl;return new cn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){let c=this.context.gl,f=o.sort((x,w)=>w.overscaledZ-x.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let w=0;w<y;w++)x[w+_]=new cn({func:c.GEQUAL,mask:255},w+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=y,[x,f]}return[{[_]:cn.disabled},f]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new xn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}colorModeForDrapableLayerRenderPass(o){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new xn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new xn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],r.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,c,f,_=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Gt.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Gt(f||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let o=this.context.gl,c=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&f!==0&&(this.depthFBO=new h1(this.context,c,f,0,"texture"),this.depthTexture=new r.T(this.context,{width:c,height:f,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),o.bindTexture(o.TEXTURE_2D,y),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,c,f,0,0,c,f,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,c)=>o+c/this._fpsHistory.length,0))}render(o,c){let f=r.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=c;let _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Fe=>{let be=_[Fe];return!(be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[be.type]}),w=x(),S=!1,M=!1,A=null,L=0,F=!1;for(let Fe of w){let be=_[Fe];be.visibility!=="none"&&(be.type==="circle"?S=!0:be.type==="building"?(A=be,++L):be.type==="symbol"&&(be.hasOcclusionOpacityProperties?M=!0:S=!0))}this.updateEmissiveMode();let N=w.map(Fe=>_[Fe]),j=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();for(let Fe in j){let be=j[Fe];be.used&&(be.prepare(this.context),be.getSource().usedInConflation&&++L)}let U=!1;for(let Fe of N)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(U=!0),this.prepareLayer(Fe));let Z={},q={},ee={},re={},ne={};for(let Fe in j){let be=j[Fe];Z[Fe]=be.getVisibleCoordinates(),q[Fe]=Z[Fe].slice().reverse(),ee[Fe]=be.getVisibleCoordinates(!0).reverse(),re[Fe]=be.getShadowCasterCoordinates(),ne[Fe]=be.sortCoordinatesByDistance(Z[Fe])}let ge=Fe=>{let be=this.style.getLayerSourceCache(Fe);return be&&be.used?be.getSource():null};if(L||U||this._clippingActiveLastFrame){let Fe=[],be=[],Ge=0;for(let Le of N)this.isSourceForClippingOrConflation(Le,ge(Le))&&(Fe.push(Le),be.push(Ge)),Ge++;if(Fe&&(U||Fe.length>1)||this._clippingActiveLastFrame){U=!1;let Le=[];for(let tt=0;tt<Fe.length;tt++){let bt=Fe[tt],At=be[tt],_t=this.style.getLayerSourceCache(bt);if(!_t||!_t.used||!_t.getSource().usedInConflation&&bt.type!=="clip"&&bt.type!=="building")continue;let pt=r.eQ,jt=r.b_.None,zt=[],Tt=!0;if(bt.type==="building")pt=r.eS;else if(bt.type==="clip"){pt=At;for(let Ot of bt.layout.get("clip-layer-types"))jt|=Ot==="model"?r.b_.Model:Ot==="symbol"?r.b_.Symbol:r.b_.FillExtrusion;for(let Ot of bt.layout.get("clip-layer-scope"))zt.push(Ot);bt.isHidden(this.transform.zoom)?Tt=!1:U=!0}Tt&&Le.push({layer:bt.fqid,cache:_t,order:pt,clipMask:jt,clipScope:zt})}this.replacementSource.setSources(Le),F=!0}}this._clippingActiveLastFrame=U,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<N.length;Fe++){let be=N[Fe];if(be.visibility==="none")continue;let Ge=be.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){let Le=ge(be);Le&&(this.minCutoffZoom=Math.max(Le.minzoom,this.minCutoffZoom)),be.minzoom&&(this.minCutoffZoom=Math.max(be.minzoom,this.minCutoffZoom))}be.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}let de=this.style&&this.style.fog;de?(this._fogVisible=de.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=de.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,w=x(),N=w.map(Fe=>_[Fe]));let fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(let Fe in j)for(let be of Z[Fe]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(be)||Ge),fe.addShadowReceiver(be.toUnwrapped(),Ge.min,Ge.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new b1(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ue&&!this._snow&&(this._snow=new yv(this)),!ue&&this._snow&&(this._snow.destroy(),delete this._snow),ae&&!this._rain&&(this._rain=new cg(this)),!ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),A){this.buildingTileBorderManager||(this.buildingTileBorderManager=new rg);let Fe=this.style.getLayerSourceCache(A);this.buildingTileBorderManager.updateBorders(Fe,A)}if(!zs.has(this.context.gl))return;this.renderPass="offscreen";for(let Fe of N){let be=o.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;let Ge=be?q[be.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Ge&&Ge.length)&&this.renderLayer(this,be,Fe,Ge)}this.depthRangeFor3D=[0,1-(N.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),De=(()=>{if(c.showOverdrawInspector)return r.ao.black;let Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){let be=this.style.getLut(Fe.scope);if(!_e){let Ge=Fe.properties.get("color-use-theme")==="none",Le=Fe.properties.get("color").toNonPremultipliedRenderColor(Ge?null:be).toArray01();return new r.ao(...Le)}if(_e){let Ge=Fe.properties.get("space-color-use-theme")==="none",Le=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Ge?null:be).toArray01();return new r.ao(...Le)}}return r.ao.transparent})();if(this.context.clear({color:De,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);if(Fe.isSky())continue;let Ge=be?(Fe.is3D(y)?ne:q)[be.id]:void 0;this._renderTileClippingMasks(Fe,be,Ge),this.renderLayer(this,be,Fe,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,be,Fe,be?q[be.id]:void 0)}function Ce(Fe,be){let Ge;return be&&(Ge=(Fe.type==="symbol"?ee:Fe.is3D(y)?ne:q)[be.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){let Fe=N[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){let be=o.getLayerSourceCache(Fe);this.renderLayer(this,be,Fe,Ce(Fe,be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;fe&&(Be=fe.getShadowCastingLayerCount());let Ue=!1,Ye=-1;for(let Fe=0;Fe<w.length;++Fe){let be=N[Fe];be.isHidden(this.transform.zoom)||be.is3D(y)&&(Ye=Fe)}M&&Ye===-1&&(S=!0);let dt=!1;for(;this.currentLayer<w.length;){let Fe=N[this.currentLayer],be=o.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&Fe.is3D(y)&&!y){let Ge=this.currentLayer,Le=tt=>{for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){let bt=N[this.currentLayer];if(ia[bt.type]){let At=this.style.getLayerSourceCache(bt);ia[bt.type](this,At,bt,Ce(bt,At),tt)}}};Le("initialize"),Le("reset"),this.currentLayer=Ge,dt=!0}if(S&&!Ue&&this.terrain&&!this.transform.isOrthographic&&(Ue=!0,this.blitDepth()),M&&Ye!==-1&&this.currentLayer===Ye+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,be,be?Z[be.id]:void 0),this.renderLayer(this,be,Fe,Ce(Fe,be)),!this.terrain&&fe&&Be>0&&Fe.hasShadowPass()&&--Be==0){{this.clearStencil(),this.resetStencilClippingMasks();let Ge=this.currentLayer;for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){let Le=N[this.currentLayer];if(dg[Le.type]){let tt=this.style.getLayerSourceCache(Le);dg[Le.type](this,tt,Le,Ce(Le,tt))}}this.currentLayer=Ge}if(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){let Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){let Le=N[this.currentLayer];if(!Le.hasLightBeamPass())continue;let tt=o.getLayerSourceCache(Le);this.renderLayer(this,tt,Le,tt?q[tt.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Ge=this.currentLayer;this.depthOcclusion=!0;for(let Le of this.layersWithOcclusionOpacity){this.currentLayer=Le;let tt=N[this.currentLayer],bt=o.getLayerSourceCache(tt),At=bt?q[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(tt,bt,bt?Z[bt.id]:void 0),this.renderLayer(this,bt,tt,At)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;N.forEach(be=>{let Ge=o.getLayerSourceCache(be);Ge&&!be.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Ge.getSource().maxzoom)&&(Fe=Ge)}),Fe&&this.options.showTileBoundaries&&gt(this,Fe,Fe.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Fe){let be=Fe.transform.padding;pd(Fe,Fe.transform.height-(be.top||0),3,g1),pd(Fe,be.bottom||0,3,_1),gr(Fe,be.left||0,3,v1),gr(Fe,Fe.transform.width-(be.right||0),3,dd);let Ge=Fe.transform.centerPoint;(function(Le,tt,bt,At){Oe(Le,tt-1,bt-10,2,20,At),Oe(Le,tt-10,bt-1,20,2,At)})(Fe,Ge.x,Fe.transform.height-Ge.y,hd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:c}=this.transform.projection,f=!c||!c.includes(o.type);if(ug[o.type]&&(f||this.terrain&&o.type==="custom")){let _=this.style.getLayerSourceCache(o);ug[o.type](o,_,this)}this.gpuTimingEnd()}renderLayer(o,c,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(f.type)&&(!o.terrain||f.type!=="custom")||f.type==="clip"||su[f.type](o,c,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,f=this.context.gl,_=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,c=this.context.gl,f=c.createQuery();this.deferredRenderGpuTimeQueries.push(f),c.beginQuery(o.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let c={};for(let f in o){let _=o[f],y=this.context.extTimerQuery,x=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),c[f]=x}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.gl,f=0;for(let _ of o)f+=c.getQueryParameter(_,c.QUERY_RESULT)/1e6,c.deleteQuery(_);return f}translatePosMatrix(o,c,f,_,y){if(!f[0]&&!f[1])return o;let x=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(x){let M=Math.sin(x),A=Math.cos(x);f=[f[0]*A-f[1]*M,f[0]*M+f[1]*A]}let w=[y?f[0]:r.ay(c,f[0],this.transform.zoom),y?f[1]:r.ay(c,f[1],this.transform.zoom),0],S=new Float32Array(16);return r.br(S,o,w),S}saveTileTexture(o){if(o.context!==this.context)return;let c=o.size[0],f=this._tileTextures[c];f?f.push(o):this._tileTextures[c]=[o]}getTileTexture(o){let c=this._tileTextures[o];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,c,f){let _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||c!==void 0&&!c||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(o,c){this.cache=this.cache||{};let f=c&&c.defines||[],_=c&&c.config,y=this.currentGlobalDefines(o,c&&c.overrideFog,c&&c.overrideRtt).concat(f),x=e1.cacheKey(H0[o],o,y,_);return this.cache[x]||(this.cache[x]=new e1(this.context,o,H0[o],_,Ym[o],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,c){if(this.style.enable3dLights()){let f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){let y=((x,w,S)=>{let M=x.properties.get("direction"),A=x.properties.get("color-use-theme")==="none",L=x.properties.get("color").toNonPremultipliedRenderColor(A?null:S.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),N=w.properties.get("color-use-theme")==="none",j=w.properties.get("color").toNonPremultipliedRenderColor(N?null:S.getLut(w.scope)).toArray01(),U=w.properties.get("intensity"),Z=[M.x,M.y,M.z],q=r.dN(j,U),ee=r.dN(L,F);return{u_lighting_ambient_color:q,u_lighting_directional_dir:Z,u_lighting_directional_color:ee,u_ground_radiance:ah(Z,ee,q)}})(f,_,this.style);c.setLightsUniformValues(o,y)}}}uploadCommonUniforms(o,c,f,_,y){if(this.uploadCommonLightUniforms(o,c),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let w=x.getOpacity(this.transform.pitch),S=((M,A,L,F,N,j,U,Z,q,ee,re,ne)=>{let ge=M.transform,de=A.properties.get("color-use-theme")==="none",fe=A.properties.get("color").toNonPremultipliedRenderColor(de?null:M.style.getLut(A.scope)).toArray01();fe[3]=F;let ue=M.frameCounter/1e3%1,[ae,_e]=A.properties.get("vertical-range");return{u_fog_matrix:L?ge.calculateFogTileMatrix(L):ne||M.identityMat,u_fog_range:A.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ae,_e),_e],u_fog_temporal_offset:ue,u_frustum_tl:N,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:Z,u_globe_pos:q,u_globe_radius:ee,u_viewport:re,u_globe_transition:r.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,f,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],_);c.setFogUniformValues(o,S)}y&&c.setCutoffUniformValues(o,y.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let _ of f)c[_.key]=o[_.key]||new td(_,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,c){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[o.key];return c||(this._cachedTileFogOpacities[o.key]=c=this.style.fog.getOpacityForTile(o)),c[0]>=Xe||c[1]>=Xe}setupDepthForOcclusion(o,c,f){let _=this.context,y=_.gl,x=!!f;var w;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),x||c.setTerrainUniformValues(_,f)}updateEmissiveMode(){if(this._forceEmissiveMode)return;let o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function pg(p,o){let c=!1,f=null,_=()=>{f=null,c&&(p(),f=setTimeout(_,o),c=!1)};return()=>(c=!0,f||_(),f)}class xv{constructor(o){this._hashName=o&&encodeURIComponent(o),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pg(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let c=Kr(o);if(this._hashName){let f=this._hashName,_=!1,y=location.hash.slice(1).split("&").map(x=>{let w=x.split("=")[0];return w===f?(_=!0,`${w}=${c}`):x}).filter(x=>x);return _||y.push(`${f}=${c}`),`#${y.join("&")}`}return`#${c}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(Number(f)))){let f=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kr(p,o){let c=p.getCenter(),f=Math.round(100*p.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),x=Math.round(c.lng*y)/y,w=Math.round(c.lat*y)/y,S=p.getBearing(),M=p.getPitch(),A=o?`/${x}/${w}/${f}`:`${f}/${w}/${x}`;return(S||M)&&(A+="/"+Math.round(10*S)/10),M&&(A+=`/${Math.round(M)}`),A}let fh={linearity:.3,easing:r.eT(0,0,.3,1)},bv=Object.assign({deceleration:2500,maxSpeed:1400},fh),wv=Object.assign({deceleration:20,maxSpeed:1400},fh),_d=Object.assign({deceleration:1e3,maxSpeed:360},fh),Cv=Object.assign({deceleration:1e3,maxSpeed:90},fh);class Ev{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,c=r.o.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)c.zoom+=y.zoomDelta||0,c.bearing+=y.bearingDelta||0,c.pitch+=y.pitchDelta||0,y.panDelta&&c.pan._add(y.panDelta),y.around&&(c.around=y.around),y.pinchAround&&(c.pinchAround=y.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){let y=Sl(c.pan.mag(),f,Object.assign({},bv,o||{}));_.offset=c.pan.mult(y.amount/c.pan.mag()),_.center=this._map.transform.center,mh(_,y)}if(c.zoom){let y=Sl(c.zoom,f,wv);_.zoom=this._map.transform.zoom+y.amount,mh(_,y)}if(c.bearing){let y=Sl(c.bearing,f,_d);_.bearing=this._map.transform.bearing+r.aA(y.amount,-179,179),mh(_,y)}if(c.pitch){let y=Sl(c.pitch,f,Cv);_.pitch=this._map.transform.pitch+y.amount,mh(_,y)}if(_.zoom||_.bearing){let y=c.pinchAround===void 0?c.around:c.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function mh(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function Sl(p,o,c){let{maxSpeed:f,linearity:_,deceleration:y}=c,x=r.aA(p*_/(o/1e3),-f,f),w=Math.abs(x)/(y*_);return{easing:c.easing,duration:1e3*w,amount:x*(w/2)}}class As extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f,_={}){let y=Or(c.getCanvasContainer(),f),x=c.unproject(y);super(o,Object.assign({point:y,lngLat:x,originalEvent:f},_)),this._defaultPrevented=!1,this.target=c}}class au extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){let _=o==="touchend"?f.changedTouches:f.touches,y=qo(c.getCanvasContainer(),_),x=y.map(S=>c.unproject(S)),w=y.reduce((S,M,A,L)=>S.add(M.div(L.length)),new r.P(0,0));super(o,{points:y,point:w,lngLats:x,lngLat:c.unproject(w),originalEvent:f}),this._defaultPrevented=!1}}class Sv extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class fg{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Sv(this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new As(o.type,this._map,o))}mouseup(o){this._map.fire(new As(o.type,this._map,o))}preclick(o){let c=new MouseEvent("preclick",o);this._map.fire(new As(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new As(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new As(o.type,this._map,o))}mouseover(o){this._map.fire(new As(o.type,this._map,o))}mouseout(o){this._map.fire(new As(o.type,this._map,o))}touchstart(o){return this._firePreventable(new au(o.type,this._map,o))}touchmove(o){this._map.fire(new au(o.type,this._map,o))}touchend(o){this._map.fire(new au(o.type,this._map,o))}touchcancel(o){this._map.fire(new au(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new As(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new As("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new As(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mg{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(Vn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;let f=c,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ke("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let x=Math.min(_.x,f.x),w=Math.max(_.x,f.x),S=Math.min(_.y,f.y),M=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${S}px)`,this._box.style.width=w-x+"px",this._box.style.height=M-S+"px")})}mouseupWindow(o,c){if(!this._active)return;let f=this._startPos,_=c;if(f&&o.button===0){if(this.reset(),Ni(),f.x!==_.x||f.y!==_.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:o})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),sr(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new r.z(o,{originalEvent:c}))}}function gg(p,o){let c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=o[f];return c}class M1{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=(function(_){let y=new r.P(0,0);for(let x of _)y._add(x);return y.div(_.length)})(c),this.touches=gg(f,c)))}touchmove(o,c,f){if(this.aborted||!this.centroid)return;let _=gg(f,c);for(let y in this.touches){let x=_[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(o,c,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class _g{constructor(o){this.singleTap=new M1(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,f){this.singleTap.touchstart(o,c,f)}touchmove(o,c,f){this.singleTap.touchmove(o,c,f)}touchend(o,c,f){let _=this.singleTap.touchend(o,c,f);if(_){let y=o.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(_)<30;if(y&&x||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class D1{constructor(){this._zoomIn=new _g({numTouches:1,numTaps:2}),this._zoomOut=new _g({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,f){this._zoomIn.touchstart(o,c,f),this._zoomOut.touchstart(o,c,f)}touchmove(o,c,f){this._zoomIn.touchmove(o,c,f),this._zoomOut.touchmove(o,c,f)}touchend(o,c,f){let _=this._zoomIn.touchend(o,c,f),y=this._zoomOut.touchend(o,c,f);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(_)},{originalEvent:o})}):y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let A1={0:1,2:2},Iv={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class vg{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;let f=Ks(o);this._correctButton(o,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(o,c){let f=this._lastPoint;if(f){if(o.preventDefault(),this._eventButton!=null&&(function(_,y){let x=A1[y];return _.buttons===void 0||(_.buttons&x)!==x})(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(o){this._lastPoint&&Ks(o)===this._eventButton&&(this._moved&&Ni(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class P1 extends vg{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Mv extends vg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Iv[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=.8*(c.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Dv extends vg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Iv[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){let f=-.5*(c.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class O1{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,c,f){return this._calculateTransform(o,c,f)}touchmove(o,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,f)}}touchend(o,c,f){this._calculateTransform(o,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,f){f.length>0&&(this._active=!0);let _=gg(f,c),y=new r.P(0,0),x=new r.P(0,0),w=0;for(let M in _){let A=_[M],L=this._touches[M];L&&(y._add(A),x._add(A.sub(L)),w++,_[M]=A)}if(this._touches=_,w<this._minTouches||!x.mag())return;let S=x.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(w),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ke("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class yg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,f){return{}}touchstart(o,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,f){let _=this._firstTwoTouches;if(!_)return;o.preventDefault();let[y,x]=_,w=$p(f,c,y),S=$p(f,c,x);if(!w||!S)return;let M=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],M,o)}touchend(o,c,f){if(!this._firstTwoTouches)return;let[_,y]=this._firstTwoTouches,x=$p(f,c,_),w=$p(f,c,y);x&&w||(this._active&&Ni(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $p(p,o,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return o[f]}function R1(p,o){return Math.log2(p/o)}class pI extends yg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){let f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(R1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:R1(this._distance,f),pinchAround:c}}}function k1(p,o){return 180*p.angleWith(o)/Math.PI}class nr extends yg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){let f=this._vector;if(this._vector=o[0].sub(o[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:k1(this._vector,f),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let _=k1(o,f);return Math.abs(_)<c}}function xg(p){return Math.abs(p.y)>Math.abs(p.x)}class fI extends yg{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,xg(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,f){let _=this._lastPoints;if(!_)return;let y=o[0].sub(_[0]),x=o[1].sub(_[1]);return this._map._cooperativeGestures&&!r.eU()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,f.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(o,c,f){if(this._valid!==void 0)return this._valid;let _=o.mag()>=2,y=c.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let x=o.y>0==c.y>0;return xg(o)&&xg(c)&&x}}let mI={panStep:100,bearingStep:15,pitchStep:10};class gI{constructor(){let o=mI;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,f=0,_=0,y=0,x=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),y=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),y=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),x=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:w=>{let S=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Hp,zoom:c?Math.round(S)+c*(o.shiftKey?2:1):S,bearing:w.getBearing()+f*this._bearingStep,pitch:w.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hp(p){return p*(2-p)}let Av=4.000244140625,Pv=1/450;class bg{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Pv,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,f=r.o.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%Av==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=Or(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>Av?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);let L=c(),F=Math.pow(2,L),N=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(N*A))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,y=this._easing,x,w=!1;if(this._type==="wheel"&&_&&y){let M=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),A=y(M);x=r.ak(_,f,A),M<1?this._frameId||(this._frameId=!0):w=!0}else x=f,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=x-c();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=r.eV;if(this._prevEase){let f=this._prevEase,_=(r.o.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),x=.27/Math.sqrt(y*y+1e-4)*.01,w=Math.sqrt(.0729-x*x);c=r.eT(x,w,.25,1)}return this._prevEase={start:r.o.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ke("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class lc{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(){this._tap=new _g({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,c,f))}touchmove(o,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let _=c[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(o,c,f)}touchend(o,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(o,c,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl{constructor(o,c,f){this._el=o,this._mousePan=c,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gp{constructor(o,c,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cg{constructor(o,c,f,_){this._el=o,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let qp=p=>p.zoom||p.drag||p.pitch||p.rotate;class _I extends r.z{}class Wp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){let f=r.av([],c,o);this.radius=r.ag(f[2]<0?r.eX([],f,this.constants):[f[0],f[1],0])}projectRay(o){r.eX(o,o,this.constants),r.aw(o,o),r.eY(o,o,this.constants);let c=r.c5([],o,this.radius);if(c[2]>0){let f=r.c5([],[0,0,1],r.bJ(c,[0,0,1])),_=r.c5([],r.aw([],[c[0],c[1],0]),this.radius),y=r.d8([],c,r.c5([],r.av([],r.d8([],_,f),c),2));c[0]=y[0],c[1]=y[1]}return c}}function Eg(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class vI{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ev(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.aY(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,y,x]of this._listeners){let w=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,w,x)}}destroy(){for(let[o,c,f]of this._listeners){let _=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(c,_,f)}}_addDefaultHandlers(o){let c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new fg(c,o));let _=c.boxZoom=new mg(c,o);this._add("boxZoom",_);let y=new D1,x=new wg;c.doubleClickZoom=new lc(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let w=new Qr;this._add("tapDragZoom",w);let S=c.touchPitch=new fI(c);this._add("touchPitch",S);let M=new Mv(o),A=new Dv(o);c.dragRotate=new Gp(o,M,A),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);let L=new P1(o),F=new O1(c,o);c.dragPan=new Tl(f,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]);let N=new nr,j=new pI;c.touchZoomRotate=new Cg(f,j,N,w),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Tv(c));let U=c.scrollZoom=new bg(c,this);this._add("scrollZoom",U,["mousePan"]);let Z=c.keyboard=new gI;this._add("keyboard",Z);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[q]&&c[q].enable(o[q])}_add(o,c,f){this._handlers.push({handlerName:o,handler:c,allowed:f}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,f){for(let _ in o)if(_!==f&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let c=[];for(let f of o)this._el.contains(f.target)&&c.push(f);return c}handleEvent(o,c){this._updatingCamera=!0;let f=o.type==="renderFrame",_=f?void 0:o,y={needsRenderFrame:!1},x={},w={},S=o.touches?this._getMapTouches(o.touches):void 0,M=S?qo(this._el,S):f?void 0:Or(this._el,o);for(let{handlerName:F,handler:N,allowed:j}of this._handlers){if(!N.isEnabled())continue;let U;this._blockedByActive(w,j,F)?N.reset():N[c||o.type]&&(U=N[c||o.type](o,M,S),this.mergeHandlerResult(y,x,U,F,_),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||N.isActive())&&(w[F]=N)}let A={};for(let F in this._previousActiveHandlers)w[F]||(A[F]=_);this._previousActiveHandlers=w,(Object.keys(A).length||Eg(y))&&(this._changes.push([y,x,A]),this._triggerRenderFrame()),(Object.keys(w).length||Eg(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:L}=y;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(o,c,f,_,y){if(!f)return;Object.assign(o,f);let x={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(c.zoom=x),f.panDelta!==void 0&&(c.drag=x),f.pitchDelta!==void 0&&(c.pitch=x),f.bearingDelta!==void 0&&(c.rotate=x)}_applyChanges(){let o={},c={},f={};for(let[_,y,x]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),Object.assign(c,y),Object.assign(f,x);this._updateMapTransform(o,c,f),this._changes=[]}_updateMapTransform(o,c,f){let _=this._map,y=_.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{let re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Eg(o)){let ee=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ee!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!Eg(o))return void this._fireEvents(c,f,!0);let{panDelta:w,zoomDelta:S,bearingDelta:M,pitchDelta:A,around:L,aroundCoord:F,pinchAround:N}=o;y._isCameraConstrained&&(S>0&&(S=0),y._isCameraConstrained=!1),N!==void 0&&(L=N),(S||(ee=>c[ee]&&!this._eventsInProgress[ee])("drag"))&&L&&(this._dragOrigin=x(y.pointCoordinate3D(L)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),L=L||_.transform.centerPoint,M&&(y.bearing+=M),A&&(y.pitch+=A),y._updateCameraState();let j=[0,0,0];if(w)if(y.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L).dir),re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L.sub(w)).dir);j[0]=re[0]-ee[0],j[1]=re[1]-ee[1]}else{let ee=y.pointCoordinate(L);if(y.projection.name==="globe"){w=w.rotate(-y.angle);let re=y._pixelsPerMercatorPixel/y.worldSize;j[0]=-w.x*r.eW(r.a$(ee.y))*re,j[1]=-w.y*r.eW(y.center.lat)*re}else{let re=y.pointCoordinate(L.sub(w));ee&&re&&(j[0]=re.x-ee.x,j[1]=re.y-ee.y)}}let U=y.zoom,Z=[0,0,0];if(S){let ee=x(F||y.pointCoordinate3D(L)),re={dir:r.aw([],r.av([],ee,y._camera.position))};if(re.dir[2]<0){let ne=y.zoomDeltaToMovement(ee,S);r.c5(Z,re.dir,ne)}}let q=r.d8(j,j,Z);y._translateCameraConstrained(q),S&&Math.abs(y.zoom-U)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,f,!0)}_fireEvents(o,c,f){let _=qp(this._eventsInProgress),y=qp(o),x={};for(let A in o){let{originalEvent:L}=o[A];this._eventsInProgress[A]||(x[`${A}start`]=L),this._eventsInProgress[A]=o[A]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(let A in x)this._fireEvent(A,x[A]);y&&this._fireEvent("move",y.originalEvent);for(let A in o){let{originalEvent:L}=o[A];this._fireEvent(A,L)}let w={},S;for(let A in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[A];this._handlersById[L].isActive()||(delete this._eventsInProgress[A],S=c[L]||F,w[`${A}end`]=S)}for(let A in w)this._fireEvent(A,w[A]);let M=qp(this._eventsInProgress);if(f&&(_||y)&&!M){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;A?(L(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:S})):(this._map.fire(new r.z("moveend",{originalEvent:S})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new r.z(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new _I("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Sg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ov extends r.E{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,f){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},c),f)}panTo(o,c,f){return this.easeTo(Object.assign({center:o},c),f)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,f){return this.easeTo(Object.assign({zoom:o},c),f)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,f){return this.easeTo(Object.assign({bearing:o},c),f)}resetNorth(o,c){return this.rotateTo(0,Object.assign({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=r.aI.convert(o);let f=c&&c.bearing||0,_=c&&c.pitch||0,y=o.getNorthWest(),x=o.getSouthEast();return this._cameraForBounds(this.transform,y,x,f,_,c)}_extendPadding(o){let c={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},c,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},c,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,c){let f=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return f/_>o.aspect?f/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,f,_,y,x){let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=r.aT.convert(c),A=r.aT.convert(f),L=.5*(M.lat+A.lat),F=.5*(M.lng+A.lng),N=r.eZ(L,F),j=r.aw([],N),U=r.aw([],r.bI([],j,[0,1,0])),Z=r.bI([],U,j),q=[U[0],U[1],U[2],0,Z[0],Z[1],Z[2],0,j[0],j[1],j[2],0,0,0,0,1],ee=[N,r.eZ(M.lat,M.lng),r.eZ(A.lat,M.lng),r.eZ(A.lat,A.lng),r.eZ(M.lat,A.lng),r.eZ(L,M.lng),r.eZ(L,A.lng),r.eZ(M.lat,F),r.eZ(A.lat,F)],re=r.d9.fromPoints(ee.map(Le=>[r.bJ(U,Le),r.bJ(Z,Le),r.bJ(j,Le)])),ne=r.af([],re.center,q);r.e_(ne)===0&&r.e$(ne,0,0,1),r.aw(ne,ne),r.c5(ne,ne,r.aD),w.center=r.f0(ne);let ge=w.getWorldToCameraMatrix(),de=r.bl(new Float64Array(16),ge);re=r.d9.applyTransform(re,r.aB([],ge,q));let fe=this._extendAABB(re,w,S,_);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=fe,r.af(ne,ne,ge);let ue=.5*(re.max[2]-re.min[2]),ae=this._minimumAABBFrustumDistance(w,re),_e=r.c5([],[0,0,1],ue),De=r.d8(_e,ne,_e),Ce=ae+(w.pitch===0?0:r.bG(ne,De)),Be=w.globeCenterInViewSpace,Ue=r.av([],ne,[Be[0],Be[1],Be[2]]);r.aw(Ue,Ue),r.c5(Ue,Ue,Ce);let Ye=r.d8([],ne,Ue);r.af(Ye,Ye,de);let dt=r.eM/r.aD,Fe=r.ag(Ye),be=r.cf(Math.max(Fe*dt-r.eM,Number.EPSILON),0),Ge=Math.min(w.zoomFromMercatorZAdjusted(be),S.maxZoom);return Ge>.5*(r.c_+r.cL)?(w.setProjection({name:"mercator"}),w.zoom=Ge,this._cameraForBounds(w,c,f,_,y,x)):{center:w.center,zoom:Ge,bearing:_,pitch:y}}_extendAABB(o,c,f,_){let y=.5*((f.padding.left||0)+(f.padding.right||0)),x=.5*((f.padding.top||0)+(f.padding.bottom||0)),w=x,S=y,M=y,A=x,L=c.width-(S+M),F=c.height-(w+A),N=r.av([],o.max,o.min),j=Math.min(L/N[0],F/N[1]),U=Math.min(c.scaleZoom(c.scale*j),f.maxZoom);if(isNaN(U))return null;let Z=c.scale/c.zoomScale(U),q=new r.d9([o.min[0]-S*Z,o.min[1]-A*Z,o.min[2]],[o.max[0]+M*Z,o.max[1]+w*Z,o.max[2]]),ee=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new r.P(f.offset.x,f.offset.y):r.P.convert(f.offset)).rotate(-r.an(_));return q.center[0]-=ee.x*Z,q.center[1]+=ee.y*Z,q}queryTerrainElevation(o,c){let f=this.transform.elevation;return f?(c=Object.assign({},{exaggerated:!0},c),f.getAtPoint(r.ae.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,f,_,y,x){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,f,_,y,x);let w=o.clone(),S=this._extendCameraOptions(x);w.bearing=_,w.pitch=y;let M=r.aT.convert(c),A=r.aT.convert(f),L=new r.aT(M.lng,A.lat),F=new r.aT(A.lng,M.lat),N=w.project(M),j=w.project(A),U=this.queryTerrainElevation(M),Z=this.queryTerrainElevation(A),q=this.queryTerrainElevation(L),ee=this.queryTerrainElevation(F),re=[[N.x,N.y,Math.min(U||0,Z||0,q||0,ee||0)],[j.x,j.y,Math.max(U||0,Z||0,q||0,ee||0)]],ne=r.d9.fromPoints(re),ge=w.getWorldToCameraMatrix(),de=r.bl(new Float64Array(16),ge);ne=r.d9.applyTransform(ne,ge);let fe=this._extendAABB(ne,w,S,_);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=fe;let ue=.5*r.av([],ne.max,ne.min)[2],ae=this._minimumAABBFrustumDistance(w,ne),_e=[0,0,1,0];r.aC(_e,_e,ge),r.f1(_e,_e);let De=r.c5([],_e,ae+ue),Ce=r.d8([],ne.center,De);r.af(ne.center,ne.center,de),r.af(Ce,Ce,de);let Be=w.unproject(new r.P(ne.center[0],ne.center[1])),Ue=r.f2(w.projection,Be),Ye=Math.pow(2,Ue),dt=Math.min(w._zoomFromMercatorZ(Ce[2]*w.pixelsPerMeter*Ye/w.worldSize),S.maxZoom);return w.mercatorFromTransition&&dt<.5*(r.c_+r.cL)?(w.setProjection({name:"globe"}),w.zoom=dt,this._cameraForBounds(w,c,f,_,y,x)):{center:Be,zoom:dt,bearing:_,pitch:y}}fitBounds(o,c,f){let _=this.cameraForBounds(o,c);return this._fitInternal(_,c,f)}fitScreenCoordinates(o,c,f,_,y){let x=r.P.convert(o),w=r.P.convert(c),S=new r.P(Math.min(x.x,w.x),Math.min(x.y,w.y)),M=new r.P(Math.max(x.x,w.x),Math.max(x.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,w))return this;let A=this.transform.pointLocation3D(S),L=this.transform.pointLocation3D(M),F=this.transform.pointLocation3D(new r.P(S.x,M.y)),N=this.transform.pointLocation3D(new r.P(M.x,S.y)),j=[Math.min(A.lng,L.lng,F.lng,N.lng),Math.min(A.lat,L.lat,F.lat,N.lat)],U=[Math.max(A.lng,L.lng,F.lng,N.lng),Math.max(A.lat,L.lat,F.lat,N.lat)],Z=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,j,U,f,Z,_);return this._fitInternal(q,_,y)}_fitInternal(o,c,f){return o?(c=Object.assign(o,c)).linear?this.easeTo(c,f):this.flyTo(c,f):this}jumpTo(o,c){this.stop();let f=o.preloadOnly?this.transform.clone():this.transform,_=!1,y=!1,x=!1;"zoom"in o&&f.zoom!==+o.zoom&&(_=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=r.aT.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(y=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(x=!0,f.pitch=+o.pitch);let w=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!f.isPaddingEqual(w))if(o.retainPadding===!1){let S=f.clone();S.padding=w,f.setLocationAtPoint(f.center,S.centerPoint)}else f.padding=w;return o.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),_&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),y&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),x&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Sg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){let f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(Sg),this;this.stop();let _=f.zoom,y=f.pitch,x=f.bearing;f.setFreeCameraOptions(o);let w=_!==f.zoom,S=y!==f.pitch,M=x!==f.bearing;return this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),w&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),M&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),S&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:r.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?+o.zoom:_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,L=this._extendPadding(o.padding),F=r.P.convert(o.offset),N,j,U;if(f.projection.name==="globe"){let _e=r.ae.fromLngLat(f.center),De=F.rotate(-f.angle);_e.x+=De.x/f.worldSize,_e.y+=De.y/f.worldSize;let Ce=_e.toLngLat(),Be=r.aT.convert(o.center||Ce);this._normalizeCenter(Be),N=f.centerPoint.add(De),j=new r.P(_e.x,_e.y).mult(f.worldSize),U=new r.P(r.aF(Be.lng),r.aJ(Be.lat)).mult(f.worldSize).sub(j)}else{N=f.centerPoint.add(F);let _e=f.pointLocation(N),De=r.aT.convert(o.center||_e);this._normalizeCenter(De),j=f.project(_e),U=f.project(De).sub(j)}let Z=f.zoomScale(S-_),q,ee;o.around&&(q=r.aT.convert(o.around),ee=f.locationPoint(q));let re=this._zooming||S!==_,ne=this._rotating||y!==M,ge=this._pitching||A!==x,de=!f.isPaddingEqual(L),fe=o.retainPadding===!1?f.clone():f,ue=_e=>De=>{if(re&&(_e.zoom=r.ak(_,S,De)),ne&&(_e.bearing=r.ak(y,M,De)),ge&&(_e.pitch=r.ak(x,A,De)),de&&(fe.interpolatePadding(w,L,De),N=fe.centerPoint.add(F)),q)_e.setLocationAtPoint(q,ee);else{let Ce=_e.zoomScale(_e.zoom-_),Be=S>_?Math.min(2,Z):Math.max(.5,Z),Ue=Math.pow(Be,1-De),Ye=_e.unproject(j.add(U.mult(De*Ue)).mult(Ce));_e.setLocationAtPoint(_e.renderWorldCopies?Ye.wrap():Ye,N)}return o.preloadOnly||this._fireMoveEvents(c),_e};if(o.preloadOnly){let _e=this._emulate(ue,o.duration,f);return this._preloadTiles(_e),this}let ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ne,this._pitching=ge,this._padding=de,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,ae),this._ease(ue(f),_e=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(c,_e)},o),this}_prepareEase(o,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||f.moving||this.fire(new r.z("movestart",o)),this._zooming&&!f.zooming&&this.fire(new r.z("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new r.z("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new r.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.z("move",o)),this._zooming&&this.fire(new r.z("zoom",o)),this._rotating&&this.fire(new r.z("rotate",o)),this._pitching&&this.fire(new r.z("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new r.z("zoomend",o)),_&&this.fire(new r.z("rotateend",o)),y&&this.fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){let Le=r.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Le,c)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eV},o);let f=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in o?r.aA(+o.zoom,f.minZoom,f.maxZoom):_,M="bearing"in o?this._normalizeBearing(o.bearing,y):y,A="pitch"in o?+o.pitch:x,L=this._extendPadding(o.padding),F=f.zoomScale(S-_),N=r.P.convert(o.offset),j=f.centerPoint.add(N),U=f.pointLocation(j),Z=r.aT.convert(o.center||U);this._normalizeCenter(Z);let q=f.project(U),ee=f.project(Z).sub(q),re=o.curve,ne=Math.max(f.width,f.height),ge=ne/F,de=ee.mag();if("minZoom"in o){let Le=r.aA(Math.min(o.minZoom,_,S),f.minZoom,f.maxZoom),tt=ne/f.zoomScale(Le-_);re=Math.sqrt(tt/de*2)}let fe=re*re;function ue(Le){let tt=(ge*ge-ne*ne+(Le?-1:1)*fe*fe*de*de)/(2*(Le?ge:ne)*fe*de);return Math.log(Math.sqrt(tt*tt+1)-tt)}function ae(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function _e(Le){return(Math.exp(Le)+Math.exp(-Le))/2}let De=ue(0),Ce=function(Le){return _e(De)/_e(De+re*Le)},Be=function(Le){return ne*((_e(De)*(ae(tt=De+re*Le)/_e(tt))-ae(De))/fe)/de;var tt},Ue=(ue(1)-De)/re;if(Math.abs(de)<1e-6||!isFinite(Ue)){if(Math.abs(ne-ge)<1e-6)return this.easeTo(o,c);let Le=ge<ne?-1:1;Ue=Math.abs(Math.log(ge/ne))/re,Be=function(){return 0},Ce=function(tt){return Math.exp(Le*re*tt)}}o.duration="duration"in o?+o.duration:1e3*Ue/("screenSpeed"in o?+o.screenSpeed/re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let Ye=y!==M,dt=A!==x,Fe=!f.isPaddingEqual(L),be=o.retainPadding===!1?f.clone():f,Ge=Le=>tt=>{let bt=tt*Ue,At=1/Ce(bt);Le.zoom=tt===1?S:_+Le.scaleZoom(At),Ye&&(Le.bearing=r.ak(y,M,tt)),dt&&(Le.pitch=r.ak(x,A,tt)),Fe&&(be.interpolatePadding(w,L,tt),j=be.centerPoint.add(N));let _t=tt===1?Z:Le.unproject(q.add(ee.mult(Be(bt))).mult(At));return Le.setLocationAtPoint(Le.renderWorldCopies?_t.wrap():_t,j),Le._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Le};if(o.preloadOnly){let Le=this._emulate(Ge,o.duration,f);return this._preloadTiles(Le),this}return this._zooming=!0,this._rotating=Ye,this._pitching=dt,this._padding=Fe,this._prepareEase(c,!1),this._ease(Ge(f),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!o){let f=this.handlers;f&&f.stop(!1)}return this}_ease(o,c,f){f.animate===!1||f.duration===0?(o(1),c()):(this._easeStart=r.o.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=r.bT(o,-180,180);let f=Math.abs(o-c);return Math.abs(o-360-c)<f&&(o-=360),Math.abs(o+360-c)<f&&(o+=360),o}_normalizeCenter(o){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let f=o.lng-c.center.lng;o.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,f){let _=Math.ceil(15*c/1e3),y=[],x=o(f.clone());for(let w=0;w<=_;w++){let S=x(w/_);y.push(S.clone())}return y}_preloadTiles(o,c){}}class Zp{constructor(o={}){this.options=o,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let c=this.options&&this.options.compact,f=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ke("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let _=ke("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=ke("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(o){let f=c.reduce((_,y,x)=>(y.value&&(_+=`${y.key}=${y.value}${x<c.length-1?"&":""}`),_),"?");o.href=`${r.e.FEEDBACK_URL}/${f}#${Kr(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let c=this._map.style._mergedSourceCaches;for(let _ in c){let y=c[_];if(y.used){let x=y.getSource();x.attribution&&o.indexOf(x.attribution)<0&&o.push(x.attribution)}}o.sort((_,y)=>_.length-y.length),o=o.filter((_,y)=>{for(let x=y+1;x<o.length;x++)if(o[x].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let f=o.map(_=>(function(y){let x=new DOMParser().parseFromString(y,"text/html");return Array.from(x.body.querySelectorAll("*")).forEach(w=>{let S=w.textContent||"";if(w.tagName!=="A")return void w.replaceWith(x.createTextNode(S));let M=w.getAttribute("href");if(!M||!/^(https?:|mailto:)/i.test(M))return void w.replaceWith(x.createTextNode(S));let A=x.createElement("a");A.href=M,A.textContent=S,A.rel="noopener nofollow";let L=w.getAttribute("class");L&&(A.className=L),w.replaceWith(A)}),x.body.innerHTML})(_)).join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yp{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=ke("div","mapboxgl-ctrl");let c=ke("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let c in o){let f=o[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class gh{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(o,c){let f=ke("button",o,this._container);return f.type="button",f.addEventListener("click",c),f}_createSeparator(){return ke("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,c){this._map&&(o.setAttribute("aria-label",c),o.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");let c=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(f=>f.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){let o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{let c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});ke("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){let o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,c){for(let f=0;f<o.length;f++){let _=o[f],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(y,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&c&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),f<o.length-1&&this._createSeparator()}}}class cc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){let c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(let _ of f)if(_.id===o)return void(_.cancelled=!0)}run(o=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let f of c)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class uc{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let c=r.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,f){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+f}}let dc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class lu extends r.z{constructor(o,c,f,_){let{point:y,lngLat:x,originalEvent:w,target:S}=o;super(o.type,{point:y,lngLat:x,originalEvent:w,target:S}),this.preventDefault=()=>{o.preventDefault()},this.id=c,this.interaction=f,this.feature=_}}class Ka{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,c){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);let f=c.filter,_=c.type;f&&this.filters.set(o,r.b6(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");let y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,c)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(o,c),this.typeById.set(o,_)}get(o){let c=this.typeById.get(o);if(!c)return;let f=this.interactionsByType.get(c);return f?f.get(o):void 0}remove(o){let c=this.typeById.get(o);if(!c)return;this.typeById.delete(o),this.filters.delete(o);let f=this.interactionsByType.get(c);f&&(f.delete(o),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(c,this.handleType))}queryTargets(o,c){let f=[];for(let[_,y]of c)y.target&&f.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(o,f,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let c=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());c.length&&(o.type="mouseenter",this.handleType(o,c));let f=new Map;for(let[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(y.id,y);f.size&&(o.type="mouseleave",this.handleType(o,Array.from(f.values())))}handleOut(o){let c=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);c.length&&(o.type="mouseleave",this.handleType(o,c)),this.hoveredFeatures.clear()}handleType(o,c){let f=o.type==="mouseenter";if(f&&!this.interactionsByType.has(o.type))return void r.w("mouseenter interaction required for mouseleave to work.");let _=Array.from(this.interactionsByType.get(o.type)).reverse(),y=!!c;c=c||this.queryTargets(o.point,_);let x=!1,w=new Set;for(let S of c){for(let[M,A]of _){if(!A.target)continue;let L=S.variants?S.variants[M]:null;if(L){for(let F of L){if(Zd(F,S,w,M))continue;let N=new r.dx(S,F),j=Ju(F,S,M);y&&N.id!==void 0&&(N.state=this.map.getFeatureState(N));let U=f?this.prevHoveredFeatures.get(j):null,Z=new lu(o,M,A,N),q=U?U.stop:A.handler(Z);if(f&&this.hoveredFeatures.set(j,{feature:S,stop:q}),q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[S,M]of _){let{handler:A,target:L}=M;if(!L&&A(new lu(o,S,M,null))!==!1)break}}}function yI(p,o){if(Array.isArray(p)&&Array.isArray(o)){let c=new Set(p),f=new Set(o);return c.size===f.size&&p.every(_=>f.has(_))}return r.by(p,o)}let xI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},bI={showCompass:!0,showZoom:!0,visualizePitch:!1};class wI{constructor(o,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Mv({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new Dv({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Vn()}move(o,c){let f=this.map,_=this.mouseRotate.mousemoveWindow(o,c),y=_&&_.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(o,c),w=x&&x.pitchDelta;w&&f.setPitch(f.getPitch()+w)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){sr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Or(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Or(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qo(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=qo(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Rv(p,o,c){if(p=new r.aT(p.lng,p.lat),o){let f=new r.aT(p.lng-360,p.lat),_=new r.aT(p.lng+360,p.lat),y=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),x=c.locationPoint3D(p).distSqr(o),w=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint3D(f).distSqr(o)<x&&(w||Math.abs(f.lng-c.center.lng)<y)?p=f:c.locationPoint3D(_).distSqr(o)<x&&(w||Math.abs(_.lng-c.center.lng)<y)&&(p=_)}for(;Math.abs(p.lng-c.center.lng)>180;){let f=c.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}let Ko={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Sa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Tg extends r.E{constructor(o,c){super(),(o instanceof HTMLElement||c)&&(o=Object.assign({element:o},c)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:f="center",color:_="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:w=0,rotation:S=Sa.rotation,rotationAlignment:M=Sa.rotationAlignment,pitchAlignment:A=Sa.pitchAlignment,occludedOpacity:L=Sa.occludedOpacity,altitude:F=Sa.altitude}=o||{};this._anchor=f,this._color=_,this._scale=y,this._draggable=x,this._clickTolerance=w,this._rotation=S,this._rotationAlignment=M,this._pitchAlignment=A,this._occludedOpacity=L,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",U=>{U.preventDefault()}),this._element.addEventListener("mousedown",U=>{U.preventDefault()});let N=this._element.classList;for(let U in Ko)N.remove(`mapboxgl-marker-anchor-${U}`);N.add(`mapboxgl-marker-anchor-${this._anchor}`);let j=o&&o.className?o.className.trim().split(/\s+/):[];N.add(...j),this._popup=null}_createDefaultMarker(){let o=ke("div"),c=ht("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){let f=ht("radialGradient",{id:"shadowGradient"},ht("defs",{},c));ht("stop",{offset:"10%","stop-opacity":.4},f),ht("stop",{offset:"100%","stop-opacity":.05},f),ht("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return ht("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),ht("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),ht("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Sa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let c=o.code,f=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(o){let c=o.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,c=this._pos;if(!o||!c)return!1;let f=o.unproject(c,this._altitude),_=o.getFreeCameraOptions();if(!_.position)return!1;let y=_.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();let f=o.unproject(c,this._altitude),_;o._showingGlobe()&&r.f5(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(f),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Ko[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let o=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!o||f!=="map")return"";if(!c._showingGlobe()){let S=c.getPitch();return S?`rotateX(${S}deg)`:""}let _=r.cX(r.f6(c.transform,this._lngLat)),y=o.sub(r.f7(c.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let w=_/x;return`rotateX(${-y.y*w}deg) rotateY(${y.x*w}deg)`}_calculateZTransform(){let o=this._pos,c=this._map;if(!c||!o)return"";let f=0,_=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){let y=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);f=r.cX(Math.atan2(x.y,x.x))-90}else f=-c.getBearing();else if(_==="horizon"){let y=r.ah(4,6,c.getZoom()),x=r.f7(c.transform);x.y+=y*c.transform.height;let w=o.sub(x),S=r.cX(Math.atan2(w.y,w.x));f=(S>90?S-270:S+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Rv(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let c=this._map;if(!c)return;let f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){let y=this._clickTolerance||c._clickTolerance;if(o.point.dist(f)<y)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(o){let c=this._map,f=this._pos;c&&f&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(f),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Sa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Sa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Sa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Sa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let CI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_h={maxWidth:100,unit:"metric"},kv={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ta={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ia=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vd(p=new r.P(0,0),o="bottom"){if(typeof p=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new r.P(0,p);case"top-left":return new r.P(c,c);case"top-right":return new r.P(-c,c);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(c,-c);case"bottom-right":return new r.P(-c,-c);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[o]||[0,0])}return{version:C,supported:$e.supported,setRTLTextPlugin:r.fb,getRTLTextPluginStatus:r.fa,Map:class extends Ov{constructor(p){k.mark(P.create);let o=p;if((p=Object.assign({},xI,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.f3(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new N0(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new cc,this._domRenderTaskQueue=new cc,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},dc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new uc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new ju(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){let c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new vI(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new xv(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Zp({customAttribution:p.customAttribution})),this._logoControl=new Yp,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new r.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new r.z(`${c.dataType}dataloading`,c))}),this._interactions=new Ka(this)}_getMapId(){return this._mapId}addControl(p,o){if(o===void 0&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=p.onAdd(this);this._controls.push(p);let f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new r.z("movestart",p)).fire(new r.z("move",p)),this.fire(new r.z("resize",p)),o&&this.fire(new r.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(o=>o==="auto"?navigator.language:o):p}setLanguage(p){let o=this._parseLanguage(p);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,o=p.projection.name,c;o==="globe"&&p.zoom>=r.cL?(p.setMercatorFromTransition(),c=!0):o==="mercator"&&p.zoom<r.cL&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,o){return this._updateProjection(p||o||{name:"mercator"})}_updateProjection(p){let o,c=this.transform.mercatorFromTransition;o=p.name==="globe"&&this.transform.zoom>=r.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();let f=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(o||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,o){return this.transform.locationPoint3D(r.aT.convert(p),o)}unproject(p,o){return this.transform.pointLocation3D(r.P.convert(p),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,o,c){let f=_=>{let y=[];if(Array.isArray(o)){let x=o.filter(w=>this.getLayer(w));y=x.length?this.queryRenderedFeatures(_,{layers:x}):[]}else y=this.queryRenderedFeatures(_,{target:o});return y};if(p==="mouseenter"||p==="mouseover"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:x=>{let w=f(x.point);w.length?_||(_=!0,c.call(this,new As(p,this,x.originalEvent,{features:w}))):_=!1},mouseout:()=>{_=!1}}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;return{listener:c,targets:o,delegates:{mousemove:w=>{f(w.point).length?_=!0:_&&(_=!1,c.call(this,new As(p,this,w.originalEvent)))},mouseout:w=>{_&&(_=!1,c.call(this,new As(p,this,w.originalEvent)))}}}}{let _=y=>{let x=f(y.point);x.length&&(y.features=x,c.call(this,y),delete y.features)};return{listener:c,targets:o,delegates:{[p]:_}}}}on(p,o,c){if(typeof o=="function"||c===void 0)return super.on(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(let _ in f.delegates)this.on(_,f.delegates[_]);return this}once(p,o,c){if(typeof o=="function"||c===void 0)return super.once(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._createDelegatedListener(p,o,c);for(let _ in f.delegates)this.once(_,f.delegates[_]);return this}off(p,o,c){if(typeof o=="function"||c===void 0)return super.off(p,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(_=>{for(let y=0;y<_.length;y++){let x=_[y];if(x.listener===c&&yI(x.targets,o)){for(let w in x.delegates)this.off(w,x.delegates[w]);return _.splice(y,1),this}}})(f),this}queryRenderedFeatures(p,o){if(!this.style)return[];if(p===void 0||p instanceof r.P||Array.isArray(p)||o!==void 0||(o=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!o){let y=this.style.queryRenderedFeatures(p,void 0,this.transform),x=this.style.queryRenderedFeatureset(p,void 0,this.transform);return y.concat(x)}let c=!0;if(o.target&&(c=this._isTargetValid(o.target),c&&!o.layers))return this.style.queryRenderedFeatureset(p,o,this.transform);let f=!0;if(o.layers&&Array.isArray(o.layers)){for(let y of o.layers)if(!this._isValidId(y)){f=!1;break}if(f&&!o.target)return this.style.queryRenderedFeatures(p,o,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(p,o,this.transform))),c&&(_=_.concat(this.style.queryRenderedFeatureset(p,o,this.transform))),_}querySourceFeatures(p,o){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,o)}queryRasterValue(p,o,c){return this._isValidId(p)?this.style.queryRasterValue(p,o,c):Promise.resolve(null)}isPointOnSurface(p){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}addInteraction(p,o){return this._interactions.add(p,o),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&p&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(p,(c,f)=>{if(c){let _=typeof c=="string"?c:c instanceof Error?c.message:c.error;r.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(p,o)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){let o=this._locale[p];if(o==null)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){let c=Object.assign({},o);o&&o.config&&(c.initialConfig=o.config,delete c.config),this.style=new Ea(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ea(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dr(p)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(let o of p)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(p)}addSource(p,o){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,o,{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();let w=r.I.from(p);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:S,height:M,data:A}=r.o.getImageData(o);this.style.addImage(w,{data:new r.q({width:S,height:M},A),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:S,height:M}=o,A=o;this.style.addImage(w,{data:new r.q({width:S,height:M},new Uint8Array(A.data)),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:f,usvg:!1,version:0,userImage:A}),A.onAdd&&A.onAdd(this,p)}}updateImage(p,o){this._lazyInitEmptyStyle();let c=r.I.from(p),f=this.style.getImage(c);if(!f)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.o.getImageData(o):o,{width:y,height:x,data:w}=_;if(y===void 0||x===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||x!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));let S=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap),M=!1;f.usvg?(f.data=new r.q({width:y,height:x},new Uint8Array(w)),f.usvg=!1,f.icon=void 0,M=!0):f.data.replace(w,S),this.style.updateImage(c,f,M)}hasImage(p){return p?!!this.style&&!!this.style.getImage(r.I.from(p)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(r.I.from(p))}loadImage(p,o){r.n(this._requestManager.transformRequest(p,r.R.Image),(c,f)=>{o(c,f instanceof HTMLImageElement?r.o.getImageData(f):f)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,o){this._lazyInitEmptyStyle(),this.style.addModel(p,o)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,o){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)):this}getSlot(p){let o=this.getLayer(p);return o&&o.slot||null}setSlot(p,o){return this.style.setSlot(p,o),this.style.mergeLayers(),this._update(!0)}addImport(p,o){return this.style.addImport(p,o).catch(c=>this.fire(new r.y(new Error("Failed to add import",c)))),this}updateImport(p,o){return typeof o!="string"&&o.id!==p?(this.removeImport(p),this.addImport(o)):(this.style.updateImport(p,o),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,o){return this.style.moveImport(p,o),this._update(!0)}moveLayer(p,o){return this._isValidId(p)?(this.style.moveLayer(p,o),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;let o=this.style.getOwnLayer(p);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,o,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,o,c),this._update(!0)):this}setFilter(p,o,c={}){return this._isValidId(p)?(this.style.setFilter(p,o,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,o,c,f),this._update(!0)):this}getPaintProperty(p,o){return this._isValidId(p)?this.style.getPaintProperty(p,o):null}setLayoutProperty(p,o,c,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,o,c,f),this._update(!0)):this}getLayoutProperty(p,o){return this._isValidId(p)?this.style.getLayoutProperty(p,o):null}setLayerProperty(p,o,c,f={}){return this._isValidId(p)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,o,c,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,o){return this.style.setSchema(p,o),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,o){return this.style.setConfig(p,o),this._update(!0)}getConfigProperty(p,o){return this.style.getConfigProperty(p,o)}setConfigProperty(p,o,c){return this.style.setConfigProperty(p,o,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let o=p[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,o),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aT.convert(p),this.transform):0}setFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,o),this._update())}removeFeatureState(p,o){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,o),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new gh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,c,f,_,y=this._container;for(;y&&(!f||!_);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(c=x.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),y=y.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new jb(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=ke("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=ke("div","mapboxgl-canvas-container",p);this._canvas=ke("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=ke("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=ke("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){let c=r.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let o=this._markers.indexOf(p);o!==-1&&this._markers.splice(o,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let o=this._popups.indexOf(p);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let p=Object.assign({},$e.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",p);o?(rs(o,!0),this.painter=new hg(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.k.testSupport(o)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;this.fire(new r.z("renderstart")),++this._frameId;let c=this.painter.context.extTimerQuery,f=r.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=_.createQuery(),_.beginQuery(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let M=this.transform.zoom,A=this.transform.pitch,L=r.o.now(),F=new r.ac(M,{now:L,fadeDuration:y,pitch:A,transition:this.style.transition,worldview:this._worldview});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(f);let w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,k.mark(P.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let M=r.o.now()-f;_.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let A=_.getQueryParameter(o,_.QUERY_RESULT)/1e6;_.deleteQuery(o),this.fire(new r.z("gpu-timing-frame",{cpuTime:M,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){let M=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(M);this.fire(new r.z("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(M);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:A}))},50)}let S=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(S||this._repaint)this.triggerRepaint();else{let M=this.idle();if(M&&(x=this._updateAverageElevation(f,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,k.mark(P.fullLoad),this._performanceMetricsCollection&&Fr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let o of this._markers)p&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!p||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(p,o=!1){let c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let _=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=p;let x=Math.abs(_-y);if(x>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){Uc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===ci||p.status===401)){let o=this.painter.context.gl;rs(o,!1),this._logoControl instanceof Yp&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),om(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&sm(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Yi(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Wo(this._requestManager._customAccessToken)}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let c=this.painter.context.gl,f=c.createFramebuffer();function _(y){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0);let x=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,x),x}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(_(p),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(p,o,c){let f=c[1]-c[0],_=p.length/4;for(let y=0;y<o.length;y++){let x=o[y],w=0;for(let S=0;S<x.length;S+=4)x[S]===p[S]&&x[S+1]===p[S+1]&&x[S+2]===p[S+2]&&x[S+3]===p[S+3]&&(w+=1);f+=(c[y+2]-c[y+1])*(1-w/_)}return f}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zs.delete(this.painter.context.gl),Vc.remove(),Qs.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.o.frame(o=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(p){let o=this.style?this.style.getSourceCaches():[];return r.bw(o,(c,f)=>c._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,o){r.f4(p,o)}get version(){return C}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},bI,p),this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),ke("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),ke("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=ke("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let o=p.getZoom(),c=o===p.getMaxZoom(),f=o===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wI(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){let c=ke("button",p,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(p,o){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.E{constructor(p={}){super();let o=navigator.geolocation;this.options=Object.assign({geolocation:o},CI,p),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(p){let o=this._map.getMaxBounds(),c=p.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){let o=new r.aT(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),_=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(p){if(p){let o=new r.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,o=r.cf(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ke("button","mapboxgl-ctrl-geolocate",this._container),ke("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ke("div","mapboxgl-user-location"),this._dotElement.appendChild(ke("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ke("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Tg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ke("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Zp,ScaleControl:class{constructor(p={}){this.options=Object.assign({},_h,p),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,f=o._containerWidth/2-p/2,_=o.unproject([f,c]),y=o.unproject([f+p,c]),x=_.distanceTo(y);if(this.options.unit==="imperial"){let w=3.2808*x;w>5280?this._setScale(p,w/5280,"mile"):this._setScale(p,w,"foot")}else this.options.unit==="nautical"?this._setScale(p,x/1852,"nautical-mile"):x>=1e3?this._setScale(p,x/1e3,"kilometer"):this._setScale(p,x,"meter")}_setScale(p,o,c){this._map._requestDomTask(()=>{let f=(function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),w=y/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){let M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M})(w),x*w})(o),_=f/o;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${kv[c]}`,this._container.style.width=p*_+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=ke("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=ke("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ke("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:gh,Popup:class extends r.E{constructor(p){super(),this.options=Object.assign(Object.create(Ta),p),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let o=document.createDocumentFragment(),c=document.createElement("body"),f;for(c.innerHTML=p;f=c.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=ke("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){let c=this._closeButton=ke("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let o=this._map,c=this._container,f=this._pos;if(!o||!c||!f)return"bottom";let _=c.offsetWidth,y=c.offsetHeight,x=f.x<_/2,w=f.x>o.transform.width-_/2;if(f.y+p<y)return x?"top-left":w?"top-right":"top";if(f.y>o.transform.height-y){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){let o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=ke("div","mapboxgl-popup",o.getContainer()),this._tip=ke("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rv(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){let _=this._pos=this._trackPointer&&p instanceof r.P?p:o.project(this._lngLat,this._altitude),y=vd(this.options.offset),x=this._anchor=this._getAnchor(y.y),w=vd(this.options.offset,x),S=_.add(w).round();o._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Ko[x]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&o._showingGlobe()){let _=r.f5(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(Ia);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Tg,Style:Ea,LngLat:r.aT,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:fs,Evented:r.E,config:r.e,prewarm:r.f9,clearPrewarmedResources:r.f8,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(p){r.e.ACCESS_TOKEN=p},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(p){r.e.API_URL=p},get workerCount(){return r.fi.workerCount},set workerCount(p){r.fi.workerCount=p},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.fh(p)},get workerUrl(){return r.fg.workerUrl},set workerUrl(p){r.fg.workerUrl=p},get workerClass(){return r.fg.workerClass},set workerClass(p){r.fg.workerClass=p},get workerParams(){return r.fg.workerParams},set workerParams(p){r.fg.workerParams=p},get dracoUrl(){return r.ff()},set dracoUrl(p){r.fe(p)},get meshoptUrl(){return r.fd()},set meshoptUrl(p){r.fc(p)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var d=e;return d})});var vj=Nr((IIe,_j)=>{"use strict";_j.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var np=Nr(em=>{"use strict";var rR,Jee=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];em.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17};em.getSymbolTotalCodewords=function(n){return Jee[n]};em.getBCHDigit=function(i){let n=0;for(;i!==0;)n++,i>>>=1;return n};em.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');rR=n};em.isKanjiModeEnabled=function(){return typeof rR<"u"};em.toSJIS=function(n){return rR(n)}});var dT=Nr(ql=>{"use strict";ql.L={bit:1};ql.M={bit:0};ql.Q={bit:3};ql.H={bit:2};function ete(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return ql.L;case"m":case"medium":return ql.M;case"q":case"quartile":return ql.Q;case"h":case"high":return ql.H;default:throw new Error("Unknown EC Level: "+i)}}ql.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4};ql.from=function(n,e){if(ql.isValid(n))return n;try{return ete(n)}catch{return e}}});var bj=Nr((AIe,xj)=>{"use strict";function yj(){this.buffer=[],this.length=0}yj.prototype={get:function(i){let n=Math.floor(i/8);return(this.buffer[n]>>>7-i%8&1)===1},put:function(i,n){for(let e=0;e<n;e++)this.putBit((i>>>n-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(i){let n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),i&&(this.buffer[n]|=128>>>this.length%8),this.length++}};xj.exports=yj});var Cj=Nr((PIe,wj)=>{"use strict";function xb(i){if(!i||i<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=i,this.data=new Uint8Array(i*i),this.reservedBit=new Uint8Array(i*i)}xb.prototype.set=function(i,n,e,a){let d=i*this.size+n;this.data[d]=e,a&&(this.reservedBit[d]=!0)};xb.prototype.get=function(i,n){return this.data[i*this.size+n]};xb.prototype.xor=function(i,n,e){this.data[i*this.size+n]^=e};xb.prototype.isReserved=function(i,n){return this.reservedBit[i*this.size+n]};wj.exports=xb});var Ej=Nr(hT=>{"use strict";var tte=np().getSymbolSize;hT.getRowColCoords=function(n){if(n===1)return[];let e=Math.floor(n/7)+2,a=tte(n),d=a===145?26:Math.ceil((a-13)/(2*e-2))*2,r=[a-7];for(let C=1;C<e-1;C++)r[C]=r[C-1]-d;return r.push(6),r.reverse()};hT.getPositions=function(n){let e=[],a=hT.getRowColCoords(n),d=a.length;for(let r=0;r<d;r++)for(let C=0;C<d;C++)r===0&&C===0||r===0&&C===d-1||r===d-1&&C===0||e.push([a[r],a[C]]);return e}});var Ij=Nr(Tj=>{"use strict";var nte=np().getSymbolSize,Sj=7;Tj.getPositions=function(n){let e=nte(n);return[[0,0],[e-Sj,0],[0,e-Sj]]}});var Mj=Nr(ro=>{"use strict";ro.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var tm={N1:3,N2:3,N3:40,N4:10};ro.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7};ro.from=function(n){return ro.isValid(n)?parseInt(n,10):void 0};ro.getPenaltyN1=function(n){let e=n.size,a=0,d=0,r=0,C=null,P=null;for(let k=0;k<e;k++){d=r=0,C=P=null;for(let X=0;X<e;X++){let oe=n.get(k,X);oe===C?d++:(d>=5&&(a+=tm.N1+(d-5)),C=oe,d=1),oe=n.get(X,k),oe===P?r++:(r>=5&&(a+=tm.N1+(r-5)),P=oe,r=1)}d>=5&&(a+=tm.N1+(d-5)),r>=5&&(a+=tm.N1+(r-5))}return a};ro.getPenaltyN2=function(n){let e=n.size,a=0;for(let d=0;d<e-1;d++)for(let r=0;r<e-1;r++){let C=n.get(d,r)+n.get(d,r+1)+n.get(d+1,r)+n.get(d+1,r+1);(C===4||C===0)&&a++}return a*tm.N2};ro.getPenaltyN3=function(n){let e=n.size,a=0,d=0,r=0;for(let C=0;C<e;C++){d=r=0;for(let P=0;P<e;P++)d=d<<1&2047|n.get(C,P),P>=10&&(d===1488||d===93)&&a++,r=r<<1&2047|n.get(P,C),P>=10&&(r===1488||r===93)&&a++}return a*tm.N3};ro.getPenaltyN4=function(n){let e=0,a=n.data.length;for(let r=0;r<a;r++)e+=n.data[r];return Math.abs(Math.ceil(e*100/a/5)-10)*tm.N4};function ite(i,n,e){switch(i){case ro.Patterns.PATTERN000:return(n+e)%2===0;case ro.Patterns.PATTERN001:return n%2===0;case ro.Patterns.PATTERN010:return e%3===0;case ro.Patterns.PATTERN011:return(n+e)%3===0;case ro.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(e/3))%2===0;case ro.Patterns.PATTERN101:return n*e%2+n*e%3===0;case ro.Patterns.PATTERN110:return(n*e%2+n*e%3)%2===0;case ro.Patterns.PATTERN111:return(n*e%3+(n+e)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}ro.applyMask=function(n,e){let a=e.size;for(let d=0;d<a;d++)for(let r=0;r<a;r++)e.isReserved(r,d)||e.xor(r,d,ite(n,r,d))};ro.getBestMask=function(n,e){let a=Object.keys(ro.Patterns).length,d=0,r=1/0;for(let C=0;C<a;C++){e(C),ro.applyMask(C,n);let P=ro.getPenaltyN1(n)+ro.getPenaltyN2(n)+ro.getPenaltyN3(n)+ro.getPenaltyN4(n);ro.applyMask(C,n),P<r&&(r=P,d=C)}return d}});var sR=Nr(oR=>{"use strict";var ip=dT(),pT=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],fT=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];oR.getBlocksCount=function(n,e){switch(e){case ip.L:return pT[(n-1)*4+0];case ip.M:return pT[(n-1)*4+1];case ip.Q:return pT[(n-1)*4+2];case ip.H:return pT[(n-1)*4+3];default:return}};oR.getTotalCodewordsCount=function(n,e){switch(e){case ip.L:return fT[(n-1)*4+0];case ip.M:return fT[(n-1)*4+1];case ip.Q:return fT[(n-1)*4+2];case ip.H:return fT[(n-1)*4+3];default:return}}});var Dj=Nr(gT=>{"use strict";var bb=new Uint8Array(512),mT=new Uint8Array(256);(function(){let n=1;for(let e=0;e<255;e++)bb[e]=n,mT[n]=e,n<<=1,n&256&&(n^=285);for(let e=255;e<512;e++)bb[e]=bb[e-255]})();gT.log=function(n){if(n<1)throw new Error("log("+n+")");return mT[n]};gT.exp=function(n){return bb[n]};gT.mul=function(n,e){return n===0||e===0?0:bb[mT[n]+mT[e]]}});var Aj=Nr(wb=>{"use strict";var aR=Dj();wb.mul=function(n,e){let a=new Uint8Array(n.length+e.length-1);for(let d=0;d<n.length;d++)for(let r=0;r<e.length;r++)a[d+r]^=aR.mul(n[d],e[r]);return a};wb.mod=function(n,e){let a=new Uint8Array(n);for(;a.length-e.length>=0;){let d=a[0];for(let C=0;C<e.length;C++)a[C]^=aR.mul(e[C],d);let r=0;for(;r<a.length&&a[r]===0;)r++;a=a.slice(r)}return a};wb.generateECPolynomial=function(n){let e=new Uint8Array([1]);for(let a=0;a<n;a++)e=wb.mul(e,new Uint8Array([1,aR.exp(a)]));return e}});var Rj=Nr((zIe,Oj)=>{"use strict";var Pj=Aj();function lR(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}lR.prototype.initialize=function(n){this.degree=n,this.genPoly=Pj.generateECPolynomial(this.degree)};lR.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");let e=new Uint8Array(n.length+this.degree);e.set(n);let a=Pj.mod(e,this.genPoly),d=this.degree-a.length;if(d>0){let r=new Uint8Array(this.degree);return r.set(a,d),r}return a};Oj.exports=lR});var cR=Nr(kj=>{"use strict";kj.isValid=function(n){return!isNaN(n)&&n>=1&&n<=40}});var uR=Nr($d=>{"use strict";var Fj="[0-9]+",rte="[A-Z $%*+\\-./:]+",Cb="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Cb=Cb.replace(/u/g,"\\u");var ote="(?:(?![A-Z0-9 $%*+\\-./:]|"+Cb+`)(?:.|[\r
]))+`;$d.KANJI=new RegExp(Cb,"g");$d.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");$d.BYTE=new RegExp(ote,"g");$d.NUMERIC=new RegExp(Fj,"g");$d.ALPHANUMERIC=new RegExp(rte,"g");var ste=new RegExp("^"+Cb+"$"),ate=new RegExp("^"+Fj+"$"),lte=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");$d.testKanji=function(n){return ste.test(n)};$d.testNumeric=function(n){return ate.test(n)};$d.testAlphanumeric=function(n){return lte.test(n)}});var rp=Nr(is=>{"use strict";var cte=cR(),dR=uR();is.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};is.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};is.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};is.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};is.MIXED={bit:-1};is.getCharCountIndicator=function(n,e){if(!n.ccBits)throw new Error("Invalid mode: "+n);if(!cte.isValid(e))throw new Error("Invalid version: "+e);return e>=1&&e<10?n.ccBits[0]:e<27?n.ccBits[1]:n.ccBits[2]};is.getBestModeForData=function(n){return dR.testNumeric(n)?is.NUMERIC:dR.testAlphanumeric(n)?is.ALPHANUMERIC:dR.testKanji(n)?is.KANJI:is.BYTE};is.toString=function(n){if(n&&n.id)return n.id;throw new Error("Invalid mode")};is.isValid=function(n){return n&&n.bit&&n.ccBits};function ute(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return is.NUMERIC;case"alphanumeric":return is.ALPHANUMERIC;case"kanji":return is.KANJI;case"byte":return is.BYTE;default:throw new Error("Unknown mode: "+i)}}is.from=function(n,e){if(is.isValid(n))return n;try{return ute(n)}catch{return e}}});var Vj=Nr(nm=>{"use strict";var _T=np(),dte=sR(),Lj=dT(),op=rp(),hR=cR(),zj=7973,Nj=_T.getBCHDigit(zj);function hte(i,n,e){for(let a=1;a<=40;a++)if(n<=nm.getCapacity(a,e,i))return a}function Bj(i,n){return op.getCharCountIndicator(i,n)+4}function pte(i,n){let e=0;return i.forEach(function(a){let d=Bj(a.mode,n);e+=d+a.getBitsLength()}),e}function fte(i,n){for(let e=1;e<=40;e++)if(pte(i,e)<=nm.getCapacity(e,n,op.MIXED))return e}nm.from=function(n,e){return hR.isValid(n)?parseInt(n,10):e};nm.getCapacity=function(n,e,a){if(!hR.isValid(n))throw new Error("Invalid QR Code version");typeof a>"u"&&(a=op.BYTE);let d=_T.getSymbolTotalCodewords(n),r=dte.getTotalCodewordsCount(n,e),C=(d-r)*8;if(a===op.MIXED)return C;let P=C-Bj(a,n);switch(a){case op.NUMERIC:return Math.floor(P/10*3);case op.ALPHANUMERIC:return Math.floor(P/11*2);case op.KANJI:return Math.floor(P/13);case op.BYTE:default:return Math.floor(P/8)}};nm.getBestVersionForData=function(n,e){let a,d=Lj.from(e,Lj.M);if(Array.isArray(n)){if(n.length>1)return fte(n,d);if(n.length===0)return 1;a=n[0]}else a=n;return hte(a.mode,a.getLength(),d)};nm.getEncodedBits=function(n){if(!hR.isValid(n)||n<7)throw new Error("Invalid QR Code version");let e=n<<12;for(;_T.getBCHDigit(e)-Nj>=0;)e^=zj<<_T.getBCHDigit(e)-Nj;return n<<12|e}});var Hj=Nr($j=>{"use strict";var pR=np(),jj=1335,mte=21522,Uj=pR.getBCHDigit(jj);$j.getEncodedBits=function(n,e){let a=n.bit<<3|e,d=a<<10;for(;pR.getBCHDigit(d)-Uj>=0;)d^=jj<<pR.getBCHDigit(d)-Uj;return(a<<10|d)^mte}});var qj=Nr((HIe,Gj)=>{"use strict";var gte=rp();function m0(i){this.mode=gte.NUMERIC,this.data=i.toString()}m0.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)};m0.prototype.getLength=function(){return this.data.length};m0.prototype.getBitsLength=function(){return m0.getBitsLength(this.data.length)};m0.prototype.write=function(n){let e,a,d;for(e=0;e+3<=this.data.length;e+=3)a=this.data.substr(e,3),d=parseInt(a,10),n.put(d,10);let r=this.data.length-e;r>0&&(a=this.data.substr(e),d=parseInt(a,10),n.put(d,r*3+1))};Gj.exports=m0});var Zj=Nr((GIe,Wj)=>{"use strict";var _te=rp(),fR=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function g0(i){this.mode=_te.ALPHANUMERIC,this.data=i}g0.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)};g0.prototype.getLength=function(){return this.data.length};g0.prototype.getBitsLength=function(){return g0.getBitsLength(this.data.length)};g0.prototype.write=function(n){let e;for(e=0;e+2<=this.data.length;e+=2){let a=fR.indexOf(this.data[e])*45;a+=fR.indexOf(this.data[e+1]),n.put(a,11)}this.data.length%2&&n.put(fR.indexOf(this.data[e]),6)};Wj.exports=g0});var Xj=Nr((qIe,Yj)=>{"use strict";var vte=rp();function _0(i){this.mode=vte.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}_0.getBitsLength=function(n){return n*8};_0.prototype.getLength=function(){return this.data.length};_0.prototype.getBitsLength=function(){return _0.getBitsLength(this.data.length)};_0.prototype.write=function(i){for(let n=0,e=this.data.length;n<e;n++)i.put(this.data[n],8)};Yj.exports=_0});var Qj=Nr((WIe,Kj)=>{"use strict";var yte=rp(),xte=np();function v0(i){this.mode=yte.KANJI,this.data=i}v0.getBitsLength=function(n){return n*13};v0.prototype.getLength=function(){return this.data.length};v0.prototype.getBitsLength=function(){return v0.getBitsLength(this.data.length)};v0.prototype.write=function(i){let n;for(n=0;n<this.data.length;n++){let e=xte.toSJIS(this.data[n]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),i.put(e,13)}};Kj.exports=v0});var Jj=Nr((ZIe,mR)=>{"use strict";var Eb={single_source_shortest_paths:function(i,n,e){var a={},d={};d[n]=0;var r=Eb.PriorityQueue.make();r.push(n,0);for(var C,P,k,X,oe,Me,$e,ke,ht;!r.empty();){C=r.pop(),P=C.value,X=C.cost,oe=i[P]||{};for(k in oe)oe.hasOwnProperty(k)&&(Me=oe[k],$e=X+Me,ke=d[k],ht=typeof d[k]>"u",(ht||ke>$e)&&(d[k]=$e,r.push(k,$e),a[k]=P))}if(typeof e<"u"&&typeof d[e]>"u"){var Nt=["Could not find a path from ",n," to ",e,"."].join("");throw new Error(Nt)}return a},extract_shortest_path_from_predecessor_list:function(i,n){for(var e=[],a=n,d;a;)e.push(a),d=i[a],a=i[a];return e.reverse(),e},find_path:function(i,n,e){var a=Eb.single_source_shortest_paths(i,n,e);return Eb.extract_shortest_path_from_predecessor_list(a,e)},PriorityQueue:{make:function(i){var n=Eb.PriorityQueue,e={},a;i=i||{};for(a in n)n.hasOwnProperty(a)&&(e[a]=n[a]);return e.queue=[],e.sorter=i.sorter||n.default_sorter,e},default_sorter:function(i,n){return i.cost-n.cost},push:function(i,n){var e={value:i,cost:n};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof mR<"u"&&(mR.exports=Eb)});var a6=Nr(y0=>{"use strict";var kr=rp(),n6=qj(),i6=Zj(),r6=Xj(),o6=Qj(),Sb=uR(),vT=np(),bte=Jj();function e6(i){return unescape(encodeURIComponent(i)).length}function Tb(i,n,e){let a=[],d;for(;(d=i.exec(e))!==null;)a.push({data:d[0],index:d.index,mode:n,length:d[0].length});return a}function s6(i){let n=Tb(Sb.NUMERIC,kr.NUMERIC,i),e=Tb(Sb.ALPHANUMERIC,kr.ALPHANUMERIC,i),a,d;return vT.isKanjiModeEnabled()?(a=Tb(Sb.BYTE,kr.BYTE,i),d=Tb(Sb.KANJI,kr.KANJI,i)):(a=Tb(Sb.BYTE_KANJI,kr.BYTE,i),d=[]),n.concat(e,a,d).sort(function(C,P){return C.index-P.index}).map(function(C){return{data:C.data,mode:C.mode,length:C.length}})}function gR(i,n){switch(n){case kr.NUMERIC:return n6.getBitsLength(i);case kr.ALPHANUMERIC:return i6.getBitsLength(i);case kr.KANJI:return o6.getBitsLength(i);case kr.BYTE:return r6.getBitsLength(i)}}function wte(i){return i.reduce(function(n,e){let a=n.length-1>=0?n[n.length-1]:null;return a&&a.mode===e.mode?(n[n.length-1].data+=e.data,n):(n.push(e),n)},[])}function Cte(i){let n=[];for(let e=0;e<i.length;e++){let a=i[e];switch(a.mode){case kr.NUMERIC:n.push([a,{data:a.data,mode:kr.ALPHANUMERIC,length:a.length},{data:a.data,mode:kr.BYTE,length:a.length}]);break;case kr.ALPHANUMERIC:n.push([a,{data:a.data,mode:kr.BYTE,length:a.length}]);break;case kr.KANJI:n.push([a,{data:a.data,mode:kr.BYTE,length:e6(a.data)}]);break;case kr.BYTE:n.push([{data:a.data,mode:kr.BYTE,length:e6(a.data)}])}}return n}function Ete(i,n){let e={},a={start:{}},d=["start"];for(let r=0;r<i.length;r++){let C=i[r],P=[];for(let k=0;k<C.length;k++){let X=C[k],oe=""+r+k;P.push(oe),e[oe]={node:X,lastCount:0},a[oe]={};for(let Me=0;Me<d.length;Me++){let $e=d[Me];e[$e]&&e[$e].node.mode===X.mode?(a[$e][oe]=gR(e[$e].lastCount+X.length,X.mode)-gR(e[$e].lastCount,X.mode),e[$e].lastCount+=X.length):(e[$e]&&(e[$e].lastCount=X.length),a[$e][oe]=gR(X.length,X.mode)+4+kr.getCharCountIndicator(X.mode,n))}}d=P}for(let r=0;r<d.length;r++)a[d[r]].end=0;return{map:a,table:e}}function t6(i,n){let e,a=kr.getBestModeForData(i);if(e=kr.from(n,a),e!==kr.BYTE&&e.bit<a.bit)throw new Error('"'+i+'" cannot be encoded with mode '+kr.toString(e)+`.
 Suggested mode is: `+kr.toString(a));switch(e===kr.KANJI&&!vT.isKanjiModeEnabled()&&(e=kr.BYTE),e){case kr.NUMERIC:return new n6(i);case kr.ALPHANUMERIC:return new i6(i);case kr.KANJI:return new o6(i);case kr.BYTE:return new r6(i)}}y0.fromArray=function(n){return n.reduce(function(e,a){return typeof a=="string"?e.push(t6(a,null)):a.data&&e.push(t6(a.data,a.mode)),e},[])};y0.fromString=function(n,e){let a=s6(n,vT.isKanjiModeEnabled()),d=Cte(a),r=Ete(d,e),C=bte.find_path(r.map,"start","end"),P=[];for(let k=1;k<C.length-1;k++)P.push(r.table[C[k]].node);return y0.fromArray(wte(P))};y0.rawSplit=function(n){return y0.fromArray(s6(n,vT.isKanjiModeEnabled()))}});var c6=Nr(l6=>{"use strict";var xT=np(),_R=dT(),Ste=bj(),Tte=Cj(),Ite=Ej(),Mte=Ij(),xR=Mj(),bR=sR(),Dte=Rj(),yT=Vj(),Ate=Hj(),Pte=rp(),vR=a6();function Ote(i,n){let e=i.size,a=Mte.getPositions(n);for(let d=0;d<a.length;d++){let r=a[d][0],C=a[d][1];for(let P=-1;P<=7;P++)if(!(r+P<=-1||e<=r+P))for(let k=-1;k<=7;k++)C+k<=-1||e<=C+k||(P>=0&&P<=6&&(k===0||k===6)||k>=0&&k<=6&&(P===0||P===6)||P>=2&&P<=4&&k>=2&&k<=4?i.set(r+P,C+k,!0,!0):i.set(r+P,C+k,!1,!0))}}function Rte(i){let n=i.size;for(let e=8;e<n-8;e++){let a=e%2===0;i.set(e,6,a,!0),i.set(6,e,a,!0)}}function kte(i,n){let e=Ite.getPositions(n);for(let a=0;a<e.length;a++){let d=e[a][0],r=e[a][1];for(let C=-2;C<=2;C++)for(let P=-2;P<=2;P++)C===-2||C===2||P===-2||P===2||C===0&&P===0?i.set(d+C,r+P,!0,!0):i.set(d+C,r+P,!1,!0)}}function Fte(i,n){let e=i.size,a=yT.getEncodedBits(n),d,r,C;for(let P=0;P<18;P++)d=Math.floor(P/3),r=P%3+e-8-3,C=(a>>P&1)===1,i.set(d,r,C,!0),i.set(r,d,C,!0)}function yR(i,n,e){let a=i.size,d=Ate.getEncodedBits(n,e),r,C;for(r=0;r<15;r++)C=(d>>r&1)===1,r<6?i.set(r,8,C,!0):r<8?i.set(r+1,8,C,!0):i.set(a-15+r,8,C,!0),r<8?i.set(8,a-r-1,C,!0):r<9?i.set(8,15-r-1+1,C,!0):i.set(8,15-r-1,C,!0);i.set(a-8,8,1,!0)}function Lte(i,n){let e=i.size,a=-1,d=e-1,r=7,C=0;for(let P=e-1;P>0;P-=2)for(P===6&&P--;;){for(let k=0;k<2;k++)if(!i.isReserved(d,P-k)){let X=!1;C<n.length&&(X=(n[C]>>>r&1)===1),i.set(d,P-k,X),r--,r===-1&&(C++,r=7)}if(d+=a,d<0||e<=d){d-=a,a=-a;break}}}function Nte(i,n,e){let a=new Ste;e.forEach(function(k){a.put(k.mode.bit,4),a.put(k.getLength(),Pte.getCharCountIndicator(k.mode,i)),k.write(a)});let d=xT.getSymbolTotalCodewords(i),r=bR.getTotalCodewordsCount(i,n),C=(d-r)*8;for(a.getLengthInBits()+4<=C&&a.put(0,4);a.getLengthInBits()%8!==0;)a.putBit(0);let P=(C-a.getLengthInBits())/8;for(let k=0;k<P;k++)a.put(k%2?17:236,8);return zte(a,i,n)}function zte(i,n,e){let a=xT.getSymbolTotalCodewords(n),d=bR.getTotalCodewordsCount(n,e),r=a-d,C=bR.getBlocksCount(n,e),P=a%C,k=C-P,X=Math.floor(a/C),oe=Math.floor(r/C),Me=oe+1,$e=X-oe,ke=new Dte($e),ht=0,Nt=new Array(C),Mt=new Array(C),Xt=0,Vn=new Uint8Array(i.buffer);for(let qo=0;qo<C;qo++){let Ks=qo<k?oe:Me;Nt[qo]=Vn.slice(ht,ht+Ks),Mt[qo]=ke.encode(Nt[qo]),ht+=Ks,Xt=Math.max(Xt,Ks)}let sr=new Uint8Array(a),Hi=0,Ni,Or;for(Ni=0;Ni<Xt;Ni++)for(Or=0;Or<C;Or++)Ni<Nt[Or].length&&(sr[Hi++]=Nt[Or][Ni]);for(Ni=0;Ni<$e;Ni++)for(Or=0;Or<C;Or++)sr[Hi++]=Mt[Or][Ni];return sr}function Bte(i,n,e,a){let d;if(Array.isArray(i))d=vR.fromArray(i);else if(typeof i=="string"){let X=n;if(!X){let oe=vR.rawSplit(i);X=yT.getBestVersionForData(oe,e)}d=vR.fromString(i,X||40)}else throw new Error("Invalid data");let r=yT.getBestVersionForData(d,e);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(!n)n=r;else if(n<r)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+r+`.
`);let C=Nte(n,e,d),P=xT.getSymbolSize(n),k=new Tte(P);return Ote(k,n),Rte(k),kte(k,n),yR(k,e,0),n>=7&&Fte(k,n),Lte(k,C),isNaN(a)&&(a=xR.getBestMask(k,yR.bind(null,k,e))),xR.applyMask(a,k),yR(k,e,a),{modules:k,version:n,errorCorrectionLevel:e,maskPattern:a,segments:d}}l6.create=function(n,e){if(typeof n>"u"||n==="")throw new Error("No input text");let a=_R.M,d,r;return typeof e<"u"&&(a=_R.from(e.errorCorrectionLevel,_R.M),d=yT.from(e.version),r=xR.from(e.maskPattern),e.toSJISFunc&&xT.setToSJISFunction(e.toSJISFunc)),Bte(n,d,a,r)}});var wR=Nr(im=>{"use strict";function u6(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let n=i.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+i);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(a){return[a,a]}))),n.length===6&&n.push("F","F");let e=parseInt(n.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:e&255,hex:"#"+n.slice(0,6).join("")}}im.getOptions=function(n){n||(n={}),n.color||(n.color={});let e=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,a=n.width&&n.width>=21?n.width:void 0,d=n.scale||4;return{width:a,scale:a?4:d,margin:e,color:{dark:u6(n.color.dark||"#000000ff"),light:u6(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}};im.getScale=function(n,e){return e.width&&e.width>=n+e.margin*2?e.width/(n+e.margin*2):e.scale};im.getImageWidth=function(n,e){let a=im.getScale(n,e);return Math.floor((n+e.margin*2)*a)};im.qrToImageData=function(n,e,a){let d=e.modules.size,r=e.modules.data,C=im.getScale(d,a),P=Math.floor((d+a.margin*2)*C),k=a.margin*C,X=[a.color.light,a.color.dark];for(let oe=0;oe<P;oe++)for(let Me=0;Me<P;Me++){let $e=(oe*P+Me)*4,ke=a.color.light;if(oe>=k&&Me>=k&&oe<P-k&&Me<P-k){let ht=Math.floor((oe-k)/C),Nt=Math.floor((Me-k)/C);ke=X[r[ht*d+Nt]?1:0]}n[$e++]=ke.r,n[$e++]=ke.g,n[$e++]=ke.b,n[$e]=ke.a}}});var d6=Nr(bT=>{"use strict";var CR=wR();function Vte(i,n,e){i.clearRect(0,0,n.width,n.height),n.style||(n.style={}),n.height=e,n.width=e,n.style.height=e+"px",n.style.width=e+"px"}function Ute(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}bT.render=function(n,e,a){let d=a,r=e;typeof d>"u"&&(!e||!e.getContext)&&(d=e,e=void 0),e||(r=Ute()),d=CR.getOptions(d);let C=CR.getImageWidth(n.modules.size,d),P=r.getContext("2d"),k=P.createImageData(C,C);return CR.qrToImageData(k.data,n,d),Vte(P,r,C),P.putImageData(k,0,0),r};bT.renderToDataURL=function(n,e,a){let d=a;typeof d>"u"&&(!e||!e.getContext)&&(d=e,e=void 0),d||(d={});let r=bT.render(n,e,d),C=d.type||"image/png",P=d.rendererOpts||{};return r.toDataURL(C,P.quality)}});var f6=Nr(p6=>{"use strict";var jte=wR();function h6(i,n){let e=i.a/255,a=n+'="'+i.hex+'"';return e<1?a+" "+n+'-opacity="'+e.toFixed(2).slice(1)+'"':a}function ER(i,n,e){let a=i+n;return typeof e<"u"&&(a+=" "+e),a}function $te(i,n,e){let a="",d=0,r=!1,C=0;for(let P=0;P<i.length;P++){let k=Math.floor(P%n),X=Math.floor(P/n);!k&&!r&&(r=!0),i[P]?(C++,P>0&&k>0&&i[P-1]||(a+=r?ER("M",k+e,.5+X+e):ER("m",d,0),d=0,r=!1),k+1<n&&i[P+1]||(a+=ER("h",C),C=0)):d++}return a}p6.render=function(n,e,a){let d=jte.getOptions(e),r=n.modules.size,C=n.modules.data,P=r+d.margin*2,k=d.color.light.a?"<path "+h6(d.color.light,"fill")+' d="M0 0h'+P+"v"+P+'H0z"/>':"",X="<path "+h6(d.color.dark,"stroke")+' d="'+$te(C,r,d.margin)+'"/>',oe='viewBox="0 0 '+P+" "+P+'"',$e='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+oe+' shape-rendering="crispEdges">'+k+X+`</svg>
`;return typeof a=="function"&&a(null,$e),$e}});var IR=Nr(Ib=>{"use strict";var Hte=vj(),SR=c6(),m6=d6(),Gte=f6();function TR(i,n,e,a,d){let r=[].slice.call(arguments,1),C=r.length,P=typeof r[C-1]=="function";if(!P&&!Hte())throw new Error("Callback required as last argument");if(P){if(C<2)throw new Error("Too few arguments provided");C===2?(d=e,e=n,n=a=void 0):C===3&&(n.getContext&&typeof d>"u"?(d=a,a=void 0):(d=a,a=e,e=n,n=void 0))}else{if(C<1)throw new Error("Too few arguments provided");return C===1?(e=n,n=a=void 0):C===2&&!n.getContext&&(a=e,e=n,n=void 0),new Promise(function(k,X){try{let oe=SR.create(e,a);k(i(oe,n,a))}catch(oe){X(oe)}})}try{let k=SR.create(e,a);d(null,i(k,n,a))}catch(k){d(k)}}Ib.create=SR.create;Ib.toCanvas=TR.bind(null,m6.render);Ib.toDataURL=TR.bind(null,m6.renderToDataURL);Ib.toString=TR.bind(null,function(i,n,e){return Gte.render(i,e)})});var GM;function Ow(){return GM}function pu(i){let n=GM;return GM=i,n}var AN=Symbol("NotFound");function Zg(i){return i===AN||i?.name==="\u0275NotFound"}var js=null,Rw=!1,qM=1,gG=null,$s=Symbol("SIGNAL");function Ei(i){let n=js;return js=i,n}function Nw(){return js}var Yg={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Xg(i){if(Rw)throw new Error("");if(js===null)return;js.consumerOnSignalRead(i);let n=js.producersTail;if(n!==void 0&&n.producer===i)return;let e,a=js.recomputing;if(a&&(e=n!==void 0?n.nextProducer:js.producers,e!==void 0&&e.producer===i)){js.producersTail=e,e.lastReadVersion=i.version;return}let d=i.consumersTail;if(d!==void 0&&d.consumer===js&&(!a||vG(d,js)))return;let r=Qg(js),C={producer:i,consumer:js,nextProducer:e,prevConsumer:d,lastReadVersion:i.version,nextConsumer:void 0};js.producersTail=C,n!==void 0?n.nextProducer=C:js.producers=C,r&&kN(i,C)}function PN(){qM++}function zw(i){if(!(Qg(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===qM)){if(!i.producerMustRecompute(i)&&!Sy(i)){Lw(i);return}i.producerRecomputeValue(i),Lw(i)}}function WM(i){if(i.consumers===void 0)return;let n=Rw;Rw=!0;try{for(let e=i.consumers;e!==void 0;e=e.nextConsumer){let a=e.consumer;a.dirty||_G(a)}}finally{Rw=n}}function ZM(){return js?.consumerAllowSignalWrites!==!1}function _G(i){i.dirty=!0,WM(i),i.consumerMarkedDirty?.(i)}function Lw(i){i.dirty=!1,i.lastCleanEpoch=qM}function Kg(i){return i&&ON(i),Ei(i)}function ON(i){i.producersTail=void 0,i.recomputing=!0}function Ey(i,n){Ei(n),i&&RN(i)}function RN(i){i.recomputing=!1;let n=i.producersTail,e=n!==void 0?n.nextProducer:i.producers;if(e!==void 0){if(Qg(i))do e=YM(e);while(e!==void 0);n!==void 0?n.nextProducer=void 0:i.producers=void 0}}function Sy(i){for(let n=i.producers;n!==void 0;n=n.nextProducer){let e=n.producer,a=n.lastReadVersion;if(a!==e.version||(zw(e),a!==e.version))return!0}return!1}function Ty(i){if(Qg(i)){let n=i.producers;for(;n!==void 0;)n=YM(n)}i.producers=void 0,i.producersTail=void 0,i.consumers=void 0,i.consumersTail=void 0}function kN(i,n){let e=i.consumersTail,a=Qg(i);if(e!==void 0?(n.nextConsumer=e.nextConsumer,e.nextConsumer=n):(n.nextConsumer=void 0,i.consumers=n),n.prevConsumer=e,i.consumersTail=n,!a)for(let d=i.producers;d!==void 0;d=d.nextProducer)kN(d.producer,d)}function YM(i){let n=i.producer,e=i.nextProducer,a=i.nextConsumer,d=i.prevConsumer;if(i.nextConsumer=void 0,i.prevConsumer=void 0,a!==void 0?a.prevConsumer=d:n.consumersTail=d,d!==void 0)d.nextConsumer=a;else if(n.consumers=a,!Qg(n)){let r=n.producers;for(;r!==void 0;)r=YM(r)}return e}function Qg(i){return i.consumerIsAlwaysLive||i.consumers!==void 0}function Bw(i){gG?.(i)}function vG(i,n){let e=n.producersTail;if(e!==void 0){let a=n.producers;do{if(a===i)return!0;if(a===e)break;a=a.nextProducer}while(a!==void 0)}return!1}function Vw(i,n){return Object.is(i,n)}function Uw(i,n){let e=Object.create(yG);e.computation=i,n!==void 0&&(e.equal=n);let a=()=>{if(zw(e),Xg(e),e.value===Cy)throw e.error;return e.value};return a[$s]=e,Bw(e),a}var kw=Symbol("UNSET"),Fw=Symbol("COMPUTING"),Cy=Symbol("ERRORED"),yG=Ci(Ht({},Yg),{value:kw,dirty:!0,error:null,equal:Vw,kind:"computed",producerMustRecompute(i){return i.value===kw||i.value===Fw},producerRecomputeValue(i){if(i.value===Fw)throw new Error("");let n=i.value;i.value=Fw;let e=Kg(i),a,d=!1;try{a=i.computation(),Ei(null),d=n!==kw&&n!==Cy&&a!==Cy&&i.equal(n,a)}catch(r){a=Cy,i.error=r}finally{Ey(i,e)}if(d){i.value=n;return}i.value=a,i.version++}});function xG(){throw new Error}var FN=xG;function LN(i){FN(i)}function XM(i){FN=i}var bG=null;function KM(i,n){let e=Object.create(jw);e.value=i,n!==void 0&&(e.equal=n);let a=()=>NN(e);return a[$s]=e,Bw(e),[a,C=>Jg(e,C),C=>QM(e,C)]}function NN(i){return Xg(i),i.value}function Jg(i,n){ZM()||LN(i),i.equal(i.value,n)||(i.value=n,wG(i))}function QM(i,n){ZM()||LN(i),Jg(i,n(i.value))}var jw=Ci(Ht({},Yg),{equal:Vw,value:void 0,kind:"signal"});function wG(i){i.version++,PN(),WM(i),bG?.(i)}function ki(i){return typeof i=="function"}function e_(i){let e=i(a=>{Error.call(a),a.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var $w=e_(i=>function(e){i(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((a,d)=>`${d+1}) ${a.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function af(i,n){if(i){let e=i.indexOf(n);0<=e&&i.splice(e,1)}}var Gr=class i{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let r of e)r.remove(this);else e.remove(this);let{initialTeardown:a}=this;if(ki(a))try{a()}catch(r){n=r instanceof $w?r.errors:[r]}let{_finalizers:d}=this;if(d){this._finalizers=null;for(let r of d)try{zN(r)}catch(C){n=n??[],C instanceof $w?n=[...n,...C.errors]:n.push(C)}}if(n)throw new $w(n)}}add(n){var e;if(n&&n!==this)if(this.closed)zN(n);else{if(n instanceof i){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&af(e,n)}remove(n){let{_finalizers:e}=this;e&&af(e,n),n instanceof i&&n._removeParent(this)}};Gr.EMPTY=(()=>{let i=new Gr;return i.closed=!0,i})();var JM=Gr.EMPTY;function Hw(i){return i instanceof Gr||i&&"closed"in i&&ki(i.remove)&&ki(i.add)&&ki(i.unsubscribe)}function zN(i){ki(i)?i():i.unsubscribe()}var wc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var t_={setTimeout(i,n,...e){let{delegate:a}=t_;return a?.setTimeout?a.setTimeout(i,n,...e):setTimeout(i,n,...e)},clearTimeout(i){let{delegate:n}=t_;return(n?.clearTimeout||clearTimeout)(i)},delegate:void 0};function Gw(i){t_.setTimeout(()=>{let{onUnhandledError:n}=wc;if(n)n(i);else throw i})}function Iy(){}var BN=eD("C",void 0,void 0);function VN(i){return eD("E",void 0,i)}function UN(i){return eD("N",i,void 0)}function eD(i,n,e){return{kind:i,value:n,error:e}}var lf=null;function n_(i){if(wc.useDeprecatedSynchronousErrorHandling){let n=!lf;if(n&&(lf={errorThrown:!1,error:null}),i(),n){let{errorThrown:e,error:a}=lf;if(lf=null,e)throw a}}else i()}function jN(i){wc.useDeprecatedSynchronousErrorHandling&&lf&&(lf.errorThrown=!0,lf.error=i)}var cf=class extends Gr{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Hw(n)&&n.add(this)):this.destination=SG}static create(n,e,a){return new Cd(n,e,a)}next(n){this.isStopped?nD(UN(n),this):this._next(n)}error(n){this.isStopped?nD(VN(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?nD(BN,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},CG=Function.prototype.bind;function tD(i,n){return CG.call(i,n)}var iD=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(a){qw(a)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(a){qw(a)}else qw(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){qw(e)}}},Cd=class extends cf{constructor(n,e,a){super();let d;if(ki(n)||!n)d={next:n??void 0,error:e??void 0,complete:a??void 0};else{let r;this&&wc.useDeprecatedNextContext?(r=Object.create(n),r.unsubscribe=()=>this.unsubscribe(),d={next:n.next&&tD(n.next,r),error:n.error&&tD(n.error,r),complete:n.complete&&tD(n.complete,r)}):d=n}this.destination=new iD(d)}};function qw(i){wc.useDeprecatedSynchronousErrorHandling?jN(i):Gw(i)}function EG(i){throw i}function nD(i,n){let{onStoppedNotification:e}=wc;e&&t_.setTimeout(()=>e(i,n))}var SG={closed:!0,next:Iy,error:EG,complete:Iy};var i_=typeof Symbol=="function"&&Symbol.observable||"@@observable";function la(i){return i}function rD(...i){return oD(i)}function oD(i){return i.length===0?la:i.length===1?i[0]:function(e){return i.reduce((a,d)=>d(a),e)}}var Fi=(()=>{class i{constructor(e){e&&(this._subscribe=e)}lift(e){let a=new i;return a.source=this,a.operator=e,a}subscribe(e,a,d){let r=IG(e)?e:new Cd(e,a,d);return n_(()=>{let{operator:C,source:P}=this;r.add(C?C.call(r,P):P?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(e){try{return this._subscribe(e)}catch(a){e.error(a)}}forEach(e,a){return a=$N(a),new a((d,r)=>{let C=new Cd({next:P=>{try{e(P)}catch(k){r(k),C.unsubscribe()}},error:r,complete:d});this.subscribe(C)})}_subscribe(e){var a;return(a=this.source)===null||a===void 0?void 0:a.subscribe(e)}[i_](){return this}pipe(...e){return oD(e)(this)}toPromise(e){return e=$N(e),new e((a,d)=>{let r;this.subscribe(C=>r=C,C=>d(C),()=>a(r))})}}return i.create=n=>new i(n),i})();function $N(i){var n;return(n=i??wc.Promise)!==null&&n!==void 0?n:Promise}function TG(i){return i&&ki(i.next)&&ki(i.error)&&ki(i.complete)}function IG(i){return i&&i instanceof cf||TG(i)&&Hw(i)}function sD(i){return ki(i?.lift)}function Vi(i){return n=>{if(sD(n))return n.lift(function(e){try{return i(e,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function Li(i,n,e,a,d){return new aD(i,n,e,a,d)}var aD=class extends cf{constructor(n,e,a,d,r,C){super(n),this.onFinalize=r,this.shouldUnsubscribe=C,this._next=e?function(P){try{e(P)}catch(k){n.error(k)}}:super._next,this._error=d?function(P){try{d(P)}catch(k){n.error(k)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(P){n.error(P)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function r_(){return Vi((i,n)=>{let e=null;i._refCount++;let a=Li(n,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){e=null;return}let d=i._connection,r=e;e=null,d&&(!r||d===r)&&d.unsubscribe(),n.unsubscribe()});i.subscribe(a),a.closed||(e=i.connect())})}var o_=class extends Fi{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,sD(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Gr;let e=this.getSubject();n.add(this.source.subscribe(Li(e,void 0,()=>{this._teardown(),e.complete()},a=>{this._teardown(),e.error(a)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Gr.EMPTY)}return n}refCount(){return r_()(this)}};var HN=e_(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var li=(()=>{class i extends Fi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let a=new Ww(this,this);return a.operator=e,a}_throwIfClosed(){if(this.closed)throw new HN}next(e){n_(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let a of this.currentObservers)a.next(e)}})}error(e){n_(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:a}=this;for(;a.length;)a.shift().error(e)}})}complete(){n_(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:a,isStopped:d,observers:r}=this;return a||d?JM:(this.currentObservers=null,r.push(e),new Gr(()=>{this.currentObservers=null,af(r,e)}))}_checkFinalizedStatuses(e){let{hasError:a,thrownError:d,isStopped:r}=this;a?e.error(d):r&&e.complete()}asObservable(){let e=new Fi;return e.source=this,e}}return i.create=(n,e)=>new Ww(n,e),i})(),Ww=class extends li{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,a;(a=(e=this.destination)===null||e===void 0?void 0:e.next)===null||a===void 0||a.call(e,n)}error(n){var e,a;(a=(e=this.destination)===null||e===void 0?void 0:e.error)===null||a===void 0||a.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,a;return(a=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&a!==void 0?a:JM}};var zo=class extends li{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:a}=this;if(n)throw e;return this._throwIfClosed(),a}next(n){super.next(this._value=n)}};var lD={now(){return(lD.delegate||Date).now()},delegate:void 0};var Zw=class extends Gr{constructor(n,e){super()}schedule(n,e=0){return this}};var My={setInterval(i,n,...e){let{delegate:a}=My;return a?.setInterval?a.setInterval(i,n,...e):setInterval(i,n,...e)},clearInterval(i){let{delegate:n}=My;return(n?.clearInterval||clearInterval)(i)},delegate:void 0};var Yw=class extends Zw{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var a;if(this.closed)return this;this.state=n;let d=this.id,r=this.scheduler;return d!=null&&(this.id=this.recycleAsyncId(r,d,e)),this.pending=!0,this.delay=e,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(r,this.id,e),this}requestAsyncId(n,e,a=0){return My.setInterval(n.flush.bind(n,this),a)}recycleAsyncId(n,e,a=0){if(a!=null&&this.delay===a&&this.pending===!1)return e;e!=null&&My.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let a=this._execute(n,e);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let a=!1,d;try{this.work(n)}catch(r){a=!0,d=r||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),d}unsubscribe(){if(!this.closed){let{id:n,scheduler:e}=this,{actions:a}=e;this.work=this.state=this.scheduler=null,this.pending=!1,af(a,this),n!=null&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}};var s_=class i{constructor(n,e=i.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,a){return new this.schedulerActionCtor(this,n).schedule(a,e)}};s_.now=lD.now;var Xw=class extends s_{constructor(n,e=s_.now){super(n,e),this.actions=[],this._active=!1}flush(n){let{actions:e}=this;if(this._active){e.push(n);return}let a;this._active=!0;do if(a=n.execute(n.state,n.delay))break;while(n=e.shift());if(this._active=!1,a){for(;n=e.shift();)n.unsubscribe();throw a}}};var uf=new Xw(Yw),GN=uf;var Aa=new Fi(i=>i.complete());function Kw(i){return i&&ki(i.schedule)}function qN(i){return i[i.length-1]}function Qw(i){return ki(qN(i))?i.pop():void 0}function Mh(i){return Kw(qN(i))?i.pop():void 0}function ZN(i,n,e,a){function d(r){return r instanceof e?r:new e(function(C){C(r)})}return new(e||(e=Promise))(function(r,C){function P(oe){try{X(a.next(oe))}catch(Me){C(Me)}}function k(oe){try{X(a.throw(oe))}catch(Me){C(Me)}}function X(oe){oe.done?r(oe.value):d(oe.value).then(P,k)}X((a=a.apply(i,n||[])).next())})}function WN(i){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&i[n],a=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&a>=i.length&&(i=void 0),{value:i&&i[a++],done:!i}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function df(i){return this instanceof df?(this.v=i,this):new df(i)}function YN(i,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e.apply(i,n||[]),d,r=[];return d=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),P("next"),P("throw"),P("return",C),d[Symbol.asyncIterator]=function(){return this},d;function C(ke){return function(ht){return Promise.resolve(ht).then(ke,Me)}}function P(ke,ht){a[ke]&&(d[ke]=function(Nt){return new Promise(function(Mt,Xt){r.push([ke,Nt,Mt,Xt])>1||k(ke,Nt)})},ht&&(d[ke]=ht(d[ke])))}function k(ke,ht){try{X(a[ke](ht))}catch(Nt){$e(r[0][3],Nt)}}function X(ke){ke.value instanceof df?Promise.resolve(ke.value.v).then(oe,Me):$e(r[0][2],ke)}function oe(ke){k("next",ke)}function Me(ke){k("throw",ke)}function $e(ke,ht){ke(ht),r.shift(),r.length&&k(r[0][0],r[0][1])}}function XN(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i[Symbol.asyncIterator],e;return n?n.call(i):(i=typeof WN=="function"?WN(i):i[Symbol.iterator](),e={},a("next"),a("throw"),a("return"),e[Symbol.asyncIterator]=function(){return this},e);function a(r){e[r]=i[r]&&function(C){return new Promise(function(P,k){C=i[r](C),d(P,k,C.done,C.value)})}}function d(r,C,P,k){Promise.resolve(k).then(function(X){r({value:X,done:P})},C)}}var Jw=i=>i&&typeof i.length=="number"&&typeof i!="function";function eC(i){return ki(i?.then)}function tC(i){return ki(i[i_])}function nC(i){return Symbol.asyncIterator&&ki(i?.[Symbol.asyncIterator])}function iC(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function MG(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var rC=MG();function oC(i){return ki(i?.[rC])}function sC(i){return YN(this,arguments,function*(){let e=i.getReader();try{for(;;){let{value:a,done:d}=yield df(e.read());if(d)return yield df(void 0);yield yield df(a)}}finally{e.releaseLock()}})}function aC(i){return ki(i?.getReader)}function lo(i){if(i instanceof Fi)return i;if(i!=null){if(tC(i))return DG(i);if(Jw(i))return AG(i);if(eC(i))return PG(i);if(nC(i))return KN(i);if(oC(i))return OG(i);if(aC(i))return RG(i)}throw iC(i)}function DG(i){return new Fi(n=>{let e=i[i_]();if(ki(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function AG(i){return new Fi(n=>{for(let e=0;e<i.length&&!n.closed;e++)n.next(i[e]);n.complete()})}function PG(i){return new Fi(n=>{i.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Gw)})}function OG(i){return new Fi(n=>{for(let e of i)if(n.next(e),n.closed)return;n.complete()})}function KN(i){return new Fi(n=>{kG(i,n).catch(e=>n.error(e))})}function RG(i){return KN(sC(i))}function kG(i,n){var e,a,d,r;return ZN(this,void 0,void 0,function*(){try{for(e=XN(i);a=yield e.next(),!a.done;){let C=a.value;if(n.next(C),n.closed)return}}catch(C){d={error:C}}finally{try{a&&!a.done&&(r=e.return)&&(yield r.call(e))}finally{if(d)throw d.error}}n.complete()})}function Pa(i,n,e,a=0,d=!1){let r=n.schedule(function(){e(),d?i.add(this.schedule(null,a)):this.unsubscribe()},a);if(i.add(r),!d)return r}function lC(i,n=0){return Vi((e,a)=>{e.subscribe(Li(a,d=>Pa(a,i,()=>a.next(d),n),()=>Pa(a,i,()=>a.complete(),n),d=>Pa(a,i,()=>a.error(d),n)))})}function cC(i,n=0){return Vi((e,a)=>{a.add(i.schedule(()=>e.subscribe(a),n))})}function QN(i,n){return lo(i).pipe(cC(n),lC(n))}function JN(i,n){return lo(i).pipe(cC(n),lC(n))}function e3(i,n){return new Fi(e=>{let a=0;return n.schedule(function(){a===i.length?e.complete():(e.next(i[a++]),e.closed||this.schedule())})})}function t3(i,n){return new Fi(e=>{let a;return Pa(e,n,()=>{a=i[rC](),Pa(e,n,()=>{let d,r;try{({value:d,done:r}=a.next())}catch(C){e.error(C);return}r?e.complete():e.next(d)},0,!0)}),()=>ki(a?.return)&&a.return()})}function uC(i,n){if(!i)throw new Error("Iterable cannot be null");return new Fi(e=>{Pa(e,n,()=>{let a=i[Symbol.asyncIterator]();Pa(e,n,()=>{a.next().then(d=>{d.done?e.complete():e.next(d.value)})},0,!0)})})}function n3(i,n){return uC(sC(i),n)}function i3(i,n){if(i!=null){if(tC(i))return QN(i,n);if(Jw(i))return e3(i,n);if(eC(i))return JN(i,n);if(nC(i))return uC(i,n);if(oC(i))return t3(i,n);if(aC(i))return n3(i,n)}throw iC(i)}function go(i,n){return n?i3(i,n):lo(i)}function Dn(...i){let n=Mh(i);return go(i,n)}function Cc(i,n){let e=ki(i)?i:()=>i,a=d=>d.error(e());return new Fi(n?d=>n.schedule(a,0,d):a)}function dC(i){return!!i&&(i instanceof Fi||ki(i.lift)&&ki(i.subscribe))}var Ed=e_(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function r3(i){return i instanceof Date&&!isNaN(i)}function Qn(i,n){return Vi((e,a)=>{let d=0;e.subscribe(Li(a,r=>{a.next(i.call(n,r,d++))}))})}var{isArray:FG}=Array;function LG(i,n){return FG(n)?i(...n):i(n)}function hC(i){return Qn(n=>LG(i,n))}var{isArray:NG}=Array,{getPrototypeOf:zG,prototype:BG,keys:VG}=Object;function pC(i){if(i.length===1){let n=i[0];if(NG(n))return{args:n,keys:null};if(UG(n)){let e=VG(n);return{args:e.map(a=>n[a]),keys:e}}}return{args:i,keys:null}}function UG(i){return i&&typeof i=="object"&&zG(i)===BG}function fC(i,n){return i.reduce((e,a,d)=>(e[a]=n[d],e),{})}function hf(...i){let n=Mh(i),e=Qw(i),{args:a,keys:d}=pC(i);if(a.length===0)return go([],n);let r=new Fi(jG(a,n,d?C=>fC(d,C):la));return e?r.pipe(hC(e)):r}function jG(i,n,e=la){return a=>{o3(n,()=>{let{length:d}=i,r=new Array(d),C=d,P=d;for(let k=0;k<d;k++)o3(n,()=>{let X=go(i[k],n),oe=!1;X.subscribe(Li(a,Me=>{r[k]=Me,oe||(oe=!0,P--),P||a.next(e(r.slice()))},()=>{--C||a.complete()}))},a)},a)}}function o3(i,n,e){i?Pa(e,i,n):n()}function s3(i,n,e,a,d,r,C,P){let k=[],X=0,oe=0,Me=!1,$e=()=>{Me&&!k.length&&!X&&n.complete()},ke=Nt=>X<a?ht(Nt):k.push(Nt),ht=Nt=>{r&&n.next(Nt),X++;let Mt=!1;lo(e(Nt,oe++)).subscribe(Li(n,Xt=>{d?.(Xt),r?ke(Xt):n.next(Xt)},()=>{Mt=!0},void 0,()=>{if(Mt)try{for(X--;k.length&&X<a;){let Xt=k.shift();C?Pa(n,C,()=>ht(Xt)):ht(Xt)}$e()}catch(Xt){n.error(Xt)}}))};return i.subscribe(Li(n,ke,()=>{Me=!0,$e()})),()=>{P?.()}}function Bo(i,n,e=1/0){return ki(n)?Bo((a,d)=>Qn((r,C)=>n(a,r,d,C))(lo(i(a,d))),e):(typeof n=="number"&&(e=n),Vi((a,d)=>s3(a,d,i,e)))}function a_(i=1/0){return Bo(la,i)}function a3(){return a_(1)}function Dh(...i){return a3()(go(i,Mh(i)))}function Dy(i){return new Fi(n=>{lo(i()).subscribe(n)})}function Ay(...i){let n=Qw(i),{args:e,keys:a}=pC(i),d=new Fi(r=>{let{length:C}=e;if(!C){r.complete();return}let P=new Array(C),k=C,X=C;for(let oe=0;oe<C;oe++){let Me=!1;lo(e[oe]).subscribe(Li(r,$e=>{Me||(Me=!0,X--),P[oe]=$e},()=>k--,void 0,()=>{(!k||!Me)&&(X||r.next(a?fC(a,P):P),r.complete())}))}});return n?d.pipe(hC(n)):d}function mC(i=0,n,e=GN){let a=-1;return n!=null&&(Kw(n)?e=n:a=n),new Fi(d=>{let r=r3(i)?+i-e.now():i;r<0&&(r=0);let C=0;return e.schedule(function(){d.closed||(d.next(C++),0<=a?this.schedule(void 0,a):d.complete())},r)})}function pf(i=0,n=uf){return i<0&&(i=0),mC(i,i,n)}function Ao(i,n){return Vi((e,a)=>{let d=0;e.subscribe(Li(a,r=>i.call(n,r,d++)&&a.next(r)))})}function l3(i){return Vi((n,e)=>{let a=!1,d=null,r=null,C=!1,P=()=>{if(r?.unsubscribe(),r=null,a){a=!1;let X=d;d=null,e.next(X)}C&&e.complete()},k=()=>{r=null,C&&e.complete()};n.subscribe(Li(e,X=>{a=!0,d=X,r||lo(i(X)).subscribe(r=Li(e,P,k))},()=>{C=!0,(!a||!r||r.closed)&&e.complete()}))})}function gC(i,n=uf){return l3(()=>mC(i,n))}function tl(i){return Vi((n,e)=>{let a=null,d=!1,r;a=n.subscribe(Li(e,void 0,void 0,C=>{r=lo(i(C,tl(i)(n))),a?(a.unsubscribe(),a=null,r.subscribe(e)):d=!0})),d&&(a.unsubscribe(),a=null,r.subscribe(e))})}function c3(i,n,e,a,d){return(r,C)=>{let P=e,k=n,X=0;r.subscribe(Li(C,oe=>{let Me=X++;k=P?i(k,oe,Me):(P=!0,oe),a&&C.next(k)},d&&(()=>{P&&C.next(k),C.complete()})))}}function fu(i,n){return ki(n)?Bo(i,n,1):Bo(i,1)}function l_(i,n=uf){return Vi((e,a)=>{let d=null,r=null,C=null,P=()=>{if(d){d.unsubscribe(),d=null;let X=r;r=null,a.next(X)}};function k(){let X=C+i,oe=n.now();if(oe<X){d=this.schedule(void 0,X-oe),a.add(d);return}P()}e.subscribe(Li(a,X=>{r=X,C=n.now(),d||(d=n.schedule(k,i),a.add(d))},()=>{P(),a.complete()},void 0,()=>{r=d=null}))})}function Ah(i){return Vi((n,e)=>{let a=!1;n.subscribe(Li(e,d=>{a=!0,e.next(d)},()=>{a||e.next(i),e.complete()}))})}function nl(i){return i<=0?()=>Aa:Vi((n,e)=>{let a=0;n.subscribe(Li(e,d=>{++a<=i&&(e.next(d),i<=a&&e.complete())}))})}function ff(i,n=la){return i=i??$G,Vi((e,a)=>{let d,r=!0;e.subscribe(Li(a,C=>{let P=n(C);(r||!i(d,P))&&(r=!1,d=P,a.next(C))}))})}function $G(i,n){return i===n}function _C(i=HG){return Vi((n,e)=>{let a=!1;n.subscribe(Li(e,d=>{a=!0,e.next(d)},()=>a?e.complete():e.error(i())))})}function HG(){return new Ed}function Sd(i){return Vi((n,e)=>{try{n.subscribe(e)}finally{e.add(i)}})}function Td(i,n){let e=arguments.length>=2;return a=>a.pipe(i?Ao((d,r)=>i(d,r,a)):la,nl(1),e?Ah(n):_C(()=>new Ed))}function c_(i){return i<=0?()=>Aa:Vi((n,e)=>{let a=[];n.subscribe(Li(e,d=>{a.push(d),i<a.length&&a.shift()},()=>{for(let d of a)e.next(d);e.complete()},void 0,()=>{a=null}))})}function cD(i,n){let e=arguments.length>=2;return a=>a.pipe(i?Ao((d,r)=>i(d,r,a)):la,c_(1),e?Ah(n):_C(()=>new Ed))}function uD(i,n){return Vi(c3(i,n,arguments.length>=2,!0))}function hD(i={}){let{connector:n=()=>new li,resetOnError:e=!0,resetOnComplete:a=!0,resetOnRefCountZero:d=!0}=i;return r=>{let C,P,k,X=0,oe=!1,Me=!1,$e=()=>{P?.unsubscribe(),P=void 0},ke=()=>{$e(),C=k=void 0,oe=Me=!1},ht=()=>{let Nt=C;ke(),Nt?.unsubscribe()};return Vi((Nt,Mt)=>{X++,!Me&&!oe&&$e();let Xt=k=k??n();Mt.add(()=>{X--,X===0&&!Me&&!oe&&(P=dD(ht,d))}),Xt.subscribe(Mt),!C&&X>0&&(C=new Cd({next:Vn=>Xt.next(Vn),error:Vn=>{Me=!0,$e(),P=dD(ke,e,Vn),Xt.error(Vn)},complete:()=>{oe=!0,$e(),P=dD(ke,a),Xt.complete()}}),lo(Nt).subscribe(C))})(r)}}function dD(i,n,...e){if(n===!0){i();return}if(n===!1)return;let a=new Cd({next:()=>{a.unsubscribe(),i()}});return lo(n(...e)).subscribe(a)}function Py(i){return Ao((n,e)=>i<=e)}function u_(...i){let n=Mh(i);return Vi((e,a)=>{(n?Dh(i,e,n):Dh(i,e)).subscribe(a)})}function So(i,n){return Vi((e,a)=>{let d=null,r=0,C=!1,P=()=>C&&!d&&a.complete();e.subscribe(Li(a,k=>{d?.unsubscribe();let X=0,oe=r++;lo(i(k,oe)).subscribe(d=Li(a,Me=>a.next(n?n(k,Me,oe,X++):Me),()=>{d=null,P()}))},()=>{C=!0,P()}))})}function Ec(i){return Vi((n,e)=>{lo(i).subscribe(Li(e,()=>e.complete(),Iy)),!e.closed&&n.subscribe(e)})}function Po(i,n,e){let a=ki(i)||n||e?{next:i,error:n,complete:e}:i;return a?Vi((d,r)=>{var C;(C=a.subscribe)===null||C===void 0||C.call(a);let P=!0;d.subscribe(Li(r,k=>{var X;(X=a.next)===null||X===void 0||X.call(a,k),r.next(k)},()=>{var k;P=!1,(k=a.complete)===null||k===void 0||k.call(a),r.complete()},k=>{var X;P=!1,(X=a.error)===null||X===void 0||X.call(a,k),r.error(k)},()=>{var k,X;P&&((k=a.unsubscribe)===null||k===void 0||k.call(a)),(X=a.finalize)===null||X===void 0||X.call(a)}))}):la}function u3(i){let n=Ei(null);try{return i()}finally{Ei(n)}}var bC="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",sn=class extends Error{code;constructor(n,e){super(mu(n,e)),this.code=n}};function GG(i){return`NG0${Math.abs(i)}`}function mu(i,n){return`${GG(i)}${n?": "+n:""}`}var Al=globalThis;function Rr(i){for(let n in i)if(i[n]===Rr)return n;throw Error("")}function p3(i,n){for(let e in n)n.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(i[e]=n[e])}function Md(i){if(typeof i=="string")return i;if(Array.isArray(i))return`[${i.map(Md).join(", ")}]`;if(i==null)return""+i;let n=i.overriddenName||i.name;if(n)return`${n}`;let e=i.toString();if(e==null)return""+e;let a=e.indexOf(`
`);return a>=0?e.slice(0,a):e}function wC(i,n){return i?n?`${i} ${n}`:i:n||""}var qG=Rr({__forward_ref__:Rr});function gu(i){return i.__forward_ref__=gu,i.toString=function(){return Md(this())},i}function Rs(i){return ED(i)?i():i}function ED(i){return typeof i=="function"&&i.hasOwnProperty(qG)&&i.__forward_ref__===gu}function kt(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function vr(i){return{providers:i.providers||[],imports:i.imports||[]}}function Fy(i){return WG(i,CC)}function SD(i){return Fy(i)!==null}function WG(i,n){return i.hasOwnProperty(n)&&i[n]||null}function ZG(i){let n=i?.[CC]??null;return n||null}function fD(i){return i&&i.hasOwnProperty(yC)?i[yC]:null}var CC=Rr({\u0275prov:Rr}),yC=Rr({\u0275inj:Rr}),Kt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=kt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function TD(i){return i&&!!i.\u0275providers}var ID=Rr({\u0275cmp:Rr}),MD=Rr({\u0275dir:Rr}),DD=Rr({\u0275pipe:Rr}),AD=Rr({\u0275mod:Rr}),Ry=Rr({\u0275fac:Rr}),yf=Rr({__NG_ELEMENT_ID__:Rr}),d3=Rr({__NG_ENV_ID__:Rr});function xf(i){return typeof i=="string"?i:i==null?"":String(i)}function f3(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():xf(i)}var m3=Rr({ngErrorCode:Rr}),YG=Rr({ngErrorMessage:Rr}),XG=Rr({ngTokenPath:Rr});function PD(i,n){return g3("",-200,n)}function EC(i,n){throw new sn(-201,!1)}function g3(i,n,e){let a=new sn(n,i);return a[m3]=n,a[YG]=i,e&&(a[XG]=e),a}function KG(i){return i[m3]}var mD;function _3(){return mD}function ca(i){let n=mD;return mD=i,n}function OD(i,n,e){let a=Fy(i);if(a&&a.providedIn=="root")return a.value===void 0?a.value=a.factory():a.value;if(e&8)return null;if(n!==void 0)return n;EC(i,"Injector")}var QG={},mf=QG,JG="__NG_DI_FLAG__",gD=class{injector;constructor(n){this.injector=n}retrieve(n,e){let a=gf(e)||0;try{return this.injector.get(n,a&8?null:mf,a)}catch(d){if(Zg(d))return d;throw d}}};function eq(i,n=0){let e=Ow();if(e===void 0)throw new sn(-203,!1);if(e===null)return OD(i,void 0,n);{let a=tq(n),d=e.retrieve(i,a);if(Zg(d)){if(a.optional)return null;throw d}return d}}function hn(i,n=0){return(_3()||eq)(Rs(i),n)}function Ve(i,n){return hn(i,gf(n))}function gf(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function tq(i){return{optional:!!(i&8),host:!!(i&1),self:!!(i&2),skipSelf:!!(i&4)}}function _D(i){let n=[];for(let e=0;e<i.length;e++){let a=Rs(i[e]);if(Array.isArray(a)){if(a.length===0)throw new sn(900,!1);let d,r=0;for(let C=0;C<a.length;C++){let P=a[C],k=nq(P);typeof k=="number"?k===-1?d=P.token:r|=k:d=P}n.push(hn(d,r))}else n.push(hn(a))}return n}function nq(i){return i[JG]}function Ph(i,n){let e=i.hasOwnProperty(Ry);return e?i[Ry]:null}function v3(i,n,e){if(i.length!==n.length)return!1;for(let a=0;a<i.length;a++){let d=i[a],r=n[a];if(e&&(d=e(d),r=e(r)),r!==d)return!1}return!0}function y3(i){return i.flat(Number.POSITIVE_INFINITY)}function SC(i,n){i.forEach(e=>Array.isArray(e)?SC(e,n):n(e))}function RD(i,n,e){n>=i.length?i.push(e):i.splice(n,0,e)}function Ly(i,n){return n>=i.length-1?i.pop():i.splice(n,1)[0]}function x3(i,n){let e=[];for(let a=0;a<i;a++)e.push(n);return e}function b3(i,n,e,a){let d=i.length;if(d==n)i.push(e,a);else if(d===1)i.push(a,i[0]),i[0]=e;else{for(d--,i.push(i[d-1],i[d]);d>n;){let r=d-2;i[d]=i[r],d--}i[n]=e,i[n+1]=a}}function TC(i,n,e){let a=h_(i,n);return a>=0?i[a|1]=e:(a=~a,b3(i,a,n,e)),a}function IC(i,n){let e=h_(i,n);if(e>=0)return i[e|1]}function h_(i,n){return iq(i,n,1)}function iq(i,n,e){let a=0,d=i.length>>e;for(;d!==a;){let r=a+(d-a>>1),C=i[r<<e];if(n===C)return r<<e;C>n?d=r:a=r+1}return~(d<<e)}var Rh={},ua=[],_u=new Kt(""),kD=new Kt("",-1),FD=new Kt(""),ky=class{get(n,e=mf){if(e===mf){let d=g3("",-201);throw d.name="\u0275NotFound",d}return e}};function LD(i){return i[AD]||null}function vu(i){return i[ID]||null}function ND(i){return i[MD]||null}function w3(i){return i[DD]||null}function Sc(i){return{\u0275providers:i}}function C3(i){return Sc([{provide:_u,multi:!0,useValue:i}])}function E3(...i){return{\u0275providers:zD(!0,i),\u0275fromNgModule:!0}}function zD(i,...n){let e=[],a=new Set,d,r=C=>{e.push(C)};return SC(n,C=>{let P=C;xC(P,r,[],a)&&(d||=[],d.push(P))}),d!==void 0&&S3(d,r),e}function S3(i,n){for(let e=0;e<i.length;e++){let{ngModule:a,providers:d}=i[e];BD(d,r=>{n(r,a)})}}function xC(i,n,e,a){if(i=Rs(i),!i)return!1;let d=null,r=fD(i),C=!r&&vu(i);if(!r&&!C){let k=i.ngModule;if(r=fD(k),r)d=k;else return!1}else{if(C&&!C.standalone)return!1;d=i}let P=a.has(d);if(C){if(P)return!1;if(a.add(d),C.dependencies){let k=typeof C.dependencies=="function"?C.dependencies():C.dependencies;for(let X of k)xC(X,n,e,a)}}else if(r){if(r.imports!=null&&!P){a.add(d);let X;try{SC(r.imports,oe=>{xC(oe,n,e,a)&&(X||=[],X.push(oe))})}finally{}X!==void 0&&S3(X,n)}if(!P){let X=Ph(d)||(()=>new d);n({provide:d,useFactory:X,deps:ua},d),n({provide:FD,useValue:d,multi:!0},d),n({provide:_u,useValue:()=>hn(d),multi:!0},d)}let k=r.providers;if(k!=null&&!P){let X=i;BD(k,oe=>{n(oe,X)})}}else return!1;return d!==i&&i.providers!==void 0}function BD(i,n){for(let e of i)TD(e)&&(e=e.\u0275providers),Array.isArray(e)?BD(e,n):n(e)}var rq=Rr({provide:String,useValue:Rr});function T3(i){return i!==null&&typeof i=="object"&&rq in i}function oq(i){return!!(i&&i.useExisting)}function sq(i){return!!(i&&i.useFactory)}function _f(i){return typeof i=="function"}function I3(i){return!!i.useClass}var Ny=new Kt(""),vC={},h3={},pD;function p_(){return pD===void 0&&(pD=new ky),pD}var Yr=class{},vf=class extends Yr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,a,d){super(),this.parent=e,this.source=a,this.scopes=d,yD(n,C=>this.processProvider(C)),this.records.set(kD,d_(void 0,this)),d.has("environment")&&this.records.set(Yr,d_(void 0,this));let r=this.records.get(Ny);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(FD,ua,{self:!0}))}retrieve(n,e){let a=gf(e)||0;try{return this.get(n,mf,a)}catch(d){if(Zg(d))return d;throw d}}destroy(){Oy(this),this._destroyed=!0;let n=Ei(null);try{for(let a of this._ngOnDestroyHooks)a.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let a of e)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ei(n)}}onDestroy(n){return Oy(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){Oy(this);let e=pu(this),a=ca(void 0),d;try{return n()}finally{pu(e),ca(a)}}get(n,e=mf,a){if(Oy(this),n.hasOwnProperty(d3))return n[d3](this);let d=gf(a),r,C=pu(this),P=ca(void 0);try{if(!(d&4)){let X=this.records.get(n);if(X===void 0){let oe=dq(n)&&Fy(n);oe&&this.injectableDefInScope(oe)?X=d_(vD(n),vC):X=null,this.records.set(n,X)}if(X!=null)return this.hydrate(n,X,d)}let k=d&2?p_():this.parent;return e=d&8&&e===mf?null:e,k.get(n,e)}catch(k){let X=KG(k);throw X===-200||X===-201?new sn(X,null):k}finally{ca(P),pu(C)}}resolveInjectorInitializers(){let n=Ei(null),e=pu(this),a=ca(void 0),d;try{let r=this.get(_u,ua,{self:!0});for(let C of r)C()}finally{pu(e),ca(a),Ei(n)}}toString(){let n=[],e=this.records;for(let a of e.keys())n.push(Md(a));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Rs(n);let e=_f(n)?n:Rs(n&&n.provide),a=lq(n);if(!_f(n)&&n.multi===!0){let d=this.records.get(e);d||(d=d_(void 0,vC,!0),d.factory=()=>_D(d.multi),this.records.set(e,d)),e=n,d.multi.push(n)}this.records.set(e,a)}hydrate(n,e,a){let d=Ei(null);try{if(e.value===h3)throw PD(Md(n));return e.value===vC&&(e.value=h3,e.value=e.factory(void 0,a)),typeof e.value=="object"&&e.value&&uq(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Ei(d)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Rs(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function vD(i){let n=Fy(i),e=n!==null?n.factory:Ph(i);if(e!==null)return e;if(i instanceof Kt)throw new sn(204,!1);if(i instanceof Function)return aq(i);throw new sn(204,!1)}function aq(i){if(i.length>0)throw new sn(204,!1);let e=ZG(i);return e!==null?()=>e.factory(i):()=>new i}function lq(i){if(T3(i))return d_(void 0,i.useValue);{let n=VD(i);return d_(n,vC)}}function VD(i,n,e){let a;if(_f(i)){let d=Rs(i);return Ph(d)||vD(d)}else if(T3(i))a=()=>Rs(i.useValue);else if(sq(i))a=()=>i.useFactory(..._D(i.deps||[]));else if(oq(i))a=(d,r)=>hn(Rs(i.useExisting),r!==void 0&&r&8?8:void 0);else{let d=Rs(i&&(i.useClass||i.provide));if(cq(i))a=()=>new d(..._D(i.deps));else return Ph(d)||vD(d)}return a}function Oy(i){if(i.destroyed)throw new sn(205,!1)}function d_(i,n,e=!1){return{factory:i,value:n,multi:e?[]:void 0}}function cq(i){return!!i.deps}function uq(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function dq(i){return typeof i=="function"||typeof i=="object"&&i.ngMetadataName==="InjectionToken"}function yD(i,n){for(let e of i)Array.isArray(e)?yD(e,n):e&&TD(e)?yD(e.\u0275providers,n):n(e)}function ys(i,n){let e;i instanceof vf?(Oy(i),e=i):e=new gD(i);let a,d=pu(e),r=ca(void 0);try{return n()}finally{pu(d),ca(r)}}function M3(){return _3()!==void 0||Ow()!=null}var Tc=0,ni=1,Si=2,ls=3,Pl=4,da=5,bf=6,f_=7,Vo=8,Ad=9,yu=10,co=11,m_=12,UD=13,wf=14,ha=15,kh=16,Cf=17,xu=18,zy=19,jD=20,Id=21,MC=22,By=23,il=24,Ef=25,Sf=26,uo=27,D3=1,$D=6,Fh=7,Vy=8,Tf=9,Oo=10;function bu(i){return Array.isArray(i)&&typeof i[D3]=="object"}function Ic(i){return Array.isArray(i)&&i[D3]===!0}function HD(i){return(i.flags&4)!==0}function Lh(i){return i.componentOffset>-1}function Uy(i){return(i.flags&1)===1}function wu(i){return!!i.template}function g_(i){return(i[Si]&512)!==0}function If(i){return(i[Si]&256)===256}var A3="svg",P3="math";function Ol(i){for(;Array.isArray(i);)i=i[Tc];return i}function GD(i,n){return Ol(n[i])}function Mc(i,n){return Ol(n[i.index])}function jy(i,n){return i.data[n]}function $y(i,n){return i[n]}function qD(i,n,e,a){e>=i.data.length&&(i.data[e]=null,i.blueprint[e]=null),n[e]=a}function Rl(i,n){let e=n[i];return bu(e)?e:e[Tc]}function O3(i){return(i[Si]&4)===4}function DC(i){return(i[Si]&128)===128}function R3(i){return Ic(i[ls])}function kl(i,n){return n==null?null:i[n]}function WD(i){i[Cf]=0}function ZD(i){i[Si]&1024||(i[Si]|=1024,DC(i)&&__(i))}function k3(i,n){for(;i>0;)n=n[wf],i--;return n}function Hy(i){return!!(i[Si]&9216||i[il]?.dirty)}function AC(i){i[yu].changeDetectionScheduler?.notify(8),i[Si]&64&&(i[Si]|=1024),Hy(i)&&__(i)}function __(i){i[yu].changeDetectionScheduler?.notify(0);let n=Oh(i);for(;n!==null&&!(n[Si]&8192||(n[Si]|=8192,!DC(n)));)n=Oh(n)}function YD(i,n){if(If(i))throw new sn(911,!1);i[Id]===null&&(i[Id]=[]),i[Id].push(n)}function F3(i,n){if(i[Id]===null)return;let e=i[Id].indexOf(n);e!==-1&&i[Id].splice(e,1)}function Oh(i){let n=i[ls];return Ic(n)?n[ls]:n}function XD(i){return i[f_]??=[]}function KD(i){return i.cleanup??=[]}function L3(i,n,e,a){let d=XD(n);d.push(e),i.firstCreatePass&&KD(i).push(a,d.length-1)}var qi={lFrame:Z3(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var xD=!1;function N3(){return qi.lFrame.elementDepthCount}function z3(){qi.lFrame.elementDepthCount++}function QD(){qi.lFrame.elementDepthCount--}function JD(){return qi.bindingsEnabled}function e2(){return qi.skipHydrationRootTNode!==null}function t2(i){return qi.skipHydrationRootTNode===i}function n2(){qi.skipHydrationRootTNode=null}function yi(){return qi.lFrame.lView}function Uo(){return qi.lFrame.tView}function Ee(i){return qi.lFrame.contextLView=i,i[Vo]}function Se(i){return qi.lFrame.contextLView=null,i}function ks(){let i=i2();for(;i!==null&&i.type===64;)i=i.parent;return i}function i2(){return qi.lFrame.currentTNode}function B3(){let i=qi.lFrame,n=i.currentTNode;return i.isParent?n:n.parent}function v_(i,n){let e=qi.lFrame;e.currentTNode=i,e.isParent=n}function r2(){return qi.lFrame.isParent}function o2(){qi.lFrame.isParent=!1}function V3(){return qi.lFrame.contextLView}function s2(){return xD}function a2(i){let n=xD;return xD=i,n}function Gy(){let i=qi.lFrame,n=i.bindingRootIndex;return n===-1&&(n=i.bindingRootIndex=i.tView.bindingStartIndex),n}function U3(){return qi.lFrame.bindingIndex}function j3(i){return qi.lFrame.bindingIndex=i}function Mf(){return qi.lFrame.bindingIndex++}function PC(i){let n=qi.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+i,e}function $3(){return qi.lFrame.inI18n}function H3(i,n){let e=qi.lFrame;e.bindingIndex=e.bindingRootIndex=i,OC(n)}function G3(){return qi.lFrame.currentDirectiveIndex}function OC(i){qi.lFrame.currentDirectiveIndex=i}function q3(i){let n=qi.lFrame.currentDirectiveIndex;return n===-1?null:i[n]}function l2(){return qi.lFrame.currentQueryIndex}function RC(i){qi.lFrame.currentQueryIndex=i}function hq(i){let n=i[ni];return n.type===2?n.declTNode:n.type===1?i[da]:null}function c2(i,n,e){if(e&4){let d=n,r=i;for(;d=d.parent,d===null&&!(e&1);)if(d=hq(r),d===null||(r=r[wf],d.type&10))break;if(d===null)return!1;n=d,i=r}let a=qi.lFrame=W3();return a.currentTNode=n,a.lView=i,!0}function kC(i){let n=W3(),e=i[ni];qi.lFrame=n,n.currentTNode=e.firstChild,n.lView=i,n.tView=e,n.contextLView=i,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function W3(){let i=qi.lFrame,n=i===null?null:i.child;return n===null?Z3(i):n}function Z3(i){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=n),n}function Y3(){let i=qi.lFrame;return qi.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var u2=Y3;function FC(){let i=Y3();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function X3(i){return(qi.lFrame.contextLView=k3(i,qi.lFrame.contextLView))[Vo]}function Cu(){return qi.lFrame.selectedIndex}function Nh(i){qi.lFrame.selectedIndex=i}function LC(){let i=qi.lFrame;return jy(i.tView,i.selectedIndex)}function K3(){return qi.lFrame.currentNamespace}var Q3=!0;function NC(){return Q3}function zC(i){Q3=i}function bD(i,n=null,e=null,a){let d=d2(i,n,e,a);return d.resolveInjectorInitializers(),d}function d2(i,n=null,e=null,a,d=new Set){let r=[e||ua,E3(i)];return a=a||(typeof i=="object"?void 0:Md(i)),new vf(r,n||p_(),a||null,d)}var hr=class i{static THROW_IF_NOT_FOUND=mf;static NULL=new ky;static create(n,e){if(Array.isArray(n))return bD({name:""},e,n,"");{let a=n.name??"";return bD({name:a},n.parent,n.providers,a)}}static \u0275prov=kt({token:i,providedIn:"any",factory:()=>hn(kD)});static __NG_ELEMENT_ID__=-1},si=new Kt(""),Fl=(()=>{class i{static __NG_ELEMENT_ID__=pq;static __NG_ENV_ID__=e=>e}return i})(),wD=class extends Fl{_lView;constructor(n){super(),this._lView=n}get destroyed(){return If(this._lView)}onDestroy(n){let e=this._lView;return YD(e,n),()=>F3(e,n)}};function pq(){return new wD(yi())}var Hs=class{_console=console;handleError(n){this._console.error("ERROR",n)}},Gs=new Kt("",{providedIn:"root",factory:()=>{let i=Ve(Yr),n;return e=>{i.destroyed&&!n?setTimeout(()=>{throw e}):(n??=i.get(Hs),n.handleError(e))}}}),J3={provide:_u,useValue:()=>void Ve(Hs),multi:!0},fq=new Kt("",{providedIn:"root",factory:()=>{let i=Ve(si).defaultView;if(!i)return;let n=Ve(Gs),e=r=>{n(r.reason),r.preventDefault()},a=r=>{r.error?n(r.error):n(new Error(r.message,{cause:r})),r.preventDefault()},d=()=>{i.addEventListener("unhandledrejection",e),i.addEventListener("error",a)};typeof Zone<"u"?Zone.root.run(d):d(),Ve(Fl).onDestroy(()=>{i.removeEventListener("error",a),i.removeEventListener("unhandledrejection",e)})}});function h2(){return Sc([C3(()=>void Ve(fq))])}function p2(i){return typeof i=="function"&&i[$s]!==void 0}function qs(i,n){let[e,a,d]=KM(i,n?.equal),r=e,C=r[$s];return r.set=a,r.update=d,r.asReadonly=ez.bind(r),r}function ez(){let i=this[$s];if(i.readonlyFn===void 0){let n=()=>this();n[$s]=i,i.readonlyFn=n}return i.readonlyFn}function f2(i){return p2(i)&&typeof i.set=="function"}var BC=(()=>{class i{view;node;constructor(e,a){this.view=e,this.node=a}static __NG_ELEMENT_ID__=mq}return i})();function mq(){return new BC(yi(),ks())}var Dd=class{},y_=new Kt("",{providedIn:"root",factory:()=>!1});var m2=new Kt(""),g2=new Kt(""),Eu=(()=>{class i{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new zo(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Fi(e=>{e.next(!1),e.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new i})}return i})(),VC=(()=>{class i{internalPendingTasks=Ve(Eu);scheduler=Ve(Dd);errorHandler=Ve(Gs);add(){let e=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(e)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(e))}}run(e){let a=this.add();e().catch(this.errorHandler).finally(a)}static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new i})}return i})();function qy(...i){}var _2=(()=>{class i{static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new CD})}return i})(),CD=class{dirtyEffectCount=0;queues=new Map;add(n){this.enqueue(n),this.schedule(n)}schedule(n){n.dirty&&this.dirtyEffectCount++}remove(n){let e=n.zone,a=this.queues.get(e);a.has(n)&&(a.delete(n),n.dirty&&this.dirtyEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let a=this.queues.get(e);a.has(n)||a.add(n)}flush(){for(;this.dirtyEffectCount>0;){let n=!1;for(let[e,a]of this.queues)e===null?n||=this.flushQueue(a):n||=e.run(()=>this.flushQueue(a));n||(this.dirtyEffectCount=0)}}flushQueue(n){let e=!1;for(let a of n)a.dirty&&(this.dirtyEffectCount--,e=!0,a.run());return e}};function tx(i){return{toString:i}.toString()}function Cq(i){return typeof i=="function"}var XC=class{previousValue;currentValue;firstChange;constructor(n,e,a){this.previousValue=n,this.currentValue=e,this.firstChange=a}isFirstChange(){return this.firstChange}};function Fz(i,n,e,a){n!==null?n.applyValueToInputSignal(n,a):i[e]=a}var Br=(()=>{let i=()=>Lz;return i.ngInherit=!0,i})();function Lz(i){return i.type.prototype.ngOnChanges&&(i.setInput=Sq),Eq}function Eq(){let i=zz(this),n=i?.current;if(n){let e=i.previous;if(e===Rh)i.previous=n;else for(let a in n)e[a]=n[a];i.current=null,this.ngOnChanges(n)}}function Sq(i,n,e,a,d){let r=this.declaredInputs[a],C=zz(i)||Tq(i,{previous:Rh,current:null}),P=C.current||(C.current={}),k=C.previous,X=k[r];P[r]=new XC(X&&X.currentValue,e,k===Rh),Fz(i,n,d,e)}var Nz="__ngSimpleChanges__";function zz(i){return i[Nz]||null}function Tq(i,n){return i[Nz]=n}var tz=[];var zr=function(i,n=null,e){for(let a=0;a<tz.length;a++){let d=tz[a];d(i,n,e)}};function Iq(i,n,e){let{ngOnChanges:a,ngOnInit:d,ngDoCheck:r}=n.type.prototype;if(a){let C=Lz(n);(e.preOrderHooks??=[]).push(i,C),(e.preOrderCheckHooks??=[]).push(i,C)}d&&(e.preOrderHooks??=[]).push(0-i,d),r&&((e.preOrderHooks??=[]).push(i,r),(e.preOrderCheckHooks??=[]).push(i,r))}function Bz(i,n){for(let e=n.directiveStart,a=n.directiveEnd;e<a;e++){let r=i.data[e].type.prototype,{ngAfterContentInit:C,ngAfterContentChecked:P,ngAfterViewInit:k,ngAfterViewChecked:X,ngOnDestroy:oe}=r;C&&(i.contentHooks??=[]).push(-e,C),P&&((i.contentHooks??=[]).push(e,P),(i.contentCheckHooks??=[]).push(e,P)),k&&(i.viewHooks??=[]).push(-e,k),X&&((i.viewHooks??=[]).push(e,X),(i.viewCheckHooks??=[]).push(e,X)),oe!=null&&(i.destroyHooks??=[]).push(e,oe)}}function qC(i,n,e){Vz(i,n,3,e)}function WC(i,n,e,a){(i[Si]&3)===e&&Vz(i,n,e,a)}function v2(i,n){let e=i[Si];(e&3)===n&&(e&=16383,e+=1,i[Si]=e)}function Vz(i,n,e,a){let d=a!==void 0?i[Cf]&65535:0,r=a??-1,C=n.length-1,P=0;for(let k=d;k<C;k++)if(typeof n[k+1]=="number"){if(P=n[k],a!=null&&P>=a)break}else n[k]<0&&(i[Cf]+=65536),(P<r||r==-1)&&(Mq(i,e,n,k),i[Cf]=(i[Cf]&4294901760)+k+2),k++}function nz(i,n){zr(4,i,n);let e=Ei(null);try{n.call(i)}finally{Ei(e),zr(5,i,n)}}function Mq(i,n,e,a){let d=e[a]<0,r=e[a+1],C=d?-e[a]:e[a],P=i[C];d?i[Si]>>14<i[Cf]>>16&&(i[Si]&3)===n&&(i[Si]+=16384,nz(P,r)):nz(P,r)}var b_=-1,Af=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,a,d){this.factory=n,this.name=d,this.canSeeViewProviders=e,this.injectImpl=a}};function Dq(i){return(i.flags&8)!==0}function Aq(i){return(i.flags&16)!==0}function Pq(i,n,e){let a=0;for(;a<e.length;){let d=e[a];if(typeof d=="number"){if(d!==0)break;a++;let r=e[a++],C=e[a++],P=e[a++];i.setAttribute(n,C,P,r)}else{let r=d,C=e[++a];Oq(r)?i.setProperty(n,r,C):i.setAttribute(n,r,C),a++}}return a}function Uz(i){return i===3||i===4||i===6}function Oq(i){return i.charCodeAt(0)===64}function w_(i,n){if(!(n===null||n.length===0))if(i===null||i.length===0)i=n.slice();else{let e=-1;for(let a=0;a<n.length;a++){let d=n[a];typeof d=="number"?e=d:e===0||(e===-1||e===2?iz(i,e,d,null,n[++a]):iz(i,e,d,null,null))}}return i}function iz(i,n,e,a,d){let r=0,C=i.length;if(n===-1)C=-1;else for(;r<i.length;){let P=i[r++];if(typeof P=="number"){if(P===n){C=-1;break}else if(P>n){C=r-1;break}}}for(;r<i.length;){let P=i[r];if(typeof P=="number")break;if(P===e){d!==null&&(i[r+1]=d);return}r++,d!==null&&r++}C!==-1&&(i.splice(C,0,n),r=C+1),i.splice(r++,0,e),d!==null&&i.splice(r++,0,d)}function jz(i){return i!==b_}function KC(i){return i&32767}function Rq(i){return i>>16}function QC(i,n){let e=Rq(i),a=n;for(;e>0;)a=a[wf],e--;return a}var A2=!0;function JC(i){let n=A2;return A2=i,n}var kq=256,$z=kq-1,Hz=5,Fq=0,Su={};function Lq(i,n,e){let a;typeof e=="string"?a=e.charCodeAt(0)||0:e.hasOwnProperty(yf)&&(a=e[yf]),a==null&&(a=e[yf]=Fq++);let d=a&$z,r=1<<d;n.data[i+(d>>Hz)]|=r}function eE(i,n){let e=Gz(i,n);if(e!==-1)return e;let a=n[ni];a.firstCreatePass&&(i.injectorIndex=n.length,y2(a.data,i),y2(n,null),y2(a.blueprint,null));let d=mA(i,n),r=i.injectorIndex;if(jz(d)){let C=KC(d),P=QC(d,n),k=P[ni].data;for(let X=0;X<8;X++)n[r+X]=P[C+X]|k[C+X]}return n[r+8]=d,r}function y2(i,n){i.push(0,0,0,0,0,0,0,0,n)}function Gz(i,n){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||n[i.injectorIndex+8]===null?-1:i.injectorIndex}function mA(i,n){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let e=0,a=null,d=n;for(;d!==null;){if(a=Xz(d),a===null)return b_;if(e++,d=d[wf],a.injectorIndex!==-1)return a.injectorIndex|e<<16}return b_}function P2(i,n,e){Lq(i,n,e)}function Nq(i,n){if(n==="class")return i.classes;if(n==="style")return i.styles;let e=i.attrs;if(e){let a=e.length,d=0;for(;d<a;){let r=e[d];if(Uz(r))break;if(r===0)d=d+2;else if(typeof r=="number")for(d++;d<a&&typeof e[d]=="string";)d++;else{if(r===n)return e[d+1];d=d+2}}}return null}function qz(i,n,e){if(e&8||i!==void 0)return i;EC(n,"NodeInjector")}function Wz(i,n,e,a){if(e&8&&a===void 0&&(a=null),(e&3)===0){let d=i[Ad],r=ca(void 0);try{return d?d.get(n,a,e&8):OD(n,a,e&8)}finally{ca(r)}}return qz(a,n,e)}function Zz(i,n,e,a=0,d){if(i!==null){if(n[Si]&2048&&!(a&2)){let C=Uq(i,n,e,a,Su);if(C!==Su)return C}let r=Yz(i,n,e,a,Su);if(r!==Su)return r}return Wz(n,e,a,d)}function Yz(i,n,e,a,d){let r=Bq(e);if(typeof r=="function"){if(!c2(n,i,a))return a&1?qz(d,e,a):Wz(n,e,a,d);try{let C;if(C=r(a),C==null&&!(a&8))EC(e);else return C}finally{u2()}}else if(typeof r=="number"){let C=null,P=Gz(i,n),k=b_,X=a&1?n[ha][da]:null;for((P===-1||a&4)&&(k=P===-1?mA(i,n):n[P+8],k===b_||!oz(a,!1)?P=-1:(C=n[ni],P=KC(k),n=QC(k,n)));P!==-1;){let oe=n[ni];if(rz(r,P,oe.data)){let Me=zq(P,n,e,C,a,X);if(Me!==Su)return Me}k=n[P+8],k!==b_&&oz(a,n[ni].data[P+8]===X)&&rz(r,P,n)?(C=oe,P=KC(k),n=QC(k,n)):P=-1}}return d}function zq(i,n,e,a,d,r){let C=n[ni],P=C.data[i+8],k=a==null?Lh(P)&&A2:a!=C&&(P.type&3)!==0,X=d&1&&r===P,oe=ZC(P,C,e,k,X);return oe!==null?Yy(n,C,oe,P,d):Su}function ZC(i,n,e,a,d){let r=i.providerIndexes,C=n.data,P=r&1048575,k=i.directiveStart,X=i.directiveEnd,oe=r>>20,Me=a?P:P+oe,$e=d?P+oe:X;for(let ke=Me;ke<$e;ke++){let ht=C[ke];if(ke<k&&e===ht||ke>=k&&ht.type===e)return ke}if(d){let ke=C[k];if(ke&&wu(ke)&&ke.type===e)return k}return null}function Yy(i,n,e,a,d){let r=i[e],C=n.data;if(r instanceof Af){let P=r;if(P.resolving){let ke=f3(C[e]);throw PD(ke)}let k=JC(P.canSeeViewProviders);P.resolving=!0;let X=C[e].type||C[e],oe,Me=P.injectImpl?ca(P.injectImpl):null,$e=c2(i,a,0);try{r=i[e]=P.factory(void 0,d,C,i,a),n.firstCreatePass&&e>=a.directiveStart&&Iq(e,C[e],n)}finally{Me!==null&&ca(Me),JC(k),P.resolving=!1,u2()}}return r}function Bq(i){if(typeof i=="string")return i.charCodeAt(0)||0;let n=i.hasOwnProperty(yf)?i[yf]:void 0;return typeof n=="number"?n>=0?n&$z:Vq:n}function rz(i,n,e){let a=1<<i;return!!(e[n+(i>>Hz)]&a)}function oz(i,n){return!(i&2)&&!(i&1&&n)}var Df=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,a){return Zz(this._tNode,this._lView,n,gf(a),e)}};function Vq(){return new Df(ks(),yi())}function Mu(i){return tx(()=>{let n=i.prototype.constructor,e=n[Ry]||O2(n),a=Object.prototype,d=Object.getPrototypeOf(i.prototype).constructor;for(;d&&d!==a;){let r=d[Ry]||O2(d);if(r&&r!==e)return r;d=Object.getPrototypeOf(d)}return r=>new r})}function O2(i){return ED(i)?()=>{let n=O2(Rs(i));return n&&n()}:Ph(i)}function Uq(i,n,e,a,d){let r=i,C=n;for(;r!==null&&C!==null&&C[Si]&2048&&!g_(C);){let P=Yz(r,C,e,a|2,Su);if(P!==Su)return P;let k=r.parent;if(!k){let X=C[jD];if(X){let oe=X.get(e,Su,a);if(oe!==Su)return oe}k=Xz(C),C=C[wf]}r=k}return d}function Xz(i){let n=i[ni],e=n.type;return e===2?n.declTNode:e===1?i[da]:null}function nx(i){return Nq(ks(),i)}function jq(){return T_(ks(),yi())}function T_(i,n){return new pr(Mc(i,n))}var pr=(()=>{class i{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=jq}return i})();function $q(i){return i instanceof pr?i.nativeElement:i}function Hq(){return this._results[Symbol.iterator]()}var tE=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new li}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;let a=y3(n);(this._changesDetected=!v3(this._results,a,e))&&(this._results=a,this.length=a.length,this.last=a[this.length-1],this.first=a[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=Hq};function Kz(i){return(i.flags&128)===128}var gA=(function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i})(gA||{}),Qz=new Map,Gq=0;function qq(){return Gq++}function Wq(i){Qz.set(i[zy],i)}function R2(i){Qz.delete(i[zy])}var sz="__ngContext__";function C_(i,n){bu(n)?(i[sz]=n[zy],Wq(n)):i[sz]=n}function Jz(i){return tB(i[m_])}function eB(i){return tB(i[Pl])}function tB(i){for(;i!==null&&!Ic(i);)i=i[Pl];return i}var k2;function _A(i){k2=i}function nB(){if(k2!==void 0)return k2;if(typeof document<"u")return document;throw new sn(210,!1)}var I_=new Kt("",{providedIn:"root",factory:()=>Zq}),Zq="ng",gE=new Kt(""),Rf=new Kt("",{providedIn:"platform",factory:()=>"unknown"});var ix=new Kt(""),M_=new Kt("",{providedIn:"root",factory:()=>nB().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Yq="h",Xq="b";var iB="r";var rB="di";var oB=!1,sB=new Kt("",{providedIn:"root",factory:()=>oB});var _E=new Kt("");var Kq=(i,n,e,a)=>{};function Qq(i,n,e,a){Kq(i,n,e,a)}function vE(i){return(i.flags&32)===32}var Jq=()=>null;function aB(i,n,e=!1){return Jq(i,n,e)}function lB(i,n){let e=i.contentQueries;if(e!==null){let a=Ei(null);try{for(let d=0;d<e.length;d+=2){let r=e[d],C=e[d+1];if(C!==-1){let P=i.data[C];RC(r),P.contentQueries(2,n[C],C)}}}finally{Ei(a)}}}function F2(i,n,e){RC(0);let a=Ei(null);try{n(i,e)}finally{Ei(a)}}function cB(i,n,e){if(HD(n)){let a=Ei(null);try{let d=n.directiveStart,r=n.directiveEnd;for(let C=d;C<r;C++){let P=i.data[C];if(P.contentQueries){let k=e[C];P.contentQueries(1,k,C)}}}finally{Ei(a)}}}var Pd=(function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i})(Pd||{});var UC;function e9(){if(UC===void 0&&(UC=null,Al.trustedTypes))try{UC=Al.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return UC}function yE(i){return e9()?.createHTML(i)||i}var jC;function t9(){if(jC===void 0&&(jC=null,Al.trustedTypes))try{jC=Al.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return jC}function az(i){return t9()?.createScriptURL(i)||i}var Od=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${bC})`}},L2=class extends Od{getTypeName(){return"HTML"}},N2=class extends Od{getTypeName(){return"Style"}},z2=class extends Od{getTypeName(){return"Script"}},B2=class extends Od{getTypeName(){return"URL"}},V2=class extends Od{getTypeName(){return"ResourceURL"}};function Nl(i){return i instanceof Od?i.changingThisBreaksApplicationSecurity:i}function Rd(i,n){let e=uB(i);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${bC})`)}return e===n}function uB(i){return i instanceof Od&&i.getTypeName()||null}function vA(i){return new L2(i)}function yA(i){return new N2(i)}function xA(i){return new z2(i)}function bA(i){return new B2(i)}function wA(i){return new V2(i)}function n9(i){let n=new j2(i);return i9()?new U2(n):n}var U2=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let e=new window.DOMParser().parseFromString(yE(n),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(n):(e.firstChild?.remove(),e)}catch{return null}}},j2=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let e=this.inertDocument.createElement("template");return e.innerHTML=yE(n),e}};function i9(){try{return!!new window.DOMParser().parseFromString(yE(""),"text/html")}catch{return!1}}var r9=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function rx(i){return i=String(i),i.match(r9)?i:"unsafe:"+i}function kd(i){let n={};for(let e of i.split(","))n[e]=!0;return n}function ox(...i){let n={};for(let e of i)for(let a in e)e.hasOwnProperty(a)&&(n[a]=!0);return n}var dB=kd("area,br,col,hr,img,wbr"),hB=kd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),pB=kd("rp,rt"),o9=ox(pB,hB),s9=ox(hB,kd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),a9=ox(pB,kd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),lz=ox(dB,s9,a9,o9),fB=kd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),l9=kd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),c9=kd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),u9=ox(fB,l9,c9),d9=kd("script,style,template"),$2=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let e=n.firstChild,a=!0,d=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?a=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,a&&e.firstChild){d.push(e),e=f9(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=p9(e);if(r){e=r;break}e=d.pop()}}return this.buf.join("")}startElement(n){let e=cz(n).toLowerCase();if(!lz.hasOwnProperty(e))return this.sanitizedSomething=!0,!d9.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let a=n.attributes;for(let d=0;d<a.length;d++){let r=a.item(d),C=r.name,P=C.toLowerCase();if(!u9.hasOwnProperty(P)){this.sanitizedSomething=!0;continue}let k=r.value;fB[P]&&(k=rx(k)),this.buf.push(" ",C,'="',uz(k),'"')}return this.buf.push(">"),!0}endElement(n){let e=cz(n).toLowerCase();lz.hasOwnProperty(e)&&!dB.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(uz(n))}};function h9(i,n){return(i.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function p9(i){let n=i.nextSibling;if(n&&i!==n.previousSibling)throw mB(n);return n}function f9(i){let n=i.firstChild;if(n&&h9(i,n))throw mB(n);return n}function cz(i){let n=i.nodeName;return typeof n=="string"?n:"FORM"}function mB(i){return new Error(`Failed to sanitize html because the element is clobbered: ${i.outerHTML}`)}var m9=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,g9=/([^\#-~ |!])/g;function uz(i){return i.replace(/&/g,"&amp;").replace(m9,function(n){let e=n.charCodeAt(0),a=n.charCodeAt(1);return"&#"+((e-55296)*1024+(a-56320)+65536)+";"}).replace(g9,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $C;function CA(i,n){let e=null;try{$C=$C||n9(i);let a=n?String(n):"";e=$C.getInertBodyElement(a);let d=5,r=a;do{if(d===0)throw new Error("Failed to sanitize html because the input is unstable");d--,a=r,r=e.innerHTML,e=$C.getInertBodyElement(a)}while(a!==r);let P=new $2().sanitizeChildren(dz(e)||e);return yE(P)}finally{if(e){let a=dz(e)||e;for(;a.firstChild;)a.firstChild.remove()}}}function dz(i){return"content"in i&&_9(i)?i.content:null}function _9(i){return i.nodeType===Node.ELEMENT_NODE&&i.nodeName==="TEMPLATE"}function v9(i,n){return i.createText(n)}function y9(i,n,e){i.setValue(n,e)}function gB(i,n,e){return i.createElement(n,e)}function nE(i,n,e,a,d){i.insertBefore(n,e,a,d)}function _B(i,n,e){i.appendChild(n,e)}function hz(i,n,e,a,d){a!==null?nE(i,n,e,a,d):_B(i,n,e)}function vB(i,n,e,a){i.removeChild(null,n,e,a)}function x9(i,n,e){i.setAttribute(n,"style",e)}function b9(i,n,e){e===""?i.removeAttribute(n,"class"):i.setAttribute(n,"class",e)}function yB(i,n,e){let{mergedAttrs:a,classes:d,styles:r}=e;a!==null&&Pq(i,n,a),d!==null&&b9(i,n,d),r!==null&&x9(i,n,r)}var Fs=(function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i})(Fs||{});function no(i){let n=bB();return n?n.sanitize(Fs.URL,i)||"":Rd(i,"URL")?Nl(i):rx(xf(i))}function xB(i){let n=bB();if(n)return az(n.sanitize(Fs.RESOURCE_URL,i)||"");if(Rd(i,"ResourceURL"))return az(Nl(i));throw new sn(904,!1)}function w9(i,n){return n==="src"&&(i==="embed"||i==="frame"||i==="iframe"||i==="media"||i==="script")||n==="href"&&(i==="base"||i==="link")?xB:no}function EA(i,n,e){return w9(n,e)(i)}function bB(){let i=yi();return i&&i[yu].sanitizer}function SA(i){return i.ownerDocument.defaultView}function sx(i){return i.ownerDocument}function wB(i){return i instanceof Function?i():i}function C9(i,n,e){let a=i.length;for(;;){let d=i.indexOf(n,e);if(d===-1)return d;if(d===0||i.charCodeAt(d-1)<=32){let r=n.length;if(d+r===a||i.charCodeAt(d+r)<=32)return d}e=d+1}}var CB="ng-template";function E9(i,n,e,a){let d=0;if(a){for(;d<n.length&&typeof n[d]=="string";d+=2)if(n[d]==="class"&&C9(n[d+1].toLowerCase(),e,0)!==-1)return!0}else if(TA(i))return!1;if(d=n.indexOf(1,d),d>-1){let r;for(;++d<n.length&&typeof(r=n[d])=="string";)if(r.toLowerCase()===e)return!0}return!1}function TA(i){return i.type===4&&i.value!==CB}function S9(i,n,e){let a=i.type===4&&!e?CB:i.value;return n===a}function T9(i,n,e){let a=4,d=i.attrs,r=d!==null?D9(d):0,C=!1;for(let P=0;P<n.length;P++){let k=n[P];if(typeof k=="number"){if(!C&&!Dc(a)&&!Dc(k))return!1;if(C&&Dc(k))continue;C=!1,a=k|a&1;continue}if(!C)if(a&4){if(a=2|a&1,k!==""&&!S9(i,k,e)||k===""&&n.length===1){if(Dc(a))return!1;C=!0}}else if(a&8){if(d===null||!E9(i,d,k,e)){if(Dc(a))return!1;C=!0}}else{let X=n[++P],oe=I9(k,d,TA(i),e);if(oe===-1){if(Dc(a))return!1;C=!0;continue}if(X!==""){let Me;if(oe>r?Me="":Me=d[oe+1].toLowerCase(),a&2&&X!==Me){if(Dc(a))return!1;C=!0}}}}return Dc(a)||C}function Dc(i){return(i&1)===0}function I9(i,n,e,a){if(n===null)return-1;let d=0;if(a||!e){let r=!1;for(;d<n.length;){let C=n[d];if(C===i)return d;if(C===3||C===6)r=!0;else if(C===1||C===2){let P=n[++d];for(;typeof P=="string";)P=n[++d];continue}else{if(C===4)break;if(C===0){d+=4;continue}}d+=r?1:2}return-1}else return A9(n,i)}function EB(i,n,e=!1){for(let a=0;a<n.length;a++)if(T9(i,n[a],e))return!0;return!1}function M9(i){let n=i.attrs;if(n!=null){let e=n.indexOf(5);if((e&1)===0)return n[e+1]}return null}function D9(i){for(let n=0;n<i.length;n++){let e=i[n];if(Uz(e))return n}return i.length}function A9(i,n){let e=i.indexOf(4);if(e>-1)for(e++;e<i.length;){let a=i[e];if(typeof a=="number")return-1;if(a===n)return e;e++}return-1}function P9(i,n){e:for(let e=0;e<n.length;e++){let a=n[e];if(i.length===a.length){for(let d=0;d<i.length;d++)if(i[d]!==a[d])continue e;return!0}}return!1}function pz(i,n){return i?":not("+n.trim()+")":n}function O9(i){let n=i[0],e=1,a=2,d="",r=!1;for(;e<i.length;){let C=i[e];if(typeof C=="string")if(a&2){let P=i[++e];d+="["+C+(P.length>0?'="'+P+'"':"")+"]"}else a&8?d+="."+C:a&4&&(d+=" "+C);else d!==""&&!Dc(C)&&(n+=pz(r,d),d=""),a=C,r=r||!Dc(a);e++}return d!==""&&(n+=pz(r,d)),n}function R9(i){return i.map(O9).join(",")}function k9(i){let n=[],e=[],a=1,d=2;for(;a<i.length;){let r=i[a];if(typeof r=="string")d===2?r!==""&&n.push(r,i[++a]):d===8&&e.push(r);else{if(!Dc(d))break;d=r}a++}return e.length&&n.push(1,...e),n}var pa={};function IA(i,n,e,a,d,r,C,P,k,X,oe){let Me=uo+a,$e=Me+d,ke=F9(Me,$e),ht=typeof X=="function"?X():X;return ke[ni]={type:i,blueprint:ke,template:e,queries:null,viewQuery:P,declTNode:n,data:ke.slice().fill(null,Me),bindingStartIndex:Me,expandoStartIndex:$e,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof C=="function"?C():C,firstChild:null,schemas:k,consts:ht,incompleteFirstPass:!1,ssrId:oe}}function F9(i,n){let e=[];for(let a=0;a<n;a++)e.push(a<i?null:pa);return e}function L9(i){let n=i.tView;return n===null||n.incompleteFirstPass?i.tView=IA(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):n}function MA(i,n,e,a,d,r,C,P,k,X,oe){let Me=n.blueprint.slice();return Me[Tc]=d,Me[Si]=a|4|128|8|64|1024,(X!==null||i&&i[Si]&2048)&&(Me[Si]|=2048),WD(Me),Me[ls]=Me[wf]=i,Me[Vo]=e,Me[yu]=C||i&&i[yu],Me[co]=P||i&&i[co],Me[Ad]=k||i&&i[Ad]||null,Me[da]=r,Me[zy]=qq(),Me[bf]=oe,Me[jD]=X,Me[ha]=n.type==2?i[ha]:Me,Me}function N9(i,n,e){let a=Mc(n,i),d=L9(e),r=i[yu].rendererFactory,C=DA(i,MA(i,d,null,SB(e),a,n,null,r.createRenderer(a,e),null,null,null));return i[n.index]=C}function SB(i){let n=16;return i.signals?n=4096:i.onPush&&(n=64),n}function TB(i,n,e,a){if(e===0)return-1;let d=n.length;for(let r=0;r<e;r++)n.push(a),i.blueprint.push(a),i.data.push(null);return d}function DA(i,n){return i[m_]?i[UD][Pl]=n:i[m_]=n,i[UD]=n,n}function K(i=1){IB(Uo(),yi(),Cu()+i,!1)}function IB(i,n,e,a){if(!a)if((n[Si]&3)===3){let r=i.preOrderCheckHooks;r!==null&&qC(n,r,e)}else{let r=i.preOrderHooks;r!==null&&WC(n,r,0,e)}Nh(e)}var xE=(function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i})(xE||{});function H2(i,n,e,a){let d=Ei(null);try{let[r,C,P]=i.inputs[e],k=null;(C&xE.SignalBased)!==0&&(k=n[r][$s]),k!==null&&k.transformFn!==void 0?a=k.transformFn(a):P!==null&&(a=P.call(n,a)),i.setInput!==null?i.setInput(n,k,a,e,r):Fz(n,k,r,a)}finally{Ei(d)}}var Tu=(function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i})(Tu||{}),z9;function AA(i,n){return z9(i,n)}var Pf=new Set,bE=(function(i){return i[i.CHANGE_DETECTION=0]="CHANGE_DETECTION",i[i.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",i})(bE||{}),kf=new Kt(""),fz=new Set;function Pc(i){fz.has(i)||(fz.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var MB=!1,G2=class extends li{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,M3()&&(this.destroyRef=Ve(Fl,{optional:!0})??void 0,this.pendingTasks=Ve(Eu,{optional:!0})??void 0)}emit(n){let e=Ei(null);try{super.next(n)}finally{Ei(e)}}subscribe(n,e,a){let d=n,r=e||(()=>null),C=a;if(n&&typeof n=="object"){let k=n;d=k.next?.bind(k),r=k.error?.bind(k),C=k.complete?.bind(k)}this.__isAsync&&(r=this.wrapInTimeout(r),d&&(d=this.wrapInTimeout(d)),C&&(C=this.wrapInTimeout(C)));let P=super.subscribe({next:d,error:r,complete:C});return n instanceof Gr&&n.add(P),P}wrapInTimeout(n){return e=>{let a=this.pendingTasks?.add();setTimeout(()=>{try{n(e)}finally{a!==void 0&&this.pendingTasks?.remove(a)}})}}},Vt=G2;function DB(i){let n,e;function a(){i=qy;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{i(),a()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{i(),a()})),()=>a()}function mz(i){return queueMicrotask(()=>i()),()=>{i=qy}}var PA="isAngularZone",iE=PA+"_ID",B9=0,xi=class i{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Vt(!1);onMicrotaskEmpty=new Vt(!1);onStable=new Vt(!1);onError=new Vt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1,scheduleInRootZone:r=MB}=n;if(typeof Zone>"u")throw new sn(908,!1);Zone.assertZonePatched();let C=this;C._nesting=0,C._outer=C._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(C._inner=C._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(C._inner=C._inner.fork(Zone.longStackTraceZoneSpec)),C.shouldCoalesceEventChangeDetection=!d&&a,C.shouldCoalesceRunChangeDetection=d,C.callbackScheduled=!1,C.scheduleInRootZone=r,j9(C)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(PA)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new sn(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new sn(909,!1)}run(n,e,a){return this._inner.run(n,e,a)}runTask(n,e,a,d){let r=this._inner,C=r.scheduleEventTask("NgZoneEvent: "+d,n,V9,qy,qy);try{return r.runTask(C,e,a)}finally{r.cancelTask(C)}}runGuarded(n,e,a){return this._inner.runGuarded(n,e,a)}runOutsideAngular(n){return this._outer.run(n)}},V9={};function OA(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function U9(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function n(){DB(()=>{i.callbackScheduled=!1,q2(i),i.isCheckStableRunning=!0,OA(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{n()}):i._outer.run(()=>{n()}),q2(i)}function j9(i){let n=()=>{U9(i)},e=B9++;i._inner=i._inner.fork({name:"angular",properties:{[PA]:!0,[iE]:e,[iE+e]:!0},onInvokeTask:(a,d,r,C,P,k)=>{if($9(k))return a.invokeTask(r,C,P,k);try{return gz(i),a.invokeTask(r,C,P,k)}finally{(i.shouldCoalesceEventChangeDetection&&C.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&n(),_z(i)}},onInvoke:(a,d,r,C,P,k,X)=>{try{return gz(i),a.invoke(r,C,P,k,X)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!H9(k)&&n(),_z(i)}},onHasTask:(a,d,r,C)=>{a.hasTask(r,C),d===r&&(C.change=="microTask"?(i._hasPendingMicrotasks=C.microTask,q2(i),OA(i)):C.change=="macroTask"&&(i.hasPendingMacrotasks=C.macroTask))},onHandleError:(a,d,r,C)=>(a.handleError(r,C),i.runOutsideAngular(()=>i.onError.emit(C)),!1)})}function q2(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function gz(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function _z(i){i._nesting--,OA(i)}var rE=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Vt;onMicrotaskEmpty=new Vt;onStable=new Vt;onError=new Vt;run(n,e,a){return n.apply(e,a)}runGuarded(n,e,a){return n.apply(e,a)}runOutsideAngular(n){return n()}runTask(n,e,a,d){return n.apply(e,a)}};function $9(i){return AB(i,"__ignore_ng_zone__")}function H9(i){return AB(i,"__scheduler_tick__")}function AB(i,n){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[n]===!0}var RA=(()=>{class i{impl=null;execute(){this.impl?.execute()}static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new i})}return i})(),PB=[0,1,2,3],OB=(()=>{class i{ngZone=Ve(xi);scheduler=Ve(Dd);errorHandler=Ve(Hs,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Ve(kf,{optional:!0})}execute(){let e=this.sequences.size>0;e&&zr(16),this.executing=!0;for(let a of PB)for(let d of this.sequences)if(!(d.erroredOrDestroyed||!d.hooks[a]))try{d.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let r=d.hooks[a];return r(d.pipelinedValue)},d.snapshot))}catch(r){d.erroredOrDestroyed=!0,this.errorHandler?.handleError(r)}this.executing=!1;for(let a of this.sequences)a.afterRun(),a.once&&(this.sequences.delete(a),a.destroy());for(let a of this.deferredRegistrations)this.sequences.add(a);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&zr(17)}register(e){let{view:a}=e;a!==void 0?((a[Ef]??=[]).push(e),__(a),a[Si]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,a){return a?a.run(bE.AFTER_NEXT_RENDER,e):e()}static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new i})}return i})(),oE=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(n,e,a,d,r,C=null){this.impl=n,this.hooks=e,this.view=a,this.once=d,this.snapshot=C,this.unregisterOnDestroy=r?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let n=this.view?.[Ef];n&&(this.view[Ef]=n.filter(e=>e!==this))}};function zl(i,n){let e=n?.injector??Ve(hr);return Pc("NgAfterNextRender"),q9(i,e,n,!0)}function G9(i){return i instanceof Function?[void 0,void 0,i,void 0]:[i.earlyRead,i.write,i.mixedReadWrite,i.read]}function q9(i,n,e,a){let d=n.get(RA);d.impl??=n.get(OB);let r=n.get(kf,null,{optional:!0}),C=e?.manualCleanup!==!0?n.get(Fl):null,P=n.get(BC,null,{optional:!0}),k=new oE(d.impl,G9(i),P?.view,a,C,r?.snapshot(null));return d.impl.register(k),k}var RB=new Kt("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function kB(i,n,e){let a=i.get(RB);if(Array.isArray(n))for(let d of n)a.queue.add(d),e?.detachedLeaveAnimationFns?.push(d);else a.queue.add(n),e?.detachedLeaveAnimationFns?.push(n);a.scheduler&&a.scheduler(i)}function W9(i,n){let e=i.get(RB);if(n.detachedLeaveAnimationFns){for(let a of n.detachedLeaveAnimationFns)e.queue.delete(a);n.detachedLeaveAnimationFns=void 0}}function Z9(i,n){for(let[e,a]of n)kB(i,a.animateFns)}function vz(i,n,e,a){let d=i?.[Sf]?.enter;n!==null&&d&&d.has(e.index)&&Z9(a,d)}function x_(i,n,e,a,d,r,C,P){if(d!=null){let k,X=!1;Ic(d)?k=d:bu(d)&&(X=!0,d=d[Tc]);let oe=Ol(d);i===0&&a!==null?(vz(P,a,r,e),C==null?_B(n,a,oe):nE(n,a,oe,C||null,!0)):i===1&&a!==null?(vz(P,a,r,e),nE(n,a,oe,C||null,!0)):i===2?yz(P,r,e,Me=>{vB(n,oe,X,Me)}):i===3&&yz(P,r,e,()=>{n.destroyNode(oe)}),k!=null&&o7(n,i,e,k,r,a,C)}}function Y9(i,n){FB(i,n),n[Tc]=null,n[da]=null}function X9(i,n,e,a,d,r){a[Tc]=d,a[da]=n,CE(i,a,e,1,d,r)}function FB(i,n){n[yu].changeDetectionScheduler?.notify(9),CE(i,n,n[co],2,null,null)}function K9(i){let n=i[m_];if(!n)return x2(i[ni],i);for(;n;){let e=null;if(bu(n))e=n[m_];else{let a=n[Oo];a&&(e=a)}if(!e){for(;n&&!n[Pl]&&n!==i;)bu(n)&&x2(n[ni],n),n=n[ls];n===null&&(n=i),bu(n)&&x2(n[ni],n),e=n&&n[Pl]}n=e}}function kA(i,n){let e=i[Tf],a=e.indexOf(n);e.splice(a,1)}function wE(i,n){if(If(n))return;let e=n[co];e.destroyNode&&CE(i,n,e,3,null,null),K9(n)}function x2(i,n){if(If(n))return;let e=Ei(null);try{n[Si]&=-129,n[Si]|=256,n[il]&&Ty(n[il]),e7(i,n),J9(i,n),n[ni].type===1&&n[co].destroy();let a=n[kh];if(a!==null&&Ic(n[ls])){a!==n[ls]&&kA(a,n);let d=n[xu];d!==null&&d.detachView(i)}R2(n)}finally{Ei(e)}}function yz(i,n,e,a){let d=i?.[Sf];if(d==null||d.leave==null||!d.leave.has(n.index))return a(!1);i&&Pf.add(i),kB(e,()=>{if(d.leave&&d.leave.has(n.index)){let C=d.leave.get(n.index),P=[];if(C){for(let k=0;k<C.animateFns.length;k++){let X=C.animateFns[k],{promise:oe}=X();P.push(oe)}d.detachedLeaveAnimationFns=void 0}d.running=Promise.allSettled(P),Q9(i,a)}else i&&Pf.delete(i),a(!1)},d)}function Q9(i,n){let e=i[Sf]?.running;if(e){e.then(()=>{i[Sf].running=void 0,Pf.delete(i),n(!0)});return}n(!1)}function J9(i,n){let e=i.cleanup,a=n[f_];if(e!==null)for(let C=0;C<e.length-1;C+=2)if(typeof e[C]=="string"){let P=e[C+3];P>=0?a[P]():a[-P].unsubscribe(),C+=2}else{let P=a[e[C+1]];e[C].call(P)}a!==null&&(n[f_]=null);let d=n[Id];if(d!==null){n[Id]=null;for(let C=0;C<d.length;C++){let P=d[C];P()}}let r=n[By];if(r!==null){n[By]=null;for(let C of r)C.destroy()}}function e7(i,n){let e;if(i!=null&&(e=i.destroyHooks)!=null)for(let a=0;a<e.length;a+=2){let d=n[e[a]];if(!(d instanceof Af)){let r=e[a+1];if(Array.isArray(r))for(let C=0;C<r.length;C+=2){let P=d[r[C]],k=r[C+1];zr(4,P,k);try{k.call(P)}finally{zr(5,P,k)}}else{zr(4,d,r);try{r.call(d)}finally{zr(5,d,r)}}}}}function LB(i,n,e){return t7(i,n.parent,e)}function t7(i,n,e){let a=n;for(;a!==null&&a.type&168;)n=a,a=n.parent;if(a===null)return e[Tc];if(Lh(a)){let{encapsulation:d}=i.data[a.directiveStart+a.componentOffset];if(d===Pd.None||d===Pd.Emulated)return null}return Mc(a,e)}function NB(i,n,e){return i7(i,n,e)}function n7(i,n,e){return i.type&40?Mc(i,e):null}var i7=n7,xz;function FA(i,n,e,a){let d=LB(i,a,n),r=n[co],C=a.parent||n[da],P=NB(C,a,n);if(d!=null)if(Array.isArray(e))for(let k=0;k<e.length;k++)hz(r,d,e[k],P,!1);else hz(r,d,e,P,!1);xz!==void 0&&xz(r,a,n,e,d)}function Wy(i,n){if(n!==null){let e=n.type;if(e&3)return Mc(n,i);if(e&4)return W2(-1,i[n.index]);if(e&8){let a=n.child;if(a!==null)return Wy(i,a);{let d=i[n.index];return Ic(d)?W2(-1,d):Ol(d)}}else{if(e&128)return Wy(i,n.next);if(e&32)return AA(n,i)()||Ol(i[n.index]);{let a=zB(i,n);if(a!==null){if(Array.isArray(a))return a[0];let d=Oh(i[ha]);return Wy(d,a)}else return Wy(i,n.next)}}}return null}function zB(i,n){if(n!==null){let a=i[ha][da],d=n.projection;return a.projection[d]}return null}function W2(i,n){let e=Oo+i+1;if(e<n.length){let a=n[e],d=a[ni].firstChild;if(d!==null)return Wy(a,d)}return n[Fh]}function LA(i,n,e,a,d,r,C){for(;e!=null;){let P=a[Ad];if(e.type===128){e=e.next;continue}let k=a[e.index],X=e.type;if(C&&n===0&&(k&&C_(Ol(k),a),e.flags|=2),!vE(e))if(X&8)LA(i,n,e.child,a,d,r,!1),x_(n,i,P,d,k,e,r,a);else if(X&32){let oe=AA(e,a),Me;for(;Me=oe();)x_(n,i,P,d,Me,e,r,a);x_(n,i,P,d,k,e,r,a)}else X&16?BB(i,n,a,e,d,r):x_(n,i,P,d,k,e,r,a);e=C?e.projectionNext:e.next}}function CE(i,n,e,a,d,r){LA(e,a,i.firstChild,n,d,r,!1)}function r7(i,n,e){let a=n[co],d=LB(i,e,n),r=e.parent||n[da],C=NB(r,e,n);BB(a,0,n,e,d,C)}function BB(i,n,e,a,d,r){let C=e[ha],k=C[da].projection[a.projection];if(Array.isArray(k))for(let X=0;X<k.length;X++){let oe=k[X];x_(n,i,e[Ad],d,oe,a,r,e)}else{let X=k,oe=C[ls];Kz(a)&&(X.flags|=128),LA(i,n,X,oe,d,r,!0)}}function o7(i,n,e,a,d,r,C){let P=a[Fh],k=Ol(a);P!==k&&x_(n,i,e,r,P,d,C);for(let X=Oo;X<a.length;X++){let oe=a[X];CE(oe[ni],oe,i,n,r,P)}}function s7(i,n,e,a,d){if(n)d?i.addClass(e,a):i.removeClass(e,a);else{let r=a.indexOf("-")===-1?void 0:Tu.DashCase;d==null?i.removeStyle(e,a,r):(typeof d=="string"&&d.endsWith("!important")&&(d=d.slice(0,-10),r|=Tu.Important),i.setStyle(e,a,d,r))}}function VB(i,n,e,a,d){let r=Cu(),C=a&2;try{Nh(-1),C&&n.length>uo&&IB(i,n,uo,!1),zr(C?2:0,d,e),e(a,d)}finally{Nh(r),zr(C?3:1,d,e)}}function NA(i,n,e){p7(i,n,e),(e.flags&64)===64&&f7(i,n,e)}function EE(i,n,e=Mc){let a=n.localNames;if(a!==null){let d=n.index+1;for(let r=0;r<a.length;r+=2){let C=a[r+1],P=C===-1?e(n,i):i[C];i[d++]=P}}}function a7(i,n,e,a){let r=a.get(sB,oB)||e===Pd.ShadowDom,C=i.selectRootElement(n,r);return l7(C),C}function l7(i){c7(i)}var c7=()=>null;function u7(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function UB(i,n,e,a,d,r){let C=n[ni];if(zA(i,C,n,e,a)){Lh(i)&&h7(n,i.index);return}i.type&3&&(e=u7(e)),d7(i,n,e,a,d,r)}function d7(i,n,e,a,d,r){if(i.type&3){let C=Mc(i,n);a=r!=null?r(a,i.value||"",e):a,d.setProperty(C,e,a)}else i.type&12}function h7(i,n){let e=Rl(n,i);e[Si]&16||(e[Si]|=64)}function p7(i,n,e){let a=e.directiveStart,d=e.directiveEnd;Lh(e)&&N9(n,e,i.data[a+e.componentOffset]),i.firstCreatePass||eE(e,n);let r=e.initialInputs;for(let C=a;C<d;C++){let P=i.data[C],k=Yy(n,i,C,e);if(C_(k,n),r!==null&&v7(n,C-a,k,P,e,r),wu(P)){let X=Rl(e.index,n);X[Vo]=Yy(n,i,C,e)}}}function f7(i,n,e){let a=e.directiveStart,d=e.directiveEnd,r=e.index,C=G3();try{Nh(r);for(let P=a;P<d;P++){let k=i.data[P],X=n[P];OC(P),(k.hostBindings!==null||k.hostVars!==0||k.hostAttrs!==null)&&m7(k,X)}}finally{Nh(-1),OC(C)}}function m7(i,n){i.hostBindings!==null&&i.hostBindings(1,n)}function jB(i,n){let e=i.directiveRegistry,a=null;if(e)for(let d=0;d<e.length;d++){let r=e[d];EB(n,r.selectors,!1)&&(a??=[],wu(r)?a.unshift(r):a.push(r))}return a}function g7(i,n,e,a,d,r){let C=Mc(i,n);_7(n[co],C,r,i.value,e,a,d)}function _7(i,n,e,a,d,r,C){if(r==null)i.removeAttribute(n,d,e);else{let P=C==null?xf(r):C(r,a||"",d);i.setAttribute(n,d,P,e)}}function v7(i,n,e,a,d,r){let C=r[n];if(C!==null)for(let P=0;P<C.length;P+=2){let k=C[P],X=C[P+1];H2(a,e,k,X)}}function $B(i,n,e,a,d){let r=uo+e,C=n[ni],P=d(C,n,i,a,e);n[r]=P,v_(i,!0);let k=i.type===2;return k?(yB(n[co],P,i),(N3()===0||Uy(i))&&C_(P,n),z3()):C_(P,n),NC()&&(!k||!vE(i))&&FA(C,n,P,i),i}function HB(i){let n=i;return r2()?o2():(n=n.parent,v_(n,!1)),n}function y7(i,n){let e=i[Ad];if(!e)return;let a;try{a=e.get(Gs,null)}catch{a=null}a?.(n)}function zA(i,n,e,a,d){let r=i.inputs?.[a],C=i.hostDirectiveInputs?.[a],P=!1;if(C)for(let k=0;k<C.length;k+=2){let X=C[k],oe=C[k+1],Me=n.data[X];H2(Me,e[X],oe,d),P=!0}if(r)for(let k of r){let X=e[k],oe=n.data[k];H2(oe,X,a,d),P=!0}return P}function x7(i,n){let e=Rl(n,i),a=e[ni];b7(a,e);let d=e[Tc];d!==null&&e[bf]===null&&(e[bf]=aB(d,e[Ad])),zr(18),BA(a,e,e[Vo]),zr(19,e[Vo])}function b7(i,n){for(let e=n.length;e<i.blueprint.length;e++)n.push(i.blueprint[e])}function BA(i,n,e){kC(n);try{let a=i.viewQuery;a!==null&&F2(1,a,e);let d=i.template;d!==null&&VB(i,n,d,1,e),i.firstCreatePass&&(i.firstCreatePass=!1),n[xu]?.finishViewCreation(i),i.staticContentQueries&&lB(i,n),i.staticViewQueries&&F2(2,i.viewQuery,e);let r=i.components;r!==null&&w7(n,r)}catch(a){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),a}finally{n[Si]&=-5,FC()}}function w7(i,n){for(let e=0;e<n.length;e++)x7(i,n[e])}function ax(i,n,e,a){let d=Ei(null);try{let r=n.tView,P=i[Si]&4096?4096:16,k=MA(i,r,e,P,null,n,null,null,a?.injector??null,a?.embeddedViewInjector??null,a?.dehydratedView??null),X=i[n.index];k[kh]=X;let oe=i[xu];return oe!==null&&(k[xu]=oe.createEmbeddedView(r)),BA(r,k,e),k}finally{Ei(d)}}function E_(i,n){return!n||n.firstChild===null||Kz(i)}function Xy(i,n,e,a,d=!1){for(;e!==null;){if(e.type===128){e=d?e.projectionNext:e.next;continue}let r=n[e.index];r!==null&&a.push(Ol(r)),Ic(r)&&GB(r,a);let C=e.type;if(C&8)Xy(i,n,e.child,a);else if(C&32){let P=AA(e,n),k;for(;k=P();)a.push(k)}else if(C&16){let P=zB(n,e);if(Array.isArray(P))a.push(...P);else{let k=Oh(n[ha]);Xy(k[ni],k,P,a,!0)}}e=d?e.projectionNext:e.next}return a}function GB(i,n){for(let e=Oo;e<i.length;e++){let a=i[e],d=a[ni].firstChild;d!==null&&Xy(a[ni],a,d,n)}i[Fh]!==i[Tc]&&n.push(i[Fh])}function qB(i){if(i[Ef]!==null){for(let n of i[Ef])n.impl.addSequence(n);i[Ef].length=0}}var WB=[];function C7(i){return i[il]??E7(i)}function E7(i){let n=WB.pop()??Object.create(T7);return n.lView=i,n}function S7(i){i.lView[il]!==i&&(i.lView=null,WB.push(i))}var T7=Ci(Ht({},Yg),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{__(i.lView)},consumerOnSignalRead(){this.lView[il]=this}});function I7(i){let n=i[il]??Object.create(M7);return n.lView=i,n}var M7=Ci(Ht({},Yg),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{let n=Oh(i.lView);for(;n&&!ZB(n[ni]);)n=Oh(n);n&&ZD(n)},consumerOnSignalRead(){this.lView[il]=this}});function ZB(i){return i.type!==2}function YB(i){if(i[By]===null)return;let n=!0;for(;n;){let e=!1;for(let a of i[By])a.dirty&&(e=!0,a.zone===null||Zone.current===a.zone?a.run():a.zone.run(()=>a.run()));n=e&&!!(i[Si]&8192)}}var D7=100;function XB(i,n=0){let a=i[yu].rendererFactory,d=!1;d||a.begin?.();try{A7(i,n)}finally{d||a.end?.()}}function A7(i,n){let e=s2();try{a2(!0),Z2(i,n);let a=0;for(;Hy(i);){if(a===D7)throw new sn(103,!1);a++,Z2(i,1)}}finally{a2(e)}}function P7(i,n,e,a){if(If(n))return;let d=n[Si],r=!1,C=!1;kC(n);let P=!0,k=null,X=null;r||(ZB(i)?(X=C7(n),k=Kg(X)):Nw()===null?(P=!1,X=I7(n),k=Kg(X)):n[il]&&(Ty(n[il]),n[il]=null));try{WD(n),j3(i.bindingStartIndex),e!==null&&VB(i,n,e,2,a);let oe=(d&3)===3;if(!r)if(oe){let ke=i.preOrderCheckHooks;ke!==null&&qC(n,ke,null)}else{let ke=i.preOrderHooks;ke!==null&&WC(n,ke,0,null),v2(n,0)}if(C||O7(n),YB(n),KB(n,0),i.contentQueries!==null&&lB(i,n),!r)if(oe){let ke=i.contentCheckHooks;ke!==null&&qC(n,ke)}else{let ke=i.contentHooks;ke!==null&&WC(n,ke,1),v2(n,1)}k7(i,n);let Me=i.components;Me!==null&&JB(n,Me,0);let $e=i.viewQuery;if($e!==null&&F2(2,$e,a),!r)if(oe){let ke=i.viewCheckHooks;ke!==null&&qC(n,ke)}else{let ke=i.viewHooks;ke!==null&&WC(n,ke,2),v2(n,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),n[MC]){for(let ke of n[MC])ke();n[MC]=null}r||(qB(n),n[Si]&=-73)}catch(oe){throw r||__(n),oe}finally{X!==null&&(Ey(X,k),P&&S7(X)),FC()}}function KB(i,n){for(let e=Jz(i);e!==null;e=eB(e))for(let a=Oo;a<e.length;a++){let d=e[a];QB(d,n)}}function O7(i){for(let n=Jz(i);n!==null;n=eB(n)){if(!(n[Si]&2))continue;let e=n[Tf];for(let a=0;a<e.length;a++){let d=e[a];ZD(d)}}}function R7(i,n,e){zr(18);let a=Rl(n,i);QB(a,e),zr(19,a[Vo])}function QB(i,n){DC(i)&&Z2(i,n)}function Z2(i,n){let a=i[ni],d=i[Si],r=i[il],C=!!(n===0&&d&16);if(C||=!!(d&64&&n===0),C||=!!(d&1024),C||=!!(r?.dirty&&Sy(r)),C||=!1,r&&(r.dirty=!1),i[Si]&=-9217,C)P7(a,i,a.template,i[Vo]);else if(d&8192){let P=Ei(null);try{YB(i),KB(i,1);let k=a.components;k!==null&&JB(i,k,1),qB(i)}finally{Ei(P)}}}function JB(i,n,e){for(let a=0;a<n.length;a++)R7(i,n[a],e)}function k7(i,n){let e=i.hostBindingOpCodes;if(e!==null)try{for(let a=0;a<e.length;a++){let d=e[a];if(d<0)Nh(~d);else{let r=d,C=e[++a],P=e[++a];H3(C,r);let k=n[r];zr(24,k),P(2,k),zr(25,k)}}}finally{Nh(-1)}}function VA(i,n){let e=s2()?64:1088;for(i[yu].changeDetectionScheduler?.notify(n);i;){i[Si]|=e;let a=Oh(i);if(g_(i)&&!a)return i;i=a}return null}function eV(i,n,e,a){return[i,!0,0,n,null,a,null,e,null,null]}function tV(i,n){let e=Oo+n;if(e<i.length)return i[e]}function lx(i,n,e,a=!0){let d=n[ni];if(F7(d,n,i,e),a){let C=W2(e,i),P=n[co],k=P.parentNode(i[Fh]);k!==null&&X9(d,i[da],P,n,k,C)}let r=n[bf];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function nV(i,n){let e=Ky(i,n);return e!==void 0&&wE(e[ni],e),e}function Ky(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e];if(a){let d=a[kh];d!==null&&d!==i&&kA(d,a),n>0&&(i[e-1][Pl]=a[Pl]);let r=Ly(i,Oo+n);Y9(a[ni],a);let C=r[xu];C!==null&&C.detachView(r[ni]),a[ls]=null,a[Pl]=null,a[Si]&=-129}return a}function F7(i,n,e,a){let d=Oo+a,r=e.length;a>0&&(e[d-1][Pl]=n),a<r-Oo?(n[Pl]=e[d],RD(e,Oo+a,n)):(e.push(n),n[Pl]=null),n[ls]=e;let C=n[kh];C!==null&&e!==C&&iV(C,n);let P=n[xu];P!==null&&P.insertView(i),AC(n),n[Si]|=128}function iV(i,n){let e=i[Tf],a=n[ls];if(bu(a))i[Si]|=2;else{let d=a[ls][ha];n[ha]!==d&&(i[Si]|=2)}e===null?i[Tf]=[n]:e.push(n)}var zh=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let n=this._lView,e=n[ni];return Xy(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e}get context(){return this._lView[Vo]}set context(n){this._lView[Vo]=n}get destroyed(){return If(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[ls];if(Ic(n)){let e=n[Vy],a=e?e.indexOf(this):-1;a>-1&&(Ky(n,a),Ly(e,a))}this._attachedToViewContainer=!1}wE(this._lView[ni],this._lView)}onDestroy(n){YD(this._lView,n)}markForCheck(){VA(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Si]&=-129}reattach(){AC(this._lView),this._lView[Si]|=128}detectChanges(){this._lView[Si]|=1024,XB(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new sn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=g_(this._lView),e=this._lView[kh];e!==null&&!n&&kA(e,this._lView),FB(this._lView[ni],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new sn(902,!1);this._appRef=n;let e=g_(this._lView),a=this._lView[kh];a!==null&&!e&&iV(a,this._lView),AC(this._lView)}};var rl=(()=>{class i{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=L7;constructor(e,a,d){this._declarationLView=e,this._declarationTContainer=a,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,a){return this.createEmbeddedViewImpl(e,a)}createEmbeddedViewImpl(e,a,d){let r=ax(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:a,dehydratedView:d});return new zh(r)}}return i})();function L7(){return SE(ks(),yi())}function SE(i,n){return i.type&4?new rl(n,i,T_(i,n)):null}function D_(i,n,e,a,d){let r=i.data[n];if(r===null)r=N7(i,n,e,a,d),$3()&&(r.flags|=32);else if(r.type&64){r.type=e,r.value=a,r.attrs=d;let C=B3();r.injectorIndex=C===null?-1:C.injectorIndex}return v_(r,!0),r}function N7(i,n,e,a,d){let r=i2(),C=r2(),P=C?r:r&&r.parent,k=i.data[n]=B7(i,P,e,n,a,d);return z7(i,k,r,C),k}function z7(i,n,e,a){i.firstChild===null&&(i.firstChild=n),e!==null&&(a?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function B7(i,n,e,a,d,r){let C=n?n.injectorIndex:-1,P=0;return e2()&&(P|=128),{type:e,index:a,insertBeforeIndex:null,injectorIndex:C,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:P,providerIndexes:0,value:d,attrs:r,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var nfe=new RegExp(`^(\\d+)*(${Xq}|${Yq})*(.*)`);function V7(i){let n=i[$D]??[],a=i[ls][co],d=[];for(let r of n)r.data[rB]!==void 0?d.push(r):U7(r,a);i[$D]=d}function U7(i,n){let e=0,a=i.firstChild;if(a){let d=i.data[iB];for(;e<d;){let r=a.nextSibling;vB(n,a,!1),a=r,e++}}}var j7=()=>null,$7=()=>null;function sE(i,n){return j7(i,n)}function rV(i,n,e){return $7(i,n,e)}var oV=class{},TE=class{},Y2=class{resolveComponentFactory(n){throw new sn(917,!1)}},cx=class{static NULL=new Y2},xs=class{},Oa=(()=>{class i{destroyNode=null;static __NG_ELEMENT_ID__=()=>H7()}return i})();function H7(){let i=yi(),n=ks(),e=Rl(n.index,i);return(bu(e)?e:i)[co]}var sV=(()=>{class i{static \u0275prov=kt({token:i,providedIn:"root",factory:()=>null})}return i})();var YC={},X2=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,a){let d=this.injector.get(n,YC,a);return d!==YC||e===YC?d:this.parentInjector.get(n,e,a)}};function aE(i,n,e){let a=e?i.styles:null,d=e?i.classes:null,r=0;if(n!==null)for(let C=0;C<n.length;C++){let P=n[C];if(typeof P=="number")r=P;else if(r==1)d=wC(d,P);else if(r==2){let k=P,X=n[++C];a=wC(a,k+": "+X+";")}}e?i.styles=a:i.stylesWithoutHost=a,e?i.classes=d:i.classesWithoutHost=d}function Dt(i,n=0){let e=yi();if(e===null)return hn(i,n);let a=ks();return Zz(a,e,Rs(i),n)}function UA(){let i="invalid";throw new Error(i)}function aV(i,n,e,a,d){let r=a===null?null:{"":-1},C=d(i,e);if(C!==null){let P=C,k=null,X=null;for(let oe of C)if(oe.resolveHostDirectives!==null){[P,k,X]=oe.resolveHostDirectives(C);break}W7(i,n,e,P,r,k,X)}r!==null&&a!==null&&G7(e,a,r)}function G7(i,n,e){let a=i.localNames=[];for(let d=0;d<n.length;d+=2){let r=e[n[d+1]];if(r==null)throw new sn(-301,!1);a.push(n[d],r)}}function q7(i,n,e){n.componentOffset=e,(i.components??=[]).push(n.index)}function W7(i,n,e,a,d,r,C){let P=a.length,k=!1;for(let $e=0;$e<P;$e++){let ke=a[$e];!k&&wu(ke)&&(k=!0,q7(i,e,$e)),P2(eE(e,n),i,ke.type)}J7(e,i.data.length,P);for(let $e=0;$e<P;$e++){let ke=a[$e];ke.providersResolver&&ke.providersResolver(ke)}let X=!1,oe=!1,Me=TB(i,n,P,null);P>0&&(e.directiveToIndex=new Map);for(let $e=0;$e<P;$e++){let ke=a[$e];if(e.mergedAttrs=w_(e.mergedAttrs,ke.hostAttrs),Y7(i,e,n,Me,ke),Q7(Me,ke,d),C!==null&&C.has(ke)){let[Nt,Mt]=C.get(ke);e.directiveToIndex.set(ke.type,[Me,Nt+e.directiveStart,Mt+e.directiveStart])}else(r===null||!r.has(ke))&&e.directiveToIndex.set(ke.type,Me);ke.contentQueries!==null&&(e.flags|=4),(ke.hostBindings!==null||ke.hostAttrs!==null||ke.hostVars!==0)&&(e.flags|=64);let ht=ke.type.prototype;!X&&(ht.ngOnChanges||ht.ngOnInit||ht.ngDoCheck)&&((i.preOrderHooks??=[]).push(e.index),X=!0),!oe&&(ht.ngOnChanges||ht.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(e.index),oe=!0),Me++}Z7(i,e,r)}function Z7(i,n,e){for(let a=n.directiveStart;a<n.directiveEnd;a++){let d=i.data[a];if(e===null||!e.has(d))bz(0,n,d,a),bz(1,n,d,a),Cz(n,a,!1);else{let r=e.get(d);wz(0,n,r,a),wz(1,n,r,a),Cz(n,a,!0)}}}function bz(i,n,e,a){let d=i===0?e.inputs:e.outputs;for(let r in d)if(d.hasOwnProperty(r)){let C;i===0?C=n.inputs??={}:C=n.outputs??={},C[r]??=[],C[r].push(a),lV(n,r)}}function wz(i,n,e,a){let d=i===0?e.inputs:e.outputs;for(let r in d)if(d.hasOwnProperty(r)){let C=d[r],P;i===0?P=n.hostDirectiveInputs??={}:P=n.hostDirectiveOutputs??={},P[C]??=[],P[C].push(a,r),lV(n,C)}}function lV(i,n){n==="class"?i.flags|=8:n==="style"&&(i.flags|=16)}function Cz(i,n,e){let{attrs:a,inputs:d,hostDirectiveInputs:r}=i;if(a===null||!e&&d===null||e&&r===null||TA(i)){i.initialInputs??=[],i.initialInputs.push(null);return}let C=null,P=0;for(;P<a.length;){let k=a[P];if(k===0){P+=4;continue}else if(k===5){P+=2;continue}else if(typeof k=="number")break;if(!e&&d.hasOwnProperty(k)){let X=d[k];for(let oe of X)if(oe===n){C??=[],C.push(k,a[P+1]);break}}else if(e&&r.hasOwnProperty(k)){let X=r[k];for(let oe=0;oe<X.length;oe+=2)if(X[oe]===n){C??=[],C.push(X[oe+1],a[P+1]);break}}P+=2}i.initialInputs??=[],i.initialInputs.push(C)}function Y7(i,n,e,a,d){i.data[a]=d;let r=d.factory||(d.factory=Ph(d.type,!0)),C=new Af(r,wu(d),Dt,null);i.blueprint[a]=C,e[a]=C,X7(i,n,a,TB(i,e,d.hostVars,pa),d)}function X7(i,n,e,a,d){let r=d.hostBindings;if(r){let C=i.hostBindingOpCodes;C===null&&(C=i.hostBindingOpCodes=[]);let P=~n.index;K7(C)!=P&&C.push(P),C.push(e,a,r)}}function K7(i){let n=i.length;for(;n>0;){let e=i[--n];if(typeof e=="number"&&e<0)return e}return 0}function Q7(i,n,e){if(e){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)e[n.exportAs[a]]=i;wu(n)&&(e[""]=i)}}function J7(i,n,e){i.flags|=1,i.directiveStart=n,i.directiveEnd=n+e,i.providerIndexes=n}function cV(i,n,e,a,d,r,C,P){let k=n[ni],X=k.consts,oe=kl(X,C),Me=D_(k,i,e,a,oe);return r&&aV(k,n,Me,kl(X,P),d),Me.mergedAttrs=w_(Me.mergedAttrs,Me.attrs),Me.attrs!==null&&aE(Me,Me.attrs,!1),Me.mergedAttrs!==null&&aE(Me,Me.mergedAttrs,!0),k.queries!==null&&k.queries.elementStart(k,Me),Me}function uV(i,n){Bz(i,n),HD(n)&&i.queries.elementEnd(n)}function eW(i,n,e,a,d,r){let C=n.consts,P=kl(C,d),k=D_(n,i,e,a,P);if(k.mergedAttrs=w_(k.mergedAttrs,k.attrs),r!=null){let X=kl(C,r);k.localNames=[];for(let oe=0;oe<X.length;oe+=2)k.localNames.push(X[oe],-1)}return k.attrs!==null&&aE(k,k.attrs,!1),k.mergedAttrs!==null&&aE(k,k.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,k),k}function jA(i){return IE(i)?Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i:!1}function dV(i,n){if(Array.isArray(i))for(let e=0;e<i.length;e++)n(i[e]);else{let e=i[Symbol.iterator](),a;for(;!(a=e.next()).done;)n(a.value)}}function IE(i){return i!==null&&(typeof i=="function"||typeof i=="object")}function ME(i,n,e){return i[n]=e}function tW(i,n){return i[n]}function Ll(i,n,e){if(e===pa)return!1;let a=i[n];return Object.is(a,e)?!1:(i[n]=e,!0)}function $A(i,n,e,a){let d=Ll(i,n,e);return Ll(i,n+1,a)||d}function nW(i,n,e,a,d){let r=$A(i,n,e,a);return Ll(i,n+2,d)||r}function b2(i,n,e){return function a(d){let r=Lh(i)?Rl(i.index,n):n;VA(r,5);let C=n[Vo],P=Ez(n,C,e,d),k=a.__ngNextListenerFn__;for(;k;)P=Ez(n,C,k,d)&&P,k=k.__ngNextListenerFn__;return P}}function Ez(i,n,e,a){let d=Ei(null);try{return zr(6,n,e),e(a)!==!1}catch(r){return y7(i,r),!1}finally{zr(7,n,e),Ei(d)}}function iW(i,n,e,a,d,r,C,P){let k=Uy(i),X=!1,oe=null;if(!a&&k&&(oe=oW(n,e,r,i.index)),oe!==null){let Me=oe.__ngLastListenerFn__||oe;Me.__ngNextListenerFn__=C,oe.__ngLastListenerFn__=C,X=!0}else{let Me=Mc(i,e),$e=a?a(Me):Me;Qq(e,$e,r,P);let ke=d.listen($e,r,P);if(!rW(r)){let ht=a?Nt=>a(Ol(Nt[i.index])):i.index;hV(ht,n,e,r,P,ke,!1)}}return X}function rW(i){return i.startsWith("animation")||i.startsWith("transition")}function oW(i,n,e,a){let d=i.cleanup;if(d!=null)for(let r=0;r<d.length-1;r+=2){let C=d[r];if(C===e&&d[r+1]===a){let P=n[f_],k=d[r+2];return P&&P.length>k?P[k]:null}typeof C=="string"&&(r+=2)}return null}function hV(i,n,e,a,d,r,C){let P=n.firstCreatePass?KD(n):null,k=XD(e),X=k.length;k.push(d,r),P&&P.push(a,i,X,(X+1)*(C?-1:1))}function Sz(i,n,e,a,d,r){let C=n[e],P=n[ni],X=P.data[e].outputs[a],Me=C[X].subscribe(r);hV(i.index,P,n,d,r,Me,!0)}var K2=Symbol("BINDING");var lE=class extends cx{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=vu(n);return new Bh(e,this.ngModule)}};function sW(i){return Object.keys(i).map(n=>{let[e,a,d]=i[n],r={propName:e,templateName:n,isSignal:(a&xE.SignalBased)!==0};return d&&(r.transform=d),r})}function aW(i){return Object.keys(i).map(n=>({propName:i[n],templateName:n}))}function lW(i,n,e){let a=n instanceof Yr?n:n?.injector;return a&&i.getStandaloneInjector!==null&&(a=i.getStandaloneInjector(a)||a),a?new X2(e,a):e}function cW(i){let n=i.get(xs,null);if(n===null)throw new sn(407,!1);let e=i.get(sV,null),a=i.get(Dd,null);return{rendererFactory:n,sanitizer:e,changeDetectionScheduler:a,ngReflect:!1}}function uW(i,n){let e=pV(i);return gB(n,e,e==="svg"?A3:e==="math"?P3:null)}function pV(i){return(i.selectors[0][0]||"div").toLowerCase()}var Bh=class extends TE{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=sW(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=aW(this.componentDef.outputs),this.cachedOutputs}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=R9(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,a,d,r,C){zr(22);let P=Ei(null);try{let k=this.componentDef,X=dW(a,k,C,r),oe=lW(k,d||this.ngModule,n),Me=cW(oe),$e=Me.rendererFactory.createRenderer(null,k),ke=a?a7($e,a,k.encapsulation,oe):uW(k,$e),ht=C?.some(Tz)||r?.some(Xt=>typeof Xt!="function"&&Xt.bindings.some(Tz)),Nt=MA(null,X,null,512|SB(k),null,null,Me,$e,oe,null,aB(ke,oe,!0));Nt[uo]=ke,kC(Nt);let Mt=null;try{let Xt=cV(uo,Nt,2,"#host",()=>X.directiveRegistry,!0,0);yB($e,ke,Xt),C_(ke,Nt),NA(X,Nt,Xt),cB(X,Xt,Nt),uV(X,Xt),e!==void 0&&pW(Xt,this.ngContentSelectors,e),Mt=Rl(Xt.index,Nt),Nt[Vo]=Mt[Vo],BA(X,Nt,null)}catch(Xt){throw Mt!==null&&R2(Mt),R2(Nt),Xt}finally{zr(23),FC()}return new cE(this.componentType,Nt,!!ht)}finally{Ei(P)}}};function dW(i,n,e,a){let d=i?["ng-version","20.3.15"]:k9(n.selectors[0]),r=null,C=null,P=0;if(e)for(let oe of e)P+=oe[K2].requiredVars,oe.create&&(oe.targetIdx=0,(r??=[]).push(oe)),oe.update&&(oe.targetIdx=0,(C??=[]).push(oe));if(a)for(let oe=0;oe<a.length;oe++){let Me=a[oe];if(typeof Me!="function")for(let $e of Me.bindings){P+=$e[K2].requiredVars;let ke=oe+1;$e.create&&($e.targetIdx=ke,(r??=[]).push($e)),$e.update&&($e.targetIdx=ke,(C??=[]).push($e))}}let k=[n];if(a)for(let oe of a){let Me=typeof oe=="function"?oe:oe.type,$e=ND(Me);k.push($e)}return IA(0,null,hW(r,C),1,P,k,null,null,null,[d],null)}function hW(i,n){return!i&&!n?null:e=>{if(e&1&&i)for(let a of i)a.create();if(e&2&&n)for(let a of n)a.update()}}function Tz(i){let n=i[K2].kind;return n==="input"||n==="twoWay"}var cE=class extends oV{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e,a){super(),this._rootLView=e,this._hasInputBindings=a,this._tNode=jy(e[ni],uo),this.location=T_(this._tNode,e),this.instance=Rl(this._tNode.index,e)[Vo],this.hostView=this.changeDetectorRef=new zh(e,void 0),this.componentType=n}setInput(n,e){this._hasInputBindings;let a=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let d=this._rootLView,r=zA(a,d[ni],d,n,e);this.previousInputValues.set(n,e);let C=Rl(a.index,d);VA(C,1)}get injector(){return new Df(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function pW(i,n,e){let a=i.projection=[];for(let d=0;d<n.length;d++){let r=e[d];a.push(r!=null&&r.length?Array.from(r):null)}}var ol=(()=>{class i{static __NG_ELEMENT_ID__=fW}return i})();function fW(){let i=ks();return mV(i,yi())}var mW=ol,fV=class extends mW{_lContainer;_hostTNode;_hostLView;constructor(n,e,a){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=a}get element(){return T_(this._hostTNode,this._hostLView)}get injector(){return new Df(this._hostTNode,this._hostLView)}get parentInjector(){let n=mA(this._hostTNode,this._hostLView);if(jz(n)){let e=QC(n,this._hostLView),a=KC(n),d=e[ni].data[a+8];return new Df(d,e)}else return new Df(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=Iz(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-Oo}createEmbeddedView(n,e,a){let d,r;typeof a=="number"?d=a:a!=null&&(d=a.index,r=a.injector);let C=sE(this._lContainer,n.ssrId),P=n.createEmbeddedViewImpl(e||{},r,C);return this.insertImpl(P,d,E_(this._hostTNode,C)),P}createComponent(n,e,a,d,r,C,P){let k=n&&!Cq(n),X;if(k)X=e;else{let Mt=e||{};X=Mt.index,a=Mt.injector,d=Mt.projectableNodes,r=Mt.environmentInjector||Mt.ngModuleRef,C=Mt.directives,P=Mt.bindings}let oe=k?n:new Bh(vu(n)),Me=a||this.parentInjector;if(!r&&oe.ngModule==null){let Xt=(k?Me:this.parentInjector).get(Yr,null);Xt&&(r=Xt)}let $e=vu(oe.componentType??{}),ke=sE(this._lContainer,$e?.id??null),ht=ke?.firstChild??null,Nt=oe.create(Me,d,ht,r,C,P);return this.insertImpl(Nt.hostView,X,E_(this._hostTNode,ke)),Nt}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,a){let d=n._lView;if(R3(d)){let P=this.indexOf(n);if(P!==-1)this.detach(P);else{let k=d[ls],X=new fV(k,k[da],k[ls]);X.detach(X.indexOf(n))}}let r=this._adjustIndex(e),C=this._lContainer;return lx(C,d,r,a),n.attachToViewContainerRef(),RD(w2(C),r,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=Iz(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),a=Ky(this._lContainer,e);a&&(Ly(w2(this._lContainer),e),wE(a[ni],a))}detach(n){let e=this._adjustIndex(n,-1),a=Ky(this._lContainer,e);return a&&Ly(w2(this._lContainer),e)!=null?new zh(a):null}_adjustIndex(n,e=0){return n??this.length+e}};function Iz(i){return i[Vy]}function w2(i){return i[Vy]||(i[Vy]=[])}function mV(i,n){let e,a=n[i.index];return Ic(a)?e=a:(e=eV(a,n,null,i),n[i.index]=e,DA(n,e)),_W(e,n,i,a),new fV(e,i,n)}function gW(i,n){let e=i[co],a=e.createComment(""),d=Mc(n,i),r=e.parentNode(d);return nE(e,r,a,e.nextSibling(d),!1),a}var _W=xW,vW=()=>!1;function yW(i,n,e){return vW(i,n,e)}function xW(i,n,e,a){if(i[Fh])return;let d;e.type&8?d=Ol(a):d=gW(n,e),i[Fh]=d}var Q2=class i{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new i(this.queryList)}setDirty(){this.queryList.setDirty()}},J2=class i{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let e=n.queries;if(e!==null){let a=n.contentQueries!==null?n.contentQueries[0]:e.length,d=[];for(let r=0;r<a;r++){let C=e.getByIndex(r),P=this.queries[C.indexInDeclarationView];d.push(P.clone())}return new i(d)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)HA(n,e).matches!==null&&this.queries[e].setDirty()}},eA=class{flags;read;predicate;constructor(n,e,a=null){this.flags=e,this.read=a,typeof n=="string"?this.predicate=MW(n):this.predicate=n}},tA=class i{queries;constructor(n=[]){this.queries=n}elementStart(n,e){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let a=0;a<this.length;a++){let d=e!==null?e.length:0,r=this.getByIndex(a).embeddedTView(n,d);r&&(r.indexInDeclarationView=a,e!==null?e.push(r):e=[r])}return e!==null?new i(e):null}template(n,e){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},nA=class i{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,e=-1){this.metadata=n,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new i(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,a=n.parent;for(;a!==null&&a.type&8&&a.index!==e;)a=a.parent;return e===(a!==null?a.index:-1)}return this._appliesToNextNode}matchTNode(n,e){let a=this.metadata.predicate;if(Array.isArray(a))for(let d=0;d<a.length;d++){let r=a[d];this.matchTNodeWithReadOption(n,e,bW(e,r)),this.matchTNodeWithReadOption(n,e,ZC(e,n,r,!1,!1))}else a===rl?e.type&4&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,ZC(e,n,a,!1,!1))}matchTNodeWithReadOption(n,e,a){if(a!==null){let d=this.metadata.read;if(d!==null)if(d===pr||d===ol||d===rl&&e.type&4)this.addMatch(e.index,-2);else{let r=ZC(e,n,d,!1,!1);r!==null&&this.addMatch(e.index,r)}else this.addMatch(e.index,a)}}addMatch(n,e){this.matches===null?this.matches=[n,e]:this.matches.push(n,e)}};function bW(i,n){let e=i.localNames;if(e!==null){for(let a=0;a<e.length;a+=2)if(e[a]===n)return e[a+1]}return null}function wW(i,n){return i.type&11?T_(i,n):i.type&4?SE(i,n):null}function CW(i,n,e,a){return e===-1?wW(n,i):e===-2?EW(i,n,a):Yy(i,i[ni],e,n)}function EW(i,n,e){if(e===pr)return T_(n,i);if(e===rl)return SE(n,i);if(e===ol)return mV(n,i)}function gV(i,n,e,a){let d=n[xu].queries[a];if(d.matches===null){let r=i.data,C=e.matches,P=[];for(let k=0;C!==null&&k<C.length;k+=2){let X=C[k];if(X<0)P.push(null);else{let oe=r[X];P.push(CW(n,oe,C[k+1],e.metadata.read))}}d.matches=P}return d.matches}function iA(i,n,e,a){let d=i.queries.getByIndex(e),r=d.matches;if(r!==null){let C=gV(i,n,d,e);for(let P=0;P<r.length;P+=2){let k=r[P];if(k>0)a.push(C[P/2]);else{let X=r[P+1],oe=n[-k];for(let Me=Oo;Me<oe.length;Me++){let $e=oe[Me];$e[kh]===$e[ls]&&iA($e[ni],$e,X,a)}if(oe[Tf]!==null){let Me=oe[Tf];for(let $e=0;$e<Me.length;$e++){let ke=Me[$e];iA(ke[ni],ke,X,a)}}}}}return a}function SW(i,n){return i[xu].queries[n].queryList}function TW(i,n,e){let a=new tE((e&4)===4);return L3(i,n,a,a.destroy),(n[xu]??=new J2).queries.push(new Q2(a))-1}function IW(i,n,e){let a=Uo();return a.firstCreatePass&&(DW(a,new eA(i,n,e),-1),(n&2)===2&&(a.staticViewQueries=!0)),TW(a,yi(),n)}function MW(i){return i.split(",").map(n=>n.trim())}function DW(i,n,e){i.queries===null&&(i.queries=new tA),i.queries.track(new nA(n,e))}function HA(i,n){return i.queries.getByIndex(n)}function AW(i,n){let e=i[ni],a=HA(e,n);return a.crossesNgTemplate?iA(e,i,n,[]):gV(e,i,a,n)}var Iu=class{},DE=class{};var uE=class extends Iu{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new lE(this);constructor(n,e,a,d=!0){super(),this.ngModuleType=n,this._parent=e;let r=LD(n);this._bootstrapComponents=wB(r.bootstrap),this._r3Injector=d2(n,e,[{provide:Iu,useValue:this},{provide:cx,useValue:this.componentFactoryResolver},...a],Md(n),new Set(["environment"])),d&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},dE=class extends DE{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new uE(this.moduleType,n,[])}};var Qy=class extends Iu{injector;componentFactoryResolver=new lE(this);instance=null;constructor(n){super();let e=new vf([...n.providers,{provide:Iu,useValue:this},{provide:cx,useValue:this.componentFactoryResolver}],n.parent||p_(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function A_(i,n,e=null){return new Qy({providers:i,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var PW=(()=>{class i{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let a=zD(!1,e.type),d=a.length>0?A_([a],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,d)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=kt({token:i,providedIn:"environment",factory:()=>new i(hn(Yr))})}return i})();function vn(i){return tx(()=>{let n=_V(i),e=Ci(Ht({},n),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===gA.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&i.dependencies||null,getStandaloneInjector:n.standalone?d=>d.get(PW).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||Pd.Emulated,styles:i.styles||ua,_:null,schemas:i.schemas||null,tView:null,id:""});n.standalone&&Pc("NgStandalone"),vV(e);let a=i.dependencies;return e.directiveDefs=Mz(a,OW),e.pipeDefs=Mz(a,w3),e.id=FW(e),e})}function OW(i){return vu(i)||ND(i)}function Tr(i){return tx(()=>({type:i.type,bootstrap:i.bootstrap||ua,declarations:i.declarations||ua,imports:i.imports||ua,exports:i.exports||ua,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function RW(i,n){if(i==null)return Rh;let e={};for(let a in i)if(i.hasOwnProperty(a)){let d=i[a],r,C,P,k;Array.isArray(d)?(P=d[0],r=d[1],C=d[2]??r,k=d[3]||null):(r=d,C=d,P=xE.None,k=null),e[r]=[a,P,k],n[r]=C}return e}function kW(i){if(i==null)return Rh;let n={};for(let e in i)i.hasOwnProperty(e)&&(n[i[e]]=e);return n}function yr(i){return tx(()=>{let n=_V(i);return vV(n),n})}function P_(i){return{type:i.type,name:i.name,factory:null,pure:i.pure!==!1,standalone:i.standalone??!0,onDestroy:i.type.prototype.ngOnDestroy||null}}function _V(i){let n={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:n,inputConfig:i.inputs||Rh,exportAs:i.exportAs||null,standalone:i.standalone??!0,signals:i.signals===!0,selectors:i.selectors||ua,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:RW(i.inputs,n),outputs:kW(i.outputs),debugInfo:null}}function vV(i){i.features?.forEach(n=>n(i))}function Mz(i,n){return i?()=>{let e=typeof i=="function"?i():i,a=[];for(let d of e){let r=n(d);r!==null&&a.push(r)}return a}:null}function FW(i){let n=0,e=typeof i.consts=="function"?"":i.consts,a=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,e,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery];for(let r of a.join("|"))n=Math.imul(31,n)+r.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function LW(i){return Object.getPrototypeOf(i.prototype).constructor}function bs(i){let n=LW(i.type),e=!0,a=[i];for(;n;){let d;if(wu(i))d=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new sn(903,!1);d=n.\u0275dir}if(d){if(e){a.push(d);let C=i;C.inputs=C2(i.inputs),C.declaredInputs=C2(i.declaredInputs),C.outputs=C2(i.outputs);let P=d.hostBindings;P&&UW(i,P);let k=d.viewQuery,X=d.contentQueries;if(k&&BW(i,k),X&&VW(i,X),NW(i,d),p3(i.outputs,d.outputs),wu(d)&&d.data.animation){let oe=i.data;oe.animation=(oe.animation||[]).concat(d.data.animation)}}let r=d.features;if(r)for(let C=0;C<r.length;C++){let P=r[C];P&&P.ngInherit&&P(i),P===bs&&(e=!1)}}n=Object.getPrototypeOf(n)}zW(a)}function NW(i,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||i.inputs.hasOwnProperty(e))continue;let a=n.inputs[e];a!==void 0&&(i.inputs[e]=a,i.declaredInputs[e]=n.declaredInputs[e])}}function zW(i){let n=0,e=null;for(let a=i.length-1;a>=0;a--){let d=i[a];d.hostVars=n+=d.hostVars,d.hostAttrs=w_(d.hostAttrs,e=w_(e,d.hostAttrs))}}function C2(i){return i===Rh?{}:i===ua?[]:i}function BW(i,n){let e=i.viewQuery;e?i.viewQuery=(a,d)=>{n(a,d),e(a,d)}:i.viewQuery=n}function VW(i,n){let e=i.contentQueries;e?i.contentQueries=(a,d,r)=>{n(a,d,r),e(a,d,r)}:i.contentQueries=n}function UW(i,n){let e=i.hostBindings;e?i.hostBindings=(a,d)=>{n(a,d),e(a,d)}:i.hostBindings=n}function yV(i,n,e,a,d,r,C,P){if(e.firstCreatePass){i.mergedAttrs=w_(i.mergedAttrs,i.attrs);let oe=i.tView=IA(2,i,d,r,C,e.directiveRegistry,e.pipeRegistry,null,e.schemas,e.consts,null);e.queries!==null&&(e.queries.template(e,i),oe.queries=e.queries.embeddedTView(i))}P&&(i.flags|=P),v_(i,!1);let k=$W(e,n,i,a);NC()&&FA(e,n,k,i),C_(k,n);let X=eV(k,n,k,i);n[a+uo]=X,DA(n,X),yW(X,i,n)}function jW(i,n,e,a,d,r,C,P,k,X,oe){let Me=e+uo,$e;return n.firstCreatePass?($e=D_(n,Me,4,C||null,P||null),JD()&&aV(n,i,$e,kl(n.consts,X),jB),Bz(n,$e)):$e=n.data[Me],yV($e,i,n,e,a,d,r,k),Uy($e)&&NA(n,i,$e),X!=null&&EE(i,$e,oe),$e}function Jy(i,n,e,a,d,r,C,P,k,X,oe){let Me=e+uo,$e;if(n.firstCreatePass){if($e=D_(n,Me,4,C||null,P||null),X!=null){let ke=kl(n.consts,X);$e.localNames=[];for(let ht=0;ht<ke.length;ht+=2)$e.localNames.push(ke[ht],-1)}}else $e=n.data[Me];return yV($e,i,n,e,a,d,r,k),X!=null&&EE(i,$e,oe),$e}function $i(i,n,e,a,d,r,C,P){let k=yi(),X=Uo(),oe=kl(X.consts,r);return jW(k,X,i,n,e,a,d,oe,void 0,C,P),$i}var $W=HW;function HW(i,n,e,a){return zC(!0),n[co].createComment("")}var AE=(()=>{class i{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();var GA=new Kt("");function Fd(i){return!!i&&typeof i.then=="function"}function PE(i){return!!i&&typeof i.subscribe=="function"}var qA=new Kt("");function OE(i){return Sc([{provide:qA,multi:!0,useValue:i}])}var WA=(()=>{class i{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,a)=>{this.resolve=e,this.reject=a});appInits=Ve(qA,{optional:!0})??[];injector=Ve(hr);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let d of this.appInits){let r=ys(this.injector,d);if(Fd(r))e.push(r);else if(PE(r)){let C=new Promise((P,k)=>{r.subscribe({complete:P,error:k})});e.push(C)}}let a=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{a()}).catch(d=>{this.reject(d)}),e.length===0&&a(),this.initialized=!0}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ux=new Kt("");function xV(){XM(()=>{let i="";throw new sn(600,i)})}function bV(i){return i.isBoundToModule}var GW=10;var Ra=(()=>{class i{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Ve(Gs);afterRenderManager=Ve(RA);zonelessEnabled=Ve(y_);rootEffectScheduler=Ve(_2);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new li;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=Ve(Eu);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Qn(e=>!e))}constructor(){Ve(kf,{optional:!0})}whenStable(){let e;return new Promise(a=>{e=this.isStable.subscribe({next:d=>{d&&a()}})}).finally(()=>{e.unsubscribe()})}_injector=Ve(Yr);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,a){return this.bootstrapImpl(e,a)}bootstrapImpl(e,a,d=hr.NULL){return this._injector.get(xi).run(()=>{zr(10);let C=e instanceof TE;if(!this._injector.get(WA).done){let ht="";throw new sn(405,ht)}let k;C?k=e:k=this._injector.get(cx).resolveComponentFactory(e),this.componentTypes.push(k.componentType);let X=bV(k)?void 0:this._injector.get(Iu),oe=a||k.selector,Me=k.create(d,[],oe,X),$e=Me.location.nativeElement,ke=Me.injector.get(GA,null);return ke?.registerApplication($e),Me.onDestroy(()=>{this.detachView(Me.hostView),Zy(this.components,Me),ke?.unregisterApplication($e)}),this._loadComponent(Me),zr(11,Me),Me})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){zr(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(bE.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new sn(101,!1);let e=Ei(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Ei(e),this.afterTick.next(),zr(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(xs,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<GW;)zr(14),this.synchronizeOnce(),zr(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let e=!1;if(this.dirtyFlags&7){let a=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:d}of this.allViews){if(!a&&!Hy(d))continue;let r=a&&!this.zonelessEnabled?0:1;XB(d,r),e=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}e||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Hy(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let a=e;this._views.push(a),a.attachToAppRef(this)}detachView(e){let a=e;Zy(this._views,a),a.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView);try{this.tick()}catch(d){this.internalErrorHandler(d)}this.components.push(e),this._injector.get(ux,[]).forEach(d=>d(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Zy(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new sn(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Zy(i,n){let e=i.indexOf(n);e>-1&&i.splice(e,1)}function Ro(i,n,e,a){let d=yi(),r=Mf();if(Ll(d,r,n)){let C=Uo(),P=LC();g7(P,d,i,n,e,a)}return Ro}var cfe=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var rA=class{destroy(n){}updateValue(n,e){}swap(n,e){let a=Math.min(n,e),d=Math.max(n,e),r=this.detach(d);if(d-a>1){let C=this.detach(a);this.attach(a,r),this.attach(d,C)}else this.attach(a,r)}move(n,e){this.attach(e,this.detach(n))}};function E2(i,n,e,a,d){return i===e&&Object.is(n,a)?1:Object.is(d(i,n),d(e,a))?-1:0}function qW(i,n,e){let a,d,r=0,C=i.length-1,P=void 0;if(Array.isArray(n)){let k=n.length-1;for(;r<=C&&r<=k;){let X=i.at(r),oe=n[r],Me=E2(r,X,r,oe,e);if(Me!==0){Me<0&&i.updateValue(r,oe),r++;continue}let $e=i.at(C),ke=n[k],ht=E2(C,$e,k,ke,e);if(ht!==0){ht<0&&i.updateValue(C,ke),C--,k--;continue}let Nt=e(r,X),Mt=e(C,$e),Xt=e(r,oe);if(Object.is(Xt,Mt)){let Vn=e(k,ke);Object.is(Vn,Nt)?(i.swap(r,C),i.updateValue(C,ke),k--,C--):i.move(C,r),i.updateValue(r,oe),r++;continue}if(a??=new hE,d??=Az(i,r,C,e),oA(i,a,r,Xt))i.updateValue(r,oe),r++,C++;else if(d.has(Xt))a.set(Nt,i.detach(r)),C--;else{let Vn=i.create(r,n[r]);i.attach(r,Vn),r++,C++}}for(;r<=k;)Dz(i,a,e,r,n[r]),r++}else if(n!=null){let k=n[Symbol.iterator](),X=k.next();for(;!X.done&&r<=C;){let oe=i.at(r),Me=X.value,$e=E2(r,oe,r,Me,e);if($e!==0)$e<0&&i.updateValue(r,Me),r++,X=k.next();else{a??=new hE,d??=Az(i,r,C,e);let ke=e(r,Me);if(oA(i,a,r,ke))i.updateValue(r,Me),r++,C++,X=k.next();else if(!d.has(ke))i.attach(r,i.create(r,Me)),r++,C++,X=k.next();else{let ht=e(r,oe);a.set(ht,i.detach(r)),C--}}}for(;!X.done;)Dz(i,a,e,i.length,X.value),X=k.next()}for(;r<=C;)i.destroy(i.detach(C--));a?.forEach(k=>{i.destroy(k)})}function oA(i,n,e,a){return n!==void 0&&n.has(a)?(i.attach(e,n.get(a)),n.delete(a),!0):!1}function Dz(i,n,e,a,d){if(oA(i,n,a,e(a,d)))i.updateValue(a,d);else{let r=i.create(a,d);i.attach(a,r)}}function Az(i,n,e,a){let d=new Set;for(let r=n;r<=e;r++)d.add(a(r,i.at(r)));return d}var hE=class{kvMap=new Map;_vMap=void 0;has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;let e=this.kvMap.get(n);return this._vMap!==void 0&&this._vMap.has(e)?(this.kvMap.set(n,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,e){if(this.kvMap.has(n)){let a=this.kvMap.get(n);this._vMap===void 0&&(this._vMap=new Map);let d=this._vMap;for(;d.has(a);)a=d.get(a);d.set(a,e)}else this.kvMap.set(n,e)}forEach(n){for(let[e,a]of this.kvMap)if(n(a,e),this._vMap!==void 0){let d=this._vMap;for(;d.has(a);)a=d.get(a),n(a,e)}}};function Je(i,n,e,a,d,r,C,P){Pc("NgControlFlow");let k=yi(),X=Uo(),oe=kl(X.consts,r);return Jy(k,X,i,n,e,a,d,oe,256,C,P),dx}function dx(i,n,e,a,d,r,C,P){Pc("NgControlFlow");let k=yi(),X=Uo(),oe=kl(X.consts,r);return Jy(k,X,i,n,e,a,d,oe,512,C,P),dx}function et(i,n){Pc("NgControlFlow");let e=yi(),a=Mf(),d=e[a]!==pa?e[a]:-1,r=d!==-1?pE(e,uo+d):void 0,C=0;if(Ll(e,a,i)){let P=Ei(null);try{if(r!==void 0&&nV(r,C),i!==-1){let k=uo+i,X=pE(e,k),oe=cA(e[ni],k),Me=rV(X,oe,e),$e=ax(e,oe,n,{dehydratedView:Me});lx(X,$e,C,E_(oe,Me))}}finally{Ei(P)}}else if(r!==void 0){let P=tV(r,C);P!==void 0&&(P[Vo]=n)}}var sA=class{lContainer;$implicit;$index;constructor(n,e,a){this.lContainer=n,this.$implicit=e,this.$index=a}get $count(){return this.lContainer.length-Oo}};function ka(i){return i}var aA=class{hasEmptyBlock;trackByFn;liveCollection;constructor(n,e,a){this.hasEmptyBlock=n,this.trackByFn=e,this.liveCollection=a}};function Wi(i,n,e,a,d,r,C,P,k,X,oe,Me,$e){Pc("NgControlFlow");let ke=yi(),ht=Uo(),Nt=k!==void 0,Mt=yi(),Xt=P?C.bind(Mt[ha][Vo]):C,Vn=new aA(Nt,Xt);Mt[uo+i]=Vn,Jy(ke,ht,i+1,n,e,a,d,kl(ht.consts,r),256),Nt&&Jy(ke,ht,i+2,k,X,oe,Me,kl(ht.consts,$e),512)}var lA=class extends rA{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(n,e,a){super(),this.lContainer=n,this.hostLView=e,this.templateTNode=a}get length(){return this.lContainer.length-Oo}at(n){return this.getLView(n)[Vo].$implicit}attach(n,e){let a=e[bf];this.needsIndexUpdate||=n!==this.length,lx(this.lContainer,e,n,E_(this.templateTNode,a)),WW(this.lContainer,n)}detach(n){return this.needsIndexUpdate||=n!==this.length-1,ZW(this.lContainer,n),YW(this.lContainer,n)}create(n,e){let a=sE(this.lContainer,this.templateTNode.tView.ssrId),d=ax(this.hostLView,this.templateTNode,new sA(this.lContainer,e,n),{dehydratedView:a});return this.operationsCounter?.recordCreate(),d}destroy(n){wE(n[ni],n),this.operationsCounter?.recordDestroy()}updateValue(n,e){this.getLView(n)[Vo].$implicit=e}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[Vo].$index=n}getLView(n){return XW(this.lContainer,n)}};function Zi(i){let n=Ei(null),e=Cu();try{let a=yi(),d=a[ni],r=a[e],C=e+1,P=pE(a,C);if(r.liveCollection===void 0){let X=cA(d,C);r.liveCollection=new lA(P,a,X)}else r.liveCollection.reset();let k=r.liveCollection;if(qW(k,i,r.trackByFn),k.updateIndexes(),r.hasEmptyBlock){let X=Mf(),oe=k.length===0;if(Ll(a,X,oe)){let Me=e+2,$e=pE(a,Me);if(oe){let ke=cA(d,Me),ht=rV($e,ke,a),Nt=ax(a,ke,void 0,{dehydratedView:ht});lx($e,Nt,0,E_(ke,ht))}else d.firstUpdatePass&&V7($e),nV($e,0)}}}finally{Ei(n)}}function pE(i,n){return i[n]}function WW(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e],d=a?a[Sf]:void 0;if(a&&d&&d.detachedLeaveAnimationFns&&d.detachedLeaveAnimationFns.length>0){let r=a[Ad];W9(r,d),Pf.delete(a),d.detachedLeaveAnimationFns=void 0}}function ZW(i,n){if(i.length<=Oo)return;let e=Oo+n,a=i[e],d=a?a[Sf]:void 0;d&&d.leave&&d.leave.size>0&&(d.detachedLeaveAnimationFns=[])}function YW(i,n){return Ky(i,n)}function XW(i,n){return tV(i,n)}function cA(i,n){return jy(i,n)}function vt(i,n,e){let a=yi(),d=Mf();if(Ll(a,d,n)){let r=Uo(),C=LC();UB(C,a,i,n,a[co],e)}return vt}function uA(i,n,e,a,d){zA(n,i,e,d?"class":"style",a)}function z(i,n,e,a){let d=yi(),r=d[ni],C=i+uo,P=r.firstCreatePass?cV(C,d,2,n,jB,JD(),e,a):r.data[C];if($B(P,d,i,n,wV),Uy(P)){let k=d[ni];NA(k,d,P),cB(k,P,d)}return a!=null&&EE(d,P),z}function V(){let i=Uo(),n=ks(),e=HB(n);return i.firstCreatePass&&uV(i,e),t2(e)&&n2(),QD(),e.classesWithoutHost!=null&&Dq(e)&&uA(i,e,yi(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&Aq(e)&&uA(i,e,yi(),e.stylesWithoutHost,!1),V}function An(i,n,e,a){return z(i,n,e,a),V(),An}function O_(i,n,e,a){let d=yi(),r=d[ni],C=i+uo,P=r.firstCreatePass?eW(C,r,2,n,e,a):r.data[C];return $B(P,d,i,n,wV),a!=null&&EE(d,P),O_}function R_(){let i=ks(),n=HB(i);return t2(n)&&n2(),QD(),R_}function Ff(i,n,e,a){return O_(i,n,e,a),R_(),Ff}var wV=(i,n,e,a,d)=>(zC(!0),gB(n[co],a,K3()));function wt(){return yi()}var HC=void 0;function KW(i){let n=Math.floor(Math.abs(i)),e=i.toString().replace(/^[^.]*\.?/,"").length;return n===1&&e===0?1:5}var QW=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],HC,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],HC,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",HC,"{1} 'at' {0}",HC],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",KW],S2={};function sl(i){let n=JW(i),e=Pz(n);if(e)return e;let a=n.split("-")[0];if(e=Pz(a),e)return e;if(a==="en")return QW;throw new sn(701,!1)}function Pz(i){return i in S2||(S2[i]=Al.ng&&Al.ng.common&&Al.ng.common.locales&&Al.ng.common.locales[i]),S2[i]}var jo=(function(i){return i[i.LocaleId=0]="LocaleId",i[i.DayPeriodsFormat=1]="DayPeriodsFormat",i[i.DayPeriodsStandalone=2]="DayPeriodsStandalone",i[i.DaysFormat=3]="DaysFormat",i[i.DaysStandalone=4]="DaysStandalone",i[i.MonthsFormat=5]="MonthsFormat",i[i.MonthsStandalone=6]="MonthsStandalone",i[i.Eras=7]="Eras",i[i.FirstDayOfWeek=8]="FirstDayOfWeek",i[i.WeekendRange=9]="WeekendRange",i[i.DateFormat=10]="DateFormat",i[i.TimeFormat=11]="TimeFormat",i[i.DateTimeFormat=12]="DateTimeFormat",i[i.NumberSymbols=13]="NumberSymbols",i[i.NumberFormats=14]="NumberFormats",i[i.CurrencyCode=15]="CurrencyCode",i[i.CurrencySymbol=16]="CurrencySymbol",i[i.CurrencyName=17]="CurrencyName",i[i.Currencies=18]="Currencies",i[i.Directionality=19]="Directionality",i[i.PluralCase=20]="PluralCase",i[i.ExtraData=21]="ExtraData",i})(jo||{});function JW(i){return i.toLowerCase().replace(/_/g,"-")}var hx="en-US";var eZ=hx;function CV(i){typeof i=="string"&&(eZ=i.toLowerCase().replace(/_/g,"-"))}function Te(i,n,e){let a=yi(),d=Uo(),r=ks();return EV(d,a,a[co],r,i,n,e),Te}function EV(i,n,e,a,d,r,C){let P=!0,k=null;if((a.type&3||C)&&(k??=b2(a,n,r),iW(a,i,n,C,e,d,r,k)&&(P=!1)),P){let X=a.outputs?.[d],oe=a.hostDirectiveOutputs?.[d];if(oe&&oe.length)for(let Me=0;Me<oe.length;Me+=2){let $e=oe[Me],ke=oe[Me+1];k??=b2(a,n,r),Sz(a,n,$e,ke,d,k)}if(X&&X.length)for(let Me of X)k??=b2(a,n,r),Sz(a,n,Me,d,d,k)}}function te(i=1){return X3(i)}function tZ(i,n){let e=null,a=M9(i);for(let d=0;d<n.length;d++){let r=n[d];if(r==="*"){e=d;continue}if(a===null?EB(i,r,!0):P9(a,r))return d}return e}function Lf(i){let n=yi()[ha][da];if(!n.projection){let e=i?i.length:1,a=n.projection=x3(e,null),d=a.slice(),r=n.child;for(;r!==null;){if(r.type!==128){let C=i?tZ(r,i):0;C!==null&&(d[C]?d[C].projectionNext=r:a[C]=r,d[C]=r)}r=r.next}}}function Ld(i,n=0,e,a,d,r){let C=yi(),P=Uo(),k=a?i+1:null;k!==null&&Jy(C,P,k,a,d,r,null,e);let X=D_(P,uo+i,16,null,e||null);X.projection===null&&(X.projection=n),o2();let Me=!C[bf]||e2();C[ha][da].projection[X.projection]===null&&k!==null?nZ(C,P,k):Me&&!vE(X)&&r7(P,C,X)}function nZ(i,n,e){let a=uo+e,d=n.data[a],r=i[a],C=sE(r,d.tView.ssrId),P=ax(i,d,void 0,{dehydratedView:C});lx(r,P,0,E_(d,C))}function Fa(i,n,e){IW(i,n,e)}function fa(i){let n=yi(),e=Uo(),a=l2();RC(a+1);let d=HA(e,a);if(i.dirty&&O3(n)===((d.metadata.flags&2)===2)){if(d.matches===null)i.reset([]);else{let r=AW(n,a);i.reset(r,$q),i.notifyOnChanges()}return!0}return!1}function ma(){return SW(yi(),l2())}function Bl(i){let n=V3();return $y(n,uo+i)}function GC(i,n){return i<<17|n<<2}function Of(i){return i>>17&32767}function iZ(i){return(i&2)==2}function rZ(i,n){return i&131071|n<<17}function dA(i){return i|2}function S_(i){return(i&131068)>>2}function T2(i,n){return i&-131069|n<<2}function oZ(i){return(i&1)===1}function hA(i){return i|1}function sZ(i,n,e,a,d,r){let C=r?n.classBindings:n.styleBindings,P=Of(C),k=S_(C);i[a]=e;let X=!1,oe;if(Array.isArray(e)){let Me=e;oe=Me[1],(oe===null||h_(Me,oe)>0)&&(X=!0)}else oe=e;if(d)if(k!==0){let $e=Of(i[P+1]);i[a+1]=GC($e,P),$e!==0&&(i[$e+1]=T2(i[$e+1],a)),i[P+1]=rZ(i[P+1],a)}else i[a+1]=GC(P,0),P!==0&&(i[P+1]=T2(i[P+1],a)),P=a;else i[a+1]=GC(k,0),P===0?P=a:i[k+1]=T2(i[k+1],a),k=a;X&&(i[a+1]=dA(i[a+1])),Oz(i,oe,a,!0),Oz(i,oe,a,!1),aZ(n,oe,i,a,r),C=GC(P,k),r?n.classBindings=C:n.styleBindings=C}function aZ(i,n,e,a,d){let r=d?i.residualClasses:i.residualStyles;r!=null&&typeof n=="string"&&h_(r,n)>=0&&(e[a+1]=hA(e[a+1]))}function Oz(i,n,e,a){let d=i[e+1],r=n===null,C=a?Of(d):S_(d),P=!1;for(;C!==0&&(P===!1||r);){let k=i[C],X=i[C+1];lZ(k,n)&&(P=!0,i[C+1]=a?hA(X):dA(X)),C=a?Of(X):S_(X)}P&&(i[e+1]=a?dA(d):hA(d))}function lZ(i,n){return i===null||n==null||(Array.isArray(i)?i[1]:i)===n?!0:Array.isArray(i)&&typeof n=="string"?h_(i,n)>=0:!1}var Ac={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function cZ(i){return i.substring(Ac.key,Ac.keyEnd)}function uZ(i){return dZ(i),SV(i,TV(i,0,Ac.textEnd))}function SV(i,n){let e=Ac.textEnd;return e===n?-1:(n=Ac.keyEnd=hZ(i,Ac.key=n,e),TV(i,n,e))}function dZ(i){Ac.key=0,Ac.keyEnd=0,Ac.value=0,Ac.valueEnd=0,Ac.textEnd=i.length}function TV(i,n,e){for(;n<e&&i.charCodeAt(n)<=32;)n++;return n}function hZ(i,n,e){for(;n<e&&i.charCodeAt(n)>32;)n++;return n}function $o(i,n,e){return IV(i,n,e,!1),$o}function an(i,n){return IV(i,n,null,!0),an}function px(i){fZ(xZ,pZ,i,!0)}function pZ(i,n){for(let e=uZ(n);e>=0;e=SV(n,e))TC(i,cZ(n),!0)}function IV(i,n,e,a){let d=yi(),r=Uo(),C=PC(2);if(r.firstUpdatePass&&DV(r,i,C,a),n!==pa&&Ll(d,C,n)){let P=r.data[Cu()];AV(r,P,d,d[co],i,d[C+1]=wZ(n,e),a,C)}}function fZ(i,n,e,a){let d=Uo(),r=PC(2);d.firstUpdatePass&&DV(d,null,r,a);let C=yi();if(e!==pa&&Ll(C,r,e)){let P=d.data[Cu()];if(PV(P,a)&&!MV(d,r)){let k=a?P.classesWithoutHost:P.stylesWithoutHost;k!==null&&(e=wC(k,e||"")),uA(d,P,C,e,a)}else bZ(d,P,C,C[co],C[r+1],C[r+1]=yZ(i,n,e),a,r)}}function MV(i,n){return n>=i.expandoStartIndex}function DV(i,n,e,a){let d=i.data;if(d[e+1]===null){let r=d[Cu()],C=MV(i,e);PV(r,a)&&n===null&&!C&&(n=!1),n=mZ(d,r,n,a),sZ(d,r,n,e,C,a)}}function mZ(i,n,e,a){let d=q3(i),r=a?n.residualClasses:n.residualStyles;if(d===null)(a?n.classBindings:n.styleBindings)===0&&(e=I2(null,i,n,e,a),e=ex(e,n.attrs,a),r=null);else{let C=n.directiveStylingLast;if(C===-1||i[C]!==d)if(e=I2(d,i,n,e,a),r===null){let k=gZ(i,n,a);k!==void 0&&Array.isArray(k)&&(k=I2(null,i,n,k[1],a),k=ex(k,n.attrs,a),_Z(i,n,a,k))}else r=vZ(i,n,a)}return r!==void 0&&(a?n.residualClasses=r:n.residualStyles=r),e}function gZ(i,n,e){let a=e?n.classBindings:n.styleBindings;if(S_(a)!==0)return i[Of(a)]}function _Z(i,n,e,a){let d=e?n.classBindings:n.styleBindings;i[Of(d)]=a}function vZ(i,n,e){let a,d=n.directiveEnd;for(let r=1+n.directiveStylingLast;r<d;r++){let C=i[r].hostAttrs;a=ex(a,C,e)}return ex(a,n.attrs,e)}function I2(i,n,e,a,d){let r=null,C=e.directiveEnd,P=e.directiveStylingLast;for(P===-1?P=e.directiveStart:P++;P<C&&(r=n[P],a=ex(a,r.hostAttrs,d),r!==i);)P++;return i!==null&&(e.directiveStylingLast=P),a}function ex(i,n,e){let a=e?1:2,d=-1;if(n!==null)for(let r=0;r<n.length;r++){let C=n[r];typeof C=="number"?d=C:d===a&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),TC(i,C,e?!0:n[++r]))}return i===void 0?null:i}function yZ(i,n,e){if(e==null||e==="")return ua;let a=[],d=Nl(e);if(Array.isArray(d))for(let r=0;r<d.length;r++)i(a,d[r],!0);else if(typeof d=="object")for(let r in d)d.hasOwnProperty(r)&&i(a,r,d[r]);else typeof d=="string"&&n(a,d);return a}function xZ(i,n,e){let a=String(n);a!==""&&!a.includes(" ")&&TC(i,a,e)}function bZ(i,n,e,a,d,r,C,P){d===pa&&(d=ua);let k=0,X=0,oe=0<d.length?d[0]:null,Me=0<r.length?r[0]:null;for(;oe!==null||Me!==null;){let $e=k<d.length?d[k+1]:void 0,ke=X<r.length?r[X+1]:void 0,ht=null,Nt;oe===Me?(k+=2,X+=2,$e!==ke&&(ht=Me,Nt=ke)):Me===null||oe!==null&&oe<Me?(k+=2,ht=oe):(X+=2,ht=Me,Nt=ke),ht!==null&&AV(i,n,e,a,ht,Nt,C,P),oe=k<d.length?d[k]:null,Me=X<r.length?r[X]:null}}function AV(i,n,e,a,d,r,C,P){if(!(n.type&3))return;let k=i.data,X=k[P+1],oe=oZ(X)?Rz(k,n,e,d,S_(X),C):void 0;if(!fE(oe)){fE(r)||iZ(X)&&(r=Rz(k,null,e,d,P,C));let Me=GD(Cu(),e);s7(a,C,Me,d,r)}}function Rz(i,n,e,a,d,r){let C=n===null,P;for(;d>0;){let k=i[d],X=Array.isArray(k),oe=X?k[1]:k,Me=oe===null,$e=e[d+1];$e===pa&&($e=Me?ua:void 0);let ke=Me?IC($e,a):oe===a?$e:void 0;if(X&&!fE(ke)&&(ke=IC(k,a)),fE(ke)&&(P=ke,C))return P;let ht=i[d+1];d=C?Of(ht):S_(ht)}if(n!==null){let k=r?n.residualClasses:n.residualStyles;k!=null&&(P=IC(k,a))}return P}function fE(i){return i!==void 0}function wZ(i,n){return i==null||i===""||(typeof n=="string"?i=i+n:typeof i=="object"&&(i=Md(Nl(i)))),i}function PV(i,n){return(i.flags&(n?8:16))!==0}function W(i,n=""){let e=yi(),a=Uo(),d=i+uo,r=a.firstCreatePass?D_(a,d,1,n,null):a.data[d],C=CZ(a,e,r,n,i);e[d]=C,NC()&&FA(a,e,C,r),v_(r,!1)}var CZ=(i,n,e,a,d)=>(zC(!0),v9(n[co],a));function EZ(i,n,e,a=""){return Ll(i,Mf(),e)?n+xf(e)+a:pa}function SZ(i,n,e,a,d,r=""){let C=U3(),P=$A(i,C,e,d);return PC(2),P?n+xf(e)+a+xf(d)+r:pa}function ot(i){return bi("",i),ot}function bi(i,n,e){let a=yi(),d=EZ(a,i,n,e);return d!==pa&&OV(a,Cu(),d),bi}function ga(i,n,e,a,d){let r=yi(),C=SZ(r,i,n,e,a,d);return C!==pa&&OV(r,Cu(),C),ga}function OV(i,n,e){let a=GD(n,i);y9(i[co],a,e)}function _o(i,n,e){f2(n)&&(n=n());let a=yi(),d=Mf();if(Ll(a,d,n)){let r=Uo(),C=LC();UB(C,a,i,n,a[co],e)}return _o}function To(i,n){let e=f2(i);return e&&i.set(n),e}function vo(i,n){let e=yi(),a=Uo(),d=ks();return EV(a,e,e[co],d,i,n),vo}function TZ(i,n,e){let a=Uo();if(a.firstCreatePass){let d=wu(i);pA(e,a.data,a.blueprint,d,!0),pA(n,a.data,a.blueprint,d,!1)}}function pA(i,n,e,a,d){if(i=Rs(i),Array.isArray(i))for(let r=0;r<i.length;r++)pA(i[r],n,e,a,d);else{let r=Uo(),C=yi(),P=ks(),k=_f(i)?i:Rs(i.provide),X=VD(i),oe=P.providerIndexes&1048575,Me=P.directiveStart,$e=P.providerIndexes>>20;if(_f(i)||!i.multi){let ke=new Af(X,d,Dt,null),ht=D2(k,n,d?oe:oe+$e,Me);ht===-1?(P2(eE(P,C),r,k),M2(r,i,n.length),n.push(k),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),e.push(ke),C.push(ke)):(e[ht]=ke,C[ht]=ke)}else{let ke=D2(k,n,oe+$e,Me),ht=D2(k,n,oe,oe+$e),Nt=ke>=0&&e[ke],Mt=ht>=0&&e[ht];if(d&&!Mt||!d&&!Nt){P2(eE(P,C),r,k);let Xt=DZ(d?MZ:IZ,e.length,d,a,X,i);!d&&Mt&&(e[ht].providerFactory=Xt),M2(r,i,n.length,0),n.push(k),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),e.push(Xt),C.push(Xt)}else{let Xt=RV(e[d?ht:ke],X,!d&&a);M2(r,i,ke>-1?ke:ht,Xt)}!d&&a&&Mt&&e[ht].componentProviders++}}}function M2(i,n,e,a){let d=_f(n),r=I3(n);if(d||r){let k=(r?Rs(n.useClass):n).prototype.ngOnDestroy;if(k){let X=i.destroyHooks||(i.destroyHooks=[]);if(!d&&n.multi){let oe=X.indexOf(e);oe===-1?X.push(e,[a,k]):X[oe+1].push(a,k)}else X.push(e,k)}}}function RV(i,n,e){return e&&i.componentProviders++,i.multi.push(n)-1}function D2(i,n,e,a){for(let d=e;d<a;d++)if(n[d]===i)return d;return-1}function IZ(i,n,e,a,d){return fA(this.multi,[])}function MZ(i,n,e,a,d){let r=this.multi,C;if(this.providerFactory){let P=this.providerFactory.componentProviders,k=Yy(a,a[ni],this.providerFactory.index,d);C=k.slice(0,P),fA(r,C);for(let X=P;X<k.length;X++)C.push(k[X])}else C=[],fA(r,C);return C}function fA(i,n){for(let e=0;e<i.length;e++){let a=i[e];n.push(a())}return n}function DZ(i,n,e,a,d,r){let C=new Af(i,e,Dt,null);return C.multi=[],C.index=n,C.componentProviders=0,RV(C,d,a&&!e),C}function Nd(i,n=[]){return e=>{e.providersResolver=(a,d)=>TZ(a,d?d(i):i,n)}}function k_(i,n,e){let a=Gy()+i,d=yi();return d[a]===pa?ME(d,a,e?n.call(e):n()):tW(d,a)}function ZA(i,n){let e=i[n];return e===pa?void 0:e}function AZ(i,n,e,a,d,r){let C=n+e;return Ll(i,C,d)?ME(i,C+1,r?a.call(r,d):a(d)):ZA(i,C+1)}function PZ(i,n,e,a,d,r,C){let P=n+e;return $A(i,P,d,r)?ME(i,P+2,C?a.call(C,d,r):a(d,r)):ZA(i,P+2)}function OZ(i,n,e,a,d,r,C,P){let k=n+e;return nW(i,k,d,r,C)?ME(i,k+3,P?a.call(P,d,r,C):a(d,r,C)):ZA(i,k+3)}function Ls(i,n){let e=Uo(),a,d=i+uo;e.firstCreatePass?(a=RZ(n,e.pipeRegistry),e.data[d]=a,a.onDestroy&&(e.destroyHooks??=[]).push(d,a.onDestroy)):a=e.data[d];let r=a.factory||(a.factory=Ph(a.type,!0)),C,P=ca(Dt);try{let k=JC(!1),X=r();return JC(k),qD(e,yi(),d,X),X}finally{ca(P)}}function RZ(i,n){if(n)for(let e=n.length-1;e>=0;e--){let a=n[e];if(i===a.name)return a}}function F_(i,n,e){let a=i+uo,d=yi(),r=$y(d,a);return YA(d,a)?AZ(d,Gy(),n,r.transform,e,r):r.transform(e)}function L_(i,n,e,a){let d=i+uo,r=yi(),C=$y(r,d);return YA(r,d)?PZ(r,Gy(),n,C.transform,e,a,C):C.transform(e,a)}function Nf(i,n,e,a,d){let r=i+uo,C=yi(),P=$y(C,r);return YA(C,r)?OZ(C,Gy(),n,P.transform,e,a,d,P):P.transform(e,a,d)}function YA(i,n){return i[ni].data[n].pure}function fx(i,n){return SE(i,n)}var mE=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},XA=(()=>{class i{compileModuleSync(e){return new dE(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let a=this.compileModuleSync(e),d=LD(e),r=wB(d.declarations).reduce((C,P)=>{let k=vu(P);return k&&C.push(new Bh(k)),C},[]);return new mE(a,r)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var kZ=(()=>{class i{zone=Ve(xi);changeDetectionScheduler=Ve(Dd);applicationRef=Ve(Ra);applicationErrorHandler=Ve(Gs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(e){this.applicationErrorHandler(e)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),kV=new Kt("",{factory:()=>!1});function KA({ngZoneFactory:i,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return i??=()=>new xi(Ci(Ht({},JA()),{scheduleInRootZone:e})),[{provide:xi,useFactory:i},{provide:_u,multi:!0,useFactory:()=>{let a=Ve(kZ,{optional:!0});return()=>a.initialize()}},{provide:_u,multi:!0,useFactory:()=>{let a=Ve(FZ);return()=>{a.initialize()}}},n===!0?{provide:m2,useValue:!0}:[],{provide:g2,useValue:e??MB},{provide:Gs,useFactory:()=>{let a=Ve(xi),d=Ve(Yr),r;return C=>{a.runOutsideAngular(()=>{d.destroyed&&!r?setTimeout(()=>{throw C}):(r??=d.get(Hs),r.handleError(C))})}}}]}function QA(i){let n=i?.ignoreChangesOutsideZone,e=i?.scheduleInRootZone,a=KA({ngZoneFactory:()=>{let d=JA(i);return d.scheduleInRootZone=e,d.shouldCoalesceEventChangeDetection&&Pc("NgZone_CoalesceEvent"),new xi(d)},ignoreChangesOutsideZone:n,scheduleInRootZone:e});return Sc([{provide:kV,useValue:!0},{provide:y_,useValue:!1},a])}function JA(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var FZ=(()=>{class i{subscription=new Gr;initialized=!1;zone=Ve(xi);pendingTasks=Ve(Eu);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{xi.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{xi.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var FV=(()=>{class i{applicationErrorHandler=Ve(Gs);appRef=Ve(Ra);taskService=Ve(Eu);ngZone=Ve(xi);zonelessEnabled=Ve(y_);tracing=Ve(kf,{optional:!0});disableScheduling=Ve(m2,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Gr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(iE):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ve(g2,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof rE||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let a=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,a=!0;break}case 12:{this.appRef.dirtyFlags|=16,a=!0;break}case 13:{this.appRef.dirtyFlags|=2,a=!0;break}case 11:{a=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(a))return;let d=this.useMicrotaskScheduler?mz:DB;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>d(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>d(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(iE+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(a){this.taskService.remove(e),this.applicationErrorHandler(a)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,mz(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function LZ(){return typeof $localize<"u"&&$localize.locale||hx}var mx=new Kt("",{providedIn:"root",factory:()=>Ve(mx,{optional:!0,skipSelf:!0})||LZ()});function Ho(i){return u3(i)}function N_(i,n){return Uw(i,n?.equal)}var LV=class{[$s];constructor(n){this[$s]=n}destroy(){this[$s].destroy()}};var jV=Symbol("InputSignalNode#UNSET"),QZ=Ci(Ht({},jw),{transformFn:void 0,applyValueToInputSignal(i,n){Jg(i,n)}});function $V(i,n){let e=Object.create(QZ);e.value=i,e.transformFn=n?.transform;function a(){if(Xg(e),e.value===jV){let d=null;throw new sn(-950,d)}return e.value}return a[$s]=e,a}var z_=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>nx(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},JZ=new Kt("");JZ.__NG_ELEMENT_ID__=i=>{let n=ks();if(n===null)throw new sn(204,!1);if(n.type&2)return n.value;if(i&8)return null;throw new sn(204,!1)};function NV(i,n){return $V(i,n)}function eY(i){return $V(jV,i)}var Io=(NV.required=eY,NV);var eP=new Kt(""),tY=new Kt("");function gx(i){return!i.moduleRef}function nY(i){let n=gx(i)?i.r3Injector:i.moduleRef.injector,e=n.get(xi);return e.run(()=>{gx(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let a=n.get(Gs),d;if(e.runOutsideAngular(()=>{d=e.onError.subscribe({next:a})}),gx(i)){let r=()=>n.destroy(),C=i.platformInjector.get(eP);C.add(r),n.onDestroy(()=>{d.unsubscribe(),C.delete(r)})}else{let r=()=>i.moduleRef.destroy(),C=i.platformInjector.get(eP);C.add(r),i.moduleRef.onDestroy(()=>{Zy(i.allPlatformModules,i.moduleRef),d.unsubscribe(),C.delete(r)})}return rY(a,e,()=>{let r=n.get(Eu),C=r.add(),P=n.get(WA);return P.runInitializers(),P.donePromise.then(()=>{let k=n.get(mx,hx);if(CV(k||hx),!n.get(tY,!0))return gx(i)?n.get(Ra):(i.allPlatformModules.push(i.moduleRef),i.moduleRef);if(gx(i)){let oe=n.get(Ra);return i.rootComponent!==void 0&&oe.bootstrap(i.rootComponent),oe}else return iY?.(i.moduleRef,i.allPlatformModules),i.moduleRef}).finally(()=>void r.remove(C))})})}var iY;function rY(i,n,e){try{let a=e();return Fd(a)?a.catch(d=>{throw n.runOutsideAngular(()=>i(d)),d}):a}catch(a){throw n.runOutsideAngular(()=>i(a)),a}}var RE=null;function oY(i=[],n){return hr.create({name:n,providers:[{provide:Ny,useValue:"platform"},{provide:eP,useValue:new Set([()=>RE=null])},...i]})}function sY(i=[]){if(RE)return RE;let n=oY(i);return RE=n,xV(),aY(n),n}function aY(i){let n=i.get(gE,null);ys(i,()=>{n?.forEach(e=>e())})}var Oc=(()=>{class i{static __NG_ELEMENT_ID__=lY}return i})();function lY(i){return cY(ks(),yi(),(i&16)===16)}function cY(i,n,e){if(Lh(i)&&!e){let a=Rl(i.index,n);return new zh(a,a)}else if(i.type&175){let a=n[ha];return new zh(a,n)}return null}var tP=class{constructor(){}supports(n){return jA(n)}create(n){return new nP(n)}},uY=(i,n)=>n,nP=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||uY}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,a=this._removalsHead,d=0,r=null;for(;e||a;){let C=!a||e&&e.currentIndex<zV(a,d,r)?e:a,P=zV(C,d,r),k=C.currentIndex;if(C===a)d--,a=a._nextRemoved;else if(e=e._next,C.previousIndex==null)d++;else{r||(r=[]);let X=P-d,oe=k-d;if(X!=oe){for(let $e=0;$e<X;$e++){let ke=$e<r.length?r[$e]:r[$e]=0,ht=ke+$e;oe<=ht&&ht<X&&(r[$e]=ke+1)}let Me=C.previousIndex;r[Me]=oe-X}}P!==k&&n(C,P,k)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!jA(n))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,a=!1,d,r,C;if(Array.isArray(n)){this.length=n.length;for(let P=0;P<this.length;P++)r=n[P],C=this._trackByFn(P,r),e===null||!Object.is(e.trackById,C)?(e=this._mismatch(e,r,C,P),a=!0):(a&&(e=this._verifyReinsertion(e,r,C,P)),Object.is(e.item,r)||this._addIdentityChange(e,r)),e=e._next}else d=0,dV(n,P=>{C=this._trackByFn(d,P),e===null||!Object.is(e.trackById,C)?(e=this._mismatch(e,P,C,d),a=!0):(a&&(e=this._verifyReinsertion(e,P,C,d)),Object.is(e.item,P)||this._addIdentityChange(e,P)),e=e._next,d++}),this.length=d;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,a,d){let r;return n===null?r=this._itTail:(r=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(a,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,r,d)):(n=this._linkedRecords===null?null:this._linkedRecords.get(a,d),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,r,d)):n=this._addAfter(new iP(e,a),r,d)),n}_verifyReinsertion(n,e,a,d){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(a,null);return r!==null?n=this._reinsertAfter(r,n._prev,d):n.currentIndex!=d&&(n.currentIndex=d,this._addToMoves(n,d)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,a){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let d=n._prevRemoved,r=n._nextRemoved;return d===null?this._removalsHead=r:d._nextRemoved=r,r===null?this._removalsTail=d:r._prevRemoved=d,this._insertAfter(n,e,a),this._addToMoves(n,a),n}_moveAfter(n,e,a){return this._unlink(n),this._insertAfter(n,e,a),this._addToMoves(n,a),n}_addAfter(n,e,a){return this._insertAfter(n,e,a),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,a){let d=e===null?this._itHead:e._next;return n._next=d,n._prev=e,d===null?this._itTail=n:d._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new kE),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,a=n._next;return e===null?this._itHead=a:e._next=a,a===null?this._itTail=e:a._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new kE),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},iP=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},rP=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let a;for(a=this._head;a!==null;a=a._nextDup)if((e===null||e<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){let e=n._prevDup,a=n._nextDup;return e===null?this._head=a:e._nextDup=a,a===null?this._tail=e:a._prevDup=e,this._head===null}},kE=class{map=new Map;put(n){let e=n.trackById,a=this.map.get(e);a||(a=new rP,this.map.set(e,a)),a.add(n)}get(n,e){let a=n,d=this.map.get(a);return d?d.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function zV(i,n,e){let a=i.previousIndex;if(a===null)return a;let d=0;return e&&a<e.length&&(d=e[a]),a+n+d}var oP=class{constructor(){}supports(n){return n instanceof Map||IE(n)}create(){return new sP}},sP=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let e;for(e=this._mapHead;e!==null;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;e!==null;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;e!==null;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||IE(n)))throw new sn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,d)=>{if(e&&e.key===d)this._maybeAddToChanges(e,a),this._appendAfter=e,e=e._next;else{let r=this._getOrCreateRecordForKey(d,a);e=this._insertBeforeOrAppend(e,r)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let a=e;a!==null;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){let a=n._prev;return e._next=n,e._prev=a,n._prev=e,a&&(a._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){let d=this._records.get(n);this._maybeAddToChanges(d,e);let r=d._prev,C=d._next;return r&&(r._next=C),C&&(C._prev=r),d._next=null,d._prev=null,d}let a=new aP(n);return this._records.set(n,a),a.currentValue=e,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(a=>e(n[a],a))}},aP=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(n){this.key=n}};function BV(){return new FE([new tP])}var FE=(()=>{class i{factories;static \u0275prov=kt({token:i,providedIn:"root",factory:BV});constructor(e){this.factories=e}static create(e,a){if(a!=null){let d=a.factories.slice();e=e.concat(d)}return new i(e)}static extend(e){return{provide:i,useFactory:()=>{let a=Ve(i,{optional:!0,skipSelf:!0});return i.create(e,a||BV())}}}find(e){let a=this.factories.find(d=>d.supports(e));if(a!=null)return a;throw new sn(901,!1)}}return i})();function VV(){return new uP([new oP])}var uP=(()=>{class i{static \u0275prov=kt({token:i,providedIn:"root",factory:VV});factories;constructor(e){this.factories=e}static create(e,a){if(a){let d=a.factories.slice();e=e.concat(d)}return new i(e)}static extend(e){return{provide:i,useFactory:()=>{let a=Ve(i,{optional:!0,skipSelf:!0});return i.create(e,a||VV())}}}find(e){let a=this.factories.find(d=>d.supports(e));if(a)return a;throw new sn(901,!1)}}return i})();function HV(i){let{rootComponent:n,appProviders:e,platformProviders:a,platformRef:d}=i;zr(8);try{let r=d?.injector??sY(a),C=[KA({}),{provide:Dd,useExisting:FV},J3,...e||[]],P=new Qy({providers:C,parent:r,debugName:"",runEnvironmentInitializers:!1});return nY({r3Injector:P.injector,platformInjector:r,rootComponent:n})}catch(r){return Promise.reject(r)}finally{zr(9)}}function Ns(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}function dP(i,n=NaN){return!isNaN(parseFloat(i))&&!isNaN(Number(i))?Number(i):n}function LE(i,n){let e=vu(i),a=n.elementInjector||p_();return new Bh(e).create(a,n.projectableNodes,n.hostElement,n.environmentInjector,n.directives,n.bindings)}function GV(i){let n=vu(i);if(!n)return null;let e=new Bh(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var ZV=null;function Vl(){return ZV}function hP(i){ZV??=i}var _x=class{},vx=(()=>{class i{historyGo(e){throw new Error("")}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(YV),providedIn:"platform"})}return i})(),pP=new Kt(""),YV=(()=>{class i extends vx{_location;_history;_doc=Ve(si);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Vl().getBaseHref(this._doc)}onPopState(e){let a=Vl().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",e,!1),()=>a.removeEventListener("popstate",e)}onHashChange(e){let a=Vl().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",e,!1),()=>a.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,a,d){this._history.pushState(e,a,d)}replaceState(e,a,d){this._history.replaceState(e,a,d)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>new i,providedIn:"platform"})}return i})();function NE(i,n){return i?n?i.endsWith("/")?n.startsWith("/")?i+n.slice(1):i+n:n.startsWith("/")?i+n:`${i}/${n}`:i:n}function qV(i){let n=i.search(/#|\?|$/);return i[n-1]==="/"?i.slice(0,n-1)+i.slice(n):i}function Rc(i){return i&&i[0]!=="?"?`?${i}`:i}var kc=(()=>{class i{historyGo(e){throw new Error("")}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(BE),providedIn:"root"})}return i})(),zE=new Kt(""),BE=(()=>{class i extends kc{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,a){super(),this._platformLocation=e,this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??Ve(si).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return NE(this._baseHref,e)}path(e=!1){let a=this._platformLocation.pathname+Rc(this._platformLocation.search),d=this._platformLocation.hash;return d&&e?`${a}${d}`:a}pushState(e,a,d,r){let C=this.prepareExternalUrl(d+Rc(r));this._platformLocation.pushState(e,a,C)}replaceState(e,a,d,r){let C=this.prepareExternalUrl(d+Rc(r));this._platformLocation.replaceState(e,a,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(a){return new(a||i)(hn(vx),hn(zE,8))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Du=(()=>{class i{_subject=new li;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let a=this._locationStrategy.getBaseHref();this._basePath=pY(qV(WV(a))),this._locationStrategy.onPopState(d=>{this._subject.next({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,a=""){return this.path()==this.normalize(e+Rc(a))}normalize(e){return i.stripTrailingSlash(hY(this._basePath,WV(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,a="",d=null){this._locationStrategy.pushState(d,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Rc(a)),d)}replaceState(e,a="",d=null){this._locationStrategy.replaceState(d,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Rc(a)),d)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}),()=>{let a=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(a,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",a){this._urlChangeListeners.forEach(d=>d(e,a))}subscribe(e,a,d){return this._subject.subscribe({next:e,error:a??void 0,complete:d??void 0})}static normalizeQueryParams=Rc;static joinWithSlash=NE;static stripTrailingSlash=qV;static \u0275fac=function(a){return new(a||i)(hn(kc))};static \u0275prov=kt({token:i,factory:()=>dY(),providedIn:"root"})}return i})();function dY(){return new Du(hn(kc))}function hY(i,n){if(!i||!n.startsWith(i))return n;let e=n.substring(i.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function WV(i){return i.replace(/\/index.html$/,"")}function pY(i){if(new RegExp("^(https?:)?//").test(i)){let[,e]=i.split(/\/\/[^\/]+/);return e}return i}var xP=(()=>{class i extends kc{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,a){super(),this._platformLocation=e,a!=null&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let a=this._platformLocation.hash??"#";return a.length>0?a.substring(1):a}prepareExternalUrl(e){let a=NE(this._baseHref,e);return a.length>0?"#"+a:a}pushState(e,a,d,r){let C=this.prepareExternalUrl(d+Rc(r))||this._platformLocation.pathname;this._platformLocation.pushState(e,a,C)}replaceState(e,a,d,r){let C=this.prepareExternalUrl(d+Rc(r))||this._platformLocation.pathname;this._platformLocation.replaceState(e,a,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(a){return new(a||i)(hn(vx),hn(zE,8))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})();var Ws=(function(i){return i[i.Format=0]="Format",i[i.Standalone=1]="Standalone",i})(Ws||{}),qr=(function(i){return i[i.Narrow=0]="Narrow",i[i.Abbreviated=1]="Abbreviated",i[i.Wide=2]="Wide",i[i.Short=3]="Short",i})(qr||{}),La=(function(i){return i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long",i[i.Full=3]="Full",i})(La||{}),Bd={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function t4(i){return sl(i)[jo.LocaleId]}function n4(i,n,e){let a=sl(i),d=[a[jo.DayPeriodsFormat],a[jo.DayPeriodsStandalone]],r=Ul(d,n);return Ul(r,e)}function i4(i,n,e){let a=sl(i),d=[a[jo.DaysFormat],a[jo.DaysStandalone]],r=Ul(d,n);return Ul(r,e)}function r4(i,n,e){let a=sl(i),d=[a[jo.MonthsFormat],a[jo.MonthsStandalone]],r=Ul(d,n);return Ul(r,e)}function o4(i,n){let a=sl(i)[jo.Eras];return Ul(a,n)}function yx(i,n){let e=sl(i);return Ul(e[jo.DateFormat],n)}function xx(i,n){let e=sl(i);return Ul(e[jo.TimeFormat],n)}function bx(i,n){let a=sl(i)[jo.DateTimeFormat];return Ul(a,n)}function wx(i,n){let e=sl(i),a=e[jo.NumberSymbols][n];if(typeof a>"u"){if(n===Bd.CurrencyDecimal)return e[jo.NumberSymbols][Bd.Decimal];if(n===Bd.CurrencyGroup)return e[jo.NumberSymbols][Bd.Group]}return a}function s4(i){if(!i[jo.ExtraData])throw new sn(2303,!1)}function a4(i){let n=sl(i);return s4(n),(n[jo.ExtraData][2]||[]).map(a=>typeof a=="string"?fP(a):[fP(a[0]),fP(a[1])])}function l4(i,n,e){let a=sl(i);s4(a);let d=[a[jo.ExtraData][0],a[jo.ExtraData][1]],r=Ul(d,n)||[];return Ul(r,e)||[]}function Ul(i,n){for(let e=n;e>-1;e--)if(typeof i[e]<"u")return i[e];throw new sn(2304,!1)}function fP(i){let[n,e]=i.split(":");return{hours:+n,minutes:+e}}var fY=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,VE={},mY=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function c4(i,n,e,a){let d=EY(i);n=zd(e,n)||n;let C=[],P;for(;n;)if(P=mY.exec(n),P){C=C.concat(P.slice(1));let oe=C.pop();if(!oe)break;n=oe}else{C.push(n);break}let k=d.getTimezoneOffset();a&&(k=d4(a,k),d=CY(d,a));let X="";return C.forEach(oe=>{let Me=bY(oe);X+=Me?Me(d,e,k):oe==="''"?"'":oe.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),X}function GE(i,n,e){let a=new Date(0);return a.setFullYear(i,n,e),a.setHours(0,0,0),a}function zd(i,n){let e=t4(i);if(VE[e]??={},VE[e][n])return VE[e][n];let a="";switch(n){case"shortDate":a=yx(i,La.Short);break;case"mediumDate":a=yx(i,La.Medium);break;case"longDate":a=yx(i,La.Long);break;case"fullDate":a=yx(i,La.Full);break;case"shortTime":a=xx(i,La.Short);break;case"mediumTime":a=xx(i,La.Medium);break;case"longTime":a=xx(i,La.Long);break;case"fullTime":a=xx(i,La.Full);break;case"short":let d=zd(i,"shortTime"),r=zd(i,"shortDate");a=UE(bx(i,La.Short),[d,r]);break;case"medium":let C=zd(i,"mediumTime"),P=zd(i,"mediumDate");a=UE(bx(i,La.Medium),[C,P]);break;case"long":let k=zd(i,"longTime"),X=zd(i,"longDate");a=UE(bx(i,La.Long),[k,X]);break;case"full":let oe=zd(i,"fullTime"),Me=zd(i,"fullDate");a=UE(bx(i,La.Full),[oe,Me]);break}return a&&(VE[e][n]=a),a}function UE(i,n){return n&&(i=i.replace(/\{([^}]+)}/g,function(e,a){return n!=null&&a in n?n[a]:e})),i}function Fc(i,n,e="-",a,d){let r="";(i<0||d&&i<=0)&&(d?i=-i+1:(i=-i,r=e));let C=String(i);for(;C.length<n;)C="0"+C;return a&&(C=C.slice(C.length-n)),r+C}function gY(i,n){return Fc(i,3).substring(0,n)}function ts(i,n,e=0,a=!1,d=!1){return function(r,C){let P=_Y(i,r);if((e>0||P>-e)&&(P+=e),i===3)P===0&&e===-12&&(P=12);else if(i===6)return gY(P,n);let k=wx(C,Bd.MinusSign);return Fc(P,n,k,a,d)}}function _Y(i,n){switch(i){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new sn(2301,!1)}}function io(i,n,e=Ws.Format,a=!1){return function(d,r){return vY(d,r,i,n,e,a)}}function vY(i,n,e,a,d,r){switch(e){case 2:return r4(n,d,a)[i.getMonth()];case 1:return i4(n,d,a)[i.getDay()];case 0:let C=i.getHours(),P=i.getMinutes();if(r){let X=a4(n),oe=l4(n,d,a),Me=X.findIndex($e=>{if(Array.isArray($e)){let[ke,ht]=$e,Nt=C>=ke.hours&&P>=ke.minutes,Mt=C<ht.hours||C===ht.hours&&P<ht.minutes;if(ke.hours<ht.hours){if(Nt&&Mt)return!0}else if(Nt||Mt)return!0}else if($e.hours===C&&$e.minutes===P)return!0;return!1});if(Me!==-1)return oe[Me]}return n4(n,d,a)[C<12?0:1];case 3:return o4(n,a)[i.getFullYear()<=0?0:1];default:let k=e;throw new sn(2302,!1)}}function jE(i){return function(n,e,a){let d=-1*a,r=wx(e,Bd.MinusSign),C=d>0?Math.floor(d/60):Math.ceil(d/60);switch(i){case 0:return(d>=0?"+":"")+Fc(C,2,r)+Fc(Math.abs(d%60),2,r);case 1:return"GMT"+(d>=0?"+":"")+Fc(C,1,r);case 2:return"GMT"+(d>=0?"+":"")+Fc(C,2,r)+":"+Fc(Math.abs(d%60),2,r);case 3:return a===0?"Z":(d>=0?"+":"")+Fc(C,2,r)+":"+Fc(Math.abs(d%60),2,r);default:throw new sn(2310,!1)}}}var yY=0,HE=4;function xY(i){let n=GE(i,yY,1).getDay();return GE(i,0,1+(n<=HE?HE:HE+7)-n)}function u4(i){let n=i.getDay(),e=n===0?-3:HE-n;return GE(i.getFullYear(),i.getMonth(),i.getDate()+e)}function mP(i,n=!1){return function(e,a){let d;if(n){let r=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,C=e.getDate();d=1+Math.floor((C+r)/7)}else{let r=u4(e),C=xY(r.getFullYear()),P=r.getTime()-C.getTime();d=1+Math.round(P/6048e5)}return Fc(d,i,wx(a,Bd.MinusSign))}}function $E(i,n=!1){return function(e,a){let r=u4(e).getFullYear();return Fc(r,i,wx(a,Bd.MinusSign),n)}}var gP={};function bY(i){if(gP[i])return gP[i];let n;switch(i){case"G":case"GG":case"GGG":n=io(3,qr.Abbreviated);break;case"GGGG":n=io(3,qr.Wide);break;case"GGGGG":n=io(3,qr.Narrow);break;case"y":n=ts(0,1,0,!1,!0);break;case"yy":n=ts(0,2,0,!0,!0);break;case"yyy":n=ts(0,3,0,!1,!0);break;case"yyyy":n=ts(0,4,0,!1,!0);break;case"Y":n=$E(1);break;case"YY":n=$E(2,!0);break;case"YYY":n=$E(3);break;case"YYYY":n=$E(4);break;case"M":case"L":n=ts(1,1,1);break;case"MM":case"LL":n=ts(1,2,1);break;case"MMM":n=io(2,qr.Abbreviated);break;case"MMMM":n=io(2,qr.Wide);break;case"MMMMM":n=io(2,qr.Narrow);break;case"LLL":n=io(2,qr.Abbreviated,Ws.Standalone);break;case"LLLL":n=io(2,qr.Wide,Ws.Standalone);break;case"LLLLL":n=io(2,qr.Narrow,Ws.Standalone);break;case"w":n=mP(1);break;case"ww":n=mP(2);break;case"W":n=mP(1,!0);break;case"d":n=ts(2,1);break;case"dd":n=ts(2,2);break;case"c":case"cc":n=ts(7,1);break;case"ccc":n=io(1,qr.Abbreviated,Ws.Standalone);break;case"cccc":n=io(1,qr.Wide,Ws.Standalone);break;case"ccccc":n=io(1,qr.Narrow,Ws.Standalone);break;case"cccccc":n=io(1,qr.Short,Ws.Standalone);break;case"E":case"EE":case"EEE":n=io(1,qr.Abbreviated);break;case"EEEE":n=io(1,qr.Wide);break;case"EEEEE":n=io(1,qr.Narrow);break;case"EEEEEE":n=io(1,qr.Short);break;case"a":case"aa":case"aaa":n=io(0,qr.Abbreviated);break;case"aaaa":n=io(0,qr.Wide);break;case"aaaaa":n=io(0,qr.Narrow);break;case"b":case"bb":case"bbb":n=io(0,qr.Abbreviated,Ws.Standalone,!0);break;case"bbbb":n=io(0,qr.Wide,Ws.Standalone,!0);break;case"bbbbb":n=io(0,qr.Narrow,Ws.Standalone,!0);break;case"B":case"BB":case"BBB":n=io(0,qr.Abbreviated,Ws.Format,!0);break;case"BBBB":n=io(0,qr.Wide,Ws.Format,!0);break;case"BBBBB":n=io(0,qr.Narrow,Ws.Format,!0);break;case"h":n=ts(3,1,-12);break;case"hh":n=ts(3,2,-12);break;case"H":n=ts(3,1);break;case"HH":n=ts(3,2);break;case"m":n=ts(4,1);break;case"mm":n=ts(4,2);break;case"s":n=ts(5,1);break;case"ss":n=ts(5,2);break;case"S":n=ts(6,1);break;case"SS":n=ts(6,2);break;case"SSS":n=ts(6,3);break;case"Z":case"ZZ":case"ZZZ":n=jE(0);break;case"ZZZZZ":n=jE(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=jE(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=jE(2);break;default:return null}return gP[i]=n,n}function d4(i,n){i=i.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+i)/6e4;return isNaN(e)?n:e}function wY(i,n){return i=new Date(i.getTime()),i.setMinutes(i.getMinutes()+n),i}function CY(i,n,e){let d=i.getTimezoneOffset(),r=d4(n,d);return wY(i,-1*(r-d))}function EY(i){if(XV(i))return i;if(typeof i=="number"&&!isNaN(i))return new Date(i);if(typeof i=="string"){if(i=i.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(i)){let[d,r=1,C=1]=i.split("-").map(P=>+P);return GE(d,r-1,C)}let e=parseFloat(i);if(!isNaN(i-e))return new Date(e);let a;if(a=i.match(fY))return SY(a)}let n=new Date(i);if(!XV(n))throw new sn(2311,!1);return n}function SY(i){let n=new Date(0),e=0,a=0,d=i[8]?n.setUTCFullYear:n.setFullYear,r=i[8]?n.setUTCHours:n.setHours;i[9]&&(e=Number(i[9]+i[10]),a=Number(i[9]+i[11])),d.call(n,Number(i[1]),Number(i[2])-1,Number(i[3]));let C=Number(i[4]||0)-e,P=Number(i[5]||0)-a,k=Number(i[6]||0),X=Math.floor(parseFloat("0."+(i[7]||0))*1e3);return r.call(n,C,P,k,X),n}function XV(i){return i instanceof Date&&!isNaN(i.valueOf())}var _P=/\s+/,KV=[],bP=(()=>{class i{_ngEl;_renderer;initialClasses=KV;rawClass;stateMap=new Map;constructor(e,a){this._ngEl=e,this._renderer=a}set klass(e){this.initialClasses=e!=null?e.trim().split(_P):KV}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(_P):e}ngDoCheck(){for(let a of this.initialClasses)this._updateState(a,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let a of e)this._updateState(a,!0);else if(e!=null)for(let a of Object.keys(e))this._updateState(a,!!e[a]);this._applyStateDiff()}_updateState(e,a){let d=this.stateMap.get(e);d!==void 0?(d.enabled!==a&&(d.changed=!0,d.enabled=a),d.touched=!0):this.stateMap.set(e,{enabled:a,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let a=e[0],d=e[1];d.changed?(this._toggleClass(a,d.enabled),d.changed=!1):d.touched||(d.enabled&&this._toggleClass(a,!1),this.stateMap.delete(a)),d.touched=!1}}_toggleClass(e,a){e=e.trim(),e.length>0&&e.split(_P).forEach(d=>{a?this._renderer.addClass(this._ngEl.nativeElement,d):this._renderer.removeClass(this._ngEl.nativeElement,d)})}static \u0275fac=function(a){return new(a||i)(Dt(pr),Dt(Oa))};static \u0275dir=yr({type:i,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return i})();var qE=class{$implicit;ngForOf;index;count;constructor(n,e,a,d){this.$implicit=n,this.ngForOf=e,this.index=a,this.count=d}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},B_=(()=>{class i{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,a,d){this._viewContainer=e,this._template=a,this._differs=d}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let a=this._viewContainer;e.forEachOperation((d,r,C)=>{if(d.previousIndex==null)a.createEmbeddedView(this._template,new qE(d.item,this._ngForOf,-1,-1),C===null?void 0:C);else if(C==null)a.remove(r===null?void 0:r);else if(r!==null){let P=a.get(r);a.move(P,C),QV(P,d)}});for(let d=0,r=a.length;d<r;d++){let P=a.get(d).context;P.index=d,P.count=r,P.ngForOf=this._ngForOf}e.forEachIdentityChange(d=>{let r=a.get(d.currentIndex);QV(r,d)})}static ngTemplateContextGuard(e,a){return!0}static \u0275fac=function(a){return new(a||i)(Dt(ol),Dt(rl),Dt(FE))};static \u0275dir=yr({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return i})();function QV(i,n){i.context.$implicit=n.item}var cs=(()=>{class i{_viewContainer;_context=new WE;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,a){this._viewContainer=e,this._thenTemplateRef=a}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){JV(e,!1),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){JV(e,!1),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,a){return!0}static \u0275fac=function(a){return new(a||i)(Dt(ol),Dt(rl))};static \u0275dir=yr({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return i})(),WE=class{$implicit=null;ngIf=null};function JV(i,n){if(i&&!i.createEmbeddedView)throw new sn(2020,!1)}function wP(i,n){return new sn(2100,!1)}var vP=class{createSubscription(n,e,a){return Ho(()=>n.subscribe({next:e,error:a}))}dispose(n){Ho(()=>n.unsubscribe())}},yP=class{createSubscription(n,e,a){return n.then(d=>e?.(d),d=>a?.(d)),{unsubscribe:()=>{e=null,a=null}}}dispose(n){n.unsubscribe()}},TY=new yP,IY=new vP,CP=(()=>{class i{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;applicationErrorHandler=Ve(Gs);constructor(e){this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){if(!this._obj){if(e)try{this.markForCheckOnValueUpdate=!1,this._subscribe(e)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,a=>this._updateLatestValue(e,a),a=>this.applicationErrorHandler(a))}_selectStrategy(e){if(Fd(e))return TY;if(PE(e))return IY;throw wP(i,e)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,a){e===this._obj&&(this._latestValue=a,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(a){return new(a||i)(Dt(Oc,16))};static \u0275pipe=P_({name:"async",type:i,pure:!1})}return i})();var MY="mediumDate",h4=new Kt(""),p4=new Kt(""),Cx=(()=>{class i{locale;defaultTimezone;defaultOptions;constructor(e,a,d){this.locale=e,this.defaultTimezone=a,this.defaultOptions=d}transform(e,a,d,r){if(e==null||e===""||e!==e)return null;try{let C=a??this.defaultOptions?.dateFormat??MY,P=d??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return c4(e,C,r||this.locale,P)}catch(C){throw wP(i,C.message)}}static \u0275fac=function(a){return new(a||i)(Dt(mx,16),Dt(h4,24),Dt(p4,24))};static \u0275pipe=P_({name:"date",type:i,pure:!0})}return i})();function DY(i,n){return{key:i,value:n}}var EP=(()=>{class i{differs;constructor(e){this.differs=e}differ;keyValues=[];compareFn=e4;transform(e,a=e4){if(!e||!(e instanceof Map)&&typeof e!="object")return null;this.differ??=this.differs.find(e).create();let d=this.differ.diff(e),r=a!==this.compareFn;return d&&(this.keyValues=[],d.forEachItem(C=>{this.keyValues.push(DY(C.key,C.currentValue))})),(d||r)&&(a&&this.keyValues.sort(a),this.compareFn=a),this.keyValues}static \u0275fac=function(a){return new(a||i)(Dt(uP,16))};static \u0275pipe=P_({name:"keyvalue",type:i,pure:!1})}return i})();function e4(i,n){let e=i.key,a=n.key;if(e===a)return 0;if(e==null)return 1;if(a==null)return-1;if(typeof e=="string"&&typeof a=="string")return e<a?-1:1;if(typeof e=="number"&&typeof a=="number")return e-a;if(typeof e=="boolean"&&typeof a=="boolean")return e<a?-1:1;let d=String(e),r=String(a);return d==r?0:d<r?-1:1}var SP=(()=>{class i{transform(e,a,d){if(e==null)return null;if(!(typeof e=="string"||Array.isArray(e)))throw wP(i,e);return e.slice(a,d)}static \u0275fac=function(a){return new(a||i)};static \u0275pipe=P_({name:"slice",type:i,pure:!1})}return i})();var fi=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})();function Ex(i,n){n=encodeURIComponent(n);for(let e of i.split(";")){let a=e.indexOf("="),[d,r]=a==-1?[e,""]:[e.slice(0,a),e.slice(a+1)];if(d.trim()===n)return decodeURIComponent(r)}return null}var zf=class{};var IP="browser";function f4(i){return i===IP}var m4=(()=>{class i{static \u0275prov=kt({token:i,providedIn:"root",factory:()=>new TP(Ve(si),window)})}return i})(),TP=class{document;window;offset=()=>[0,0];constructor(n,e){this.document=n,this.window=e}setOffset(n){Array.isArray(n)?this.offset=()=>n:this.offset=n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n,e){this.window.scrollTo(Ci(Ht({},e),{left:n[0],top:n[1]}))}scrollToAnchor(n,e){let a=AY(this.document,n);a&&(this.scrollToElement(a,e),a.focus())}setHistoryScrollRestoration(n){try{this.window.history.scrollRestoration=n}catch{console.warn(mu(2400,!1))}}scrollToElement(n,e){let a=n.getBoundingClientRect(),d=a.left+this.window.pageXOffset,r=a.top+this.window.pageYOffset,C=this.offset();this.window.scrollTo(Ci(Ht({},e),{left:d-C[0],top:r-C[1]}))}};function AY(i,n){let e=i.getElementById(n)||i.getElementsByName(n)[0];if(e)return e;if(typeof i.createTreeWalker=="function"&&i.body&&typeof i.body.attachShadow=="function"){let a=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT),d=a.currentNode;for(;d;){let r=d.shadowRoot;if(r){let C=r.getElementById(n)||r.querySelector(`[name="${n}"]`);if(C)return C}d=a.nextNode()}}return null}var Sx=class{_doc;constructor(n){this._doc=n}manager},ZE=(()=>{class i extends Sx{constructor(e){super(e)}supports(e){return!0}addEventListener(e,a,d,r){return e.addEventListener(a,d,r),()=>this.removeEventListener(e,a,d,r)}removeEventListener(e,a,d,r){return e.removeEventListener(a,d,r)}static \u0275fac=function(a){return new(a||i)(hn(si))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),XE=new Kt(""),OP=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,a){this._zone=a,e.forEach(C=>{C.manager=this});let d=e.filter(C=>!(C instanceof ZE));this._plugins=d.slice().reverse();let r=e.find(C=>C instanceof ZE);r&&this._plugins.push(r)}addEventListener(e,a,d,r){return this._findPluginFor(a).addEventListener(e,a,d,r)}getZone(){return this._zone}_findPluginFor(e){let a=this._eventNameToPlugin.get(e);if(a)return a;if(a=this._plugins.find(r=>r.supports(e)),!a)throw new sn(5101,!1);return this._eventNameToPlugin.set(e,a),a}static \u0275fac=function(a){return new(a||i)(hn(XE),hn(xi))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),MP="ng-app-id";function g4(i){for(let n of i)n.remove()}function _4(i,n){let e=n.createElement("style");return e.textContent=i,e}function PY(i,n,e,a){let d=i.head?.querySelectorAll(`style[${MP}="${n}"],link[${MP}="${n}"]`);if(d)for(let r of d)r.removeAttribute(MP),r instanceof HTMLLinkElement?a.set(r.href.slice(r.href.lastIndexOf("/")+1),{usage:0,elements:[r]}):r.textContent&&e.set(r.textContent,{usage:0,elements:[r]})}function AP(i,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",i),e}var RP=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(e,a,d,r={}){this.doc=e,this.appId=a,this.nonce=d,PY(e,a,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,a){for(let d of e)this.addUsage(d,this.inline,_4);a?.forEach(d=>this.addUsage(d,this.external,AP))}removeStyles(e,a){for(let d of e)this.removeUsage(d,this.inline);a?.forEach(d=>this.removeUsage(d,this.external))}addUsage(e,a,d){let r=a.get(e);r?r.usage++:a.set(e,{usage:1,elements:[...this.hosts].map(C=>this.addElement(C,d(e,this.doc)))})}removeUsage(e,a){let d=a.get(e);d&&(d.usage--,d.usage<=0&&(g4(d.elements),a.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])g4(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[a,{elements:d}]of this.inline)d.push(this.addElement(e,_4(a,this.doc)));for(let[a,{elements:d}]of this.external)d.push(this.addElement(e,AP(a,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,a){return this.nonce&&a.setAttribute("nonce",this.nonce),e.appendChild(a)}static \u0275fac=function(a){return new(a||i)(hn(si),hn(I_),hn(M_,8),hn(Rf))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),DP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},kP=/%COMP%/g;var y4="%COMP%",OY=`_nghost-${y4}`,RY=`_ngcontent-${y4}`,kY=!0,FY=new Kt("",{providedIn:"root",factory:()=>kY});function LY(i){return RY.replace(kP,i)}function NY(i){return OY.replace(kP,i)}function x4(i,n){return n.map(e=>e.replace(kP,i))}var FP=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,a,d,r,C,P,k=null,X=null){this.eventManager=e,this.sharedStylesHost=a,this.appId=d,this.removeStylesOnCompDestroy=r,this.doc=C,this.ngZone=P,this.nonce=k,this.tracingService=X,this.platformIsServer=!1,this.defaultRenderer=new Tx(e,C,P,this.platformIsServer,this.tracingService)}createRenderer(e,a){if(!e||!a)return this.defaultRenderer;let d=this.getOrCreateRenderer(e,a);return d instanceof YE?d.applyToHost(e):d instanceof Ix&&d.applyStyles(),d}getOrCreateRenderer(e,a){let d=this.rendererByCompId,r=d.get(a.id);if(!r){let C=this.doc,P=this.ngZone,k=this.eventManager,X=this.sharedStylesHost,oe=this.removeStylesOnCompDestroy,Me=this.platformIsServer,$e=this.tracingService;switch(a.encapsulation){case Pd.Emulated:r=new YE(k,X,a,this.appId,oe,C,P,Me,$e);break;case Pd.ShadowDom:return new PP(k,X,e,a,C,P,this.nonce,Me,$e);default:r=new Ix(k,X,a,oe,C,P,Me,$e);break}d.set(a.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(a){return new(a||i)(hn(OP),hn(RP),hn(I_),hn(FY),hn(si),hn(xi),hn(M_),hn(kf,8))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),Tx=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,a,d,r){this.eventManager=n,this.doc=e,this.ngZone=a,this.platformIsServer=d,this.tracingService=r}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(DP[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(v4(n)?n.content:n).appendChild(e)}insertBefore(n,e,a){n&&(v4(n)?n.content:n).insertBefore(e,a)}removeChild(n,e){e.remove()}selectRootElement(n,e){let a=typeof n=="string"?this.doc.querySelector(n):n;if(!a)throw new sn(-5104,!1);return e||(a.textContent=""),a}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,a,d){if(d){e=d+":"+e;let r=DP[d];r?n.setAttributeNS(r,e,a):n.setAttribute(e,a)}else n.setAttribute(e,a)}removeAttribute(n,e,a){if(a){let d=DP[a];d?n.removeAttributeNS(d,e):n.removeAttribute(`${a}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,a,d){d&(Tu.DashCase|Tu.Important)?n.style.setProperty(e,a,d&Tu.Important?"important":""):n.style[e]=a}removeStyle(n,e,a){a&Tu.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,a){n!=null&&(n[e]=a)}setValue(n,e){n.nodeValue=e}listen(n,e,a,d){if(typeof n=="string"&&(n=Vl().getGlobalEventTarget(this.doc,n),!n))throw new sn(5102,!1);let r=this.decoratePreventDefault(a);return this.tracingService?.wrapEventListener&&(r=this.tracingService.wrapEventListener(n,e,r)),this.eventManager.addEventListener(n,e,r,d)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;n(e)===!1&&e.preventDefault()}}};function v4(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var PP=class extends Tx{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,a,d,r,C,P,k,X){super(n,r,C,k,X),this.sharedStylesHost=e,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let oe=d.styles;oe=x4(d.id,oe);for(let $e of oe){let ke=document.createElement("style");P&&ke.setAttribute("nonce",P),ke.textContent=$e,this.shadowRoot.appendChild(ke)}let Me=d.getExternalStyles?.();if(Me)for(let $e of Me){let ke=AP($e,r);P&&ke.setAttribute("nonce",P),this.shadowRoot.appendChild(ke)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,a){return super.insertBefore(this.nodeOrShadowRoot(n),e,a)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Ix=class extends Tx{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,a,d,r,C,P,k,X){super(n,r,C,P,k),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=d;let oe=a.styles;this.styles=X?x4(X,oe):oe,this.styleUrls=a.getExternalStyles?.(X)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Pf.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},YE=class extends Ix{contentAttr;hostAttr;constructor(n,e,a,d,r,C,P,k,X){let oe=d+"-"+a.id;super(n,e,a,r,C,P,k,X,oe),this.contentAttr=LY(oe),this.hostAttr=NY(oe)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let a=super.createElement(n,e);return super.setAttribute(a,this.contentAttr,""),a}};var KE=class i extends _x{supportsDOMEvents=!0;static makeCurrent(){hP(new i)}onAndCancel(n,e,a,d){return n.addEventListener(e,a,d),()=>{n.removeEventListener(e,a,d)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=zY();return e==null?null:BY(e)}resetBaseElement(){Mx=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return Ex(document.cookie,n)}},Mx=null;function zY(){return Mx=Mx||document.head.querySelector("base"),Mx?Mx.getAttribute("href"):null}function BY(i){return new URL(i,document.baseURI).pathname}var VY=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),b4=["alt","control","meta","shift"],UY={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},jY={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},w4=(()=>{class i extends Sx{constructor(e){super(e)}supports(e){return i.parseEventName(e)!=null}addEventListener(e,a,d,r){let C=i.parseEventName(a),P=i.eventCallback(C.fullKey,d,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Vl().onAndCancel(e,C.domEventName,P,r))}static parseEventName(e){let a=e.toLowerCase().split("."),d=a.shift();if(a.length===0||!(d==="keydown"||d==="keyup"))return null;let r=i._normalizeKey(a.pop()),C="",P=a.indexOf("code");if(P>-1&&(a.splice(P,1),C="code."),b4.forEach(X=>{let oe=a.indexOf(X);oe>-1&&(a.splice(oe,1),C+=X+".")}),C+=r,a.length!=0||r.length===0)return null;let k={};return k.domEventName=d,k.fullKey=C,k}static matchEventFullKeyCode(e,a){let d=UY[e.key]||e.key,r="";return a.indexOf("code.")>-1&&(d=e.code,r="code."),d==null||!d?!1:(d=d.toLowerCase(),d===" "?d="space":d==="."&&(d="dot"),b4.forEach(C=>{if(C!==d){let P=jY[C];P(e)&&(r+=C+".")}}),r+=d,r===a)}static eventCallback(e,a,d){return r=>{i.matchEventFullKeyCode(r,e)&&d.runGuarded(()=>a(r))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(a){return new(a||i)(hn(si))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})();function LP(i,n,e){let a=Ht({rootComponent:i,platformRef:e?.platformRef},$Y(n));return HV(a)}function $Y(i){return{appProviders:[...ZY,...i?.providers??[]],platformProviders:WY}}function HY(){KE.makeCurrent()}function GY(){return new Hs}function qY(){return _A(document),document}var WY=[{provide:Rf,useValue:IP},{provide:gE,useValue:HY,multi:!0},{provide:si,useFactory:qY}];var ZY=[{provide:Ny,useValue:"root"},{provide:Hs,useFactory:GY},{provide:XE,useClass:ZE,multi:!0,deps:[si]},{provide:XE,useClass:w4,multi:!0,deps:[si]},FP,RP,OP,{provide:xs,useExisting:FP},{provide:zf,useClass:VY},[]];var U_=class{},Dx=class{},Uh=class i{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let a=e.indexOf(":");if(a>0){let d=e.slice(0,a),r=e.slice(a+1).trim();this.addHeaderEntry(d,r)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,a)=>{this.addHeaderEntry(a,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,a])=>{this.setHeaderEntries(e,a)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new i;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let a=n.value;if(typeof a=="string"&&(a=[a]),a.length===0)return;this.maybeSetNormalizedName(n.name,e);let d=(n.op==="a"?this.headers.get(e):void 0)||[];d.push(...a),this.headers.set(e,d);break;case"d":let r=n.value;if(!r)this.headers.delete(e),this.normalizedNames.delete(e);else{let C=this.headers.get(e);if(!C)return;C=C.filter(P=>r.indexOf(P)===-1),C.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,C)}break}}addHeaderEntry(n,e){let a=n.toLowerCase();this.maybeSetNormalizedName(n,a),this.headers.has(a)?this.headers.get(a).push(e):this.headers.set(a,[e])}setHeaderEntries(n,e){let a=(Array.isArray(e)?e:[e]).map(r=>r.toString()),d=n.toLowerCase();this.headers.set(d,a),this.maybeSetNormalizedName(n,d)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var JE=class{encodeKey(n){return C4(n)}encodeValue(n){return C4(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function YY(i,n){let e=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(d=>{let r=d.indexOf("="),[C,P]=r==-1?[n.decodeKey(d),""]:[n.decodeKey(d.slice(0,r)),n.decodeValue(d.slice(r+1))],k=e.get(C)||[];k.push(P),e.set(C,k)}),e}var XY=/%(\d[a-f0-9])/gi,KY={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function C4(i){return encodeURIComponent(i).replace(XY,(n,e)=>KY[e]??n)}function QE(i){return`${i}`}var Vd=class i{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new JE,n.fromString){if(n.fromObject)throw new sn(2805,!1);this.map=YY(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let a=n.fromObject[e],d=Array.isArray(a)?a.map(QE):[QE(a)];this.map.set(e,d)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(a=>{let d=n[a];Array.isArray(d)?d.forEach(r=>{e.push({param:a,value:r,op:"a"})}):e.push({param:a,value:d,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(a=>e+"="+this.encoder.encodeValue(a)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new i({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(QE(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let a=this.map.get(n.param)||[],d=a.indexOf(QE(n.value));d!==-1&&a.splice(d,1),a.length>0?this.map.set(n.param,a):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var eS=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function QY(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function E4(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function S4(i){return typeof Blob<"u"&&i instanceof Blob}function T4(i){return typeof FormData<"u"&&i instanceof FormData}function JY(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var I4="Content-Type",M4="Accept",D4="X-Request-URL",A4="text/plain",P4="application/json",eX=`${P4}, ${A4}, */*`,V_=class i{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(n,e,a,d){this.url=e,this.method=n.toUpperCase();let r;if(QY(this.method)||d?(this.body=a!==void 0?a:null,r=d):r=a,r){if(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,this.keepalive=!!r.keepalive,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),r.priority&&(this.priority=r.priority),r.cache&&(this.cache=r.cache),r.credentials&&(this.credentials=r.credentials),typeof r.timeout=="number"){if(r.timeout<1||!Number.isInteger(r.timeout))throw new sn(2822,"");this.timeout=r.timeout}r.mode&&(this.mode=r.mode),r.redirect&&(this.redirect=r.redirect),r.integrity&&(this.integrity=r.integrity),r.referrer&&(this.referrer=r.referrer),this.transferCache=r.transferCache}if(this.headers??=new Uh,this.context??=new eS,!this.params)this.params=new Vd,this.urlWithParams=e;else{let C=this.params.toString();if(C.length===0)this.urlWithParams=e;else{let P=e.indexOf("?"),k=P===-1?"?":P<e.length-1?"&":"";this.urlWithParams=e+k+C}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||E4(this.body)||S4(this.body)||T4(this.body)||JY(this.body)?this.body:this.body instanceof Vd?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||T4(this.body)?null:S4(this.body)?this.body.type||null:E4(this.body)?null:typeof this.body=="string"?A4:this.body instanceof Vd?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?P4:null}clone(n={}){let e=n.method||this.method,a=n.url||this.url,d=n.responseType||this.responseType,r=n.keepalive??this.keepalive,C=n.priority||this.priority,P=n.cache||this.cache,k=n.mode||this.mode,X=n.redirect||this.redirect,oe=n.credentials||this.credentials,Me=n.referrer||this.referrer,$e=n.integrity||this.integrity,ke=n.transferCache??this.transferCache,ht=n.timeout??this.timeout,Nt=n.body!==void 0?n.body:this.body,Mt=n.withCredentials??this.withCredentials,Xt=n.reportProgress??this.reportProgress,Vn=n.headers||this.headers,sr=n.params||this.params,Hi=n.context??this.context;return n.setHeaders!==void 0&&(Vn=Object.keys(n.setHeaders).reduce((Ni,Or)=>Ni.set(Or,n.setHeaders[Or]),Vn)),n.setParams&&(sr=Object.keys(n.setParams).reduce((Ni,Or)=>Ni.set(Or,n.setParams[Or]),sr)),new i(e,a,Nt,{params:sr,headers:Vn,context:Hi,reportProgress:Xt,responseType:d,withCredentials:Mt,transferCache:ke,keepalive:r,cache:P,priority:C,timeout:ht,mode:k,redirect:X,credentials:oe,referrer:Me,integrity:$e})}},Bf=(function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i})(Bf||{}),j_=class{headers;status;statusText;url;ok;type;redirected;constructor(n,e=200,a="OK"){this.headers=n.headers||new Uh,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||a,this.url=n.url||null,this.redirected=n.redirected,this.ok=this.status>=200&&this.status<300}},tS=class i extends j_{constructor(n={}){super(n)}type=Bf.ResponseHeader;clone(n={}){return new i({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Ax=class i extends j_{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=Bf.Response;clone(n={}){return new i({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0,redirected:n.redirected??this.redirected})}},Vh=class extends j_{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},tX=200,nX=204;function NP(i,n){return{body:n,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,credentials:i.credentials,transferCache:i.transferCache,timeout:i.timeout,keepalive:i.keepalive,priority:i.priority,cache:i.cache,mode:i.mode,redirect:i.redirect,integrity:i.integrity,referrer:i.referrer}}var yo=(()=>{class i{handler;constructor(e){this.handler=e}request(e,a,d={}){let r;if(e instanceof V_)r=e;else{let k;d.headers instanceof Uh?k=d.headers:k=new Uh(d.headers);let X;d.params&&(d.params instanceof Vd?X=d.params:X=new Vd({fromObject:d.params})),r=new V_(e,a,d.body!==void 0?d.body:null,{headers:k,context:d.context,params:X,reportProgress:d.reportProgress,responseType:d.responseType||"json",withCredentials:d.withCredentials,transferCache:d.transferCache,keepalive:d.keepalive,priority:d.priority,cache:d.cache,mode:d.mode,redirect:d.redirect,credentials:d.credentials,referrer:d.referrer,integrity:d.integrity,timeout:d.timeout})}let C=Dn(r).pipe(fu(k=>this.handler.handle(k)));if(e instanceof V_||d.observe==="events")return C;let P=C.pipe(Ao(k=>k instanceof Ax));switch(d.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return P.pipe(Qn(k=>{if(k.body!==null&&!(k.body instanceof ArrayBuffer))throw new sn(2806,!1);return k.body}));case"blob":return P.pipe(Qn(k=>{if(k.body!==null&&!(k.body instanceof Blob))throw new sn(2807,!1);return k.body}));case"text":return P.pipe(Qn(k=>{if(k.body!==null&&typeof k.body!="string")throw new sn(2808,!1);return k.body}));case"json":default:return P.pipe(Qn(k=>k.body))}case"response":return P;default:throw new sn(2809,!1)}}delete(e,a={}){return this.request("DELETE",e,a)}get(e,a={}){return this.request("GET",e,a)}head(e,a={}){return this.request("HEAD",e,a)}jsonp(e,a){return this.request("JSONP",e,{params:new Vd().append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,a={}){return this.request("OPTIONS",e,a)}patch(e,a,d={}){return this.request("PATCH",e,NP(d,a))}post(e,a,d={}){return this.request("POST",e,NP(d,a))}put(e,a,d={}){return this.request("PUT",e,NP(d,a))}static \u0275fac=function(a){return new(a||i)(hn(U_))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})();var iX=new Kt("");function rX(i,n){return n(i)}function oX(i,n,e){return(a,d)=>ys(e,()=>n(a,r=>i(r,d)))}var BP=new Kt(""),O4=new Kt(""),R4=new Kt("",{providedIn:"root",factory:()=>!0});var nS=(()=>{class i extends U_{backend;injector;chain=null;pendingTasks=Ve(VC);contributeToStability=Ve(R4);constructor(e,a){super(),this.backend=e,this.injector=a}handle(e){if(this.chain===null){let a=Array.from(new Set([...this.injector.get(BP),...this.injector.get(O4,[])]));this.chain=a.reduceRight((d,r)=>oX(d,r,this.injector),rX)}if(this.contributeToStability){let a=this.pendingTasks.add();return this.chain(e,d=>this.backend.handle(d)).pipe(Sd(a))}else return this.chain(e,a=>this.backend.handle(a))}static \u0275fac=function(a){return new(a||i)(hn(Dx),hn(Yr))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})();var sX=/^\)\]\}',?\n/,aX=RegExp(`^${D4}:`,"m");function lX(i){return"responseURL"in i&&i.responseURL?i.responseURL:aX.test(i.getAllResponseHeaders())?i.getResponseHeader(D4):null}var zP=(()=>{class i{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new sn(-2800,!1);let a=this.xhrFactory;return Dn(null).pipe(So(()=>new Fi(r=>{let C=a.build();if(C.open(e.method,e.urlWithParams),e.withCredentials&&(C.withCredentials=!0),e.headers.forEach((Mt,Xt)=>C.setRequestHeader(Mt,Xt.join(","))),e.headers.has(M4)||C.setRequestHeader(M4,eX),!e.headers.has(I4)){let Mt=e.detectContentTypeHeader();Mt!==null&&C.setRequestHeader(I4,Mt)}if(e.timeout&&(C.timeout=e.timeout),e.responseType){let Mt=e.responseType.toLowerCase();C.responseType=Mt!=="json"?Mt:"text"}let P=e.serializeBody(),k=null,X=()=>{if(k!==null)return k;let Mt=C.statusText||"OK",Xt=new Uh(C.getAllResponseHeaders()),Vn=lX(C)||e.url;return k=new tS({headers:Xt,status:C.status,statusText:Mt,url:Vn}),k},oe=()=>{let{headers:Mt,status:Xt,statusText:Vn,url:sr}=X(),Hi=null;Xt!==nX&&(Hi=typeof C.response>"u"?C.responseText:C.response),Xt===0&&(Xt=Hi?tX:0);let Ni=Xt>=200&&Xt<300;if(e.responseType==="json"&&typeof Hi=="string"){let Or=Hi;Hi=Hi.replace(sX,"");try{Hi=Hi!==""?JSON.parse(Hi):null}catch(qo){Hi=Or,Ni&&(Ni=!1,Hi={error:qo,text:Hi})}}Ni?(r.next(new Ax({body:Hi,headers:Mt,status:Xt,statusText:Vn,url:sr||void 0})),r.complete()):r.error(new Vh({error:Hi,headers:Mt,status:Xt,statusText:Vn,url:sr||void 0}))},Me=Mt=>{let{url:Xt}=X(),Vn=new Vh({error:Mt,status:C.status||0,statusText:C.statusText||"Unknown Error",url:Xt||void 0});r.error(Vn)},$e=Me;e.timeout&&($e=Mt=>{let{url:Xt}=X(),Vn=new Vh({error:new DOMException("Request timed out","TimeoutError"),status:C.status||0,statusText:C.statusText||"Request timeout",url:Xt||void 0});r.error(Vn)});let ke=!1,ht=Mt=>{ke||(r.next(X()),ke=!0);let Xt={type:Bf.DownloadProgress,loaded:Mt.loaded};Mt.lengthComputable&&(Xt.total=Mt.total),e.responseType==="text"&&C.responseText&&(Xt.partialText=C.responseText),r.next(Xt)},Nt=Mt=>{let Xt={type:Bf.UploadProgress,loaded:Mt.loaded};Mt.lengthComputable&&(Xt.total=Mt.total),r.next(Xt)};return C.addEventListener("load",oe),C.addEventListener("error",Me),C.addEventListener("timeout",$e),C.addEventListener("abort",Me),e.reportProgress&&(C.addEventListener("progress",ht),P!==null&&C.upload&&C.upload.addEventListener("progress",Nt)),C.send(P),r.next({type:Bf.Sent}),()=>{C.removeEventListener("error",Me),C.removeEventListener("abort",Me),C.removeEventListener("load",oe),C.removeEventListener("timeout",$e),e.reportProgress&&(C.removeEventListener("progress",ht),P!==null&&C.upload&&C.upload.removeEventListener("progress",Nt)),C.readyState!==C.DONE&&C.abort()}})))}static \u0275fac=function(a){return new(a||i)(hn(zf))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),k4=new Kt(""),cX="XSRF-TOKEN",uX=new Kt("",{providedIn:"root",factory:()=>cX}),dX="X-XSRF-TOKEN",hX=new Kt("",{providedIn:"root",factory:()=>dX}),Px=class{},pX=(()=>{class i{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,a){this.doc=e,this.cookieName=a}getToken(){let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ex(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(a){return new(a||i)(hn(si),hn(uX))};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),fX=/^(?:https?:)?\/\//i;function mX(i,n){if(!Ve(k4)||i.method==="GET"||i.method==="HEAD"||fX.test(i.url))return n(i);let e=Ve(Px).getToken(),a=Ve(hX);return e!=null&&!i.headers.has(a)&&(i=i.clone({headers:i.headers.set(a,e)})),n(i)}var VP=(function(i){return i[i.Interceptors=0]="Interceptors",i[i.LegacyInterceptors=1]="LegacyInterceptors",i[i.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",i[i.NoXsrfProtection=3]="NoXsrfProtection",i[i.JsonpSupport=4]="JsonpSupport",i[i.RequestsMadeViaParent=5]="RequestsMadeViaParent",i[i.Fetch=6]="Fetch",i})(VP||{});function gX(i,n){return{\u0275kind:i,\u0275providers:n}}function UP(...i){let n=[yo,zP,nS,{provide:U_,useExisting:nS},{provide:Dx,useFactory:()=>Ve(iX,{optional:!0})??Ve(zP)},{provide:BP,useValue:mX,multi:!0},{provide:k4,useValue:!0},{provide:Px,useClass:pX}];for(let e of i)n.push(...e.\u0275providers);return Sc(n)}function jP(i){return gX(VP.Interceptors,i.map(n=>({provide:BP,useValue:n,multi:!0})))}var F4=(()=>{class i{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(a){return new(a||i)(hn(si))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var $P=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:function(a){let d=null;return a?d=new(a||i):d=hn(_X),d},providedIn:"root"})}return i})(),_X=(()=>{class i extends $P{_doc;constructor(e){super(),this._doc=e}sanitize(e,a){if(a==null)return null;switch(e){case Fs.NONE:return a;case Fs.HTML:return Rd(a,"HTML")?Nl(a):CA(this._doc,String(a)).toString();case Fs.STYLE:return Rd(a,"Style")?Nl(a):a;case Fs.SCRIPT:if(Rd(a,"Script"))return Nl(a);throw new sn(5200,!1);case Fs.URL:return Rd(a,"URL")?Nl(a):rx(String(a));case Fs.RESOURCE_URL:if(Rd(a,"ResourceURL"))return Nl(a);throw new sn(5201,!1);default:throw new sn(5202,!1)}}bypassSecurityTrustHtml(e){return vA(e)}bypassSecurityTrustStyle(e){return yA(e)}bypassSecurityTrustScript(e){return xA(e)}bypassSecurityTrustUrl(e){return bA(e)}bypassSecurityTrustResourceUrl(e){return wA(e)}static \u0275fac=function(a){return new(a||i)(hn(si))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Di="primary",Hx=Symbol("RouteTitle"),ZP=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function jf(i){return new ZP(i)}function H4(i,n,e){let a=e.path.split("/");if(a.length>i.length||e.pathMatch==="full"&&(n.hasChildren()||a.length<i.length))return null;let d={};for(let r=0;r<a.length;r++){let C=a[r],P=i[r];if(C[0]===":")d[C.substring(1)]=P;else if(C!==P.path)return null}return{consumed:i.slice(0,a.length),posParams:d}}function vX(i,n){if(i.length!==n.length)return!1;for(let e=0;e<i.length;++e)if(!Au(i[e],n[e]))return!1;return!0}function Au(i,n){let e=i?YP(i):void 0,a=n?YP(n):void 0;if(!e||!a||e.length!=a.length)return!1;let d;for(let r=0;r<e.length;r++)if(d=e[r],!G4(i[d],n[d]))return!1;return!0}function YP(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function G4(i,n){if(Array.isArray(i)&&Array.isArray(n)){if(i.length!==n.length)return!1;let e=[...i].sort(),a=[...n].sort();return e.every((d,r)=>a[r]===d)}else return i===n}function q4(i){return i.length>0?i[i.length-1]:null}function Ud(i){return dC(i)?i:Fd(i)?go(Promise.resolve(i)):Dn(i)}var yX={exact:Z4,subset:Y4},W4={exact:xX,subset:bX,ignored:()=>!0};function N4(i,n,e){return yX[e.paths](i.root,n.root,e.matrixParams)&&W4[e.queryParams](i.queryParams,n.queryParams)&&!(e.fragment==="exact"&&i.fragment!==n.fragment)}function xX(i,n){return Au(i,n)}function Z4(i,n,e){if(!Vf(i.segments,n.segments)||!oS(i.segments,n.segments,e)||i.numberOfChildren!==n.numberOfChildren)return!1;for(let a in n.children)if(!i.children[a]||!Z4(i.children[a],n.children[a],e))return!1;return!0}function bX(i,n){return Object.keys(n).length<=Object.keys(i).length&&Object.keys(n).every(e=>G4(i[e],n[e]))}function Y4(i,n,e){return X4(i,n,n.segments,e)}function X4(i,n,e,a){if(i.segments.length>e.length){let d=i.segments.slice(0,e.length);return!(!Vf(d,e)||n.hasChildren()||!oS(d,e,a))}else if(i.segments.length===e.length){if(!Vf(i.segments,e)||!oS(i.segments,e,a))return!1;for(let d in n.children)if(!i.children[d]||!Y4(i.children[d],n.children[d],a))return!1;return!0}else{let d=e.slice(0,i.segments.length),r=e.slice(i.segments.length);return!Vf(i.segments,d)||!oS(i.segments,d,a)||!i.children[Di]?!1:X4(i.children[Di],n,r,a)}}function oS(i,n,e){return n.every((a,d)=>W4[e](i[d].parameters,a.parameters))}var Ou=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Pr([],{}),e={},a=null){this.root=n,this.queryParams=e,this.fragment=a}get queryParamMap(){return this._queryParamMap??=jf(this.queryParams),this._queryParamMap}toString(){return EX.serialize(this)}},Pr=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return sS(this)}},jh=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=jf(this.parameters),this._parameterMap}toString(){return Q4(this)}};function wX(i,n){return Vf(i,n)&&i.every((e,a)=>Au(e.parameters,n[a].parameters))}function Vf(i,n){return i.length!==n.length?!1:i.every((e,a)=>e.path===n[a].path)}function CX(i,n){let e=[];return Object.entries(i.children).forEach(([a,d])=>{a===Di&&(e=e.concat(n(d,a)))}),Object.entries(i.children).forEach(([a,d])=>{a!==Di&&(e=e.concat(n(d,a)))}),e}var $f=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>new $h,providedIn:"root"})}return i})(),$h=class{parse(n){let e=new KP(n);return new Ou(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${Ox(n.root,!0)}`,a=IX(n.queryParams),d=typeof n.fragment=="string"?`#${SX(n.fragment)}`:"";return`${e}${a}${d}`}},EX=new $h;function sS(i){return i.segments.map(n=>Q4(n)).join("/")}function Ox(i,n){if(!i.hasChildren())return sS(i);if(n){let e=i.children[Di]?Ox(i.children[Di],!1):"",a=[];return Object.entries(i.children).forEach(([d,r])=>{d!==Di&&a.push(`${d}:${Ox(r,!1)}`)}),a.length>0?`${e}(${a.join("//")})`:e}else{let e=CX(i,(a,d)=>d===Di?[Ox(i.children[Di],!1)]:[`${d}:${Ox(a,!1)}`]);return Object.keys(i.children).length===1&&i.children[Di]!=null?`${sS(i)}/${e[0]}`:`${sS(i)}/(${e.join("//")})`}}function K4(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function iS(i){return K4(i).replace(/%3B/gi,";")}function SX(i){return encodeURI(i)}function XP(i){return K4(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function aS(i){return decodeURIComponent(i)}function z4(i){return aS(i.replace(/\+/g,"%20"))}function Q4(i){return`${XP(i.path)}${TX(i.parameters)}`}function TX(i){return Object.entries(i).map(([n,e])=>`;${XP(n)}=${XP(e)}`).join("")}function IX(i){let n=Object.entries(i).map(([e,a])=>Array.isArray(a)?a.map(d=>`${iS(e)}=${iS(d)}`).join("&"):`${iS(e)}=${iS(a)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var MX=/^[^\/()?;#]+/;function HP(i){let n=i.match(MX);return n?n[0]:""}var DX=/^[^\/()?;=#]+/;function AX(i){let n=i.match(DX);return n?n[0]:""}var PX=/^[^=?&#]+/;function OX(i){let n=i.match(PX);return n?n[0]:""}var RX=/^[^&#]+/;function kX(i){let n=i.match(RX);return n?n[0]:""}var KP=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Pr([],{}):new Pr([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(a[Di]=new Pr(n,e)),a}parseSegment(){let n=HP(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new sn(4009,!1);return this.capture(n),new jh(aS(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=AX(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){let d=HP(this.remaining);d&&(a=d,this.capture(a))}n[aS(e)]=aS(a)}parseQueryParam(n){let e=OX(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){let C=kX(this.remaining);C&&(a=C,this.capture(a))}let d=z4(e),r=z4(a);if(n.hasOwnProperty(d)){let C=n[d];Array.isArray(C)||(C=[C],n[d]=C),C.push(r)}else n[d]=r}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let a=HP(this.remaining),d=this.remaining[a.length];if(d!=="/"&&d!==")"&&d!==";")throw new sn(4010,!1);let r;a.indexOf(":")>-1?(r=a.slice(0,a.indexOf(":")),this.capture(r),this.capture(":")):n&&(r=Di);let C=this.parseChildren();e[r??Di]=Object.keys(C).length===1&&C[Di]?C[Di]:new Pr([],C),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new sn(4011,!1)}};function J4(i){return i.segments.length>0?new Pr([],{[Di]:i}):i}function e5(i){let n={};for(let[a,d]of Object.entries(i.children)){let r=e5(d);if(a===Di&&r.segments.length===0&&r.hasChildren())for(let[C,P]of Object.entries(r.children))n[C]=P;else(r.segments.length>0||r.hasChildren())&&(n[a]=r)}let e=new Pr(i.segments,n);return FX(e)}function FX(i){if(i.numberOfChildren===1&&i.children[Di]){let n=i.children[Di];return new Pr(i.segments.concat(n.segments),n.children)}return i}function Hh(i){return i instanceof Ou}function t5(i,n,e=null,a=null){let d=n5(i);return i5(d,n,e,a)}function n5(i){let n;function e(r){let C={};for(let k of r.children){let X=e(k);C[k.outlet]=X}let P=new Pr(r.url,C);return r===i&&(n=P),P}let a=e(i.root),d=J4(a);return n??d}function i5(i,n,e,a){let d=i;for(;d.parent;)d=d.parent;if(n.length===0)return GP(d,d,d,e,a);let r=LX(n);if(r.toRoot())return GP(d,d,new Pr([],{}),e,a);let C=NX(r,d,i),P=C.processChildren?kx(C.segmentGroup,C.index,r.commands):o5(C.segmentGroup,C.index,r.commands);return GP(d,C.segmentGroup,P,e,a)}function lS(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function Lx(i){return typeof i=="object"&&i!=null&&i.outlets}function GP(i,n,e,a,d){let r={};a&&Object.entries(a).forEach(([k,X])=>{r[k]=Array.isArray(X)?X.map(oe=>`${oe}`):`${X}`});let C;i===n?C=e:C=r5(i,n,e);let P=J4(e5(C));return new Ou(P,r,d)}function r5(i,n,e){let a={};return Object.entries(i.children).forEach(([d,r])=>{r===n?a[d]=e:a[d]=r5(r,n,e)}),new Pr(i.segments,a)}var cS=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,a){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=a,n&&a.length>0&&lS(a[0]))throw new sn(4003,!1);let d=a.find(Lx);if(d&&d!==q4(a))throw new sn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function LX(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new cS(!0,0,i);let n=0,e=!1,a=i.reduce((d,r,C)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let P={};return Object.entries(r.outlets).forEach(([k,X])=>{P[k]=typeof X=="string"?X.split("/"):X}),[...d,{outlets:P}]}if(r.segmentPath)return[...d,r.segmentPath]}return typeof r!="string"?[...d,r]:C===0?(r.split("/").forEach((P,k)=>{k==0&&P==="."||(k==0&&P===""?e=!0:P===".."?n++:P!=""&&d.push(P))}),d):[...d,r]},[]);return new cS(e,n,a)}var G_=class{segmentGroup;processChildren;index;constructor(n,e,a){this.segmentGroup=n,this.processChildren=e,this.index=a}};function NX(i,n,e){if(i.isAbsolute)return new G_(n,!0,0);if(!e)return new G_(n,!1,NaN);if(e.parent===null)return new G_(e,!0,0);let a=lS(i.commands[0])?0:1,d=e.segments.length-1+a;return zX(e,d,i.numberOfDoubleDots)}function zX(i,n,e){let a=i,d=n,r=e;for(;r>d;){if(r-=d,a=a.parent,!a)throw new sn(4005,!1);d=a.segments.length}return new G_(a,!1,d-r)}function BX(i){return Lx(i[0])?i[0].outlets:{[Di]:i}}function o5(i,n,e){if(i??=new Pr([],{}),i.segments.length===0&&i.hasChildren())return kx(i,n,e);let a=VX(i,n,e),d=e.slice(a.commandIndex);if(a.match&&a.pathIndex<i.segments.length){let r=new Pr(i.segments.slice(0,a.pathIndex),{});return r.children[Di]=new Pr(i.segments.slice(a.pathIndex),i.children),kx(r,0,d)}else return a.match&&d.length===0?new Pr(i.segments,{}):a.match&&!i.hasChildren()?QP(i,n,e):a.match?kx(i,0,d):QP(i,n,e)}function kx(i,n,e){if(e.length===0)return new Pr(i.segments,{});{let a=BX(e),d={};if(Object.keys(a).some(r=>r!==Di)&&i.children[Di]&&i.numberOfChildren===1&&i.children[Di].segments.length===0){let r=kx(i.children[Di],n,e);return new Pr(i.segments,r.children)}return Object.entries(a).forEach(([r,C])=>{typeof C=="string"&&(C=[C]),C!==null&&(d[r]=o5(i.children[r],n,C))}),Object.entries(i.children).forEach(([r,C])=>{a[r]===void 0&&(d[r]=C)}),new Pr(i.segments,d)}}function VX(i,n,e){let a=0,d=n,r={match:!1,pathIndex:0,commandIndex:0};for(;d<i.segments.length;){if(a>=e.length)return r;let C=i.segments[d],P=e[a];if(Lx(P))break;let k=`${P}`,X=a<e.length-1?e[a+1]:null;if(d>0&&k===void 0)break;if(k&&X&&typeof X=="object"&&X.outlets===void 0){if(!V4(k,X,C))return r;a+=2}else{if(!V4(k,{},C))return r;a++}d++}return{match:!0,pathIndex:d,commandIndex:a}}function QP(i,n,e){let a=i.segments.slice(0,n),d=0;for(;d<e.length;){let r=e[d];if(Lx(r)){let k=UX(r.outlets);return new Pr(a,k)}if(d===0&&lS(e[0])){let k=i.segments[n];a.push(new jh(k.path,B4(e[0]))),d++;continue}let C=Lx(r)?r.outlets[Di]:`${r}`,P=d<e.length-1?e[d+1]:null;C&&P&&lS(P)?(a.push(new jh(C,B4(P))),d+=2):(a.push(new jh(C,{})),d++)}return new Pr(a,{})}function UX(i){let n={};return Object.entries(i).forEach(([e,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(n[e]=QP(new Pr([],{}),0,a))}),n}function B4(i){let n={};return Object.entries(i).forEach(([e,a])=>n[e]=`${a}`),n}function V4(i,n,e){return i==e.path&&Au(n,e.parameters)}var q_="imperative",us=(function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i})(us||{}),cl=class{id;url;constructor(n,e){this.id=n,this.url=e}},Gh=class extends cl{type=us.NavigationStart;navigationTrigger;restoredState;constructor(n,e,a="imperative",d=null){super(n,e),this.navigationTrigger=a,this.restoredState=d}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},jl=class extends cl{urlAfterRedirects;type=us.NavigationEnd;constructor(n,e,a){super(n,e),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},_a=(function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i[i.Aborted=4]="Aborted",i})(_a||{}),Z_=(function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i})(Z_||{}),Pu=class extends cl{reason;code;type=us.NavigationCancel;constructor(n,e,a,d){super(n,e),this.reason=a,this.code=d}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ru=class extends cl{reason;code;type=us.NavigationSkipped;constructor(n,e,a,d){super(n,e),this.reason=a,this.code=d}},Y_=class extends cl{error;target;type=us.NavigationError;constructor(n,e,a,d){super(n,e),this.error=a,this.target=d}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Nx=class extends cl{urlAfterRedirects;state;type=us.RoutesRecognized;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uS=class extends cl{urlAfterRedirects;state;type=us.GuardsCheckStart;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dS=class extends cl{urlAfterRedirects;state;shouldActivate;type=us.GuardsCheckEnd;constructor(n,e,a,d,r){super(n,e),this.urlAfterRedirects=a,this.state=d,this.shouldActivate=r}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},hS=class extends cl{urlAfterRedirects;state;type=us.ResolveStart;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},pS=class extends cl{urlAfterRedirects;state;type=us.ResolveEnd;constructor(n,e,a,d){super(n,e),this.urlAfterRedirects=a,this.state=d}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fS=class{route;type=us.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},mS=class{route;type=us.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},gS=class{snapshot;type=us.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},_S=class{snapshot;type=us.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vS=class{snapshot;type=us.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},yS=class{snapshot;type=us.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},X_=class{routerEvent;position;anchor;type=us.Scroll;constructor(n,e,a){this.routerEvent=n,this.position=e,this.anchor=a}toString(){let n=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${n}')`}},zx=class{},K_=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function jX(i){return!(i instanceof zx)&&!(i instanceof K_)}function $X(i,n){return i.providers&&!i._injector&&(i._injector=A_(i.providers,n,`Route: ${i.path}`)),i._injector??n}function Nc(i){return i.outlet||Di}function HX(i,n){let e=i.filter(a=>Nc(a)===n);return e.push(...i.filter(a=>Nc(a)!==n)),e}function e0(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let n=i.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var xS=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return e0(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new Hf(this.rootInjector)}},Hf=(()=>{class i{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,a){let d=this.getOrCreateContext(e);d.outlet=a,this.contexts.set(e,d)}onChildOutletDestroyed(e){let a=this.getContext(e);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let a=this.getContext(e);return a||(a=new xS(this.rootInjector),this.contexts.set(e,a)),a}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(a){return new(a||i)(hn(Yr))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),bS=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=JP(n,this._root);return e?e.children.map(a=>a.value):[]}firstChild(n){let e=JP(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=eO(n,this._root);return e.length<2?[]:e[e.length-2].children.map(d=>d.value).filter(d=>d!==n)}pathFromRoot(n){return eO(n,this._root).map(e=>e.value)}};function JP(i,n){if(i===n.value)return n;for(let e of n.children){let a=JP(i,e);if(a)return a}return null}function eO(i,n){if(i===n.value)return[n];for(let e of n.children){let a=eO(i,e);if(a.length)return a.unshift(n),a}return[]}var ll=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function H_(i){let n={};return i&&i.children.forEach(e=>n[e.value.outlet]=e),n}var Bx=class extends bS{snapshot;constructor(n,e){super(n),this.snapshot=e,lO(this,n)}toString(){return this.snapshot.toString()}};function s5(i){let n=GX(i),e=new zo([new jh("",{})]),a=new zo({}),d=new zo({}),r=new zo({}),C=new zo(""),P=new Zs(e,a,r,C,d,Di,i,n.root);return P.snapshot=n.root,new Bx(new ll(P,[]),n)}function GX(i){let n={},e={},a={},r=new Uf([],n,a,"",e,Di,i,null,{});return new Vx("",new ll(r,[]))}var Zs=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,a,d,r,C,P,k){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=a,this.fragmentSubject=d,this.dataSubject=r,this.outlet=C,this.component=P,this._futureSnapshot=k,this.title=this.dataSubject?.pipe(Qn(X=>X[Hx]))??Dn(void 0),this.url=n,this.params=e,this.queryParams=a,this.fragment=d,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Qn(n=>jf(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Qn(n=>jf(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function wS(i,n,e="emptyOnly"){let a,{routeConfig:d}=i;return n!==null&&(e==="always"||d?.path===""||!n.component&&!n.routeConfig?.loadComponent)?a={params:Ht(Ht({},n.params),i.params),data:Ht(Ht({},n.data),i.data),resolve:Ht(Ht(Ht(Ht({},i.data),n.data),d?.data),i._resolvedData)}:a={params:Ht({},i.params),data:Ht({},i.data),resolve:Ht(Ht({},i.data),i._resolvedData??{})},d&&l5(d)&&(a.resolve[Hx]=d.title),a}var Uf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Hx]}constructor(n,e,a,d,r,C,P,k,X){this.url=n,this.params=e,this.queryParams=a,this.fragment=d,this.data=r,this.outlet=C,this.component=P,this.routeConfig=k,this._resolve=X}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=jf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=jf(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(a=>a.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},Vx=class extends bS{url;constructor(n,e){super(e),this.url=n,lO(this,e)}toString(){return a5(this._root)}};function lO(i,n){n.value._routerState=i,n.children.forEach(e=>lO(i,e))}function a5(i){let n=i.children.length>0?` { ${i.children.map(a5).join(", ")} } `:"";return`${i.value}${n}`}function qP(i){if(i.snapshot){let n=i.snapshot,e=i._futureSnapshot;i.snapshot=e,Au(n.queryParams,e.queryParams)||i.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&i.fragmentSubject.next(e.fragment),Au(n.params,e.params)||i.paramsSubject.next(e.params),vX(n.url,e.url)||i.urlSubject.next(e.url),Au(n.data,e.data)||i.dataSubject.next(e.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function tO(i,n){let e=Au(i.params,n.params)&&wX(i.url,n.url),a=!i.parent!=!n.parent;return e&&!a&&(!i.parent||tO(i.parent,n.parent))}function l5(i){return typeof i.title=="string"||i.title===null}var c5=new Kt(""),Gx=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Di;activateEvents=new Vt;deactivateEvents=new Vt;attachEvents=new Vt;detachEvents=new Vt;routerOutletData=Io();parentContexts=Ve(Hf);location=Ve(ol);changeDetector=Ve(Oc);inputBinder=Ve(qx,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:a,previousValue:d}=e.name;if(a)return;this.isTrackedInParentContexts(d)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(d)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new sn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new sn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new sn(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,a){this.activated=e,this._activatedRoute=a,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,a){if(this.isActivated)throw new sn(4013,!1);this._activatedRoute=e;let d=this.location,C=e.snapshot.component,P=this.parentContexts.getOrCreateContext(this.name).children,k=new nO(e,P,d.injector,this.routerOutletData);this.activated=d.createComponent(C,{index:d.length,injector:k,environmentInjector:a}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Br]})}return i})(),nO=class{route;childContexts;parent;outletData;constructor(n,e,a,d){this.route=n,this.childContexts=e,this.parent=a,this.outletData=d}get(n,e){return n===Zs?this.route:n===Hf?this.childContexts:n===c5?this.outletData:this.parent.get(n,e)}},qx=new Kt(""),cO=(()=>{class i{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:a}=e,d=hf([a.queryParams,a.params,a.data]).pipe(So(([r,C,P],k)=>(P=Ht(Ht(Ht({},r),C),P),k===0?Dn(P):Promise.resolve(P)))).subscribe(r=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==a||a.component===null){this.unsubscribeFromRouteData(e);return}let C=GV(a.component);if(!C){this.unsubscribeFromRouteData(e);return}for(let{templateName:P}of C.inputs)e.activatedComponentRef.setInput(P,r[P])});this.outletDataSubscriptions.set(e,d)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})(),uO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(a,d){a&1&&An(0,"router-outlet")},dependencies:[Gx],encapsulation:2})}return i})();function dO(i){let n=i.children&&i.children.map(dO),e=n?Ci(Ht({},i),{children:n}):Ht({},i);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Di&&(e.component=uO),e}function qX(i,n,e){let a=Ux(i,n._root,e?e._root:void 0);return new Bx(a,n)}function Ux(i,n,e){if(e&&i.shouldReuseRoute(n.value,e.value.snapshot)){let a=e.value;a._futureSnapshot=n.value;let d=WX(i,n,e);return new ll(a,d)}else{if(i.shouldAttach(n.value)){let r=i.retrieve(n.value);if(r!==null){let C=r.route;return C.value._futureSnapshot=n.value,C.children=n.children.map(P=>Ux(i,P)),C}}let a=ZX(n.value),d=n.children.map(r=>Ux(i,r));return new ll(a,d)}}function WX(i,n,e){return n.children.map(a=>{for(let d of e.children)if(i.shouldReuseRoute(a.value,d.value.snapshot))return Ux(i,a,d);return Ux(i,a)})}function ZX(i){return new Zs(new zo(i.url),new zo(i.params),new zo(i.queryParams),new zo(i.fragment),new zo(i.data),i.outlet,i.component,i)}var Q_=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},u5="ngNavigationCancelingError";function CS(i,n){let{redirectTo:e,navigationBehaviorOptions:a}=Hh(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,d=d5(!1,_a.Redirect);return d.url=e,d.navigationBehaviorOptions=a,d}function d5(i,n){let e=new Error(`NavigationCancelingError: ${i||""}`);return e[u5]=!0,e.cancellationCode=n,e}function YX(i){return h5(i)&&Hh(i.url)}function h5(i){return!!i&&i[u5]}var XX=(i,n,e,a)=>Qn(d=>(new iO(n,d.targetRouterState,d.currentRouterState,e,a).activate(i),d)),iO=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,a,d,r){this.routeReuseStrategy=n,this.futureState=e,this.currState=a,this.forwardEvent=d,this.inputBindingEnabled=r}activate(n){let e=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,a,n),qP(this.futureState.root),this.activateChildRoutes(e,a,n)}deactivateChildRoutes(n,e,a){let d=H_(e);n.children.forEach(r=>{let C=r.value.outlet;this.deactivateRoutes(r,d[C],a),delete d[C]}),Object.values(d).forEach(r=>{this.deactivateRouteAndItsChildren(r,a)})}deactivateRoutes(n,e,a){let d=n.value,r=e?e.value:null;if(d===r)if(d.component){let C=a.getContext(d.outlet);C&&this.deactivateChildRoutes(n,e,C.children)}else this.deactivateChildRoutes(n,e,a);else r&&this.deactivateRouteAndItsChildren(e,a)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let a=e.getContext(n.value.outlet),d=a&&n.value.component?a.children:e,r=H_(n);for(let C of Object.values(r))this.deactivateRouteAndItsChildren(C,d);if(a&&a.outlet){let C=a.outlet.detach(),P=a.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:C,route:n,contexts:P})}}deactivateRouteAndOutlet(n,e){let a=e.getContext(n.value.outlet),d=a&&n.value.component?a.children:e,r=H_(n);for(let C of Object.values(r))this.deactivateRouteAndItsChildren(C,d);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(n,e,a){let d=H_(e);n.children.forEach(r=>{this.activateRoutes(r,d[r.value.outlet],a),this.forwardEvent(new yS(r.value.snapshot))}),n.children.length&&this.forwardEvent(new _S(n.value.snapshot))}activateRoutes(n,e,a){let d=n.value,r=e?e.value:null;if(qP(d),d===r)if(d.component){let C=a.getOrCreateContext(d.outlet);this.activateChildRoutes(n,e,C.children)}else this.activateChildRoutes(n,e,a);else if(d.component){let C=a.getOrCreateContext(d.outlet);if(this.routeReuseStrategy.shouldAttach(d.snapshot)){let P=this.routeReuseStrategy.retrieve(d.snapshot);this.routeReuseStrategy.store(d.snapshot,null),C.children.onOutletReAttached(P.contexts),C.attachRef=P.componentRef,C.route=P.route.value,C.outlet&&C.outlet.attach(P.componentRef,P.route.value),qP(P.route.value),this.activateChildRoutes(n,null,C.children)}else C.attachRef=null,C.route=d,C.outlet&&C.outlet.activateWith(d,C.injector),this.activateChildRoutes(n,null,C.children)}else this.activateChildRoutes(n,null,a)}},ES=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},W_=class{component;route;constructor(n,e){this.component=n,this.route=e}};function KX(i,n,e){let a=i._root,d=n?n._root:null;return Rx(a,d,e,[a.value])}function QX(i){let n=i.routeConfig?i.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:i,guards:n}}function t0(i,n){let e=Symbol(),a=n.get(i,e);return a===e?typeof i=="function"&&!SD(i)?i:n.get(i):a}function Rx(i,n,e,a,d={canDeactivateChecks:[],canActivateChecks:[]}){let r=H_(n);return i.children.forEach(C=>{JX(C,r[C.value.outlet],e,a.concat([C.value]),d),delete r[C.value.outlet]}),Object.entries(r).forEach(([C,P])=>Fx(P,e.getContext(C),d)),d}function JX(i,n,e,a,d={canDeactivateChecks:[],canActivateChecks:[]}){let r=i.value,C=n?n.value:null,P=e?e.getContext(i.value.outlet):null;if(C&&r.routeConfig===C.routeConfig){let k=eK(C,r,r.routeConfig.runGuardsAndResolvers);k?d.canActivateChecks.push(new ES(a)):(r.data=C.data,r._resolvedData=C._resolvedData),r.component?Rx(i,n,P?P.children:null,a,d):Rx(i,n,e,a,d),k&&P&&P.outlet&&P.outlet.isActivated&&d.canDeactivateChecks.push(new W_(P.outlet.component,C))}else C&&Fx(n,P,d),d.canActivateChecks.push(new ES(a)),r.component?Rx(i,null,P?P.children:null,a,d):Rx(i,null,e,a,d);return d}function eK(i,n,e){if(typeof e=="function")return e(i,n);switch(e){case"pathParamsChange":return!Vf(i.url,n.url);case"pathParamsOrQueryParamsChange":return!Vf(i.url,n.url)||!Au(i.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!tO(i,n)||!Au(i.queryParams,n.queryParams);case"paramsChange":default:return!tO(i,n)}}function Fx(i,n,e){let a=H_(i),d=i.value;Object.entries(a).forEach(([r,C])=>{d.component?n?Fx(C,n.children.getContext(r),e):Fx(C,null,e):Fx(C,n,e)}),d.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new W_(n.outlet.component,d)):e.canDeactivateChecks.push(new W_(null,d)):e.canDeactivateChecks.push(new W_(null,d))}function Wx(i){return typeof i=="function"}function tK(i){return typeof i=="boolean"}function nK(i){return i&&Wx(i.canLoad)}function iK(i){return i&&Wx(i.canActivate)}function rK(i){return i&&Wx(i.canActivateChild)}function oK(i){return i&&Wx(i.canDeactivate)}function sK(i){return i&&Wx(i.canMatch)}function p5(i){return i instanceof Ed||i?.name==="EmptyError"}var rS=Symbol("INITIAL_VALUE");function J_(){return So(i=>hf(i.map(n=>n.pipe(nl(1),u_(rS)))).pipe(Qn(n=>{for(let e of n)if(e!==!0){if(e===rS)return rS;if(e===!1||aK(e))return e}return!0}),Ao(n=>n!==rS),nl(1)))}function aK(i){return Hh(i)||i instanceof Q_}function lK(i,n){return Bo(e=>{let{targetSnapshot:a,currentSnapshot:d,guards:{canActivateChecks:r,canDeactivateChecks:C}}=e;return C.length===0&&r.length===0?Dn(Ci(Ht({},e),{guardsResult:!0})):cK(C,a,d,i).pipe(Bo(P=>P&&tK(P)?uK(a,r,i,n):Dn(P)),Qn(P=>Ci(Ht({},e),{guardsResult:P})))})}function cK(i,n,e,a){return go(i).pipe(Bo(d=>mK(d.component,d.route,e,n,a)),Td(d=>d!==!0,!0))}function uK(i,n,e,a){return go(n).pipe(fu(d=>Dh(hK(d.route.parent,a),dK(d.route,a),fK(i,d.path,e),pK(i,d.route,e))),Td(d=>d!==!0,!0))}function dK(i,n){return i!==null&&n&&n(new vS(i)),Dn(!0)}function hK(i,n){return i!==null&&n&&n(new gS(i)),Dn(!0)}function pK(i,n,e){let a=n.routeConfig?n.routeConfig.canActivate:null;if(!a||a.length===0)return Dn(!0);let d=a.map(r=>Dy(()=>{let C=e0(n)??e,P=t0(r,C),k=iK(P)?P.canActivate(n,i):ys(C,()=>P(n,i));return Ud(k).pipe(Td())}));return Dn(d).pipe(J_())}function fK(i,n,e){let a=n[n.length-1],r=n.slice(0,n.length-1).reverse().map(C=>QX(C)).filter(C=>C!==null).map(C=>Dy(()=>{let P=C.guards.map(k=>{let X=e0(C.node)??e,oe=t0(k,X),Me=rK(oe)?oe.canActivateChild(a,i):ys(X,()=>oe(a,i));return Ud(Me).pipe(Td())});return Dn(P).pipe(J_())}));return Dn(r).pipe(J_())}function mK(i,n,e,a,d){let r=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!r||r.length===0)return Dn(!0);let C=r.map(P=>{let k=e0(n)??d,X=t0(P,k),oe=oK(X)?X.canDeactivate(i,n,e,a):ys(k,()=>X(i,n,e,a));return Ud(oe).pipe(Td())});return Dn(C).pipe(J_())}function gK(i,n,e,a){let d=n.canLoad;if(d===void 0||d.length===0)return Dn(!0);let r=d.map(C=>{let P=t0(C,i),k=nK(P)?P.canLoad(n,e):ys(i,()=>P(n,e));return Ud(k)});return Dn(r).pipe(J_(),f5(a))}function f5(i){return rD(Po(n=>{if(typeof n!="boolean")throw CS(i,n)}),Qn(n=>n===!0))}function _K(i,n,e,a){let d=n.canMatch;if(!d||d.length===0)return Dn(!0);let r=d.map(C=>{let P=t0(C,i),k=sK(P)?P.canMatch(n,e):ys(i,()=>P(n,e));return Ud(k)});return Dn(r).pipe(J_(),f5(a))}var jx=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},$x=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function $_(i){return Cc(new jx(i))}function vK(i){return Cc(new sn(4e3,!1))}function yK(i){return Cc(d5(!1,_a.GuardRejected))}var rO=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let a=[],d=e.root;for(;;){if(a=a.concat(d.segments),d.numberOfChildren===0)return Dn(a);if(d.numberOfChildren>1||!d.children[Di])return vK(`${n.redirectTo}`);d=d.children[Di]}}applyRedirectCommands(n,e,a,d,r){return xK(e,d,r).pipe(Qn(C=>{if(C instanceof Ou)throw new $x(C);let P=this.applyRedirectCreateUrlTree(C,this.urlSerializer.parse(C),n,a);if(C[0]==="/")throw new $x(P);return P}))}applyRedirectCreateUrlTree(n,e,a,d){let r=this.createSegmentGroup(n,e.root,a,d);return new Ou(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let a={};return Object.entries(n).forEach(([d,r])=>{if(typeof r=="string"&&r[0]===":"){let P=r.substring(1);a[d]=e[P]}else a[d]=r}),a}createSegmentGroup(n,e,a,d){let r=this.createSegments(n,e.segments,a,d),C={};return Object.entries(e.children).forEach(([P,k])=>{C[P]=this.createSegmentGroup(n,k,a,d)}),new Pr(r,C)}createSegments(n,e,a,d){return e.map(r=>r.path[0]===":"?this.findPosParam(n,r,d):this.findOrReturn(r,a))}findPosParam(n,e,a){let d=a[e.path.substring(1)];if(!d)throw new sn(4001,!1);return d}findOrReturn(n,e){let a=0;for(let d of e){if(d.path===n.path)return e.splice(a),d;a++}return n}};function xK(i,n,e){if(typeof i=="string")return Dn(i);let a=i,{queryParams:d,fragment:r,routeConfig:C,url:P,outlet:k,params:X,data:oe,title:Me}=n;return Ud(ys(e,()=>a({params:X,data:oe,queryParams:d,fragment:r,routeConfig:C,url:P,outlet:k,title:Me})))}var oO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function bK(i,n,e,a,d){let r=m5(i,n,e);return r.matched?(a=$X(n,a),_K(a,n,e,d).pipe(Qn(C=>C===!0?r:Ht({},oO)))):Dn(r)}function m5(i,n,e){if(n.path==="**")return wK(e);if(n.path==="")return n.pathMatch==="full"&&(i.hasChildren()||e.length>0)?Ht({},oO):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let d=(n.matcher||H4)(e,i,n);if(!d)return Ht({},oO);let r={};Object.entries(d.posParams??{}).forEach(([P,k])=>{r[P]=k.path});let C=d.consumed.length>0?Ht(Ht({},r),d.consumed[d.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:d.consumed,remainingSegments:e.slice(d.consumed.length),parameters:C,positionalParamSegments:d.posParams??{}}}function wK(i){return{matched:!0,parameters:i.length>0?q4(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function U4(i,n,e,a){return e.length>0&&SK(i,e,a)?{segmentGroup:new Pr(n,EK(a,new Pr(e,i.children))),slicedSegments:[]}:e.length===0&&TK(i,e,a)?{segmentGroup:new Pr(i.segments,CK(i,e,a,i.children)),slicedSegments:e}:{segmentGroup:new Pr(i.segments,i.children),slicedSegments:e}}function CK(i,n,e,a){let d={};for(let r of e)if(TS(i,n,r)&&!a[Nc(r)]){let C=new Pr([],{});d[Nc(r)]=C}return Ht(Ht({},a),d)}function EK(i,n){let e={};e[Di]=n;for(let a of i)if(a.path===""&&Nc(a)!==Di){let d=new Pr([],{});e[Nc(a)]=d}return e}function SK(i,n,e){return e.some(a=>TS(i,n,a)&&Nc(a)!==Di)}function TK(i,n,e){return e.some(a=>TS(i,n,a))}function TS(i,n,e){return(i.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function IK(i,n,e){return n.length===0&&!i.children[e]}var sO=class{};function MK(i,n,e,a,d,r,C="emptyOnly"){return new aO(i,n,e,a,d,C,r).recognize()}var DK=31,aO=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,a,d,r,C,P){this.injector=n,this.configLoader=e,this.rootComponentType=a,this.config=d,this.urlTree=r,this.paramsInheritanceStrategy=C,this.urlSerializer=P,this.applyRedirects=new rO(this.urlSerializer,this.urlTree)}noMatchError(n){return new sn(4002,`'${n.segmentGroup}'`)}recognize(){let n=U4(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Qn(({children:e,rootSnapshot:a})=>{let d=new ll(a,e),r=new Vx("",d),C=t5(a,[],this.urlTree.queryParams,this.urlTree.fragment);return C.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(C),{state:r,tree:C}}))}match(n){let e=new Uf([],Object.freeze({}),Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Di,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Di,e).pipe(Qn(a=>({children:a,rootSnapshot:e})),tl(a=>{if(a instanceof $x)return this.urlTree=a.urlTree,this.match(a.urlTree.root);throw a instanceof jx?this.noMatchError(a):a}))}processSegmentGroup(n,e,a,d,r){return a.segments.length===0&&a.hasChildren()?this.processChildren(n,e,a,r):this.processSegment(n,e,a,a.segments,d,!0,r).pipe(Qn(C=>C instanceof ll?[C]:[]))}processChildren(n,e,a,d){let r=[];for(let C of Object.keys(a.children))C==="primary"?r.unshift(C):r.push(C);return go(r).pipe(fu(C=>{let P=a.children[C],k=HX(e,C);return this.processSegmentGroup(n,k,P,C,d)}),uD((C,P)=>(C.push(...P),C)),Ah(null),cD(),Bo(C=>{if(C===null)return $_(a);let P=g5(C);return AK(P),Dn(P)}))}processSegment(n,e,a,d,r,C,P){return go(e).pipe(fu(k=>this.processSegmentAgainstRoute(k._injector??n,e,k,a,d,r,C,P).pipe(tl(X=>{if(X instanceof jx)return Dn(null);throw X}))),Td(k=>!!k),tl(k=>{if(p5(k))return IK(a,d,r)?Dn(new sO):$_(a);throw k}))}processSegmentAgainstRoute(n,e,a,d,r,C,P,k){return Nc(a)!==C&&(C===Di||!TS(d,r,a))?$_(d):a.redirectTo===void 0?this.matchSegmentAgainstRoute(n,d,a,r,C,k):this.allowRedirects&&P?this.expandSegmentAgainstRouteUsingRedirect(n,d,e,a,r,C,k):$_(d)}expandSegmentAgainstRouteUsingRedirect(n,e,a,d,r,C,P){let{matched:k,parameters:X,consumedSegments:oe,positionalParamSegments:Me,remainingSegments:$e}=m5(e,d,r);if(!k)return $_(e);typeof d.redirectTo=="string"&&d.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>DK&&(this.allowRedirects=!1));let ke=new Uf(r,X,Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,j4(d),Nc(d),d.component??d._loadedComponent??null,d,$4(d)),ht=wS(ke,P,this.paramsInheritanceStrategy);return ke.params=Object.freeze(ht.params),ke.data=Object.freeze(ht.data),this.applyRedirects.applyRedirectCommands(oe,d.redirectTo,Me,ke,n).pipe(So(Mt=>this.applyRedirects.lineralizeSegments(d,Mt)),Bo(Mt=>this.processSegment(n,a,e,Mt.concat($e),C,!1,P)))}matchSegmentAgainstRoute(n,e,a,d,r,C){let P=bK(e,a,d,n,this.urlSerializer);return a.path==="**"&&(e.children={}),P.pipe(So(k=>k.matched?(n=a._injector??n,this.getChildConfig(n,a,d).pipe(So(({routes:X})=>{let oe=a._loadedInjector??n,{parameters:Me,consumedSegments:$e,remainingSegments:ke}=k,ht=new Uf($e,Me,Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,j4(a),Nc(a),a.component??a._loadedComponent??null,a,$4(a)),Nt=wS(ht,C,this.paramsInheritanceStrategy);ht.params=Object.freeze(Nt.params),ht.data=Object.freeze(Nt.data);let{segmentGroup:Mt,slicedSegments:Xt}=U4(e,$e,ke,X);if(Xt.length===0&&Mt.hasChildren())return this.processChildren(oe,X,Mt,ht).pipe(Qn(sr=>new ll(ht,sr)));if(X.length===0&&Xt.length===0)return Dn(new ll(ht,[]));let Vn=Nc(a)===r;return this.processSegment(oe,X,Mt,Xt,Vn?Di:r,!0,ht).pipe(Qn(sr=>new ll(ht,sr instanceof ll?[sr]:[])))}))):$_(e)))}getChildConfig(n,e,a){return e.children?Dn({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?Dn({routes:e._loadedRoutes,injector:e._loadedInjector}):gK(n,e,a,this.urlSerializer).pipe(Bo(d=>d?this.configLoader.loadChildren(n,e).pipe(Po(r=>{e._loadedRoutes=r.routes,e._loadedInjector=r.injector})):yK(e))):Dn({routes:[],injector:n})}};function AK(i){i.sort((n,e)=>n.value.outlet===Di?-1:e.value.outlet===Di?1:n.value.outlet.localeCompare(e.value.outlet))}function PK(i){let n=i.value.routeConfig;return n&&n.path===""}function g5(i){let n=[],e=new Set;for(let a of i){if(!PK(a)){n.push(a);continue}let d=n.find(r=>a.value.routeConfig===r.value.routeConfig);d!==void 0?(d.children.push(...a.children),e.add(d)):n.push(a)}for(let a of e){let d=g5(a.children);n.push(new ll(a.value,d))}return n.filter(a=>!e.has(a))}function j4(i){return i.data||{}}function $4(i){return i.resolve||{}}function OK(i,n,e,a,d,r){return Bo(C=>MK(i,n,e,a,C.extractedUrl,d,r).pipe(Qn(({state:P,tree:k})=>Ci(Ht({},C),{targetSnapshot:P,urlAfterRedirects:k}))))}function RK(i,n){return Bo(e=>{let{targetSnapshot:a,guards:{canActivateChecks:d}}=e;if(!d.length)return Dn(e);let r=new Set(d.map(k=>k.route)),C=new Set;for(let k of r)if(!C.has(k))for(let X of _5(k))C.add(X);let P=0;return go(C).pipe(fu(k=>r.has(k)?kK(k,a,i,n):(k.data=wS(k,k.parent,i).resolve,Dn(void 0))),Po(()=>P++),c_(1),Bo(k=>P===C.size?Dn(e):Aa))})}function _5(i){let n=i.children.map(e=>_5(e)).flat();return[i,...n]}function kK(i,n,e,a){let d=i.routeConfig,r=i._resolve;return d?.title!==void 0&&!l5(d)&&(r[Hx]=d.title),Dy(()=>(i.data=wS(i,i.parent,e).resolve,FK(r,i,n,a).pipe(Qn(C=>(i._resolvedData=C,i.data=Ht(Ht({},i.data),C),null)))))}function FK(i,n,e,a){let d=YP(i);if(d.length===0)return Dn({});let r={};return go(d).pipe(Bo(C=>LK(i[C],n,e,a).pipe(Td(),Po(P=>{if(P instanceof Q_)throw CS(new $h,P);r[C]=P}))),c_(1),Qn(()=>r),tl(C=>p5(C)?Aa:Cc(C)))}function LK(i,n,e,a){let d=e0(n)??a,r=t0(i,d),C=r.resolve?r.resolve(n,e):ys(d,()=>r(n,e));return Ud(C)}function WP(i){return So(n=>{let e=i(n);return e?go(e).pipe(Qn(()=>n)):Dn(n)})}var hO=(()=>{class i{buildTitle(e){let a,d=e.root;for(;d!==void 0;)a=this.getResolvedTitleForRoute(d)??a,d=d.children.find(r=>r.outlet===Di);return a}getResolvedTitleForRoute(e){return e.data[Hx]}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(v5),providedIn:"root"})}return i})(),v5=(()=>{class i extends hO{title;constructor(e){super(),this.title=e}updateTitle(e){let a=this.buildTitle(e);a!==void 0&&this.title.setTitle(a)}static \u0275fac=function(a){return new(a||i)(hn(F4))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),qh=new Kt("",{providedIn:"root",factory:()=>({})}),Gf=new Kt(""),IS=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Ve(XA);loadComponent(e,a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return Dn(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);let d=Ud(ys(e,()=>a.loadComponent())).pipe(Qn(x5),So(b5),Po(C=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=C}),Sd(()=>{this.componentLoaders.delete(a)})),r=new o_(d,()=>new li).pipe(r_());return this.componentLoaders.set(a,r),r}loadChildren(e,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return Dn({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);let r=y5(a,this.compiler,e,this.onLoadEndListener).pipe(Sd(()=>{this.childrenLoaders.delete(a)})),C=new o_(r,()=>new li).pipe(r_());return this.childrenLoaders.set(a,C),C}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function y5(i,n,e,a){return Ud(ys(e,()=>i.loadChildren())).pipe(Qn(x5),So(b5),Bo(d=>d instanceof DE||Array.isArray(d)?Dn(d):go(n.compileModuleAsync(d))),Qn(d=>{a&&a(i);let r,C,P=!1;return Array.isArray(d)?(C=d,P=!0):(r=d.create(e).injector,C=r.get(Gf,[],{optional:!0,self:!0}).flat()),{routes:C.map(dO),injector:r}}))}function NK(i){return i&&typeof i=="object"&&"default"in i}function x5(i){return NK(i)?i.default:i}function b5(i){return Dn(i)}var MS=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(zK),providedIn:"root"})}return i})(),zK=(()=>{class i{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,a){return e}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),pO=new Kt(""),fO=new Kt("");function w5(i,n,e){let a=i.get(fO),d=i.get(si);if(!d.startViewTransition||a.skipNextTransition)return a.skipNextTransition=!1,new Promise(X=>setTimeout(X));let r,C=new Promise(X=>{r=X}),P=d.startViewTransition(()=>(r(),BK(i)));P.ready.catch(X=>{});let{onViewTransitionCreated:k}=a;return k&&ys(i,()=>k({transition:P,from:n,to:e})),C}function BK(i){return new Promise(n=>{zl({read:()=>setTimeout(n)},{injector:i})})}var mO=new Kt(""),DS=(()=>{class i{currentNavigation=qs(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new li;transitionAbortWithErrorSubject=new li;configLoader=Ve(IS);environmentInjector=Ve(Yr);destroyRef=Ve(Fl);urlSerializer=Ve($f);rootContexts=Ve(Hf);location=Ve(Du);inputBindingEnabled=Ve(qx,{optional:!0})!==null;titleStrategy=Ve(hO);options=Ve(qh,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Ve(MS);createViewTransition=Ve(pO,{optional:!0});navigationErrorHandler=Ve(mO,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Dn(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=d=>this.events.next(new fS(d)),a=d=>this.events.next(new mS(d));this.configLoader.onLoadEndListener=a,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let a=++this.navigationId;Ho(()=>{this.transitions?.next(Ci(Ht({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:a}))})}setupNavigations(e){return this.transitions=new zo(null),this.transitions.pipe(Ao(a=>a!==null),So(a=>{let d=!1;return Dn(a).pipe(So(r=>{if(this.navigationId>a.id)return this.cancelNavigationTransition(a,"",_a.SupersededByNewNavigation),Aa;this.currentTransition=a,this.currentNavigation.set({id:r.id,initialUrl:r.rawUrl,extractedUrl:r.extractedUrl,targetBrowserUrl:typeof r.extras.browserUrl=="string"?this.urlSerializer.parse(r.extras.browserUrl):r.extras.browserUrl,trigger:r.source,extras:r.extras,previousNavigation:this.lastSuccessfulNavigation?Ci(Ht({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>r.abortController.abort()});let C=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),P=r.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!C&&P!=="reload")return this.events.next(new Ru(r.id,this.urlSerializer.serialize(r.rawUrl),"",Z_.IgnoredSameUrlNavigation)),r.resolve(!1),Aa;if(this.urlHandlingStrategy.shouldProcessUrl(r.rawUrl))return Dn(r).pipe(So(k=>(this.events.next(new Gh(k.id,this.urlSerializer.serialize(k.extractedUrl),k.source,k.restoredState)),k.id!==this.navigationId?Aa:Promise.resolve(k))),OK(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Po(k=>{a.targetSnapshot=k.targetSnapshot,a.urlAfterRedirects=k.urlAfterRedirects,this.currentNavigation.update(oe=>(oe.finalUrl=k.urlAfterRedirects,oe));let X=new Nx(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(X)}));if(C&&this.urlHandlingStrategy.shouldProcessUrl(r.currentRawUrl)){let{id:k,extractedUrl:X,source:oe,restoredState:Me,extras:$e}=r,ke=new Gh(k,this.urlSerializer.serialize(X),oe,Me);this.events.next(ke);let ht=s5(this.rootComponentType).snapshot;return this.currentTransition=a=Ci(Ht({},r),{targetSnapshot:ht,urlAfterRedirects:X,extras:Ci(Ht({},$e),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(Nt=>(Nt.finalUrl=X,Nt)),Dn(a)}else return this.events.next(new Ru(r.id,this.urlSerializer.serialize(r.extractedUrl),"",Z_.IgnoredByUrlHandlingStrategy)),r.resolve(!1),Aa}),Po(r=>{let C=new uS(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot);this.events.next(C)}),Qn(r=>(this.currentTransition=a=Ci(Ht({},r),{guards:KX(r.targetSnapshot,r.currentSnapshot,this.rootContexts)}),a)),lK(this.environmentInjector,r=>this.events.next(r)),Po(r=>{if(a.guardsResult=r.guardsResult,r.guardsResult&&typeof r.guardsResult!="boolean")throw CS(this.urlSerializer,r.guardsResult);let C=new dS(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot,!!r.guardsResult);this.events.next(C)}),Ao(r=>r.guardsResult?!0:(this.cancelNavigationTransition(r,"",_a.GuardRejected),!1)),WP(r=>{if(r.guards.canActivateChecks.length!==0)return Dn(r).pipe(Po(C=>{let P=new hS(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(P)}),So(C=>{let P=!1;return Dn(C).pipe(RK(this.paramsInheritanceStrategy,this.environmentInjector),Po({next:()=>P=!0,complete:()=>{P||this.cancelNavigationTransition(C,"",_a.NoDataFromResolver)}}))}),Po(C=>{let P=new pS(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(P)}))}),WP(r=>{let C=P=>{let k=[];if(P.routeConfig?.loadComponent){let X=e0(P)??this.environmentInjector;k.push(this.configLoader.loadComponent(X,P.routeConfig).pipe(Po(oe=>{P.component=oe}),Qn(()=>{})))}for(let X of P.children)k.push(...C(X));return k};return hf(C(r.targetSnapshot.root)).pipe(Ah(null),nl(1))}),WP(()=>this.afterPreactivation()),So(()=>{let{currentSnapshot:r,targetSnapshot:C}=a,P=this.createViewTransition?.(this.environmentInjector,r.root,C.root);return P?go(P).pipe(Qn(()=>a)):Dn(a)}),Qn(r=>{let C=qX(e.routeReuseStrategy,r.targetSnapshot,r.currentRouterState);return this.currentTransition=a=Ci(Ht({},r),{targetRouterState:C}),this.currentNavigation.update(P=>(P.targetRouterState=C,P)),a}),Po(()=>{this.events.next(new zx)}),XX(this.rootContexts,e.routeReuseStrategy,r=>this.events.next(r),this.inputBindingEnabled),nl(1),Ec(new Fi(r=>{let C=a.abortController.signal,P=()=>r.next();return C.addEventListener("abort",P),()=>C.removeEventListener("abort",P)}).pipe(Ao(()=>!d&&!a.targetRouterState),Po(()=>{this.cancelNavigationTransition(a,a.abortController.signal.reason+"",_a.Aborted)}))),Po({next:r=>{d=!0,this.lastSuccessfulNavigation=Ho(this.currentNavigation),this.events.next(new jl(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects))),this.titleStrategy?.updateTitle(r.targetRouterState.snapshot),r.resolve(!0)},complete:()=>{d=!0}}),Ec(this.transitionAbortWithErrorSubject.pipe(Po(r=>{throw r}))),Sd(()=>{d||this.cancelNavigationTransition(a,"",_a.SupersededByNewNavigation),this.currentTransition?.id===a.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),tl(r=>{if(this.destroyed)return a.resolve(!1),Aa;if(d=!0,h5(r))this.events.next(new Pu(a.id,this.urlSerializer.serialize(a.extractedUrl),r.message,r.cancellationCode)),YX(r)?this.events.next(new K_(r.url,r.navigationBehaviorOptions)):a.resolve(!1);else{let C=new Y_(a.id,this.urlSerializer.serialize(a.extractedUrl),r,a.targetSnapshot??void 0);try{let P=ys(this.environmentInjector,()=>this.navigationErrorHandler?.(C));if(P instanceof Q_){let{message:k,cancellationCode:X}=CS(this.urlSerializer,P);this.events.next(new Pu(a.id,this.urlSerializer.serialize(a.extractedUrl),k,X)),this.events.next(new K_(P.redirectTo,P.navigationBehaviorOptions))}else throw this.events.next(C),r}catch(P){this.options.resolveNavigationPromiseOnError?a.resolve(!1):a.reject(P)}}return Aa}))}))}cancelNavigationTransition(e,a,d){let r=new Pu(e.id,this.urlSerializer.serialize(e.extractedUrl),a,d);this.events.next(r),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),a=Ho(this.currentNavigation),d=a?.targetBrowserUrl??a?.extractedUrl;return e.toString()!==d?.toString()&&!a?.extras.skipLocationChange}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function VK(i){return i!==q_}var C5=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(UK),providedIn:"root"})}return i})(),SS=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},UK=(()=>{class i extends SS{static \u0275fac=(()=>{let e;return function(d){return(e||(e=Mu(i)))(d||i)}})();static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),E5=(()=>{class i{urlSerializer=Ve($f);options=Ve(qh,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=Ve(Du);urlHandlingStrategy=Ve(MS);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ou;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:a,targetBrowserUrl:d}){let r=e!==void 0?this.urlHandlingStrategy.merge(e,a):a,C=d??r;return C instanceof Ou?this.urlSerializer.serialize(C):C}commitTransition({targetRouterState:e,finalUrl:a,initialUrl:d}){a&&e?(this.currentUrlTree=a,this.rawUrlTree=this.urlHandlingStrategy.merge(a,d),this.routerState=e):this.rawUrlTree=d}routerState=s5(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:()=>Ve(jK),providedIn:"root"})}return i})(),jK=(()=>{class i extends E5{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(a=>{a.type==="popstate"&&setTimeout(()=>{e(a.url,a.state,"popstate")})})}handleRouterEvent(e,a){e instanceof Gh?this.updateStateMemento():e instanceof Ru?this.commitTransition(a):e instanceof Nx?this.urlUpdateStrategy==="eager"&&(a.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(a),a)):e instanceof zx?(this.commitTransition(a),this.urlUpdateStrategy==="deferred"&&!a.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(a),a)):e instanceof Pu&&e.code!==_a.SupersededByNewNavigation&&e.code!==_a.Redirect?this.restoreHistory(a):e instanceof Y_?this.restoreHistory(a,!0):e instanceof jl&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:a,id:d}){let{replaceUrl:r,state:C}=a;if(this.location.isCurrentPathEqualTo(e)||r){let P=this.browserPageId,k=Ht(Ht({},C),this.generateNgRouterState(d,P));this.location.replaceState(e,"",k)}else{let P=Ht(Ht({},C),this.generateNgRouterState(d,this.browserPageId+1));this.location.go(e,"",P)}}restoreHistory(e,a=!1){if(this.canceledNavigationResolution==="computed"){let d=this.browserPageId,r=this.currentPageId-d;r!==0?this.location.historyGo(r):this.getCurrentUrlTree()===e.finalUrl&&r===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(a&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,a){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:a}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(d){return(e||(e=Mu(i)))(d||i)}})();static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function AS(i,n){i.events.pipe(Ao(e=>e instanceof jl||e instanceof Pu||e instanceof Y_||e instanceof Ru),Qn(e=>e instanceof jl||e instanceof Ru?0:(e instanceof Pu?e.code===_a.Redirect||e.code===_a.SupersededByNewNavigation:!1)?2:1),Ao(e=>e!==2),nl(1)).subscribe(()=>{n()})}var $K={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},HK={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ws=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Ve(AE);stateManager=Ve(E5);options=Ve(qh,{optional:!0})||{};pendingTasks=Ve(Eu);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Ve(DS);urlSerializer=Ve($f);location=Ve(Du);urlHandlingStrategy=Ve(MS);injector=Ve(Yr);_events=new li;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Ve(C5);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Ve(Gf,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Ve(qx,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Gr;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(a=>{try{let d=this.navigationTransitions.currentTransition,r=Ho(this.navigationTransitions.currentNavigation);if(d!==null&&r!==null){if(this.stateManager.handleRouterEvent(a,r),a instanceof Pu&&a.code!==_a.Redirect&&a.code!==_a.SupersededByNewNavigation)this.navigated=!0;else if(a instanceof jl)this.navigated=!0;else if(a instanceof K_){let C=a.navigationBehaviorOptions,P=this.urlHandlingStrategy.merge(a.url,d.currentRawUrl),k=Ht({browserUrl:d.extras.browserUrl,info:d.extras.info,skipLocationChange:d.extras.skipLocationChange,replaceUrl:d.extras.replaceUrl||this.urlUpdateStrategy==="eager"||VK(d.source)},C);this.scheduleNavigation(P,q_,null,k,{resolve:d.resolve,reject:d.reject,promise:d.promise})}}jX(a)&&this._events.next(a)}catch(d){this.navigationTransitions.transitionAbortWithErrorSubject.next(d)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),q_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,a,d)=>{this.navigateToSyncWithBrowser(e,d,a)})}navigateToSyncWithBrowser(e,a,d){let r={replaceUrl:!0},C=d?.navigationId?d:null;if(d){let k=Ht({},d);delete k.navigationId,delete k.\u0275routerPageId,Object.keys(k).length!==0&&(r.state=k)}let P=this.parseUrl(e);this.scheduleNavigation(P,a,C,r).catch(k=>{this.disposed||this.injector.get(Gs)(k)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Ho(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(dO),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,a={}){let{relativeTo:d,queryParams:r,fragment:C,queryParamsHandling:P,preserveFragment:k}=a,X=k?this.currentUrlTree.fragment:C,oe=null;switch(P??this.options.defaultQueryParamsHandling){case"merge":oe=Ht(Ht({},this.currentUrlTree.queryParams),r);break;case"preserve":oe=this.currentUrlTree.queryParams;break;default:oe=r||null}oe!==null&&(oe=this.removeEmptyProps(oe));let Me;try{let $e=d?d.snapshot:this.routerState.snapshot.root;Me=n5($e)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),Me=this.currentUrlTree.root}return i5(Me,e,oe,X??null)}navigateByUrl(e,a={skipLocationChange:!1}){let d=Hh(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(r,q_,null,a)}navigate(e,a={skipLocationChange:!1}){return GK(e),this.navigateByUrl(this.createUrlTree(e,a),a)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.console.warn(mu(4018,!1)),this.urlSerializer.parse("/")}}isActive(e,a){let d;if(a===!0?d=Ht({},$K):a===!1?d=Ht({},HK):d=a,Hh(e))return N4(this.currentUrlTree,e,d);let r=this.parseUrl(e);return N4(this.currentUrlTree,r,d)}removeEmptyProps(e){return Object.entries(e).reduce((a,[d,r])=>(r!=null&&(a[d]=r),a),{})}scheduleNavigation(e,a,d,r,C){if(this.disposed)return Promise.resolve(!1);let P,k,X;C?(P=C.resolve,k=C.reject,X=C.promise):X=new Promise((Me,$e)=>{P=Me,k=$e});let oe=this.pendingTasks.add();return AS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(oe))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:r,resolve:P,reject:k,promise:X,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),X.catch(Me=>Promise.reject(Me))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function GK(i){for(let n=0;n<i.length;n++)if(i[n]==null)throw new sn(4008,!1)}var n0=(()=>{class i{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=qs(null);get href(){return Ho(this.reactiveHref)}set href(e){this.reactiveHref.set(e)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new li;applicationErrorHandler=Ve(Gs);options=Ve(qh,{optional:!0});constructor(e,a,d,r,C,P){this.router=e,this.route=a,this.tabIndexAttribute=d,this.renderer=r,this.el=C,this.locationStrategy=P,this.reactiveHref.set(Ve(new z_("href"),{optional:!0}));let k=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement=k==="a"||k==="area"||!!(typeof customElements=="object"&&customElements.get(k)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let e=this.preserveFragment,a=d=>d==="merge"||d==="preserve";e||=a(this.queryParamsHandling),e||=!this.queryParamsHandling&&!a(this.options?.defaultQueryParamsHandling),e&&(this.subscription=this.router.events.subscribe(d=>{d instanceof jl&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Hh(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,a,d,r,C){let P=this.urlTree;if(P===null||this.isAnchorElement&&(e!==0||a||d||r||C||typeof this.target=="string"&&this.target!="_self"))return!0;let k={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(P,k)?.catch(X=>{this.applicationErrorHandler(X)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.reactiveHref.set(e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e))??"":null)}applyAttributeValue(e,a){let d=this.renderer,r=this.el.nativeElement;a!==null?d.setAttribute(r,e,a):d.removeAttribute(r,e)}get urlTree(){return this.routerLinkInput===null?null:Hh(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(a){return new(a||i)(Dt(ws),Dt(Zs),nx("tabindex"),Dt(Oa),Dt(pr),Dt(kc))};static \u0275dir=yr({type:i,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(a,d){a&1&&Te("click",function(C){return d.onClick(C.button,C.ctrlKey,C.shiftKey,C.altKey,C.metaKey)}),a&2&&Ro("href",d.reactiveHref(),EA)("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Ns],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Ns],replaceUrl:[2,"replaceUrl","replaceUrl",Ns],routerLink:"routerLink"},features:[Br]})}return i})();var Zx=class{};var S5=(()=>{class i{router;injector;preloadingStrategy;loader;subscription;constructor(e,a,d,r){this.router=e,this.injector=a,this.preloadingStrategy=d,this.loader=r}setUpPreloading(){this.subscription=this.router.events.pipe(Ao(e=>e instanceof jl),fu(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,a){let d=[];for(let r of a){r.providers&&!r._injector&&(r._injector=A_(r.providers,e,`Route: ${r.path}`));let C=r._injector??e,P=r._loadedInjector??C;(r.loadChildren&&!r._loadedRoutes&&r.canLoad===void 0||r.loadComponent&&!r._loadedComponent)&&d.push(this.preloadConfig(C,r)),(r.children||r._loadedRoutes)&&d.push(this.processRoutes(P,r.children??r._loadedRoutes))}return go(d).pipe(a_())}preloadConfig(e,a){return this.preloadingStrategy.preload(a,()=>{let d;a.loadChildren&&a.canLoad===void 0?d=this.loader.loadChildren(e,a):d=Dn(null);let r=d.pipe(Bo(C=>C===null?Dn(void 0):(a._loadedRoutes=C.routes,a._loadedInjector=C.injector,this.processRoutes(C.injector??e,C.routes))));if(a.loadComponent&&!a._loadedComponent){let C=this.loader.loadComponent(e,a);return go([r,C]).pipe(a_())}else return r})}static \u0275fac=function(a){return new(a||i)(hn(ws),hn(Yr),hn(Zx),hn(IS))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),T5=new Kt(""),qK=(()=>{class i{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=q_;restoredId=0;store={};constructor(e,a,d,r,C={}){this.urlSerializer=e,this.transitions=a,this.viewportScroller=d,this.zone=r,this.options=C,C.scrollPositionRestoration||="disabled",C.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Gh?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof jl?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Ru&&e.code===Z_.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{if(!(e instanceof X_))return;let a={behavior:"instant"};e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],a):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position,a):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(e,a){this.zone.runOutsideAngular(()=>Sr(this,null,function*(){yield new Promise(d=>{setTimeout(d),typeof requestAnimationFrame<"u"&&requestAnimationFrame(d)}),this.zone.run(()=>{this.transitions.events.next(new X_(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,a))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(a){UA()};static \u0275prov=kt({token:i,factory:i.\u0275fac})}return i})();function _O(i,...n){return Sc([{provide:Gf,multi:!0,useValue:i},[],{provide:Zs,useFactory:I5,deps:[ws]},{provide:ux,multi:!0,useFactory:M5},n.map(e=>e.\u0275providers)])}function I5(i){return i.routerState.root}function Yx(i,n){return{\u0275kind:i,\u0275providers:n}}function M5(){let i=Ve(hr);return n=>{let e=i.get(Ra);if(n!==e.components[0])return;let a=i.get(ws),d=i.get(D5);i.get(vO)===1&&a.initialNavigation(),i.get(O5,null,{optional:!0})?.setUpPreloading(),i.get(T5,null,{optional:!0})?.init(),a.resetRootComponentType(e.componentTypes[0]),d.closed||(d.next(),d.complete(),d.unsubscribe())}}var D5=new Kt("",{factory:()=>new li}),vO=new Kt("",{providedIn:"root",factory:()=>1});function A5(){let i=[{provide:_E,useValue:!0},{provide:vO,useValue:0},OE(()=>{let n=Ve(hr);return n.get(pP,Promise.resolve()).then(()=>new Promise(a=>{let d=n.get(ws),r=n.get(D5);AS(d,()=>{a(!0)}),n.get(DS).afterPreactivation=()=>(a(!0),r.closed?Dn(void 0):r),d.initialNavigation()}))})];return Yx(2,i)}function P5(){let i=[OE(()=>{Ve(ws).setUpLocationChangeListener()}),{provide:vO,useValue:2}];return Yx(3,i)}var O5=new Kt("");function R5(i){return Yx(0,[{provide:O5,useExisting:S5},{provide:Zx,useExisting:i}])}function k5(){return Yx(8,[cO,{provide:qx,useExisting:cO}])}function F5(i){Pc("NgRouterViewTransitions");let n=[{provide:pO,useValue:w5},{provide:fO,useValue:Ht({skipNextTransition:!!i?.skipInitialTransition},i)}];return Yx(9,n)}var L5=[Du,{provide:$f,useClass:$h},ws,Hf,{provide:Zs,useFactory:I5,deps:[ws]},IS,[]],Xx=(()=>{class i{constructor(){}static forRoot(e,a){return{ngModule:i,providers:[L5,[],{provide:Gf,multi:!0,useValue:e},[],a?.errorHandler?{provide:mO,useValue:a.errorHandler}:[],{provide:qh,useValue:a||{}},a?.useHash?ZK():YK(),WK(),a?.preloadingStrategy?R5(a.preloadingStrategy).\u0275providers:[],a?.initialNavigation?XK(a):[],a?.bindToComponentInputs?k5().\u0275providers:[],a?.enableViewTransitions?F5().\u0275providers:[],KK()]}}static forChild(e){return{ngModule:i,providers:[{provide:Gf,multi:!0,useValue:e}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})();function WK(){return{provide:T5,useFactory:()=>{let i=Ve(m4),n=Ve(xi),e=Ve(qh),a=Ve(DS),d=Ve($f);return e.scrollOffset&&i.setOffset(e.scrollOffset),new qK(d,a,i,n,e)}}}function ZK(){return{provide:kc,useClass:xP}}function YK(){return{provide:kc,useClass:BE}}function XK(i){return[i.initialNavigation==="disabled"?P5().\u0275providers:[],i.initialNavigation==="enabledBlocking"?A5().\u0275providers:[]]}var gO=new Kt("");function KK(){return[{provide:gO,useFactory:M5},{provide:ux,multi:!0,useExisting:gO}]}var Na=class i{stateSubject=new zo(null);state$=this.stateSubject.asObservable();pendingResolve=null;confirm(n){return n.message?(this.pendingResolve&&this.pendingResolve(!1),new Promise(e=>{this.pendingResolve=e,this.stateSubject.next({title:n.title??"Confirm action",message:n.message,confirmText:n.confirmText??"Confirm",cancelText:n.cancelText??"Cancel",tone:n.tone??"accent",confirmClass:n.confirmClass})})):Promise.resolve(!1)}resolve(n){this.pendingResolve&&(this.pendingResolve(n),this.pendingResolve=null),this.stateSubject.next(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};function QK(i,n){if(i&1){let e=wt();z(0,"div",1),Te("click",function(){Ee(e);let d=te();return Se(d.onCancel())}),z(1,"div",2),Te("click",function(d){return Ee(e),Se(d.stopPropagation())}),z(2,"div",3)(3,"h2"),W(4),V()(),z(5,"p",4),W(6),V(),z(7,"div",5)(8,"button",6),Te("click",function(){Ee(e);let d=te();return Se(d.onCancel())}),W(9),V(),z(10,"button",7),Te("click",function(){Ee(e);let d=te();return Se(d.onConfirm())}),W(11),V()()()()}if(i&2){let e=n.ngIf;K(4),ot(e.title),K(2),ot(e.message),K(3),bi(" ",e.cancelText," "),K(),an("danger",e.tone==="danger")("confirm-white-text",e.confirmClass==="white-text"),K(),bi(" ",e.confirmText," ")}}var PS=class i{constructor(n){this.confirmation=n;this.state$=this.confirmation.state$,this.subscription=this.confirmation.state$.subscribe(e=>{this.isOpen=!!e})}state$;isOpen=!1;subscription;ngOnDestroy(){this.subscription.unsubscribe()}onConfirm(){this.confirmation.resolve(!0)}onCancel(){this.confirmation.resolve(!1)}onEscape(){this.isOpen&&this.onCancel()}static \u0275fac=function(e){return new(e||i)(Dt(Na))};static \u0275cmp=vn({type:i,selectors:[["app-confirm-dialog"]],hostBindings:function(e,a){e&1&&Te("keydown.escape",function(){return a.onEscape()},sx)},decls:2,vars:3,consts:[["class","confirm-backdrop",3,"click",4,"ngIf"],[1,"confirm-backdrop",3,"click"],["role","dialog","aria-modal","true",1,"confirm-modal",3,"click"],[1,"confirm-header"],[1,"confirm-message"],[1,"confirm-actions"],["type","button",1,"button","cancel-button",3,"click"],["type","button",1,"button","confirm-button",3,"click"]],template:function(e,a){e&1&&($i(0,QK,12,8,"div",0),Ls(1,"async")),e&2&&vt("ngIf",F_(1,1,a.state$))},dependencies:[fi,cs,CP],styles:[".confirm-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:100000}.confirm-modal[_ngcontent-%COMP%]{width:min(480px,92vw);background:var(--modal-surface);border-radius:var(--modal-radius);padding:24px;border:var(--modal-border);box-shadow:var(--modal-shadow);animation:_ngcontent-%COMP%_confirmPop .18s ease-out}.confirm-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:22px;font-weight:700}.confirm-message[_ngcontent-%COMP%]{margin:12px 0 0;color:var(--color-white);font-size:15px;line-height:1.5}.confirm-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;flex-wrap:wrap}button.button.cancel-button[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white);box-shadow:none}button.button.cancel-button[_ngcontent-%COMP%]:hover{border-color:var(--color-light-gray);transform:translateY(-1px)}button.button.confirm-button[_ngcontent-%COMP%]{background:var(--color-accent);color:var(--color-black)}button.button.confirm-button.confirm-white-text[_ngcontent-%COMP%]{color:#fff}button.button.confirm-button.danger[_ngcontent-%COMP%]{background:var(--color-error);color:var(--color-white)}button.button.confirm-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}@keyframes _ngcontent-%COMP%_confirmPop{0%{transform:scale(.98);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width: 640px){.confirm-modal[_ngcontent-%COMP%]{width:calc(100% - 32px);padding:20px;border-radius:var(--modal-radius)}.confirm-actions[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:stretch}}"]})};var OS=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=vn({type:i,selectors:[["app-root"]],decls:2,vars:0,template:function(e,a){e&1&&An(0,"router-outlet")(1,"app-confirm-dialog")},dependencies:[Gx,PS],encapsulation:2})};var ul={mapboxToken:"pk.eyJ1IjoiZm5zYnJsIiwiYSI6ImNtaHhqbGUwbDAxeGcyanNjazVybGJtdHYifQ.YxqJwN9S4EposFmNb7igWA",googleClientId:"177987336410-qse83le4nl3i65oat3g2b32kk5sji7sq.apps.googleusercontent.com",googleRedirectUri:"postmessage"};var b0=Pw(bO());var RS;function JK(){if(RS===void 0&&(RS=null,typeof window<"u")){let i=window;i.trustedTypes!==void 0&&(RS=i.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return RS}function Qx(i){return JK()?.createHTML(i)||i}function z5(i){return Error(`Unable to find icon with the name "${i}"`)}function eQ(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function B5(i){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${i}".`)}function V5(i){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${i}".`)}var jd=class{url;svgText;options;svgElement;constructor(n,e,a){this.url=n,this.svgText=e,this.options=a}},j5=(()=>{class i{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(e,a,d,r){this._httpClient=e,this._sanitizer=a,this._errorHandler=r,this._document=d}addSvgIcon(e,a,d){return this.addSvgIconInNamespace("",e,a,d)}addSvgIconLiteral(e,a,d){return this.addSvgIconLiteralInNamespace("",e,a,d)}addSvgIconInNamespace(e,a,d,r){return this._addSvgIconConfig(e,a,new jd(d,null,r))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,a,d,r){let C=this._sanitizer.sanitize(Fs.HTML,d);if(!C)throw V5(d);let P=Qx(C);return this._addSvgIconConfig(e,a,new jd("",P,r))}addSvgIconSet(e,a){return this.addSvgIconSetInNamespace("",e,a)}addSvgIconSetLiteral(e,a){return this.addSvgIconSetLiteralInNamespace("",e,a)}addSvgIconSetInNamespace(e,a,d){return this._addSvgIconSetConfig(e,new jd(a,null,d))}addSvgIconSetLiteralInNamespace(e,a,d){let r=this._sanitizer.sanitize(Fs.HTML,a);if(!r)throw V5(a);let C=Qx(r);return this._addSvgIconSetConfig(e,new jd("",C,d))}registerFontClassAlias(e,a=e){return this._fontCssClassesByAlias.set(e,a),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){let a=this._sanitizer.sanitize(Fs.RESOURCE_URL,e);if(!a)throw B5(e);let d=this._cachedIconsByUrl.get(a);return d?Dn(kS(d)):this._loadSvgIconFromConfig(new jd(e,null)).pipe(Po(r=>this._cachedIconsByUrl.set(a,r)),Qn(r=>kS(r)))}getNamedSvgIcon(e,a=""){let d=U5(a,e),r=this._svgIconConfigs.get(d);if(r)return this._getSvgFromConfig(r);if(r=this._getIconConfigFromResolvers(a,e),r)return this._svgIconConfigs.set(d,r),this._getSvgFromConfig(r);let C=this._iconSetConfigs.get(a);return C?this._getSvgFromIconSetConfigs(e,C):Cc(z5(d))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Dn(kS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Qn(a=>kS(a)))}_getSvgFromIconSetConfigs(e,a){let d=this._extractIconWithNameFromAnySet(e,a);if(d)return Dn(d);let r=a.filter(C=>!C.svgText).map(C=>this._loadSvgIconSetFromConfig(C).pipe(tl(P=>{let X=`Loading icon set URL: ${this._sanitizer.sanitize(Fs.RESOURCE_URL,C.url)} failed: ${P.message}`;return this._errorHandler.handleError(new Error(X)),Dn(null)})));return Ay(r).pipe(Qn(()=>{let C=this._extractIconWithNameFromAnySet(e,a);if(!C)throw z5(e);return C}))}_extractIconWithNameFromAnySet(e,a){for(let d=a.length-1;d>=0;d--){let r=a[d];if(r.svgText&&r.svgText.toString().indexOf(e)>-1){let C=this._svgElementFromConfig(r),P=this._extractSvgIconFromSet(C,e,r.options);if(P)return P}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Po(a=>e.svgText=a),Qn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Dn(null):this._fetchIcon(e).pipe(Po(a=>e.svgText=a))}_extractSvgIconFromSet(e,a,d){let r=e.querySelector(`[id="${a}"]`);if(!r)return null;let C=r.cloneNode(!0);if(C.removeAttribute("id"),C.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(C,d);if(C.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(C),d);let P=this._svgElementFromString(Qx("<svg></svg>"));return P.appendChild(C),this._setSvgAttributes(P,d)}_svgElementFromString(e){let a=this._document.createElement("DIV");a.innerHTML=e;let d=a.querySelector("svg");if(!d)throw Error("<svg> tag not found");return d}_toSvgElement(e){let a=this._svgElementFromString(Qx("<svg></svg>")),d=e.attributes;for(let r=0;r<d.length;r++){let{name:C,value:P}=d[r];C!=="id"&&a.setAttribute(C,P)}for(let r=0;r<e.childNodes.length;r++)e.childNodes[r].nodeType===this._document.ELEMENT_NODE&&a.appendChild(e.childNodes[r].cloneNode(!0));return a}_setSvgAttributes(e,a){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),a&&a.viewBox&&e.setAttribute("viewBox",a.viewBox),e}_fetchIcon(e){let{url:a,options:d}=e,r=d?.withCredentials??!1;if(!this._httpClient)throw eQ();if(a==null)throw Error(`Cannot fetch icon from URL "${a}".`);let C=this._sanitizer.sanitize(Fs.RESOURCE_URL,a);if(!C)throw B5(a);let P=this._inProgressUrlFetches.get(C);if(P)return P;let k=this._httpClient.get(C,{responseType:"text",withCredentials:r}).pipe(Qn(X=>Qx(X)),Sd(()=>this._inProgressUrlFetches.delete(C)),hD());return this._inProgressUrlFetches.set(C,k),k}_addSvgIconConfig(e,a,d){return this._svgIconConfigs.set(U5(e,a),d),this}_addSvgIconSetConfig(e,a){let d=this._iconSetConfigs.get(e);return d?d.push(a):this._iconSetConfigs.set(e,[a]),this}_svgElementFromConfig(e){if(!e.svgElement){let a=this._svgElementFromString(e.svgText);this._setSvgAttributes(a,e.options),e.svgElement=a}return e.svgElement}_getIconConfigFromResolvers(e,a){for(let d=0;d<this._resolvers.length;d++){let r=this._resolvers[d](a,e);if(r)return tQ(r)?new jd(r.url,null,r.options):new jd(r,null)}}static \u0275fac=function(a){return new(a||i)(hn(yo,8),hn($P),hn(si,8),hn(Hs))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function kS(i){return i.cloneNode(!0)}function U5(i,n){return i+":"+n}function tQ(i){return!!(i.url&&i.options)}function Jx(i){return i.buttons===0||i.detail===0}function eb(i){let n=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var wO;function $5(){if(wO==null){let i=typeof document<"u"?document.head:null;wO=!!(i&&(i.createShadowRoot||i.attachShadow))}return wO}function CO(i){if($5()){let n=i.getRootNode?i.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}function za(i){return i.composedPath?i.composedPath()[0]:i.target}var EO;try{EO=typeof Intl<"u"&&Intl.v8BreakIterator}catch{EO=!1}var ns=(()=>{class i{_platformId=Ve(Rf);isBrowser=this._platformId?f4(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||EO)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var tb;function H5(){if(tb==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>tb=!0}))}finally{tb=tb||!1}return tb}function r0(i){return H5()?i:!!i.capture}function ku(i){return i instanceof pr?i.nativeElement:i}var G5=new Kt("cdk-input-modality-detector-options"),q5={ignoreKeys:[18,17,224,91,16]},W5=650,SO={passive:!0,capture:!0},Z5=(()=>{class i{_platform=Ve(ns);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new zo(null);_options;_lastTouchMs=0;_onKeydown=e=>{this._options?.ignoreKeys?.some(a=>a===e.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=za(e))};_onMousedown=e=>{Date.now()-this._lastTouchMs<W5||(this._modality.next(Jx(e)?"keyboard":"mouse"),this._mostRecentTarget=za(e))};_onTouchstart=e=>{if(eb(e)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=za(e)};constructor(){let e=Ve(xi),a=Ve(si),d=Ve(G5,{optional:!0});if(this._options=Ht(Ht({},q5),d),this.modalityDetected=this._modality.pipe(Py(1)),this.modalityChanged=this.modalityDetected.pipe(ff()),this._platform.isBrowser){let r=Ve(xs).createRenderer(null,null);this._listenerCleanups=e.runOutsideAngular(()=>[r.listen(a,"keydown",this._onKeydown,SO),r.listen(a,"mousedown",this._onMousedown,SO),r.listen(a,"touchstart",this._onTouchstart,SO)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(e=>e())}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),nb=(function(i){return i[i.IMMEDIATE=0]="IMMEDIATE",i[i.EVENTUAL=1]="EVENTUAL",i})(nb||{}),Y5=new Kt("cdk-focus-monitor-default-options"),FS=r0({passive:!0,capture:!0}),TO=(()=>{class i{_ngZone=Ve(xi);_platform=Ve(ns);_inputModalityDetector=Ve(Z5);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=Ve(si);_stopInputModalityDetector=new li;constructor(){let e=Ve(Y5,{optional:!0});this._detectionMode=e?.detectionMode||nb.IMMEDIATE}_rootNodeFocusAndBlurListener=e=>{let a=za(e);for(let d=a;d;d=d.parentElement)e.type==="focus"?this._onFocus(e,d):this._onBlur(e,d)};monitor(e,a=!1){let d=ku(e);if(!this._platform.isBrowser||d.nodeType!==1)return Dn();let r=CO(d)||this._document,C=this._elementInfo.get(d);if(C)return a&&(C.checkChildren=!0),C.subject;let P={checkChildren:a,subject:new li,rootNode:r};return this._elementInfo.set(d,P),this._registerGlobalListeners(P),P.subject}stopMonitoring(e){let a=ku(e),d=this._elementInfo.get(a);d&&(d.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(d))}focusVia(e,a,d){let r=ku(e),C=this._document.activeElement;r===C?this._getClosestElementsInfo(r).forEach(([P,k])=>this._originChanged(P,a,k)):(this._setOrigin(a),typeof r.focus=="function"&&r.focus(d))}ngOnDestroy(){this._elementInfo.forEach((e,a)=>this.stopMonitoring(a))}_getWindow(){return this._document.defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return this._detectionMode===nb.EVENTUAL||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,a){e.classList.toggle("cdk-focused",!!a),e.classList.toggle("cdk-touch-focused",a==="touch"),e.classList.toggle("cdk-keyboard-focused",a==="keyboard"),e.classList.toggle("cdk-mouse-focused",a==="mouse"),e.classList.toggle("cdk-program-focused",a==="program")}_setOrigin(e,a=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=e,this._originFromTouchInteraction=e==="touch"&&a,this._detectionMode===nb.IMMEDIATE){clearTimeout(this._originTimeoutId);let d=this._originFromTouchInteraction?W5:1;this._originTimeoutId=setTimeout(()=>this._origin=null,d)}})}_onFocus(e,a){let d=this._elementInfo.get(a),r=za(e);!d||!d.checkChildren&&a!==r||this._originChanged(a,this._getFocusOrigin(r),d)}_onBlur(e,a){let d=this._elementInfo.get(a);!d||d.checkChildren&&e.relatedTarget instanceof Node&&a.contains(e.relatedTarget)||(this._setClasses(a),this._emitOrigin(d,null))}_emitOrigin(e,a){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(a))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;let a=e.rootNode,d=this._rootNodeFocusListenerCount.get(a)||0;d||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,FS),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,FS)}),this._rootNodeFocusListenerCount.set(a,d+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ec(this._stopInputModalityDetector)).subscribe(r=>{this._setOrigin(r,!0)}))}_removeGlobalListeners(e){let a=e.rootNode;if(this._rootNodeFocusListenerCount.has(a)){let d=this._rootNodeFocusListenerCount.get(a);d>1?this._rootNodeFocusListenerCount.set(a,d-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,FS),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,FS),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,a,d){this._setClasses(e,a),this._emitOrigin(d,a),this._lastFocusOrigin=a}_getClosestElementsInfo(e){let a=[];return this._elementInfo.forEach((d,r)=>{(r===e||d.checkChildren&&r.contains(e))&&a.push([r,d])}),a}_isLastInteractionFromInputLabel(e){let{_mostRecentTarget:a,mostRecentModality:d}=this._inputModalityDetector;if(d!=="mouse"||!a||a===e||e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"||e.disabled)return!1;let r=e.labels;if(r){for(let C=0;C<r.length;C++)if(r[C].contains(a))return!0}return!1}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var LS=new WeakMap,Wh=(()=>{class i{_appRef;_injector=Ve(hr);_environmentInjector=Ve(Yr);load(e){let a=this._appRef=this._appRef||this._injector.get(Ra),d=LS.get(a);d||(d={loaders:new Set,refs:[]},LS.set(a,d),a.onDestroy(()=>{LS.get(a)?.refs.forEach(r=>r.destroy()),LS.delete(a)})),d.loaders.has(e)||(d.loaders.add(e),d.refs.push(LE(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function o0(i){return Array.isArray(i)?i:[i]}var X5=new Set,qf,NS=(()=>{class i{_platform=Ve(ns);_nonce=Ve(M_,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):iQ}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&nQ(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function nQ(i,n){if(!X5.has(i))try{qf||(qf=document.createElement("style"),n&&qf.setAttribute("nonce",n),qf.setAttribute("type","text/css"),document.head.appendChild(qf)),qf.sheet&&(qf.sheet.insertRule(`@media ${i} {body{ }}`,0),X5.add(i))}catch(e){console.error(e)}}function iQ(i){return{matches:i==="all"||i==="",media:i,addListener:()=>{},removeListener:()=>{}}}var Wf=(()=>{class i{_mediaMatcher=Ve(NS);_zone=Ve(xi);_queries=new Map;_destroySubject=new li;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return K5(o0(e)).some(d=>this._registerQuery(d).mql.matches)}observe(e){let d=K5(o0(e)).map(C=>this._registerQuery(C).observable),r=hf(d);return r=Dh(r.pipe(nl(1)),r.pipe(Py(1),l_(0))),r.pipe(Qn(C=>{let P={matches:!1,breakpoints:{}};return C.forEach(({matches:k,query:X})=>{P.matches=P.matches||k,P.breakpoints[X]=k}),P}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);let a=this._mediaMatcher.matchMedia(e),r={observable:new Fi(C=>{let P=k=>this._zone.run(()=>C.next(k));return a.addListener(P),()=>{a.removeListener(P)}}).pipe(u_(a),Qn(({matches:C})=>({query:e,matches:C})),Ec(this._destroySubject)),mql:a};return this._queries.set(e,r),r}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function K5(i){return i.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}var eU=new Kt("liveAnnouncerElement",{providedIn:"root",factory:tU});function tU(){return null}var nU=new Kt("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),rQ=0,MO=(()=>{class i{_ngZone=Ve(xi);_defaultOptions=Ve(nU,{optional:!0});_liveElement;_document=Ve(si);_previousTimeout;_currentPromise;_currentResolve;constructor(){let e=Ve(eU,{optional:!0});this._liveElement=e||this._createLiveElement()}announce(e,...a){let d=this._defaultOptions,r,C;return a.length===1&&typeof a[0]=="number"?C=a[0]:[r,C]=a,this.clear(),clearTimeout(this._previousTimeout),r||(r=d&&d.politeness?d.politeness:"polite"),C==null&&d&&(C=d.duration),this._liveElement.setAttribute("aria-live",r),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(P=>this._currentResolve=P)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,typeof C=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),C)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let e="cdk-live-announcer-element",a=this._document.getElementsByClassName(e),d=this._document.createElement("div");for(let r=0;r<a.length;r++)a[r].remove();return d.classList.add(e),d.classList.add("cdk-visually-hidden"),d.setAttribute("aria-atomic","true"),d.setAttribute("aria-live","polite"),d.id=`cdk-live-announcer-${rQ++}`,this._document.body.appendChild(d),d}_exposeAnnouncerToModals(e){let a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<a.length;d++){let r=a[d],C=r.getAttribute("aria-owns");C?C.indexOf(e)===-1&&r.setAttribute("aria-owns",C+" "+e):r.setAttribute("aria-owns",e)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Zh=(function(i){return i[i.NONE=0]="NONE",i[i.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",i[i.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",i})(Zh||{}),Q5="cdk-high-contrast-black-on-white",J5="cdk-high-contrast-white-on-black",IO="cdk-high-contrast-active",DO=(()=>{class i{_platform=Ve(ns);_hasCheckedHighContrastMode;_document=Ve(si);_breakpointSubscription;constructor(){this._breakpointSubscription=Ve(Wf).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Zh.NONE;let e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);let a=this._document.defaultView||window,d=a&&a.getComputedStyle?a.getComputedStyle(e):null,r=(d&&d.backgroundColor||"").replace(/ /g,"");switch(e.remove(),r){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Zh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Zh.BLACK_ON_WHITE}return Zh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let e=this._document.body.classList;e.remove(IO,Q5,J5),this._hasCheckedHighContrastMode=!0;let a=this.getHighContrastMode();a===Zh.BLACK_ON_WHITE?e.add(IO,Q5):a===Zh.WHITE_ON_BLACK&&e.add(IO,J5)}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var AO={},ib=(()=>{class i{_appId=Ve(I_);getId(e){return this._appId!=="ng"&&(e+=this._appId),AO.hasOwnProperty(e)||(AO[e]=0),`${e}${AO[e]++}`}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var oQ=new Kt("cdk-dir-doc",{providedIn:"root",factory:sQ});function sQ(){return Ve(si)}var aQ=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function lQ(i){let n=i?.toLowerCase()||"";return n==="auto"&&typeof navigator<"u"&&navigator?.language?aQ.test(navigator.language)?"rtl":"ltr":n==="rtl"?"rtl":"ltr"}var iU=(()=>{class i{get value(){return this.valueSignal()}valueSignal=qs("ltr");change=new Vt;constructor(){let e=Ve(oQ,{optional:!0});if(e){let a=e.body?e.body.dir:null,d=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(lQ(a||d||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Yh=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})();var $l=(()=>{class i{constructor(){Ve(DO)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[Yh,Yh]})}return i})();var cQ=["*"],uQ=new Kt("MAT_ICON_DEFAULT_OPTIONS"),dQ=new Kt("mat-icon-location",{providedIn:"root",factory:hQ});function hQ(){let i=Ve(si),n=i?i.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}var rU=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],pQ=rU.map(i=>`[${i}]`).join(", "),fQ=/^url\(['"]?#(.*?)['"]?\)$/,Ai=(()=>{class i{_elementRef=Ve(pr);_iconRegistry=Ve(j5);_location=Ve(dQ);_errorHandler=Ve(Hs);_defaultColor;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(e){let a=this._cleanupFontValue(e);a!==this._fontSet&&(this._fontSet=a,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(e){let a=this._cleanupFontValue(e);a!==this._fontIcon&&(this._fontIcon=a,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Gr.EMPTY;constructor(){let e=Ve(new z_("aria-hidden"),{optional:!0}),a=Ve(uQ,{optional:!0});a&&(a.color&&(this.color=this._defaultColor=a.color),a.fontSet&&(this.fontSet=a.fontSet)),e||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(e){if(!e)return["",""];let a=e.split(":");switch(a.length){case 1:return["",a[0]];case 2:return a;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let e=this._elementsWithExternalReferences;if(e&&e.size){let a=this._location.getPathname();a!==this._previousPath&&(this._previousPath=a,this._prependPathToReferences(a))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();let a=this._location.getPathname();this._previousPath=a,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(a),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){let e=this._elementRef.nativeElement,a=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();a--;){let d=e.childNodes[a];(d.nodeType!==1||d.nodeName.toLowerCase()==="svg")&&d.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let e=this._elementRef.nativeElement,a=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(d=>d.length>0);this._previousFontSetClass.forEach(d=>e.classList.remove(d)),a.forEach(d=>e.classList.add(d)),this._previousFontSetClass=a,this.fontIcon!==this._previousFontIconClass&&!a.includes("mat-ligature-font")&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return typeof e=="string"?e.trim().split(" ")[0]:e}_prependPathToReferences(e){let a=this._elementsWithExternalReferences;a&&a.forEach((d,r)=>{d.forEach(C=>{r.setAttribute(C.name,`url('${e}#${C.value}')`)})})}_cacheChildrenWithExternalReferences(e){let a=e.querySelectorAll(pQ),d=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let r=0;r<a.length;r++)rU.forEach(C=>{let P=a[r],k=P.getAttribute(C),X=k?k.match(fQ):null;if(X){let oe=d.get(P);oe||(oe=[],d.set(P,oe)),oe.push({name:C,value:X[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){let[a,d]=this._splitIconName(e);a&&(this._svgNamespace=a),d&&(this._svgName=d),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(d,a).pipe(nl(1)).subscribe(r=>this._setSvgElement(r),r=>{let C=`Error retrieving icon ${a}:${d}! ${r.message}`;this._errorHandler.handleError(new Error(C))})}}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(a,d){a&2&&(Ro("data-mat-icon-type",d._usingFontIcon()?"font":"svg")("data-mat-icon-name",d._svgName||d.fontIcon)("data-mat-icon-namespace",d._svgNamespace||d.fontSet)("fontIcon",d._usingFontIcon()?d.fontIcon:null),px(d.color?"mat-"+d.color:""),an("mat-icon-inline",d.inline)("mat-icon-no-color",d.color!=="primary"&&d.color!=="accent"&&d.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Ns],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],ngContentSelectors:cQ,decls:1,vars:0,template:function(a,d){a&1&&(Lf(),Ld(0))},styles:[`mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
`],encapsulation:2,changeDetection:0})}return i})(),Pi=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[$l,$l]})}return i})();var Zf;function oU(){if(Zf==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Zf=!1,Zf;if(document.documentElement?.style&&"scrollBehavior"in document.documentElement.style)Zf=!0;else{let i=Element.prototype.scrollTo;i?Zf=!/\{\s*\[native code\]\s*\}/.test(i.toString()):Zf=!1}}return Zf}function PO(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var sU={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var gQ=new Kt("MATERIAL_ANIMATIONS");var aU=null;function _Q(){return Ve(gQ,{optional:!0})?.animationsDisabled||Ve(ix,{optional:!0})==="NoopAnimations"?"di-disabled":(aU??=Ve(NS).matchMedia("(prefers-reduced-motion)").matches,aU?"reduced-motion":"enabled")}function Yf(){return _Q()!=="enabled"}function Go(i){return i==null?"":typeof i=="string"?i:`${i}px`}var Hl=(function(i){return i[i.FADING_IN=0]="FADING_IN",i[i.VISIBLE=1]="VISIBLE",i[i.FADING_OUT=2]="FADING_OUT",i[i.HIDDEN=3]="HIDDEN",i})(Hl||{}),OO=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Hl.HIDDEN;constructor(n,e,a,d=!1){this._renderer=n,this.element=e,this.config=a,this._animationForciblyDisabledThroughCss=d}fadeOut(){this._renderer.fadeOutRipple(this)}},lU=r0({passive:!0,capture:!0}),RO=class{_events=new Map;addHandler(n,e,a,d){let r=this._events.get(e);if(r){let C=r.get(a);C?C.add(d):r.set(a,new Set([d]))}else this._events.set(e,new Map([[a,new Set([d])]])),n.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,lU)})}removeHandler(n,e,a){let d=this._events.get(n);if(!d)return;let r=d.get(e);r&&(r.delete(a),r.size===0&&d.delete(e),d.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,lU)))}_delegateEventHandler=n=>{let e=za(n);e&&this._events.get(n.type)?.forEach((a,d)=>{(d===e||d.contains(e))&&a.forEach(r=>r.handleEvent(n))})}},rb={enterDuration:225,exitDuration:150},yQ=800,cU=r0({passive:!0,capture:!0}),uU=["mousedown","touchstart"],dU=["mouseup","mouseleave","touchend","touchcancel"],xQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(a,d){},styles:[`.mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}
`],encapsulation:2,changeDetection:0})}return i})(),zS=class i{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new RO;constructor(n,e,a,d,r){this._target=n,this._ngZone=e,this._platform=d,d.isBrowser&&(this._containerElement=ku(a)),r&&r.get(Wh).load(xQ)}fadeInRipple(n,e,a={}){let d=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=Ht(Ht({},rb),a.animation);a.centered&&(n=d.left+d.width/2,e=d.top+d.height/2);let C=a.radius||bQ(n,e,d),P=n-d.left,k=e-d.top,X=r.enterDuration,oe=document.createElement("div");oe.classList.add("mat-ripple-element"),oe.style.left=`${P-C}px`,oe.style.top=`${k-C}px`,oe.style.height=`${C*2}px`,oe.style.width=`${C*2}px`,a.color!=null&&(oe.style.backgroundColor=a.color),oe.style.transitionDuration=`${X}ms`,this._containerElement.appendChild(oe);let Me=window.getComputedStyle(oe),$e=Me.transitionProperty,ke=Me.transitionDuration,ht=$e==="none"||ke==="0s"||ke==="0s, 0s"||d.width===0&&d.height===0,Nt=new OO(this,oe,a,ht);oe.style.transform="scale3d(1, 1, 1)",Nt.state=Hl.FADING_IN,a.persistent||(this._mostRecentTransientRipple=Nt);let Mt=null;return!ht&&(X||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xt=()=>{Mt&&(Mt.fallbackTimer=null),clearTimeout(sr),this._finishRippleTransition(Nt)},Vn=()=>this._destroyRipple(Nt),sr=setTimeout(Vn,X+100);oe.addEventListener("transitionend",Xt),oe.addEventListener("transitioncancel",Vn),Mt={onTransitionEnd:Xt,onTransitionCancel:Vn,fallbackTimer:sr}}),this._activeRipples.set(Nt,Mt),(ht||!X)&&this._finishRippleTransition(Nt),Nt}fadeOutRipple(n){if(n.state===Hl.FADING_OUT||n.state===Hl.HIDDEN)return;let e=n.element,a=Ht(Ht({},rb),n.config.animation);e.style.transitionDuration=`${a.exitDuration}ms`,e.style.opacity="0",n.state=Hl.FADING_OUT,(n._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let e=ku(n);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,uU.forEach(a=>{i._eventManager.addHandler(this._ngZone,a,e,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{dU.forEach(e=>{this._triggerElement.addEventListener(e,this,cU)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===Hl.FADING_IN?this._startFadeOutTransition(n):n.state===Hl.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let e=n===this._mostRecentTransientRipple,{persistent:a}=n.config;n.state=Hl.VISIBLE,!a&&(!e||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let e=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=Hl.HIDDEN,e!==null&&(n.element.removeEventListener("transitionend",e.onTransitionEnd),n.element.removeEventListener("transitioncancel",e.onTransitionCancel),e.fallbackTimer!==null&&clearTimeout(e.fallbackTimer)),n.element.remove()}_onMousedown(n){let e=Jx(n),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+yQ;!this._target.rippleDisabled&&!e&&!a&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!eb(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let e=n.changedTouches;if(e)for(let a=0;a<e.length;a++)this.fadeInRipple(e[a].clientX,e[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let e=n.state===Hl.VISIBLE||n.config.terminateOnPointerUp&&n.state===Hl.FADING_IN;!n.config.persistent&&e&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(uU.forEach(e=>i._eventManager.removeHandler(e,n,this)),this._pointerUpEventsRegistered&&(dU.forEach(e=>n.removeEventListener(e,this,cU)),this._pointerUpEventsRegistered=!1))}};function bQ(i,n,e){let a=Math.max(Math.abs(i-e.left),Math.abs(i-e.right)),d=Math.max(Math.abs(n-e.top),Math.abs(n-e.bottom));return Math.sqrt(a*a+d*d)}var hU=new Kt("mat-ripple-global-options");var wQ={capture:!0},CQ=["focus","mousedown","mouseenter","touchstart"],kO="mat-ripple-loader-uninitialized",FO="mat-ripple-loader-class-name",pU="mat-ripple-loader-centered",BS="mat-ripple-loader-disabled",fU=(()=>{class i{_document=Ve(si);_animationsDisabled=Yf();_globalRippleOptions=Ve(hU,{optional:!0});_platform=Ve(ns);_ngZone=Ve(xi);_injector=Ve(hr);_eventCleanups;_hosts=new Map;constructor(){let e=Ve(xs).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>CQ.map(a=>e.listen(this._document,a,this._onInteraction,wQ)))}ngOnDestroy(){let e=this._hosts.keys();for(let a of e)this.destroyRipple(a);this._eventCleanups.forEach(a=>a())}configureRipple(e,a){e.setAttribute(kO,this._globalRippleOptions?.namespace??""),(a.className||!e.hasAttribute(FO))&&e.setAttribute(FO,a.className||""),a.centered&&e.setAttribute(pU,""),a.disabled&&e.setAttribute(BS,"")}setDisabled(e,a){let d=this._hosts.get(e);d?(d.target.rippleDisabled=a,!a&&!d.hasSetUpEvents&&(d.hasSetUpEvents=!0,d.renderer.setupTriggerEvents(e))):a?e.setAttribute(BS,""):e.removeAttribute(BS)}_onInteraction=e=>{let a=za(e);if(a instanceof HTMLElement){let d=a.closest(`[${kO}="${this._globalRippleOptions?.namespace??""}"]`);d&&this._createRipple(d)}};_createRipple(e){if(!this._document||this._hosts.has(e))return;e.querySelector(".mat-ripple")?.remove();let a=this._document.createElement("span");a.classList.add("mat-ripple",e.getAttribute(FO)),e.append(a);let d=this._globalRippleOptions,r=this._animationsDisabled?0:d?.animation?.enterDuration??rb.enterDuration,C=this._animationsDisabled?0:d?.animation?.exitDuration??rb.exitDuration,P={rippleDisabled:this._animationsDisabled||d?.disabled||e.hasAttribute(BS),rippleConfig:{centered:e.hasAttribute(pU),terminateOnPointerUp:d?.terminateOnPointerUp,animation:{enterDuration:r,exitDuration:C}}},k=new zS(P,this._ngZone,a,this._platform,this._injector),X=!P.rippleDisabled;X&&k.setupTriggerEvents(e),this._hosts.set(e,{target:P,renderer:k,hasSetUpEvents:X}),e.removeAttribute(kO)}destroyRipple(e){let a=this._hosts.get(e);a&&(a.renderer._removeTriggerEvents(),this._hosts.delete(e))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var mU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["structural-styles"]],decls:0,vars:0,template:function(a,d){},styles:[`.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}
`],encapsulation:2,changeDetection:0})}return i})();var EQ=new Kt("MAT_BUTTON_CONFIG");function gU(i){return i==null?void 0:dP(i)}var _U=(()=>{class i{_elementRef=Ve(pr);_ngZone=Ve(xi);_animationsDisabled=Yf();_config=Ve(EQ,{optional:!0});_focusMonitor=Ve(TO);_cleanupClick;_renderer=Ve(Oa);_rippleLoader=Ve(fU);_isAnchor;_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=e,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;tabIndex;set _tabindex(e){this.tabIndex=e}constructor(){Ve(Wh).load(mU);let e=this._elementRef.nativeElement;this._isAnchor=e.tagName==="A",this.disabledInteractive=this._config?.disabledInteractive??!1,this.color=this._config?.color??null,this._rippleLoader?.configureRipple(e,{className:"mat-mdc-button-ripple"})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0),this._isAnchor&&this._setupAsAnchor()}ngOnDestroy(){this._cleanupClick?.(),this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(e="program",a){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,a):this._elementRef.nativeElement.focus(a)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this._isAnchor?this.disabled||null:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}_getTabIndex(){return this._isAnchor?this.disabled&&!this.disabledInteractive?-1:this.tabIndex:this.tabIndex}_setupAsAnchor(){this._cleanupClick=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"click",e=>{this.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}))}static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,hostAttrs:[1,"mat-mdc-button-base"],hostVars:13,hostBindings:function(a,d){a&2&&(Ro("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled())("tabindex",d._getTabIndex()),px(d.color?"mat-"+d.color:""),an("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("mat-unthemed",!d.color)("_mat-animation-noopable",d._animationsDisabled))},inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",Ns],disabled:[2,"disabled","disabled",Ns],ariaDisabled:[2,"aria-disabled","ariaDisabled",Ns],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Ns],tabIndex:[2,"tabIndex","tabIndex",gU],_tabindex:[2,"tabindex","_tabindex",gU]}})}return i})();var vU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[$l,$l]})}return i})();var SQ=["matButton",""],TQ=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],IQ=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var yU=new Map([["text",["mat-mdc-button"]],["filled",["mdc-button--unelevated","mat-mdc-unelevated-button"]],["elevated",["mdc-button--raised","mat-mdc-raised-button"]],["outlined",["mdc-button--outlined","mat-mdc-outlined-button"]],["tonal",["mat-tonal-button"]]]),xU=(()=>{class i extends _U{get appearance(){return this._appearance}set appearance(e){this.setAppearance(e||this._config?.defaultAppearance||"text")}_appearance=null;constructor(){super();let e=MQ(this._elementRef.nativeElement);e&&this.setAppearance(e)}setAppearance(e){if(e===this._appearance)return;let a=this._elementRef.nativeElement.classList,d=this._appearance?yU.get(this._appearance):null,r=yU.get(e);d&&a.remove(...d),a.add(...r),this._appearance=e}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["button","matButton",""],["a","matButton",""],["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""],["a","mat-button",""],["a","mat-raised-button",""],["a","mat-flat-button",""],["a","mat-stroked-button",""]],hostAttrs:[1,"mdc-button"],inputs:{appearance:[0,"matButton","appearance"]},exportAs:["matButton","matAnchor"],features:[bs],attrs:SQ,ngContentSelectors:IQ,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(a,d){a&1&&(Lf(TQ),Ff(0,"span",0),Ld(1),O_(2,"span",1),Ld(3,1),R_(),Ld(4,2),Ff(5,"span",2)(6,"span",3)),a&2&&an("mdc-button__ripple",!d._isFab)("mdc-fab__ripple",d._isFab)},styles:[`.mat-mdc-button-base{text-decoration:none}.mat-mdc-button-base .mat-icon{min-height:fit-content;flex-shrink:0}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-button-text-horizontal-padding, 12px);height:var(--mat-button-text-container-height, 40px);font-family:var(--mat-button-text-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-text-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-text-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-text-label-text-transform);font-weight:var(--mat-button-text-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mat-button-text-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mat-button-text-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-text-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-button-text-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-button-text-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-text-touch-target-size, 48px);display:var(--mat-button-text-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-filled-container-height, 40px);font-family:var(--mat-button-filled-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-filled-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-filled-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-filled-label-text-transform);font-weight:var(--mat-button-filled-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-filled-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-button-filled-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-filled-touch-target-size, 48px);display:var(--mat-button-filled-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mat-button-filled-label-text-color, var(--mat-sys-on-primary));background-color:var(--mat-button-filled-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mat-button-filled-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-filled-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-filled-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mat-button-protected-container-elevation-shadow, var(--mat-sys-level1));height:var(--mat-button-protected-container-height, 40px);font-family:var(--mat-button-protected-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-protected-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-protected-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-protected-label-text-transform);font-weight:var(--mat-button-protected-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-protected-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-button-protected-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-protected-touch-target-size, 48px);display:var(--mat-button-protected-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-raised-button:not(:disabled){color:var(--mat-button-protected-label-text-color, var(--mat-sys-primary));background-color:var(--mat-button-protected-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mat-button-protected-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mat-button-protected-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mat-button-protected-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mat-button-protected-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-protected-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-protected-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mat-button-protected-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-outlined-container-height, 40px);font-family:var(--mat-button-outlined-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-outlined-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-outlined-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-outlined-label-text-transform);font-weight:var(--mat-button-outlined-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mat-button-outlined-container-shape, var(--mat-sys-corner-full));border-width:var(--mat-button-outlined-outline-width, 1px);padding:0 var(--mat-button-outlined-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-button-outlined-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-outlined-touch-target-size, 48px);display:var(--mat-button-outlined-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-outlined-button:not(:disabled){color:var(--mat-button-outlined-label-text-color, var(--mat-sys-primary));border-color:var(--mat-button-outlined-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-outlined-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mat-button-outlined-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-tonal-container-height, 40px);font-family:var(--mat-button-tonal-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-tonal-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-tonal-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-tonal-label-text-transform);font-weight:var(--mat-button-tonal-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-tonal-horizontal-padding, 24px)}.mat-tonal-button:not(:disabled){color:var(--mat-button-tonal-label-text-color, var(--mat-sys-on-secondary-container));background-color:var(--mat-button-tonal-container-color, var(--mat-sys-secondary-container))}.mat-tonal-button,.mat-tonal-button .mdc-button__ripple{border-radius:var(--mat-button-tonal-container-shape, var(--mat-sys-corner-full))}.mat-tonal-button[disabled],.mat-tonal-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-tonal-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-tonal-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-tonal-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}[dir=rtl] .mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}.mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}[dir=rtl] .mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}.mat-tonal-button .mat-ripple-element{background-color:var(--mat-button-tonal-ripple-color, color-mix(in srgb, var(--mat-sys-on-secondary-container) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-tonal-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-tonal-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-tonal-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-tonal-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-tonal-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-tonal-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-tonal-touch-target-size, 48px);display:var(--mat-button-tonal-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button,.mat-tonal-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon,.mat-tonal-button .mdc-button__label,.mat-tonal-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator,.mat-tonal-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before,.mat-tonal-button:focus>.mat-focus-indicator::before{content:"";border-radius:inherit}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable,.mat-tonal-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon,.mat-tonal-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-tonal-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}
`,`@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-button-base.mat-tonal-button,.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}
`],encapsulation:2,changeDetection:0})}return i})();function MQ(i){return i.hasAttribute("mat-raised-button")?"elevated":i.hasAttribute("mat-stroked-button")?"outlined":i.hasAttribute("mat-flat-button")?"filled":i.hasAttribute("mat-button")?"text":null}var bU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[$l,vU,$l]})}return i})();var ob=class{_attachedHost;attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;n!=null&&(this._attachedHost=null,n.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(n){this._attachedHost=n}},s0=class extends ob{component;viewContainerRef;injector;projectableNodes;constructor(n,e,a,d){super(),this.component=n,this.viewContainerRef=e,this.injector=a,this.projectableNodes=d}},a0=class extends ob{templateRef;viewContainerRef;context;injector;constructor(n,e,a,d){super(),this.templateRef=n,this.viewContainerRef=e,this.context=a,this.injector=d}get origin(){return this.templateRef.elementRef}attach(n,e=this.context){return this.context=e,super.attach(n)}detach(){return this.context=void 0,super.detach()}},LO=class extends ob{element;constructor(n){super(),this.element=n instanceof pr?n.nativeElement:n}},l0=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(n){if(n instanceof s0)return this._attachedPortal=n,this.attachComponentPortal(n);if(n instanceof a0)return this._attachedPortal=n,this.attachTemplatePortal(n);if(this.attachDomPortal&&n instanceof LO)return this._attachedPortal=n,this.attachDomPortal(n)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},VS=class extends l0{outletElement;_appRef;_defaultInjector;constructor(n,e,a){super(),this.outletElement=n,this._appRef=e,this._defaultInjector=a}attachComponentPortal(n){let e;if(n.viewContainerRef){let a=n.injector||n.viewContainerRef.injector,d=a.get(Iu,null,{optional:!0})||void 0;e=n.viewContainerRef.createComponent(n.component,{index:n.viewContainerRef.length,injector:a,ngModuleRef:d,projectableNodes:n.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else{let a=this._appRef,d=n.injector||this._defaultInjector||hr.NULL,r=d.get(Yr,a.injector);e=LE(n.component,{elementInjector:d,environmentInjector:r,projectableNodes:n.projectableNodes||void 0}),a.attachView(e.hostView),this.setDisposeFn(()=>{a.viewCount>0&&a.detachView(e.hostView),e.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=n,e}attachTemplatePortal(n){let e=n.viewContainerRef,a=e.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return a.rootNodes.forEach(d=>this.outletElement.appendChild(d)),a.detectChanges(),this.setDisposeFn(()=>{let d=e.indexOf(a);d!==-1&&e.remove(d)}),this._attachedPortal=n,a}attachDomPortal=n=>{let e=n.element;e.parentNode;let a=this.outletElement.ownerDocument.createComment("dom-portal");e.parentNode.insertBefore(a,e),this.outletElement.appendChild(e),this._attachedPortal=n,super.setDisposeFn(()=>{a.parentNode&&a.parentNode.replaceChild(e,a)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}};var NO=(()=>{class i extends l0{_moduleRef=Ve(Iu,{optional:!0});_document=Ve(si);_viewContainerRef=Ve(ol);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new Vt;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);let a=e.viewContainerRef!=null?e.viewContainerRef:this._viewContainerRef,d=a.createComponent(e.component,{index:a.length,injector:e.injector||a.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return a!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);let a=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=a,this.attached.emit(a),a}attachDomPortal=e=>{let a=e.element;a.parentNode;let d=this._document.createComment("dom-portal");e.setAttachedHost(this),a.parentNode.insertBefore(d,a),this._getRootNode().appendChild(a),this._attachedPortal=e,super.setDisposeFn(()=>{d.parentNode&&d.parentNode.replaceChild(a,d)})};_getRootNode(){let e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[bs]})}return i})();var US=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})();var DQ=20,zO=(()=>{class i{_ngZone=Ve(xi);_platform=Ve(ns);_renderer=Ve(xs).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new li;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let a=this.scrollContainers.get(e);a&&(a.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=DQ){return this._platform.isBrowser?new Fi(a=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let d=e>0?this._scrolled.pipe(gC(e)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{d.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Dn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(e,a){let d=this.getAncestorScrollContainers(e);return this.scrolled(a).pipe(Ao(r=>!r||d.indexOf(r)>-1))}getAncestorScrollContainers(e){let a=[];return this.scrollContainers.forEach((d,r)=>{this._scrollableContainsElement(r,e)&&a.push(r)}),a}_scrollableContainsElement(e,a){let d=ku(a),r=e.getElementRef().nativeElement;do if(d==r)return!0;while(d=d.parentElement);return!1}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var AQ=20,sb=(()=>{class i{_platform=Ve(ns);_listeners;_viewportSize;_change=new li;_document=Ve(si);constructor(){let e=Ve(xi),a=Ve(xs).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let d=r=>this._change.next(r);this._listeners=[a.listen("window","resize",d),a.listen("window","orientationchange",d)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:a,height:d}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+d,right:e.left+a,height:d,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,a=this._getWindow(),d=e.documentElement,r=d.getBoundingClientRect(),C=-r.top||e.body.scrollTop||a.scrollY||d.scrollTop||0,P=-r.left||e.body.scrollLeft||a.scrollX||d.scrollLeft||0;return{top:C,left:P}}change(e=AQ){return e>0?this._change.pipe(gC(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var wU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})(),BO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[Yh,wU,Yh,wU]})}return i})();var CU=oU();function AU(i){return new jS(i.get(sb),i.get(si))}var jS=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(n,e){this._viewportRuler=n,this._document=e}attach(){}enable(){if(this._canBeEnabled()){let n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Go(-this._previousScrollPosition.left),n.style.top=Go(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let n=this._document.documentElement,e=this._document.body,a=n.style,d=e.style,r=a.scrollBehavior||"",C=d.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),CU&&(a.scrollBehavior=d.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),CU&&(a.scrollBehavior=r,d.scrollBehavior=C)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let e=this._document.documentElement,a=this._viewportRuler.getViewportSize();return e.scrollHeight>a.height||e.scrollWidth>a.width}};function PU(i,n){return new $S(i.get(zO),i.get(xi),i.get(sb),n)}var $S=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(n,e,a,d){this._scrollDispatcher=n,this._ngZone=e,this._viewportRuler=a,this._config=d}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(this._scrollSubscription)return;let n=this._scrollDispatcher.scrolled(0).pipe(Ao(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{let e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}};var ab=class{enable(){}disable(){}attach(){}};function VO(i,n){return n.some(e=>{let a=i.bottom<e.top,d=i.top>e.bottom,r=i.right<e.left,C=i.left>e.right;return a||d||r||C})}function EU(i,n){return n.some(e=>{let a=i.top<e.top,d=i.bottom>e.bottom,r=i.left<e.left,C=i.right>e.right;return a||d||r||C})}function YS(i,n){return new HS(i.get(zO),i.get(sb),i.get(xi),n)}var HS=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(n,e,a,d){this._scrollDispatcher=n,this._viewportRuler=e,this._ngZone=a,this._config=d}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(!this._scrollSubscription){let n=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(n).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:d}=this._viewportRuler.getViewportSize();VO(e,[{width:a,height:d,bottom:d,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},OU=(()=>{class i{_injector=Ve(hr);constructor(){}noop=()=>new ab;close=e=>PU(this._injector,e);block=()=>AU(this._injector);reposition=e=>YS(this._injector,e);static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),c0=class{positionStrategy;scrollStrategy=new ab;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(n){if(n){let e=Object.keys(n);for(let a of e)n[a]!==void 0&&(this[a]=n[a])}}};var GS=class{connectionPair;scrollableViewProperties;constructor(n,e){this.connectionPair=n,this.scrollableViewProperties=e}};var RU=(()=>{class i{_attachedOverlays=[];_document=Ve(si);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){let a=this._attachedOverlays.indexOf(e);a>-1&&this._attachedOverlays.splice(a,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),kU=(()=>{class i extends RU{_ngZone=Ve(xi);_renderer=Ve(xs).createRenderer(null,null);_cleanupKeydown;add(e){super.add(e),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=e=>{let a=this._attachedOverlays;for(let d=a.length-1;d>-1;d--)if(a[d]._keydownEvents.observers.length>0){this._ngZone.run(()=>a[d]._keydownEvents.next(e));break}};static \u0275fac=(()=>{let e;return function(d){return(e||(e=Mu(i)))(d||i)}})();static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),FU=(()=>{class i extends RU{_platform=Ve(ns);_ngZone=Ve(xi);_renderer=Ve(xs).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(e){if(super.add(e),!this._isAttached){let a=this._document.body,d={capture:!0},r=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[r.listen(a,"pointerdown",this._pointerDownListener,d),r.listen(a,"click",this._clickListener,d),r.listen(a,"auxclick",this._clickListener,d),r.listen(a,"contextmenu",this._clickListener,d)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(e=>e()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=e=>{this._pointerDownEventTarget=za(e)};_clickListener=e=>{let a=za(e),d=e.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;let r=this._attachedOverlays.slice();for(let C=r.length-1;C>-1;C--){let P=r[C];if(P._outsidePointerEvents.observers.length<1||!P.hasAttached())continue;if(SU(P.overlayElement,a)||SU(P.overlayElement,d))break;let k=P._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(e)):k.next(e)}};static \u0275fac=(()=>{let e;return function(d){return(e||(e=Mu(i)))(d||i)}})();static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function SU(i,n){let e=typeof ShadowRoot<"u"&&ShadowRoot,a=n;for(;a;){if(a===i)return!0;a=e&&a instanceof ShadowRoot?a.host:a.parentNode}return!1}var LU=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(a,d){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}
`],encapsulation:2,changeDetection:0})}return i})(),NU=(()=>{class i{_platform=Ve(ns);_containerElement;_document=Ve(si);_styleLoader=Ve(Wh);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let e="cdk-overlay-container";if(this._platform.isBrowser||PO()){let d=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let r=0;r<d.length;r++)d[r].remove()}let a=this._document.createElement("div");a.classList.add(e),PO()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}_loadStyles(){this._styleLoader.load(LU)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),UO=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(n,e,a,d){this._renderer=e,this._ngZone=a,this.element=n.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=e.listen(this.element,"click",d)}detach(){this._ngZone.runOutsideAngular(()=>{let n=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(n,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),n.style.pointerEvents="none",n.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},qS=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new li;_attachments=new li;_detachments=new li;_positionStrategy;_scrollStrategy;_locationChanges=Gr.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_previousHostParent;_keydownEvents=new li;_outsidePointerEvents=new li;_afterNextRenderRef;constructor(n,e,a,d,r,C,P,k,X,oe=!1,Me,$e){this._portalOutlet=n,this._host=e,this._pane=a,this._config=d,this._ngZone=r,this._keyboardDispatcher=C,this._document=P,this._location=k,this._outsideClickDispatcher=X,this._animationsDisabled=oe,this._injector=Me,this._renderer=$e,d.scrollStrategy&&(this._scrollStrategy=d.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=d.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let e=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=zl(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof e?.onDestroy=="function"&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let n=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){let n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,n&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config=Ht(Ht({},this._config),n),this._updateElementSize()}setDirection(n){this._config=Ci(Ht({},this._config),{direction:n}),this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){let n=this._config.direction;return n?typeof n=="string"?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let n=this._pane.style;n.width=Go(this._config.width),n.height=Go(this._config.height),n.minWidth=Go(this._config.minWidth),n.minHeight=Go(this._config.minHeight),n.maxWidth=Go(this._config.maxWidth),n.maxHeight=Go(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){let n="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new UO(this._document,this._renderer,this._ngZone,e=>{this._backdropClick.next(e)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(n))}):this._backdropRef.element.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(n,e,a){let d=o0(e||[]).filter(r=>!!r);d.length&&(a?n.classList.add(...d):n.classList.remove(...d))}_detachContentWhenEmpty(){let n=!1;try{this._detachContentAfterRenderRef=zl(()=>{n=!0,this._detachContent()},{injector:this._injector})}catch(e){if(n)throw e;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let n=this._scrollStrategy;n?.disable(),n?.detach?.()}},TU="cdk-overlay-connected-position-bounding-box",PQ=/([A-Za-z%]+)$/;function zU(i,n){return new WS(n,i.get(sb),i.get(si),i.get(ns),i.get(NU))}var WS=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new li;_resizeSubscription=Gr.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(n,e,a,d,r){this._viewportRuler=e,this._document=a,this._platform=d,this._overlayContainer=r,this.setOrigin(n)}attach(n){this._overlayRef&&this._overlayRef,this._validatePositions(),n.hostElement.classList.add(TU),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let n=this._originRect,e=this._overlayRect,a=this._viewportRect,d=this._containerRect,r=[],C;for(let P of this._preferredPositions){let k=this._getOriginPoint(n,d,P),X=this._getOverlayPoint(k,e,P),oe=this._getOverlayFit(X,e,a,P);if(oe.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(P,k);return}if(this._canFitWithFlexibleDimensions(oe,X,a)){r.push({position:P,origin:k,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(k,P)});continue}(!C||C.overlayFit.visibleArea<oe.visibleArea)&&(C={overlayFit:oe,overlayPoint:X,originPoint:k,position:P,overlayRect:e})}if(r.length){let P=null,k=-1;for(let X of r){let oe=X.boundingBoxRect.width*X.boundingBoxRect.height*(X.position.weight||1);oe>k&&(k=oe,P=X)}this._isPushed=!1,this._applyPosition(P.position,P.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(C.position,C.originPoint);return}this._applyPosition(C.position,C.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Xf(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(TU),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,e)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,n.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,e,a){let d;if(a.originX=="center")d=n.left+n.width/2;else{let C=this._isRtl()?n.right:n.left,P=this._isRtl()?n.left:n.right;d=a.originX=="start"?C:P}e.left<0&&(d-=e.left);let r;return a.originY=="center"?r=n.top+n.height/2:r=a.originY=="top"?n.top:n.bottom,e.top<0&&(r-=e.top),{x:d,y:r}}_getOverlayPoint(n,e,a){let d;a.overlayX=="center"?d=-e.width/2:a.overlayX==="start"?d=this._isRtl()?-e.width:0:d=this._isRtl()?0:-e.width;let r;return a.overlayY=="center"?r=-e.height/2:r=a.overlayY=="top"?0:-e.height,{x:n.x+d,y:n.y+r}}_getOverlayFit(n,e,a,d){let r=MU(e),{x:C,y:P}=n,k=this._getOffset(d,"x"),X=this._getOffset(d,"y");k&&(C+=k),X&&(P+=X);let oe=0-C,Me=C+r.width-a.width,$e=0-P,ke=P+r.height-a.height,ht=this._subtractOverflows(r.width,oe,Me),Nt=this._subtractOverflows(r.height,$e,ke),Mt=ht*Nt;return{visibleArea:Mt,isCompletelyWithinViewport:r.width*r.height===Mt,fitsInViewportVertically:Nt===r.height,fitsInViewportHorizontally:ht==r.width}}_canFitWithFlexibleDimensions(n,e,a){if(this._hasFlexibleDimensions){let d=a.bottom-e.y,r=a.right-e.x,C=IU(this._overlayRef.getConfig().minHeight),P=IU(this._overlayRef.getConfig().minWidth),k=n.fitsInViewportVertically||C!=null&&C<=d,X=n.fitsInViewportHorizontally||P!=null&&P<=r;return k&&X}return!1}_pushOverlayOnScreen(n,e,a){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};let d=MU(e),r=this._viewportRect,C=Math.max(n.x+d.width-r.width,0),P=Math.max(n.y+d.height-r.height,0),k=Math.max(r.top-a.top-n.y,0),X=Math.max(r.left-a.left-n.x,0),oe=0,Me=0;return d.width<=r.width?oe=X||-C:oe=n.x<this._viewportMargin?r.left-a.left-n.x:0,d.height<=r.height?Me=k||-P:Me=n.y<this._viewportMargin?r.top-a.top-n.y:0,this._previousPushAmount={x:oe,y:Me},{x:n.x+oe,y:n.y+Me}}_applyPosition(n,e){if(this._setTransformOrigin(n),this._setOverlayElementStyles(e,n),this._setBoundingBoxStyles(e,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){let a=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!OQ(this._lastScrollVisibility,a)){let d=new GS(n,a);this._positionChanges.next(d)}this._lastScrollVisibility=a}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;let e=this._boundingBox.querySelectorAll(this._transformOriginSelector),a,d=n.overlayY;n.overlayX==="center"?a="center":this._isRtl()?a=n.overlayX==="start"?"right":"left":a=n.overlayX==="start"?"left":"right";for(let r=0;r<e.length;r++)e[r].style.transformOrigin=`${a} ${d}`}_calculateBoundingBoxRect(n,e){let a=this._viewportRect,d=this._isRtl(),r,C,P;if(e.overlayY==="top")C=n.y,r=a.height-C+this._viewportMargin;else if(e.overlayY==="bottom")P=a.height-n.y+this._viewportMargin*2,r=a.height-P+this._viewportMargin;else{let ke=Math.min(a.bottom-n.y+a.top,n.y),ht=this._lastBoundingBoxSize.height;r=ke*2,C=n.y-ke,r>ht&&!this._isInitialRender&&!this._growAfterOpen&&(C=n.y-ht/2)}let k=e.overlayX==="start"&&!d||e.overlayX==="end"&&d,X=e.overlayX==="end"&&!d||e.overlayX==="start"&&d,oe,Me,$e;if(X)$e=a.width-n.x+this._viewportMargin*2,oe=n.x-this._viewportMargin;else if(k)Me=n.x,oe=a.right-n.x;else{let ke=Math.min(a.right-n.x+a.left,n.x),ht=this._lastBoundingBoxSize.width;oe=ke*2,Me=n.x-ke,oe>ht&&!this._isInitialRender&&!this._growAfterOpen&&(Me=n.x-ht/2)}return{top:C,left:Me,bottom:P,right:$e,width:oe,height:r}}_setBoundingBoxStyles(n,e){let a=this._calculateBoundingBoxRect(n,e);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));let d={};if(this._hasExactPosition())d.top=d.left="0",d.bottom=d.right=d.maxHeight=d.maxWidth="",d.width=d.height="100%";else{let r=this._overlayRef.getConfig().maxHeight,C=this._overlayRef.getConfig().maxWidth;d.height=Go(a.height),d.top=Go(a.top),d.bottom=Go(a.bottom),d.width=Go(a.width),d.left=Go(a.left),d.right=Go(a.right),e.overlayX==="center"?d.alignItems="center":d.alignItems=e.overlayX==="end"?"flex-end":"flex-start",e.overlayY==="center"?d.justifyContent="center":d.justifyContent=e.overlayY==="bottom"?"flex-end":"flex-start",r&&(d.maxHeight=Go(r)),C&&(d.maxWidth=Go(C))}this._lastBoundingBoxSize=a,Xf(this._boundingBox.style,d)}_resetBoundingBoxStyles(){Xf(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Xf(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,e){let a={},d=this._hasExactPosition(),r=this._hasFlexibleDimensions,C=this._overlayRef.getConfig();if(d){let oe=this._viewportRuler.getViewportScrollPosition();Xf(a,this._getExactOverlayY(e,n,oe)),Xf(a,this._getExactOverlayX(e,n,oe))}else a.position="static";let P="",k=this._getOffset(e,"x"),X=this._getOffset(e,"y");k&&(P+=`translateX(${k}px) `),X&&(P+=`translateY(${X}px)`),a.transform=P.trim(),C.maxHeight&&(d?a.maxHeight=Go(C.maxHeight):r&&(a.maxHeight="")),C.maxWidth&&(d?a.maxWidth=Go(C.maxWidth):r&&(a.maxWidth="")),Xf(this._pane.style,a)}_getExactOverlayY(n,e,a){let d={top:"",bottom:""},r=this._getOverlayPoint(e,this._overlayRect,n);if(this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,a)),n.overlayY==="bottom"){let C=this._document.documentElement.clientHeight;d.bottom=`${C-(r.y+this._overlayRect.height)}px`}else d.top=Go(r.y);return d}_getExactOverlayX(n,e,a){let d={left:"",right:""},r=this._getOverlayPoint(e,this._overlayRect,n);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,a));let C;if(this._isRtl()?C=n.overlayX==="end"?"left":"right":C=n.overlayX==="end"?"right":"left",C==="right"){let P=this._document.documentElement.clientWidth;d.right=`${P-(r.x+this._overlayRect.width)}px`}else d.left=Go(r.x);return d}_getScrollVisibility(){let n=this._getOriginRect(),e=this._pane.getBoundingClientRect(),a=this._scrollables.map(d=>d.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:EU(n,a),isOriginOutsideView:VO(n,a),isOverlayClipped:EU(e,a),isOverlayOutsideView:VO(e,a)}}_subtractOverflows(n,...e){return e.reduce((a,d)=>a-Math.max(d,0),n)}_getNarrowedViewportRect(){let n=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+n-this._viewportMargin,bottom:a.top+e-this._viewportMargin,width:n-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,e){return e==="x"?n.offsetX==null?this._offsetX:n.offsetX:n.offsetY==null?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&o0(n).forEach(e=>{e!==""&&this._appliedPanelClasses.indexOf(e)===-1&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){let n=this._origin;if(n instanceof pr)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();let e=n.width||0,a=n.height||0;return{top:n.y,bottom:n.y+a,left:n.x,right:n.x+e,height:a,width:e}}};function Xf(i,n){for(let e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i}function IU(i){if(typeof i!="number"&&i!=null){let[n,e]=i.split(PQ);return!e||e==="px"?parseFloat(n):null}return i||null}function MU(i){return{top:Math.floor(i.top),right:Math.floor(i.right),bottom:Math.floor(i.bottom),left:Math.floor(i.left),width:Math.floor(i.width),height:Math.floor(i.height)}}function OQ(i,n){return i===n?!0:i.isOriginClipped===n.isOriginClipped&&i.isOriginOutsideView===n.isOriginOutsideView&&i.isOverlayClipped===n.isOverlayClipped&&i.isOverlayOutsideView===n.isOverlayOutsideView}var DU="cdk-global-overlay-wrapper";function XS(i){return new ZS}var ZS=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(n){let e=n.getConfig();this._overlayRef=n,this._width&&!e.width&&n.updateSize({width:this._width}),this._height&&!e.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(DU),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:d,height:r,maxWidth:C,maxHeight:P}=a,k=(d==="100%"||d==="100vw")&&(!C||C==="100%"||C==="100vw"),X=(r==="100%"||r==="100vh")&&(!P||P==="100%"||P==="100vh"),oe=this._xPosition,Me=this._xOffset,$e=this._overlayRef.getConfig().direction==="rtl",ke="",ht="",Nt="";k?Nt="flex-start":oe==="center"?(Nt="center",$e?ht=Me:ke=Me):$e?oe==="left"||oe==="end"?(Nt="flex-end",ke=Me):(oe==="right"||oe==="start")&&(Nt="flex-start",ht=Me):oe==="left"||oe==="start"?(Nt="flex-start",ke=Me):(oe==="right"||oe==="end")&&(Nt="flex-end",ht=Me),n.position=this._cssPosition,n.marginLeft=k?"0":ke,n.marginTop=X?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=k?"0":ht,e.justifyContent=Nt,e.alignItems=X?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,a=e.style;e.classList.remove(DU),a.justifyContent=a.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}},BU=(()=>{class i{_injector=Ve(hr);constructor(){}global(){return XS()}flexibleConnectedTo(e){return zU(this._injector,e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function KS(i,n){i.get(Wh).load(LU);let e=i.get(NU),a=i.get(si),d=i.get(ib),r=i.get(Ra),C=i.get(iU),P=a.createElement("div"),k=a.createElement("div");k.id=d.getId("cdk-overlay-"),k.classList.add("cdk-overlay-pane"),P.appendChild(k),e.getContainerElement().appendChild(P);let X=new VS(k,r,i),oe=new c0(n),Me=i.get(Oa,null,{optional:!0})||i.get(xs).createRenderer(null,null);return oe.direction=oe.direction||C.value,new qS(X,P,k,oe,i.get(xi),i.get(kU),a,i.get(Du),i.get(FU),n?.disableAnimations??i.get(ix,null,{optional:!0})==="NoopAnimations",i.get(Yr),Me)}var VU=(()=>{class i{scrollStrategies=Ve(OU);_positionBuilder=Ve(BU);_injector=Ve(hr);constructor(){}create(e){return KS(this._injector,e)}position(){return this._positionBuilder}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var RQ=new Kt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let i=Ve(hr);return()=>YS(i)}});function kQ(i){let n=Ve(hr);return()=>YS(n)}var FQ={provide:RQ,useFactory:kQ},jO=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({providers:[VU,FQ],imports:[Yh,US,BO,BO]})}return i})();function LQ(i,n){if(i&1){let e=wt();z(0,"div",1)(1,"button",2),Te("click",function(){Ee(e);let d=te();return Se(d.action())}),W(2),V()()}if(i&2){let e=te();K(2),bi(" ",e.data.action," ")}}var NQ=["label"];function zQ(i,n){}var BQ=Math.pow(2,31)-1,lb=class{_overlayRef;instance;containerInstance;_afterDismissed=new li;_afterOpened=new li;_onAction=new li;_durationTimeoutId;_dismissedByAction=!1;constructor(n,e){this._overlayRef=e,this.containerInstance=n,n._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(n){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(n,BQ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},UU=new Kt("MatSnackBarData"),u0=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},VQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return i})(),UQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return i})(),jQ=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return i})(),jU=(()=>{class i{snackBarRef=Ve(lb);data=Ve(UU);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(a,d){a&1&&(z(0,"div",0),W(1),V(),Je(2,LQ,3,1,"div",1)),a&2&&(K(),bi(" ",d.data.message,`
`),K(),et(d.hasAction?2:-1))},dependencies:[xU,VQ,UQ,jQ],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return i})(),$O="_mat-snack-bar-enter",HO="_mat-snack-bar-exit",$Q=(()=>{class i extends l0{_ngZone=Ve(xi);_elementRef=Ve(pr);_changeDetectorRef=Ve(Oc);_platform=Ve(ns);_animationsDisabled=Yf();snackBarConfig=Ve(u0);_document=Ve(si);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=Ve(hr);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new li;_onExit=new li;_onEnter=new li;_animationState="void";_live;_label;_role;_liveElementId=Ve(ib).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let a=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),a}attachTemplatePortal(e){this._assertNotAttached();let a=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),a}attachDomPortal=e=>{this._assertNotAttached();let a=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),a};onAnimationEnd(e){e===HO?this._completeExit():e===$O&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?zl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd($O)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd($O)},200)))}exit(){return this._destroyed?Dn(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?zl(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(HO)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(HO),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,a=this.snackBarConfig.panelClass;a&&(Array.isArray(a)?a.forEach(C=>e.classList.add(C)):e.classList.add(a)),this._exposeToModals();let d=this._label.nativeElement,r="mdc-snackbar__label";d.classList.toggle(r,!d.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<a.length;d++){let r=a[d],C=r.getAttribute("aria-owns");this._trackedModals.add(r),C?C.indexOf(e)===-1&&r.setAttribute("aria-owns",C+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let a=e.getAttribute("aria-owns");if(a){let d=a.replace(this._liveElementId,"").trim();d.length>0?e.setAttribute("aria-owns",d):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,a=e.querySelector("[aria-hidden]"),d=e.querySelector("[aria-live]");if(a&&d){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&a.contains(document.activeElement)&&(r=document.activeElement),a.removeAttribute("aria-hidden"),d.appendChild(a),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=vn({type:i,selectors:[["mat-snack-bar-container"]],viewQuery:function(a,d){if(a&1&&(Fa(NO,7),Fa(NQ,7)),a&2){let r;fa(r=ma())&&(d._portalOutlet=r.first),fa(r=ma())&&(d._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(a,d){a&1&&Te("animationend",function(C){return d.onAnimationEnd(C.animationName)})("animationcancel",function(C){return d.onAnimationEnd(C.animationName)}),a&2&&an("mat-snack-bar-container-enter",d._animationState==="visible")("mat-snack-bar-container-exit",d._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!d._animationsDisabled)},features:[bs],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(a,d){a&1&&(z(0,"div",1)(1,"div",2,0)(3,"div",3),$i(4,zQ,0,0,"ng-template",4),V(),An(5,"div"),V()()),a&2&&(K(5),Ro("aria-live",d._live)("role",d._role)("id",d._liveElementId))},dependencies:[NO],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return i})();function HQ(){return new u0}var GQ=new Kt("mat-snack-bar-default-options",{providedIn:"root",factory:HQ}),zc=(()=>{class i{_live=Ve(MO);_injector=Ve(hr);_breakpointObserver=Ve(Wf);_parentSnackBar=Ve(i,{optional:!0,skipSelf:!0});_defaultConfig=Ve(GQ);_animationsDisabled=Yf();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=jU;snackBarContainerComponent=$Q;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,a){return this._attach(e,a)}openFromTemplate(e,a){return this._attach(e,a)}open(e,a="",d){let r=Ht(Ht({},this._defaultConfig),d);return r.data={message:e,action:a},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,a){let d=a&&a.viewContainerRef&&a.viewContainerRef.injector,r=hr.create({parent:d||this._injector,providers:[{provide:u0,useValue:a}]}),C=new s0(this.snackBarContainerComponent,a.viewContainerRef,r),P=e.attach(C);return P.instance.snackBarConfig=a,P.instance}_attach(e,a){let d=Ht(Ht(Ht({},new u0),this._defaultConfig),a),r=this._createOverlay(d),C=this._attachSnackBarContainer(r,d),P=new lb(C,r);if(e instanceof rl){let k=new a0(e,null,{$implicit:d.data,snackBarRef:P});P.instance=C.attachTemplatePortal(k)}else{let k=this._createInjector(d,P),X=new s0(e,void 0,k),oe=C.attachComponentPortal(X);P.instance=oe.instance}return this._breakpointObserver.observe(sU.HandsetPortrait).pipe(Ec(r.detachments())).subscribe(k=>{r.overlayElement.classList.toggle(this.handsetCssClass,k.matches)}),d.announcementMessage&&C._onAnnounce.subscribe(()=>{this._live.announce(d.announcementMessage,d.politeness)}),this._animateSnackBar(P,d),this._openedSnackBarRef=P,this._openedSnackBarRef}_animateSnackBar(e,a){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),a.announcementMessage&&this._live.clear()}),a.duration&&a.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(a.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let a=new c0;a.direction=e.direction;let d=XS(this._injector),r=e.direction==="rtl",C=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,P=!C&&e.horizontalPosition!=="center";return C?d.left("0"):P?d.right("0"):d.centerHorizontally(),e.verticalPosition==="top"?d.top("0"):d.bottom("0"),a.positionStrategy=d,a.disableAnimations=this._animationsDisabled,KS(this._injector,a)}_createInjector(e,a){let d=e&&e.viewContainerRef&&e.viewContainerRef.injector;return hr.create({parent:d||this._injector,providers:[{provide:lb,useValue:a},{provide:UU,useValue:e.data}]})}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Fu=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({providers:[zc],imports:[jO,US,bU,$l,jU,$l]})}return i})();var XU=(()=>{class i{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,a){this._renderer=e,this._elementRef=a}setProperty(e,a){this._renderer.setProperty(this._elementRef.nativeElement,e,a)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(a){return new(a||i)(Dt(Oa),Dt(pr))};static \u0275dir=yr({type:i})}return i})(),qQ=(()=>{class i extends XU{static \u0275fac=(()=>{let e;return function(d){return(e||(e=Mu(i)))(d||i)}})();static \u0275dir=yr({type:i,features:[bs]})}return i})(),YO=new Kt("");var WQ={provide:YO,useExisting:gu(()=>Cs),multi:!0};function ZQ(){let i=Vl()?Vl().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var YQ=new Kt(""),Cs=(()=>{class i extends XU{_compositionMode;_composing=!1;constructor(e,a,d){super(e,a),this._compositionMode=d,this._compositionMode==null&&(this._compositionMode=!ZQ())}writeValue(e){let a=e??"";this.setProperty("value",a)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(a){return new(a||i)(Dt(Oa),Dt(pr),Dt(YQ,8))};static \u0275dir=yr({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(a,d){a&1&&Te("input",function(C){return d._handleInput(C.target.value)})("blur",function(){return d.onTouched()})("compositionstart",function(){return d._compositionStart()})("compositionend",function(C){return d._compositionEnd(C.target.value)})},standalone:!1,features:[Nd([WQ]),bs]})}return i})();function XO(i){return i==null||KO(i)===0}function KO(i){return i==null?null:Array.isArray(i)||typeof i=="string"?i.length:i instanceof Set?i.size:null}var QO=new Kt(""),JO=new Kt(""),XQ=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Lu=class{static min(n){return KQ(n)}static max(n){return QQ(n)}static required(n){return JQ(n)}static requiredTrue(n){return eJ(n)}static email(n){return tJ(n)}static minLength(n){return nJ(n)}static maxLength(n){return iJ(n)}static pattern(n){return rJ(n)}static nullValidator(n){return KU()}static compose(n){return ij(n)}static composeAsync(n){return oj(n)}};function KQ(i){return n=>{if(n.value==null||i==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e<i?{min:{min:i,actual:n.value}}:null}}function QQ(i){return n=>{if(n.value==null||i==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e>i?{max:{max:i,actual:n.value}}:null}}function JQ(i){return XO(i.value)?{required:!0}:null}function eJ(i){return i.value===!0?null:{required:!0}}function tJ(i){return XO(i.value)||XQ.test(i.value)?null:{email:!0}}function nJ(i){return n=>{let e=n.value?.length??KO(n.value);return e===null||e===0?null:e<i?{minlength:{requiredLength:i,actualLength:e}}:null}}function iJ(i){return n=>{let e=n.value?.length??KO(n.value);return e!==null&&e>i?{maxlength:{requiredLength:i,actualLength:e}}:null}}function rJ(i){if(!i)return KU;let n,e;return typeof i=="string"?(e="",i.charAt(0)!=="^"&&(e+="^"),e+=i,i.charAt(i.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=i.toString(),n=i),a=>{if(XO(a.value))return null;let d=a.value;return n.test(d)?null:{pattern:{requiredPattern:e,actualValue:d}}}}function KU(i){return null}function QU(i){return i!=null}function JU(i){return Fd(i)?go(i):i}function ej(i){let n={};return i.forEach(e=>{n=e!=null?Ht(Ht({},n),e):n}),Object.keys(n).length===0?null:n}function tj(i,n){return n.map(e=>e(i))}function oJ(i){return!i.validate}function nj(i){return i.map(n=>oJ(n)?n:e=>n.validate(e))}function ij(i){if(!i)return null;let n=i.filter(QU);return n.length==0?null:function(e){return ej(tj(e,n))}}function rj(i){return i!=null?ij(nj(i)):null}function oj(i){if(!i)return null;let n=i.filter(QU);return n.length==0?null:function(e){let a=tj(e,n).map(JU);return Ay(a).pipe(Qn(ej))}}function sj(i){return i!=null?oj(nj(i)):null}function $U(i,n){return i===null?[n]:Array.isArray(i)?[...i,n]:[i,n]}function aj(i){return i._rawValidators}function lj(i){return i._rawAsyncValidators}function GO(i){return i?Array.isArray(i)?i:[i]:[]}function JS(i,n){return Array.isArray(i)?i.includes(n):i===n}function HU(i,n){let e=GO(n);return GO(i).forEach(d=>{JS(e,d)||e.push(d)}),e}function GU(i,n){return GO(n).filter(e=>!JS(i,e))}var eT=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=rj(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=sj(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},p0=class extends eT{name;get formDirective(){return null}get path(){return null}},Kf=class extends eT{_parent=null;name=null;valueAccessor=null},tT=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},sJ={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},jTe=Ci(Ht({},sJ),{"[class.ng-submitted]":"isSubmitted"}),Ys=(()=>{class i extends tT{constructor(e){super(e)}static \u0275fac=function(a){return new(a||i)(Dt(Kf,2))};static \u0275dir=yr({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(a,d){a&2&&an("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)},standalone:!1,features:[bs]})}return i})(),Kh=(()=>{class i extends tT{constructor(e){super(e)}static \u0275fac=function(a){return new(a||i)(Dt(p0,10))};static \u0275dir=yr({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(a,d){a&2&&an("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)("ng-submitted",d.isSubmitted)},standalone:!1,features:[bs]})}return i})();var ub="VALID",QS="INVALID",d0="PENDING",db="DISABLED",Xh=class{},nT=class extends Xh{value;source;constructor(n,e){super(),this.value=n,this.source=e}},hb=class extends Xh{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},pb=class extends Xh{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},h0=class extends Xh{status;source;constructor(n,e){super(),this.status=n,this.source=e}},qO=class extends Xh{source;constructor(n){super(),this.source=n}},mb=class extends Xh{source;constructor(n){super(),this.source=n}};function eR(i){return(lT(i)?i.validators:i)||null}function aJ(i){return Array.isArray(i)?rj(i):i||null}function tR(i,n){return(lT(n)?n.asyncValidators:i)||null}function lJ(i){return Array.isArray(i)?sj(i):i||null}function lT(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function cj(i,n,e){let a=i.controls;if(!(n?Object.keys(a):a).length)throw new sn(1e3,"");if(!a[e])throw new sn(1001,"")}function uj(i,n,e){i._forEachChild((a,d)=>{if(e[d]===void 0)throw new sn(1002,"")})}var f0=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return Ho(this.statusReactive)}set status(n){Ho(()=>this.statusReactive.set(n))}_status=N_(()=>this.statusReactive());statusReactive=qs(void 0);get valid(){return this.status===ub}get invalid(){return this.status===QS}get pending(){return this.status==d0}get disabled(){return this.status===db}get enabled(){return this.status!==db}errors;get pristine(){return Ho(this.pristineReactive)}set pristine(n){Ho(()=>this.pristineReactive.set(n))}_pristine=N_(()=>this.pristineReactive());pristineReactive=qs(!0);get dirty(){return!this.pristine}get touched(){return Ho(this.touchedReactive)}set touched(n){Ho(()=>this.touchedReactive.set(n))}_touched=N_(()=>this.touchedReactive());touchedReactive=qs(!1);get untouched(){return!this.touched}_events=new li;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(HU(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(HU(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(GU(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(GU(n,this._rawAsyncValidators))}hasValidator(n){return JS(this._rawValidators,n)}hasAsyncValidator(n){return JS(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let a=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(Ci(Ht({},n),{sourceControl:a})),e&&n.emitEvent!==!1&&this._events.next(new pb(!0,a))}markAllAsDirty(n={}){this.markAsDirty({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(n))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let a=n.sourceControl??this;this._forEachChild(d=>{d.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:a})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,a),e&&n.emitEvent!==!1&&this._events.next(new pb(!1,a))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let a=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(Ci(Ht({},n),{sourceControl:a})),e&&n.emitEvent!==!1&&this._events.next(new hb(!1,a))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let a=n.sourceControl??this;this._forEachChild(d=>{d.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,a),e&&n.emitEvent!==!1&&this._events.next(new hb(!0,a))}markAsPending(n={}){this.status=d0;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new h0(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(Ci(Ht({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=db,this.errors=null,this._forEachChild(d=>{d.disable(Ci(Ht({},n),{onlySelf:!0}))}),this._updateValue();let a=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new nT(this.value,a)),this._events.next(new h0(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ci(Ht({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(d=>d(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=ub,this._forEachChild(a=>{a.enable(Ci(Ht({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Ci(Ht({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let a=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ub||this.status===d0)&&this._runAsyncValidator(a,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new nT(this.value,e)),this._events.next(new h0(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(Ci(Ht({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?db:ub}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=d0,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:n!==!1};let a=JU(this.asyncValidator(this));this._asyncValidationSubscription=a.subscribe(d=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(d,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((a,d)=>a&&a._find(d),this)}getError(n,e){let a=e?this.get(e):this;return a&&a.errors?a.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,a){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||a)&&this._events.next(new h0(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,a)}_initObservables(){this.valueChanges=new Vt,this.statusChanges=new Vt}_calculateStatus(){return this._allControlsDisabled()?db:this.errors?QS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(d0)?d0:this._anyControlsHaveStatus(QS)?QS:ub}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let a=!this._anyControlsDirty(),d=this.pristine!==a;this.pristine=a,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),d&&this._events.next(new hb(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new pb(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){lT(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=aJ(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=lJ(this._rawAsyncValidators)}},iT=class extends f0{constructor(n,e,a){super(eR(e),tR(a,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,a={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,a={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){uj(this,!0,n),Object.keys(n).forEach(a=>{cj(this,!0,a),this.controls[a].setValue(n[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(a=>{let d=this.controls[a];d&&d.patchValue(n[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((a,d)=>{a.reset(n?n[d]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new mb(this))}getRawValue(){return this._reduceChildren({},(n,e,a)=>(n[a]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,a)=>a._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let a=this.controls[e];a&&n(a,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,a]of Object.entries(this.controls))if(this.contains(e)&&n(a))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,a,d)=>((a.enabled||this.disabled)&&(e[d]=a.value),e))}_reduceChildren(n,e){let a=n;return this._forEachChild((d,r)=>{a=e(a,d,r)}),a}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var WO=class extends iT{};var gb=new Kt("",{providedIn:"root",factory:()=>cT}),cT="always";function cJ(i,n){return[...n.path,i]}function rT(i,n,e=cT){nR(i,n),n.valueAccessor.writeValue(i.value),(i.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(i.disabled),dJ(i,n),pJ(i,n),hJ(i,n),uJ(i,n)}function oT(i,n,e=!0){let a=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(a),n.valueAccessor.registerOnTouched(a)),aT(i,n),i&&(n._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function sT(i,n){i.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function uJ(i,n){if(n.valueAccessor.setDisabledState){let e=a=>{n.valueAccessor.setDisabledState(a)};i.registerOnDisabledChange(e),n._registerOnDestroy(()=>{i._unregisterOnDisabledChange(e)})}}function nR(i,n){let e=aj(i);n.validator!==null?i.setValidators($U(e,n.validator)):typeof e=="function"&&i.setValidators([e]);let a=lj(i);n.asyncValidator!==null?i.setAsyncValidators($U(a,n.asyncValidator)):typeof a=="function"&&i.setAsyncValidators([a]);let d=()=>i.updateValueAndValidity();sT(n._rawValidators,d),sT(n._rawAsyncValidators,d)}function aT(i,n){let e=!1;if(i!==null){if(n.validator!==null){let d=aj(i);if(Array.isArray(d)&&d.length>0){let r=d.filter(C=>C!==n.validator);r.length!==d.length&&(e=!0,i.setValidators(r))}}if(n.asyncValidator!==null){let d=lj(i);if(Array.isArray(d)&&d.length>0){let r=d.filter(C=>C!==n.asyncValidator);r.length!==d.length&&(e=!0,i.setAsyncValidators(r))}}}let a=()=>{};return sT(n._rawValidators,a),sT(n._rawAsyncValidators,a),e}function dJ(i,n){n.valueAccessor.registerOnChange(e=>{i._pendingValue=e,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&dj(i,n)})}function hJ(i,n){n.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&dj(i,n),i.updateOn!=="submit"&&i.markAsTouched()})}function dj(i,n){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function pJ(i,n){let e=(a,d)=>{n.valueAccessor.writeValue(a),d&&n.viewToModelUpdate(a)};i.registerOnChange(e),n._registerOnDestroy(()=>{i._unregisterOnChange(e)})}function fJ(i,n){i==null,nR(i,n)}function mJ(i,n){return aT(i,n)}function hj(i,n){if(!i.hasOwnProperty("model"))return!1;let e=i.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function gJ(i){return Object.getPrototypeOf(i.constructor)===qQ}function _J(i,n){i._syncPendingControls(),n.forEach(e=>{let a=e.control;a.updateOn==="submit"&&a._pendingChange&&(e.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}function pj(i,n){if(!n)return null;Array.isArray(n);let e,a,d;return n.forEach(r=>{r.constructor===Cs?e=r:gJ(r)?a=r:d=r}),d||a||e||null}function vJ(i,n){let e=i.indexOf(n);e>-1&&i.splice(e,1)}function qU(i,n){let e=i.indexOf(n);e>-1&&i.splice(e,1)}function WU(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var fb=class extends f0{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,a){super(eR(e),tR(a,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),lT(e)&&(e.nonNullable||e.initialValueIsDefault)&&(WU(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(a=>a(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new mb(this))}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){qU(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){qU(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){WU(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var yJ=i=>i instanceof fb;var xJ={provide:Kf,useExisting:gu(()=>va)},ZU=Promise.resolve(),va=(()=>{class i extends Kf{_changeDetectorRef;callSetDisabledState;control=new fb;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Vt;constructor(e,a,d,r,C,P){super(),this._changeDetectorRef=C,this.callSetDisabledState=P,this._parent=e,this._setValidators(a),this._setAsyncValidators(d),this.valueAccessor=pj(this,r)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let a=e.name.previousValue;this.formDirective.removeControl({name:a,path:this._getPath(a)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),hj(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){rT(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){ZU.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let a=e.isDisabled.currentValue,d=a!==0&&Ns(a);ZU.then(()=>{d&&!this.control.disabled?this.control.disable():!d&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?cJ(e,this._parent):[e]}static \u0275fac=function(a){return new(a||i)(Dt(p0,9),Dt(QO,10),Dt(JO,10),Dt(YO,10),Dt(Oc,8),Dt(gb,8))};static \u0275dir=yr({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Nd([xJ]),bs,Br]})}return i})();var Qh=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275dir=yr({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return i})();var fj=new Kt(""),bJ={provide:Kf,useExisting:gu(()=>iR)},iR=(()=>{class i extends Kf{_ngModelWarningConfig;callSetDisabledState;viewModel;form;set isDisabled(e){}model;update=new Vt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,a,d,r,C){super(),this._ngModelWarningConfig=r,this.callSetDisabledState=C,this._setValidators(e),this._setAsyncValidators(a),this.valueAccessor=pj(this,d)}ngOnChanges(e){if(this._isControlChanged(e)){let a=e.form.previousValue;a&&oT(a,this,!1),rT(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}hj(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&oT(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}static \u0275fac=function(a){return new(a||i)(Dt(QO,10),Dt(JO,10),Dt(YO,10),Dt(fj,8),Dt(gb,8))};static \u0275dir=yr({type:i,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],standalone:!1,features:[Nd([bJ]),bs,Br]})}return i})(),wJ={provide:p0,useExisting:gu(()=>Qf)},Qf=(()=>{class i extends p0{callSetDisabledState;get submitted(){return Ho(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=N_(()=>this._submittedReactive());_submittedReactive=qs(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Vt;constructor(e,a,d){super(),this.callSetDisabledState=d,this._setValidators(e),this._setAsyncValidators(a)}ngOnChanges(e){e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(aT(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let a=this.form.get(e.path);return rT(a,e,this.callSetDisabledState),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),a}getControl(e){return this.form.get(e.path)}removeControl(e){oT(e.control||null,e,!1),vJ(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,a){this.form.get(e.path).setValue(a)}onSubmit(e){return this._submittedReactive.set(!0),_J(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new qO(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0,a={}){this.form.reset(e,a),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(e=>{let a=e.control,d=this.form.get(e.path);a!==d&&(oT(a||null,e),yJ(d)&&(rT(d,e,this.callSetDisabledState),e.control=d))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let a=this.form.get(e.path);fJ(a,e),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let a=this.form.get(e.path);a&&mJ(a,e)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){nR(this.form,this),this._oldForm&&aT(this._oldForm,this)}static \u0275fac=function(a){return new(a||i)(Dt(QO,10),Dt(JO,10),Dt(gb,8))};static \u0275dir=yr({type:i,selectors:[["","formGroup",""]],hostBindings:function(a,d){a&1&&Te("submit",function(C){return d.onSubmit(C)})("reset",function(){return d.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Nd([wJ]),bs,Br]})}return i})();var mj=(()=>{class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({})}return i})(),ZO=class extends f0{constructor(n,e,a){super(eR(e),tR(a,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){Array.isArray(n)?n.forEach(a=>{this.controls.push(a),this._registerControl(a)}):(this.controls.push(n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,a={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(n,e={}){let a=this._adjustIndex(n);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,a={}){let d=this._adjustIndex(n);d<0&&(d=0),this.controls[d]&&this.controls[d]._registerOnCollectionChange(()=>{}),this.controls.splice(d,1),e&&(this.controls.splice(d,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){uj(this,!1,n),n.forEach((a,d)=>{cj(this,!1,d),this.at(d).setValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((a,d)=>{this.at(d)&&this.at(d).patchValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((a,d)=>{a.reset(n[d],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new mb(this))}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,a)=>a._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,a)=>{n(e,a)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function YU(i){return!!i&&(i.asyncValidators!==void 0||i.validators!==void 0||i.updateOn!==void 0)}var Jh=(()=>{class i{useNonNullable=!1;get nonNullable(){let e=new i;return e.useNonNullable=!0,e}group(e,a=null){let d=this._reduceControls(e),r={};return YU(a)?r=a:a!==null&&(r.validators=a.validator,r.asyncValidators=a.asyncValidator),new iT(d,r)}record(e,a=null){let d=this._reduceControls(e);return new WO(d,a)}control(e,a,d){let r={};return this.useNonNullable?(YU(a)?r=a:(r.validators=a,r.asyncValidators=d),new fb(e,Ci(Ht({},r),{nonNullable:!0}))):new fb(e,a,d)}array(e,a,d){let r=e.map(C=>this._createControl(C));return new ZO(r,a,d)}_reduceControls(e){let a={};return Object.keys(e).forEach(d=>{a[d]=this._createControl(e[d])}),a}_createControl(e){if(e instanceof fb)return e;if(e instanceof f0)return e;if(Array.isArray(e)){let a=e[0],d=e.length>1?e[1]:null,r=e.length>2?e[2]:null;return this.control(a,d,r)}else return this.control(e)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Ba=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:gb,useValue:e.callSetDisabledState??cT}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[mj]})}return i})(),Nu=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:fj,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:gb,useValue:e.callSetDisabledState??cT}]}}static \u0275fac=function(a){return new(a||i)};static \u0275mod=Tr({type:i});static \u0275inj=vr({imports:[mj]})}return i})();var Es=class i{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/users";getUsers(){return this.http.get(this.apiUrl)}getUserById(n){return this.http.get(`${this.apiUrl}/${n}`)}searchUsers(n){return this.http.get(`${this.apiUrl}/search?q=${n}`)}toggleSavedEvent(n,e){return this.http.post(`${this.apiUrl}/${n}/saved-events/${e}`,{})}followUser(n,e){return this.http.post(`${this.apiUrl}/${n}/follow/${e}`,{})}unfollowUser(n,e){return this.http.delete(`${this.apiUrl}/${n}/follow/${e}`)}isFollowing(n,e){return this.http.get(`${this.apiUrl}/${n}/is-following/${e}?t=${new Date().getTime()}`)}getFollowNotifications(n,e){return this.http.get(`${this.apiUrl}/${n}/follow/${e}/notifications?t=${new Date().getTime()}`)}setFollowNotifications(n,e,a){return this.http.put(`${this.apiUrl}/${n}/follow/${e}/notifications?enabled=${a}`,{})}getFollowers(n){return this.http.get(`${this.apiUrl}/${n}/followers`)}getFollowing(n){return this.http.get(`${this.apiUrl}/${n}/following`)}updateUser(n,e){return this.http.put(`${this.apiUrl}/${n}`,e)}changePassword(n,e,a){return this.http.put(`${this.apiUrl}/${n}/password`,{oldPassword:e,newPassword:a})}userUpdated=new li;userUpdates$=this.userUpdated.asObservable();notifyUserUpdate(){this.userUpdated.next()}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};function CJ(i,n){if(i&1&&(z(0,"p",5),W(1),V()),i&2){let e=te();K(),ot(e.distance())}}function EJ(i,n){if(i&1&&(z(0,"p",6),W(1),V()),i&2){let e=te();K(),bi("\u{1F3AB} ",e.maxParticipants()-e.occupiedSpots()," spots left")}}function SJ(i,n){if(i&1){let e=wt();z(0,"div",10),Te("click",function(d){return Ee(e),te(2).focusLocation.emit(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2,"place"),V()()}}function TJ(i,n){if(i&1&&(z(0,"span",13),W(1),V()),i&2){let e=te(4);K(),ot(e.savedCount())}}function IJ(i,n){if(i&1){let e=wt();z(0,"div",12),Te("click",function(d){return Ee(e),te(3).toggleFavorite.emit(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2),V(),Je(3,TJ,2,1,"span",13),V()}if(i&2){let e=te(3);K(),an("saved",e.isSaved()),K(),ot(e.isSaved()?"favorite":"favorite_border"),K(),et(e.showSavedCount()&&e.savedCount()!==null&&e.savedCount()!==void 0?3:-1)}}function MJ(i,n){if(i&1&&Je(0,IJ,4,4,"div",11),i&2){let e=te(2);et(e.isParticipating()?-1:0)}}function DJ(i,n){if(i&1){let e=wt();z(0,"div",10),Te("click",function(d){return Ee(e),te(2).shareEvent.emit(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2,"share"),V()()}}function AJ(i,n){if(i&1&&(z(0,"div",7),Je(1,SJ,3,0,"div",9),Je(2,MJ,1,1),Je(3,DJ,3,0,"div",9),V()),i&2){let e=te();K(),et(e.showActions()||e.showLocationPin()?1:-1),K(),et(e.showActions()?2:-1),K(),et(e.showShare()?3:-1)}}function PJ(i,n){i&1&&(z(0,"mat-icon"),W(1,"person"),V())}function OJ(i,n){i&1&&(z(0,"span",17),W(1,"You are the eventer"),V())}function RJ(i,n){if(i&1){let e=wt();z(0,"button",19),Te("click",function(d){Ee(e);let r=te(3);return Se(r.isFollowing?r.unfollowOrganizer(d):r.followOrganizer(d))}),W(1),V()}if(i&2){let e=te(3);an("following",e.isFollowing),K(),bi(" ",e.isFollowing?"Following":"Follow"," ")}}function kJ(i,n){if(i&1&&Je(0,OJ,2,0,"span",17)(1,RJ,2,3,"button",18),i&2){let e,a=te(2);et(((e=a.currentUserId())==null?null:e.toString())===((e=a.creatorId())==null?null:e.toString())?0:1)}}function FJ(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",14),Te("click",function(d){return Ee(e),te().openOrganizerProfile.emit(),Se(d.stopPropagation())}),z(2,"div",15),Je(3,PJ,2,0,"mat-icon"),V(),z(4,"span",16),W(5),V()(),Je(6,kJ,2,1),V()}if(i&2){let e=te();K(2),$o("background-image",e.organizerImage()?"url("+e.organizerImage()+")":""),K(),et(e.organizerImage()?-1:3),K(2),ot(e.organizerName()),K(),et(e.currentUserId()&&e.creatorId()?6:-1)}}var tp=class i{constructor(n){this.userService=n}title=Io.required();location=Io.required();dateTime=Io.required();distance=Io();id=Io.required();isSaved=Io(!1);savedCount=Io(null);isParticipating=Io(!1);showDistance=Io(!0);showActions=Io(!0);showShare=Io(!1);showOrganizerInfo=Io(!0);showSavedCount=Io(!0);showLocationPin=Io(!1);organizerName=Io();organizerImage=Io();creatorId=Io();occupiedSpots=Io();maxParticipants=Io();currentUserId=Io(null);isFollowing=!1;focusLocation=new Vt;toggleFavorite=new Vt;openOrganizerProfile=new Vt;shareEvent=new Vt;ngOnInit(){this.checkIfFollowing()}checkIfFollowing(){}followOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.followUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!0},error:e=>console.error("Error following",e)})}unfollowOrganizer(n){n.stopPropagation(),!(!this.currentUserId()||!this.creatorId())&&this.userService.unfollowUser(this.currentUserId(),this.creatorId().toString()).subscribe({next:()=>{this.isFollowing=!1},error:e=>console.error("Error unfollowing",e)})}static \u0275fac=function(e){return new(e||i)(Dt(Es))};static \u0275cmp=vn({type:i,selectors:[["app-event-card"]],inputs:{title:[1,"title"],location:[1,"location"],dateTime:[1,"dateTime"],distance:[1,"distance"],id:[1,"id"],isSaved:[1,"isSaved"],savedCount:[1,"savedCount"],isParticipating:[1,"isParticipating"],showDistance:[1,"showDistance"],showActions:[1,"showActions"],showShare:[1,"showShare"],showOrganizerInfo:[1,"showOrganizerInfo"],showSavedCount:[1,"showSavedCount"],showLocationPin:[1,"showLocationPin"],organizerName:[1,"organizerName"],organizerImage:[1,"organizerImage"],creatorId:[1,"creatorId"],occupiedSpots:[1,"occupiedSpots"],maxParticipants:[1,"maxParticipants"],currentUserId:[1,"currentUserId"]},outputs:{focusLocation:"focusLocation",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",shareEvent:"shareEvent"},decls:12,vars:7,consts:[[1,"card-container"],[1,"info-section"],[1,"title"],[1,"location"],[1,"date-time"],[1,"distance"],[1,"spots-info"],[1,"actions-section"],[1,"organizer-info"],[1,"icon-circle"],[1,"icon-circle",3,"click"],[1,"icon-circle","favorite-icon"],[1,"icon-circle","favorite-icon",3,"click"],[1,"favorite-count"],[1,"organizer-details","clickable",3,"click"],[1,"organizer-img"],[1,"organizer-name"],[1,"is-organizer-badge"],[1,"follow-btn",3,"following"],[1,"follow-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"h3",2),W(3),V(),z(4,"p",3),W(5),V(),z(6,"p",4),W(7),V(),Je(8,CJ,2,1,"p",5),Je(9,EJ,2,1,"p",6),V(),Je(10,AJ,4,3,"div",7),V(),Je(11,FJ,7,5,"div",8)),e&2&&(K(3),ot(a.title()),K(2),ot(a.location()),K(2),ot(a.dateTime()),K(),et(a.distance()?8:-1),K(),et(a.maxParticipants()&&a.occupiedSpots()!==void 0?9:-1),K(),et(a.showActions()||a.showShare()||a.showLocationPin()?10:-1),K(),et(a.organizerName()&&a.showOrganizerInfo()?11:-1))},dependencies:[fi,Pi,Ai],styles:[".card-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);color:var(--color-white)}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.title[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.location[_ngcontent-%COMP%]{margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.date-time[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#888}.distance[_ngcontent-%COMP%]{margin:0;font-size:10px;color:#aaa}.actions-section[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm)}.icon-circle[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:background-color .2s}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:1px;right:1px;min-width:14px;height:14px;padding:0 4px;border-radius:999px;background:#101010e6;border:1px solid rgba(255,255,255,.2);color:var(--color-accent);font-size:8px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#555}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.9)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-light-gray);transition:color .2s ease}.icon-circle[_ngcontent-%COMP%]   mat-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent)}.organizer-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-top:10px;margin-top:10px;border-top:1px solid rgba(255,255,255,.1)}.organizer-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.organizer-details.clickable[_ngcontent-%COMP%]{cursor:pointer}.organizer-details.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-img[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#333;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;overflow:hidden}.organizer-img[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:#ccc}.organizer-name[_ngcontent-%COMP%]{font-size:12px;color:#aaa;font-weight:500}.follow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #1a73e8;color:#1a73e8;border-radius:12px;padding:2px 10px;font-size:11px;cursor:pointer;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{background:#1a73e81a}.follow-btn.following[_ngcontent-%COMP%]{background:#1a73e8;color:#fff;border-color:#1a73e8}.is-organizer-badge[_ngcontent-%COMP%]{font-size:10px;color:#4caf50;background:#4caf501a;padding:2px 6px;border-radius:4px;border:1px solid rgba(76,175,80,.3)}"]})};var Xs=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";getEvents(n){let e=this.baseUrl;return n&&n!=="undefined"&&n!=="null"&&!isNaN(Number(n))&&(e+=`?userId=${n}`),this.http.get(e)}getOrganizedEvents(n){return this.http.get(`${this.baseUrl}/organized?userId=${n}`)}getJoinedEvents(n){return this.http.get(`${this.baseUrl}/joined?userId=${n}`)}toggleSavedEvent(n,e){return this.http.post(`http://localhost:8080/api/users/${n}/saved-events/${e}`,{})}getSavedEvents(n){return this.http.get(`http://localhost:8080/api/users/${n}/saved-events`)}getEventById(n,e){let a=`${this.baseUrl}/${n}`;return e&&(a+=`?userId=${e}`),this.http.get(a)}searchEvents(n){return this.http.get(`${this.baseUrl}/search?q=${n}`)}requestParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participation-request?userId=${e}`,{})}leaveEvent(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/leave`,{})}acceptParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/accept`,{})}rejectParticipation(n,e){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/reject`,{})}removeParticipant(n,e,a){return this.http.post(`${this.baseUrl}/${n}/participants/${e}/remove?organizerId=${a}`,{})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/${n}`)}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var zu=class i{constructor(n){this.http=n}apiUrl="https://api.mapbox.com/geocoding/v5/mapbox.places";searchCity(n){let e=`${this.apiUrl}/${encodeURIComponent(n)}.json`,a={access_token:ul.mapboxToken,types:"place,locality",limit:"5",language:"it"};return this.http.get(e,{params:a}).pipe(Qn(d=>d.features&&d.features.length>0?d.features:[]))}reverseGeocode(n,e){let a=`${this.apiUrl}/${e},${n}.json`,d={access_token:ul.mapboxToken,types:"place,locality",limit:"1",language:"it"};return this.http.get(a,{params:d}).pipe(Qn(r=>{let C=r?.features||[],P=C.find(k=>(k.place_type||[]).includes("place"))||C[0];return P?.text||P?.place_name||null}))}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var _b=(i,n)=>n.id;function LJ(i,n){if(i&1){let e=wt();z(0,"mat-icon",12),Te("click",function(){Ee(e);let d=te(2);return Se(d.clearSearch())}),W(1,"close"),V()}}function NJ(i,n){if(i&1){let e=wt();z(0,"mat-icon",12),Te("click",function(){Ee(e);let d=te(2);return Se(d.onSearch())}),W(1,"search"),V()}}function zJ(i,n){if(i&1){let e=wt();z(0,"div",7)(1,"input",8),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.searchQuery,d)||(r.searchQuery=d),Se(d)}),Te("keyup.enter",function(){Ee(e);let d=te();return Se(d.onSearch())})("ngModelChange",function(d){Ee(e);let r=te();return Se(r.onSearchChange(d))}),V(),z(2,"div",9),Je(3,LJ,2,0,"mat-icon",10)(4,NJ,2,0,"mat-icon",10),z(5,"mat-icon",11),Te("click",function(){Ee(e);let d=te();return d.showFilterOptions=!d.showFilterOptions,d.filterMenuOpen=!1,Se(d.sortMenuOpen=!1)}),W(6,"tune"),V()()()}if(i&2){let e=te();K(),_o("ngModel",e.searchQuery),K(2),et(e.isSearching?3:4)}}function BJ(i,n){i&1&&(z(0,"mat-icon"),W(1,"check"),V())}function VJ(i,n){if(i&1){let e=wt();z(0,"button",26),Te("click",function(d){let r=Ee(e).$implicit;return te(3).selectFilter(r),Se(d.stopPropagation())}),z(1,"span"),W(2),V(),Je(3,BJ,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=te(3);K(2),ot(a.filterLabels[e]),K(),et(a.filterOption===e?3:-1)}}function UJ(i,n){if(i&1&&(z(0,"div",18),Wi(1,VJ,4,2,"button",25,ka),V()),i&2){let e=te(2);K(),Zi(e.filterOrder)}}function jJ(i,n){i&1&&(z(0,"mat-icon"),W(1,"check"),V())}function $J(i,n){if(i&1){let e=wt();z(0,"button",26),Te("click",function(d){let r=Ee(e).$implicit;return te(3).selectSort(r),Se(d.stopPropagation())}),z(1,"span"),W(2),V(),Je(3,jJ,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=te(3);K(2),ot(a.sortLabels[e]),K(),et(a.sortOption===e?3:-1)}}function HJ(i,n){if(i&1&&(z(0,"div",18),Wi(1,$J,4,2,"button",25,ka),V()),i&2){let e=te(2);K(),Zi(e.sortOrder)}}function GJ(i,n){if(i&1){let e=wt();z(0,"div",13)(1,"div",14)(2,"div",15),Te("click",function(){Ee(e);let d=te();return d.filterMenuOpen=!d.filterMenuOpen,Se(d.sortMenuOpen=!1)}),z(3,"div",16)(4,"mat-icon"),W(5,"filter_list"),V(),z(6,"span"),W(7),V(),z(8,"mat-icon",17),W(9),V()(),Je(10,UJ,3,0,"div",18),V(),z(11,"div",15),Te("click",function(){Ee(e);let d=te();return d.sortMenuOpen=!d.sortMenuOpen,Se(d.filterMenuOpen=!1)}),z(12,"div",16)(13,"mat-icon"),W(14,"swap_vert"),V(),z(15,"span"),W(16),V(),z(17,"mat-icon",17),W(18),V()(),Je(19,HJ,3,0,"div",18),V()(),z(20,"div",19)(21,"div",20)(22,"span"),W(23,"Price"),V(),z(24,"span",21),W(25),V()(),z(26,"div",22)(27,"input",23),Te("input",function(d){Ee(e);let r=te();return Se(r.onPriceMinChange(d.target.value))}),V(),z(28,"input",24),Te("input",function(d){Ee(e);let r=te();return Se(r.onPriceMaxChange(d.target.value))}),V()()(),z(29,"div",19)(30,"div",20)(31,"span"),W(32,"Distance"),V(),z(33,"span",21),W(34),V()(),z(35,"div",22)(36,"input",23),Te("input",function(d){Ee(e);let r=te();return Se(r.onDistanceMinChange(d.target.value))}),V(),z(37,"input",24),Te("input",function(d){Ee(e);let r=te();return Se(r.onDistanceMaxChange(d.target.value))}),V()()()()}if(i&2){let e=te();K(7),ot(e.filterLabels[e.filterOption]),K(2),ot(e.filterMenuOpen?"expand_less":"expand_more"),K(),et(e.filterMenuOpen?10:-1),K(6),ot(e.sortLabels[e.sortOption]),K(2),ot(e.sortMenuOpen?"expand_less":"expand_more"),K(),et(e.sortMenuOpen?19:-1),K(6),ga("\u20AC",e.priceMin.toFixed(0)," - \u20AC",e.priceMax.toFixed(0)),K(),$o("--min-percent",e.priceMinPercent)("--max-percent",e.priceMaxPercent),K(),vt("min",0)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMin),K(),vt("min",e.priceMin)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMax),K(6),ga("",e.distanceMin.toFixed(1)," - ",e.distanceMax.toFixed(1)," km"),K(),$o("--min-percent",e.distanceMinPercent)("--max-percent",e.distanceMaxPercent),K(),vt("min",0)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMin),K(),vt("min",e.distanceMin)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMax)}}function qJ(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Ee(e).$implicit,r=te(4);return Se(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function WJ(i,n){if(i&1){let e=wt();z(0,"button",36),Te("click",function(){Ee(e);let d=te(4);return Se(d.showMoreSearch())}),W(1,"Show more"),V()}}function ZJ(i,n){i&1&&(z(0,"div",34),W(1,"No events found."),V())}function YJ(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),Wi(2,qJ,1,14,"app-event-card",32,_b),Ls(4,"slice"),Je(5,WJ,2,0,"button",33),Je(6,ZJ,2,0,"div",34),V()()),i&2){let e=te(3);K(2),Zi(Nf(4,2,e.filteredSearchResults,0,e.shownSearch)),K(3),et(e.shownSearch<e.filteredSearchResults.length?5:-1),K(),et(e.filteredSearchResults.length===0?6:-1)}}function XJ(i,n){if(i&1){let e=wt();z(0,"div",38),Te("click",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.selectCity(d))}),z(1,"div",39)(2,"mat-icon"),W(3,"location_on"),V()(),z(4,"div",40)(5,"span",41),W(6),V()()()}if(i&2){let e=n.$implicit;K(6),ot(e.name)}}function KJ(i,n){i&1&&(z(0,"div",34),W(1,"No places found."),V())}function QJ(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),Wi(2,XJ,7,1,"div",37,ka),V(),Je(4,KJ,2,0,"div",34),V()),i&2){let e=te(3);K(2),Zi(e.cityResults),K(2),et(e.cityResults.length===0?4:-1)}}function JJ(i,n){i&1&&(z(0,"mat-icon"),W(1,"person"),V())}function eee(i,n){if(i&1){let e=wt();z(0,"div",43),Te("click",function(d){Ee(e);let r=te().$implicit,C=te(4);return C.followingMap[r.id]?C.unfollowUser(r,d):C.followUser(r,d),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2),V()()}if(i&2){let e=te().$implicit,a=te(4);an("following",a.followingMap[e.id]),K(2),ot(a.followingMap[e.id]?"person":"person_add")}}function tee(i,n){if(i&1){let e=wt();z(0,"div",38),Te("click",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.openUserProfile.emit(d.id.toString()))}),z(1,"div",39),Je(2,JJ,2,0,"mat-icon"),V(),z(3,"div",40)(4,"span",41),W(5),V()(),Je(6,eee,3,3,"div",42),V()}if(i&2){let e=n.$implicit,a=te(4);K(),$o("background-image",e.profileImage?"url("+e.profileImage+")":"")("background-size","cover"),K(),et(e.profileImage?-1:2),K(3),ot(e.name),K(),et(a.userId&&a.userId.toString()!==e.id.toString()?6:-1)}}function nee(i,n){i&1&&(z(0,"div",34),W(1,"No creators found."),V())}function iee(i,n){if(i&1&&(z(0,"div",30)(1,"div",31),Wi(2,tee,7,7,"div",37,ka),V(),Je(4,nee,2,0,"div",34),V()),i&2){let e=te(3);K(2),Zi(e.userResults),K(2),et(e.userResults.length===0?4:-1)}}function ree(i,n){if(i&1){let e=wt();z(0,"div",28)(1,"button",29),Te("click",function(){Ee(e);let d=te(2);return Se(d.setActiveTab("events"))}),W(2," EVENTS "),V(),z(3,"button",29),Te("click",function(){Ee(e);let d=te(2);return Se(d.setActiveTab("places"))}),W(4," PLACES "),V(),z(5,"button",29),Te("click",function(){Ee(e);let d=te(2);return Se(d.setActiveTab("creators"))}),W(6," CREATORS "),V()(),Je(7,YJ,7,6,"div",30),Je(8,QJ,5,1,"div",30),Je(9,iee,5,1,"div",30)}if(i&2){let e=te(2);K(),an("active",e.activeTab==="events"),K(2),an("active",e.activeTab==="places"),K(2),an("active",e.activeTab==="creators"),K(2),et(e.activeTab==="events"?7:-1),K(),et(e.activeTab==="places"?8:-1),K(),et(e.activeTab==="creators"?9:-1)}}function oee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Ee(e).$implicit,r=te(4);return Se(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function see(i,n){if(i&1){let e=wt();z(0,"button",36),Te("click",function(){Ee(e);let d=te(4);return Se(d.showMoreFound())}),W(1," Show more"),V()}}function aee(i,n){i&1&&(z(0,"div",34),W(1,"No events found in your area."),V())}function lee(i,n){if(i&1&&(z(0,"div",30)(1,"h2",44),W(2,"FOUND EVENTS"),V(),z(3,"div",31),Wi(4,oee,1,14,"app-event-card",32,_b),Ls(6,"slice"),Je(7,see,2,0,"button",33),Je(8,aee,2,0,"div",34),V()()),i&2){let e=te(3);K(4),Zi(Nf(6,2,e.filteredFoundEvents,0,e.shownFound)),K(3),et(e.shownFound<e.filteredFoundEvents.length?7:-1),K(),et(e.filteredFoundEvents.length===0?8:-1)}}function cee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Ee(e).$implicit,r=te(4);return Se(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!0)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function uee(i,n){if(i&1){let e=wt();z(0,"button",36),Te("click",function(){Ee(e);let d=te(4);return Se(d.showMoreFollowUp())}),W(1,"Show more"),V()}}function dee(i,n){i&1&&(z(0,"div",34),W(1,"No upcoming events you are participating in."),V())}function hee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Ee(e).$implicit,r=te(4);return Se(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function pee(i,n){if(i&1){let e=wt();z(0,"button",36),Te("click",function(){Ee(e);let d=te(4);return Se(d.showMoreSaved())}),W(1," Show more"),V()}}function fee(i,n){i&1&&(z(0,"div",34),W(1,"You haven't saved any events yet."),V())}function mee(i,n){if(i&1){let e=wt();z(0,"app-event-card",46),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))})("openOrganizerProfile",function(){let d=Ee(e).$implicit,r=te(4);return Se(d.creatorId?r.openUserProfile.emit(d.creatorId.toString()):null)}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function gee(i,n){if(i&1){let e=wt();z(0,"button",36),Te("click",function(){Ee(e);let d=te(4);return Se(d.showMoreDiscover())}),W(1,"Show more"),V()}}function _ee(i,n){i&1&&(z(0,"div",34),W(1,"No new events to discover at the moment."),V())}function vee(i,n){if(i&1&&(z(0,"div",30)(1,"h2",44),W(2,"FOLLOW UP EVENTS"),V(),z(3,"div",31),Wi(4,cee,1,14,"app-event-card",32,_b),Ls(6,"slice"),Je(7,uee,2,0,"button",33),Je(8,dee,2,0,"div",34),V()(),z(9,"div",30)(10,"h2",44),W(11,"SAVED EVENTS"),V(),z(12,"div",31),Wi(13,hee,1,17,"app-event-card",32,_b),Ls(15,"slice"),Je(16,pee,2,0,"button",33),Je(17,fee,2,0,"div",34),V()(),z(18,"div",30)(19,"h2",44),W(20,"DISCOVER EVENTS"),V(),z(21,"div",31),Wi(22,mee,1,13,"app-event-card",45,_b),Ls(24,"slice"),Je(25,gee,2,0,"button",33),Je(26,_ee,2,0,"div",34),V()()),i&2){let e=te(3);K(4),Zi(Nf(6,6,e.filteredFollowUpEvents,0,e.shownFollowUp)),K(3),et(e.shownFollowUp<e.filteredFollowUpEvents.length?7:-1),K(),et(e.filteredFollowUpEvents.length===0?8:-1),K(5),Zi(Nf(15,10,e.filteredSavedEvents,0,e.shownSaved)),K(3),et(e.shownSaved<e.filteredSavedEvents.length?16:-1),K(),et(e.filteredSavedEvents.length===0?17:-1),K(5),Zi(Nf(24,14,e.filteredDiscoverEvents,0,e.shownDiscover)),K(3),et(e.shownDiscover<e.filteredDiscoverEvents.length?25:-1),K(),et(e.filteredDiscoverEvents.length===0?26:-1)}}function yee(i,n){if(i&1&&Je(0,lee,9,6,"div",30)(1,vee,27,18),i&2){let e=te(2);et(e.userId?1:0)}}function xee(i,n){if(i&1&&(z(0,"div",27),Je(1,ree,10,9)(2,yee,2,1),V()),i&2){let e=te();an("search-mode",e.isSearching),K(),et(e.isSearching?1:2)}}var vb=class i{constructor(n,e,a){this.eventService=n;this.mapboxService=e;this.userService=a}events=[];focusEvent=new Vt;collapsed=!1;userId=null;toggleSidebar=new Vt;toggleFavorite=new Vt;foundLocation=new Vt;openUserProfile=new Vt;shareEvent=new Vt;searchQuery="";searchResults=[];cityResults=[];userResults=[];activeTab="events";isSearching=!1;followingMap={};showFilterOptions=!1;followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filteredFollowUpEvents=[];filteredSavedEvents=[];filteredDiscoverEvents=[];filteredFoundEvents=[];filteredSearchResults=[];shownFollowUp=3;shownSaved=3;shownDiscover=3;shownFound=3;shownSearch=3;filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};searchInput$=new li;searchSub;ngOnInit(){this.searchSub=this.searchInput$.pipe(l_(300),ff()).subscribe(n=>{let e=n?.trim()||"";if(!e){this.clearSearch();return}this.onSearchInternal(e)})}ngOnDestroy(){this.searchSub?.unsubscribe()}get isFiltering(){return this.filterOption!=="all"}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};ngOnChanges(n){(n.events||n.userId)&&this.categorizeEvents()}showMoreFollowUp(){this.shownFollowUp+=3}showMoreSaved(){this.shownSaved+=3}showMoreDiscover(){this.shownDiscover+=3}showMoreFound(){this.shownFound+=3}showMoreSearch(){this.shownSearch+=3}categorizeEvents(){if(this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent),this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.applyFilters();return}this.eventService.getJoinedEvents(this.userId).subscribe({next:a=>{let d=a.filter(this.isFutureEvent);d.sort((r,C)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`),k=new Date(`${C.date}T${C.startTime||"00:00"}`);return P.getTime()-k.getTime()}),this.followUpEvents=d,this.applyFilters()},error:a=>console.error("Error fetching follow up events",a)});let n=[],e=[];this.events.filter(this.isFutureEvent).forEach(a=>{let d=!1,r=a.isParticipating||!1;a.isSaved&&!r&&(d=!0),d&&n.push(a),!r&&!d&&e.push(a)}),this.savedEvents=n,this.discoverEvents=e,this.foundEvents=[],this.applyFilters()}updateRangeLimits(){let n=this.events.map(X=>X.costPerPerson??0),e=n.length?Math.max(...n):0,a=Math.max(10,Math.ceil(e)),d=this.events.map(X=>X.distanceKm).filter(X=>typeof X=="number"&&!Number.isNaN(X)),r=d.length?Math.max(...d):0,C=Math.max(5,Math.ceil(r)),P=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=a,(P||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let k=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=C,(k||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(){this.filteredFoundEvents=this.filterAndSortList(this.foundEvents),this.filteredFollowUpEvents=this.filterAndSortList(this.followUpEvents),this.filteredSavedEvents=this.filterAndSortList(this.savedEvents),this.filteredDiscoverEvents=this.filterAndSortList(this.discoverEvents),this.filteredSearchResults=this.filterAndSortList(this.searchResults)}filterAndSortList(n){let e=[...n];switch(this.filterOption){case"participating":e=e.filter(r=>!!r.isParticipating);break;case"free":e=e.filter(r=>r.costPerPerson==null||r.costPerPerson===0);break;case"available":e=e.filter(r=>r.nPartecipants==null||r.occupiedSpots==null?!0:r.nPartecipants-r.occupiedSpots>0);break;default:break}switch((this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(e=e.filter(r=>{let C=r.costPerPerson??0;return C>=this.priceMin&&C<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(e=e.filter(r=>{let C=r.distanceKm;return C==null?!1:C>=this.distanceMin&&C<=this.distanceMax})),this.sortOption){case"distance":e.sort((r,C)=>{let P=r.distanceKm??Number.MAX_SAFE_INTEGER,k=C.distanceKm??Number.MAX_SAFE_INTEGER;return P-k});break;case"name":e.sort((r,C)=>(r.title||"").localeCompare(C.title||"","it"));break;case"date":default:e.sort((r,C)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`).getTime(),k=new Date(`${C.date}T${C.startTime||"00:00"}`).getTime();return P-k});break}return e}cycleFilter(){let n=this.filterOrder.indexOf(this.filterOption);this.filterOption=this.filterOrder[(n+1)%this.filterOrder.length],this.applyFilters()}cycleSort(){let n=this.sortOrder.indexOf(this.sortOption);this.sortOption=this.sortOrder[(n+1)%this.sortOrder.length],this.applyFilters()}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1,this.applyFilters()}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1,this.applyFilters()}get priceMinPercent(){return this.priceMaxLimit?`${this.priceMin/this.priceMaxLimit*100}%`:"0%"}get priceMaxPercent(){return this.priceMaxLimit?`${this.priceMax/this.priceMaxLimit*100}%`:"100%"}get distanceMinPercent(){return this.distanceMaxLimit?`${this.distanceMin/this.distanceMaxLimit*100}%`:"0%"}get distanceMaxPercent(){return this.distanceMaxLimit?`${this.distanceMax/this.distanceMaxLimit*100}%`:"100%"}onPriceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(e)?this.priceMin:e,this.applyFilters()}onPriceMaxChange(n){let e=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(e)?this.priceMax:e,this.applyFilters()}onDistanceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(e)?this.distanceMin:e,this.applyFilters()}onDistanceMaxChange(n){let e=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(e)?this.distanceMax:e,this.applyFilters()}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",C=a&&d?`${a} - ${d}`:a||d;return[r,C].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}goToEvent(n){this.focusEvent.emit(n)}toggle(){this.toggleSidebar.emit()}onSearchChange(n){this.searchQuery=n,this.searchInput$.next(n)}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.onSearchInternal(this.searchQuery.trim())}onSearchInternal(n){this.isSearching=!0,this.eventService.searchEvents(n).subscribe(e=>{this.searchResults=e.filter(this.isFutureEvent),this.applyFilters()}),this.mapboxService.searchCity(n).subscribe(e=>{this.cityResults=e.map(a=>({name:a.place_name,center:a.center}))}),this.userService.searchUsers(n).subscribe(e=>{this.userResults=e,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(e=>{this.followingMap[n.id]=e.isFollowing})})}followUser(n,e){e.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,e){e.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}setActiveTab(n){this.activeTab=n}selectCity(n){if(n){let[e,a]=n.center;this.foundLocation.emit({lat:a,lng:e})}}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[],this.activeTab="events",this.applyFilters()}isMobileOrTablet(){return window.innerWidth<=1024}static \u0275fac=function(e){return new(e||i)(Dt(Xs),Dt(zu),Dt(Es))};static \u0275cmp=vn({type:i,selectors:[["app-sidebar"]],inputs:{events:"events",collapsed:"collapsed",userId:"userId"},outputs:{focusEvent:"focusEvent",toggleSidebar:"toggleSidebar",toggleFavorite:"toggleFavorite",foundLocation:"foundLocation",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Br],decls:10,vars:6,consts:[[1,"sidebar-container"],[1,"header"],[1,"logo"],[1,"collapse-toggle",3,"click"],["class","search-container",4,"ngIf"],["class","filter-sort",4,"ngIf"],["class","sections-container",3,"search-mode",4,"ngIf"],[1,"search-container"],["type","text","placeholder","Search city, events or user",1,"search-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-actions"],[1,"search-icon","clickable"],[1,"options-icon","clickable",3,"click"],[1,"search-icon","clickable",3,"click"],[1,"filter-sort"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs","dual"],["type","range",1,"min-range",3,"input","min","max","step","value"],["type","range",1,"max-range",3,"input","min","max","step","value"],[1,"menu-item"],[1,"menu-item",3,"click"],[1,"sections-container"],[1,"tabs-header"],[1,"tab-btn",3,"click"],[1,"events-section"],[1,"events-list"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"show-more-btn"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"show-more-btn",3,"click"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle","small"],[1,"loc-info"],[1,"loc-name"],[1,"icon-circle","follow-icon",3,"following"],[1,"icon-circle","follow-icon",3,"click"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","openOrganizerProfile","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"h1",2),W(3,"LUMO"),V(),z(4,"button",3),Te("click",function(){return a.toggle()}),z(5,"mat-icon"),W(6),V()()(),$i(7,zJ,7,2,"div",4)(8,GJ,38,34,"div",5)(9,xee,3,3,"div",6),V()),e&2&&(an("collapsed",a.collapsed),K(6),ot(a.collapsed?"chevron_right":"chevron_left"),K(),vt("ngIf",!a.collapsed),K(),vt("ngIf",!a.collapsed&&a.showFilterOptions),K(),vt("ngIf",!a.collapsed))},dependencies:[fi,cs,Ba,Cs,Ys,va,Pi,Ai,tp,SP],styles:['.sidebar-container[_ngcontent-%COMP%]{width:360px;max-width:90vw;height:calc(100vh - 40px);background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);display:flex;flex-direction:column;gap:24px;padding:24px;border-radius:24px;box-shadow:4px 0 12px #0000004d;border:1px solid var(--color-light-gray);color:var(--color-white);position:absolute;top:20px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:auto;height:72px;overflow:hidden;padding:24px;justify-content:center;border-radius:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:14px;font-weight:700;margin:0 0 16px;text-transform:uppercase;letter-spacing:.5px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{gap:10px;justify-content:space-between;width:100%;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block;font-size:24px}.logo[_ngcontent-%COMP%]{color:var(--color-accent);font-size:24px;font-weight:900;margin:0;padding:0;letter-spacing:1px;text-shadow:none}.search-container[_ngcontent-%COMP%]{position:relative}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px 64px 12px 16px;background-color:var(--color-gray);border:1px solid rgba(255,255,255,.12);border-radius:12px;color:#aaa;font-size:14px;outline:none;box-sizing:border-box}.search-input[_ngcontent-%COMP%]::placeholder{color:#666}.search-actions[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);display:flex;align-items:center;gap:8px;color:#666}.search-icon[_ngcontent-%COMP%], .options-icon[_ngcontent-%COMP%]{font-size:20px;display:flex;align-items:center;justify-content:center}.options-icon[_ngcontent-%COMP%]{font-size:20px}.filter-sort[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin:6px 0 4px;position:relative;z-index:var(--z-dropdown);overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{display:grid;gap:6px}.range-inputs.dual[_ngcontent-%COMP%]{position:relative;height:24px;display:flex;align-items:center;gap:0}.range-inputs.dual[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;right:0;height:4px;border-radius:999px;background:#ffffff2e}.range-inputs.dual[_ngcontent-%COMP%]:after{content:"";position:absolute;left:var(--min-percent, 0%);right:calc(100% - var(--max-percent, 100%));height:4px;border-radius:999px;background:var(--color-accent)}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;left:0;right:0;width:100%;height:24px;margin:0;background:none;pointer-events:none;-webkit-appearance:none}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{pointer-events:auto;-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{pointer-events:auto;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   .min-range[_ngcontent-%COMP%]{z-index:2}.range-inputs.dual[_ngcontent-%COMP%]   .max-range[_ngcontent-%COMP%]{z-index:3}.range-inputs[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:100%;accent-color:var(--color-accent)}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;gap:5px;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:10px;transition:background-color .2s ease,border-color .2s ease,transform .1s ease;min-width:110px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:5px 8px;gap:4px}.pill[_ngcontent-%COMP%]:hover{background:var(--color-bit-gray);border-color:var(--color-light-gray)}.pill[_ngcontent-%COMP%]:active{transform:translateY(1px)}.dropdown[_ngcontent-%COMP%]{position:relative}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:180px;z-index:calc(var(--z-dropdown) + 1);padding:4px;pointer-events:auto}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:none;background:transparent;color:var(--color-white);cursor:pointer;border-radius:8px;transition:background-color .15s ease;text-align:left}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff14}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:8px;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-weight:500;font-size:13px;cursor:pointer;border-radius:20px;transition:all .2s;white-space:nowrap}.tab-btn[_ngcontent-%COMP%]:hover{background:#fff3}.tab-btn.active[_ngcontent-%COMP%]{background:#fbbc04;color:var(--color-white);font-weight:600}.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:color .2s}.clickable[_ngcontent-%COMP%]:hover{color:var(--color-white)}.sections-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow-y:auto;min-height:0;gap:24px}.sections-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.sections-container.search-mode[_ngcontent-%COMP%]{overflow:hidden}.sections-container.search-mode[_ngcontent-%COMP%]   .tabs-header[_ngcontent-%COMP%]{flex:0 0 auto}.sections-container.search-mode[_ngcontent-%COMP%]   .events-section[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;padding-right:4px}.events-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.collapse-toggle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;border:none;background:var(--color-gray);color:var(--color-white);display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,transform .1s ease;z-index:calc(var(--z-sidebar) + 10)}.collapse-toggle[_ngcontent-%COMP%]:hover{background:#3a3a3a}.collapse-toggle[_ngcontent-%COMP%]:active{transform:scale(.96)}@media (max-width: 767px){.sidebar-container[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px) and (max-width: 1024px){.sidebar-container[_ngcontent-%COMP%]{padding:24px;top:20px;left:20px;z-index:var(--z-sidebar)}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:fit-content;height:72px;padding:24px;border-radius:24px;justify-content:center;align-items:center}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;margin:0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:block}}.empty-state[_ngcontent-%COMP%]{font-size:13px;font-weight:300;color:var(--color-gray-light);font-style:italic;opacity:.7;margin-bottom:8px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px;transition:background-color .2s;border:1px solid transparent}.location-item[_ngcontent-%COMP%]:hover{background:#333;border-color:#555;cursor:pointer}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--color-white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.follow-icon[_ngcontent-%COMP%]{background:var(--color-bit-gray);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;margin-left:auto}.follow-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-white)}.follow-icon[_ngcontent-%COMP%]:hover{background:#555}.follow-icon.following[_ngcontent-%COMP%]{background:var(--color-accent)}.follow-icon.following[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-black)}.show-more-btn[_ngcontent-%COMP%]{width:100%;padding:10px;background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white);border-radius:12px;cursor:pointer;font-size:13px;font-weight:500;margin-top:8px;transition:all .2s}.show-more-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:var(--color-light-gray)}']})};var gj=(i,n)=>n.id;function bee(i,n){if(i&1){let e=wt();z(0,"mat-icon",7),Te("click",function(d){Ee(e);let r=te();return r.showFilterOptions=!r.showFilterOptions,r.filterMenuOpen=!1,r.sortMenuOpen=!1,Se(d.stopPropagation())}),W(1,"tune"),V()}}function wee(i,n){if(i&1){let e=wt();z(0,"mat-icon",8),Te("click",function(d){return Ee(e),te().toggleExpand(),Se(d.stopPropagation())}),W(1,"close"),V()}}function Cee(i,n){i&1&&(z(0,"mat-icon"),W(1,"check"),V())}function Eee(i,n){if(i&1){let e=wt();z(0,"button",28),Te("click",function(d){let r=Ee(e).$implicit;return te(4).selectFilter(r),Se(d.stopPropagation())}),z(1,"span"),W(2),V(),Je(3,Cee,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=te(4);K(2),ot(a.filterLabels[e]),K(),et(a.filterOption===e?3:-1)}}function See(i,n){if(i&1&&(z(0,"div",20),Wi(1,Eee,4,2,"button",27,ka),V()),i&2){let e=te(3);K(),Zi(e.filterOrder)}}function Tee(i,n){i&1&&(z(0,"mat-icon"),W(1,"check"),V())}function Iee(i,n){if(i&1){let e=wt();z(0,"button",28),Te("click",function(d){let r=Ee(e).$implicit;return te(4).selectSort(r),Se(d.stopPropagation())}),z(1,"span"),W(2),V(),Je(3,Tee,2,0,"mat-icon"),V()}if(i&2){let e=n.$implicit,a=te(4);K(2),ot(a.sortLabels[e]),K(),et(a.sortOption===e?3:-1)}}function Mee(i,n){if(i&1&&(z(0,"div",20),Wi(1,Iee,4,2,"button",27,ka),V()),i&2){let e=te(3);K(),Zi(e.sortOrder)}}function Dee(i,n){if(i&1){let e=wt();z(0,"div",13)(1,"div",16)(2,"div",17),Te("click",function(){Ee(e);let d=te(2);return d.filterMenuOpen=!d.filterMenuOpen,Se(d.sortMenuOpen=!1)}),z(3,"div",18)(4,"mat-icon"),W(5,"filter_list"),V(),z(6,"span"),W(7),V(),z(8,"mat-icon",19),W(9),V()(),Je(10,See,3,0,"div",20),V(),z(11,"div",17),Te("click",function(){Ee(e);let d=te(2);return d.sortMenuOpen=!d.sortMenuOpen,Se(d.filterMenuOpen=!1)}),z(12,"div",18)(13,"mat-icon"),W(14,"swap_vert"),V(),z(15,"span"),W(16),V(),z(17,"mat-icon",19),W(18),V()(),Je(19,Mee,3,0,"div",20),V()(),z(20,"div",21)(21,"div",22)(22,"span"),W(23,"Price"),V(),z(24,"span",23),W(25),V()(),z(26,"div",24)(27,"input",25),Te("input",function(d){Ee(e);let r=te(2);return Se(r.onPriceMinChange(d.target.value))}),V(),z(28,"input",26),Te("input",function(d){Ee(e);let r=te(2);return Se(r.onPriceMaxChange(d.target.value))}),V()()(),z(29,"div",21)(30,"div",22)(31,"span"),W(32,"Distance"),V(),z(33,"span",23),W(34),V()(),z(35,"div",24)(36,"input",25),Te("input",function(d){Ee(e);let r=te(2);return Se(r.onDistanceMinChange(d.target.value))}),V(),z(37,"input",26),Te("input",function(d){Ee(e);let r=te(2);return Se(r.onDistanceMaxChange(d.target.value))}),V()()()()}if(i&2){let e=te(2);K(7),ot(e.filterLabels[e.filterOption]),K(2),ot(e.filterMenuOpen?"expand_less":"expand_more"),K(),et(e.filterMenuOpen?10:-1),K(6),ot(e.sortLabels[e.sortOption]),K(2),ot(e.sortMenuOpen?"expand_less":"expand_more"),K(),et(e.sortMenuOpen?19:-1),K(6),ga("\u20AC",e.priceMin.toFixed(0)," - \u20AC",e.priceMax.toFixed(0)),K(),$o("--min-percent",e.priceMinPercent)("--max-percent",e.priceMaxPercent),K(),vt("min",0)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMin),K(),vt("min",e.priceMin)("max",e.priceMaxLimit)("step",e.priceStep)("value",e.priceMax),K(6),ga("",e.distanceMin.toFixed(1)," - ",e.distanceMax.toFixed(1)," km"),K(),$o("--min-percent",e.distanceMinPercent)("--max-percent",e.distanceMaxPercent),K(),vt("min",0)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMin),K(),vt("min",e.distanceMin)("max",e.distanceMaxLimit)("step",e.distanceStep)("value",e.distanceMax)}}function Aee(i,n){if(i&1){let e=wt();z(0,"app-event-card",31),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=te(4);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)}}function Pee(i,n){i&1&&(z(0,"div",30),W(1,"No events found."),V())}function Oee(i,n){if(i&1&&(z(0,"div",15),Wi(1,Aee,1,13,"app-event-card",29,gj),Je(3,Pee,2,0,"div",30),V()),i&2){let e=te(3);K(),Zi(e.getFiltered(e.searchResults)),K(2),et(e.searchResults.length===0?3:-1)}}function Ree(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=te(5);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function kee(i,n){i&1&&(z(0,"div",30),W(1,"No events found in your area."),V())}function Fee(i,n){if(i&1&&(z(0,"div",32)(1,"div",33),W(2,"FOUND EVENTS"),V(),z(3,"div",15),Wi(4,Ree,1,14,"app-event-card",34,ka),Je(6,kee,2,0,"div",30),V()()),i&2){let e=te(4);K(4),Zi(e.getFiltered(e.foundEvents)),K(2),et(e.foundEvents.length===0?6:-1)}}function Lee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=te(5);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!0)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Nee(i,n){i&1&&(z(0,"div",30),W(1,"No upcoming events you are participating in."),V())}function zee(i,n){if(i&1){let e=wt();z(0,"app-event-card",35),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=te(5);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("isParticipating",!!e.isParticipating)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Bee(i,n){i&1&&(z(0,"div",30),W(1,"You haven't saved any events yet."),V())}function Vee(i,n){if(i&1){let e=wt();z(0,"app-event-card",37),Te("focusLocation",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.goToEvent(d))})("toggleFavorite",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.toggleFavorite.emit(d))})("shareEvent",function(){let d=Ee(e).$implicit,r=te(5);return Se(r.shareEvent.emit(d))}),V()}if(i&2){let e=n.$implicit,a=te(5);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("distance",a.formatDistance(e.distanceKm))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("showSavedCount",!1)("organizerName",e.organizerName)("organizerImage",e.organizerImage)("creatorId",e.creatorId)("currentUserId",a.userId)("showOrganizerInfo",!1)}}function Uee(i,n){i&1&&(z(0,"div",30),W(1,"No new events to discover at the moment."),V())}function jee(i,n){if(i&1&&(z(0,"div",32)(1,"div",33),W(2,"FOLLOW UP EVENTS"),V(),z(3,"div",15),Wi(4,Lee,1,14,"app-event-card",34,ka),Je(6,Nee,2,0,"div",30),V()(),z(7,"div",32)(8,"div",33),W(9,"SAVED EVENTS"),V(),z(10,"div",15),Wi(11,zee,1,14,"app-event-card",34,ka),Je(13,Bee,2,0,"div",30),V()(),z(14,"div",32)(15,"div",33),W(16,"DISCOVER EVENTS"),V(),z(17,"div",15),Wi(18,Vee,1,13,"app-event-card",36,ka),Je(20,Uee,2,0,"div",30),V()()),i&2){let e=te(4);K(4),Zi(e.getFiltered(e.followUpEvents)),K(2),et(e.followUpEvents.length===0?6:-1),K(5),Zi(e.getFiltered(e.savedEvents)),K(2),et(e.savedEvents.length===0?13:-1),K(5),Zi(e.getFiltered(e.discoverEvents)),K(2),et(e.discoverEvents.length===0?20:-1)}}function $ee(i,n){if(i&1&&Je(0,Fee,7,1,"div",32)(1,jee,21,3),i&2){let e=te(3);et(e.userId?1:0)}}function Hee(i,n){if(i&1&&Je(0,Oee,4,1,"div",15)(1,$ee,2,1),i&2){let e=te(2);et(e.isSearching&&e.hasSearchQuery?0:1)}}function Gee(i,n){if(i&1){let e=wt();z(0,"div",39),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.selectCity(d))}),z(1,"div",40)(2,"mat-icon"),W(3,"location_on"),V()(),z(4,"div",41)(5,"span",42),W(6),V()()()}if(i&2){let e=n.$implicit;K(6),ot(e.name)}}function qee(i,n){i&1&&(z(0,"div",30),W(1,"No places found."),V())}function Wee(i,n){if(i&1&&(z(0,"div",15),Wi(1,Gee,7,1,"div",38,ka),Je(3,qee,2,0,"div",30),V()),i&2){let e=te(2);K(),Zi(e.cityResults),K(2),et(e.isSearching&&e.cityResults.length===0?3:-1)}}function Zee(i,n){i&1&&(z(0,"mat-icon"),W(1,"person"),V())}function Yee(i,n){if(i&1){let e=wt();z(0,"div",39),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.openProfile(d))}),z(1,"div",40),$i(2,Zee,2,0,"mat-icon",43),V(),z(3,"div",41)(4,"span",42),W(5),V()()()}if(i&2){let e=n.$implicit;K(),$o("background-image",e.profileImage?"url("+e.profileImage+")":"")("background-size","cover"),K(),vt("ngIf",!e.profileImage),K(3),ot(e.name)}}function Xee(i,n){i&1&&(z(0,"div",30),W(1,"No creators found."),V())}function Kee(i,n){if(i&1&&(z(0,"div",15),Wi(1,Yee,6,6,"div",38,gj),Je(3,Xee,2,0,"div",30),V()),i&2){let e=te(2);K(),Zi(e.userResults),K(2),et(e.isSearching&&e.userResults.length===0?3:-1)}}function Qee(i,n){if(i&1){let e=wt();z(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),Te("click",function(){Ee(e);let d=te();return Se(d.setActiveTab("events"))}),W(4,"EVENTS"),V(),z(5,"button",12),Te("click",function(){Ee(e);let d=te();return Se(d.setActiveTab("places"))}),W(6,"PLACES"),V(),z(7,"button",12),Te("click",function(){Ee(e);let d=te();return Se(d.setActiveTab("creators"))}),W(8,"CREATORS"),V()(),Je(9,Dee,38,34,"div",13),z(10,"div",14),Je(11,Hee,2,1),Je(12,Wee,4,1,"div",15),Je(13,Kee,4,1,"div",15),V()()()}if(i&2){let e=te();K(3),an("active",e.activeTab==="events"),K(2),an("active",e.activeTab==="places"),K(2),an("active",e.activeTab==="creators"),K(2),et(e.activeTab==="events"&&e.showFilterOptions?9:-1),K(2),et(e.activeTab==="events"?11:-1),K(),et(e.activeTab==="places"?12:-1),K(),et(e.activeTab==="creators"?13:-1)}}var yb=class i{constructor(n,e,a){this.eventService=n;this.mapboxService=e;this.userService=a}focusEvent=new Vt;foundLocation=new Vt;toggleFavorite=new Vt;openUserProfile=new Vt;shareEvent=new Vt;userId=null;events=[];searchQuery="";isExpanded=!1;isSearching=!1;activeTab="events";searchResults=[];cityResults=[];userResults=[];followingMap={};followUpEvents=[];savedEvents=[];discoverEvents=[];foundEvents=[];filterOption="all";sortOption="date";priceMin=0;priceMax=100;priceMaxLimit=100;priceStep=1;distanceMin=0;distanceMax=20;distanceMaxLimit=20;distanceStep=.5;filterMenuOpen=!1;sortMenuOpen=!1;showFilterOptions=!1;filterOrder=["all","participating","free","available"];sortOrder=["date","distance","name"];filterLabels={all:"All",participating:"Participating",free:"Free",available:"Available spots"};sortLabels={date:"Date",distance:"Distance",name:"Name"};ngOnChanges(){this.categorizeEvents()}toggleExpand(){this.isExpanded=!this.isExpanded,this.isExpanded||this.clearSearch()}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.clearSearch();return}this.isSearching=!0,this.eventService.searchEvents(this.searchQuery).subscribe(n=>{this.searchResults=n}),this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(e=>({name:e.place_name,center:e.center}))}),this.userService.searchUsers(this.searchQuery).subscribe(n=>{this.userResults=n,this.checkFollowingStatuses()})}checkFollowingStatuses(){this.userId&&this.userResults.forEach(n=>{this.userService.isFollowing(this.userId,n.id.toString()).subscribe(e=>{this.followingMap[n.id]=e.isFollowing})})}followUser(n,e){e.stopPropagation(),this.userId&&this.userService.followUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!0})}unfollowUser(n,e){e.stopPropagation(),this.userId&&this.userService.unfollowUser(this.userId,n.id.toString()).subscribe(()=>{this.followingMap[n.id]=!1})}openProfile(n){this.openUserProfile.emit(n.id.toString()),this.closeSearch()}setActiveTab(n){this.activeTab=n,n!=="events"&&(this.filterMenuOpen=!1,this.sortMenuOpen=!1)}selectCity(n){let[e,a]=n.center;this.foundLocation.emit({lat:a,lng:e}),this.closeSearch()}goToEvent(n){this.focusEvent.emit(n),this.closeSearch()}clearSearch(){this.searchQuery="",this.isSearching=!1,this.searchResults=[],this.cityResults=[],this.userResults=[]}closeSearch(){this.isExpanded=!1,this.clearSearch()}get hasSearchQuery(){return this.searchQuery.trim().length>0}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",C=a&&d?`${a} - ${d}`:a||d;return[r,C].filter(Boolean).join(" | ")}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};categorizeEvents(){if(this.followUpEvents=[],this.savedEvents=[],this.discoverEvents=[],this.foundEvents=[],this.updateRangeLimits(),!this.userId){this.foundEvents=this.events.filter(this.isFutureEvent);return}this.eventService.getJoinedEvents(this.userId).subscribe(n=>{this.followUpEvents=n.filter(this.isFutureEvent)}),this.events.filter(this.isFutureEvent).forEach(n=>{let e=n.isSaved||!1,a=n.isParticipating||!1;e&&this.savedEvents.push(n),!a&&!e&&this.discoverEvents.push(n)})}updateRangeLimits(){let n=this.events.map(X=>X.costPerPerson??0),e=n.length?Math.max(...n):0,a=Math.max(10,Math.ceil(e)),d=this.events.map(X=>X.distanceKm).filter(X=>typeof X=="number"&&!Number.isNaN(X)),r=d.length?Math.max(...d):0,C=Math.max(5,Math.ceil(r)),P=this.priceMax===this.priceMaxLimit||this.priceMax===0;this.priceMaxLimit=a,(P||this.priceMax>this.priceMaxLimit)&&(this.priceMax=this.priceMaxLimit),this.priceMin>this.priceMax&&(this.priceMin=this.priceMax);let k=this.distanceMax===this.distanceMaxLimit||this.distanceMax===0;this.distanceMaxLimit=C,(k||this.distanceMax>this.distanceMaxLimit)&&(this.distanceMax=this.distanceMaxLimit),this.distanceMin>this.distanceMax&&(this.distanceMin=this.distanceMax)}applyFilters(n){let e=[...n];switch(this.filterOption){case"participating":e=e.filter(r=>!!r.isParticipating);break;case"free":e=e.filter(r=>r.costPerPerson==null||r.costPerPerson===0);break;case"available":e=e.filter(r=>r.nPartecipants==null||r.occupiedSpots==null?!0:r.nPartecipants-r.occupiedSpots>0);break}switch(this.sortOption){case"distance":e.sort((r,C)=>(r.distanceKm??999)-(C.distanceKm??999));break;case"name":e.sort((r,C)=>(r.title||"").localeCompare(C.title||""));break;case"date":default:e.sort((r,C)=>{let P=new Date(`${r.date}T${r.startTime||"00:00"}`).getTime(),k=new Date(`${C.date}T${C.startTime||"00:00"}`).getTime();return P-k});break}return(this.priceMin>0||this.priceMax<this.priceMaxLimit)&&(e=e.filter(r=>{let C=r.costPerPerson??0;return C>=this.priceMin&&C<=this.priceMax})),(this.distanceMin>0||this.distanceMax<this.distanceMaxLimit)&&(e=e.filter(r=>{let C=r.distanceKm;return C==null?!1:C>=this.distanceMin&&C<=this.distanceMax})),e}getFiltered(n){return this.applyFilters(n)}selectFilter(n){this.filterOption=n,this.filterMenuOpen=!1,this.sortMenuOpen=!1}selectSort(n){this.sortOption=n,this.sortMenuOpen=!1,this.filterMenuOpen=!1}get priceMinPercent(){return this.priceMaxLimit?`${this.priceMin/this.priceMaxLimit*100}%`:"0%"}get priceMaxPercent(){return this.priceMaxLimit?`${this.priceMax/this.priceMaxLimit*100}%`:"100%"}get distanceMinPercent(){return this.distanceMaxLimit?`${this.distanceMin/this.distanceMaxLimit*100}%`:"0%"}get distanceMaxPercent(){return this.distanceMaxLimit?`${this.distanceMax/this.distanceMaxLimit*100}%`:"100%"}onPriceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.priceMax));this.priceMin=Number.isNaN(e)?this.priceMin:e}onPriceMaxChange(n){let e=Math.min(this.priceMaxLimit,Math.max(Number(n),this.priceMin));this.priceMax=Number.isNaN(e)?this.priceMax:e}onDistanceMinChange(n){let e=Math.max(0,Math.min(Number(n),this.distanceMax));this.distanceMin=Number.isNaN(e)?this.distanceMin:e}onDistanceMaxChange(n){let e=Math.min(this.distanceMaxLimit,Math.max(Number(n),this.distanceMin));this.distanceMax=Number.isNaN(e)?this.distanceMax:e}static \u0275fac=function(e){return new(e||i)(Dt(Xs),Dt(zu),Dt(Es))};static \u0275cmp=vn({type:i,selectors:[["app-mobile-search"]],inputs:{userId:"userId",events:"events"},outputs:{focusEvent:"focusEvent",foundLocation:"foundLocation",toggleFavorite:"toggleFavorite",openUserProfile:"openUserProfile",shareEvent:"shareEvent"},features:[Br],decls:8,vars:7,consts:[[1,"mobile-search-wrapper"],[1,"floating-search-bar",3,"click"],[1,"search-icon"],["type","text","placeholder","Search events, cities or people",1,"pill-input",3,"ngModelChange","keyup.enter","focus","ngModel","readonly"],["class","options-icon",3,"click",4,"ngIf"],["class","close-icon",3,"click",4,"ngIf"],["class","search-overlay",4,"ngIf"],[1,"options-icon",3,"click"],[1,"close-icon",3,"click"],[1,"search-overlay"],[1,"search-results-container"],[1,"tabs-header"],[1,"tab-btn",3,"click"],[1,"filter-sort-container"],[1,"results-scroll-area"],[1,"list-view"],[1,"filter-row"],[1,"pill","dropdown",3,"click"],[1,"pill-inner"],[1,"chevron"],[1,"dropdown-menu"],[1,"range-filter"],[1,"range-header"],[1,"range-value"],[1,"range-inputs","dual"],["type","range",1,"min-range",3,"input","min","max","step","value"],["type","range",1,"max-range",3,"input","min","max","step","value"],[1,"menu-item"],[1,"menu-item",3,"click"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"empty-state"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId"],[1,"mobile-section"],[1,"section-title"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","isParticipating","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[3,"focusLocation","toggleFavorite","shareEvent","title","location","dateTime","distance","id","isSaved","savedCount","showSavedCount","organizerName","organizerImage","creatorId","currentUserId","showOrganizerInfo"],[1,"location-item","clickable"],[1,"location-item","clickable",3,"click"],[1,"icon-circle"],[1,"loc-info"],[1,"loc-name"],[4,"ngIf"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1),Te("click",function(){return!a.isExpanded&&a.toggleExpand()}),z(2,"mat-icon",2),W(3,"search"),V(),z(4,"input",3),vo("ngModelChange",function(r){return To(a.searchQuery,r)||(a.searchQuery=r),r}),Te("keyup.enter",function(){return a.onSearch()})("focus",function(){return!a.isExpanded&&a.toggleExpand()}),V(),$i(5,bee,2,0,"mat-icon",4)(6,wee,2,0,"mat-icon",5),V(),$i(7,Qee,14,10,"div",6),V()),e&2&&(an("expanded",a.isExpanded),K(4),_o("ngModel",a.searchQuery),vt("readonly",!a.isExpanded),K(),vt("ngIf",a.isExpanded&&a.activeTab==="events"),K(),vt("ngIf",a.isExpanded),K(),vt("ngIf",a.isExpanded))},dependencies:[fi,cs,Ba,Cs,Ys,va,Pi,Ai,tp],styles:['.mobile-search-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:80px;left:20px;z-index:var(--z-sidebar);transition:all .3s cubic-bezier(.25,.8,.25,1)}@media (max-width: 767px){.mobile-search-wrapper[_ngcontent-%COMP%]{bottom:40px}}.mobile-search-wrapper.expanded[_ngcontent-%COMP%]{inset:0;z-index:10000}.floating-search-bar[_ngcontent-%COMP%]{background:var(--color-dark-gray);height:50px;border-radius:25px;display:flex;align-items:center;padding:0 16px;box-shadow:0 4px 12px #0000004d;border:1px solid var(--color-light-gray);gap:12px;cursor:pointer;z-index:10001;position:absolute;bottom:0;width:100%}.expanded[_ngcontent-%COMP%]   .floating-search-bar[_ngcontent-%COMP%]{inset:20px 20px auto;width:calc(100% - 40px);border-radius:12px}.pill-input[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--color-white);font-size:14px;flex:1;outline:none}.search-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.search-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--color-dark-gray);z-index:9999;display:flex;flex-direction:column;padding-top:90px;animation:_ngcontent-%COMP%_searchSlideUp .3s cubic-bezier(.25,.8,.25,1)}@keyframes _ngcontent-%COMP%_searchSlideUp{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.search-results-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:0 20px 20px;gap:20px;overflow:hidden}.tabs-header[_ngcontent-%COMP%]{display:flex;gap:8px;padding-bottom:8px;overflow-x:auto}.tab-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;padding:8px 16px;color:var(--color-white);font-size:12px;font-weight:600;border-radius:20px;white-space:nowrap}.tab-btn.active[_ngcontent-%COMP%]{background:var(--color-accent);color:var(--color-black)}.results-scroll-area[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--color-gray);border-radius:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background:var(--color-bit-gray);display:flex;align-items:center;justify-content:center}.loc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loc-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;opacity:.5;font-style:italic}.search-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.options-icon[_ngcontent-%COMP%], .close-icon[_ngcontent-%COMP%]{color:var(--color-gray-light);font-size:20px;width:20px;height:20px}.filter-sort-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:0 0 10px;overflow:visible}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.range-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray)}.range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--color-white)}.range-value[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:600}.range-inputs[_ngcontent-%COMP%]{display:grid;gap:6px}.range-inputs.dual[_ngcontent-%COMP%]{position:relative;height:24px;display:flex;align-items:center;gap:0}.range-inputs.dual[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;right:0;height:4px;border-radius:999px;background:#ffffff2e}.range-inputs.dual[_ngcontent-%COMP%]:after{content:"";position:absolute;left:var(--min-percent, 0%);right:calc(100% - var(--max-percent, 100%));height:4px;border-radius:999px;background:var(--color-accent)}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{position:absolute;left:0;right:0;width:100%;height:24px;margin:0;background:none;pointer-events:none;-webkit-appearance:none}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{pointer-events:auto;-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-track{background:transparent}.range-inputs.dual[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{pointer-events:auto;height:16px;width:16px;border-radius:50%;background:var(--color-accent);border:2px solid #0f0f0f}.range-inputs.dual[_ngcontent-%COMP%]   .min-range[_ngcontent-%COMP%]{z-index:2}.range-inputs.dual[_ngcontent-%COMP%]   .max-range[_ngcontent-%COMP%]{z-index:3}.range-inputs[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:100%;accent-color:var(--color-accent)}.mobile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{color:var(--color-accent);font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}.pill[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;padding:0;border-radius:12px;border:1px solid var(--color-bit-gray);background:var(--color-gray);color:var(--color-white);cursor:pointer;font-size:11px;min-width:120px}.pill-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;gap:6px}.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;margin-top:6px;background:var(--color-gray);border:1px solid var(--color-bit-gray);border-radius:10px;box-shadow:0 8px 20px #00000059;min-width:160px;z-index:10002;padding:4px}.menu-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:none;background:transparent;color:var(--color-white);font-size:13px;border-radius:8px}.menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.chevron[_ngcontent-%COMP%]{margin-left:auto}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.clickable[_ngcontent-%COMP%]{cursor:pointer}']})};var g6=Pw(IR());function qte(i,n){if(i&1&&An(0,"img",8),i&2){let e=te(2);vt("src",e.posterPreviewUrl,no)}}function Wte(i,n){i&1&&(z(0,"div",9),W(1,"Anteprima in generazione..."),V())}function Zte(i,n){if(i&1){let e=wt();z(0,"div",1),Te("click",function(){Ee(e);let d=te();return Se(d.close.emit())}),z(1,"div",2),Te("click",function(d){return Ee(e),Se(d.stopPropagation())}),z(2,"div",3)(3,"div",4)(4,"span"),W(5,"Share Event"),V()(),z(6,"button",5),Te("click",function(){Ee(e);let d=te();return Se(d.close.emit())}),z(7,"mat-icon"),W(8,"close"),V()()(),z(9,"div",6)(10,"div",7),Je(11,qte,1,1,"img",8)(12,Wte,2,0,"div",9),V(),z(13,"div",10)(14,"button",11),Te("click",function(){Ee(e);let d=te();return Se(d.downloadPoster())}),z(15,"mat-icon"),W(16,"download"),V(),z(17,"span"),W(18),V()(),z(19,"button",12),Te("click",function(){Ee(e);let d=te();return Se(d.shareLink())}),z(20,"mat-icon"),W(21,"link"),V(),z(22,"span"),W(23,"Share link"),V()()()()()()}if(i&2){let e=te();K(10),$o("background-image","url("+e.templateUrl+")"),K(),et(e.posterPreviewUrl?11:12),K(3),vt("disabled",e.downloading),K(4),ot(e.downloading?"Generating...":"Download poster")}}var x0=class i{constructor(n){this.snackBar=n}event=null;close=new Vt;templateUrl="assets/img/LocandinaTemplate.png";downloading=!1;posterPreviewUrl="";posterWidth=1080;posterHeight=1350;infoArea={x:50,y:190,width:590};qrSquare={x:325,y:831,size:430};previewToken=0;ngOnChanges(n){n.event&&this.buildPreview()}getShareLink(n=this.event){if(!n)return"";let e=window.location.protocol,a=window.location.host;return`${e}//${a}/?event=${n.id}`}getQrCodeUrl(n=220,e=this.event){let a=this.getShareLink(e);return a?`https://api.qrserver.com/v1/create-qr-code/?size=${n}x${n}&margin=0&data=${encodeURIComponent(a)}`:""}buildPreview(){return Sr(this,null,function*(){let n=++this.previewToken;if(!this.event){this.posterPreviewUrl="";return}try{let e=yield this.renderPoster(this.event);if(n!==this.previewToken)return;this.posterPreviewUrl=e.toDataURL("image/png")}catch(e){console.error("Failed to generate poster preview",e),n===this.previewToken&&(this.posterPreviewUrl="")}})}downloadPoster(){return Sr(this,null,function*(){let n=this.event;if(!(!n||this.downloading)){this.downloading=!0;try{let e=yield this.renderPoster(n),a=yield new Promise(C=>e.toBlob(C,"image/png"));if(!a)throw new Error("Unable to generate poster");let d=`lumo-event-${n.id}.png`,r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=d,r.click(),setTimeout(()=>URL.revokeObjectURL(r.href),1e3)}catch(e){console.error("Failed to download poster",e),this.showToast("Unable to generate the poster. You can share the link instead.","error")}finally{this.downloading=!1}}})}shareLink(){return Sr(this,null,function*(){let n=this.getShareLink();if(!(!n||!this.event)){if(navigator.share)try{yield navigator.share({title:this.event.title,text:"Check out this event on Lumo",url:n});return}catch(e){console.warn("Share cancelled or failed",e)}this.copyShareLink()}})}copyShareLink(){let n=this.getShareLink();n&&navigator.clipboard.writeText(n).then(()=>{this.showToast("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy link: ",e),this.showToast("Unable to copy the link.","error")})}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1600:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",C=a&&d?`${a} - ${d}`:a||d;return[r,C].filter(Boolean).join(" | ")}formatCost(n){return n.costPerPerson==null||n.costPerPerson===0?"Free":`\u20AC${n.costPerPerson} per person`}formatLocation(n){return n.city||"Location TBD"}ensureFontsLoaded(){return Sr(this,null,function*(){if("fonts"in document)try{yield document.fonts.ready}catch(n){console.warn("Fonts not ready",n)}})}loadImage(n){return new Promise((e,a)=>{let d=new Image;d.crossOrigin="anonymous",d.onload=()=>e(d),d.onerror=()=>a(new Error("Failed to load image")),d.src=n})}renderPoster(n){return Sr(this,null,function*(){yield this.ensureFontsLoaded();let e=document.createElement("canvas");e.width=this.posterWidth,e.height=this.posterHeight;let a=e.getContext("2d");if(!a)throw new Error("Unable to render poster");let d=yield this.loadImage(this.templateUrl);a.drawImage(d,0,0,this.posterWidth,this.posterHeight),a.textAlign="left",a.textBaseline="top";let r=n.title||"Lumo Event",C=this.infoArea.x,P=this.infoArea.width,k=this.infoArea.y;a.fillStyle="#FCC324",a.font='700 56px "Stack Sans Headline", Arial, sans-serif',k=this.drawWrappedText(a,r,C,k,P,64,2),k+=12;let X=this.formatDateTime(n);X&&(a.fillStyle="#FCC324",a.font='600 32px "Stack Sans Headline", Arial, sans-serif',a.fillText(X,C,k),k+=40),a.fillStyle="#FFFFFF",a.font='500 30px "Stack Sans Headline", Arial, sans-serif',a.fillText(this.formatLocation(n),C,k),k+=38,a.fillText(this.formatCost(n),C,k),k+=38,n.organizerName&&(a.fillStyle="#B0B0B0",a.font='500 26px "Stack Sans Headline", Arial, sans-serif',a.fillText(`Eventer: ${n.organizerName}`,C,k),k+=32),n.description&&(a.fillStyle="#B0B0B0",a.font='400 24px "Stack Sans Headline", Arial, sans-serif',k=this.drawWrappedText(a,n.description,C,k+6,P,30,3));let oe=20,Me=12,$e=24,ke=this.qrSquare.size+oe*2,ht=this.qrSquare.x-oe,Nt=this.qrSquare.y-oe,Mt=ke-Me*2,Xt=ht+Me,Vn=Nt+Me,sr=this.getShareLink(n),Hi="";try{Hi=yield g6.toDataURL(sr,{width:Mt,margin:0,color:{dark:"#000000",light:"#ffffff"}})}catch(Ni){console.error("Local QR generation failed",Ni)}if(Hi){let Ni=yield this.loadImage(Hi);a.save(),this.drawRoundedRect(a,ht,Nt,ke,ke,$e),a.clip(),a.fillStyle="#FFFFFF",a.fill(),a.drawImage(Ni,Xt,Vn,Mt,Mt),a.restore()}return e})}drawRoundedRect(n,e,a,d,r,C){let P=Math.max(0,Math.min(C,d/2,r/2));n.beginPath(),n.moveTo(e+P,a),n.arcTo(e+d,a,e+d,a+r,P),n.arcTo(e+d,a+r,e,a+r,P),n.arcTo(e,a+r,e,a,P),n.arcTo(e,a,e+d,a,P),n.closePath()}drawWrappedText(n,e,a,d,r,C,P){let k=e.split(" "),X="",oe=0;for(let Me of k){let $e=X?`${X} ${Me}`:Me;if(n.measureText($e).width>r&&X){if(n.fillText(this.truncateToWidth(n,X,r,oe===P-1),a,d),X=Me,d+=C,oe+=1,oe>=P)return d}else X=$e}if(X&&oe<P){let Me=oe===P-1;n.fillText(this.truncateToWidth(n,X,r,Me),a,d),d+=C}return d}truncateToWidth(n,e,a,d){if(!d||n.measureText(e).width<=a)return e;let r=e;for(;r.length>0;){let C=`${r}...`;if(n.measureText(C).width<=a)return C;r=r.slice(0,-1)}return e}static \u0275fac=function(e){return new(e||i)(Dt(zc))};static \u0275cmp=vn({type:i,selectors:[["app-event-share-modal"]],inputs:{event:"event"},outputs:{close:"close"},features:[Br],decls:1,vars:1,consts:[[1,"event-share-backdrop"],[1,"event-share-backdrop",3,"click"],[1,"event-share-modal",3,"click"],[1,"event-share-header"],[1,"header-title"],[1,"close-btn",3,"click"],[1,"event-share-content"],[1,"poster-preview"],["alt","Event poster",1,"poster-preview-image",3,"src"],[1,"poster-preview-loading"],[1,"share-actions"],[1,"button","action-btn",3,"click","disabled"],[1,"button","action-btn","secondary",3,"click"]],template:function(e,a){e&1&&Je(0,Zte,24,5,"div",0),e&2&&et(a.event?0:-1)},dependencies:[fi,Pi,Ai,Fu],styles:['.event-share-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-popup);display:flex;align-items:center;justify-content:center;padding:20px}.event-share-modal[_ngcontent-%COMP%]{width:min(560px,94vw);background:var(--modal-surface);border:var(--modal-border);border-radius:var(--modal-radius);box-shadow:var(--modal-shadow);padding:14px 14px 18px;display:flex;flex-direction:column;gap:16px}.event-share-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-white);font-weight:600;font-size:16px}.header-title[_ngcontent-%COMP%]:before{content:"";width:10px;height:10px;display:inline-block}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.event-share-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.poster-preview[_ngcontent-%COMP%]{position:relative;width:min(500px,100%);aspect-ratio:4 / 5;border-radius:18px;border:1px solid var(--color-bit-gray);overflow:hidden;background-position:center;background-size:cover;background-color:#0b0b0b}.poster-preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.poster-preview-loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:grid;place-items:center;color:#cfcfcf;font-size:13px;background:#00000059}.share-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;align-items:center;justify-content:center;width:100%}.action-btn[_ngcontent-%COMP%]{gap:8px;width:210px;justify-content:center;font-weight:var(--font-weight-semibold)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:inherit}.action-btn.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-bit-gray);color:var(--color-white)}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:default}@media (max-width: 767px){.event-share-modal[_ngcontent-%COMP%]{padding:16px}.event-share-content[_ngcontent-%COMP%]{width:100%}.share-actions[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;justify-content:center}.action-btn[_ngcontent-%COMP%]{flex:1 1 140px;justify-content:center;width:auto}}']})};function Yte(i,n){if(i&1){let e=wt();z(0,"app-event-share-modal",5),Te("close",function(){Ee(e);let d=te();return Se(d.sharingEvent=null)}),V()}if(i&2){let e=te();vt("event",e.sharingEvent)}}var sp=document.createElement("div");sp.style.width="20px";sp.style.height="20px";sp.style.backgroundColor="#4285F4";sp.style.border="3px solid white";sp.style.borderRadius="50%";sp.style.boxShadow="0 0 3px rgba(0,0,0,0.3)";var Mb=class i{constructor(n,e){this.eventService=n;this.snackBar=e}userId=null;eventSelected=new Vt;mapInteract=new Vt;eventsUpdated=new Vt;openUserProfile=new Vt;mapInstance;eventMarkers=new Map;events=[];sharingEvent=null;userCoords=null;sidebarCollapsed=!1;managedPopupType=null;sidebar;mobileSearch;pollSubscription=null;get map(){return this.mapInstance}getEventScreenPosition(n){if(!n.latitude||!n.longitude||!this.mapInstance)return null;let e=this.mapInstance.project([n.longitude,n.latitude]);return{x:e.x,y:e.y}}ngOnChanges(n){n.userId&&!n.userId.isFirstChange()&&(this.resetSearch(),this.loadEvents(),this.startPolling())}resetSearch(){this.sidebar&&this.sidebar.clearSearch(),this.mobileSearch&&this.mobileSearch.clearSearch()}ngAfterViewInit(){this.mapInstance=new b0.Map({accessToken:ul.mapboxToken,container:"map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:18,pitch:60,bearing:-20,antialias:!0}),this.mapInstance.dragPan.enable(),this.mapInstance.touchZoomRotate.enable({around:"center"}),this.mapInstance.touchZoomRotate.disableRotation(),this.mapInstance.touchZoomRotate.enable(),this.mapInstance.on("move",n=>{n.originalEvent&&this.mapInteract.emit()}),this.mapInstance.on("moveend",()=>this.updateVisibleMarkers()),this.mapInstance.on("zoomend",()=>this.updateVisibleMarkers()),this.mapInstance.on("click",n=>{n.originalEvent&&this.mapInteract.emit()}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.setCenter(this.userCoords),new b0.Marker({element:sp}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>{console.warn("Geolocation error:",n)},{enableHighAccuracy:!0}),this.loadEvents(),this.startPolling()}ngOnDestroy(){this.map&&this.mapInstance.remove(),this.eventMarkers.forEach(n=>n.remove()),this.stopPolling()}startPolling(){this.stopPolling(),this.pollSubscription=pf(1e4).pipe(So(()=>this.eventService.getEvents(this.userId||void 0))).subscribe({next:n=>{this.handleEventsUpdate(n)},error:n=>console.error("Error polling events",n)})}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}isFutureEvent(n){if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()}handleEventsUpdate(n){let e=n.filter(r=>this.isFutureEvent(r)),a=JSON.stringify(this.events.map(r=>({id:r.id,status:r.participationStatus,saved:r.isSaved,savedCount:r.savedCount}))),d=JSON.stringify(e.map(r=>({id:r.id,status:r.participationStatus,saved:r.isSaved,savedCount:r.savedCount})));(this.events.length!==e.length||a!==d)&&(this.events=e,this.updateDistancesAndSort(),this.placeEventMarkers(),this.eventsUpdated.emit(this.events))}loadEvents(){this.eventService.getEvents(this.userId||void 0).subscribe({next:n=>{this.events=n.filter(e=>this.isFutureEvent(e)),this.updateDistancesAndSort(),this.placeEventMarkers()},error:n=>{console.error("Error fetching events",n)}})}placeEventMarkers(){this.updateVisibleMarkers()}updateVisibleMarkers(){if(!this.mapInstance)return;let n=this.mapInstance.getBounds();if(!n)return;let e=this.events.filter(d=>d.latitude==null||d.longitude==null?!1:n.contains([d.longitude,d.latitude]));e.length>100&&(e=e.slice(0,100));let a=new Set(e.map(d=>d.id));this.eventMarkers.forEach((d,r)=>{a.has(r)||(d.remove(),this.eventMarkers.delete(r))}),e.forEach(d=>{if(typeof d.id=="number"&&!this.eventMarkers.has(d.id)){if(d.latitude==null||d.longitude==null)return;let r=document.createElement("div");r.className="golden-pulse-marker";let C=new b0.Marker({element:r}).setLngLat([d.longitude,d.latitude]).addTo(this.map);r.addEventListener("click",P=>{P.stopPropagation(),this.flyToEvent(d)}),this.eventMarkers.set(d.id,C)}})}flyToEvent(n){!this.map||n.longitude==null||n.latitude==null||(this.mapInstance.flyTo({center:[n.longitude,n.latitude],zoom:18,essential:!0,duration:1e3}),this.eventSelected.emit(n))}flyToLocation(n){this.map&&this.mapInstance.flyTo({center:[n.lng,n.lat],zoom:17,essential:!0,duration:1500})}flyToUser(){if(this.map){if(this.userCoords){this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),this.updateDistancesAndSort(),this.placeEventMarkers();return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.userCoords=[n.coords.longitude,n.coords.latitude],this.mapInstance.flyTo({center:this.userCoords,zoom:16,essential:!0,duration:800}),new b0.Marker({element:sp}).setLngLat(this.userCoords).addTo(this.map),this.updateDistancesAndSort(),this.placeEventMarkers()},n=>console.warn("Geolocation error:",n),{enableHighAccuracy:!0})}}updateDistancesAndSort(){if(!this.userCoords||!this.events.length)return;let[n,e]=this.userCoords;this.events=this.events.map(a=>Ci(Ht({},a),{distanceKm:this.computeDistanceKm(e,n,a.latitude,a.longitude)})).sort((a,d)=>(a.distanceKm??Number.POSITIVE_INFINITY)-(d.distanceKm??Number.POSITIVE_INFINITY))}computeDistanceKm(n,e,a,d){if(a==null||d==null)return;let r=6371,C=this.deg2rad(a-n),P=this.deg2rad(d-e),k=Math.sin(C/2)*Math.sin(C/2)+Math.cos(this.deg2rad(n))*Math.cos(this.deg2rad(a))*Math.sin(P/2)*Math.sin(P/2),X=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k));return r*X}deg2rad(n){return n*(Math.PI/180)}formatDistance(n){return n==null?"":n<1?`${(n*1e3).toFixed(0)} m`:`${n.toFixed(1)} km`}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}requestLogin=new Vt;onToggleFavorite(n){if(!this.userId){this.snackBar.open("You must sign in to save events.","SIGN IN",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["login-snackbar"]}).onAction().subscribe(()=>{this.requestLogin.emit()});return}n.id&&this.eventService.toggleSavedEvent(this.userId,n.id).subscribe({next:e=>{let a=!!n.isSaved,d=typeof n.savedCount=="number"?n.savedCount:0;n.isSaved=e.isSaved,e.isSaved&&!a?n.savedCount=d+1:!e.isSaved&&a?n.savedCount=Math.max(0,d-1):(n.savedCount===void 0||n.savedCount===null)&&(n.savedCount=d);let r=this.events.find(C=>C.id===n.id);r&&r!==n&&(r.isSaved=n.isSaved,r.savedCount=n.savedCount),this.events=[...this.events]},error:e=>console.error("Error toggling favorite",e)})}openShare(n){this.sharingEvent=n}static \u0275fac=function(e){return new(e||i)(Dt(Xs),Dt(zc))};static \u0275cmp=vn({type:i,selectors:[["map-view"]],viewQuery:function(e,a){if(e&1&&(Fa(vb,5),Fa(yb,5)),e&2){let d;fa(d=ma())&&(a.sidebar=d.first),fa(d=ma())&&(a.mobileSearch=d.first)}},inputs:{userId:"userId"},outputs:{eventSelected:"eventSelected",mapInteract:"mapInteract",eventsUpdated:"eventsUpdated",openUserProfile:"openUserProfile",requestLogin:"requestLogin"},features:[Br],decls:7,vars:6,consts:[[3,"focusEvent","toggleSidebar","toggleFavorite","foundLocation","shareEvent","openUserProfile","events","collapsed","userId"],[3,"focusEvent","foundLocation","toggleFavorite","shareEvent","openUserProfile","events","userId"],[3,"event"],["id","map",1,"map-container"],[1,"locate-btn",3,"click"],[3,"close","event"]],template:function(e,a){e&1&&(z(0,"app-sidebar",0),Te("focusEvent",function(r){return a.flyToEvent(r)})("toggleSidebar",function(){return a.toggleSidebar()})("toggleFavorite",function(r){return a.onToggleFavorite(r)})("foundLocation",function(r){return a.flyToLocation(r)})("shareEvent",function(r){return a.openShare(r)})("openUserProfile",function(r){return a.openUserProfile.emit(r)}),V(),z(1,"app-mobile-search",1),Te("focusEvent",function(r){return a.flyToEvent(r)})("foundLocation",function(r){return a.flyToLocation(r)})("toggleFavorite",function(r){return a.onToggleFavorite(r)})("shareEvent",function(r){return a.openShare(r)})("openUserProfile",function(r){return a.openUserProfile.emit(r)}),V(),Je(2,Yte,1,1,"app-event-share-modal",2),An(3,"div",3),z(4,"button",4),Te("click",function(){return a.flyToUser()}),z(5,"mat-icon"),W(6,"my_location"),V()()),e&2&&(vt("events",a.events)("collapsed",a.sidebarCollapsed)("userId",a.userId),K(),vt("events",a.events)("userId",a.userId),K(),et(a.sharingEvent?2:-1))},dependencies:[vb,yb,x0,Pi,Ai,Fu,fi],styles:['.map-container[_ngcontent-%COMP%]{width:100%;height:100vh}.locate-btn[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px;width:48px;height:48px;border-radius:50%;border:1px solid var(--color-light-gray);background:var(--color-dark-gray);box-shadow:0 2px 8px #00000040;display:grid;place-items:center;cursor:pointer;transition:box-shadow .2s ease,transform .1s ease,background-color .2s}.locate-btn[_ngcontent-%COMP%]:hover{background:#333;box-shadow:0 4px 12px #0000004d}.locate-btn[_ngcontent-%COMP%]:active{transform:scale(.96)}.locate-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}app-mobile-search[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){app-mobile-search[_ngcontent-%COMP%]{display:block}.locate-btn[_ngcontent-%COMP%]{bottom:40px}}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content{background:var(--color-dark-gray);color:#f5f5f5;border:1px solid var(--color-gray);box-shadow:0 4px 12px #00000059;border-radius:10px}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-content strong{color:#fbbc04}[_nghost-%COMP%]     .mapboxgl-popup.event-popup .mapboxgl-popup-tip{border-top-color:var(--color-dark-gray)}[_nghost-%COMP%]     .golden-pulse-marker{width:40px;height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;background:transparent}[_nghost-%COMP%]     .golden-pulse-marker:after{content:"";position:absolute;width:14px;height:14px;background-color:#fcc324;border:2px solid white;border-radius:3px;transform:rotate(45deg);box-shadow:0 0 10px #fcc324cc;z-index:2;animation:_ngcontent-%COMP%_corePulse 3s infinite ease-in-out}[_nghost-%COMP%]     .golden-pulse-marker:before{content:"";position:absolute;width:100%;height:100%;background:radial-gradient(circle,#fcc32466,#fcc32400 70%);border-radius:50%;z-index:1;opacity:.6;animation:_ngcontent-%COMP%_glowPulse 2.5s infinite ease-in-out}@keyframes _ngcontent-%COMP%_corePulse{0%,to{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:.8;transform:rotate(45deg) scale(.9)}}@keyframes _ngcontent-%COMP%_glowPulse{0%,to{opacity:.2;transform:scale(.8)}50%{opacity:.7;transform:scale(1.2)}}']})};function Xte(i,n){if(i&1&&An(0,"textarea",1),i&2){let e=te();vt("formControl",e.control)("placeholder",e.placeholder)}}function Kte(i,n){if(i&1&&(z(0,"span",5),W(1),V()),i&2){let e=te(2);K(),ot(e.placeholder)}}function Qte(i,n){if(i&1){let e=wt();z(0,"button",7),Te("click",function(d){Ee(e);let r=te(2);return Se(r.togglePasswordVisibility(d))}),z(1,"mat-icon"),W(2),V()()}if(i&2){let e=te(2);K(2),ot(e.showPassword?"visibility_off":"visibility")}}function Jte(i,n){if(i&1&&(z(0,"div",3),An(1,"input",4),Je(2,Kte,2,1,"span",5),Je(3,Qte,3,1,"button",6),V()),i&2){let e=te();an("with-toggle",e.showToggle&&e.type==="password"),K(),an("date-input",e.type==="date")("has-value",e.type==="date"&&!!(e.control!=null&&e.control.value)),vt("formControl",e.control)("type",e.inputType)("placeholder",e.placeholder),Ro("min",e.min),K(),et(e.type==="date"&&!(e.control!=null&&e.control.value)?2:-1),K(),et(e.showToggle&&e.type==="password"?3:-1)}}var Bu=class i{control=null;type="text";placeholder="";error=!1;customClass="";showToggle=!1;min=null;showPassword=!1;get inputType(){return this.showToggle&&this.type==="password"?this.showPassword?"text":"password":this.type}togglePasswordVisibility(n){n.stopPropagation(),this.showToggle&&this.type==="password"&&(this.showPassword=!this.showPassword)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=vn({type:i,selectors:[["FormField"]],inputs:{control:"control",type:"type",placeholder:"placeholder",error:"error",customClass:"customClass",showToggle:"showToggle",min:"min"},decls:3,vars:4,consts:[[1,"input-wrapper",3,"ngClass"],[1,"input-field",3,"formControl","placeholder"],[1,"input-with-toggle",3,"with-toggle"],[1,"input-with-toggle"],[1,"input-field",3,"formControl","type","placeholder"],[1,"date-placeholder"],["type","button",1,"toggle-btn"],["type","button",1,"toggle-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Je(1,Xte,1,2,"textarea",1)(2,Jte,4,12,"div",2),V()),e&2&&(an("error",a.error),vt("ngClass",a.customClass),K(),et(a.type==="textarea"?1:2))},dependencies:[Nu,Cs,Ys,iR,fi,bP,Pi,Ai],styles:[".form-field[_ngcontent-%COMP%]{font:var(--font-stack-headline);display:block;min-width:0;min-height:50px;max-width:500px;padding:0 var(--spacing-md);border-radius:var(--radius-lg);background-color:var(--color-gray);border:none;color:var(--color-white);font-size:16px}.form-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray);font-weight:var(--font-weight-light)}.form-field[_ngcontent-%COMP%]:focus{outline:none}input[type=date][_ngcontent-%COMP%]{color:var(--color-light-gray)}.input-wrapper[_ngcontent-%COMP%]{width:100%;position:relative;box-sizing:border-box}.input-wrapper.tall-field[_ngcontent-%COMP%]{height:80px}.input-wrapper.tall-field[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{height:100%;resize:none;padding-top:12px}.input-with-toggle[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.date-input[_ngcontent-%COMP%]{color:transparent}.date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-text, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-month-field, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-day-field, .date-input[_ngcontent-%COMP%]:not(.has-value)::-webkit-datetime-edit-year-field{color:transparent}.date-input.has-value[_ngcontent-%COMP%]{color:var(--color-white)}.date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-text, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-month-field, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-day-field, .date-input.has-value[_ngcontent-%COMP%]::-webkit-datetime-edit-year-field{color:var(--color-white)}.date-placeholder[_ngcontent-%COMP%]{position:absolute;left:var(--spacing-md);top:50%;transform:translateY(-50%);color:var(--color-light-gray);font-weight:var(--font-weight-light);pointer-events:none}.input-with-toggle.with-toggle[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{padding-right:42px}.toggle-btn[_ngcontent-%COMP%]{position:absolute;right:10px;background:transparent;border:none;color:#bbb;cursor:pointer;display:grid;place-items:center;padding:4px}.toggle-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.input-field[_ngcontent-%COMP%]{width:100%;height:50px;padding:0 var(--spacing-md);background-color:var(--color-gray);border:2px solid rgba(255,255,255,.12);border-radius:var(--radius-lg);color:var(--color-white);font-size:16px;font-family:inherit;font-weight:var(--font-weight-light);outline:none;box-sizing:border-box;transition:border-color .2s}.input-field[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.input-field[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.input-wrapper.error[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{border-color:var(--color-error)}input[_ngcontent-%COMP%]:-webkit-autofill, input[_ngcontent-%COMP%]:-webkit-autofill:hover, input[_ngcontent-%COMP%]:-webkit-autofill:focus, input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px var(--color-gray) inset!important;-webkit-text-fill-color:var(--color-white)!important;transition:background-color 5000s ease-in-out 0s;caret-color:var(--color-white)}"]})};function MR(i){let n=i.value?.trim();return/^[A-Za-z---\s]+$/.test(n)?null:{onlyLetters:!0}}function DR(i){let n=i.value;if(!n)return{adult:!0};let e=new Date(n);return new Date().getFullYear()-e.getFullYear()<18?{adult:!0}:null}function rm(i){let n=i.value?.trim();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?null:{emailInvalid:!0}}function Hd(i){let n=i.value;return/^(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(n)?null:{weakPassword:!0}}var Wl=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/auth";signUp(n){return console.log("Payload inviato:",n),this.http.post(`${this.baseUrl}/signup`,n)}login(n){return this.http.post(`${this.baseUrl}/login`,n)}loginWithGoogle(n){return this.http.post(`${this.baseUrl}/login/google`,n)}loginWithGoogleCode(n){return this.http.post(`${this.baseUrl}/login/google/code`,n)}requestPasswordReset(n){return this.http.post(`${this.baseUrl}/password-reset/request`,n)}confirmPasswordReset(n){return this.http.post(`${this.baseUrl}/password-reset/confirm`,n)}verifyEmail(n){return this.http.get(`${this.baseUrl}/verify?token=${n}`)}resendEmail(n){return this.http.post(`${this.baseUrl}/resend-token`,n)}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var w0=class i{scriptLoadingPromise=null;loadScript(){return this.scriptLoadingPromise?this.scriptLoadingPromise:(this.scriptLoadingPromise=new Promise((n,e)=>{if(document.getElementById("google-identity")){n();return}let a=document.createElement("script");a.id="google-identity",a.src="https://accounts.google.com/gsi/client",a.async=!0,a.defer=!0,a.onload=()=>n(),a.onerror=()=>e(new Error("Unable to load Google Identity Services")),document.head.appendChild(a)}),this.scriptLoadingPromise)}getAuthCode(){return Sr(this,null,function*(){if(yield this.loadScript(),!ul.googleClientId)throw new Error("Configure the Google Client ID.");let n=ul.googleRedirectUri||window.location.origin;return new Promise((e,a)=>{google.accounts.oauth2.initCodeClient({client_id:ul.googleClientId,scope:"openid email profile",ux_mode:"popup",redirect_uri:n,state:"signin",callback:r=>{if(r&&r.code)e(r.code);else if(r&&r.error){let C=new Error(r.error_description||r.error||"Google sign-in cancelled.");C.code=r.error,a(C)}else a(new Error("Google sign-in cancelled."))}}).requestCode()})})}getIdToken(){return Sr(this,null,function*(){if(yield this.loadScript(),!ul.googleClientId)throw new Error("Configure the Google Client ID.");return new Promise((n,e)=>{let a=!1,d=C=>{let P=(C||"").toLowerCase();return P.includes("invalid")?{message:"Configure the Google Client ID.",code:"google_config"}:P.includes("missing")?{message:"Configure the Google Client ID.",code:"google_config"}:P.includes("suppressed")?{message:"Google sign-in cancelled: Google suppressed the prompt (cookie).",code:"google_cancelled"}:P.includes("user_cancel")?{message:"Google sign-in cancelled by the user.",code:"google_cancelled"}:{message:"Google sign-in cancelled.",code:"google_cancelled"}},r=(C,P)=>{if(!a)if(a=!0,P)n(P);else{let k=typeof C=="string"?C:C?.message,X=typeof C=="string"?void 0:C?.code,oe=new Error(k||"Google sign-in cancelled.");X&&(oe.code=X),e(oe)}};google.accounts.id.initialize({client_id:ul.googleClientId,callback:C=>{C&&C.credential?r(void 0,C.credential):r({message:"Google sign-in cancelled.",code:"google_cancelled"})},ux_mode:"popup",use_fedcm_for_prompt:!0,itp_support:!0,cancel_on_tap_outside:!0,auto_select:!1}),google.accounts.id.prompt(C=>{let P=C?.isNotDisplayed?.(),k=C?.isSkippedMoment?.();if(P||k){let X=C?.getNotDisplayedReason?.()||C?.getSkippedReason?.()||"Google sign-in cancelled.";r(d(X))}})})})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var ap=class i{constructor(n){this.bp=n;this.bp.observe(["(max-width: 979px)","(min-width: 980px) and (max-width: 1399px)","(min-width: 1400px)"]).subscribe(e=>{e.breakpoints["(max-width: 979px)"]?this.screen.set("mobile"):e.breakpoints["(min-width: 980px) and (max-width: 1399px)"]?this.screen.set("tablet"):this.screen.set("desktop")})}screen=qs("desktop");static \u0275fac=function(e){return new(e||i)(hn(Wf))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};function ene(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.generalError)}}function tne(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.name)}}function nne(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.birthdate)}}function ine(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.email)}}function rne(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.password)}}function one(i,n){i&1&&(z(0,"p"),W(1,"Start joining events"),V())}var wT=class i{constructor(n,e,a,d){this.fb=n;this.auth=e;this.googleIdentity=a;this.responsive=d;this.form=this.fb.group({name:["",[MR]],birthdate:["",[DR]],email:["",[rm]],password:["",[Hd]]})}close=new Vt;switchToSignIn=new Vt;signUpSuccess=new Vt;signInSuccess=new Vt;form;errors={};generalError=null;onSubmit(){this.errors={},this.generalError=null;let n=this.form.controls;if(MR(n.name)&&(this.errors.name="Il nome deve contenere solo lettere."),DR(n.birthdate)&&(this.errors.birthdate="Devi essere maggiore di 18 anni."),rm(n.email)&&(this.errors.email="Email non valida."),Hd(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let C={name:this.form.value.name,birthdate:this.form.value.birthdate,email:this.form.value.email,password:this.form.value.password};this.auth.signUp(C).subscribe({next:P=>{if(this.errors={},this.generalError=null,!P?.success){this.generalError=P?.error||"Registrazione non riuscita.";return}this.signUpSuccess.emit({email:this.form.value.email,token:P?.data?.token||""})},error:P=>{if(this.errors={},this.generalError=null,P&&typeof P=="object"&&"error"in P){let k=P.error;if(k&&typeof k=="object"){if(k.data&&typeof k.data=="object"){this.errors=k.data;return}if(k.error&&typeof k.error=="string"){this.generalError=k.error;return}}if(typeof P.error=="string"){this.generalError=P.error;return}}if(typeof P=="string"){this.generalError=P;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",P)}})}hasError(n){return!!this.errors[n]}closePopup(){this.close.emit()}goToSignIn(){this.switchToSignIn.emit()}signUpWithGoogle(){return Sr(this,null,function*(){this.errors={},this.generalError=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:e=>{this.signInSuccess.emit({id:e?.data?.id||"",name:e?.data?.name||"",email:e?.data?.email||""}),this.closePopup()},error:e=>{let a=e?.error;if(a?.data&&typeof a.data=="object"){this.errors=a.data;return}if(typeof a?.error=="string"){this.generalError=a.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}static \u0275fac=function(e){return new(e||i)(Dt(Jh),Dt(Wl),Dt(w0),Dt(ap))};static \u0275cmp=vn({type:i,selectors:[["SignUpPopup"]],outputs:{close:"close",switchToSignIn:"switchToSignIn",signUpSuccess:"signUpSuccess",signInSuccess:"signInSuccess"},decls:38,vars:27,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header","desktop-header"],[1,"error"],[1,"form",3,"ngSubmit","formGroup"],["placeholder","Full name",3,"error","control","type"],["placeholder","Birthday",3,"error","control","type"],["placeholder","Email",3,"error","control","type"],["placeholder","Password",3,"error","control","type","showToggle"],["type","submit",1,"button"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.closePopup()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Te("click",function(){return a.closePopup()}),W(5,"arrow_back"),V(),z(6,"h1"),W(7,"Sign Up"),V()(),z(8,"div",5)(9,"div",6)(10,"button",7),Te("click",function(){return a.closePopup()}),z(11,"mat-icon"),W(12,"close"),V()(),z(13,"div",8)(14,"h1"),W(15,"Join LUMO"),V(),Je(16,ene,2,1,"p",9)(17,tne,2,1,"p",9)(18,nne,2,1,"p",9)(19,ine,2,1,"p",9)(20,rne,2,1,"p",9)(21,one,2,0,"p"),V(),z(22,"form",10),Te("ngSubmit",function(){return a.onSubmit()}),An(23,"FormField",11)(24,"FormField",12)(25,"FormField",13)(26,"FormField",14),z(27,"button",15),W(28,"Sign Up"),V()(),z(29,"div",16)(30,"p"),W(31,"or sign up with"),V(),z(32,"a",17),Te("click",function(){return a.signUpWithGoogle()}),An(33,"img",18),V()(),z(34,"p"),W(35," Already have an account? "),z(36,"span",19),Te("click",function(){return a.goToSignIn()}),W(37,"Sign In"),V()()()()()()),e&2&&(an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(),an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(15),et(a.generalError?16:a.errors.name?17:a.errors.birthdate?18:a.errors.email?19:a.errors.password?20:21),K(6),vt("formGroup",a.form),K(),vt("error",a.hasError("name"))("control",a.form.get("name"))("type","text"),K(),vt("error",a.hasError("birthdate"))("control",a.form.get("birthdate"))("type","date"),K(),vt("error",a.hasError("email"))("control",a.form.get("email"))("type","text"),K(),vt("error",a.hasError("password"))("control",a.form.get("password"))("type","password")("showToggle",!0))},dependencies:[Bu,Pi,Ai,fi,Nu,Qh,Kh,Qf],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:var(--spacing-2xl) 5%;border:var(--modal-border);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:var(--modal-surface);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function sne(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.generalError)}}function ane(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.email)}}function lne(i,n){if(i&1&&(z(0,"p",9),W(1),V()),i&2){let e=te();K(),ot(e.errors.password)}}function cne(i,n){if(i&1&&(z(0,"p",10),W(1),V()),i&2){let e=te();K(),ot(e.infoMessage)}}function une(i,n){i&1&&(z(0,"p"),W(1,"Sign in to LUMO"),V())}var CT=class i{constructor(n,e,a,d,r){this.fb=n;this.auth=e;this.googleIdentity=a;this.router=d;this.responsive=r;this.form=this.fb.group({email:["",[rm]],password:["",[Hd]]})}close=new Vt;switchToSignUp=new Vt;signInSuccess=new Vt;form;errors={};generalError=null;infoMessage=null;closePopup(){this.close.emit()}goToSignUp(){this.switchToSignUp.emit()}onSubmit(){this.errors={},this.generalError=null,this.infoMessage=null;let n=this.form.controls;if(rm(n.email)&&(this.errors.email="Email non valida."),Hd(n.password)&&(this.errors.password="La password deve avere almeno 8 caratteri, una maiuscola, un numero e un simbolo."),Object.keys(this.errors).length>0)return;let d={email:this.form.value.email,password:this.form.value.password};this.auth.login(d).subscribe({next:r=>{this.errors={},this.generalError=null,this.signInSuccess.emit({id:r?.data?.id||"",name:r?.data?.name||"",email:r?.data?.email||d.email,profileImage:r?.data?.profileImage}),localStorage.setItem("user",JSON.stringify({id:r?.data?.id||"",name:r?.data?.name||"",email:r?.data?.email||d.email,profileImage:r?.data?.profileImage,isAdmin:r?.data?.isAdmin})),r?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:r=>{if(this.errors={},this.generalError=null,r&&typeof r=="object"&&"error"in r){let C=r.error;if(C&&typeof C=="object"){if(C.data&&typeof C.data=="object"){this.errors=C.data;return}if(C.error&&typeof C.error=="string"){this.generalError=C.error;return}}if(typeof r.error=="string"){this.generalError=r.error;return}}if(typeof r=="string"){this.generalError=r;return}this.generalError="Unexpected error.",console.warn("Unhandled error shape",r)}})}onForgotPassword(){this.errors={},this.generalError=null,this.infoMessage=null;let n=this.form.controls;if(rm(n.email)){this.errors.email="Email non valida.";return}let a={email:this.form.value.email};this.auth.requestPasswordReset(a).subscribe({next:()=>{this.infoMessage="If the email exists, a reset link has been sent."},error:d=>{let r=d?.error;if(r?.data&&typeof r.data=="object"){this.errors=r.data;return}if(typeof r?.error=="string"){this.generalError=r.error;return}if(typeof d?.error=="string"){this.generalError=d.error;return}if(typeof d=="string"){this.generalError=d;return}this.generalError="Unable to send reset email."}})}signInWithGoogle(){return Sr(this,null,function*(){this.errors={},this.generalError=null,this.infoMessage=null;try{let n=yield this.googleIdentity.getAuthCode();this.auth.loginWithGoogleCode({code:n}).subscribe({next:e=>{this.signInSuccess.emit({id:e?.data?.id||"",name:e?.data?.name||"",email:e?.data?.email||"",profileImage:e?.data?.profileImage}),localStorage.setItem("user",JSON.stringify(e.data)),e?.data?.isAdmin==="true"&&this.router.navigate(["/admin"]),this.closePopup()},error:e=>{let a=e?.error;if(a?.data&&typeof a.data=="object"){this.errors=a.data;return}if(typeof a?.error=="string"){this.generalError=a.error;return}this.generalError="Google sign-in failed."}})}catch(n){if(n?.code==="google_cancelled")return;this.generalError=n?.message||"Google sign-in failed."}})}hasError(n){return!!this.errors[n]}static \u0275fac=function(e){return new(e||i)(Dt(Jh),Dt(Wl),Dt(w0),Dt(ws),Dt(ap))};static \u0275cmp=vn({type:i,selectors:[["SignInPopup"]],outputs:{close:"close",switchToSignUp:"switchToSignUp",signInSuccess:"signInSuccess"},decls:38,vars:23,consts:[[1,"backdrop",3,"click"],[1,"popup-container"],[1,"mobile-popup-container"],[1,"mobile-header"],[3,"click"],[1,"centered-content"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header"],[1,"error"],[1,"info"],[1,"form",3,"ngSubmit","formGroup"],["placeholder","Email",3,"error","control","type","title"],["placeholder","Password",3,"error","control","type","title","showToggle"],["type","button",1,"click-text","text-link",3,"click"],["type","submit",1,"button"],[1,"other-sign-up-methods"],[1,"button","generic",3,"click"],["src","assets/img/google-logo.webp","height","20",1,"google-logo"],[1,"click-text",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.closePopup()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Te("click",function(){return a.closePopup()}),W(5,"arrow_back"),V(),z(6,"h1"),W(7,"Sign In"),V()(),z(8,"div",5)(9,"div",6)(10,"button",7),Te("click",function(){return a.closePopup()}),z(11,"mat-icon"),W(12,"close"),V()(),z(13,"div",8)(14,"h1"),W(15,"Welcome back!"),V(),Je(16,sne,2,1,"p",9)(17,ane,2,1,"p",9)(18,lne,2,1,"p",9)(19,cne,2,1,"p",10)(20,une,2,0,"p"),V(),z(21,"form",11),Te("ngSubmit",function(){return a.onSubmit()}),An(22,"FormField",12)(23,"FormField",13),z(24,"p")(25,"button",14),Te("click",function(){return a.onForgotPassword()}),W(26,"Forgot password?"),V()(),z(27,"button",15),W(28,"Sign In"),V()(),z(29,"div",16)(30,"p"),W(31,"or sign in with"),V(),z(32,"a",17),Te("click",function(){return a.signInWithGoogle()}),An(33,"img",18),V()(),z(34,"p"),W(35," Don\u2019t have an account? "),z(36,"span",19),Te("click",function(){return a.goToSignUp()}),W(37,"Sign Up"),V()()()()()()),e&2&&(an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(),an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(15),et(a.generalError?16:a.errors.email?17:a.errors.password?18:a.infoMessage?19:20),K(5),vt("formGroup",a.form),K(),vt("error",a.hasError("email"))("control",a.form.get("email"))("type","text")("title","Email"),K(),vt("error",a.hasError("password"))("control",a.form.get("password"))("type","password")("title","Password")("showToggle",!0))},dependencies:[Bu,Pi,Ai,fi,Nu,Qh,Kh,Qf],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:var(--spacing-2xl) 5%;border:var(--modal-border);display:flex;flex-direction:column;gap:var(--spacing-lg)}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;z-index:var(--z-popup)}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:var(--spacing-2xl);height:100%;width:100%;background:var(--modal-surface);border-radius:0;overflow-y:auto;gap:var(--spacing-lg);border:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-popup-container[_ngcontent-%COMP%]{background-color:transparent}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg)}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{text-align:right;width:100%}.text-link[_ngcontent-%COMP%]{background:transparent;border:none;padding:0;font:inherit}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.google-logo[_ngcontent-%COMP%]{height:20px}.other-sign-up-methods[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.other-sign-up-methods[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--spacing-lg)}.form-field.error[_ngcontent-%COMP%]{border:2px solid var(--color-error)}.error[_ngcontent-%COMP%]{color:var(--color-error)}.info[_ngcontent-%COMP%]{color:var(--color-accent)}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%], .popup-container.tablet[_ngcontent-%COMP%]   .mobile-header[_ngcontent-%COMP%]{background-color:transparent}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{display:none}.popup-container.tablet[_ngcontent-%COMP%], .popup-container.mobile[_ngcontent-%COMP%]{display:flex}.popup-content[_ngcontent-%COMP%]{padding:var(--spacing-2xl) var(--spacing-xl);justify-content:flex-start;align-items:center;padding-top:0}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.form[_ngcontent-%COMP%]{gap:var(--spacing-xl)}.form[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{height:60px;font-size:20px;border-radius:var(--radius-lg)}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}}"]})};function dne(i,n){i&1&&(z(0,"p",5),W(1,"You have been successfully registered"),V())}function hne(i,n){i&1&&(z(0,"p"),W(1,"Check your email and click the button"),V())}var ET=class i{constructor(n){this.responsive=n}email;token;verified=!1;close=new Vt;resendVerification=new Vt;onClose(){this.close.emit()}resend(){this.resendVerification.emit()}closePopup(){this.close.emit()}static \u0275fac=function(e){return new(e||i)(Dt(ap))};static \u0275cmp=vn({type:i,selectors:[["VerifyEmailPopup"]],inputs:{email:"email",token:"token",verified:"verified"},outputs:{close:"close",resendVerification:"resendVerification"},decls:13,vars:13,consts:[[1,"backdrop"],[1,"popup-container"],[1,"popup-content"],[1,"close-btn","close",3,"click"],[1,"header"],[1,"success"],[1,"button",3,"click"]],template:function(e,a){e&1&&(An(0,"div",0),z(1,"div",1)(2,"div",2)(3,"button",3),Te("click",function(){return a.closePopup()}),z(4,"mat-icon"),W(5,"close"),V()(),z(6,"div",4)(7,"h1"),W(8,"Verify your email"),V(),Je(9,dne,2,0,"p",5)(10,hne,2,0,"p"),V(),z(11,"a",6),Te("click",function(){return a.resend()}),W(12,"Resend verification email"),V()()()),e&2&&(an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(),an("mobile",a.responsive.screen()==="mobile")("tablet",a.responsive.screen()==="tablet")("desktop",a.responsive.screen()==="desktop"),K(8),et(a.verified?9:10))},dependencies:[Pi,Ai],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:900}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:30%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:40px;border:var(--modal-border);display:flex;flex-direction:column;gap:24px}.popup-container.tablet[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:950}.popup-container.tablet[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:40%;height:auto;background:var(--modal-surface);border-radius:var(--modal-radius);padding:40px;border:var(--modal-border);display:flex;flex-direction:column;gap:24px}.backdrop.mobile[_ngcontent-%COMP%]{display:none}.popup-container.mobile[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100vw;height:100vh}.popup-container.mobile[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;background:var(--modal-surface);display:flex;justify-content:center;align-items:center;flex-direction:column;padding:1.5rem;height:100%;width:100%;border-radius:0;overflow-y:auto;gap:24px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{text-align:center}.error[_ngcontent-%COMP%]{color:var(--color-error)}.success[_ngcontent-%COMP%]{color:#14c972}"]})};var ST=class i{close=new Vt;action=new Vt;onAction(n){this.action.emit(n),this.close.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=vn({type:i,selectors:[["UserMenu"]],outputs:{close:"close",action:"action"},decls:20,vars:0,consts:[[1,"menu-backdrop",3,"click"],[1,"menu-container"],[1,"menu-header","mobile-header"],[3,"click"],[1,"menu-item-container"],[1,"menu-item",3,"click"],[1,"icon"],[1,"menu-item","logout",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.close.emit()}),V(),z(1,"div",1)(2,"div",2)(3,"mat-icon",3),Te("click",function(){return a.close.emit()}),W(4,"arrow_back"),V(),z(5,"h1"),W(6,"Menu"),V()(),z(7,"div",4)(8,"div",5),Te("click",function(){return a.onAction("account")}),z(9,"i",6),W(10,"\u{1F464}"),V(),W(11," Account "),V(),z(12,"div",5),Te("click",function(){return a.onAction("my-events")}),z(13,"i",6),W(14,"\u2795"),V(),W(15," My events "),V(),z(16,"div",7),Te("click",function(){return a.onAction("logout")}),z(17,"i",6),W(18,"\u{1F6AA}"),V(),W(19," Logout "),V()()())},dependencies:[fi,Pi,Ai],styles:["[_nghost-%COMP%]{display:contents}.menu-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent}.menu-container[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 10px);right:0;width:100%;background:var(--color-dark-gray);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:var(--z-dropdown);animation:_ngcontent-%COMP%_menuFadeIn .2s ease-out;transform-origin:top right;overflow:hidden}@keyframes _ngcontent-%COMP%_menuFadeIn{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.menu-item-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-regular);cursor:pointer;width:100%;justify-content:center;transition:all .2s ease;border-bottom:1px solid var(--color-bit-gray)}.menu-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;color:var(--color-white)}.menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.menu-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-style:normal;font-size:16px;display:none}.menu-item.logout[_ngcontent-%COMP%]{color:var(--color-error)}.menu-item.logout[_ngcontent-%COMP%]:hover{background:#ff6b6b1a;color:var(--color-error)}.mobile-only[_ngcontent-%COMP%]{display:none!important}@media (max-width: 767px){.menu-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;border-radius:0;z-index:var(--z-popup);padding-top:0;transform-origin:center;background:var(--color-dark-gray);display:flex;flex-direction:column;justify-content:flex-start;align-items:center;background:linear-gradient(160deg,#141414,#0c0c0c);overflow-y:auto}.menu-item[_ngcontent-%COMP%]{width:100%;padding:24px 30px;font-size:28px;border-bottom:1px solid var(--color-bit-gray);justify-content:center}.mobile-only[_ngcontent-%COMP%]{display:flex!important}}"]})};var C0=class i{constructor(n){this.http=n}apiUrl="http://localhost:8080/api/notifications";getNotifications(n){return this.http.get(`${this.apiUrl}?userId=${n}`)}markAsRead(n){return this.http.post(`${this.apiUrl}/${n}/read`,{})}markAllAsRead(n){return this.http.post(`${this.apiUrl}/read-all?userId=${n}`,{})}updateType(n,e){return this.http.post(`${this.apiUrl}/${n}/type?newType=${e}`,{})}deleteNotification(n){return this.http.delete(`${this.apiUrl}/${n}`)}deleteReadNotifications(n){return this.http.delete(`${this.apiUrl}/read?userId=${n}`)}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var pne=(i,n)=>n.id;function fne(i,n){i&1&&(z(0,"div",7),W(1,"No notifications"),V())}function mne(i,n){if(i&1){let e=wt();z(0,"div",16)(1,"div",20),Te("click",function(d){Ee(e);let r=te().$implicit,C=te(2);return Se(C.acceptRequest(r,d))}),z(2,"mat-icon"),W(3,"check"),V()(),z(4,"div",21),Te("click",function(d){Ee(e);let r=te().$implicit,C=te(2);return Se(C.rejectRequest(r,d))}),z(5,"mat-icon"),W(6,"close"),V()()()}}function gne(i,n){i&1&&(z(0,"div",17)(1,"mat-icon"),W(2,"check_circle"),V(),W(3," Accepted "),V())}function _ne(i,n){i&1&&(z(0,"div",18)(1,"mat-icon"),W(2,"cancel"),V(),W(3," Rejected "),V())}function vne(i,n){if(i&1){let e=wt();z(0,"div",22),Te("click",function(d){Ee(e);let r=te().$implicit,C=te(2);return Se(C.toggleExpand(r.id,d))}),z(1,"mat-icon"),W(2),V()()}if(i&2){let e=te().$implicit,a=te(2);K(2),ot(a.expandedId===e.id?"expand_less":"expand_more")}}function yne(i,n){if(i&1){let e=wt();z(0,"div",9),Te("click",function(){let d=Ee(e).$implicit,r=te(2);return Se(r.onNotificationClick(d))}),z(1,"div",10)(2,"mat-icon"),W(3),V()(),z(4,"div",11)(5,"div",12)(6,"span",13),W(7),V(),z(8,"span",14),W(9),Ls(10,"date"),V()(),z(11,"div",15),W(12),V(),Je(13,mne,7,0,"div",16),Je(14,gne,4,0,"div",17),Je(15,_ne,4,0,"div",18),Je(16,vne,3,1,"div",19),V()()}if(i&2){let e=n.$implicit,a=te(2);an("unread",!e.isRead),K(2),$o("color",a.getIconColor(e.type)),K(),ot(a.getIcon(e.type)),K(4),ot(e.title),K(2),ot(L_(10,14,e.createdAt,"short")),K(2),an("expanded",a.expandedId===e.id),K(),bi(" ",e.message," "),K(),et(e.type==="PARTICIPATION_REQUEST"?13:-1),K(),et(e.type==="REQUEST_ACCEPTED"?14:-1),K(),et(e.type==="REQUEST_REJECTED"?15:-1),K(),et(e.message.length>100?16:-1)}}function xne(i,n){if(i&1&&Wi(0,yne,17,17,"div",8,pne),i&2){let e=te();Zi(e.notifications)}}var TT=class i{constructor(n,e,a){this.notifService=n;this.eventService=e;this.eRef=a}userId;close=new Vt;openChat=new Vt;openEvent=new Vt;notifications=[];expandedId=null;ngOnInit(){this.loadNotifications()}loadNotifications(){this.userId&&this.notifService.getNotifications(this.userId).subscribe(n=>{this.notifications=n.map(e=>this.translateNotification(e))})}translateNotification(n){let e=(n.message||"").match(/["']([^"']+)["']/g)?.map(r=>r.slice(1,-1))||[],a=e.length?e[e.length-1]:"",d=e[0]||"";switch(n.type){case"APPROVED":n.title="Event Approved",a?n.message=`Your event '${a}' has been approved and is now visible!`:n.message="Your event has been approved and is now visible!";break;case"REJECTED":n.title="Event Rejected",a?n.message=`Your event '${a}' has been rejected.`:n.message="Your event has been rejected.";break;case"PARTICIPATION_REQUEST":n.title="Participation Request",e.length>=2?n.message=`User '${d}' wants to join event '${a}'.`:a?n.message=`A user wants to join event '${a}'.`:n.message="A user requested to join your event.";break;case"PARTICIPATION_ACCEPTED":n.title="Request Accepted",n.message="Your request to join the event has been accepted!";break;case"PARTICIPATION_REJECTED":n.title="Request Rejected",n.message="Your request to join the event has been rejected.";break;case"PARTICIPATION_REMOVED":n.title="Removed from Event",a?n.message=`You have been removed from the event '${a}'.`:n.message="You have been removed from the event.";break;case"REQUEST_ACCEPTED":n.title="Request Accepted";break;case"REQUEST_REJECTED":n.title="Request Rejected";break;case"CHAT_MESSAGE":n.title="New chat message";break}return n}toggleExpand(n,e){e.stopPropagation(),this.expandedId=this.expandedId===n?null:n}deleteRead(){this.userId&&this.notifService.deleteReadNotifications(this.userId).subscribe({next:()=>{this.notifications=this.notifications.filter(n=>!n.isRead)},error:n=>console.error("Error deleting read notifications",n)})}acceptRequest(n,e){e.stopPropagation(),console.log("Attempting to accept request:",n),n.relatedEventId&&n.relatedUserId?(console.log("IDs found, calling service..."),this.eventService.acceptParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{console.log("Participation accepted successfully"),this.notifService.updateType(n.id,"REQUEST_ACCEPTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:a=>console.error("Error accepting participation",a)})):console.error("Missing relatedEventId or relatedUserId in notification:",n)}rejectRequest(n,e){e.stopPropagation(),n.relatedEventId&&n.relatedUserId&&this.eventService.rejectParticipation(n.relatedEventId,n.relatedUserId).subscribe({next:()=>{this.notifService.updateType(n.id,"REQUEST_REJECTED").subscribe(()=>{this.notifService.markAsRead(n.id).subscribe(()=>this.loadNotifications())})},error:a=>console.error("Error rejecting participation",a)})}delete(n,e){n.stopPropagation(),this.notifService.deleteNotification(e.id).subscribe({next:()=>{this.notifications=this.notifications.filter(a=>a.id!==e.id)},error:a=>console.error("Error deleting notification",a)})}onNotificationClick(n){if(n.type==="CHAT_MESSAGE"){if(!n.relatedEventId){console.error("Missing relatedEventId in chat notification:",n);return}this.openChat.emit(n.relatedEventId),this.close.emit();return}if(n.type==="FOLLOWUP"){if(!n.relatedEventId){console.error("Missing relatedEventId in followup notification:",n);return}this.openEvent.emit(n.relatedEventId),this.close.emit()}}getIcon(n){switch(n){case"APPROVED":return"check_circle";case"REJECTED":return"cancel";case"FOLLOWUP":return"event_available";case"PARTICIPATION_REQUEST":return"person_add";case"PARTICIPATION_ACCEPTED":return"how_to_reg";case"PARTICIPATION_REJECTED":return"person_remove";case"PARTICIPATION_REMOVED":return"person_remove";case"REQUEST_ACCEPTED":return"check_circle";case"REQUEST_REJECTED":return"cancel";case"CHAT_MESSAGE":return"chat";case"SUCCESS":return"check_circle";case"ERROR":return"error";case"WARNING":return"warning";default:return"notifications"}}getIconColor(n){switch(n){case"APPROVED":return"var(--color-accent)";case"REJECTED":return"#ff4444";case"FOLLOWUP":return"#4caf50";case"PARTICIPATION_REQUEST":return"#2196f3";case"PARTICIPATION_ACCEPTED":return"#4caf50";case"PARTICIPATION_REJECTED":return"#ff4444";case"PARTICIPATION_REMOVED":return"#ff4444";case"CHAT_MESSAGE":return"var(--color-accent)";default:return"white"}}static \u0275fac=function(e){return new(e||i)(Dt(C0),Dt(Xs),Dt(pr))};static \u0275cmp=vn({type:i,selectors:[["notification-menu"]],inputs:{userId:"userId"},outputs:{close:"close",openChat:"openChat",openEvent:"openEvent"},decls:14,vars:1,consts:[[1,"notif-container"],[1,"notif-header"],[1,"mobile-only","back-arrow",3,"click"],[1,"title-wrap"],[1,"header-actions"],["title","Delete read notifications",1,"pill-btn",3,"click"],[1,"notif-list"],[1,"empty-state"],[1,"notif-item",3,"unread"],[1,"notif-item",3,"click"],[1,"icon-section"],[1,"content-section"],[1,"notif-top"],[1,"notif-title"],[1,"notif-time"],[1,"notif-msg"],[1,"action-buttons"],[1,"status-msg","success"],[1,"status-msg","error"],[1,"expand-btn"],["title","Accept",1,"btn-approve",3,"click"],["title","Reject",1,"btn-reject",3,"click"],[1,"expand-btn",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"mat-icon",2),Te("click",function(){return a.close.emit()}),W(3,"arrow_back"),V(),z(4,"div",3)(5,"h1"),W(6,"Notifications"),V()(),z(7,"div",4)(8,"button",5),Te("click",function(){return a.deleteRead()}),z(9,"mat-icon"),W(10,"delete_sweep"),V()()()(),z(11,"div",6),Je(12,fne,2,0,"div",7)(13,xne,2,0),V()()),e&2&&(K(12),et(a.notifications.length===0?12:13))},dependencies:[fi,Pi,Ai,Cx],styles:[".notif-container[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);border:1px solid rgba(255,255,255,.08);width:340px;border-radius:18px;box-shadow:0 18px 48px #00000073;overflow:hidden;display:flex;flex-direction:column;max-height:460px;color:var(--color-white);font-family:var(--font-stack-headline)}.notif-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;column-gap:12px;height:64px;padding:0 20px;border-bottom:1px solid rgba(255,255,255,.08);background:radial-gradient(circle at 20% 20%,rgba(252,195,36,.1),transparent 38%)}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:var(--font-weight-bold);letter-spacing:.2px;display:flex;padding-bottom:0;align-items:center;height:40px;line-height:1}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex:1;height:40px;color:var(--color-white)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end}.pill-btn[_ngcontent-%COMP%]{width:40px;height:40px;display:grid;place-items:center;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#ffffff0d;color:var(--color-white);cursor:pointer;transition:background .2s,border-color .2s,transform .1s,color .2s}.pill-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fff3;transform:translateY(-1px)}.pill-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.pill-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.notif-list[_ngcontent-%COMP%]{overflow-y:auto;max-height:380px;padding:8px 4px 10px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-dark-gray)}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-bit-gray);border-radius:3px}.notif-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-light-gray)}.notif-item[_ngcontent-%COMP%]{display:flex;padding:12px 14px;margin:6px 8px;border-radius:14px;border:1px solid rgba(255,255,255,.06);transition:background .2s,border-color .2s,transform .15s;align-items:flex-start;gap:var(--spacing-md);position:relative;background:#ffffff05}.notif-item[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#ffffff1f;transform:translateY(-1px)}.notif-item.unread[_ngcontent-%COMP%]{background:#fcc32414;border-color:#fcc3243d}.icon-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-top:2px}.content-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-width:0}.notif-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:var(--spacing-xs)}.notif-title[_ngcontent-%COMP%]{font-weight:var(--font-weight-semibold);font-size:14px;color:var(--color-white)}.notif-time[_ngcontent-%COMP%]{font-size:10px;opacity:.6;margin-left:var(--spacing-sm);white-space:nowrap}.notif-msg[_ngcontent-%COMP%]{font-size:13px;opacity:.82;line-height:1.45;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;transition:max-height .3s ease}.notif-msg.expanded[_ngcontent-%COMP%]{-webkit-line-clamp:unset;overflow:visible}.expand-btn[_ngcontent-%COMP%]{cursor:pointer;opacity:.6;transition:opacity .2s;display:flex;align-items:center;justify-content:center}.expand-btn[_ngcontent-%COMP%]:hover{opacity:1}.empty-state[_ngcontent-%COMP%]{padding:28px 18px 34px;text-align:center;opacity:.6;font-style:italic;font-size:13px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);margin-left:auto;align-items:center;padding-left:var(--spacing-sm);margin-top:8px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s,background-color .2s}.btn-approve[_ngcontent-%COMP%]{background-color:#4caf5033;color:#4caf50}.btn-approve[_ngcontent-%COMP%]:hover{background-color:#4caf5066;transform:scale(1.1)}.btn-reject[_ngcontent-%COMP%]{background-color:#f4433633;color:#f44336}.btn-reject[_ngcontent-%COMP%]:hover{background-color:#f4433666;transform:scale(1.1)}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.status-msg[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:12px;font-weight:var(--font-weight-medium);margin-left:auto;padding-left:var(--spacing-sm);white-space:nowrap;margin-top:5px}.status-msg[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.status-msg.success[_ngcontent-%COMP%]{color:#4caf50}.status-msg.error[_ngcontent-%COMP%]{color:#f44336}@media (max-width: 768px){.notif-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;max-height:none;border-radius:0;z-index:100001;background-color:var(--color-dark-gray)}.notif-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:1px solid rgba(255,255,255,.1)}.title-wrap[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.notif-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.header-actions[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:flex;align-items:center;height:100%;top:0}.notif-list[_ngcontent-%COMP%]{max-height:none;flex:1;padding-bottom:20px}.notif-item[_ngcontent-%COMP%]{padding:var(--spacing-lg)}.notif-title[_ngcontent-%COMP%]{font-size:18px}.notif-msg[_ngcontent-%COMP%]{font-size:16px}.btn-approve[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]{width:44px;height:44px}.btn-approve[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}}"]})};var IT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/events";moderationUrl="http://localhost:8080/api/moderation";getMessages(n,e,a=100){let d=new URLSearchParams;return e!=null&&d.set("userId",String(e)),d.set("limit",String(a)),this.http.get(`${this.baseUrl}/${n}/chat/messages?${d.toString()}`)}sendMessage(n,e,a){return this.http.post(`${this.baseUrl}/${n}/chat/messages?userId=${e}`,{content:a})}connect(n,e,a){let d=new EventSource(`${this.baseUrl}/${n}/chat/stream?userId=${e}`),r=C=>P=>{a(C,JSON.parse(P.data))};return d.addEventListener("message",r("message")),d.addEventListener("poll",r("poll")),d.addEventListener("poll-vote",r("poll-vote")),d.addEventListener("poll-close",r("poll-close")),d.addEventListener("mute",r("mute")),d}getMuteStatus(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/mute-status?userId=${e}`)}getMutes(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/mutes?userId=${e}`)}muteUser(n,e,a,d){return this.http.post(`${this.baseUrl}/${n}/chat/mutes?userId=${e}`,{targetUserId:a,reason:d})}unmuteUser(n,e,a){return this.http.delete(`${this.baseUrl}/${n}/chat/mutes/${a}?userId=${e}`)}getPolls(n,e){return this.http.get(`${this.baseUrl}/${n}/chat/polls?userId=${e}`)}createPoll(n,e,a,d,r){return this.http.post(`${this.baseUrl}/${n}/chat/polls/open?userId=${e}`,{question:a,options:d,endsAt:r})}votePoll(n,e,a,d){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${e}/votes?userId=${a}`,{optionIds:d})}closePoll(n,e,a){return this.http.post(`${this.baseUrl}/${n}/chat/polls/${e}/close?userId=${a}`,{})}getBannedWords(){return this.http.get(`${this.moderationUrl}/banned-words`)}checkMessage(n){return this.http.post(`${this.moderationUrl}/check`,{content:n})}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var wne=["messagesContainer"];function Cne(i,n){if(i&1){let e=wt();z(0,"button",30),Te("click",function(d){Ee(e);let r=te(2);return r.togglePin(r.pinnedItem,r.pinnedType),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2,"close"),V()()}}function Ene(i,n){if(i&1){let e=wt();z(0,"div",24),Te("click",function(){Ee(e);let d=te();return Se(d.scrollToItem(d.pinnedId,d.pinnedType))}),z(1,"mat-icon",25),W(2,"push_pin"),V(),z(3,"div",26)(4,"span",27),W(5),V(),z(6,"span",28),W(7),V()(),$i(8,Cne,3,0,"button",29),V()}if(i&2){let e=te();K(5),ot(e.getPinnedSenderName()),K(2),ot(e.getPinnedDisplayText()),K(),vt("ngIf",e.isOrganizer)}}function Sne(i,n){if(i&1&&(z(0,"a",35),W(1,"Open link"),V()),i&2){let e=te().$implicit;vt("href",e.link,no)}}function Tne(i,n){if(i&1&&(z(0,"div",31)(1,"div",32),W(2),V(),z(3,"div",33),W(4),V(),$i(5,Sne,2,1,"a",34),V()),i&2){let e=n.$implicit;Ro("id",e.anchorId),K(2),ot(e.label),K(2),ot(e.content),K(),vt("ngIf",e.link)}}function Ine(i,n){if(i&1&&An(0,"img",49),i&2){let e=te(2).$implicit;vt("src",e.message.senderImage,no)}}function Mne(i,n){if(i&1&&(z(0,"div",50),W(1),V()),i&2){let e=te(2).$implicit;K(),bi(" ",e.message.senderName.slice(0,1)||"?"," ")}}function Dne(i,n){if(i&1){let e=wt();z(0,"div",51),Te("click",function(d){return Ee(e),Se(d.stopPropagation())}),z(1,"button",52),Te("click",function(d){Ee(e);let r=te(2).$implicit,C=te();return Se(C.togglePinFromMenu(r.message,"message",d))}),z(2,"mat-icon"),W(3,"push_pin"),V()()()}if(i&2){let e=te(2).$implicit,a=te();K(),an("active",a.isPinned(e.message.id,"message"))("unpin",a.isPinned(e.message.id,"message")),Ro("aria-label",a.isPinned(e.message.id,"message")?"Unpin":"Pin message")}}function Ane(i,n){if(i&1){let e=wt();z(0,"div",39),Te("click",function(d){Ee(e);let r=te().$implicit,C=te();return Se(C.openPinMenu(r.message,"message",d))}),z(1,"div",40),$i(2,Ine,1,1,"img",41)(3,Mne,2,1,"div",42),V(),z(4,"div",43)(5,"div",44)(6,"span",45),W(7),V(),z(8,"span",46),W(9),V(),Je(10,Dne,4,5,"div",47),V(),z(11,"div",48),W(12),V()()()}if(i&2){let e=te().$implicit,a=te();an("mine",a.currentUserId&&e.message.senderId.toString()===a.currentUserId)("pin-enabled",a.isOrganizer),Ro("id",a.getItemAnchorId(e.message.id,"message")),K(2),vt("ngIf",e.message.senderImage),K(),vt("ngIf",!e.message.senderImage),K(4),ot(e.message.senderName),K(2),ot(a.formatTimestamp(e.message.createdAt)),K(),et(a.isOrganizer&&a.activePinId===e.message.id&&a.activePinType==="message"?10:-1),K(2),ot(e.message.content)}}function Pne(i,n){if(i&1){let e=wt();z(0,"div",51),Te("click",function(d){return Ee(e),Se(d.stopPropagation())}),z(1,"button",52),Te("click",function(d){Ee(e);let r=te(2).$implicit,C=te();return Se(C.togglePinFromMenu(r.poll,"poll",d))}),z(2,"mat-icon"),W(3,"push_pin"),V()()()}if(i&2){let e=te(2).$implicit,a=te();K(),an("active",a.isPinned(e.poll.id,"poll"))("unpin",a.isPinned(e.poll.id,"poll")),Ro("aria-label",a.isPinned(e.poll.id,"poll")?"Unpin":"Pin poll")}}function One(i,n){if(i&1){let e=wt();z(0,"div",63),Te("click",function(){let d=Ee(e).$implicit,r=te(2).$implicit,C=te();return Se(C.toggleVote(r.poll,d.id))}),z(1,"div",64)(2,"span"),W(3),V(),z(4,"span",65),W(5),V()(),z(6,"div",66),An(7,"div",67),V()()}if(i&2){let e=n.$implicit,a=te(2).$implicit,d=te();an("selected",d.pollSelections[a.poll.id]==null?null:d.pollSelections[a.poll.id].has(e.id))("closed",a.poll.closed),K(3),ot(e.text),K(2),ot(d.getPollOptionCount(e)),K(2),$o("width",d.getPollBarWidth(a.poll,e))}}function Rne(i,n){if(i&1){let e=wt();z(0,"button",68),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te();return Se(r.closePoll(d.poll))}),W(1," Chiudi sondaggio "),V()}if(i&2){let e=te(2).$implicit;vt("disabled",e.poll.closed)}}function kne(i,n){if(i&1){let e=wt();z(0,"div",53),Te("click",function(d){Ee(e);let r=te().$implicit,C=te();return Se(C.openPinMenu(r.poll,"poll",d))}),z(1,"div",54)(2,"div",55)(3,"span",56),W(4,"Sondaggio"),V(),z(5,"span",46),W(6),V()(),Je(7,Pne,4,5,"div",47),V(),z(8,"div",57),W(9),V(),z(10,"div",58),$i(11,One,8,8,"div",59),V(),z(12,"div",60),$i(13,Rne,2,1,"button",61),V(),z(14,"div",62),W(15),V()()}if(i&2){let e=te().$implicit,a=te();an("pin-enabled",a.isOrganizer),Ro("id",a.getItemAnchorId(e.poll.id,"poll")),K(6),ot(a.formatTimestamp(e.poll.createdAt)),K(),et(a.isOrganizer&&a.activePinId===e.poll.id&&a.activePinType==="poll"?7:-1),K(2),ot(e.poll.question),K(2),vt("ngForOf",e.poll.options),K(2),vt("ngIf",a.isOrganizer),K(2),bi("Totale voti: ",a.getPollTotalVotes(e.poll))}}function Fne(i,n){if(i&1&&(z(0,"div",36),Je(1,Ane,13,11,"div",37),Je(2,kne,16,9,"div",38),V()),i&2){let e=n.$implicit;K(),et(e.type==="message"&&e.message?1:-1),K(),et(e.type==="poll"&&e.poll?2:-1)}}function Lne(i,n){i&1&&(z(0,"div",69),W(1," Nessun messaggio ancora. "),V())}function Nne(i,n){i&1&&(z(0,"div",70),W(1," Sei stato mutato: puoi leggere ma non inviare messaggi. "),V())}function zne(i,n){if(i&1){let e=wt();z(0,"button",71),Te("click",function(){Ee(e);let d=te();return Se(d.openPollPopup())}),z(1,"mat-icon"),W(2,"add"),V()()}if(i&2){let e=te();vt("disabled",e.isMuted)}}function Bne(i,n){if(i&1&&(z(0,"div",72),W(1),V()),i&2){let e=te();K(),ot(e.messageError)}}function Vne(i,n){if(i&1){let e=wt();z(0,"button",87),Te("click",function(){Ee(e);let d=te().index,r=te(2);return Se(r.removePollOption(d))}),z(1,"mat-icon"),W(2,"remove_circle_outline"),V()()}}function Une(i,n){if(i&1){let e=wt();z(0,"div",84)(1,"input",85),vo("ngModelChange",function(d){let r=Ee(e).index,C=te(2);return To(C.pollOptions[r],d)||(C.pollOptions[r]=d),Se(d)}),V(),$i(2,Vne,3,0,"button",86),V()}if(i&2){let e=n.index,a=te(2);K(),_o("ngModel",a.pollOptions[e]),vt("placeholder","Opzione "+(e+1)),K(),vt("ngIf",a.pollOptions.length>2)}}function jne(i,n){if(i&1){let e=wt();z(0,"button",88),Te("click",function(){Ee(e);let d=te(2);return Se(d.addPollOption())}),z(1,"mat-icon"),W(2,"add"),V(),W(3," Aggiungi opzione "),V()}}function $ne(i,n){if(i&1&&(z(0,"div",89),W(1),V()),i&2){let e=te(2);K(),ot(e.pollError)}}function Hne(i,n){if(i&1){let e=wt();z(0,"div",73),Te("click",function(){Ee(e);let d=te();return Se(d.closePollPopup())}),z(1,"div",74),Te("click",function(d){return Ee(e),Se(d.stopPropagation())}),z(2,"div",75)(3,"span"),W(4,"Crea sondaggio"),V(),z(5,"button",76),Te("click",function(){Ee(e);let d=te();return Se(d.closePollPopup())}),z(6,"mat-icon"),W(7,"close"),V()()(),z(8,"div",77)(9,"input",78),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.pollQuestion,d)||(r.pollQuestion=d),Se(d)}),V(),z(10,"div",79),$i(11,Une,3,3,"div",80),V(),$i(12,jne,4,0,"button",81)(13,$ne,2,1,"div",82),z(14,"button",83),Te("click",function(){Ee(e);let d=te();return Se(d.createPoll())}),W(15,"Crea sondaggio"),V()()()()}if(i&2){let e=te();K(9),_o("ngModel",e.pollQuestion),K(2),vt("ngForOf",e.pollOptions)("ngForTrackBy",e.trackByIndex),K(),vt("ngIf",e.pollOptions.length<5),K(),vt("ngIf",e.pollError)}}var E0=class i{constructor(n){this.chatService=n}event;currentUserId=null;close=new Vt;messagesContainer;messages=[];polls=[];mutes=[];mutedUserIds=new Set;isMuted=!1;isOrganizer=!1;messageText="";pollQuestion="";pollOptions=["","",""];pollSelections={};pollError="";showPollPopup=!1;pinnedId=null;pinnedType=null;pinnedItem=null;activePinId=null;activePinType=null;bannedPatterns=[];bannedRaw=[];messageError="";timelineItems=[];infoMessages=[];eventSource=null;ngOnInit(){this.initializeChat()}ngOnChanges(n){(n.event||n.currentUserId)&&this.initializeChat()}ngOnDestroy(){this.persistMessages(),this.eventSource?.close()}onClose(){this.close.emit()}openPollPopup(){this.pollQuestion="",this.pollOptions=["","",""],this.pollError="",this.showPollPopup=!0}closePollPopup(){this.showPollPopup=!1,this.pollError=""}addPollOption(){this.pollOptions.length<5&&this.pollOptions.push("")}removePollOption(n){this.pollOptions.length>2&&this.pollOptions.splice(n,1)}trackByIndex(n,e){return n}sendMessage(){if(!this.currentUserId||!this.messageText.trim())return;let n=this.messageText.trim();if(this.messageText="",this.isBannedMessage(n)){this.messageError="Messaggio non consentito.";return}this.messageError="",this.chatService.checkMessage(n).subscribe({next:e=>{if(e?.banned){this.messageError="Messaggio non consentito.";return}this.chatService.sendMessage(this.event.id,this.currentUserId,n).subscribe({next:a=>{this.addMessage(a)},error:a=>{let d=a?.error?.data?.content||a?.error?.error;d&&(this.messageError=d),console.error("Error sending message",a)}})},error:e=>{this.messageError="Messaggio non consentito.",console.error("Error checking message",e)}})}createPoll(){if(!this.currentUserId||!this.pollQuestion.trim())return;let n=this.pollOptions.map(d=>d.trim()).filter(Boolean);if(n.length<2){this.pollError="Inserisci almeno due opzioni.";return}if(n.length>5){this.pollError="Massimo 5 opzioni consentite.";return}let a=new Date(Date.now()+1e3*60*60*24*365*10).toISOString().split(".")[0];this.chatService.createPoll(this.event.id,this.currentUserId,this.pollQuestion.trim(),n,a).subscribe({next:d=>{this.upsertPoll(d),this.pollQuestion="",this.pollOptions=["","",""],this.showPollPopup=!1,this.pollError="",this.loadPolls()},error:d=>{console.error("Error creating poll",d),this.pollError="Errore nella creazione del sondaggio."}})}toggleVote(n,e){!this.currentUserId||n.closed||this.chatService.votePoll(this.event.id,n.id,this.currentUserId,[e]).subscribe({next:a=>this.upsertPoll(a),error:a=>console.error("Error voting poll",a)})}closePoll(n){this.currentUserId&&this.chatService.closePoll(this.event.id,n.id,this.currentUserId).subscribe({next:e=>this.upsertPoll(e),error:e=>console.error("Error closing poll",e)})}muteUser(n){this.currentUserId&&this.chatService.muteUser(this.event.id,this.currentUserId,n.id).subscribe({next:e=>{this.mutes=[...this.mutes.filter(a=>a.userId!==e.userId),e],this.mutedUserIds.add(e.userId)},error:e=>console.error("Error muting user",e)})}unmuteUser(n){this.currentUserId&&this.chatService.unmuteUser(this.event.id,this.currentUserId,n.id).subscribe({next:()=>{this.mutes=this.mutes.filter(e=>e.userId!==n.id),this.mutedUserIds.delete(n.id)},error:e=>console.error("Error unmuting user",e)})}isUserMuted(n){return this.mutedUserIds.has(n)}getParticipants(){return this.event.acceptedUsersList||[]}formatTimestamp(n){return n?new Date(n).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):""}formatDateTime(n){return n?new Date(n).toLocaleString("it-IT",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):""}getOptionVoters(n){return!n.voters||n.voters.length===0?"":n.voters.map(e=>e.userName).join(", ")}rebuildTimelineItems(){let n=[];this.messages.forEach(e=>n.push({type:"message",createdAt:e.createdAt,message:e})),this.polls.forEach(e=>n.push({type:"poll",createdAt:e.createdAt,poll:e})),this.timelineItems=n.sort((e,a)=>new Date(e.createdAt).getTime()-new Date(a.createdAt).getTime())}getPollTotalVotes(n){return n.options.reduce((e,a)=>e+(a.voters?.length||0),0)}getPollOptionCount(n){return n.voters?.length||0}getPollBarWidth(n,e){let a=this.getPollTotalVotes(n);if(!a)return"0%";let d=this.getPollOptionCount(e);return`${Math.round(d/a*100)}%`}getPinnedSenderName(){return this.pinnedItem?this.pinnedType==="poll"?"Sondaggio":this.pinnedItem.senderName||"Utente":""}getPinnedDisplayText(){return this.pinnedItem?this.pinnedType==="poll"?this.pinnedItem.question:this.pinnedItem.content:""}isPinned(n,e){return this.pinnedId===n&&this.pinnedType===e}openPinMenu(n,e,a){this.isOrganizer&&(a.stopPropagation(),this.activePinId=n.id,this.activePinType=e)}closePinMenu(){this.activePinId=null,this.activePinType=null}togglePinFromMenu(n,e,a){a.stopPropagation(),this.togglePin(n,e),this.activePinId=null,this.activePinType=null}togglePin(n,e){this.pinnedId===n.id&&this.pinnedType===e?(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null):(this.pinnedId=n.id,this.pinnedType=e,this.pinnedItem=n),this.persistPinnedItem()}scrollToItem(n,e){this.scrollToAnchor(this.getItemAnchorId(n,e))}scrollToAnchor(n){let e=this.messagesContainer?.nativeElement;if(!e)return;let a=e.querySelector(`#${n}`);if(!a)return;let d=e.getBoundingClientRect().top,r=a.getBoundingClientRect().top;e.scrollTo({top:e.scrollTop+r-d-12,behavior:"smooth"})}getItemAnchorId(n,e){return`chat-${e}-${n}`}getMessageAnchorId(n){return this.getItemAnchorId(n,"message")}loadBannedWords(){this.chatService.getBannedWords().subscribe({next:n=>this.buildBannedPatterns(n),error:n=>console.error("Error loading banned words",n)})}loadData(){this.currentUserId&&(this.chatService.getMessages(this.event.id).subscribe({next:n=>{n.length===0&&this.messages.length>0||(this.messages=n,this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())},error:n=>console.error("Error loading messages",n)}),this.loadPolls(),this.chatService.getMuteStatus(this.event.id,this.currentUserId).subscribe({next:n=>this.isMuted=n.muted,error:n=>console.error("Error loading mute status",n)}),this.isOrganizer&&this.chatService.getMutes(this.event.id,this.currentUserId).subscribe({next:n=>{this.mutes=n,this.mutedUserIds=new Set(n.map(e=>e.userId))},error:n=>console.error("Error loading mutes",n)}))}connectStream(){this.currentUserId&&(this.eventSource?.close(),this.eventSource=this.chatService.connect(this.event.id,this.currentUserId,(n,e)=>{if(n==="message"&&this.addMessage(e),(n==="poll"||n==="poll-vote"||n==="poll-close")&&this.upsertPoll(e),n==="mute"){let a=e;a.muted?this.mutedUserIds.add(a.userId):this.mutedUserIds.delete(a.userId),this.currentUserId&&Number(this.currentUserId)===a.userId&&(this.isMuted=a.muted)}}))}loadPolls(){this.currentUserId&&this.chatService.getPolls(this.event.id,this.currentUserId).subscribe({next:n=>{this.polls=n,n.forEach(e=>this.syncPollSelections(e)),this.rebuildTimelineItems(),this.scrollToBottom()},error:n=>console.error("Error loading polls",n)})}toIsoLocal(n){if(!n)return null;if(n.includes("T"))return n;let a=n.trim().match(/^(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})$/);if(!a)return null;let[,d,r,C,P,k]=a;return`${C}-${r}-${d}T${P}:${k}`}upsertPoll(n){let e=this.polls.findIndex(d=>d.id===n.id),a=e<0;if(a)this.polls=[n,...this.polls];else{let d=[...this.polls];d[e]=n,this.polls=d}this.syncPollSelections(n),this.rebuildTimelineItems(),a&&this.scrollToBottom()}syncPollSelections(n){if(!this.currentUserId)return;let e=new Set;n.options.forEach(a=>{a.voters?.some(r=>r.userId===Number(this.currentUserId))&&e.add(a.id)}),this.pollSelections[n.id]=e}addMessage(n){this.messages.some(e=>e.id===n.id)||(this.messages=[...this.messages,n],this.refreshPinnedItem(),this.persistMessages(),this.rebuildTimelineItems(),this.scrollToBottom())}initializeChat(){this.event&&(this.messages=this.getCachedMessages(),this.loadPinnedItem(),this.buildInfoMessages(),this.rebuildTimelineItems(),this.activePinId=null,this.activePinType=null,this.loadBannedWords(),this.currentUserId&&(this.isOrganizer=this.event.creatorId?.toString()===this.currentUserId,this.loadData(),this.connectStream()))}getCacheKeys(){if(!this.event?.id)return[];let n=[`chat-cache:${this.event.id}`];return this.currentUserId&&n.push(`chat-cache:${this.event.id}:${this.currentUserId}`),n}getCachedMessages(){let n=this.getCacheKeys();if(n.length===0)return[];let e=new Map;for(let a of n){let d=localStorage.getItem(a);if(d)try{let r=JSON.parse(d);if(!Array.isArray(r))continue;r.forEach(C=>{C&&typeof C.id=="number"&&e.set(C.id,C)})}catch{continue}}return Array.from(e.values()).sort((a,d)=>new Date(a.createdAt).getTime()-new Date(d.createdAt).getTime())}persistMessages(){let n=this.getCacheKeys();if(n.length===0)return;let e=JSON.stringify(this.messages);n.forEach(a=>localStorage.setItem(a,e))}pinnedStorageKey(){return this.event?.id?`chat-pins:${this.event.id}`:null}loadPinnedItem(){let n=this.pinnedStorageKey();if(!n)return;let e=localStorage.getItem(n);if(!e){this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null;return}try{let a=JSON.parse(e);a&&typeof a.id=="number"?(this.pinnedId=a.id,this.pinnedType=a.type,this.refreshPinnedItem()):(this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null)}catch{this.pinnedId=null,this.pinnedType=null,this.pinnedItem=null}}persistPinnedItem(){let n=this.pinnedStorageKey();n&&(this.pinnedId!==null&&this.pinnedType!==null?localStorage.setItem(n,JSON.stringify({id:this.pinnedId,type:this.pinnedType})):localStorage.removeItem(n))}refreshPinnedItem(){if(this.pinnedId===null||this.pinnedType===null){this.pinnedItem=null;return}this.pinnedType==="message"?this.pinnedItem=this.messages.find(n=>n.id===this.pinnedId)||null:this.pinnedItem=this.polls.find(n=>n.id===this.pinnedId)||null}buildInfoMessages(){let n=[],e=this.formatEventTime();e&&n.push({key:"time",label:"Time",content:e,anchorId:"chat-info-time"});let a=this.formatEventPlace();a&&n.push({key:"place",label:"Location",content:a,anchorId:"chat-info-place"});let d=this.getMapLink();d&&n.push({key:"link",label:"Map Link",content:d,anchorId:"chat-info-link",link:d}),this.infoMessages=n}formatEventTime(){if(!this.event)return"";let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):"",a=this.event.endTime?this.event.endTime.slice(0,5):"",d=n?n.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"short"}):"",r=[e,a].filter(Boolean).join(" - ");return[d,r].filter(Boolean).join(" ")}formatEventPlace(){return this.event?this.event.city?this.event.city:Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`${this.event.latitude.toFixed(5)}, ${this.event.longitude.toFixed(5)}`:"":""}getMapLink(){return this.event?Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)?`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`:this.event.city?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.event.city)}`:"":""}scrollToBottom(){requestAnimationFrame(()=>{this.doScrollToBottom(),setTimeout(()=>this.doScrollToBottom(),50),setTimeout(()=>this.doScrollToBottom(),150)})}doScrollToBottom(){let n=this.messagesContainer?.nativeElement;n&&(n.scrollTop=n.scrollHeight)}buildBannedPatterns(n){this.bannedPatterns=[],this.bannedRaw=[],Array.isArray(n)&&n.forEach(e=>{let a=this.normalizeContent(e);if(!a){e&&this.bannedRaw.push(e);return}this.bannedPatterns.push(this.buildPhrasePattern(a))})}isBannedMessage(n){if(!n)return!1;for(let a of this.bannedRaw)if(a&&n.includes(a))return!0;let e=this.normalizeContent(n);return e?this.bannedPatterns.some(a=>a.test(e)):!1}normalizeContent(n){if(!n)return"";let e=n.toLowerCase();return this.replaceLeet(e).normalize("NFD").replace(/[\u0300-\u036f]+/g,"").replace(/[^a-z0-9]+/g," ").trim().replace(/\s+/g," ")}replaceLeet(n){let e={"@":"a",0:"o",1:"i","!":"i",3:"e",4:"a",5:"s",$:"s",7:"t",8:"b"};return n.split("").map(a=>e[a]??a).join("")}buildPhrasePattern(n){let d=n.split(/\s+/).filter(Boolean).map(r=>this.buildTokenPattern(r)).join("\\s+");return new RegExp(`(?:^|\\s)${d}(?:\\s|$)`)}buildTokenPattern(n){return n.split("").map(e=>this.escapeRegex(e)).join("\\s*")}escapeRegex(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static \u0275fac=function(e){return new(e||i)(Dt(IT))};static \u0275cmp=vn({type:i,selectors:[["event-chat-modal"]],viewQuery:function(e,a){if(e&1&&Fa(wne,5),e&2){let d;fa(d=ma())&&(a.messagesContainer=d.first)}},inputs:{event:"event",currentUserId:"currentUserId"},outputs:{close:"close"},features:[Br],decls:31,vars:12,consts:[["messagesContainer",""],[1,"chat-backdrop",3,"click"],[1,"chat-container",3,"click"],[1,"chat-header"],[1,"header-left"],[1,"back-arrow",3,"click"],[1,"header-text"],[1,"title"],[1,"subtitle"],["aria-label","Close chat",1,"close-btn",3,"click"],[1,"chat-body"],[1,"chat-left"],[1,"pinned-bar"],[1,"messages",3,"click"],["class","info-message",4,"ngFor","ngForOf"],["class","timeline-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","mute-banner",4,"ngIf"],[1,"message-input"],["placeholder","Scrivi un messaggio...",3,"ngModelChange","input","keydown.enter","ngModel","disabled"],["class","add-btn",3,"disabled","click",4,"ngIf"],[1,"send-btn",3,"click","disabled"],["class","message-error",4,"ngIf"],[1,"poll-popup-backdrop"],[1,"pinned-bar",3,"click"],[1,"pin-icon"],[1,"pinned-content"],[1,"pinned-sender"],[1,"pinned-text"],["class","unpin-btn",3,"click",4,"ngIf"],[1,"unpin-btn",3,"click"],[1,"info-message"],[1,"info-label"],[1,"info-content"],["class","info-link","target","_blank","rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",1,"info-link",3,"href"],[1,"timeline-item"],[1,"message",3,"mine","pin-enabled"],[1,"poll-message-card",3,"pin-enabled"],[1,"message",3,"click"],[1,"avatar"],["alt","Avatar",3,"src",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"content"],[1,"meta"],[1,"name"],[1,"time"],[1,"pin-menu"],[1,"text"],["alt","Avatar",3,"src"],[1,"placeholder"],[1,"pin-menu",3,"click"],["type","button",1,"pin-menu-btn",3,"click"],[1,"poll-message-card",3,"click"],[1,"poll-message-header"],[1,"header-main"],[1,"poll-tag"],[1,"poll-message-question"],[1,"poll-bars"],["class","poll-bar-row",3,"selected","closed","click",4,"ngFor","ngForOf"],[1,"poll-actions"],["class","pill ghost",3,"disabled","click",4,"ngIf"],[1,"poll-total"],[1,"poll-bar-row",3,"click"],[1,"poll-bar-label"],[1,"poll-bar-count"],[1,"poll-bar-track"],[1,"poll-bar-fill"],[1,"pill","ghost",3,"click","disabled"],[1,"empty-state"],[1,"mute-banner"],[1,"add-btn",3,"click","disabled"],[1,"message-error"],[1,"poll-popup-backdrop",3,"click"],[1,"poll-popup",3,"click"],[1,"poll-popup-header"],[1,"icon-btn",3,"click"],[1,"poll-create"],["placeholder","Domanda del sondaggio",1,"poll-question-input",3,"ngModelChange","ngModel"],[1,"poll-options-list"],["class","poll-option-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","add-option-pill",3,"click",4,"ngIf"],["class","poll-error",4,"ngIf"],[1,"pill","create-poll-btn",3,"click"],[1,"poll-option-row"],[3,"ngModelChange","ngModel","placeholder"],["class","remove-option-btn",3,"click",4,"ngIf"],[1,"remove-option-btn",3,"click"],[1,"add-option-pill",3,"click"],[1,"poll-error"]],template:function(e,a){if(e&1){let d=wt();z(0,"div",1),Te("click",function(){return Ee(d),Se(a.onClose())}),z(1,"div",2),Te("click",function(C){return Ee(d),Se(C.stopPropagation())}),z(2,"div",3)(3,"div",4)(4,"mat-icon",5),Te("click",function(){return Ee(d),Se(a.onClose())}),W(5,"arrow_back"),V(),z(6,"div",6)(7,"span",7),W(8,"Event Chat"),V(),z(9,"span",8),W(10),V()()(),z(11,"button",9),Te("click",function(){return Ee(d),Se(a.onClose())}),z(12,"mat-icon"),W(13,"close"),V()()(),z(14,"div",10)(15,"div",11),Je(16,Ene,9,3,"div",12),z(17,"div",13,0),Te("click",function(){return Ee(d),Se(a.closePinMenu())}),$i(19,Tne,6,4,"div",14)(20,Fne,3,2,"div",15)(21,Lne,2,0,"div",16),V(),$i(22,Nne,2,0,"div",17),z(23,"div",18)(24,"input",19),vo("ngModelChange",function(C){return Ee(d),To(a.messageText,C)||(a.messageText=C),Se(C)}),Te("input",function(){return Ee(d),Se(a.messageError="")})("keydown.enter",function(){return Ee(d),Se(a.sendMessage())}),V(),$i(25,zne,3,1,"button",20),z(26,"button",21),Te("click",function(){return Ee(d),Se(a.sendMessage())}),z(27,"mat-icon"),W(28,"send"),V()()(),$i(29,Bne,2,1,"div",22),V()(),Je(30,Hne,16,5,"div",23),V()()}e&2&&(K(10),ot(a.event.title),K(6),et(a.pinnedItem?16:-1),K(3),vt("ngForOf",a.infoMessages),K(),vt("ngForOf",a.timelineItems),K(),vt("ngIf",a.timelineItems.length===0),K(),vt("ngIf",a.isMuted),K(2),_o("ngModel",a.messageText),vt("disabled",a.isMuted),K(),vt("ngIf",a.currentUserId),K(),vt("disabled",a.isMuted||!a.messageText.trim()),K(3),vt("ngIf",a.messageError),K(),et(a.showPollPopup?30:-1))},dependencies:[fi,B_,cs,Ba,Cs,Ys,va,Pi,Ai],styles:['.chat-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px;-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.chat-container[_ngcontent-%COMP%]{width:100%;max-width:760px;max-height:90vh;background:var(--modal-surface);border-radius:var(--modal-radius);box-shadow:var(--modal-shadow);display:flex;flex-direction:column;overflow:hidden;border:var(--modal-border);color:#f5f5f5}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}@media (max-width: 768px){.chat-backdrop[_ngcontent-%COMP%]{padding:0}.chat-container[_ngcontent-%COMP%]{width:100vw;height:100vh;max-height:100vh;border-radius:0}.mobile-only[_ngcontent-%COMP%]{display:inline-flex}.close-btn[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{color:var(--color-accent)}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:relative;padding:16px}.header-left[_ngcontent-%COMP%]{width:100%;justify-content:center;gap:0}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:16px;margin-right:0}.header-text[_ngcontent-%COMP%]{align-items:center;text-align:center}}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:var(--modal-header-border)}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.header-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.title[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#facc15}.subtitle[_ngcontent-%COMP%]{color:#bdbdbd;font-size:14px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;color:#f0f0f0;width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.12);display:grid;place-items:center;transition:background-color .15s ease,border-color .15s ease}.icon-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#fff3}.back-arrow[_ngcontent-%COMP%]{cursor:pointer;color:#fff;font-size:24px;margin-right:4px;transition:color .2s;display:flex;align-items:center;justify-content:center}.back-arrow[_ngcontent-%COMP%]:hover{color:var(--color-accent)}.chat-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:16px;padding:16px;overflow:hidden;flex:1;min-height:0;justify-content:center}.chat-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;min-height:0;height:100%}.pinned-toggle[_ngcontent-%COMP%]{width:100%;background:#ffffff0a;border:1px solid rgba(255,255,255,.1);color:#f3f3f3;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;cursor:pointer;border-radius:12px}.pinned-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:14px}.pinned-toggle[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:transform .2s ease}.pinned-toggle[_ngcontent-%COMP%]   .chevron.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.pinned-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:#fcc3241f;border:1px solid rgba(252,195,36,.25);border-radius:12px;padding:10px 12px;cursor:pointer;transition:background-color .15s ease}.pinned-bar[_ngcontent-%COMP%]:hover{background:#fcc3242e}.pinned-bar[_ngcontent-%COMP%]   .pin-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:20px;flex-shrink:0}.pinned-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1;min-width:0}.pinned-sender[_ngcontent-%COMP%]{font-size:12px;font-weight:700;color:var(--color-accent)}.pinned-text[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.unpin-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#888;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .15s ease,color .15s ease}.unpin-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.unpin-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.pinned-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:8px;margin-bottom:4px}.pinned-item[_ngcontent-%COMP%]{background:#ffffff0a;border:1px solid rgba(255,255,255,.08);color:#f0f0f0;border-radius:12px;padding:8px 10px;display:flex;flex-direction:column;gap:2px;text-align:left;cursor:pointer}.pinned-item[_ngcontent-%COMP%]:hover{border-color:#fff3;background:#ffffff14}.pin-label[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.2px;text-transform:uppercase;color:var(--color-accent)}.pin-preview[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.messages[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:16px;overflow-y:auto;scroll-behavior:smooth;flex:1;border:1px solid rgba(255,255,255,.06);scrollbar-width:none;-ms-overflow-style:none}.messages[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.timeline-item[_ngcontent-%COMP%]{margin-bottom:14px}.message[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:14px;align-items:flex-start;position:relative}.message.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.message.mine[_ngcontent-%COMP%]{flex-direction:row-reverse}.message.mine[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.message.mine[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{justify-content:flex-end}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{text-align:right}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .avatar[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ffffff1a;font-weight:600;pointer-events:none}.content[_ngcontent-%COMP%]{flex:1;max-width:70%;position:relative}.meta[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:12px;color:#9a9a9a;margin-bottom:4px;align-items:center}.name[_ngcontent-%COMP%]{font-weight:600;color:#f2f2f2}.text[_ngcontent-%COMP%]{background:#ffffff14;border-radius:12px;padding:10px 12px;box-shadow:0 8px 20px #00000040;border:1px solid rgba(255,255,255,.06);display:inline-block;width:auto;max-width:100%}.message.mine[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:#fcc3242e;border-color:#fcc32459;color:#fdf7e0}.pin-menu[_ngcontent-%COMP%]{position:static;z-index:1;display:inline-flex;align-items:center;margin-left:6px}.message.mine[_ngcontent-%COMP%]   .pin-menu[_ngcontent-%COMP%]{margin-right:6px;margin-left:0}.pin-menu-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:34px;height:30px;border-radius:0;border:none;background:transparent;color:#fff;cursor:pointer;position:relative}.pin-menu-btn.active[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32480}.pin-menu-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px}.pin-menu-btn.unpin[_ngcontent-%COMP%]:after{content:"";position:absolute;width:18px;height:3px;background:#000;border-radius:2px;transform:rotate(-35deg)}.pin-menu-btn.unpin[_ngcontent-%COMP%]{color:#fff}.info-message[_ngcontent-%COMP%]{border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;padding:10px 12px;margin-bottom:10px}.info-label[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;letter-spacing:.3px;color:var(--color-accent);margin-bottom:4px;font-weight:700}.info-content[_ngcontent-%COMP%]{font-size:13px;color:#e6e6e6;white-space:pre-wrap}.info-link[_ngcontent-%COMP%]{display:inline-flex;margin-top:6px;font-size:12px;color:var(--color-accent);text-decoration:none}.info-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.poll-message-card[_ngcontent-%COMP%]{border-radius:14px;padding:12px;background:#ffffff0f;border:1px solid rgba(255,255,255,.1);transition:background-color .2s,border-color .2s;position:relative}.poll-message-card.pin-enabled[_ngcontent-%COMP%]{cursor:pointer}.poll-message-card.pin-enabled[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#fcc32466}.poll-message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;font-size:12px;color:#b8b8b8;margin-bottom:8px}.poll-message-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.poll-tag[_ngcontent-%COMP%]{background:#fcc32433;color:var(--color-accent);padding:2px 8px;border-radius:999px;font-weight:600;font-size:11px}.poll-message-question[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:var(--color-accent);margin-bottom:12px}.poll-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.poll-bar-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:10px;cursor:pointer;transition:background-color .2s ease,border-color .2s ease;border:1px solid transparent;background:#ffffff0a}.poll-bar-row[_ngcontent-%COMP%]:hover:not(.closed){background:#ffffff14;border-color:#ffffff1a}.poll-bar-row.selected[_ngcontent-%COMP%]{background:#fcc3241f;border-color:#fcc3244d}.poll-bar-row.closed[_ngcontent-%COMP%]{cursor:default;opacity:.8}.poll-bar-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#d8d8d8}.poll-bar-track[_ngcontent-%COMP%]{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden}.poll-bar-fill[_ngcontent-%COMP%]{height:100%;background:var(--color-accent);box-shadow:0 4px 10px #fcc3244d}.poll-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:14px}.poll-total[_ngcontent-%COMP%]{margin-top:10px;font-size:11px;color:#b0b0b0}.empty-state[_ngcontent-%COMP%]{color:#b3b3b3;font-size:14px;text-align:center;padding:16px 0}.mute-banner[_ngcontent-%COMP%]{background:#ff606026;color:#ffb3b3;padding:10px 12px;border-radius:12px;font-size:13px;border:1px solid rgba(255,96,96,.3)}.message-input[_ngcontent-%COMP%]{display:flex;gap:8px}.message-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-top:4px}.message-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;background:#ffffff0a;color:#f4f4f4}.send-btn[_ngcontent-%COMP%]{background:var(--color-accent);color:#fff;border:none;border-radius:12px;padding:0 16px;cursor:pointer;display:flex;align-items:center;box-shadow:0 10px 20px #fcc32440}.add-btn[_ngcontent-%COMP%]{background:#ffffff14;color:#f5f5f5;border:1px solid rgba(255,255,255,.12);border-radius:12px;width:42px;display:flex;align-items:center;justify-content:center;cursor:pointer}.add-btn[_ngcontent-%COMP%]:hover{background:#ffffff24}.poll-create[_ngcontent-%COMP%]   .poll-question-input[_ngcontent-%COMP%]{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;margin-bottom:20px;background:#ffffff0a;color:#f4f4f4;font-weight:600}.poll-options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.poll-option-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.poll-option-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border-radius:12px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;background:#ffffff0a;color:#f4f4f4;font-size:14px}.remove-option-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ef4444;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:4px;opacity:.7;transition:opacity .2s}.remove-option-btn[_ngcontent-%COMP%]:hover{opacity:1}.add-option-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;background:#fcc3241a;color:var(--color-accent);border:1px dashed var(--color-accent);border-radius:12px;padding:8px 16px;cursor:pointer;font-size:13px;font-weight:600;width:100%;justify-content:center;margin-bottom:20px;transition:background-color .2s}.add-option-pill[_ngcontent-%COMP%]:hover{background:#fcc32426}.create-poll-btn[_ngcontent-%COMP%]{width:100%;padding:12px!important;font-weight:700!important;font-size:15px!important;margin-top:10px}.pill[_ngcontent-%COMP%]{border-radius:999px;border:none;background:var(--color-accent);color:#fff;padding:8px 14px;cursor:pointer;font-size:12px;box-shadow:0 8px 18px #fcc3242e}.pill.ghost[_ngcontent-%COMP%]{background:transparent;color:#f5f5f5;border:1px solid rgba(255,255,255,.2);box-shadow:none}.pill.danger[_ngcontent-%COMP%]{background:#d43d3d;color:#fff;box-shadow:none}.poll-popup-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));display:flex;align-items:center;justify-content:center;z-index:60}.poll-popup[_ngcontent-%COMP%]{width:min(460px,92vw);background:var(--modal-surface);border-radius:var(--modal-radius);border:var(--modal-border);padding:16px;box-shadow:var(--modal-shadow)}.poll-popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.poll-popup-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;color:var(--color-accent);font-size:18px}.poll-error[_ngcontent-%COMP%]{color:#ffb3b3;font-size:12px;margin-bottom:8px}.mobile-only[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]{flex:0 0 auto;width:36px;height:36px;flex-shrink:0;position:relative;z-index:1;display:block}']})};var Ab=(i,n)=>n.id;function Gne(i,n){i&1&&(z(0,"div",13),W(1,"Loading..."),V())}function qne(i,n){if(i&1){let e=wt();z(0,"span",31),Te("click",function(){Ee(e);let d=te().$implicit,r=te(3);return Se(r.toggleRequests(d.id))}),W(1),V()}if(i&2){let e=te().$implicit;K(),bi(" ",e.pendingUsersList==null?null:e.pendingUsersList.length," Requests ")}}function Wne(i,n){if(i&1){let e=wt();z(0,"div",43),An(1,"img",44),z(2,"span",45),W(3),V(),z(4,"button",46),Te("click",function(){let d=Ee(e).$implicit,r=te(3).$implicit,C=te(3);return Se(C.removeParticipant(r,d))}),z(5,"mat-icon"),W(6,"person_remove"),V()()()}if(i&2){let e=n.$implicit;K(),vt("src",e.profileImage||"assets/placeholder-user.png",no),K(2),ga("",e.name," ",e.surname)}}function Zne(i,n){if(i&1&&(z(0,"div",37)(1,"h5",41),W(2,"Accepted People"),V(),z(3,"div",42),Wi(4,Wne,7,3,"div",43,Ab),V()()),i&2){let e=te(2).$implicit;K(4),Zi(e.acceptedUsersList)}}function Yne(i,n){i&1&&(z(0,"p",38),W(1,"No participants accepted yet."),V())}function Xne(i,n){if(i&1){let e=wt();z(0,"div",47)(1,"div",48),An(2,"img",49),z(3,"span"),W(4),V()(),z(5,"div",50)(6,"button",51),Te("click",function(){let d=Ee(e).$implicit,r=te(3).$implicit,C=te(3);return Se(C.acceptRequest(r,d))}),W(7,"Accept"),V(),z(8,"button",52),Te("click",function(){let d=Ee(e).$implicit,r=te(3).$implicit,C=te(3);return Se(C.rejectRequest(r,d))}),W(9,"Reject"),V()()()}if(i&2){let e=n.$implicit;K(2),vt("src",e.profileImage||"assets/placeholder-user.png",no),K(2),ga("",e.name," ",e.surname)}}function Kne(i,n){if(i&1&&Wi(0,Xne,10,3,"div",47,Ab),i&2){let e=te(2).$implicit;Zi(e.pendingUsersList)}}function Qne(i,n){i&1&&(z(0,"p",40),W(1,"No pending requests."),V())}function Jne(i,n){if(i&1&&(z(0,"div",30)(1,"div",32)(2,"h4"),W(3,"Event Overview"),V(),z(4,"div",33)(5,"div",34)(6,"span",35),W(7,"Accepted Participants"),V(),z(8,"span",36),W(9),V()(),z(10,"div",34)(11,"span",35),W(12,"Capacity"),V(),z(13,"span",36),W(14),V()()(),Je(15,Zne,6,0,"div",37)(16,Yne,2,0,"p",38),V(),z(17,"div",39)(18,"h4"),W(19),V(),Je(20,Kne,2,0)(21,Qne,2,0,"p",40),V()()),i&2){let e=te().$implicit;K(9),ot((e.acceptedUsersList==null?null:e.acceptedUsersList.length)||0),K(5),ga(" ",(e.acceptedUsersList==null?null:e.acceptedUsersList.length)||0," / ",e.nPartecipants," "),K(),et(e.acceptedUsersList!=null&&e.acceptedUsersList.length?15:16),K(4),bi("Pending Requests (",(e.pendingUsersList==null?null:e.pendingUsersList.length)||0,")"),K(),et(e.pendingUsersList!=null&&e.pendingUsersList.length?20:21)}}function eie(i,n){if(i&1){let e=wt();z(0,"div",20)(1,"div",21)(2,"div",22)(3,"h3"),W(4),V(),z(5,"span",23),W(6),V(),z(7,"span",24),W(8),V(),$i(9,qne,2,1,"span",25),V(),z(10,"div",26)(11,"button",27),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.openChat(d))}),z(12,"mat-icon"),W(13,"chat"),V()(),z(14,"button",28),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.deleteEvent(d))}),z(15,"mat-icon"),W(16,"delete"),V()(),z(17,"button",29),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.toggleRequests(d.id))}),z(18,"mat-icon"),W(19,"group"),V()()()(),Je(20,Jne,22,6,"div",30),V()}if(i&2){let e=n.$implicit,a=te(3);an("expanded",a.expandedEventRequestsId===e.id),K(4),ot(e.title),K(2),ot(e.city),K(2),ot(a.formatDateTime(e)),K(),vt("ngIf",e.pendingUsersList==null?null:e.pendingUsersList.length),K(11),et(a.expandedEventRequestsId===e.id?20:-1)}}function tie(i,n){i&1&&(z(0,"div",19),W(1,"No organized events found."),V())}function nie(i,n){if(i&1&&(z(0,"div",17),Wi(1,eie,21,7,"div",18,Ab,!1,tie,2,0,"div",19),V()),i&2){let e=te(2);an("has-expanded-requests",e.expandedEventRequestsId),K(),Zi(e.organizedEvents)}}function iie(i,n){if(i&1){let e=wt();z(0,"div",53)(1,"div",54)(2,"button",55),Te("click",function(d){let r=Ee(e).$implicit;return te(3).goToEvent(r),Se(d.stopPropagation())}),z(3,"mat-icon"),W(4,"place"),V()(),z(5,"button",56),Te("click",function(d){let r=Ee(e).$implicit;return te(3).openChat(r),Se(d.stopPropagation())}),z(6,"mat-icon"),W(7,"chat"),V()()(),z(8,"app-event-card",57),Te("shareEvent",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.openShare(d))}),V()()}if(i&2){let e=n.$implicit,a=te(3);K(8),vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("id",e.id)("isSaved",!!e.isSaved)("savedCount",e.savedCount)("isParticipating",!!e.isParticipating)("showDistance",!1)("showActions",!1)("showLocationPin",!1)}}function rie(i,n){i&1&&(z(0,"div",19),W(1,"You haven't joined any events yet."),V())}function oie(i,n){if(i&1&&(z(0,"div",15),Wi(1,iie,9,10,"div",53,Ab,!1,rie,2,0,"div",19),V()),i&2){let e=te(2);K(),Zi(e.joinedEvents)}}function sie(i,n){if(i&1){let e=wt();z(0,"app-event-card",59),Te("shareEvent",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.openShare(d))})("focusLocation",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.goToEvent(d))}),V()}if(i&2){let e=n.$implicit,a=te(3);vt("title",e.title)("location",e.city)("dateTime",a.formatDateTime(e))("id",e.id)("isSaved",!0)("savedCount",e.savedCount)("isParticipating",!!e.isParticipating)("showDistance",!1)("showActions",!1)("showLocationPin",!0)}}function aie(i,n){i&1&&(z(0,"div",19),W(1,"You haven't saved any events yet."),V())}function lie(i,n){if(i&1&&(z(0,"div",15),Wi(1,sie,1,10,"app-event-card",58,Ab,!1,aie,2,0,"div",19),V()),i&2){let e=te(2);K(),Zi(e.savedEvents)}}function cie(i,n){if(i&1){let e=wt();z(0,"app-event-share-modal",60),Te("close",function(){Ee(e);let d=te(2);return Se(d.sharingEvent=null)}),V()}if(i&2){let e=te(2);vt("event",e.sharingEvent)}}function uie(i,n){if(i&1){let e=wt();z(0,"div",1),Te("click",function(){Ee(e);let d=te();return Se(d.close.emit())}),V(),z(1,"div",2)(2,"div",3)(3,"mat-icon",4),Te("click",function(){Ee(e);let d=te();return Se(d.onBack())}),W(4,"arrow_back"),V(),z(5,"div",5)(6,"button",6),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("ORGANIZED"))}),W(7," My Events "),V(),z(8,"button",6),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("JOINED"))}),W(9," Joined Events "),V(),z(10,"button",6),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("SAVED"))}),W(11," Saved Events "),V()(),z(12,"div",7)(13,"h2",8),W(14),V()(),z(15,"button",9),Te("click",function(){Ee(e);let d=te();return Se(d.close.emit())}),z(16,"mat-icon"),W(17,"close"),V()()(),z(18,"div",10)(19,"button",11),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("ORGANIZED"))}),z(20,"mat-icon"),W(21,"event"),V(),z(22,"span"),W(23,"My Events"),V()(),z(24,"button",11),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("JOINED"))}),z(25,"mat-icon"),W(26,"group"),V(),z(27,"span"),W(28,"Joined"),V()(),z(29,"button",11),Te("click",function(){Ee(e);let d=te();return Se(d.switchTab("SAVED"))}),z(30,"mat-icon"),W(31,"bookmark"),V(),z(32,"span"),W(33,"Saved"),V()()(),z(34,"div",12),Je(35,Gne,2,0,"div",13),Je(36,nie,4,3,"div",14),Je(37,oie,4,1,"div",15),Je(38,lie,4,1,"div",15),V()(),Je(39,cie,1,1,"app-event-share-modal",16)}if(i&2){let e=te();K(6),an("active",e.activeTab==="ORGANIZED"),K(2),an("active",e.activeTab==="JOINED"),K(2),an("active",e.activeTab==="SAVED"),K(4),ot(e.getViewTitle()),K(5),an("active",e.activeTab==="ORGANIZED"),K(5),an("active",e.activeTab==="JOINED"),K(5),an("active",e.activeTab==="SAVED"),K(6),et(e.loading?35:-1),K(),et(!e.loading&&e.activeTab==="ORGANIZED"?36:-1),K(),et(!e.loading&&e.activeTab==="JOINED"?37:-1),K(),et(!e.loading&&e.activeTab==="SAVED"?38:-1),K(),et(e.sharingEvent?39:-1)}}function die(i,n){if(i&1){let e=wt();z(0,"event-chat-modal",61),Te("close",function(){Ee(e);let d=te();return Se(d.closeChat())}),V()}if(i&2){let e=te();vt("event",e.chatEvent)("currentUserId",e.userId.toString())}}var MT=class i{constructor(n,e){this.eventService=n;this.confirmation=e}userId;close=new Vt;focusLocal=new Vt;view="organized";getViewTitle(){return this.expandedEventRequestsId?"Manage Requests":this.activeTab==="ORGANIZED"?"My Events":this.activeTab==="JOINED"?"Joined Events":"Saved Events"}onBack(){this.expandedEventRequestsId?this.expandedEventRequestsId=null:this.close.emit()}activeTab="ORGANIZED";organizedEvents=[];joinedEvents=[];savedEvents=[];loading=!1;sharingEvent=null;expandedEventRequestsId=null;showChatModal=!1;chatEvent=null;ngOnInit(){this.loadData()}loadData(){this.loading=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>this.organizedEvents=n,error:n=>console.error("Error loading organized events",n)}),this.eventService.getJoinedEvents(this.userId).subscribe({next:n=>{this.joinedEvents=n},error:n=>{console.error("Error loading joined events",n)}}),this.eventService.getSavedEvents(this.userId).subscribe({next:n=>{this.savedEvents=n.filter(this.isFutureEvent),this.loading=!1},error:n=>{console.error("Error loading saved events",n),this.loading=!1}})}isFutureEvent=n=>{if(!n.date)return!0;let e=n.endTime||n.startTime||"23:59";return new Date(`${n.date}T${e}`).getTime()>=Date.now()};switchTab(n){this.activeTab=n,this.expandedEventRequestsId=null}toggleRequests(n){this.expandedEventRequestsId===n?this.expandedEventRequestsId=null:this.expandedEventRequestsId=n}deleteEvent(n){return Sr(this,null,function*(){(yield this.confirmation.confirm({title:"Delete event",message:"Are you sure you want to delete this event?",confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.organizedEvents=this.organizedEvents.filter(a=>a.id!==n.id),this.expandedEventRequestsId===n.id&&(this.expandedEventRequestsId=null)},error:a=>console.error("Error deleting event",a)})})}openChat(n){this.chatEvent=n,this.showChatModal=!0}closeChat(){this.showChatModal=!1,this.chatEvent=null}acceptRequest(n,e){this.eventService.acceptParticipation(n.id,e.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(a=>a.id!==e.id)),n.acceptedUsersList||(n.acceptedUsersList=[]),n.acceptedUsersList.push(e),n.acceptedUsersList.sort((a,d)=>(a.name||"").localeCompare(d.name||"")),n.occupiedSpots=(n.occupiedSpots||0)+1},error:a=>console.error("Error accepting",a)})}rejectRequest(n,e){this.eventService.rejectParticipation(n.id,e.id).subscribe({next:()=>{n.pendingUsersList&&(n.pendingUsersList=n.pendingUsersList.filter(a=>a.id!==e.id))},error:a=>console.error("Error rejecting",a)})}removeParticipant(n,e){return Sr(this,null,function*(){(yield this.confirmation.confirm({title:"Remove participant",message:`Remove ${e.name} ${e.surname} from this event?`,confirmText:"Remove",cancelText:"Cancel",tone:"danger"}))&&this.eventService.removeParticipant(n.id,e.id,this.userId).subscribe({next:()=>{n.acceptedUsersList&&(n.acceptedUsersList=n.acceptedUsersList.filter(d=>d.id!==e.id)),n.occupiedSpots=Math.max(0,(n.occupiedSpots||0)-1)},error:d=>console.error("Error removing participant",d)})})}openShare(n){this.sharingEvent=n}goToEvent(n){this.focusLocal.emit(n)}formatDateTime(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"";return`${e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):""} | ${a}`}static \u0275fac=function(e){return new(e||i)(Dt(Xs),Dt(Na))};static \u0275cmp=vn({type:i,selectors:[["app-my-events-modal"]],inputs:{userId:"userId"},outputs:{close:"close",focusLocal:"focusLocal"},decls:2,vars:2,consts:[[3,"event","currentUserId"],[1,"backdrop",3,"click"],[1,"modal-container"],[1,"modal-header"],[1,"back-arrow",3,"click"],[1,"tabs","tablet-desktop-only"],[1,"tab-btn",3,"click"],[1,"title-wrap","mobile-only"],[1,"yellow-title"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"mobile-tabs","mobile-only"],[1,"mobile-tab-btn",3,"click"],[1,"modal-content"],[1,"loading-state"],[1,"events-list",3,"has-expanded-requests"],[1,"events-grid"],[3,"event"],[1,"events-list"],[1,"organized-event-item",3,"expanded"],[1,"empty-state"],[1,"organized-event-item"],[1,"event-summary"],[1,"event-info"],[1,"event-location"],[1,"event-date"],["class","requests-badge",3,"click",4,"ngIf"],[1,"event-actions"],["title","Open chat",1,"icon-btn","chat",3,"click"],["title","Delete event",1,"icon-btn","danger",3,"click"],["title","Manage Requests",1,"icon-btn",3,"click"],[1,"requests-panel"],[1,"requests-badge",3,"click"],[1,"event-overview-section"],[1,"stats-card"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"participants-list"],[1,"no-data-msg"],[1,"pending-requests-section"],[1,"no-requests"],[1,"section-subtitle"],[1,"participants-grid"],[1,"participant-chip"],[1,"participant-avatar",3,"src"],[1,"participant-name"],["type","button","title","Remove participant",1,"participant-remove-btn",3,"click"],[1,"request-item"],[1,"user-info"],[1,"user-avatar",3,"src"],[1,"request-actions"],[1,"accept-btn",3,"click"],[1,"reject-btn",3,"click"],[1,"joined-event-item"],[1,"joined-action-btns"],["title","View on map",1,"joined-action-btn","joined-pin-btn",3,"click"],["title","Open chat",1,"joined-chat-btn",3,"click"],[3,"shareEvent","title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions","showLocationPin"],[3,"title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions","showLocationPin"],[3,"shareEvent","focusLocation","title","location","dateTime","id","isSaved","savedCount","isParticipating","showDistance","showActions","showLocationPin"],[3,"close","event"],[3,"close","event","currentUserId"]],template:function(e,a){e&1&&(Je(0,uie,40,18),Je(1,die,1,2,"event-chat-modal",0)),e&2&&(et(a.showChatModal?-1:0),K(),et(a.showChatModal&&a.chatEvent?1:-1))},dependencies:[fi,cs,Pi,Ai,tp,x0,E0],styles:['.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);z-index:var(--z-backdrop);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.modal-container[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:600px;height:80vh;background:var(--modal-surface);border-radius:var(--modal-radius);z-index:var(--z-popup);display:flex;flex-direction:column;overflow:hidden;box-shadow:var(--modal-shadow);border:var(--modal-border)}.modal-header[_ngcontent-%COMP%]{padding:16px 24px;background:transparent;display:flex;align-items:center;justify-content:space-between;border-bottom:var(--modal-header-border)}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}.back-arrow[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-white);font-size:24px;margin-right:16px;transition:color .2s}.back-arrow[_ngcontent-%COMP%]:hover{color:var(--color-accent)}.tabs[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:center;align-items:center;gap:0}.tab-btn[_ngcontent-%COMP%]{flex:1;background:none;border:none;color:#888;font-size:16px;font-weight:600;padding:10px 24px;cursor:pointer;position:relative;text-align:center;border-left:1px solid rgba(255,255,255,.12);transition:color .3s}.tab-btn[_ngcontent-%COMP%]:first-child{border-left:none}.tab-btn.active[_ngcontent-%COMP%]{color:#fbce4e}.tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-17px;left:0;width:100%;height:3px;background:#fbce4e;border-radius:3px 3px 0 0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px}.events-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.organized-event-item[_ngcontent-%COMP%]{background-color:var(--color-gray);border-radius:var(--radius-md);padding:12px var(--spacing-md);border:none;color:var(--color-white)}.event-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.event-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.icon-btn.chat[_ngcontent-%COMP%]{background:#fcc32424;color:var(--color-accent);border:1px solid rgba(252,195,36,.3);width:36px;height:36px;border-radius:8px}.icon-btn.chat[_ngcontent-%COMP%]:hover{background:#fcc3244d;color:#0b0b0b}.event-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.icon-btn.danger[_ngcontent-%COMP%]{background:#ea43351a;color:var(--color-danger);border:1px solid rgba(234,67,53,.2);width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:all .2s}.icon-btn.danger[_ngcontent-%COMP%]:hover{background:var(--color-danger);color:#fff}.icon-btn.danger[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.event-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-white)}.event-location[_ngcontent-%COMP%]{display:block;margin:0;font-size:12px;color:var(--color-accent);font-weight:var(--font-weight-medium)}.event-date[_ngcontent-%COMP%]{display:block;margin:0;font-size:10px;color:#888}.requests-badge[_ngcontent-%COMP%]{display:inline-block;background:var(--color-accent);color:#000;font-size:10px;font-weight:700;padding:2px 8px;border-radius:12px;cursor:pointer;align-self:flex-start;margin-top:4px}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);border:none;color:var(--color-light-gray);padding:0;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:background-color .2s}.icon-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.icon-btn[_ngcontent-%COMP%]:hover{background-color:#555;color:var(--color-white)}.requests-panel[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,.1);animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.requests-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#ddd;font-size:14px;text-transform:uppercase;letter-spacing:.5px}.request-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:#fff}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;background:#444}.request-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.accept-btn[_ngcontent-%COMP%], .reject-btn[_ngcontent-%COMP%]{border:none;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer}.accept-btn[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.reject-btn[_ngcontent-%COMP%]{background:#f44336;color:#fff}.no-requests[_ngcontent-%COMP%]{color:#888;font-size:14px;font-style:italic}.event-overview-section[_ngcontent-%COMP%]{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(255,255,255,.1)}.pending-requests-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .event-overview-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#fbce4e;font-size:14px;text-transform:uppercase;letter-spacing:1px;font-weight:700}.stats-card[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;background:#ffffff08;padding:16px;border-radius:12px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.stat-label[_ngcontent-%COMP%]{color:#888;font-size:12px;text-transform:uppercase}.stat-value[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700}.section-subtitle[_ngcontent-%COMP%]{color:#ddd;font-size:14px;margin:0 0 12px;font-weight:600}.participants-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.participant-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#ffffff0d;padding:6px 10px;border-radius:20px;border:1px solid rgba(255,255,255,.05)}.participant-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;object-fit:cover}.participant-name[_ngcontent-%COMP%]{color:#eee;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.participant-remove-btn[_ngcontent-%COMP%]{margin-left:auto;width:22px;height:22px;border-radius:50%;border:1px solid rgba(244,67,54,.3);background:#f4433626;color:#f44336;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.participant-remove-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.participant-remove-btn[_ngcontent-%COMP%]:hover{background:#f44336;color:#fff}.no-data-msg[_ngcontent-%COMP%]{color:#888;font-size:13px;font-style:italic}.events-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.joined-event-item[_ngcontent-%COMP%]{position:relative}.joined-action-btns[_ngcontent-%COMP%]{position:absolute;top:50%;right:12px;transform:translateY(-50%);display:flex;gap:8px;align-items:center;z-index:2}.joined-action-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:var(--radius-full);background-color:var(--color-bit-gray);border:none;color:var(--color-light-gray);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s,transform .1s ease}.joined-action-btn[_ngcontent-%COMP%]:hover{background-color:#555}.joined-action-btn[_ngcontent-%COMP%]:active{transform:scale(.9)}.joined-action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-light-gray)}.joined-chat-btn[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:10px;border:1px solid rgba(252,195,36,.3);background:#fcc32424;color:var(--color-accent);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background .2s,color .2s,border-color .2s}.joined-chat-btn[_ngcontent-%COMP%]:hover{background:#fcc3244d;color:#0b0b0b}.joined-chat-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#888;margin-top:40px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#333;border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#444}@media (max-width: 768px){.backdrop[_ngcontent-%COMP%]{-webkit-backdrop-filter:none;backdrop-filter:none}.modal-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;transform:none;width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none}.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:var(--modal-header-border);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex!important;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;font-size:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.modal-content[_ngcontent-%COMP%]{padding:16px}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item[_ngcontent-%COMP%]:not(.expanded){display:none}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]{background:transparent!important;padding:0!important;border:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .event-summary[_ngcontent-%COMP%]{display:none!important}.has-expanded-requests[_ngcontent-%COMP%]   .organized-event-item.expanded[_ngcontent-%COMP%]   .requests-panel[_ngcontent-%COMP%]{margin-top:0!important;border-top:none!important;padding-top:0!important}}.mobile-tabs[_ngcontent-%COMP%]{display:none;justify-content:space-around;background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);padding:8px 0}.mobile-tab-btn[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;color:#888;font-size:11px;cursor:pointer;padding:8px 0;transition:color .2s}.mobile-tab-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.mobile-tab-btn.active[_ngcontent-%COMP%]{color:var(--color-accent)}.mobile-tab-btn.active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}@media (max-width: 768px){.mobile-tabs[_ngcontent-%COMP%]{display:flex!important}}']})};var y6=Pw(IR());function hie(i,n){if(i&1&&An(0,"img",15),i&2){let e=te(2);vt("src",e.user==null?null:e.user.profileImage,no)}}function pie(i,n){if(i&1&&(z(0,"div",16),W(1),V()),i&2){let e=te(2);K(),ot(e.getInitials((e.user==null?null:e.user.name)||""))}}function fie(i,n){if(i&1){let e=wt();z(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),Je(5,hie,1,1,"img",15)(6,pie,2,1,"div",16),z(7,"button",17),Te("click",function(){Ee(e);let d=te();return Se(d.onChangePhoto())}),z(8,"mat-icon"),W(9,"edit"),V()()(),z(10,"h3",18),W(11),V(),z(12,"p",19)(13,"mat-icon"),W(14,"mail_outline"),V(),W(15),V(),z(16,"p",20),W(17),V(),z(18,"div",21)(19,"div",22),Te("click",function(){Ee(e);let d=te();return Se(d.showFollowers())}),z(20,"span",23),W(21),V(),z(22,"span",24),W(23,"Followers"),V()(),An(24,"div",25),z(25,"div",22),Te("click",function(){Ee(e);let d=te();return Se(d.showFollowing())}),z(26,"span",23),W(27),V(),z(28,"span",24),W(29,"Following"),V()()()(),z(30,"div",26)(31,"button",27),Te("click",function(){Ee(e);let d=te();return Se(d.showEditProfile())}),z(32,"mat-icon"),W(33,"settings"),V(),W(34," Edit Profile "),V()()(),An(35,"div",28),z(36,"div",29)(37,"div",30)(38,"span",31),W(39,"Share Profile"),V(),z(40,"div",32),An(41,"img",33),V(),z(42,"div",34)(43,"div",35)(44,"button",36),Te("click",function(){Ee(e);let d=te();return Se(d.copyShareLink())}),z(45,"mat-icon"),W(46,"content_copy"),V(),W(47," Copy Link "),V()()()()()()()}if(i&2){let e=te();K(5),et(e.user!=null&&e.user.profileImage?5:6),K(6),ot(e.user==null?null:e.user.name),K(4),bi(" ",e.getDiscreteEmail(e.user==null?null:e.user.email)," "),K(2),ot((e.user==null?null:e.user.description)||"Find The Glow"),K(4),ot((e.user==null?null:e.user.followersCount)||0),K(6),ot((e.user==null?null:e.user.followingCount)||0),K(14),vt("src",e.getQrCodeUrl(),no)}}function mie(i,n){if(i&1){let e=wt();z(0,"div",37)(1,"div",38)(2,"div",39)(3,"h4"),W(4,"Personal Information"),V(),z(5,"div",40)(6,"label"),W(7,"Name"),V(),z(8,"input",41),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.editData.name,d)||(r.editData.name=d),Se(d)}),V()(),z(9,"div",40)(10,"label"),W(11,"Email"),V(),An(12,"input",42),V(),z(13,"div",40)(14,"label"),W(15,"Description"),V(),z(16,"textarea",43),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.editData.description,d)||(r.editData.description=d),Se(d)}),V()(),z(17,"button",44),Te("click",function(){Ee(e);let d=te();return Se(d.onSaveProfile())}),W(18,"Update Details"),V()(),An(19,"div",28),z(20,"div",45)(21,"h4"),W(22,"Change Password"),V(),z(23,"div",40)(24,"label"),W(25,"Current Password"),V(),z(26,"input",46),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.passwordData.old,d)||(r.passwordData.old=d),Se(d)}),V()(),z(27,"div",40)(28,"label"),W(29,"New Password"),V(),z(30,"input",47),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.passwordData.new,d)||(r.passwordData.new=d),Se(d)}),V()(),z(31,"div",40)(32,"label"),W(33,"Confirm New Password"),V(),z(34,"input",48),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.passwordData.confirm,d)||(r.passwordData.confirm=d),Se(d)}),V()(),z(35,"button",44),Te("click",function(){Ee(e);let d=te();return Se(d.onChangePassword())}),W(36,"Change Password"),V()()()()}if(i&2){let e=te();K(8),_o("ngModel",e.editData.name),K(4),vt("value",e.editData.email),K(4),_o("ngModel",e.editData.description),K(10),_o("ngModel",e.passwordData.old),K(4),_o("ngModel",e.passwordData.new),K(4),_o("ngModel",e.passwordData.confirm)}}function gie(i,n){if(i&1&&An(0,"img",61),i&2){let e=te().$implicit;vt("src",e.profileImage,no)}}function _ie(i,n){if(i&1&&(z(0,"div",62),W(1),V()),i&2){let e=te().$implicit,a=te(3);K(),ot(a.getInitials(e.name))}}function vie(i,n){if(i&1){let e=wt();z(0,"button",63),Te("click",function(){Ee(e);let d=te().$implicit,r=te(3);return Se(r.onUnfollow(d))}),W(1," Unfollow "),V()}}function yie(i,n){if(i&1){let e=wt();z(0,"button",64),Te("click",function(){Ee(e);let d=te().$implicit,r=te(3);return Se(r.onFollow(d))}),W(1," Follow "),V()}}function xie(i,n){if(i&1){let e=wt();z(0,"div",54)(1,"div",55),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.openProfileFromList(d))}),$i(2,gie,1,1,"img",56)(3,_ie,2,1,"div",57),z(4,"span",58),W(5),V()(),$i(6,vie,2,0,"button",59)(7,yie,2,0,"button",60),V()}if(i&2){let e=n.$implicit,a=te(3);K(2),vt("ngIf",e.profileImage),K(),vt("ngIf",!e.profileImage),K(2),ot(e.name),K(),vt("ngIf",a.view==="following"||a.view==="followers"&&a.followingIds.has(e.id.toString())),K(),vt("ngIf",a.view==="followers"&&!a.followingIds.has(e.id.toString()))}}function bie(i,n){i&1&&(z(0,"div",65),W(1," No users found. "),V())}function wie(i,n){if(i&1&&(z(0,"div",51),$i(1,xie,8,5,"div",52)(2,bie,2,0,"div",53),V()),i&2){let e=te(2);K(),vt("ngForOf",e.userList),K(),vt("ngIf",e.userList.length===0)}}function Cie(i,n){i&1&&(z(0,"div",66),W(1,"Loading..."),V())}function Eie(i,n){if(i&1&&(z(0,"div",49),$i(1,wie,3,2,"div",50)(2,Cie,2,0,"ng-template",null,0,fx),V()),i&2){let e=Bl(3),a=te();K(),vt("ngIf",!a.loadingList)("ngIfElse",e)}}var DT=class i{constructor(n,e,a){this.userService=n;this.confirmation=e;this.snackBar=a}_user=null;qrCodeUrl="";set user(n){this._user=n,this.generateQrCode()}get user(){return this._user}close=new Vt;changePhoto=new Vt;openProfile=new Vt;view="profile";userList=[];followingIds=new Set;loadingList=!1;editData={name:"",email:"",description:""};passwordData={old:"",new:"",confirm:""};onClose(){this.view="profile",this.close.emit()}onBack(){this.view!=="profile"&&(this.view="profile")}onBackOrClose(){if(this.view!=="profile"){this.onBack();return}this.onClose()}getViewTitle(){switch(this.view){case"edit-profile":return"Edit Profile";case"followers":return"Followers";case"following":return"Following";default:return"Account"}}onChangePhoto(){this.changePhoto.emit()}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}getDiscreteEmail(n){if(!n)return"";if(n.length<=25)return n;let e=n.split("@");if(e.length!==2)return n;let[a,d]=e;return`...${a.slice(-3)}@${d}`}showFollowers(){if(!this.user)return;let n=this.user.id;this.view="followers",this.loadingList=!0,this.userService.getFollowers(n).subscribe({next:e=>{this.userList=e,this.userService.getFollowing(n).subscribe({next:a=>{this.followingIds=new Set(a.map(d=>d.id.toString())),this.loadingList=!1},error:a=>{console.error("Error fetching following list",a),this.loadingList=!1}})},error:e=>{console.error(e),this.loadingList=!1}})}showFollowing(){this.user&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.user.id).subscribe({next:n=>{this.userList=n,this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}}))}onFollow(n){this.user&&this.userService.followUser(this.user.id,n.id).subscribe({next:()=>{this.followingIds.add(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||0)+1),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}onUnfollow(n){return Sr(this,null,function*(){!this.user||!(yield this.confirmation.confirm({title:"Unfollow user",message:`Are you sure you want to unfollow ${n.name}?`,confirmText:"Unfollow",cancelText:"Cancel",confirmClass:"white-text"}))||this.userService.unfollowUser(this.user.id,n.id).subscribe({next:()=>{this.view==="following"?this.userList=this.userList.filter(a=>a.id!==n.id):this.followingIds.delete(n.id.toString()),this.user&&(this.user.followingCount=(this.user.followingCount||1)-1),this.userService.notifyUserUpdate()},error:a=>console.error(a)})})}openProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}showEditProfile(){this.user&&(this.view="edit-profile",this.editData={name:this.user.name,email:this.user.email,description:this.user.description||""},this.passwordData={old:"",new:"",confirm:""})}onSaveProfile(){this.user&&this.userService.updateUser(this.user.id,this.editData).subscribe({next:n=>{this.user&&(this.user.name=n.name,this.user.email=n.email,this.user.description=n.description),this.showToast("Profile updated successfully"),this.userService.notifyUserUpdate()},error:n=>{console.error(n),this.showToast("Failed to update profile","error")}})}getShareLink(){if(!this.user)return"";let n=window.location.protocol,e=window.location.host;return`${n}//${e}/?user=${this.user.id}`}generateQrCode(){if(!this.user){this.qrCodeUrl="";return}let n=this.getShareLink();y6.toDataURL(n,{width:200,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(e=>{this.qrCodeUrl=e}).catch(e=>{console.error("QR Code generation failed",e),this.qrCodeUrl=""})}getQrCodeUrl(){return this.qrCodeUrl}copyShareLink(){let n=this.getShareLink();navigator.clipboard.writeText(n).then(()=>{this.showToast("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy: ",e),this.showToast("Unable to copy the link.","error")})}onChangePassword(){if(this.user){if(this.passwordData.new!==this.passwordData.confirm){this.showToast("New passwords do not match","error");return}if(!this.passwordData.old||!this.passwordData.new){this.showToast("Please fill in default fields","error");return}this.userService.changePassword(this.user.id,this.passwordData.old,this.passwordData.new).subscribe({next:()=>{this.showToast("Password changed successfully"),this.passwordData={old:"",new:"",confirm:""}},error:n=>{console.error(n),this.showToast("Failed to change password. Existing password may be incorrect.","error")}})}}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:700,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Dt(Es),Dt(Na),Dt(zc))};static \u0275cmp=vn({type:i,selectors:[["app-account-modal"]],inputs:{user:"user"},outputs:{close:"close",changePhoto:"changePhoto",openProfile:"openProfile"},decls:15,vars:9,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],["type","button",1,"back-arrow",3,"click"],[1,"title-wrap"],["aria-label","Close",1,"close-btn","close","tablet-desktop-only",3,"click"],["class","account-content",4,"ngIf"],["class","edit-profile-view",4,"ngIf"],["class","user-list-view",4,"ngIf"],[1,"account-content"],[1,"content-row"],[1,"content-col","left-col"],[1,"profile-section"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"edit-photo-btn",3,"click"],[1,"user-name"],[1,"user-email"],[1,"user-description"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"actions-section"],[1,"action-btn",3,"click"],[1,"vertical-divider"],[1,"content-col","right-col"],[1,"share-section-embedded"],[1,"share-header"],[1,"qr-code-wrapper"],["alt","Profile QR Code",3,"src"],[1,"share-details"],[1,"mini-link-group"],[1,"mini-copy-btn",3,"click"],[1,"edit-profile-view"],[1,"edit-content-layout"],[1,"edit-section","left-section"],[1,"form-group"],["placeholder","Name",3,"ngModelChange","ngModel"],["readonly","","disabled","",1,"readonly-input",3,"value"],["placeholder","Description (e.g. Find The Glow)","rows","3",3,"ngModelChange","ngModel"],[1,"button",3,"click"],[1,"edit-section","right-section"],["type","password","placeholder","Current Password",3,"ngModelChange","ngModel"],["type","password","placeholder","New Password",3,"ngModelChange","ngModel"],["type","password","placeholder","Confirm Password",3,"ngModelChange","ngModel"],[1,"user-list-view"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],["class","user-item",4,"ngFor","ngForOf"],["class","empty-list",4,"ngIf"],[1,"user-item"],[1,"user-info",3,"click"],["class","list-avatar",3,"src",4,"ngIf"],["class","list-avatar-placeholder",4,"ngIf"],[1,"list-username"],["class","unfollow-btn",3,"click",4,"ngIf"],["class","follow-btn",3,"click",4,"ngIf"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"unfollow-btn",3,"click"],[1,"follow-btn",3,"click"],[1,"empty-list"],[1,"loading-spinner"]],template:function(e,a){e&1&&(z(0,"div",1),Te("click",function(){return a.onClose()}),z(1,"div",2),Te("click",function(r){return r.stopPropagation()}),z(2,"div",3)(3,"button",4),Te("click",function(){return a.onBackOrClose()}),z(4,"mat-icon"),W(5,"arrow_back"),V()(),z(6,"div",5)(7,"h2"),W(8),V()(),z(9,"button",6),Te("click",function(){return a.onClose()}),z(10,"mat-icon"),W(11,"close"),V()()(),$i(12,fie,48,7,"div",7)(13,mie,37,6,"div",8)(14,Eie,4,2,"div",9),V()()),e&2&&(K(3),an("back-arrow--profile",a.view==="profile"),Ro("aria-label",a.view==="profile"?"Close":"Back"),K(4),an("yellow-title",a.view!=="profile"),K(),ot(a.getViewTitle()),K(4),vt("ngIf",a.view==="profile"),K(),vt("ngIf",a.view==="edit-profile"),K(),vt("ngIf",a.view!=="profile"&&a.view!=="edit-profile"))},dependencies:[fi,B_,cs,Pi,Ai,Fu,Ba,Cs,Ys,va],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--modal-backdrop-color);display:flex;justify-content:center;align-items:center;z-index:99999;-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur))}.modal-container[_ngcontent-%COMP%]{background:var(--modal-surface);width:800px;max-width:95vw;height:auto;border-radius:var(--modal-radius);padding:24px;border:var(--modal-border);box-shadow:var(--modal-shadow);animation:_ngcontent-%COMP%_slideUp .3s ease-out;display:flex;flex-direction:column;overflow:hidden;box-sizing:border-box}.edit-profile-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden}.edit-content-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;flex:1;overflow-y:auto;padding:5%}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.edit-content-layout[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-gray);border-radius:3px}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}.back-arrow[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-white);cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.back-arrow--profile[_ngcontent-%COMP%]{display:none}.back-arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{height:70px;position:relative;display:flex;align-items:center;justify-content:center;padding:0 24px;border-bottom:var(--modal-header-border);margin-bottom:0}.title-wrap[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px!important;color:var(--color-accent)!important;text-align:center;margin:0!important;width:auto!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;line-height:normal!important}.back-arrow[_ngcontent-%COMP%]{position:absolute;left:24px;cursor:pointer;color:var(--color-white);display:flex!important;align-items:center;justify-content:center;z-index:10;height:100%;top:0}.back-arrow.back-arrow--profile[_ngcontent-%COMP%]{display:flex!important}.close[_ngcontent-%COMP%]{position:absolute;right:24px;z-index:10;display:none!important}}.account-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;height:100%}.content-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex:1;gap:24px;align-items:stretch}.content-col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:flex-start}.left-col[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:10px}.right-col[_ngcontent-%COMP%]{align-items:center;justify-content:center}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:auto}.share-section-embedded[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:15px;background:#ffffff08;border-radius:12px;padding:24px;border:1px solid rgba(255,255,255,.05);width:100%;box-sizing:border-box;height:100%;justify-content:center}.vertical-divider[_ngcontent-%COMP%]{width:1px;background:#ffffff1a}.edit-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:15px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:160px;display:block}.section-divider[_ngcontent-%COMP%]{display:none}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:20px;font-weight:600}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.avatar-container[_ngcontent-%COMP%]{position:relative;margin-bottom:8px}.profile-image[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--color-accent)}.profile-placeholder[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:600;color:var(--color-white);border:2px solid var(--color-accent)}.edit-photo-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background:var(--color-accent);color:#000;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 8px #0000004d;transition:transform .2s}.edit-photo-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.edit-photo-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.user-name[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--color-white);font-size:24px;font-weight:700;letter-spacing:-.5px;line-height:1.1}.user-email[_ngcontent-%COMP%]{margin:4px 0 0;color:#ffffff80;font-size:13px;display:flex;align-items:center;justify-content:center;gap:6px;font-weight:400}.user-email[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;opacity:.8}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d!important;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white)!important;font-size:14px;font-family:inherit;resize:none;min-height:80px}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:20px;margin-top:10px;padding:8px 0;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:15px}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:12px;border:1px solid var(--color-gray);background:#ffffff0d;color:var(--color-white);font-size:15px;cursor:pointer;transition:all .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:var(--color-light-gray)}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:opacity .2s}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.user-list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:10px}.list-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:20px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;padding:0;display:flex;align-items:center}.back-btn[_ngcontent-%COMP%]:hover{color:var(--color-white)}.user-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;overflow-y:auto;flex:1;padding-right:5px;scrollbar-width:none}.user-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:#ffffff0d}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--color-gray);display:flex;align-items:center;justify-content:center;color:var(--color-white);font-size:14px;font-weight:600}.list-username[_ngcontent-%COMP%]{color:var(--color-white);font-size:16px;font-weight:500}.unfollow-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--color-error, #ff4444);color:#fff;padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;transition:all .2s}.unfollow-btn[_ngcontent-%COMP%]:hover{background:var(--color-error, #ff4444);color:#fff}.empty-list[_ngcontent-%COMP%]{color:var(--color-light-gray);text-align:center;padding:20px}.loading-spinner[_ngcontent-%COMP%]{color:var(--color-accent);text-align:center;padding:20px}.follow-btn[_ngcontent-%COMP%]{background:var(--color-accent);border:1px solid var(--color-accent);color:#000;padding:6px 12px;border-radius:4px;font-size:12px;cursor:pointer;font-weight:600;transition:all .2s}.follow-btn[_ngcontent-%COMP%]:hover{opacity:.9;transform:scale(1.05)}.edit-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-accent);margin:0 0 5px;font-size:16px;font-weight:600}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--color-light-gray);font-size:12px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px}.form-group[_ngcontent-%COMP%]   input.readonly-input[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;background:#ffffff05}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-gray);border-radius:8px;padding:10px;color:var(--color-white);font-size:14px;font-family:inherit;resize:none}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;border:none;overflow-y:auto;padding:0 0 80px}.content-row[_ngcontent-%COMP%], .edit-content-layout[_ngcontent-%COMP%]{flex-direction:column;gap:24px;background:linear-gradient(160deg,#141414,#0c0c0c)}.vertical-divider[_ngcontent-%COMP%]{display:none}.content-col[_ngcontent-%COMP%], .left-col[_ngcontent-%COMP%], .right-col[_ngcontent-%COMP%], .edit-section[_ngcontent-%COMP%]{width:100%;flex:none;padding:24px;box-sizing:border-box}.share-section-embedded[_ngcontent-%COMP%]{padding:20px}.qr-code-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:140px}.profile-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:0 8px}.edit-section[_ngcontent-%COMP%]{padding:0 8px}.user-list[_ngcontent-%COMP%]{padding:24px}}.share-header[_ngcontent-%COMP%]{color:var(--color-white);font-size:14px;font-weight:500;opacity:.8}.qr-code-wrapper[_ngcontent-%COMP%]{background:#fff;padding:6px;border-radius:10px;flex-shrink:0}.share-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}.mini-link-group[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.mini-copy-btn[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid var(--color-accent);color:var(--color-accent);border-radius:8px;padding:8px 16px;font-size:14px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s;width:100%;justify-content:center}.mini-copy-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.mini-copy-btn[_ngcontent-%COMP%]:hover{background:var(--color-accent);color:#000}"]})};function Sie(i,n){i&1&&An(0,"span",3)}function Tie(i,n){if(i&1){let e=wt();z(0,"notification-menu",9),Te("click",function(d){return Ee(e),Se(d.stopPropagation())})("openChat",function(d){Ee(e);let r=te();return Se(r.onOpenChatFromNotification(d))})("openEvent",function(d){Ee(e);let r=te();return Se(r.onOpenEventFromNotification(d))})("close",function(){Ee(e);let d=te();return Se(d.showNotifications=!1)}),V()}if(i&2){let e=te();vt("userId",(e.loggedUser==null?null:e.loggedUser.id)||0)}}function Iie(i,n){if(i&1&&An(0,"img",6),i&2){let e=te();vt("src",e.loggedUser==null?null:e.loggedUser.profileImage,no)}}function Mie(i,n){if(i&1&&(z(0,"div",7),W(1),V()),i&2){let e=te();K(),ot(e.getInitials((e.loggedUser==null?null:e.loggedUser.name)||(e.loggedUser==null?null:e.loggedUser.email)||""))}}function Die(i,n){if(i&1){let e=wt();z(0,"UserMenu",10),Te("click",function(d){return Ee(e),Se(d.stopPropagation())})("close",function(){Ee(e);let d=te();return Se(d.showUserMenu=!1)})("action",function(d){Ee(e);let r=te();return Se(r.onMenuAction(d))}),V()}}function Aie(i,n){if(i&1){let e=wt();z(0,"app-my-events-modal",11),Te("close",function(){Ee(e);let d=te();return Se(d.showMyEventsModal=!1)})("focusLocal",function(d){Ee(e);let r=te();return Se(r.onFocusEvent(d))}),V()}if(i&2){let e=te();vt("userId",(e.loggedUser==null?null:e.loggedUser.id)||0)}}function Pie(i,n){if(i&1){let e=wt();z(0,"app-account-modal",12),Te("close",function(){Ee(e);let d=te();return Se(d.showAccountModal=!1)})("changePhoto",function(){Ee(e);let d=te();return Se(d.onChangePhotoFromAccount())})("openProfile",function(d){Ee(e);let r=te();return Se(r.onOpenProfileFromAccount(d))}),V()}if(i&2){let e=te();vt("user",e.loggedUser)}}var AT=class i{constructor(n,e,a){this.notificationService=n;this.elementRef=e;this.userService=a}loggedUser=null;action=new Vt;openProfile=new Vt;openChatFromNotification=new Vt;openEventFromNotification=new Vt;focusEvent=new Vt;showUserMenu=!1;showNotifications=!1;showMyEventsModal=!1;showAccountModal=!1;hasUnread=!1;pollSubscription=null;ngOnInit(){this.startPolling()}ngOnDestroy(){this.stopPolling()}ngOnChanges(){this.loggedUser?(this.checkUnreadNotifications(),this.startPolling()):this.stopPolling()}startPolling(){this.pollSubscription||this.loggedUser&&(this.pollSubscription=pf(5e3).pipe(So(()=>{let n=[];return this.loggedUser&&!this.showNotifications&&n.push(this.notificationService.getNotifications(this.loggedUser.id)),this.loggedUser&&this.userService.notifyUserUpdate(),n.length>0?this.notificationService.getNotifications(this.loggedUser.id):[]})).subscribe({next:n=>{Array.isArray(n)&&(this.hasUnread=n.some(e=>!e.isRead))},error:n=>console.error("Error polling notifications",n)}))}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}onClickOutside(n){this.elementRef.nativeElement.contains(n.target)||(this.showUserMenu=!1,this.showNotifications=!1)}checkUnreadNotifications(){this.loggedUser&&this.notificationService.getNotifications(this.loggedUser.id).subscribe({next:n=>{this.hasUnread=n.some(e=>!e.isRead)},error:n=>console.error("Error fetching notifications status",n)})}toggleUserMenu(n){n&&n.stopPropagation(),this.showUserMenu=!this.showUserMenu,this.showNotifications=!1}toggleNotifications(n){n.stopPropagation(),this.showNotifications=!this.showNotifications,this.showUserMenu=!1,this.showNotifications&&this.loggedUser?this.notificationService.markAllAsRead(this.loggedUser.id).subscribe({next:()=>{this.hasUnread=!1},error:e=>console.error("Error marking read",e)}):!this.showNotifications&&this.loggedUser&&this.checkUnreadNotifications()}onMenuAction(n){n==="my-events"?this.showMyEventsModal=!0:n==="account"?this.showAccountModal=!0:this.action.emit(n),this.showUserMenu=!1}onOpenProfileFromAccount(n){this.showAccountModal=!1,this.openProfile.emit(n)}onChangePhotoFromAccount(){this.showAccountModal=!1,this.action.emit("change-photo")}onOpenChatFromNotification(n){this.showNotifications=!1,this.openChatFromNotification.emit(n)}onOpenEventFromNotification(n){this.showNotifications=!1,this.openEventFromNotification.emit(n)}onFocusEvent(n){this.showMyEventsModal=!1,this.focusEvent.emit(n)}onAddEvent(){this.action.emit("add-event")}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}static \u0275fac=function(e){return new(e||i)(Dt(C0),Dt(pr),Dt(Es))};static \u0275cmp=vn({type:i,selectors:[["app-action-bar"]],hostBindings:function(e,a){e&1&&Te("click",function(r){return a.onClickOutside(r)},sx)},inputs:{loggedUser:"loggedUser"},outputs:{action:"action",openProfile:"openProfile",openChatFromNotification:"openChatFromNotification",openEventFromNotification:"openEventFromNotification",focusEvent:"focusEvent"},features:[Br],decls:14,vars:6,consts:[[1,"action-bar"],[1,"add-event-btn","button",3,"click"],[1,"icon-circle","notification-icon",3,"click"],[1,"unread-indicator"],[3,"userId"],[1,"profile-trigger",3,"click"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[3,"user"],[3,"click","openChat","openEvent","close","userId"],[3,"click","close","action"],[3,"close","focusLocal","userId"],[3,"close","changePhoto","openProfile","user"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"button",1),Te("click",function(){return a.onAddEvent()}),W(2,"Add Event"),V(),z(3,"div",2),Te("click",function(r){return a.toggleNotifications(r)}),z(4,"mat-icon"),W(5,"notifications"),V(),Je(6,Sie,1,0,"span",3),Je(7,Tie,1,1,"notification-menu",4),V(),z(8,"div",5),Te("click",function(r){return a.toggleUserMenu(r)}),Je(9,Iie,1,1,"img",6)(10,Mie,2,1,"div",7),Je(11,Die,1,0,"UserMenu"),V()(),Je(12,Aie,1,1,"app-my-events-modal",4),Je(13,Pie,1,1,"app-account-modal",8)),e&2&&(K(6),et(a.hasUnread?6:-1),K(),et(a.showNotifications?7:-1),K(2),et(a.loggedUser!=null&&a.loggedUser.profileImage?9:10),K(2),et(a.showUserMenu?11:-1),K(),et(a.showMyEventsModal?12:-1),K(),et(a.showAccountModal?13:-1))},dependencies:[fi,Pi,Ai,ST,TT,MT,DT],styles:[".action-bar[_ngcontent-%COMP%]{height:72px;position:absolute;top:20px;right:20px;display:flex;align-items:center;justify-content:space-between;gap:10px;background:var(--color-dark-gray);padding:12px;border-radius:var(--radius-2xl);box-shadow:var(--shadow-lg);z-index:var(--z-action-bar);width:auto;box-sizing:border-box;border:1px solid var(--color-light-gray)}.action-bar[_ngcontent-%COMP%]   .add-event-btn[_ngcontent-%COMP%]{height:44px;cursor:pointer;transition:transform .1s ease,filter .2s}.add-event-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.1);transform:scale(1.02)}.profile-trigger[_ngcontent-%COMP%]{height:44px;width:44px;border-radius:var(--radius-full);overflow:hidden;cursor:pointer;border:1px solid transparent;transition:border-color .2s;background-color:var(--color-dark-gray);display:flex;justify-content:center;align-items:center}.profile-trigger[_ngcontent-%COMP%]:hover{border-color:var(--color-accent)}.profile-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-semibold);font-size:16px}.icon-circle[_ngcontent-%COMP%]{width:44px;height:44px;background:#ffffff1a;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s,transform .2s}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px;color:var(--color-white)}.icon-circle[_ngcontent-%COMP%]:hover{background:#fff3}.notification-icon[_ngcontent-%COMP%]{margin-right:4px;margin-left:4px;position:relative}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;width:10px;height:10px;background-color:var(--color-accent);border-radius:var(--radius-full);border:2px solid var(--color-dark-gray);z-index:10}notification-menu[_ngcontent-%COMP%]{position:absolute;top:70px;right:-70px;z-index:var(--z-dropdown)}@media (max-width: 768px){.action-bar[_ngcontent-%COMP%]{top:20px;bottom:auto;right:20px;padding:8px;height:60px}}"]})};var Oie=["canvas"],PT=class i{imageFile;close=new Vt;imageCropped=new Vt;canvasRef;ctx;image=new Image;scale=1;offsetX=0;offsetY=0;isDragging=!1;lastX=0;lastY=0;VIEWPORT_SIZE=300;OUTPUT_SIZE=128;ngAfterViewInit(){let n=this.canvasRef.nativeElement;this.ctx=n.getContext("2d");let e=new FileReader;e.onload=a=>{this.image.src=a.target.result,this.image.onload=()=>{this.resetView(),this.draw()}},e.readAsDataURL(this.imageFile)}resetView(){let n=this.VIEWPORT_SIZE/this.image.width,e=this.VIEWPORT_SIZE/this.image.height;this.scale=Math.max(n,e),this.offsetX=(this.VIEWPORT_SIZE-this.image.width*this.scale)/2,this.offsetY=(this.VIEWPORT_SIZE-this.image.height*this.scale)/2}draw(){this.ctx&&(this.ctx.clearRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.VIEWPORT_SIZE,this.VIEWPORT_SIZE),this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.ctx.drawImage(this.image,0,0),this.ctx.restore())}onMouseDown(n){this.isDragging=!0,this.lastX=n.clientX,this.lastY=n.clientY}onMouseMove(n){if(!this.isDragging)return;let e=n.clientX-this.lastX,a=n.clientY-this.lastY;this.offsetX+=e,this.offsetY+=a,this.lastX=n.clientX,this.lastY=n.clientY,this.draw()}onMouseUp(){this.isDragging=!1}onWheel(n){n.preventDefault();let a=this.scale-n.deltaY*.001;a>.1&&(this.scale=a,this.draw())}onZoomChange(n){this.scale=parseFloat(n.target.value),this.draw()}zoomIn(){this.scale=Math.min(this.scale+.1,5),this.draw()}zoomOut(){this.scale=Math.max(this.scale-.1,.1),this.draw()}crop(){let n=document.createElement("canvas");n.width=this.OUTPUT_SIZE,n.height=this.OUTPUT_SIZE;let e=n.getContext("2d"),a=(0-this.offsetX)/this.scale,d=(0-this.offsetY)/this.scale,r=this.VIEWPORT_SIZE/this.scale,C=this.VIEWPORT_SIZE/this.scale;e.drawImage(this.image,a,d,r,C,0,0,this.OUTPUT_SIZE,this.OUTPUT_SIZE),n.toBlob(P=>{P&&this.imageCropped.emit(P)},"image/jpeg",.9)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=vn({type:i,selectors:[["CropImagePopup"]],viewQuery:function(e,a){if(e&1&&Fa(Oie,5),e&2){let d;fa(d=ma())&&(a.canvasRef=d.first)}},inputs:{imageFile:"imageFile"},outputs:{close:"close",imageCropped:"imageCropped"},decls:23,vars:3,consts:[["canvas",""],[1,"crop-backdrop"],[1,"crop-container"],[1,"crop-header"],[1,"close-btn",3,"click"],[1,"canvas-wrapper"],[3,"mousedown","mousemove","mouseup","mouseleave","wheel","width","height"],[1,"overlay-guide"],[1,"controls"],[1,"zoom-icon",2,"cursor","pointer",3,"click"],["type","range","min","0.1","max","5","step","0.1",3,"input","value"],[1,"actions"],[1,"btn-cancel","button",3,"click"],[1,"button",3,"click"]],template:function(e,a){if(e&1){let d=wt();z(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3"),W(4,"Crop Image"),V(),z(5,"button",4),Te("click",function(){return Ee(d),Se(a.close.emit())}),z(6,"mat-icon"),W(7,"close"),V()()(),z(8,"div",5)(9,"canvas",6,0),Te("mousedown",function(C){return Ee(d),Se(a.onMouseDown(C))})("mousemove",function(C){return Ee(d),Se(a.onMouseMove(C))})("mouseup",function(){return Ee(d),Se(a.onMouseUp())})("mouseleave",function(){return Ee(d),Se(a.onMouseUp())})("wheel",function(C){return Ee(d),Se(a.onWheel(C))}),V(),An(11,"div",7),V(),z(12,"div",8)(13,"span",9),Te("click",function(){return Ee(d),Se(a.zoomOut())}),W(14,"\u2212"),V(),z(15,"input",10),Te("input",function(C){return Ee(d),Se(a.onZoomChange(C))}),V(),z(16,"span",9),Te("click",function(){return Ee(d),Se(a.zoomIn())}),W(17,"+"),V()(),z(18,"div",11)(19,"button",12),Te("click",function(){return Ee(d),Se(a.close.emit())}),W(20,"Cancel"),V(),z(21,"button",13),Te("click",function(){return Ee(d),Se(a.crop())}),W(22,"Save Photo"),V()()()()}e&2&&(K(9),vt("width",a.VIEWPORT_SIZE)("height",a.VIEWPORT_SIZE),K(6),vt("value",a.scale))},dependencies:[fi,Pi,Ai],styles:[".crop-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:1000;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.crop-container[_ngcontent-%COMP%]{background:var(--modal-surface);border-radius:var(--modal-radius);padding:24px;width:90%;max-width:400px;border:var(--modal-border);box-shadow:var(--modal-shadow);display:flex;flex-direction:column;gap:20px;position:relative}.crop-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.crop-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-white);font-size:18px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;width:300px;height:300px;margin:0 auto;border-radius:12px;overflow:hidden;background:var(--color-gray);cursor:move}.overlay-guide[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid var(--color-light-gray);box-sizing:border-box;pointer-events:none;border-radius:12px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--color-light-gray)}input[type=range][_ngcontent-%COMP%]{flex:1;accent-color:var(--color-accent);height:4px;background:var(--color-light-gray);border-radius:2px;appearance:none}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--color-white);border-radius:50%;cursor:pointer}.actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:10px}.btn-cancel[_ngcontent-%COMP%]{height:auto;border:1px solid var(--color-light-gray);background:var(--color-dark-gray)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}"]})};function Rie(i,n){if(i&1&&(z(0,"p",7),W(1),V()),i&2){let e=te();K(),ot(e.generalError)}}function kie(i,n){if(i&1&&(z(0,"p",7),W(1),Ls(2,"keyvalue"),V()),i&2){let e=te();K(),ot(F_(2,1,e.errors)[0].value)}}var OT=class i{constructor(n,e,a){this.fb=n;this.http=e;this.mapboxService=a;this.form=this.fb.group({title:["",Lu.required],description:["",Lu.required],date:["",Lu.required],endDate:[""],startTime:["",Lu.required],endTime:[""],nPartecipants:["",[Lu.required,Lu.min(1)]],costPerPerson:["",[Lu.min(0)]]},{validators:this.timeRangeValidator})}close=new Vt;eventCreated=new Vt;openLocationSelector=new Vt;form;generalError="";errors={};latitude=null;longitude=null;locationText="Select position on map";selectedCity=null;timeRangeValidator(n){let e=n.get("startTime")?.value,a=n.get("endTime")?.value;if(e&&a){let[d,r]=e.split(":").map(Number),[C,P]=a.split(":").map(Number),k=d*60+r,X=C*60+P;if(X<=k)return{timeOrder:!0};if(X-k<60)return{minDuration:!0}}return null}onClose(){this.close.emit()}submitAttempted=!1;hasError(n){let e=this.form.get(n),a=n==="startTime"||n==="endTime",d=this.form.errors?.timeOrder||this.form.errors?.minDuration;return!!(this.submitAttempted&&(e?.invalid||a&&d))}selectLocationOnMap(){this.openLocationSelector.emit()}setLocation(n,e){this.latitude=n,this.longitude=e,this.selectedCity=null,this.locationText="Location selected",this.mapboxService.reverseGeocode(n,e).subscribe({next:a=>{a&&(this.selectedCity=a,this.locationText=`Location: ${a}`)},error:a=>console.error("Error reverse geocoding city",a)})}onSubmit(){this.submitAttempted=!0,this.errors={},this.generalError="",Object.keys(this.form.controls).forEach(C=>{this.form.get(C)?.markAsTouched()});let n=this.form.controls;if(n.title.invalid&&(this.errors.title="Title is required."),n.description.invalid&&(this.errors.description="Description is required."),n.date.invalid&&(this.errors.date="Date is required."),n.startTime.invalid&&(this.errors.startTime="Start time is required."),n.nPartecipants.invalid&&(n.nPartecipants.errors?.required?this.errors.nPartecipants="Number of participants is required.":n.nPartecipants.errors?.min&&(this.errors.nPartecipants="Number of participants must be at least 1.")),n.costPerPerson.invalid&&(n.costPerPerson.errors?.min?this.errors.costPerPerson="Cost cannot be negative.":this.errors.costPerPerson="Invalid cost."),this.form.errors?.timeOrder?this.errors.time="Start time must be before end time.":this.form.errors?.minDuration&&(this.errors.time="Event must last at least one hour."),this.latitude===null||this.longitude===null?this.errors.location="Select a location on the map.":this.selectedCity||(this.errors.location="Unable to detect city from selected location."),Object.keys(this.errors).length>0)return;let e=this.form.value,a={title:e.title,description:e.description,city:this.selectedCity,date:e.date,endDate:e.endDate||null,startTime:e.startTime,endTime:e.endTime,nPartecipants:parseInt(e.nPartecipants),costPerPerson:e.costPerPerson!==null&&e.costPerPerson!==""?Math.max(0,parseFloat(e.costPerPerson)):null,latitude:this.latitude,longitude:this.longitude},d=localStorage.getItem("user"),r=d?JSON.parse(d).id:null;this.http.post(`http://localhost:8080/api/events?userId=${r}`,a).subscribe({next:C=>{this.eventCreated.emit(C),this.onClose()},error:C=>{console.error("Error creating event:",C),this.generalError="Error creating event"}})}static \u0275fac=function(e){return new(e||i)(Dt(Jh),Dt(yo),Dt(zu))};static \u0275cmp=vn({type:i,selectors:[["create-event-popup"]],outputs:{close:"close",eventCreated:"eventCreated",openLocationSelector:"openLocationSelector"},decls:34,vars:29,consts:[[1,"backdrop",3,"click"],[1,"popup-container","desktop"],[1,"popup-content"],[1,"mobile-header"],[3,"click"],[1,"close-btn","close","tablet-desktop-only",3,"click"],[1,"header","desktop-header"],[1,"error"],[1,"form"],[1,"two-column","single-column"],["placeholder","Title",3,"error","control","type"],["placeholder","Description","customClass","tall-field",3,"error","control","type"],[1,"two-column"],["placeholder","From",3,"error","control","type"],["placeholder","To",3,"error","control","type"],["placeholder","Start",3,"error","control","type"],["placeholder","End",3,"error","control","type"],["placeholder","Max Participants",3,"error","control","type"],["placeholder","Cost (\u20AC)",3,"error","control","type","min"],["type","button",1,"button","location-btn",3,"click"],["type","button",1,"button",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.onClose()}),V(),z(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),Te("click",function(){return a.onClose()}),W(5,"arrow_back"),V(),z(6,"h1"),W(7,"Create Event"),V()(),z(8,"button",5),Te("click",function(){return a.onClose()}),z(9,"mat-icon"),W(10,"close"),V()(),z(11,"div",6)(12,"h1"),W(13,"Create Event"),V(),Je(14,Rie,2,1,"p",7),Ls(15,"keyvalue"),dx(16,kie,3,3,"p",7),V(),z(17,"form",8)(18,"div",9),An(19,"FormField",10),V(),An(20,"FormField",11),z(21,"div",12),An(22,"FormField",13)(23,"FormField",14),V(),z(24,"div",12),An(25,"FormField",15)(26,"FormField",16),V(),z(27,"div",12),An(28,"FormField",17)(29,"FormField",18),V(),z(30,"button",19),Te("click",function(){return a.selectLocationOnMap()}),W(31),V(),z(32,"button",20),Te("click",function(){return a.onSubmit()}),W(33,"Create Event"),V()()()()),e&2&&(K(14),et(a.generalError?14:F_(15,27,a.errors).length>0?16:-1),K(5),vt("error",a.hasError("title"))("control",a.form.get("title"))("type","text"),K(),vt("error",a.hasError("description"))("control",a.form.get("description"))("type","textarea"),K(2),vt("error",a.hasError("date"))("control",a.form.get("date"))("type","date"),K(),vt("error",a.hasError("endDate"))("control",a.form.get("endDate"))("type","date"),K(2),vt("error",a.hasError("startTime"))("control",a.form.get("startTime"))("type","time"),K(),vt("error",a.hasError("endTime"))("control",a.form.get("endTime"))("type","time"),K(2),vt("error",a.hasError("nPartecipants"))("control",a.form.get("nPartecipants"))("type","number"),K(),vt("error",a.hasError("costPerPerson"))("control",a.form.get("costPerPerson"))("type","number")("min",0),K(2),bi(" \u{1F4CD} ",a.locationText," "))},dependencies:[fi,Bu,Nu,Qh,Kh,Pi,Ai,EP],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.popup-container.desktop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:relative;align-items:center;width:45%;max-height:95vh;background:var(--modal-surface);border-radius:var(--modal-radius);border:var(--modal-border);display:flex;flex-direction:column;overflow:visible}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.close[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}.header[_ngcontent-%COMP%]{padding:20px 0 10px;text-align:center;width:100%}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-lg);padding:0 8% 24px;box-sizing:border-box}.form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.two-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md);width:100%}.single-column[_ngcontent-%COMP%]{grid-template-columns:1fr}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md);width:100%}.tall-field[_ngcontent-%COMP%]{min-height:80px}.tall-field[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.description-row[_ngcontent-%COMP%]{width:100%;min-height:80px}.description-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}.time-section[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--spacing-sm)}.section-label[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-light-gray);margin:0}.time-inputs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-md);width:100%}.time-inputs[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.time-separator[_ngcontent-%COMP%]{font-size:18px;color:var(--color-light-gray);padding:0 var(--spacing-xs)}.location-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-sm);width:100%}.location-btn[_ngcontent-%COMP%]{background-color:var(--color-gray);width:100%;border:2px solid rgba(255,255,255,.12);box-sizing:border-box}.location-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2)}.error[_ngcontent-%COMP%]{color:var(--color-error);font-size:18px;margin:0}.mobile-back[_ngcontent-%COMP%], .mobile-header[_ngcontent-%COMP%]{display:none}@media (max-width: 767px){.popup-container.desktop[_ngcontent-%COMP%]{width:100vw;height:100vh;max-width:none;max-height:none;border-radius:0;inset:0;z-index:var(--z-popup)}.popup-container.desktop[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;max-width:none;max-height:none;border-radius:0;border:none;justify-content:flex-start;background:var(--modal-surface);overflow-y:auto}.three-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--spacing-md)}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:50px;font-size:18px}.button[_ngcontent-%COMP%]{height:60px;font-size:16px}.close[_ngcontent-%COMP%], .desktop-header[_ngcontent-%COMP%], .mobile-back[_ngcontent-%COMP%]{display:none}.mobile-header[_ngcontent-%COMP%]{display:flex}.form[_ngcontent-%COMP%]{background:linear-gradient(160deg,#141414f5,#0c0c0cfa);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:var(--spacing-lg);padding:0 10%;height:100%}.two-column[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr));box-sizing:border-box}.two-column[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{min-width:0}.two-column.single-column[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};var RT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api";createReport(n){return this.http.post(`${this.baseUrl}/reports`,n)}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};function Lie(i,n){if(i&1&&(z(0,"p",3),W(1,"You are reporting: "),z(2,"strong"),W(3),V()()),i&2){let e=te();K(3),ot(e.targetLabel)}}function Nie(i,n){if(i&1){let e=wt();z(0,"div",11)(1,"span"),W(2),V(),z(3,"button",15),Te("click",function(){Ee(e);let d=te();return Se(d.clearImage())}),z(4,"mat-icon"),W(5,"close"),V()()()}if(i&2){let e=te();K(2),ot(e.imageName)}}var S0=class i{constructor(n,e){this.reportService=n;this.snackBar=e}reporterId=null;targetType="USER";targetId=null;targetLabel="";close=new Vt;submitted=new Vt;reason="";details="";imageFile=null;imageName="";isSubmitting=!1;onClose(){this.close.emit()}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let a=e.files[0];this.imageFile=a,this.imageName=a.name}clearImage(){this.imageFile=null,this.imageName=""}submitReport(){if(!this.reporterId||!this.targetId){this.showToast("You must be logged in to report.","error");return}if(!this.reason.trim()){this.showToast("Please enter the main reason.","error");return}let n=new FormData;n.append("reporterId",this.reporterId),n.append("targetType",this.targetType),n.append("targetId",this.targetId),n.append("reason",this.reason.trim()),this.details.trim()&&n.append("details",this.details.trim()),this.imageFile&&n.append("image",this.imageFile,this.imageFile.name),this.isSubmitting=!0,this.reportService.createReport(n).subscribe({next:()=>{this.showToast("Report submitted."),this.isSubmitting=!1,this.submitted.emit(),this.onClose()},error:e=>{console.error("Error submitting report",e),this.showToast("Unable to submit the report.","error"),this.isSubmitting=!1}})}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1400:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Dt(RT),Dt(zc))};static \u0275cmp=vn({type:i,selectors:[["app-report-modal"]],inputs:{reporterId:"reporterId",targetType:"targetType",targetId:"targetId",targetLabel:"targetLabel"},outputs:{close:"close",submitted:"submitted"},decls:27,vars:7,consts:[[1,"report-backdrop",3,"click"],[1,"report-modal",3,"click"],[1,"report-header"],[1,"target-line"],["type","button",1,"icon-btn",3,"click"],[1,"report-body"],[1,"field-label"],["type","text","placeholder","E.g. Offensive language, scam, inappropriate behavior",1,"field-input",3,"ngModelChange","ngModel"],["rows","4","placeholder","Add any other helpful details...",1,"field-input","field-textarea",3,"ngModelChange","ngModel"],[1,"file-row"],["type","file","accept","image/*",1,"file-input",3,"change"],[1,"file-chip"],[1,"report-actions"],["type","button",1,"button","secondary",3,"click"],["type","button",1,"button",3,"click","disabled"],["type","button",1,"file-remove",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.onClose()}),z(1,"div",1),Te("click",function(r){return r.stopPropagation()}),z(2,"div",2)(3,"div")(4,"h3"),W(5),V(),Je(6,Lie,4,1,"p",3),V(),z(7,"button",4),Te("click",function(){return a.onClose()}),z(8,"mat-icon"),W(9,"close"),V()()(),z(10,"div",5)(11,"label",6),W(12,"Main reason"),V(),z(13,"input",7),vo("ngModelChange",function(r){return To(a.reason,r)||(a.reason=r),r}),V(),z(14,"label",6),W(15,"Details (optional)"),V(),z(16,"textarea",8),vo("ngModelChange",function(r){return To(a.details,r)||(a.details=r),r}),V(),z(17,"label",6),W(18,"Image (optional)"),V(),z(19,"div",9)(20,"input",10),Te("change",function(r){return a.onFileSelected(r)}),V(),Je(21,Nie,6,1,"div",11),V()(),z(22,"div",12)(23,"button",13),Te("click",function(){return a.onClose()}),W(24,"Cancel"),V(),z(25,"button",14),Te("click",function(){return a.submitReport()}),W(26),V()()()()),e&2&&(K(5),bi("Report ",a.targetType==="USER"?"user":"event"),K(),et(a.targetLabel?6:-1),K(7),_o("ngModel",a.reason),K(3),_o("ngModel",a.details),K(5),et(a.imageName?21:-1),K(4),vt("disabled",a.isSubmitting||!a.reason.trim()),K(),bi(" ",a.isSubmitting?"Sending...":"Submit report"," "))},dependencies:[fi,Ba,Cs,Ys,va,Pi,Ai,Fu],styles:[".report-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;justify-content:center;align-items:center;z-index:2000;padding:24px}.report-modal[_ngcontent-%COMP%]{background:#141414f2;color:#fff;border-radius:20px;width:min(520px,100%);box-shadow:0 20px 60px #00000080;border:1px solid rgba(252,195,36,.2);padding:20px 22px;display:flex;flex-direction:column;gap:16px}.report-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-start}.report-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px;color:#f4c12a}.target-line[_ngcontent-%COMP%]{margin:4px 0 0;color:#ffffffb3;font-size:13px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;cursor:pointer}.report-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.field-label[_ngcontent-%COMP%]{font-size:13px;color:#fffc}.field-input[_ngcontent-%COMP%]{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#ffffff14;color:#fff;padding:10px 12px;font-size:14px;outline:none}.field-input[_ngcontent-%COMP%]:focus{border-color:#fcc32499}.field-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:96px}.file-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.file-input[_ngcontent-%COMP%]{width:100%;color:#fffc;background:#ffffff14;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:6px 8px;font-size:14px;outline:none}.file-input[_ngcontent-%COMP%]:focus{border-color:#fcc32499}.file-input[_ngcontent-%COMP%]::file-selector-button, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button{margin-right:12px;border:none;background-color:var(--color-accent, #f4c12a);color:#fff;padding:8px 14px;border-radius:10px;font-weight:700;font-family:inherit;cursor:pointer;transition:transform .2s,opacity .2s}.file-input[_ngcontent-%COMP%]::file-selector-button:hover, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button:hover{opacity:.9;transform:translateY(-1px)}.file-input[_ngcontent-%COMP%]::file-selector-button:active, .file-input[_ngcontent-%COMP%]::-webkit-file-upload-button:active{transform:translateY(0)}.file-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#fcc32426;border:1px solid rgba(252,195,36,.4);padding:6px 10px;border-radius:999px;font-size:12px;max-width:100%;overflow:hidden;text-overflow:ellipsis}.file-chip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:280px}.file-remove[_ngcontent-%COMP%]{border:none;background:transparent;color:#f4c12a;cursor:pointer;display:flex;align-items:center}.report-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px}@media (max-width: 600px){.report-modal[_ngcontent-%COMP%]{padding:18px 16px}}"]})};function zie(i,n){if(i&1&&(z(0,"p",5)(1,"mat-icon",7),W(2,"place"),V(),z(3,"span"),W(4),V()()),i&2){let e=te();K(4),ot(e.event.city)}}function Bie(i,n){if(i&1&&(z(0,"p",5),W(1),V()),i&2){let e=te();K(),ot(e.getSubtitle())}}function Vie(i,n){if(i&1){let e=wt();z(0,"button",26),Te("click",function(d){Ee(e);let r=te();return Se(r.openInMaps(d))}),z(1,"mat-icon"),W(2,"map"),V()()}}function Uie(i,n){if(i&1&&(z(0,"span",28),W(1),V()),i&2){let e=te(2);K(),ot(e.event.savedCount)}}function jie(i,n){if(i&1){let e=wt();z(0,"button",27),Te("click",function(d){return Ee(e),te().toggleFavorite.emit(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2),V(),Je(3,Uie,2,1,"span",28),V()}if(i&2){let e=te();an("saved",e.isSaved()),K(2),ot(e.isSaved()?"favorite":"favorite_border"),K(),et(e.event.savedCount!==void 0&&e.event.savedCount!==null?3:-1)}}function $ie(i,n){if(i&1){let e=wt();z(0,"button",29),Te("click",function(d){return Ee(e),te().openReportModal(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2,"flag"),V()()}}function Hie(i,n){if(i&1&&(z(0,"span",14)(1,"mat-icon"),W(2,"event_available"),V(),z(3,"span"),W(4),V()()),i&2){let e=te();K(4),bi("",e.event.nPartecipants-(e.event.occupiedSpots||0)," spots left")}}function Gie(i,n){if(i&1&&(z(0,"p",30),W(1),V()),i&2){let e=te();K(),ot(e.event.description)}}function qie(i,n){if(i&1&&An(0,"img",20),i&2){let e=te();vt("src",e.organizerImage,no)}}function Wie(i,n){if(i&1&&(z(0,"div",21),W(1),V()),i&2){let e=te();K(),ot(e.getInitials(e.organizerName))}}function Zie(i,n){i&1&&(z(0,"span",31),W(1,"You"),V())}function Yie(i,n){if(i&1){let e=wt();z(0,"button",34),Te("click",function(d){return Ee(e),te(3).followOrganizer(),Se(d.stopPropagation())}),z(1,"mat-icon"),W(2,"person_add"),V()()}}function Xie(i,n){if(i&1){let e=wt();z(0,"div",33)(1,"button",35),Te("click",function(d){Ee(e);let r=te(3);return Se(r.toggleNotifications(d))}),z(2,"mat-icon"),W(3),V()()()}if(i&2){let e=te(3);K(),an("active",e.notificationsEnabled),vt("disabled",e.notificationsLoading),K(2),ot(e.notificationsEnabled?"notifications":"notifications_off")}}function Kie(i,n){if(i&1&&Je(0,Yie,3,0,"button",32)(1,Xie,4,4,"div",33),i&2){let e=te(2);et(!e.isFollowing&&!e.isLoadingFollowStatus?0:e.isFollowing?1:-1)}}function Qie(i,n){if(i&1&&Je(0,Zie,2,0,"span",31)(1,Kie,2,1),i&2){let e=te();et(e.currentUserId.toString()===((e.creatorId||e.event.creatorId)==null?null:(e.creatorId||e.event.creatorId).toString())?0:1)}}function Jie(i,n){if(i&1){let e=wt();z(0,"div",36),W(1,"You cannot join your own event"),V(),z(2,"button",37),Te("click",function(){Ee(e);let d=te();return Se(d.onDeleteEvent())}),W(3,"Delete event"),V()}}function ere(i,n){if(i&1){let e=wt();z(0,"div",38)(1,"button",41),W(2,"Joined"),V(),z(3,"button",42),Te("click",function(){Ee(e);let d=te(2);return Se(d.onOpenChat())}),W(4,"Chat"),V(),z(5,"button",43),Te("click",function(){Ee(e);let d=te(2);return Se(d.onLeave())}),W(6,"Leave"),V()()}}function tre(i,n){i&1&&(z(0,"button",39),W(1,"Pending"),V())}function nre(i,n){if(i&1){let e=wt();z(0,"button",44),Te("click",function(){Ee(e);let d=te(2);return Se(d.onParticipate())}),W(1,"Request to join"),V()}}function ire(i,n){if(i&1&&Je(0,ere,7,0,"div",38)(1,tre,2,0,"button",39)(2,nre,2,0,"button",40),i&2){let e=te();et(e.event.participationStatus==="ACCEPTED"?0:e.event.participationStatus==="PENDING"?1:2)}}function rre(i,n){if(i&1){let e=wt();z(0,"app-report-modal",45),Te("close",function(){Ee(e);let d=te();return Se(d.closeReportModal())})("submitted",function(){Ee(e);let d=te();return Se(d.closeReportModal())}),V()}if(i&2){let e=te();vt("reporterId",e.currentUserId)("targetType","EVENT")("targetId",e.event.id?e.event.id.toString():null)("targetLabel",e.event.title)}}var kT=class i{constructor(n,e){this.elementRef=n;this.userService=e}event;organizerName="Eventer";organizerImage;eventPosition;currentUserId=null;creatorId;close=new Vt;participate=new Vt;toggleFavorite=new Vt;openOrganizerProfile=new Vt;leave=new Vt;deleteEvent=new Vt;shareEvent=new Vt;openChat=new Vt;isFollowing=!1;isLoadingFollowStatus=!0;notificationsEnabled=!1;notificationsLoading=!1;showReportModal=!1;ngAfterViewInit(){this.positionCard()}ngOnChanges(n){n.eventPosition&&this.positionCard(),(n.event||n.currentUserId||n.creatorId)&&this.checkIfFollowing()}checkIfFollowing(){let n=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!n||this.currentUserId===n.toString()){this.isFollowing=!1,this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1;return}this.isLoadingFollowStatus=!0,this.userService.isFollowing(this.currentUserId,n.toString()).subscribe({next:e=>{this.isFollowing=e.isFollowing,this.isLoadingFollowStatus=!1,this.isFollowing?this.loadNotificationPreference(n.toString()):this.notificationsEnabled=!1},error:e=>{console.error("Error checking follow status",e),this.isLoadingFollowStatus=!1,this.notificationsEnabled=!1}})}onClick(n){n.stopPropagation()}onResize(){this.positionCard()}positionCard(){if(!this.eventPosition)return;let n=this.elementRef.nativeElement.querySelector(".card-container");if(n){let e=document.querySelector(".sidebar-container"),a=e?.getBoundingClientRect(),d=a&&!e?.classList.contains("collapsed")?a.right:0,r=12,C=d>0?d+r:r,P=r,X=window.innerWidth<=768?100:P,oe=n.offsetWidth||0,Me=n.offsetHeight||0,$e=window.innerWidth,ke=window.innerHeight,ht=-20,Nt=this.eventPosition.x,Mt=this.eventPosition.y+ht,Xt=Nt-oe/2,Vn=Nt+oe/2;Xt<C?Nt+=C-Xt:Vn>$e-P&&(Nt-=Vn-($e-P));let sr=Mt-Me;sr<X&&(Mt+=X-sr);let Ni=document.querySelector(".action-bar")?.getBoundingClientRect();if(Ni){let Or=Nt-oe/2,qo=Nt+oe/2,Ks=Mt-Me,Vu=Mt,Uu=qo>Ni.left-P&&Or<Ni.right+P,ci=Vu>Ni.top-P&&Ks<Ni.bottom+P;if(Uu&&ci){let ju=Ni.bottom+P;Ks<ju&&(Mt+=ju-Ks)}}Mt>ke-P&&(Mt=ke-P),n.style.left=`${Nt}px`,n.style.top=`${Mt}px`,n.style.transform="translate(-50%, -100%)"}}onClose(){this.close.emit()}onParticipate(){this.isOrganizer()||this.participate.emit(this.event)}onLeave(){this.leave.emit(this.event)}onOpenChat(){this.openChat.emit(this.event)}onDeleteEvent(){this.isOrganizer()&&this.deleteEvent.emit(this.event)}toggleNotifications(n){n.stopPropagation();let e=this.creatorId||(this.event?this.event.creatorId:null);if(!this.currentUserId||!e||!this.isFollowing)return;let a=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,e.toString(),a).subscribe({next:d=>{this.notificationsEnabled=d.enabled,this.notificationsLoading=!1},error:d=>{console.error("Error updating follow notifications",d),this.notificationsLoading=!1}})}isOrganizer(){let n=this.creatorId??this.event?.creatorId;return!!this.currentUserId&&!!n&&this.currentUserId.toString()===n.toString()}getOrganizerId(){let n=this.creatorId??this.event?.creatorId??this.event?.creator?.id;return n!=null?String(n):null}formatHeroDate(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):null,a=n?n.toLocaleDateString("en-US",{weekday:"short"}):"",d=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"";return[[a,d].filter(Boolean).join(" "),e||""].filter(Boolean).join(", ")}getActualParticipants(){return this.event.occupiedSpots!==void 0&&this.event.occupiedSpots!==null?this.event.occupiedSpots:this.event.nPartecipants||0}getSubtitle(){return this.event.city?this.event.city:this.event.description?this.event.description:"Location TBD"}hasCoordinates(){return!!this.event&&Number.isFinite(this.event.latitude)&&Number.isFinite(this.event.longitude)}openInMaps(n){if(n?.stopPropagation(),!this.hasCoordinates())return;let e=`https://www.google.com/maps/search/?api=1&query=${this.event.latitude},${this.event.longitude}`;window.open(e,"_blank","noopener")}showDescription(){return!!this.event.description&&this.event.description!==this.getSubtitle()}formatDateTime(){let n=this.event.date?new Date(`${this.event.date}T00:00:00`):null,e=this.event.startTime?this.event.startTime.slice(0,5):null,a=this.event.endTime?this.event.endTime.slice(0,5):null,d=n?n.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",r=a?`${e} \u2014 ${a}`:e;return[d,r].filter(Boolean).join(" / ")}formatCost(){return this.event.costPerPerson!==void 0&&this.event.costPerPerson!==null?`${this.event.costPerPerson} per person`:"Free"}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"OR"}isSaved(){return this.event.isSaved}followOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.followUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.userService.notifyUserUpdate()},error:e=>console.error("Error following",e)})}unfollowOrganizer(){let n=this.creatorId||(this.event?this.event.creatorId:null);!this.currentUserId||!n||this.userService.unfollowUser(this.currentUserId,n.toString()).subscribe({next:()=>{this.isFollowing=!1,this.notificationsEnabled=!1,this.userService.notifyUserUpdate()},error:e=>console.error("Error unfollowing",e)})}onOrganizerClick(){let n=this.getOrganizerId();if(!n){console.log("[EventPopupCard] eventer click with missing id",{creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event});return}console.log("[EventPopupCard] open eventer",{organizerId:n,creatorIdInput:this.creatorId,eventCreatorId:this.event?.creatorId,event:this.event}),this.openOrganizerProfile.emit(n)}openReportModal(){!this.currentUserId||this.isOrganizer()||(this.showReportModal=!0)}closeReportModal(){this.showReportModal=!1}loadNotificationPreference(n){this.currentUserId&&(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,n).subscribe({next:e=>{this.notificationsEnabled=!!e.enabled,this.notificationsLoading=!1},error:e=>{console.error("Error fetching follow notifications preference",e),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(e){return new(e||i)(Dt(pr),Dt(Es))};static \u0275cmp=vn({type:i,selectors:[["event-popup-card"]],hostBindings:function(e,a){e&1&&Te("click",function(r){return a.onClick(r)})("resize",function(){return a.onResize()},SA)},inputs:{event:"event",organizerName:"organizerName",organizerImage:"organizerImage",eventPosition:"eventPosition",currentUserId:"currentUserId",creatorId:"creatorId"},outputs:{close:"close",participate:"participate",toggleFavorite:"toggleFavorite",openOrganizerProfile:"openOrganizerProfile",leave:"leave",deleteEvent:"deleteEvent",shareEvent:"shareEvent",openChat:"openChat"},features:[Br],decls:47,vars:15,consts:[[1,"card-container"],[1,"card-content"],[1,"header-row"],[1,"title-block"],[1,"title"],[1,"subtitle"],[1,"accent-date"],[1,"inline-icon"],[1,"action-icons"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"saved"],["aria-label","Share event",1,"action-icon","share-icon",3,"click"],["aria-label","Report event",1,"action-icon","report-icon"],[1,"chip-row"],[1,"chip"],["class","chip",4,"ngIf"],["class","description",4,"ngIf"],[1,"eventer-section"],[1,"eventer-info"],["type","button",1,"eventer-hit",3,"click"],["alt","Eventer",1,"organizer-avatar",3,"src"],[1,"organizer-avatar","placeholder"],[1,"eventer-text"],[1,"eventer-label"],[1,"eventer-name"],[3,"reporterId","targetType","targetId","targetLabel"],["type","button","aria-label","Open in Google Maps",1,"action-icon","map-icon",3,"click"],["aria-label","Save event",1,"action-icon","favorite-icon",3,"click"],[1,"favorite-count"],["aria-label","Report event",1,"action-icon","report-icon",3,"click"],[1,"description"],[1,"is-organizer-badge"],[1,"icon-circle","follow-btn-popup"],[1,"notify-toggle"],[1,"icon-circle","follow-btn-popup",3,"click"],[1,"icon-circle","bell-btn",3,"click","disabled"],[1,"owner-note"],["type","button",1,"button","cancel-btn",3,"click"],[1,"participation-actions"],["disabled","",1,"button","partecipa-btn","pending"],[1,"button","partecipa-btn"],["disabled","",1,"button","partecipa-btn","accepted"],["type","button",1,"button","chat-btn",3,"click"],["type","button",1,"button","leave-btn",3,"click"],[1,"button","partecipa-btn",3,"click"],[3,"close","submitted","reporterId","targetType","targetId","targetLabel"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),W(5),V(),Je(6,zie,5,1,"p",5)(7,Bie,2,1,"p",5),z(8,"p",6)(9,"mat-icon",7),W(10,"event"),V(),z(11,"span"),W(12),V()()(),z(13,"div",8),Je(14,Vie,3,0,"button",9),Je(15,jie,4,4,"button",10),z(16,"button",11),Te("click",function(r){return a.shareEvent.emit(a.event),r.stopPropagation()}),z(17,"mat-icon"),W(18,"share"),V()(),Je(19,$ie,3,0,"button",12),V()(),z(20,"div",13)(21,"span",14)(22,"mat-icon"),W(23,"group"),V(),z(24,"span"),W(25),V()(),$i(26,Hie,5,1,"span",15),z(27,"span",14)(28,"mat-icon"),W(29,"euro"),V(),z(30,"span"),W(31),V()()(),$i(32,Gie,2,1,"p",16),z(33,"div",17)(34,"div",18)(35,"button",19),Te("click",function(r){return a.onOrganizerClick(),r.stopPropagation()}),Je(36,qie,1,1,"img",20)(37,Wie,2,1,"div",21),z(38,"div",22)(39,"span",23),W(40,"Eventer"),V(),z(41,"span",24),W(42),V()()()(),Je(43,Qie,2,1),V(),Je(44,Jie,4,0)(45,ire,3,1),V()(),Je(46,rre,1,4,"app-report-modal",25)),e&2&&(K(5),ot(a.event.title),K(),et(a.event.city?6:7),K(6),ot(a.formatHeroDate()),K(2),et(a.hasCoordinates()?14:-1),K(),et(a.event.isParticipating?-1:15),K(4),et(a.currentUserId&&!a.isOrganizer()?19:-1),K(6),bi("",a.getActualParticipants()," participants"),K(),vt("ngIf",a.event.occupiedSpots!==void 0),K(5),ot(a.formatCost()),K(),vt("ngIf",a.showDescription()),K(4),et(a.organizerImage?36:37),K(6),ot(a.organizerName),K(),et(a.currentUserId&&(a.creatorId||a.event.creatorId)?43:-1),K(),et(a.isOrganizer()?44:45),K(2),et(a.showReportModal&&a.event?46:-1))},dependencies:[fi,cs,Pi,Ai,S0],styles:[".card-container[_ngcontent-%COMP%]{position:absolute;z-index:900;pointer-events:none}.card-content[_ngcontent-%COMP%]{position:relative;width:380px;max-width:calc(100vw - 32px);background:radial-gradient(circle at 15% 20%,rgba(252,195,36,.18),transparent 34%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);border-radius:18px;padding:22px;display:flex;flex-direction:column;gap:10px;pointer-events:all;box-shadow:0 12px 30px #0000008c;border:1px solid rgba(255,255,255,.08);color:#f7f7f7;white-space:normal}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:10px 12px;flex-wrap:wrap}.title-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;flex:1 1 220px;min-width:0;padding-top:54px}.title[_ngcontent-%COMP%]{margin:0;font-size:32px;font-weight:var(--font-weight-bold);color:var(--color-white);line-height:1.05;text-transform:uppercase;letter-spacing:.4px;word-break:break-word;overflow-wrap:anywhere}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:var(--font-weight-regular);color:#e7e7e7;line-height:1.3;display:inline-flex;align-items:center;gap:6px}.inline-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--color-accent)}.accent-date[_ngcontent-%COMP%]{margin:2px 0 6px;font-size:18px;font-weight:var(--font-weight-bold);color:var(--color-accent);text-transform:lowercase;display:inline-flex;align-items:center;gap:6px}.action-icons[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;position:absolute;top:16px;right:16px;flex-wrap:nowrap;justify-content:flex-end}.action-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.12);background:#ffffff12;border-radius:14px;width:42px;height:42px;display:grid;place-items:center;color:#d8d8d8;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease,border-color .15s ease,background-color .15s ease}.favorite-icon[_ngcontent-%COMP%]{position:relative}.favorite-count[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;min-width:16px;height:16px;padding:0 4px;border-radius:999px;background:#0c0c0ce6;border:1px solid rgba(255,255,255,.22);color:var(--color-accent);font-size:9px;font-weight:var(--font-weight-bold);display:grid;place-items:center;line-height:1}.action-icon[_ngcontent-%COMP%]:hover{transform:translateY(-1px);border-color:#fff3;background:#ffffff1a}.favorite-icon.saved[_ngcontent-%COMP%]{color:var(--color-accent);border-color:#fcc32499;box-shadow:0 0 12px #fcc32447}.action-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px}.report-icon[_ngcontent-%COMP%]{color:#ff8b8b}.report-icon[_ngcontent-%COMP%]:hover{border-color:#ff8b8b80;background:#ff8b8b1f}.brand-pill[_ngcontent-%COMP%]{align-self:flex-start;padding:6px 10px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.14);color:var(--color-accent);font-weight:var(--font-weight-bold);font-size:12px;letter-spacing:.8px}.chip-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:8px 0 6px}.chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:#f5f5f5;font-size:11px;line-height:1.2}.chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:var(--color-accent)}.description[_ngcontent-%COMP%]{margin:6px 0 8px;font-size:15px;font-weight:var(--font-weight-light);color:#e6e6e6;line-height:1.6}.eventer-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:6px}.eventer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.eventer-hit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;padding:0;border-radius:0;border:none;background:transparent;color:inherit;cursor:pointer;transition:opacity .15s ease}.eventer-hit[_ngcontent-%COMP%]:hover{opacity:.8}.organizer-avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.15)}.organizer-avatar.placeholder[_ngcontent-%COMP%]{background:#ffffff1a;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.eventer-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;align-items:flex-start;text-align:left}.eventer-label[_ngcontent-%COMP%]{font-size:11px;font-weight:var(--font-weight-regular);color:#c7c7c7;letter-spacing:.6px;text-transform:uppercase}.eventer-name[_ngcontent-%COMP%]{font-size:14px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.is-organizer-badge[_ngcontent-%COMP%]{padding:8px 10px;border-radius:10px;background:#fcc3242e;border:1px solid rgba(252,195,36,.5);color:#f8f1d2;font-weight:var(--font-weight-semibold);font-size:12px}.icon-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#ffffff14;border:1px solid rgba(255,255,255,.12);display:flex;justify-content:center;align-items:center;cursor:pointer;transition:transform .15s ease,background-color .15s ease,border-color .15s ease}.icon-circle[_ngcontent-%COMP%]:hover{background-color:#ffffff24;border-color:#fff3}.icon-circle[_ngcontent-%COMP%]:active{transform:scale(.94)}.icon-circle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#f0f0f0}.follow-btn-popup.following[_ngcontent-%COMP%]{background-color:var(--color-accent);color:#0b0b0b;border-color:var(--color-accent)}.partecipa-btn[_ngcontent-%COMP%]{width:100%;margin-top:16px;background:var(--color-accent);color:var(--color-white);font-weight:var(--font-weight-bold);border:none;border-radius:12px;padding:10px 16px;font-size:15px;letter-spacing:.3px;box-shadow:0 8px 18px #fcc32440;transition:filter .15s ease,transform .1s ease}.partecipa-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.partecipa-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.partecipa-btn.pending[_ngcontent-%COMP%]{background-color:#ffb84d;color:#fff;opacity:.95}.partecipa-btn.accepted[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;opacity:.95}.partecipa-btn[_ngcontent-%COMP%]:disabled{pointer-events:none}.participation-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:16px}.participation-actions[_ngcontent-%COMP%]   .partecipa-btn[_ngcontent-%COMP%]{width:auto;margin-top:0;flex:1 1 auto}.chat-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:#ffffff14;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.chat-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f;border-color:#ffffff4d}.chat-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.leave-btn[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:transparent;color:#f7f7f7;font-weight:var(--font-weight-semibold);letter-spacing:.2px;transition:background-color .15s ease,border-color .15s ease,transform .1s ease}.leave-btn[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#ffffff47}.leave-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.owner-note[_ngcontent-%COMP%]{margin-top:16px;padding:12px 14px;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.12);color:#f0f0f0;font-weight:var(--font-weight-semibold);font-size:14px}.notify-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.bell-btn[_ngcontent-%COMP%]{background:#ffffff14;border:1px solid rgba(255,255,255,.2)}.bell-btn.active[_ngcontent-%COMP%]{background:#fbbc0429;border-color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.notify-label[_ngcontent-%COMP%]{font-size:12px;color:#cfcfcf}.cancel-btn[_ngcontent-%COMP%]{width:100%;margin-top:10px;background:#b61e1e;color:#fff;font-weight:var(--font-weight-semibold);border:none;border-radius:12px;padding:10px 14px;letter-spacing:.2px;box-shadow:0 8px 18px #b61e1e59;transition:filter .15s ease,transform .1s ease}.cancel-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.cancel-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 480px){.card-content[_ngcontent-%COMP%]{width:calc(100vw - 24px);padding:18px}.title-block[_ngcontent-%COMP%]{padding-top:0;padding-right:0}.action-icons[_ngcontent-%COMP%]{position:static;flex-wrap:wrap;justify-content:flex-start}.title[_ngcontent-%COMP%]{font-size:26px}.subtitle[_ngcontent-%COMP%], .accent-date[_ngcontent-%COMP%]{font-size:16px}}"]})};var LT=Pw(bO());var ore=(i,n)=>n.name;function sre(i,n){if(i&1){let e=wt();z(0,"mat-icon",10),Te("click",function(){Ee(e);let d=te();return d.searchQuery="",Se(d.cityResults=[])}),W(1,"close"),V()}}function are(i,n){if(i&1){let e=wt();z(0,"div",12),Te("click",function(){let d=Ee(e).$implicit,r=te(2);return Se(r.selectCity(d))}),z(1,"mat-icon"),W(2,"location_on"),V(),z(3,"span"),W(4),V()()}if(i&2){let e=n.$implicit;K(4),ot(e.name)}}function lre(i,n){if(i&1&&(z(0,"div",7),Wi(1,are,5,1,"div",11,ore),V()),i&2){let e=te();K(),Zi(e.cityResults)}}var FT=class i{constructor(n){this.mapboxService=n}locationSelected=new Vt;close=new Vt;map;selectedMarker=null;selectedCoords=null;searchQuery="";cityResults=[];ngAfterViewInit(){this.map=new LT.Map({accessToken:ul.mapboxToken,container:"location-map",style:"mapbox://styles/fnsbrl/cmhxy97pz004e01qx08c0gc44",center:[12.4964,41.9028],zoom:12,pitch:0,bearing:0}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{let e=[n.coords.longitude,n.coords.latitude];this.map.flyTo({center:e,zoom:17,duration:1e3})},n=>console.warn("Geolocation error:",n)),this.map.on("click",n=>{this.selectedCoords=[n.lngLat.lng,n.lngLat.lat],this.selectedMarker&&this.selectedMarker.remove();let e=document.createElement("div");e.style.width="30px",e.style.height="30px",e.style.backgroundColor="#FCC324",e.style.borderRadius="50%",e.style.border="3px solid white",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",this.selectedMarker=new LT.Marker({element:e}).setLngLat(this.selectedCoords).addTo(this.map)})}onSearch(){if(!this.searchQuery||this.searchQuery.trim()===""){this.cityResults=[];return}this.mapboxService.searchCity(this.searchQuery).subscribe(n=>{this.cityResults=n.map(e=>({name:e.place_name,center:e.center}))})}selectCity(n){this.map.flyTo({center:n.center,zoom:16,essential:!0}),this.searchQuery="",this.cityResults=[]}ngOnDestroy(){this.map&&this.map.remove()}onConfirm(){this.selectedCoords&&this.locationSelected.emit({lat:this.selectedCoords[1],lng:this.selectedCoords[0]})}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||i)(Dt(zu))};static \u0275cmp=vn({type:i,selectors:[["map-location-selector"]],outputs:{locationSelected:"locationSelected",close:"close"},decls:14,vars:4,consts:[[1,"backdrop",3,"click"],[1,"selector-container"],[1,"instruction-text"],[1,"search-section"],[1,"search-bar"],["type","text","placeholder","Search city or place...",3,"ngModelChange","input","ngModel"],[1,"clear-icon"],[1,"search-results"],["id","location-map",1,"map"],[1,"button","confirm-btn",3,"click","disabled"],[1,"clear-icon",3,"click"],[1,"result-item"],[1,"result-item",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0),Te("click",function(){return a.onClose()}),V(),z(1,"div",1)(2,"div",2),W(3," \u{1F4CD} Select a location for your event "),V(),z(4,"div",3)(5,"div",4)(6,"mat-icon"),W(7,"search"),V(),z(8,"input",5),vo("ngModelChange",function(r){return To(a.searchQuery,r)||(a.searchQuery=r),r}),Te("input",function(){return a.onSearch()}),V(),Je(9,sre,2,0,"mat-icon",6),V(),Je(10,lre,3,0,"div",7),V(),An(11,"div",8),z(12,"button",9),Te("click",function(){return a.onConfirm()}),W(13," Confirm Location "),V()()),e&2&&(K(8),_o("ngModel",a.searchQuery),K(),et(a.searchQuery?9:-1),K(),et(a.cityResults.length>0?10:-1),K(2),vt("disabled",!a.selectedCoords))},dependencies:[fi,Ba,Cs,Ys,va,Pi,Ai],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));z-index:var(--z-backdrop)}.selector-container[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:var(--z-popup);pointer-events:none;display:flex;flex-direction:column;align-items:center;padding:20px;gap:20px;background-color:transparent}.instruction-text[_ngcontent-%COMP%]{pointer-events:all;background:var(--color-dark-gray);color:var(--color-white);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:var(--font-weight-semibold);border:1px solid var(--color-light-gray);box-shadow:0 4px 12px #0000004d;text-align:center}.map[_ngcontent-%COMP%]{flex:1;width:100%;border-radius:20px;overflow:hidden;pointer-events:all;box-shadow:0 8px 24px #0006}.confirm-btn[_ngcontent-%COMP%]{pointer-events:all;min-width:250px;box-shadow:0 4px 12px #0000004d}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.confirm-btn[_ngcontent-%COMP%]:disabled:hover{filter:grayscale(1);transform:none}.search-section[_ngcontent-%COMP%]{width:100%;max-width:400px;position:relative;pointer-events:all;z-index:2100}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;padding:8px 16px;box-shadow:0 4px 12px #0000004d}.search-bar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);margin-right:8px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;color:#fff;font-size:16px;outline:none}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--color-gray)}.clear-icon[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-gray);margin-left:8px}.clear-icon[_ngcontent-%COMP%]:hover{color:#fff}.search-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;background:var(--color-dark-gray);border:1px solid var(--color-light-gray);border-radius:12px;margin-top:8px;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px #00000080;z-index:2200}.result-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;transition:background .2s;color:#fff}.result-item[_ngcontent-%COMP%]:hover{background:#ffffff1a}.result-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-gray);font-size:20px;width:20px;height:20px}"]})};var PR=(i,n)=>n.id;function cre(i,n){i&1&&(z(0,"div",7),W(1,"Loading..."),V())}function ure(i,n){if(i&1&&An(0,"img",14),i&2){let e=te(3);vt("src",e.user.profileImage,no)}}function dre(i,n){if(i&1&&(z(0,"div",15),W(1),V()),i&2){let e=te(3);K(),ot(e.getInitials(e.user.name))}}function hre(i,n){if(i&1&&(z(0,"p",24),W(1),V()),i&2){let e=te(3);K(),bi(" ",e.user.email," ")}}function pre(i,n){if(i&1&&(z(0,"p",25),W(1),V()),i&2){let e=te(3);K(),ot(e.user.description)}}function fre(i,n){if(i&1){let e=wt();z(0,"button",30),Te("click",function(d){Ee(e);let r=te(4);return Se(r.toggleNotifications(d))}),z(1,"mat-icon"),W(2),V()()}if(i&2){let e=te(4);an("active",e.notificationsEnabled),vt("disabled",e.notificationsLoading),K(2),ot(e.notificationsEnabled?"notifications":"notifications_off")}}function mre(i,n){if(i&1){let e=wt();z(0,"div",26)(1,"button",27),Te("click",function(){Ee(e);let d=te(3);return Se(d.toggleFollow())}),W(2),V(),Je(3,fre,3,4,"button",28),V(),z(4,"button",29),Te("click",function(){Ee(e);let d=te(3);return Se(d.openReportModal())}),z(5,"mat-icon"),W(6,"flag"),V(),W(7," Segnala "),V()}if(i&2){let e=te(3);K(),an("following",e.isFollowing),K(),bi(" ",e.isFollowing?"Following":"Follow"," "),K(),et(e.isFollowing?3:-1)}}function gre(i,n){if(i&1){let e=wt();z(0,"div",10)(1,"div",13),Je(2,ure,1,1,"img",14)(3,dre,2,1,"div",15),V(),z(4,"h3",16),W(5),V(),$i(6,hre,2,1,"p",17)(7,pre,2,1,"p",18),Je(8,mre,8,4),z(9,"div",19)(10,"div",20),Te("click",function(){Ee(e);let d=te(2);return Se(d.showFollowers())}),z(11,"span",21),W(12),V(),z(13,"span",22),W(14,"Followers"),V()(),An(15,"div",23),z(16,"div",20),Te("click",function(){Ee(e);let d=te(2);return Se(d.showFollowing())}),z(17,"span",21),W(18),V(),z(19,"span",22),W(20,"Following"),V()(),An(21,"div",23),z(22,"div",20),Te("click",function(){Ee(e);let d=te(2);return Se(d.showEvents())}),z(23,"span",21),W(24),V(),z(25,"span",22),W(26,"Events"),V()()()()}if(i&2){let e=te(2);K(2),et(e.user.profileImage?2:3),K(3),ot(e.user.name),K(),vt("ngIf",e.user.email&&e.currentUserId&&e.user.id.toString()===e.currentUserId),K(),vt("ngIf",e.user.description),K(),et(e.currentUserId&&e.user.id.toString()!==e.currentUserId?8:-1),K(4),ot(e.user.followersCount||0),K(6),ot(e.user.followingCount||0),K(6),ot(e.user.approvedEventsCount||0)}}function _re(i,n){if(i&1&&An(0,"img",38),i&2){let e=te().$implicit;vt("src",e.profileImage,no)}}function vre(i,n){if(i&1&&(z(0,"div",39),W(1),V()),i&2){let e=te().$implicit,a=te(4);K(),ot(a.getInitials(e.name))}}function yre(i,n){if(i&1){let e=wt();z(0,"button",43),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te(4);return Se(r.onListUnfollow(d))}),W(1,"Unfollow"),V()}}function xre(i,n){if(i&1){let e=wt();z(0,"button",44),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te(4);return Se(r.onListFollow(d))}),W(1,"Follow"),V()}}function bre(i,n){if(i&1&&Je(0,yre,2,0,"button",41)(1,xre,2,0,"button",42),i&2){let e=te().$implicit,a=te(4);et(a.myFollowingIds.has(e.id.toString())?0:1)}}function wre(i,n){if(i&1){let e=wt();z(0,"div",35)(1,"div",37),Te("click",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.onOpenProfileFromList(d))}),Je(2,_re,1,1,"img",38)(3,vre,2,1,"div",39),z(4,"span",40),W(5),V()(),Je(6,bre,2,1),V()}if(i&2){let e=n.$implicit,a=te(4);K(2),et(e.profileImage?2:3),K(3),ot(e.name),K(),et(a.currentUserId&&e.id.toString()!==a.currentUserId?6:-1)}}function Cre(i,n){i&1&&(z(0,"div",36),W(1,"No users found."),V())}function Ere(i,n){if(i&1&&(z(0,"div",34),Wi(1,wre,7,3,"div",35,PR),Je(3,Cre,2,0,"div",36),V()),i&2){let e=te(3);K(),Zi(e.userList),K(2),et(e.userList.length===0?3:-1)}}function Sre(i,n){i&1&&(z(0,"div",7),W(1,"Loading list..."),V())}function Tre(i,n){if(i&1){let e=wt();z(0,"div",11)(1,"div",31)(2,"button",32),Te("click",function(){Ee(e);let d=te(2);return Se(d.onClose())}),z(3,"mat-icon"),W(4,"arrow_back"),V()(),z(5,"h3"),W(6),V()(),$i(7,Ere,4,1,"div",33)(8,Sre,2,0,"ng-template",null,0,fx),V()}if(i&2){let e=Bl(9),a=te(2);K(6),ot(a.view==="followers"?"Followers":"Following"),K(),vt("ngIf",!a.loadingList)("ngIfElse",e)}}function Ire(i,n){i&1&&(z(0,"div",7),W(1,"Loading events..."),V())}function Mre(i,n){i&1&&(z(0,"div",36),W(1,"No upcoming events."),V())}function Dre(i,n){if(i&1){let e=wt();z(0,"div",47),Te("click",function(){let d=Ee(e).$implicit,r=te(4);return Se(r.focusEventOnMap(d))}),z(1,"div",48)(2,"p",49),W(3),V(),z(4,"p",50)(5,"mat-icon",51),W(6,"event"),V(),z(7,"span"),W(8),V(),z(9,"mat-icon",51),W(10,"place"),V(),z(11,"span"),W(12),V()()(),z(13,"div",52)(14,"span",53)(15,"mat-icon"),W(16,"group"),V(),z(17,"span"),W(18),V()(),z(19,"span",53)(20,"mat-icon"),W(21,"euro"),V(),z(22,"span"),W(23),V()()()()}if(i&2){let e=n.$implicit,a=te(4);K(3),ot(e.title),K(5),ot(a.formatEventDate(e)),K(4),ot(e.city),K(6),bi("",a.eventStats(e).participants," participants"),K(5),ot(a.eventStats(e).cost)}}function Are(i,n){if(i&1&&Wi(0,Dre,24,5,"div",46,PR),i&2){let e=te(3);Zi(e.upcomingEvents)}}function Pre(i,n){i&1&&(z(0,"div",7),W(1,"Loading events..."),V())}function Ore(i,n){i&1&&(z(0,"div",36),W(1,"No past events."),V())}function Rre(i,n){if(i&1&&(z(0,"div",54)(1,"div",48)(2,"p",49),W(3),V(),z(4,"p",50)(5,"mat-icon",51),W(6,"event"),V(),z(7,"span"),W(8),V(),z(9,"mat-icon",51),W(10,"place"),V(),z(11,"span"),W(12),V()()(),z(13,"div",52)(14,"span",53)(15,"mat-icon"),W(16,"group"),V(),z(17,"span"),W(18),V()(),z(19,"span",53)(20,"mat-icon"),W(21,"euro"),V(),z(22,"span"),W(23),V()()()()),i&2){let e=n.$implicit,a=te(4);K(3),ot(e.title),K(5),ot(a.formatEventDate(e)),K(4),ot(e.city),K(6),bi("",a.eventStats(e).participants," participants"),K(5),ot(a.eventStats(e).cost)}}function kre(i,n){if(i&1&&Wi(0,Rre,24,5,"div",54,PR),i&2){let e=te(3);Zi(e.pastEvents)}}function Fre(i,n){if(i&1&&(z(0,"div",12)(1,"div",45)(2,"h4"),W(3,"Upcoming"),V(),Je(4,Ire,2,0,"div",7)(5,Mre,2,0,"div",36)(6,Are,2,0),V(),z(7,"div",45)(8,"h4"),W(9,"Past"),V(),Je(10,Pre,2,0,"div",7)(11,Ore,2,0,"div",36)(12,kre,2,0),V()()),i&2){let e=te(2);K(4),et(e.loadingEvents?4:e.upcomingEvents.length===0?5:6),K(6),et(e.loadingEvents?10:e.pastEvents.length===0?11:12)}}function Lre(i,n){if(i&1&&(Je(0,gre,27,8,"div",10),Je(1,Tre,10,3,"div",11),Je(2,Fre,13,2,"div",12)),i&2){let e=te();et(e.view==="profile"?0:-1),K(),et(e.view==="followers"||e.view==="following"?1:-1),K(),et(e.view==="events"?2:-1)}}function Nre(i,n){i&1&&(z(0,"div",8),W(1,"Unable to load profile."),V())}function zre(i,n){if(i&1){let e=wt();z(0,"app-report-modal",55),Te("close",function(){Ee(e);let d=te();return Se(d.closeReportModal())})("submitted",function(){Ee(e);let d=te();return Se(d.closeReportModal())}),V()}if(i&2){let e=te();vt("reporterId",e.currentUserId)("targetType","USER")("targetId",e.user.id.toString())("targetLabel",e.user.name)}}var NT=class i{constructor(n,e,a){this.userService=n;this.eventService=e;this.confirmation=a}userId=null;currentUserId=null;close=new Vt;openProfile=new Vt;focusEvent=new Vt;user=null;isFollowing=!1;loading=!1;notificationsEnabled=!1;notificationsLoading=!1;view="profile";userList=[];loadingList=!1;myFollowingIds=new Set;loadingEvents=!1;upcomingEvents=[];pastEvents=[];showReportModal=!1;ngOnChanges(n){n.userId&&this.userId&&(this.loadUser(),this.checkIfFollowing())}onClose(){this.view!=="profile"?this.view="profile":this.close.emit()}getViewTitle(){switch(this.view){case"followers":return"Followers";case"following":return"Following";case"events":return"Events";default:return"Profile"}}loadUser(){this.userId&&(this.loading=!0,this.userService.getUserById(this.userId).subscribe({next:n=>{this.user=n,this.loading=!1},error:n=>{console.error("Error loading user profile",n),this.loading=!1}}))}checkIfFollowing(){!this.userId||!this.currentUserId||this.userService.isFollowing(this.currentUserId,this.userId).subscribe({next:n=>{this.isFollowing=n.isFollowing,this.isFollowing?this.loadNotificationPreference():this.notificationsEnabled=!1},error:n=>console.error(n)})}toggleFollow(){return Sr(this,null,function*(){if(!(!this.userId||!this.currentUserId))if(this.isFollowing){if(!(yield this.confirmation.confirm({title:"Unfollow user",message:"Are you sure you want to unfollow this user?",confirmText:"Unfollow",cancelText:"Cancel",confirmClass:"white-text"})))return;this.userService.unfollowUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!1,this.user&&(this.user.followersCount=(this.user.followersCount||1)-1),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}else this.userService.followUser(this.currentUserId,this.userId).subscribe({next:()=>{this.isFollowing=!0,this.notificationsEnabled=!0,this.user&&(this.user.followersCount=(this.user.followersCount||0)+1),this.userService.notifyUserUpdate()},error:n=>console.error(n)})})}getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):""}showFollowers(){this.userId&&(this.view="followers",this.loadingList=!0,this.userService.getFollowers(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}showFollowing(){this.userId&&(this.view="following",this.loadingList=!0,this.userService.getFollowing(this.userId).subscribe({next:n=>{this.userList=n,this.fetchMyFollowing()},error:n=>{console.error(n),this.loadingList=!1}}))}fetchMyFollowing(){if(!this.currentUserId){this.loadingList=!1;return}this.userService.getFollowing(this.currentUserId).subscribe({next:n=>{this.myFollowingIds=new Set(n.map(e=>e.id.toString())),this.loadingList=!1},error:n=>{console.error(n),this.loadingList=!1}})}onListFollow(n){this.currentUserId&&this.userService.followUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.add(n.id.toString()),this.userService.notifyUserUpdate()},error:e=>console.error(e)})}onOpenProfileFromList(n){n?.id&&(this.view="profile",this.openProfile.emit(n.id.toString()))}onListUnfollow(n){return Sr(this,null,function*(){!this.currentUserId||!(yield this.confirmation.confirm({title:"Unfollow user",message:`Are you sure you want to unfollow ${n.name}?`,confirmText:"Unfollow",cancelText:"Cancel",confirmClass:"white-text"}))||this.userService.unfollowUser(this.currentUserId,n.id.toString()).subscribe({next:()=>{this.myFollowingIds.delete(n.id.toString()),this.userService.notifyUserUpdate()},error:a=>console.error(a)})})}showEvents(){this.userId&&(this.view="events",!(this.upcomingEvents.length||this.pastEvents.length||this.loadingEvents)&&(this.loadingEvents=!0,this.eventService.getOrganizedEvents(this.userId).subscribe({next:n=>{let e=new Date;this.upcomingEvents=[],this.pastEvents=[],n.forEach(a=>{new Date(`${a.date}T${a.endTime||a.startTime||"00:00"}`).getTime()>=e.getTime()?this.upcomingEvents.push(a):this.pastEvents.push(a)}),this.upcomingEvents.sort((a,d)=>new Date(`${a.date}T${a.startTime||"00:00"}`).getTime()-new Date(`${d.date}T${d.startTime||"00:00"}`).getTime()),this.pastEvents.sort((a,d)=>new Date(`${d.date}T${d.startTime||"00:00"}`).getTime()-new Date(`${a.date}T${a.startTime||"00:00"}`).getTime()),this.loadingEvents=!1},error:n=>{console.error("Error loading events by user",n),this.loadingEvents=!1}})))}focusEventOnMap(n){this.focusEvent.emit(n)}formatEventDate(n){let e=n.date?new Date(`${n.date}T00:00:00`):null,a=n.startTime?n.startTime.slice(0,5):"",d=n.endTime?n.endTime.slice(0,5):"",r=e?e.toLocaleDateString("en-US",{day:"2-digit",month:"short"}):"",C=a&&d?`${a} - ${d}`:a||d;return[r,C].filter(Boolean).join(" \u2022 ")}eventStats(n){let e=n.occupiedSpots??0,a=n.nPartecipants??null,d=`${e}${a?`/${a}`:""}`,r;a!=null&&(r=Math.max(a-e,0).toString());let C=n.costPerPerson==null||n.costPerPerson===0?"Free":n.costPerPerson.toString();return{participants:d,freeSpots:r,cost:C}}toggleNotifications(n){if(n?.stopPropagation(),!this.currentUserId||!this.userId||!this.isFollowing)return;let e=!this.notificationsEnabled;this.notificationsLoading=!0,this.userService.setFollowNotifications(this.currentUserId,this.userId,e).subscribe({next:a=>{this.notificationsEnabled=a.enabled,this.notificationsLoading=!1},error:a=>{console.error("Error updating follow notifications",a),this.notificationsLoading=!1}})}openReportModal(){!this.user||!this.currentUserId||this.user.id.toString()!==this.currentUserId&&(this.showReportModal=!0)}closeReportModal(){this.showReportModal=!1}loadNotificationPreference(){!this.currentUserId||!this.userId||(this.notificationsLoading=!0,this.userService.getFollowNotifications(this.currentUserId,this.userId).subscribe({next:n=>{this.notificationsEnabled=!!n.enabled,this.notificationsLoading=!1},error:n=>{console.error("Error loading follow notification preference",n),this.notificationsEnabled=!1,this.notificationsLoading=!1}}))}static \u0275fac=function(e){return new(e||i)(Dt(Es),Dt(Xs),Dt(Na))};static \u0275cmp=vn({type:i,selectors:[["app-user-profile-modal"]],inputs:{userId:"userId",currentUserId:"currentUserId"},outputs:{close:"close",openProfile:"openProfile",focusEvent:"focusEvent"},features:[Br],decls:15,vars:5,consts:[["loadingTemplate",""],[1,"modal-backdrop",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"back-btn","header-back-btn","mobile-only",3,"click"],[1,"yellow-title"],[1,"close-btn","tablet-desktop-only",3,"click"],[1,"loading-spinner"],[1,"error-state"],[3,"reporterId","targetType","targetId","targetLabel"],[1,"profile-content"],[1,"list-view"],[1,"events-view"],[1,"avatar-container"],["alt","Profile",1,"profile-image",3,"src"],[1,"profile-placeholder"],[1,"user-name"],["class","user-email",4,"ngIf"],["class","user-description",4,"ngIf"],[1,"stats-container"],[1,"stat-item","clickable",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-divider"],[1,"user-email"],[1,"user-description"],[1,"follow-actions"],[1,"button","follow-main-btn",3,"click"],[1,"bell-btn",3,"active","disabled"],["type","button",1,"report-btn",3,"click"],[1,"bell-btn",3,"click","disabled"],[1,"list-header"],[1,"back-btn",3,"click"],["class","user-list",4,"ngIf","ngIfElse"],[1,"user-list"],[1,"user-item"],[1,"empty-list"],[1,"user-info",3,"click"],[1,"list-avatar",3,"src"],[1,"list-avatar-placeholder"],[1,"list-username"],[1,"unfollow-btn","small-btn"],[1,"follow-btn","small-btn"],[1,"unfollow-btn","small-btn",3,"click"],[1,"follow-btn","small-btn",3,"click"],[1,"events-section"],[1,"event-card","clickable"],[1,"event-card","clickable",3,"click"],[1,"event-card-header"],[1,"event-title"],[1,"event-sub"],[1,"inline-icon"],[1,"event-stats"],[1,"pill","stat-pill"],[1,"event-card","past"],[3,"close","submitted","reporterId","targetType","targetId","targetLabel"]],template:function(e,a){e&1&&(z(0,"div",1),Te("click",function(){return a.onClose()}),z(1,"div",2),Te("click",function(r){return r.stopPropagation()}),z(2,"div",3)(3,"button",4),Te("click",function(){return a.onClose()}),z(4,"mat-icon"),W(5,"arrow_back"),V()(),z(6,"h2",5),W(7),V(),z(8,"button",6),Te("click",function(){return a.onClose()}),z(9,"mat-icon"),W(10,"close"),V()()(),Je(11,cre,2,0,"div",7)(12,Lre,3,3)(13,Nre,2,0,"div",8),V()(),Je(14,zre,1,4,"app-report-modal",9)),e&2&&(K(),an("events-mode",a.view==="events"),K(6),ot(a.getViewTitle()),K(4),et(a.loading?11:a.user?12:13),K(3),et(a.showReportModal&&a.user?14:-1))},dependencies:[fi,cs,Pi,Ai,S0],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--modal-backdrop-color);-webkit-backdrop-filter:blur(var(--modal-backdrop-blur));backdrop-filter:blur(var(--modal-backdrop-blur));display:flex;justify-content:center;align-items:center;z-index:2000}.modal-container[_ngcontent-%COMP%]{background:var(--modal-surface);width:90%;max-width:400px;border-radius:var(--modal-radius);padding:24px;color:#fff;border:var(--modal-border);box-shadow:var(--modal-shadow);max-height:85vh;display:flex;flex-direction:column;overflow:hidden}.modal-container.events-mode[_ngcontent-%COMP%]{background:var(--modal-surface)}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;max-height:100vh;border-radius:0;padding:24px 32px 80px}.profile-content[_ngcontent-%COMP%]{padding:0 8px}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:24px;padding-top:2px;position:relative}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;line-height:1.2;text-align:center}.yellow-title[_ngcontent-%COMP%]{color:var(--color-accent)!important}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{justify-content:center;gap:16px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;flex:0 1 auto}.header-back-btn[_ngcontent-%COMP%]{display:inline-flex!important}}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.profile-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.avatar-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.profile-image[_ngcontent-%COMP%], .profile-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.profile-placeholder[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffb800,#ffdc73);color:#1a1a1a;font-size:36px;font-weight:700;display:flex;align-items:center;justify-content:center}.user-name[_ngcontent-%COMP%]{margin:0;font-size:22px;font-weight:600}.user-email[_ngcontent-%COMP%]{margin:0;color:#888;font-size:14px}.user-description[_ngcontent-%COMP%]{margin:8px 0 0;color:#e0e0e0;font-size:14px;font-weight:400;line-height:1.4;max-width:90%;opacity:.9;text-align:center}.follow-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;margin:6px 0 12px}.report-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#ffffff0f;border:1px solid rgba(255,255,255,.2);color:#ff8b8b;padding:8px 14px;border-radius:18px;cursor:pointer;font-size:13px}.report-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.report-btn[_ngcontent-%COMP%]:hover{border-color:#ff8b8b99}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:0;margin-top:16px;background:#ffffff0d;padding:16px 12px;border-radius:12px;width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer}.stat-item.clickable[_ngcontent-%COMP%]:hover{opacity:.8}.stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#ffb800}.stat-label[_ngcontent-%COMP%]{font-size:11px;color:#888;text-transform:uppercase;letter-spacing:.5px}.stat-divider[_ngcontent-%COMP%]{width:1px;height:30px;background:#ffffff1a;flex-shrink:0}.follow-main-btn[_ngcontent-%COMP%]{width:100%;max-width:220px;margin:0 auto;color:#fff!important}.follow-main-btn[_ngcontent-%COMP%]:not(.following){background-color:var(--color-accent)}.follow-main-btn.following[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.bell-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#ffffff0f;color:#f1f1f1;display:grid;place-items:center;cursor:pointer;transition:background-color .2s ease,border-color .2s ease,transform .1s ease}.bell-btn[_ngcontent-%COMP%]:hover{background:#ffffff1f}.bell-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.bell-btn.active[_ngcontent-%COMP%]{border-color:var(--color-accent);background:#fbbc042e;color:var(--color-accent)}.bell-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.events-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;padding-right:4px;scrollbar-width:thin;scrollbar-color:var(--color-bit-gray) transparent;max-height:500px}.events-section[_ngcontent-%COMP%]{background:#ffffff0a;padding:12px;border-radius:14px;display:flex;flex-direction:column;gap:10px;border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 16px #0000004d}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.events-view[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--color-bit-gray);border-radius:20px}.events-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;text-transform:uppercase;letter-spacing:.5px;color:#cfcfcf}.event-card[_ngcontent-%COMP%]{background:#ffffff0f;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 16px #0000004d}.event-card.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:border-color .2s ease,background-color .2s ease,transform .1s ease}.event-card.clickable[_ngcontent-%COMP%]:hover{border-color:#fcc32466;background:#ffffff14}.event-card.clickable[_ngcontent-%COMP%]:active{transform:translateY(1px)}.event-card.past[_ngcontent-%COMP%]{opacity:.85}.event-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.event-title[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:800;color:#fdfdfd}.event-sub[_ngcontent-%COMP%]{margin:2px 0 0;font-size:13px;color:#d6d6d6;display:flex;align-items:center;gap:8px}.event-sub[_ngcontent-%COMP%]   .inline-icon[_ngcontent-%COMP%]{color:var(--color-accent);font-size:18px;width:18px;height:18px;line-height:18px;flex-shrink:0}.event-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;align-items:center}.stat-pill[_ngcontent-%COMP%]{border-color:#ffffff26;background:#ffffff14;color:#f5f5f5;font-size:12px;padding:7px 9px;gap:5px;border-radius:999px;display:inline-flex;align-items:center}.stat-pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;line-height:16px;color:var(--color-accent);flex-shrink:0}.list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;line-height:0}.header-back-btn[_ngcontent-%COMP%]{position:absolute;left:12px;top:50%;transform:translateY(-50%);z-index:2}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%)}.user-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:12px;padding-right:4px}.user-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;background:#ffffff0d;border-radius:8px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.list-avatar[_ngcontent-%COMP%], .list-avatar-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.list-avatar-placeholder[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}.list-username[_ngcontent-%COMP%]{font-weight:500;font-size:14px}.small-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600;cursor:pointer;border:none}.small-btn.follow-btn[_ngcontent-%COMP%]{background:#ffb800;color:#1a1a1a}.small-btn.unfollow-btn[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff}.loading-spinner[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-list[_ngcontent-%COMP%]{text-align:center;color:#888;padding:20px}"]})};function Bre(i,n){if(i&1){let e=wt();z(0,"div",2)(1,"a",10),Te("click",function(){Ee(e);let d=te();return Se(d.openSignUp())}),W(2,"Sign Up"),V(),z(3,"a",10),Te("click",function(){Ee(e);let d=te();return Se(d.openSignIn())}),W(4,"Sign In"),V()()}}function Vre(i,n){if(i&1){let e=wt();z(0,"app-action-bar",11),Te("action",function(d){Ee(e);let r=te();return Se(r.onMenuAction(d))})("openProfile",function(d){Ee(e);let r=te();return Se(r.openUserProfile(d))})("openChatFromNotification",function(d){Ee(e);let r=te();return Se(r.onChatNotification(d))})("openEventFromNotification",function(d){Ee(e);let r=te();return Se(r.onUpcomingEventNotification(d))})("focusEvent",function(d){Ee(e);let r=te();return Se(r.onFocusEventFromMenu(d))}),V(),z(1,"input",12),Te("change",function(d){Ee(e);let r=te();return Se(r.onFileSelected(d))}),V()}if(i&2){let e=te();vt("loggedUser",e.loggedUser)}}function Ure(i,n){if(i&1){let e=wt();z(0,"SignUpPopup",13),Te("switchToSignIn",function(){Ee(e);let d=te();return Se(d.switchToSignIn())})("close",function(){Ee(e);let d=te();return Se(d.closeAll())})("signUpSuccess",function(d){Ee(e);let r=te();return Se(r.openVerifyPopup(d.email,d.token))})("signInSuccess",function(d){Ee(e);let r=te();return Se(r.onSignInSuccess(d))}),V()}}function jre(i,n){if(i&1){let e=wt();z(0,"VerifyEmailPopup",14),Te("close",function(){Ee(e);let d=te();return Se(d.closeAll())})("resendVerification",function(){Ee(e);let d=te();return Se(d.resendEmail())}),V()}if(i&2){let e=te();vt("email",e.recentEmail)("token",e.recentToken)("verified",e.emailVerified)}}function $re(i,n){if(i&1){let e=wt();z(0,"SignInPopup",15),Te("switchToSignUp",function(){Ee(e);let d=te();return Se(d.switchToSignUp())})("close",function(){Ee(e);let d=te();return Se(d.closeAll())})("signInSuccess",function(d){Ee(e);let r=te();return Se(r.onSignInSuccess(d))}),V()}}function Hre(i,n){if(i&1){let e=wt();z(0,"app-user-profile-modal",16),Te("close",function(){Ee(e);let d=te();return Se(d.closeAll())})("openProfile",function(d){Ee(e);let r=te();return Se(r.openUserProfile(d))})("focusEvent",function(d){Ee(e);let r=te();return Se(r.onFocusEventFromProfile(d))}),V()}if(i&2){let e=te();vt("userId",e.selectedUserProfileId)("currentUserId",e.loggedUser?e.loggedUser.id.toString():null)}}function Gre(i,n){if(i&1){let e=wt();z(0,"CropImagePopup",17),Te("close",function(){Ee(e);let d=te();return Se(d.showCropPopup=!1)})("imageCropped",function(d){Ee(e);let r=te();return Se(r.onImageCropped(d))}),V()}if(i&2){let e=te();vt("imageFile",e.selectedImageFile)}}function qre(i,n){if(i&1){let e=wt();z(0,"create-event-popup",18,0),Te("close",function(){Ee(e);let d=te();return Se(d.showCreateEventPopup=!1)})("eventCreated",function(){Ee(e);let d=te();return Se(d.closeAll())})("openLocationSelector",function(){Ee(e);let d=Bl(1),r=te();return r.createEventPopupRef=d,Se(r.openLocationSelector())}),V()}if(i&2){let e=te();$o("display",e.showLocationSelector?"none":"block")}}function Wre(i,n){if(i&1){let e=wt();z(0,"map-location-selector",19),Te("locationSelected",function(d){Ee(e);let r=te();return Se(r.onLocationSelected(d))})("close",function(){Ee(e);let d=te();return Se(d.showLocationSelector=!1)}),V()}}function Zre(i,n){if(i&1){let e=wt();z(0,"event-popup-card",20),Te("close",function(){Ee(e);let d=te();return Se(d.closeEventPopup())})("participate",function(d){Ee(e);let r=te();return Se(r.onParticipate(d))})("toggleFavorite",function(){Ee(e);let d=te();return Se(d.onToggleFavorite())})("openOrganizerProfile",function(d){Ee(e);let r=te();return Se(r.openUserProfile(d))})("leave",function(d){Ee(e);let r=te();return Se(r.onLeaveEvent(d))})("deleteEvent",function(d){Ee(e);let r=te();return Se(r.onDeleteEvent(d))})("shareEvent",function(d){Ee(e);let r=te();return Se(r.openShare(d))})("openChat",function(d){Ee(e);let r=te();return Se(r.openChat(d))}),V()}if(i&2){let e=te();vt("event",e.selectedEvent)("eventPosition",e.eventScreenPosition||void 0)("organizerName",e.selectedEvent.organizerName||"")("organizerImage",e.selectedEvent.organizerImage)("currentUserId",e.loggedUser&&e.loggedUser.id?e.loggedUser.id.toString():null)("creatorId",e.selectedEvent.creatorId)}}function Yre(i,n){if(i&1){let e=wt();z(0,"event-chat-modal",21),Te("close",function(){Ee(e);let d=te();return Se(d.closeChat())}),V()}if(i&2){let e=te();vt("event",e.chatEvent)("currentUserId",(e.loggedUser==null||e.loggedUser.id==null?null:e.loggedUser.id.toString())||null)}}var zT=class i{constructor(n,e,a,d,r,C,P){this.route=n;this.router=e;this.authService=a;this.http=d;this.eventService=r;this.userService=C;this.confirmation=P}mapView;showSignUp=!1;showSignIn=!1;showVerifyPopup=!1;showCropPopup=!1;selectedImageFile=null;showCreateEventPopup=!1;showChatModal=!1;showLocationSelector=!1;selectedEvent=null;chatEvent=null;previousSelectedEvent=null;eventScreenPosition=null;showUserProfile=!1;selectedUserProfileId=null;loggedUser=null;recentEmail="";recentToken="";emailVerified=!1;pendingSharedEventId=null;sharedEventRetryCount=0;sharedEventLoading=!1;ngOnInit(){this.refreshLocalUser(),this.checkAdminRedirect(),this.userService.userUpdates$.subscribe(()=>{this.refreshUserFromBackend()}),this.route.queryParams.subscribe(n=>{let e=n.token,a=n.email,d=n.user,r=n.event;if(d&&(this.openUserProfile(d),this.router.navigate([],{relativeTo:this.route,queryParams:{user:null},queryParamsHandling:"merge",replaceUrl:!0})),r){let C=Number(r);Number.isNaN(C)||(this.pendingSharedEventId=C,this.loadSharedEvent()),this.router.navigate([],{relativeTo:this.route,queryParams:{event:null},queryParamsHandling:"merge",replaceUrl:!0})}e&&(this.recentToken=e,this.recentEmail=a||"",this.openVerifyPopup(),this.authService.verifyEmail(e).subscribe({next:C=>{this.emailVerified=!0},error:()=>this.emailVerified=!1}))})}ngAfterViewInit(){this.loadSharedEvent()}checkAdminRedirect(){this.loggedUser&&this.loggedUser.isAdmin&&this.router.navigate(["/admin"])}refreshLocalUser(){let n=localStorage.getItem("user");if(n)try{this.loggedUser=JSON.parse(n)}catch(e){console.error("Error parsing local user",e),localStorage.removeItem("user")}}refreshUserFromBackend(){this.loggedUser&&this.userService.getUserById(this.loggedUser.id).subscribe({next:n=>{if(this.loggedUser={id:n.id||"",name:n.name||n.email||"User",email:n.email||"",description:n.description,profileImage:n.profileImage,followersCount:n.followersCount,followingCount:n.followingCount,isAdmin:n.isAdmin},this.loggedUser?.isAdmin){this.router.navigate(["/admin"]);return}localStorage.setItem("user",JSON.stringify(this.loggedUser)),console.log("User refreshed:",this.loggedUser)},error:n=>console.error("Error refreshing user",n)})}loadSharedEvent(){if(!this.pendingSharedEventId||this.sharedEventLoading)return;let n=this.pendingSharedEventId,e=this.loggedUser?this.loggedUser.id:void 0;this.sharedEventLoading=!0,this.eventService.getEventById(n,e).subscribe({next:a=>{this.sharedEventLoading=!1,this.openSharedEventOnMap(a)},error:a=>{this.sharedEventLoading=!1,this.pendingSharedEventId=null,console.error("Error loading shared event",a)}})}openSharedEventOnMap(n){if(!this.mapView?.map){this.sharedEventRetryCount<12&&(this.sharedEventRetryCount+=1,setTimeout(()=>this.openSharedEventOnMap(n),250));return}this.sharedEventRetryCount=0,this.pendingSharedEventId=null,this.mapView.flyToEvent(n)}openVerifyPopup(n,e){n!==void 0&&(this.recentEmail=n),e!==void 0&&(this.recentToken=e),this.closeAll(),this.showVerifyPopup=!0}resendEmail(){!this.recentToken&&!this.recentEmail||this.authService.resendEmail({oldToken:this.recentToken,email:this.recentEmail}).subscribe({next:n=>{n?.data?.token&&(this.recentToken=n.data.token),this.emailVerified=!1},error:n=>{console.error("Error resending verification email",n)}})}openSignUp(){this.closeAll(),this.showSignUp=!0}openSignIn(){this.closeAll(),this.showSignIn=!0}closeAll(){this.showSignUp=!1,this.showSignIn=!1,this.showVerifyPopup=!1,this.showCropPopup=!1,this.showCreateEventPopup=!1,this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent=null,this.showLocationSelector=!1,this.closeEventPopup(),this.mapView&&(this.mapView.managedPopupType=null),this.showUserProfile=!1,this.selectedUserProfileId=null}openUserProfile(n){console.log("[Home] openUserProfile",n),this.closeAll(),this.selectedUserProfileId=n,this.showUserProfile=!0}openEventPopup(n){this.selectedEvent=n,this.updateCardPosition(),this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.on("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this)),this.mapView.map.on("click",this.onMapClick.bind(this)));let e=this.loggedUser?this.loggedUser.id:void 0;this.eventService.getEventById(n.id,e).subscribe({next:a=>{this.selectedEvent=a,this.updateCardPosition()},error:a=>console.error("Error fetching fresh event data",a)}),setTimeout(()=>{document.addEventListener("click",this.onDocumentClick)},0)}openChat(n){if(!this.loggedUser){this.openSignIn();return}this.selectedEvent&&(this.previousSelectedEvent=this.selectedEvent,this.closeEventPopup()),this.chatEvent=n,this.showChatModal=!0}onChatNotification(n){if(!this.loggedUser){this.openSignIn();return}this.eventService.getEventById(n,this.loggedUser.id).subscribe({next:e=>{this.closeAll(),this.openChat(e)},error:e=>console.error("Error opening chat from notification",e)})}onUpcomingEventNotification(n){let e=this.loggedUser?this.loggedUser.id:void 0;this.eventService.getEventById(n,e).subscribe({next:a=>{this.closeAll(),this.mapView&&this.mapView.flyToEvent(a)},error:a=>console.error("Error opening event from notification",a)})}closeChat(){if(this.showChatModal=!1,this.chatEvent=null,this.previousSelectedEvent){let n=this.previousSelectedEvent;this.previousSelectedEvent=null,this.openEventPopup(n)}}onEventsUpdated(n){if(this.selectedEvent){let e=n.find(a=>a.id===this.selectedEvent.id);e&&(this.selectedEvent=e)}}updateCardPosition(){this.selectedEvent&&this.mapView&&(this.eventScreenPosition=this.mapView.getEventScreenPosition(this.selectedEvent))}onMapClick(n){n.defaultPrevented||this.closeEventPopup()}onDocumentClick=n=>{this.closeEventPopup()};closeEventPopup(){this.selectedEvent=null,this.eventScreenPosition=null,this.mapView&&this.mapView.map&&(this.mapView.map.off("move",this.updateCardPosition.bind(this)),this.mapView.map.off("click",this.onMapClick.bind(this))),document.removeEventListener("click",this.onDocumentClick)}onParticipate(n){if(console.log("onParticipate called for event:",n.id),!this.loggedUser){console.log("User not logged in, opening sign in"),this.openSignIn();return}console.log("Sending request for user:",this.loggedUser.id,"event:",n.id),this.eventService.requestParticipation(n.id,this.loggedUser.id).subscribe({next:()=>{console.log("Request success"),this.selectedEvent&&this.selectedEvent.id===n.id&&(console.log("Updating local state to PENDING"),this.selectedEvent.participationStatus="PENDING")},error:e=>console.error("Error requesting participation",e)})}onLeaveEvent(n){return Sr(this,null,function*(){if(!this.loggedUser){this.openSignIn();return}(yield this.confirmation.confirm({title:"Leave event",message:"Are you sure you want to leave the event?",confirmText:"Leave",cancelText:"Cancel"}))&&this.eventService.leaveEvent(n.id,this.loggedUser.id).subscribe({next:()=>{if(this.selectedEvent&&this.selectedEvent.id===n.id&&(this.selectedEvent.participationStatus="NONE",this.selectedEvent.isParticipating=!1,typeof this.selectedEvent.occupiedSpots=="number"&&this.selectedEvent.occupiedSpots>0&&(this.selectedEvent.occupiedSpots-=1)),this.mapView){let a=this.mapView.events.find(d=>d.id===n.id);a&&(a.participationStatus="NONE",a.isParticipating=!1,typeof a.occupiedSpots=="number"&&a.occupiedSpots>0&&(a.occupiedSpots-=1))}},error:a=>console.error("Error leaving event",a)})})}onDeleteEvent(n){return Sr(this,null,function*(){if(!this.loggedUser){this.openSignIn();return}if(n.creatorId&&n.creatorId.toString()!==this.loggedUser.id.toString()){console.warn("You are not the eventer of this event");return}(yield this.confirmation.confirm({title:"Delete event",message:"Are you sure you want to delete this event? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.eventService.deleteEvent(n.id).subscribe({next:()=>{this.mapView&&(this.mapView.events=this.mapView.events.filter(a=>a.id!==n.id),this.mapView.loadEvents?.()),this.closeEventPopup()},error:a=>console.error("Error deleting event",a)})})}onToggleFavorite(){this.selectedEvent&&this.mapView&&this.mapView.onToggleFavorite(this.selectedEvent)}openShare(n){this.mapView&&this.mapView.openShare(n)}createEventPopupRef=null;openLocationSelector(){this.showLocationSelector=!0}onLocationSelected(n){this.createEventPopupRef&&this.createEventPopupRef.setLocation(n.lat,n.lng),this.showLocationSelector=!1}switchToSignUp(){this.openSignUp()}switchToSignIn(){this.openSignIn()}onSignInSuccess(n){if(console.log("User received on sign in:",n),this.loggedUser={id:n?.id||"",name:n?.name||n?.email||"User",email:n?.email||"",profileImage:n.profileImage,isAdmin:n.isAdmin},this.loggedUser.isAdmin){this.router.navigate(["/admin"]);return}this.refreshUserFromBackend(),this.closeAll()}logout(){this.loggedUser=null,localStorage.removeItem("user"),this.closeAll()}onMenuAction(n){if(console.log("Menu action:",n),n==="logout")this.logout();else if(n==="change-photo"){let e=document.getElementById("hiddenFileInput");e&&e.click()}else n==="account"?console.log("Navigate to Account"):n==="events"?console.log("Navigate to Events"):n==="add-event"&&(console.log("Create Event clicked"),this.showCreateEventPopup=!0)}onFileSelected(n){let e=n.target.files[0];e&&(this.selectedImageFile=e,this.showCropPopup=!0,n.target.value="")}onImageCropped(n){if(this.loggedUser){let e=new FormData;e.append("file",n,"profile.jpg"),this.http.post(`http://localhost:8080/api/users/${this.loggedUser.id}/image`,e).subscribe({next:a=>{this.loggedUser&&(this.loggedUser.profileImage=a.imageUrl+"?t="+new Date().getTime(),localStorage.setItem("user",JSON.stringify(this.loggedUser)),this.closeAll())},error:a=>console.error("Error uploading image",a)})}}onFocusEventFromMenu(n){this.mapView&&this.mapView.flyToEvent(n)}onFocusEventFromProfile(n){this.closeAll(),this.mapView&&this.mapView.flyToEvent(n)}static \u0275fac=function(e){return new(e||i)(Dt(Zs),Dt(ws),Dt(Wl),Dt(yo),Dt(Xs),Dt(Es),Dt(Na))};static \u0275cmp=vn({type:i,selectors:[["Home"]],viewQuery:function(e,a){if(e&1&&Fa(Mb,5),e&2){let d;fa(d=ma())&&(a.mapView=d.first)}},decls:13,vars:11,consts:[["createEventPopup",""],[1,"home-container"],[1,"top-bar"],[3,"email","token","verified"],[3,"userId","currentUserId"],[3,"eventSelected","mapInteract","requestLogin","eventsUpdated","openUserProfile","userId"],[3,"imageFile"],[3,"display"],[3,"event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"event","currentUserId"],[1,"button",3,"click"],[3,"action","openProfile","openChatFromNotification","openEventFromNotification","focusEvent","loggedUser"],["id","hiddenFileInput","type","file","accept","image/*",2,"display","none",3,"change"],[3,"switchToSignIn","close","signUpSuccess","signInSuccess"],[3,"close","resendVerification","email","token","verified"],[3,"switchToSignUp","close","signInSuccess"],[3,"close","openProfile","focusEvent","userId","currentUserId"],[3,"close","imageCropped","imageFile"],[3,"close","eventCreated","openLocationSelector"],[3,"locationSelected","close"],[3,"close","participate","toggleFavorite","openOrganizerProfile","leave","deleteEvent","shareEvent","openChat","event","eventPosition","organizerName","organizerImage","currentUserId","creatorId"],[3,"close","event","currentUserId"]],template:function(e,a){e&1&&(z(0,"div",1),Je(1,Bre,5,0,"div",2)(2,Vre,2,1),Je(3,Ure,1,0,"SignUpPopup"),Je(4,jre,1,3,"VerifyEmailPopup",3),Je(5,$re,1,0,"SignInPopup"),Je(6,Hre,1,2,"app-user-profile-modal",4),z(7,"map-view",5),Te("eventSelected",function(r){return a.openEventPopup(r)})("mapInteract",function(){return a.closeEventPopup()})("requestLogin",function(){return a.openSignIn()})("eventsUpdated",function(r){return a.onEventsUpdated(r)})("openUserProfile",function(r){return a.openUserProfile(r)}),V(),Je(8,Gre,1,1,"CropImagePopup",6),Je(9,qre,2,2,"create-event-popup",7),Je(10,Wre,1,0,"map-location-selector"),Je(11,Zre,1,6,"event-popup-card",8),Je(12,Yre,1,2,"event-chat-modal",9),V()),e&2&&(K(),et(a.loggedUser?2:1),K(2),et(a.showSignUp?3:-1),K(),et(a.showVerifyPopup?4:-1),K(),et(a.showSignIn?5:-1),K(),et(a.showUserProfile?6:-1),K(),vt("userId",a.loggedUser?a.loggedUser.id||"":null),K(),et(a.showCropPopup&&a.selectedImageFile?8:-1),K(),et(a.showCreateEventPopup?9:-1),K(),et(a.showLocationSelector?10:-1),K(),et(a.selectedEvent?11:-1),K(),et(a.showChatModal&&a.chatEvent?12:-1))},dependencies:[Mb,wT,CT,ET,AT,PT,OT,kT,FT,NT,E0],styles:[".top-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;top:20px;right:20px;gap:8px;z-index:1000;background:var(--color-dark-gray);padding:8px;border-radius:16px;box-shadow:0 4px 20px #0000004d;box-sizing:border-box;border:1px solid var(--color-light-gray);align-items:center}@media (max-width: 768px){.top-bar[_ngcontent-%COMP%]{inset:20px auto auto 50%;transform:translate(-50%);width:90%;justify-content:center;background:#1a1a1af2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.top-bar[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{flex:1;font-size:14px;height:44px}}"]})};var Xre=()=>["/"];function Kre(i,n){if(i&1){let e=wt();z(0,"a",5),Te("click",function(){Ee(e);let d=te();return Se(d.verifyEmail())}),W(1,"Verify Email"),V()}}function Qre(i,n){i&1&&(z(0,"a",4),W(1,"Back to Home"),V()),i&2&&vt("routerLink",k_(1,Xre))}var BT=class i{constructor(n,e){this.route=n;this.authService=e}token="";verified=!1;message="Click the button to verify your email.";ngOnInit(){this.route.queryParams.subscribe(n=>{this.token=n.token||""})}verifyEmail(){this.token&&this.authService.verifyEmail(this.token).subscribe({next:n=>{this.verified=!0,this.message="You have been successfully registered! Signing you in...",n.data&&localStorage.setItem("user",JSON.stringify(n.data)),setTimeout(()=>{window.location.href="/"},1500)},error:n=>{this.verified=!1,this.message=n.error?.error||"Token is invalid or expired."}})}static \u0275fac=function(e){return new(e||i)(Dt(Zs),Dt(Wl))};static \u0275cmp=vn({type:i,selectors:[["VerifyEmailPage"]],decls:9,vars:2,consts:[[1,"container"],[1,"verify-container"],[1,"header"],[1,"button"],[1,"button",3,"routerLink"],[1,"button",3,"click"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),W(4,"Email Verification"),V(),z(5,"p"),W(6),V()(),Je(7,Kre,2,0,"a",3)(8,Qre,2,2,"a",4),V()()),e&2&&(K(6),ot(a.message),K(),et(a.verified?8:7))},dependencies:[Xx,n0],styles:[".container[_ngcontent-%COMP%]{background-color:var(--color-dark-gray);width:100%;height:100vh;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .verify-container[_ngcontent-%COMP%]{text-align:center;position:relative;align-items:center;width:30%;height:auto;background-color:var(--color-gray);border-radius:20px;padding:40px;border:2px solid var(--color-dark-gray);display:flex;flex-direction:column;gap:24px}"]})};var x6=()=>["/"];function Jre(i,n){if(i&1&&(z(0,"p",6),W(1),V()),i&2){let e=te();an("error",e.isError),K(),ot(e.message)}}function eoe(i,n){i&1&&(z(0,"p"),W(1,"Set a new password for your account."),V())}function toe(i,n){i&1&&(z(0,"a",4),W(1,"Back to Home"),V()),i&2&&vt("routerLink",k_(1,x6))}function noe(i,n){i&1&&(z(0,"a",4),W(1,"Back to Home"),V()),i&2&&vt("routerLink",k_(1,x6))}function ioe(i,n){if(i&1){let e=wt();z(0,"form",7),Te("ngSubmit",function(){Ee(e);let d=te();return Se(d.onSubmit())}),An(1,"FormField",8)(2,"FormField",9),z(3,"button",10),W(4,"Update password"),V()()}if(i&2){let e=te();vt("formGroup",e.form),K(),vt("error",!!e.errors.newPassword)("control",e.form.controls.newPassword)("type","password")("showToggle",!0),K(),vt("error",!!e.errors.confirmPassword)("control",e.form.controls.confirmPassword)("type","password")("showToggle",!0)}}var VT=class i{constructor(n,e,a){this.route=n;this.authService=e;this.fb=a;this.form=this.fb.nonNullable.group({newPassword:["",[Hd]],confirmPassword:[""]})}token="";message="";isError=!1;completed=!1;canSubmit=!0;errors={};form;ngOnInit(){this.route.queryParams.subscribe(n=>{this.token=n.token||"",this.token||(this.canSubmit=!1,this.isError=!0,this.message="Reset link is missing or invalid.")})}onSubmit(){if(this.errors={},this.message="",this.isError=!1,!this.token){this.isError=!0,this.message="Reset link is missing or invalid.";return}let n=this.form.controls;Hd(n.newPassword)&&(this.errors.newPassword="Password must be at least 8 characters, with a capital letter, number, and symbol.");let a=this.form.value.newPassword||"",d=this.form.value.confirmPassword||"";if(a!==d&&(this.errors.confirmPassword="Passwords do not match."),Object.keys(this.errors).length>0){this.isError=!0,this.message=Object.values(this.errors)[0]||"Fix the errors above.";return}this.authService.confirmPasswordReset({token:this.token,newPassword:a}).subscribe({next:()=>{this.completed=!0,this.isError=!1,this.message="Password updated. You can sign in now."},error:r=>{let C=r?.error;if(C?.data&&typeof C.data=="object"){this.errors=C.data,this.isError=!0,this.message=Object.values(this.errors)[0]||"Unable to reset password.";return}if(typeof C?.error=="string"){this.isError=!0,this.message=C.error;return}if(typeof r?.error=="string"){this.isError=!0,this.message=r.error;return}if(typeof r=="string"){this.isError=!0,this.message=r;return}this.isError=!0,this.message="Reset link is invalid or expired."}})}static \u0275fac=function(e){return new(e||i)(Dt(Zs),Dt(Wl),Dt(Jh))};static \u0275cmp=vn({type:i,selectors:[["ResetPasswordPage"]],decls:10,vars:2,consts:[[1,"container"],[1,"reset-container"],[1,"header"],[1,"message",3,"error"],[1,"button",3,"routerLink"],[1,"form",3,"formGroup"],[1,"message"],[1,"form",3,"ngSubmit","formGroup"],["placeholder","New password",3,"error","control","type","showToggle"],["placeholder","Confirm password",3,"error","control","type","showToggle"],["type","submit",1,"button"]],template:function(e,a){e&1&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),W(4,"Reset password"),V(),Je(5,Jre,2,3,"p",3)(6,eoe,2,0,"p"),V(),Je(7,toe,2,2,"a",4)(8,noe,2,2,"a",4)(9,ioe,5,9,"form",5),V()()),e&2&&(K(5),et(a.message?5:6),K(2),et(a.canSubmit?a.completed?8:9:7))},dependencies:[fi,Xx,n0,Nu,Qh,Kh,Qf,Bu],styles:[".container[_ngcontent-%COMP%]{background-color:var(--color-dark-gray);width:100%;height:100vh;display:flex;justify-content:center;align-items:center;padding:24px}.reset-container[_ngcontent-%COMP%]{text-align:center;width:min(440px,100%);background:var(--modal-surface);border-radius:var(--modal-radius);padding:32px 28px;border:var(--modal-border);display:flex;flex-direction:column;gap:24px;box-shadow:var(--modal-shadow)}.header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.message[_ngcontent-%COMP%]{color:var(--color-accent);font-weight:var(--font-weight-semibold)}.message.error[_ngcontent-%COMP%]{color:var(--color-error)}.form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:16px;align-items:center}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%}"]})};var UT=class i{constructor(n){this.http=n}baseUrl="http://localhost:8080/api/admin";getUsers(){return this.http.get(`${this.baseUrl}/users`)}getAllEvents(){return this.http.get(`${this.baseUrl}/events`)}approveEvent(n){return this.http.post(`${this.baseUrl}/events/${n}/approve`,{})}rejectEvent(n,e){return this.http.post(`${this.baseUrl}/events/${n}/reject`,{reason:e})}deleteEvent(n){return this.http.delete(`${this.baseUrl}/events/${n}`)}getReports(){return this.http.get(`${this.baseUrl}/reports`)}static \u0275fac=function(e){return new(e||i)(hn(yo))};static \u0275prov=kt({token:i,factory:i.\u0275fac,providedIn:"root"})};var $T=(i,n)=>n.id;function ooe(i,n){i&1&&(z(0,"h1"),W(1,"Dashboard Overview"),V())}function soe(i,n){i&1&&(z(0,"h1"),W(1,"Event Management"),V())}function aoe(i,n){i&1&&(z(0,"h1"),W(1,"User Management"),V())}function loe(i,n){i&1&&(z(0,"h1"),W(1,"Reports"),V())}function coe(i,n){if(i&1){let e=wt();z(0,"button",37),Te("click",function(){Ee(e);let d=te().$implicit,r=te(2);return Se(r.approveEvent(d))}),z(1,"mat-icon"),W(2,"check"),V()(),z(3,"button",38),Te("click",function(){Ee(e);let d=te().$implicit,r=te(2);return Se(r.rejectEvent(d))}),z(4,"mat-icon"),W(5,"close"),V()()}}function uoe(i,n){if(i&1){let e=wt();z(0,"div",35)(1,"input",39,0),Te("keyup.enter",function(){Ee(e);let d=Bl(2),r=te().$implicit,C=te(2);return Se(C.confirmReject(r,d.value))}),V(),z(3,"button",40),Te("click",function(){Ee(e);let d=Bl(2),r=te().$implicit,C=te(2);return Se(C.confirmReject(r,d.value))}),z(4,"mat-icon"),W(5,"check"),V()(),z(6,"button",41),Te("click",function(){Ee(e);let d=te().$implicit,r=te(2);return Se(r.cancelReject(d.id))}),z(7,"mat-icon"),W(8,"close"),V()()()}}function doe(i,n){if(i&1&&(z(0,"tr",36)(1,"td",42)(2,"div",43)(3,"div",44)(4,"span",45),W(5,"Description"),V(),z(6,"span",46),W(7),V()(),z(8,"div",47)(9,"span",45),W(10,"Date"),V(),z(11,"span",48),W(12),V()(),z(13,"div",47)(14,"span",45),W(15,"Time"),V(),z(16,"span",48),W(17),V()(),z(18,"div",47)(19,"span",45),W(20,"City"),V(),z(21,"span",48),W(22),V()(),z(23,"div",47)(24,"span",45),W(25,"Capacity"),V(),z(26,"span",48),W(27),V()(),z(28,"div",47)(29,"span",45),W(30,"Cost"),V(),z(31,"span",48),W(32),V()(),z(33,"div",47)(34,"span",45),W(35,"Coordinates"),V(),z(36,"span",48),W(37),V()(),z(38,"div",47)(39,"span",45),W(40,"Created"),V(),z(41,"span",48),W(42),V()(),z(43,"div",47)(44,"span",45),W(45,"Organizer"),V(),z(46,"span",48),W(47),V()(),z(48,"div",47)(49,"span",45),W(50,"Event ID"),V(),z(51,"span",48),W(52),V()()()()()),i&2){let e=te().$implicit;K(7),ot(e.description||"No description provided."),K(5),ot(e.date||"-"),K(5),ga("",e.startTime||"-"," - ",e.endTime||"-"),K(5),ot(e.city||"-"),K(5),ot(e.nPartecipants||"-"),K(5),ot(e.costPerPerson!=null?e.costPerPerson+" EUR":"Free"),K(5),ot(e.latitude!=null&&e.longitude!=null?e.latitude+", "+e.longitude:"-"),K(5),ot(e.createdAt||"-"),K(5),ot(e.organizerName||e.organizer||"Unknown"),K(5),bi("#",e.id)}}function hoe(i,n){if(i&1){let e=wt();z(0,"tr")(1,"td")(2,"div",29)(3,"strong"),W(4),V(),z(5,"span",30),W(6),V()()(),z(7,"td")(8,"div",31),An(9,"img",32),z(10,"span"),W(11),V()()(),z(12,"td"),W(13),V(),z(14,"td")(15,"div",33)(16,"button",34),Te("click",function(){let d=Ee(e).$implicit,r=te(2);return Se(r.toggleDetails(d.id))}),z(17,"mat-icon"),W(18),V()(),Je(19,coe,6,0)(20,uoe,9,0,"div",35),V()()(),Je(21,doe,53,11,"tr",36)}if(i&2){let e=n.$implicit,a=te(2);K(4),ot(e.title),K(2),ot(e.city),K(3),vt("src",e.organizerImg||"assets/img/default-avatar.png",no),K(2),ot(e.organizer),K(2),ot(e.date),K(5),ot(a.expandedEventId===e.id?"expand_less":"info"),K(),et(a.eventsCurrentlyRejecting.includes(e.id)?20:19),K(2),et(a.expandedEventId===e.id?21:-1)}}function poe(i,n){i&1&&(z(0,"tr")(1,"td",49),W(2,"No pending requests."),V()())}function foe(i,n){if(i&1){let e=wt();z(0,"div",10)(1,"div",11),Te("click",function(){Ee(e);let d=te();return Se(d.setView("users"))}),z(2,"div",12)(3,"mat-icon"),W(4,"people"),V()(),z(5,"div",13)(6,"span",14),W(7),V(),z(8,"span",15),W(9,"Registered Users"),V()()(),z(10,"div",11),Te("click",function(){Ee(e);let d=te();return Se(d.setView("events"))}),z(11,"div",16)(12,"mat-icon"),W(13,"event"),V()(),z(14,"div",13)(15,"span",14),W(16),V(),z(17,"span",15),W(18,"Total Events"),V()()(),z(19,"div",17)(20,"div",18)(21,"mat-icon"),W(22,"assignment"),V()(),z(23,"div",13)(24,"span",14),W(25),V(),z(26,"span",15),W(27,"Pending Approval"),V()()()(),z(28,"div",19)(29,"div",20)(30,"div",21)(31,"h3"),W(32,"Recent Requests"),V(),z(33,"button",22),Te("click",function(){Ee(e);let d=te();return Se(d.setView("events"))}),W(34,"See all"),V()(),z(35,"div",23)(36,"table")(37,"thead")(38,"tr")(39,"th"),W(40,"EVENT"),V(),z(41,"th"),W(42,"EVENTER"),V(),z(43,"th"),W(44,"DATE"),V(),z(45,"th"),W(46,"ACTIONS"),V()()(),z(47,"tbody"),Wi(48,hoe,22,8,null,null,$T),Je(50,poe,3,0,"tr"),V()()()(),z(51,"div",24)(52,"h3"),W(53,"Quick Actions"),V(),z(54,"div",25)(55,"button",26),Te("click",function(){Ee(e);let d=te();return Se(d.setView("events"))}),z(56,"mat-icon",27),W(57,"verified_user"),V(),z(58,"span"),W(59,"Manage Events"),V()(),z(60,"button",28),Te("click",function(){Ee(e);let d=te();return Se(d.setView("users"))}),z(61,"mat-icon",27),W(62,"search"),V(),z(63,"span"),W(64,"Search Users"),V()()()()()}if(i&2){let e=te();K(7),ot(e.totalUsers),K(9),ot(e.totalEvents),K(9),ot(e.pendingEventsCount),K(23),Zi(e.recentRequests.slice(0,5)),K(2),et(e.recentRequests.length===0?50:-1)}}function moe(i,n){i&1&&(z(0,"span",53),W(1,"Approved"),V())}function goe(i,n){i&1&&(z(0,"span",54),W(1,"Pending"),V())}function _oe(i,n){if(i&1){let e=wt();z(0,"button",37),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te(2);return Se(r.approveEvent(d))}),z(1,"mat-icon"),W(2,"check"),V()(),z(3,"button",38),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te(2);return Se(r.rejectEvent(d))}),z(4,"mat-icon"),W(5,"close"),V()()}}function voe(i,n){if(i&1){let e=wt();z(0,"div",35)(1,"input",39,0),Te("keyup.enter",function(){Ee(e);let d=Bl(2),r=te(2).$implicit,C=te(2);return Se(C.confirmReject(r,d.value))}),V(),z(3,"button",40),Te("click",function(){Ee(e);let d=Bl(2),r=te(2).$implicit,C=te(2);return Se(C.confirmReject(r,d.value))}),z(4,"mat-icon"),W(5,"check"),V()(),z(6,"button",41),Te("click",function(){Ee(e);let d=te(2).$implicit,r=te(2);return Se(r.cancelReject(d.id))}),z(7,"mat-icon"),W(8,"close"),V()()()}}function yoe(i,n){if(i&1&&Je(0,_oe,6,0)(1,voe,9,0,"div",35),i&2){let e=te().$implicit,a=te(2);et(a.eventsCurrentlyRejecting.includes(e.id)?1:0)}}function xoe(i,n){if(i&1){let e=wt();z(0,"button",56),Te("click",function(){Ee(e);let d=te().$implicit,r=te(2);return Se(r.deleteEvent(d))}),z(1,"mat-icon"),W(2,"delete_outline"),V()()}}function boe(i,n){if(i&1&&(z(0,"tr",36)(1,"td",57)(2,"div",43)(3,"div",44)(4,"span",45),W(5,"Description"),V(),z(6,"span",46),W(7),V()(),z(8,"div",47)(9,"span",45),W(10,"Date"),V(),z(11,"span",48),W(12),V()(),z(13,"div",47)(14,"span",45),W(15,"Time"),V(),z(16,"span",48),W(17),V()(),z(18,"div",47)(19,"span",45),W(20,"City"),V(),z(21,"span",48),W(22),V()(),z(23,"div",47)(24,"span",45),W(25,"Capacity"),V(),z(26,"span",48),W(27),V()(),z(28,"div",47)(29,"span",45),W(30,"Cost"),V(),z(31,"span",48),W(32),V()(),z(33,"div",47)(34,"span",45),W(35,"Coordinates"),V(),z(36,"span",48),W(37),V()(),z(38,"div",47)(39,"span",45),W(40,"Created"),V(),z(41,"span",48),W(42),V()(),z(43,"div",47)(44,"span",45),W(45,"Organizer"),V(),z(46,"span",48),W(47),V()(),z(48,"div",47)(49,"span",45),W(50,"Event ID"),V(),z(51,"span",48),W(52),V()()()()()),i&2){let e=te().$implicit;K(7),ot(e.description||"No description provided."),K(5),ot(e.date||"-"),K(5),ga("",e.startTime||"-"," - ",e.endTime||"-"),K(5),ot(e.city||"-"),K(5),ot(e.nPartecipants||"-"),K(5),ot(e.costPerPerson!=null?e.costPerPerson+" EUR":"Free"),K(5),ot(e.latitude!=null&&e.longitude!=null?e.latitude+", "+e.longitude:"-"),K(5),ot(e.createdAt||"-"),K(5),ot(e.organizerName||e.organizer||"Unknown"),K(5),bi("#",e.id)}}function woe(i,n){if(i&1){let e=wt();z(0,"tr")(1,"td"),W(2),V(),z(3,"td")(4,"div",29)(5,"strong"),W(6),V(),z(7,"span",30),W(8),V()()(),z(9,"td")(10,"div",31),An(11,"img",32),z(12,"span"),W(13),V()()(),z(14,"td"),Je(15,moe,2,0,"span",53)(16,goe,2,0,"span",54),V(),z(17,"td"),W(18),V(),z(19,"td")(20,"div",33)(21,"button",34),Te("click",function(){let d=Ee(e).$implicit,r=te(2);return Se(r.toggleDetails(d.id))}),z(22,"mat-icon"),W(23),V()(),Je(24,yoe,2,1),$i(25,xoe,3,0,"button",55),V()()(),Je(26,boe,53,11,"tr",36)}if(i&2){let e=n.$implicit,a=te(2);K(2),bi("#",e.id),K(4),ot(e.title),K(2),ot(e.city),K(3),vt("src",e.organizerImage||"assets/img/default-avatar.png",no),K(2),ot(e.organizerName||"Unknown"),K(2),et(e.isApproved?15:16),K(3),ot(e.date),K(5),ot(a.expandedEventId===e.id?"expand_less":"info"),K(),et(e.isApproved?-1:24),K(),vt("ngIf",e.isApproved),K(),et(a.expandedEventId===e.id?26:-1)}}function Coe(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",50)(2,"mat-icon",51),W(3,"search"),V(),z(4,"input",52),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.searchTermEvents,d)||(r.searchTermEvents=d),Se(d)}),V()(),z(5,"div",23)(6,"table")(7,"thead")(8,"tr")(9,"th"),W(10,"ID"),V(),z(11,"th"),W(12,"EVENT"),V(),z(13,"th"),W(14,"EVENTER"),V(),z(15,"th"),W(16,"STATUS"),V(),z(17,"th"),W(18,"DATE"),V(),z(19,"th"),W(20,"ACTIONS"),V()()(),z(21,"tbody"),Wi(22,woe,27,11,null,null,$T),V()()()()}if(i&2){let e=te();K(4),_o("ngModel",e.searchTermEvents),K(18),Zi(e.filteredEvents)}}function Eoe(i,n){i&1&&(z(0,"span",59),W(1,"Admin"),V())}function Soe(i,n){i&1&&(z(0,"span",60),W(1,"User"),V())}function Toe(i,n){if(i&1&&(z(0,"tr")(1,"td"),W(2),V(),z(3,"td")(4,"div",31),An(5,"img",32),z(6,"span"),W(7),V()()(),z(8,"td"),W(9),V(),z(10,"td"),Je(11,Eoe,2,0,"span",59)(12,Soe,2,0,"span",60),V()()),i&2){let e=n.$implicit;K(2),bi("#",e.id),K(3),vt("src",e.profileImage||"assets/img/default-avatar.png",no),K(2),ot(e.name),K(2),ot(e.email),K(2),et(e.isAdmin?11:12)}}function Ioe(i,n){if(i&1){let e=wt();z(0,"div",8)(1,"div",50)(2,"mat-icon",51),W(3,"search"),V(),z(4,"input",58),vo("ngModelChange",function(d){Ee(e);let r=te();return To(r.searchTermUsers,d)||(r.searchTermUsers=d),Se(d)}),V()(),z(5,"div",23)(6,"table")(7,"thead")(8,"tr")(9,"th"),W(10,"ID"),V(),z(11,"th"),W(12,"USER"),V(),z(13,"th"),W(14,"EMAIL"),V(),z(15,"th"),W(16,"ROLE"),V()()(),z(17,"tbody"),Wi(18,Toe,13,5,"tr",null,$T),V()()()()}if(i&2){let e=te();K(4),_o("ngModel",e.searchTermUsers),K(14),Zi(e.filteredUsers)}}function Moe(i,n){i&1&&(z(0,"div",66),W(1,"No reports yet."),V())}function Doe(i,n){if(i&1&&(An(0,"span",78),z(1,"span",79),W(2),Ls(3,"date"),V()),i&2){let e=te().$implicit;K(2),ot(L_(3,1,e.createdAt,"short"))}}function Aoe(i,n){if(i&1){let e=wt();z(0,"div",72),Te("click",function(){let d=Ee(e).$implicit,r=te(3);return Se(r.selectReport(d))}),z(1,"div",73)(2,"div",74),W(3),V(),z(4,"span",75),W(5),V()(),z(6,"div",76)(7,"span",77),W(8),V(),Je(9,Doe,4,4),V()()}if(i&2){let e=n.$implicit,a=te(3);an("active",(a.selectedReport==null?null:a.selectedReport.id)===e.id),K(3),ot(e.reason),K(),an("user",e.targetType==="USER")("event",e.targetType==="EVENT"),K(),bi(" ",e.targetType==="USER"?"User":"Event"," "),K(3),ot(e.targetName),K(),et(e.createdAt?9:-1)}}function Poe(i,n){if(i&1){let e=wt();z(0,"button",80),Te("click",function(){Ee(e);let d=te(3);return Se(d.toggleReportsExpanded())}),z(1,"mat-icon"),W(2),V(),W(3),V()}if(i&2){let e=te(3);K(2),ot(e.showAllReports?"expand_less":"expand_more"),K(),bi(" ",e.showAllReports?"Show fewer":"Show more reports"," ")}}function Ooe(i,n){if(i&1&&(z(0,"div",69),Wi(1,Aoe,10,10,"div",70,$T),V(),Je(3,Poe,4,2,"button",71)),i&2){let e=te(2);K(),Zi(e.visibleReports),K(2),et(e.hasMoreReports?3:-1)}}function Roe(i,n){if(i&1&&(z(0,"div",84)(1,"span",85),W(2,"Created:"),V(),z(3,"span",86),W(4),Ls(5,"date"),V()()),i&2){let e=te(3);K(4),ot(L_(5,1,e.selectedReport.createdAt,"medium"))}}function koe(i,n){if(i&1&&(z(0,"a",89)(1,"mat-icon"),W(2,"download"),V(),W(3," Download image "),V()),i&2){let e=te(3);vt("href",e.selectedReport.imageUrl,no)}}function Foe(i,n){i&1&&(z(0,"div",66),W(1,"No image attached."),V())}function Loe(i,n){if(i&1&&(z(0,"div",68)(1,"div",81)(2,"div")(3,"span",82),W(4,"Report details"),V(),z(5,"h3"),W(6),V()(),z(7,"span",75),W(8),V()(),z(9,"div",83)(10,"div",84)(11,"span",85),W(12,"Reported:"),V(),z(13,"span",86),W(14),V()(),z(15,"div",84)(16,"span",85),W(17,"Type:"),V(),z(18,"span",86),W(19),V()(),z(20,"div",84)(21,"span",85),W(22,"Reporter:"),V(),z(23,"span",86),W(24),V()(),Je(25,Roe,6,4,"div",84),z(26,"div",87)(27,"span",85),W(28,"Details:"),V(),z(29,"span",86),W(30),V()()(),z(31,"div",88),Je(32,koe,4,1,"a",89)(33,Foe,2,0,"div",66),V()()),i&2){let e=te(2);K(6),ot(e.selectedReport.reason),K(),an("user",e.selectedReport.targetType==="USER")("event",e.selectedReport.targetType==="EVENT"),K(),bi(" ",e.selectedReport.targetType==="USER"?"User":"Event"," "),K(6),ot(e.selectedReport.targetName),K(5),ot(e.selectedReport.targetType),K(5),ot(e.selectedReport.reporterName),K(),et(e.selectedReport.createdAt?25:-1),K(5),ot(e.selectedReport.details||"No details provided."),K(2),et(e.selectedReport.hasImage&&e.selectedReport.imageUrl?32:33)}}function Noe(i,n){i&1&&(z(0,"div",66),W(1,"Select a report to see details."),V())}function zoe(i,n){if(i&1&&(z(0,"div",9)(1,"div",61)(2,"div",62)(3,"div",63)(4,"h3"),W(5,"Reports queue"),V()(),z(6,"div",64)(7,"span",65),W(8),V(),z(9,"span",65),W(10),V(),z(11,"span",65),W(12),V()()(),Je(13,Moe,2,0,"div",66)(14,Ooe,4,1),V(),z(15,"div",67),Je(16,Loe,34,12,"div",68)(17,Noe,2,0,"div",66),V()()),i&2){let e=te();K(8),bi("Total ",e.reports.length),K(2),bi("Users ",e.reportTypeCounts.USER),K(2),bi("Events ",e.reportTypeCounts.EVENT),K(),et(e.reports.length===0?13:14),K(3),et(e.selectedReport?16:17)}}var jT=class i{constructor(n,e,a,d){this.router=n;this.adminService=e;this.confirmation=a;this.snackBar=d}users=[];allEvents=[];recentRequests=[];totalUsers=0;totalEvents=0;pendingEventsCount=0;currentView="dashboard";reports=[];selectedReport=null;loadingReports=!1;showAllReports=!1;reportsPreviewLimit=6;searchTermEvents="";searchTermUsers="";expandedEventId=null;pollSubscription=null;ngOnInit(){this.loadData(),this.startPolling()}ngOnDestroy(){this.stopPolling()}startPolling(){this.pollSubscription=pf(5e3).subscribe(()=>{this.loadData()})}stopPolling(){this.pollSubscription&&(this.pollSubscription.unsubscribe(),this.pollSubscription=null)}setView(n){this.currentView=n,this.expandedEventId=null,n==="reports"&&(this.showAllReports=!1,this.loadReports())}get filteredEvents(){if(!this.searchTermEvents.trim())return this.allEvents;let n=this.searchTermEvents.toLowerCase();return this.allEvents.filter(e=>e.title?.toLowerCase().includes(n)||e.city?.toLowerCase().includes(n)||e.organizerName?.toLowerCase().includes(n))}get filteredUsers(){if(!this.searchTermUsers.trim())return this.users;let n=this.searchTermUsers.toLowerCase();return this.users.filter(e=>e.name?.toLowerCase().includes(n)||e.email?.toLowerCase().includes(n))}loadData(){this.adminService.getUsers().subscribe(n=>{this.users=n,this.calculateStats()}),this.adminService.getAllEvents().subscribe(n=>{this.allEvents=n,this.calculateStats()}),this.loadReports()}calculateStats(){if(this.totalUsers=this.users.length,this.allEvents){this.totalEvents=this.allEvents.length;let n=this.allEvents.filter(e=>e.isApproved===!1);this.pendingEventsCount=n.length,this.recentRequests=n.map(e=>Ci(Ht({},e),{organizer:e.organizerName||"Unknown",organizerImg:e.organizerImage}))}}toggleDetails(n){this.expandedEventId===n?this.expandedEventId=null:this.expandedEventId=n}approveEvent(n){this.adminService.approveEvent(n.id).subscribe(()=>{this.loadData()})}eventsCurrentlyRejecting=[];rejectEvent(n){this.eventsCurrentlyRejecting.includes(n.id)||this.eventsCurrentlyRejecting.push(n.id)}cancelReject(n){this.eventsCurrentlyRejecting=this.eventsCurrentlyRejecting.filter(e=>e!==n)}confirmReject(n,e){console.log("Confirming reject for event:",n.id,"Reason:",e),this.adminService.rejectEvent(n.id,e).subscribe({next:()=>{console.log("Rejection successful"),this.cancelReject(n.id),this.loadData()},error:a=>{console.error("Rejection failed:",a),this.showToast("Error while rejecting the event.","error")}})}deleteEvent(n){return Sr(this,null,function*(){(yield this.confirmation.confirm({title:"Delete event",message:`Are you sure you want to permanently delete the event "${n.title}"? This action will remove the event from the map and all user lists. It cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",tone:"danger"}))&&this.adminService.deleteEvent(n.id).subscribe({next:()=>{this.loadData()},error:a=>{console.error("Error deleting event",a),this.showToast("Error deleting the event.","error")}})})}loadReports(){this.loadingReports||(this.loadingReports=!0,this.adminService.getReports().subscribe({next:n=>{if(this.reports=n,this.selectedReport){let e=n.find(a=>a.id===this.selectedReport?.id)||null;this.selectedReport=e}this.loadingReports=!1},error:n=>{console.error("Error loading reports",n),this.loadingReports=!1}}))}get visibleReports(){return this.showAllReports?this.reports:this.reports.slice(0,this.reportsPreviewLimit)}get hasMoreReports(){return this.reports.length>this.reportsPreviewLimit}get reportTypeCounts(){let n={USER:0,EVENT:0,OTHER:0};for(let e of this.reports)e.targetType==="USER"?n.USER+=1:e.targetType==="EVENT"?n.EVENT+=1:n.OTHER+=1;return n}toggleReportsExpanded(){this.showAllReports=!this.showAllReports}selectReport(n){this.selectedReport=n}signOut(){localStorage.removeItem("user"),this.router.navigate(["/"])}showToast(n,e="default"){this.snackBar.open(n,void 0,{duration:e==="error"?1600:1e3,horizontalPosition:"center",verticalPosition:"top",panelClass:e==="error"?["toast-snackbar","toast-snackbar--error"]:["toast-snackbar"]})}static \u0275fac=function(e){return new(e||i)(Dt(ws),Dt(UT),Dt(Na),Dt(zc))};static \u0275cmp=vn({type:i,selectors:[["app-admin-dashboard"]],decls:38,vars:15,consts:[["reasonInput",""],[1,"admin-container"],[1,"sidebar"],[1,"logo"],["href","javascript:void(0)",1,"nav-item",3,"click"],[1,"btn-logout",3,"click"],[1,"main-content"],[1,"header"],[1,"full-table-section"],[1,"reports-grid"],[1,"stats-grid"],[1,"stat-card",3,"click"],[1,"stat-icon","users-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-icon","events-icon"],[1,"stat-card"],[1,"stat-icon","pending-icon"],[1,"dashboard-grid"],[1,"requests-section"],[1,"section-header"],[1,"btn-link",3,"click"],[1,"table-container"],[1,"actions-section"],[1,"quick-actions"],[1,"action-card",3,"click"],[1,"action-icon"],[1,"action-card","outline",3,"click"],[1,"ev-cell-title"],[1,"ev-sub"],[1,"ev-organizer"],[1,"table-avatar",3,"src"],[1,"action-buttons"],["title","View details",1,"btn-icon","info",3,"click"],[1,"inline-reject"],[1,"event-details-row"],["title","Approve",1,"btn-icon","approve",3,"click"],["title","Reject",1,"btn-icon","reject",3,"click"],["type","text","placeholder","Reason...","autoFocus","",1,"input-reason",3,"keyup.enter"],[1,"btn-icon","approve",3,"click"],[1,"btn-icon","reject",3,"click"],["colspan","4"],[1,"event-details"],[1,"detail-item","full"],[1,"detail-label"],[1,"detail-value","description"],[1,"detail-item"],[1,"detail-value"],["colspan","4",1,"no-data"],[1,"search-container"],[1,"search-icon"],["type","text","placeholder","Search events by title, city or eventer...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","approved"],[1,"status-badge","pending"],["class","btn-icon delete","title","Delete Permanently",3,"click",4,"ngIf"],["title","Delete Permanently",1,"btn-icon","delete",3,"click"],["colspan","6"],["type","text","placeholder","Search users by name or email...",1,"search-input",3,"ngModelChange","ngModel"],[1,"status-badge","admin"],[1,"status-badge","user"],[1,"reports-list"],[1,"reports-header"],[1,"reports-title"],[1,"reports-chips"],[1,"reports-chip"],[1,"no-data"],[1,"report-detail"],[1,"detail-card"],[1,"reports-items"],[1,"report-item",3,"active"],[1,"reports-toggle"],[1,"report-item",3,"click"],[1,"report-item-top"],[1,"report-title"],[1,"report-type"],[1,"report-meta"],[1,"report-target"],[1,"report-dot"],[1,"report-date"],[1,"reports-toggle",3,"click"],[1,"detail-header"],[1,"detail-kicker"],[1,"detail-grid"],[1,"detail-row"],[1,"report-detail-label"],[1,"report-detail-value"],[1,"detail-row","full"],[1,"detail-actions"],["download","",1,"button","download-btn",3,"href"]],template:function(e,a){e&1&&(z(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),W(4,"LUMO "),z(5,"span"),W(6,"Admin"),V()()(),z(7,"nav")(8,"a",4),Te("click",function(){return a.setView("dashboard")}),z(9,"mat-icon"),W(10,"dashboard"),V(),W(11," Dashboard "),V(),z(12,"a",4),Te("click",function(){return a.setView("events")}),z(13,"mat-icon"),W(14,"event"),V(),W(15," Events "),V(),z(16,"a",4),Te("click",function(){return a.setView("users")}),z(17,"mat-icon"),W(18,"people"),V(),W(19," Users "),V(),z(20,"a",4),Te("click",function(){return a.setView("reports")}),z(21,"mat-icon"),W(22,"flag"),V(),W(23," Reports "),V()(),z(24,"button",5),Te("click",function(){return a.signOut()}),z(25,"mat-icon"),W(26,"logout"),V(),W(27," Logout "),V()(),z(28,"div",6)(29,"div",7),Je(30,ooe,2,0,"h1")(31,soe,2,0,"h1")(32,aoe,2,0,"h1")(33,loe,2,0,"h1"),V(),Je(34,foe,65,4),Je(35,Coe,24,1,"div",8),Je(36,Ioe,20,1,"div",8),Je(37,zoe,18,5,"div",9),V()()),e&2&&(K(8),an("active",a.currentView==="dashboard"),K(4),an("active",a.currentView==="events"),K(4),an("active",a.currentView==="users"),K(4),an("active",a.currentView==="reports"),K(8),an("reports-view",a.currentView==="reports"),K(2),et(a.currentView==="dashboard"?30:a.currentView==="events"?31:a.currentView==="users"?32:a.currentView==="reports"?33:-1),K(4),et(a.currentView==="dashboard"?34:-1),K(),et(a.currentView==="events"?35:-1),K(),et(a.currentView==="users"?36:-1),K(),et(a.currentView==="reports"?37:-1))},dependencies:[fi,cs,Pi,Ai,Fu,Ba,Cs,Ys,va,Cx],styles:[".admin-container[_ngcontent-%COMP%]{display:flex;height:100vh;background:radial-gradient(circle at 14% 18%,rgba(252,195,36,.18),transparent 42%),linear-gradient(160deg,#1a1a1a,#101010 55%,#060606);color:var(--color-white);font-family:var(--font-stack-headline);overflow:hidden}.sidebar[_ngcontent-%COMP%]{width:250px;background:transparent;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;padding:20px;flex-shrink:0;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.logo[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--color-white);margin:0 0 40px;font-size:20px;font-weight:var(--font-weight-semibold)}.logo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--color-accent)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex-grow:1}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;color:var(--color-light-gray);text-decoration:none;border-radius:var(--radius-sm);transition:all .2s;font-size:14px;font-weight:var(--font-weight-medium)}.nav-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.nav-item.active[_ngcontent-%COMP%], .nav-item[_ngcontent-%COMP%]:hover{background-color:#fcc3241a;color:var(--color-accent)}.nav-item.active[_ngcontent-%COMP%]{border-left:3px solid var(--color-accent)}.btn-logout[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:transparent;border:1px solid var(--color-gray);color:var(--color-light-gray);border-radius:var(--radius-sm);cursor:pointer;margin-top:auto;width:100%;transition:all .2s;font-family:var(--font-stack-headline)}.btn-logout[_ngcontent-%COMP%]:hover{background:var(--color-gray);color:var(--color-white)}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:30px 40px;overflow-y:auto}.main-content.reports-view[_ngcontent-%COMP%]{overflow:hidden}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;margin:0 0 30px;font-weight:var(--font-weight-semibold);color:var(--color-white)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}.stat-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;display:flex;align-items:center;gap:20px;border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.stat-card[_ngcontent-%COMP%]:hover{border-color:#fcc32480;box-shadow:0 0 15px #fcc3241a;transform:translateY(-2px)}.stat-icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--radius-md);background:#ffffff1a;display:flex;align-items:center;justify-content:center}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-white)}.users-icon[_ngcontent-%COMP%]{background:#ffffff1a}.events-icon[_ngcontent-%COMP%]{background:#fcc3241a}.events-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-accent)}.pending-icon[_ngcontent-%COMP%]{background:#ffffff1a}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:28px;font-weight:var(--font-weight-bold);color:var(--color-white)}.stat-label[_ngcontent-%COMP%]{font-size:13px;color:var(--color-light-gray)}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:20px}.requests-section[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:24px;padding:24px;border:1px solid rgba(255,255,255,.1)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:16px;font-weight:var(--font-weight-semibold)}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-light-gray);cursor:pointer;font-size:12px;font-family:var(--font-stack-headline)}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}th[_ngcontent-%COMP%]{text-align:left;color:var(--color-light-gray);font-size:11px;text-transform:uppercase;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.1);font-weight:var(--font-weight-medium)}td[_ngcontent-%COMP%]{padding:16px 0;border-bottom:1px solid rgba(255,255,255,.1);vertical-align:middle}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.ev-cell-title[_ngcontent-%COMP%]{display:flex;flex-direction:column}.ev-cell-title[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--color-white);font-weight:var(--font-weight-medium)}.ev-sub[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.ev-organizer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.table-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:var(--radius-full);object-fit:cover}.event-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-top:0}.event-details[_ngcontent-%COMP%]{background:#ffffff08;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px 24px}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.detail-item.full[_ngcontent-%COMP%]{grid-column:1 / -1}.detail-label[_ngcontent-%COMP%]{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--color-light-gray)}.detail-value[_ngcontent-%COMP%]{font-size:12px;color:var(--color-white)}.detail-value.description[_ngcontent-%COMP%]{color:#ddd;line-height:1.4;white-space:pre-wrap}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.btn-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.approve[_ngcontent-%COMP%]{background:#10b9811a;color:var(--success)}.approve[_ngcontent-%COMP%]{background:#4caf501a;color:#4caf50}.approve[_ngcontent-%COMP%]:hover{background:#4caf50;color:#fff}.reject[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.reject[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.delete[_ngcontent-%COMP%]{background:#e539351a;color:var(--color-error)}.delete[_ngcontent-%COMP%]:hover{background:var(--color-error);color:#fff}.info[_ngcontent-%COMP%]{background:#2196f31a;color:#2196f3}.info[_ngcontent-%COMP%]:hover{background:#2196f3;color:#fff}.inline-reject[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center}.input-reason[_ngcontent-%COMP%]{background:var(--color-dark-gray);border:1px solid var(--color-bit-gray);color:var(--color-white);padding:5px 8px;border-radius:4px;width:120px;height:32px;outline:none;font-family:var(--font-stack-headline)}.input-reason[_ngcontent-%COMP%]:focus{border-color:var(--color-accent)}.actions-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.actions-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;color:var(--color-white);font-weight:var(--font-weight-semibold)}.quick-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.action-card[_ngcontent-%COMP%]{background:#ffffff08;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:24px;padding:20px;display:flex;align-items:center;gap:15px;cursor:pointer;color:var(--color-white);font-size:15px;font-weight:var(--font-weight-medium);transition:transform .2s,border-color .2s;width:100%;text-align:left;font-family:var(--font-stack-headline)}.action-card[_ngcontent-%COMP%]:hover{border-color:var(--color-accent);transform:translateY(-2px)}.action-icon[_ngcontent-%COMP%]{background:transparent;color:var(--color-accent)}.no-data[_ngcontent-%COMP%]{text-align:center;color:var(--color-light-gray);font-style:italic}@media (max-width: 768px){.admin-container[_ngcontent-%COMP%]{flex-direction:column}.sidebar[_ngcontent-%COMP%]{width:100%;flex-direction:row;padding:12px 16px;border-right:none;border-bottom:1px solid var(--color-gray);position:fixed;top:0;left:0;z-index:100;background:var(--color-dark-gray)}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{flex-direction:row;gap:8px;flex-grow:0}.nav-item[_ngcontent-%COMP%]{padding:10px 12px;font-size:12px;gap:6px}.nav-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .logo[_ngcontent-%COMP%]{display:none}.btn-logout[_ngcontent-%COMP%]{margin-top:0;margin-left:auto;width:auto;padding:10px 12px}.btn-logout[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.main-content[_ngcontent-%COMP%]{margin-left:0;padding:80px 16px 24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.stat-card[_ngcontent-%COMP%]{padding:16px}.stat-value[_ngcontent-%COMP%]{font-size:22px}table[_ngcontent-%COMP%]{font-size:12px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px 8px}.action-buttons[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-icon[_ngcontent-%COMP%]{width:28px;height:28px}.input-reason[_ngcontent-%COMP%]{width:80px}.event-details[_ngcontent-%COMP%]{grid-template-columns:1fr}.search-input[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 1024px){.dashboard-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;margin-bottom:24px}.search-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:14px;color:var(--color-light-gray);font-size:20px;width:20px;height:20px;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:12px 16px 12px 44px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background-color:#ffffff0d;color:var(--color-white);font-family:var(--font-stack-headline);font-size:14px;outline:none;transition:border-color .2s,box-shadow .2s}.search-input[_ngcontent-%COMP%]::placeholder{color:var(--color-light-gray)}.search-input[_ngcontent-%COMP%]:focus{border-color:var(--color-accent);box-shadow:0 0 0 2px #fcc32433}@media (max-width: 768px){.search-input[_ngcontent-%COMP%]{max-width:100%}}.reports-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(320px,.9fr) minmax(360px,1.2fr);gap:18px;margin-top:10px;align-items:start;height:calc(100vh - 160px)}.reports-list[_ngcontent-%COMP%], .report-detail[_ngcontent-%COMP%]{background:#ffffff0a;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px;min-height:300px;box-shadow:0 10px 30px #0003;height:100%}.reports-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-height:0}.reports-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}.reports-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--color-accent);font-size:16px;font-weight:var(--font-weight-semibold)}.reports-subtitle[_ngcontent-%COMP%]{margin:6px 0 0;font-size:12px;color:var(--color-light-gray)}.reports-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;gap:8px;justify-content:flex-end}.reports-chip[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:6px 10px;font-size:11px;color:var(--color-white);background:#ffffff0a;white-space:nowrap}.reports-items[_ngcontent-%COMP%]{display:grid;gap:10px;overflow-y:auto;padding-right:6px;flex:1;min-height:0}.reports-items[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:rgba(252,195,36,.45) rgba(255,255,255,.06)}.reports-items[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.reports-items[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff0f;border-radius:999px}.reports-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#fcc324a6,#fcc32459);border-radius:999px;border:2px solid rgba(255,255,255,.04)}.reports-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#fcc324d9,#fcc32480)}.report-item[_ngcontent-%COMP%]{padding:12px 14px;border-radius:14px;border:1px solid transparent;background:#ffffff0d;cursor:pointer;transition:border-color .2s,transform .2s,box-shadow .2s}.report-item[_ngcontent-%COMP%]:hover{border-color:#fff3;transform:translateY(-1px);box-shadow:0 6px 14px #00000040}.report-item.active[_ngcontent-%COMP%]{border-color:#fcc32499;box-shadow:0 0 12px #fcc32440;background:#fcc3240f}.report-item-top[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}.report-title[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:var(--color-white)}.report-type[_ngcontent-%COMP%]{font-size:11px;border-radius:999px;padding:4px 10px;border:1px solid rgba(255,255,255,.15);color:var(--color-light-gray);background:#ffffff0a;text-transform:uppercase;letter-spacing:.4px}.report-type.user[_ngcontent-%COMP%]{border-color:#2196f359;color:#90caf9;background:#2196f31f}.report-type.event[_ngcontent-%COMP%]{border-color:#fcc32459;color:var(--color-accent);background:#fcc3241f}.report-meta[_ngcontent-%COMP%]{font-size:12px;color:#b5b5b5;display:flex;flex-wrap:wrap;gap:6px;align-items:center}.report-dot[_ngcontent-%COMP%]{width:4px;height:4px;border-radius:50%;background:#fff6}.reports-toggle[_ngcontent-%COMP%]{align-self:flex-start;background:#ffffff0f;color:var(--color-white);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:8px 12px;display:inline-flex;align-items:center;gap:6px;cursor:pointer;font-family:var(--font-stack-headline);transition:all .2s}.reports-toggle[_ngcontent-%COMP%]:hover{border-color:#fcc32480;color:var(--color-accent)}.reports-loading[_ngcontent-%COMP%]{font-size:12px;color:var(--color-light-gray)}.detail-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;height:100%}.report-detail[_ngcontent-%COMP%]{overflow:auto;min-height:0}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}.detail-kicker[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.6px;font-size:10px;color:var(--color-light-gray)}.detail-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:4px 0 0;font-size:18px;font-weight:var(--font-weight-semibold)}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:10px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:12px;font-size:13px}.detail-row.full[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.report-detail-label[_ngcontent-%COMP%]{color:#bdbdbd;font-weight:600}.report-detail-value[_ngcontent-%COMP%]{color:var(--color-white)}.detail-actions[_ngcontent-%COMP%]{margin-top:4px}.download-btn[_ngcontent-%COMP%]{margin-top:6px;display:inline-flex;align-items:center;gap:8px;width:fit-content;background:#fcc3241f;border:1px solid rgba(252,195,36,.4);color:var(--color-accent);padding:8px 12px;border-radius:10px;font-size:12px;font-weight:var(--font-weight-medium);text-decoration:none}.download-btn[_ngcontent-%COMP%]:hover{background:#fcc32433}@media (max-width: 980px){.reports-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;height:calc(100vh - 190px)}.reports-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.reports-chips[_ngcontent-%COMP%]{justify-content:flex-start}}"]})};var b6=(i,n)=>{let e=Ve(ws),a=localStorage.getItem("user");if(a){let d=JSON.parse(a);if(d.isAdmin==="true"||d.isAdmin===!0)return!0}return e.navigate(["/"]),!1};var w6=[{path:"",component:zT},{path:"admin",component:jT,canActivate:[b6]},{path:"verify-email",component:BT},{path:"reset-password",component:VT}];var C6=(i,n)=>n(i).pipe(tl(e=>(console.error("HTTP ERROR intercepted",e),e instanceof Vh?Cc(()=>e):Cc(()=>e||"Unknown error"))));var E6={providers:[UP(jP([C6])),_O(w6),h2(),QA({eventCoalescing:!0})]};LP(OS,E6).catch(i=>console.error(i));
